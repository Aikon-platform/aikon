(function(){"use strict";function Z(){}const Is=t=>t;function Ms(t,e){for(const n in e)t[n]=e[n];return t}function Tc(t){return!!t&&(typeof t=="object"||typeof t=="function")&&typeof t.then=="function"}function xs(t){return t()}function As(){return Object.create(null)}function Ze(t){t.forEach(xs)}function _n(t){return typeof t=="function"}function _e(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}let hi;function _t(t,e){return hi||(hi=document.createElement("a")),hi.href=e,t===hi.href}function Nc(t){return Object.keys(t).length===0}function di(t,...e){if(t==null)return Z;const n=t.subscribe(...e);return n.unsubscribe?()=>n.unsubscribe():n}function Ke(t){let e;return di(t,n=>e=n)(),e}function me(t,e,n){t.$$.on_destroy.push(di(e,n))}function Et(t,e,n,i){if(t){const r=Ts(t,e,n,i);return t[0](r)}}function Ts(t,e,n,i){return t[1]&&i?Ms(n.ctx.slice(),t[1](i(e))):n.ctx}function Ct(t,e,n,i){if(t[2]&&i){const r=t[2](i(n));if(e.dirty===void 0)return r;if(typeof r=="object"){const s=[],o=Math.max(e.dirty.length,r.length);for(let l=0;l<o;l+=1)s[l]=e.dirty[l]|r[l];return s}return e.dirty|r}return e.dirty}function It(t,e,n,i,r,s){if(r){const o=Ts(e,n,i,s);t.p(o,r)}}function Mt(t){if(t.ctx.length>32){const e=[],n=t.ctx.length/32;for(let i=0;i<n;i++)e[i]=-1;return e}return-1}function Oc(t){const e={};for(const n in t)e[n]=!0;return e}function mi(t){return t??""}function pi(t){return t&&_n(t.destroy)?t.destroy:Z}const Ns=typeof window<"u";let Pc=Ns?()=>window.performance.now():()=>Date.now(),fr=Ns?t=>requestAnimationFrame(t):Z;const vn=new Set;function Os(t){vn.forEach(e=>{e.c(t)||(vn.delete(e),e.f())}),vn.size!==0&&fr(Os)}function Lc(t){let e;return vn.size===0&&fr(Os),{promise:new Promise(n=>{vn.add(e={c:t,f:n})}),abort(){vn.delete(e)}}}function y(t,e){t.appendChild(e)}function Ps(t){if(!t)return document;const e=t.getRootNode?t.getRootNode():t.ownerDocument;return e&&e.host?e:t.ownerDocument}function Rc(t){const e=w("style");return Dc(Ps(t),e),e.sheet}function Dc(t,e){return y(t.head||t,e),e.sheet}function V(t,e,n){t.insertBefore(e,n||null)}function F(t){t.parentNode&&t.parentNode.removeChild(t)}function We(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function w(t){return document.createElement(t)}function xt(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function se(t){return document.createTextNode(t)}function q(){return se(" ")}function Ge(){return se("")}function pe(t,e,n,i){return t.addEventListener(e,n,i),()=>t.removeEventListener(e,n,i)}function Bt(t){return function(e){return e.preventDefault(),t.call(this,e)}}function v(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function $c(t){return Array.from(t.childNodes)}function ve(t,e){e=""+e,t.data!==e&&(t.data=e)}function gi(t,e){t.value=e??""}function Re(t,e,n,i){n==null?t.style.removeProperty(e):t.style.setProperty(e,n,i?"important":"")}function Ls(t,e,n){for(let i=0;i<t.options.length;i+=1){const r=t.options[i];if(r.__value===e){r.selected=!0;return}}(!n||e!==void 0)&&(t.selectedIndex=-1)}function zc(t){const e=t.querySelector(":checked");return e&&e.__value}function Se(t,e,n){t.classList[n?"add":"remove"](e)}function Rs(t,e,{bubbles:n=!1,cancelable:i=!1}={}){const r=document.createEvent("CustomEvent");return r.initCustomEvent(t,n,i,e),r}function _i(t,e){return new t(e)}const vi=new Map;let yi=0;function jc(t){let e=5381,n=t.length;for(;n--;)e=(e<<5)-e^t.charCodeAt(n);return e>>>0}function Fc(t,e){const n={stylesheet:Rc(e),rules:{}};return vi.set(t,n),n}function Ds(t,e,n,i,r,s,o,l=0){const a=16.666/i;let c=`{
`;for(let g=0;g<=1;g+=a){const _=e+(n-e)*s(g);c+=g*100+`%{${o(_,1-_)}}
`}const u=c+`100% {${o(n,1-n)}}
}`,h=`__svelte_${jc(u)}_${l}`,f=Ps(t),{stylesheet:d,rules:m}=vi.get(f)||Fc(f,t);m[h]||(m[h]=!0,d.insertRule(`@keyframes ${h} ${u}`,d.cssRules.length));const p=t.style.animation||"";return t.style.animation=`${p?`${p}, `:""}${h} ${i}ms linear ${r}ms 1 both`,yi+=1,h}function Vc(t,e){const n=(t.style.animation||"").split(", "),i=n.filter(e?s=>s.indexOf(e)<0:s=>s.indexOf("__svelte")===-1),r=n.length-i.length;r&&(t.style.animation=i.join(", "),yi-=r,yi||Hc())}function Hc(){fr(()=>{yi||(vi.forEach(t=>{const{ownerNode:e}=t.stylesheet;e&&F(e)}),vi.clear())})}let Vn;function qt(t){Vn=t}function yn(){if(!Vn)throw new Error("Function called outside component initialization");return Vn}function Hn(t){yn().$$.on_mount.push(t)}function Un(t){yn().$$.on_destroy.push(t)}function bi(){const t=yn();return(e,n,{cancelable:i=!1}={})=>{const r=t.$$.callbacks[e];if(r){const s=Rs(e,n,{cancelable:i});return r.slice().forEach(o=>{o.call(t,s)}),!s.defaultPrevented}return!0}}function bn(t,e){return yn().$$.context.set(t,e),e}function vt(t){return yn().$$.context.get(t)}const wn=[],Sn=[];let kn=[];const $s=[],Uc=Promise.resolve();let hr=!1;function Bc(){hr||(hr=!0,Uc.then(mr))}function Dt(t){kn.push(t)}const dr=new Set;let En=0;function mr(){if(En!==0)return;const t=Vn;do{try{for(;En<wn.length;){const e=wn[En];En++,qt(e),qc(e.$$)}}catch(e){throw wn.length=0,En=0,e}for(qt(null),wn.length=0,En=0;Sn.length;)Sn.pop()();for(let e=0;e<kn.length;e+=1){const n=kn[e];dr.has(n)||(dr.add(n),n())}kn.length=0}while(wn.length);for(;$s.length;)$s.pop()();hr=!1,dr.clear(),qt(t)}function qc(t){if(t.fragment!==null){t.update(),Ze(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(Dt)}}function Kc(t){const e=[],n=[];kn.forEach(i=>t.indexOf(i)===-1?e.push(i):n.push(i)),n.forEach(i=>i()),kn=e}let Bn;function Wc(){return Bn||(Bn=Promise.resolve(),Bn.then(()=>{Bn=null})),Bn}function pr(t,e,n){t.dispatchEvent(Rs(`${e?"intro":"outro"}${n}`))}const wi=new Set;let Kt;function Ee(){Kt={r:0,c:[],p:Kt}}function Ce(){Kt.r||Ze(Kt.c),Kt=Kt.p}function H(t,e){t&&t.i&&(wi.delete(t),t.i(e))}function K(t,e,n,i){if(t&&t.o){if(wi.has(t))return;wi.add(t),Kt.c.push(()=>{wi.delete(t),i&&(n&&t.d(1),i())}),t.o(e)}else i&&i()}const Gc={duration:0};function Zt(t,e,n,i){const r={direction:"both"};let s=e(t,n,r),o=i?0:1,l=null,a=null,c=null;function u(){c&&Vc(t,c)}function h(d,m){const p=d.b-o;return m*=Math.abs(p),{a:o,b:d.b,d:p,duration:m,start:d.start,end:d.start+m,group:d.group}}function f(d){const{delay:m=0,duration:p=300,easing:g=Is,tick:_=Z,css:S}=s||Gc,C={start:Pc()+m,b:d};d||(C.group=Kt,Kt.r+=1),l||a?a=C:(S&&(u(),c=Ds(t,o,d,p,m,g,S)),d&&_(0,1),l=h(C,p),Dt(()=>pr(t,d,"start")),Lc(b=>{if(a&&b>a.start&&(l=h(a,p),a=null,pr(t,l.b,"start"),S&&(u(),c=Ds(t,o,l.b,l.duration,0,g,s.css))),l){if(b>=l.end)_(o=l.b,1-o),pr(t,l.b,"end"),a||(l.b?u():--l.group.r||Ze(l.group.c)),l=null;else if(b>=l.start){const k=b-l.start;o=l.a+l.d*g(k/l.duration),_(o,1-o)}}return!!(l||a)}))}return{run(d){_n(s)?Wc().then(()=>{s=s(r),f(d)}):f(d)},end(){u(),l=a=null}}}function gr(t,e){const n=e.token={};function i(r,s,o,l){if(e.token!==n)return;e.resolved=l;let a=e.ctx;o!==void 0&&(a=a.slice(),a[o]=l);const c=r&&(e.current=r)(a);let u=!1;e.block&&(e.blocks?e.blocks.forEach((h,f)=>{f!==s&&h&&(Ee(),K(h,1,1,()=>{e.blocks[f]===h&&(e.blocks[f]=null)}),Ce())}):e.block.d(1),c.c(),H(c,1),c.m(e.mount(),e.anchor),u=!0),e.block=c,e.blocks&&(e.blocks[s]=c),u&&mr()}if(Tc(t)){const r=yn();if(t.then(s=>{qt(r),i(e.then,1,e.value,s),qt(null)},s=>{if(qt(r),i(e.catch,2,e.error,s),qt(null),!e.hasCatch)throw s}),e.current!==e.pending)return i(e.pending,0),!0}else{if(e.current!==e.then)return i(e.then,1,e.value,t),!0;e.resolved=t}}function zs(t,e,n){const i=e.slice(),{resolved:r}=t;t.current===t.then&&(i[t.value]=r),t.current===t.catch&&(i[t.error]=r),t.block.p(i,n)}function _r(t,e){K(t,1,1,()=>{e.delete(t.key)})}function vr(t,e,n,i,r,s,o,l,a,c,u,h){let f=t.length,d=s.length,m=f;const p={};for(;m--;)p[t[m].key]=m;const g=[],_=new Map,S=new Map,C=[];for(m=d;m--;){const A=h(r,s,m),E=n(A);let M=o.get(E);M?i&&C.push(()=>M.p(A,e)):(M=c(E,A),M.c()),_.set(E,g[m]=M),E in p&&S.set(E,Math.abs(m-p[E]))}const b=new Set,k=new Set;function P(A){H(A,1),A.m(l,u),o.set(A.key,A),u=A.first,d--}for(;f&&d;){const A=g[d-1],E=t[f-1],M=A.key,D=E.key;A===E?(u=A.first,f--,d--):_.has(D)?!o.has(M)||b.has(M)?P(A):k.has(D)?f--:S.get(M)>S.get(D)?(k.add(M),P(A)):(b.add(D),f--):(a(E,o),f--)}for(;f--;){const A=t[f];_.has(A.key)||a(A,o)}for(;d;)P(g[d-1]);return Ze(C),g}function Yc(t,e){const n={},i={},r={$$scope:1};let s=t.length;for(;s--;){const o=t[s],l=e[s];if(l){for(const a in o)a in l||(i[a]=1);for(const a in l)r[a]||(n[a]=l[a],r[a]=1);t[s]=l}else for(const a in o)r[a]=1}for(const o in i)o in n||(n[o]=void 0);return n}function Xc(t){return typeof t=="object"&&t!==null?t:{}}function ue(t){t&&t.c()}function ae(t,e,n,i){const{fragment:r,after_update:s}=t.$$;r&&r.m(e,n),i||Dt(()=>{const o=t.$$.on_mount.map(xs).filter(_n);t.$$.on_destroy?t.$$.on_destroy.push(...o):Ze(o),t.$$.on_mount=[]}),s.forEach(Dt)}function ce(t,e){const n=t.$$;n.fragment!==null&&(Kc(n.after_update),Ze(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function Jc(t,e){t.$$.dirty[0]===-1&&(wn.push(t),Bc(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function ye(t,e,n,i,r,s,o,l=[-1]){const a=Vn;qt(t);const c=t.$$={fragment:null,ctx:[],props:s,update:Z,not_equal:r,bound:As(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(a?a.$$.context:[])),callbacks:As(),dirty:l,skip_bound:!1,root:e.target||a.$$.root};o&&o(c.root);let u=!1;if(c.ctx=n?n(t,e.props||{},(h,f,...d)=>{const m=d.length?d[0]:f;return c.ctx&&r(c.ctx[h],c.ctx[h]=m)&&(!c.skip_bound&&c.bound[h]&&c.bound[h](m),u&&Jc(t,h)),f}):[],c.update(),u=!0,Ze(c.before_update),c.fragment=i?i(c.ctx):!1,e.target){if(e.hydrate){const h=$c(e.target);c.fragment&&c.fragment.l(h),h.forEach(F)}else c.fragment&&c.fragment.c();e.intro&&H(t.$$.fragment),ae(t,e.target,e.anchor,e.customElement),mr()}qt(a)}class be{$destroy(){ce(this,1),this.$destroy=Z}$on(e,n){if(!_n(n))return Z;const i=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return i.push(n),()=>{const r=i.indexOf(n);r!==-1&&i.splice(r,1)}}$set(e){this.$$set&&!Nc(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const Cn=[];function Qc(t,e){return{subscribe:we(t,e).subscribe}}function we(t,e=Z){let n;const i=new Set;function r(l){if(_e(t,l)&&(t=l,n)){const a=!Cn.length;for(const c of i)c[1](),Cn.push(c,t);if(a){for(let c=0;c<Cn.length;c+=2)Cn[c][0](Cn[c+1]);Cn.length=0}}}function s(l){r(l(t))}function o(l,a=Z){const c=[l,a];return i.add(c),i.size===1&&(n=e(r)||Z),l(t),()=>{i.delete(c),i.size===0&&n&&(n(),n=null)}}return{set:r,update:s,subscribe:o}}function Be(t,e,n){const i=!Array.isArray(t),r=i?[t]:t,s=e.length<2;return Qc(n,o=>{let l=!1;const a=[];let c=0,u=Z;const h=()=>{if(c)return;u();const d=e(i?a[0]:a,o);s?o(d):u=_n(d)?d:Z},f=r.map((d,m)=>di(d,p=>{a[m]=p,c&=~(1<<m),l&&h()},()=>{c|=1<<m}));return l=!0,h(),function(){Ze(f),u(),l=!1}})}const W=APP_LANG,Tt=APP_NAME;WEBAPP_NAME;const yr=USER_ID;IS_SUPERUSER,ADD_PERMISSION;const en=CSRF_TOKEN;ADDITIONAL_MODULES;const Zc="Region",js=APP_URL,eu=SAS_APP_URL;CANTALOUPE_APP_URL,MEDIA_PATH;const tu=PAGE_LEN,nu={Witness:W==="en"?"Witness":"Témoin",Work:W==="en"?"Work":"Œuvre",Series:W==="en"?"Series":"Série d'imprimés",Regions:W==="en"?"Region Extraction":"Extraction d'illustrations"},qn=we(!1),iu=we(""),ru=t=>typeof t=="string"||t instanceof String;async function Fs(t){qn.set(!0);try{return await t()}finally{qn.set(!1)}}function br(t){return t.match(/\d+/g).toString()}function su(t){return parseInt(br(t),10)}function ou(t,e=100){const n=Math.floor(e*.75);return t.length>e?t.slice(0,n)+"..."+t.slice(-e+n):t}function lu(){return"https://vhs.huma-num.fr"}function au(){return eu??"http://localhost:8888"}function wr(t,e){if(typeof window<"u"){const n=parseInt(new URLSearchParams(window.location.search).get(e));if(!isNaN(n))return t.set(n),n}return t.set(1),1}function Sr(t,e,n){if(e.set(t),typeof window<"u"){const i=new URL(window.location.href);i.searchParams.set(n,t),window.history.pushState({},"",i)}}function cu(t=null){return t=t.split("_"),t.length<3?void 0:`${t.slice(0,3).join("_").replace(".jpg","")}.jpg`}function Vs(t=null){const e=cu(t);return e===void 0?void 0:`${lu()}/iiif/2/${e}`}function $t(t=null,e=null,n="full"){if(e=ru(e)?e.replace(".jpg",""):e,!t)return"https://placehold.co/96x96/png?text=No+image";const i=Vs(t);if(i===void 0)return"https://placehold.co/96x96/png?text=No+image";const r=t.split("_");return e||(e=r[r.length-1].includes(",")?r.pop().replace(".jpg",""):"full"),`${i}/${e}/${n}/0/default.jpg`}function uu(t=null){return`${Vs(t)}/info.json`}function fu(t=null,e=1){return`${au()}/index.html?iiif-content=${t}&canvas=${e}`}function ht(t,e=null,n=!1){return new Promise(i=>{if(document.getElementById("msg-modal")){n?document.getElementById("modal-footer").hidden=!1:i(void 0),e&&(document.getElementById("modal-title").innerHTML=e),document.getElementById("modal-msg").innerHTML=t,document.getElementById("hidden-msg-btn").click();const s=document.getElementById("cancel-btn"),o=document.getElementById("ok-btn"),l=document.getElementById("modal-bkg"),a=()=>{s.removeEventListener("click",c),l.removeEventListener("click",c),o.removeEventListener("click",u),document.getElementById("modal-footer").hidden=!0},c=()=>{a(),i(!1)},u=()=>{a(),i(!0)};s.addEventListener("click",c),o.addEventListener("click",u)}else n?i(window.confirm(t)):(window.alert(t),i(void 0))})}function Si(){let t,e,n=(i,r)=>i===r;return{set:i=>{e=t,t=i},setCompareFn:i=>n=i,get:()=>t,getNewAndOld:()=>[t,e],same:()=>n(t,e)}}const kr=(t,e)=>Array.isArray(t)&&Array.isArray(e)&&t.length===e.length&&t.every((n,i)=>n===e[i]||void 0);function hu(t){const n=[85,70,60],i=[50,65,40],r=t*137.5%360,s=n[t%n.length],o=i[Math.floor(t/n.length)%i.length];return`hsl(${Math.floor(r)}, ${s}%, ${o}%)`}function Hs(t=null){return t<600?1:t<800?2:t<1e3?3:t<1200?4:t<1400?5:t>=1400?6:4}function Us(t){const e=t.querySelectorAll(".modal-background, .modal-close, .modal-card-head .delete, .modal-card-foot .button-close"),n=()=>t.classList.remove("is-active");e.forEach(r=>r.addEventListener("click",n));const i=r=>{r.key==="Escape"&&t.classList.contains("is-active")&&n()};return document.addEventListener("keydown",i),{destroy(){e.forEach(r=>r.removeEventListener("click",n)),document.removeEventListener("keydown",i)}}}function Bs(t){const e=()=>{const n=document.getElementById(t.dataset.target);n==null||n.classList.add("is-active")};return t.addEventListener("click",e),{destroy(){t.removeEventListener("click",e)}}}function In(t,e,n="string"){const i={string:s=>{const o=s.get(e);return o!==null?o:null},array:s=>{const o=s.get(e);return o?o.split(",").map(Number).filter(l=>!isNaN(l)):null},set:s=>{const o=s.get(e);return o?new Set(o.split(",").map(Number).filter(l=>!isNaN(l))):null},number:s=>{const o=s.get(e);return o!==null?Number(o):null},boolean:s=>{const o=s.get(e);return o!==null?o==="true":null}},r={string:(s,o)=>o?s.searchParams.set(e,o):s.searchParams.delete(e),array:(s,o)=>{o!=null&&o.length?s.searchParams.set(e,o.join(",")):s.searchParams.delete(e)},set:(s,o)=>{o!=null&&o.size?s.searchParams.set(e,Array.from(o).join(",")):s.searchParams.delete(e)},number:(s,o)=>{o!=null?s.searchParams.set(e,String(o)):s.searchParams.delete(e)},boolean:(s,o)=>o?s.searchParams.set(e,"true"):s.searchParams.delete(e)};if(typeof window<"u"){const s=new URLSearchParams(window.location.search),o=i[n](s);return o!==null&&t.set(o),l=>{const a=new URL(window.location);r[n](a,l),window.history.pushState({},"",a)}}return()=>{}}function du(t){const e=t-1;return e*e*e+1}function Mn(t,{delay:e=0,duration:n=400,easing:i=Is}={}){const r=+getComputedStyle(t).opacity;return{delay:e,duration:n,easing:i,css:s=>`opacity: ${s*r}`}}function qs(t,{delay:e=0,duration:n=400,easing:i=du,axis:r="y"}={}){const s=getComputedStyle(t),o=+s.opacity,l=r==="y"?"height":"width",a=parseFloat(s[l]),c=r==="y"?["top","bottom"]:["left","right"],u=c.map(_=>`${_[0].toUpperCase()}${_.slice(1)}`),h=parseFloat(s[`padding${u[0]}`]),f=parseFloat(s[`padding${u[1]}`]),d=parseFloat(s[`margin${u[0]}`]),m=parseFloat(s[`margin${u[1]}`]),p=parseFloat(s[`border${u[0]}Width`]),g=parseFloat(s[`border${u[1]}Width`]);return{delay:e,duration:n,easing:i,css:_=>`overflow: hidden;opacity: ${Math.min(_*20,1)*o};${l}: ${_*a}px;padding-${c[0]}: ${_*h}px;padding-${c[1]}: ${_*f}px;margin-${c[0]}: ${_*d}px;margin-${c[1]}: ${_*m}px;border-${c[0]}-width: ${_*p}px;border-${c[1]}-width: ${_*g}px;`}}const _y="";function Ks(t){let e,n,i;return{c(){e=w("div"),e.innerHTML='<div class="loader svelte-vizlcg"></div>',v(e,"class","bkg-shade svelte-vizlcg")},m(r,s){V(r,e,s),i=!0},i(r){i||(Dt(()=>{i&&(n||(n=Zt(e,Mn,{duration:150},!0)),n.run(1))}),i=!0)},o(r){n||(n=Zt(e,Mn,{duration:150},!1)),n.run(0),i=!1},d(r){r&&F(e),r&&n&&n.end()}}}function mu(t){let e,n,i=t[0]&&Ks();return{c(){i&&i.c(),e=Ge()},m(r,s){i&&i.m(r,s),V(r,e,s),n=!0},p(r,[s]){r[0]?i?s&1&&H(i,1):(i=Ks(),i.c(),H(i,1),i.m(e.parentNode,e)):i&&(Ee(),K(i,1,1,()=>{i=null}),Ce())},i(r){n||(H(i),n=!0)},o(r){K(i),n=!1},d(r){i&&i.d(r),r&&F(e)}}}function pu(t,e,n){let i;return me(t,qn,r=>n(0,i=r)),[i]}class gu extends be{constructor(e){super(),ye(this,e,pu,mu,_e,{})}}const _u=t=>({}),Ws=t=>({});function vu(t){let e,n,i,r,s,o,l,a,c,u,h,f,d,m,p,g,_,S,C,b,k;const P=t[1].content,A=Et(P,t,t[0],Ws);return{c(){e=w("button"),n=q(),i=w("div"),r=w("div"),s=q(),o=w("div"),l=w("div"),l.innerHTML=`<div class="title is-4 mb-0 media-content"><span id="modal-title" class="mb-0"></span></div>
            <button class="delete media-left" aria-label="close"></button>`,a=q(),c=w("section"),u=w("div"),h=q(),f=w("div"),A&&A.c(),d=q(),m=w("footer"),p=w("div"),g=w("button"),g.textContent=`${W==="en"?"Abort":"Retour"}`,_=q(),S=w("button"),S.textContent="OK",v(e,"id","hidden-msg-btn"),v(e,"data-target","msg-modal"),e.hidden=!0,v(r,"id","modal-bkg"),v(r,"class","modal-background"),v(l,"class","modal-card-head media mb-0"),v(u,"id","modal-msg"),v(f,"class","py-3"),v(c,"id","modal-body"),v(c,"class","modal-card-body"),v(g,"id","cancel-btn"),v(g,"class","button is-link is-light button-close"),v(S,"id","ok-btn"),v(S,"class","button is-link button-close"),v(p,"class","buttons"),v(m,"id","modal-footer"),v(m,"class","modal-card-foot is-center pt-3"),m.hidden=!0,v(o,"class","modal-content"),v(i,"id","msg-modal"),v(i,"class","modal fade"),v(i,"tabindex","-1"),v(i,"aria-labelledby","selection-modal-label"),v(i,"aria-hidden","true")},m(E,M){V(E,e,M),V(E,n,M),V(E,i,M),y(i,r),y(i,s),y(i,o),y(o,l),y(o,a),y(o,c),y(c,u),y(c,h),y(c,f),A&&A.m(f,null),y(o,d),y(o,m),y(m,p),y(p,g),y(p,_),y(p,S),C=!0,b||(k=[pi(Bs.call(null,e)),pi(Us.call(null,i))],b=!0)},p(E,[M]){A&&A.p&&(!C||M&1)&&It(A,P,E,E[0],C?Ct(P,E[0],M,_u):Mt(E[0]),Ws)},i(E){C||(H(A,E),C=!0)},o(E){K(A,E),C=!1},d(E){E&&F(e),E&&F(n),E&&F(i),A&&A.d(E),b=!1,Ze(k)}}}function yu(t,e,n){let{$$slots:i={},$$scope:r}=e;return t.$$set=s=>{"$$scope"in s&&n(0,r=s.$$scope)},[r,i]}class bu extends be{constructor(e){super(),ye(this,e,yu,vu,_e,{})}}const vy="",wu=t=>({activeTab:t&8}),Gs=t=>({activeTab:t[3]});function Ys(t,e,n){const i=t.slice();return i[11]=e[n][0],i[12]=e[n][1],i}const Su=t=>({activeTab:t&8}),Xs=t=>({activeTab:t[3]}),ku=t=>({}),Js=t=>({});function Eu(t){let e,n,i=Object.entries(t[2]),r=[];for(let s=0;s<i.length;s+=1)r[s]=Qs(Ys(t,i,s));return{c(){e=w("div"),n=w("ul");for(let s=0;s<r.length;s+=1)r[s].c();v(e,"class","tabs")},m(s,o){V(s,e,o),y(e,n);for(let l=0;l<r.length;l+=1)r[l]&&r[l].m(n,null)},p(s,o){if(o&28){i=Object.entries(s[2]);let l;for(l=0;l<i.length;l+=1){const a=Ys(s,i,l);r[l]?r[l].p(a,o):(r[l]=Qs(a),r[l].c(),r[l].m(n,null))}for(;l<r.length;l+=1)r[l].d(1);r.length=i.length}},i:Z,o:Z,d(s){s&&F(e),We(r,s)}}}function Cu(t){let e;const n=t[8].tabs,i=Et(n,t,t[7],Xs);return{c(){i&&i.c()},m(r,s){i&&i.m(r,s),e=!0},p(r,s){i&&i.p&&(!e||s&136)&&It(i,n,r,r[7],e?Ct(n,r[7],s,Su):Mt(r[7]),Xs)},i(r){e||(H(i,r),e=!0)},o(r){K(i,r),e=!1},d(r){i&&i.d(r)}}}function Qs(t){let e,n,i=t[12]+"",r,s,o,l;function a(){return t[9](t[11])}return{c(){e=w("li"),n=w("a"),r=se(i),s=q(),v(n,"href",null),Se(e,"is-active",t[3]===t[11])},m(c,u){V(c,e,u),y(e,n),y(n,r),y(e,s),o||(l=pe(n,"click",a),o=!0)},p(c,u){t=c,u&4&&i!==(i=t[12]+"")&&ve(r,i),u&12&&Se(e,"is-active",t[3]===t[11])},d(c){c&&F(e),o=!1,l()}}}function Iu(t){let e,n,i,r,s,o,l,a,c,u,h,f,d;e=new gu({});const m=t[8].sidebar,p=Et(m,t,t[7],Js),g=[Cu,Eu],_=[];function S(k,P){return P&4&&(a=null),k[5].tabs?0:(a==null&&(a=!!Object.keys(k[2]).length),a?1:-1)}~(c=S(t,-1))&&(u=_[c]=g[c](t));const C=t[8].content,b=Et(C,t,t[7],Gs);return{c(){ue(e.$$.fragment),n=q(),i=w("div"),r=w("aside"),p&&p.c(),s=q(),o=w("main"),l=w("nav"),u&&u.c(),h=q(),f=w("div"),b&&b.c(),v(r,"class","sidebar svelte-jexg"),Re(r,"width",t[0]+"%"),Re(r,"min-height",t[1]),v(l,"id","tabs"),v(l,"class","tabs-bar svelte-jexg"),v(f,"class","content-area pl-5 svelte-jexg"),v(o,"class","main-content svelte-jexg"),Re(o,"width",100-t[0]+"%"),Re(o,"min-height",t[1]),v(i,"class","layout svelte-jexg"),Re(i,"min-height",t[1])},m(k,P){ae(e,k,P),V(k,n,P),V(k,i,P),y(i,r),p&&p.m(r,null),y(i,s),y(i,o),y(o,l),~c&&_[c].m(l,null),y(o,h),y(o,f),b&&b.m(f,null),d=!0},p(k,[P]){p&&p.p&&(!d||P&128)&&It(p,m,k,k[7],d?Ct(m,k[7],P,ku):Mt(k[7]),Js),(!d||P&1)&&Re(r,"width",k[0]+"%");let A=c;c=S(k,P),c===A?~c&&_[c].p(k,P):(u&&(Ee(),K(_[A],1,1,()=>{_[A]=null}),Ce()),~c?(u=_[c],u?u.p(k,P):(u=_[c]=g[c](k),u.c()),H(u,1),u.m(l,null)):u=null),b&&b.p&&(!d||P&136)&&It(b,C,k,k[7],d?Ct(C,k[7],P,wu):Mt(k[7]),Gs),(!d||P&1)&&Re(o,"width",100-k[0]+"%")},i(k){d||(H(e.$$.fragment,k),H(p,k),H(u),H(b,k),d=!0)},o(k){K(e.$$.fragment,k),K(p,k),K(u),K(b,k),d=!1},d(k){ce(e,k),k&&F(n),k&&F(i),p&&p.d(k),~c&&_[c].d(),b&&b.d(k)}}}function Mu(t=null){t||(t=document.getElementById("navbar")),document.documentElement.style.setProperty("--top-offset",`${t.offsetHeight}px`)}function xu(t,e,n){let i,{$$slots:r={},$$scope:s}=e;const o=Oc(r);let{sidebarWidth:l="25"}=e;const a="90vh";let{tabList:c={}}=e,u=Object.keys(c),{topOffsetElement:h=null}=e;Mu(h);function f(m){if(!u.includes(m)){console.warn(`Tab "${m}" is not available.`);return}n(3,i=m);const p=new URL(window.location);p.searchParams.set("tab",m),window.history.pushState({},"",p)}const d=m=>f(m);return t.$$set=m=>{"sidebarWidth"in m&&n(0,l=m.sidebarWidth),"tabList"in m&&n(2,c=m.tabList),"topOffsetElement"in m&&n(6,h=m.topOffsetElement),"$$scope"in m&&n(7,s=m.$$scope)},n(3,i=new URLSearchParams(window.location.search).get("tab")??u[0]??null),[l,a,c,i,f,o,h,s,r,d]}class Au extends be{constructor(e){super(),ye(this,e,xu,Iu,_e,{sidebarWidth:0,layoutHeight:1,tabList:2,topOffsetElement:6})}get layoutHeight(){return this.$$.ctx[1]}}const ki={0:{title:W==="en"?"no categorization":"aucune catégorisation",svg:`<svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 59 59">
        <rect x="1" y="0.62" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>
    </svg>`},1:{title:W==="en"?"overall visual matches":"correspondances visuelles globales",svg:`<svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 68 69">
        <rect x="10" y="10.62" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>
        <rect x="1" y="1" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>
        <rect x="10" y="10.62" width="46" height="45.71" rx="4.11" ry="4.11" fill="currentColor" stroke="none"/>
    </svg>`},2:{title:W==="en"?"visual matches on part of the image":"correspondances visuelles sur une partie de l'image",svg:`<svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 70 71">
        <rect x="12" y="12.43" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>
        <rect x="1" y="0.81" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>
        <path d="M 12 21.43 L 21 12.43" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
        <path d="M 12 30 L 30 12.43" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
        <path d="M 40 56 L 57 38" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
        <path d="M 48.3 56.29 L 57 47" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
        <path d="M 12 39 L 39 12" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
        <path d="M 12 48 L 48 12" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
        <path d="M 13 56 L 57 12" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
        <path d="M 31 56 L 57 29" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
        <path d="M 21 57 L 57 21" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
    </svg>`},3:{title:W==="en"?"semantic and non-visual matches":"correspondances sémantiques et non-visuelle",svg:`<svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 72 73">
        <rect x="14" y="14.43" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3" stroke-dasharray="9 9"/>
        <rect x="1" y="0.81" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>
    </svg>`},4:{title:W==="en"?"regions without match":"régions sans correspondance",svg:`<svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 59 59">
        <rect x="1" y="0.62" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>
        <path d="M 2.67 54.55 L 55 2" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
        <path d="M 54.37 54.05 L 2.72 2.24" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
    </svg>`},5:{title:W==="en"?"user specific category":"correspondances spécifiques à l'utilisateur",svg:`<svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 59 59">
        <rect x="1" y="0.81" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>
        <path d="M 8.69 55.28 C 9.25 44.15 18.08 35.28 28.86 35.28 C 32.5 35.28 36.07 36.3 39.18 38.25 C 44.96 41.85 48.66 48.3 49.02 55.28 Z M 17.85 21.48 C 17.85 15.37 22.79 10.39 28.86 10.39 C 34.92 10.39 39.86 15.37 39.86 21.48 C 39.86 27.59 34.92 32.56 28.86 32.56 C 22.79 32.56 17.85 27.59 17.85 21.48 Z M 40.37 36.34 C 38.43 35.13 36.32 34.25 34.13 33.7 C 38.82 31.64 42.1 26.94 42.1 21.48 C 42.1 14.13 36.16 8.15 28.86 8.15 C 21.55 8.15 15.61 14.13 15.61 21.48 C 15.61 26.95 18.9 31.66 23.6 33.71 C 13.76 36.18 6.41 45.4 6.41 56.4 C 6.41 57.02 6.92 57.52 7.54 57.52 L 50.17 57.52 C 50.79 57.52 51.3 57.02 51.3 56.4 C 51.3 48.23 47.11 40.54 40.37 36.34 Z" fill="currentColor" stroke="none"/>
    </svg>`}};function Tu(t){let e,n=ki[t[2]].svg+"",i,r,s,o;return{c(){e=w("span"),v(e,"class",i="tag py-4 "+t[4]+" "+(t[0]?"is-hoverable":"")),v(e,"title",r=ki[t[2]].title),Se(e,"is-selected",t[1])},m(l,a){V(l,e,a),e.innerHTML=n,s||(o=[pe(e,"click",t[5]),pe(e,"keyup",null)],s=!0)},p(l,[a]){a&4&&n!==(n=ki[l[2]].svg+"")&&(e.innerHTML=n),a&17&&i!==(i="tag py-4 "+l[4]+" "+(l[0]?"is-hoverable":""))&&v(e,"class",i),a&4&&r!==(r=ki[l[2]].title)&&v(e,"title",r),a&19&&Se(e,"is-selected",l[1])},i:Z,o:Z,d(l){l&&F(e),s=!1,Ze(o)}}}function Nu(t,e,n){let{selectable:i=!0}=e,{isSelected:r=!1}=e,{category:s}=e,{toggle:o=()=>{}}=e,{padding:l="px-2"}=e;const a=()=>o(s);return t.$$set=c=>{"selectable"in c&&n(0,i=c.selectable),"isSelected"in c&&n(1,r=c.isSelected),"category"in c&&n(2,s=c.category),"toggle"in c&&n(3,o=c.toggle),"padding"in c&&n(4,l=c.padding)},[i,r,s,o,l,a]}class xn extends be{constructor(e){super(),ye(this,e,Nu,Tu,_e,{selectable:0,isSelected:1,category:2,toggle:3,padding:4})}}const Ny="";function Zs(t){let e,n,i=t[3].title+"",r,s;return{c(){e=w("span"),n=w("a"),r=se(i),v(n,"href",s=`${js}/${Tt}/witness/${t[3].witnessId}/regions/${t[1]}`),v(n,"target","_blank"),v(e,"class","legend-label svelte-w1sf17")},m(o,l){V(o,e,l),y(e,n),y(n,r)},p(o,l){l&8&&i!==(i=o[3].title+"")&&ve(r,i),l&10&&s!==(s=`${js}/${Tt}/witness/${o[3].witnessId}/regions/${o[1]}`)&&v(n,"href",s)},d(o){o&&F(e)}}}function Ou(t){let e,n,i,r,s,o,l,a,c,u=!t[5]&&Zs(t);return{c(){e=w("div"),n=w("span"),i=q(),r=w("span"),l=q(),u&&u.c(),v(n,"class","legend-nb svelte-w1sf17"),v(r,"class","legend-color svelte-w1sf17"),v(r,"aria-label",s=t[3].title),v(r,"title",o=t[3].title),Re(r,"background-color",t[0]?t[3].color:"#999"),v(r,"role","button"),v(r,"tabindex","0"),Se(r,"inactive",!t[0]),Se(r,"clickable",t[4]),v(e,"class","legend-item svelte-w1sf17"),Se(e,"inactive",!t[0])},m(h,f){V(h,e,f),y(e,n),y(e,i),y(e,r),y(e,l),u&&u.m(e,null),a||(c=[pe(r,"click",function(){_n(t[2])&&t[2].apply(this,arguments)}),pe(r,"keydown",null)],a=!0)},p(h,[f]){t=h,f&8&&s!==(s=t[3].title)&&v(r,"aria-label",s),f&8&&o!==(o=t[3].title)&&v(r,"title",o),f&9&&Re(r,"background-color",t[0]?t[3].color:"#999"),f&1&&Se(r,"inactive",!t[0]),f&16&&Se(r,"clickable",t[4]),t[5]?u&&(u.d(1),u=null):u?u.p(t,f):(u=Zs(t),u.c(),u.m(e,null)),f&1&&Se(e,"inactive",!t[0])},i:Z,o:Z,d(h){h&&F(e),u&&u.d(),a=!1,Ze(c)}}}function Pu(t,e,n){let{isActive:i=!0}=e,{id:r}=e,{toggle:s=()=>{}}=e,{meta:o={title:"Region",color:"#999",witnessId:1}}=e,{clickable:l=!0}=e,{onlyColor:a=!1}=e;return t.$$set=c=>{"isActive"in c&&n(0,i=c.isActive),"id"in c&&n(1,r=c.id),"toggle"in c&&n(2,s=c.toggle),"meta"in c&&n(3,o=c.meta),"clickable"in c&&n(4,l=c.clickable),"onlyColor"in c&&n(5,a=c.onlyColor)},[i,r,s,o,l,a]}class Ei extends be{constructor(e){super(),ye(this,e,Pu,Ou,_e,{isActive:0,id:1,toggle:2,meta:3,clickable:4,onlyColor:5})}}const Oy="";function eo(t,e,n){const i=t.slice();return i[6]=e[n][0],i[7]=e[n][1],i}function Lu(t){let e;return{c(){e=w("span"),e.innerHTML='<i class="fas fa-chevron-down"></i>',v(e,"class","icon is-small")},m(n,i){V(n,e,i)},d(n){n&&F(e)}}}function Ru(t){let e;return{c(){e=w("span"),e.innerHTML='<i class="fas fa-chevron-up"></i>',v(e,"class","icon is-small")},m(n,i){V(n,e,i)},d(n){n&&F(e)}}}function to(t){let e,n;function i(){return t[5](t[6])}return e=new Ei({props:{id:t[6],meta:t[7],isActive:t[1].has(parseInt(t[6])),toggle:i,onlyColor:!t[3]}}),{c(){ue(e.$$.fragment)},m(r,s){ae(e,r,s),n=!0},p(r,s){t=r;const o={};s&1&&(o.id=t[6]),s&1&&(o.meta=t[7]),s&3&&(o.isActive=t[1].has(parseInt(t[6]))),s&5&&(o.toggle=i),s&8&&(o.onlyColor=!t[3]),e.$set(o)},i(r){n||(H(e.$$.fragment,r),n=!0)},o(r){K(e.$$.fragment,r),n=!1},d(r){ce(e,r)}}}function Du(t){let e,n,i,r,s,o,l,a,c,u,h,f,d,m,p,g;function _(A,E){return A[3]?Ru:Lu}let S=_(t),C=S(t),b=Array.from(t[0]||new Map),k=[];for(let A=0;A<b.length;A+=1)k[A]=to(eo(t,b,A));const P=A=>K(k[A],1,1,()=>{k[A]=null});return{c(){e=w("div"),n=w("div"),i=w("div"),r=w("div"),s=w("h3"),s.textContent=`${W==="en"?"Visible documents":"Documents visibles"}`,o=q(),l=w("div"),a=w("div"),c=w("button"),C.c(),f=q(),d=w("div");for(let A=0;A<k.length;A+=1)k[A].c();v(s,"class","title mb-0"),v(r,"class","level-item"),v(i,"class","level-left"),v(c,"class","button is-small is-ghost"),v(c,"aria-label",u=t[3]?"Minify legend":"Expand legend"),v(a,"class","level-item"),v(a,"title",h=t[3]?"Minify legend":"Expand legend"),v(l,"class","level-right"),v(n,"class","level is-mobile mb-3"),v(d,"class","svelte-13ym7ov"),Se(d,"is-condensed",!t[3]),Se(d,"is-expanded",t[3])},m(A,E){V(A,e,E),y(e,n),y(n,i),y(i,r),y(r,s),y(n,o),y(n,l),y(l,a),y(a,c),C.m(c,null),y(e,f),y(e,d);for(let M=0;M<k.length;M+=1)k[M]&&k[M].m(d,null);m=!0,p||(g=pe(c,"click",t[4]),p=!0)},p(A,[E]){if(S!==(S=_(A))&&(C.d(1),C=S(A),C&&(C.c(),C.m(c,null))),(!m||E&8&&u!==(u=A[3]?"Minify legend":"Expand legend"))&&v(c,"aria-label",u),(!m||E&8&&h!==(h=A[3]?"Minify legend":"Expand legend"))&&v(a,"title",h),E&15){b=Array.from(A[0]||new Map);let M;for(M=0;M<b.length;M+=1){const D=eo(A,b,M);k[M]?(k[M].p(D,E),H(k[M],1)):(k[M]=to(D),k[M].c(),H(k[M],1),k[M].m(d,null))}for(Ee(),M=b.length;M<k.length;M+=1)P(M);Ce()}(!m||E&8)&&Se(d,"is-condensed",!A[3]),(!m||E&8)&&Se(d,"is-expanded",A[3])},i(A){if(!m){for(let E=0;E<b.length;E+=1)H(k[E]);m=!0}},o(A){k=k.filter(Boolean);for(let E=0;E<k.length;E+=1)K(k[E]);m=!1},d(A){A&&F(e),C.d(),We(k,A),p=!1,g()}}}function $u(t,e,n){let{documentNodes:i}=e,{selectedRegions:r}=e,{toggleRegion:s}=e,o=!0;const l=()=>n(3,o=!o),a=c=>s(parseInt(c));return t.$$set=c=>{"documentNodes"in c&&n(0,i=c.documentNodes),"selectedRegions"in c&&n(1,r=c.selectedRegions),"toggleRegion"in c&&n(2,s=c.toggleRegion)},[i,r,s,o,l,a]}class zu extends be{constructor(e){super(),ye(this,e,$u,Du,_e,{documentNodes:0,selectedRegions:1,toggleRegion:2})}}var tn;(function(t){t.Range="range",t.Steps="steps",t.Positions="positions",t.Count="count",t.Values="values"})(tn||(tn={}));var it;(function(t){t[t.None=-1]="None",t[t.NoValue=0]="NoValue",t[t.LargeValue=1]="LargeValue",t[t.SmallValue=2]="SmallValue"})(it||(it={}));function ju(t){return Ci(t)&&typeof t.from=="function"}function Ci(t){return typeof t=="object"&&typeof t.to=="function"}function no(t){t.parentElement.removeChild(t)}function Er(t){return t!=null}function io(t){t.preventDefault()}function Fu(t){return t.filter(function(e){return this[e]?!1:this[e]=!0},{})}function Vu(t,e){return Math.round(t/e)*e}function Hu(t,e){var n=t.getBoundingClientRect(),i=t.ownerDocument,r=i.documentElement,s=oo(i);return/webkit.*Chrome.*Mobile/i.test(navigator.userAgent)&&(s.x=0),e?n.top+s.y-r.clientTop:n.left+s.x-r.clientLeft}function Nt(t){return typeof t=="number"&&!isNaN(t)&&isFinite(t)}function ro(t,e,n){n>0&&(et(t,e),setTimeout(function(){Mi(t,e)},n))}function so(t){return Math.max(Math.min(t,100),0)}function Ii(t){return Array.isArray(t)?t:[t]}function Uu(t){t=String(t);var e=t.split(".");return e.length>1?e[1].length:0}function et(t,e){t.classList&&!/\s/.test(e)?t.classList.add(e):t.className+=" "+e}function Mi(t,e){t.classList&&!/\s/.test(e)?t.classList.remove(e):t.className=t.className.replace(new RegExp("(^|\\b)"+e.split(" ").join("|")+"(\\b|$)","gi")," ")}function Bu(t,e){return t.classList?t.classList.contains(e):new RegExp("\\b"+e+"\\b").test(t.className)}function oo(t){var e=window.pageXOffset!==void 0,n=(t.compatMode||"")==="CSS1Compat",i=e?window.pageXOffset:n?t.documentElement.scrollLeft:t.body.scrollLeft,r=e?window.pageYOffset:n?t.documentElement.scrollTop:t.body.scrollTop;return{x:i,y:r}}function qu(){return window.navigator.pointerEnabled?{start:"pointerdown",move:"pointermove",end:"pointerup"}:window.navigator.msPointerEnabled?{start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:{start:"mousedown touchstart",move:"mousemove touchmove",end:"mouseup touchend"}}function Ku(){var t=!1;try{var e=Object.defineProperty({},"passive",{get:function(){t=!0}});window.addEventListener("test",null,e)}catch{}return t}function Wu(){return window.CSS&&CSS.supports&&CSS.supports("touch-action","none")}function Cr(t,e){return 100/(e-t)}function Ir(t,e,n){return e*100/(t[n+1]-t[n])}function Gu(t,e){return Ir(t,t[0]<0?e+Math.abs(t[0]):e-t[0],0)}function Yu(t,e){return e*(t[1]-t[0])/100+t[0]}function Kn(t,e){for(var n=1;t>=e[n];)n+=1;return n}function Xu(t,e,n){if(n>=t.slice(-1)[0])return 100;var i=Kn(n,t),r=t[i-1],s=t[i],o=e[i-1],l=e[i];return o+Gu([r,s],n)/Cr(o,l)}function Ju(t,e,n){if(n>=100)return t.slice(-1)[0];var i=Kn(n,e),r=t[i-1],s=t[i],o=e[i-1],l=e[i];return Yu([r,s],(n-o)*Cr(o,l))}function Qu(t,e,n,i){if(i===100)return i;var r=Kn(i,t),s=t[r-1],o=t[r];return n?i-s>(o-s)/2?o:s:e[r-1]?t[r-1]+Vu(i-t[r-1],e[r-1]):i}var lo=function(){function t(e,n,i){this.xPct=[],this.xVal=[],this.xSteps=[],this.xNumSteps=[],this.xHighestCompleteStep=[],this.xSteps=[i||!1],this.xNumSteps=[!1],this.snap=n;var r,s=[];for(Object.keys(e).forEach(function(o){s.push([Ii(e[o]),o])}),s.sort(function(o,l){return o[0][0]-l[0][0]}),r=0;r<s.length;r++)this.handleEntryPoint(s[r][1],s[r][0]);for(this.xNumSteps=this.xSteps.slice(0),r=0;r<this.xNumSteps.length;r++)this.handleStepPoint(r,this.xNumSteps[r])}return t.prototype.getDistance=function(e){for(var n=[],i=0;i<this.xNumSteps.length-1;i++)n[i]=Ir(this.xVal,e,i);return n},t.prototype.getAbsoluteDistance=function(e,n,i){var r=0;if(e<this.xPct[this.xPct.length-1])for(;e>this.xPct[r+1];)r++;else e===this.xPct[this.xPct.length-1]&&(r=this.xPct.length-2);!i&&e===this.xPct[r+1]&&r++,n===null&&(n=[]);var s,o=1,l=n[r],a=0,c=0,u=0,h=0;for(i?s=(e-this.xPct[r])/(this.xPct[r+1]-this.xPct[r]):s=(this.xPct[r+1]-e)/(this.xPct[r+1]-this.xPct[r]);l>0;)a=this.xPct[r+1+h]-this.xPct[r+h],n[r+h]*o+100-s*100>100?(c=a*s,o=(l-100*s)/n[r+h],s=1):(c=n[r+h]*a/100*o,o=0),i?(u=u-c,this.xPct.length+h>=1&&h--):(u=u+c,this.xPct.length-h>=1&&h++),l=n[r+h]*o;return e+u},t.prototype.toStepping=function(e){return e=Xu(this.xVal,this.xPct,e),e},t.prototype.fromStepping=function(e){return Ju(this.xVal,this.xPct,e)},t.prototype.getStep=function(e){return e=Qu(this.xPct,this.xSteps,this.snap,e),e},t.prototype.getDefaultStep=function(e,n,i){var r=Kn(e,this.xPct);return(e===100||n&&e===this.xPct[r-1])&&(r=Math.max(r-1,1)),(this.xVal[r]-this.xVal[r-1])/i},t.prototype.getNearbySteps=function(e){var n=Kn(e,this.xPct);return{stepBefore:{startValue:this.xVal[n-2],step:this.xNumSteps[n-2],highestStep:this.xHighestCompleteStep[n-2]},thisStep:{startValue:this.xVal[n-1],step:this.xNumSteps[n-1],highestStep:this.xHighestCompleteStep[n-1]},stepAfter:{startValue:this.xVal[n],step:this.xNumSteps[n],highestStep:this.xHighestCompleteStep[n]}}},t.prototype.countStepDecimals=function(){var e=this.xNumSteps.map(Uu);return Math.max.apply(null,e)},t.prototype.hasNoSize=function(){return this.xVal[0]===this.xVal[this.xVal.length-1]},t.prototype.convert=function(e){return this.getStep(this.toStepping(e))},t.prototype.handleEntryPoint=function(e,n){var i;if(e==="min"?i=0:e==="max"?i=100:i=parseFloat(e),!Nt(i)||!Nt(n[0]))throw new Error("noUiSlider: 'range' value isn't numeric.");this.xPct.push(i),this.xVal.push(n[0]);var r=Number(n[1]);i?this.xSteps.push(isNaN(r)?!1:r):isNaN(r)||(this.xSteps[0]=r),this.xHighestCompleteStep.push(0)},t.prototype.handleStepPoint=function(e,n){if(n){if(this.xVal[e]===this.xVal[e+1]){this.xSteps[e]=this.xHighestCompleteStep[e]=this.xVal[e];return}this.xSteps[e]=Ir([this.xVal[e],this.xVal[e+1]],n,0)/Cr(this.xPct[e],this.xPct[e+1]);var i=(this.xVal[e+1]-this.xVal[e])/this.xNumSteps[e],r=Math.ceil(Number(i.toFixed(3))-1),s=this.xVal[e]+this.xNumSteps[e]*r;this.xHighestCompleteStep[e]=s}},t}(),ao={to:function(t){return t===void 0?"":t.toFixed(2)},from:Number},co={target:"target",base:"base",origin:"origin",handle:"handle",handleLower:"handle-lower",handleUpper:"handle-upper",touchArea:"touch-area",horizontal:"horizontal",vertical:"vertical",background:"background",connect:"connect",connects:"connects",ltr:"ltr",rtl:"rtl",textDirectionLtr:"txt-dir-ltr",textDirectionRtl:"txt-dir-rtl",draggable:"draggable",drag:"state-drag",tap:"state-tap",active:"active",tooltip:"tooltip",pips:"pips",pipsHorizontal:"pips-horizontal",pipsVertical:"pips-vertical",marker:"marker",markerHorizontal:"marker-horizontal",markerVertical:"marker-vertical",markerNormal:"marker-normal",markerLarge:"marker-large",markerSub:"marker-sub",value:"value",valueHorizontal:"value-horizontal",valueVertical:"value-vertical",valueNormal:"value-normal",valueLarge:"value-large",valueSub:"value-sub"},nn={tooltips:".__tooltips",aria:".__aria"};function Zu(t,e){if(!Nt(e))throw new Error("noUiSlider: 'step' is not numeric.");t.singleStep=e}function ef(t,e){if(!Nt(e))throw new Error("noUiSlider: 'keyboardPageMultiplier' is not numeric.");t.keyboardPageMultiplier=e}function tf(t,e){if(!Nt(e))throw new Error("noUiSlider: 'keyboardMultiplier' is not numeric.");t.keyboardMultiplier=e}function nf(t,e){if(!Nt(e))throw new Error("noUiSlider: 'keyboardDefaultStep' is not numeric.");t.keyboardDefaultStep=e}function rf(t,e){if(typeof e!="object"||Array.isArray(e))throw new Error("noUiSlider: 'range' is not an object.");if(e.min===void 0||e.max===void 0)throw new Error("noUiSlider: Missing 'min' or 'max' in 'range'.");t.spectrum=new lo(e,t.snap||!1,t.singleStep)}function sf(t,e){if(e=Ii(e),!Array.isArray(e)||!e.length)throw new Error("noUiSlider: 'start' option is incorrect.");t.handles=e.length,t.start=e}function of(t,e){if(typeof e!="boolean")throw new Error("noUiSlider: 'snap' option must be a boolean.");t.snap=e}function lf(t,e){if(typeof e!="boolean")throw new Error("noUiSlider: 'animate' option must be a boolean.");t.animate=e}function af(t,e){if(typeof e!="number")throw new Error("noUiSlider: 'animationDuration' option must be a number.");t.animationDuration=e}function uo(t,e){var n=[!1],i;if(e==="lower"?e=[!0,!1]:e==="upper"&&(e=[!1,!0]),e===!0||e===!1){for(i=1;i<t.handles;i++)n.push(e);n.push(!1)}else{if(!Array.isArray(e)||!e.length||e.length!==t.handles+1)throw new Error("noUiSlider: 'connect' option doesn't match handle count.");n=e}t.connect=n}function cf(t,e){switch(e){case"horizontal":t.ort=0;break;case"vertical":t.ort=1;break;default:throw new Error("noUiSlider: 'orientation' option is invalid.")}}function fo(t,e){if(!Nt(e))throw new Error("noUiSlider: 'margin' option must be numeric.");e!==0&&(t.margin=t.spectrum.getDistance(e))}function uf(t,e){if(!Nt(e))throw new Error("noUiSlider: 'limit' option must be numeric.");if(t.limit=t.spectrum.getDistance(e),!t.limit||t.handles<2)throw new Error("noUiSlider: 'limit' option is only supported on linear sliders with 2 or more handles.")}function ff(t,e){var n;if(!Nt(e)&&!Array.isArray(e))throw new Error("noUiSlider: 'padding' option must be numeric or array of exactly 2 numbers.");if(Array.isArray(e)&&!(e.length===2||Nt(e[0])||Nt(e[1])))throw new Error("noUiSlider: 'padding' option must be numeric or array of exactly 2 numbers.");if(e!==0){for(Array.isArray(e)||(e=[e,e]),t.padding=[t.spectrum.getDistance(e[0]),t.spectrum.getDistance(e[1])],n=0;n<t.spectrum.xNumSteps.length-1;n++)if(t.padding[0][n]<0||t.padding[1][n]<0)throw new Error("noUiSlider: 'padding' option must be a positive number(s).");var i=e[0]+e[1],r=t.spectrum.xVal[0],s=t.spectrum.xVal[t.spectrum.xVal.length-1];if(i/(s-r)>1)throw new Error("noUiSlider: 'padding' option must not exceed 100% of the range.")}}function hf(t,e){switch(e){case"ltr":t.dir=0;break;case"rtl":t.dir=1;break;default:throw new Error("noUiSlider: 'direction' option was not recognized.")}}function df(t,e){if(typeof e!="string")throw new Error("noUiSlider: 'behaviour' must be a string containing options.");var n=e.indexOf("tap")>=0,i=e.indexOf("drag")>=0,r=e.indexOf("fixed")>=0,s=e.indexOf("snap")>=0,o=e.indexOf("hover")>=0,l=e.indexOf("unconstrained")>=0,a=e.indexOf("invert-connects")>=0,c=e.indexOf("drag-all")>=0,u=e.indexOf("smooth-steps")>=0;if(r){if(t.handles!==2)throw new Error("noUiSlider: 'fixed' behaviour must be used with 2 handles");fo(t,t.start[1]-t.start[0])}if(a&&t.handles!==2)throw new Error("noUiSlider: 'invert-connects' behaviour must be used with 2 handles");if(l&&(t.margin||t.limit))throw new Error("noUiSlider: 'unconstrained' behaviour cannot be used with margin or limit");t.events={tap:n||s,drag:i,dragAll:c,smoothSteps:u,fixed:r,snap:s,hover:o,unconstrained:l,invertConnects:a}}function mf(t,e){if(e!==!1)if(e===!0||Ci(e)){t.tooltips=[];for(var n=0;n<t.handles;n++)t.tooltips.push(e)}else{if(e=Ii(e),e.length!==t.handles)throw new Error("noUiSlider: must pass a formatter for all handles.");e.forEach(function(i){if(typeof i!="boolean"&&!Ci(i))throw new Error("noUiSlider: 'tooltips' must be passed a formatter or 'false'.")}),t.tooltips=e}}function pf(t,e){if(e.length!==t.handles)throw new Error("noUiSlider: must pass a attributes for all handles.");t.handleAttributes=e}function gf(t,e){if(!Ci(e))throw new Error("noUiSlider: 'ariaFormat' requires 'to' method.");t.ariaFormat=e}function _f(t,e){if(!ju(e))throw new Error("noUiSlider: 'format' requires 'to' and 'from' methods.");t.format=e}function vf(t,e){if(typeof e!="boolean")throw new Error("noUiSlider: 'keyboardSupport' option must be a boolean.");t.keyboardSupport=e}function yf(t,e){t.documentElement=e}function bf(t,e){if(typeof e!="string"&&e!==!1)throw new Error("noUiSlider: 'cssPrefix' must be a string or `false`.");t.cssPrefix=e}function wf(t,e){if(typeof e!="object")throw new Error("noUiSlider: 'cssClasses' must be an object.");typeof t.cssPrefix=="string"?(t.cssClasses={},Object.keys(e).forEach(function(n){t.cssClasses[n]=t.cssPrefix+e[n]})):t.cssClasses=e}function ho(t){var e={margin:null,limit:null,padding:null,animate:!0,animationDuration:300,ariaFormat:ao,format:ao},n={step:{r:!1,t:Zu},keyboardPageMultiplier:{r:!1,t:ef},keyboardMultiplier:{r:!1,t:tf},keyboardDefaultStep:{r:!1,t:nf},start:{r:!0,t:sf},connect:{r:!0,t:uo},direction:{r:!0,t:hf},snap:{r:!1,t:of},animate:{r:!1,t:lf},animationDuration:{r:!1,t:af},range:{r:!0,t:rf},orientation:{r:!1,t:cf},margin:{r:!1,t:fo},limit:{r:!1,t:uf},padding:{r:!1,t:ff},behaviour:{r:!0,t:df},ariaFormat:{r:!1,t:gf},format:{r:!1,t:_f},tooltips:{r:!1,t:mf},keyboardSupport:{r:!0,t:vf},documentElement:{r:!1,t:yf},cssPrefix:{r:!0,t:bf},cssClasses:{r:!0,t:wf},handleAttributes:{r:!1,t:pf}},i={connect:!1,direction:"ltr",behaviour:"tap",orientation:"horizontal",keyboardSupport:!0,cssPrefix:"noUi-",cssClasses:co,keyboardPageMultiplier:5,keyboardMultiplier:1,keyboardDefaultStep:10};t.format&&!t.ariaFormat&&(t.ariaFormat=t.format),Object.keys(n).forEach(function(a){if(!Er(t[a])&&i[a]===void 0){if(n[a].r)throw new Error("noUiSlider: '"+a+"' is required.");return}n[a].t(e,Er(t[a])?t[a]:i[a])}),e.pips=t.pips;var r=document.createElement("div"),s=r.style.msTransform!==void 0,o=r.style.transform!==void 0;e.transformRule=o?"transform":s?"msTransform":"webkitTransform";var l=[["left","top"],["right","bottom"]];return e.style=l[e.dir][e.ort],e}function Sf(t,e,n){var i=qu(),r=Wu(),s=r&&Ku(),o=t,l,a,c,u,h,f,d=e.spectrum,m=[],p=[],g=[],_=0,S={},C=!1,b=t.ownerDocument,k=e.documentElement||b.documentElement,P=b.body,A=b.dir==="rtl"||e.ort===1?0:100;function E(T,O){var j=b.createElement("div");return O&&et(j,O),T.appendChild(j),j}function M(T,O){var j=E(T,e.cssClasses.origin),J=E(j,e.cssClasses.handle);if(E(J,e.cssClasses.touchArea),J.setAttribute("data-handle",String(O)),e.keyboardSupport&&(J.setAttribute("tabindex","0"),J.addEventListener("keydown",function(ne){return wt(ne,O)})),e.handleAttributes!==void 0){var te=e.handleAttributes[O];Object.keys(te).forEach(function(ne){J.setAttribute(ne,te[ne])})}return J.setAttribute("role","slider"),J.setAttribute("aria-orientation",e.ort?"vertical":"horizontal"),O===0?et(J,e.cssClasses.handleLower):O===e.handles-1&&et(J,e.cssClasses.handleUpper),j.handle=J,j}function D(T,O){return O?E(T,e.cssClasses.connect):!1}function $(T,O){a=E(O,e.cssClasses.connects),c=[],u=[],u.push(D(a,T[0]));for(var j=0;j<e.handles;j++)c.push(M(O,j)),g[j]=j,u.push(D(a,T[j+1]))}function R(T){et(T,e.cssClasses.target),e.dir===0?et(T,e.cssClasses.ltr):et(T,e.cssClasses.rtl),e.ort===0?et(T,e.cssClasses.horizontal):et(T,e.cssClasses.vertical);var O=getComputedStyle(T).direction;return O==="rtl"?et(T,e.cssClasses.textDirectionRtl):et(T,e.cssClasses.textDirectionLtr),E(T,e.cssClasses.base)}function z(T,O){return!e.tooltips||!e.tooltips[O]?!1:E(T.firstChild,e.cssClasses.tooltip)}function I(){return o.hasAttribute("disabled")}function N(T){var O=c[T];return O.hasAttribute("disabled")}function x(T){T!=null?(c[T].setAttribute("disabled",""),c[T].handle.removeAttribute("tabindex")):(o.setAttribute("disabled",""),c.forEach(function(O){O.handle.removeAttribute("tabindex")}))}function L(T){T!=null?(c[T].removeAttribute("disabled"),c[T].handle.setAttribute("tabindex","0")):(o.removeAttribute("disabled"),c.forEach(function(O){O.removeAttribute("disabled"),O.handle.setAttribute("tabindex","0")}))}function B(){f&&(At("update"+nn.tooltips),f.forEach(function(T){T&&no(T)}),f=null)}function U(){B(),f=c.map(z),zn("update"+nn.tooltips,function(T,O,j){if(!(!f||!e.tooltips)&&f[O]!==!1){var J=T[O];e.tooltips[O]!==!0&&(J=e.tooltips[O].to(j[O])),f[O].innerHTML=J}})}function G(){At("update"+nn.aria),zn("update"+nn.aria,function(T,O,j,J,te){g.forEach(function(ne){var he=c[ne],le=gn(p,ne,0,!0,!0,!0),Ne=gn(p,ne,100,!0,!0,!0),Oe=te[ne],De=String(e.ariaFormat.to(j[ne]));le=d.fromStepping(le).toFixed(1),Ne=d.fromStepping(Ne).toFixed(1),Oe=d.fromStepping(Oe).toFixed(1),he.children[0].setAttribute("aria-valuemin",le),he.children[0].setAttribute("aria-valuemax",Ne),he.children[0].setAttribute("aria-valuenow",Oe),he.children[0].setAttribute("aria-valuetext",De)})})}function X(T){if(T.mode===tn.Range||T.mode===tn.Steps)return d.xVal;if(T.mode===tn.Count){if(T.values<2)throw new Error("noUiSlider: 'values' (>= 2) required for mode 'count'.");for(var O=T.values-1,j=100/O,J=[];O--;)J[O]=O*j;return J.push(100),ee(J,T.stepped)}return T.mode===tn.Positions?ee(T.values,T.stepped):T.mode===tn.Values?T.stepped?T.values.map(function(te){return d.fromStepping(d.getStep(d.toStepping(te)))}):T.values:[]}function ee(T,O){return T.map(function(j){return d.fromStepping(O?d.getStep(j):j)})}function Q(T){function O(Oe,De){return Number((Oe+De).toFixed(7))}var j=X(T),J={},te=d.xVal[0],ne=d.xVal[d.xVal.length-1],he=!1,le=!1,Ne=0;return j=Fu(j.slice().sort(function(Oe,De){return Oe-De})),j[0]!==te&&(j.unshift(te),he=!0),j[j.length-1]!==ne&&(j.push(ne),le=!0),j.forEach(function(Oe,De){var $e,xe,Ue,nt=Oe,qe=j[De+1],Qe,Ss,ks,Es,Mc,Cs,xc,Ac=T.mode===tn.Steps;for(Ac&&($e=d.xNumSteps[De]),$e||($e=qe-nt),qe===void 0&&(qe=nt),$e=Math.max($e,1e-7),xe=nt;xe<=qe;xe=O(xe,$e)){for(Qe=d.toStepping(xe),Ss=Qe-Ne,Mc=Ss/(T.density||1),Cs=Math.round(Mc),xc=Ss/Cs,Ue=1;Ue<=Cs;Ue+=1)ks=Ne+Ue*xc,J[ks.toFixed(5)]=[d.fromStepping(ks),0];Es=j.indexOf(xe)>-1?it.LargeValue:Ac?it.SmallValue:it.NoValue,!De&&he&&xe!==qe&&(Es=0),xe===qe&&le||(J[Qe.toFixed(5)]=[xe,Es]),Ne=Qe}}),J}function Y(T,O,j){var J,te,ne=b.createElement("div"),he=(J={},J[it.None]="",J[it.NoValue]=e.cssClasses.valueNormal,J[it.LargeValue]=e.cssClasses.valueLarge,J[it.SmallValue]=e.cssClasses.valueSub,J),le=(te={},te[it.None]="",te[it.NoValue]=e.cssClasses.markerNormal,te[it.LargeValue]=e.cssClasses.markerLarge,te[it.SmallValue]=e.cssClasses.markerSub,te),Ne=[e.cssClasses.valueHorizontal,e.cssClasses.valueVertical],Oe=[e.cssClasses.markerHorizontal,e.cssClasses.markerVertical];et(ne,e.cssClasses.pips),et(ne,e.ort===0?e.cssClasses.pipsHorizontal:e.cssClasses.pipsVertical);function De(xe,Ue){var nt=Ue===e.cssClasses.value,qe=nt?Ne:Oe,Qe=nt?he:le;return Ue+" "+qe[e.ort]+" "+Qe[xe]}function $e(xe,Ue,nt){if(nt=O?O(Ue,nt):nt,nt!==it.None){var qe=E(ne,!1);qe.className=De(nt,e.cssClasses.marker),qe.style[e.style]=xe+"%",nt>it.NoValue&&(qe=E(ne,!1),qe.className=De(nt,e.cssClasses.value),qe.setAttribute("data-value",String(Ue)),qe.style[e.style]=xe+"%",qe.innerHTML=String(j.to(Ue)))}}return Object.keys(T).forEach(function(xe){$e(xe,T[xe][0],T[xe][1])}),ne}function oe(){h&&(no(h),h=null)}function fe(T){oe();var O=Q(T),j=T.filter,J=T.format||{to:function(te){return String(Math.round(te))}};return h=o.appendChild(Y(O,j,J)),h}function ke(){var T=l.getBoundingClientRect(),O="offset"+["Width","Height"][e.ort];return e.ort===0?T.width||l[O]:T.height||l[O]}function ie(T,O,j,J){var te=function(he){var le=ze(he,J.pageOffset,J.target||O);if(!le||I()&&!J.doNotReject||Bu(o,e.cssClasses.tap)&&!J.doNotReject||T===i.start&&le.buttons!==void 0&&le.buttons>1||J.hover&&le.buttons)return!1;s||le.preventDefault(),le.calcPoint=le.points[e.ort],j(le,J)},ne=[];return T.split(" ").forEach(function(he){O.addEventListener(he,te,s?{passive:!0}:!1),ne.push([he,te])}),ne}function ze(T,O,j){var J=T.type.indexOf("touch")===0,te=T.type.indexOf("mouse")===0,ne=T.type.indexOf("pointer")===0,he=0,le=0;if(T.type.indexOf("MSPointer")===0&&(ne=!0),T.type==="mousedown"&&!T.buttons&&!T.touches)return!1;if(J){var Ne=function($e){var xe=$e.target;return xe===j||j.contains(xe)||T.composed&&T.composedPath().shift()===j};if(T.type==="touchstart"){var Oe=Array.prototype.filter.call(T.touches,Ne);if(Oe.length>1)return!1;he=Oe[0].pageX,le=Oe[0].pageY}else{var De=Array.prototype.find.call(T.changedTouches,Ne);if(!De)return!1;he=De.pageX,le=De.pageY}}return O=O||oo(b),(te||ne)&&(he=T.clientX+O.x,le=T.clientY+O.y),T.pageOffset=O,T.points=[he,le],T.cursor=te||ne,T}function Xe(T){var O=T-Hu(l,e.ort),j=O*100/ke();return j=so(j),e.dir?100-j:j}function Ut(T){var O=100,j=!1;return c.forEach(function(J,te){if(!N(te)){var ne=p[te],he=Math.abs(ne-T),le=he===100&&O===100,Ne=he<O,Oe=he<=O&&T>ne;(Ne||Oe||le)&&(j=te,O=he)}}),j}function Me(T,O){T.type==="mouseout"&&T.target.nodeName==="HTML"&&T.relatedTarget===null&&at(T,O)}function Ve(T,O){if(navigator.appVersion.indexOf("MSIE 9")===-1&&T.buttons===0&&O.buttonsProperty!==0)return at(T,O);var j=(e.dir?-1:1)*(T.calcPoint-O.startCalcPoint),J=j*100/O.baseSize;jn(j>0,J,O.locations,O.handleNumbers,O.connect)}function at(T,O){O.handle&&(Mi(O.handle,e.cssClasses.active),_-=1),O.listeners.forEach(function(j){k.removeEventListener(j[0],j[1])}),_===0&&(Mi(o,e.cssClasses.drag),ut(),T.cursor&&(P.style.cursor="",P.removeEventListener("selectstart",io))),e.events.smoothSteps&&(O.handleNumbers.forEach(function(j){ft(j,p[j],!0,!0,!1,!1)}),O.handleNumbers.forEach(function(j){Pe("update",j)})),O.handleNumbers.forEach(function(j){Pe("change",j),Pe("set",j),Pe("end",j)})}function Te(T,O){if(!O.handleNumbers.some(N)){var j;if(O.handleNumbers.length===1){var J=c[O.handleNumbers[0]];j=J.children[0],_+=1,et(j,e.cssClasses.active)}T.stopPropagation();var te=[],ne=ie(i.move,k,Ve,{target:T.target,handle:j,connect:O.connect,listeners:te,startCalcPoint:T.calcPoint,baseSize:ke(),pageOffset:T.pageOffset,handleNumbers:O.handleNumbers,buttonsProperty:T.buttons,locations:p.slice()}),he=ie(i.end,k,at,{target:T.target,handle:j,listeners:te,doNotReject:!0,handleNumbers:O.handleNumbers}),le=ie("mouseout",k,Me,{target:T.target,handle:j,listeners:te,doNotReject:!0,handleNumbers:O.handleNumbers});te.push.apply(te,ne.concat(he,le)),T.cursor&&(P.style.cursor=getComputedStyle(T.target).cursor,c.length>1&&et(o,e.cssClasses.drag),P.addEventListener("selectstart",io,!1)),O.handleNumbers.forEach(function(Ne){Pe("start",Ne)})}}function Je(T){T.stopPropagation();var O=Xe(T.calcPoint),j=Ut(O);j!==!1&&(e.events.snap||ro(o,e.cssClasses.tap,e.animationDuration),ft(j,O,!0,!0),ut(),Pe("slide",j,!0),Pe("update",j,!0),e.events.snap?Te(T,{handleNumbers:[j]}):(Pe("change",j,!0),Pe("set",j,!0)))}function He(T){var O=Xe(T.calcPoint),j=d.getStep(O),J=d.fromStepping(j);Object.keys(S).forEach(function(te){te.split(".")[0]==="hover"&&S[te].forEach(function(ne){ne.call(an,J)})})}function wt(T,O){if(I()||N(O))return!1;var j=["Left","Right"],J=["Down","Up"],te=["PageDown","PageUp"],ne=["Home","End"];e.dir&&!e.ort?j.reverse():e.ort&&!e.dir&&(J.reverse(),te.reverse());var he=T.key.replace("Arrow",""),le=he===te[0],Ne=he===te[1],Oe=he===J[0]||he===j[0]||le,De=he===J[1]||he===j[1]||Ne,$e=he===ne[0],xe=he===ne[1];if(!Oe&&!De&&!$e&&!xe)return!0;T.preventDefault();var Ue;if(De||Oe){var nt=Oe?0:1,qe=Fn(O),Qe=qe[nt];if(Qe===null)return!1;Qe===!1&&(Qe=d.getDefaultStep(p[O],Oe,e.keyboardDefaultStep)),Ne||le?Qe*=e.keyboardPageMultiplier:Qe*=e.keyboardMultiplier,Qe=Math.max(Qe,1e-7),Qe=(Oe?-1:1)*Qe,Ue=m[O]+Qe}else xe?Ue=e.spectrum.xVal[e.spectrum.xVal.length-1]:Ue=e.spectrum.xVal[0];return ft(O,d.toStepping(Ue),!0,!0),Pe("slide",O),Pe("update",O),Pe("change",O),Pe("set",O),!1}function ui(T){T.fixed||c.forEach(function(O,j){ie(i.start,O.children[0],Te,{handleNumbers:[j]})}),T.tap&&ie(i.start,l,Je,{}),T.hover&&ie(i.move,l,He,{hover:!0}),T.drag&&u.forEach(function(O,j){if(!(O===!1||j===0||j===u.length-1)){var J=c[j-1],te=c[j],ne=[O],he=[J,te],le=[j-1,j];et(O,e.cssClasses.draggable),T.fixed&&(ne.push(J.children[0]),ne.push(te.children[0])),T.dragAll&&(he=c,le=g),ne.forEach(function(Ne){ie(i.start,Ne,Te,{handles:he,handleNumbers:le,connect:O})})}})}function zn(T,O){S[T]=S[T]||[],S[T].push(O),T.split(".")[0]==="update"&&c.forEach(function(j,J){Pe("update",J)})}function or(T){return T===nn.aria||T===nn.tooltips}function At(T){var O=T&&T.split(".")[0],j=O?T.substring(O.length):T;Object.keys(S).forEach(function(J){var te=J.split(".")[0],ne=J.substring(te.length);(!O||O===te)&&(!j||j===ne)&&(!or(ne)||j===ne)&&delete S[J]})}function Pe(T,O,j){Object.keys(S).forEach(function(J){var te=J.split(".")[0];T===te&&S[J].forEach(function(ne){ne.call(an,m.map(e.format.to),O,m.slice(),j||!1,p.slice(),an)})})}function gn(T,O,j,J,te,ne,he){var le;return c.length>1&&!e.events.unconstrained&&(J&&O>0&&(le=d.getAbsoluteDistance(T[O-1],e.margin,!1),j=Math.max(j,le)),te&&O<c.length-1&&(le=d.getAbsoluteDistance(T[O+1],e.margin,!0),j=Math.min(j,le))),c.length>1&&e.limit&&(J&&O>0&&(le=d.getAbsoluteDistance(T[O-1],e.limit,!1),j=Math.min(j,le)),te&&O<c.length-1&&(le=d.getAbsoluteDistance(T[O+1],e.limit,!0),j=Math.max(j,le))),e.padding&&(O===0&&(le=d.getAbsoluteDistance(0,e.padding[0],!1),j=Math.max(j,le)),O===c.length-1&&(le=d.getAbsoluteDistance(100,e.padding[1],!0),j=Math.min(j,le))),he||(j=d.getStep(j)),j=so(j),j===T[O]&&!ne?!1:j}function ct(T,O){var j=e.ort;return(j?O:T)+", "+(j?T:O)}function jn(T,O,j,J,te){var ne=j.slice(),he=J[0],le=e.events.smoothSteps,Ne=[!T,T],Oe=[T,!T];J=J.slice(),T&&J.reverse(),J.length>1?J.forEach(function($e,xe){var Ue=gn(ne,$e,ne[$e]+O,Ne[xe],Oe[xe],!1,le);Ue===!1?O=0:(O=Ue-ne[$e],ne[$e]=Ue)}):Ne=Oe=[!0];var De=!1;J.forEach(function($e,xe){De=ft($e,j[$e]+O,Ne[xe],Oe[xe],!1,le)||De}),De&&(J.forEach(function($e){Pe("update",$e),Pe("slide",$e)}),te!=null&&Pe("drag",he))}function gt(T,O){return e.dir?100-T-O:T}function fi(T,O){p[T]=O,m[T]=d.fromStepping(O);var j=gt(O,0)-A,J="translate("+ct(j+"%","0")+")";if(c[T].style[e.transformRule]=J,e.events.invertConnects&&p.length>1){var te=p.every(function(ne,he,le){return he===0||ne>=le[he-1]});if(C!==!te){Ie();return}}Ae(T),Ae(T+1),C&&(Ae(T-1),Ae(T+2))}function ut(){g.forEach(function(T){var O=p[T]>50?-1:1,j=3+(c.length+O*T);c[T].style.zIndex=String(j)})}function ft(T,O,j,J,te,ne){return te||(O=gn(p,T,O,j,J,!1,ne)),O===!1?!1:(fi(T,O),!0)}function Ae(T){if(u[T]){var O=p.slice();C&&O.sort(function(le,Ne){return le-Ne});var j=0,J=100;T!==0&&(j=O[T-1]),T!==u.length-1&&(J=O[T]);var te=J-j,ne="translate("+ct(gt(j,te)+"%","0")+")",he="scale("+ct(te/100,"1")+")";u[T].style[e.transformRule]=ne+" "+he}}function lr(T,O){return T===null||T===!1||T===void 0||(typeof T=="number"&&(T=String(T)),T=e.format.from(T),T!==!1&&(T=d.toStepping(T)),T===!1||isNaN(T))?p[O]:T}function ln(T,O,j){var J=Ii(T),te=p[0]===void 0;O=O===void 0?!0:O,e.animate&&!te&&ro(o,e.cssClasses.tap,e.animationDuration),g.forEach(function(le){ft(le,lr(J[le],le),!0,!1,j)});var ne=g.length===1?0:1;if(te&&d.hasNoSize()&&(j=!0,p[0]=0,g.length>1)){var he=100/(g.length-1);g.forEach(function(le){p[le]=le*he})}for(;ne<g.length;++ne)g.forEach(function(le){ft(le,p[le],!0,!0,j)});ut(),g.forEach(function(le){Pe("update",le),J[le]!==null&&O&&Pe("set",le)})}function St(T){ln(e.start,T)}function ar(T,O,j,J){if(T=Number(T),!(T>=0&&T<g.length))throw new Error("noUiSlider: invalid handle number, got: "+T);ft(T,lr(O,T),!0,!0,J),Pe("update",T),j&&Pe("set",T)}function Rt(T){if(T===void 0&&(T=!1),T)return m.length===1?m[0]:m.slice(0);var O=m.map(e.format.to);return O.length===1?O[0]:O}function cr(){for(At(nn.aria),At(nn.tooltips),Object.keys(e.cssClasses).forEach(function(T){Mi(o,e.cssClasses[T])});o.firstChild;)o.removeChild(o.firstChild);delete o.noUiSlider}function Fn(T){var O=p[T],j=d.getNearbySteps(O),J=m[T],te=j.thisStep.step,ne=null;if(e.snap)return[J-j.stepBefore.startValue||null,j.stepAfter.startValue-J||null];te!==!1&&J+te>j.stepAfter.startValue&&(te=j.stepAfter.startValue-J),J>j.thisStep.startValue?ne=j.thisStep.step:j.stepBefore.step===!1?ne=!1:ne=J-j.stepBefore.highestStep,O===100?te=null:O===0&&(ne=null);var he=d.countStepDecimals();return te!==null&&te!==!1&&(te=Number(te.toFixed(he))),ne!==null&&ne!==!1&&(ne=Number(ne.toFixed(he))),[ne,te]}function kt(){return g.map(Fn)}function ur(T,O){var j=Rt(),J=["margin","limit","padding","range","animate","snap","step","format","pips","tooltips","connect"];J.forEach(function(ne){T[ne]!==void 0&&(n[ne]=T[ne])});var te=ho(n);J.forEach(function(ne){T[ne]!==void 0&&(e[ne]=te[ne])}),d=te.spectrum,e.margin=te.margin,e.limit=te.limit,e.padding=te.padding,e.pips?fe(e.pips):oe(),e.tooltips?U():B(),p=[],ln(Er(T.start)?T.start:j,O),T.connect&&re()}function re(){for(;a.firstChild;)a.removeChild(a.firstChild);for(var T=0;T<=e.handles;T++)u[T]=D(a,e.connect[T]),Ae(T);ui({drag:e.events.drag,fixed:!0})}function Ie(){C=!C,uo(e,e.connect.map(function(T){return!T})),re()}function Le(){l=R(o),$(e.connect,l),ui(e.events),ln(e.start),e.pips&&fe(e.pips),e.tooltips&&U(),G()}Le();var an={destroy:cr,steps:kt,on:zn,off:At,get:Rt,set:ln,setHandle:ar,reset:St,disable:x,enable:L,__moveHandles:function(T,O,j){jn(T,O,p,j)},options:n,updateOptions:ur,target:o,removePips:oe,removeTooltips:B,getPositions:function(){return p.slice()},getTooltips:function(){return f},getOrigins:function(){return c},pips:fe};return an}function kf(t,e){if(!t||!t.nodeName)throw new Error("noUiSlider: create requires a single element, got: "+t);if(t.noUiSlider)throw new Error("noUiSlider: Slider was already initialized.");var n=ho(e),i=Sf(t,n,e);return t.noUiSlider=i,i}const Ef={__spectrum:lo,cssClasses:co,create:kf},Py="",Ly="";function Cf(t){let e,n,i;return{c(){e=w("span"),n=se(t[0]),v(e,"id",t[3]),v(e,"class",i="tooltip "+t[2]+" "+(t[1]?"display":"")+" svelte-1am23me")},m(r,s){V(r,e,s),y(e,n)},p(r,[s]){s&1&&ve(n,r[0]),s&6&&i!==(i="tooltip "+r[2]+" "+(r[1]?"display":"")+" svelte-1am23me")&&v(e,"class",i)},i:Z,o:Z,d(r){r&&F(e)}}}function If(t,e,n){let i,r,s,o,{tooltipText:l}=e,{targetHtmlId:a}=e;const c=`tooltip-generic-${window.crypto.randomUUID()}`,u=()=>n(1,o=!0),h=()=>n(1,o=!1),f=()=>n(1,o=!o);return Hn(()=>{s=a?document.getElementById(a):document.getElementById(c).parentElement,a&&!s&&(console.error(`TooltipGeneric: element with ID ${a} not found, defaulting to the parent element`),s=document.getElementById(c).targetElement),s.addEventListener("mouseover",u),s.addEventListener("mouseout",h),s.addEventListener("click",f)}),Un(()=>{s.removeEventListener("mouseover",u),s.removeEventListener("mouseout",h),s.removeEventListener("click",f)}),t.$$set=d=>{"tooltipText"in d&&n(0,l=d.tooltipText),"targetHtmlId"in d&&n(4,a=d.targetHtmlId)},t.$$.update=()=>{t.$$.dirty&33&&n(2,i=r(l))},n(5,r=d=>n(2,i=d.length>100?"tooltip-wide":d.length>20?"tooltip-mid":"tooltip-thin")),s=void 0,n(1,o=!1),[l,o,i,c,a,r]}class xi extends be{constructor(e){super(),ye(this,e,If,Cf,_e,{tooltipText:0,targetHtmlId:4})}}const Ry="";function Mf(t){let e,n,i,r,s,o,l,a,c,u,h,f,d,m,p,g;return{c(){e=w("div"),n=w("span"),i=se(t[2]),r=se(" ("),s=se(t[3]),o=se(")"),l=q(),a=w("div"),c=w("span"),u=se(t[0]),h=q(),f=w("div"),d=w("div"),m=q(),p=w("span"),g=se(t[1]),v(c,"class","range-marker svelte-216mtn"),v(d,"class","slider"),v(d,"id",t[4]),v(f,"class","slider-wrapper svelte-216mtn"),v(p,"class","range-marker svelte-216mtn"),v(a,"class","slider-outer-wrapper is-flex flex-direction-row svelte-216mtn")},m(_,S){V(_,e,S),y(e,n),y(n,i),y(n,r),y(n,s),y(n,o),y(e,l),y(e,a),y(a,c),y(c,u),y(a,h),y(a,f),y(f,d),y(a,m),y(a,p),y(p,g)},p(_,[S]){S&4&&ve(i,_[2]),S&8&&ve(s,_[3]),S&1&&ve(u,_[0]),S&2&&ve(g,_[1])},i:Z,o:Z,d(_){_&&F(e)}}}function xf(t,e,n){let i,{minVal:r}=e,{maxVal:s}=e,{start:o}=e,{step:l=void 0}=e,{roundTo:a=2}=e,{title:c=""}=e,{emitOnUpdate:u=!1}=e;const h=bi(),f=`slider-${window.crypto.randomUUID()}`,d=Array.isArray(o)&&o.length===2&&o.every(E=>!isNaN(parseFloat(E))),m=[],p=d?[`noUi-handle-${window.crypto.randomUUID()}`,`noUi-handle-${window.crypto.randomUUID()}`]:[`noUi-handle-${window.crypto.randomUUID()}`],g=Si();g.setCompareFn(d?kr:(E,M)=>S(E)===S(M)),g.set(o);const _=vt("resetTrigger")||void 0;_==null||_.subscribe(k);const S=E=>Number(E.toFixed(a)),C=(E,M)=>{E=Array.isArray(E)?E.map(S):S(E),n(3,i=E),(M==="set"||M==="update"&&u)&&(g.set(E),g.same()||h("updateSlider",g.get()))};function b(E){m.length&&m.map((M,D)=>M.$set({tooltipText:d?E[D]:E}))}function k(){const E=document.getElementById(f);E!=null&&E.noUiSlider&&E.noUiSlider.reset()}function P(){const E=document.getElementById(f);let M;Ef.create(E,{start:o,step:l,connect:d?!0:"lower",range:{min:r,max:s},handleAttributes:p.map(D=>({id:D}))}),E.noUiSlider.on("update",()=>{M=E.noUiSlider.get(!0),C(M,"update")}),E.noUiSlider.on("set",()=>{M=E.noUiSlider.get(!0),C(M,"set")})}function A(){p.map((E,M)=>{m.push(new xi({target:document.getElementById(E),props:d?{tooltipText:i[M]}:{tooltipText:i}}))})}return Hn(()=>{P(),A()}),Un(()=>{document.getElementById(f)&&(document.getElementById(f).innerHTML="")}),t.$$set=E=>{"minVal"in E&&n(0,r=E.minVal),"maxVal"in E&&n(1,s=E.maxVal),"start"in E&&n(5,o=E.start),"step"in E&&n(6,l=E.step),"roundTo"in E&&n(7,a=E.roundTo),"title"in E&&n(2,c=E.title),"emitOnUpdate"in E&&n(8,u=E.emitOnUpdate)},t.$$.update=()=>{t.$$.dirty&32&&n(3,i=o),t.$$.dirty&8&&b(i)},[r,s,c,i,f,o,l,a,u]}class cn extends be{constructor(e){super(),ye(this,e,xf,Mf,_e,{minVal:0,maxVal:1,start:5,step:6,roundTo:7,title:2,emitOnUpdate:8})}}const Af=t=>({}),mo=t=>({});function po(t,e,n){const i=t.slice();return i[41]=e[n],i}function go(t,e,n){const i=t.slice();return i[44]=e[n],i}function _o(t,e,n){const i=t.slice();return i[41]=e[n],i}function vo(t,e,n){const i=t.slice();i[49]=e[n];const r=Object.keys(i[28][i[49]]||{});return i[50]=r,i}function yo(t){var ur;let e,n,i,r=((ur=t[0])==null?void 0:ur.title)+"",s,o,l,a,c,u,h,f,d,m=(t[3].pairs||0)+"",p,g,_,S,C,b,k,P=(t[3].images||0)+"",A,E,M,D,$,R,z,I=(t[4]||0)+"",N,x,L,B,U,G,X,ee,Q,Y,oe,fe,ke,ie,ze,Xe,Ut,Me,Ve,at,Te,Je,He,wt,ui,zn,or,At,Pe,gn,ct,jn=["Series","Witness","Work"],gt=[];for(let re=0;re<3;re+=1)gt[re]=bo(vo(t,jn,re));U=new zu({props:{documentNodes:t[5],selectedRegions:t[6],toggleRegion:t[17]}});let fi=["all","filtered"],ut=[];for(let re=0;re<2;re+=1)ut[re]=wo(_o(t,fi,re));let ft=t[29],Ae=[];for(let re=0;re<ft.length;re+=1)Ae[re]=So(go(t,ft,re));const lr=re=>K(Ae[re],1,1,()=>{Ae[re]=null});let ln=["threshold","topk"],St=[];for(let re=0;re<2;re+=1)St[re]=ko(po(t,ln,re));const ar=[Of,Nf],Rt=[];function cr(re,Ie){return re[7]==="threshold"?0:1}He=cr(t),wt=Rt[He]=ar[He](t);const Fn=t[34].datavizInfo,kt=Et(Fn,t,t[33],mo);return{c(){e=w("div"),n=w("div"),i=w("h1"),s=se(r),o=q(),l=w("div");for(let re=0;re<3;re+=1)gt[re].c();a=q(),c=w("div"),u=w("div"),h=w("p"),h.textContent=`${W==="en"?"Pairs":"Paires"}`,f=q(),d=w("p"),p=se(m),g=q(),_=w("div"),S=w("div"),C=w("p"),C.textContent="Images",b=q(),k=w("p"),A=se(P),E=q(),M=w("div"),D=w("div"),$=w("p"),$.textContent="Clusters",R=q(),z=w("p"),N=se(I),x=q(),L=w("hr"),B=q(),ue(U.$$.fragment),G=q(),X=w("hr"),ee=q(),Q=w("div"),Y=w("h3"),Y.textContent=`${W==="en"?"Similarity categories":"Catégories de similarité"}`,oe=q(),fe=w("div");for(let re=0;re<2;re+=1)ut[re].c();ke=q(),ie=w("div");for(let re=0;re<Ae.length;re+=1)Ae[re].c();ze=q(),Xe=w("hr"),Ut=q(),Me=w("div"),Ve=w("h3"),Ve.textContent=`${W==="en"?"Similarity score":"Score de similarité"}`,at=q(),Te=w("div");for(let re=0;re<2;re+=1)St[re].c();Je=q(),wt.c(),ui=q(),zn=w("hr"),or=q(),At=w("div"),Pe=w("h3"),Pe.textContent=`${W==="en"?"Visualisation information":"Informations sur la visualisation"}`,gn=q(),kt&&kt.c(),v(i,"class","title"),v(h,"class","heading"),v(d,"class","title is-5"),v(c,"class","level-item has-text-centered"),v(C,"class","heading"),v(k,"class","title is-5"),v(_,"class","level-item has-text-centered"),v($,"class","heading"),v(z,"class","title is-5"),v(M,"class","level-item has-text-centered"),v(l,"class","level"),v(n,"class","pb-2"),v(Y,"class","title"),v(fe,"class","buttons mb-3"),v(ie,"class","level"),Se(ie,"is-disabled",t[1]==="all"),v(Q,"class","pt-2"),v(Ve,"class","title"),v(Te,"class","buttons mb-3"),v(Me,"class","pt-2"),v(Pe,"class","title"),v(At,"class","py-2"),v(e,"class","content is-small mt-4")},m(re,Ie){V(re,e,Ie),y(e,n),y(n,i),y(i,s),y(n,o),y(n,l);for(let Le=0;Le<3;Le+=1)gt[Le]&&gt[Le].m(l,null);y(l,a),y(l,c),y(c,u),y(u,h),y(u,f),y(u,d),y(d,p),y(l,g),y(l,_),y(_,S),y(S,C),y(S,b),y(S,k),y(k,A),y(l,E),y(l,M),y(M,D),y(D,$),y(D,R),y(D,z),y(z,N),y(e,x),y(e,L),y(e,B),ae(U,e,null),y(e,G),y(e,X),y(e,ee),y(e,Q),y(Q,Y),y(Q,oe),y(Q,fe);for(let Le=0;Le<2;Le+=1)ut[Le]&&ut[Le].m(fe,null);y(Q,ke),y(Q,ie);for(let Le=0;Le<Ae.length;Le+=1)Ae[Le]&&Ae[Le].m(ie,null);y(e,ze),y(e,Xe),y(e,Ut),y(e,Me),y(Me,Ve),y(Me,at),y(Me,Te);for(let Le=0;Le<2;Le+=1)St[Le]&&St[Le].m(Te,null);y(Me,Je),Rt[He].m(Me,null),y(e,ui),y(e,zn),y(e,or),y(e,At),y(At,Pe),y(At,gn),kt&&kt.m(At,null),ct=!0},p(re,Ie){var T;if((!ct||Ie[0]&1)&&r!==(r=((T=re[0])==null?void 0:T.title)+"")&&ve(s,r),Ie[0]&268435456){jn=["Series","Witness","Work"];let O;for(O=0;O<3;O+=1){const j=vo(re,jn,O);gt[O]?gt[O].p(j,Ie):(gt[O]=bo(j),gt[O].c(),gt[O].m(l,a))}for(;O<3;O+=1)gt[O].d(1)}(!ct||Ie[0]&8)&&m!==(m=(re[3].pairs||0)+"")&&ve(p,m),(!ct||Ie[0]&8)&&P!==(P=(re[3].images||0)+"")&&ve(A,P),(!ct||Ie[0]&16)&&I!==(I=(re[4]||0)+"")&&ve(N,I);const Le={};if(Ie[0]&32&&(Le.documentNodes=re[5]),Ie[0]&64&&(Le.selectedRegions=re[6]),U.$set(Le),Ie[0]&1073741826){fi=["all","filtered"];let O;for(O=0;O<2;O+=1){const j=_o(re,fi,O);ut[O]?ut[O].p(j,Ie):(ut[O]=wo(j),ut[O].c(),ut[O].m(fe,null))}for(;O<2;O+=1)ut[O].d(1)}if(Ie[0]&536903694){ft=re[29];let O;for(O=0;O<ft.length;O+=1){const j=go(re,ft,O);Ae[O]?(Ae[O].p(j,Ie),H(Ae[O],1)):(Ae[O]=So(j),Ae[O].c(),H(Ae[O],1),Ae[O].m(ie,null))}for(Ee(),O=ft.length;O<Ae.length;O+=1)lr(O);Ce()}if((!ct||Ie[0]&2)&&Se(ie,"is-disabled",re[1]==="all"),Ie[0]&33554560){ln=["threshold","topk"];let O;for(O=0;O<2;O+=1){const j=po(re,ln,O);St[O]?St[O].p(j,Ie):(St[O]=ko(j),St[O].c(),St[O].m(Te,null))}for(;O<2;O+=1)St[O].d(1)}let an=He;He=cr(re),He===an?Rt[He].p(re,Ie):(Ee(),K(Rt[an],1,1,()=>{Rt[an]=null}),Ce(),wt=Rt[He],wt?wt.p(re,Ie):(wt=Rt[He]=ar[He](re),wt.c()),H(wt,1),wt.m(Me,null)),kt&&kt.p&&(!ct||Ie[1]&4)&&It(kt,Fn,re,re[33],ct?Ct(Fn,re[33],Ie,Af):Mt(re[33]),mo)},i(re){if(!ct){H(U.$$.fragment,re);for(let Ie=0;Ie<ft.length;Ie+=1)H(Ae[Ie]);H(wt),H(kt,re),ct=!0}},o(re){K(U.$$.fragment,re),Ae=Ae.filter(Boolean);for(let Ie=0;Ie<Ae.length;Ie+=1)K(Ae[Ie]);K(wt),K(kt,re),ct=!1},d(re){re&&F(e),We(gt,re),ce(U),We(ut,re),We(Ae,re),We(St,re),Rt[He].d(),kt&&kt.d(re)}}}function Tf(t){let e,n,i,r=nu[t[49]]+"",s,o,l,a=(t[50].length||0)+"",c;return{c(){e=w("div"),n=w("div"),i=w("p"),s=se(r),o=q(),l=w("p"),c=se(a),v(i,"class","heading"),v(l,"class","title is-5"),v(e,"class","level-item has-text-centered")},m(u,h){V(u,e,h),y(e,n),y(n,i),y(i,s),y(n,o),y(n,l),y(l,c)},p:Z,d(u){u&&F(e)}}}function bo(t){let e,n=t[50].length>0&&Tf(t);return{c(){n&&n.c(),e=Ge()},m(i,r){n&&n.m(i,r),V(i,e,r)},p(i,r){i[50].length>0&&n.p(i,r)},d(i){n&&n.d(i),i&&F(e)}}}function wo(t){let e,n=t[41]==="all"?W==="en"?"All pairs":"Toutes les paires":W==="en"?"Filter by category":"Filtrer par catégorie",i,r,s,o;function l(){return t[35](t[41])}return{c(){e=w("button"),i=se(n),r=q(),v(e,"class","button is-small is-flex-grow-1"),Se(e,"is-link",t[1]===t[41]),Se(e,"is-contrasted",t[1]!==t[41])},m(a,c){V(a,e,c),y(e,i),y(e,r),s||(o=pe(e,"click",l),s=!0)},p(a,c){t=a,c[0]&2&&Se(e,"is-link",t[1]===t[41]),c[0]&2&&Se(e,"is-contrasted",t[1]!==t[41])},d(a){a&&F(e),s=!1,o()}}}function So(t){let e,n,i,r,s,o=(t[3].categories[t[44]]||0)+"",l,a,c;return i=new xn({props:{category:t[44],isSelected:t[2].includes(t[44]),toggle:t[36],selectable:t[1]==="filtered"}}),{c(){e=w("div"),n=w("div"),ue(i.$$.fragment),r=q(),s=w("p"),l=se(o),a=q(),v(s,"class","is-size-7 mt-1"),v(e,"class","level-item has-text-centered")},m(u,h){V(u,e,h),y(e,n),ae(i,n,null),y(n,r),y(n,s),y(s,l),y(e,a),c=!0},p(u,h){const f={};h[0]&4&&(f.isSelected=u[2].includes(u[44])),h[0]&2&&(f.toggle=u[36]),h[0]&2&&(f.selectable=u[1]==="filtered"),i.$set(f),(!c||h[0]&8)&&o!==(o=(u[3].categories[u[44]]||0)+"")&&ve(l,o)},i(u){c||(H(i.$$.fragment,u),c=!0)},o(u){K(i.$$.fragment,u),c=!1},d(u){u&&F(e),ce(i)}}}function ko(t){let e,n=t[41]==="threshold"?W==="en"?"Score threshold":"Seuil de score":W==="en"?"Top K pairs":"Top K paires",i,r,s,o;function l(){return t[37](t[41])}return{c(){e=w("button"),i=se(n),r=q(),v(e,"class","button is-small is-flex-grow-1"),Se(e,"is-link",t[7]===t[41]),Se(e,"is-contrasted",t[7]!==t[41])},m(a,c){V(a,e,c),y(e,i),y(e,r),s||(o=pe(e,"click",l),s=!0)},p(a,c){t=a,c[0]&128&&Se(e,"is-link",t[7]===t[41]),c[0]&128&&Se(e,"is-contrasted",t[7]!==t[41])},d(a){a&&F(e),s=!1,o()}}}function Nf(t){let e,n,i,r,s,o,l,a,c,u,h,f;return i=new cn({props:{minVal:1,maxVal:5,start:t[10]||3,step:1,roundTo:0,title:"K"}}),i.$on("updateSlider",t[39]),{c(){e=w("div"),n=w("div"),ue(i.$$.fragment),r=q(),s=w("div"),o=w("label"),l=w("input"),a=q(),c=w("span"),c.textContent=`${W==="en"?"Mutual top K":"Top K mutuel"}`,v(n,"class","column is-two-thirds pl-4"),l.checked=t[11],v(l,"type","checkbox"),v(l,"class","mr-2"),v(c,"class","is-size-7"),v(o,"class","checkbox mt-3 is-flex is-align-items-center"),v(s,"class","column mt-2"),v(e,"class","columns mt-2")},m(d,m){V(d,e,m),y(e,n),ae(i,n,null),y(e,r),y(e,s),y(s,o),y(o,l),y(o,a),y(o,c),u=!0,h||(f=pe(l,"change",t[40]),h=!0)},p(d,m){const p={};m[0]&1024&&(p.start=d[10]||3),i.$set(p),(!u||m[0]&2048)&&(l.checked=d[11])},i(d){u||(H(i.$$.fragment,d),u=!0)},o(d){K(i.$$.fragment,d),u=!1},d(d){d&&F(e),ce(i),h=!1,f()}}}function Of(t){var i,r;let e,n;return e=new cn({props:{minVal:((i=t[8].scoreRange)==null?void 0:i.min)||0,maxVal:((r=t[8].scoreRange)==null?void 0:r.max)||1,start:t[9],step:.01,roundTo:2,title:W==="en"?"Minimum score":"Score minimum"}}),e.$on("updateSlider",t[38]),{c(){ue(e.$$.fragment)},m(s,o){ae(e,s,o),n=!0},p(s,o){var a,c;const l={};o[0]&256&&(l.minVal=((a=s[8].scoreRange)==null?void 0:a.min)||0),o[0]&256&&(l.maxVal=((c=s[8].scoreRange)==null?void 0:c.max)||1),o[0]&512&&(l.start=s[9]),e.$set(l)},i(s){n||(H(e.$$.fragment,s),n=!0)},o(s){K(e.$$.fragment,s),n=!1},d(s){ce(e,s)}}}function Pf(t){let e,n,i=t[3]&&yo(t);return{c(){e=w("div"),i&&i.c(),v(e,"class","m-4 py-5 px-4")},m(r,s){V(r,e,s),i&&i.m(e,null),n=!0},p(r,s){r[3]?i?(i.p(r,s),s[0]&8&&H(i,1)):(i=yo(r),i.c(),H(i,1),i.m(e,null)):i&&(Ee(),K(i,1,1,()=>{i=null}),Ce())},i(r){n||(H(i),n=!0)},o(r){K(i),n=!1},d(r){r&&F(e),i&&i.d()}}}function Lf(t,e,n){let i,r,s,o,l,a,c,u,h,f,{$$slots:d={},$$scope:m}=e,{docSet:p=null}=e,{documentSetStore:g}=e,{clusterStore:_}=e;const{docSetNumber:S,documentNodes:C,selectedCategories:b,toggleCategory:k,selectedRegions:P,toggleRegion:A,threshold:E,setThreshold:M,topK:D,setTopK:$,mutualTopK:R,setMutualTopK:z,scoreMode:I,setScoreMode:N,pairStats:x}=g;me(t,S,ie=>n(3,r=ie)),me(t,C,ie=>n(5,o=ie)),me(t,b,ie=>n(2,i=ie)),me(t,P,ie=>n(6,l=ie)),me(t,E,ie=>n(9,u=ie)),me(t,D,ie=>n(10,h=ie)),me(t,R,ie=>n(11,f=ie)),me(t,I,ie=>n(7,a=ie)),me(t,x,ie=>n(8,c=ie));const{clusterNb:L}=_;me(t,L,ie=>n(4,s=ie));const B=vt("selectedDocuments"),U=[0,1,2,3,5];let G="all";function X(ie){n(1,G=ie),ie==="all"&&i.length!==U.length&&b.set(U)}const ee=ie=>X(ie),Q=ie=>G==="filtered"?k(ie):null,Y=ie=>N(ie),oe=ie=>M(ie.detail),fe=ie=>$(ie.detail),ke=()=>z(!f);return t.$$set=ie=>{"docSet"in ie&&n(0,p=ie.docSet),"documentSetStore"in ie&&n(31,g=ie.documentSetStore),"clusterStore"in ie&&n(32,_=ie.clusterStore),"$$scope"in ie&&n(33,m=ie.$$scope)},[p,G,i,r,s,o,l,a,c,u,h,f,S,C,b,k,P,A,E,M,D,$,R,z,I,N,x,L,B,U,X,g,_,m,d,ee,Q,Y,oe,fe,ke]}class Rf extends be{constructor(e){super(),ye(this,e,Lf,Pf,_e,{docSet:0,documentSetStore:31,clusterStore:32},null,[-1,-1])}}function Ai(t,e){return t==null||e==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function Df(t,e){return t==null||e==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function Eo(t){let e,n,i;t.length!==2?(e=Ai,n=(l,a)=>Ai(t(l),a),i=(l,a)=>t(l)-a):(e=t===Ai||t===Df?t:$f,n=t,i=t);function r(l,a,c=0,u=l.length){if(c<u){if(e(a,a)!==0)return u;do{const h=c+u>>>1;n(l[h],a)<0?c=h+1:u=h}while(c<u)}return c}function s(l,a,c=0,u=l.length){if(c<u){if(e(a,a)!==0)return u;do{const h=c+u>>>1;n(l[h],a)<=0?c=h+1:u=h}while(c<u)}return c}function o(l,a,c=0,u=l.length){const h=r(l,a,c,u-1);return h>c&&i(l[h-1],a)>-i(l[h],a)?h-1:h}return{left:r,center:o,right:s}}function $f(){return 0}function zf(t){return t===null?NaN:+t}const jf=Eo(Ai).right;Eo(zf).center;const Ff=jf;class Co extends Map{constructor(e,n=Uf){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:n}}),e!=null)for(const[i,r]of e)this.set(i,r)}get(e){return super.get(Io(this,e))}has(e){return super.has(Io(this,e))}set(e,n){return super.set(Vf(this,e),n)}delete(e){return super.delete(Hf(this,e))}}function Io({_intern:t,_key:e},n){const i=e(n);return t.has(i)?t.get(i):n}function Vf({_intern:t,_key:e},n){const i=e(n);return t.has(i)?t.get(i):(t.set(i,n),n)}function Hf({_intern:t,_key:e},n){const i=e(n);return t.has(i)&&(n=t.get(i),t.delete(i)),n}function Uf(t){return t!==null&&typeof t=="object"?t.valueOf():t}const Bf=Math.sqrt(50),qf=Math.sqrt(10),Kf=Math.sqrt(2);function Ti(t,e,n){const i=(e-t)/Math.max(0,n),r=Math.floor(Math.log10(i)),s=i/Math.pow(10,r),o=s>=Bf?10:s>=qf?5:s>=Kf?2:1;let l,a,c;return r<0?(c=Math.pow(10,-r)/o,l=Math.round(t*c),a=Math.round(e*c),l/c<t&&++l,a/c>e&&--a,c=-c):(c=Math.pow(10,r)*o,l=Math.round(t/c),a=Math.round(e/c),l*c<t&&++l,a*c>e&&--a),a<l&&.5<=n&&n<2?Ti(t,e,n*2):[l,a,c]}function Wf(t,e,n){if(e=+e,t=+t,n=+n,!(n>0))return[];if(t===e)return[t];const i=e<t,[r,s,o]=i?Ti(e,t,n):Ti(t,e,n);if(!(s>=r))return[];const l=s-r+1,a=new Array(l);if(i)if(o<0)for(let c=0;c<l;++c)a[c]=(s-c)/-o;else for(let c=0;c<l;++c)a[c]=(s-c)*o;else if(o<0)for(let c=0;c<l;++c)a[c]=(r+c)/-o;else for(let c=0;c<l;++c)a[c]=(r+c)*o;return a}function Mr(t,e,n){return e=+e,t=+t,n=+n,Ti(t,e,n)[2]}function Gf(t,e,n){e=+e,t=+t,n=+n;const i=e<t,r=i?Mr(e,t,n):Mr(t,e,n);return(i?-1:1)*(r<0?1/-r:r)}function Ni(t,e,n){t=+t,e=+e,n=(r=arguments.length)<2?(e=t,t=0,1):r<3?1:+n;for(var i=-1,r=Math.max(0,Math.ceil((e-t)/n))|0,s=new Array(r);++i<r;)s[i]=t+i*n;return s}function Yf(t){return t}var xr=1,Ar=2,Tr=3,Wn=4,Mo=1e-6;function Xf(t){return"translate("+t+",0)"}function Jf(t){return"translate(0,"+t+")"}function Qf(t){return e=>+t(e)}function Zf(t,e){return e=Math.max(0,t.bandwidth()-e*2)/2,t.round()&&(e=Math.round(e)),n=>+t(n)+e}function eh(){return!this.__axis}function xo(t,e){var n=[],i=null,r=null,s=6,o=6,l=3,a=typeof window<"u"&&window.devicePixelRatio>1?0:.5,c=t===xr||t===Wn?-1:1,u=t===Wn||t===Ar?"x":"y",h=t===xr||t===Tr?Xf:Jf;function f(d){var m=i??(e.ticks?e.ticks.apply(e,n):e.domain()),p=r??(e.tickFormat?e.tickFormat.apply(e,n):Yf),g=Math.max(s,0)+l,_=e.range(),S=+_[0]+a,C=+_[_.length-1]+a,b=(e.bandwidth?Zf:Qf)(e.copy(),a),k=d.selection?d.selection():d,P=k.selectAll(".domain").data([null]),A=k.selectAll(".tick").data(m,e).order(),E=A.exit(),M=A.enter().append("g").attr("class","tick"),D=A.select("line"),$=A.select("text");P=P.merge(P.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),A=A.merge(M),D=D.merge(M.append("line").attr("stroke","currentColor").attr(u+"2",c*s)),$=$.merge(M.append("text").attr("fill","currentColor").attr(u,c*g).attr("dy",t===xr?"0em":t===Tr?"0.71em":"0.32em")),d!==k&&(P=P.transition(d),A=A.transition(d),D=D.transition(d),$=$.transition(d),E=E.transition(d).attr("opacity",Mo).attr("transform",function(R){return isFinite(R=b(R))?h(R+a):this.getAttribute("transform")}),M.attr("opacity",Mo).attr("transform",function(R){var z=this.parentNode.__axis;return h((z&&isFinite(z=z(R))?z:b(R))+a)})),E.remove(),P.attr("d",t===Wn||t===Ar?o?"M"+c*o+","+S+"H"+a+"V"+C+"H"+c*o:"M"+a+","+S+"V"+C:o?"M"+S+","+c*o+"V"+a+"H"+C+"V"+c*o:"M"+S+","+a+"H"+C),A.attr("opacity",1).attr("transform",function(R){return h(b(R)+a)}),D.attr(u+"2",c*s),$.attr(u,c*g).text(p),k.filter(eh).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",t===Ar?"start":t===Wn?"end":"middle"),k.each(function(){this.__axis=b})}return f.scale=function(d){return arguments.length?(e=d,f):e},f.ticks=function(){return n=Array.from(arguments),f},f.tickArguments=function(d){return arguments.length?(n=d==null?[]:Array.from(d),f):n.slice()},f.tickValues=function(d){return arguments.length?(i=d==null?null:Array.from(d),f):i&&i.slice()},f.tickFormat=function(d){return arguments.length?(r=d,f):r},f.tickSize=function(d){return arguments.length?(s=o=+d,f):s},f.tickSizeInner=function(d){return arguments.length?(s=+d,f):s},f.tickSizeOuter=function(d){return arguments.length?(o=+d,f):o},f.tickPadding=function(d){return arguments.length?(l=+d,f):l},f.offset=function(d){return arguments.length?(a=+d,f):a},f}function th(t){return xo(Tr,t)}function nh(t){return xo(Wn,t)}var ih={value:()=>{}};function Gn(){for(var t=0,e=arguments.length,n={},i;t<e;++t){if(!(i=arguments[t]+"")||i in n||/[\s.]/.test(i))throw new Error("illegal type: "+i);n[i]=[]}return new Oi(n)}function Oi(t){this._=t}function rh(t,e){return t.trim().split(/^|\s+/).map(function(n){var i="",r=n.indexOf(".");if(r>=0&&(i=n.slice(r+1),n=n.slice(0,r)),n&&!e.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:i}})}Oi.prototype=Gn.prototype={constructor:Oi,on:function(t,e){var n=this._,i=rh(t+"",n),r,s=-1,o=i.length;if(arguments.length<2){for(;++s<o;)if((r=(t=i[s]).type)&&(r=sh(n[r],t.name)))return r;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++s<o;)if(r=(t=i[s]).type)n[r]=Ao(n[r],t.name,e);else if(e==null)for(r in n)n[r]=Ao(n[r],t.name,null);return this},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new Oi(t)},call:function(t,e){if((r=arguments.length-2)>0)for(var n=new Array(r),i=0,r,s;i<r;++i)n[i]=arguments[i+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(s=this._[t],i=0,r=s.length;i<r;++i)s[i].value.apply(e,n)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var i=this._[t],r=0,s=i.length;r<s;++r)i[r].value.apply(e,n)}};function sh(t,e){for(var n=0,i=t.length,r;n<i;++n)if((r=t[n]).name===e)return r.value}function Ao(t,e,n){for(var i=0,r=t.length;i<r;++i)if(t[i].name===e){t[i]=ih,t=t.slice(0,i).concat(t.slice(i+1));break}return n!=null&&t.push({name:e,value:n}),t}var Nr="http://www.w3.org/1999/xhtml";const To={svg:"http://www.w3.org/2000/svg",xhtml:Nr,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Pi(t){var e=t+="",n=e.indexOf(":");return n>=0&&(e=t.slice(0,n))!=="xmlns"&&(t=t.slice(n+1)),To.hasOwnProperty(e)?{space:To[e],local:t}:t}function oh(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===Nr&&e.documentElement.namespaceURI===Nr?e.createElement(t):e.createElementNS(n,t)}}function lh(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function No(t){var e=Pi(t);return(e.local?lh:oh)(e)}function ah(){}function Or(t){return t==null?ah:function(){return this.querySelector(t)}}function ch(t){typeof t!="function"&&(t=Or(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var s=e[r],o=s.length,l=i[r]=new Array(o),a,c,u=0;u<o;++u)(a=s[u])&&(c=t.call(a,a.__data__,u,s))&&("__data__"in a&&(c.__data__=a.__data__),l[u]=c);return new yt(i,this._parents)}function uh(t){return t==null?[]:Array.isArray(t)?t:Array.from(t)}function fh(){return[]}function Oo(t){return t==null?fh:function(){return this.querySelectorAll(t)}}function hh(t){return function(){return uh(t.apply(this,arguments))}}function dh(t){typeof t=="function"?t=hh(t):t=Oo(t);for(var e=this._groups,n=e.length,i=[],r=[],s=0;s<n;++s)for(var o=e[s],l=o.length,a,c=0;c<l;++c)(a=o[c])&&(i.push(t.call(a,a.__data__,c,o)),r.push(a));return new yt(i,r)}function Po(t){return function(){return this.matches(t)}}function Lo(t){return function(e){return e.matches(t)}}var mh=Array.prototype.find;function ph(t){return function(){return mh.call(this.children,t)}}function gh(){return this.firstElementChild}function _h(t){return this.select(t==null?gh:ph(typeof t=="function"?t:Lo(t)))}var vh=Array.prototype.filter;function yh(){return Array.from(this.children)}function bh(t){return function(){return vh.call(this.children,t)}}function wh(t){return this.selectAll(t==null?yh:bh(typeof t=="function"?t:Lo(t)))}function Sh(t){typeof t!="function"&&(t=Po(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var s=e[r],o=s.length,l=i[r]=[],a,c=0;c<o;++c)(a=s[c])&&t.call(a,a.__data__,c,s)&&l.push(a);return new yt(i,this._parents)}function Ro(t){return new Array(t.length)}function kh(){return new yt(this._enter||this._groups.map(Ro),this._parents)}function Li(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}Li.prototype={constructor:Li,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function Eh(t){return function(){return t}}function Ch(t,e,n,i,r,s){for(var o=0,l,a=e.length,c=s.length;o<c;++o)(l=e[o])?(l.__data__=s[o],i[o]=l):n[o]=new Li(t,s[o]);for(;o<a;++o)(l=e[o])&&(r[o]=l)}function Ih(t,e,n,i,r,s,o){var l,a,c=new Map,u=e.length,h=s.length,f=new Array(u),d;for(l=0;l<u;++l)(a=e[l])&&(f[l]=d=o.call(a,a.__data__,l,e)+"",c.has(d)?r[l]=a:c.set(d,a));for(l=0;l<h;++l)d=o.call(t,s[l],l,s)+"",(a=c.get(d))?(i[l]=a,a.__data__=s[l],c.delete(d)):n[l]=new Li(t,s[l]);for(l=0;l<u;++l)(a=e[l])&&c.get(f[l])===a&&(r[l]=a)}function Mh(t){return t.__data__}function xh(t,e){if(!arguments.length)return Array.from(this,Mh);var n=e?Ih:Ch,i=this._parents,r=this._groups;typeof t!="function"&&(t=Eh(t));for(var s=r.length,o=new Array(s),l=new Array(s),a=new Array(s),c=0;c<s;++c){var u=i[c],h=r[c],f=h.length,d=Ah(t.call(u,u&&u.__data__,c,i)),m=d.length,p=l[c]=new Array(m),g=o[c]=new Array(m),_=a[c]=new Array(f);n(u,h,p,g,_,d,e);for(var S=0,C=0,b,k;S<m;++S)if(b=p[S]){for(S>=C&&(C=S+1);!(k=g[C])&&++C<m;);b._next=k||null}}return o=new yt(o,i),o._enter=l,o._exit=a,o}function Ah(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function Th(){return new yt(this._exit||this._groups.map(Ro),this._parents)}function Nh(t,e,n){var i=this.enter(),r=this,s=this.exit();return typeof t=="function"?(i=t(i),i&&(i=i.selection())):i=i.append(t+""),e!=null&&(r=e(r),r&&(r=r.selection())),n==null?s.remove():n(s),i&&r?i.merge(r).order():r}function Oh(t){for(var e=t.selection?t.selection():t,n=this._groups,i=e._groups,r=n.length,s=i.length,o=Math.min(r,s),l=new Array(r),a=0;a<o;++a)for(var c=n[a],u=i[a],h=c.length,f=l[a]=new Array(h),d,m=0;m<h;++m)(d=c[m]||u[m])&&(f[m]=d);for(;a<r;++a)l[a]=n[a];return new yt(l,this._parents)}function Ph(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var i=t[e],r=i.length-1,s=i[r],o;--r>=0;)(o=i[r])&&(s&&o.compareDocumentPosition(s)^4&&s.parentNode.insertBefore(o,s),s=o);return this}function Lh(t){t||(t=Rh);function e(h,f){return h&&f?t(h.__data__,f.__data__):!h-!f}for(var n=this._groups,i=n.length,r=new Array(i),s=0;s<i;++s){for(var o=n[s],l=o.length,a=r[s]=new Array(l),c,u=0;u<l;++u)(c=o[u])&&(a[u]=c);a.sort(e)}return new yt(r,this._parents).order()}function Rh(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function Dh(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function $h(){return Array.from(this)}function zh(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var i=t[e],r=0,s=i.length;r<s;++r){var o=i[r];if(o)return o}return null}function jh(){let t=0;for(const e of this)++t;return t}function Fh(){return!this.node()}function Vh(t){for(var e=this._groups,n=0,i=e.length;n<i;++n)for(var r=e[n],s=0,o=r.length,l;s<o;++s)(l=r[s])&&t.call(l,l.__data__,s,r);return this}function Hh(t){return function(){this.removeAttribute(t)}}function Uh(t){return function(){this.removeAttributeNS(t.space,t.local)}}function Bh(t,e){return function(){this.setAttribute(t,e)}}function qh(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function Kh(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttribute(t):this.setAttribute(t,n)}}function Wh(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function Gh(t,e){var n=Pi(t);if(arguments.length<2){var i=this.node();return n.local?i.getAttributeNS(n.space,n.local):i.getAttribute(n)}return this.each((e==null?n.local?Uh:Hh:typeof e=="function"?n.local?Wh:Kh:n.local?qh:Bh)(n,e))}function Do(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function Yh(t){return function(){this.style.removeProperty(t)}}function Xh(t,e,n){return function(){this.style.setProperty(t,e,n)}}function Jh(t,e,n){return function(){var i=e.apply(this,arguments);i==null?this.style.removeProperty(t):this.style.setProperty(t,i,n)}}function Qh(t,e,n){return arguments.length>1?this.each((e==null?Yh:typeof e=="function"?Jh:Xh)(t,e,n??"")):An(this.node(),t)}function An(t,e){return t.style.getPropertyValue(e)||Do(t).getComputedStyle(t,null).getPropertyValue(e)}function Zh(t){return function(){delete this[t]}}function ed(t,e){return function(){this[t]=e}}function td(t,e){return function(){var n=e.apply(this,arguments);n==null?delete this[t]:this[t]=n}}function nd(t,e){return arguments.length>1?this.each((e==null?Zh:typeof e=="function"?td:ed)(t,e)):this.node()[t]}function $o(t){return t.trim().split(/^|\s+/)}function Pr(t){return t.classList||new zo(t)}function zo(t){this._node=t,this._names=$o(t.getAttribute("class")||"")}zo.prototype={add:function(t){var e=this._names.indexOf(t);e<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function jo(t,e){for(var n=Pr(t),i=-1,r=e.length;++i<r;)n.add(e[i])}function Fo(t,e){for(var n=Pr(t),i=-1,r=e.length;++i<r;)n.remove(e[i])}function id(t){return function(){jo(this,t)}}function rd(t){return function(){Fo(this,t)}}function sd(t,e){return function(){(e.apply(this,arguments)?jo:Fo)(this,t)}}function od(t,e){var n=$o(t+"");if(arguments.length<2){for(var i=Pr(this.node()),r=-1,s=n.length;++r<s;)if(!i.contains(n[r]))return!1;return!0}return this.each((typeof e=="function"?sd:e?id:rd)(n,e))}function ld(){this.textContent=""}function ad(t){return function(){this.textContent=t}}function cd(t){return function(){var e=t.apply(this,arguments);this.textContent=e??""}}function ud(t){return arguments.length?this.each(t==null?ld:(typeof t=="function"?cd:ad)(t)):this.node().textContent}function fd(){this.innerHTML=""}function hd(t){return function(){this.innerHTML=t}}function dd(t){return function(){var e=t.apply(this,arguments);this.innerHTML=e??""}}function md(t){return arguments.length?this.each(t==null?fd:(typeof t=="function"?dd:hd)(t)):this.node().innerHTML}function pd(){this.nextSibling&&this.parentNode.appendChild(this)}function gd(){return this.each(pd)}function _d(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function vd(){return this.each(_d)}function yd(t){var e=typeof t=="function"?t:No(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function bd(){return null}function wd(t,e){var n=typeof t=="function"?t:No(t),i=e==null?bd:typeof e=="function"?e:Or(e);return this.select(function(){return this.insertBefore(n.apply(this,arguments),i.apply(this,arguments)||null)})}function Sd(){var t=this.parentNode;t&&t.removeChild(this)}function kd(){return this.each(Sd)}function Ed(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function Cd(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function Id(t){return this.select(t?Cd:Ed)}function Md(t){return arguments.length?this.property("__data__",t):this.node().__data__}function xd(t){return function(e){t.call(this,e,this.__data__)}}function Ad(t){return t.trim().split(/^|\s+/).map(function(e){var n="",i=e.indexOf(".");return i>=0&&(n=e.slice(i+1),e=e.slice(0,i)),{type:e,name:n}})}function Td(t){return function(){var e=this.__on;if(e){for(var n=0,i=-1,r=e.length,s;n<r;++n)s=e[n],(!t.type||s.type===t.type)&&s.name===t.name?this.removeEventListener(s.type,s.listener,s.options):e[++i]=s;++i?e.length=i:delete this.__on}}}function Nd(t,e,n){return function(){var i=this.__on,r,s=xd(e);if(i){for(var o=0,l=i.length;o<l;++o)if((r=i[o]).type===t.type&&r.name===t.name){this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=s,r.options=n),r.value=e;return}}this.addEventListener(t.type,s,n),r={type:t.type,name:t.name,value:e,listener:s,options:n},i?i.push(r):this.__on=[r]}}function Od(t,e,n){var i=Ad(t+""),r,s=i.length,o;if(arguments.length<2){var l=this.node().__on;if(l){for(var a=0,c=l.length,u;a<c;++a)for(r=0,u=l[a];r<s;++r)if((o=i[r]).type===u.type&&o.name===u.name)return u.value}return}for(l=e?Nd:Td,r=0;r<s;++r)this.each(l(i[r],e,n));return this}function Vo(t,e,n){var i=Do(t),r=i.CustomEvent;typeof r=="function"?r=new r(e,n):(r=i.document.createEvent("Event"),n?(r.initEvent(e,n.bubbles,n.cancelable),r.detail=n.detail):r.initEvent(e,!1,!1)),t.dispatchEvent(r)}function Pd(t,e){return function(){return Vo(this,t,e)}}function Ld(t,e){return function(){return Vo(this,t,e.apply(this,arguments))}}function Rd(t,e){return this.each((typeof e=="function"?Ld:Pd)(t,e))}function*Dd(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var i=t[e],r=0,s=i.length,o;r<s;++r)(o=i[r])&&(yield o)}var Ho=[null];function yt(t,e){this._groups=t,this._parents=e}function Yn(){return new yt([[document.documentElement]],Ho)}function $d(){return this}yt.prototype=Yn.prototype={constructor:yt,select:ch,selectAll:dh,selectChild:_h,selectChildren:wh,filter:Sh,data:xh,enter:kh,exit:Th,join:Nh,merge:Oh,selection:$d,order:Ph,sort:Lh,call:Dh,nodes:$h,node:zh,size:jh,empty:Fh,each:Vh,attr:Gh,style:Qh,property:nd,classed:od,text:ud,html:md,raise:gd,lower:vd,append:yd,insert:wd,remove:kd,clone:Id,datum:Md,on:Od,dispatch:Rd,[Symbol.iterator]:Dd};function Fe(t){return typeof t=="string"?new yt([[document.querySelector(t)]],[document.documentElement]):new yt([[t]],Ho)}function zd(t){let e;for(;e=t.sourceEvent;)t=e;return t}function rt(t,e){if(t=zd(t),e===void 0&&(e=t.currentTarget),e){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var i=n.createSVGPoint();return i.x=t.clientX,i.y=t.clientY,i=i.matrixTransform(e.getScreenCTM().inverse()),[i.x,i.y]}if(e.getBoundingClientRect){var r=e.getBoundingClientRect();return[t.clientX-r.left-e.clientLeft,t.clientY-r.top-e.clientTop]}}return[t.pageX,t.pageY]}const jd={passive:!1},Xn={capture:!0,passive:!1};function Lr(t){t.stopImmediatePropagation()}function Tn(t){t.preventDefault(),t.stopImmediatePropagation()}function Uo(t){var e=t.document.documentElement,n=Fe(t).on("dragstart.drag",Tn,Xn);"onselectstart"in e?n.on("selectstart.drag",Tn,Xn):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function Bo(t,e){var n=t.document.documentElement,i=Fe(t).on("dragstart.drag",null);e&&(i.on("click.drag",Tn,Xn),setTimeout(function(){i.on("click.drag",null)},0)),"onselectstart"in n?i.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}const Ri=t=>()=>t;function Rr(t,{sourceEvent:e,subject:n,target:i,identifier:r,active:s,x:o,y:l,dx:a,dy:c,dispatch:u}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},subject:{value:n,enumerable:!0,configurable:!0},target:{value:i,enumerable:!0,configurable:!0},identifier:{value:r,enumerable:!0,configurable:!0},active:{value:s,enumerable:!0,configurable:!0},x:{value:o,enumerable:!0,configurable:!0},y:{value:l,enumerable:!0,configurable:!0},dx:{value:a,enumerable:!0,configurable:!0},dy:{value:c,enumerable:!0,configurable:!0},_:{value:u}})}Rr.prototype.on=function(){var t=this._.on.apply(this._,arguments);return t===this._?this:t};function Fd(t){return!t.ctrlKey&&!t.button}function Vd(){return this.parentNode}function Hd(t,e){return e??{x:t.x,y:t.y}}function Ud(){return navigator.maxTouchPoints||"ontouchstart"in this}function Bd(){var t=Fd,e=Vd,n=Hd,i=Ud,r={},s=Gn("start","drag","end"),o=0,l,a,c,u,h=0;function f(b){b.on("mousedown.drag",d).filter(i).on("touchstart.drag",g).on("touchmove.drag",_,jd).on("touchend.drag touchcancel.drag",S).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function d(b,k){if(!(u||!t.call(this,b,k))){var P=C(this,e.call(this,b,k),b,k,"mouse");P&&(Fe(b.view).on("mousemove.drag",m,Xn).on("mouseup.drag",p,Xn),Uo(b.view),Lr(b),c=!1,l=b.clientX,a=b.clientY,P("start",b))}}function m(b){if(Tn(b),!c){var k=b.clientX-l,P=b.clientY-a;c=k*k+P*P>h}r.mouse("drag",b)}function p(b){Fe(b.view).on("mousemove.drag mouseup.drag",null),Bo(b.view,c),Tn(b),r.mouse("end",b)}function g(b,k){if(t.call(this,b,k)){var P=b.changedTouches,A=e.call(this,b,k),E=P.length,M,D;for(M=0;M<E;++M)(D=C(this,A,b,k,P[M].identifier,P[M]))&&(Lr(b),D("start",b,P[M]))}}function _(b){var k=b.changedTouches,P=k.length,A,E;for(A=0;A<P;++A)(E=r[k[A].identifier])&&(Tn(b),E("drag",b,k[A]))}function S(b){var k=b.changedTouches,P=k.length,A,E;for(u&&clearTimeout(u),u=setTimeout(function(){u=null},500),A=0;A<P;++A)(E=r[k[A].identifier])&&(Lr(b),E("end",b,k[A]))}function C(b,k,P,A,E,M){var D=s.copy(),$=rt(M||P,k),R,z,I;if((I=n.call(b,new Rr("beforestart",{sourceEvent:P,target:f,identifier:E,active:o,x:$[0],y:$[1],dx:0,dy:0,dispatch:D}),A))!=null)return R=I.x-$[0]||0,z=I.y-$[1]||0,function N(x,L,B){var U=$,G;switch(x){case"start":r[E]=N,G=o++;break;case"end":delete r[E],--o;case"drag":$=rt(B||L,k),G=o;break}D.call(x,b,new Rr(x,{sourceEvent:L,subject:I,target:f,identifier:E,active:G,x:$[0]+R,y:$[1]+z,dx:$[0]-U[0],dy:$[1]-U[1],dispatch:D}),A)}}return f.filter=function(b){return arguments.length?(t=typeof b=="function"?b:Ri(!!b),f):t},f.container=function(b){return arguments.length?(e=typeof b=="function"?b:Ri(b),f):e},f.subject=function(b){return arguments.length?(n=typeof b=="function"?b:Ri(b),f):n},f.touchable=function(b){return arguments.length?(i=typeof b=="function"?b:Ri(!!b),f):i},f.on=function(){var b=s.on.apply(s,arguments);return b===s?f:b},f.clickDistance=function(b){return arguments.length?(h=(b=+b)*b,f):Math.sqrt(h)},f}function Dr(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function qo(t,e){var n=Object.create(t.prototype);for(var i in e)n[i]=e[i];return n}function Jn(){}var Qn=.7,Di=1/Qn,Nn="\\s*([+-]?\\d+)\\s*",Zn="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",zt="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",qd=/^#([0-9a-f]{3,8})$/,Kd=new RegExp(`^rgb\\(${Nn},${Nn},${Nn}\\)$`),Wd=new RegExp(`^rgb\\(${zt},${zt},${zt}\\)$`),Gd=new RegExp(`^rgba\\(${Nn},${Nn},${Nn},${Zn}\\)$`),Yd=new RegExp(`^rgba\\(${zt},${zt},${zt},${Zn}\\)$`),Xd=new RegExp(`^hsl\\(${Zn},${zt},${zt}\\)$`),Jd=new RegExp(`^hsla\\(${Zn},${zt},${zt},${Zn}\\)$`),Ko={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Dr(Jn,un,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:Wo,formatHex:Wo,formatHex8:Qd,formatHsl:Zd,formatRgb:Go,toString:Go});function Wo(){return this.rgb().formatHex()}function Qd(){return this.rgb().formatHex8()}function Zd(){return Zo(this).formatHsl()}function Go(){return this.rgb().formatRgb()}function un(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=qd.exec(t))?(n=e[1].length,e=parseInt(e[1],16),n===6?Yo(e):n===3?new dt(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):n===8?$i(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):n===4?$i(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=Kd.exec(t))?new dt(e[1],e[2],e[3],1):(e=Wd.exec(t))?new dt(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=Gd.exec(t))?$i(e[1],e[2],e[3],e[4]):(e=Yd.exec(t))?$i(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=Xd.exec(t))?Qo(e[1],e[2]/100,e[3]/100,1):(e=Jd.exec(t))?Qo(e[1],e[2]/100,e[3]/100,e[4]):Ko.hasOwnProperty(t)?Yo(Ko[t]):t==="transparent"?new dt(NaN,NaN,NaN,0):null}function Yo(t){return new dt(t>>16&255,t>>8&255,t&255,1)}function $i(t,e,n,i){return i<=0&&(t=e=n=NaN),new dt(t,e,n,i)}function em(t){return t instanceof Jn||(t=un(t)),t?(t=t.rgb(),new dt(t.r,t.g,t.b,t.opacity)):new dt}function $r(t,e,n,i){return arguments.length===1?em(t):new dt(t,e,n,i??1)}function dt(t,e,n,i){this.r=+t,this.g=+e,this.b=+n,this.opacity=+i}Dr(dt,$r,qo(Jn,{brighter(t){return t=t==null?Di:Math.pow(Di,t),new dt(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?Qn:Math.pow(Qn,t),new dt(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new dt(fn(this.r),fn(this.g),fn(this.b),zi(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Xo,formatHex:Xo,formatHex8:tm,formatRgb:Jo,toString:Jo}));function Xo(){return`#${hn(this.r)}${hn(this.g)}${hn(this.b)}`}function tm(){return`#${hn(this.r)}${hn(this.g)}${hn(this.b)}${hn((isNaN(this.opacity)?1:this.opacity)*255)}`}function Jo(){const t=zi(this.opacity);return`${t===1?"rgb(":"rgba("}${fn(this.r)}, ${fn(this.g)}, ${fn(this.b)}${t===1?")":`, ${t})`}`}function zi(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function fn(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function hn(t){return t=fn(t),(t<16?"0":"")+t.toString(16)}function Qo(t,e,n,i){return i<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new Ot(t,e,n,i)}function Zo(t){if(t instanceof Ot)return new Ot(t.h,t.s,t.l,t.opacity);if(t instanceof Jn||(t=un(t)),!t)return new Ot;if(t instanceof Ot)return t;t=t.rgb();var e=t.r/255,n=t.g/255,i=t.b/255,r=Math.min(e,n,i),s=Math.max(e,n,i),o=NaN,l=s-r,a=(s+r)/2;return l?(e===s?o=(n-i)/l+(n<i)*6:n===s?o=(i-e)/l+2:o=(e-n)/l+4,l/=a<.5?s+r:2-s-r,o*=60):l=a>0&&a<1?0:o,new Ot(o,l,a,t.opacity)}function zr(t,e,n,i){return arguments.length===1?Zo(t):new Ot(t,e,n,i??1)}function Ot(t,e,n,i){this.h=+t,this.s=+e,this.l=+n,this.opacity=+i}Dr(Ot,zr,qo(Jn,{brighter(t){return t=t==null?Di:Math.pow(Di,t),new Ot(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?Qn:Math.pow(Qn,t),new Ot(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,i=n+(n<.5?n:1-n)*e,r=2*n-i;return new dt(jr(t>=240?t-240:t+120,r,i),jr(t,r,i),jr(t<120?t+240:t-120,r,i),this.opacity)},clamp(){return new Ot(el(this.h),ji(this.s),ji(this.l),zi(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=zi(this.opacity);return`${t===1?"hsl(":"hsla("}${el(this.h)}, ${ji(this.s)*100}%, ${ji(this.l)*100}%${t===1?")":`, ${t})`}`}}));function el(t){return t=(t||0)%360,t<0?t+360:t}function ji(t){return Math.max(0,Math.min(1,t||0))}function jr(t,e,n){return(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)*255}const Fr=t=>()=>t;function nm(t,e){return function(n){return t+n*e}}function im(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(i){return Math.pow(t+i*e,n)}}function rm(t){return(t=+t)==1?tl:function(e,n){return n-e?im(e,n,t):Fr(isNaN(e)?n:e)}}function tl(t,e){var n=e-t;return n?nm(t,n):Fr(isNaN(t)?e:t)}const Fi=function t(e){var n=rm(e);function i(r,s){var o=n((r=$r(r)).r,(s=$r(s)).r),l=n(r.g,s.g),a=n(r.b,s.b),c=tl(r.opacity,s.opacity);return function(u){return r.r=o(u),r.g=l(u),r.b=a(u),r.opacity=c(u),r+""}}return i.gamma=t,i}(1);function sm(t,e){e||(e=[]);var n=t?Math.min(e.length,t.length):0,i=e.slice(),r;return function(s){for(r=0;r<n;++r)i[r]=t[r]*(1-s)+e[r]*s;return i}}function om(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function lm(t,e){var n=e?e.length:0,i=t?Math.min(n,t.length):0,r=new Array(i),s=new Array(n),o;for(o=0;o<i;++o)r[o]=Ur(t[o],e[o]);for(;o<n;++o)s[o]=e[o];return function(l){for(o=0;o<i;++o)s[o]=r[o](l);return s}}function am(t,e){var n=new Date;return t=+t,e=+e,function(i){return n.setTime(t*(1-i)+e*i),n}}function Pt(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}function cm(t,e){var n={},i={},r;(t===null||typeof t!="object")&&(t={}),(e===null||typeof e!="object")&&(e={});for(r in e)r in t?n[r]=Ur(t[r],e[r]):i[r]=e[r];return function(s){for(r in n)i[r]=n[r](s);return i}}var Vr=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Hr=new RegExp(Vr.source,"g");function um(t){return function(){return t}}function fm(t){return function(e){return t(e)+""}}function nl(t,e){var n=Vr.lastIndex=Hr.lastIndex=0,i,r,s,o=-1,l=[],a=[];for(t=t+"",e=e+"";(i=Vr.exec(t))&&(r=Hr.exec(e));)(s=r.index)>n&&(s=e.slice(n,s),l[o]?l[o]+=s:l[++o]=s),(i=i[0])===(r=r[0])?l[o]?l[o]+=r:l[++o]=r:(l[++o]=null,a.push({i:o,x:Pt(i,r)})),n=Hr.lastIndex;return n<e.length&&(s=e.slice(n),l[o]?l[o]+=s:l[++o]=s),l.length<2?a[0]?fm(a[0].x):um(e):(e=a.length,function(c){for(var u=0,h;u<e;++u)l[(h=a[u]).i]=h.x(c);return l.join("")})}function Ur(t,e){var n=typeof e,i;return e==null||n==="boolean"?Fr(e):(n==="number"?Pt:n==="string"?(i=un(e))?(e=i,Fi):nl:e instanceof un?Fi:e instanceof Date?am:om(e)?sm:Array.isArray(e)?lm:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?cm:Pt)(t,e)}function hm(t,e){return t=+t,e=+e,function(n){return Math.round(t*(1-n)+e*n)}}var il=180/Math.PI,Br={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function rl(t,e,n,i,r,s){var o,l,a;return(o=Math.sqrt(t*t+e*e))&&(t/=o,e/=o),(a=t*n+e*i)&&(n-=t*a,i-=e*a),(l=Math.sqrt(n*n+i*i))&&(n/=l,i/=l,a/=l),t*i<e*n&&(t=-t,e=-e,a=-a,o=-o),{translateX:r,translateY:s,rotate:Math.atan2(e,t)*il,skewX:Math.atan(a)*il,scaleX:o,scaleY:l}}var Vi;function dm(t){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?Br:rl(e.a,e.b,e.c,e.d,e.e,e.f)}function mm(t){return t==null||(Vi||(Vi=document.createElementNS("http://www.w3.org/2000/svg","g")),Vi.setAttribute("transform",t),!(t=Vi.transform.baseVal.consolidate()))?Br:(t=t.matrix,rl(t.a,t.b,t.c,t.d,t.e,t.f))}function sl(t,e,n,i){function r(c){return c.length?c.pop()+" ":""}function s(c,u,h,f,d,m){if(c!==h||u!==f){var p=d.push("translate(",null,e,null,n);m.push({i:p-4,x:Pt(c,h)},{i:p-2,x:Pt(u,f)})}else(h||f)&&d.push("translate("+h+e+f+n)}function o(c,u,h,f){c!==u?(c-u>180?u+=360:u-c>180&&(c+=360),f.push({i:h.push(r(h)+"rotate(",null,i)-2,x:Pt(c,u)})):u&&h.push(r(h)+"rotate("+u+i)}function l(c,u,h,f){c!==u?f.push({i:h.push(r(h)+"skewX(",null,i)-2,x:Pt(c,u)}):u&&h.push(r(h)+"skewX("+u+i)}function a(c,u,h,f,d,m){if(c!==h||u!==f){var p=d.push(r(d)+"scale(",null,",",null,")");m.push({i:p-4,x:Pt(c,h)},{i:p-2,x:Pt(u,f)})}else(h!==1||f!==1)&&d.push(r(d)+"scale("+h+","+f+")")}return function(c,u){var h=[],f=[];return c=t(c),u=t(u),s(c.translateX,c.translateY,u.translateX,u.translateY,h,f),o(c.rotate,u.rotate,h,f),l(c.skewX,u.skewX,h,f),a(c.scaleX,c.scaleY,u.scaleX,u.scaleY,h,f),c=u=null,function(d){for(var m=-1,p=f.length,g;++m<p;)h[(g=f[m]).i]=g.x(d);return h.join("")}}}var pm=sl(dm,"px, ","px)","deg)"),gm=sl(mm,", ",")",")"),_m=1e-12;function ol(t){return((t=Math.exp(t))+1/t)/2}function vm(t){return((t=Math.exp(t))-1/t)/2}function ym(t){return((t=Math.exp(2*t))-1)/(t+1)}const bm=function t(e,n,i){function r(s,o){var l=s[0],a=s[1],c=s[2],u=o[0],h=o[1],f=o[2],d=u-l,m=h-a,p=d*d+m*m,g,_;if(p<_m)_=Math.log(f/c)/e,g=function(A){return[l+A*d,a+A*m,c*Math.exp(e*A*_)]};else{var S=Math.sqrt(p),C=(f*f-c*c+i*p)/(2*c*n*S),b=(f*f-c*c-i*p)/(2*f*n*S),k=Math.log(Math.sqrt(C*C+1)-C),P=Math.log(Math.sqrt(b*b+1)-b);_=(P-k)/e,g=function(A){var E=A*_,M=ol(k),D=c/(n*S)*(M*ym(e*E+k)-vm(k));return[l+D*d,a+D*m,c*M/ol(e*E+k)]}}return g.duration=_*1e3*e/Math.SQRT2,g}return r.rho=function(s){var o=Math.max(.001,+s),l=o*o,a=l*l;return t(o,l,a)},r}(Math.SQRT2,2,4);var On=0,ei=0,ti=0,ll=1e3,Hi,ni,Ui=0,dn=0,Bi=0,ii=typeof performance=="object"&&performance.now?performance:Date,al=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function qr(){return dn||(al(wm),dn=ii.now()+Bi)}function wm(){dn=0}function qi(){this._call=this._time=this._next=null}qi.prototype=Kr.prototype={constructor:qi,restart:function(t,e,n){if(typeof t!="function")throw new TypeError("callback is not a function");n=(n==null?qr():+n)+(e==null?0:+e),!this._next&&ni!==this&&(ni?ni._next=this:Hi=this,ni=this),this._call=t,this._time=n,Wr()},stop:function(){this._call&&(this._call=null,this._time=1/0,Wr())}};function Kr(t,e,n){var i=new qi;return i.restart(t,e,n),i}function Sm(){qr(),++On;for(var t=Hi,e;t;)(e=dn-t._time)>=0&&t._call.call(void 0,e),t=t._next;--On}function cl(){dn=(Ui=ii.now())+Bi,On=ei=0;try{Sm()}finally{On=0,Em(),dn=0}}function km(){var t=ii.now(),e=t-Ui;e>ll&&(Bi-=e,Ui=t)}function Em(){for(var t,e=Hi,n,i=1/0;e;)e._call?(i>e._time&&(i=e._time),t=e,e=e._next):(n=e._next,e._next=null,e=t?t._next=n:Hi=n);ni=t,Wr(i)}function Wr(t){if(!On){ei&&(ei=clearTimeout(ei));var e=t-dn;e>24?(t<1/0&&(ei=setTimeout(cl,t-ii.now()-Bi)),ti&&(ti=clearInterval(ti))):(ti||(Ui=ii.now(),ti=setInterval(km,ll)),On=1,al(cl))}}function ul(t,e,n){var i=new qi;return e=e==null?0:+e,i.restart(r=>{i.stop(),t(r+e)},e,n),i}var Cm=Gn("start","end","cancel","interrupt"),Im=[],fl=0,hl=1,Gr=2,Ki=3,dl=4,Yr=5,Wi=6;function Gi(t,e,n,i,r,s){var o=t.__transition;if(!o)t.__transition={};else if(n in o)return;Mm(t,n,{name:e,index:i,group:r,on:Cm,tween:Im,time:s.time,delay:s.delay,duration:s.duration,ease:s.ease,timer:null,state:fl})}function Xr(t,e){var n=Lt(t,e);if(n.state>fl)throw new Error("too late; already scheduled");return n}function jt(t,e){var n=Lt(t,e);if(n.state>Ki)throw new Error("too late; already running");return n}function Lt(t,e){var n=t.__transition;if(!n||!(n=n[e]))throw new Error("transition not found");return n}function Mm(t,e,n){var i=t.__transition,r;i[e]=n,n.timer=Kr(s,0,n.time);function s(c){n.state=hl,n.timer.restart(o,n.delay,n.time),n.delay<=c&&o(c-n.delay)}function o(c){var u,h,f,d;if(n.state!==hl)return a();for(u in i)if(d=i[u],d.name===n.name){if(d.state===Ki)return ul(o);d.state===dl?(d.state=Wi,d.timer.stop(),d.on.call("interrupt",t,t.__data__,d.index,d.group),delete i[u]):+u<e&&(d.state=Wi,d.timer.stop(),d.on.call("cancel",t,t.__data__,d.index,d.group),delete i[u])}if(ul(function(){n.state===Ki&&(n.state=dl,n.timer.restart(l,n.delay,n.time),l(c))}),n.state=Gr,n.on.call("start",t,t.__data__,n.index,n.group),n.state===Gr){for(n.state=Ki,r=new Array(f=n.tween.length),u=0,h=-1;u<f;++u)(d=n.tween[u].value.call(t,t.__data__,n.index,n.group))&&(r[++h]=d);r.length=h+1}}function l(c){for(var u=c<n.duration?n.ease.call(null,c/n.duration):(n.timer.restart(a),n.state=Yr,1),h=-1,f=r.length;++h<f;)r[h].call(t,u);n.state===Yr&&(n.on.call("end",t,t.__data__,n.index,n.group),a())}function a(){n.state=Wi,n.timer.stop(),delete i[e];for(var c in i)return;delete t.__transition}}function Yi(t,e){var n=t.__transition,i,r,s=!0,o;if(n){e=e==null?null:e+"";for(o in n){if((i=n[o]).name!==e){s=!1;continue}r=i.state>Gr&&i.state<Yr,i.state=Wi,i.timer.stop(),i.on.call(r?"interrupt":"cancel",t,t.__data__,i.index,i.group),delete n[o]}s&&delete t.__transition}}function xm(t){return this.each(function(){Yi(this,t)})}function Am(t,e){var n,i;return function(){var r=jt(this,t),s=r.tween;if(s!==n){i=n=s;for(var o=0,l=i.length;o<l;++o)if(i[o].name===e){i=i.slice(),i.splice(o,1);break}}r.tween=i}}function Tm(t,e,n){var i,r;if(typeof n!="function")throw new Error;return function(){var s=jt(this,t),o=s.tween;if(o!==i){r=(i=o).slice();for(var l={name:e,value:n},a=0,c=r.length;a<c;++a)if(r[a].name===e){r[a]=l;break}a===c&&r.push(l)}s.tween=r}}function Nm(t,e){var n=this._id;if(t+="",arguments.length<2){for(var i=Lt(this.node(),n).tween,r=0,s=i.length,o;r<s;++r)if((o=i[r]).name===t)return o.value;return null}return this.each((e==null?Am:Tm)(n,t,e))}function Jr(t,e,n){var i=t._id;return t.each(function(){var r=jt(this,i);(r.value||(r.value={}))[e]=n.apply(this,arguments)}),function(r){return Lt(r,i).value[e]}}function ml(t,e){var n;return(typeof e=="number"?Pt:e instanceof un?Fi:(n=un(e))?(e=n,Fi):nl)(t,e)}function Om(t){return function(){this.removeAttribute(t)}}function Pm(t){return function(){this.removeAttributeNS(t.space,t.local)}}function Lm(t,e,n){var i,r=n+"",s;return function(){var o=this.getAttribute(t);return o===r?null:o===i?s:s=e(i=o,n)}}function Rm(t,e,n){var i,r=n+"",s;return function(){var o=this.getAttributeNS(t.space,t.local);return o===r?null:o===i?s:s=e(i=o,n)}}function Dm(t,e,n){var i,r,s;return function(){var o,l=n(this),a;return l==null?void this.removeAttribute(t):(o=this.getAttribute(t),a=l+"",o===a?null:o===i&&a===r?s:(r=a,s=e(i=o,l)))}}function $m(t,e,n){var i,r,s;return function(){var o,l=n(this),a;return l==null?void this.removeAttributeNS(t.space,t.local):(o=this.getAttributeNS(t.space,t.local),a=l+"",o===a?null:o===i&&a===r?s:(r=a,s=e(i=o,l)))}}function zm(t,e){var n=Pi(t),i=n==="transform"?gm:ml;return this.attrTween(t,typeof e=="function"?(n.local?$m:Dm)(n,i,Jr(this,"attr."+t,e)):e==null?(n.local?Pm:Om)(n):(n.local?Rm:Lm)(n,i,e))}function jm(t,e){return function(n){this.setAttribute(t,e.call(this,n))}}function Fm(t,e){return function(n){this.setAttributeNS(t.space,t.local,e.call(this,n))}}function Vm(t,e){var n,i;function r(){var s=e.apply(this,arguments);return s!==i&&(n=(i=s)&&Fm(t,s)),n}return r._value=e,r}function Hm(t,e){var n,i;function r(){var s=e.apply(this,arguments);return s!==i&&(n=(i=s)&&jm(t,s)),n}return r._value=e,r}function Um(t,e){var n="attr."+t;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(e==null)return this.tween(n,null);if(typeof e!="function")throw new Error;var i=Pi(t);return this.tween(n,(i.local?Vm:Hm)(i,e))}function Bm(t,e){return function(){Xr(this,t).delay=+e.apply(this,arguments)}}function qm(t,e){return e=+e,function(){Xr(this,t).delay=e}}function Km(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?Bm:qm)(e,t)):Lt(this.node(),e).delay}function Wm(t,e){return function(){jt(this,t).duration=+e.apply(this,arguments)}}function Gm(t,e){return e=+e,function(){jt(this,t).duration=e}}function Ym(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?Wm:Gm)(e,t)):Lt(this.node(),e).duration}function Xm(t,e){if(typeof e!="function")throw new Error;return function(){jt(this,t).ease=e}}function Jm(t){var e=this._id;return arguments.length?this.each(Xm(e,t)):Lt(this.node(),e).ease}function Qm(t,e){return function(){var n=e.apply(this,arguments);if(typeof n!="function")throw new Error;jt(this,t).ease=n}}function Zm(t){if(typeof t!="function")throw new Error;return this.each(Qm(this._id,t))}function ep(t){typeof t!="function"&&(t=Po(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var s=e[r],o=s.length,l=i[r]=[],a,c=0;c<o;++c)(a=s[c])&&t.call(a,a.__data__,c,s)&&l.push(a);return new Wt(i,this._parents,this._name,this._id)}function tp(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,n=t._groups,i=e.length,r=n.length,s=Math.min(i,r),o=new Array(i),l=0;l<s;++l)for(var a=e[l],c=n[l],u=a.length,h=o[l]=new Array(u),f,d=0;d<u;++d)(f=a[d]||c[d])&&(h[d]=f);for(;l<i;++l)o[l]=e[l];return new Wt(o,this._parents,this._name,this._id)}function np(t){return(t+"").trim().split(/^|\s+/).every(function(e){var n=e.indexOf(".");return n>=0&&(e=e.slice(0,n)),!e||e==="start"})}function ip(t,e,n){var i,r,s=np(e)?Xr:jt;return function(){var o=s(this,t),l=o.on;l!==i&&(r=(i=l).copy()).on(e,n),o.on=r}}function rp(t,e){var n=this._id;return arguments.length<2?Lt(this.node(),n).on.on(t):this.each(ip(n,t,e))}function sp(t){return function(){var e=this.parentNode;for(var n in this.__transition)if(+n!==t)return;e&&e.removeChild(this)}}function op(){return this.on("end.remove",sp(this._id))}function lp(t){var e=this._name,n=this._id;typeof t!="function"&&(t=Or(t));for(var i=this._groups,r=i.length,s=new Array(r),o=0;o<r;++o)for(var l=i[o],a=l.length,c=s[o]=new Array(a),u,h,f=0;f<a;++f)(u=l[f])&&(h=t.call(u,u.__data__,f,l))&&("__data__"in u&&(h.__data__=u.__data__),c[f]=h,Gi(c[f],e,n,f,c,Lt(u,n)));return new Wt(s,this._parents,e,n)}function ap(t){var e=this._name,n=this._id;typeof t!="function"&&(t=Oo(t));for(var i=this._groups,r=i.length,s=[],o=[],l=0;l<r;++l)for(var a=i[l],c=a.length,u,h=0;h<c;++h)if(u=a[h]){for(var f=t.call(u,u.__data__,h,a),d,m=Lt(u,n),p=0,g=f.length;p<g;++p)(d=f[p])&&Gi(d,e,n,p,f,m);s.push(f),o.push(u)}return new Wt(s,o,e,n)}var cp=Yn.prototype.constructor;function up(){return new cp(this._groups,this._parents)}function fp(t,e){var n,i,r;return function(){var s=An(this,t),o=(this.style.removeProperty(t),An(this,t));return s===o?null:s===n&&o===i?r:r=e(n=s,i=o)}}function pl(t){return function(){this.style.removeProperty(t)}}function hp(t,e,n){var i,r=n+"",s;return function(){var o=An(this,t);return o===r?null:o===i?s:s=e(i=o,n)}}function dp(t,e,n){var i,r,s;return function(){var o=An(this,t),l=n(this),a=l+"";return l==null&&(a=l=(this.style.removeProperty(t),An(this,t))),o===a?null:o===i&&a===r?s:(r=a,s=e(i=o,l))}}function mp(t,e){var n,i,r,s="style."+e,o="end."+s,l;return function(){var a=jt(this,t),c=a.on,u=a.value[s]==null?l||(l=pl(e)):void 0;(c!==n||r!==u)&&(i=(n=c).copy()).on(o,r=u),a.on=i}}function pp(t,e,n){var i=(t+="")=="transform"?pm:ml;return e==null?this.styleTween(t,fp(t,i)).on("end.style."+t,pl(t)):typeof e=="function"?this.styleTween(t,dp(t,i,Jr(this,"style."+t,e))).each(mp(this._id,t)):this.styleTween(t,hp(t,i,e),n).on("end.style."+t,null)}function gp(t,e,n){return function(i){this.style.setProperty(t,e.call(this,i),n)}}function _p(t,e,n){var i,r;function s(){var o=e.apply(this,arguments);return o!==r&&(i=(r=o)&&gp(t,o,n)),i}return s._value=e,s}function vp(t,e,n){var i="style."+(t+="");if(arguments.length<2)return(i=this.tween(i))&&i._value;if(e==null)return this.tween(i,null);if(typeof e!="function")throw new Error;return this.tween(i,_p(t,e,n??""))}function yp(t){return function(){this.textContent=t}}function bp(t){return function(){var e=t(this);this.textContent=e??""}}function wp(t){return this.tween("text",typeof t=="function"?bp(Jr(this,"text",t)):yp(t==null?"":t+""))}function Sp(t){return function(e){this.textContent=t.call(this,e)}}function kp(t){var e,n;function i(){var r=t.apply(this,arguments);return r!==n&&(e=(n=r)&&Sp(r)),e}return i._value=t,i}function Ep(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(t==null)return this.tween(e,null);if(typeof t!="function")throw new Error;return this.tween(e,kp(t))}function Cp(){for(var t=this._name,e=this._id,n=gl(),i=this._groups,r=i.length,s=0;s<r;++s)for(var o=i[s],l=o.length,a,c=0;c<l;++c)if(a=o[c]){var u=Lt(a,e);Gi(a,t,n,c,o,{time:u.time+u.delay+u.duration,delay:0,duration:u.duration,ease:u.ease})}return new Wt(i,this._parents,t,n)}function Ip(){var t,e,n=this,i=n._id,r=n.size();return new Promise(function(s,o){var l={value:o},a={value:function(){--r===0&&s()}};n.each(function(){var c=jt(this,i),u=c.on;u!==t&&(e=(t=u).copy(),e._.cancel.push(l),e._.interrupt.push(l),e._.end.push(a)),c.on=e}),r===0&&s()})}var Mp=0;function Wt(t,e,n,i){this._groups=t,this._parents=e,this._name=n,this._id=i}function gl(){return++Mp}var Gt=Yn.prototype;Wt.prototype={constructor:Wt,select:lp,selectAll:ap,selectChild:Gt.selectChild,selectChildren:Gt.selectChildren,filter:ep,merge:tp,selection:up,transition:Cp,call:Gt.call,nodes:Gt.nodes,node:Gt.node,size:Gt.size,empty:Gt.empty,each:Gt.each,on:rp,attr:zm,attrTween:Um,style:pp,styleTween:vp,text:wp,textTween:Ep,remove:op,tween:Nm,delay:Km,duration:Ym,ease:Jm,easeVarying:Zm,end:Ip,[Symbol.iterator]:Gt[Symbol.iterator]};function xp(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}var Ap={time:null,delay:0,duration:250,ease:xp};function Tp(t,e){for(var n;!(n=t.__transition)||!(n=n[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return n}function Np(t){var e,n;t instanceof Wt?(e=t._id,t=t._name):(e=gl(),(n=Ap).time=qr(),t=t==null?null:t+"");for(var i=this._groups,r=i.length,s=0;s<r;++s)for(var o=i[s],l=o.length,a,c=0;c<l;++c)(a=o[c])&&Gi(a,t,e,c,o,n||Tp(a,e));return new Wt(i,this._parents,t,e)}Yn.prototype.interrupt=xm,Yn.prototype.transition=Np;function _l(t,e){var n,i=1;t==null&&(t=0),e==null&&(e=0);function r(){var s,o=n.length,l,a=0,c=0;for(s=0;s<o;++s)l=n[s],a+=l.x,c+=l.y;for(a=(a/o-t)*i,c=(c/o-e)*i,s=0;s<o;++s)l=n[s],l.x-=a,l.y-=c}return r.initialize=function(s){n=s},r.x=function(s){return arguments.length?(t=+s,r):t},r.y=function(s){return arguments.length?(e=+s,r):e},r.strength=function(s){return arguments.length?(i=+s,r):i},r}function Op(t){const e=+this._x.call(null,t),n=+this._y.call(null,t);return vl(this.cover(e,n),e,n,t)}function vl(t,e,n,i){if(isNaN(e)||isNaN(n))return t;var r,s=t._root,o={data:i},l=t._x0,a=t._y0,c=t._x1,u=t._y1,h,f,d,m,p,g,_,S;if(!s)return t._root=o,t;for(;s.length;)if((p=e>=(h=(l+c)/2))?l=h:c=h,(g=n>=(f=(a+u)/2))?a=f:u=f,r=s,!(s=s[_=g<<1|p]))return r[_]=o,t;if(d=+t._x.call(null,s.data),m=+t._y.call(null,s.data),e===d&&n===m)return o.next=s,r?r[_]=o:t._root=o,t;do r=r?r[_]=new Array(4):t._root=new Array(4),(p=e>=(h=(l+c)/2))?l=h:c=h,(g=n>=(f=(a+u)/2))?a=f:u=f;while((_=g<<1|p)===(S=(m>=f)<<1|d>=h));return r[S]=s,r[_]=o,t}function Pp(t){var e,n,i=t.length,r,s,o=new Array(i),l=new Array(i),a=1/0,c=1/0,u=-1/0,h=-1/0;for(n=0;n<i;++n)isNaN(r=+this._x.call(null,e=t[n]))||isNaN(s=+this._y.call(null,e))||(o[n]=r,l[n]=s,r<a&&(a=r),r>u&&(u=r),s<c&&(c=s),s>h&&(h=s));if(a>u||c>h)return this;for(this.cover(a,c).cover(u,h),n=0;n<i;++n)vl(this,o[n],l[n],t[n]);return this}function Lp(t,e){if(isNaN(t=+t)||isNaN(e=+e))return this;var n=this._x0,i=this._y0,r=this._x1,s=this._y1;if(isNaN(n))r=(n=Math.floor(t))+1,s=(i=Math.floor(e))+1;else{for(var o=r-n||1,l=this._root,a,c;n>t||t>=r||i>e||e>=s;)switch(c=(e<i)<<1|t<n,a=new Array(4),a[c]=l,l=a,o*=2,c){case 0:r=n+o,s=i+o;break;case 1:n=r-o,s=i+o;break;case 2:r=n+o,i=s-o;break;case 3:n=r-o,i=s-o;break}this._root&&this._root.length&&(this._root=l)}return this._x0=n,this._y0=i,this._x1=r,this._y1=s,this}function Rp(){var t=[];return this.visit(function(e){if(!e.length)do t.push(e.data);while(e=e.next)}),t}function Dp(t){return arguments.length?this.cover(+t[0][0],+t[0][1]).cover(+t[1][0],+t[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function st(t,e,n,i,r){this.node=t,this.x0=e,this.y0=n,this.x1=i,this.y1=r}function $p(t,e,n){var i,r=this._x0,s=this._y0,o,l,a,c,u=this._x1,h=this._y1,f=[],d=this._root,m,p;for(d&&f.push(new st(d,r,s,u,h)),n==null?n=1/0:(r=t-n,s=e-n,u=t+n,h=e+n,n*=n);m=f.pop();)if(!(!(d=m.node)||(o=m.x0)>u||(l=m.y0)>h||(a=m.x1)<r||(c=m.y1)<s))if(d.length){var g=(o+a)/2,_=(l+c)/2;f.push(new st(d[3],g,_,a,c),new st(d[2],o,_,g,c),new st(d[1],g,l,a,_),new st(d[0],o,l,g,_)),(p=(e>=_)<<1|t>=g)&&(m=f[f.length-1],f[f.length-1]=f[f.length-1-p],f[f.length-1-p]=m)}else{var S=t-+this._x.call(null,d.data),C=e-+this._y.call(null,d.data),b=S*S+C*C;if(b<n){var k=Math.sqrt(n=b);r=t-k,s=e-k,u=t+k,h=e+k,i=d.data}}return i}function zp(t){if(isNaN(u=+this._x.call(null,t))||isNaN(h=+this._y.call(null,t)))return this;var e,n=this._root,i,r,s,o=this._x0,l=this._y0,a=this._x1,c=this._y1,u,h,f,d,m,p,g,_;if(!n)return this;if(n.length)for(;;){if((m=u>=(f=(o+a)/2))?o=f:a=f,(p=h>=(d=(l+c)/2))?l=d:c=d,e=n,!(n=n[g=p<<1|m]))return this;if(!n.length)break;(e[g+1&3]||e[g+2&3]||e[g+3&3])&&(i=e,_=g)}for(;n.data!==t;)if(r=n,!(n=n.next))return this;return(s=n.next)&&delete n.next,r?(s?r.next=s:delete r.next,this):e?(s?e[g]=s:delete e[g],(n=e[0]||e[1]||e[2]||e[3])&&n===(e[3]||e[2]||e[1]||e[0])&&!n.length&&(i?i[_]=n:this._root=n),this):(this._root=s,this)}function jp(t){for(var e=0,n=t.length;e<n;++e)this.remove(t[e]);return this}function Fp(){return this._root}function Vp(){var t=0;return this.visit(function(e){if(!e.length)do++t;while(e=e.next)}),t}function Hp(t){var e=[],n,i=this._root,r,s,o,l,a;for(i&&e.push(new st(i,this._x0,this._y0,this._x1,this._y1));n=e.pop();)if(!t(i=n.node,s=n.x0,o=n.y0,l=n.x1,a=n.y1)&&i.length){var c=(s+l)/2,u=(o+a)/2;(r=i[3])&&e.push(new st(r,c,u,l,a)),(r=i[2])&&e.push(new st(r,s,u,c,a)),(r=i[1])&&e.push(new st(r,c,o,l,u)),(r=i[0])&&e.push(new st(r,s,o,c,u))}return this}function Up(t){var e=[],n=[],i;for(this._root&&e.push(new st(this._root,this._x0,this._y0,this._x1,this._y1));i=e.pop();){var r=i.node;if(r.length){var s,o=i.x0,l=i.y0,a=i.x1,c=i.y1,u=(o+a)/2,h=(l+c)/2;(s=r[0])&&e.push(new st(s,o,l,u,h)),(s=r[1])&&e.push(new st(s,u,l,a,h)),(s=r[2])&&e.push(new st(s,o,h,u,c)),(s=r[3])&&e.push(new st(s,u,h,a,c))}n.push(i)}for(;i=n.pop();)t(i.node,i.x0,i.y0,i.x1,i.y1);return this}function Bp(t){return t[0]}function qp(t){return arguments.length?(this._x=t,this):this._x}function Kp(t){return t[1]}function Wp(t){return arguments.length?(this._y=t,this):this._y}function Qr(t,e,n){var i=new Zr(e??Bp,n??Kp,NaN,NaN,NaN,NaN);return t==null?i:i.addAll(t)}function Zr(t,e,n,i,r,s){this._x=t,this._y=e,this._x0=n,this._y0=i,this._x1=r,this._y1=s,this._root=void 0}function yl(t){for(var e={data:t.data},n=e;t=t.next;)n=n.next={data:t.data};return e}var ot=Qr.prototype=Zr.prototype;ot.copy=function(){var t=new Zr(this._x,this._y,this._x0,this._y0,this._x1,this._y1),e=this._root,n,i;if(!e)return t;if(!e.length)return t._root=yl(e),t;for(n=[{source:e,target:t._root=new Array(4)}];e=n.pop();)for(var r=0;r<4;++r)(i=e.source[r])&&(i.length?n.push({source:i,target:e.target[r]=new Array(4)}):e.target[r]=yl(i));return t},ot.add=Op,ot.addAll=Pp,ot.cover=Lp,ot.data=Rp,ot.extent=Dp,ot.find=$p,ot.remove=zp,ot.removeAll=jp,ot.root=Fp,ot.size=Vp,ot.visit=Hp,ot.visitAfter=Up,ot.x=qp,ot.y=Wp;function lt(t){return function(){return t}}function rn(t){return(t()-.5)*1e-6}function Gp(t){return t.x+t.vx}function Yp(t){return t.y+t.vy}function bl(t){var e,n,i,r=1,s=1;typeof t!="function"&&(t=lt(t==null?1:+t));function o(){for(var c,u=e.length,h,f,d,m,p,g,_=0;_<s;++_)for(h=Qr(e,Gp,Yp).visitAfter(l),c=0;c<u;++c)f=e[c],p=n[f.index],g=p*p,d=f.x+f.vx,m=f.y+f.vy,h.visit(S);function S(C,b,k,P,A){var E=C.data,M=C.r,D=p+M;if(E){if(E.index>f.index){var $=d-E.x-E.vx,R=m-E.y-E.vy,z=$*$+R*R;z<D*D&&($===0&&($=rn(i),z+=$*$),R===0&&(R=rn(i),z+=R*R),z=(D-(z=Math.sqrt(z)))/z*r,f.vx+=($*=z)*(D=(M*=M)/(g+M)),f.vy+=(R*=z)*D,E.vx-=$*(D=1-D),E.vy-=R*D)}return}return b>d+D||P<d-D||k>m+D||A<m-D}}function l(c){if(c.data)return c.r=n[c.data.index];for(var u=c.r=0;u<4;++u)c[u]&&c[u].r>c.r&&(c.r=c[u].r)}function a(){if(e){var c,u=e.length,h;for(n=new Array(u),c=0;c<u;++c)h=e[c],n[h.index]=+t(h,c,e)}}return o.initialize=function(c,u){e=c,i=u,a()},o.iterations=function(c){return arguments.length?(s=+c,o):s},o.strength=function(c){return arguments.length?(r=+c,o):r},o.radius=function(c){return arguments.length?(t=typeof c=="function"?c:lt(+c),a(),o):t},o}function Xp(t){return t.index}function wl(t,e){var n=t.get(e);if(!n)throw new Error("node not found: "+e);return n}function Sl(t){var e=Xp,n=h,i,r=lt(30),s,o,l,a,c,u=1;t==null&&(t=[]);function h(g){return 1/Math.min(l[g.source.index],l[g.target.index])}function f(g){for(var _=0,S=t.length;_<u;++_)for(var C=0,b,k,P,A,E,M,D;C<S;++C)b=t[C],k=b.source,P=b.target,A=P.x+P.vx-k.x-k.vx||rn(c),E=P.y+P.vy-k.y-k.vy||rn(c),M=Math.sqrt(A*A+E*E),M=(M-s[C])/M*g*i[C],A*=M,E*=M,P.vx-=A*(D=a[C]),P.vy-=E*D,k.vx+=A*(D=1-D),k.vy+=E*D}function d(){if(o){var g,_=o.length,S=t.length,C=new Map(o.map((k,P)=>[e(k,P,o),k])),b;for(g=0,l=new Array(_);g<S;++g)b=t[g],b.index=g,typeof b.source!="object"&&(b.source=wl(C,b.source)),typeof b.target!="object"&&(b.target=wl(C,b.target)),l[b.source.index]=(l[b.source.index]||0)+1,l[b.target.index]=(l[b.target.index]||0)+1;for(g=0,a=new Array(S);g<S;++g)b=t[g],a[g]=l[b.source.index]/(l[b.source.index]+l[b.target.index]);i=new Array(S),m(),s=new Array(S),p()}}function m(){if(o)for(var g=0,_=t.length;g<_;++g)i[g]=+n(t[g],g,t)}function p(){if(o)for(var g=0,_=t.length;g<_;++g)s[g]=+r(t[g],g,t)}return f.initialize=function(g,_){o=g,c=_,d()},f.links=function(g){return arguments.length?(t=g,d(),f):t},f.id=function(g){return arguments.length?(e=g,f):e},f.iterations=function(g){return arguments.length?(u=+g,f):u},f.strength=function(g){return arguments.length?(n=typeof g=="function"?g:lt(+g),m(),f):n},f.distance=function(g){return arguments.length?(r=typeof g=="function"?g:lt(+g),p(),f):r},f}const Jp=1664525,Qp=1013904223,kl=4294967296;function Zp(){let t=1;return()=>(t=(Jp*t+Qp)%kl)/kl}function eg(t){return t.x}function tg(t){return t.y}var ng=10,ig=Math.PI*(3-Math.sqrt(5));function El(t){var e,n=1,i=.001,r=1-Math.pow(i,1/300),s=0,o=.6,l=new Map,a=Kr(h),c=Gn("tick","end"),u=Zp();t==null&&(t=[]);function h(){f(),c.call("tick",e),n<i&&(a.stop(),c.call("end",e))}function f(p){var g,_=t.length,S;p===void 0&&(p=1);for(var C=0;C<p;++C)for(n+=(s-n)*r,l.forEach(function(b){b(n)}),g=0;g<_;++g)S=t[g],S.fx==null?S.x+=S.vx*=o:(S.x=S.fx,S.vx=0),S.fy==null?S.y+=S.vy*=o:(S.y=S.fy,S.vy=0);return e}function d(){for(var p=0,g=t.length,_;p<g;++p){if(_=t[p],_.index=p,_.fx!=null&&(_.x=_.fx),_.fy!=null&&(_.y=_.fy),isNaN(_.x)||isNaN(_.y)){var S=ng*Math.sqrt(.5+p),C=p*ig;_.x=S*Math.cos(C),_.y=S*Math.sin(C)}(isNaN(_.vx)||isNaN(_.vy))&&(_.vx=_.vy=0)}}function m(p){return p.initialize&&p.initialize(t,u),p}return d(),e={tick:f,restart:function(){return a.restart(h),e},stop:function(){return a.stop(),e},nodes:function(p){return arguments.length?(t=p,d(),l.forEach(m),e):t},alpha:function(p){return arguments.length?(n=+p,e):n},alphaMin:function(p){return arguments.length?(i=+p,e):i},alphaDecay:function(p){return arguments.length?(r=+p,e):+r},alphaTarget:function(p){return arguments.length?(s=+p,e):s},velocityDecay:function(p){return arguments.length?(o=1-p,e):1-o},randomSource:function(p){return arguments.length?(u=p,l.forEach(m),e):u},force:function(p,g){return arguments.length>1?(g==null?l.delete(p):l.set(p,m(g)),e):l.get(p)},find:function(p,g,_){var S=0,C=t.length,b,k,P,A,E;for(_==null?_=1/0:_*=_,S=0;S<C;++S)A=t[S],b=p-A.x,k=g-A.y,P=b*b+k*k,P<_&&(E=A,_=P);return E},on:function(p,g){return arguments.length>1?(c.on(p,g),e):c.on(p)}}}function Cl(){var t,e,n,i,r=lt(-30),s,o=1,l=1/0,a=.81;function c(d){var m,p=t.length,g=Qr(t,eg,tg).visitAfter(h);for(i=d,m=0;m<p;++m)e=t[m],g.visit(f)}function u(){if(t){var d,m=t.length,p;for(s=new Array(m),d=0;d<m;++d)p=t[d],s[p.index]=+r(p,d,t)}}function h(d){var m=0,p,g,_=0,S,C,b;if(d.length){for(S=C=b=0;b<4;++b)(p=d[b])&&(g=Math.abs(p.value))&&(m+=p.value,_+=g,S+=g*p.x,C+=g*p.y);d.x=S/_,d.y=C/_}else{p=d,p.x=p.data.x,p.y=p.data.y;do m+=s[p.data.index];while(p=p.next)}d.value=m}function f(d,m,p,g){if(!d.value)return!0;var _=d.x-e.x,S=d.y-e.y,C=g-m,b=_*_+S*S;if(C*C/a<b)return b<l&&(_===0&&(_=rn(n),b+=_*_),S===0&&(S=rn(n),b+=S*S),b<o&&(b=Math.sqrt(o*b)),e.vx+=_*d.value*i/b,e.vy+=S*d.value*i/b),!0;if(d.length||b>=l)return;(d.data!==e||d.next)&&(_===0&&(_=rn(n),b+=_*_),S===0&&(S=rn(n),b+=S*S),b<o&&(b=Math.sqrt(o*b)));do d.data!==e&&(C=s[d.data.index]*i/b,e.vx+=_*C,e.vy+=S*C);while(d=d.next)}return c.initialize=function(d,m){t=d,n=m,u()},c.strength=function(d){return arguments.length?(r=typeof d=="function"?d:lt(+d),u(),c):r},c.distanceMin=function(d){return arguments.length?(o=d*d,c):Math.sqrt(o)},c.distanceMax=function(d){return arguments.length?(l=d*d,c):Math.sqrt(l)},c.theta=function(d){return arguments.length?(a=d*d,c):Math.sqrt(a)},c}function Il(t){var e=lt(.1),n,i,r;typeof t!="function"&&(t=lt(t==null?0:+t));function s(l){for(var a=0,c=n.length,u;a<c;++a)u=n[a],u.vx+=(r[a]-u.x)*i[a]*l}function o(){if(n){var l,a=n.length;for(i=new Array(a),r=new Array(a),l=0;l<a;++l)i[l]=isNaN(r[l]=+t(n[l],l,n))?0:+e(n[l],l,n)}}return s.initialize=function(l){n=l,o()},s.strength=function(l){return arguments.length?(e=typeof l=="function"?l:lt(+l),o(),s):e},s.x=function(l){return arguments.length?(t=typeof l=="function"?l:lt(+l),o(),s):t},s}function Ml(t){var e=lt(.1),n,i,r;typeof t!="function"&&(t=lt(t==null?0:+t));function s(l){for(var a=0,c=n.length,u;a<c;++a)u=n[a],u.vy+=(r[a]-u.y)*i[a]*l}function o(){if(n){var l,a=n.length;for(i=new Array(a),r=new Array(a),l=0;l<a;++l)i[l]=isNaN(r[l]=+t(n[l],l,n))?0:+e(n[l],l,n)}}return s.initialize=function(l){n=l,o()},s.strength=function(l){return arguments.length?(e=typeof l=="function"?l:lt(+l),o(),s):e},s.y=function(l){return arguments.length?(t=typeof l=="function"?l:lt(+l),o(),s):t},s}function rg(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)}function Xi(t,e){if((n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var n,i=t.slice(0,n);return[i.length>1?i[0]+i.slice(2):i,+t.slice(n+1)]}function Pn(t){return t=Xi(Math.abs(t)),t?t[1]:NaN}function sg(t,e){return function(n,i){for(var r=n.length,s=[],o=0,l=t[0],a=0;r>0&&l>0&&(a+l+1>i&&(l=Math.max(1,i-a)),s.push(n.substring(r-=l,r+l)),!((a+=l+1)>i));)l=t[o=(o+1)%t.length];return s.reverse().join(e)}}function og(t){return function(e){return e.replace(/[0-9]/g,function(n){return t[+n]})}}var lg=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Ji(t){if(!(e=lg.exec(t)))throw new Error("invalid format: "+t);var e;return new es({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}Ji.prototype=es.prototype;function es(t){this.fill=t.fill===void 0?" ":t.fill+"",this.align=t.align===void 0?">":t.align+"",this.sign=t.sign===void 0?"-":t.sign+"",this.symbol=t.symbol===void 0?"":t.symbol+"",this.zero=!!t.zero,this.width=t.width===void 0?void 0:+t.width,this.comma=!!t.comma,this.precision=t.precision===void 0?void 0:+t.precision,this.trim=!!t.trim,this.type=t.type===void 0?"":t.type+""}es.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function ag(t){e:for(var e=t.length,n=1,i=-1,r;n<e;++n)switch(t[n]){case".":i=r=n;break;case"0":i===0&&(i=n),r=n;break;default:if(!+t[n])break e;i>0&&(i=0);break}return i>0?t.slice(0,i)+t.slice(r+1):t}var xl;function cg(t,e){var n=Xi(t,e);if(!n)return t+"";var i=n[0],r=n[1],s=r-(xl=Math.max(-8,Math.min(8,Math.floor(r/3)))*3)+1,o=i.length;return s===o?i:s>o?i+new Array(s-o+1).join("0"):s>0?i.slice(0,s)+"."+i.slice(s):"0."+new Array(1-s).join("0")+Xi(t,Math.max(0,e+s-1))[0]}function Al(t,e){var n=Xi(t,e);if(!n)return t+"";var i=n[0],r=n[1];return r<0?"0."+new Array(-r).join("0")+i:i.length>r+1?i.slice(0,r+1)+"."+i.slice(r+1):i+new Array(r-i.length+2).join("0")}const Tl={"%":(t,e)=>(t*100).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:rg,e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>Al(t*100,e),r:Al,s:cg,X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function Nl(t){return t}var Ol=Array.prototype.map,Pl=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function ug(t){var e=t.grouping===void 0||t.thousands===void 0?Nl:sg(Ol.call(t.grouping,Number),t.thousands+""),n=t.currency===void 0?"":t.currency[0]+"",i=t.currency===void 0?"":t.currency[1]+"",r=t.decimal===void 0?".":t.decimal+"",s=t.numerals===void 0?Nl:og(Ol.call(t.numerals,String)),o=t.percent===void 0?"%":t.percent+"",l=t.minus===void 0?"−":t.minus+"",a=t.nan===void 0?"NaN":t.nan+"";function c(h){h=Ji(h);var f=h.fill,d=h.align,m=h.sign,p=h.symbol,g=h.zero,_=h.width,S=h.comma,C=h.precision,b=h.trim,k=h.type;k==="n"?(S=!0,k="g"):Tl[k]||(C===void 0&&(C=12),b=!0,k="g"),(g||f==="0"&&d==="=")&&(g=!0,f="0",d="=");var P=p==="$"?n:p==="#"&&/[boxX]/.test(k)?"0"+k.toLowerCase():"",A=p==="$"?i:/[%p]/.test(k)?o:"",E=Tl[k],M=/[defgprs%]/.test(k);C=C===void 0?6:/[gprs]/.test(k)?Math.max(1,Math.min(21,C)):Math.max(0,Math.min(20,C));function D($){var R=P,z=A,I,N,x;if(k==="c")z=E($)+z,$="";else{$=+$;var L=$<0||1/$<0;if($=isNaN($)?a:E(Math.abs($),C),b&&($=ag($)),L&&+$==0&&m!=="+"&&(L=!1),R=(L?m==="("?m:l:m==="-"||m==="("?"":m)+R,z=(k==="s"?Pl[8+xl/3]:"")+z+(L&&m==="("?")":""),M){for(I=-1,N=$.length;++I<N;)if(x=$.charCodeAt(I),48>x||x>57){z=(x===46?r+$.slice(I+1):$.slice(I))+z,$=$.slice(0,I);break}}}S&&!g&&($=e($,1/0));var B=R.length+$.length+z.length,U=B<_?new Array(_-B+1).join(f):"";switch(S&&g&&($=e(U+$,U.length?_-z.length:1/0),U=""),d){case"<":$=R+$+z+U;break;case"=":$=R+U+$+z;break;case"^":$=U.slice(0,B=U.length>>1)+R+$+z+U.slice(B);break;default:$=U+R+$+z;break}return s($)}return D.toString=function(){return h+""},D}function u(h,f){var d=c((h=Ji(h),h.type="f",h)),m=Math.max(-8,Math.min(8,Math.floor(Pn(f)/3)))*3,p=Math.pow(10,-m),g=Pl[8+m/3];return function(_){return d(p*_)+g}}return{format:c,formatPrefix:u}}var Qi,Ll,Rl;fg({thousands:",",grouping:[3],currency:["$",""]});function fg(t){return Qi=ug(t),Ll=Qi.format,Rl=Qi.formatPrefix,Qi}function hg(t){return Math.max(0,-Pn(Math.abs(t)))}function dg(t,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Pn(e)/3)))*3-Pn(Math.abs(t)))}function mg(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,Pn(e)-Pn(t))+1}function ts(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t);break}return this}const Dl=Symbol("implicit");function $l(){var t=new Co,e=[],n=[],i=Dl;function r(s){let o=t.get(s);if(o===void 0){if(i!==Dl)return i;t.set(s,o=e.push(s)-1)}return n[o%n.length]}return r.domain=function(s){if(!arguments.length)return e.slice();e=[],t=new Co;for(const o of s)t.has(o)||t.set(o,e.push(o)-1);return r},r.range=function(s){return arguments.length?(n=Array.from(s),r):n.slice()},r.unknown=function(s){return arguments.length?(i=s,r):i},r.copy=function(){return $l(e,n).unknown(i)},ts.apply(r,arguments),r}function ns(){var t=$l().unknown(void 0),e=t.domain,n=t.range,i=0,r=1,s,o,l=!1,a=0,c=0,u=.5;delete t.unknown;function h(){var f=e().length,d=r<i,m=d?r:i,p=d?i:r;s=(p-m)/Math.max(1,f-a+c*2),l&&(s=Math.floor(s)),m+=(p-m-s*(f-a))*u,o=s*(1-a),l&&(m=Math.round(m),o=Math.round(o));var g=Ni(f).map(function(_){return m+s*_});return n(d?g.reverse():g)}return t.domain=function(f){return arguments.length?(e(f),h()):e()},t.range=function(f){return arguments.length?([i,r]=f,i=+i,r=+r,h()):[i,r]},t.rangeRound=function(f){return[i,r]=f,i=+i,r=+r,l=!0,h()},t.bandwidth=function(){return o},t.step=function(){return s},t.round=function(f){return arguments.length?(l=!!f,h()):l},t.padding=function(f){return arguments.length?(a=Math.min(1,c=+f),h()):a},t.paddingInner=function(f){return arguments.length?(a=Math.min(1,f),h()):a},t.paddingOuter=function(f){return arguments.length?(c=+f,h()):c},t.align=function(f){return arguments.length?(u=Math.max(0,Math.min(1,f)),h()):u},t.copy=function(){return ns(e(),[i,r]).round(l).paddingInner(a).paddingOuter(c).align(u)},ts.apply(h(),arguments)}function pg(t){return function(){return t}}function gg(t){return+t}var zl=[0,1];function Ln(t){return t}function is(t,e){return(e-=t=+t)?function(n){return(n-t)/e}:pg(isNaN(e)?NaN:.5)}function _g(t,e){var n;return t>e&&(n=t,t=e,e=n),function(i){return Math.max(t,Math.min(e,i))}}function vg(t,e,n){var i=t[0],r=t[1],s=e[0],o=e[1];return r<i?(i=is(r,i),s=n(o,s)):(i=is(i,r),s=n(s,o)),function(l){return s(i(l))}}function yg(t,e,n){var i=Math.min(t.length,e.length)-1,r=new Array(i),s=new Array(i),o=-1;for(t[i]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++o<i;)r[o]=is(t[o],t[o+1]),s[o]=n(e[o],e[o+1]);return function(l){var a=Ff(t,l,1,i)-1;return s[a](r[a](l))}}function bg(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function wg(){var t=zl,e=zl,n=Ur,i,r,s,o=Ln,l,a,c;function u(){var f=Math.min(t.length,e.length);return o!==Ln&&(o=_g(t[0],t[f-1])),l=f>2?yg:vg,a=c=null,h}function h(f){return f==null||isNaN(f=+f)?s:(a||(a=l(t.map(i),e,n)))(i(o(f)))}return h.invert=function(f){return o(r((c||(c=l(e,t.map(i),Pt)))(f)))},h.domain=function(f){return arguments.length?(t=Array.from(f,gg),u()):t.slice()},h.range=function(f){return arguments.length?(e=Array.from(f),u()):e.slice()},h.rangeRound=function(f){return e=Array.from(f),n=hm,u()},h.clamp=function(f){return arguments.length?(o=f?!0:Ln,u()):o!==Ln},h.interpolate=function(f){return arguments.length?(n=f,u()):n},h.unknown=function(f){return arguments.length?(s=f,h):s},function(f,d){return i=f,r=d,u()}}function Sg(){return wg()(Ln,Ln)}function kg(t,e,n,i){var r=Gf(t,e,n),s;switch(i=Ji(i??",f"),i.type){case"s":{var o=Math.max(Math.abs(t),Math.abs(e));return i.precision==null&&!isNaN(s=dg(r,o))&&(i.precision=s),Rl(i,o)}case"":case"e":case"g":case"p":case"r":{i.precision==null&&!isNaN(s=mg(r,Math.max(Math.abs(t),Math.abs(e))))&&(i.precision=s-(i.type==="e"));break}case"f":case"%":{i.precision==null&&!isNaN(s=hg(r))&&(i.precision=s-(i.type==="%")*2);break}}return Ll(i)}function Eg(t){var e=t.domain;return t.ticks=function(n){var i=e();return Wf(i[0],i[i.length-1],n??10)},t.tickFormat=function(n,i){var r=e();return kg(r[0],r[r.length-1],n??10,i)},t.nice=function(n){n==null&&(n=10);var i=e(),r=0,s=i.length-1,o=i[r],l=i[s],a,c,u=10;for(l<o&&(c=o,o=l,l=c,c=r,r=s,s=c);u-- >0;){if(c=Mr(o,l,n),c===a)return i[r]=o,i[s]=l,e(i);if(c>0)o=Math.floor(o/c)*c,l=Math.ceil(l/c)*c;else if(c<0)o=Math.ceil(o*c)/c,l=Math.floor(l*c)/c;else break;a=c}return t},t}function rs(){var t=Sg();return t.copy=function(){return bg(t,rs())},ts.apply(t,arguments),Eg(t)}const Zi=t=>()=>t;function Cg(t,{sourceEvent:e,target:n,transform:i,dispatch:r}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:i,enumerable:!0,configurable:!0},_:{value:r}})}function Yt(t,e,n){this.k=t,this.x=e,this.y=n}Yt.prototype={constructor:Yt,scale:function(t){return t===1?this:new Yt(this.k*t,this.x,this.y)},translate:function(t,e){return t===0&e===0?this:new Yt(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var ss=new Yt(1,0,0);Yt.prototype;function os(t){t.stopImmediatePropagation()}function ri(t){t.preventDefault(),t.stopImmediatePropagation()}function Ig(t){return(!t.ctrlKey||t.type==="wheel")&&!t.button}function Mg(){var t=this;return t instanceof SVGElement?(t=t.ownerSVGElement||t,t.hasAttribute("viewBox")?(t=t.viewBox.baseVal,[[t.x,t.y],[t.x+t.width,t.y+t.height]]):[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]):[[0,0],[t.clientWidth,t.clientHeight]]}function jl(){return this.__zoom||ss}function xg(t){return-t.deltaY*(t.deltaMode===1?.05:t.deltaMode?1:.002)*(t.ctrlKey?10:1)}function Ag(){return navigator.maxTouchPoints||"ontouchstart"in this}function Tg(t,e,n){var i=t.invertX(e[0][0])-n[0][0],r=t.invertX(e[1][0])-n[1][0],s=t.invertY(e[0][1])-n[0][1],o=t.invertY(e[1][1])-n[1][1];return t.translate(r>i?(i+r)/2:Math.min(0,i)||Math.max(0,r),o>s?(s+o)/2:Math.min(0,s)||Math.max(0,o))}function Fl(){var t=Ig,e=Mg,n=Tg,i=xg,r=Ag,s=[0,1/0],o=[[-1/0,-1/0],[1/0,1/0]],l=250,a=bm,c=Gn("start","zoom","end"),u,h,f,d=500,m=150,p=0,g=10;function _(I){I.property("__zoom",jl).on("wheel.zoom",E,{passive:!1}).on("mousedown.zoom",M).on("dblclick.zoom",D).filter(r).on("touchstart.zoom",$).on("touchmove.zoom",R).on("touchend.zoom touchcancel.zoom",z).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}_.transform=function(I,N,x,L){var B=I.selection?I.selection():I;B.property("__zoom",jl),I!==B?k(I,N,x,L):B.interrupt().each(function(){P(this,arguments).event(L).start().zoom(null,typeof N=="function"?N.apply(this,arguments):N).end()})},_.scaleBy=function(I,N,x,L){_.scaleTo(I,function(){var B=this.__zoom.k,U=typeof N=="function"?N.apply(this,arguments):N;return B*U},x,L)},_.scaleTo=function(I,N,x,L){_.transform(I,function(){var B=e.apply(this,arguments),U=this.__zoom,G=x==null?b(B):typeof x=="function"?x.apply(this,arguments):x,X=U.invert(G),ee=typeof N=="function"?N.apply(this,arguments):N;return n(C(S(U,ee),G,X),B,o)},x,L)},_.translateBy=function(I,N,x,L){_.transform(I,function(){return n(this.__zoom.translate(typeof N=="function"?N.apply(this,arguments):N,typeof x=="function"?x.apply(this,arguments):x),e.apply(this,arguments),o)},null,L)},_.translateTo=function(I,N,x,L,B){_.transform(I,function(){var U=e.apply(this,arguments),G=this.__zoom,X=L==null?b(U):typeof L=="function"?L.apply(this,arguments):L;return n(ss.translate(X[0],X[1]).scale(G.k).translate(typeof N=="function"?-N.apply(this,arguments):-N,typeof x=="function"?-x.apply(this,arguments):-x),U,o)},L,B)};function S(I,N){return N=Math.max(s[0],Math.min(s[1],N)),N===I.k?I:new Yt(N,I.x,I.y)}function C(I,N,x){var L=N[0]-x[0]*I.k,B=N[1]-x[1]*I.k;return L===I.x&&B===I.y?I:new Yt(I.k,L,B)}function b(I){return[(+I[0][0]+ +I[1][0])/2,(+I[0][1]+ +I[1][1])/2]}function k(I,N,x,L){I.on("start.zoom",function(){P(this,arguments).event(L).start()}).on("interrupt.zoom end.zoom",function(){P(this,arguments).event(L).end()}).tween("zoom",function(){var B=this,U=arguments,G=P(B,U).event(L),X=e.apply(B,U),ee=x==null?b(X):typeof x=="function"?x.apply(B,U):x,Q=Math.max(X[1][0]-X[0][0],X[1][1]-X[0][1]),Y=B.__zoom,oe=typeof N=="function"?N.apply(B,U):N,fe=a(Y.invert(ee).concat(Q/Y.k),oe.invert(ee).concat(Q/oe.k));return function(ke){if(ke===1)ke=oe;else{var ie=fe(ke),ze=Q/ie[2];ke=new Yt(ze,ee[0]-ie[0]*ze,ee[1]-ie[1]*ze)}G.zoom(null,ke)}})}function P(I,N,x){return!x&&I.__zooming||new A(I,N)}function A(I,N){this.that=I,this.args=N,this.active=0,this.sourceEvent=null,this.extent=e.apply(I,N),this.taps=0}A.prototype={event:function(I){return I&&(this.sourceEvent=I),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(I,N){return this.mouse&&I!=="mouse"&&(this.mouse[1]=N.invert(this.mouse[0])),this.touch0&&I!=="touch"&&(this.touch0[1]=N.invert(this.touch0[0])),this.touch1&&I!=="touch"&&(this.touch1[1]=N.invert(this.touch1[0])),this.that.__zoom=N,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(I){var N=Fe(this.that).datum();c.call(I,this.that,new Cg(I,{sourceEvent:this.sourceEvent,target:_,type:I,transform:this.that.__zoom,dispatch:c}),N)}};function E(I,...N){if(!t.apply(this,arguments))return;var x=P(this,N).event(I),L=this.__zoom,B=Math.max(s[0],Math.min(s[1],L.k*Math.pow(2,i.apply(this,arguments)))),U=rt(I);if(x.wheel)(x.mouse[0][0]!==U[0]||x.mouse[0][1]!==U[1])&&(x.mouse[1]=L.invert(x.mouse[0]=U)),clearTimeout(x.wheel);else{if(L.k===B)return;x.mouse=[U,L.invert(U)],Yi(this),x.start()}ri(I),x.wheel=setTimeout(G,m),x.zoom("mouse",n(C(S(L,B),x.mouse[0],x.mouse[1]),x.extent,o));function G(){x.wheel=null,x.end()}}function M(I,...N){if(f||!t.apply(this,arguments))return;var x=I.currentTarget,L=P(this,N,!0).event(I),B=Fe(I.view).on("mousemove.zoom",ee,!0).on("mouseup.zoom",Q,!0),U=rt(I,x),G=I.clientX,X=I.clientY;Uo(I.view),os(I),L.mouse=[U,this.__zoom.invert(U)],Yi(this),L.start();function ee(Y){if(ri(Y),!L.moved){var oe=Y.clientX-G,fe=Y.clientY-X;L.moved=oe*oe+fe*fe>p}L.event(Y).zoom("mouse",n(C(L.that.__zoom,L.mouse[0]=rt(Y,x),L.mouse[1]),L.extent,o))}function Q(Y){B.on("mousemove.zoom mouseup.zoom",null),Bo(Y.view,L.moved),ri(Y),L.event(Y).end()}}function D(I,...N){if(t.apply(this,arguments)){var x=this.__zoom,L=rt(I.changedTouches?I.changedTouches[0]:I,this),B=x.invert(L),U=x.k*(I.shiftKey?.5:2),G=n(C(S(x,U),L,B),e.apply(this,N),o);ri(I),l>0?Fe(this).transition().duration(l).call(k,G,L,I):Fe(this).call(_.transform,G,L,I)}}function $(I,...N){if(t.apply(this,arguments)){var x=I.touches,L=x.length,B=P(this,N,I.changedTouches.length===L).event(I),U,G,X,ee;for(os(I),G=0;G<L;++G)X=x[G],ee=rt(X,this),ee=[ee,this.__zoom.invert(ee),X.identifier],B.touch0?!B.touch1&&B.touch0[2]!==ee[2]&&(B.touch1=ee,B.taps=0):(B.touch0=ee,U=!0,B.taps=1+!!u);u&&(u=clearTimeout(u)),U&&(B.taps<2&&(h=ee[0],u=setTimeout(function(){u=null},d)),Yi(this),B.start())}}function R(I,...N){if(this.__zooming){var x=P(this,N).event(I),L=I.changedTouches,B=L.length,U,G,X,ee;for(ri(I),U=0;U<B;++U)G=L[U],X=rt(G,this),x.touch0&&x.touch0[2]===G.identifier?x.touch0[0]=X:x.touch1&&x.touch1[2]===G.identifier&&(x.touch1[0]=X);if(G=x.that.__zoom,x.touch1){var Q=x.touch0[0],Y=x.touch0[1],oe=x.touch1[0],fe=x.touch1[1],ke=(ke=oe[0]-Q[0])*ke+(ke=oe[1]-Q[1])*ke,ie=(ie=fe[0]-Y[0])*ie+(ie=fe[1]-Y[1])*ie;G=S(G,Math.sqrt(ke/ie)),X=[(Q[0]+oe[0])/2,(Q[1]+oe[1])/2],ee=[(Y[0]+fe[0])/2,(Y[1]+fe[1])/2]}else if(x.touch0)X=x.touch0[0],ee=x.touch0[1];else return;x.zoom("touch",n(C(G,X,ee),x.extent,o))}}function z(I,...N){if(this.__zooming){var x=P(this,N).event(I),L=I.changedTouches,B=L.length,U,G;for(os(I),f&&clearTimeout(f),f=setTimeout(function(){f=null},d),U=0;U<B;++U)G=L[U],x.touch0&&x.touch0[2]===G.identifier?delete x.touch0:x.touch1&&x.touch1[2]===G.identifier&&delete x.touch1;if(x.touch1&&!x.touch0&&(x.touch0=x.touch1,delete x.touch1),x.touch0)x.touch0[1]=this.__zoom.invert(x.touch0[0]);else if(x.end(),x.taps===2&&(G=rt(G,this),Math.hypot(h[0]-G[0],h[1]-G[1])<g)){var X=Fe(this).on("dblclick.zoom");X&&X.apply(this,arguments)}}}return _.wheelDelta=function(I){return arguments.length?(i=typeof I=="function"?I:Zi(+I),_):i},_.filter=function(I){return arguments.length?(t=typeof I=="function"?I:Zi(!!I),_):t},_.touchable=function(I){return arguments.length?(r=typeof I=="function"?I:Zi(!!I),_):r},_.extent=function(I){return arguments.length?(e=typeof I=="function"?I:Zi([[+I[0][0],+I[0][1]],[+I[1][0],+I[1][1]]]),_):e},_.scaleExtent=function(I){return arguments.length?(s[0]=+I[0],s[1]=+I[1],_):[s[0],s[1]]},_.translateExtent=function(I){return arguments.length?(o[0][0]=+I[0][0],o[1][0]=+I[1][0],o[0][1]=+I[0][1],o[1][1]=+I[1][1],_):[[o[0][0],o[0][1]],[o[1][0],o[1][1]]]},_.constrain=function(I){return arguments.length?(n=I,_):n},_.duration=function(I){return arguments.length?(l=+I,_):l},_.interpolate=function(I){return arguments.length?(a=I,_):a},_.on=function(){var I=c.on.apply(c,arguments);return I===c?_:I},_.clickDistance=function(I){return arguments.length?(p=(I=+I)*I,_):Math.sqrt(p)},_.tapDistance=function(I){return arguments.length?(g=+I,_):g},_}function Ng(t,e,n=null,i,r=null){const s=Fe(t);s.selectAll("*").remove();const o=s.node(),l=o.getBoundingClientRect();let a=l.width||800,c=l.height||600;const u=a/2,h=c/2,f=s.append("canvas").attr("class","network-canvas").attr("width",a).attr("height",c).style("width",a+"px").style("height",c+"px").style("cursor","default"),d=f.node().getContext("2d",{alpha:!1});let m=ss;const p=new Set,g={current:null};function _(){const $=o.getBoundingClientRect(),R=$.width||800,z=$.height||600;(R!==a||z!==c)&&(a=R,c=z,f.attr("width",a).attr("height",c).style("width",a+"px").style("height",c+"px"),D())}const S=new ResizeObserver(_);S.observe(o);const C=El(e).force("link",Sl(n).id($=>$.id).distance($=>$.distance)).force("charge",Cl().strength(-250)).force("center",_l(u,h).strength(.7)).force("collide",bl($=>$.radius+10).strength(.5)).force("x",Il(u).strength(.025)).force("y",Ml(h).strength(.025)).alphaDecay(.05).velocityDecay(.6);let b=null;C.on("tick",()=>{b||(b=requestAnimationFrame(()=>{D(),b=null}))}),C.tick(100);for(let $=0;$<100;$++)C.tick();C.alphaTarget(0);const k=Og({canvas:f,nodes:e,transform:()=>m,hoveredNode:g,onSelectionChange:($,R)=>{p.clear(),$.forEach(I=>p.add(I));const z=Lg(e,$,R);i(z),D()},render:()=>D()}),P=Fl().scaleExtent([.1,10]).filter($=>!k.isSelectionMode()||$.type==="wheel").on("zoom",({transform:$})=>{m=$,D()});f.call(P);const{dragstarted:A,dragged:E,dragended:M}=Pg(f,e,C,()=>m,g,()=>!k.isSelectionMode(),D);k.setupInteractions(f,{start:A,drag:E,end:M});function D(){d.save(),d.fillRect(0,0,a,c),d.translate(m.x,m.y),d.scale(m.k,m.k),d.strokeStyle="#8a8a8a",d.lineWidth=1/m.k,n.forEach(R=>{const z=R.source.x,I=R.source.y,N=R.target.x,x=R.target.y;d.globalAlpha=Math.max(.2,R.strength),d.lineWidth=R.width/m.k,d.beginPath(),d.moveTo(z,I),d.lineTo(N,x),d.stroke()}),d.globalAlpha=1,e.forEach(R=>{const z=p.has(R.id);d.fillStyle=R.color,d.beginPath(),d.arc(R.x,R.y,R.radius,0,2*Math.PI),d.fill(),z&&(d.strokeStyle="#0f2bff",d.lineWidth=3/m.k,d.stroke())});const $=k.getSelectionRect();if($){d.strokeStyle="#0f2bff",d.fillStyle="rgba(15, 43, 255, 0.2)",d.lineWidth=2/m.k;const R=Math.min($.x1,$.x2),z=Math.min($.y1,$.y2),I=Math.abs($.x2-$.x1),N=Math.abs($.y2-$.y1);d.fillRect(R,z,I,N),d.strokeRect(R,z,I,N)}d.restore()}return D(),{destroy:()=>{b&&cancelAnimationFrame(b),C.stop(),S.disconnect(),f.remove()},toggleSelectionMode:()=>{const $=k.toggleSelectionMode();return r&&r($),D(),$}}}function Og(t){const{canvas:e,nodes:n,transform:i,hoveredNode:r,onSelectionChange:s,render:o}=t,l=new Set,a=[];let c=!1,u=null;function h(){return c=!c,e.style("cursor",c?"crosshair":"default"),c}function f(p){if(l.has(p)){l.delete(p);const g=a.indexOf(p);g>-1&&a.splice(g,1)}else l.add(p),a.push(p);s(l,a)}function d(p,g){const _=i(),S=(p-_.x)/_.k,C=(g-_.y)/_.k;for(let b=n.length-1;b>=0;b--){const k=n[b],P=S-k.x,A=C-k.y;if(Math.sqrt(P*P+A*A)<k.radius)return k}return null}function m(p,g){let _=null;p.on("mousedown",function(S){const[C,b]=rt(S),k=d(C,b);if(c){const P=i(),A=(C-P.x)/P.k,E=(b-P.y)/P.k;u={x1:A,y1:E,x2:A,y2:E},o()}else k&&(_=k,g.start(S,k))}),p.on("mousemove",function(S){const[C,b]=rt(S);if(c){if(u){const k=i(),P=(C-k.x)/k.k,A=(b-k.y)/k.k;u.x2=P,u.y2=A,o()}}else if(_)g.drag(S,_,C,b);else{const k=d(C,b);r.current!==k&&(r.current=k,p.style("cursor",k?"pointer":"default"),o())}}),p.on("mouseup",function(S){if(c){if(u){const C=Math.min(u.x1,u.x2),b=Math.min(u.y1,u.y2),k=Math.max(u.x1,u.x2),P=Math.max(u.y1,u.y2);l.clear(),a.length=0;const A=[];n.forEach(E=>{E.x>=C&&E.x<=k&&E.y>=b&&E.y<=P&&A.push({id:E.id,y:E.y})}),A.sort((E,M)=>E.y-M.y),A.forEach(({id:E})=>{l.add(E),a.push(E)}),s(l,a),u=null,o()}}else if(_)g.end(S,_),_=null;else{const[C,b]=rt(S),k=d(C,b);k&&f(k.id)}})}return{toggleSelectionMode:h,isSelectionMode:()=>c,setupInteractions:m,getSelectionRect:()=>u}}function Pg(t,e,n,i,r,s,o){let l=null;function a(h,f){s()&&(h.active||n.alphaTarget(.3).restart(),l=f,f.fx=f.x,f.fy=f.y)}function c(h,f,d,m){if(!l||!s())return;const p=i();f.fx=(d-p.x)/p.k,f.fy=(m-p.y)/p.k,o()}function u(h,f){!l||!s()||(h.active||n.alphaTarget(0),f.fx=null,f.fy=null,l=null)}return{dragstarted:a,dragged:c,dragended:u}}function Lg(t,e,n){const i=new Map(t.map(r=>[r.id,r]));return n.map(r=>i.get(r)).filter(Boolean)}const Vl=8,Rg=1.5,Dg=50,Hl=.5,$g=800,zg=600;function jg(t,e,n=null,i=null,r=null){const s=$g/2,o=zg/2,a=Fe(t).append("svg").attr("class","network-svg"),c=a.append("g"),u=c.append("g").selectAll("line").data(n).join("line").attr("class","link").attr("stroke-width",m=>m.width||Rg).attr("stroke-opacity",m=>Math.max(.2,m.strength||Hl)),h=c.append("g").selectAll("circle").data(e).join("circle").attr("class","node").attr("r",m=>m.radius||Vl).attr("fill",m=>m.color);h.append("title").text(m=>m.label);const f=El(e).force("link",Sl(n).id(m=>m.id).distance(m=>m.distance||Dg)).force("charge",Cl().strength(-250)).force("center",_l(s,o).strength(.7)).force("collide",bl(m=>(m.radius||Vl)+10).strength(Hl)).force("x",Il(s).strength(.025)).force("y",Ml(o).strength(.025));let d=null;if(i){d=Fg({svg:a,g:c,nodes:e,onSelectionChange:(_,S)=>{h.classed("selected",b=>_.has(b.id));const C=Hg(e,_,S);i(C)}}),a.call(Fl().scaleExtent([.1,10]).filter(_=>!d.isSelectionMode()||_.type==="wheel").on("zoom",({transform:_})=>c.attr("transform",_)));const{dragstarted:m,dragged:p,dragended:g}=Vg(f,u,h);d.setupNodeClick(h),d.setupDrag(h,{start:m,drag:p,end:g})}return{destroy:()=>{f.stop(),a.remove()},toggleSelectionMode:()=>{if(d){const m=d.toggleSelectionMode();return r&&r(m),m}}}}function Fg(t){const{svg:e,g:n,nodes:i,onSelectionChange:r,getNodePosition:s=p=>({x:p.x,y:p.y}),getNodeId:o=p=>p.id}=t,l=new Set,a=[];let c=!1;function u(){return c=!c,e.style("cursor",c?"crosshair":"default"),c}function h(p){if(l.has(p)){l.delete(p);const g=a.indexOf(p);g>-1&&a.splice(g,1)}else l.add(p),a.push(p);r(l,a)}function f(){l.clear(),a.length=0,r(l,a)}let d=null,m=null;return e.on("mousedown",function(p){if(!c)return;p.preventDefault();const[g,_]=rt(p,n.node());d={x:g,y:_},m=n.append("rect").attr("class","selection-rect").attr("x",g).attr("y",_).attr("width",0).attr("height",0)}).on("mousemove",function(p){if(!c||!m)return;const[g,_]=rt(p,n.node()),S=g-d.x,C=_-d.y;m.attr("x",S<0?g:d.x).attr("y",C<0?_:d.y).attr("width",Math.abs(S)).attr("height",Math.abs(C))}).on("mouseup",function(p){if(!c||!m)return;const[g,_]=rt(p,n.node()),S=Math.min(d.x,g),C=Math.min(d.y,_),b=Math.max(d.x,g),k=Math.max(d.y,_);l.clear(),a.length=0;const P=[];i.forEach(A=>{const E=s(A);E.x>=S&&E.x<=b&&E.y>=C&&E.y<=k&&P.push({id:o(A),y:E.y})}),P.sort((A,E)=>A.y-E.y),P.forEach(({id:A})=>{l.add(A),a.push(A)}),r(l,a),m.remove(),m=null,d=null}),{toggleSelectionMode:u,toggleNode:h,clearSelection:f,isSelectionMode:()=>c,getSelectedNodes:()=>l,getSelectionOrder:()=>a,setupNodeClick:p=>{p.on("click",function(g,_){g.stopPropagation(),h(o(_))})},setupDrag:(p,g)=>{p.call(Bd().filter(()=>!c).on("start",g.start).on("drag",g.drag).on("end",g.end))}}}function Vg(t,e,n){t.on("tick",()=>{e.attr("x1",o=>o.source.x).attr("y1",o=>o.source.y).attr("x2",o=>o.target.x).attr("y2",o=>o.target.y),n.attr("cx",o=>o.x).attr("cy",o=>o.y)});function i(o){o.active||t.alphaTarget(.3).restart(),o.subject.fx=o.subject.x,o.subject.fy=o.subject.y}function r(o){o.subject.fx=o.x,o.subject.fy=o.y}function s(o){o.active||t.alphaTarget(0),o.subject.fx=null,o.subject.fy=null}return{dragstarted:i,dragged:r,dragended:s}}function Hg(t,e,n){const i=new Map(t.map(r=>[r.id,r]));return n.map(r=>i.get(r)).filter(Boolean)}const Ug="modulepreload",Bg=function(t){return"/"+t},Ul={},ls=function(e,n,i){return e()};function as(t){const{type:e,modelName:n,title:i,extractMeta:r=d=>d}=t,s={id:null,type:e,title:i,selected:{}},o=JSON.parse(localStorage.getItem(e))||s,l=we(o),a=we(!1);function c(d,m=!1){a.set(m),localStorage.setItem(e,JSON.stringify(d))}function u(){l.update(d=>{if(e!=="documentSet")return console.error("Document set management is the only type currently supported for saving."),d;const m=Object.fromEntries(Object.entries(d.selected).map(([g,_])=>[g,Object.keys(_)])),p=d.id?`${d.id}/edit`:"new";return fetch(`${window.location.origin}/${n}/${p}`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":en},body:JSON.stringify({title:d.title,selection:d,...m})}).then(g=>g.json()).then(g=>{if(!(g!=null&&g.document_set_id))throw new Error("Failed to save");l.update(_=>(_.id=g.document_set_id,_.title=g.document_set_title,c(_,!0),_))}).catch(g=>console.error("Error:",g)),d})}const h=d=>l.update(()=>{const m=d.selection.id?d.selection:{...d.selection,id:d.id};return c(m),m}),f=()=>l.update(()=>{const d={...s,selected:{}};return c(d),d});return{type:e,subscribe:l.subscribe,add:d=>l.update(m=>(m.selected[d.class]={...m.selected[d.class]||{},[d.id]:r(d)},c(m),m)),addAll:d=>l.update(m=>(d.forEach(p=>{m.selected[p.class]={...m.selected[p.class]||{},[p.id]:r(p)}}),c(m),m)),remove:(d,m)=>l.update(p=>{const{[d]:g,..._}=p.selected[m];return p.selected[m]=_,c(p),p}),removeAll:(d,m)=>l.update(p=>(d.forEach(g=>{var _;return(_=p.selected[m])==null?!0:delete _[g]}),c(p),p)),toggle:d=>l.update(m=>{var p;if((p=m.selected[d.class])!=null&&p[d.id]){const{[d.id]:g,..._}=m.selected[d.class];m.selected[d.class]=_}else m.selected[d.class]={...m.selected[d.class]||{},[d.id]:r(d)};return c(m),m}),toggleSet:d=>{Ke(l).id===d.id?f():h(d)},empty:()=>l.update(d=>(d.id=null,d.title=i,d.selected={},c(d,!0),d)),updateTitle:d=>l.update(m=>(m.title=d,c(m,!0),m)),save:u,isSaved:a,selection:l,selectionTitle:Be(l,d=>d.title),isSelected:Be(l,d=>m=>{var p;return((p=d.selected[m.class])==null?void 0:p[m.id])||!1}),selected:Be(l,d=>d.selected),nbSelected:Be(l,d=>Object.values(d.selected).reduce((m,p)=>m+Object.keys(p).length,0)),isSetSelected:Be(l,d=>m=>d.id===m.id)}}as({type:"documentSet",modelName:"document-set",title:W==="en"?"Document set":"Set de documents",extractMeta:t=>({title:t.title,url:t.url})});const qg=as({type:"regionsSet",modelName:"regions-set",title:W==="en"?"Regions set":"Set de régions",extractMeta:t=>t}),er=as({type:"clusterSet",modelName:"cluster-set",title:W==="en"?"Selected regions":"Régions sélectionnées",extractMeta:t=>({imgRef:t.id,clusterId:t.clusterId,title:t.title,xywh:t.xywh,img:t.img})});function Kg(){const t=`${window.location.origin}${window.location.pathname}`,e=we(1),n=we({}),i=we({}),r=we("");wr(e,"p");function s(u){r.update(h=>{const f=h===u?"":u;return navigator.clipboard.writeText(f).then(d=>""),f})}const o=(async()=>{try{const u=await fetch(`${t}canvas`);if(!u.ok)return{};const h=await u.json();let f={};return Object.values(h).forEach(d=>{Object.entries(d).forEach(([m,p])=>{f[m]=p})}),n.set(f),h}catch{return{}}})(),l=Be(e,u=>(async()=>{const f=await(await fetch(`${t}canvas?p=${u}`)).json();return i.set(f),f})());function a(u){Sr(u,e,"p")}function c(u){n.update(h=>(delete h[u],{...h})),i.update(h=>{for(const f in h)if(h[f][u]){const{[u]:d,...m}=h[f];return h[f]=m,h}return h})}return{currentPage:e,pageRegions:i,allRegions:n,fetchPages:l,fetchAll:o,handlePageUpdate:a,remove:c,clipBoard:r,copyRef:s}}const Bl=Kg(),$y="";function Wg(t){let e;return{c(){e=xt("path"),v(e,"d","M384 336H192c-8.8 0-16-7.2-16-16V64c0-8.8 7.2-16 16-16l140.1 0L400 115.9V320c0 8.8-7.2 16-16 16zM192 384H384c35.3 0 64-28.7 64-64V115.9c0-12.7-5.1-24.9-14.1-33.9L366.1 14.1c-9-9-21.2-14.1-33.9-14.1H192c-35.3 0-64 28.7-64 64V320c0 35.3 28.7 64 64 64zM64 128c-35.3 0-64 28.7-64 64V448c0 35.3 28.7 64 64 64H256c35.3 0 64-28.7 64-64V416H272v32c0 8.8-7.2 16-16 16H64c-8.8 0-16-7.2-16-16V192c0-8.8 7.2-16 16-16H96V128H64z"),v(e,"class","svelte-1829hp2")},m(n,i){V(n,e,i)},d(n){n&&F(e)}}}function Gg(t){let e;return{c(){e=xt("path"),v(e,"d","M208 0H332.1c12.7 0 24.9 5.1 33.9 14.1l67.9 67.9c9 9 14.1 21.2 14.1 33.9V336c0 26.5-21.5 48-48 48H208c-26.5 0-48-21.5-48-48V48c0-26.5 21.5-48 48-48zM48 128h80v64H64V448H256V416h64v48c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V176c0-26.5 21.5-48 48-48z"),v(e,"class","svelte-1829hp2")},m(n,i){V(n,e,i)},d(n){n&&F(e)}}}function Yg(t){let e=W==="en"?"Copy ID":"Copier l'ID",n;return{c(){n=se(e)},m(i,r){V(i,n,r)},p:Z,d(i){i&&F(n)}}}function Xg(t){let e=W==="en"?"Copied!":"Copié !",n;return{c(){n=se(e)},m(i,r){V(i,n,r)},p:Z,d(i){i&&F(n)}}}function ql(t){let e,n,i;var r=t[7];function s(o){return{props:{mainImgItem:o[1],compareImgItem:o[14]}}}return r&&(e=_i(r,s(t))),{c(){e&&ue(e.$$.fragment),n=Ge()},m(o,l){e&&ae(e,o,l),V(o,n,l),i=!0},p(o,l){const a={};if(l&2&&(a.mainImgItem=o[1]),l&128&&r!==(r=o[7])){if(e){Ee();const c=e;K(c.$$.fragment,1,0,()=>{ce(c,1)}),Ce()}r?(e=_i(r,s(o)),ue(e.$$.fragment),H(e.$$.fragment,1),ae(e,n.parentNode,n)):e=null}else r&&e.$set(a)},i(o){i||(e&&H(e.$$.fragment,o),i=!0)},o(o){e&&K(e.$$.fragment,o),i=!1},d(o){o&&F(n),e&&ce(e,o)}}}function Jg(t){let e,n,i,r,s,o,l,a,c,u,h,f,d,m,p,g,_,S,C,b,k,P,A;function E(N,x){return N[8]?Gg:Wg}let M=E(t),D=M(t);function $(N,x){return N[8]?Xg:Yg}let R=$(t),z=R(t),I=t[7]&&ql(t);return{c(){e=w("div"),n=w("figure"),i=w("img"),s=q(),o=w("div"),l=w("span"),u=q(),h=w("div"),f=w("button"),d=xt("svg"),D.c(),m=q(),p=w("span"),z.c(),_=q(),I&&I.c(),v(i,"class","region-img svelte-1829hp2"),_t(i.src,r=t[9])||v(i,"src",r),v(i,"alt","Extracted region"),v(l,"class","overlay-desc"),v(o,"class","overlay is-center svelte-1829hp2"),v(n,"class",a="image card region-image "+(t[0]?"is-96x96":"")+" svelte-1829hp2"),v(n,"tabindex","-1"),v(n,"style",c=(t[2]==="full"?"height: 100%":`height: ${t[2]}px; min-width: ${t[2]}px`)+"; "+(t[3]?`border: 5px solid ${t[3]};`:"")),v(d,"xmlns","http://www.w3.org/2000/svg"),v(d,"viewBox","0 0 384 512"),v(d,"class","svelte-1829hp2"),v(p,"class","tooltip svelte-1829hp2"),v(f,"class","button tag svelte-1829hp2"),v(f,"style",g=t[6]?"":"display: none;"),v(h,"class","region-btn ml-1 svelte-1829hp2"),v(e,"class",S="region is-center "+(t[5]&&t[11](t[1])?"checked":"")+" svelte-1829hp2"),v(e,"style",C=t[2]==="full"?"height: 100%":"")},m(N,x){V(N,e,x),y(e,n),y(n,i),y(n,s),y(n,o),y(o,l),l.innerHTML=t[10],y(e,u),y(e,h),y(h,f),y(f,d),D.m(d,null),y(f,m),y(f,p),z.m(p,null),y(h,_),I&&I.m(h,null),k=!0,P||(A=[pe(n,"click",t[19]),pe(n,"keyup",Qg),pe(f,"click",t[20])],P=!0)},p(N,[x]){t=N,(!k||x&512&&!_t(i.src,r=t[9]))&&v(i,"src",r),(!k||x&1024)&&(l.innerHTML=t[10]),(!k||x&1&&a!==(a="image card region-image "+(t[0]?"is-96x96":"")+" svelte-1829hp2"))&&v(n,"class",a),(!k||x&12&&c!==(c=(t[2]==="full"?"height: 100%":`height: ${t[2]}px; min-width: ${t[2]}px`)+"; "+(t[3]?`border: 5px solid ${t[3]};`:"")))&&v(n,"style",c),M!==(M=E(t))&&(D.d(1),D=M(t),D&&(D.c(),D.m(d,null))),R===(R=$(t))&&z?z.p(t,x):(z.d(1),z=R(t),z&&(z.c(),z.m(p,null))),(!k||x&64&&g!==(g=t[6]?"":"display: none;"))&&v(f,"style",g),t[7]?I?(I.p(t,x),x&128&&H(I,1)):(I=ql(t),I.c(),H(I,1),I.m(h,null)):I&&(Ee(),K(I,1,1,()=>{I=null}),Ce()),(!k||x&2082&&S!==(S="region is-center "+(t[5]&&t[11](t[1])?"checked":"")+" svelte-1829hp2"))&&v(e,"class",S),(!k||x&4&&C!==(C=t[2]==="full"?"height: 100%":""))&&v(e,"style",C)},i(N){k||(H(I),Dt(()=>{k&&(b||(b=Zt(e,Mn,{duration:t[15]},!0)),b.run(1))}),k=!0)},o(N){K(I),b||(b=Zt(e,Mn,{duration:t[15]},!1)),b.run(0),k=!1},d(N){N&&F(e),D.d(),z.d(),I&&I.d(),N&&b&&b.end(),P=!1,Ze(A)}}}const Qg=()=>null;function Zg(t,e,n){let i,r,s,o,l,{selectionStore:a}=e;a||(a=qg);const{isSelected:c}=a;me(t,c,M=>n(11,l=M));const{clipBoard:u}=Bl;me(t,u,M=>n(18,o=M));let{item:h}=e,{descPromise:f=void 0}=e,{isSquare:d=!0}=e,{height:m=d?96:140}=e;m==="full"&&(d=!1);let{borderColor:p=null}=e,{toggleSelection:g=a.toggle}=e;const _=vt("qImgMetadata")||void 0,S=vt("isInModal")||!1,C=S?0:500;let b;S||ls(()=>Promise.resolve().then(()=>G0),void 0).then(M=>n(7,b=M.default));let{selectable:k=!S}=e,{copyable:P=!0}=e;const A=()=>k?g(h):null,E=()=>P?Bl.copyRef(h.ref):null;return t.$$set=M=>{"selectionStore"in M&&n(16,a=M.selectionStore),"item"in M&&n(1,h=M.item),"descPromise"in M&&n(17,f=M.descPromise),"isSquare"in M&&n(0,d=M.isSquare),"height"in M&&n(2,m=M.height),"borderColor"in M&&n(3,p=M.borderColor),"toggleSelection"in M&&n(4,g=M.toggleSelection),"selectable"in M&&n(5,k=M.selectable),"copyable"in M&&n(6,P=M.copyable)},t.$$.update=()=>{t.$$.dirty&2&&n(10,i=h.title),t.$$.dirty&131072&&f&&f.then(M=>n(10,i=M)),t.$$.dirty&7&&n(9,r=$t(h.img??h.ref,h.xywh,m==="full"?m:d?`${m},`:`,${m}`)),t.$$.dirty&262146&&n(8,s=h.ref===o)},[d,h,m,p,g,k,P,b,s,r,i,l,c,u,_,C,a,f,o,A,E]}class Rn extends be{constructor(e){super(),ye(this,e,Zg,Jg,_e,{selectionStore:16,item:1,descPromise:17,isSquare:0,height:2,borderColor:3,toggleSelection:4,selectable:5,copyable:6})}}const zy="";function Kl(t,e,n){const i=t.slice();return i[11]=e[n],i}function Wl(t,e,n){const i=t.slice();return i[14]=e[n],i}function cs(t){const e=t.slice(),n=e[2].get(e[11][e[14]].id);return e[17]=n,e}function Gl(t,e,n){const i=t.slice();return i[14]=e[n],i}function Yl(t){let e,n,i,r,s,o,l,a,c,u,h=t[0].regions,f=[];for(let _=0;_<h.length;_+=1)f[_]=Xl(Gl(t,h,_));const d=_=>K(f[_],1,1,()=>{f[_]=null});let m=t[0].rows,p=[];for(let _=0;_<m.length;_+=1)p[_]=Zl(Kl(t,m,_));const g=_=>K(p[_],1,1,()=>{p[_]=null});return{c(){e=w("div"),n=w("h3"),n.textContent="Aligned Documents",i=q(),r=w("div"),s=w("table"),o=w("thead"),l=w("tr");for(let _=0;_<f.length;_+=1)f[_].c();a=q(),c=w("tbody");for(let _=0;_<p.length;_+=1)p[_].c();v(n,"class","title is-5"),v(o,"class","region-header svelte-1hxxzoa"),v(s,"class","table is-fullwidth svelte-1hxxzoa"),v(r,"class","table-container svelte-1hxxzoa"),v(e,"class","box mt-4")},m(_,S){V(_,e,S),y(e,n),y(e,i),y(e,r),y(r,s),y(s,o),y(o,l);for(let C=0;C<f.length;C+=1)f[C]&&f[C].m(l,null);y(s,a),y(s,c);for(let C=0;C<p.length;C+=1)p[C]&&p[C].m(c,null);u=!0},p(_,S){if(S&3){h=_[0].regions;let C;for(C=0;C<h.length;C+=1){const b=Gl(_,h,C);f[C]?(f[C].p(b,S),H(f[C],1)):(f[C]=Xl(b),f[C].c(),H(f[C],1),f[C].m(l,null))}for(Ee(),C=h.length;C<f.length;C+=1)d(C);Ce()}if(S&77){m=_[0].rows;let C;for(C=0;C<m.length;C+=1){const b=Kl(_,m,C);p[C]?(p[C].p(b,S),H(p[C],1)):(p[C]=Zl(b),p[C].c(),H(p[C],1),p[C].m(c,null))}for(Ee(),C=m.length;C<p.length;C+=1)g(C);Ce()}},i(_){if(!u){for(let S=0;S<h.length;S+=1)H(f[S]);for(let S=0;S<m.length;S+=1)H(p[S]);u=!0}},o(_){f=f.filter(Boolean);for(let S=0;S<f.length;S+=1)K(f[S]);p=p.filter(Boolean);for(let S=0;S<p.length;S+=1)K(p[S]);u=!1},d(_){_&&F(e),We(f,_),We(p,_)}}}function Xl(t){let e,n,i,r;return n=new Ei({props:{id:t[14],meta:t[1].get(t[14])||{},clickable:!1}}),{c(){e=w("th"),ue(n.$$.fragment),i=q(),v(e,"class","is-vcentered")},m(s,o){V(s,e,o),ae(n,e,null),y(e,i),r=!0},p(s,o){const l={};o&1&&(l.id=s[14]),o&3&&(l.meta=s[1].get(s[14])||{}),n.$set(l)},i(s){r||(H(n.$$.fragment,s),r=!0)},o(s){K(n.$$.fragment,s),r=!1},d(s){s&&F(e),ce(n)}}}function Jl(t){let e,n,i,r,s=t[11][t[14]].page+"",o,l;return e=new Rn({props:{item:t[17],selectable:!1,copyable:!1,borderColor:t[6](t[11][t[14]],t[3]),isSquare:!1}}),{c(){ue(e.$$.fragment),n=q(),i=w("div"),r=se("Page "),o=se(s),v(i,"class","has-text-grey-dark mt-2")},m(a,c){ae(e,a,c),V(a,n,c),V(a,i,c),y(i,r),y(i,o),l=!0},p(a,c){const u={};c&5&&(u.item=a[17]),c&9&&(u.borderColor=a[6](a[11][a[14]],a[3])),e.$set(u),(!l||c&1)&&s!==(s=a[11][a[14]].page+"")&&ve(o,s)},i(a){l||(H(e.$$.fragment,a),l=!0)},o(a){K(e.$$.fragment,a),l=!1},d(a){ce(e,a),a&&F(n),a&&F(i)}}}function Ql(t){let e,n,i=t[11][t[14]]&&Jl(cs(t));return{c(){e=w("td"),i&&i.c(),v(e,"class","has-text-centered"),Re(e,"vertical-align","top")},m(r,s){V(r,e,s),i&&i.m(e,null),n=!0},p(r,s){r[11][r[14]]?i?(i.p(cs(r),s),s&1&&H(i,1)):(i=Jl(cs(r)),i.c(),H(i,1),i.m(e,null)):i&&(Ee(),K(i,1,1,()=>{i=null}),Ce())},i(r){n||(H(i),n=!0)},o(r){K(i),n=!1},d(r){r&&F(e),i&&i.d()}}}function Zl(t){let e,n,i,r=t[0].regions,s=[];for(let l=0;l<r.length;l+=1)s[l]=Ql(Wl(t,r,l));const o=l=>K(s[l],1,1,()=>{s[l]=null});return{c(){e=w("tr");for(let l=0;l<s.length;l+=1)s[l].c();n=q()},m(l,a){V(l,e,a);for(let c=0;c<s.length;c+=1)s[c]&&s[c].m(e,null);y(e,n),i=!0},p(l,a){if(a&77){r=l[0].regions;let c;for(c=0;c<r.length;c+=1){const u=Wl(l,r,c);s[c]?(s[c].p(u,a),H(s[c],1)):(s[c]=Ql(u),s[c].c(),H(s[c],1),s[c].m(e,n))}for(Ee(),c=r.length;c<s.length;c+=1)o(c);Ce()}},i(l){if(!i){for(let a=0;a<r.length;a+=1)H(s[a]);i=!0}},o(l){s=s.filter(Boolean);for(let a=0;a<s.length;a+=1)K(s[a]);i=!1},d(l){l&&F(e),We(s,l)}}}function e_(t){let e,n,i=t[0]&&Yl(t);return{c(){i&&i.c(),e=Ge()},m(r,s){i&&i.m(r,s),V(r,e,s),n=!0},p(r,[s]){r[0]?i?(i.p(r,s),s&1&&H(i,1)):(i=Yl(r),i.c(),H(i,1),i.m(e.parentNode,e)):i&&(Ee(),K(i,1,1,()=>{i=null}),Ce())},i(r){n||(H(i),n=!0)},o(r){K(i),n=!1},d(r){i&&i.d(r),r&&F(e)}}}function t_(t){let e=0;for(let o=0;o<t.length;o++)e=t.charCodeAt(o)+((e<<5)-e),e=e&e;const i=e*.618033988749895%1*360,r=65+e%20,s=80+e%10;return`hsl(${Math.floor(i)}, ${r}%, ${s}%)`}function n_(t,e,n){let i,r,s,{selectedDocuments:o=[]}=e,{documentSetStore:l}=e;const{buildAlignedImageMatrix:a,documentNodes:c,imageNodes:u}=l;me(t,c,m=>n(1,r=m)),me(t,u,m=>n(2,s=m));let h=null;function f(m,p){if(!m)return;const g=m.id;if(p.get(g)!==1)return d.has(g)||d.set(g,t_(g)),d.get(g)}const d=new Map;return t.$$set=m=>{"selectedDocuments"in m&&n(7,o=m.selectedDocuments),"documentSetStore"in m&&n(8,l=m.documentSetStore)},t.$$.update=()=>{if(t.$$.dirty&134)if(o.length>0&&s&&r){const m=o.map(p=>p.id);n(0,h=a(m))}else n(0,h=null);t.$$.dirty&1&&n(3,i=h?(()=>{const m=new Map;return h.rows.forEach(p=>{Object.values(p).forEach(g=>{m.set(g.id,(m.get(g.id)||0)+1)})}),m})():new Map)},[h,r,s,i,c,u,f,o,l]}class i_ extends be{constructor(e){super(),ye(this,e,n_,e_,_e,{selectedDocuments:7,documentSetStore:8})}}const jy="";function ea(t,e,n){const i=t.slice();return i[15]=e[n],i}function r_(t){let e;return{c(){e=w("span"),e.innerHTML='<i class="fas fa-crop-alt"></i>',v(e,"class","icon px-4")},m(n,i){V(n,e,i)},d(n){n&&F(e)}}}function s_(t){let e;return{c(){e=w("span"),e.innerHTML='<i class="fas fa-hand-pointer"></i>',v(e,"class","icon px-4")},m(n,i){V(n,e,i)},d(n){n&&F(e)}}}function ta(t){let e,n,i,r;const s=[l_,o_],o=[];function l(a,c){return a[0]==="img"?0:a[0]==="doc"?1:-1}return~(e=l(t))&&(n=o[e]=s[e](t)),{c(){n&&n.c(),i=Ge()},m(a,c){~e&&o[e].m(a,c),V(a,i,c),r=!0},p(a,c){let u=e;e=l(a),e===u?~e&&o[e].p(a,c):(n&&(Ee(),K(o[u],1,1,()=>{o[u]=null}),Ce()),~e?(n=o[e],n?n.p(a,c):(n=o[e]=s[e](a),n.c()),H(n,1),n.m(i.parentNode,i)):n=null)},i(a){r||(H(n),r=!0)},o(a){K(n),r=!1},d(a){~e&&o[e].d(a),a&&F(i)}}}function o_(t){let e,n;return e=new i_({props:{selectedDocuments:t[5],documentSetStore:t[1]}}),{c(){ue(e.$$.fragment)},m(i,r){ae(e,i,r),n=!0},p(i,r){const s={};r&32&&(s.selectedDocuments=i[5]),r&2&&(s.documentSetStore=i[1]),e.$set(s)},i(i){n||(H(e.$$.fragment,i),n=!0)},o(i){K(e.$$.fragment,i),n=!1},d(i){ce(e,i)}}}function l_(t){let e,n,i=W==="en"?"Selected regions":"Régions sélectionnées",r,s,o=t[5].length+"",l,a,c,u,h=[],f=new Map,d,m=t[5];const p=g=>g[15].id;for(let g=0;g<m.length;g+=1){let _=ea(t,m,g),S=p(_);f.set(S,h[g]=na(S,_))}return{c(){e=w("div"),n=w("h3"),r=se(i),s=se(" ("),l=se(o),a=se(")"),c=q(),u=w("div");for(let g=0;g<h.length;g+=1)h[g].c();v(n,"class","title is-5"),v(u,"class","selected-nodes grid is-gap-2 mt-5 svelte-1a3kdxu"),v(e,"class","selected-panel box mt-4 svelte-1a3kdxu")},m(g,_){V(g,e,_),y(e,n),y(n,r),y(n,s),y(n,l),y(n,a),y(e,c),y(e,u);for(let S=0;S<h.length;S+=1)h[S]&&h[S].m(u,null);d=!0},p(g,_){(!d||_&32)&&o!==(o=g[5].length+"")&&ve(l,o),_&32&&(m=g[5],Ee(),h=vr(h,_,p,1,g,m,f,u,_r,na,null,ea),Ce())},i(g){if(!d){for(let _=0;_<m.length;_+=1)H(h[_]);d=!0}},o(g){for(let _=0;_<h.length;_+=1)K(h[_]);d=!1},d(g){g&&F(e);for(let _=0;_<h.length;_+=1)h[_].d()}}}function na(t,e){let n,i,r;return i=new Rn({props:{item:e[15],selectable:!1,copyable:!1}}),{key:t,first:null,c(){n=Ge(),ue(i.$$.fragment),this.first=n},m(s,o){V(s,n,o),ae(i,s,o),r=!0},p(s,o){e=s;const l={};o&32&&(l.item=e[15]),i.$set(l)},i(s){r||(H(i.$$.fragment,s),r=!0)},o(s){K(i.$$.fragment,s),r=!1},d(s){s&&F(n),ce(i,s)}}}function a_(t){let e,n,i,r=t[3]?"click":"selection",s,o,l,a,c,u,h,f;function d(_,S){return _[3]?s_:r_}let m=d(t),p=m(t),g=t[5].length>0&&ta(t);return{c(){e=w("div"),n=w("button"),p.c(),i=se(`
        Switch to `),s=se(r),o=se(" mode"),l=q(),a=w("div"),c=q(),g&&g.c(),v(n,"class","toggle-button button is-small is-link mb-3"),v(a,"class","visualization-container")},m(_,S){V(_,e,S),y(e,n),p.m(n,null),y(n,i),y(n,s),y(n,o),y(e,l),y(e,a),t[9](a),y(e,c),g&&g.m(e,null),u=!0,h||(f=pe(n,"click",t[7]),h=!0)},p(_,[S]){m!==(m=d(_))&&(p.d(1),p=m(_),p&&(p.c(),p.m(n,i))),(!u||S&8)&&r!==(r=_[3]?"click":"selection")&&ve(s,r),_[5].length>0?g?(g.p(_,S),S&32&&H(g,1)):(g=ta(_),g.c(),H(g,1),g.m(e,null)):g&&(Ee(),K(g,1,1,()=>{g=null}),Ce())},i(_){u||(H(g),u=!0)},o(_){K(g),u=!1},d(_){_&&F(e),p.d(),t[9](null),g&&g.d(),h=!1,f()}}}const c_=1e3;function u_(t,e,n){let i,r,s=Z,o=()=>(s(),s=di(i,b=>n(8,r=b)),i),l;t.$$.on_destroy.push(()=>s());let{type:a="img"}=e,{documentSetStore:c}=e;const{imageNetwork:u,documentNetwork:h,selectedNodes:f,updateSelectedNodes:d}=c;me(t,f,b=>n(5,l=b));let m,p,g=!1;function _(){m&&(m.destroy(),d([]));function b(P){d(P)}m=(r.nodes.length<c_?jg:Ng)(p,r.nodes,r.links,b,P=>{n(3,g=P)}),n(3,g=a==="img"),g&&m.toggleSelectionMode()}function S(){m&&n(3,g=m.toggleSelectionMode())}Un(()=>{m==null||m.destroy()});function C(b){Sn[b?"unshift":"push"](()=>{p=b,n(2,p)})}return t.$$set=b=>{"type"in b&&n(0,a=b.type),"documentSetStore"in b&&n(1,c=b.documentSetStore)},t.$$.update=()=>{t.$$.dirty&1&&o(n(4,i=a==="img"?u:h)),t.$$.dirty&260&&r&&p&&_()},[a,c,p,g,i,l,f,S,r,C]}class f_ extends be{constructor(e){super(),ye(this,e,u_,a_,_e,{type:0,documentSetStore:1})}}const Fy="";function ia(t,e,n){const i=t.slice();return i[25]=e[n],i}function ra(t,e,n){const i=t.slice();return i[25]=e[n],i}function h_(t){let e,n,i,r,s,o,l,a,c,u,h,f,d,m,p,g,_,S,C,b,k,P,A,E=t[4].docs,M=[];for(let N=0;N<E.length;N+=1)M[N]=sa(ra(t,E,N));const D=N=>K(M[N],1,1,()=>{M[N]=null});let $=t[4].docs,R=[];for(let N=0;N<$.length;N+=1)R[N]=oa(ia(t,$,N));const z=N=>K(R[N],1,1,()=>{R[N]=null});let I=t[2]&&la(t);return{c(){e=w("div"),n=w("div"),i=w("div"),r=w("label"),r.textContent="Ordre",s=q(),o=w("div"),l=w("div"),a=w("select"),c=w("option"),c.textContent="Par nom",u=w("option"),u.textContent="Par score",h=q(),f=w("div"),d=w("div");for(let N=0;N<M.length;N+=1)M[N].c();m=q(),p=w("div"),g=w("div");for(let N=0;N<R.length;N+=1)R[N].c();_=q(),S=w("div"),C=q(),I&&I.c(),b=Ge(),v(r,"class","label"),c.__value="name",c.value=c.__value,u.__value="score",u.value=u.__value,t[3]===void 0&&Dt(()=>t[15].call(a)),v(l,"class","select"),v(o,"class","control"),v(i,"class","field"),v(d,"class","row-headers svelte-1ji3et5"),v(g,"class","col-headers svelte-1ji3et5"),v(p,"class","matrix-main svelte-1ji3et5"),v(f,"class","matrix-wrapper svelte-1ji3et5"),v(n,"class","box"),v(e,"class","column is-half")},m(N,x){V(N,e,x),y(e,n),y(n,i),y(i,r),y(i,s),y(i,o),y(o,l),y(l,a),y(a,c),y(a,u),Ls(a,t[3],!0),y(n,h),y(n,f),y(f,d);for(let L=0;L<M.length;L+=1)M[L]&&M[L].m(d,null);y(f,m),y(f,p),y(p,g);for(let L=0;L<R.length;L+=1)R[L]&&R[L].m(g,null);y(p,_),y(p,S),t[16](S),V(N,C,x),I&&I.m(N,x),V(N,b,x),k=!0,P||(A=pe(a,"change",t[15]),P=!0)},p(N,x){if(x&8&&Ls(a,N[3]),x&16){E=N[4].docs;let L;for(L=0;L<E.length;L+=1){const B=ra(N,E,L);M[L]?(M[L].p(B,x),H(M[L],1)):(M[L]=sa(B),M[L].c(),H(M[L],1),M[L].m(d,null))}for(Ee(),L=E.length;L<M.length;L+=1)D(L);Ce()}if(x&16){$=N[4].docs;let L;for(L=0;L<$.length;L+=1){const B=ia(N,$,L);R[L]?(R[L].p(B,x),H(R[L],1)):(R[L]=oa(B),R[L].c(),H(R[L],1),R[L].m(g,null))}for(Ee(),L=$.length;L<R.length;L+=1)z(L);Ce()}N[2]?I?I.p(N,x):(I=la(N),I.c(),I.m(b.parentNode,b)):I&&(I.d(1),I=null)},i(N){if(!k){for(let x=0;x<E.length;x+=1)H(M[x]);for(let x=0;x<$.length;x+=1)H(R[x]);k=!0}},o(N){M=M.filter(Boolean);for(let x=0;x<M.length;x+=1)K(M[x]);R=R.filter(Boolean);for(let x=0;x<R.length;x+=1)K(R[x]);k=!1},d(N){N&&F(e),We(M,N),We(R,N),t[16](null),N&&F(C),I&&I.d(N),N&&F(b),P=!1,A()}}}function d_(t){let e;return{c(){e=w("div"),e.innerHTML='<div class="notification is-info">Aucun document disponible</div>',v(e,"class","column")},m(n,i){V(n,e,i)},p:Z,i:Z,o:Z,d(n){n&&F(e)}}}function sa(t){let e,n,i,r;return n=new Ei({props:{id:t[25].id,meta:t[25],onlyColor:!0,clickable:!1}}),{c(){e=w("div"),ue(n.$$.fragment),i=q(),v(e,"class","header-item svelte-1ji3et5"),Re(e,"height",si+"px")},m(s,o){V(s,e,o),ae(n,e,null),y(e,i),r=!0},p(s,o){const l={};o&16&&(l.id=s[25].id),o&16&&(l.meta=s[25]),n.$set(l)},i(s){r||(H(n.$$.fragment,s),r=!0)},o(s){K(n.$$.fragment,s),r=!1},d(s){s&&F(e),ce(n)}}}function oa(t){let e,n,i,r;return n=new Ei({props:{id:t[25].id,meta:t[25],onlyColor:!0,clickable:!1}}),{c(){e=w("div"),ue(n.$$.fragment),i=q(),v(e,"class","header-item svelte-1ji3et5"),Re(e,"width",si+"px")},m(s,o){V(s,e,o),ae(n,e,null),y(e,i),r=!0},p(s,o){const l={};o&16&&(l.id=s[25].id),o&16&&(l.meta=s[25]),n.$set(l)},i(s){r||(H(n.$$.fragment,s),r=!0)},o(s){K(n.$$.fragment,s),r=!1},d(s){s&&F(e),ce(n)}}}function la(t){let e,n,i,r,s;return{c(){e=w("div"),n=w("div"),i=w("h4"),i.textContent="Similarité page par page",r=q(),s=xt("svg"),v(i,"class","title is-5"),v(n,"class","box"),v(e,"class","column is-half")},m(o,l){V(o,e,l),y(e,n),y(n,i),y(n,r),y(n,s),t[17](s)},p:Z,d(o){o&&F(e),t[17](null)}}}function m_(t){let e,n,i,r;const s=[d_,h_],o=[];function l(a,c){return a[5].length?1:0}return n=l(t),i=o[n]=s[n](t),{c(){e=w("div"),i.c(),v(e,"class","columns")},m(a,c){V(a,e,c),o[n].m(e,null),r=!0},p(a,[c]){let u=n;n=l(a),n===u?o[n].p(a,c):(Ee(),K(o[u],1,1,()=>{o[u]=null}),Ce(),i=o[n],i?i.p(a,c):(i=o[n]=s[n](a),i.c()),H(i,1),i.m(e,null))},i(a){r||(H(i),r=!0)},o(a){K(i),r=!1},d(a){a&&F(e),o[n].d()}}}const si=30;function p_(t,e,n){let i,r,s,o,l,a,c,{documentSetStore:u}=e;const{documentNodes:h,docPairStats:f,pairIndex:d,documentStats:m}=u;me(t,h,R=>n(14,c=R)),me(t,f,R=>n(13,a=R)),me(t,d,R=>n(18,o=R)),me(t,m,R=>n(12,l=R));let p,g,_=null,S="name";const C={top:100,right:10,bottom:10,left:100};function b(R,z,I){var U;if(!R.length)return{docs:[],matrix:[],orders:{},maxScore:0};const N=R.length,x=Array(N).fill(0).map(()=>Array(N).fill(0));let L=0;R.forEach((G,X)=>{var ee;G.index=X,G.count=((ee=I==null?void 0:I.get(G.id))==null?void 0:ee.count)||0});for(let G=0;G<N;G++)for(let X=0;X<N;X++)if(G!==X){const ee=R[G].id<R[X].id?`${R[G].id}-${R[X].id}`:`${R[X].id}-${R[G].id}`,Q=((U=z==null?void 0:z.get(ee))==null?void 0:U.score)||0;Q>L&&(L=Q),x[G][X]={x:X,y:G,z:Q}}else x[G][X]={x:X,y:G,z:0,diagonal:!0};const B={name:Ni(N).sort((G,X)=>R[G].title.localeCompare(R[X].title)),score:Ni(N).sort((G,X)=>R[X].count-R[G].count)};return{docs:R,matrix:x,orders:B,maxScore:L}}function k(R){const{doc1:z,doc2:I}=R,N=z.id<I.id?`${z.id}-${I.id}`:`${I.id}-${z.id}`,x=o.byDocPair.get(N)||[];if(!x.length)return null;const L=new Map;let B=1/0,U=-1/0;return x.forEach(X=>{const[ee,Q,Y]=X.regions_id_1===z.id?[X.page_1,X.page_2,X.weightedScore||0]:[X.page_2,X.page_1,X.weightedScore||0],oe=`${ee}-${Q}`;L.has(oe)||L.set(oe,{page1:ee,page2:Q,scores:[]}),L.get(oe).scores.push(Y),Y<B&&(B=Y),Y>U&&(U=Y)}),{points:Array.from(L.values()).map(({page1:X,page2:ee,scores:Q})=>({page1:X,page2:ee,score:Q.reduce((Y,oe)=>Y+oe,0)/Q.length,count:Q.length})),minScore:B,maxScore:U,doc1:z,doc2:I}}function P(){if(!p||!r.docs.length)return;const{docs:R,matrix:z,maxScore:I}=r,N=R.length*si,x=R.length*si;Fe(p).selectAll("*").remove();const B=Fe(p).append("svg").attr("width",N+C.left+C.right).attr("height",x+C.top+C.bottom).append("g").attr("transform",`translate(${C.left},${C.top})`),U=ns().range([0,N]).domain(Ni(R.length)).padding(.01),G=Fe("body").append("div").attr("class","tooltip").style("position","fixed").style("background","white").style("border","1px solid #ddd").style("border-radius","4px").style("padding","8px").style("pointer-events","none").style("opacity",0).style("font-size","12px").style("box-shadow","0 2px 4px rgba(0,0,0,0.1)").style("z-index","9999");B.selectAll(".row").data(z).join("g").attr("class","row").attr("transform",(ee,Q)=>`translate(0,${U(Q)})`).each(function(ee){Fe(this).selectAll(".cell").data(ee.filter(Q=>Q.z>0||Q.diagonal)).join("rect").attr("class","cell").attr("x",Q=>U(Q.x)).attr("width",U.bandwidth()).attr("height",U.bandwidth()).attr("fill",Q=>{if(Q.diagonal)return"#e8e8e8";const Y=zr(233,.951,.52);return Y.opacity=I>0?Q.z/I:0,Y}).attr("stroke","#fff").attr("stroke-width",.5).style("opacity",.8).style("cursor",Q=>Q.diagonal?"default":"pointer").on("mouseover",function(Q,Y){Y.diagonal||(Fe(this).attr("stroke","#000").attr("stroke-width",2).style("opacity",1),G.style("opacity",1))}).on("mousemove",function(Q,Y){Y.diagonal||G.html(`<strong>${R[Y.y].title}</strong><br/>↔<br/><strong>${R[Y.x].title}</strong><br/><br/>Score: ${Y.z.toFixed(2)}`).style("left",Q.clientX+15+"px").style("top",Q.clientY+15+"px")}).on("mouseleave",function(){Fe(this).attr("stroke","#fff").attr("stroke-width",.5).style("opacity",.8),G.style("opacity",0)}).on("click",(Q,Y)=>{Y.diagonal||n(2,_={row:Y.y,col:Y.x,doc1:R[Y.y],doc2:R[Y.x]})})}),E()}function A(){if(!g||!(s!=null&&s.points.length))return;Fe(g).selectAll("*").remove();const{points:R,minScore:z,maxScore:I,doc1:N,doc2:x}=s,L={top:40,right:20,bottom:60,left:70},B=500-L.left-L.right,U=500-L.top-L.bottom,X=Fe(g).attr("width",500).attr("height",500).append("g").attr("transform",`translate(${L.left},${L.top})`),ee=Math.max(...R.map(fe=>fe.page1)),Q=Math.max(...R.map(fe=>fe.page2)),Y=rs().domain([0,ee]).range([0,B]),oe=rs().domain([0,Q]).range([U,0]);X.append("g").attr("transform",`translate(0,${U})`).call(th(Y).ticks(Math.min(ee,10))),X.append("g").call(nh(oe).ticks(Math.min(Q,10))),X.append("text").attr("x",B/2).attr("y",U+40).attr("text-anchor","middle").attr("font-size","12px").text(`${N.title} (page)`),X.append("text").attr("transform","rotate(-90)").attr("x",-U/2).attr("y",-50).attr("text-anchor","middle").attr("font-size","12px").text(`${x.title} (page)`),X.selectAll(".point").data(R).join("circle").attr("cx",fe=>Y(fe.page1)).attr("cy",fe=>oe(fe.page2)).attr("r",4).attr("fill",fe=>{const ke=zr(233,.951,.52);return ke.opacity=(fe.score-z)/(I-z),ke}).attr("opacity",.7)}function E(){if(!p||!r.orders[S])return;const{docs:R,orders:z}=r,I=ns().range([0,R.length*si]).domain(z[S]).padding(.01);Fe(p).select("svg").select("g").transition().duration(1500).selectAll(".row").delay((L,B)=>I(B)*2).attr("transform",(L,B)=>`translate(0,${I(B)})`).selectAll(".cell").delay(L=>I(L.x)*2).attr("x",L=>I(L.x))}function M(){S=zc(this),n(3,S)}function D(R){Sn[R?"unshift":"push"](()=>{p=R,n(0,p)})}function $(R){Sn[R?"unshift":"push"](()=>{g=R,n(1,g)})}return t.$$set=R=>{"documentSetStore"in R&&n(10,u=R.documentSetStore)},t.$$.update=()=>{t.$$.dirty&16384&&n(5,i=Array.from((c==null?void 0:c.values())||[])),t.$$.dirty&12320&&n(4,r=b(i,a.scoreCount,l.scoreCount)),t.$$.dirty&4&&n(11,s=_?k(_):null),t.$$.dirty&17&&p&&r.docs.length&&P(),t.$$.dirty&2050&&g&&s&&A(),t.$$.dirty&9&&S&&p&&E()},[p,g,_,S,r,i,h,f,d,m,u,s,l,a,c,M,D,$]}class g_ extends be{constructor(e){super(),ye(this,e,p_,m_,_e,{documentSetStore:10})}}const aa="https://vhs.huma-num.fr",__=()=>new Worker("/static/js/pairWorker.js",{type:"module"});function v_(t){const e=we(null),n=we([]),i=we(new Set),r=we([]),s=we(0),o=we(3),l=we(!1),a=we("threshold"),c=we([]),u=we(new Map);let h;const f=we({byImage:new Map,byDocPair:new Map,byDoc:new Map}),d=we(new Map),m=we(new Map),p=we({}),g=we({}),_=we({}),S=we({}),C=we({documents:0,pairs:null,images:0,categories:{}}),b=Be(n,(N,x)=>{if(N.length===0){x(Promise.resolve(0));return}h&&h.terminate();const L=414,B=new Promise((U,G)=>{(async()=>{try{const ee=await fetch(`${aa}/document-set/${L}/pairs?category=${N.join(",")}`);if(!ee.ok)throw new Error(`HTTP ${ee.status}`);const Q=await ee.json();h=__(),h.postMessage({rawPairs:Q,selectedCategories:N}),h.onmessage=async Y=>{const{allPairs:oe,imageNodes:fe,pairIndex:ke,categories:ie,stats:ze}=Y.data;f.set(ke),p.set(ze.pairStats),g.set(ze.documentStats),_.set(ze.imageStats),S.set(ze.docPairStats);const Xe=Array.from(ze.documentStats.scoreCount.keys());Ke(i).size===0&&i.set(new Set(Xe));const Me=await Promise.all(Xe.map(Te=>k(Te).then(Je=>({id:Te,info:Je})))),Ve=new Map;Me.forEach(({id:Te,info:Je})=>Ve.set(Te,Je)),u.set(Ve);const at=new Map;Xe.forEach((Te,Je)=>{const He=Ve.get(Te)||{};at.set(Te,{id:Te,title:He.title||`Region Extraction ${Te}`,color:He.color||hu(Je),images:[],...He})}),fe.forEach(Te=>{const Je=at.get(Te.regionId);Je&&(Te.color=Je.color,Te.title=`${Je.title} | Page ${Te.canvas}`,Je.images.push(Te))}),at.forEach(Te=>Te.images.sort((Je,He)=>Je.canvas-He.canvas)),d.set(fe),m.set(at),C.set({documents:Xe.length,pairs:oe.length,images:fe.size,categories:ie}),c.set(oe),h.terminate(),h=null,U(oe.length)},h.onerror=Y=>{console.error("Worker error",Y);const oe=`Error processing pairs: ${Y.message}`;e.set(oe),G(new Error(oe))}}catch(ee){const Q=`Fetch error: ${ee.message}`;e.set(Q),G(new Error(Q))}})()});x(B)});async function k(N){try{const x=await fetch(`${aa}/search/regions/?id=${N}`);if(!x.ok)throw new Error(`HTTP ${x.status}`);const{results:L}=await x.json();if(!(L!=null&&L.length))return{title:`Region Extraction ${N}`};const B=L[0],[,...U]=B.title.split(" | "),[G,X]=(B.ref||"_").split("_");return{title:U.join(" | "),ref:B.ref,witnessId:br(G),digitizationRef:X,zeros:B.zeros,img_nb:B.img_nb,url:B.url}}catch(x){return e.set(`Error fetching region #${N}: ${x.message}`),{title:`Region Extraction ${N}`}}}const P=Be([c,s,o,l,i],([N,x,L,B,U])=>{if(!N)return[];const G=[],X=Ke(a);for(let ee=0;ee<N.length;ee++){const Q=N[ee];if(X==="threshold"&&Q.weightedScore<x)break;if(!(!U.has(Q.regions_id_1)||!U.has(Q.regions_id_2))){if(X==="topk"&&L!==null){const Y=Q.rank_1??1/0,oe=Q.rank_2??1/0;if(B){if(Y>L||oe>L)continue}else if(Y>L&&oe>L)continue}G.push(Q)}}return G}),A=Be([P,m],([N,x])=>{if(!N.length||x.size===0)return[];const L=new Set;for(const U of N)L.add(U.regions_id_1),L.add(U.regions_id_2);const B=[];return L.forEach(U=>{const G=x.get(U);G&&B.push(G)}),B.sort((U,G)=>G.id-U.id)});function E(N,x,L=10,B=200,U=2,G=25){if(!x)return{strength:.5,distance:100,width:2};const{min:X,_:ee,range:Q}=x,Y=Q===0?.5:(N-X)/Q,oe=B-Y*(B-L),fe=U+Y*(G-U);return{strength:Y,distance:oe,width:fe}}function M(N,x,L=10,B=60){if(!x)return L;const{min:U,_:G,range:X}=x;return X===0?(L+B)/2:L+(N-U)/X*(B-L)}const D=Be([P],([N])=>{var ee;const x=Ke(d),L=Ke(_),B=Ke(p),U=new Set,G=[];for(const Q of N){const{strength:Y,distance:oe,width:fe}=E(Q.weightedScore,B.scoreRange);G.push({source:Q.id_1,target:Q.id_2,strength:Y,distance:oe,width:fe}),U.has(Q.id_1)||U.add(Q.id_1),U.has(Q.id_2)||U.add(Q.id_2)}const X=[];for(const Q of U){const Y=x.get(Q);if(Y){const oe=(ee=L.scoreCount)==null?void 0:ee.get(Q),{count:fe,score:ke}=oe;X.push({...Y,radius:M(ke,L.scoreRange),label:`Region: ${Y.regionId}
Page: ${Y.canvas}
Connections: ${fe}
Total score: ${ke.toFixed(2)}`})}}return{nodes:X,links:G}}),$=Be(A,N=>{const x=Ke(S),L=Ke(g);if(N.size===0)return{nodes:[],links:[]};const B=Array.from(N.values()).map(G=>{var Y;const X=(Y=L.scoreCount)==null?void 0:Y.get(G.id),{count:ee,score:Q}=X;return{...G,radius:M(ee,L.countRange),label:`${G.title}
Images: ${ee}
Total score: ${Q.toFixed(2)}`}}),U=Array.from(x.scoreCount.entries()).map(([G,X])=>{const[ee,Q]=G.split("-").map(Number),{strength:Y,distance:oe,width:fe}=E(X.score,x.scoreRange);return{source:ee,target:Q,strength:Y,distance:oe,width:fe}});return{nodes:B,links:U}});function R(N){if(!N.length)return{regions:[],rows:[]};const x=Ke(m),L=Ke(f),B=N[0],U=x.get(B);if(!(U!=null&&U.images))return{regions:N,rows:[]};const G=U.images,X=(oe,fe,ke)=>{const{r1:ie,r2:ze}={r1:fe,r2:ke},Xe=ie<ze?`${ie}-${ze}`:`${ze}-${ie}`;return(L.byDocPair.get(Xe)||[]).map(Me=>Me.id_1===oe&&Me.regions_id_1===fe?{id:Me.id_2,page:Me.page_2}:Me.id_2===oe&&Me.regions_id_2===fe?{id:Me.id_1,page:Me.page_1}:null).filter(Boolean)},ee=[];for(const oe of G){let fe=[{[B]:{id:oe.id,page:oe.canvas}}];for(let ke=1;ke<N.length;ke++){const ie=N[ke],ze=[];for(const Xe of fe){const Ut=[];for(let Me=0;Me<ke;Me++){const Ve=N[Me];if(Xe[Ve]){const at=X(Xe[Ve].id,Ve,ie);Ut.push(...at)}}if(Ut.length===0)ze.push(Xe);else{const Me=new Map;Ut.forEach(Ve=>{Me.has(Ve.id)||Me.set(Ve.id,Ve)});for(const Ve of Me.values()){const at={...Xe,[ie]:Ve};ze.push(at)}}}fe=ze}ee.push(...fe)}const Q=[],Y=new Set;for(const oe of ee){const fe=N.map(ke=>{var ie;return((ie=oe[ke])==null?void 0:ie.id)||""}).join("|");Y.has(fe)||(Y.add(fe),Q.push(oe))}return{regions:N,rows:Q}}function z(N){n.update(x=>x.indexOf(N)>-1?x.filter(B=>B!==N):[...x,N].sort((B,U)=>B-U))}function I(N){i.update(x=>{const L=new Set(x);return L.has(N)?L.delete(N):L.add(N),L})}return{error:e,allPairs:c,visiblePairs:P,pairIndex:f,documentNodes:m,imageNodes:d,fetchPairs:b,imageNetwork:D,documentNetwork:$,selectedCategories:n,pairStats:p,documentStats:g,imageStats:_,docPairStats:S,docSetNumber:C,selectedNodes:r,selectedRegions:i,updateSelectedNodes:N=>r.set(N),toggleCategory:z,toggleRegion:I,buildAlignedImageMatrix:R,threshold:s,setThreshold:N=>s.set(N),topK:o,setTopK:N=>o.set(N),mutualTopK:l,setMutualTopK:N=>l.set(N),scoreMode:a,setScoreMode:N=>a.set(N)}}function ca(t){let e,n,i,r,s,o=(t[0].clusters||0)+"",l;return{c(){e=w("div"),n=w("div"),i=w("p"),i.textContent="Clusters",r=q(),s=w("p"),l=se(o),v(i,"class","heading"),v(s,"class","title is-5"),v(e,"class","level-item")},m(a,c){V(a,e,c),y(e,n),y(n,i),y(n,r),y(n,s),y(s,l)},p(a,c){c&1&&o!==(o=(a[0].clusters||0)+"")&&ve(l,o)},d(a){a&&F(e)}}}function y_(t){var $,R,z;let e,n,i,r,s,o,l=(t[0].count||0)+"",a,c,u,h,f,d,m,p=(t[0].links||0)+"",g,_,S,C,b,k,P,A,E=(((R=($=t[0])==null?void 0:$.density)==null?void 0:R.toFixed(3))||0)+"",M,D=((z=t[0])==null?void 0:z.clusters)&&ca(t);return{c(){e=w("div"),n=w("div"),i=w("div"),r=w("p"),r.textContent=`${W==="en"?"Nodes":"Nœuds"}`,s=q(),o=w("p"),a=se(l),c=q(),u=w("div"),h=w("div"),f=w("p"),f.textContent=`${W==="en"?"Edges":"Liens"}`,d=q(),m=w("p"),g=se(p),_=q(),D&&D.c(),S=q(),C=w("div"),b=w("div"),k=w("p"),k.textContent=`${W==="en"?"Density":"Densité"}`,P=q(),A=w("p"),M=se(E),v(r,"class","heading"),v(o,"class","title is-5"),v(n,"class","level-item"),v(f,"class","heading"),v(m,"class","title is-5"),v(u,"class","level-item"),v(k,"class","heading"),v(A,"class","title is-5"),v(C,"class","level-item"),v(e,"class","level has-text-centered")},m(I,N){V(I,e,N),y(e,n),y(n,i),y(i,r),y(i,s),y(i,o),y(o,a),y(e,c),y(e,u),y(u,h),y(h,f),y(h,d),y(h,m),y(m,g),y(e,_),D&&D.m(e,null),y(e,S),y(e,C),y(C,b),y(b,k),y(b,P),y(b,A),y(A,M)},p(I,[N]){var x,L,B;N&1&&l!==(l=(I[0].count||0)+"")&&ve(a,l),N&1&&p!==(p=(I[0].links||0)+"")&&ve(g,p),(x=I[0])!=null&&x.clusters?D?D.p(I,N):(D=ca(I),D.c(),D.m(e,S)):D&&(D.d(1),D=null),N&1&&E!==(E=(((B=(L=I[0])==null?void 0:L.density)==null?void 0:B.toFixed(3))||0)+"")&&ve(M,E)},i:Z,o:Z,d(I){I&&F(e),D&&D.d()}}}function b_(t,e,n){let i,r,s,o,{activeTab:l="img"}=e,{documentSetStore:a}=e;const{imageStats:c,documentStats:u,docPairStats:h}=a;return me(t,c,f=>n(8,o=f)),me(t,u,f=>n(7,s=f)),me(t,h,f=>n(6,r=f)),t.$$set=f=>{"activeTab"in f&&n(4,l=f.activeTab),"documentSetStore"in f&&n(5,a=f.documentSetStore)},t.$$.update=()=>{t.$$.dirty&464&&n(0,i=l==="img"?o:l==="doc"?s:r)},[i,c,u,h,l,a,r,s,o]}class w_ extends be{constructor(e){super(),ye(this,e,b_,y_,_e,{activeTab:4,documentSetStore:5})}}function S_(t){let e,n,i;const r=t[1].default,s=Et(r,t,t[0],null);return{c(){e=w("table"),n=w("tbody"),s&&s.c(),v(e,"class","table is-fullwidth")},m(o,l){V(o,e,l),y(e,n),s&&s.m(n,null),i=!0},p(o,[l]){s&&s.p&&(!i||l&1)&&It(s,r,o,o[0],i?Ct(r,o[0],l,null):Mt(o[0]),null)},i(o){i||(H(s,o),i=!0)},o(o){K(s,o),i=!1},d(o){o&&F(e),s&&s.d(o)}}}function k_(t,e,n){let{$$slots:i={},$$scope:r}=e;return t.$$set=s=>{"$$scope"in s&&n(0,r=s.$$scope)},[r,i]}class E_ extends be{constructor(e){super(),ye(this,e,k_,S_,_e,{})}}const C_=t=>({}),ua=t=>({}),I_=t=>({}),fa=t=>({}),M_=t=>({}),ha=t=>({});function x_(t){let e;const n=t[4]["row-body"],i=Et(n,t,t[3],ua);return{c(){i&&i.c()},m(r,s){i&&i.m(r,s),e=!0},p(r,s){i&&i.p&&(!e||s&8)&&It(i,n,r,r[3],e?Ct(n,r[3],s,C_):Mt(r[3]),ua)},i(r){e||(H(i,r),e=!0)},o(r){K(i,r),e=!1},d(r){i&&i.d(r)}}}function A_(t){let e,n,i,r;const s=t[4]["row-body"],o=Et(s,t,t[3],fa);return{c(){e=w("div"),n=w("div"),o&&o.c(),v(n,"class","grid is-gap-2"),v(e,"class",i="fixed-grid has-"+t[2]+"-cols")},m(l,a){V(l,e,a),y(e,n),o&&o.m(n,null),r=!0},p(l,a){o&&o.p&&(!r||a&8)&&It(o,s,l,l[3],r?Ct(s,l[3],a,I_):Mt(l[3]),fa),(!r||a&4&&i!==(i="fixed-grid has-"+l[2]+"-cols"))&&v(e,"class",i)},i(l){r||(H(o,l),r=!0)},o(l){K(o,l),r=!1},d(l){l&&F(e),o&&o.d(l)}}}function T_(t){let e,n,i,r,s,o,l,a,c,u;Dt(t[5]);const h=t[4]["row-header"],f=Et(h,t,t[3],ha),d=[A_,x_],m=[];function p(g,_){return g[0]?0:1}return o=p(t),l=m[o]=d[o](t),{c(){e=w("tr"),n=w("th"),i=w("div"),f&&f.c(),r=q(),s=w("td"),l.c(),v(i,"class","content-wrapper py-5"),v(n,"class","is-3 center-flex is-narrow"),Re(n,"width","15vw"),v(s,"class","p-5 is-fullwidth")},m(g,_){V(g,e,_),y(e,n),y(n,i),f&&f.m(i,null),y(e,r),y(e,s),m[o].m(s,null),a=!0,c||(u=pe(window,"resize",t[5]),c=!0)},p(g,[_]){f&&f.p&&(!a||_&8)&&It(f,h,g,g[3],a?Ct(h,g[3],_,M_):Mt(g[3]),ha);let S=o;o=p(g),o===S?m[o].p(g,_):(Ee(),K(m[S],1,1,()=>{m[S]=null}),Ce(),l=m[o],l?l.p(g,_):(l=m[o]=d[o](g),l.c()),H(l,1),l.m(s,null))},i(g){a||(H(f,g),H(l),a=!0)},o(g){K(f,g),K(l),a=!1},d(g){g&&F(e),f&&f.d(g),m[o].d(),c=!1,u()}}}function N_(t,e,n){let i,{$$slots:r={},$$scope:s}=e,{useGrid:o=!0}=e,l=0;function a(){n(1,l=window.innerWidth)}return t.$$set=c=>{"useGrid"in c&&n(0,o=c.useGrid),"$$scope"in c&&n(3,s=c.$$scope)},t.$$.update=()=>{t.$$.dirty&2&&n(2,i=Hs(l))},[o,l,i,s,r,a]}class da extends be{constructor(e){super(),ye(this,e,N_,T_,_e,{useGrid:0})}}const Vy="",O_=t=>({}),ma=t=>({}),P_=t=>({}),pa=t=>({});function ga(t){let e,n,i,r,s,o,l,a,c,u,h,f=t[1]&&_a(t);return a=new xi({props:{tooltipText:t[2][t[1]][W]}}),{c(){f&&f.c(),e=q(),n=w("div"),i=w("button"),r=xt("svg"),s=xt("path"),l=q(),ue(a.$$.fragment),v(s,"fill","none"),v(s,"stroke","currentColor"),v(s,"stroke-linecap","round"),v(s,"stroke-linejoin","round"),v(s,"stroke-width","1.5"),v(s,"d","M12 3v18m0 0l8.5-8.5M12 21l-8.5-8.5"),v(r,"style",o=`transform: rotate(${t[1]?"180":"0"}deg)`),v(r,"xmlns","http://www.w3.org/2000/svg"),v(r,"width","24"),v(r,"height","24"),v(r,"viewBox","0 0 24 24"),v(r,"class","svelte-jbs1sd"),v(i,"class","button is-link svelte-jbs1sd"),v(n,"class","ctrl-toggle svelte-jbs1sd")},m(d,m){f&&f.m(d,m),V(d,e,m),V(d,n,m),y(n,i),y(i,r),y(r,s),y(i,l),ae(a,i,null),c=!0,u||(h=pe(i,"click",Bt(t[3])),u=!0)},p(d,m){d[1]?f?(f.p(d,m),m&2&&H(f,1)):(f=_a(d),f.c(),H(f,1),f.m(e.parentNode,e)):f&&(Ee(),K(f,1,1,()=>{f=null}),Ce()),(!c||m&2&&o!==(o=`transform: rotate(${d[1]?"180":"0"}deg)`))&&v(r,"style",o);const p={};m&2&&(p.tooltipText=d[2][d[1]][W]),a.$set(p)},i(d){c||(H(f),H(a.$$.fragment,d),c=!0)},o(d){K(f),K(a.$$.fragment,d),c=!1},d(d){f&&f.d(d),d&&F(e),d&&F(n),ce(a),u=!1,h()}}}function _a(t){let e,n,i;const r=t[5]["toolbar-hidden"],s=Et(r,t,t[4],ma);return{c(){e=w("div"),s&&s.c(),v(e,"class","ctrl-extra")},m(o,l){V(o,e,l),s&&s.m(e,null),i=!0},p(o,l){s&&s.p&&(!i||l&16)&&It(s,r,o,o[4],i?Ct(r,o[4],l,O_):Mt(o[4]),ma)},i(o){i||(H(s,o),Dt(()=>{i&&(n||(n=Zt(e,qs,{axis:"y"},!0)),n.run(1))}),i=!0)},o(o){K(s,o),n||(n=Zt(e,qs,{axis:"y"},!1)),n.run(0),i=!1},d(o){o&&F(e),s&&s.d(o),o&&n&&n.end()}}}function L_(t){let e,n,i,r,s,o,l,a;const c=t[5]["toolbar-visible"],u=Et(c,t,t[4],pa);let h=t[0]&&ga(t);return{c(){e=w("div"),n=w("form"),i=w("div"),r=w("div"),s=w("div"),u&&u.c(),o=q(),h&&h.c(),v(s,"class","ctrl-block svelte-jbs1sd"),v(r,"class","ctrl-block-wrapper svelte-jbs1sd"),v(i,"class","ctrl-base"),v(n,"class","ctrl svelte-jbs1sd"),v(e,"id","toolbar"),v(e,"class",l="ctrl-wrapper is-flex is-justify-content-center is-align-items-center "+(t[1]?"toolbar-expanded":"toolbar-collapsed")+" svelte-jbs1sd")},m(f,d){V(f,e,d),y(e,n),y(n,i),y(i,r),y(r,s),u&&u.m(s,null),y(n,o),h&&h.m(n,null),a=!0},p(f,[d]){u&&u.p&&(!a||d&16)&&It(u,c,f,f[4],a?Ct(c,f[4],d,P_):Mt(f[4]),pa),f[0]?h?(h.p(f,d),d&1&&H(h,1)):(h=ga(f),h.c(),H(h,1),h.m(n,null)):h&&(Ee(),K(h,1,1,()=>{h=null}),Ce()),(!a||d&2&&l!==(l="ctrl-wrapper is-flex is-justify-content-center is-align-items-center "+(f[1]?"toolbar-expanded":"toolbar-collapsed")+" svelte-jbs1sd"))&&v(e,"class",l)},i(f){a||(H(u,f),H(h),a=!0)},o(f){K(u,f),K(h),a=!1},d(f){f&&F(e),u&&u.d(f),h&&h.d()}}}function R_(t,e,n){let i,{$$slots:r={},$$scope:s}=e,{expandable:o=!0}=e;const l={true:{en:"Collapse the toolbar",fr:"Refermer le menu"},false:{en:"Expand the toolbar",fr:"Ouvrir le menu"}},a=()=>n(1,i=!i);return t.$$set=c=>{"expandable"in c&&n(0,o=c.expandable),"$$scope"in c&&n(4,s=c.$$scope)},n(1,i=!1),[o,i,l,a,s,r]}class D_ extends be{constructor(e){super(),ye(this,e,R_,L_,_e,{expandable:0})}}function va(t){let e,n,i,r,s,o,l,a,c,u=t[5]>1&&ya(t),h=t[5]<t[3]&&Sa(t);return{c(){e=w("nav"),n=w("ul"),u&&u.c(),i=q(),r=w("li"),s=w("a"),o=se(t[5]),l=q(),h&&h.c(),v(s,"class","pagination-link is-current"),v(s,"href",null),v(n,"class","pagination-list ml-0"),v(e,"class","pagination is-centered mb-2"),v(e,"aria-label","pagination")},m(f,d){V(f,e,d),y(e,n),u&&u.m(n,null),y(n,i),y(n,r),y(r,s),y(s,o),y(n,l),h&&h.m(n,null),a||(c=pe(s,"click",Bt(t[9])),a=!0)},p(f,d){f[5]>1?u?u.p(f,d):(u=ya(f),u.c(),u.m(n,i)):u&&(u.d(1),u=null),d&32&&ve(o,f[5]),f[5]<f[3]?h?h.p(f,d):(h=Sa(f),h.c(),h.m(n,null)):h&&(h.d(1),h=null)},d(f){f&&F(e),u&&u.d(),h&&h.d(),a=!1,c()}}}function ya(t){let e,n,i,r,s,o,l=t[5]-1>1&&ba(t);return{c(){e=w("li"),n=w("a"),n.textContent="1",i=q(),l&&l.c(),r=Ge(),v(n,"class","pagination-link"),v(n,"href",null)},m(a,c){V(a,e,c),y(e,n),V(a,i,c),l&&l.m(a,c),V(a,r,c),s||(o=pe(n,"click",Bt(t[7])),s=!0)},p(a,c){a[5]-1>1?l?l.p(a,c):(l=ba(a),l.c(),l.m(r.parentNode,r)):l&&(l.d(1),l=null)},d(a){a&&F(e),a&&F(i),l&&l.d(a),a&&F(r),s=!1,o()}}}function ba(t){let e,n,i,r=t[5]-1+"",s,o,l,a=t[5]-1>2&&wa();return{c(){a&&a.c(),e=q(),n=w("li"),i=w("a"),s=se(r),v(i,"class","pagination-link"),v(i,"href",null)},m(c,u){a&&a.m(c,u),V(c,e,u),V(c,n,u),y(n,i),y(i,s),o||(l=pe(i,"click",Bt(t[8])),o=!0)},p(c,u){c[5]-1>2?a||(a=wa(),a.c(),a.m(e.parentNode,e)):a&&(a.d(1),a=null),u&32&&r!==(r=c[5]-1+"")&&ve(s,r)},d(c){a&&a.d(c),c&&F(e),c&&F(n),o=!1,l()}}}function wa(t){let e;return{c(){e=w("li"),e.innerHTML='<span class="pagination-ellipsis">…</span>'},m(n,i){V(n,e,i)},d(n){n&&F(e)}}}function Sa(t){let e,n,i,r,s,o,l=t[5]+1<t[3]&&ka(t);return{c(){l&&l.c(),e=q(),n=w("li"),i=w("a"),r=se(t[3]),v(i,"class","pagination-link"),v(i,"href",null)},m(a,c){l&&l.m(a,c),V(a,e,c),V(a,n,c),y(n,i),y(i,r),s||(o=pe(i,"click",Bt(t[11])),s=!0)},p(a,c){a[5]+1<a[3]?l?l.p(a,c):(l=ka(a),l.c(),l.m(e.parentNode,e)):l&&(l.d(1),l=null),c&8&&ve(r,a[3])},d(a){l&&l.d(a),a&&F(e),a&&F(n),s=!1,o()}}}function ka(t){let e,n,i=t[5]+1+"",r,s,o,l,a,c=t[5]+2<t[3]&&Ea();return{c(){e=w("li"),n=w("a"),r=se(i),s=q(),c&&c.c(),o=Ge(),v(n,"class","pagination-link"),v(n,"href",null)},m(u,h){V(u,e,h),y(e,n),y(n,r),V(u,s,h),c&&c.m(u,h),V(u,o,h),l||(a=pe(n,"click",Bt(t[10])),l=!0)},p(u,h){h&32&&i!==(i=u[5]+1+"")&&ve(r,i),u[5]+2<u[3]?c||(c=Ea(),c.c(),c.m(o.parentNode,o)):c&&(c.d(1),c=null)},d(u){u&&F(e),u&&F(s),c&&c.d(u),u&&F(o),l=!1,a()}}}function Ea(t){let e;return{c(){e=w("li"),e.innerHTML='<span class="pagination-ellipsis">…</span>'},m(n,i){V(n,e,i)},d(n){n&&F(e)}}}function $_(t){let e,n,i=t[5]*t[2]-t[2]+1+"",r,s,o=Math.min(t[5]*t[2],t[1])+"",l,a,c,u,h=t[4]&&va(t);return{c(){h&&h.c(),e=q(),n=w("div"),r=se(i),s=se(" - "),l=se(o),a=se(" / "),c=se(t[1]),v(n,"class",u="is-size-7 is-center mb-4 "+(t[4]?"":"mt-4"))},m(f,d){h&&h.m(f,d),V(f,e,d),V(f,n,d),y(n,r),y(n,s),y(n,l),y(n,a),y(n,c)},p(f,[d]){f[4]?h?h.p(f,d):(h=va(f),h.c(),h.m(e.parentNode,e)):h&&(h.d(1),h=null),d&36&&i!==(i=f[5]*f[2]-f[2]+1+"")&&ve(r,i),d&38&&o!==(o=Math.min(f[5]*f[2],f[1])+"")&&ve(l,o),d&2&&ve(c,f[1]),d&16&&u!==(u="is-size-7 is-center mb-4 "+(f[4]?"":"mt-4"))&&v(n,"class",u)},i:Z,o:Z,d(f){h&&h.d(f),f&&F(e),f&&F(n)}}}function z_(t,e,n){let i,r,s,{store:o}=e;const{currentPage:l}=o;me(t,l,p=>n(5,s=p));let{nbOfItems:a}=e,{pageLength:c=tu}=e;const u=()=>o.handlePageUpdate(1),h=()=>o.handlePageUpdate(s-1),f=()=>o.handlePageUpdate(s),d=()=>o.handlePageUpdate(s+1),m=()=>o.handlePageUpdate(i);return t.$$set=p=>{"store"in p&&n(0,o=p.store),"nbOfItems"in p&&n(1,a=p.nbOfItems),"pageLength"in p&&n(2,c=p.pageLength)},t.$$.update=()=>{t.$$.dirty&6&&n(3,i=c>0?Math.ceil(a/c):1),t.$$.dirty&14&&n(4,r=i>1||a>c)},[o,a,c,i,r,s,l,u,h,f,d,m]}class Ca extends be{constructor(e){super(),ye(this,e,z_,$_,_e,{store:0,nbOfItems:1,pageLength:2})}}function j_(t){let e,n,i,r,s=W==="en"?"Save selection":"Sauvegarder la sélection",o,l,a;return{c(){e=w("button"),n=w("span"),i=w("i"),r=q(),o=se(s),v(i,"class","fa-solid fa-floppy-disk"),v(e,"class","button is-link")},m(c,u){V(c,e,u),y(e,n),y(n,i),y(n,r),y(n,o),l||(a=pe(e,"click",t[7]),l=!0)},p:Z,d(c){c&&F(e),l=!1,a()}}}function F_(t){let e,n,i,r,s=W==="en"?"Go to treatment":"Accéder au traitement",o,l;return{c(){var a;e=w("a"),n=w("span"),i=w("i"),r=q(),o=se(s),v(i,"class","fa-solid fa-gear"),v(e,"class","button is-link"),v(e,"href",l="/"+Tt+"/treatment/add/?document_set="+((a=t[3])==null?void 0:a.id))},m(a,c){V(a,e,c),y(e,n),y(n,i),y(n,r),y(n,o)},p(a,c){var u;c&8&&l!==(l="/"+Tt+"/treatment/add/?document_set="+((u=a[3])==null?void 0:u.id))&&v(e,"href",l)},d(a){a&&F(e)}}}function Ia(t){let e,n,i,r,s,o,l;return{c(){var a,c;e=w("a"),n=w("span"),n.innerHTML='<i class="fa-solid fa-file-export"></i> JSON',r=q(),s=w("a"),o=w("span"),o.innerHTML='<i class="fa-solid fa-file-zipper"></i> ZIP',v(e,"class","button is-link is-dark"),v(e,"href",i="/"+Tt+"/document-set/"+((a=t[3])==null?void 0:a.id)+"/json"),v(e,"target","_blank"),v(s,"class","button is-link is-dark"),v(s,"href",l="/"+Tt+"/document-set/"+((c=t[3])==null?void 0:c.id)+"/zip"),v(s,"target","_blank")},m(a,c){V(a,e,c),y(e,n),V(a,r,c),V(a,s,c),y(s,o)},p(a,c){var u,h;c&8&&i!==(i="/"+Tt+"/document-set/"+((u=a[3])==null?void 0:u.id)+"/json")&&v(e,"href",i),c&8&&l!==(l="/"+Tt+"/document-set/"+((h=a[3])==null?void 0:h.id)+"/zip")&&v(s,"href",l)},d(a){a&&F(e),a&&F(r),a&&F(s)}}}function V_(t){let e,n,i,r,s,o,l;function a(f,d){return f[2]&&!f[1]?F_:j_}let c=a(t),u=c(t),h=!t[1]&&Ia(t);return{c(){e=w("footer"),n=w("div"),i=w("button"),i.textContent=`${W==="en"?"Clear selection":"Vider la sélection"}`,r=q(),u.c(),s=q(),h&&h.c(),v(i,"class","button button-close is-link is-light"),v(n,"class","buttons"),v(e,"class","modal-card-foot is-center")},m(f,d){V(f,e,d),y(e,n),y(n,i),y(n,r),u.m(n,null),y(n,s),h&&h.m(n,null),o||(l=pe(i,"click",t[6]),o=!0)},p(f,[d]){c===(c=a(f))&&u?u.p(f,d):(u.d(1),u=c(f),u&&(u.c(),u.m(n,s))),f[1]?h&&(h.d(1),h=null):h?h.p(f,d):(h=Ia(f),h.c(),h.m(n,null))},i:Z,o:Z,d(f){f&&F(e),u.d(),h&&h.d(),o=!1,l()}}}function H_(t,e,n){let i,r,{selectionStore:s}=e;const{isSaved:o,selection:l}=s;me(t,o,h=>n(2,i=h)),me(t,l,h=>n(3,r=h));let{isRegion:a=s.type!=="documentSet"}=e;const c=()=>s.empty(),u=()=>s.save();return t.$$set=h=>{"selectionStore"in h&&n(0,s=h.selectionStore),"isRegion"in h&&n(1,a=h.isRegion)},[s,a,i,r,o,l,c,u]}class U_ extends be{constructor(e){super(),ye(this,e,H_,V_,_e,{selectionStore:0,isRegion:1})}}const Hy="";function B_(t){let e,n,i,r,s,o;return{c(){e=w("span"),n=se(t[5]),i=q(),r=w("span"),r.innerHTML='<i class="fas fa-edit"></i>',v(r,"class","pl-3 smaller has-text-link")},m(l,a){V(l,e,a),y(e,n),y(e,i),y(e,r),s||(o=[pe(e,"click",t[7]),pe(e,"keyup",null)],s=!0)},p(l,a){a&32&&ve(n,l[5])},d(l){l&&F(e),s=!1,Ze(o)}}}function q_(t){let e,n,i;return{c(){e=w("input"),v(e,"class","input selection-title svelte-sgypdx")},m(r,s){V(r,e,s),t[12](e),gi(e,t[4]),n||(i=[pe(e,"input",t[13]),pe(e,"keydown",t[8]),pe(e,"blur",t[9])],n=!0)},p(r,s){s&16&&e.value!==r[4]&&gi(e,r[4])},d(r){r&&F(e),t[12](null),n=!1,Ze(i)}}}function K_(t){let e,n,i,r,s,o,l,a,c,u,h,f,d,m,p,g,_,S,C,b;function k(D,$){return D[2]?q_:B_}let P=k(t),A=P(t);const E=t[11].default,M=Et(E,t,t[10],null);return _=new U_({props:{selectionStore:t[0]}}),{c(){e=w("div"),n=w("div"),i=q(),r=w("div"),s=w("div"),o=w("div"),l=w("i"),a=q(),A.c(),c=se(`
                (`),u=se(t[1]),h=se(")"),f=q(),d=w("button"),m=q(),p=w("section"),M&&M.c(),g=q(),ue(_.$$.fragment),v(n,"class","modal-background"),v(l,"class","fa-solid fa-book-bookmark"),v(o,"class","title is-4 mb-0 media-content"),v(d,"class","delete media-left"),v(d,"aria-label","close"),v(s,"class","modal-card-head media mb-0 is-middle"),v(p,"class","modal-card-body"),v(r,"class","modal-content"),v(e,"id","selection-modal"),v(e,"class","modal fade"),v(e,"tabindex","-1"),v(e,"aria-labelledby","selection-modal-label"),v(e,"aria-hidden","true")},m(D,$){V(D,e,$),y(e,n),y(e,i),y(e,r),y(r,s),y(s,o),y(o,l),y(o,a),A.m(o,null),y(o,c),y(o,u),y(o,h),y(s,f),y(s,d),y(r,m),y(r,p),M&&M.m(p,null),y(r,g),ae(_,r,null),S=!0,C||(b=pi(Us.call(null,e)),C=!0)},p(D,[$]){P===(P=k(D))&&A?A.p(D,$):(A.d(1),A=P(D),A&&(A.c(),A.m(o,c))),(!S||$&2)&&ve(u,D[1]),M&&M.p&&(!S||$&1024)&&It(M,E,D,D[10],S?Ct(E,D[10],$,null):Mt(D[10]),null);const R={};$&1&&(R.selectionStore=D[0]),_.$set(R)},i(D){S||(H(M,D),H(_.$$.fragment,D),S=!0)},o(D){K(M,D),K(_.$$.fragment,D),S=!1},d(D){D&&F(e),A.d(),M&&M.d(D),ce(_),C=!1,b()}}}function W_(t,e,n){let i,{$$slots:r={},$$scope:s}=e,{selectionStore:o}=e;const{selectionTitle:l,updateTitle:a,save:c}=o;me(t,l,C=>n(5,i=C));let{selectionLength:u=!1}=e,h=!1,f,d;function m(){n(2,h=!0),n(4,d=i),setTimeout(()=>f&&f.focus(),0)}function p(C){C.key==="Enter"&&g()}function g(){n(2,h=!1),a(d),c()}function _(C){Sn[C?"unshift":"push"](()=>{f=C,n(3,f)})}function S(){d=this.value,n(4,d)}return t.$$set=C=>{"selectionStore"in C&&n(0,o=C.selectionStore),"selectionLength"in C&&n(1,u=C.selectionLength),"$$scope"in C&&n(10,s=C.$$scope)},[o,u,h,f,d,i,l,m,p,g,s,r,_,S]}class G_ extends be{constructor(e){super(),ye(this,e,W_,K_,_e,{selectionStore:0,selectionLength:1})}}const Uy="";function Y_(t){let e,n,i,r,s,o=W==="en"?"Selection":"Sélection",l,a,c,u,h,f;return{c(){e=w("div"),n=w("button"),i=w("span"),r=w("i"),s=q(),l=se(o),a=se(`
            (`),c=se(t[0]),u=se(")"),v(r,"class","fa-solid fa-book-bookmark"),v(i,"id","btn-content"),v(n,"id","set-btn"),v(n,"class","button px-5 py-4 is-link svelte-gmt9z5"),v(n,"data-target","selection-modal"),v(e,"class","set-container svelte-gmt9z5")},m(d,m){V(d,e,m),y(e,n),y(n,i),y(i,r),y(i,s),y(i,l),y(i,a),y(i,c),y(i,u),h||(f=pi(Bs.call(null,n)),h=!0)},p(d,[m]){m&1&&ve(c,d[0])},i:Z,o:Z,d(d){d&&F(e),h=!1,f()}}}function X_(t,e,n){let{selectionLength:i=0}=e,r=i;return t.$$set=s=>{"selectionLength"in s&&n(0,i=s.selectionLength)},t.$$.update=()=>{if(t.$$.dirty&3&&i!==r){const s=i>r;n(1,r=i);const o=document.getElementById("btn-content");o&&o.animate([{transform:s?"translateY(-7px)":"translateX(-5px)"},{transform:s?"translateY(7px)":"translateX(5px)"},{transform:"translate(0)"}],{duration:300,easing:"cubic-bezier(0.65, 0, 0.35, 1)"})}},[i,r]}class J_ extends be{constructor(e){super(),ye(this,e,X_,Y_,_e,{selectionLength:0})}}const By="";function Ma(t,e,n){const i=t.slice();return i[7]=e[n][0],i[8]=e[n][1],i}function Q_(t){let e;return{c(){e=w("div"),e.textContent=`${W==="en"?"No regions in selection":"Aucune région sélectionnée"}`},m(n,i){V(n,e,i)},p:Z,d(n){n&&F(e)}}}function Z_(t){let e,n,i=Object.entries(t[2]),r=[];for(let s=0;s<i.length;s+=1)r[s]=xa(Ma(t,i,s));return{c(){e=w("div"),n=w("div");for(let s=0;s<r.length;s+=1)r[s].c();v(n,"class","grid is-gap-2"),v(e,"class","fixed-grid has-6-cols")},m(s,o){V(s,e,o),y(e,n);for(let l=0;l<r.length;l+=1)r[l]&&r[l].m(n,null)},p(s,o){if(o&13){i=Object.entries(s[2]);let l;for(l=0;l<i.length;l+=1){const a=Ma(s,i,l);r[l]?r[l].p(a,o):(r[l]=xa(a),r[l].c(),r[l].m(n,null))}for(;l<r.length;l+=1)r[l].d(1);r.length=i.length}},d(s){s&&F(e),We(r,s)}}}function xa(t){let e,n,i,r,s,o,l,a=t[8].title+"",c,u,h,f,d,m;function p(){return t[6](t[7])}return{c(){e=w("div"),n=w("figure"),i=w("img"),s=q(),o=w("div"),l=w("span"),c=se(a),u=q(),h=w("button"),f=q(),_t(i.src,r=$t(t[8].img,t[8].xywh,"96,"))||v(i,"src",r),v(i,"alt","Extracted region"),v(l,"class","overlay-desc"),v(o,"class","overlay is-center svelte-g8ij5d"),v(n,"class","image is-64x64 card"),v(h,"class","delete region-btn svelte-g8ij5d"),v(h,"aria-label","remove from selection"),v(e,"class","selection cell svelte-g8ij5d")},m(g,_){V(g,e,_),y(e,n),y(n,i),y(n,s),y(n,o),y(o,l),y(l,c),y(e,u),y(e,h),y(e,f),d||(m=pe(h,"click",p),d=!0)},p(g,_){t=g,_&4&&!_t(i.src,r=$t(t[8].img,t[8].xywh,"96,"))&&v(i,"src",r),_&4&&a!==(a=t[8].title+"")&&ve(c,a)},d(g){g&&F(e),d=!1,m()}}}function e0(t){let e;function n(s,o){return s[4]?Z_:Q_}let i=n(t),r=i(t);return{c(){r.c(),e=Ge()},m(s,o){r.m(s,o),V(s,e,o)},p(s,o){i===(i=n(s))&&r?r.p(s,o):(r.d(1),r=i(s),r&&(r.c(),r.m(e.parentNode,e)))},d(s){r.d(s),s&&F(e)}}}function t0(t){let e,n,i,r;return e=new J_({props:{selectionLength:t[1]}}),i=new G_({props:{selectionLength:t[1],selectionStore:t[0],$$slots:{default:[e0]},$$scope:{ctx:t}}}),{c(){ue(e.$$.fragment),n=q(),ue(i.$$.fragment)},m(s,o){ae(e,s,o),V(s,n,o),ae(i,s,o),r=!0},p(s,[o]){const l={};o&2&&(l.selectionLength=s[1]),e.$set(l);const a={};o&2&&(a.selectionLength=s[1]),o&1&&(a.selectionStore=s[0]),o&2077&&(a.$$scope={dirty:o,ctx:s}),i.$set(a)},i(s){r||(H(e.$$.fragment,s),H(i.$$.fragment,s),r=!0)},o(s){K(e.$$.fragment,s),K(i.$$.fragment,s),r=!1},d(s){ce(e,s),s&&F(n),ce(i,s)}}}function n0(t,e,n){let i,r,s,o,{selectionStore:l}=e;const{selected:a}=l;me(t,a,u=>n(3,o=u));const c=u=>l.remove(u,Object.keys(o)[0]);return t.$$set=u=>{"selectionStore"in u&&n(0,l=u.selectionStore)},t.$$.update=()=>{t.$$.dirty&8&&n(2,i=Object.values(o)[0]||{}),t.$$.dirty&4&&n(1,r=Object.keys(i).length),t.$$.dirty&2&&n(4,s=r>0)},[l,r,i,o,s,a,c]}class i0 extends be{constructor(e){super(),ye(this,e,n0,t0,_e,{selectionStore:0})}}const qy="";function Aa(t,e,n){const i=t.slice();return i[17]=e[n],i}function Ta(t,e,n){const i=t.slice();return i[20]=e[n],i}function Na(t,e,n){const i=t.slice();return i[23]=e[n],i}function Oa(t){let e,n,i,r,s,o=t[23].title+"",l,a,c,u=t[23].shortcut+"",h,f,d,m;return{c(){e=w("p"),n=w("button"),i=w("span"),r=w("i"),s=q(),l=se(o),a=q(),c=w("span"),h=se(u),f=q(),v(r,"class","fas "+t[23].icon+" svelte-7vjt6f"),v(i,"class","icon is-small"),v(c,"class","shortcut svelte-7vjt6f"),v(n,"class","button pl-5"),v(n,"title",t[23].desc),v(e,"class","control")},m(p,g){V(p,e,g),y(e,n),y(n,i),y(i,r),y(n,s),y(n,l),y(n,a),y(n,c),y(c,h),y(e,f),d||(m=pe(n,"click",Bt(t[23].fct)),d=!0)},p(p,g){t=p},d(p){p&&F(e),d=!1,m()}}}function r0(t){let e,n,i,r,s,o,l,a=Object.values(t[10]),c=[];for(let u=0;u<a.length;u+=1)c[u]=Oa(Na(t,a,u));return{c(){e=w("div"),n=w("div"),i=w("div"),r=w("span"),r.textContent=`${W==="en"?"Process selection":"Agir sur la sélection"}`,s=q(),o=w("div"),l=w("div");for(let u=0;u<c.length;u+=1)c[u].c();v(r,"class","tag is-medium is-link mr-5"),v(i,"class","column is-narrow mr-5"),v(l,"class","field has-addons"),v(o,"class","column"),v(n,"class","columns is-vcentered is-mobile py-4"),v(e,"slot","toolbar-visible")},m(u,h){V(u,e,h),y(e,n),y(n,i),y(i,r),y(n,s),y(n,o),y(o,l);for(let f=0;f<c.length;f+=1)c[f]&&c[f].m(l,null)},p(u,h){if(h&1024){a=Object.values(u[10]);let f;for(f=0;f<a.length;f+=1){const d=Na(u,a,f);c[f]?c[f].p(d,h):(c[f]=Oa(d),c[f].c(),c[f].m(l,null))}for(;f<c.length;f+=1)c[f].d(1);c.length=a.length}},d(u){u&&F(e),We(c,u)}}}function s0(t){let e,n=t[9].title+"",i;return{c(){e=w("span"),i=se(n),v(e,"class","button is-small is-success"),v(e,"title",t[9].desc)},m(r,s){V(r,e,s),y(e,i)},p:Z,d(r){r&&F(e)}}}function o0(t){let e,n=t[8].title+"",i,r,s;function o(){return t[12](t[17])}return{c(){e=w("button"),i=se(n),v(e,"class","button is-small is-warning"),v(e,"title",t[8].desc)},m(l,a){V(l,e,a),y(e,i),r||(s=pe(e,"click",o),r=!0)},p(l,a){t=l},d(l){l&&F(e),r=!1,s()}}}function l0(t){let e,n,i=t[17].size+"",r,s,o,l,a,c;function u(d,m){return d[17].fullyConnected?s0:o0}let h=u(t),f=h(t);return{c(){e=w("div"),n=w("span"),r=se(i),s=se(" images"),o=q(),l=w("hr"),a=q(),f.c(),c=q(),v(n,"class","cluster-size"),v(e,"class","cluster-info is-center is-fullwidth")},m(d,m){V(d,e,m),y(e,n),y(n,r),y(n,s),y(e,o),y(e,l),y(e,a),f.m(e,null),V(d,c,m)},p(d,m){m&4&&i!==(i=d[17].size+"")&&ve(r,i),h===(h=u(d))&&f?f.p(d,m):(f.d(1),f=h(d),f&&(f.c(),f.m(e,null)))},d(d){d&&F(e),f.d(),d&&F(c)}}}function Pa(t){let e,n;return e=new Rn({props:{item:{...t[3].get(t[20]),clusterId:t[17].id},copyable:!1,selectionStore:er}}),{c(){ue(e.$$.fragment)},m(i,r){ae(e,i,r),n=!0},p(i,r){const s={};r&12&&(s.item={...i[3].get(i[20]),clusterId:i[17].id}),e.$set(s)},i(i){n||(H(e.$$.fragment,i),n=!0)},o(i){K(e.$$.fragment,i),n=!1},d(i){ce(e,i)}}}function a0(t){let e,n,i=t[17].members,r=[];for(let o=0;o<i.length;o+=1)r[o]=Pa(Ta(t,i,o));const s=o=>K(r[o],1,1,()=>{r[o]=null});return{c(){for(let o=0;o<r.length;o+=1)r[o].c();e=q()},m(o,l){for(let a=0;a<r.length;a+=1)r[a]&&r[a].m(o,l);V(o,e,l),n=!0},p(o,l){if(l&12){i=o[17].members;let a;for(a=0;a<i.length;a+=1){const c=Ta(o,i,a);r[a]?(r[a].p(c,l),H(r[a],1)):(r[a]=Pa(c),r[a].c(),H(r[a],1),r[a].m(e.parentNode,e))}for(Ee(),a=i.length;a<r.length;a+=1)s(a);Ce()}},i(o){if(!n){for(let l=0;l<i.length;l+=1)H(r[l]);n=!0}},o(o){r=r.filter(Boolean);for(let l=0;l<r.length;l+=1)K(r[l]);n=!1},d(o){We(r,o),o&&F(e)}}}function La(t,e){let n,i,r;return i=new da({props:{$$slots:{"row-body":[a0],"row-header":[l0]},$$scope:{ctx:e}}}),{key:t,first:null,c(){n=Ge(),ue(i.$$.fragment),this.first=n},m(s,o){V(s,n,o),ae(i,s,o),r=!0},p(s,o){e=s;const l={};o&67108876&&(l.$$scope={dirty:o,ctx:e}),i.$set(l)},i(s){r||(H(i.$$.fragment,s),r=!0)},o(s){K(i.$$.fragment,s),r=!1},d(s){s&&F(n),ce(i,s)}}}function c0(t){let e=[],n=new Map,i,r,s=t[2];const o=l=>l[17].id;for(let l=0;l<s.length;l+=1){let a=Aa(t,s,l),c=o(a);n.set(c,e[l]=La(c,a))}return{c(){for(let l=0;l<e.length;l+=1)e[l].c();i=Ge()},m(l,a){for(let c=0;c<e.length;c+=1)e[c]&&e[c].m(l,a);V(l,i,a),r=!0},p(l,a){a&780&&(s=l[2],Ee(),e=vr(e,a,o,1,l,s,n,i.parentNode,_r,La,i,Aa),Ce())},i(l){if(!r){for(let a=0;a<s.length;a+=1)H(e[a]);r=!0}},o(l){for(let a=0;a<e.length;a+=1)K(e[a]);r=!1},d(l){for(let a=0;a<e.length;a+=1)e[a].d(l);l&&F(i)}}}function u0(t){let e,n,i,r,s,o,l,a,c,u;return e=new D_({props:{expandable:!1,$$slots:{"toolbar-visible":[r0]},$$scope:{ctx:t}}}),i=new Ca({props:{store:t[0],nbOfItems:t[1],pageLength:t[7]}}),s=new i0({props:{selectionStore:er}}),l=new E_({props:{$$slots:{default:[c0]},$$scope:{ctx:t}}}),c=new Ca({props:{store:t[0],nbOfItems:t[1],pageLength:t[7]}}),{c(){ue(e.$$.fragment),n=q(),ue(i.$$.fragment),r=q(),ue(s.$$.fragment),o=q(),ue(l.$$.fragment),a=q(),ue(c.$$.fragment)},m(h,f){ae(e,h,f),V(h,n,f),ae(i,h,f),V(h,r,f),ae(s,h,f),V(h,o,f),ae(l,h,f),V(h,a,f),ae(c,h,f),u=!0},p(h,[f]){const d={};f&67108864&&(d.$$scope={dirty:f,ctx:h}),e.$set(d);const m={};f&1&&(m.store=h[0]),f&2&&(m.nbOfItems=h[1]),i.$set(m);const p={};f&67108876&&(p.$$scope={dirty:f,ctx:h}),l.$set(p);const g={};f&1&&(g.store=h[0]),f&2&&(g.nbOfItems=h[1]),c.$set(g)},i(h){u||(H(e.$$.fragment,h),H(i.$$.fragment,h),H(s.$$.fragment,h),H(l.$$.fragment,h),H(c.$$.fragment,h),u=!0)},o(h){K(e.$$.fragment,h),K(i.$$.fragment,h),K(s.$$.fragment,h),K(l.$$.fragment,h),K(c.$$.fragment,h),u=!1},d(h){ce(e,h),h&&F(n),ce(i,h),h&&F(r),ce(s,h),h&&F(o),ce(l,h),h&&F(a),ce(c,h)}}}function f0(t,e,n){let i,r,s,{documentSetStore:o}=e;const{imageNodes:l}=o;me(t,l,b=>n(3,s=b));let{clusterStore:a}=e;const{clusterNb:c,paginatedClusters:u,pageLength:h,validateCluster:f,newCluster:d,removeFromClusters:m}=a;me(t,c,b=>n(1,i=b)),me(t,u,b=>n(2,r=b));const p={create:{title:W==="en"?"New cluster":"Nouveau cluster",desc:W==="en"?"Create a new validated cluster from the selected regions":"Créer un nouveau cluster valide à partir des régions sélectionnées",icon:"fa-object-group",shortcut:"Shift + C",fct:d},remove:{title:W==="en"?"Remove from cluster":"Retirer du cluster",desc:W==="en"?"Remove the selected regions from their cluster":"Retirer les régions sélectionnées de leur cluster",icon:"fa-chain-broken",shortcut:"Shift + D",fct:m},validate:{title:W==="en"?"Validate cluster":"Valider le cluster",desc:W==="en"?"Set as exact match all the pairs of regions in the cluster":"Définir comme correspondance exacte toutes les paires de régions dans le cluster",icon:"fa-check",fct:f},validated:{title:W==="en"?"Validated cluster":"Cluster valide",desc:W==="en"?"All pairs of regions have be categorized as exact matches":"Toutes les paires de régions ont été catégorisées comme des correspondances exactes",icon:"fa-check"}},{validate:g,validated:_,...S}=p,C=b=>g.fct(b);return t.$$set=b=>{"documentSetStore"in b&&n(11,o=b.documentSetStore),"clusterStore"in b&&n(0,a=b.clusterStore)},[a,i,r,s,l,c,u,h,g,_,S,o,C]}class h0 extends be{constructor(e){super(),ye(this,e,f0,u0,_e,{documentSetStore:11,clusterStore:0})}}function d0(t,e){const i=we(1),{visiblePairs:r,imageNodes:s}=t;wr(i,"p");function o(b){Sr(b,i,"p")}function l(b){if(b.length===0)return[];const k=new Map,P=D=>k.has(D)?(k.get(D)!==D&&k.set(D,P(k.get(D))),k.get(D)):(k.set(D,D),D),A=(D,$)=>{const R=P(D),z=P($);R!==z&&k.set(z,R)},E=new Set;b.forEach(D=>{A(D.id_1,D.id_2),E.add(D.id_1),E.add(D.id_2)});const M=new Map;return E.forEach(D=>{const $=P(D);M.has($)||M.set($,[]),M.get($).push(D)}),Array.from(M.values()).map(D=>{const $=D.length,R=$*($-1)/2,z=new Set(D),I=b.filter(N=>z.has(N.id_1)&&z.has(N.id_2)).length;return{id:crypto.randomUUID(),members:D,size:$,fullyConnected:I===R}}).filter(D=>D.size>1).sort((D,$)=>$.size-D.size)}const a=Be(r,b=>b.length?l(b):[]),c=we([]);a.subscribe(b=>{c.set(b)});const u=Be([c,i],([b,k])=>{const P=(k-1)*10,A=P+10;return b.slice(P,A)}),h=(b,k)=>{const P=Ke(s).get(b),A=Ke(s).get(k);return{img_1:b,img_2:k,regions_id_1:P==null?void 0:P.regionId,regions_id_2:A==null?void 0:A.regionId}},f=(b,k)=>(c.update(P=>P.map(A=>{if(!k[A.id])return A;const E=A.members.filter(M=>!b.has(M));return{...A,members:E,size:E.length}}).filter(A=>A.size>0)),!0),d=async b=>{const k=Array.isArray(b)?b:Object.keys(b),P=new Set(k),A={};Ke(c).forEach(M=>{const D=M.members.filter($=>P.has($));D.length>0&&(A[M.id]=D)});const E=Object.entries(A).flatMap(([M,D])=>{const $=Ke(c).find(z=>z.id===M);if(!$)return[];const R=$.members.filter(z=>!P.has(z));return D.flatMap(z=>R.map(I=>h(z,I)))});if(E.length===0)return f(P,A),!0;try{const M=await Fs(()=>fetch(`${window.location.origin}/${Tt}/uncategorize-pair-batch`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":en},body:JSON.stringify({pairs:E})}));return M.ok?(f(P,A),!0):(console.log(M),await ht(W==="en"?"Batch un-categorization failed":"La dé-catégorisation par lot a échoué",W==="en"?"Error":"Erreur"),!1)}catch(M){return await ht(M,W==="en"?"Error":"Erreur"),!1}},m=async b=>{const k=b.flatMap((P,A)=>b.slice(A+1).map(E=>h(P,E)));try{const P=await Fs(()=>fetch(`${window.location.origin}/${Tt}/exact-match-batch`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":en},body:JSON.stringify({pairs:k})}));return P.ok?!0:(console.log(P),await ht(W==="en"?"Batch validation failed":"La validation par lot a échoué",W==="en"?"Error":"Erreur"),!1)}catch(P){return await ht(P,W==="en"?"Error":"Erreur"),console.error("Error:",P),!1}},p=async b=>{const k=await m(b.members);return k&&c.update(P=>P.map(A=>A.id===b.id?{...A,fullyConnected:!0}:A)),k},g=async b=>{if(b.length<2)return!1;const k=await m(b);return k&&c.update(P=>[{id:crypto.randomUUID(),members:b,size:b.length,fullyConnected:!0},...P].sort((E,M)=>M.size-E.size)),k},_=()=>Object.values(Ke(e).selected)[0]||{},S=async()=>{if(!await ht(W==="en"?"Do you want to create a cluster out of these images?":"Voulez-vous créer un cluster à partir de ces images ?",W==="en"?"Confirm creation":"Confirmer la création",!0))return;const k=_(),P=Object.keys(k);return P.length<2?(await ht(W==="en"?"Cluster creation requires at least 2 images":"La création d'un nouveau cluster nécessite a minima 2 images",W==="en"?"Impossible creation":"Création impossible"),!1):!await d(P)||!await g(P)?!1:(e.empty(),!0)},C=async()=>{if(!await ht(W==="en"?"Do you want to remove these images from their clusters?":"Voulez-vous supprimer ces images de leurs clusters ?",W==="en"?"Confirm deletion":"Confirmer la suppression",!0))return;const k=_();return await d(Object.keys(k))?(e.empty(),!0):!1};return{imageClusters:a,interfaceClusters:c,clusterNb:Be(c,b=>b.length),validateCluster:p,removeFromClusters:C,newCluster:S,paginatedClusters:u,handlePageUpdate:o,pageLength:10,currentPage:i}}function Ra(t,e,n){const i=t.slice();return i[25]=e[n],i}function m0(t){let e,n,i;return{c(){e=w("p"),e.textContent=`La matrice de documents visualise les scores de similarité globaux entre tous les documents du
                        corpus.
                        Cliquez sur une cellule pour voir les détails des similarités entre pages.`,n=q(),i=w("ul"),i.innerHTML=`<li>Matrice : Scores normalisés entre documents (0-100).</li>
                        <li>Scatter plot : Similarités détaillées par page.</li>`},m(r,s){V(r,e,s),V(r,n,s),V(r,i,s)},d(r){r&&F(e),r&&F(n),r&&F(i)}}}function p0(t){let e,n,i;return{c(){e=w("p"),e.textContent=`The Documents Network illustrates the connections between different witnesses in the document
                        set.
                        Each node represents a witness, and edges denote relationships based on shared content or other
                        relevant factors.`,n=q(),i=w("ul"),i.innerHTML=`<li>Nodes: Witnesses in the document set.</li>
                        <li>Edges: Relationships based on shared content.</li>`},m(r,s){V(r,e,s),V(r,n,s),V(r,i,s)},d(r){r&&F(e),r&&F(n),r&&F(i)}}}function g0(t){let e,n,i;return{c(){e=w("p"),e.textContent=`The Regions Network visualizes the relationships between image regions across different witnesses
                        in the document set.
                        Each node represents an image region, and edges indicate similarity or connections based on
                        predefined criteria.`,n=q(),i=w("ul"),i.innerHTML=`<li>Nodes: Image regions from various witnesses.</li>
                        <li>Edges: Similarity links between regions.</li>`},m(r,s){V(r,e,s),V(r,n,s),V(r,i,s)},d(r){r&&F(e),r&&F(n),r&&F(i)}}}function _0(t){let e,n,i,r;function s(a,c){return a[23]==="img"?g0:a[23]==="doc"?p0:m0}let o=s(t),l=o(t);return i=new w_({props:{activeTab:t[23],documentSetStore:t[4]}}),{c(){e=w("div"),l.c(),n=q(),ue(i.$$.fragment),v(e,"slot","datavizInfo")},m(a,c){V(a,e,c),l.m(e,null),y(e,n),ae(i,e,null),r=!0},p(a,c){o!==(o=s(a))&&(l.d(1),l=o(a),l&&(l.c(),l.m(e,n)));const u={};c&8388608&&(u.activeTab=a[23]),i.$set(u)},i(a){r||(H(i.$$.fragment,a),r=!0)},o(a){K(i.$$.fragment,a),r=!1},d(a){a&&F(e),l.d(),ce(i)}}}function v0(t){let e,n,i;return n=new Rf({props:{docSet:t[0],documentSetStore:t[4],clusterStore:t[8],$$slots:{datavizInfo:[_0]},$$scope:{ctx:t}}}),{c(){e=w("div"),ue(n.$$.fragment),v(e,"slot","sidebar")},m(r,s){V(r,e,s),ae(n,e,null),i=!0},p(r,s){const o={};s&1&&(o.docSet=r[0]),s&276824064&&(o.$$scope={dirty:s,ctx:r}),n.$set(o)},i(r){i||(H(n.$$.fragment,r),i=!0)},o(r){K(n.$$.fragment,r),i=!1},d(r){r&&F(e),ce(n)}}}function Da(t){let e,n,i,r,s,o,l,a=t[25].title+"",c,u;return{c(){e=w("div"),n=w("figure"),i=w("img"),s=q(),o=w("div"),l=w("span"),c=se(a),u=q(),_t(i.src,r=$t(t[25].img,t[25].xywh,"96,"))||v(i,"src",r),v(i,"alt","Extracted region"),v(l,"class","overlay-desc"),v(o,"class","overlay is-center"),v(n,"class","image is-64x64 card"),v(e,"class","selection cell")},m(h,f){V(h,e,f),y(e,n),y(n,i),y(n,s),y(n,o),y(o,l),y(l,c),y(e,u)},p(h,f){f&2&&!_t(i.src,r=$t(h[25].img,h[25].xywh,"96,"))&&v(i,"src",r),f&2&&a!==(a=h[25].title+"")&&ve(c,a)},d(h){h&&F(e)}}}function y0(t){let e,n,i=Object.values(Object.values(t[1])[0]||{}),r=[];for(let s=0;s<i.length;s+=1)r[s]=Da(Ra(t,i,s));return{c(){e=w("div"),n=w("div");for(let s=0;s<r.length;s+=1)r[s].c();v(n,"class","grid is-gap-2"),v(e,"slot","content"),v(e,"class","fixed-grid has-6-cols")},m(s,o){V(s,e,o),y(e,n);for(let l=0;l<r.length;l+=1)r[l]&&r[l].m(n,null)},p(s,o){if(o&2){i=Object.values(Object.values(s[1])[0]||{});let l;for(l=0;l<i.length;l+=1){const a=Ra(s,i,l);r[l]?r[l].p(a,o):(r[l]=Da(a),r[l].c(),r[l].m(n,null))}for(;l<r.length;l+=1)r[l].d(1);r.length=i.length}},d(s){s&&F(e),We(r,s)}}}function b0(t){let e,n,i,r={ctx:t,current:null,token:null,hasCatch:!1,pending:A0,then:k0,catch:S0,value:24,blocks:[,,,]};return gr(n=t[3],r),{c(){e=Ge(),r.block.c()},m(s,o){V(s,e,o),r.block.m(s,r.anchor=o),r.mount=()=>e.parentNode,r.anchor=e,i=!0},p(s,o){t=s,r.ctx=t,o&8&&n!==(n=t[3])&&gr(n,r)||zs(r,t,o)},i(s){i||(H(r.block),i=!0)},o(s){for(let o=0;o<3;o+=1){const l=r.blocks[o];K(l)}i=!1},d(s){s&&F(e),r.block.d(s),r.token=null,r=null}}}function w0(t){let e,n,i;return{c(){e=w("article"),n=w("div"),i=se(t[2]),v(n,"class","message-body"),v(e,"class","message is-danger")},m(r,s){V(r,e,s),y(e,n),y(n,i)},p(r,s){s&4&&ve(i,r[2])},i:Z,o:Z,d(r){r&&F(e)}}}function S0(t){return{c:Z,m:Z,p:Z,i:Z,o:Z,d:Z}}function k0(t){let e,n,i,r;const s=[C0,E0],o=[];function l(a,c){return a[24]===0?0:1}return e=l(t),n=o[e]=s[e](t),{c(){n.c(),i=Ge()},m(a,c){o[e].m(a,c),V(a,i,c),r=!0},p(a,c){let u=e;e=l(a),e===u?o[e].p(a,c):(Ee(),K(o[u],1,1,()=>{o[u]=null}),Ce(),n=o[e],n?n.p(a,c):(n=o[e]=s[e](a),n.c()),H(n,1),n.m(i.parentNode,i))},i(a){r||(H(n),r=!0)},o(a){K(n),r=!1},d(a){o[e].d(a),a&&F(i)}}}function E0(t){let e,n,i=t[9][t[23]]+"",r,s,o,l,a;const c=[x0,M0,I0],u=[];function h(f,d){return f[23]==="img"||f[23]==="doc"?0:f[23]==="sim"?1:f[23]==="mat"?2:-1}return~(o=h(t))&&(l=u[o]=c[o](t)),{c(){e=w("div"),n=w("h2"),r=se(i),s=q(),l&&l.c(),v(n,"class","title is-3 has-text-link")},m(f,d){V(f,e,d),y(e,n),y(n,r),y(e,s),~o&&u[o].m(e,null),a=!0},p(f,d){(!a||d&8388608)&&i!==(i=f[9][f[23]]+"")&&ve(r,i);let m=o;o=h(f),o===m?~o&&u[o].p(f,d):(l&&(Ee(),K(u[m],1,1,()=>{u[m]=null}),Ce()),~o?(l=u[o],l?l.p(f,d):(l=u[o]=c[o](f),l.c()),H(l,1),l.m(e,null)):l=null)},i(f){a||(H(l),a=!0)},o(f){K(l),a=!1},d(f){f&&F(e),~o&&u[o].d()}}}function C0(t){let e;return{c(){e=w("article"),e.innerHTML=`<div class="message-body">No document pairs found for this configuration.
                            Please adjust your selection criteria in the sidebar to include more documents or
                            categories.</div>`,v(e,"class","message is-warning")},m(n,i){V(n,e,i)},p:Z,i:Z,o:Z,d(n){n&&F(e)}}}function I0(t){let e,n;return e=new g_({props:{documentSetStore:t[4]}}),{c(){ue(e.$$.fragment)},m(i,r){ae(e,i,r),n=!0},p:Z,i(i){n||(H(e.$$.fragment,i),n=!0)},o(i){K(e.$$.fragment,i),n=!1},d(i){ce(e,i)}}}function M0(t){let e,n;return e=new h0({props:{documentSetStore:t[4],clusterStore:t[8]}}),{c(){ue(e.$$.fragment)},m(i,r){ae(e,i,r),n=!0},p:Z,i(i){n||(H(e.$$.fragment,i),n=!0)},o(i){K(e.$$.fragment,i),n=!1},d(i){ce(e,i)}}}function x0(t){let e,n;return e=new f_({props:{documentSetStore:t[4],type:t[23]}}),{c(){ue(e.$$.fragment)},m(i,r){ae(e,i,r),n=!0},p(i,r){const s={};r&8388608&&(s.type=i[23]),e.$set(s)},i(i){n||(H(e.$$.fragment,i),n=!0)},o(i){K(e.$$.fragment,i),n=!1},d(i){ce(e,i)}}}function A0(t){let e;return{c(){e=w("progress"),e.textContent="Loading...",v(e,"class","progress is-link"),v(e,"max","100")},m(n,i){V(n,e,i)},p:Z,i:Z,o:Z,d(n){n&&F(e)}}}function T0(t){let e,n,i,r,s,o;n=new bu({props:{$$slots:{content:[y0]},$$scope:{ctx:t}}});const l=[w0,b0],a=[];function c(u,h){return u[2]?0:1}return r=c(t),s=a[r]=l[r](t),{c(){e=w("div"),ue(n.$$.fragment),i=q(),s.c(),v(e,"slot","content")},m(u,h){V(u,e,h),ae(n,e,null),y(e,i),a[r].m(e,null),o=!0},p(u,h){const f={};h&268435458&&(f.$$scope={dirty:h,ctx:u}),n.$set(f);let d=r;r=c(u),r===d?a[r].p(u,h):(Ee(),K(a[d],1,1,()=>{a[d]=null}),Ce(),s=a[r],s?s.p(u,h):(s=a[r]=l[r](u),s.c()),H(s,1),s.m(e,null))},i(u){o||(H(n.$$.fragment,u),H(s),o=!0)},o(u){K(n.$$.fragment,u),K(s),o=!1},d(u){u&&F(e),ce(n),a[r].d()}}}function N0(t){let e,n;return e=new Au({props:{tabList:t[9],$$slots:{content:[T0,({activeTab:i})=>({23:i}),({activeTab:i})=>i?8388608:0],sidebar:[v0,({activeTab:i})=>({23:i}),({activeTab:i})=>i?8388608:0]},$$scope:{ctx:t}}}),{c(){ue(e.$$.fragment)},m(i,r){ae(e,i,r),n=!0},p(i,[r]){const s={};r&276824079&&(s.$$scope={dirty:r,ctx:i}),e.$set(s)},i(i){n||(H(e.$$.fragment,i),n=!0)},o(i){K(e.$$.fragment,i),n=!1},d(i){ce(e,i)}}}function O0(t,e,n){var D;let i,r,s,{docSet:o}=e;const l=v_(o.id),{error:a,fetchPairs:c,selectedRegions:u,selectedCategories:h,threshold:f,topK:d,mutualTopK:m,scoreMode:p}=l;me(t,a,$=>n(2,r=$)),me(t,c,$=>n(3,s=$));let g,_,S,C,b,k;Hn(()=>{g=In(u,"regions","set"),_=In(h,"categories","array"),S=In(f,"threshold","number"),C=In(d,"topk","number"),b=In(m,"mutual","boolean"),k=In(p,"mode","string"),Ke(h)||h.set([1]);const $=u.subscribe(g),R=h.subscribe(_),z=f.subscribe(S),I=d.subscribe(C),N=m.subscribe(b),x=p.subscribe(k);return()=>{$(),R(),z(),I(),N(),x()}});const{selected:P}=er;me(t,P,$=>n(1,i=$));const A=d0(l,er),E={img:W==="en"?"Image Network":"Réseau d'images",doc:W==="en"?"Document Network":"Réseau de documents",sim:W==="en"?"Copy Clusters":"Groupe de copies",mat:W==="en"?"Document Matrix":"Matrice de documents"},M=((D=o==null?void 0:o.selection)==null?void 0:D.selected)||{Witness:{},Series:{},Work:{}};return bn("selectedDocuments",M),t.$$set=$=>{"docSet"in $&&n(0,o=$.docSet)},[o,i,r,s,l,a,c,P,A,E]}class P0 extends be{constructor(e){super(),ye(this,e,O0,N0,_e,{docSet:0})}}new P0({target:document.getElementById("document-set"),props:{docSet}});const Ky="";function L0(t){let e,n,i;return n=new Rn({props:{item:t[0],height:"full"}}),{c(){e=w("div"),ue(n.$$.fragment),v(e,"class","img-wrapper svelte-1duc3w1")},m(r,s){V(r,e,s),ae(n,e,null),i=!0},p(r,[s]){const o={};s&1&&(o.item=r[0]),n.$set(o)},i(r){i||(H(n.$$.fragment,r),i=!0)},o(r){K(n.$$.fragment,r),i=!1},d(r){r&&F(e),ce(n)}}}function R0(t,e,n){let{mainImgItem:i}=e;return t.$$set=r=>{"mainImgItem"in r&&n(0,i=r.mainImgItem)},[i]}class $a extends be{constructor(e){super(),ye(this,e,R0,L0,_e,{mainImgItem:0})}}const Wy="";function D0(t){return{c:Z,m:Z,p:Z,d:Z}}function $0(t){let e,n=`${t[5][0]}%`,i=`${t[5][1]}%`,r=`${t[5][2]}%`,s=`${t[5][3]}%`;return{c(){e=w("div"),v(e,"class","modal-context-bbox svelte-zgr10j"),v(e,"aria-description",W==="fr"?"Position de la région extraite sur la page":"Position of the extracted region on the page"),Re(e,"left",n),Re(e,"top",i),Re(e,"width",r),Re(e,"height",s)},m(o,l){V(o,e,l)},p:Z,d(o){o&&F(e)}}}function z0(t){return{c:Z,m:Z,p:Z,d:Z}}function j0(t){let e,n,i,r,s,o={ctx:t,current:null,token:null,hasCatch:!1,pending:z0,then:$0,catch:D0,value:5};return gr(t[1],o),{c(){e=w("div"),n=w("div"),i=w("img"),s=q(),o.block.c(),v(i,"class","card modal-context-full-page svelte-zgr10j"),_t(i.src,r=t[0])||v(i,"src",r),v(i,"alt",W==="fr"?"Vue de la page d'où la région est extraite":"View of the page the region is extracted from"),v(n,"class","modal-context-wrapper svelte-zgr10j"),v(e,"class","modal-context-outer pb-4 svelte-zgr10j")},m(l,a){V(l,e,a),y(e,n),y(n,i),y(n,s),o.block.m(n,o.anchor=null),o.mount=()=>n,o.anchor=null},p(l,[a]){t=l,zs(o,t,a)},i:Z,o:Z,d(l){l&&F(e),o.block.d(),o.token=null,o=null}}}function F0(t,e,n){let{mainImgItem:i}=e;const r=$t(i.img,"full","full"),s=uu(i.img),o=i.xywh.map(Number),l=fetch(s).then(a=>a.json()).then(a=>[o[0]/a.width,o[1]/a.height,o[2]/a.width,o[3]/a.height].map(c=>c*100));return t.$$set=a=>{"mainImgItem"in a&&n(2,i=a.mainImgItem)},[r,l,i]}class V0 extends be{constructor(e){super(),ye(this,e,F0,j0,_e,{mainImgItem:2})}}const Gy="";function za(t,e,n){const i=t.slice();return i[13]=e[n].id,i[14]=e[n].label,i}function ja(t){let e,n,i=t[14]+"",r,s,o,l,a;function c(){return t[9](t[13])}return{c(){e=w("li"),n=w("a"),r=se(i),s=q(),v(n,"href",""),v(e,"class",o=t[13]===t[2]?"is-active":"")},m(u,h){V(u,e,h),y(e,n),y(n,r),y(e,s),l||(a=pe(n,"click",Bt(c)),l=!0)},p(u,h){t=u,h&4&&o!==(o=t[13]===t[2]?"is-active":"")&&v(e,"class",o)},d(u){u&&F(e),l=!1,a()}}}function H0(t){let e,n,i,r,s,o,l,a,c,u,h,f,d,m,p,g=t[3],_=[];for(let k=0;k<g.length;k+=1)_[k]=ja(za(t,g,k));const S=[t[1][t[2]]||{}];var C=t[0][t[2]]||null;function b(k){let P={};for(let A=0;A<S.length;A+=1)P=Ms(P,S[A]);return{props:P}}return C&&(u=_i(C,b())),{c(){e=w("div"),n=w("div"),i=q(),r=w("div"),s=w("div"),o=w("div"),l=w("ul");for(let k=0;k<_.length;k+=1)_[k].c();a=q(),c=w("div"),u&&ue(u.$$.fragment),h=q(),f=w("button"),v(n,"class","modal-background"),v(o,"class","tabs is-centered"),Re(o,"height","fit-content"),v(c,"class","ml-4 mr-4 modal-main-wrapper svelte-1uakzh2"),Se(c,"pb-4",t[2]==="main"),v(s,"class","modal-inner svelte-1uakzh2"),v(r,"class","modal-content svelte-1uakzh2"),v(f,"class","modal-close is-large"),v(f,"aria-label","close"),v(e,"id","region-modal-wrapper"),v(e,"class","modal is-active")},m(k,P){V(k,e,P),y(e,n),y(e,i),y(e,r),y(r,s),y(s,o),y(o,l);for(let A=0;A<_.length;A+=1)_[A]&&_[A].m(l,null);y(s,a),y(s,c),u&&ae(u,c,null),y(e,h),y(e,f),d=!0,m||(p=[pe(n,"click",t[6]),pe(n,"keyup",t[5]),pe(f,"click",t[6])],m=!0)},p(k,[P]){if(P&28){g=k[3];let E;for(E=0;E<g.length;E+=1){const M=za(k,g,E);_[E]?_[E].p(M,P):(_[E]=ja(M),_[E].c(),_[E].m(l,null))}for(;E<_.length;E+=1)_[E].d(1);_.length=g.length}const A=P&6?Yc(S,[Xc(k[1][k[2]]||{})]):{};if(P&5&&C!==(C=k[0][k[2]]||null)){if(u){Ee();const E=u;K(E.$$.fragment,1,0,()=>{ce(E,1)}),Ce()}C?(u=_i(C,b()),ue(u.$$.fragment),H(u.$$.fragment,1),ae(u,c,null)):u=null}else C&&u.$set(A);(!d||P&4)&&Se(c,"pb-4",k[2]==="main")},i(k){d||(u&&H(u.$$.fragment,k),d=!0)},o(k){u&&K(u.$$.fragment,k),d=!1},d(k){k&&F(e),We(_,k),u&&ce(u),m=!1,Ze(p)}}}function U0(t,e,n){let i,{mainImgItem:r}=e,{compareImgItem:s}=e;const o=bi(),l=s?["main","page","similarity","expansion"]:["main","page"],a={expansion:{fr:"Expansion de requête",en:"Query expansion"},similarity:{fr:"Comparaison",en:"Comparison"},page:{fr:"Vue de la page",en:"Page view"},main:{fr:"Vue principale",en:"Main view"}},c=l.map(g=>{var _;return{id:g,label:((_=a[g])==null?void 0:_[W])??"Main view"}}),u={main:$a,page:V0};s&&Promise.all([ls(()=>Promise.resolve().then(()=>Uv),void 0).then(g=>g.default),ls(()=>Promise.resolve().then(()=>gy),void 0).then(g=>g.default)]).then(([g,_])=>{const S=Object.keys(u);l.filter(C=>!S.includes(C)).map(C=>n(0,u[C]=C==="expansion"?_:C==="similarity"?g:$a,u))});const h={};l.map(g=>n(1,h[g]=g==="similarity"?{compareImgItem:s,mainImgItem:r}:{mainImgItem:r},h));const f=g=>n(2,i=g),d=g=>{g.key==="Escape"&&o("closeModal")},m=()=>o("closeModal");Hn(()=>{document.addEventListener("keyup",d)}),Un(()=>{document.removeEventListener("keydown",d)});const p=g=>f(g);return t.$$set=g=>{"mainImgItem"in g&&n(7,r=g.mainImgItem),"compareImgItem"in g&&n(8,s=g.compareImgItem)},n(2,i=l[0]),[u,h,i,c,f,d,m,r,s,p]}class B0 extends be{constructor(e){super(),ye(this,e,U0,H0,_e,{mainImgItem:7,compareImgItem:8})}}const Yy="";function q0(t){let e,n,i,r,s,o,l,a,c,u,h;return n=new xi({props:{targetHtmlId:t[0],tooltipText:t[1]}}),{c(){e=w("div"),ue(n.$$.fragment),i=q(),r=w("button"),s=xt("svg"),o=xt("path"),l=xt("path"),a=xt("path"),v(o,"d","M53.6443 14.25C47.7042 5.33 37.7293 0 26.9801 0C16.2206 0 6.24576 5.33 0.305653 14.25L0 14.71L0.305653 15.17C6.24576 24.09 16.2206 29.42 26.9801 29.42C37.7293 29.42 47.7042 24.09 53.6443 15.16L53.95 14.71L53.6443 14.25ZM3.25025 14.71C7.63146 8.69001 14.0606 4.65 21.2641 3.22C20.0619 3.83 18.9411 4.62 17.963 5.59C15.5176 8.02 14.1625 11.25 14.1625 14.67C14.1625 18.11 15.5176 21.34 17.963 23.76C19.0124 24.79 20.1943 25.61 21.4781 26.23C14.1829 24.85 7.6824 20.78 3.25025 14.71ZM27.1125 22.64C22.7008 22.64 19.1041 19.08 19.1041 14.7C19.1041 12.59 19.9396 10.6 21.4475 9.10001C22.9555 7.60001 24.9729 6.77 27.1125 6.77C29.2522 6.77 31.2594 7.60001 32.7775 9.10001C34.2855 10.6 35.121 12.59 35.121 14.7C35.121 16.82 34.2855 18.82 32.7775 20.32C31.2594 21.81 29.242 22.64 27.1125 22.64ZM32.9915 26.14C34.204 25.53 35.3146 24.74 36.3029 23.77C38.7482 21.34 40.0932 18.11 40.0932 14.68C40.0932 9.75 37.281 5.47001 33.1647 3.32001C40.1747 4.81001 46.4102 8.83001 50.6896 14.71C46.3797 20.64 40.0728 24.67 32.9915 26.14Z"),v(o,"fill","black"),v(o,"class","svelte-19wutme"),v(l,"d","M26.9804 25.98C33.3222 25.98 38.4633 20.9343 38.4633 14.71C38.4633 8.48576 33.3222 3.44 26.9804 3.44C20.6386 3.44 15.4976 8.48576 15.4976 14.71C15.4976 20.9343 20.6386 25.98 26.9804 25.98Z"),v(l,"fill","black"),v(l,"class","svelte-19wutme"),v(a,"d","M17.9529 23.85L36.2928 5.85001"),v(a,"stroke","black"),v(a,"stroke-width","3"),v(a,"stroke-miterlimit","10"),v(a,"class","svelte-19wutme"),v(s,"width","54"),v(s,"height","30"),v(s,"viewBox","0 0 54 30"),v(s,"fill","none"),v(s,"xmlns","http://www.w3.org/2000/svg"),v(s,"class","svelte-19wutme"),v(r,"class","button tag svelte-19wutme"),v(r,"title",t[1]),v(e,"id",t[0])},m(f,d){V(f,e,d),ae(n,e,null),y(e,i),y(e,r),y(r,s),y(s,o),y(s,l),y(s,a),c=!0,u||(h=pe(r,"click",t[2]),u=!0)},p:Z,i(f){c||(H(n.$$.fragment,f),c=!0)},o(f){K(n.$$.fragment,f),c=!1},d(f){f&&F(e),ce(n),u=!1,h()}}}function K0(t,e,n){let i,r,{mainImgItem:s}=e,{compareImgItem:o=void 0}=e;bn("isInModal",!0);const l=`modal-opener-${window.crypto.randomUUID()}`,a=W==="fr"?"Vue détaillée":"Detailed view",c=(f,d)=>(f?(d=new B0({target:document.querySelector("body"),props:{mainImgItem:s,compareImgItem:o}}),d.$on("closeModal",h)):!f&&r!=null&&d.$destroy(),d),u=()=>n(5,i=!i),h=()=>n(5,i=!1);return t.$$set=f=>{"mainImgItem"in f&&n(3,s=f.mainImgItem),"compareImgItem"in f&&n(4,o=f.compareImgItem)},t.$$.update=()=>{t.$$.dirty&96&&n(6,r=c(i,r))},n(5,i=!1),[l,a,u,s,o,i,r]}class W0 extends be{constructor(e){super(),ye(this,e,K0,q0,_e,{mainImgItem:3,compareImgItem:4})}}const G0=Object.freeze(Object.defineProperty({__proto__:null,default:W0},Symbol.toStringTag,{value:"Module"})),Xy="";function Y0(t){let e,n,i,r,s,o,l;return{c(){e=w("button"),n=w("span"),n.innerHTML='<span class="switch-control svelte-g5g8im"><span class="switch-spot"></span></span>',i=q(),r=w("span"),s=se(t[0]),v(n,"class","switch mr-2 svelte-g5g8im"),v(r,"class","label svelte-g5g8im"),v(e,"id",t[3]),v(e,"name",t[3]),v(e,"class","input-checkbox-wrapper is-flex is-align-items-center-is-justify-content-center p-2 pl-3 pr-3 svelte-g5g8im"),v(e,"aria-label",t[0]),Se(e,"is-checked",t[2]),Se(e,"is-clickable",t[1]),Se(e,"button",t[1])},m(a,c){V(a,e,c),y(e,n),y(e,i),y(e,r),y(r,s),o||(l=pe(e,"click",Bt(t[4])),o=!0)},p(a,[c]){c&1&&ve(s,a[0]),c&1&&v(e,"aria-label",a[0]),c&4&&Se(e,"is-checked",a[2]),c&2&&Se(e,"is-clickable",a[1]),c&2&&Se(e,"button",a[1])},i:Z,o:Z,d(a){a&&F(e),o=!1,l()}}}function X0(t,e,n){let i,{toggleLabel:r}=e,{start:s=!1}=e,{buttonDisplay:o=!1}=e;const l=`input-toggle-${window.crypto.randomUUID()}`,a=bi(),c=vt("resetTrigger")||void 0;c==null||c.subscribe(h);const u=()=>n(2,i=!i);function h(){n(2,i=s)}return t.$$set=f=>{"toggleLabel"in f&&n(0,r=f.toggleLabel),"start"in f&&n(5,s=f.start),"buttonDisplay"in f&&n(1,o=f.buttonDisplay)},t.$$.update=()=>{t.$$.dirty&32&&n(2,i=s),t.$$.dirty&4&&a("updateChecked",i)},[r,o,i,l,u,s]}class J0 extends be{constructor(e){super(),ye(this,e,X0,Y0,_e,{toggleLabel:0,start:5,buttonDisplay:1})}}/*! choices.js v11.1.0 | © 2025 Josh Johnson | https://github.com/jshjohnson/Choices#readme */var us=function(t,e){return us=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(n[r]=i[r])},us(t,e)};function Fa(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");us(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}var mt=function(){return mt=Object.assign||function(e){for(var n,i=1,r=arguments.length;i<r;i++){n=arguments[i];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},mt.apply(this,arguments)};function Q0(t,e,n){if(n||arguments.length===2)for(var i=0,r=e.length,s;i<r;i++)(s||!(i in e))&&(s||(s=Array.prototype.slice.call(e,0,i)),s[i]=e[i]);return t.concat(s||Array.prototype.slice.call(e))}typeof SuppressedError=="function"&&SuppressedError;var je={ADD_CHOICE:"ADD_CHOICE",REMOVE_CHOICE:"REMOVE_CHOICE",FILTER_CHOICES:"FILTER_CHOICES",ACTIVATE_CHOICES:"ACTIVATE_CHOICES",CLEAR_CHOICES:"CLEAR_CHOICES",ADD_GROUP:"ADD_GROUP",ADD_ITEM:"ADD_ITEM",REMOVE_ITEM:"REMOVE_ITEM",HIGHLIGHT_ITEM:"HIGHLIGHT_ITEM"},pt={showDropdown:"showDropdown",hideDropdown:"hideDropdown",change:"change",choice:"choice",search:"search",addItem:"addItem",removeItem:"removeItem",highlightItem:"highlightItem",highlightChoice:"highlightChoice",unhighlightItem:"unhighlightItem"},tt={TAB_KEY:9,SHIFT_KEY:16,BACK_KEY:46,DELETE_KEY:8,ENTER_KEY:13,A_KEY:65,ESC_KEY:27,UP_KEY:38,DOWN_KEY:40,PAGE_UP_KEY:33,PAGE_DOWN_KEY:34},Z0=["fuseOptions","classNames"],sn={Text:"text",SelectOne:"select-one",SelectMultiple:"select-multiple"},Va=function(t){return{type:je.ADD_CHOICE,choice:t}},e1=function(t){return{type:je.REMOVE_CHOICE,choice:t}},t1=function(t){return{type:je.FILTER_CHOICES,results:t}},n1=function(t){return{type:je.ACTIVATE_CHOICES,active:t}},i1=function(t){return{type:je.ADD_GROUP,group:t}},Ha=function(t){return{type:je.ADD_ITEM,item:t}},Ua=function(t){return{type:je.REMOVE_ITEM,item:t}},tr=function(t,e){return{type:je.HIGHLIGHT_ITEM,item:t,highlighted:e}},r1=function(t,e){return Math.floor(Math.random()*(e-t)+t)},Ba=function(t){return Array.from({length:t},function(){return r1(0,36).toString(36)}).join("")},s1=function(t,e){var n=t.id||t.name&&"".concat(t.name,"-").concat(Ba(2))||Ba(4);return n=n.replace(/(:|\.|\[|\]|,)/g,""),n="".concat(e,"-").concat(n),n},o1=function(t,e,n){n===void 0&&(n=1);for(var i="".concat(n>0?"next":"previous","ElementSibling"),r=t[i];r;){if(r.matches(e))return r;r=r[i]}return null},l1=function(t,e,n){n===void 0&&(n=1);var i;return n>0?i=e.scrollTop+e.offsetHeight>=t.offsetTop+t.offsetHeight:i=t.offsetTop>=e.scrollTop,i},nr=function(t){if(typeof t!="string"){if(t==null)return"";if(typeof t=="object"){if("raw"in t)return nr(t.raw);if("trusted"in t)return t.trusted}return t}return t.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/'/g,"&#039;").replace(/"/g,"&quot;")},a1=function(){var t=document.createElement("div");return function(e){t.innerHTML=e.trim();for(var n=t.children[0];t.firstChild;)t.removeChild(t.firstChild);return n}}(),oi=function(t,e){return typeof t=="function"?t(nr(e),e):t},qa=function(t){return typeof t=="function"?t():t},mn=function(t){if(typeof t=="string")return t;if(typeof t=="object"){if("trusted"in t)return t.trusted;if("raw"in t)return t.raw}return""},Ka=function(t){if(typeof t=="string")return t;if(typeof t=="object"){if("escaped"in t)return t.escaped;if("trusted"in t)return t.trusted}return""},fs=function(t,e){return t?Ka(e):nr(e)},Xt=function(t,e,n){t.innerHTML=fs(e,n)},c1=function(t,e){var n=t.value,i=t.label,r=i===void 0?n:i,s=e.value,o=e.label,l=o===void 0?s:o;return mn(r).localeCompare(mn(l),[],{sensitivity:"base",ignorePunctuation:!0,numeric:!0})},u1=function(t,e){return t.rank-e.rank},f1=function(t,e,n){n===void 0&&(n=null);var i=new CustomEvent(e,{detail:n,bubbles:!0,cancelable:!0});return t.dispatchEvent(i)},h1=function(t,e){var n=Object.keys(t).sort(),i=Object.keys(e).sort();return n.filter(function(r){return i.indexOf(r)<0})},ir=function(t){return Array.isArray(t)?t:[t]},li=function(t){return t&&Array.isArray(t)?t.map(function(e){return".".concat(e)}).join(""):".".concat(t)},ge=function(t,e){var n;(n=t.classList).add.apply(n,ir(e))},Ft=function(t,e){var n;(n=t.classList).remove.apply(n,ir(e))},d1=function(t){if(typeof t<"u")try{return JSON.parse(t)}catch{return t}return{}},m1=function(t,e,n){var i=t.itemEl;i&&(Ft(i,n),ge(i,e))},p1=function(){function t(e){var n=e.element,i=e.type,r=e.classNames;this.element=n,this.classNames=r,this.type=i,this.isActive=!1}return t.prototype.show=function(){return ge(this.element,this.classNames.activeState),this.element.setAttribute("aria-expanded","true"),this.isActive=!0,this},t.prototype.hide=function(){return Ft(this.element,this.classNames.activeState),this.element.setAttribute("aria-expanded","false"),this.isActive=!1,this},t}(),Wa=function(){function t(e){var n=e.element,i=e.type,r=e.classNames,s=e.position;this.element=n,this.classNames=r,this.type=i,this.position=s,this.isOpen=!1,this.isFlipped=!1,this.isDisabled=!1,this.isLoading=!1}return t.prototype.shouldFlip=function(e,n){var i=!1;return this.position==="auto"?i=this.element.getBoundingClientRect().top-n>=0&&!window.matchMedia("(min-height: ".concat(e+1,"px)")).matches:this.position==="top"&&(i=!0),i},t.prototype.setActiveDescendant=function(e){this.element.setAttribute("aria-activedescendant",e)},t.prototype.removeActiveDescendant=function(){this.element.removeAttribute("aria-activedescendant")},t.prototype.open=function(e,n){ge(this.element,this.classNames.openState),this.element.setAttribute("aria-expanded","true"),this.isOpen=!0,this.shouldFlip(e,n)&&(ge(this.element,this.classNames.flippedState),this.isFlipped=!0)},t.prototype.close=function(){Ft(this.element,this.classNames.openState),this.element.setAttribute("aria-expanded","false"),this.removeActiveDescendant(),this.isOpen=!1,this.isFlipped&&(Ft(this.element,this.classNames.flippedState),this.isFlipped=!1)},t.prototype.addFocusState=function(){ge(this.element,this.classNames.focusState)},t.prototype.removeFocusState=function(){Ft(this.element,this.classNames.focusState)},t.prototype.enable=function(){Ft(this.element,this.classNames.disabledState),this.element.removeAttribute("aria-disabled"),this.type===sn.SelectOne&&this.element.setAttribute("tabindex","0"),this.isDisabled=!1},t.prototype.disable=function(){ge(this.element,this.classNames.disabledState),this.element.setAttribute("aria-disabled","true"),this.type===sn.SelectOne&&this.element.setAttribute("tabindex","-1"),this.isDisabled=!0},t.prototype.wrap=function(e){var n=this.element,i=e.parentNode;i&&(e.nextSibling?i.insertBefore(n,e.nextSibling):i.appendChild(n)),n.appendChild(e)},t.prototype.unwrap=function(e){var n=this.element,i=n.parentNode;i&&(i.insertBefore(e,n),i.removeChild(n))},t.prototype.addLoadingState=function(){ge(this.element,this.classNames.loadingState),this.element.setAttribute("aria-busy","true"),this.isLoading=!0},t.prototype.removeLoadingState=function(){Ft(this.element,this.classNames.loadingState),this.element.removeAttribute("aria-busy"),this.isLoading=!1},t}(),g1=function(){function t(e){var n=e.element,i=e.type,r=e.classNames,s=e.preventPaste;this.element=n,this.type=i,this.classNames=r,this.preventPaste=s,this.isFocussed=this.element.isEqualNode(document.activeElement),this.isDisabled=n.disabled,this._onPaste=this._onPaste.bind(this),this._onInput=this._onInput.bind(this),this._onFocus=this._onFocus.bind(this),this._onBlur=this._onBlur.bind(this)}return Object.defineProperty(t.prototype,"placeholder",{set:function(e){this.element.placeholder=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){return this.element.value},set:function(e){this.element.value=e},enumerable:!1,configurable:!0}),t.prototype.addEventListeners=function(){var e=this.element;e.addEventListener("paste",this._onPaste),e.addEventListener("input",this._onInput,{passive:!0}),e.addEventListener("focus",this._onFocus,{passive:!0}),e.addEventListener("blur",this._onBlur,{passive:!0})},t.prototype.removeEventListeners=function(){var e=this.element;e.removeEventListener("input",this._onInput),e.removeEventListener("paste",this._onPaste),e.removeEventListener("focus",this._onFocus),e.removeEventListener("blur",this._onBlur)},t.prototype.enable=function(){var e=this.element;e.removeAttribute("disabled"),this.isDisabled=!1},t.prototype.disable=function(){var e=this.element;e.setAttribute("disabled",""),this.isDisabled=!0},t.prototype.focus=function(){this.isFocussed||this.element.focus()},t.prototype.blur=function(){this.isFocussed&&this.element.blur()},t.prototype.clear=function(e){return e===void 0&&(e=!0),this.element.value="",e&&this.setWidth(),this},t.prototype.setWidth=function(){var e=this.element;e.style.minWidth="".concat(e.placeholder.length+1,"ch"),e.style.width="".concat(e.value.length+1,"ch")},t.prototype.setActiveDescendant=function(e){this.element.setAttribute("aria-activedescendant",e)},t.prototype.removeActiveDescendant=function(){this.element.removeAttribute("aria-activedescendant")},t.prototype._onInput=function(){this.type!==sn.SelectOne&&this.setWidth()},t.prototype._onPaste=function(e){this.preventPaste&&e.preventDefault()},t.prototype._onFocus=function(){this.isFocussed=!0},t.prototype._onBlur=function(){this.isFocussed=!1},t}(),_1=4,Ga=function(){function t(e){var n=e.element;this.element=n,this.scrollPos=this.element.scrollTop,this.height=this.element.offsetHeight}return t.prototype.prepend=function(e){var n=this.element.firstElementChild;n?this.element.insertBefore(e,n):this.element.append(e)},t.prototype.scrollToTop=function(){this.element.scrollTop=0},t.prototype.scrollToChildElement=function(e,n){var i=this;if(e){var r=this.element.offsetHeight,s=this.element.scrollTop+r,o=e.offsetHeight,l=e.offsetTop+o,a=n>0?this.element.scrollTop+l-s:e.offsetTop;requestAnimationFrame(function(){i._animateScroll(a,n)})}},t.prototype._scrollDown=function(e,n,i){var r=(i-e)/n,s=r>1?r:1;this.element.scrollTop=e+s},t.prototype._scrollUp=function(e,n,i){var r=(e-i)/n,s=r>1?r:1;this.element.scrollTop=e-s},t.prototype._animateScroll=function(e,n){var i=this,r=_1,s=this.element.scrollTop,o=!1;n>0?(this._scrollDown(s,r,e),s<e&&(o=!0)):(this._scrollUp(s,r,e),s>e&&(o=!0)),o&&requestAnimationFrame(function(){i._animateScroll(e,n)})},t}(),Ya=function(){function t(e){var n=e.element,i=e.classNames;this.element=n,this.classNames=i,this.isDisabled=!1}return Object.defineProperty(t.prototype,"isActive",{get:function(){return this.element.dataset.choice==="active"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dir",{get:function(){return this.element.dir},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){return this.element.value},set:function(e){this.element.setAttribute("value",e),this.element.value=e},enumerable:!1,configurable:!0}),t.prototype.conceal=function(){var e=this.element;ge(e,this.classNames.input),e.hidden=!0,e.tabIndex=-1;var n=e.getAttribute("style");n&&e.setAttribute("data-choice-orig-style",n),e.setAttribute("data-choice","active")},t.prototype.reveal=function(){var e=this.element;Ft(e,this.classNames.input),e.hidden=!1,e.removeAttribute("tabindex");var n=e.getAttribute("data-choice-orig-style");n?(e.removeAttribute("data-choice-orig-style"),e.setAttribute("style",n)):e.removeAttribute("style"),e.removeAttribute("data-choice")},t.prototype.enable=function(){this.element.removeAttribute("disabled"),this.element.disabled=!1,this.isDisabled=!1},t.prototype.disable=function(){this.element.setAttribute("disabled",""),this.element.disabled=!0,this.isDisabled=!0},t.prototype.triggerEvent=function(e,n){f1(this.element,e,n||{})},t}(),v1=function(t){Fa(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e}(Ya),ai=function(t,e){return e===void 0&&(e=!0),typeof t>"u"?e:!!t},Xa=function(t){if(typeof t=="string"&&(t=t.split(" ").filter(function(e){return e.length})),Array.isArray(t)&&t.length)return t},Vt=function(t,e,n){if(n===void 0&&(n=!0),typeof t=="string"){var i=nr(t),r=n||i===t?t:{escaped:i,raw:t},s=Vt({value:t,label:r,selected:!0},!1);return s}var o=t;if("choices"in o){if(!e)throw new TypeError("optGroup is not allowed");var l=o,a=l.choices.map(function(f){return Vt(f,!1)}),c={id:0,label:mn(l.label)||l.value,active:!!a.length,disabled:!!l.disabled,choices:a};return c}var u=o,h={id:0,group:null,score:0,rank:0,value:u.value,label:u.label||u.value,active:ai(u.active),selected:ai(u.selected,!1),disabled:ai(u.disabled,!1),placeholder:ai(u.placeholder,!1),highlighted:!1,labelClass:Xa(u.labelClass),labelDescription:u.labelDescription,customProperties:u.customProperties};return h},y1=function(t){return t.tagName==="INPUT"},Ja=function(t){return t.tagName==="SELECT"},b1=function(t){return t.tagName==="OPTION"},w1=function(t){return t.tagName==="OPTGROUP"},S1=function(t){Fa(e,t);function e(n){var i=n.element,r=n.classNames,s=n.template,o=n.extractPlaceholder,l=t.call(this,{element:i,classNames:r})||this;return l.template=s,l.extractPlaceholder=o,l}return Object.defineProperty(e.prototype,"placeholderOption",{get:function(){return this.element.querySelector('option[value=""]')||this.element.querySelector("option[placeholder]")},enumerable:!1,configurable:!0}),e.prototype.addOptions=function(n){var i=this,r=document.createDocumentFragment();n.forEach(function(s){var o=s;if(!o.element){var l=i.template(o);r.appendChild(l),o.element=l}}),this.element.appendChild(r)},e.prototype.optionsAsChoices=function(){var n=this,i=[];return this.element.querySelectorAll(":scope > option, :scope > optgroup").forEach(function(r){b1(r)?i.push(n._optionToChoice(r)):w1(r)&&i.push(n._optgroupToChoice(r))}),i},e.prototype._optionToChoice=function(n){return!n.hasAttribute("value")&&n.hasAttribute("placeholder")&&(n.setAttribute("value",""),n.value=""),{id:0,group:null,score:0,rank:0,value:n.value,label:n.label,element:n,active:!0,selected:this.extractPlaceholder?n.selected:n.hasAttribute("selected"),disabled:n.disabled,highlighted:!1,placeholder:this.extractPlaceholder&&(!n.value||n.hasAttribute("placeholder")),labelClass:typeof n.dataset.labelClass<"u"?Xa(n.dataset.labelClass):void 0,labelDescription:typeof n.dataset.labelDescription<"u"?n.dataset.labelDescription:void 0,customProperties:d1(n.dataset.customProperties)}},e.prototype._optgroupToChoice=function(n){var i=this,r=n.querySelectorAll("option"),s=Array.from(r).map(function(o){return i._optionToChoice(o)});return{id:0,label:n.label||"",element:n,active:!!s.length,disabled:n.disabled,choices:s}},e}(Ya),k1={containerOuter:["choices"],containerInner:["choices__inner"],input:["choices__input"],inputCloned:["choices__input--cloned"],list:["choices__list"],listItems:["choices__list--multiple"],listSingle:["choices__list--single"],listDropdown:["choices__list--dropdown"],item:["choices__item"],itemSelectable:["choices__item--selectable"],itemDisabled:["choices__item--disabled"],itemChoice:["choices__item--choice"],description:["choices__description"],placeholder:["choices__placeholder"],group:["choices__group"],groupHeading:["choices__heading"],button:["choices__button"],activeState:["is-active"],focusState:["is-focused"],openState:["is-open"],disabledState:["is-disabled"],highlightedState:["is-highlighted"],selectedState:["is-selected"],flippedState:["is-flipped"],loadingState:["is-loading"],notice:["choices__notice"],addChoice:["choices__item--selectable","add-choice"],noResults:["has-no-results"],noChoices:["has-no-choices"]},Qa={items:[],choices:[],silent:!1,renderChoiceLimit:-1,maxItemCount:-1,closeDropdownOnSelect:"auto",singleModeForMultiSelect:!1,addChoices:!1,addItems:!0,addItemFilter:function(t){return!!t&&t!==""},removeItems:!0,removeItemButton:!1,removeItemButtonAlignLeft:!1,editItems:!1,allowHTML:!1,allowHtmlUserInput:!1,duplicateItemsAllowed:!0,delimiter:",",paste:!0,searchEnabled:!0,searchChoices:!0,searchFloor:1,searchResultLimit:4,searchFields:["label","value"],position:"auto",resetScrollPosition:!0,shouldSort:!0,shouldSortItems:!1,sorter:c1,shadowRoot:null,placeholder:!0,placeholderValue:null,searchPlaceholderValue:null,prependValue:null,appendValue:null,renderSelectedChoices:"auto",loadingText:"Loading...",noResultsText:"No results found",noChoicesText:"No choices to choose from",itemSelectText:"Press to select",uniqueItemText:"Only unique values can be added",customAddItemText:"Only values matching specific conditions can be added",addItemText:function(t){return'Press Enter to add <b>"'.concat(t,'"</b>')},removeItemIconText:function(){return"Remove item"},removeItemLabelText:function(t){return"Remove item: ".concat(t)},maxItemText:function(t){return"Only ".concat(t," values can be added")},valueComparer:function(t,e){return t===e},fuseOptions:{includeScore:!0},labelId:"",callbackOnInit:null,callbackOnCreateTemplates:null,classNames:k1,appendGroupInSearch:!1},Za=function(t){var e=t.itemEl;e&&(e.remove(),t.itemEl=void 0)};function E1(t,e,n){var i=t,r=!0;switch(e.type){case je.ADD_ITEM:{e.item.selected=!0;var s=e.item.element;s&&(s.selected=!0,s.setAttribute("selected","")),i.push(e.item);break}case je.REMOVE_ITEM:{e.item.selected=!1;var s=e.item.element;if(s){s.selected=!1,s.removeAttribute("selected");var o=s.parentElement;o&&Ja(o)&&o.type===sn.SelectOne&&(o.value="")}Za(e.item),i=i.filter(function(u){return u.id!==e.item.id});break}case je.REMOVE_CHOICE:{Za(e.choice),i=i.filter(function(c){return c.id!==e.choice.id});break}case je.HIGHLIGHT_ITEM:{var l=e.highlighted,a=i.find(function(c){return c.id===e.item.id});a&&a.highlighted!==l&&(a.highlighted=l,n&&m1(a,l?n.classNames.highlightedState:n.classNames.selectedState,l?n.classNames.selectedState:n.classNames.highlightedState));break}default:{r=!1;break}}return{state:i,update:r}}function C1(t,e){var n=t,i=!0;switch(e.type){case je.ADD_GROUP:{n.push(e.group);break}case je.CLEAR_CHOICES:{n=[];break}default:{i=!1;break}}return{state:n,update:i}}function I1(t,e,n){var i=t,r=!0;switch(e.type){case je.ADD_CHOICE:{i.push(e.choice);break}case je.REMOVE_CHOICE:{e.choice.choiceEl=void 0,e.choice.group&&(e.choice.group.choices=e.choice.group.choices.filter(function(o){return o.id!==e.choice.id})),i=i.filter(function(o){return o.id!==e.choice.id});break}case je.ADD_ITEM:case je.REMOVE_ITEM:{e.item.choiceEl=void 0;break}case je.FILTER_CHOICES:{var s=[];e.results.forEach(function(o){s[o.item.id]=o}),i.forEach(function(o){var l=s[o.id];l!==void 0?(o.score=l.score,o.rank=l.rank,o.active=!0):(o.score=0,o.rank=0,o.active=!1),n&&n.appendGroupInSearch&&(o.choiceEl=void 0)});break}case je.ACTIVATE_CHOICES:{i.forEach(function(o){o.active=e.active,n&&n.appendGroupInSearch&&(o.choiceEl=void 0)});break}case je.CLEAR_CHOICES:{i=[];break}default:{r=!1;break}}return{state:i,update:r}}var ec={groups:C1,items:E1,choices:I1},M1=function(){function t(e){this._state=this.defaultState,this._listeners=[],this._txn=0,this._context=e}return Object.defineProperty(t.prototype,"defaultState",{get:function(){return{groups:[],items:[],choices:[]}},enumerable:!1,configurable:!0}),t.prototype.changeSet=function(e){return{groups:e,items:e,choices:e}},t.prototype.reset=function(){this._state=this.defaultState;var e=this.changeSet(!0);this._txn?this._changeSet=e:this._listeners.forEach(function(n){return n(e)})},t.prototype.subscribe=function(e){return this._listeners.push(e),this},t.prototype.dispatch=function(e){var n=this,i=this._state,r=!1,s=this._changeSet||this.changeSet(!1);Object.keys(ec).forEach(function(o){var l=ec[o](i[o],e,n._context);l.update&&(r=!0,s[o]=!0,i[o]=l.state)}),r&&(this._txn?this._changeSet=s:this._listeners.forEach(function(o){return o(s)}))},t.prototype.withTxn=function(e){this._txn++;try{e()}finally{if(this._txn=Math.max(0,this._txn-1),!this._txn){var n=this._changeSet;n&&(this._changeSet=void 0,this._listeners.forEach(function(i){return i(n)}))}}},Object.defineProperty(t.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"items",{get:function(){return this.state.items},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"highlightedActiveItems",{get:function(){return this.items.filter(function(e){return e.active&&e.highlighted})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"choices",{get:function(){return this.state.choices},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"activeChoices",{get:function(){return this.choices.filter(function(e){return e.active})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"searchableChoices",{get:function(){return this.choices.filter(function(e){return!e.disabled&&!e.placeholder})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"groups",{get:function(){return this.state.groups},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"activeGroups",{get:function(){var e=this;return this.state.groups.filter(function(n){var i=n.active&&!n.disabled,r=e.state.choices.some(function(s){return s.active&&!s.disabled});return i&&r},[])},enumerable:!1,configurable:!0}),t.prototype.inTxn=function(){return this._txn>0},t.prototype.getChoiceById=function(e){return this.activeChoices.find(function(n){return n.id===e})},t.prototype.getGroupById=function(e){return this.groups.find(function(n){return n.id===e})},t}(),Ye={noChoices:"no-choices",noResults:"no-results",addChoice:"add-choice",generic:""};function x1(t,e,n){return(e=T1(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function tc(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function Dn(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?tc(Object(n),!0).forEach(function(i){x1(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):tc(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}function A1(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var i=n.call(t,e||"default");if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function T1(t){var e=A1(t,"string");return typeof e=="symbol"?e:e+""}function Jt(t){return Array.isArray?Array.isArray(t):rc(t)==="[object Array]"}const N1=1/0;function O1(t){if(typeof t=="string")return t;let e=t+"";return e=="0"&&1/t==-N1?"-0":e}function P1(t){return t==null?"":O1(t)}function Ht(t){return typeof t=="string"}function nc(t){return typeof t=="number"}function L1(t){return t===!0||t===!1||R1(t)&&rc(t)=="[object Boolean]"}function ic(t){return typeof t=="object"}function R1(t){return ic(t)&&t!==null}function bt(t){return t!=null}function hs(t){return!t.trim().length}function rc(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(t)}const Jy="Extended search is not available",D1="Incorrect 'index' type",$1=t=>`Invalid value for key ${t}`,z1=t=>`Pattern length exceeds max of ${t}.`,j1=t=>`Missing ${t} property in key`,F1=t=>`Property 'weight' in key '${t}' must be a positive integer`,sc=Object.prototype.hasOwnProperty;class V1{constructor(e){this._keys=[],this._keyMap={};let n=0;e.forEach(i=>{let r=oc(i);this._keys.push(r),this._keyMap[r.id]=r,n+=r.weight}),this._keys.forEach(i=>{i.weight/=n})}get(e){return this._keyMap[e]}keys(){return this._keys}toJSON(){return JSON.stringify(this._keys)}}function oc(t){let e=null,n=null,i=null,r=1,s=null;if(Ht(t)||Jt(t))i=t,e=lc(t),n=ds(t);else{if(!sc.call(t,"name"))throw new Error(j1("name"));const o=t.name;if(i=o,sc.call(t,"weight")&&(r=t.weight,r<=0))throw new Error(F1(o));e=lc(o),n=ds(o),s=t.getFn}return{path:e,id:n,weight:r,src:i,getFn:s}}function lc(t){return Jt(t)?t:t.split(".")}function ds(t){return Jt(t)?t.join("."):t}function H1(t,e){let n=[],i=!1;const r=(s,o,l)=>{if(bt(s))if(!o[l])n.push(s);else{let a=o[l];const c=s[a];if(!bt(c))return;if(l===o.length-1&&(Ht(c)||nc(c)||L1(c)))n.push(P1(c));else if(Jt(c)){i=!0;for(let u=0,h=c.length;u<h;u+=1)r(c[u],o,l+1)}else o.length&&r(c,o,l+1)}};return r(t,Ht(e)?e.split("."):e,0),i?n:n[0]}const U1={includeMatches:!1,findAllMatches:!1,minMatchCharLength:1},B1={isCaseSensitive:!1,includeScore:!1,keys:[],shouldSort:!0,sortFn:(t,e)=>t.score===e.score?t.idx<e.idx?-1:1:t.score<e.score?-1:1},q1={location:0,threshold:.6,distance:100},K1={useExtendedSearch:!1,getFn:H1,ignoreLocation:!1,ignoreFieldNorm:!1,fieldNormWeight:1};var de=Dn(Dn(Dn(Dn({},B1),U1),q1),K1);const W1=/[^ ]+/g;function G1(t=1,e=3){const n=new Map,i=Math.pow(10,e);return{get(r){const s=r.match(W1).length;if(n.has(s))return n.get(s);const o=1/Math.pow(s,.5*t),l=parseFloat(Math.round(o*i)/i);return n.set(s,l),l},clear(){n.clear()}}}class ms{constructor({getFn:e=de.getFn,fieldNormWeight:n=de.fieldNormWeight}={}){this.norm=G1(n,3),this.getFn=e,this.isCreated=!1,this.setIndexRecords()}setSources(e=[]){this.docs=e}setIndexRecords(e=[]){this.records=e}setKeys(e=[]){this.keys=e,this._keysMap={},e.forEach((n,i)=>{this._keysMap[n.id]=i})}create(){this.isCreated||!this.docs.length||(this.isCreated=!0,Ht(this.docs[0])?this.docs.forEach((e,n)=>{this._addString(e,n)}):this.docs.forEach((e,n)=>{this._addObject(e,n)}),this.norm.clear())}add(e){const n=this.size();Ht(e)?this._addString(e,n):this._addObject(e,n)}removeAt(e){this.records.splice(e,1);for(let n=e,i=this.size();n<i;n+=1)this.records[n].i-=1}getValueForItemAtKeyId(e,n){return e[this._keysMap[n]]}size(){return this.records.length}_addString(e,n){if(!bt(e)||hs(e))return;let i={v:e,i:n,n:this.norm.get(e)};this.records.push(i)}_addObject(e,n){let i={i:n,$:{}};this.keys.forEach((r,s)=>{let o=r.getFn?r.getFn(e):this.getFn(e,r.path);if(bt(o)){if(Jt(o)){let l=[];const a=[{nestedArrIndex:-1,value:o}];for(;a.length;){const{nestedArrIndex:c,value:u}=a.pop();if(bt(u))if(Ht(u)&&!hs(u)){let h={v:u,i:c,n:this.norm.get(u)};l.push(h)}else Jt(u)&&u.forEach((h,f)=>{a.push({nestedArrIndex:f,value:h})})}i.$[s]=l}else if(Ht(o)&&!hs(o)){let l={v:o,n:this.norm.get(o)};i.$[s]=l}}}),this.records.push(i)}toJSON(){return{keys:this.keys,records:this.records}}}function ac(t,e,{getFn:n=de.getFn,fieldNormWeight:i=de.fieldNormWeight}={}){const r=new ms({getFn:n,fieldNormWeight:i});return r.setKeys(t.map(oc)),r.setSources(e),r.create(),r}function Y1(t,{getFn:e=de.getFn,fieldNormWeight:n=de.fieldNormWeight}={}){const{keys:i,records:r}=t,s=new ms({getFn:e,fieldNormWeight:n});return s.setKeys(i),s.setIndexRecords(r),s}function rr(t,{errors:e=0,currentLocation:n=0,expectedLocation:i=0,distance:r=de.distance,ignoreLocation:s=de.ignoreLocation}={}){const o=e/t.length;if(s)return o;const l=Math.abs(i-n);return r?o+l/r:l?1:o}function X1(t=[],e=de.minMatchCharLength){let n=[],i=-1,r=-1,s=0;for(let o=t.length;s<o;s+=1){let l=t[s];l&&i===-1?i=s:!l&&i!==-1&&(r=s-1,r-i+1>=e&&n.push([i,r]),i=-1)}return t[s-1]&&s-i>=e&&n.push([i,s-1]),n}const pn=32;function J1(t,e,n,{location:i=de.location,distance:r=de.distance,threshold:s=de.threshold,findAllMatches:o=de.findAllMatches,minMatchCharLength:l=de.minMatchCharLength,includeMatches:a=de.includeMatches,ignoreLocation:c=de.ignoreLocation}={}){if(e.length>pn)throw new Error(z1(pn));const u=e.length,h=t.length,f=Math.max(0,Math.min(i,h));let d=s,m=f;const p=l>1||a,g=p?Array(h):[];let _;for(;(_=t.indexOf(e,m))>-1;){let A=rr(e,{currentLocation:_,expectedLocation:f,distance:r,ignoreLocation:c});if(d=Math.min(A,d),m=_+u,p){let E=0;for(;E<u;)g[_+E]=1,E+=1}}m=-1;let S=[],C=1,b=u+h;const k=1<<u-1;for(let A=0;A<u;A+=1){let E=0,M=b;for(;E<M;)rr(e,{errors:A,currentLocation:f+M,expectedLocation:f,distance:r,ignoreLocation:c})<=d?E=M:b=M,M=Math.floor((b-E)/2+E);b=M;let D=Math.max(1,f-M+1),$=o?h:Math.min(f+M,h)+u,R=Array($+2);R[$+1]=(1<<A)-1;for(let I=$;I>=D;I-=1){let N=I-1,x=n[t.charAt(N)];if(p&&(g[N]=+!!x),R[I]=(R[I+1]<<1|1)&x,A&&(R[I]|=(S[I+1]|S[I])<<1|1|S[I+1]),R[I]&k&&(C=rr(e,{errors:A,currentLocation:N,expectedLocation:f,distance:r,ignoreLocation:c}),C<=d)){if(d=C,m=N,m<=f)break;D=Math.max(1,2*f-m)}}if(rr(e,{errors:A+1,currentLocation:f,expectedLocation:f,distance:r,ignoreLocation:c})>d)break;S=R}const P={isMatch:m>=0,score:Math.max(.001,C)};if(p){const A=X1(g,l);A.length?a&&(P.indices=A):P.isMatch=!1}return P}function Q1(t){let e={};for(let n=0,i=t.length;n<i;n+=1){const r=t.charAt(n);e[r]=(e[r]||0)|1<<i-n-1}return e}class cc{constructor(e,{location:n=de.location,threshold:i=de.threshold,distance:r=de.distance,includeMatches:s=de.includeMatches,findAllMatches:o=de.findAllMatches,minMatchCharLength:l=de.minMatchCharLength,isCaseSensitive:a=de.isCaseSensitive,ignoreLocation:c=de.ignoreLocation}={}){if(this.options={location:n,threshold:i,distance:r,includeMatches:s,findAllMatches:o,minMatchCharLength:l,isCaseSensitive:a,ignoreLocation:c},this.pattern=a?e:e.toLowerCase(),this.chunks=[],!this.pattern.length)return;const u=(f,d)=>{this.chunks.push({pattern:f,alphabet:Q1(f),startIndex:d})},h=this.pattern.length;if(h>pn){let f=0;const d=h%pn,m=h-d;for(;f<m;)u(this.pattern.substr(f,pn),f),f+=pn;if(d){const p=h-pn;u(this.pattern.substr(p),p)}}else u(this.pattern,0)}searchIn(e){const{isCaseSensitive:n,includeMatches:i}=this.options;if(n||(e=e.toLowerCase()),this.pattern===e){let m={isMatch:!0,score:0};return i&&(m.indices=[[0,e.length-1]]),m}const{location:r,distance:s,threshold:o,findAllMatches:l,minMatchCharLength:a,ignoreLocation:c}=this.options;let u=[],h=0,f=!1;this.chunks.forEach(({pattern:m,alphabet:p,startIndex:g})=>{const{isMatch:_,score:S,indices:C}=J1(e,m,p,{location:r+g,distance:s,threshold:o,findAllMatches:l,minMatchCharLength:a,includeMatches:i,ignoreLocation:c});_&&(f=!0),h+=S,_&&C&&(u=[...u,...C])});let d={isMatch:f,score:f?h/this.chunks.length:1};return f&&i&&(d.indices=u),d}}class on{constructor(e){this.pattern=e}static isMultiMatch(e){return uc(e,this.multiRegex)}static isSingleMatch(e){return uc(e,this.singleRegex)}search(){}}function uc(t,e){const n=t.match(e);return n?n[1]:null}class Z1 extends on{constructor(e){super(e)}static get type(){return"exact"}static get multiRegex(){return/^="(.*)"$/}static get singleRegex(){return/^=(.*)$/}search(e){const n=e===this.pattern;return{isMatch:n,score:n?0:1,indices:[0,this.pattern.length-1]}}}class ev extends on{constructor(e){super(e)}static get type(){return"inverse-exact"}static get multiRegex(){return/^!"(.*)"$/}static get singleRegex(){return/^!(.*)$/}search(e){const i=e.indexOf(this.pattern)===-1;return{isMatch:i,score:i?0:1,indices:[0,e.length-1]}}}class tv extends on{constructor(e){super(e)}static get type(){return"prefix-exact"}static get multiRegex(){return/^\^"(.*)"$/}static get singleRegex(){return/^\^(.*)$/}search(e){const n=e.startsWith(this.pattern);return{isMatch:n,score:n?0:1,indices:[0,this.pattern.length-1]}}}class nv extends on{constructor(e){super(e)}static get type(){return"inverse-prefix-exact"}static get multiRegex(){return/^!\^"(.*)"$/}static get singleRegex(){return/^!\^(.*)$/}search(e){const n=!e.startsWith(this.pattern);return{isMatch:n,score:n?0:1,indices:[0,e.length-1]}}}class iv extends on{constructor(e){super(e)}static get type(){return"suffix-exact"}static get multiRegex(){return/^"(.*)"\$$/}static get singleRegex(){return/^(.*)\$$/}search(e){const n=e.endsWith(this.pattern);return{isMatch:n,score:n?0:1,indices:[e.length-this.pattern.length,e.length-1]}}}class rv extends on{constructor(e){super(e)}static get type(){return"inverse-suffix-exact"}static get multiRegex(){return/^!"(.*)"\$$/}static get singleRegex(){return/^!(.*)\$$/}search(e){const n=!e.endsWith(this.pattern);return{isMatch:n,score:n?0:1,indices:[0,e.length-1]}}}class fc extends on{constructor(e,{location:n=de.location,threshold:i=de.threshold,distance:r=de.distance,includeMatches:s=de.includeMatches,findAllMatches:o=de.findAllMatches,minMatchCharLength:l=de.minMatchCharLength,isCaseSensitive:a=de.isCaseSensitive,ignoreLocation:c=de.ignoreLocation}={}){super(e),this._bitapSearch=new cc(e,{location:n,threshold:i,distance:r,includeMatches:s,findAllMatches:o,minMatchCharLength:l,isCaseSensitive:a,ignoreLocation:c})}static get type(){return"fuzzy"}static get multiRegex(){return/^"(.*)"$/}static get singleRegex(){return/^(.*)$/}search(e){return this._bitapSearch.searchIn(e)}}class hc extends on{constructor(e){super(e)}static get type(){return"include"}static get multiRegex(){return/^'"(.*)"$/}static get singleRegex(){return/^'(.*)$/}search(e){let n=0,i;const r=[],s=this.pattern.length;for(;(i=e.indexOf(this.pattern,n))>-1;)n=i+s,r.push([i,n-1]);const o=!!r.length;return{isMatch:o,score:o?0:1,indices:r}}}const ps=[Z1,hc,tv,nv,rv,iv,ev,fc],dc=ps.length,sv=/ +(?=(?:[^\"]*\"[^\"]*\")*[^\"]*$)/,ov="|";function lv(t,e={}){return t.split(ov).map(n=>{let i=n.trim().split(sv).filter(s=>s&&!!s.trim()),r=[];for(let s=0,o=i.length;s<o;s+=1){const l=i[s];let a=!1,c=-1;for(;!a&&++c<dc;){const u=ps[c];let h=u.isMultiMatch(l);h&&(r.push(new u(h,e)),a=!0)}if(!a)for(c=-1;++c<dc;){const u=ps[c];let h=u.isSingleMatch(l);if(h){r.push(new u(h,e));break}}}return r})}const av=new Set([fc.type,hc.type]);class cv{constructor(e,{isCaseSensitive:n=de.isCaseSensitive,includeMatches:i=de.includeMatches,minMatchCharLength:r=de.minMatchCharLength,ignoreLocation:s=de.ignoreLocation,findAllMatches:o=de.findAllMatches,location:l=de.location,threshold:a=de.threshold,distance:c=de.distance}={}){this.query=null,this.options={isCaseSensitive:n,includeMatches:i,minMatchCharLength:r,findAllMatches:o,ignoreLocation:s,location:l,threshold:a,distance:c},this.pattern=n?e:e.toLowerCase(),this.query=lv(this.pattern,this.options)}static condition(e,n){return n.useExtendedSearch}searchIn(e){const n=this.query;if(!n)return{isMatch:!1,score:1};const{includeMatches:i,isCaseSensitive:r}=this.options;e=r?e:e.toLowerCase();let s=0,o=[],l=0;for(let a=0,c=n.length;a<c;a+=1){const u=n[a];o.length=0,s=0;for(let h=0,f=u.length;h<f;h+=1){const d=u[h],{isMatch:m,indices:p,score:g}=d.search(e);if(m){if(s+=1,l+=g,i){const _=d.constructor.type;av.has(_)?o=[...o,...p]:o.push(p)}}else{l=0,s=0,o.length=0;break}}if(s){let h={isMatch:!0,score:l/s};return i&&(h.indices=o),h}}return{isMatch:!1,score:1}}}const gs=[];function uv(...t){gs.push(...t)}function _s(t,e){for(let n=0,i=gs.length;n<i;n+=1){let r=gs[n];if(r.condition(t,e))return new r(t,e)}return new cc(t,e)}const sr={AND:"$and",OR:"$or"},vs={PATH:"$path",PATTERN:"$val"},ys=t=>!!(t[sr.AND]||t[sr.OR]),fv=t=>!!t[vs.PATH],hv=t=>!Jt(t)&&ic(t)&&!ys(t),mc=t=>({[sr.AND]:Object.keys(t).map(e=>({[e]:t[e]}))});function pc(t,e,{auto:n=!0}={}){const i=r=>{let s=Object.keys(r);const o=fv(r);if(!o&&s.length>1&&!ys(r))return i(mc(r));if(hv(r)){const a=o?r[vs.PATH]:s[0],c=o?r[vs.PATTERN]:r[a];if(!Ht(c))throw new Error($1(a));const u={keyId:ds(a),pattern:c};return n&&(u.searcher=_s(c,e)),u}let l={children:[],operator:s[0]};return s.forEach(a=>{const c=r[a];Jt(c)&&c.forEach(u=>{l.children.push(i(u))})}),l};return ys(t)||(t=mc(t)),i(t)}function dv(t,{ignoreFieldNorm:e=de.ignoreFieldNorm}){t.forEach(n=>{let i=1;n.matches.forEach(({key:r,norm:s,score:o})=>{const l=r?r.weight:null;i*=Math.pow(o===0&&l?Number.EPSILON:o,(l||1)*(e?1:s))}),n.score=i})}function mv(t,e){const n=t.matches;e.matches=[],bt(n)&&n.forEach(i=>{if(!bt(i.indices)||!i.indices.length)return;const{indices:r,value:s}=i;let o={indices:r,value:s};i.key&&(o.key=i.key.src),i.idx>-1&&(o.refIndex=i.idx),e.matches.push(o)})}function pv(t,e){e.score=t.score}function gv(t,e,{includeMatches:n=de.includeMatches,includeScore:i=de.includeScore}={}){const r=[];return n&&r.push(mv),i&&r.push(pv),t.map(s=>{const{idx:o}=s,l={item:e[o],refIndex:o};return r.length&&r.forEach(a=>{a(s,l)}),l})}class $n{constructor(e,n={},i){this.options=Dn(Dn({},de),n),this.options.useExtendedSearch,this._keyStore=new V1(this.options.keys),this.setCollection(e,i)}setCollection(e,n){if(this._docs=e,n&&!(n instanceof ms))throw new Error(D1);this._myIndex=n||ac(this.options.keys,this._docs,{getFn:this.options.getFn,fieldNormWeight:this.options.fieldNormWeight})}add(e){bt(e)&&(this._docs.push(e),this._myIndex.add(e))}remove(e=()=>!1){const n=[];for(let i=0,r=this._docs.length;i<r;i+=1){const s=this._docs[i];e(s,i)&&(this.removeAt(i),i-=1,r-=1,n.push(s))}return n}removeAt(e){this._docs.splice(e,1),this._myIndex.removeAt(e)}getIndex(){return this._myIndex}search(e,{limit:n=-1}={}){const{includeMatches:i,includeScore:r,shouldSort:s,sortFn:o,ignoreFieldNorm:l}=this.options;let a=Ht(e)?Ht(this._docs[0])?this._searchStringList(e):this._searchObjectList(e):this._searchLogical(e);return dv(a,{ignoreFieldNorm:l}),s&&a.sort(o),nc(n)&&n>-1&&(a=a.slice(0,n)),gv(a,this._docs,{includeMatches:i,includeScore:r})}_searchStringList(e){const n=_s(e,this.options),{records:i}=this._myIndex,r=[];return i.forEach(({v:s,i:o,n:l})=>{if(!bt(s))return;const{isMatch:a,score:c,indices:u}=n.searchIn(s);a&&r.push({item:s,idx:o,matches:[{score:c,value:s,norm:l,indices:u}]})}),r}_searchLogical(e){const n=pc(e,this.options),i=(l,a,c)=>{if(!l.children){const{keyId:h,searcher:f}=l,d=this._findMatches({key:this._keyStore.get(h),value:this._myIndex.getValueForItemAtKeyId(a,h),searcher:f});return d&&d.length?[{idx:c,item:a,matches:d}]:[]}const u=[];for(let h=0,f=l.children.length;h<f;h+=1){const d=l.children[h],m=i(d,a,c);if(m.length)u.push(...m);else if(l.operator===sr.AND)return[]}return u},r=this._myIndex.records,s={},o=[];return r.forEach(({$:l,i:a})=>{if(bt(l)){let c=i(n,l,a);c.length&&(s[a]||(s[a]={idx:a,item:l,matches:[]},o.push(s[a])),c.forEach(({matches:u})=>{s[a].matches.push(...u)}))}}),o}_searchObjectList(e){const n=_s(e,this.options),{keys:i,records:r}=this._myIndex,s=[];return r.forEach(({$:o,i:l})=>{if(!bt(o))return;let a=[];i.forEach((c,u)=>{a.push(...this._findMatches({key:c,value:o[u],searcher:n}))}),a.length&&s.push({idx:l,item:o,matches:a})}),s}_findMatches({key:e,value:n,searcher:i}){if(!bt(n))return[];let r=[];if(Jt(n))n.forEach(({v:s,i:o,n:l})=>{if(!bt(s))return;const{isMatch:a,score:c,indices:u}=i.searchIn(s);a&&r.push({score:c,key:e,value:s,idx:o,norm:l,indices:u})});else{const{v:s,n:o}=n,{isMatch:l,score:a,indices:c}=i.searchIn(s);l&&r.push({score:a,key:e,value:s,norm:o,indices:c})}return r}}$n.version="7.0.0",$n.createIndex=ac,$n.parseIndex=Y1,$n.config=de,$n.parseQuery=pc,uv(cv);var _v=function(){function t(e){this._haystack=[],this._fuseOptions=mt(mt({},e.fuseOptions),{keys:Q0([],e.searchFields,!0),includeMatches:!0})}return t.prototype.index=function(e){this._haystack=e,this._fuse&&this._fuse.setCollection(e)},t.prototype.reset=function(){this._haystack=[],this._fuse=void 0},t.prototype.isEmptyIndex=function(){return!this._haystack.length},t.prototype.search=function(e){this._fuse||(this._fuse=new $n(this._haystack,this._fuseOptions));var n=this._fuse.search(e);return n.map(function(i,r){return{item:i.item,score:i.score||0,rank:r+1}})},t}();function vv(t){return new _v(t)}var yv=function(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0},bs=function(t,e,n){var i=t.dataset,r=e.customProperties,s=e.labelClass,o=e.labelDescription;s&&(i.labelClass=ir(s).join(" ")),o&&(i.labelDescription=o),n&&r&&(typeof r=="string"?i.customProperties=r:typeof r=="object"&&!yv(r)&&(i.customProperties=JSON.stringify(r)))},gc=function(t,e,n){var i=e&&t.querySelector("label[for='".concat(e,"']")),r=i&&i.innerText;r&&n.setAttribute("aria-label",r)},bv={containerOuter:function(t,e,n,i,r,s,o){var l=t.classNames.containerOuter,a=document.createElement("div");return ge(a,l),a.dataset.type=s,e&&(a.dir=e),i&&(a.tabIndex=0),n&&(a.setAttribute("role",r?"combobox":"listbox"),r?a.setAttribute("aria-autocomplete","list"):o||gc(this._docRoot,this.passedElement.element.id,a),a.setAttribute("aria-haspopup","true"),a.setAttribute("aria-expanded","false")),o&&a.setAttribute("aria-labelledby",o),a},containerInner:function(t){var e=t.classNames.containerInner,n=document.createElement("div");return ge(n,e),n},itemList:function(t,e){var n=t.searchEnabled,i=t.classNames,r=i.list,s=i.listSingle,o=i.listItems,l=document.createElement("div");return ge(l,r),ge(l,e?s:o),this._isSelectElement&&n&&l.setAttribute("role","listbox"),l},placeholder:function(t,e){var n=t.allowHTML,i=t.classNames.placeholder,r=document.createElement("div");return ge(r,i),Xt(r,n,e),r},item:function(t,e,n){var i=t.allowHTML,r=t.removeItemButtonAlignLeft,s=t.removeItemIconText,o=t.removeItemLabelText,l=t.classNames,a=l.item,c=l.button,u=l.highlightedState,h=l.itemSelectable,f=l.placeholder,d=mn(e.value),m=document.createElement("div");if(ge(m,a),e.labelClass){var p=document.createElement("span");Xt(p,i,e.label),ge(p,e.labelClass),m.appendChild(p)}else Xt(m,i,e.label);if(m.dataset.item="",m.dataset.id=e.id,m.dataset.value=d,bs(m,e,!0),(e.disabled||this.containerOuter.isDisabled)&&m.setAttribute("aria-disabled","true"),this._isSelectElement&&(m.setAttribute("aria-selected","true"),m.setAttribute("role","option")),e.placeholder&&(ge(m,f),m.dataset.placeholder=""),ge(m,e.highlighted?u:h),n){e.disabled&&Ft(m,h),m.dataset.deletable="";var g=document.createElement("button");g.type="button",ge(g,c),Xt(g,!0,oi(s,e.value));var _=oi(o,e.value);_&&g.setAttribute("aria-label",_),g.dataset.button="",r?m.insertAdjacentElement("afterbegin",g):m.appendChild(g)}return m},choiceList:function(t,e){var n=t.classNames.list,i=document.createElement("div");return ge(i,n),e||i.setAttribute("aria-multiselectable","true"),i.setAttribute("role","listbox"),i},choiceGroup:function(t,e){var n=t.allowHTML,i=t.classNames,r=i.group,s=i.groupHeading,o=i.itemDisabled,l=e.id,a=e.label,c=e.disabled,u=mn(a),h=document.createElement("div");ge(h,r),c&&ge(h,o),h.setAttribute("role","group"),h.dataset.group="",h.dataset.id=l,h.dataset.value=u,c&&h.setAttribute("aria-disabled","true");var f=document.createElement("div");return ge(f,s),Xt(f,n,a||""),h.appendChild(f),h},choice:function(t,e,n,i){var r=t.allowHTML,s=t.classNames,o=s.item,l=s.itemChoice,a=s.itemSelectable,c=s.selectedState,u=s.itemDisabled,h=s.description,f=s.placeholder,d=e.label,m=mn(e.value),p=document.createElement("div");p.id=e.elementId,ge(p,o),ge(p,l),i&&typeof d=="string"&&(d=fs(r,d),d+=" (".concat(i,")"),d={trusted:d});var g=p;if(e.labelClass){var _=document.createElement("span");Xt(_,r,d),ge(_,e.labelClass),g=_,p.appendChild(_)}else Xt(p,r,d);if(e.labelDescription){var S="".concat(e.elementId,"-description");g.setAttribute("aria-describedby",S);var C=document.createElement("span");Xt(C,r,e.labelDescription),C.id=S,ge(C,h),p.appendChild(C)}return e.selected&&ge(p,c),e.placeholder&&ge(p,f),p.setAttribute("role",e.group?"treeitem":"option"),p.dataset.choice="",p.dataset.id=e.id,p.dataset.value=m,n&&(p.dataset.selectText=n),e.group&&(p.dataset.groupId="".concat(e.group.id)),bs(p,e,!1),e.disabled?(ge(p,u),p.dataset.choiceDisabled="",p.setAttribute("aria-disabled","true")):(ge(p,a),p.dataset.choiceSelectable=""),p},input:function(t,e){var n=t.classNames,i=n.input,r=n.inputCloned,s=t.labelId,o=document.createElement("input");return o.type="search",ge(o,i),ge(o,r),o.autocomplete="off",o.autocapitalize="off",o.spellcheck=!1,o.setAttribute("aria-autocomplete","list"),e?o.setAttribute("aria-label",e):s||gc(this._docRoot,this.passedElement.element.id,o),o},dropdown:function(t){var e=t.classNames,n=e.list,i=e.listDropdown,r=document.createElement("div");return ge(r,n),ge(r,i),r.setAttribute("aria-expanded","false"),r},notice:function(t,e,n){var i=t.classNames,r=i.item,s=i.itemChoice,o=i.addChoice,l=i.noResults,a=i.noChoices,c=i.notice;n===void 0&&(n=Ye.generic);var u=document.createElement("div");switch(Xt(u,!0,e),ge(u,r),ge(u,s),ge(u,c),n){case Ye.addChoice:ge(u,o);break;case Ye.noResults:ge(u,l);break;case Ye.noChoices:ge(u,a);break}return n===Ye.addChoice&&(u.dataset.choiceSelectable="",u.dataset.choice=""),u},option:function(t){var e=mn(t.label),n=new Option(e,t.value,!1,t.selected);return bs(n,t,!0),n.disabled=t.disabled,t.selected&&n.setAttribute("selected",""),n}},wv="-ms-scroll-limit"in document.documentElement.style&&"-ms-ime-align"in document.documentElement.style,Sv={},ws=function(t){if(t)return t.dataset.id?parseInt(t.dataset.id,10):void 0},ci="[data-choice-selectable]",kv=function(){function t(e,n){e===void 0&&(e="[data-choice]"),n===void 0&&(n={});var i=this;this.initialisedOK=void 0,this._hasNonChoicePlaceholder=!1,this._lastAddedChoiceId=0,this._lastAddedGroupId=0;var r=t.defaults;this.config=mt(mt(mt({},r.allOptions),r.options),n),Z0.forEach(function(_){i.config[_]=mt(mt(mt({},r.allOptions[_]),r.options[_]),n[_])});var s=this.config;s.silent||this._validateConfig();var o=s.shadowRoot||document.documentElement;this._docRoot=o;var l=typeof e=="string"?o.querySelector(e):e;if(!l||typeof l!="object"||!(y1(l)||Ja(l)))throw TypeError(!l&&typeof e=="string"?"Selector ".concat(e," failed to find an element"):"Expected one of the following types text|select-one|select-multiple");var a=l.type,c=a===sn.Text;(c||s.maxItemCount!==1)&&(s.singleModeForMultiSelect=!1),s.singleModeForMultiSelect&&(a=sn.SelectMultiple);var u=a===sn.SelectOne,h=a===sn.SelectMultiple,f=u||h;if(this._elementType=a,this._isTextElement=c,this._isSelectOneElement=u,this._isSelectMultipleElement=h,this._isSelectElement=u||h,this._canAddUserChoices=c&&s.addItems||f&&s.addChoices,typeof s.renderSelectedChoices!="boolean"&&(s.renderSelectedChoices=s.renderSelectedChoices==="always"||u),s.closeDropdownOnSelect==="auto"?s.closeDropdownOnSelect=c||u||s.singleModeForMultiSelect:s.closeDropdownOnSelect=ai(s.closeDropdownOnSelect),s.placeholder&&(s.placeholderValue?this._hasNonChoicePlaceholder=!0:l.dataset.placeholder&&(this._hasNonChoicePlaceholder=!0,s.placeholderValue=l.dataset.placeholder)),n.addItemFilter&&typeof n.addItemFilter!="function"){var d=n.addItemFilter instanceof RegExp?n.addItemFilter:new RegExp(n.addItemFilter);s.addItemFilter=d.test.bind(d)}if(this._isTextElement)this.passedElement=new v1({element:l,classNames:s.classNames});else{var m=l;this.passedElement=new S1({element:m,classNames:s.classNames,template:function(_){return i._templates.option(_)},extractPlaceholder:s.placeholder&&!this._hasNonChoicePlaceholder})}if(this.initialised=!1,this._store=new M1(s),this._currentValue="",s.searchEnabled=!c&&s.searchEnabled||h,this._canSearch=s.searchEnabled,this._isScrollingOnIe=!1,this._highlightPosition=0,this._wasTap=!0,this._placeholderValue=this._generatePlaceholderValue(),this._baseId=s1(l,"choices-"),this._direction=l.dir,!this._direction){var p=window.getComputedStyle(l).direction,g=window.getComputedStyle(document.documentElement).direction;p!==g&&(this._direction=p)}if(this._idNames={itemChoice:"item-choice"},this._templates=r.templates,this._render=this._render.bind(this),this._onFocus=this._onFocus.bind(this),this._onBlur=this._onBlur.bind(this),this._onKeyUp=this._onKeyUp.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onInput=this._onInput.bind(this),this._onClick=this._onClick.bind(this),this._onTouchMove=this._onTouchMove.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._onMouseDown=this._onMouseDown.bind(this),this._onMouseOver=this._onMouseOver.bind(this),this._onFormReset=this._onFormReset.bind(this),this._onSelectKey=this._onSelectKey.bind(this),this._onEnterKey=this._onEnterKey.bind(this),this._onEscapeKey=this._onEscapeKey.bind(this),this._onDirectionKey=this._onDirectionKey.bind(this),this._onDeleteKey=this._onDeleteKey.bind(this),this.passedElement.isActive){s.silent||console.warn("Trying to initialise Choices on element already initialised",{element:e}),this.initialised=!0,this.initialisedOK=!1;return}this.init(),this._initialItems=this._store.items.map(function(_){return _.value})}return Object.defineProperty(t,"defaults",{get:function(){return Object.preventExtensions({get options(){return Sv},get allOptions(){return Qa},get templates(){return bv}})},enumerable:!1,configurable:!0}),t.prototype.init=function(){if(!(this.initialised||this.initialisedOK!==void 0)){this._searcher=vv(this.config),this._loadChoices(),this._createTemplates(),this._createElements(),this._createStructure(),this._isTextElement&&!this.config.addItems||this.passedElement.element.hasAttribute("disabled")||this.passedElement.element.closest("fieldset:disabled")?this.disable():(this.enable(),this._addEventListeners()),this._initStore(),this.initialised=!0,this.initialisedOK=!0;var e=this.config.callbackOnInit;typeof e=="function"&&e.call(this)}},t.prototype.destroy=function(){this.initialised&&(this._removeEventListeners(),this.passedElement.reveal(),this.containerOuter.unwrap(this.passedElement.element),this._store._listeners=[],this.clearStore(!1),this._stopSearch(),this._templates=t.defaults.templates,this.initialised=!1,this.initialisedOK=void 0)},t.prototype.enable=function(){return this.passedElement.isDisabled&&this.passedElement.enable(),this.containerOuter.isDisabled&&(this._addEventListeners(),this.input.enable(),this.containerOuter.enable()),this},t.prototype.disable=function(){return this.passedElement.isDisabled||this.passedElement.disable(),this.containerOuter.isDisabled||(this._removeEventListeners(),this.input.disable(),this.containerOuter.disable()),this},t.prototype.highlightItem=function(e,n){if(n===void 0&&(n=!0),!e||!e.id)return this;var i=this._store.items.find(function(r){return r.id===e.id});return!i||i.highlighted?this:(this._store.dispatch(tr(i,!0)),n&&this.passedElement.triggerEvent(pt.highlightItem,this._getChoiceForOutput(i)),this)},t.prototype.unhighlightItem=function(e,n){if(n===void 0&&(n=!0),!e||!e.id)return this;var i=this._store.items.find(function(r){return r.id===e.id});return!i||!i.highlighted?this:(this._store.dispatch(tr(i,!1)),n&&this.passedElement.triggerEvent(pt.unhighlightItem,this._getChoiceForOutput(i)),this)},t.prototype.highlightAll=function(){var e=this;return this._store.withTxn(function(){e._store.items.forEach(function(n){n.highlighted||(e._store.dispatch(tr(n,!0)),e.passedElement.triggerEvent(pt.highlightItem,e._getChoiceForOutput(n)))})}),this},t.prototype.unhighlightAll=function(){var e=this;return this._store.withTxn(function(){e._store.items.forEach(function(n){n.highlighted&&(e._store.dispatch(tr(n,!1)),e.passedElement.triggerEvent(pt.highlightItem,e._getChoiceForOutput(n)))})}),this},t.prototype.removeActiveItemsByValue=function(e){var n=this;return this._store.withTxn(function(){n._store.items.filter(function(i){return i.value===e}).forEach(function(i){return n._removeItem(i)})}),this},t.prototype.removeActiveItems=function(e){var n=this;return this._store.withTxn(function(){n._store.items.filter(function(i){var r=i.id;return r!==e}).forEach(function(i){return n._removeItem(i)})}),this},t.prototype.removeHighlightedItems=function(e){var n=this;return e===void 0&&(e=!1),this._store.withTxn(function(){n._store.highlightedActiveItems.forEach(function(i){n._removeItem(i),e&&n._triggerChange(i.value)})}),this},t.prototype.showDropdown=function(e){var n=this;return this.dropdown.isActive?this:(e===void 0&&(e=!this._canSearch),requestAnimationFrame(function(){n.dropdown.show();var i=n.dropdown.element.getBoundingClientRect();n.containerOuter.open(i.bottom,i.height),e||n.input.focus(),n.passedElement.triggerEvent(pt.showDropdown)}),this)},t.prototype.hideDropdown=function(e){var n=this;return this.dropdown.isActive?(requestAnimationFrame(function(){n.dropdown.hide(),n.containerOuter.close(),!e&&n._canSearch&&(n.input.removeActiveDescendant(),n.input.blur()),n.passedElement.triggerEvent(pt.hideDropdown)}),this):this},t.prototype.getValue=function(e){var n=this,i=this._store.items.map(function(r){return e?r.value:n._getChoiceForOutput(r)});return this._isSelectOneElement||this.config.singleModeForMultiSelect?i[0]:i},t.prototype.setValue=function(e){var n=this;return this.initialisedOK?(this._store.withTxn(function(){e.forEach(function(i){i&&n._addChoice(Vt(i,!1))})}),this._searcher.reset(),this):(this._warnChoicesInitFailed("setValue"),this)},t.prototype.setChoiceByValue=function(e){var n=this;return this.initialisedOK?this._isTextElement?this:(this._store.withTxn(function(){var i=Array.isArray(e)?e:[e];i.forEach(function(r){return n._findAndSelectChoiceByValue(r)}),n.unhighlightAll()}),this._searcher.reset(),this):(this._warnChoicesInitFailed("setChoiceByValue"),this)},t.prototype.setChoices=function(e,n,i,r,s,o){var l=this;if(e===void 0&&(e=[]),n===void 0&&(n="value"),i===void 0&&(i="label"),r===void 0&&(r=!1),s===void 0&&(s=!0),o===void 0&&(o=!1),!this.initialisedOK)return this._warnChoicesInitFailed("setChoices"),this;if(!this._isSelectElement)throw new TypeError("setChoices can't be used with INPUT based Choices");if(typeof n!="string"||!n)throw new TypeError("value parameter must be a name of 'value' field in passed objects");if(typeof e=="function"){var a=e(this);if(typeof Promise=="function"&&a instanceof Promise)return new Promise(function(c){return requestAnimationFrame(c)}).then(function(){return l._handleLoadingState(!0)}).then(function(){return a}).then(function(c){return l.setChoices(c,n,i,r,s,o)}).catch(function(c){l.config.silent||console.error(c)}).then(function(){return l._handleLoadingState(!1)}).then(function(){return l});if(!Array.isArray(a))throw new TypeError(".setChoices first argument function must return either array of choices or Promise, got: ".concat(typeof a));return this.setChoices(a,n,i,!1)}if(!Array.isArray(e))throw new TypeError(".setChoices must be called either with array of choices with a function resulting into Promise of array of choices");return this.containerOuter.removeLoadingState(),this._store.withTxn(function(){s&&(l._isSearching=!1),r&&l.clearChoices(!0,o);var c=n==="value",u=i==="label";e.forEach(function(h){if("choices"in h){var f=h;u||(f=mt(mt({},f),{label:f[i]})),l._addGroup(Vt(f,!0))}else{var d=h;(!u||!c)&&(d=mt(mt({},d),{value:d[n],label:d[i]}));var m=Vt(d,!1);l._addChoice(m),m.placeholder&&!l._hasNonChoicePlaceholder&&(l._placeholderValue=Ka(m.label))}}),l.unhighlightAll()}),this._searcher.reset(),this},t.prototype.refresh=function(e,n,i){var r=this;return e===void 0&&(e=!1),n===void 0&&(n=!1),i===void 0&&(i=!1),this._isSelectElement?(this._store.withTxn(function(){var s=r.passedElement.optionsAsChoices(),o={};i||r._store.items.forEach(function(a){a.id&&a.active&&a.selected&&(o[a.value]=!0)}),r.clearStore(!1);var l=function(a){i?r._store.dispatch(Ua(a)):o[a.value]&&(a.selected=!0)};s.forEach(function(a){if("choices"in a){a.choices.forEach(l);return}l(a)}),r._addPredefinedChoices(s,n,e),r._isSearching&&r._searchChoices(r.input.value)}),this):(this.config.silent||console.warn("refresh method can only be used on choices backed by a <select> element"),this)},t.prototype.removeChoice=function(e){var n=this._store.choices.find(function(i){return i.value===e});return n?(this._clearNotice(),this._store.dispatch(e1(n)),this._searcher.reset(),n.selected&&this.passedElement.triggerEvent(pt.removeItem,this._getChoiceForOutput(n)),this):this},t.prototype.clearChoices=function(e,n){var i=this;return e===void 0&&(e=!0),n===void 0&&(n=!1),e&&(n?this.passedElement.element.replaceChildren(""):this.passedElement.element.querySelectorAll(":not([selected])").forEach(function(r){r.remove()})),this.itemList.element.replaceChildren(""),this.choiceList.element.replaceChildren(""),this._clearNotice(),this._store.withTxn(function(){var r=n?[]:i._store.items;i._store.reset(),r.forEach(function(s){i._store.dispatch(Va(s)),i._store.dispatch(Ha(s))})}),this._searcher.reset(),this},t.prototype.clearStore=function(e){return e===void 0&&(e=!0),this.clearChoices(e,!0),this._stopSearch(),this._lastAddedChoiceId=0,this._lastAddedGroupId=0,this},t.prototype.clearInput=function(){var e=!this._isSelectOneElement;return this.input.clear(e),this._stopSearch(),this},t.prototype._validateConfig=function(){var e=this.config,n=h1(e,Qa);n.length&&console.warn("Unknown config option(s) passed",n.join(", ")),e.allowHTML&&e.allowHtmlUserInput&&(e.addItems&&console.warn("Warning: allowHTML/allowHtmlUserInput/addItems all being true is strongly not recommended and may lead to XSS attacks"),e.addChoices&&console.warn("Warning: allowHTML/allowHtmlUserInput/addChoices all being true is strongly not recommended and may lead to XSS attacks"))},t.prototype._render=function(e){e===void 0&&(e={choices:!0,groups:!0,items:!0}),!this._store.inTxn()&&(this._isSelectElement&&(e.choices||e.groups)&&this._renderChoices(),e.items&&this._renderItems())},t.prototype._renderChoices=function(){var e=this;if(this._canAddItems()){var n=this,i=n.config,r=n._isSearching,s=this._store,o=s.activeGroups,l=s.activeChoices,a=0;if(r&&i.searchResultLimit>0?a=i.searchResultLimit:i.renderChoiceLimit>0&&(a=i.renderChoiceLimit),this._isSelectElement){var c=l.filter(function(m){return!m.element});c.length&&this.passedElement.addOptions(c)}var u=document.createDocumentFragment(),h=function(m){return m.filter(function(p){return!p.placeholder&&(r?!!p.rank:i.renderSelectedChoices||!p.selected)})},f=!1,d=function(m,p,g){r?m.sort(u1):i.shouldSort&&m.sort(i.sorter);var _=m.length;_=!p&&a&&_>a?a:_,_--,m.every(function(S,C){var b=S.choiceEl||e._templates.choice(i,S,i.itemSelectText,g);return S.choiceEl=b,u.appendChild(b),(r||!S.selected)&&(f=!0),C<_})};l.length&&(i.resetScrollPosition&&requestAnimationFrame(function(){return e.choiceList.scrollToTop()}),!this._hasNonChoicePlaceholder&&!r&&this._isSelectOneElement&&d(l.filter(function(m){return m.placeholder&&!m.group}),!1,void 0),o.length&&!r?(i.shouldSort&&o.sort(i.sorter),d(l.filter(function(m){return!m.placeholder&&!m.group}),!1,void 0),o.forEach(function(m){var p=h(m.choices);if(p.length){if(m.label){var g=m.groupEl||e._templates.choiceGroup(e.config,m);m.groupEl=g,g.remove(),u.appendChild(g)}d(p,!0,i.appendGroupInSearch&&r?m.label:void 0)}})):d(h(l),!1,void 0)),!f&&(r||!u.children.length||!i.renderSelectedChoices)&&(this._notice||(this._notice={text:qa(r?i.noResultsText:i.noChoicesText),type:r?Ye.noResults:Ye.noChoices}),u.replaceChildren("")),this._renderNotice(u),this.choiceList.element.replaceChildren(u),f&&this._highlightChoice()}},t.prototype._renderItems=function(){var e=this,n=this._store.items||[],i=this.itemList.element,r=this.config,s=document.createDocumentFragment(),o=function(h){return i.querySelector('[data-item][data-id="'.concat(h.id,'"]'))},l=function(h){var f=h.itemEl;f&&f.parentElement||(f=o(h)||e._templates.item(r,h,r.removeItemButton),h.itemEl=f,s.appendChild(f))};n.forEach(l);var a=!!s.childNodes.length;if(this._isSelectOneElement){var c=i.children.length;if(a||c>1){var u=i.querySelector(li(r.classNames.placeholder));u&&u.remove()}else!a&&!c&&this._placeholderValue&&(a=!0,l(Vt({selected:!0,value:"",label:this._placeholderValue,placeholder:!0},!1)))}a&&(i.append(s),r.shouldSortItems&&!this._isSelectOneElement&&(n.sort(r.sorter),n.forEach(function(h){var f=o(h);f&&(f.remove(),s.append(f))}),i.append(s))),this._isTextElement&&(this.passedElement.value=n.map(function(h){var f=h.value;return f}).join(r.delimiter))},t.prototype._displayNotice=function(e,n,i){i===void 0&&(i=!0);var r=this._notice;if(r&&(r.type===n&&r.text===e||r.type===Ye.addChoice&&(n===Ye.noResults||n===Ye.noChoices))){i&&this.showDropdown(!0);return}this._clearNotice(),this._notice=e?{text:e,type:n}:void 0,this._renderNotice(),i&&e&&this.showDropdown(!0)},t.prototype._clearNotice=function(){if(this._notice){var e=this.choiceList.element.querySelector(li(this.config.classNames.notice));e&&e.remove(),this._notice=void 0}},t.prototype._renderNotice=function(e){var n=this._notice;if(n){var i=this._templates.notice(this.config,n.text,n.type);e?e.append(i):this.choiceList.prepend(i)}},t.prototype._getChoiceForOutput=function(e,n){return{id:e.id,highlighted:e.highlighted,labelClass:e.labelClass,labelDescription:e.labelDescription,customProperties:e.customProperties,disabled:e.disabled,active:e.active,label:e.label,placeholder:e.placeholder,value:e.value,groupValue:e.group?e.group.label:void 0,element:e.element,keyCode:n}},t.prototype._triggerChange=function(e){e!=null&&this.passedElement.triggerEvent(pt.change,{value:e})},t.prototype._handleButtonAction=function(e){var n=this,i=this._store.items;if(!(!i.length||!this.config.removeItems||!this.config.removeItemButton)){var r=e&&ws(e.parentElement),s=r&&i.find(function(o){return o.id===r});s&&this._store.withTxn(function(){if(n._removeItem(s),n._triggerChange(s.value),n._isSelectOneElement&&!n._hasNonChoicePlaceholder){var o=(n.config.shouldSort?n._store.choices.reverse():n._store.choices).find(function(l){return l.placeholder});o&&(n._addItem(o),n.unhighlightAll(),o.value&&n._triggerChange(o.value))}})}},t.prototype._handleItemAction=function(e,n){var i=this;n===void 0&&(n=!1);var r=this._store.items;if(!(!r.length||!this.config.removeItems||this._isSelectOneElement)){var s=ws(e);s&&(r.forEach(function(o){o.id===s&&!o.highlighted?i.highlightItem(o):!n&&o.highlighted&&i.unhighlightItem(o)}),this.input.focus())}},t.prototype._handleChoiceAction=function(e){var n=this,i=ws(e),r=i&&this._store.getChoiceById(i);if(!r||r.disabled)return!1;var s=this.dropdown.isActive;if(!r.selected){if(!this._canAddItems())return!0;this._store.withTxn(function(){n._addItem(r,!0,!0),n.clearInput(),n.unhighlightAll()}),this._triggerChange(r.value)}return s&&this.config.closeDropdownOnSelect&&(this.hideDropdown(!0),this.containerOuter.element.focus()),!0},t.prototype._handleBackspace=function(e){var n=this.config;if(!(!n.removeItems||!e.length)){var i=e[e.length-1],r=e.some(function(s){return s.highlighted});n.editItems&&!r&&i?(this.input.value=i.value,this.input.setWidth(),this._removeItem(i),this._triggerChange(i.value)):(r||this.highlightItem(i,!1),this.removeHighlightedItems(!0))}},t.prototype._loadChoices=function(){var e,n=this,i=this.config;if(this._isTextElement){if(this._presetChoices=i.items.map(function(o){return Vt(o,!1)}),this.passedElement.value){var r=this.passedElement.value.split(i.delimiter).map(function(o){return Vt(o,!1,n.config.allowHtmlUserInput)});this._presetChoices=this._presetChoices.concat(r)}this._presetChoices.forEach(function(o){o.selected=!0})}else if(this._isSelectElement){this._presetChoices=i.choices.map(function(o){return Vt(o,!0)});var s=this.passedElement.optionsAsChoices();s&&(e=this._presetChoices).push.apply(e,s)}},t.prototype._handleLoadingState=function(e){e===void 0&&(e=!0);var n=this.itemList.element;e?(this.disable(),this.containerOuter.addLoadingState(),this._isSelectOneElement?n.replaceChildren(this._templates.placeholder(this.config,this.config.loadingText)):this.input.placeholder=this.config.loadingText):(this.enable(),this.containerOuter.removeLoadingState(),this._isSelectOneElement?(n.replaceChildren(""),this._render()):this.input.placeholder=this._placeholderValue||"")},t.prototype._handleSearch=function(e){if(this.input.isFocussed)if(e!==null&&typeof e<"u"&&e.length>=this.config.searchFloor){var n=this.config.searchChoices?this._searchChoices(e):0;n!==null&&this.passedElement.triggerEvent(pt.search,{value:e,resultCount:n})}else this._store.choices.some(function(i){return!i.active})&&this._stopSearch()},t.prototype._canAddItems=function(){var e=this.config,n=e.maxItemCount,i=e.maxItemText;return!e.singleModeForMultiSelect&&n>0&&n<=this._store.items.length?(this.choiceList.element.replaceChildren(""),this._notice=void 0,this._displayNotice(typeof i=="function"?i(n):i,Ye.addChoice),!1):(this._notice&&this._notice.type===Ye.addChoice&&this._clearNotice(),!0)},t.prototype._canCreateItem=function(e){var n=this.config,i=!0,r="";if(i&&typeof n.addItemFilter=="function"&&!n.addItemFilter(e)&&(i=!1,r=oi(n.customAddItemText,e)),i){var s=this._store.choices.find(function(o){return n.valueComparer(o.value,e)});if(s){if(this._isSelectElement)return this._displayNotice("",Ye.addChoice),!1;n.duplicateItemsAllowed||(i=!1,r=oi(n.uniqueItemText,e))}}return i&&(r=oi(n.addItemText,e)),r&&this._displayNotice(r,Ye.addChoice),i},t.prototype._searchChoices=function(e){var n=e.trim().replace(/\s{2,}/," ");if(!n.length||n===this._currentValue)return null;var i=this._searcher;i.isEmptyIndex()&&i.index(this._store.searchableChoices);var r=i.search(n);this._currentValue=n,this._highlightPosition=0,this._isSearching=!0;var s=this._notice,o=s&&s.type;return o!==Ye.addChoice&&(r.length?this._clearNotice():this._displayNotice(qa(this.config.noResultsText),Ye.noResults)),this._store.dispatch(t1(r)),r.length},t.prototype._stopSearch=function(){this._isSearching&&(this._currentValue="",this._isSearching=!1,this._clearNotice(),this._store.dispatch(n1(!0)),this.passedElement.triggerEvent(pt.search,{value:"",resultCount:0}))},t.prototype._addEventListeners=function(){var e=this._docRoot,n=this.containerOuter.element,i=this.input.element;e.addEventListener("touchend",this._onTouchEnd,!0),n.addEventListener("keydown",this._onKeyDown,!0),n.addEventListener("mousedown",this._onMouseDown,!0),e.addEventListener("click",this._onClick,{passive:!0}),e.addEventListener("touchmove",this._onTouchMove,{passive:!0}),this.dropdown.element.addEventListener("mouseover",this._onMouseOver,{passive:!0}),this._isSelectOneElement&&(n.addEventListener("focus",this._onFocus,{passive:!0}),n.addEventListener("blur",this._onBlur,{passive:!0})),i.addEventListener("keyup",this._onKeyUp,{passive:!0}),i.addEventListener("input",this._onInput,{passive:!0}),i.addEventListener("focus",this._onFocus,{passive:!0}),i.addEventListener("blur",this._onBlur,{passive:!0}),i.form&&i.form.addEventListener("reset",this._onFormReset,{passive:!0}),this.input.addEventListeners()},t.prototype._removeEventListeners=function(){var e=this._docRoot,n=this.containerOuter.element,i=this.input.element;e.removeEventListener("touchend",this._onTouchEnd,!0),n.removeEventListener("keydown",this._onKeyDown,!0),n.removeEventListener("mousedown",this._onMouseDown,!0),e.removeEventListener("click",this._onClick),e.removeEventListener("touchmove",this._onTouchMove),this.dropdown.element.removeEventListener("mouseover",this._onMouseOver),this._isSelectOneElement&&(n.removeEventListener("focus",this._onFocus),n.removeEventListener("blur",this._onBlur)),i.removeEventListener("keyup",this._onKeyUp),i.removeEventListener("input",this._onInput),i.removeEventListener("focus",this._onFocus),i.removeEventListener("blur",this._onBlur),i.form&&i.form.removeEventListener("reset",this._onFormReset),this.input.removeEventListeners()},t.prototype._onKeyDown=function(e){var n=e.keyCode,i=this.dropdown.isActive,r=e.key.length===1||e.key.length===2&&e.key.charCodeAt(0)>=55296||e.key==="Unidentified";switch(!this._isTextElement&&!i&&n!==tt.ESC_KEY&&n!==tt.TAB_KEY&&n!==tt.SHIFT_KEY&&(this.showDropdown(),!this.input.isFocussed&&r&&(this.input.value+=e.key,e.key===" "&&e.preventDefault())),n){case tt.A_KEY:return this._onSelectKey(e,this.itemList.element.hasChildNodes());case tt.ENTER_KEY:return this._onEnterKey(e,i);case tt.ESC_KEY:return this._onEscapeKey(e,i);case tt.UP_KEY:case tt.PAGE_UP_KEY:case tt.DOWN_KEY:case tt.PAGE_DOWN_KEY:return this._onDirectionKey(e,i);case tt.DELETE_KEY:case tt.BACK_KEY:return this._onDeleteKey(e,this._store.items,this.input.isFocussed)}},t.prototype._onKeyUp=function(){this._canSearch=this.config.searchEnabled},t.prototype._onInput=function(){var e=this.input.value;if(!e){this._isTextElement?this.hideDropdown(!0):this._stopSearch();return}this._canAddItems()&&(this._canSearch&&this._handleSearch(e),this._canAddUserChoices&&(this._canCreateItem(e),this._isSelectElement&&(this._highlightPosition=0,this._highlightChoice())))},t.prototype._onSelectKey=function(e,n){if((e.ctrlKey||e.metaKey)&&n){this._canSearch=!1;var i=this.config.removeItems&&!this.input.value&&this.input.element===document.activeElement;i&&this.highlightAll()}},t.prototype._onEnterKey=function(e,n){var i=this,r=this.input.value,s=e.target;if(e.preventDefault(),s&&s.hasAttribute("data-button")){this._handleButtonAction(s);return}if(!n){(this._isSelectElement||this._notice)&&this.showDropdown();return}var o=this.dropdown.element.querySelector(li(this.config.classNames.highlightedState));if(!(o&&this._handleChoiceAction(o))){if(!s||!r){this.hideDropdown(!0);return}if(this._canAddItems()){var l=!1;this._store.withTxn(function(){if(l=i._findAndSelectChoiceByValue(r,!0),!l){if(!i._canAddUserChoices||!i._canCreateItem(r))return;i._addChoice(Vt(r,!1,i.config.allowHtmlUserInput),!0,!0),l=!0}i.clearInput(),i.unhighlightAll()}),l&&(this._triggerChange(r),this.config.closeDropdownOnSelect&&this.hideDropdown(!0))}}},t.prototype._onEscapeKey=function(e,n){n&&(e.stopPropagation(),this.hideDropdown(!0),this._stopSearch(),this.containerOuter.element.focus())},t.prototype._onDirectionKey=function(e,n){var i=e.keyCode;if(n||this._isSelectOneElement){this.showDropdown(),this._canSearch=!1;var r=i===tt.DOWN_KEY||i===tt.PAGE_DOWN_KEY?1:-1,s=e.metaKey||i===tt.PAGE_DOWN_KEY||i===tt.PAGE_UP_KEY,o=void 0;if(s)r>0?o=this.dropdown.element.querySelector("".concat(ci,":last-of-type")):o=this.dropdown.element.querySelector(ci);else{var l=this.dropdown.element.querySelector(li(this.config.classNames.highlightedState));l?o=o1(l,ci,r):o=this.dropdown.element.querySelector(ci)}o&&(l1(o,this.choiceList.element,r)||this.choiceList.scrollToChildElement(o,r),this._highlightChoice(o)),e.preventDefault()}},t.prototype._onDeleteKey=function(e,n,i){!this._isSelectOneElement&&!e.target.value&&i&&(this._handleBackspace(n),e.preventDefault())},t.prototype._onTouchMove=function(){this._wasTap&&(this._wasTap=!1)},t.prototype._onTouchEnd=function(e){var n=(e||e.touches[0]).target,i=this._wasTap&&this.containerOuter.element.contains(n);if(i){var r=n===this.containerOuter.element||n===this.containerInner.element;r&&(this._isTextElement?this.input.focus():this._isSelectMultipleElement&&this.showDropdown()),e.stopPropagation()}this._wasTap=!0},t.prototype._onMouseDown=function(e){var n=e.target;if(n instanceof HTMLElement){if(wv&&this.choiceList.element.contains(n)){var i=this.choiceList.element.firstElementChild;this._isScrollingOnIe=this._direction==="ltr"?e.offsetX>=i.offsetWidth:e.offsetX<i.offsetLeft}if(n!==this.input.element){var r=n.closest("[data-button],[data-item],[data-choice]");r instanceof HTMLElement&&("button"in r.dataset?this._handleButtonAction(r):"item"in r.dataset?this._handleItemAction(r,e.shiftKey):"choice"in r.dataset&&this._handleChoiceAction(r)),e.preventDefault()}}},t.prototype._onMouseOver=function(e){var n=e.target;n instanceof HTMLElement&&"choice"in n.dataset&&this._highlightChoice(n)},t.prototype._onClick=function(e){var n=e.target,i=this.containerOuter,r=i.element.contains(n);r?!this.dropdown.isActive&&!i.isDisabled?this._isTextElement?document.activeElement!==this.input.element&&this.input.focus():(this.showDropdown(),i.element.focus()):this._isSelectOneElement&&n!==this.input.element&&!this.dropdown.element.contains(n)&&this.hideDropdown():(i.removeFocusState(),this.hideDropdown(!0),this.unhighlightAll())},t.prototype._onFocus=function(e){var n=e.target,i=this.containerOuter,r=n&&i.element.contains(n);if(r){var s=n===this.input.element;this._isTextElement?s&&i.addFocusState():this._isSelectMultipleElement?s&&(this.showDropdown(!0),i.addFocusState()):(i.addFocusState(),s&&this.showDropdown(!0))}},t.prototype._onBlur=function(e){var n=e.target,i=this.containerOuter,r=n&&i.element.contains(n);r&&!this._isScrollingOnIe?n===this.input.element?(i.removeFocusState(),this.hideDropdown(!0),(this._isTextElement||this._isSelectMultipleElement)&&this.unhighlightAll()):n===this.containerOuter.element&&(i.removeFocusState(),this._canSearch||this.hideDropdown(!0)):(this._isScrollingOnIe=!1,this.input.element.focus())},t.prototype._onFormReset=function(){var e=this;this._store.withTxn(function(){e.clearInput(),e.hideDropdown(),e.refresh(!1,!1,!0),e._initialItems.length&&e.setChoiceByValue(e._initialItems)})},t.prototype._highlightChoice=function(e){e===void 0&&(e=null);var n=Array.from(this.dropdown.element.querySelectorAll(ci));if(n.length){var i=e,r=this.config.classNames.highlightedState,s=Array.from(this.dropdown.element.querySelectorAll(li(r)));s.forEach(function(o){Ft(o,r),o.setAttribute("aria-selected","false")}),i?this._highlightPosition=n.indexOf(i):(n.length>this._highlightPosition?i=n[this._highlightPosition]:i=n[n.length-1],i||(i=n[0])),ge(i,r),i.setAttribute("aria-selected","true"),this.passedElement.triggerEvent(pt.highlightChoice,{el:i}),this.dropdown.isActive&&(this.input.setActiveDescendant(i.id),this.containerOuter.setActiveDescendant(i.id))}},t.prototype._addItem=function(e,n,i){if(n===void 0&&(n=!0),i===void 0&&(i=!1),!e.id)throw new TypeError("item.id must be set before _addItem is called for a choice/item");(this.config.singleModeForMultiSelect||this._isSelectOneElement)&&this.removeActiveItems(e.id),this._store.dispatch(Ha(e)),n&&(this.passedElement.triggerEvent(pt.addItem,this._getChoiceForOutput(e)),i&&this.passedElement.triggerEvent(pt.choice,this._getChoiceForOutput(e)))},t.prototype._removeItem=function(e){if(e.id){this._store.dispatch(Ua(e));var n=this._notice;n&&n.type===Ye.noChoices&&this._clearNotice(),this.passedElement.triggerEvent(pt.removeItem,this._getChoiceForOutput(e))}},t.prototype._addChoice=function(e,n,i){if(n===void 0&&(n=!0),i===void 0&&(i=!1),e.id)throw new TypeError("Can not re-add a choice which has already been added");var r=this.config;if(!(!r.duplicateItemsAllowed&&this._store.choices.find(function(l){return r.valueComparer(l.value,e.value)}))){this._lastAddedChoiceId++,e.id=this._lastAddedChoiceId,e.elementId="".concat(this._baseId,"-").concat(this._idNames.itemChoice,"-").concat(e.id);var s=r.prependValue,o=r.appendValue;s&&(e.value=s+e.value),o&&(e.value+=o.toString()),(s||o)&&e.element&&(e.element.value=e.value),this._clearNotice(),this._store.dispatch(Va(e)),e.selected&&this._addItem(e,n,i)}},t.prototype._addGroup=function(e,n){var i=this;if(n===void 0&&(n=!0),e.id)throw new TypeError("Can not re-add a group which has already been added");this._store.dispatch(i1(e)),e.choices&&(this._lastAddedGroupId++,e.id=this._lastAddedGroupId,e.choices.forEach(function(r){r.group=e,e.disabled&&(r.disabled=!0),i._addChoice(r,n)}))},t.prototype._createTemplates=function(){var e=this,n=this.config.callbackOnCreateTemplates,i={};typeof n=="function"&&(i=n.call(this,a1,fs,ir));var r={};Object.keys(this._templates).forEach(function(s){s in i?r[s]=i[s].bind(e):r[s]=e._templates[s].bind(e)}),this._templates=r},t.prototype._createElements=function(){var e=this._templates,n=this,i=n.config,r=n._isSelectOneElement,s=i.position,o=i.classNames,l=this._elementType;this.containerOuter=new Wa({element:e.containerOuter(i,this._direction,this._isSelectElement,r,i.searchEnabled,l,i.labelId),classNames:o,type:l,position:s}),this.containerInner=new Wa({element:e.containerInner(i),classNames:o,type:l,position:s}),this.input=new g1({element:e.input(i,this._placeholderValue),classNames:o,type:l,preventPaste:!i.paste}),this.choiceList=new Ga({element:e.choiceList(i,r)}),this.itemList=new Ga({element:e.itemList(i,r)}),this.dropdown=new p1({element:e.dropdown(i),classNames:o,type:l})},t.prototype._createStructure=function(){var e=this,n=e.containerInner,i=e.containerOuter,r=e.passedElement,s=this.dropdown.element;r.conceal(),n.wrap(r.element),i.wrap(n.element),this._isSelectOneElement?this.input.placeholder=this.config.searchPlaceholderValue||"":(this._placeholderValue&&(this.input.placeholder=this._placeholderValue),this.input.setWidth()),i.element.appendChild(n.element),i.element.appendChild(s),n.element.appendChild(this.itemList.element),s.appendChild(this.choiceList.element),this._isSelectOneElement?this.config.searchEnabled&&s.insertBefore(this.input.element,s.firstChild):n.element.appendChild(this.input.element),this._highlightPosition=0,this._isSearching=!1},t.prototype._initStore=function(){var e=this;this._store.subscribe(this._render).withTxn(function(){e._addPredefinedChoices(e._presetChoices,e._isSelectOneElement&&!e._hasNonChoicePlaceholder,!1)}),(!this._store.choices.length||this._isSelectOneElement&&this._hasNonChoicePlaceholder)&&this._render()},t.prototype._addPredefinedChoices=function(e,n,i){var r=this;if(n===void 0&&(n=!1),i===void 0&&(i=!0),n){var s=e.findIndex(function(o){return o.selected})===-1;s&&e.some(function(o){return o.disabled||"choices"in o?!1:(o.selected=!0,!0)})}e.forEach(function(o){"choices"in o?r._isSelectElement&&r._addGroup(o,i):r._addChoice(o,i)})},t.prototype._findAndSelectChoiceByValue=function(e,n){var i=this;n===void 0&&(n=!1);var r=this._store.choices.find(function(s){return i.config.valueComparer(s.value,e)});return r&&!r.disabled&&!r.selected?(this._addItem(r,!0,n),!0):!1},t.prototype._generatePlaceholderValue=function(){var e=this.config;if(!e.placeholder)return null;if(this._hasNonChoicePlaceholder)return e.placeholderValue;if(this._isSelectElement){var n=this.passedElement.placeholderOption;return n?n.text:null}return null},t.prototype._warnChoicesInitFailed=function(e){if(!this.config.silent)if(this.initialised){if(!this.initialisedOK)throw new TypeError("".concat(e," called for an element which has multiple instances of Choices initialised on it"))}else throw new TypeError("".concat(e," called on a non-initialised instance of Choices"))},t.version="11.1.0",t}();const Qy="",Zy="";function _c(t){let e,n;return{c(){e=w("label"),n=se(t[2]),v(e,"for",t[4])},m(i,r){V(i,e,r),y(e,n)},p(i,r){r&4&&ve(n,i[2])},d(i){i&&F(e)}}}function Ev(t){let e;return{c(){e=w("select"),v(e,"id",t[4]),v(e,"name",t[4]),v(e,"aria-label",t[2]),v(e,"class","m-1")},m(n,i){V(n,e,i)},p(n,i){i&4&&v(e,"aria-label",n[2])},i:Z,o:Z,d(n){n&&F(e)}}}function Cv(t){let e,n,i,r=t[3].length&&vc(t);return{c(){r&&r.c(),e=q(),n=w("select"),v(n,"id",t[4]),v(n,"name",t[4]),v(n,"aria-label",t[2]),v(n,"class","m-1"),n.multiple=!0},m(s,o){r&&r.m(s,o),V(s,e,o),V(s,n,o),i=!0},p(s,o){s[3].length?r?(r.p(s,o),o&8&&H(r,1)):(r=vc(s),r.c(),H(r,1),r.m(e.parentNode,e)):r&&(Ee(),K(r,1,1,()=>{r=null}),Ce()),(!i||o&4)&&v(n,"aria-label",s[2])},i(s){i||(H(r),i=!0)},o(s){K(r),i=!1},d(s){r&&r.d(s),s&&F(e),s&&F(n)}}}function vc(t){let e,n,i=t[3].length+"",r,s,o,l;return o=new xi({props:{targetHtmlId:t[5],tooltipText:`${t[3].length}
                                    ${W==="fr"&&t[3].length>1?"valeurs sélectionnées":W==="fr"&&t[3].length===1?"valeur sélectionnée":W==="en"&&t[3].length>1?"selected values":"selected value"}`}}),{c(){e=w("span"),n=w("span"),r=se(i),s=q(),ue(o.$$.fragment),v(n,"id",t[5]),v(n,"class","input-dropdown-count tag m-1 svelte-1epfuu8"),v(e,"class","is-relative")},m(a,c){V(a,e,c),y(e,n),y(n,r),y(e,s),ae(o,e,null),l=!0},p(a,c){(!l||c&8)&&i!==(i=a[3].length+"")&&ve(r,i);const u={};c&8&&(u.tooltipText=`${a[3].length}
                                    ${W==="fr"&&a[3].length>1?"valeurs sélectionnées":W==="fr"&&a[3].length===1?"valeur sélectionnée":W==="en"&&a[3].length>1?"selected values":"selected value"}`),o.$set(u)},i(a){l||(H(o.$$.fragment,a),l=!0)},o(a){K(o.$$.fragment,a),l=!1},d(a){a&&F(e),ce(o)}}}function Iv(t){let e,n,i,r,s,o,l,a=t[2]!==void 0&&_c(t);const c=[Cv,Ev],u=[];function h(f,d){return f[0]?0:1}return r=h(t),s=u[r]=c[r](t),{c(){e=w("div"),a&&a.c(),n=q(),i=w("div"),s.c(),v(i,"class",o="input-dropdown-select "+(t[0]?"is-multiple":"is-single")+" "+(t[0]&&t[3].length?"is-flex is-justify-content-flex-start is-align-items-center":"")+" "+(t[1]?"light-display":"")+" svelte-1epfuu8"),v(e,"class","input-dropdown-select-wrapper")},m(f,d){V(f,e,d),a&&a.m(e,null),y(e,n),y(e,i),u[r].m(i,null),l=!0},p(f,[d]){f[2]!==void 0?a?a.p(f,d):(a=_c(f),a.c(),a.m(e,n)):a&&(a.d(1),a=null);let m=r;r=h(f),r===m?u[r].p(f,d):(Ee(),K(u[m],1,1,()=>{u[m]=null}),Ce(),s=u[r],s?s.p(f,d):(s=u[r]=c[r](f),s.c()),H(s,1),s.m(i,null)),(!l||d&11&&o!==(o="input-dropdown-select "+(f[0]?"is-multiple":"is-single")+" "+(f[0]&&f[3].length?"is-flex is-justify-content-flex-start is-align-items-center":"")+" "+(f[1]?"light-display":"")+" svelte-1epfuu8"))&&v(i,"class",o)},i(f){l||(H(s),l=!0)},o(f){K(s),l=!1},d(f){f&&F(e),a&&a.d(),u[r].d()}}}const Mv=250;function xv(t,e,n){let i,r,{choicesItems:s}=e,{start:o=[]}=e,{multiple:l}=e,{searchable:a=!0}=e,{lightDisplay:c=!1}=e,{placeholder:u=W==="fr"?"Sélectionner une valeur":"Select a value"}=e,{title:h=void 0}=e,{selectAll:f=!!l}=e;const d=`input-dropdown-select-${window.crypto.randomUUID()}`,m=`input-dropdown-counter-${window.crypto.randomUUID()}`,p=`select-all-${window.crypto.randomUUID()}`,g=`unselect-all-${window.crypto.randomUUID()}`,_=bi();let S;const C=Si();C.setCompareFn(kr);const b=vt("resetTrigger")||void 0;b==null||b.subscribe(()=>R(S,s,o,f));const k=()=>{n(11,r=!0),setTimeout(()=>n(11,r=!1),Mv)},P=(x,L)=>{L||(C.set(x),C.same()||_("updateValues",i))},A=x=>`<span class="iconify" data-icon=${x}/>`,E=(x,L)=>x!=null&&L!=null&&x.length&&L.length?`<span class="dropdown-prefix-wrapper">${L==="iconify"?A(x):x}</span>`:"",M=(x,L)=>L?[{value:p,label:`<b>${W==="fr"?"Tout sélectionner":"Select all"}</b>`},{value:g,label:`<b>${W==="fr"?"Tout retirer":"Remove all"}</b>`},...x]:x,D=(x,L)=>M(x,L).map(B=>(B.id=`dropdown-choice-${window.crypto.randomUUID()}`,B.label=`<span>
                ${E(B.prefix||"",B.prefixType||"")}
                <span class="dropdown-prefix-text">${B.label}</span>
            </span>`,B));function $(x,L,B){return x=structuredClone(x),L=structuredClone(L),x=D(x,B).map(U=>L.includes(U.value)?{...U,selected:!0}:{...U,selected:!1}),n(3,i=L),x}function R(x,L,B,U){x&&(L=$(L,B,U),x.clearStore().setChoices(L))}const z=(x,L,B,U,G,X)=>(U=structuredClone(U),B=structuredClone(B),x.detail.value===G?(k(),B=B.map(ee=>[G,X].includes(ee.value)?{...ee,selected:!1}:{...ee,selected:!0}),L.removeActiveItems().clearChoices(!0,!0).setValue(B).hideDropdown(),U=[...new Set(B.filter(ee=>ee.selected===!0).map(ee=>ee.value))]):x.detail.value===X?(L.removeActiveItems().hideDropdown(),U=[]):U=l===!0?[...U,x.detail.value]:[x.detail.value],[...new Set(U)]),I=(x,L)=>structuredClone(L).filter(B=>B!==x.detail.value);function N(x,L){const B=document.getElementById(d);S=new kv(B,{items:[],choices:x,addChoices:!1,addItems:!1,removeItems:!0,removeItemButton:!0,searchEnabled:a,allowHTML:!0,shouldSort:!L,sorter:(U,G)=>U.label.localeCompare(G.label),placeholderValue:u,classNames:{item:["choices__item","dropdown-item"]},loadingText:W==="fr"?"Chargement...":"Loading...",noResultsText:W==="fr"?"Pas de résultats":"No results found",noChoicesText:W==="fr"?"Pas de choix pour faire la sélection":"No choices to choose from",itemSelectText:W==="fr"?"Cliquer pour sélectionner":"Press to select",uniqueItemText:W==="fr"?"Seules des valeurs uniques peuvent être ajoutées":"Only unique values can be added",customAddItemText:W==="fr"?"Les valeurs ne répondent pas aux conditions attendues":"Only values matching specific conditions can be added",removeItemIconText:W==="fr"?"Retirer l'item":"Remove item",addItemText:U=>W==="fr"?`Cliquer sur Entrer pour ajouter <b>${U}</b>`:`Press Enter to add <b>"${U}"</b>`,removeItemLabelText:U=>W==="fr"?`Retirer l'item: ${U}`:`Remove item: ${U}`,maxItemText:U=>W==="fr"?`Seulement ${U} items peuvent être ajoutées`:`Only ${U} items can be added`}),B.addEventListener("addItem",U=>{n(3,i=z(U,S,x,i,p,g))}),B.addEventListener("removeItem",U=>{n(3,i=I(U,i))})}return Hn(()=>{const x=$(s,o,f);N(x,f)}),Un(()=>{S.destroy(),S=void 0}),t.$$set=x=>{"choicesItems"in x&&n(6,s=x.choicesItems),"start"in x&&n(7,o=x.start),"multiple"in x&&n(0,l=x.multiple),"searchable"in x&&n(8,a=x.searchable),"lightDisplay"in x&&n(1,c=x.lightDisplay),"placeholder"in x&&n(9,u=x.placeholder),"title"in x&&n(2,h=x.title),"selectAll"in x&&n(10,f=x.selectAll)},t.$$.update=()=>{t.$$.dirty&2056&&P(i,r)},n(3,i=[]),n(11,r=!1),[l,c,h,i,d,m,s,o,a,u,f,r]}class Av extends be{constructor(e){super(),ye(this,e,xv,Iv,_e,{choicesItems:6,start:7,multiple:0,searchable:8,lightDisplay:1,placeholder:9,title:2,selectAll:10})}}const eb="";function Tv(t){let e,n,i,r,s,o,l,a,c,u,h,f,d,m,p,g,_,S,C,b,k,P,A,E,M,D,$,R,z,I,N,x,L,B,U,G,X,ee,Q;return c=new cn({props:{minVal:0,maxVal:1,start:t[5],emitOnUpdate:!0,title:W==="fr"?"Opacité":"Opacity"}}),c.$on("updateSlider",t[9]),f=new cn({props:{minVal:0,maxVal:360,start:t[6],step:1,emitOnUpdate:!0,title:"Rotation"}}),f.$on("updateSlider",t[10]),p=new cn({props:{minVal:0,maxVal:200,step:1,start:t[7],emitOnUpdate:!0,title:W==="fr"?"Redimensionner":"Scale"}}),p.$on("updateSlider",t[11]),S=new cn({props:{minVal:-100,maxVal:100,step:1,start:t[8][0],emitOnUpdate:!0,title:W==="fr"?"Translation horizontale":"Horizontal translate"}}),S.$on("updateSlider",t[12]),k=new cn({props:{minVal:-100,maxVal:100,step:1,start:t[8][1],emitOnUpdate:!0,title:W==="fr"?"Translation verticale":"Vertical translate"}}),k.$on("updateSlider",t[13]),E=new Av({props:{choicesItems:t[4],start:[],lightDisplay:!0,placeholder:W==="fr"?"Sélectionner":"Select",title:W==="fr"?"Basculer":"Flip"}}),E.$on("updateValues",t[14]),{c(){e=w("div"),n=w("div"),i=w("div"),r=w("div"),s=w("strong"),s.textContent=`${W==="en"?"Query image transformation":"Modification de l'image requête"}`,o=q(),l=w("div"),a=w("div"),ue(c.$$.fragment),u=q(),h=w("div"),ue(f.$$.fragment),d=q(),m=w("div"),ue(p.$$.fragment),g=q(),_=w("div"),ue(S.$$.fragment),C=q(),b=w("div"),ue(k.$$.fragment),P=q(),A=w("div"),ue(E.$$.fragment),M=q(),D=w("div"),$=w("button"),$.textContent=`${W==="fr"?"Réinitialiser":"Reset"}`,R=q(),z=w("div"),I=w("img"),L=q(),B=w("img"),v(r,"class","toolbar-title mt-0 mb-2 svelte-nzei31"),v(a,"class"," svelte-nzei31"),v(h,"class"," svelte-nzei31"),v(m,"class"," svelte-nzei31"),v(_,"class"," svelte-nzei31"),v(b,"class"," svelte-nzei31"),v(A,"class"," svelte-nzei31"),v($,"class","button is-link"),v(D,"class","mt-2 is-flex is-flex-direction-column is-justify-content-center is-align-items-flex-end svelte-nzei31"),v(l,"class","toolbar-controls is-flex is-flex-direction-column is-align-items-start is-justify-content-center svelte-nzei31"),v(i,"class","toolbar svelte-nzei31"),v(n,"class","toolbar-wrapper is-flex is-flex-direction-column is-justify-content-center is-align-items-center svelte-nzei31"),v(I,"class","compare-img svelte-nzei31"),_t(I.src,N=t[0].queryImage.href)||v(I,"src",N),v(I,"alt",x=t[0].queryImage.title),v(B,"class","main-img svelte-nzei31"),_t(B.src,U=t[0].similarityImage.href)||v(B,"src",U),v(B,"alt",G=t[0].similarityImage.title),Se(B,"overlay-reset",t[2]),Re(B,"opacity",t[1]),Re(B,"transform",t[3]),v(z,"class","overlay-wrapper svelte-nzei31"),v(e,"class","similarity-overlay-wrapper svelte-nzei31")},m(Y,oe){V(Y,e,oe),y(e,n),y(n,i),y(i,r),y(r,s),y(i,o),y(i,l),y(l,a),ae(c,a,null),y(l,u),y(l,h),ae(f,h,null),y(l,d),y(l,m),ae(p,m,null),y(l,g),y(l,_),ae(S,_,null),y(l,C),y(l,b),ae(k,b,null),y(l,P),y(l,A),ae(E,A,null),y(l,M),y(l,D),y(D,$),y(e,R),y(e,z),y(z,I),y(z,L),y(z,B),X=!0,ee||(Q=pe($,"click",t[15]),ee=!0)},p(Y,[oe]){(!X||oe&1&&!_t(I.src,N=Y[0].queryImage.href))&&v(I,"src",N),(!X||oe&1&&x!==(x=Y[0].queryImage.title))&&v(I,"alt",x),(!X||oe&1&&!_t(B.src,U=Y[0].similarityImage.href))&&v(B,"src",U),(!X||oe&1&&G!==(G=Y[0].similarityImage.title))&&v(B,"alt",G),(!X||oe&4)&&Se(B,"overlay-reset",Y[2]),oe&2&&Re(B,"opacity",Y[1]),oe&8&&Re(B,"transform",Y[3])},i(Y){X||(H(c.$$.fragment,Y),H(f.$$.fragment,Y),H(p.$$.fragment,Y),H(S.$$.fragment,Y),H(k.$$.fragment,Y),H(E.$$.fragment,Y),X=!0)},o(Y){K(c.$$.fragment,Y),K(f.$$.fragment,Y),K(p.$$.fragment,Y),K(S.$$.fragment,Y),K(k.$$.fragment,Y),K(E.$$.fragment,Y),X=!1},d(Y){Y&&F(e),ce(c),ce(f),ce(p),ce(S),ce(k),ce(E),ee=!1,Q()}}}function Nv(t,e,n){let i,{imgData:r}=e;const s=[{value:"h",label:W==="fr"?"Basculer horizontalement":"Flip horizontally"},{value:"v",label:W==="fr"?"Basculer verticalement":"Flip vertically"},{value:"hv",label:W==="fr"?"Basculer horizontalement et verticalement":"Flip horizontally and vertically"}];let o=.5;const l=o;let a=0;const c=a;let u=100;const h=u;let f=[1,1];const d=structuredClone(f);let m=[0,0];const p=structuredClone(m);let g=!1;const _=we(window.crypto.randomUUID());bn("resetTrigger",_);const S=M=>n(1,o=M.detail),C=M=>n(16,a=M.detail),b=M=>n(17,u=M.detail),k=M=>n(19,m=[M.detail,m[1]]),P=M=>n(19,m=[m[0],M.detail]),A=M=>{let D=M.detail[0];n(18,f=D==="hv"?[-1,-1]:D==="h"?[-1,1]:D==="v"?[1,-1]:[1,1])},E=()=>{n(1,o=l),n(16,a=c),n(17,u=h),n(18,f=d),n(19,m=p),_.set(window.crypto.randomUUID()),n(2,g=!0),setTimeout(()=>n(2,g=!1),1e3)};return t.$$set=M=>{"imgData"in M&&n(0,r=M.imgData)},t.$$.update=()=>{t.$$.dirty&983040&&n(3,i=`translate(${m[0]-50}%, ${m[1]}%)
                        rotate(${a}deg)
                        scale(${f.map(M=>M*(u/100)).join()})`)},[r,o,g,i,s,l,c,h,p,S,C,b,k,P,A,E,a,u,f,m]}class Ov extends be{constructor(e){super(),ye(this,e,Nv,Tv,_e,{imgData:0})}}function Pv(){const t=`${window.location.origin}${window.location.pathname}`,e=25,n=window.location.pathname.match(/\d+/g).join("-"),i={[n]:{}},r=[2,6],s=we(1),o=we({}),l=we(JSON.parse(localStorage.getItem("selectedRegions"))||i);l.subscribe(R=>localStorage.setItem("selectedRegions",JSON.stringify(R)));const a=we(JSON.parse(localStorage.getItem("excludedCategories"))||[]);a.subscribe(R=>localStorage.setItem("excludedCategories",JSON.stringify(R)));const c=we(JSON.parse(localStorage.getItem("similarityScoreCutoff"))||void 0);c.subscribe(R=>{R!=null&&localStorage.setItem("similarityScoreCutoff",JSON.stringify(R))});const u=we(JSON.parse(localStorage.getItem("propagateRecursionDepth"))||r[1]);u.subscribe(R=>localStorage.setItem("propagateRecursionDepth",JSON.stringify(R)));const h=we(JSON.parse(localStorage.getItem("propagateFilterByRegions"))||!1);h.subscribe(R=>localStorage.setItem("propagateFilterByRegions",JSON.stringify(R)));const f=Be([u,h],([R,z])=>({propagateRecursionDepth:R,propagateFilterByRegions:z})),d=Be([a,l,c],([R,z,I])=>({excludedCategories:R,regions:z,similarityScoreCutoff:I})),m=Be([f,d],([R,z])=>({propagate:R,similarity:z})),p=we([]),g=we([]);async function _(){const R=async()=>{const N=await(await fetch(`${t}compared-regions`)).json();o.set(N),l.update(x=>{let L=x[n]||{};if(Object.keys(L).length){let B=Object.keys(L).filter(U=>Object.keys(N).includes(U)).reduce((U,G)=>(U[G]=L[G],U),{});x[n]=B}return x})},z=async()=>{const N=await(await fetch(`${t}query-images`)).json();N.length>0&&(p.set(N),D(A()))};qn.set(!0);try{await Promise.all([R(),z()])}catch(I){console.error("Error:",I),iu.set(I.message)}finally{qn.set(!1)}}function S(R){localStorage.setItem("selectedRegions",JSON.stringify(R))}function C(R){l.update(z=>{const I={...z};return delete I[n][R],S(I),I})}function b(R){l.update(z=>{const I={...z,[n]:{...z[n]||{},[R.ref]:R}};return S(I),I})}const k=Be(l,R=>z=>{var I;return(I=R[n])==null?void 0:I.hasOwnProperty(z)});function P(R){const z=Ke(o),I=Object.keys(z).filter(N=>N.startsWith(R));return I.length!==1?{title:"Error"}:z[I[0]]}const A=()=>wr(s,"sp"),E=Be([s,p],([R,z])=>(async()=>M(R,z))());function M(R,z){const I=(R-1)*e,N=I+e,x=z.slice(I,N);return g.set(x),x}function D(R){Sr(R,s,"sp")}function $(R){o.update(z=>({...z,[R.ref]:R}))}return{currentPage:s,comparedRegions:o,excludedCategories:a,qImgs:p,pageQImgs:g,selectedRegions:l,propagateRecursionDepth:u,propagateFilterByRegions:h,similarityToolbarParams:m,propagateParams:f,similarityScoreCutoff:c,allowedPropagateDepthRange:r,fetchSimilarity:_,setPageQImgs:E,getRegionsInfo:P,handlePageUpdate:D,unselect:C,select:b,addComparedRegions:$,isSelected:k,pageLength:e}}const Qt=Pv(),{getRegionsInfo:Lv}=Qt;async function yc(t,e,n,i,r,s,o=!1,l=!0){const a=()=>l?`<b>${!isNaN(parseFloat(n))&&e===1?`Score: ${n}`:e===2&&W==="en"?"Manual similarity":e===2&&W==="fr"?"Correspondance manuelle":e===3&&W==="en"?"Propagated match":"Correspondance propagée"}</b>`:"",c=u=>`${u}<br>
        Page ${parseInt(i)}<br>
        ${a()}`;return o===!0?fetch(`${r}${s}get_regions_title/${t}`).then(u=>u.json()).then(u=>c(u.title)).catch(u=>(console.error("similarity.utils.getDesc()",u),c(W==="fr"?"Titre inconnu":"Unknown title"))):Promise.resolve(c(Lv(t).title))}function bc(t,e,n){const i=t.slice();return i[16]=e[n],i}function wc(t){let e,n,i=t[16]==="queryImage"&&W==="fr"?"Image requête":t[16]==="similarityImage"&&W==="fr"?"Similarité":t[16]==="queryImage"&&W==="en"?"Query image":"Similarity",r,s,o,l,a;return o=new Rn({props:{item:t[0][t[16]],descPromise:t[1][t[16]],height:"full"}}),{c(){e=w("div"),n=w("span"),r=se(i),s=q(),ue(o.$$.fragment),l=q(),v(e,"class","img-legend-wrapper column is-flex is-flex-direction-column is-justify-content-center is-align-items-center")},m(c,u){V(c,e,u),y(e,n),y(n,r),y(e,s),ae(o,e,null),y(e,l),a=!0},p(c,u){const h={};u&1&&(h.item=c[0][c[16]]),o.$set(h)},i(c){a||(H(o.$$.fragment,c),a=!0)},o(c){K(o.$$.fragment,c),a=!1},d(c){c&&F(e),ce(o)}}}function Rv(t){let e,n,i=["queryImage","similarityImage"],r=[];for(let o=0;o<2;o+=1)r[o]=wc(bc(t,i,o));const s=o=>K(r[o],1,1,()=>{r[o]=null});return{c(){e=w("div");for(let o=0;o<2;o+=1)r[o].c();v(e,"class","side-by-side columns")},m(o,l){V(o,e,l);for(let a=0;a<2;a+=1)r[a]&&r[a].m(e,null);n=!0},p(o,[l]){if(l&3){i=["queryImage","similarityImage"];let a;for(a=0;a<2;a+=1){const c=bc(o,i,a);r[a]?(r[a].p(c,l),H(r[a],1)):(r[a]=wc(c),r[a].c(),H(r[a],1),r[a].m(e,null))}for(Ee(),a=2;a<2;a+=1)s(a);Ce()}},i(o){if(!n){for(let l=0;l<2;l+=1)H(r[l]);n=!0}},o(o){r=r.filter(Boolean);for(let l=0;l<2;l+=1)K(r[l]);n=!1},d(o){o&&F(e),We(r,o)}}}function Dv(t,e,n){let{imgData:i}=e;const r=vt("similarityPair"),s=new URL(window.location.href),o=s.origin,l=s.pathname,[a,c,u,h]=r.qImg.split(".")[0].split("_"),[f,d,m,p]=r.sImg.split(".")[0].split("_"),g=`${a}_${c}`,_=`${f}_${d}`,S={queryImage:yc(g,r.similarityType,r.score,u,o,l,!0,!1),similarityImage:yc(_,r.similarityType,r.score,m,o,l,!0,!0)};return t.$$set=C=>{"imgData"in C&&n(0,i=C.imgData)},[i,S]}class $v extends be{constructor(e){super(),ye(this,e,Dv,Rv,_e,{imgData:0})}}const tb="";function zv(t){let e,n;return e=new $v({props:{imgData:t[2]}}),{c(){ue(e.$$.fragment)},m(i,r){ae(e,i,r),n=!0},p:Z,i(i){n||(H(e.$$.fragment,i),n=!0)},o(i){K(e.$$.fragment,i),n=!1},d(i){ce(e,i)}}}function jv(t){let e,n;return e=new Ov({props:{imgData:t[1]}}),{c(){ue(e.$$.fragment)},m(i,r){ae(e,i,r),n=!0},p:Z,i(i){n||(H(e.$$.fragment,i),n=!0)},o(i){K(e.$$.fragment,i),n=!1},d(i){ce(e,i)}}}function Fv(t){let e,n,i,r,s,o,l,a,c;const u=[jv,zv],h=[];function f(d,m){return d[0]?0:1}return i=f(t),r=h[i]=u[i](t),a=new J0({props:{start:!1,buttonDisplay:!0,toggleLabel:W==="en"?"Overlay view":"Vue superposée"}}),a.$on("updateChecked",t[3]),{c(){e=w("div"),n=w("div"),r.c(),o=q(),l=w("div"),ue(a.$$.fragment),v(n,"class",s="modal-similarity-images "+(t[0]?"overlay-wrapper":"side-by-side-wrapper")+" svelte-1qvtan5"),v(e,"class","modal-similarity svelte-1qvtan5")},m(d,m){V(d,e,m),y(e,n),h[i].m(n,null),y(e,o),y(e,l),ae(a,l,null),c=!0},p(d,[m]){let p=i;i=f(d),i===p?h[i].p(d,m):(Ee(),K(h[p],1,1,()=>{h[p]=null}),Ce(),r=h[i],r?r.p(d,m):(r=h[i]=u[i](d),r.c()),H(r,1),r.m(n,null)),(!c||m&1&&s!==(s="modal-similarity-images "+(d[0]?"overlay-wrapper":"side-by-side-wrapper")+" svelte-1qvtan5"))&&v(n,"class",s)},i(d){c||(H(r),H(a.$$.fragment,d),c=!0)},o(d){K(r),K(a.$$.fragment,d),c=!1},d(d){d&&F(e),h[i].d(),ce(a)}}}function Vv(t,e,n){let{mainImgItem:i}=e,{compareImgItem:r}=e;const s={similarityImage:{href:$t(i.img,i.img.split("_").pop()),title:a(i.title)},queryImage:{href:$t(r.img,r.img.split("_").pop()),title:a(r.title)}},o={similarityImage:i,queryImage:r};let l=!1;function a(u){return W==="fr"?`Vue principale de la région ${u}`:`Main view of region ${u}`}const c=()=>n(0,l=!l);return t.$$set=u=>{"mainImgItem"in u&&n(4,i=u.mainImgItem),"compareImgItem"in u&&n(5,r=u.compareImgItem)},[l,s,o,c,i,r]}class Hv extends be{constructor(e){super(),ye(this,e,Vv,Fv,_e,{mainImgItem:4,compareImgItem:5})}}const Uv=Object.freeze(Object.defineProperty({__proto__:null,default:Hv},Symbol.toStringTag,{value:"Module"})),Sc=(t,e,n,i)=>({id:t,img:t,title:`Canvas ${i} - ${n} - ${W==="en"?"Witness":"Témoin"} #${br(e)}`,xywh:n.split(",").map(Number),canvas:i,ref:t.replace(".jpg",""),type:Zc});function Bv(t){let e,n,i,r,s,o,l,a,c,u,h;return n=new xn({props:{category:1,isSelected:t[0]===1,toggle:t[4],padding:"pl-3 pr-2"}}),r=new xn({props:{category:2,isSelected:t[0]===2,toggle:t[4]}}),o=new xn({props:{category:3,isSelected:t[0]===3,toggle:t[4]}}),a=new xn({props:{category:4,isSelected:t[0]===4,toggle:t[4]}}),u=new xn({props:{category:5,isSelected:t[0]===5,toggle:t[4],padding:"pl-2 pr-3"}}),{c(){e=w("div"),ue(n.$$.fragment),i=q(),ue(r.$$.fragment),s=q(),ue(o.$$.fragment),l=q(),ue(a.$$.fragment),c=q(),ue(u.$$.fragment),v(e,"class","tags has-addons is-dark is-center")},m(f,d){V(f,e,d),ae(n,e,null),y(e,i),ae(r,e,null),y(e,s),ae(o,e,null),y(e,l),ae(a,e,null),y(e,c),ae(u,e,null),h=!0},p(f,d){const m={};d&1&&(m.isSelected=f[0]===1),n.$set(m);const p={};d&1&&(p.isSelected=f[0]===2),r.$set(p);const g={};d&1&&(g.isSelected=f[0]===3),o.$set(g);const _={};d&1&&(_.isSelected=f[0]===4),a.$set(_);const S={};d&1&&(S.isSelected=f[0]===5),u.$set(S)},i(f){h||(H(n.$$.fragment,f),H(r.$$.fragment,f),H(o.$$.fragment,f),H(a.$$.fragment,f),H(u.$$.fragment,f),h=!0)},o(f){K(n.$$.fragment,f),K(r.$$.fragment,f),K(o.$$.fragment,f),K(a.$$.fragment,f),K(u.$$.fragment,f),h=!1},d(f){f&&F(e),ce(n),ce(r),ce(o),ce(a),ce(u)}}}function qv(t){let e,n,i,r;n=new Rn({props:{item:t[3],size:256,selectable:!1,isSquare:!1}});let s=!t[2]&&Bv(t);return{c(){e=w("div"),ue(n.$$.fragment),i=q(),s&&s.c()},m(o,l){V(o,e,l),ae(n,e,null),y(e,i),s&&s.m(e,null),r=!0},p(o,[l]){o[2]||s.p(o,l)},i(o){r||(H(n.$$.fragment,o),H(s),r=!0)},o(o){K(n.$$.fragment,o),K(s),r=!1},d(o){o&&F(e),ce(n),s&&s.d()}}}function Kv(t,e,n){let i,r,s;const{comparedRegions:o}=Qt;me(t,o,z=>n(15,s=z));const l=new URL(window.location.href),a=l.origin;l.pathname;let{qImg:c}=e,{sImg:u}=e,{qRegions:h}=e,{sRegions:f}=e,{score:d=0}=e,{category:m=null}=e,{users:p=[]}=e,{isManual:g}=e,{similarityType:_}=e;const S=vt("isInModal")||!1,[C,b,k,P]=u.split(".")[0].split("_"),E=(()=>{let z=Sc(u,C,P,k);const I=s[`${C}_${b}_anno${f}`]||{title:z.title};return z.title=`${ou(I.title.replace(/^[^|]+/,""))}<br/>Page ${su(k)}<br/><b>Score: ${d}</b>`,z})();bn("similarityPair",{qImg:c,sImg:u,qRegions:h,sRegions:f,score:d,category:m,users:p,isManual:g,similarityType:_});function M(z){z=z.slice();let I=z.indexOf(Number(yr));return r&&I===-1?z.push(Number(yr)):!r&&I!==-1&&z.splice(I,1),z}const D=()=>({img_1:c,img_2:u,regions_id_1:h,regions_id_2:f,score:d,category:i,category_x:M(p),similarity_type:_});function $(z){z===5?r=!r:n(0,i=i===z?null:z)}async function R(z){$(z);try{(await fetch(`${a}/${Tt}/save-category`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":en},body:JSON.stringify(D())})).ok||(console.error("Error: Network response was not ok"),$(z))}catch(I){console.error("Error:",I),$(z)}}return t.$$set=z=>{"qImg"in z&&n(5,c=z.qImg),"sImg"in z&&n(6,u=z.sImg),"qRegions"in z&&n(7,h=z.qRegions),"sRegions"in z&&n(8,f=z.sRegions),"score"in z&&n(9,d=z.score),"category"in z&&n(10,m=z.category),"users"in z&&n(11,p=z.users),"isManual"in z&&n(12,g=z.isManual),"similarityType"in z&&n(13,_=z.similarityType)},t.$$.update=()=>{t.$$.dirty&1024&&n(0,i=m),t.$$.dirty&2048&&(r=p.includes(Number(yr))||!1)},[i,o,S,E,R,c,u,h,f,d,m,p,g,_]}class Wv extends be{constructor(e){super(),ye(this,e,Kv,qv,_e,{qImg:5,sImg:6,qRegions:7,sRegions:8,score:9,category:10,users:11,isManual:12,similarityType:13})}}function kc(t,e,n){const i=t.slice();return i[22]=e[n].uuid,i[23]=e[n].data[0],i[24]=e[n].data[1],i[25]=e[n].data[2],i[26]=e[n].data[3],i[27]=e[n].data[4],i[28]=e[n].data[5],i[29]=e[n].data[6],i[30]=e[n].data[7],i[31]=e[n].data[8],i}function Gv(t){let e,n=W==="en"?`Error when retrieving similar regions: ${t[2]}`:`Erreur de recupération des régions similaires: ${t[2]}`,i;return{c(){e=w("div"),i=se(n),v(e,"class","faded is-center")},m(r,s){V(r,e,s),y(e,i)},p(r,s){s[0]&4&&n!==(n=W==="en"?`Error when retrieving similar regions: ${r[2]}`:`Erreur de recupération des régions similaires: ${r[2]}`)&&ve(i,n)},i:Z,o:Z,d(r){r&&F(e)}}}function Yv(t){let e,n,i=t[4].length+"",r,s,o=t[11](t[10],t[4].length)+"",l,a,c,u=[],h=new Map,f,d=t[4];const m=g=>g[22];for(let g=0;g<d.length;g+=1){let _=kc(t,d,g),S=m(_);h.set(S,u[g]=Cc(S,_))}let p=null;return d.length||(p=Ec(t)),{c(){e=w("div"),n=w("span"),r=se(i),s=q(),l=se(o),a=q(),c=w("div");for(let g=0;g<u.length;g+=1)u[g].c();p&&p.c(),v(n,"class","m-2"),v(c,"class","m-2 is-gap-2"),Se(c,"grid",t[4].length>0)},m(g,_){V(g,e,_),y(e,n),y(n,r),y(n,s),y(n,l),y(e,a),y(e,c);for(let S=0;S<u.length;S+=1)u[S]&&u[S].m(c,null);p&&p.m(c,null),f=!0},p(g,_){(!f||_[0]&16)&&i!==(i=g[4].length+"")&&ve(r,i),(!f||_[0]&16)&&o!==(o=g[11](g[10],g[4].length)+"")&&ve(l,o),_[0]&49&&(d=g[4],Ee(),u=vr(u,_,m,1,g,d,h,c,_r,Cc,null,kc),Ce(),!d.length&&p?p.p(g,_):d.length?p&&(p.d(1),p=null):(p=Ec(g),p.c(),p.m(c,null))),(!f||_[0]&16)&&Se(c,"grid",g[4].length>0)},i(g){if(!f){for(let _=0;_<d.length;_+=1)H(u[_]);f=!0}},o(g){for(let _=0;_<u.length;_+=1)K(u[_]);f=!1},d(g){g&&F(e);for(let _=0;_<u.length;_+=1)u[_].d();p&&p.d()}}}function Xv(t){let e;return{c(){e=w("div"),e.textContent=`${W==="en"&&!t[10]?"Retrieving similar regions...":W==="fr"&&!t[10]?"Récupération des régions similaires...":W==="en"&&t[10]?"Retrieving propagated regions...":"Récupération de similarités propagées..."}`,v(e,"class","faded is-center")},m(n,i){V(n,e,i)},p:Z,i:Z,o:Z,d(n){n&&F(e)}}}function Ec(t){let e;function n(s,o){return s[5]?Qv:Jv}let i=n(t),r=i(t);return{c(){r.c(),e=Ge()},m(s,o){r.m(s,o),V(s,e,o)},p(s,o){i===(i=n(s))&&r?r.p(s,o):(r.d(1),r=i(s),r&&(r.c(),r.m(e.parentNode,e)))},d(s){r.d(s),s&&F(e)}}}function Jv(t){let e;return{c(){e=w("div"),e.textContent=`${W==="en"?"No similar regions":"Pas de régions similaires"}
                    `,v(e,"class","faded is-center")},m(n,i){V(n,e,i)},p:Z,d(n){n&&F(e)}}}function Qv(t){let e;return{c(){e=w("div"),e.textContent=`${W==="en"?"No document selected. Select one to display results.":"Aucun document sélectionné. Sélectionnez-en un pour afficher les résultats."}
                    `,v(e,"class","faded is-center")},m(n,i){V(n,e,i)},p:Z,d(n){n&&F(e)}}}function Cc(t,e){let n,i,r;return i=new Wv({props:{qImg:e[0],sImg:e[25],score:e[23],qRegions:e[26],sRegions:e[27],category:e[28],users:e[29],isManual:e[30],similarityType:e[31]}}),{key:t,first:null,c(){n=Ge(),ue(i.$$.fragment),this.first=n},m(s,o){V(s,n,o),ae(i,s,o),r=!0},p(s,o){e=s;const l={};o[0]&1&&(l.qImg=e[0]),o[0]&16&&(l.sImg=e[25]),o[0]&16&&(l.score=e[23]),o[0]&16&&(l.qRegions=e[26]),o[0]&16&&(l.sRegions=e[27]),o[0]&16&&(l.category=e[28]),o[0]&16&&(l.users=e[29]),o[0]&16&&(l.isManual=e[30]),o[0]&16&&(l.similarityType=e[31]),i.$set(l)},i(s){r||(H(i.$$.fragment,s),r=!0)},o(s){K(i.$$.fragment,s),r=!1},d(s){s&&F(n),ce(i,s)}}}function Zv(t){let e,n,i,r;const s=[Xv,Yv,Gv],o=[];function l(a,c){return a[1]&&a[3]==="loading"?0:a[3]==="loaded"?1:a[3]==="error"?2:-1}return~(e=l(t))&&(n=o[e]=s[e](t)),{c(){n&&n.c(),i=Ge()},m(a,c){~e&&o[e].m(a,c),V(a,i,c),r=!0},p(a,c){let u=e;e=l(a),e===u?~e&&o[e].p(a,c):(n&&(Ee(),K(o[u],1,1,()=>{o[u]=null}),Ce()),~e?(n=o[e],n?n.p(a,c):(n=o[e]=s[e](a),n.c()),H(n,1),n.m(i.parentNode,i)):n=null)},i(a){r||(H(n),r=!0)},o(a){K(n),r=!1},d(a){~e&&o[e].d(a),a&&F(i)}}}function ey(t,e,n){let i,r,s,o,l,a,c,u,{qImg:h}=e,{sImgsPromise:f}=e;const{selectedRegions:d,excludedCategories:m,similarityScoreCutoff:p,propagateFilterByRegions:g}=Qt;me(t,d,M=>n(16,u=M)),me(t,m,M=>n(15,c=M)),me(t,p,M=>n(14,a=M)),me(t,g,M=>n(13,l=M));const _=vt("similarityPropagatedContext")||!1,S=window.location.pathname.match(/\d+/g).join("-");let C;const b=(M,D)=>M===null||D===void 0||Number(M)>=D,k=(M,D,$)=>!$.includes(M),P=(M,D,$,R,z,I)=>_?!0:b(M,z)&&k(D,$,R),A=(M,D,$,R)=>M.filter(({uuid:z,data:[I,N,x,L,B,U,G,X,ee]})=>P(I,U,G,D,$)),E=(M,D)=>{const $=D>1;return M?W==="fr"?$?"similarités propagées":"similarité propagée":$?"propagated matches":"propagated match":W==="fr"?$?"images similaires":"image similaire":$?"similar images":"similar image"};return t.$$set=M=>{"qImg"in M&&n(0,h=M.qImg),"sImgsPromise"in M&&n(1,f=M.sImgsPromise)},t.$$.update=()=>{t.$$.dirty[0]&65536&&n(5,i=Object.values(u).length===0||u[S]===void 0||!Object.keys(u[S]).length),t.$$.dirty[0]&2&&(M=>{n(3,r="loading"),n(4,o=[]),n(12,s=[])})(),t.$$.dirty[0]&2&&f.then(M=>{n(12,s=M.map(D=>({uuid:window.crypto.randomUUID(),data:D}))),n(3,r="loaded")}).catch(M=>{n(2,C=M),n(3,r="error")}),t.$$.dirty[0]&61440&&n(4,o=A(s,c,a))},n(3,r="loading"),n(12,s=[]),[h,f,C,r,o,i,d,m,p,g,_,E,s,l,a,c,u]}class Ic extends be{constructor(e){super(),ye(this,e,ey,Zv,_e,{qImg:0,sImgsPromise:1},null,[-1,-1])}}function ty(t){let e,n;return e=new Ic({props:{qImg:t[0],sImgsPromise:t[1]}}),{c(){ue(e.$$.fragment)},m(i,r){ae(e,i,r),n=!0},p(i,[r]){const s={};r&1&&(s.qImg=i[0]),r&2&&(s.sImgsPromise=i[1]),e.$set(s)},i(i){n||(H(e.$$.fragment,i),n=!0)},o(i){K(e.$$.fragment,i),n=!1},d(i){ce(e,i)}}}function ny(t,e,n){let i,r,{qImg:s}=e,o;const l=vt("isInModal")||!1,{selectedRegions:a,comparedRegions:c}=Qt;me(t,a,m=>n(4,i=m)),me(t,c,m=>n(5,r=m));const u=`${window.location.origin}${window.location.pathname}`,h=window.location.pathname.match(/\d+/g).join("-"),f=(m,p)=>p?Object.keys(r).map(g=>r[g].id):Object.values(m[h]||{}).map(g=>g.id);async function d(m,p,g){const _=f(p,g);return _.length===0?[]:await(await fetch(`${u}similar-images`,{method:"POST",body:JSON.stringify({regionsIds:_,qImg:m,topk:12}),headers:{"Content-Type":"application/json","X-CSRFToken":en}})).json()}return l?o=d(s,i,l):a.subscribe(m=>{n(1,o=d(s,m,l))}),t.$$set=m=>{"qImg"in m&&n(0,s=m.qImg)},[s,o,a,c]}class iy extends be{constructor(e){super(),ye(this,e,ny,ty,_e,{qImg:0})}}const nb="";function ry(t){let e,n,i,r;return i=new Ic({props:{qImg:t[0],sImgsPromise:t[1]}}),{c(){e=w("div"),n=w("div"),ue(i.$$.fragment),v(n,"class","matches-suggestion svelte-1cb4wg0"),v(e,"class","block matches-suggestion-wrapper svelte-1cb4wg0")},m(s,o){V(s,e,o),y(e,n),ae(i,n,null),r=!0},p(s,[o]){const l={};o&1&&(l.qImg=s[0]),o&2&&(l.sImgsPromise=s[1]),i.$set(l)},i(s){r||(H(i.$$.fragment,s),r=!0)},o(s){K(i.$$.fragment,s),r=!1},d(s){s&&F(e),ce(i)}}}function sy(t,e,n){let i,r,{qImg:s}=e;const{propagateParams:o,selectedRegions:l}=Qt;me(t,o,g=>n(4,i=g)),me(t,l,g=>n(5,r=g));const a=`${window.location.origin}${window.location.pathname}`,c=window.location.pathname.match(/\d+/g).join("-"),u=vt("isInModal")||!1;let h;const f=Si();f.setCompareFn((g,_)=>[g,_].every(S=>S&&S.hasOwnProperty("propagateRecursionDepth")&&S.hasOwnProperty("propagateFilterByRegions"))?g.propagateRecursionDepth===_.propagateRecursionDepth&&g.propagateFilterByRegions===_.propagateFilterByRegions:!1);const d=Si();d.setCompareFn(kr),bn("similarityPropagatedContext",!0);const m=g=>Object.keys(g).includes(c)?Object.values(g[c]).map(_=>_.id):[],p=async(g,_,S)=>fetch(`${a}propagated-matches/${s}`,{method:"POST",body:JSON.stringify({regionsIds:S?[]:_,filterByRegions:S?!1:g.propagateFilterByRegions,recursionDepth:g.propagateRecursionDepth}),headers:{"Content-Type":"application/json","X-CSRFToken":en}}).then(C=>C.json()).catch(C=>(console.error("PropagatedMatches.getPropagatedMatches:",C),[]));return o.subscribe(g=>{f.set(g),f.same()||n(1,h=p(f.get(),m(r),u))}),l.subscribe(g=>{d.set(m(g)),i.propagateFilterByRegions===!0&&!d.same()&&n(1,h=p(i,d.get(),u))}),t.$$set=g=>{"qImg"in g&&n(0,s=g.qImg)},[s,h,o,l]}class oy extends be{constructor(e){super(),ye(this,e,sy,ry,_e,{qImg:0})}}const ib="";function ly(t){let e,n,i,r=parseInt(t[5])+"",s,o,l,a,c,u,h,f,d,m,p,g,_,S,C,b,k,P,A;return{c(){e=w("a"),n=w("i"),i=se(`
            Page `),s=se(r),o=q(),l=w("img"),c=q(),u=w("div"),h=w("div"),f=w("input"),d=q(),m=w("button"),m.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M256 80c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 144L48 224c-17.7 0-32 14.3-32 32s14.3 32 32 32l144 0 0 144c0 17.7 14.3 32 32 32s32-14.3 32-32l0-144 144 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-144 0 0-144z"></path></svg>',p=q(),g=w("button"),_=xt("svg"),S=xt("path"),v(n,"class","fa-solid fa-pen-to-square"),v(e,"class","tag px-2 py-1 mb-2 is-rounded is-hoverable"),v(e,"href",fu(t[6],parseInt(t[5]))),v(e,"target","_blank"),_t(l.src,a=$t(t[0],t[0].split("_").pop(),"250,"))||v(l,"src",a),v(l,"alt","Query region"),v(l,"class","mb-3 card query-image svelte-f4ylwc"),v(f,"class","input is-small tag"),v(f,"type","text"),v(f,"placeholder",W==="en"?"Add new match":"Ajouter une correspondance"),v(m,"class","button is-small tag is-link is-center"),v(h,"class","tags has-addons"),Re(h,"flex-wrap","nowrap"),v(S,"fill","white"),v(S,"d","M376.6 84.5c11.3-13.6 9.5-33.8-4.1-45.1s-33.8-9.5-45.1 4.1L192 206 56.6 43.5C45.3 29.9 25.1 28.1 11.5 39.4S-3.9 70.9 7.4 84.5L150.3 256 7.4 427.5c-11.3 13.6-9.5 33.8 4.1 45.1s33.8 9.5 45.1-4.1L192 306 327.4 468.5c11.3 13.6 31.5 15.4 45.1 4.1s15.4-31.5 4.1-45.1L233.7 256 376.6 84.5z"),v(_,"xmlns","http://www.w3.org/2000/svg"),v(_,"viewBox","0 0 384 512"),v(g,"id","no-match"),v(g,"class",C="button is-small tag is-danger is-center m-0 "+(t[3]===1?"visible":"")+" svelte-f4ylwc"),v(g,"title",W==="en"?"No match for this region in this witness":"Aucune correspondance de cette région pour ce témoin"),v(u,"class","new-similarity control pt-2 is-center svelte-f4ylwc")},m(E,M){V(E,e,M),y(e,n),y(e,i),y(e,s),V(E,o,M),V(E,l,M),V(E,c,M),V(E,u,M),y(u,h),y(h,f),gi(f,t[1]),y(h,d),y(h,m),y(u,p),y(u,g),y(g,_),y(_,S),k=!0,P||(A=[pe(f,"input",t[12]),pe(m,"click",t[8]),pe(g,"click",t[9])],P=!0)},p(E,M){(!k||M&1&&!_t(l.src,a=$t(E[0],E[0].split("_").pop(),"250,")))&&v(l,"src",a),M&2&&f.value!==E[1]&&gi(f,E[1]),(!k||M&8&&C!==(C="button is-small tag is-danger is-center m-0 "+(E[3]===1?"visible":"")+" svelte-f4ylwc"))&&v(g,"class",C)},i(E){k||(Dt(()=>{k&&(b||(b=Zt(g,Mn,{duration:500},!0)),b.run(1))}),k=!0)},o(E){b||(b=Zt(g,Mn,{duration:500},!1)),b.run(0),k=!1},d(E){E&&F(e),E&&F(o),E&&F(l),E&&F(c),E&&F(u),E&&b&&b.end(),P=!1,Ze(A)}}}function ay(t){let e,n,i,r,s,o,l,a;return n=new iy({props:{qImg:t[0]}}),o=new oy({props:{qImg:t[0]}}),{c(){e=w("div"),ue(n.$$.fragment),r=q(),s=w("div"),ue(o.$$.fragment),v(e,"class",i=mi(t[7]?"":t[2])+" svelte-f4ylwc"),v(s,"class",l=mi(t[7]?"":t[2])+" svelte-f4ylwc")},m(c,u){V(c,e,u),ae(n,e,null),V(c,r,u),V(c,s,u),ae(o,s,null),a=!0},p(c,u){const h={};u&1&&(h.qImg=c[0]),n.$set(h),(!a||u&4&&i!==(i=mi(c[7]?"":c[2])+" svelte-f4ylwc"))&&v(e,"class",i);const f={};u&1&&(f.qImg=c[0]),o.$set(f),(!a||u&4&&l!==(l=mi(c[7]?"":c[2])+" svelte-f4ylwc"))&&v(s,"class",l)},i(c){a||(H(n.$$.fragment,c),H(o.$$.fragment,c),a=!0)},o(c){K(n.$$.fragment,c),K(o.$$.fragment,c),a=!1},d(c){c&&F(e),ce(n),c&&F(r),c&&F(s),ce(o)}}}function cy(t){let e,n;return e=new da({props:{useGrid:!1,$$slots:{"row-body":[ay],"row-header":[ly]},$$scope:{ctx:t}}}),{c(){ue(e.$$.fragment)},m(i,r){ae(e,i,r),n=!0},p(i,[r]){const s={};r&1048591&&(s.$$scope={dirty:r,ctx:i}),e.$set(s)},i(i){n||(H(e.$$.fragment,i),n=!0)},o(i){K(e.$$.fragment,i),n=!1},d(i){ce(e,i)}}}function uy(t){return t=t.replace(".jpg",""),/^wit\d+_[a-zA-Z]{3}\d+_\d+_\d+,\d+,\d+,\d+$/.test(t)}function fy(t,e,n){let i,r,s,o;const{selectedRegions:l}=Qt;me(t,l,P=>n(11,o=P));let{qImg:a}=e,c="";const[u,h,f,d]=a.split(".")[0].split("_"),m=`${window.location.origin}${window.location.pathname}`,p=window.location.pathname.match(/\d+/g).join("-"),g=W==="en"?"Error":"Erreur",_=vt("manifest"),S=vt("isInModal")||!1;bn("qImgMetadata",Sc(a,u,d,f));async function C(){if(!c||!uy(c)){await ht(W==="en"?"Please insert a valid region reference to add a new match":"Veuillez insérer une référence de région valide pour ajouter une nouvelle correspondance","Error");return}try{const P=await fetch(`${m}add-region-pair`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":en},body:JSON.stringify({q_img:a.replace(".jpg",""),s_img:c,similarity_type:2})});P.ok||(console.error("Error: Network response was not ok"),await ht(W==="en"?"Problem with network, match was not added":"Problème de réseau, la correspondance n'a pas été ajoutée",g));const A=await P.json();if(A.hasOwnProperty("error")||!A.hasOwnProperty("s_regions")){await ht(W==="en"?`Request was unsuccessful, match was not added:<br>${A.error}`:`La requête n'a pas abouti, la correspondance n'a pas été ajoutée :<br>${A.error}`,g);return}const E=A.s_regions;Qt.addComparedRegions(E),Qt.select(E)}catch(P){console.error("Error:",P),await ht(W==="en"?`An error has occurred, match was not added:<br>${P}`:`Une erreur s'est produite, la correspondance n'a pas été ajoutée :<br>${P}`,g)}}async function b(){const P=Object.values(o[p])[0];if(await ht(W==="en"?`Do you confirm this region does not have any match in ${P.title}?`:`Confirmez-vous que cette région n'a pas de correspondance dans ${P.title} ?`,W==="en"?"Confirm no match":"Confirmer l'absence de correspondance",!0))try{(await fetch(`${m}no-match`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":en},body:JSON.stringify({q_img:a,s_regions:P.id})})).ok||(console.error("Error: Network response was not ok"),await ht(W==="en"?"Problem with network":"Problème de réseau",g)),Qt.select(P)}catch(E){console.error("Error:",E),await ht(W==="en"?`An error has occurred, request was unsuccessful:<br>${E}`:`Une erreur s'est produite, la requête n'a pas abouti :<br>${E}`,g)}}function k(){c=this.value,n(1,c)}return t.$$set=P=>{"qImg"in P&&n(0,a=P.qImg)},t.$$.update=()=>{t.$$.dirty&2048&&n(3,i=o.hasOwnProperty(p)?Object.values(o[p]).length:0),t.$$.dirty&1024&&n(2,s=`fixed-grid has-${r-1}-cols`)},n(10,r=Hs(window.innerWidth)),[a,c,s,i,l,f,_,S,C,b,r,o,k]}class hy extends be{constructor(e){super(),ye(this,e,fy,cy,_e,{qImg:0})}}function dy(t){let e,n,i,r,s,o;return s=new hy({props:{qImg:t[0].img}}),{c(){e=w("div"),n=w("a"),i=w("button"),i.textContent=`${W==="fr"?"Voir toutes les similarités pour ce document":"View all similarities for this document"}`,r=q(),ue(s.$$.fragment),v(i,"class","button is-link is-small"),v(n,"href",t[1]()),v(e,"class","is-flex is-align-items-center is-justify-content-end")},m(l,a){V(l,e,a),y(e,n),y(n,i),V(l,r,a),ae(s,l,a),o=!0},p(l,[a]){const c={};a&1&&(c.qImg=l[0].img),s.$set(c)},i(l){o||(H(s.$$.fragment,l),o=!0)},o(l){K(s.$$.fragment,l),o=!1},d(l){l&&F(e),l&&F(r),ce(s,l)}}}function my(t,e,n){let{mainImgItem:i}=e;function r(){const s=i.img.match(/wit(\d+)/)[1],o=new URL(window.location.origin);return o.pathname=`${new URL(window.location).pathname.split("/")[1]}/witness/${s}/regions/`,o.searchParams.set("tab","similarity"),o.href}return t.$$set=s=>{"mainImgItem"in s&&n(0,i=s.mainImgItem)},[i,r]}class py extends be{constructor(e){super(),ye(this,e,my,dy,_e,{mainImgItem:0})}}const gy=Object.freeze(Object.defineProperty({__proto__:null,default:py},Symbol.toStringTag,{value:"Module"}))})();
//# sourceMappingURL=documentSet.js.map
