(function(){"use strict";function ie(){}const As=t=>t;function Ts(t,e){for(const n in e)t[n]=e[n];return t}function Bc(t){return!!t&&(typeof t=="object"||typeof t=="function")&&typeof t.then=="function"}function Ns(t){return t()}function Ps(){return Object.create(null)}function vt(t){t.forEach(Ns)}function Dn(t){return typeof t=="function"}function je(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}let Ci;function At(t,e){return Ci||(Ci=document.createElement("a")),Ci.href=e,t===Ci.href}function qc(t){return Object.keys(t).length===0}function Ii(t,...e){if(t==null)return ie;const n=t.subscribe(...e);return n.unsubscribe?()=>n.unsubscribe():n}function yt(t){let e;return Ii(t,n=>e=n)(),e}function Me(t,e,n){t.$$.on_destroy.push(Ii(e,n))}function Bt(t,e,n,i){if(t){const r=Os(t,e,n,i);return t[0](r)}}function Os(t,e,n,i){return t[1]&&i?Ts(n.ctx.slice(),t[1](i(e))):n.ctx}function qt(t,e,n,i){if(t[2]&&i){const r=t[2](i(n));if(e.dirty===void 0)return r;if(typeof r=="object"){const s=[],o=Math.max(e.dirty.length,r.length);for(let l=0;l<o;l+=1)s[l]=e.dirty[l]|r[l];return s}return e.dirty|r}return e.dirty}function Kt(t,e,n,i,r,s){if(r){const o=Os(e,n,i,s);t.p(o,r)}}function Wt(t){if(t.ctx.length>32){const e=[],n=t.ctx.length/32;for(let i=0;i<n;i++)e[i]=-1;return e}return-1}function Kc(t){const e={};for(const n in t)e[n]=!0;return e}function xi(t){return t??""}function ii(t){return t&&Dn(t.destroy)?t.destroy:ie}const Ls=typeof window<"u";let Wc=Ls?()=>window.performance.now():()=>Date.now(),Sr=Ls?t=>requestAnimationFrame(t):ie;const Rn=new Set;function Ds(t){Rn.forEach(e=>{e.c(t)||(Rn.delete(e),e.f())}),Rn.size!==0&&Sr(Ds)}function Yc(t){let e;return Rn.size===0&&Sr(Ds),{promise:new Promise(n=>{Rn.add(e={c:t,f:n})}),abort(){Rn.delete(e)}}}const Gc=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function y(t,e){t.appendChild(e)}function Rs(t){if(!t)return document;const e=t.getRootNode?t.getRootNode():t.ownerDocument;return e&&e.host?e:t.ownerDocument}function Xc(t){const e=b("style");return Jc(Rs(t),e),e.sheet}function Jc(t,e){return y(t.head||t,e),e.sheet}function z(t,e,n){t.insertBefore(e,n||null)}function $(t){t.parentNode&&t.parentNode.removeChild(t)}function St(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function b(t){return document.createElement(t)}function Gt(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function re(t){return document.createTextNode(t)}function F(){return re(" ")}function Ct(){return re("")}function be(t,e,n,i){return t.addEventListener(e,n,i),()=>t.removeEventListener(e,n,i)}function ln(t){return function(e){return e.preventDefault(),t.call(this,e)}}function v(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function Qc(t){return Array.from(t.childNodes)}function Fe(t,e){e=""+e,t.data!==e&&(t.data=e)}function Mi(t,e){t.value=e??""}function We(t,e,n,i){n==null?t.style.removeProperty(e):t.style.setProperty(e,n,i?"important":"")}function _n(t,e,n){for(let i=0;i<t.options.length;i+=1){const r=t.options[i];if(r.__value===e){r.selected=!0;return}}(!n||e!==void 0)&&(t.selectedIndex=-1)}function Ai(t){const e=t.querySelector(":checked");return e&&e.__value}function Ye(t,e,n){t.classList[n?"add":"remove"](e)}function $s(t,e,{bubbles:n=!1,cancelable:i=!1}={}){const r=document.createEvent("CustomEvent");return r.initCustomEvent(t,n,i,e),r}function Ti(t,e){return new t(e)}const Ni=new Map;let Pi=0;function Zc(t){let e=5381,n=t.length;for(;n--;)e=(e<<5)-e^t.charCodeAt(n);return e>>>0}function eu(t,e){const n={stylesheet:Xc(e),rules:{}};return Ni.set(t,n),n}function zs(t,e,n,i,r,s,o,l=0){const a=16.666/i;let c=`{
`;for(let g=0;g<=1;g+=a){const _=e+(n-e)*s(g);c+=g*100+`%{${o(_,1-_)}}
`}const u=c+`100% {${o(n,1-n)}}
}`,h=`__svelte_${Zc(u)}_${l}`,f=Rs(t),{stylesheet:d,rules:m}=Ni.get(f)||eu(f,t);m[h]||(m[h]=!0,d.insertRule(`@keyframes ${h} ${u}`,d.cssRules.length));const p=t.style.animation||"";return t.style.animation=`${p?`${p}, `:""}${h} ${i}ms linear ${r}ms 1 both`,Pi+=1,h}function tu(t,e){const n=(t.style.animation||"").split(", "),i=n.filter(e?s=>s.indexOf(e)<0:s=>s.indexOf("__svelte")===-1),r=n.length-i.length;r&&(t.style.animation=i.join(", "),Pi-=r,Pi||nu())}function nu(){Sr(()=>{Pi||(Ni.forEach(t=>{const{ownerNode:e}=t.stylesheet;e&&$(e)}),Ni.clear())})}let ri;function an(t){ri=t}function $n(){if(!ri)throw new Error("Function called outside component initialization");return ri}function zn(t){$n().$$.on_mount.push(t)}function jn(t){$n().$$.on_destroy.push(t)}function Oi(){const t=$n();return(e,n,{cancelable:i=!1}={})=>{const r=t.$$.callbacks[e];if(r){const s=$s(e,n,{cancelable:i});return r.slice().forEach(o=>{o.call(t,s)}),!s.defaultPrevented}return!0}}function Fn(t,e){return $n().$$.context.set(t,e),e}function Ft(t){return $n().$$.context.get(t)}const Hn=[],vn=[];let Vn=[];const js=[],iu=Promise.resolve();let kr=!1;function ru(){kr||(kr=!0,iu.then(Cr))}function Ht(t){Vn.push(t)}const Er=new Set;let Un=0;function Cr(){if(Un!==0)return;const t=ri;do{try{for(;Un<Hn.length;){const e=Hn[Un];Un++,an(e),su(e.$$)}}catch(e){throw Hn.length=0,Un=0,e}for(an(null),Hn.length=0,Un=0;vn.length;)vn.pop()();for(let e=0;e<Vn.length;e+=1){const n=Vn[e];Er.has(n)||(Er.add(n),n())}Vn.length=0}while(Hn.length);for(;js.length;)js.pop()();kr=!1,Er.clear(),an(t)}function su(t){if(t.fragment!==null){t.update(),vt(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(Ht)}}function ou(t){const e=[],n=[];Vn.forEach(i=>t.indexOf(i)===-1?e.push(i):n.push(i)),n.forEach(i=>i()),Vn=e}let si;function lu(){return si||(si=Promise.resolve(),si.then(()=>{si=null})),si}function Ir(t,e,n){t.dispatchEvent($s(`${e?"intro":"outro"}${n}`))}const Li=new Set;let cn;function et(){cn={r:0,c:[],p:cn}}function tt(){cn.r||vt(cn.c),cn=cn.p}function V(t,e){t&&t.i&&(Li.delete(t),t.i(e))}function W(t,e,n,i){if(t&&t.o){if(Li.has(t))return;Li.add(t),cn.c.push(()=>{Li.delete(t),i&&(n&&t.d(1),i())}),t.o(e)}else i&&i()}const au={duration:0};function yn(t,e,n,i){const r={direction:"both"};let s=e(t,n,r),o=i?0:1,l=null,a=null,c=null;function u(){c&&tu(t,c)}function h(d,m){const p=d.b-o;return m*=Math.abs(p),{a:o,b:d.b,d:p,duration:m,start:d.start,end:d.start+m,group:d.group}}function f(d){const{delay:m=0,duration:p=300,easing:g=As,tick:_=ie,css:S}=s||au,C={start:Wc()+m,b:d};d||(C.group=cn,cn.r+=1),l||a?a=C:(S&&(u(),c=zs(t,o,d,p,m,g,S)),d&&_(0,1),l=h(C,p),Ht(()=>Ir(t,d,"start")),Yc(w=>{if(a&&w>a.start&&(l=h(a,p),a=null,Ir(t,l.b,"start"),S&&(u(),c=zs(t,o,l.b,l.duration,0,g,s.css))),l){if(w>=l.end)_(o=l.b,1-o),Ir(t,l.b,"end"),a||(l.b?u():--l.group.r||vt(l.group.c)),l=null;else if(w>=l.start){const k=w-l.start;o=l.a+l.d*g(k/l.duration),_(o,1-o)}}return!!(l||a)}))}return{run(d){Dn(s)?lu().then(()=>{s=s(r),f(d)}):f(d)},end(){u(),l=a=null}}}function xr(t,e){const n=e.token={};function i(r,s,o,l){if(e.token!==n)return;e.resolved=l;let a=e.ctx;o!==void 0&&(a=a.slice(),a[o]=l);const c=r&&(e.current=r)(a);let u=!1;e.block&&(e.blocks?e.blocks.forEach((h,f)=>{f!==s&&h&&(et(),W(h,1,1,()=>{e.blocks[f]===h&&(e.blocks[f]=null)}),tt())}):e.block.d(1),c.c(),V(c,1),c.m(e.mount(),e.anchor),u=!0),e.block=c,e.blocks&&(e.blocks[s]=c),u&&Cr()}if(Bc(t)){const r=$n();if(t.then(s=>{an(r),i(e.then,1,e.value,s),an(null)},s=>{if(an(r),i(e.catch,2,e.error,s),an(null),!e.hasCatch)throw s}),e.current!==e.pending)return i(e.pending,0),!0}else{if(e.current!==e.then)return i(e.then,1,e.value,t),!0;e.resolved=t}}function Fs(t,e,n){const i=e.slice(),{resolved:r}=t;t.current===t.then&&(i[t.value]=r),t.current===t.catch&&(i[t.error]=r),t.block.p(i,n)}function cu(t,e){t.d(1),e.delete(t.key)}function Mr(t,e){W(t,1,1,()=>{e.delete(t.key)})}function Di(t,e,n,i,r,s,o,l,a,c,u,h){let f=t.length,d=s.length,m=f;const p={};for(;m--;)p[t[m].key]=m;const g=[],_=new Map,S=new Map,C=[];for(m=d;m--;){const N=h(r,s,m),E=n(N);let M=o.get(E);M?i&&C.push(()=>M.p(N,e)):(M=c(E,N),M.c()),_.set(E,g[m]=M),E in p&&S.set(E,Math.abs(m-p[E]))}const w=new Set,k=new Set;function T(N){V(N,1),N.m(l,u),o.set(N.key,N),u=N.first,d--}for(;f&&d;){const N=g[d-1],E=t[f-1],M=N.key,O=E.key;N===E?(u=N.first,f--,d--):_.has(O)?!o.has(M)||w.has(M)?T(N):k.has(O)?f--:S.get(M)>S.get(O)?(k.add(M),T(N)):(w.add(O),f--):(a(E,o),f--)}for(;f--;){const N=t[f];_.has(N.key)||a(N,o)}for(;d;)T(g[d-1]);return vt(C),g}function uu(t,e){const n={},i={},r={$$scope:1};let s=t.length;for(;s--;){const o=t[s],l=e[s];if(l){for(const a in o)a in l||(i[a]=1);for(const a in l)r[a]||(n[a]=l[a],r[a]=1);t[s]=l}else for(const a in o)r[a]=1}for(const o in i)o in n||(n[o]=void 0);return n}function fu(t){return typeof t=="object"&&t!==null?t:{}}function _e(t){t&&t.c()}function me(t,e,n,i){const{fragment:r,after_update:s}=t.$$;r&&r.m(e,n),i||Ht(()=>{const o=t.$$.on_mount.map(Ns).filter(Dn);t.$$.on_destroy?t.$$.on_destroy.push(...o):vt(o),t.$$.on_mount=[]}),s.forEach(Ht)}function pe(t,e){const n=t.$$;n.fragment!==null&&(ou(n.after_update),vt(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function du(t,e){t.$$.dirty[0]===-1&&(Hn.push(t),ru(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function He(t,e,n,i,r,s,o,l=[-1]){const a=ri;an(t);const c=t.$$={fragment:null,ctx:[],props:s,update:ie,not_equal:r,bound:Ps(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(a?a.$$.context:[])),callbacks:Ps(),dirty:l,skip_bound:!1,root:e.target||a.$$.root};o&&o(c.root);let u=!1;if(c.ctx=n?n(t,e.props||{},(h,f,...d)=>{const m=d.length?d[0]:f;return c.ctx&&r(c.ctx[h],c.ctx[h]=m)&&(!c.skip_bound&&c.bound[h]&&c.bound[h](m),u&&du(t,h)),f}):[],c.update(),u=!0,vt(c.before_update),c.fragment=i?i(c.ctx):!1,e.target){if(e.hydrate){const h=Qc(e.target);c.fragment&&c.fragment.l(h),h.forEach($)}else c.fragment&&c.fragment.c();e.intro&&V(t.$$.fragment),me(t,e.target,e.anchor,e.customElement),Cr()}an(a)}class Ve{$destroy(){pe(this,1),this.$destroy=ie}$on(e,n){if(!Dn(n))return ie;const i=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return i.push(n),()=>{const r=i.indexOf(n);r!==-1&&i.splice(r,1)}}$set(e){this.$$set&&!qc(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const Bn=[];function hu(t,e){return{subscribe:Pe(t,e).subscribe}}function Pe(t,e=ie){let n;const i=new Set;function r(l){if(je(t,l)&&(t=l,n)){const a=!Bn.length;for(const c of i)c[1](),Bn.push(c,t);if(a){for(let c=0;c<Bn.length;c+=2)Bn[c][0](Bn[c+1]);Bn.length=0}}}function s(l){r(l(t))}function o(l,a=ie){const c=[l,a];return i.add(c),i.size===1&&(n=e(r)||ie),l(t),()=>{i.delete(c),i.size===0&&n&&(n(),n=null)}}return{set:r,update:s,subscribe:o}}function ut(t,e,n){const i=!Array.isArray(t),r=i?[t]:t,s=e.length<2;return hu(n,o=>{let l=!1;const a=[];let c=0,u=ie;const h=()=>{if(c)return;u();const d=e(i?a[0]:a,o);s?o(d):u=Dn(d)?d:ie},f=r.map((d,m)=>Ii(d,p=>{a[m]=p,c&=~(1<<m),l&&h()},()=>{c|=1<<m}));return l=!0,h(),function(){vt(f),u(),l=!1}})}const q=APP_LANG,Xt=APP_NAME;WEBAPP_NAME;const Ar=USER_ID,Tr=IS_SUPERUSER;ADD_PERMISSION;const bn=CSRF_TOKEN;ADDITIONAL_MODULES;const mu="Region",Hs=APP_URL,pu=SAS_APP_URL;CANTALOUPE_APP_URL,MEDIA_PATH;const gu=PAGE_LEN,Ri={Witness:q==="en"?"Witness":"Témoin",Work:q==="en"?"Work":"Œuvre",Series:q==="en"?"Series":"Série d'imprimés",Regions:q==="en"?"Region Extraction":"Extraction d'illustrations"},oi=Pe(!1),_u=Pe(""),vu=t=>typeof t=="string"||t instanceof String;async function Vs(t){oi.set(!0);try{return await t()}finally{oi.set(!1)}}function Nr(t){return t.match(/\d+/g).toString()}function yu(t){return parseInt(Nr(t),10)}function bu(t,e=100){const n=Math.floor(e*.75);return t.length>e?t.slice(0,n)+"..."+t.slice(-e+n):t}function wu(){return"https://vhs.huma-num.fr"}function Su(){return pu??"http://localhost:8888"}function Pr(t,e){if(typeof window<"u"){const n=parseInt(new URLSearchParams(window.location.search).get(e));if(!isNaN(n))return t.set(n),n}return t.set(1),1}function Or(t,e,n){if(e.set(t),typeof window<"u"){const i=new URL(window.location.href);i.searchParams.set(n,t),window.history.pushState({},"",i)}}function ku(t=null){return t=t.split("_"),t.length<3?void 0:`${t.slice(0,3).join("_").replace(".jpg","")}.jpg`}function Us(t=null){const e=ku(t);return e===void 0?void 0:`${wu()}/iiif/2/${e}`}function Yt(t=null,e=null,n="full"){if(e=vu(e)?e.replace(".jpg",""):e,!t)return"https://placehold.co/96x96/png?text=No+image";if(!t.startsWith("wit")){const[s,...o]=t.split("_wit");t=`wit${o}`}const i=Us(t);if(i===void 0)return"https://placehold.co/96x96/png?text=No+image";const r=t.split("_");return e||(e=r[r.length-1].includes(",")?r.pop().replace(".jpg",""):"full"),`${i}/${e}/${n}/0/default.jpg`}function Eu(t=null){return`${Us(t)}/info.json`}function Cu(t=null,e=1){return`${Su()}/index.html?iiif-content=${t}&canvas=${e}`}function Tt(t,e=null,n=!1){return new Promise(i=>{if(document.getElementById("msg-modal")){n?document.getElementById("modal-footer").hidden=!1:i(void 0),e&&(document.getElementById("modal-title").innerHTML=e),document.getElementById("modal-msg").innerHTML=t,document.getElementById("hidden-msg-btn").click();const s=document.getElementById("cancel-btn"),o=document.getElementById("ok-btn"),l=document.getElementById("modal-bkg"),a=()=>{s.removeEventListener("click",c),l.removeEventListener("click",c),o.removeEventListener("click",u),document.getElementById("modal-footer").hidden=!0},c=()=>{a(),i(!1)},u=()=>{a(),i(!0)};s.addEventListener("click",c),o.addEventListener("click",u)}else n?i(window.confirm(t)):(window.alert(t),i(void 0))})}function $i(){let t,e,n=(i,r)=>i===r;return{set:i=>{e=t,t=i},setCompareFn:i=>n=i,get:()=>t,getNewAndOld:()=>[t,e],same:()=>n(t,e)}}const Lr=(t,e)=>Array.isArray(t)&&Array.isArray(e)&&t.length===e.length&&t.every((n,i)=>n===e[i]||void 0);function Iu(t){const n=[85,70,60],i=[50,65,40],r=t*137.5%360,s=n[t%n.length],o=i[Math.floor(t/n.length)%i.length];return`hsl(${Math.floor(r)}, ${s}%, ${o}%)`}function Bs(t=null){return t<600?1:t<800?2:t<1e3?3:t<1200?4:t<1400?5:t>=1400?6:4}function Dr(t){const e=t.querySelectorAll(".modal-background, .modal-close, .modal-card-head .delete, .modal-card-foot .button-close"),n=()=>t.classList.remove("is-active");e.forEach(r=>r.addEventListener("click",n));const i=r=>{r.key==="Escape"&&t.classList.contains("is-active")&&n()};return document.addEventListener("keydown",i),{destroy(){e.forEach(r=>r.removeEventListener("click",n)),document.removeEventListener("keydown",i)}}}function qs(t){const e=()=>{const n=document.getElementById(t.dataset.target);n==null||n.classList.add("is-active")};return t.addEventListener("click",e),{destroy(){t.removeEventListener("click",e)}}}function qn(t,e,n="string",i=null){const r={string:o=>{const l=o.get(e);return l!==null?l:null},array:o=>{const l=o.get(e);return l?l.split(",").map(Number).filter(a=>!isNaN(a)):null},set:o=>{const l=o.get(e);return l?new Set(l.split(",").map(Number).filter(a=>!isNaN(a))):null},number:o=>{const l=o.get(e);return l!==null?Number(l):null},boolean:o=>{const l=o.get(e);return l!==null?l==="true":null}},s={string:(o,l)=>l?o.searchParams.set(e,l):o.searchParams.delete(e),array:(o,l)=>{l!=null&&l.length?o.searchParams.set(e,l.join(",")):o.searchParams.delete(e)},set:(o,l)=>{l!=null&&l.size?o.searchParams.set(e,Array.from(l).join(",")):o.searchParams.delete(e)},number:(o,l)=>{l!=null?o.searchParams.set(e,String(l)):o.searchParams.delete(e)},boolean:(o,l)=>l?o.searchParams.set(e,"true"):o.searchParams.delete(e)};if(typeof window<"u"){const o=new URLSearchParams(window.location.search),l=r[n](o);if(l!==null)t.set(l);else if(i!==null){const a=typeof i=="function"?i():i;t.set(a)}return a=>{const c=new URL(window.location);s[n](c,a),window.history.pushState({},"",c)}}return()=>{}}function xu(t){const e=t-1;return e*e*e+1}function Kn(t,{delay:e=0,duration:n=400,easing:i=As}={}){const r=+getComputedStyle(t).opacity;return{delay:e,duration:n,easing:i,css:s=>`opacity: ${s*r}`}}function Ks(t,{delay:e=0,duration:n=400,easing:i=xu,axis:r="y"}={}){const s=getComputedStyle(t),o=+s.opacity,l=r==="y"?"height":"width",a=parseFloat(s[l]),c=r==="y"?["top","bottom"]:["left","right"],u=c.map(_=>`${_[0].toUpperCase()}${_.slice(1)}`),h=parseFloat(s[`padding${u[0]}`]),f=parseFloat(s[`padding${u[1]}`]),d=parseFloat(s[`margin${u[0]}`]),m=parseFloat(s[`margin${u[1]}`]),p=parseFloat(s[`border${u[0]}Width`]),g=parseFloat(s[`border${u[1]}Width`]);return{delay:e,duration:n,easing:i,css:_=>`overflow: hidden;opacity: ${Math.min(_*20,1)*o};${l}: ${_*a}px;padding-${c[0]}: ${_*h}px;padding-${c[1]}: ${_*f}px;margin-${c[0]}: ${_*d}px;margin-${c[1]}: ${_*m}px;border-${c[0]}-width: ${_*p}px;border-${c[1]}-width: ${_*g}px;`}}const Hy="";function Ws(t){let e,n,i;return{c(){e=b("div"),e.innerHTML='<div class="loader svelte-vizlcg"></div>',v(e,"class","bkg-shade svelte-vizlcg")},m(r,s){z(r,e,s),i=!0},i(r){i||(Ht(()=>{i&&(n||(n=yn(e,Kn,{duration:150},!0)),n.run(1))}),i=!0)},o(r){n||(n=yn(e,Kn,{duration:150},!1)),n.run(0),i=!1},d(r){r&&$(e),r&&n&&n.end()}}}function Mu(t){let e,n,i=t[0]&&Ws();return{c(){i&&i.c(),e=Ct()},m(r,s){i&&i.m(r,s),z(r,e,s),n=!0},p(r,[s]){r[0]?i?s&1&&V(i,1):(i=Ws(),i.c(),V(i,1),i.m(e.parentNode,e)):i&&(et(),W(i,1,1,()=>{i=null}),tt())},i(r){n||(V(i),n=!0)},o(r){W(i),n=!1},d(r){i&&i.d(r),r&&$(e)}}}function Au(t,e,n){let i;return Me(t,oi,r=>n(0,i=r)),[i]}class Tu extends Ve{constructor(e){super(),He(this,e,Au,Mu,je,{})}}const Nu=t=>({}),Ys=t=>({});function Pu(t){let e,n,i,r,s,o,l,a,c,u,h,f,d,m,p,g,_,S,C,w,k;const T=t[1].content,N=Bt(T,t,t[0],Ys);return{c(){e=b("button"),n=F(),i=b("div"),r=b("div"),s=F(),o=b("div"),l=b("div"),l.innerHTML=`<div class="title is-4 mb-0 media-content"><span id="modal-title" class="mb-0"></span></div>
            <button class="delete media-left" aria-label="close"></button>`,a=F(),c=b("section"),u=b("div"),h=F(),f=b("div"),N&&N.c(),d=F(),m=b("footer"),p=b("div"),g=b("button"),g.textContent=`${q==="en"?"Abort":"Retour"}`,_=F(),S=b("button"),S.textContent="OK",v(e,"id","hidden-msg-btn"),v(e,"data-target","msg-modal"),e.hidden=!0,v(r,"id","modal-bkg"),v(r,"class","modal-background"),v(l,"class","modal-card-head media mb-0"),v(u,"id","modal-msg"),v(f,"class","py-3"),v(c,"id","modal-body"),v(c,"class","modal-card-body"),v(g,"id","cancel-btn"),v(g,"class","button is-link is-light button-close"),v(S,"id","ok-btn"),v(S,"class","button is-link button-close"),v(p,"class","buttons"),v(m,"id","modal-footer"),v(m,"class","modal-card-foot is-center pt-3"),m.hidden=!0,v(o,"class","modal-content"),v(i,"id","msg-modal"),v(i,"class","modal fade"),v(i,"tabindex","-1"),v(i,"aria-labelledby","selection-modal-label"),v(i,"aria-hidden","true")},m(E,M){z(E,e,M),z(E,n,M),z(E,i,M),y(i,r),y(i,s),y(i,o),y(o,l),y(o,a),y(o,c),y(c,u),y(c,h),y(c,f),N&&N.m(f,null),y(o,d),y(o,m),y(m,p),y(p,g),y(p,_),y(p,S),C=!0,w||(k=[ii(qs.call(null,e)),ii(Dr.call(null,i))],w=!0)},p(E,[M]){N&&N.p&&(!C||M&1)&&Kt(N,T,E,E[0],C?qt(T,E[0],M,Nu):Wt(E[0]),Ys)},i(E){C||(V(N,E),C=!0)},o(E){W(N,E),C=!1},d(E){E&&$(e),E&&$(n),E&&$(i),N&&N.d(E),w=!1,vt(k)}}}function Ou(t,e,n){let{$$slots:i={},$$scope:r}=e;return t.$$set=s=>{"$$scope"in s&&n(0,r=s.$$scope)},[r,i]}class Lu extends Ve{constructor(e){super(),He(this,e,Ou,Pu,je,{})}}const Vy="",Du=t=>({activeTab:t&8}),Gs=t=>({activeTab:t[3]});function Xs(t,e,n){const i=t.slice();return i[11]=e[n][0],i[12]=e[n][1],i}const Ru=t=>({activeTab:t&8}),Js=t=>({activeTab:t[3]}),$u=t=>({}),Qs=t=>({});function zu(t){let e,n,i=Object.entries(t[2]),r=[];for(let s=0;s<i.length;s+=1)r[s]=Zs(Xs(t,i,s));return{c(){e=b("div"),n=b("ul");for(let s=0;s<r.length;s+=1)r[s].c();v(e,"class","tabs")},m(s,o){z(s,e,o),y(e,n);for(let l=0;l<r.length;l+=1)r[l]&&r[l].m(n,null)},p(s,o){if(o&28){i=Object.entries(s[2]);let l;for(l=0;l<i.length;l+=1){const a=Xs(s,i,l);r[l]?r[l].p(a,o):(r[l]=Zs(a),r[l].c(),r[l].m(n,null))}for(;l<r.length;l+=1)r[l].d(1);r.length=i.length}},i:ie,o:ie,d(s){s&&$(e),St(r,s)}}}function ju(t){let e;const n=t[8].tabs,i=Bt(n,t,t[7],Js);return{c(){i&&i.c()},m(r,s){i&&i.m(r,s),e=!0},p(r,s){i&&i.p&&(!e||s&136)&&Kt(i,n,r,r[7],e?qt(n,r[7],s,Ru):Wt(r[7]),Js)},i(r){e||(V(i,r),e=!0)},o(r){W(i,r),e=!1},d(r){i&&i.d(r)}}}function Zs(t){let e,n,i=t[12]+"",r,s,o,l;function a(){return t[9](t[11])}return{c(){e=b("li"),n=b("a"),r=re(i),s=F(),v(n,"href",null),Ye(e,"is-active",t[3]===t[11])},m(c,u){z(c,e,u),y(e,n),y(n,r),y(e,s),o||(l=be(n,"click",a),o=!0)},p(c,u){t=c,u&4&&i!==(i=t[12]+"")&&Fe(r,i),u&12&&Ye(e,"is-active",t[3]===t[11])},d(c){c&&$(e),o=!1,l()}}}function Fu(t){let e,n,i,r,s,o,l,a,c,u,h,f,d;e=new Tu({});const m=t[8].sidebar,p=Bt(m,t,t[7],Qs),g=[ju,zu],_=[];function S(k,T){return T&4&&(a=null),k[5].tabs?0:(a==null&&(a=!!Object.keys(k[2]).length),a?1:-1)}~(c=S(t,-1))&&(u=_[c]=g[c](t));const C=t[8].content,w=Bt(C,t,t[7],Gs);return{c(){_e(e.$$.fragment),n=F(),i=b("div"),r=b("aside"),p&&p.c(),s=F(),o=b("main"),l=b("nav"),u&&u.c(),h=F(),f=b("div"),w&&w.c(),v(r,"class","sidebar svelte-jexg"),We(r,"width",t[0]+"%"),We(r,"min-height",t[1]),v(l,"id","tabs"),v(l,"class","tabs-bar svelte-jexg"),v(f,"class","content-area pl-5 svelte-jexg"),v(o,"class","main-content svelte-jexg"),We(o,"width",100-t[0]+"%"),We(o,"min-height",t[1]),v(i,"class","layout svelte-jexg"),We(i,"min-height",t[1])},m(k,T){me(e,k,T),z(k,n,T),z(k,i,T),y(i,r),p&&p.m(r,null),y(i,s),y(i,o),y(o,l),~c&&_[c].m(l,null),y(o,h),y(o,f),w&&w.m(f,null),d=!0},p(k,[T]){p&&p.p&&(!d||T&128)&&Kt(p,m,k,k[7],d?qt(m,k[7],T,$u):Wt(k[7]),Qs),(!d||T&1)&&We(r,"width",k[0]+"%");let N=c;c=S(k,T),c===N?~c&&_[c].p(k,T):(u&&(et(),W(_[N],1,1,()=>{_[N]=null}),tt()),~c?(u=_[c],u?u.p(k,T):(u=_[c]=g[c](k),u.c()),V(u,1),u.m(l,null)):u=null),w&&w.p&&(!d||T&136)&&Kt(w,C,k,k[7],d?qt(C,k[7],T,Du):Wt(k[7]),Gs),(!d||T&1)&&We(o,"width",100-k[0]+"%")},i(k){d||(V(e.$$.fragment,k),V(p,k),V(u),V(w,k),d=!0)},o(k){W(e.$$.fragment,k),W(p,k),W(u),W(w,k),d=!1},d(k){pe(e,k),k&&$(n),k&&$(i),p&&p.d(k),~c&&_[c].d(),w&&w.d(k)}}}function Hu(t=null){t||(t=document.getElementById("navbar")),document.documentElement.style.setProperty("--top-offset",`${t.offsetHeight}px`)}function Vu(t,e,n){let i,{$$slots:r={},$$scope:s}=e;const o=Kc(r);let{sidebarWidth:l="25"}=e;const a="90vh";let{tabList:c={}}=e,u=Object.keys(c),{topOffsetElement:h=null}=e;Hu(h);function f(m){if(!u.includes(m)){console.warn(`Tab "${m}" is not available.`);return}n(3,i=m);const p=new URL(window.location);p.searchParams.set("tab",m),window.history.pushState({},"",p)}const d=m=>f(m);return t.$$set=m=>{"sidebarWidth"in m&&n(0,l=m.sidebarWidth),"tabList"in m&&n(2,c=m.tabList),"topOffsetElement"in m&&n(6,h=m.topOffsetElement),"$$scope"in m&&n(7,s=m.$$scope)},n(3,i=new URLSearchParams(window.location.search).get("tab")??u[0]??null),[l,a,c,i,f,o,h,s,r,d]}class Uu extends Ve{constructor(e){super(),He(this,e,Vu,Fu,je,{sidebarWidth:0,layoutHeight:1,tabList:2,topOffsetElement:6})}get layoutHeight(){return this.$$.ctx[1]}}const zi={0:{title:q==="en"?"no categorization":"aucune catégorisation",svg:`<svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 59 59">
        <rect x="1" y="0.62" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>
    </svg>`},1:{title:q==="en"?"overall visual matches":"correspondances visuelles globales",svg:`<svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 68 69">
        <rect x="10" y="10.62" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>
        <rect x="1" y="1" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>
        <rect x="10" y="10.62" width="46" height="45.71" rx="4.11" ry="4.11" fill="currentColor" stroke="none"/>
    </svg>`},2:{title:q==="en"?"visual matches on part of the image":"correspondances visuelles sur une partie de l'image",svg:`<svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 70 71">
        <rect x="12" y="12.43" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>
        <rect x="1" y="0.81" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>
        <path d="M 12 21.43 L 21 12.43" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
        <path d="M 12 30 L 30 12.43" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
        <path d="M 40 56 L 57 38" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
        <path d="M 48.3 56.29 L 57 47" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
        <path d="M 12 39 L 39 12" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
        <path d="M 12 48 L 48 12" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
        <path d="M 13 56 L 57 12" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
        <path d="M 31 56 L 57 29" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
        <path d="M 21 57 L 57 21" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
    </svg>`},3:{title:q==="en"?"semantic and non-visual matches":"correspondances sémantiques et non-visuelle",svg:`<svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 72 73">
        <rect x="14" y="14.43" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3" stroke-dasharray="9 9"/>
        <rect x="1" y="0.81" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>
    </svg>`},4:{title:q==="en"?"regions without match":"régions sans correspondance",svg:`<svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 59 59">
        <rect x="1" y="0.62" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>
        <path d="M 2.67 54.55 L 55 2" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
        <path d="M 54.37 54.05 L 2.72 2.24" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
    </svg>`},5:{title:q==="en"?"user specific category":"correspondances spécifiques à l'utilisateur",svg:`<svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 59 59">
        <rect x="1" y="0.81" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>
        <path d="M 8.69 55.28 C 9.25 44.15 18.08 35.28 28.86 35.28 C 32.5 35.28 36.07 36.3 39.18 38.25 C 44.96 41.85 48.66 48.3 49.02 55.28 Z M 17.85 21.48 C 17.85 15.37 22.79 10.39 28.86 10.39 C 34.92 10.39 39.86 15.37 39.86 21.48 C 39.86 27.59 34.92 32.56 28.86 32.56 C 22.79 32.56 17.85 27.59 17.85 21.48 Z M 40.37 36.34 C 38.43 35.13 36.32 34.25 34.13 33.7 C 38.82 31.64 42.1 26.94 42.1 21.48 C 42.1 14.13 36.16 8.15 28.86 8.15 C 21.55 8.15 15.61 14.13 15.61 21.48 C 15.61 26.95 18.9 31.66 23.6 33.71 C 13.76 36.18 6.41 45.4 6.41 56.4 C 6.41 57.02 6.92 57.52 7.54 57.52 L 50.17 57.52 C 50.79 57.52 51.3 57.02 51.3 56.4 C 51.3 48.23 47.11 40.54 40.37 36.34 Z" fill="currentColor" stroke="none"/>
    </svg>`}};function Bu(t){let e,n=zi[t[2]].svg+"",i,r,s,o;return{c(){e=b("span"),v(e,"class",i="tag py-4 "+t[4]+" "+(t[0]?"is-hoverable":"")),v(e,"title",r=zi[t[2]].title),Ye(e,"is-selected",t[1])},m(l,a){z(l,e,a),e.innerHTML=n,s||(o=[be(e,"click",t[5]),be(e,"keyup",null)],s=!0)},p(l,[a]){a&4&&n!==(n=zi[l[2]].svg+"")&&(e.innerHTML=n),a&17&&i!==(i="tag py-4 "+l[4]+" "+(l[0]?"is-hoverable":""))&&v(e,"class",i),a&4&&r!==(r=zi[l[2]].title)&&v(e,"title",r),a&19&&Ye(e,"is-selected",l[1])},i:ie,o:ie,d(l){l&&$(e),s=!1,vt(o)}}}function qu(t,e,n){let{selectable:i=!0}=e,{isSelected:r=!1}=e,{category:s}=e,{toggle:o=()=>{}}=e,{padding:l="px-2"}=e;const a=()=>o(s);return t.$$set=c=>{"selectable"in c&&n(0,i=c.selectable),"isSelected"in c&&n(1,r=c.isSelected),"category"in c&&n(2,s=c.category),"toggle"in c&&n(3,o=c.toggle),"padding"in c&&n(4,l=c.padding)},[i,r,s,o,l,a]}class Wn extends Ve{constructor(e){super(),He(this,e,qu,Bu,je,{selectable:0,isSelected:1,category:2,toggle:3,padding:4})}}const tb="";function eo(t){let e,n,i=t[3].title+"",r,s;return{c(){e=b("span"),n=b("a"),r=re(i),v(n,"href",s=`${Hs}/${Xt}/witness/${t[3].witnessId}/regions/${t[1]}`),v(n,"target","_blank"),v(e,"class","legend-label svelte-w1sf17")},m(o,l){z(o,e,l),y(e,n),y(n,r)},p(o,l){l&8&&i!==(i=o[3].title+"")&&Fe(r,i),l&10&&s!==(s=`${Hs}/${Xt}/witness/${o[3].witnessId}/regions/${o[1]}`)&&v(n,"href",s)},d(o){o&&$(e)}}}function Ku(t){let e,n,i,r,s,o,l,a,c,u=!t[5]&&eo(t);return{c(){e=b("div"),n=b("span"),i=F(),r=b("span"),l=F(),u&&u.c(),v(n,"class","legend-nb svelte-w1sf17"),v(r,"class","legend-color svelte-w1sf17"),v(r,"aria-label",s=t[3].title),v(r,"title",o=t[3].title),We(r,"background-color",t[0]?t[3].color:"#999"),v(r,"role","button"),v(r,"tabindex","0"),Ye(r,"inactive",!t[0]),Ye(r,"clickable",t[4]),v(e,"class","legend-item svelte-w1sf17"),Ye(e,"inactive",!t[0])},m(h,f){z(h,e,f),y(e,n),y(e,i),y(e,r),y(e,l),u&&u.m(e,null),a||(c=[be(r,"click",function(){Dn(t[2])&&t[2].apply(this,arguments)}),be(r,"keydown",null)],a=!0)},p(h,[f]){t=h,f&8&&s!==(s=t[3].title)&&v(r,"aria-label",s),f&8&&o!==(o=t[3].title)&&v(r,"title",o),f&9&&We(r,"background-color",t[0]?t[3].color:"#999"),f&1&&Ye(r,"inactive",!t[0]),f&16&&Ye(r,"clickable",t[4]),t[5]?u&&(u.d(1),u=null):u?u.p(t,f):(u=eo(t),u.c(),u.m(e,null)),f&1&&Ye(e,"inactive",!t[0])},i:ie,o:ie,d(h){h&&$(e),u&&u.d(),a=!1,vt(c)}}}function Wu(t,e,n){let{isActive:i=!0}=e,{id:r}=e,{toggle:s=()=>{}}=e,{meta:o={title:"Region",color:"#999",witnessId:1}}=e,{clickable:l=!0}=e,{onlyColor:a=!1}=e;return t.$$set=c=>{"isActive"in c&&n(0,i=c.isActive),"id"in c&&n(1,r=c.id),"toggle"in c&&n(2,s=c.toggle),"meta"in c&&n(3,o=c.meta),"clickable"in c&&n(4,l=c.clickable),"onlyColor"in c&&n(5,a=c.onlyColor)},[i,r,s,o,l,a]}class to extends Ve{constructor(e){super(),He(this,e,Wu,Ku,je,{isActive:0,id:1,toggle:2,meta:3,clickable:4,onlyColor:5})}}const nb="";function no(t,e,n){const i=t.slice();return i[12]=e[n][0],i[13]=e[n][1],i}function Yu(t){let e;return{c(){e=b("span"),e.innerHTML='<i class="fas fa-chevron-down"></i>',v(e,"class","icon is-small")},m(n,i){z(n,e,i)},d(n){n&&$(e)}}}function Gu(t){let e;return{c(){e=b("span"),e.innerHTML='<i class="fas fa-chevron-up"></i>',v(e,"class","icon is-small")},m(n,i){z(n,e,i)},d(n){n&&$(e)}}}function io(t){let e,n;function i(){return t[10](t[12])}return e=new to({props:{id:t[12],meta:t[13],isActive:t[0].has(parseInt(t[12])),toggle:i,onlyColor:!t[4]}}),{c(){_e(e.$$.fragment)},m(r,s){me(e,r,s),n=!0},p(r,s){t=r;const o={};s&32&&(o.id=t[12]),s&32&&(o.meta=t[13]),s&33&&(o.isActive=t[0].has(parseInt(t[12]))),s&34&&(o.toggle=i),s&16&&(o.onlyColor=!t[4]),e.$set(o)},i(r){n||(V(e.$$.fragment,r),n=!0)},o(r){W(e.$$.fragment,r),n=!1},d(r){pe(e,r)}}}function Xu(t){let e,n,i,r,s,o,l,a,c,u,h,f,d,m,p,g,_,S,C,w,k,T,N,E,M,O,L;function j(U,K){return U[4]?Gu:Yu}let R=j(t),x=R(t),H=t[5],P=[];for(let U=0;U<H.length;U+=1)P[U]=io(no(t,H,U));const X=U=>W(P[U],1,1,()=>{P[U]=null});return{c(){e=b("div"),n=b("div"),i=b("div"),r=b("div"),s=b("h3"),s.textContent=`${q==="en"?"Visible documents":"Documents visibles"}`,o=F(),l=b("div"),a=b("div"),c=b("p"),u=b("span"),h=b("select"),f=b("option"),f.textContent="ID",d=b("option"),d.textContent=`${Ri.Witness}`,m=b("option"),m.textContent=`${q==="en"?"Title":"Titre"}`,p=F(),g=b("p"),_=b("button"),_.innerHTML='<span class="icon is-small has-text-link pl-2"><i class="fas fa-check"></i></span>',S=F(),C=b("div"),w=b("button"),x.c(),N=F(),E=b("div");for(let U=0;U<P.length;U+=1)P[U].c();v(s,"class","title mb-0"),v(r,"class","level-item"),v(i,"class","level-left"),f.__value="id",f.value=f.__value,d.__value="witnessId",d.value=d.__value,m.__value="title",m.value=m.__value,t[3]===void 0&&Ht(()=>t[7].call(h)),v(u,"class","select is-small"),v(c,"class","control mb-0"),v(c,"title",q==="en"?"Sort documents by":"Trier les documents par"),v(_,"class","button is-small is-shadowless"),v(g,"class","control"),v(g,"title",q==="en"?"Select all documents":"Sélectionner tous les documents"),v(a,"class","level-item mb-0 field has-addons is-small"),v(w,"class","button is-small is-ghost"),v(w,"aria-label",k=t[4]?"Minify legend":"Expand legend"),v(C,"class","level-item"),v(C,"title",T=t[4]?"Minify legend":"Expand legend"),v(l,"class","level-right"),v(n,"class","level is-mobile mb-3"),v(E,"class","svelte-13ym7ov"),Ye(E,"is-condensed",!t[4]),Ye(E,"is-expanded",t[4])},m(U,K){z(U,e,K),y(e,n),y(n,i),y(i,r),y(r,s),y(n,o),y(n,l),y(l,a),y(a,c),y(c,u),y(u,h),y(h,f),y(h,d),y(h,m),_n(h,t[3],!0),y(a,p),y(a,g),y(g,_),y(l,S),y(l,C),y(C,w),x.m(w,null),y(e,N),y(e,E);for(let Z=0;Z<P.length;Z+=1)P[Z]&&P[Z].m(E,null);M=!0,O||(L=[be(h,"change",t[7]),be(_,"click",t[8]),be(w,"click",t[9])],O=!0)},p(U,[K]){if(K&8&&_n(h,U[3]),R!==(R=j(U))&&(x.d(1),x=R(U),x&&(x.c(),x.m(w,null))),(!M||K&16&&k!==(k=U[4]?"Minify legend":"Expand legend"))&&v(w,"aria-label",k),(!M||K&16&&T!==(T=U[4]?"Minify legend":"Expand legend"))&&v(C,"title",T),K&51){H=U[5];let Z;for(Z=0;Z<H.length;Z+=1){const ae=no(U,H,Z);P[Z]?(P[Z].p(ae,K),V(P[Z],1)):(P[Z]=io(ae),P[Z].c(),V(P[Z],1),P[Z].m(E,null))}for(et(),Z=H.length;Z<P.length;Z+=1)X(Z);tt()}(!M||K&16)&&Ye(E,"is-condensed",!U[4]),(!M||K&16)&&Ye(E,"is-expanded",U[4])},i(U){if(!M){for(let K=0;K<H.length;K+=1)V(P[K]);M=!0}},o(U){P=P.filter(Boolean);for(let K=0;K<P.length;K+=1)W(P[K]);M=!1},d(U){U&&$(e),x.d(),St(P,U),O=!1,vt(L)}}}function Ju(t,e,n){let i,{documentNodes:r}=e,{selectedRegions:s}=e,{toggleRegion:o}=e,{selectAllRegions:l}=e,a=!0,c="id";const u={id:(p,g)=>p[0]-g[0],witnessId:(p,g)=>(p[1].witnessId||0)-(g[1].witnessId||0),title:(p,g)=>(p[1].title||"").localeCompare(g[1].title||"")};function h(){c=Ai(this),n(3,c)}const f=()=>l(),d=()=>n(4,a=!a),m=p=>o(parseInt(p));return t.$$set=p=>{"documentNodes"in p&&n(6,r=p.documentNodes),"selectedRegions"in p&&n(0,s=p.selectedRegions),"toggleRegion"in p&&n(1,o=p.toggleRegion),"selectAllRegions"in p&&n(2,l=p.selectAllRegions)},t.$$.update=()=>{t.$$.dirty&72&&n(5,i=Array.from(r||new Map).sort(u[c]))},[s,o,l,c,a,i,r,h,f,d,m]}class Qu extends Ve{constructor(e){super(),He(this,e,Ju,Xu,je,{documentNodes:6,selectedRegions:0,toggleRegion:1,selectAllRegions:2})}}var wn;(function(t){t.Range="range",t.Steps="steps",t.Positions="positions",t.Count="count",t.Values="values"})(wn||(wn={}));var Nt;(function(t){t[t.None=-1]="None",t[t.NoValue=0]="NoValue",t[t.LargeValue=1]="LargeValue",t[t.SmallValue=2]="SmallValue"})(Nt||(Nt={}));function Zu(t){return ji(t)&&typeof t.from=="function"}function ji(t){return typeof t=="object"&&typeof t.to=="function"}function ro(t){t.parentElement.removeChild(t)}function Rr(t){return t!=null}function so(t){t.preventDefault()}function ef(t){return t.filter(function(e){return this[e]?!1:this[e]=!0},{})}function tf(t,e){return Math.round(t/e)*e}function nf(t,e){var n=t.getBoundingClientRect(),i=t.ownerDocument,r=i.documentElement,s=ao(i);return/webkit.*Chrome.*Mobile/i.test(navigator.userAgent)&&(s.x=0),e?n.top+s.y-r.clientTop:n.left+s.x-r.clientLeft}function Jt(t){return typeof t=="number"&&!isNaN(t)&&isFinite(t)}function oo(t,e,n){n>0&&(It(t,e),setTimeout(function(){Hi(t,e)},n))}function lo(t){return Math.max(Math.min(t,100),0)}function Fi(t){return Array.isArray(t)?t:[t]}function rf(t){t=String(t);var e=t.split(".");return e.length>1?e[1].length:0}function It(t,e){t.classList&&!/\s/.test(e)?t.classList.add(e):t.className+=" "+e}function Hi(t,e){t.classList&&!/\s/.test(e)?t.classList.remove(e):t.className=t.className.replace(new RegExp("(^|\\b)"+e.split(" ").join("|")+"(\\b|$)","gi")," ")}function sf(t,e){return t.classList?t.classList.contains(e):new RegExp("\\b"+e+"\\b").test(t.className)}function ao(t){var e=window.pageXOffset!==void 0,n=(t.compatMode||"")==="CSS1Compat",i=e?window.pageXOffset:n?t.documentElement.scrollLeft:t.body.scrollLeft,r=e?window.pageYOffset:n?t.documentElement.scrollTop:t.body.scrollTop;return{x:i,y:r}}function of(){return window.navigator.pointerEnabled?{start:"pointerdown",move:"pointermove",end:"pointerup"}:window.navigator.msPointerEnabled?{start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:{start:"mousedown touchstart",move:"mousemove touchmove",end:"mouseup touchend"}}function lf(){var t=!1;try{var e=Object.defineProperty({},"passive",{get:function(){t=!0}});window.addEventListener("test",null,e)}catch{}return t}function af(){return window.CSS&&CSS.supports&&CSS.supports("touch-action","none")}function $r(t,e){return 100/(e-t)}function zr(t,e,n){return e*100/(t[n+1]-t[n])}function cf(t,e){return zr(t,t[0]<0?e+Math.abs(t[0]):e-t[0],0)}function uf(t,e){return e*(t[1]-t[0])/100+t[0]}function li(t,e){for(var n=1;t>=e[n];)n+=1;return n}function ff(t,e,n){if(n>=t.slice(-1)[0])return 100;var i=li(n,t),r=t[i-1],s=t[i],o=e[i-1],l=e[i];return o+cf([r,s],n)/$r(o,l)}function df(t,e,n){if(n>=100)return t.slice(-1)[0];var i=li(n,e),r=t[i-1],s=t[i],o=e[i-1],l=e[i];return uf([r,s],(n-o)*$r(o,l))}function hf(t,e,n,i){if(i===100)return i;var r=li(i,t),s=t[r-1],o=t[r];return n?i-s>(o-s)/2?o:s:e[r-1]?t[r-1]+tf(i-t[r-1],e[r-1]):i}var co=function(){function t(e,n,i){this.xPct=[],this.xVal=[],this.xSteps=[],this.xNumSteps=[],this.xHighestCompleteStep=[],this.xSteps=[i||!1],this.xNumSteps=[!1],this.snap=n;var r,s=[];for(Object.keys(e).forEach(function(o){s.push([Fi(e[o]),o])}),s.sort(function(o,l){return o[0][0]-l[0][0]}),r=0;r<s.length;r++)this.handleEntryPoint(s[r][1],s[r][0]);for(this.xNumSteps=this.xSteps.slice(0),r=0;r<this.xNumSteps.length;r++)this.handleStepPoint(r,this.xNumSteps[r])}return t.prototype.getDistance=function(e){for(var n=[],i=0;i<this.xNumSteps.length-1;i++)n[i]=zr(this.xVal,e,i);return n},t.prototype.getAbsoluteDistance=function(e,n,i){var r=0;if(e<this.xPct[this.xPct.length-1])for(;e>this.xPct[r+1];)r++;else e===this.xPct[this.xPct.length-1]&&(r=this.xPct.length-2);!i&&e===this.xPct[r+1]&&r++,n===null&&(n=[]);var s,o=1,l=n[r],a=0,c=0,u=0,h=0;for(i?s=(e-this.xPct[r])/(this.xPct[r+1]-this.xPct[r]):s=(this.xPct[r+1]-e)/(this.xPct[r+1]-this.xPct[r]);l>0;)a=this.xPct[r+1+h]-this.xPct[r+h],n[r+h]*o+100-s*100>100?(c=a*s,o=(l-100*s)/n[r+h],s=1):(c=n[r+h]*a/100*o,o=0),i?(u=u-c,this.xPct.length+h>=1&&h--):(u=u+c,this.xPct.length-h>=1&&h++),l=n[r+h]*o;return e+u},t.prototype.toStepping=function(e){return e=ff(this.xVal,this.xPct,e),e},t.prototype.fromStepping=function(e){return df(this.xVal,this.xPct,e)},t.prototype.getStep=function(e){return e=hf(this.xPct,this.xSteps,this.snap,e),e},t.prototype.getDefaultStep=function(e,n,i){var r=li(e,this.xPct);return(e===100||n&&e===this.xPct[r-1])&&(r=Math.max(r-1,1)),(this.xVal[r]-this.xVal[r-1])/i},t.prototype.getNearbySteps=function(e){var n=li(e,this.xPct);return{stepBefore:{startValue:this.xVal[n-2],step:this.xNumSteps[n-2],highestStep:this.xHighestCompleteStep[n-2]},thisStep:{startValue:this.xVal[n-1],step:this.xNumSteps[n-1],highestStep:this.xHighestCompleteStep[n-1]},stepAfter:{startValue:this.xVal[n],step:this.xNumSteps[n],highestStep:this.xHighestCompleteStep[n]}}},t.prototype.countStepDecimals=function(){var e=this.xNumSteps.map(rf);return Math.max.apply(null,e)},t.prototype.hasNoSize=function(){return this.xVal[0]===this.xVal[this.xVal.length-1]},t.prototype.convert=function(e){return this.getStep(this.toStepping(e))},t.prototype.handleEntryPoint=function(e,n){var i;if(e==="min"?i=0:e==="max"?i=100:i=parseFloat(e),!Jt(i)||!Jt(n[0]))throw new Error("noUiSlider: 'range' value isn't numeric.");this.xPct.push(i),this.xVal.push(n[0]);var r=Number(n[1]);i?this.xSteps.push(isNaN(r)?!1:r):isNaN(r)||(this.xSteps[0]=r),this.xHighestCompleteStep.push(0)},t.prototype.handleStepPoint=function(e,n){if(n){if(this.xVal[e]===this.xVal[e+1]){this.xSteps[e]=this.xHighestCompleteStep[e]=this.xVal[e];return}this.xSteps[e]=zr([this.xVal[e],this.xVal[e+1]],n,0)/$r(this.xPct[e],this.xPct[e+1]);var i=(this.xVal[e+1]-this.xVal[e])/this.xNumSteps[e],r=Math.ceil(Number(i.toFixed(3))-1),s=this.xVal[e]+this.xNumSteps[e]*r;this.xHighestCompleteStep[e]=s}},t}(),uo={to:function(t){return t===void 0?"":t.toFixed(2)},from:Number},fo={target:"target",base:"base",origin:"origin",handle:"handle",handleLower:"handle-lower",handleUpper:"handle-upper",touchArea:"touch-area",horizontal:"horizontal",vertical:"vertical",background:"background",connect:"connect",connects:"connects",ltr:"ltr",rtl:"rtl",textDirectionLtr:"txt-dir-ltr",textDirectionRtl:"txt-dir-rtl",draggable:"draggable",drag:"state-drag",tap:"state-tap",active:"active",tooltip:"tooltip",pips:"pips",pipsHorizontal:"pips-horizontal",pipsVertical:"pips-vertical",marker:"marker",markerHorizontal:"marker-horizontal",markerVertical:"marker-vertical",markerNormal:"marker-normal",markerLarge:"marker-large",markerSub:"marker-sub",value:"value",valueHorizontal:"value-horizontal",valueVertical:"value-vertical",valueNormal:"value-normal",valueLarge:"value-large",valueSub:"value-sub"},Sn={tooltips:".__tooltips",aria:".__aria"};function mf(t,e){if(!Jt(e))throw new Error("noUiSlider: 'step' is not numeric.");t.singleStep=e}function pf(t,e){if(!Jt(e))throw new Error("noUiSlider: 'keyboardPageMultiplier' is not numeric.");t.keyboardPageMultiplier=e}function gf(t,e){if(!Jt(e))throw new Error("noUiSlider: 'keyboardMultiplier' is not numeric.");t.keyboardMultiplier=e}function _f(t,e){if(!Jt(e))throw new Error("noUiSlider: 'keyboardDefaultStep' is not numeric.");t.keyboardDefaultStep=e}function vf(t,e){if(typeof e!="object"||Array.isArray(e))throw new Error("noUiSlider: 'range' is not an object.");if(e.min===void 0||e.max===void 0)throw new Error("noUiSlider: Missing 'min' or 'max' in 'range'.");t.spectrum=new co(e,t.snap||!1,t.singleStep)}function yf(t,e){if(e=Fi(e),!Array.isArray(e)||!e.length)throw new Error("noUiSlider: 'start' option is incorrect.");t.handles=e.length,t.start=e}function bf(t,e){if(typeof e!="boolean")throw new Error("noUiSlider: 'snap' option must be a boolean.");t.snap=e}function wf(t,e){if(typeof e!="boolean")throw new Error("noUiSlider: 'animate' option must be a boolean.");t.animate=e}function Sf(t,e){if(typeof e!="number")throw new Error("noUiSlider: 'animationDuration' option must be a number.");t.animationDuration=e}function ho(t,e){var n=[!1],i;if(e==="lower"?e=[!0,!1]:e==="upper"&&(e=[!1,!0]),e===!0||e===!1){for(i=1;i<t.handles;i++)n.push(e);n.push(!1)}else{if(!Array.isArray(e)||!e.length||e.length!==t.handles+1)throw new Error("noUiSlider: 'connect' option doesn't match handle count.");n=e}t.connect=n}function kf(t,e){switch(e){case"horizontal":t.ort=0;break;case"vertical":t.ort=1;break;default:throw new Error("noUiSlider: 'orientation' option is invalid.")}}function mo(t,e){if(!Jt(e))throw new Error("noUiSlider: 'margin' option must be numeric.");e!==0&&(t.margin=t.spectrum.getDistance(e))}function Ef(t,e){if(!Jt(e))throw new Error("noUiSlider: 'limit' option must be numeric.");if(t.limit=t.spectrum.getDistance(e),!t.limit||t.handles<2)throw new Error("noUiSlider: 'limit' option is only supported on linear sliders with 2 or more handles.")}function Cf(t,e){var n;if(!Jt(e)&&!Array.isArray(e))throw new Error("noUiSlider: 'padding' option must be numeric or array of exactly 2 numbers.");if(Array.isArray(e)&&!(e.length===2||Jt(e[0])||Jt(e[1])))throw new Error("noUiSlider: 'padding' option must be numeric or array of exactly 2 numbers.");if(e!==0){for(Array.isArray(e)||(e=[e,e]),t.padding=[t.spectrum.getDistance(e[0]),t.spectrum.getDistance(e[1])],n=0;n<t.spectrum.xNumSteps.length-1;n++)if(t.padding[0][n]<0||t.padding[1][n]<0)throw new Error("noUiSlider: 'padding' option must be a positive number(s).");var i=e[0]+e[1],r=t.spectrum.xVal[0],s=t.spectrum.xVal[t.spectrum.xVal.length-1];if(i/(s-r)>1)throw new Error("noUiSlider: 'padding' option must not exceed 100% of the range.")}}function If(t,e){switch(e){case"ltr":t.dir=0;break;case"rtl":t.dir=1;break;default:throw new Error("noUiSlider: 'direction' option was not recognized.")}}function xf(t,e){if(typeof e!="string")throw new Error("noUiSlider: 'behaviour' must be a string containing options.");var n=e.indexOf("tap")>=0,i=e.indexOf("drag")>=0,r=e.indexOf("fixed")>=0,s=e.indexOf("snap")>=0,o=e.indexOf("hover")>=0,l=e.indexOf("unconstrained")>=0,a=e.indexOf("invert-connects")>=0,c=e.indexOf("drag-all")>=0,u=e.indexOf("smooth-steps")>=0;if(r){if(t.handles!==2)throw new Error("noUiSlider: 'fixed' behaviour must be used with 2 handles");mo(t,t.start[1]-t.start[0])}if(a&&t.handles!==2)throw new Error("noUiSlider: 'invert-connects' behaviour must be used with 2 handles");if(l&&(t.margin||t.limit))throw new Error("noUiSlider: 'unconstrained' behaviour cannot be used with margin or limit");t.events={tap:n||s,drag:i,dragAll:c,smoothSteps:u,fixed:r,snap:s,hover:o,unconstrained:l,invertConnects:a}}function Mf(t,e){if(e!==!1)if(e===!0||ji(e)){t.tooltips=[];for(var n=0;n<t.handles;n++)t.tooltips.push(e)}else{if(e=Fi(e),e.length!==t.handles)throw new Error("noUiSlider: must pass a formatter for all handles.");e.forEach(function(i){if(typeof i!="boolean"&&!ji(i))throw new Error("noUiSlider: 'tooltips' must be passed a formatter or 'false'.")}),t.tooltips=e}}function Af(t,e){if(e.length!==t.handles)throw new Error("noUiSlider: must pass a attributes for all handles.");t.handleAttributes=e}function Tf(t,e){if(!ji(e))throw new Error("noUiSlider: 'ariaFormat' requires 'to' method.");t.ariaFormat=e}function Nf(t,e){if(!Zu(e))throw new Error("noUiSlider: 'format' requires 'to' and 'from' methods.");t.format=e}function Pf(t,e){if(typeof e!="boolean")throw new Error("noUiSlider: 'keyboardSupport' option must be a boolean.");t.keyboardSupport=e}function Of(t,e){t.documentElement=e}function Lf(t,e){if(typeof e!="string"&&e!==!1)throw new Error("noUiSlider: 'cssPrefix' must be a string or `false`.");t.cssPrefix=e}function Df(t,e){if(typeof e!="object")throw new Error("noUiSlider: 'cssClasses' must be an object.");typeof t.cssPrefix=="string"?(t.cssClasses={},Object.keys(e).forEach(function(n){t.cssClasses[n]=t.cssPrefix+e[n]})):t.cssClasses=e}function po(t){var e={margin:null,limit:null,padding:null,animate:!0,animationDuration:300,ariaFormat:uo,format:uo},n={step:{r:!1,t:mf},keyboardPageMultiplier:{r:!1,t:pf},keyboardMultiplier:{r:!1,t:gf},keyboardDefaultStep:{r:!1,t:_f},start:{r:!0,t:yf},connect:{r:!0,t:ho},direction:{r:!0,t:If},snap:{r:!1,t:bf},animate:{r:!1,t:wf},animationDuration:{r:!1,t:Sf},range:{r:!0,t:vf},orientation:{r:!1,t:kf},margin:{r:!1,t:mo},limit:{r:!1,t:Ef},padding:{r:!1,t:Cf},behaviour:{r:!0,t:xf},ariaFormat:{r:!1,t:Tf},format:{r:!1,t:Nf},tooltips:{r:!1,t:Mf},keyboardSupport:{r:!0,t:Pf},documentElement:{r:!1,t:Of},cssPrefix:{r:!0,t:Lf},cssClasses:{r:!0,t:Df},handleAttributes:{r:!1,t:Af}},i={connect:!1,direction:"ltr",behaviour:"tap",orientation:"horizontal",keyboardSupport:!0,cssPrefix:"noUi-",cssClasses:fo,keyboardPageMultiplier:5,keyboardMultiplier:1,keyboardDefaultStep:10};t.format&&!t.ariaFormat&&(t.ariaFormat=t.format),Object.keys(n).forEach(function(a){if(!Rr(t[a])&&i[a]===void 0){if(n[a].r)throw new Error("noUiSlider: '"+a+"' is required.");return}n[a].t(e,Rr(t[a])?t[a]:i[a])}),e.pips=t.pips;var r=document.createElement("div"),s=r.style.msTransform!==void 0,o=r.style.transform!==void 0;e.transformRule=o?"transform":s?"msTransform":"webkitTransform";var l=[["left","top"],["right","bottom"]];return e.style=l[e.dir][e.ort],e}function Rf(t,e,n){var i=of(),r=af(),s=r&&lf(),o=t,l,a,c,u,h,f,d=e.spectrum,m=[],p=[],g=[],_=0,S={},C=!1,w=t.ownerDocument,k=e.documentElement||w.documentElement,T=w.body,N=w.dir==="rtl"||e.ort===1?0:100;function E(I,A){var D=w.createElement("div");return A&&It(D,A),I.appendChild(D),D}function M(I,A){var D=E(I,e.cssClasses.origin),J=E(D,e.cssClasses.handle);if(E(J,e.cssClasses.touchArea),J.setAttribute("data-handle",String(A)),e.keyboardSupport&&(J.setAttribute("tabindex","0"),J.addEventListener("keydown",function(ne){return Re(ne,A)})),e.handleAttributes!==void 0){var ee=e.handleAttributes[A];Object.keys(ee).forEach(function(ne){J.setAttribute(ne,ee[ne])})}return J.setAttribute("role","slider"),J.setAttribute("aria-orientation",e.ort?"vertical":"horizontal"),A===0?It(J,e.cssClasses.handleLower):A===e.handles-1&&It(J,e.cssClasses.handleUpper),D.handle=J,D}function O(I,A){return A?E(I,e.cssClasses.connect):!1}function L(I,A){a=E(A,e.cssClasses.connects),c=[],u=[],u.push(O(a,I[0]));for(var D=0;D<e.handles;D++)c.push(M(A,D)),g[D]=D,u.push(O(a,I[D+1]))}function j(I){It(I,e.cssClasses.target),e.dir===0?It(I,e.cssClasses.ltr):It(I,e.cssClasses.rtl),e.ort===0?It(I,e.cssClasses.horizontal):It(I,e.cssClasses.vertical);var A=getComputedStyle(I).direction;return A==="rtl"?It(I,e.cssClasses.textDirectionRtl):It(I,e.cssClasses.textDirectionLtr),E(I,e.cssClasses.base)}function R(I,A){return!e.tooltips||!e.tooltips[A]?!1:E(I.firstChild,e.cssClasses.tooltip)}function x(){return o.hasAttribute("disabled")}function H(I){var A=c[I];return A.hasAttribute("disabled")}function P(I){I!=null?(c[I].setAttribute("disabled",""),c[I].handle.removeAttribute("tabindex")):(o.setAttribute("disabled",""),c.forEach(function(A){A.handle.removeAttribute("tabindex")}))}function X(I){I!=null?(c[I].removeAttribute("disabled"),c[I].handle.setAttribute("tabindex","0")):(o.removeAttribute("disabled"),c.forEach(function(A){A.removeAttribute("disabled"),A.handle.setAttribute("tabindex","0")}))}function U(){f&&(ot("update"+Sn.tooltips),f.forEach(function(I){I&&ro(I)}),f=null)}function K(){U(),f=c.map(R),ft("update"+Sn.tooltips,function(I,A,D){if(!(!f||!e.tooltips)&&f[A]!==!1){var J=I[A];e.tooltips[A]!==!0&&(J=e.tooltips[A].to(D[A])),f[A].innerHTML=J}})}function Z(){ot("update"+Sn.aria),ft("update"+Sn.aria,function(I,A,D,J,ee){g.forEach(function(ne){var ge=c[ne],le=Mt(p,ne,0,!0,!0,!0),nt=Mt(p,ne,100,!0,!0,!0),it=ee[ne],lt=String(e.ariaFormat.to(D[ne]));le=d.fromStepping(le).toFixed(1),nt=d.fromStepping(nt).toFixed(1),it=d.fromStepping(it).toFixed(1),ge.children[0].setAttribute("aria-valuemin",le),ge.children[0].setAttribute("aria-valuemax",nt),ge.children[0].setAttribute("aria-valuenow",it),ge.children[0].setAttribute("aria-valuetext",lt)})})}function ae(I){if(I.mode===wn.Range||I.mode===wn.Steps)return d.xVal;if(I.mode===wn.Count){if(I.values<2)throw new Error("noUiSlider: 'values' (>= 2) required for mode 'count'.");for(var A=I.values-1,D=100/A,J=[];A--;)J[A]=A*D;return J.push(100),ce(J,I.stepped)}return I.mode===wn.Positions?ce(I.values,I.stepped):I.mode===wn.Values?I.stepped?I.values.map(function(ee){return d.fromStepping(d.getStep(d.toStepping(ee)))}):I.values:[]}function ce(I,A){return I.map(function(D){return d.fromStepping(A?d.getStep(D):D)})}function de(I){function A(it,lt){return Number((it+lt).toFixed(7))}var D=ae(I),J={},ee=d.xVal[0],ne=d.xVal[d.xVal.length-1],ge=!1,le=!1,nt=0;return D=ef(D.slice().sort(function(it,lt){return it-lt})),D[0]!==ee&&(D.unshift(ee),ge=!0),D[D.length-1]!==ne&&(D.push(ne),le=!0),D.forEach(function(it,lt){var at,ye,Ze,ue=it,Ie=D[lt+1],xe,zt,jt,gn,In,Ln,Vc,Uc=I.mode===wn.Steps;for(Uc&&(at=d.xNumSteps[lt]),at||(at=Ie-ue),Ie===void 0&&(Ie=ue),at=Math.max(at,1e-7),ye=ue;ye<=Ie;ye=A(ye,at)){for(xe=d.toStepping(ye),zt=xe-nt,In=zt/(I.density||1),Ln=Math.round(In),Vc=zt/Ln,Ze=1;Ze<=Ln;Ze+=1)jt=nt+Ze*Vc,J[jt.toFixed(5)]=[d.fromStepping(jt),0];gn=D.indexOf(ye)>-1?Nt.LargeValue:Uc?Nt.SmallValue:Nt.NoValue,!lt&&ge&&ye!==Ie&&(gn=0),ye===Ie&&le||(J[xe.toFixed(5)]=[ye,gn]),nt=xe}}),J}function fe(I,A,D){var J,ee,ne=w.createElement("div"),ge=(J={},J[Nt.None]="",J[Nt.NoValue]=e.cssClasses.valueNormal,J[Nt.LargeValue]=e.cssClasses.valueLarge,J[Nt.SmallValue]=e.cssClasses.valueSub,J),le=(ee={},ee[Nt.None]="",ee[Nt.NoValue]=e.cssClasses.markerNormal,ee[Nt.LargeValue]=e.cssClasses.markerLarge,ee[Nt.SmallValue]=e.cssClasses.markerSub,ee),nt=[e.cssClasses.valueHorizontal,e.cssClasses.valueVertical],it=[e.cssClasses.markerHorizontal,e.cssClasses.markerVertical];It(ne,e.cssClasses.pips),It(ne,e.ort===0?e.cssClasses.pipsHorizontal:e.cssClasses.pipsVertical);function lt(ye,Ze){var ue=Ze===e.cssClasses.value,Ie=ue?nt:it,xe=ue?ge:le;return Ze+" "+Ie[e.ort]+" "+xe[ye]}function at(ye,Ze,ue){if(ue=A?A(Ze,ue):ue,ue!==Nt.None){var Ie=E(ne,!1);Ie.className=lt(ue,e.cssClasses.marker),Ie.style[e.style]=ye+"%",ue>Nt.NoValue&&(Ie=E(ne,!1),Ie.className=lt(ue,e.cssClasses.value),Ie.setAttribute("data-value",String(Ze)),Ie.style[e.style]=ye+"%",Ie.innerHTML=String(D.to(Ze)))}}return Object.keys(I).forEach(function(ye){at(ye,I[ye][0],I[ye][1])}),ne}function De(){h&&(ro(h),h=null)}function Ke(I){De();var A=de(I),D=I.filter,J=I.format||{to:function(ee){return String(Math.round(ee))}};return h=o.appendChild(fe(A,D,J)),h}function he(){var I=l.getBoundingClientRect(),A="offset"+["Width","Height"][e.ort];return e.ort===0?I.width||l[A]:I.height||l[A]}function Y(I,A,D,J){var ee=function(ge){var le=te(ge,J.pageOffset,J.target||A);if(!le||x()&&!J.doNotReject||sf(o,e.cssClasses.tap)&&!J.doNotReject||I===i.start&&le.buttons!==void 0&&le.buttons>1||J.hover&&le.buttons)return!1;s||le.preventDefault(),le.calcPoint=le.points[e.ort],D(le,J)},ne=[];return I.split(" ").forEach(function(ge){A.addEventListener(ge,ee,s?{passive:!0}:!1),ne.push([ge,ee])}),ne}function te(I,A,D){var J=I.type.indexOf("touch")===0,ee=I.type.indexOf("mouse")===0,ne=I.type.indexOf("pointer")===0,ge=0,le=0;if(I.type.indexOf("MSPointer")===0&&(ne=!0),I.type==="mousedown"&&!I.buttons&&!I.touches)return!1;if(J){var nt=function(at){var ye=at.target;return ye===D||D.contains(ye)||I.composed&&I.composedPath().shift()===D};if(I.type==="touchstart"){var it=Array.prototype.filter.call(I.touches,nt);if(it.length>1)return!1;ge=it[0].pageX,le=it[0].pageY}else{var lt=Array.prototype.find.call(I.changedTouches,nt);if(!lt)return!1;ge=lt.pageX,le=lt.pageY}}return A=A||ao(w),(ee||ne)&&(ge=I.clientX+A.x,le=I.clientY+A.y),I.pageOffset=A,I.points=[ge,le],I.cursor=ee||ne,I}function se(I){var A=I-nf(l,e.ort),D=A*100/he();return D=lo(D),e.dir?100-D:D}function Q(I){var A=100,D=!1;return c.forEach(function(J,ee){if(!H(ee)){var ne=p[ee],ge=Math.abs(ne-I),le=ge===100&&A===100,nt=ge<A,it=ge<=A&&I>ne;(nt||it||le)&&(D=ee,A=ge)}}),D}function oe(I,A){I.type==="mouseout"&&I.target.nodeName==="HTML"&&I.relatedTarget===null&&Ge(I,A)}function Ee(I,A){if(navigator.appVersion.indexOf("MSIE 9")===-1&&I.buttons===0&&A.buttonsProperty!==0)return Ge(I,A);var D=(e.dir?-1:1)*(I.calcPoint-A.startCalcPoint),J=D*100/A.baseSize;pt(D>0,J,A.locations,A.handleNumbers,A.connect)}function Ge(I,A){A.handle&&(Hi(A.handle,e.cssClasses.active),_-=1),A.listeners.forEach(function(D){k.removeEventListener(D[0],D[1])}),_===0&&(Hi(o,e.cssClasses.drag),dt(),I.cursor&&(T.style.cursor="",T.removeEventListener("selectstart",so))),e.events.smoothSteps&&(A.handleNumbers.forEach(function(D){bt(D,p[D],!0,!0,!1,!1)}),A.handleNumbers.forEach(function(D){$e("update",D)})),A.handleNumbers.forEach(function(D){$e("change",D),$e("set",D),$e("end",D)})}function Je(I,A){if(!A.handleNumbers.some(H)){var D;if(A.handleNumbers.length===1){var J=c[A.handleNumbers[0]];D=J.children[0],_+=1,It(D,e.cssClasses.active)}I.stopPropagation();var ee=[],ne=Y(i.move,k,Ee,{target:I.target,handle:D,connect:A.connect,listeners:ee,startCalcPoint:I.calcPoint,baseSize:he(),pageOffset:I.pageOffset,handleNumbers:A.handleNumbers,buttonsProperty:I.buttons,locations:p.slice()}),ge=Y(i.end,k,Ge,{target:I.target,handle:D,listeners:ee,doNotReject:!0,handleNumbers:A.handleNumbers}),le=Y("mouseout",k,oe,{target:I.target,handle:D,listeners:ee,doNotReject:!0,handleNumbers:A.handleNumbers});ee.push.apply(ee,ne.concat(ge,le)),I.cursor&&(T.style.cursor=getComputedStyle(I.target).cursor,c.length>1&&It(o,e.cssClasses.drag),T.addEventListener("selectstart",so,!1)),A.handleNumbers.forEach(function(nt){$e("start",nt)})}}function Ce(I){I.stopPropagation();var A=se(I.calcPoint),D=Q(A);D!==!1&&(e.events.snap||oo(o,e.cssClasses.tap,e.animationDuration),bt(D,A,!0,!0),dt(),$e("slide",D,!0),$e("update",D,!0),e.events.snap?Je(I,{handleNumbers:[D]}):($e("change",D,!0),$e("set",D,!0)))}function Oe(I){var A=se(I.calcPoint),D=d.getStep(A),J=d.fromStepping(D);Object.keys(S).forEach(function(ee){ee.split(".")[0]==="hover"&&S[ee].forEach(function(ne){ne.call(ct,J)})})}function Re(I,A){if(x()||H(A))return!1;var D=["Left","Right"],J=["Down","Up"],ee=["PageDown","PageUp"],ne=["Home","End"];e.dir&&!e.ort?D.reverse():e.ort&&!e.dir&&(J.reverse(),ee.reverse());var ge=I.key.replace("Arrow",""),le=ge===ee[0],nt=ge===ee[1],it=ge===J[0]||ge===D[0]||le,lt=ge===J[1]||ge===D[1]||nt,at=ge===ne[0],ye=ge===ne[1];if(!it&&!lt&&!at&&!ye)return!0;I.preventDefault();var Ze;if(lt||it){var ue=it?0:1,Ie=Ne(A),xe=Ie[ue];if(xe===null)return!1;xe===!1&&(xe=d.getDefaultStep(p[A],it,e.keyboardDefaultStep)),nt||le?xe*=e.keyboardPageMultiplier:xe*=e.keyboardMultiplier,xe=Math.max(xe,1e-7),xe=(it?-1:1)*xe,Ze=m[A]+xe}else ye?Ze=e.spectrum.xVal[e.spectrum.xVal.length-1]:Ze=e.spectrum.xVal[0];return bt(A,d.toStepping(Ze),!0,!0),$e("slide",A),$e("update",A),$e("change",A),$e("set",A),!1}function Qe(I){I.fixed||c.forEach(function(A,D){Y(i.start,A.children[0],Je,{handleNumbers:[D]})}),I.tap&&Y(i.start,l,Ce,{}),I.hover&&Y(i.move,l,Oe,{hover:!0}),I.drag&&u.forEach(function(A,D){if(!(A===!1||D===0||D===u.length-1)){var J=c[D-1],ee=c[D],ne=[A],ge=[J,ee],le=[D-1,D];It(A,e.cssClasses.draggable),I.fixed&&(ne.push(J.children[0]),ne.push(ee.children[0])),I.dragAll&&(ge=c,le=g),ne.forEach(function(nt){Y(i.start,nt,Je,{handles:ge,handleNumbers:le,connect:A})})}})}function ft(I,A){S[I]=S[I]||[],S[I].push(A),I.split(".")[0]==="update"&&c.forEach(function(D,J){$e("update",J)})}function kt(I){return I===Sn.aria||I===Sn.tooltips}function ot(I){var A=I&&I.split(".")[0],D=A?I.substring(A.length):I;Object.keys(S).forEach(function(J){var ee=J.split(".")[0],ne=J.substring(ee.length);(!A||A===ee)&&(!D||D===ne)&&(!kt(ne)||D===ne)&&delete S[J]})}function $e(I,A,D){Object.keys(S).forEach(function(J){var ee=J.split(".")[0];I===ee&&S[J].forEach(function(ne){ne.call(ct,m.map(e.format.to),A,m.slice(),D||!1,p.slice(),ct)})})}function Mt(I,A,D,J,ee,ne,ge){var le;return c.length>1&&!e.events.unconstrained&&(J&&A>0&&(le=d.getAbsoluteDistance(I[A-1],e.margin,!1),D=Math.max(D,le)),ee&&A<c.length-1&&(le=d.getAbsoluteDistance(I[A+1],e.margin,!0),D=Math.min(D,le))),c.length>1&&e.limit&&(J&&A>0&&(le=d.getAbsoluteDistance(I[A-1],e.limit,!1),D=Math.min(D,le)),ee&&A<c.length-1&&(le=d.getAbsoluteDistance(I[A+1],e.limit,!0),D=Math.max(D,le))),e.padding&&(A===0&&(le=d.getAbsoluteDistance(0,e.padding[0],!1),D=Math.max(D,le)),A===c.length-1&&(le=d.getAbsoluteDistance(100,e.padding[1],!0),D=Math.min(D,le))),ge||(D=d.getStep(D)),D=lo(D),D===I[A]&&!ne?!1:D}function Ue(I,A){var D=e.ort;return(D?A:I)+", "+(D?I:A)}function pt(I,A,D,J,ee){var ne=D.slice(),ge=J[0],le=e.events.smoothSteps,nt=[!I,I],it=[I,!I];J=J.slice(),I&&J.reverse(),J.length>1?J.forEach(function(at,ye){var Ze=Mt(ne,at,ne[at]+A,nt[ye],it[ye],!1,le);Ze===!1?A=0:(A=Ze-ne[at],ne[at]=Ze)}):nt=it=[!0];var lt=!1;J.forEach(function(at,ye){lt=bt(at,D[at]+A,nt[ye],it[ye],!1,le)||lt}),lt&&(J.forEach(function(at){$e("update",at),$e("slide",at)}),ee!=null&&$e("drag",ge))}function Be(I,A){return e.dir?100-I-A:I}function gt(I,A){p[I]=A,m[I]=d.fromStepping(A);var D=Be(A,0)-N,J="translate("+Ue(D+"%","0")+")";if(c[I].style[e.transformRule]=J,e.events.invertConnects&&p.length>1){var ee=p.every(function(ne,ge,le){return ge===0||ne>=le[ge-1]});if(C!==!ee){Se();return}}B(I),B(I+1),C&&(B(I-1),B(I+2))}function dt(){g.forEach(function(I){var A=p[I]>50?-1:1,D=3+(c.length+A*I);c[I].style.zIndex=String(D)})}function bt(I,A,D,J,ee,ne){return ee||(A=Mt(p,I,A,D,J,!1,ne)),A===!1?!1:(gt(I,A),!0)}function B(I){if(u[I]){var A=p.slice();C&&A.sort(function(le,nt){return le-nt});var D=0,J=100;I!==0&&(D=A[I-1]),I!==u.length-1&&(J=A[I]);var ee=J-D,ne="translate("+Ue(Be(D,ee)+"%","0")+")",ge="scale("+Ue(ee/100,"1")+")";u[I].style[e.transformRule]=ne+" "+ge}}function we(I,A){return I===null||I===!1||I===void 0||(typeof I=="number"&&(I=String(I)),I=e.format.from(I),I!==!1&&(I=d.toStepping(I)),I===!1||isNaN(I))?p[A]:I}function Xe(I,A,D){var J=Fi(I),ee=p[0]===void 0;A=A===void 0?!0:A,e.animate&&!ee&&oo(o,e.cssClasses.tap,e.animationDuration),g.forEach(function(le){bt(le,we(J[le],le),!0,!1,D)});var ne=g.length===1?0:1;if(ee&&d.hasNoSize()&&(D=!0,p[0]=0,g.length>1)){var ge=100/(g.length-1);g.forEach(function(le){p[le]=le*ge})}for(;ne<g.length;++ne)g.forEach(function(le){bt(le,p[le],!0,!0,D)});dt(),g.forEach(function(le){$e("update",le),J[le]!==null&&A&&$e("set",le)})}function qe(I){Xe(e.start,I)}function rt(I,A,D,J){if(I=Number(I),!(I>=0&&I<g.length))throw new Error("noUiSlider: invalid handle number, got: "+I);bt(I,we(A,I),!0,!0,J),$e("update",I),D&&$e("set",I)}function Te(I){if(I===void 0&&(I=!1),I)return m.length===1?m[0]:m.slice(0);var A=m.map(e.format.to);return A.length===1?A[0]:A}function ht(){for(ot(Sn.aria),ot(Sn.tooltips),Object.keys(e.cssClasses).forEach(function(I){Hi(o,e.cssClasses[I])});o.firstChild;)o.removeChild(o.firstChild);delete o.noUiSlider}function Ne(I){var A=p[I],D=d.getNearbySteps(A),J=m[I],ee=D.thisStep.step,ne=null;if(e.snap)return[J-D.stepBefore.startValue||null,D.stepAfter.startValue-J||null];ee!==!1&&J+ee>D.stepAfter.startValue&&(ee=D.stepAfter.startValue-J),J>D.thisStep.startValue?ne=D.thisStep.step:D.stepBefore.step===!1?ne=!1:ne=J-D.stepBefore.highestStep,A===100?ee=null:A===0&&(ne=null);var ge=d.countStepDecimals();return ee!==null&&ee!==!1&&(ee=Number(ee.toFixed(ge))),ne!==null&&ne!==!1&&(ne=Number(ne.toFixed(ge))),[ne,ee]}function ze(){return g.map(Ne)}function ke(I,A){var D=Te(),J=["margin","limit","padding","range","animate","snap","step","format","pips","tooltips","connect"];J.forEach(function(ne){I[ne]!==void 0&&(n[ne]=I[ne])});var ee=po(n);J.forEach(function(ne){I[ne]!==void 0&&(e[ne]=ee[ne])}),d=ee.spectrum,e.margin=ee.margin,e.limit=ee.limit,e.padding=ee.padding,e.pips?Ke(e.pips):De(),e.tooltips?K():U(),p=[],Xe(Rr(I.start)?I.start:D,A),I.connect&&G()}function G(){for(;a.firstChild;)a.removeChild(a.firstChild);for(var I=0;I<=e.handles;I++)u[I]=O(a,e.connect[I]),B(I);Qe({drag:e.events.drag,fixed:!0})}function Se(){C=!C,ho(e,e.connect.map(function(I){return!I})),G()}function ve(){l=j(o),L(e.connect,l),Qe(e.events),Xe(e.start),e.pips&&Ke(e.pips),e.tooltips&&K(),Z()}ve();var ct={destroy:ht,steps:ze,on:ft,off:ot,get:Te,set:Xe,setHandle:rt,reset:qe,disable:P,enable:X,__moveHandles:function(I,A,D){pt(I,A,p,D)},options:n,updateOptions:ke,target:o,removePips:De,removeTooltips:U,getPositions:function(){return p.slice()},getTooltips:function(){return f},getOrigins:function(){return c},pips:Ke};return ct}function $f(t,e){if(!t||!t.nodeName)throw new Error("noUiSlider: create requires a single element, got: "+t);if(t.noUiSlider)throw new Error("noUiSlider: Slider was already initialized.");var n=po(e),i=Rf(t,n,e);return t.noUiSlider=i,i}const zf={__spectrum:co,cssClasses:fo,create:$f},ib="",rb="";function jf(t){let e,n,i;return{c(){e=b("span"),n=re(t[0]),v(e,"id",t[3]),v(e,"class",i="tooltip "+t[2]+" "+(t[1]?"display":"")+" svelte-1am23me")},m(r,s){z(r,e,s),y(e,n)},p(r,[s]){s&1&&Fe(n,r[0]),s&6&&i!==(i="tooltip "+r[2]+" "+(r[1]?"display":"")+" svelte-1am23me")&&v(e,"class",i)},i:ie,o:ie,d(r){r&&$(e)}}}function Ff(t,e,n){let i,r,s,o,{tooltipText:l}=e,{targetHtmlId:a}=e;const c=`tooltip-generic-${window.crypto.randomUUID()}`,u=()=>n(1,o=!0),h=()=>n(1,o=!1),f=()=>n(1,o=!o);return zn(()=>{s=a?document.getElementById(a):document.getElementById(c).parentElement,a&&!s&&(console.error(`TooltipGeneric: element with ID ${a} not found, defaulting to the parent element`),s=document.getElementById(c).targetElement),s.addEventListener("mouseover",u),s.addEventListener("mouseout",h),s.addEventListener("click",f)}),jn(()=>{s.removeEventListener("mouseover",u),s.removeEventListener("mouseout",h),s.removeEventListener("click",f)}),t.$$set=d=>{"tooltipText"in d&&n(0,l=d.tooltipText),"targetHtmlId"in d&&n(4,a=d.targetHtmlId)},t.$$.update=()=>{t.$$.dirty&33&&n(2,i=r(l))},n(5,r=d=>n(2,i=d.length>100?"tooltip-wide":d.length>20?"tooltip-mid":"tooltip-thin")),s=void 0,n(1,o=!1),[l,o,i,c,a,r]}class Vi extends Ve{constructor(e){super(),He(this,e,Ff,jf,je,{tooltipText:0,targetHtmlId:4})}}const sb="";function Hf(t){let e,n,i,r,s,o,l,a,c,u,h,f,d,m,p,g;return{c(){e=b("div"),n=b("span"),i=re(t[2]),r=re(" ("),s=re(t[3]),o=re(")"),l=F(),a=b("div"),c=b("span"),u=re(t[0]),h=F(),f=b("div"),d=b("div"),m=F(),p=b("span"),g=re(t[1]),v(c,"class","range-marker svelte-216mtn"),v(d,"class","slider"),v(d,"id",t[4]),v(f,"class","slider-wrapper svelte-216mtn"),v(p,"class","range-marker svelte-216mtn"),v(a,"class","slider-outer-wrapper is-flex flex-direction-row svelte-216mtn")},m(_,S){z(_,e,S),y(e,n),y(n,i),y(n,r),y(n,s),y(n,o),y(e,l),y(e,a),y(a,c),y(c,u),y(a,h),y(a,f),y(f,d),y(a,m),y(a,p),y(p,g)},p(_,[S]){S&4&&Fe(i,_[2]),S&8&&Fe(s,_[3]),S&1&&Fe(u,_[0]),S&2&&Fe(g,_[1])},i:ie,o:ie,d(_){_&&$(e)}}}function Vf(t,e,n){let i,{minVal:r}=e,{maxVal:s}=e,{start:o}=e,{step:l=void 0}=e,{roundTo:a=2}=e,{title:c=""}=e,{emitOnUpdate:u=!1}=e;const h=Oi(),f=`slider-${window.crypto.randomUUID()}`,d=Array.isArray(o)&&o.length===2&&o.every(E=>!isNaN(parseFloat(E))),m=[],p=d?[`noUi-handle-${window.crypto.randomUUID()}`,`noUi-handle-${window.crypto.randomUUID()}`]:[`noUi-handle-${window.crypto.randomUUID()}`],g=$i();g.setCompareFn(d?Lr:(E,M)=>S(E)===S(M)),g.set(o);const _=Ft("resetTrigger")||void 0;_==null||_.subscribe(k);const S=E=>Number(E.toFixed(a)),C=(E,M)=>{E=Array.isArray(E)?E.map(S):S(E),n(3,i=E),(M==="set"||M==="update"&&u)&&(g.set(E),g.same()||h("updateSlider",g.get()))};function w(E){m.length&&m.map((M,O)=>M.$set({tooltipText:d?E[O]:E}))}function k(){const E=document.getElementById(f);E!=null&&E.noUiSlider&&E.noUiSlider.reset()}function T(){const E=document.getElementById(f);let M;zf.create(E,{start:o,step:l,connect:d?!0:"lower",range:{min:r,max:s},handleAttributes:p.map(O=>({id:O}))}),E.noUiSlider.on("update",()=>{M=E.noUiSlider.get(!0),C(M,"update")}),E.noUiSlider.on("set",()=>{M=E.noUiSlider.get(!0),C(M,"set")})}function N(){p.map((E,M)=>{m.push(new Vi({target:document.getElementById(E),props:d?{tooltipText:i[M]}:{tooltipText:i}}))})}return zn(()=>{T(),N()}),jn(()=>{document.getElementById(f)&&(document.getElementById(f).innerHTML="")}),t.$$set=E=>{"minVal"in E&&n(0,r=E.minVal),"maxVal"in E&&n(1,s=E.maxVal),"start"in E&&n(5,o=E.start),"step"in E&&n(6,l=E.step),"roundTo"in E&&n(7,a=E.roundTo),"title"in E&&n(2,c=E.title),"emitOnUpdate"in E&&n(8,u=E.emitOnUpdate)},t.$$.update=()=>{t.$$.dirty&32&&n(3,i=o),t.$$.dirty&8&&w(i)},[r,s,c,i,f,o,l,a,u]}class xn extends Ve{constructor(e){super(),He(this,e,Vf,Hf,je,{minVal:0,maxVal:1,start:5,step:6,roundTo:7,title:2,emitOnUpdate:8})}}const Uf=t=>({}),go=t=>({});function _o(t,e,n){const i=t.slice();return i[44]=e[n],i}function vo(t,e,n){const i=t.slice();return i[47]=e[n],i}function yo(t,e,n){const i=t.slice();return i[44]=e[n],i}function bo(t,e,n){const i=t.slice();i[52]=e[n];const r=Object.keys(i[28][i[52]]||{});return i[53]=r,i}function wo(t){var ke;let e,n,i,r=((ke=t[0])==null?void 0:ke.title)+"",s,o,l,a,c,u,h,f,d,m=(t[3].pairs||0)+"",p,g,_,S,C,w,k,T=(t[3].images||0)+"",N,E,M,O,L,j,R,x=(t[4]||0)+"",H,P,X,U,K,Z,ae,ce,de,fe,De,Ke,he,Y,te,se,Q,oe,Ee,Ge,Je,Ce,Oe,Re,Qe,ft,kt,ot,$e,Mt,Ue,pt=["Series","Witness","Work"],Be=[];for(let G=0;G<3;G+=1)Be[G]=So(bo(t,pt,G));K=new Qu({props:{documentNodes:t[5],selectedRegions:t[6],toggleRegion:t[18],selectAllRegions:t[17]}});let gt=["all","filtered"],dt=[];for(let G=0;G<2;G+=1)dt[G]=ko(yo(t,gt,G));let bt=t[29],B=[];for(let G=0;G<bt.length;G+=1)B[G]=Eo(vo(t,bt,G));const we=G=>W(B[G],1,1,()=>{B[G]=null});let Xe=["threshold","topk"],qe=[];for(let G=0;G<2;G+=1)qe[G]=Co(_o(t,Xe,G));const rt=[Kf,qf],Te=[];function ht(G,Se){return G[7]==="threshold"?0:1}Oe=ht(t),Re=Te[Oe]=rt[Oe](t);const Ne=t[35].datavizInfo,ze=Bt(Ne,t,t[34],go);return{c(){e=b("div"),n=b("div"),i=b("h1"),s=re(r),o=F(),l=b("div");for(let G=0;G<3;G+=1)Be[G].c();a=F(),c=b("div"),u=b("div"),h=b("p"),h.textContent=`${q==="en"?"Pairs":"Paires"}`,f=F(),d=b("p"),p=re(m),g=F(),_=b("div"),S=b("div"),C=b("p"),C.textContent="Images",w=F(),k=b("p"),N=re(T),E=F(),M=b("div"),O=b("div"),L=b("p"),L.textContent="Clusters",j=F(),R=b("p"),H=re(x),P=F(),X=b("hr"),U=F(),_e(K.$$.fragment),Z=F(),ae=b("hr"),ce=F(),de=b("div"),fe=b("h3"),fe.textContent=`${q==="en"?"Similarity categories":"Catégories de similarité"}`,De=F(),Ke=b("div");for(let G=0;G<2;G+=1)dt[G].c();he=F(),Y=b("div");for(let G=0;G<B.length;G+=1)B[G].c();te=F(),se=b("hr"),Q=F(),oe=b("div"),Ee=b("h3"),Ee.textContent=`${q==="en"?"Similarity score":"Score de similarité"}`,Ge=F(),Je=b("div");for(let G=0;G<2;G+=1)qe[G].c();Ce=F(),Re.c(),Qe=F(),ft=b("hr"),kt=F(),ot=b("div"),$e=b("h3"),$e.textContent=`${q==="en"?"Visualisation information":"Informations sur la visualisation"}`,Mt=F(),ze&&ze.c(),v(i,"class","title"),v(h,"class","heading"),v(d,"class","title is-5"),v(c,"class","level-item has-text-centered"),v(C,"class","heading"),v(k,"class","title is-5"),v(_,"class","level-item has-text-centered"),v(L,"class","heading"),v(R,"class","title is-5"),v(M,"class","level-item has-text-centered"),v(l,"class","level"),v(n,"class","pb-2"),v(fe,"class","title"),v(Ke,"class","buttons mb-3"),v(Y,"class","level"),Ye(Y,"is-disabled",t[1]==="all"),v(de,"class","pt-2"),v(Ee,"class","title"),v(Je,"class","buttons mb-3"),v(oe,"class","pt-2"),v($e,"class","title"),v(ot,"class","py-2"),v(e,"class","content is-small mt-4")},m(G,Se){z(G,e,Se),y(e,n),y(n,i),y(i,s),y(n,o),y(n,l);for(let ve=0;ve<3;ve+=1)Be[ve]&&Be[ve].m(l,null);y(l,a),y(l,c),y(c,u),y(u,h),y(u,f),y(u,d),y(d,p),y(l,g),y(l,_),y(_,S),y(S,C),y(S,w),y(S,k),y(k,N),y(l,E),y(l,M),y(M,O),y(O,L),y(O,j),y(O,R),y(R,H),y(e,P),y(e,X),y(e,U),me(K,e,null),y(e,Z),y(e,ae),y(e,ce),y(e,de),y(de,fe),y(de,De),y(de,Ke);for(let ve=0;ve<2;ve+=1)dt[ve]&&dt[ve].m(Ke,null);y(de,he),y(de,Y);for(let ve=0;ve<B.length;ve+=1)B[ve]&&B[ve].m(Y,null);y(e,te),y(e,se),y(e,Q),y(e,oe),y(oe,Ee),y(oe,Ge),y(oe,Je);for(let ve=0;ve<2;ve+=1)qe[ve]&&qe[ve].m(Je,null);y(oe,Ce),Te[Oe].m(oe,null),y(e,Qe),y(e,ft),y(e,kt),y(e,ot),y(ot,$e),y(ot,Mt),ze&&ze.m(ot,null),Ue=!0},p(G,Se){var I;if((!Ue||Se[0]&1)&&r!==(r=((I=G[0])==null?void 0:I.title)+"")&&Fe(s,r),Se[0]&268435456){pt=["Series","Witness","Work"];let A;for(A=0;A<3;A+=1){const D=bo(G,pt,A);Be[A]?Be[A].p(D,Se):(Be[A]=So(D),Be[A].c(),Be[A].m(l,a))}for(;A<3;A+=1)Be[A].d(1)}(!Ue||Se[0]&8)&&m!==(m=(G[3].pairs||0)+"")&&Fe(p,m),(!Ue||Se[0]&8)&&T!==(T=(G[3].images||0)+"")&&Fe(N,T),(!Ue||Se[0]&16)&&x!==(x=(G[4]||0)+"")&&Fe(H,x);const ve={};if(Se[0]&32&&(ve.documentNodes=G[5]),Se[0]&64&&(ve.selectedRegions=G[6]),K.$set(ve),Se[0]&1073741826){gt=["all","filtered"];let A;for(A=0;A<2;A+=1){const D=yo(G,gt,A);dt[A]?dt[A].p(D,Se):(dt[A]=ko(D),dt[A].c(),dt[A].m(Ke,null))}for(;A<2;A+=1)dt[A].d(1)}if(Se[0]&536903694){bt=G[29];let A;for(A=0;A<bt.length;A+=1){const D=vo(G,bt,A);B[A]?(B[A].p(D,Se),V(B[A],1)):(B[A]=Eo(D),B[A].c(),V(B[A],1),B[A].m(Y,null))}for(et(),A=bt.length;A<B.length;A+=1)we(A);tt()}if((!Ue||Se[0]&2)&&Ye(Y,"is-disabled",G[1]==="all"),Se[0]&128|Se[1]&1){Xe=["threshold","topk"];let A;for(A=0;A<2;A+=1){const D=_o(G,Xe,A);qe[A]?qe[A].p(D,Se):(qe[A]=Co(D),qe[A].c(),qe[A].m(Je,null))}for(;A<2;A+=1)qe[A].d(1)}let ct=Oe;Oe=ht(G),Oe===ct?Te[Oe].p(G,Se):(et(),W(Te[ct],1,1,()=>{Te[ct]=null}),tt(),Re=Te[Oe],Re?Re.p(G,Se):(Re=Te[Oe]=rt[Oe](G),Re.c()),V(Re,1),Re.m(oe,null)),ze&&ze.p&&(!Ue||Se[1]&8)&&Kt(ze,Ne,G,G[34],Ue?qt(Ne,G[34],Se,Uf):Wt(G[34]),go)},i(G){if(!Ue){V(K.$$.fragment,G);for(let Se=0;Se<bt.length;Se+=1)V(B[Se]);V(Re),V(ze,G),Ue=!0}},o(G){W(K.$$.fragment,G),B=B.filter(Boolean);for(let Se=0;Se<B.length;Se+=1)W(B[Se]);W(Re),W(ze,G),Ue=!1},d(G){G&&$(e),St(Be,G),pe(K),St(dt,G),St(B,G),St(qe,G),Te[Oe].d(),ze&&ze.d(G)}}}function Bf(t){let e,n,i,r=Ri[t[52]]+"",s,o,l,a=(t[53].length||0)+"",c;return{c(){e=b("div"),n=b("div"),i=b("p"),s=re(r),o=F(),l=b("p"),c=re(a),v(i,"class","heading"),v(l,"class","title is-5"),v(e,"class","level-item has-text-centered")},m(u,h){z(u,e,h),y(e,n),y(n,i),y(i,s),y(n,o),y(n,l),y(l,c)},p:ie,d(u){u&&$(e)}}}function So(t){let e,n=t[53].length>0&&Bf(t);return{c(){n&&n.c(),e=Ct()},m(i,r){n&&n.m(i,r),z(i,e,r)},p(i,r){i[53].length>0&&n.p(i,r)},d(i){n&&n.d(i),i&&$(e)}}}function ko(t){let e,n=t[44]==="all"?q==="en"?"All pairs":"Toutes les paires":q==="en"?"Filter by category":"Filtrer par catégorie",i,r,s,o;function l(){return t[36](t[44])}return{c(){e=b("button"),i=re(n),r=F(),v(e,"class","button is-small is-flex-grow-1"),Ye(e,"is-link",t[1]===t[44]),Ye(e,"is-contrasted",t[1]!==t[44])},m(a,c){z(a,e,c),y(e,i),y(e,r),s||(o=be(e,"click",l),s=!0)},p(a,c){t=a,c[0]&2&&Ye(e,"is-link",t[1]===t[44]),c[0]&2&&Ye(e,"is-contrasted",t[1]!==t[44])},d(a){a&&$(e),s=!1,o()}}}function Eo(t){let e,n,i,r,s,o=(t[3].categories[t[47]]||0)+"",l,a,c;return i=new Wn({props:{category:t[47],isSelected:t[2].includes(t[47]),toggle:t[37],selectable:t[1]==="filtered"}}),{c(){e=b("div"),n=b("div"),_e(i.$$.fragment),r=F(),s=b("p"),l=re(o),a=F(),v(s,"class","is-size-7 mt-1"),v(e,"class","level-item has-text-centered")},m(u,h){z(u,e,h),y(e,n),me(i,n,null),y(n,r),y(n,s),y(s,l),y(e,a),c=!0},p(u,h){const f={};h[0]&4&&(f.isSelected=u[2].includes(u[47])),h[0]&2&&(f.toggle=u[37]),h[0]&2&&(f.selectable=u[1]==="filtered"),i.$set(f),(!c||h[0]&8)&&o!==(o=(u[3].categories[u[47]]||0)+"")&&Fe(l,o)},i(u){c||(V(i.$$.fragment,u),c=!0)},o(u){W(i.$$.fragment,u),c=!1},d(u){u&&$(e),pe(i)}}}function Co(t){let e,n=t[44]==="threshold"?q==="en"?"Score threshold":"Seuil de score":q==="en"?"Top K pairs":"Top K paires",i,r,s,o;function l(){return t[38](t[44])}return{c(){e=b("button"),i=re(n),r=F(),v(e,"class","button is-small is-flex-grow-1"),Ye(e,"is-link",t[7]===t[44]),Ye(e,"is-contrasted",t[7]!==t[44])},m(a,c){z(a,e,c),y(e,i),y(e,r),s||(o=be(e,"click",l),s=!0)},p(a,c){t=a,c[0]&128&&Ye(e,"is-link",t[7]===t[44]),c[0]&128&&Ye(e,"is-contrasted",t[7]!==t[44])},d(a){a&&$(e),s=!1,o()}}}function qf(t){let e,n,i,r,s,o,l,a,c,u,h,f;return i=new xn({props:{minVal:1,maxVal:5,start:t[10]||3,step:1,roundTo:0,title:"K"}}),i.$on("updateSlider",t[40]),{c(){e=b("div"),n=b("div"),_e(i.$$.fragment),r=F(),s=b("div"),o=b("label"),l=b("input"),a=F(),c=b("span"),c.textContent=`${q==="en"?"Mutual top K":"Top K mutuel"}`,v(n,"class","column is-two-thirds pl-4"),l.checked=t[11],v(l,"type","checkbox"),v(l,"class","mr-2"),v(c,"class","is-size-7"),v(o,"class","checkbox mt-3 is-flex is-align-items-center"),v(s,"class","column mt-2"),v(e,"class","columns mt-2")},m(d,m){z(d,e,m),y(e,n),me(i,n,null),y(e,r),y(e,s),y(s,o),y(o,l),y(o,a),y(o,c),u=!0,h||(f=be(l,"change",t[41]),h=!0)},p(d,m){const p={};m[0]&1024&&(p.start=d[10]||3),i.$set(p),(!u||m[0]&2048)&&(l.checked=d[11])},i(d){u||(V(i.$$.fragment,d),u=!0)},o(d){W(i.$$.fragment,d),u=!1},d(d){d&&$(e),pe(i),h=!1,f()}}}function Kf(t){var i,r;let e,n;return e=new xn({props:{minVal:((i=t[8].scoreRange)==null?void 0:i.min)||0,maxVal:((r=t[8].scoreRange)==null?void 0:r.max)||1,start:t[9],step:.01,roundTo:2,title:q==="en"?"Minimum score":"Score minimum"}}),e.$on("updateSlider",t[39]),{c(){_e(e.$$.fragment)},m(s,o){me(e,s,o),n=!0},p(s,o){var a,c;const l={};o[0]&256&&(l.minVal=((a=s[8].scoreRange)==null?void 0:a.min)||0),o[0]&256&&(l.maxVal=((c=s[8].scoreRange)==null?void 0:c.max)||1),o[0]&512&&(l.start=s[9]),e.$set(l)},i(s){n||(V(e.$$.fragment,s),n=!0)},o(s){W(e.$$.fragment,s),n=!1},d(s){pe(e,s)}}}function Wf(t){let e,n,i=t[3]&&wo(t);return{c(){e=b("div"),i&&i.c(),v(e,"class","m-4 py-5 px-4")},m(r,s){z(r,e,s),i&&i.m(e,null),n=!0},p(r,s){r[3]?i?(i.p(r,s),s[0]&8&&V(i,1)):(i=wo(r),i.c(),V(i,1),i.m(e,null)):i&&(et(),W(i,1,1,()=>{i=null}),tt())},i(r){n||(V(i),n=!0)},o(r){W(i),n=!1},d(r){r&&$(e),i&&i.d()}}}function Yf(t,e,n){let i,r,s,o,l,a,c,u,h,f,{$$slots:d={},$$scope:m}=e,{docSet:p=null}=e,{documentSetStore:g}=e,{clusterStore:_}=e;const{docSetNumber:S,documentNodes:C,selectedCategories:w,toggleCategory:k,selectedRegions:T,selectAllRegions:N,toggleRegion:E,threshold:M,setThreshold:O,topK:L,setTopK:j,mutualTopK:R,setMutualTopK:x,scoreMode:H,setScoreMode:P,pairStats:X}=g;Me(t,S,Q=>n(3,r=Q)),Me(t,C,Q=>n(5,o=Q)),Me(t,w,Q=>n(2,i=Q)),Me(t,T,Q=>n(6,l=Q)),Me(t,M,Q=>n(9,u=Q)),Me(t,L,Q=>n(10,h=Q)),Me(t,R,Q=>n(11,f=Q)),Me(t,H,Q=>n(7,a=Q)),Me(t,X,Q=>n(8,c=Q));const{clusterNb:U,handlePageUpdate:K}=_;Me(t,U,Q=>n(4,s=Q));const Z=Ft("selectedDocuments"),ae=[0,1,2,3,5];let ce="filtered";function de(Q){n(1,ce=Q),Q==="all"&&i.length!==ae.length&&w.set(ae)}function fe(Q){K(1),P(Q)}const De=Q=>de(Q),Ke=Q=>ce==="filtered"?k(Q):null,he=Q=>fe(Q),Y=Q=>O(Q.detail),te=Q=>j(Q.detail),se=()=>x(!f);return t.$$set=Q=>{"docSet"in Q&&n(0,p=Q.docSet),"documentSetStore"in Q&&n(32,g=Q.documentSetStore),"clusterStore"in Q&&n(33,_=Q.clusterStore),"$$scope"in Q&&n(34,m=Q.$$scope)},[p,ce,i,r,s,o,l,a,c,u,h,f,S,C,w,k,T,N,E,M,O,L,j,R,x,H,X,U,Z,ae,de,fe,g,_,m,d,De,Ke,he,Y,te,se]}class Gf extends Ve{constructor(e){super(),He(this,e,Yf,Wf,je,{docSet:0,documentSetStore:32,clusterStore:33},null,[-1,-1])}}function Ui(t,e){return t==null||e==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function Xf(t,e){return t==null||e==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function Io(t){let e,n,i;t.length!==2?(e=Ui,n=(l,a)=>Ui(t(l),a),i=(l,a)=>t(l)-a):(e=t===Ui||t===Xf?t:Jf,n=t,i=t);function r(l,a,c=0,u=l.length){if(c<u){if(e(a,a)!==0)return u;do{const h=c+u>>>1;n(l[h],a)<0?c=h+1:u=h}while(c<u)}return c}function s(l,a,c=0,u=l.length){if(c<u){if(e(a,a)!==0)return u;do{const h=c+u>>>1;n(l[h],a)<=0?c=h+1:u=h}while(c<u)}return c}function o(l,a,c=0,u=l.length){const h=r(l,a,c,u-1);return h>c&&i(l[h-1],a)>-i(l[h],a)?h-1:h}return{left:r,center:o,right:s}}function Jf(){return 0}function Qf(t){return t===null?NaN:+t}const Zf=Io(Ui).right;Io(Qf).center;const ed=Zf;class xo extends Map{constructor(e,n=id){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:n}}),e!=null)for(const[i,r]of e)this.set(i,r)}get(e){return super.get(Mo(this,e))}has(e){return super.has(Mo(this,e))}set(e,n){return super.set(td(this,e),n)}delete(e){return super.delete(nd(this,e))}}function Mo({_intern:t,_key:e},n){const i=e(n);return t.has(i)?t.get(i):n}function td({_intern:t,_key:e},n){const i=e(n);return t.has(i)?t.get(i):(t.set(i,n),n)}function nd({_intern:t,_key:e},n){const i=e(n);return t.has(i)&&(n=t.get(i),t.delete(i)),n}function id(t){return t!==null&&typeof t=="object"?t.valueOf():t}const rd=Math.sqrt(50),sd=Math.sqrt(10),od=Math.sqrt(2);function Bi(t,e,n){const i=(e-t)/Math.max(0,n),r=Math.floor(Math.log10(i)),s=i/Math.pow(10,r),o=s>=rd?10:s>=sd?5:s>=od?2:1;let l,a,c;return r<0?(c=Math.pow(10,-r)/o,l=Math.round(t*c),a=Math.round(e*c),l/c<t&&++l,a/c>e&&--a,c=-c):(c=Math.pow(10,r)*o,l=Math.round(t/c),a=Math.round(e/c),l*c<t&&++l,a*c>e&&--a),a<l&&.5<=n&&n<2?Bi(t,e,n*2):[l,a,c]}function ld(t,e,n){if(e=+e,t=+t,n=+n,!(n>0))return[];if(t===e)return[t];const i=e<t,[r,s,o]=i?Bi(e,t,n):Bi(t,e,n);if(!(s>=r))return[];const l=s-r+1,a=new Array(l);if(i)if(o<0)for(let c=0;c<l;++c)a[c]=(s-c)/-o;else for(let c=0;c<l;++c)a[c]=(s-c)*o;else if(o<0)for(let c=0;c<l;++c)a[c]=(r+c)/-o;else for(let c=0;c<l;++c)a[c]=(r+c)*o;return a}function jr(t,e,n){return e=+e,t=+t,n=+n,Bi(t,e,n)[2]}function ad(t,e,n){e=+e,t=+t,n=+n;const i=e<t,r=i?jr(e,t,n):jr(t,e,n);return(i?-1:1)*(r<0?1/-r:r)}function qi(t,e,n){t=+t,e=+e,n=(r=arguments.length)<2?(e=t,t=0,1):r<3?1:+n;for(var i=-1,r=Math.max(0,Math.ceil((e-t)/n))|0,s=new Array(r);++i<r;)s[i]=t+i*n;return s}function cd(t){return t}var Ki=1,Fr=2,Ao=3,ai=4,To=1e-6;function ud(t){return"translate("+t+",0)"}function fd(t){return"translate(0,"+t+")"}function dd(t){return e=>+t(e)}function hd(t,e){return e=Math.max(0,t.bandwidth()-e*2)/2,t.round()&&(e=Math.round(e)),n=>+t(n)+e}function md(){return!this.__axis}function No(t,e){var n=[],i=null,r=null,s=6,o=6,l=3,a=typeof window<"u"&&window.devicePixelRatio>1?0:.5,c=t===Ki||t===ai?-1:1,u=t===ai||t===Fr?"x":"y",h=t===Ki||t===Ao?ud:fd;function f(d){var m=i??(e.ticks?e.ticks.apply(e,n):e.domain()),p=r??(e.tickFormat?e.tickFormat.apply(e,n):cd),g=Math.max(s,0)+l,_=e.range(),S=+_[0]+a,C=+_[_.length-1]+a,w=(e.bandwidth?hd:dd)(e.copy(),a),k=d.selection?d.selection():d,T=k.selectAll(".domain").data([null]),N=k.selectAll(".tick").data(m,e).order(),E=N.exit(),M=N.enter().append("g").attr("class","tick"),O=N.select("line"),L=N.select("text");T=T.merge(T.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),N=N.merge(M),O=O.merge(M.append("line").attr("stroke","currentColor").attr(u+"2",c*s)),L=L.merge(M.append("text").attr("fill","currentColor").attr(u,c*g).attr("dy",t===Ki?"0em":t===Ao?"0.71em":"0.32em")),d!==k&&(T=T.transition(d),N=N.transition(d),O=O.transition(d),L=L.transition(d),E=E.transition(d).attr("opacity",To).attr("transform",function(j){return isFinite(j=w(j))?h(j+a):this.getAttribute("transform")}),M.attr("opacity",To).attr("transform",function(j){var R=this.parentNode.__axis;return h((R&&isFinite(R=R(j))?R:w(j))+a)})),E.remove(),T.attr("d",t===ai||t===Fr?o?"M"+c*o+","+S+"H"+a+"V"+C+"H"+c*o:"M"+a+","+S+"V"+C:o?"M"+S+","+c*o+"V"+a+"H"+C+"V"+c*o:"M"+S+","+a+"H"+C),N.attr("opacity",1).attr("transform",function(j){return h(w(j)+a)}),O.attr(u+"2",c*s),L.attr(u,c*g).text(p),k.filter(md).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",t===Fr?"start":t===ai?"end":"middle"),k.each(function(){this.__axis=w})}return f.scale=function(d){return arguments.length?(e=d,f):e},f.ticks=function(){return n=Array.from(arguments),f},f.tickArguments=function(d){return arguments.length?(n=d==null?[]:Array.from(d),f):n.slice()},f.tickValues=function(d){return arguments.length?(i=d==null?null:Array.from(d),f):i&&i.slice()},f.tickFormat=function(d){return arguments.length?(r=d,f):r},f.tickSize=function(d){return arguments.length?(s=o=+d,f):s},f.tickSizeInner=function(d){return arguments.length?(s=+d,f):s},f.tickSizeOuter=function(d){return arguments.length?(o=+d,f):o},f.tickPadding=function(d){return arguments.length?(l=+d,f):l},f.offset=function(d){return arguments.length?(a=+d,f):a},f}function Po(t){return No(Ki,t)}function Oo(t){return No(ai,t)}var pd={value:()=>{}};function ci(){for(var t=0,e=arguments.length,n={},i;t<e;++t){if(!(i=arguments[t]+"")||i in n||/[\s.]/.test(i))throw new Error("illegal type: "+i);n[i]=[]}return new Wi(n)}function Wi(t){this._=t}function gd(t,e){return t.trim().split(/^|\s+/).map(function(n){var i="",r=n.indexOf(".");if(r>=0&&(i=n.slice(r+1),n=n.slice(0,r)),n&&!e.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:i}})}Wi.prototype=ci.prototype={constructor:Wi,on:function(t,e){var n=this._,i=gd(t+"",n),r,s=-1,o=i.length;if(arguments.length<2){for(;++s<o;)if((r=(t=i[s]).type)&&(r=_d(n[r],t.name)))return r;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++s<o;)if(r=(t=i[s]).type)n[r]=Lo(n[r],t.name,e);else if(e==null)for(r in n)n[r]=Lo(n[r],t.name,null);return this},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new Wi(t)},call:function(t,e){if((r=arguments.length-2)>0)for(var n=new Array(r),i=0,r,s;i<r;++i)n[i]=arguments[i+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(s=this._[t],i=0,r=s.length;i<r;++i)s[i].value.apply(e,n)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var i=this._[t],r=0,s=i.length;r<s;++r)i[r].value.apply(e,n)}};function _d(t,e){for(var n=0,i=t.length,r;n<i;++n)if((r=t[n]).name===e)return r.value}function Lo(t,e,n){for(var i=0,r=t.length;i<r;++i)if(t[i].name===e){t[i]=pd,t=t.slice(0,i).concat(t.slice(i+1));break}return n!=null&&t.push({name:e,value:n}),t}var Hr="http://www.w3.org/1999/xhtml";const Do={svg:"http://www.w3.org/2000/svg",xhtml:Hr,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Yi(t){var e=t+="",n=e.indexOf(":");return n>=0&&(e=t.slice(0,n))!=="xmlns"&&(t=t.slice(n+1)),Do.hasOwnProperty(e)?{space:Do[e],local:t}:t}function vd(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===Hr&&e.documentElement.namespaceURI===Hr?e.createElement(t):e.createElementNS(n,t)}}function yd(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function Ro(t){var e=Yi(t);return(e.local?yd:vd)(e)}function bd(){}function Vr(t){return t==null?bd:function(){return this.querySelector(t)}}function wd(t){typeof t!="function"&&(t=Vr(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var s=e[r],o=s.length,l=i[r]=new Array(o),a,c,u=0;u<o;++u)(a=s[u])&&(c=t.call(a,a.__data__,u,s))&&("__data__"in a&&(c.__data__=a.__data__),l[u]=c);return new Vt(i,this._parents)}function Sd(t){return t==null?[]:Array.isArray(t)?t:Array.from(t)}function kd(){return[]}function $o(t){return t==null?kd:function(){return this.querySelectorAll(t)}}function Ed(t){return function(){return Sd(t.apply(this,arguments))}}function Cd(t){typeof t=="function"?t=Ed(t):t=$o(t);for(var e=this._groups,n=e.length,i=[],r=[],s=0;s<n;++s)for(var o=e[s],l=o.length,a,c=0;c<l;++c)(a=o[c])&&(i.push(t.call(a,a.__data__,c,o)),r.push(a));return new Vt(i,r)}function zo(t){return function(){return this.matches(t)}}function jo(t){return function(e){return e.matches(t)}}var Id=Array.prototype.find;function xd(t){return function(){return Id.call(this.children,t)}}function Md(){return this.firstElementChild}function Ad(t){return this.select(t==null?Md:xd(typeof t=="function"?t:jo(t)))}var Td=Array.prototype.filter;function Nd(){return Array.from(this.children)}function Pd(t){return function(){return Td.call(this.children,t)}}function Od(t){return this.selectAll(t==null?Nd:Pd(typeof t=="function"?t:jo(t)))}function Ld(t){typeof t!="function"&&(t=zo(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var s=e[r],o=s.length,l=i[r]=[],a,c=0;c<o;++c)(a=s[c])&&t.call(a,a.__data__,c,s)&&l.push(a);return new Vt(i,this._parents)}function Fo(t){return new Array(t.length)}function Dd(){return new Vt(this._enter||this._groups.map(Fo),this._parents)}function Gi(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}Gi.prototype={constructor:Gi,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function Rd(t){return function(){return t}}function $d(t,e,n,i,r,s){for(var o=0,l,a=e.length,c=s.length;o<c;++o)(l=e[o])?(l.__data__=s[o],i[o]=l):n[o]=new Gi(t,s[o]);for(;o<a;++o)(l=e[o])&&(r[o]=l)}function zd(t,e,n,i,r,s,o){var l,a,c=new Map,u=e.length,h=s.length,f=new Array(u),d;for(l=0;l<u;++l)(a=e[l])&&(f[l]=d=o.call(a,a.__data__,l,e)+"",c.has(d)?r[l]=a:c.set(d,a));for(l=0;l<h;++l)d=o.call(t,s[l],l,s)+"",(a=c.get(d))?(i[l]=a,a.__data__=s[l],c.delete(d)):n[l]=new Gi(t,s[l]);for(l=0;l<u;++l)(a=e[l])&&c.get(f[l])===a&&(r[l]=a)}function jd(t){return t.__data__}function Fd(t,e){if(!arguments.length)return Array.from(this,jd);var n=e?zd:$d,i=this._parents,r=this._groups;typeof t!="function"&&(t=Rd(t));for(var s=r.length,o=new Array(s),l=new Array(s),a=new Array(s),c=0;c<s;++c){var u=i[c],h=r[c],f=h.length,d=Hd(t.call(u,u&&u.__data__,c,i)),m=d.length,p=l[c]=new Array(m),g=o[c]=new Array(m),_=a[c]=new Array(f);n(u,h,p,g,_,d,e);for(var S=0,C=0,w,k;S<m;++S)if(w=p[S]){for(S>=C&&(C=S+1);!(k=g[C])&&++C<m;);w._next=k||null}}return o=new Vt(o,i),o._enter=l,o._exit=a,o}function Hd(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function Vd(){return new Vt(this._exit||this._groups.map(Fo),this._parents)}function Ud(t,e,n){var i=this.enter(),r=this,s=this.exit();return typeof t=="function"?(i=t(i),i&&(i=i.selection())):i=i.append(t+""),e!=null&&(r=e(r),r&&(r=r.selection())),n==null?s.remove():n(s),i&&r?i.merge(r).order():r}function Bd(t){for(var e=t.selection?t.selection():t,n=this._groups,i=e._groups,r=n.length,s=i.length,o=Math.min(r,s),l=new Array(r),a=0;a<o;++a)for(var c=n[a],u=i[a],h=c.length,f=l[a]=new Array(h),d,m=0;m<h;++m)(d=c[m]||u[m])&&(f[m]=d);for(;a<r;++a)l[a]=n[a];return new Vt(l,this._parents)}function qd(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var i=t[e],r=i.length-1,s=i[r],o;--r>=0;)(o=i[r])&&(s&&o.compareDocumentPosition(s)^4&&s.parentNode.insertBefore(o,s),s=o);return this}function Kd(t){t||(t=Wd);function e(h,f){return h&&f?t(h.__data__,f.__data__):!h-!f}for(var n=this._groups,i=n.length,r=new Array(i),s=0;s<i;++s){for(var o=n[s],l=o.length,a=r[s]=new Array(l),c,u=0;u<l;++u)(c=o[u])&&(a[u]=c);a.sort(e)}return new Vt(r,this._parents).order()}function Wd(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function Yd(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function Gd(){return Array.from(this)}function Xd(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var i=t[e],r=0,s=i.length;r<s;++r){var o=i[r];if(o)return o}return null}function Jd(){let t=0;for(const e of this)++t;return t}function Qd(){return!this.node()}function Zd(t){for(var e=this._groups,n=0,i=e.length;n<i;++n)for(var r=e[n],s=0,o=r.length,l;s<o;++s)(l=r[s])&&t.call(l,l.__data__,s,r);return this}function eh(t){return function(){this.removeAttribute(t)}}function th(t){return function(){this.removeAttributeNS(t.space,t.local)}}function nh(t,e){return function(){this.setAttribute(t,e)}}function ih(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function rh(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttribute(t):this.setAttribute(t,n)}}function sh(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function oh(t,e){var n=Yi(t);if(arguments.length<2){var i=this.node();return n.local?i.getAttributeNS(n.space,n.local):i.getAttribute(n)}return this.each((e==null?n.local?th:eh:typeof e=="function"?n.local?sh:rh:n.local?ih:nh)(n,e))}function Ho(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function lh(t){return function(){this.style.removeProperty(t)}}function ah(t,e,n){return function(){this.style.setProperty(t,e,n)}}function ch(t,e,n){return function(){var i=e.apply(this,arguments);i==null?this.style.removeProperty(t):this.style.setProperty(t,i,n)}}function uh(t,e,n){return arguments.length>1?this.each((e==null?lh:typeof e=="function"?ch:ah)(t,e,n??"")):Yn(this.node(),t)}function Yn(t,e){return t.style.getPropertyValue(e)||Ho(t).getComputedStyle(t,null).getPropertyValue(e)}function fh(t){return function(){delete this[t]}}function dh(t,e){return function(){this[t]=e}}function hh(t,e){return function(){var n=e.apply(this,arguments);n==null?delete this[t]:this[t]=n}}function mh(t,e){return arguments.length>1?this.each((e==null?fh:typeof e=="function"?hh:dh)(t,e)):this.node()[t]}function Vo(t){return t.trim().split(/^|\s+/)}function Ur(t){return t.classList||new Uo(t)}function Uo(t){this._node=t,this._names=Vo(t.getAttribute("class")||"")}Uo.prototype={add:function(t){var e=this._names.indexOf(t);e<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function Bo(t,e){for(var n=Ur(t),i=-1,r=e.length;++i<r;)n.add(e[i])}function qo(t,e){for(var n=Ur(t),i=-1,r=e.length;++i<r;)n.remove(e[i])}function ph(t){return function(){Bo(this,t)}}function gh(t){return function(){qo(this,t)}}function _h(t,e){return function(){(e.apply(this,arguments)?Bo:qo)(this,t)}}function vh(t,e){var n=Vo(t+"");if(arguments.length<2){for(var i=Ur(this.node()),r=-1,s=n.length;++r<s;)if(!i.contains(n[r]))return!1;return!0}return this.each((typeof e=="function"?_h:e?ph:gh)(n,e))}function yh(){this.textContent=""}function bh(t){return function(){this.textContent=t}}function wh(t){return function(){var e=t.apply(this,arguments);this.textContent=e??""}}function Sh(t){return arguments.length?this.each(t==null?yh:(typeof t=="function"?wh:bh)(t)):this.node().textContent}function kh(){this.innerHTML=""}function Eh(t){return function(){this.innerHTML=t}}function Ch(t){return function(){var e=t.apply(this,arguments);this.innerHTML=e??""}}function Ih(t){return arguments.length?this.each(t==null?kh:(typeof t=="function"?Ch:Eh)(t)):this.node().innerHTML}function xh(){this.nextSibling&&this.parentNode.appendChild(this)}function Mh(){return this.each(xh)}function Ah(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Th(){return this.each(Ah)}function Nh(t){var e=typeof t=="function"?t:Ro(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function Ph(){return null}function Oh(t,e){var n=typeof t=="function"?t:Ro(t),i=e==null?Ph:typeof e=="function"?e:Vr(e);return this.select(function(){return this.insertBefore(n.apply(this,arguments),i.apply(this,arguments)||null)})}function Lh(){var t=this.parentNode;t&&t.removeChild(this)}function Dh(){return this.each(Lh)}function Rh(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function $h(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function zh(t){return this.select(t?$h:Rh)}function jh(t){return arguments.length?this.property("__data__",t):this.node().__data__}function Fh(t){return function(e){t.call(this,e,this.__data__)}}function Hh(t){return t.trim().split(/^|\s+/).map(function(e){var n="",i=e.indexOf(".");return i>=0&&(n=e.slice(i+1),e=e.slice(0,i)),{type:e,name:n}})}function Vh(t){return function(){var e=this.__on;if(e){for(var n=0,i=-1,r=e.length,s;n<r;++n)s=e[n],(!t.type||s.type===t.type)&&s.name===t.name?this.removeEventListener(s.type,s.listener,s.options):e[++i]=s;++i?e.length=i:delete this.__on}}}function Uh(t,e,n){return function(){var i=this.__on,r,s=Fh(e);if(i){for(var o=0,l=i.length;o<l;++o)if((r=i[o]).type===t.type&&r.name===t.name){this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=s,r.options=n),r.value=e;return}}this.addEventListener(t.type,s,n),r={type:t.type,name:t.name,value:e,listener:s,options:n},i?i.push(r):this.__on=[r]}}function Bh(t,e,n){var i=Hh(t+""),r,s=i.length,o;if(arguments.length<2){var l=this.node().__on;if(l){for(var a=0,c=l.length,u;a<c;++a)for(r=0,u=l[a];r<s;++r)if((o=i[r]).type===u.type&&o.name===u.name)return u.value}return}for(l=e?Uh:Vh,r=0;r<s;++r)this.each(l(i[r],e,n));return this}function Ko(t,e,n){var i=Ho(t),r=i.CustomEvent;typeof r=="function"?r=new r(e,n):(r=i.document.createEvent("Event"),n?(r.initEvent(e,n.bubbles,n.cancelable),r.detail=n.detail):r.initEvent(e,!1,!1)),t.dispatchEvent(r)}function qh(t,e){return function(){return Ko(this,t,e)}}function Kh(t,e){return function(){return Ko(this,t,e.apply(this,arguments))}}function Wh(t,e){return this.each((typeof e=="function"?Kh:qh)(t,e))}function*Yh(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var i=t[e],r=0,s=i.length,o;r<s;++r)(o=i[r])&&(yield o)}var Wo=[null];function Vt(t,e){this._groups=t,this._parents=e}function ui(){return new Vt([[document.documentElement]],Wo)}function Gh(){return this}Vt.prototype=ui.prototype={constructor:Vt,select:wd,selectAll:Cd,selectChild:Ad,selectChildren:Od,filter:Ld,data:Fd,enter:Dd,exit:Vd,join:Ud,merge:Bd,selection:Gh,order:qd,sort:Kd,call:Yd,nodes:Gd,node:Xd,size:Jd,empty:Qd,each:Zd,attr:oh,style:uh,property:mh,classed:vh,text:Sh,html:Ih,raise:Mh,lower:Th,append:Nh,insert:Oh,remove:Dh,clone:zh,datum:jh,on:Bh,dispatch:Wh,[Symbol.iterator]:Yh};function mt(t){return typeof t=="string"?new Vt([[document.querySelector(t)]],[document.documentElement]):new Vt([[t]],Wo)}function Xh(t){let e;for(;e=t.sourceEvent;)t=e;return t}function wt(t,e){if(t=Xh(t),e===void 0&&(e=t.currentTarget),e){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var i=n.createSVGPoint();return i.x=t.clientX,i.y=t.clientY,i=i.matrixTransform(e.getScreenCTM().inverse()),[i.x,i.y]}if(e.getBoundingClientRect){var r=e.getBoundingClientRect();return[t.clientX-r.left-e.clientLeft,t.clientY-r.top-e.clientTop]}}return[t.pageX,t.pageY]}const Jh={passive:!1},fi={capture:!0,passive:!1};function Br(t){t.stopImmediatePropagation()}function Gn(t){t.preventDefault(),t.stopImmediatePropagation()}function Yo(t){var e=t.document.documentElement,n=mt(t).on("dragstart.drag",Gn,fi);"onselectstart"in e?n.on("selectstart.drag",Gn,fi):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function Go(t,e){var n=t.document.documentElement,i=mt(t).on("dragstart.drag",null);e&&(i.on("click.drag",Gn,fi),setTimeout(function(){i.on("click.drag",null)},0)),"onselectstart"in n?i.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}const Xi=t=>()=>t;function qr(t,{sourceEvent:e,subject:n,target:i,identifier:r,active:s,x:o,y:l,dx:a,dy:c,dispatch:u}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},subject:{value:n,enumerable:!0,configurable:!0},target:{value:i,enumerable:!0,configurable:!0},identifier:{value:r,enumerable:!0,configurable:!0},active:{value:s,enumerable:!0,configurable:!0},x:{value:o,enumerable:!0,configurable:!0},y:{value:l,enumerable:!0,configurable:!0},dx:{value:a,enumerable:!0,configurable:!0},dy:{value:c,enumerable:!0,configurable:!0},_:{value:u}})}qr.prototype.on=function(){var t=this._.on.apply(this._,arguments);return t===this._?this:t};function Qh(t){return!t.ctrlKey&&!t.button}function Zh(){return this.parentNode}function em(t,e){return e??{x:t.x,y:t.y}}function tm(){return navigator.maxTouchPoints||"ontouchstart"in this}function nm(){var t=Qh,e=Zh,n=em,i=tm,r={},s=ci("start","drag","end"),o=0,l,a,c,u,h=0;function f(w){w.on("mousedown.drag",d).filter(i).on("touchstart.drag",g).on("touchmove.drag",_,Jh).on("touchend.drag touchcancel.drag",S).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function d(w,k){if(!(u||!t.call(this,w,k))){var T=C(this,e.call(this,w,k),w,k,"mouse");T&&(mt(w.view).on("mousemove.drag",m,fi).on("mouseup.drag",p,fi),Yo(w.view),Br(w),c=!1,l=w.clientX,a=w.clientY,T("start",w))}}function m(w){if(Gn(w),!c){var k=w.clientX-l,T=w.clientY-a;c=k*k+T*T>h}r.mouse("drag",w)}function p(w){mt(w.view).on("mousemove.drag mouseup.drag",null),Go(w.view,c),Gn(w),r.mouse("end",w)}function g(w,k){if(t.call(this,w,k)){var T=w.changedTouches,N=e.call(this,w,k),E=T.length,M,O;for(M=0;M<E;++M)(O=C(this,N,w,k,T[M].identifier,T[M]))&&(Br(w),O("start",w,T[M]))}}function _(w){var k=w.changedTouches,T=k.length,N,E;for(N=0;N<T;++N)(E=r[k[N].identifier])&&(Gn(w),E("drag",w,k[N]))}function S(w){var k=w.changedTouches,T=k.length,N,E;for(u&&clearTimeout(u),u=setTimeout(function(){u=null},500),N=0;N<T;++N)(E=r[k[N].identifier])&&(Br(w),E("end",w,k[N]))}function C(w,k,T,N,E,M){var O=s.copy(),L=wt(M||T,k),j,R,x;if((x=n.call(w,new qr("beforestart",{sourceEvent:T,target:f,identifier:E,active:o,x:L[0],y:L[1],dx:0,dy:0,dispatch:O}),N))!=null)return j=x.x-L[0]||0,R=x.y-L[1]||0,function H(P,X,U){var K=L,Z;switch(P){case"start":r[E]=H,Z=o++;break;case"end":delete r[E],--o;case"drag":L=wt(U||X,k),Z=o;break}O.call(P,w,new qr(P,{sourceEvent:X,subject:x,target:f,identifier:E,active:Z,x:L[0]+j,y:L[1]+R,dx:L[0]-K[0],dy:L[1]-K[1],dispatch:O}),N)}}return f.filter=function(w){return arguments.length?(t=typeof w=="function"?w:Xi(!!w),f):t},f.container=function(w){return arguments.length?(e=typeof w=="function"?w:Xi(w),f):e},f.subject=function(w){return arguments.length?(n=typeof w=="function"?w:Xi(w),f):n},f.touchable=function(w){return arguments.length?(i=typeof w=="function"?w:Xi(!!w),f):i},f.on=function(){var w=s.on.apply(s,arguments);return w===s?f:w},f.clickDistance=function(w){return arguments.length?(h=(w=+w)*w,f):Math.sqrt(h)},f}function Kr(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function Xo(t,e){var n=Object.create(t.prototype);for(var i in e)n[i]=e[i];return n}function di(){}var hi=.7,Ji=1/hi,Xn="\\s*([+-]?\\d+)\\s*",mi="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",tn="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",im=/^#([0-9a-f]{3,8})$/,rm=new RegExp(`^rgb\\(${Xn},${Xn},${Xn}\\)$`),sm=new RegExp(`^rgb\\(${tn},${tn},${tn}\\)$`),om=new RegExp(`^rgba\\(${Xn},${Xn},${Xn},${mi}\\)$`),lm=new RegExp(`^rgba\\(${tn},${tn},${tn},${mi}\\)$`),am=new RegExp(`^hsl\\(${mi},${tn},${tn}\\)$`),cm=new RegExp(`^hsla\\(${mi},${tn},${tn},${mi}\\)$`),Jo={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Kr(di,Mn,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:Qo,formatHex:Qo,formatHex8:um,formatHsl:fm,formatRgb:Zo,toString:Zo});function Qo(){return this.rgb().formatHex()}function um(){return this.rgb().formatHex8()}function fm(){return rl(this).formatHsl()}function Zo(){return this.rgb().formatRgb()}function Mn(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=im.exec(t))?(n=e[1].length,e=parseInt(e[1],16),n===6?el(e):n===3?new Dt(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):n===8?Qi(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):n===4?Qi(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=rm.exec(t))?new Dt(e[1],e[2],e[3],1):(e=sm.exec(t))?new Dt(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=om.exec(t))?Qi(e[1],e[2],e[3],e[4]):(e=lm.exec(t))?Qi(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=am.exec(t))?il(e[1],e[2]/100,e[3]/100,1):(e=cm.exec(t))?il(e[1],e[2]/100,e[3]/100,e[4]):Jo.hasOwnProperty(t)?el(Jo[t]):t==="transparent"?new Dt(NaN,NaN,NaN,0):null}function el(t){return new Dt(t>>16&255,t>>8&255,t&255,1)}function Qi(t,e,n,i){return i<=0&&(t=e=n=NaN),new Dt(t,e,n,i)}function dm(t){return t instanceof di||(t=Mn(t)),t?(t=t.rgb(),new Dt(t.r,t.g,t.b,t.opacity)):new Dt}function Wr(t,e,n,i){return arguments.length===1?dm(t):new Dt(t,e,n,i??1)}function Dt(t,e,n,i){this.r=+t,this.g=+e,this.b=+n,this.opacity=+i}Kr(Dt,Wr,Xo(di,{brighter(t){return t=t==null?Ji:Math.pow(Ji,t),new Dt(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?hi:Math.pow(hi,t),new Dt(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new Dt(An(this.r),An(this.g),An(this.b),Zi(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:tl,formatHex:tl,formatHex8:hm,formatRgb:nl,toString:nl}));function tl(){return`#${Tn(this.r)}${Tn(this.g)}${Tn(this.b)}`}function hm(){return`#${Tn(this.r)}${Tn(this.g)}${Tn(this.b)}${Tn((isNaN(this.opacity)?1:this.opacity)*255)}`}function nl(){const t=Zi(this.opacity);return`${t===1?"rgb(":"rgba("}${An(this.r)}, ${An(this.g)}, ${An(this.b)}${t===1?")":`, ${t})`}`}function Zi(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function An(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function Tn(t){return t=An(t),(t<16?"0":"")+t.toString(16)}function il(t,e,n,i){return i<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new Qt(t,e,n,i)}function rl(t){if(t instanceof Qt)return new Qt(t.h,t.s,t.l,t.opacity);if(t instanceof di||(t=Mn(t)),!t)return new Qt;if(t instanceof Qt)return t;t=t.rgb();var e=t.r/255,n=t.g/255,i=t.b/255,r=Math.min(e,n,i),s=Math.max(e,n,i),o=NaN,l=s-r,a=(s+r)/2;return l?(e===s?o=(n-i)/l+(n<i)*6:n===s?o=(i-e)/l+2:o=(e-n)/l+4,l/=a<.5?s+r:2-s-r,o*=60):l=a>0&&a<1?0:o,new Qt(o,l,a,t.opacity)}function er(t,e,n,i){return arguments.length===1?rl(t):new Qt(t,e,n,i??1)}function Qt(t,e,n,i){this.h=+t,this.s=+e,this.l=+n,this.opacity=+i}Kr(Qt,er,Xo(di,{brighter(t){return t=t==null?Ji:Math.pow(Ji,t),new Qt(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?hi:Math.pow(hi,t),new Qt(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,i=n+(n<.5?n:1-n)*e,r=2*n-i;return new Dt(Yr(t>=240?t-240:t+120,r,i),Yr(t,r,i),Yr(t<120?t+240:t-120,r,i),this.opacity)},clamp(){return new Qt(sl(this.h),tr(this.s),tr(this.l),Zi(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=Zi(this.opacity);return`${t===1?"hsl(":"hsla("}${sl(this.h)}, ${tr(this.s)*100}%, ${tr(this.l)*100}%${t===1?")":`, ${t})`}`}}));function sl(t){return t=(t||0)%360,t<0?t+360:t}function tr(t){return Math.max(0,Math.min(1,t||0))}function Yr(t,e,n){return(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)*255}const Gr=t=>()=>t;function mm(t,e){return function(n){return t+n*e}}function pm(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(i){return Math.pow(t+i*e,n)}}function gm(t){return(t=+t)==1?ol:function(e,n){return n-e?pm(e,n,t):Gr(isNaN(e)?n:e)}}function ol(t,e){var n=e-t;return n?mm(t,n):Gr(isNaN(t)?e:t)}const nr=function t(e){var n=gm(e);function i(r,s){var o=n((r=Wr(r)).r,(s=Wr(s)).r),l=n(r.g,s.g),a=n(r.b,s.b),c=ol(r.opacity,s.opacity);return function(u){return r.r=o(u),r.g=l(u),r.b=a(u),r.opacity=c(u),r+""}}return i.gamma=t,i}(1);function _m(t,e){e||(e=[]);var n=t?Math.min(e.length,t.length):0,i=e.slice(),r;return function(s){for(r=0;r<n;++r)i[r]=t[r]*(1-s)+e[r]*s;return i}}function vm(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function ym(t,e){var n=e?e.length:0,i=t?Math.min(n,t.length):0,r=new Array(i),s=new Array(n),o;for(o=0;o<i;++o)r[o]=Qr(t[o],e[o]);for(;o<n;++o)s[o]=e[o];return function(l){for(o=0;o<i;++o)s[o]=r[o](l);return s}}function bm(t,e){var n=new Date;return t=+t,e=+e,function(i){return n.setTime(t*(1-i)+e*i),n}}function Zt(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}function wm(t,e){var n={},i={},r;(t===null||typeof t!="object")&&(t={}),(e===null||typeof e!="object")&&(e={});for(r in e)r in t?n[r]=Qr(t[r],e[r]):i[r]=e[r];return function(s){for(r in n)i[r]=n[r](s);return i}}var Xr=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Jr=new RegExp(Xr.source,"g");function Sm(t){return function(){return t}}function km(t){return function(e){return t(e)+""}}function ll(t,e){var n=Xr.lastIndex=Jr.lastIndex=0,i,r,s,o=-1,l=[],a=[];for(t=t+"",e=e+"";(i=Xr.exec(t))&&(r=Jr.exec(e));)(s=r.index)>n&&(s=e.slice(n,s),l[o]?l[o]+=s:l[++o]=s),(i=i[0])===(r=r[0])?l[o]?l[o]+=r:l[++o]=r:(l[++o]=null,a.push({i:o,x:Zt(i,r)})),n=Jr.lastIndex;return n<e.length&&(s=e.slice(n),l[o]?l[o]+=s:l[++o]=s),l.length<2?a[0]?km(a[0].x):Sm(e):(e=a.length,function(c){for(var u=0,h;u<e;++u)l[(h=a[u]).i]=h.x(c);return l.join("")})}function Qr(t,e){var n=typeof e,i;return e==null||n==="boolean"?Gr(e):(n==="number"?Zt:n==="string"?(i=Mn(e))?(e=i,nr):ll:e instanceof Mn?nr:e instanceof Date?bm:vm(e)?_m:Array.isArray(e)?ym:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?wm:Zt)(t,e)}function Em(t,e){return t=+t,e=+e,function(n){return Math.round(t*(1-n)+e*n)}}var al=180/Math.PI,Zr={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function cl(t,e,n,i,r,s){var o,l,a;return(o=Math.sqrt(t*t+e*e))&&(t/=o,e/=o),(a=t*n+e*i)&&(n-=t*a,i-=e*a),(l=Math.sqrt(n*n+i*i))&&(n/=l,i/=l,a/=l),t*i<e*n&&(t=-t,e=-e,a=-a,o=-o),{translateX:r,translateY:s,rotate:Math.atan2(e,t)*al,skewX:Math.atan(a)*al,scaleX:o,scaleY:l}}var ir;function Cm(t){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?Zr:cl(e.a,e.b,e.c,e.d,e.e,e.f)}function Im(t){return t==null||(ir||(ir=document.createElementNS("http://www.w3.org/2000/svg","g")),ir.setAttribute("transform",t),!(t=ir.transform.baseVal.consolidate()))?Zr:(t=t.matrix,cl(t.a,t.b,t.c,t.d,t.e,t.f))}function ul(t,e,n,i){function r(c){return c.length?c.pop()+" ":""}function s(c,u,h,f,d,m){if(c!==h||u!==f){var p=d.push("translate(",null,e,null,n);m.push({i:p-4,x:Zt(c,h)},{i:p-2,x:Zt(u,f)})}else(h||f)&&d.push("translate("+h+e+f+n)}function o(c,u,h,f){c!==u?(c-u>180?u+=360:u-c>180&&(c+=360),f.push({i:h.push(r(h)+"rotate(",null,i)-2,x:Zt(c,u)})):u&&h.push(r(h)+"rotate("+u+i)}function l(c,u,h,f){c!==u?f.push({i:h.push(r(h)+"skewX(",null,i)-2,x:Zt(c,u)}):u&&h.push(r(h)+"skewX("+u+i)}function a(c,u,h,f,d,m){if(c!==h||u!==f){var p=d.push(r(d)+"scale(",null,",",null,")");m.push({i:p-4,x:Zt(c,h)},{i:p-2,x:Zt(u,f)})}else(h!==1||f!==1)&&d.push(r(d)+"scale("+h+","+f+")")}return function(c,u){var h=[],f=[];return c=t(c),u=t(u),s(c.translateX,c.translateY,u.translateX,u.translateY,h,f),o(c.rotate,u.rotate,h,f),l(c.skewX,u.skewX,h,f),a(c.scaleX,c.scaleY,u.scaleX,u.scaleY,h,f),c=u=null,function(d){for(var m=-1,p=f.length,g;++m<p;)h[(g=f[m]).i]=g.x(d);return h.join("")}}}var xm=ul(Cm,"px, ","px)","deg)"),Mm=ul(Im,", ",")",")"),Am=1e-12;function fl(t){return((t=Math.exp(t))+1/t)/2}function Tm(t){return((t=Math.exp(t))-1/t)/2}function Nm(t){return((t=Math.exp(2*t))-1)/(t+1)}const Pm=function t(e,n,i){function r(s,o){var l=s[0],a=s[1],c=s[2],u=o[0],h=o[1],f=o[2],d=u-l,m=h-a,p=d*d+m*m,g,_;if(p<Am)_=Math.log(f/c)/e,g=function(N){return[l+N*d,a+N*m,c*Math.exp(e*N*_)]};else{var S=Math.sqrt(p),C=(f*f-c*c+i*p)/(2*c*n*S),w=(f*f-c*c-i*p)/(2*f*n*S),k=Math.log(Math.sqrt(C*C+1)-C),T=Math.log(Math.sqrt(w*w+1)-w);_=(T-k)/e,g=function(N){var E=N*_,M=fl(k),O=c/(n*S)*(M*Nm(e*E+k)-Tm(k));return[l+O*d,a+O*m,c*M/fl(e*E+k)]}}return g.duration=_*1e3*e/Math.SQRT2,g}return r.rho=function(s){var o=Math.max(.001,+s),l=o*o,a=l*l;return t(o,l,a)},r}(Math.SQRT2,2,4);var Jn=0,pi=0,gi=0,dl=1e3,rr,_i,sr=0,Nn=0,or=0,vi=typeof performance=="object"&&performance.now?performance:Date,hl=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function es(){return Nn||(hl(Om),Nn=vi.now()+or)}function Om(){Nn=0}function lr(){this._call=this._time=this._next=null}lr.prototype=ts.prototype={constructor:lr,restart:function(t,e,n){if(typeof t!="function")throw new TypeError("callback is not a function");n=(n==null?es():+n)+(e==null?0:+e),!this._next&&_i!==this&&(_i?_i._next=this:rr=this,_i=this),this._call=t,this._time=n,ns()},stop:function(){this._call&&(this._call=null,this._time=1/0,ns())}};function ts(t,e,n){var i=new lr;return i.restart(t,e,n),i}function Lm(){es(),++Jn;for(var t=rr,e;t;)(e=Nn-t._time)>=0&&t._call.call(void 0,e),t=t._next;--Jn}function ml(){Nn=(sr=vi.now())+or,Jn=pi=0;try{Lm()}finally{Jn=0,Rm(),Nn=0}}function Dm(){var t=vi.now(),e=t-sr;e>dl&&(or-=e,sr=t)}function Rm(){for(var t,e=rr,n,i=1/0;e;)e._call?(i>e._time&&(i=e._time),t=e,e=e._next):(n=e._next,e._next=null,e=t?t._next=n:rr=n);_i=t,ns(i)}function ns(t){if(!Jn){pi&&(pi=clearTimeout(pi));var e=t-Nn;e>24?(t<1/0&&(pi=setTimeout(ml,t-vi.now()-or)),gi&&(gi=clearInterval(gi))):(gi||(sr=vi.now(),gi=setInterval(Dm,dl)),Jn=1,hl(ml))}}function pl(t,e,n){var i=new lr;return e=e==null?0:+e,i.restart(r=>{i.stop(),t(r+e)},e,n),i}var $m=ci("start","end","cancel","interrupt"),zm=[],gl=0,_l=1,is=2,ar=3,vl=4,rs=5,cr=6;function ur(t,e,n,i,r,s){var o=t.__transition;if(!o)t.__transition={};else if(n in o)return;jm(t,n,{name:e,index:i,group:r,on:$m,tween:zm,time:s.time,delay:s.delay,duration:s.duration,ease:s.ease,timer:null,state:gl})}function ss(t,e){var n=en(t,e);if(n.state>gl)throw new Error("too late; already scheduled");return n}function nn(t,e){var n=en(t,e);if(n.state>ar)throw new Error("too late; already running");return n}function en(t,e){var n=t.__transition;if(!n||!(n=n[e]))throw new Error("transition not found");return n}function jm(t,e,n){var i=t.__transition,r;i[e]=n,n.timer=ts(s,0,n.time);function s(c){n.state=_l,n.timer.restart(o,n.delay,n.time),n.delay<=c&&o(c-n.delay)}function o(c){var u,h,f,d;if(n.state!==_l)return a();for(u in i)if(d=i[u],d.name===n.name){if(d.state===ar)return pl(o);d.state===vl?(d.state=cr,d.timer.stop(),d.on.call("interrupt",t,t.__data__,d.index,d.group),delete i[u]):+u<e&&(d.state=cr,d.timer.stop(),d.on.call("cancel",t,t.__data__,d.index,d.group),delete i[u])}if(pl(function(){n.state===ar&&(n.state=vl,n.timer.restart(l,n.delay,n.time),l(c))}),n.state=is,n.on.call("start",t,t.__data__,n.index,n.group),n.state===is){for(n.state=ar,r=new Array(f=n.tween.length),u=0,h=-1;u<f;++u)(d=n.tween[u].value.call(t,t.__data__,n.index,n.group))&&(r[++h]=d);r.length=h+1}}function l(c){for(var u=c<n.duration?n.ease.call(null,c/n.duration):(n.timer.restart(a),n.state=rs,1),h=-1,f=r.length;++h<f;)r[h].call(t,u);n.state===rs&&(n.on.call("end",t,t.__data__,n.index,n.group),a())}function a(){n.state=cr,n.timer.stop(),delete i[e];for(var c in i)return;delete t.__transition}}function fr(t,e){var n=t.__transition,i,r,s=!0,o;if(n){e=e==null?null:e+"";for(o in n){if((i=n[o]).name!==e){s=!1;continue}r=i.state>is&&i.state<rs,i.state=cr,i.timer.stop(),i.on.call(r?"interrupt":"cancel",t,t.__data__,i.index,i.group),delete n[o]}s&&delete t.__transition}}function Fm(t){return this.each(function(){fr(this,t)})}function Hm(t,e){var n,i;return function(){var r=nn(this,t),s=r.tween;if(s!==n){i=n=s;for(var o=0,l=i.length;o<l;++o)if(i[o].name===e){i=i.slice(),i.splice(o,1);break}}r.tween=i}}function Vm(t,e,n){var i,r;if(typeof n!="function")throw new Error;return function(){var s=nn(this,t),o=s.tween;if(o!==i){r=(i=o).slice();for(var l={name:e,value:n},a=0,c=r.length;a<c;++a)if(r[a].name===e){r[a]=l;break}a===c&&r.push(l)}s.tween=r}}function Um(t,e){var n=this._id;if(t+="",arguments.length<2){for(var i=en(this.node(),n).tween,r=0,s=i.length,o;r<s;++r)if((o=i[r]).name===t)return o.value;return null}return this.each((e==null?Hm:Vm)(n,t,e))}function os(t,e,n){var i=t._id;return t.each(function(){var r=nn(this,i);(r.value||(r.value={}))[e]=n.apply(this,arguments)}),function(r){return en(r,i).value[e]}}function yl(t,e){var n;return(typeof e=="number"?Zt:e instanceof Mn?nr:(n=Mn(e))?(e=n,nr):ll)(t,e)}function Bm(t){return function(){this.removeAttribute(t)}}function qm(t){return function(){this.removeAttributeNS(t.space,t.local)}}function Km(t,e,n){var i,r=n+"",s;return function(){var o=this.getAttribute(t);return o===r?null:o===i?s:s=e(i=o,n)}}function Wm(t,e,n){var i,r=n+"",s;return function(){var o=this.getAttributeNS(t.space,t.local);return o===r?null:o===i?s:s=e(i=o,n)}}function Ym(t,e,n){var i,r,s;return function(){var o,l=n(this),a;return l==null?void this.removeAttribute(t):(o=this.getAttribute(t),a=l+"",o===a?null:o===i&&a===r?s:(r=a,s=e(i=o,l)))}}function Gm(t,e,n){var i,r,s;return function(){var o,l=n(this),a;return l==null?void this.removeAttributeNS(t.space,t.local):(o=this.getAttributeNS(t.space,t.local),a=l+"",o===a?null:o===i&&a===r?s:(r=a,s=e(i=o,l)))}}function Xm(t,e){var n=Yi(t),i=n==="transform"?Mm:yl;return this.attrTween(t,typeof e=="function"?(n.local?Gm:Ym)(n,i,os(this,"attr."+t,e)):e==null?(n.local?qm:Bm)(n):(n.local?Wm:Km)(n,i,e))}function Jm(t,e){return function(n){this.setAttribute(t,e.call(this,n))}}function Qm(t,e){return function(n){this.setAttributeNS(t.space,t.local,e.call(this,n))}}function Zm(t,e){var n,i;function r(){var s=e.apply(this,arguments);return s!==i&&(n=(i=s)&&Qm(t,s)),n}return r._value=e,r}function ep(t,e){var n,i;function r(){var s=e.apply(this,arguments);return s!==i&&(n=(i=s)&&Jm(t,s)),n}return r._value=e,r}function tp(t,e){var n="attr."+t;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(e==null)return this.tween(n,null);if(typeof e!="function")throw new Error;var i=Yi(t);return this.tween(n,(i.local?Zm:ep)(i,e))}function np(t,e){return function(){ss(this,t).delay=+e.apply(this,arguments)}}function ip(t,e){return e=+e,function(){ss(this,t).delay=e}}function rp(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?np:ip)(e,t)):en(this.node(),e).delay}function sp(t,e){return function(){nn(this,t).duration=+e.apply(this,arguments)}}function op(t,e){return e=+e,function(){nn(this,t).duration=e}}function lp(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?sp:op)(e,t)):en(this.node(),e).duration}function ap(t,e){if(typeof e!="function")throw new Error;return function(){nn(this,t).ease=e}}function cp(t){var e=this._id;return arguments.length?this.each(ap(e,t)):en(this.node(),e).ease}function up(t,e){return function(){var n=e.apply(this,arguments);if(typeof n!="function")throw new Error;nn(this,t).ease=n}}function fp(t){if(typeof t!="function")throw new Error;return this.each(up(this._id,t))}function dp(t){typeof t!="function"&&(t=zo(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var s=e[r],o=s.length,l=i[r]=[],a,c=0;c<o;++c)(a=s[c])&&t.call(a,a.__data__,c,s)&&l.push(a);return new un(i,this._parents,this._name,this._id)}function hp(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,n=t._groups,i=e.length,r=n.length,s=Math.min(i,r),o=new Array(i),l=0;l<s;++l)for(var a=e[l],c=n[l],u=a.length,h=o[l]=new Array(u),f,d=0;d<u;++d)(f=a[d]||c[d])&&(h[d]=f);for(;l<i;++l)o[l]=e[l];return new un(o,this._parents,this._name,this._id)}function mp(t){return(t+"").trim().split(/^|\s+/).every(function(e){var n=e.indexOf(".");return n>=0&&(e=e.slice(0,n)),!e||e==="start"})}function pp(t,e,n){var i,r,s=mp(e)?ss:nn;return function(){var o=s(this,t),l=o.on;l!==i&&(r=(i=l).copy()).on(e,n),o.on=r}}function gp(t,e){var n=this._id;return arguments.length<2?en(this.node(),n).on.on(t):this.each(pp(n,t,e))}function _p(t){return function(){var e=this.parentNode;for(var n in this.__transition)if(+n!==t)return;e&&e.removeChild(this)}}function vp(){return this.on("end.remove",_p(this._id))}function yp(t){var e=this._name,n=this._id;typeof t!="function"&&(t=Vr(t));for(var i=this._groups,r=i.length,s=new Array(r),o=0;o<r;++o)for(var l=i[o],a=l.length,c=s[o]=new Array(a),u,h,f=0;f<a;++f)(u=l[f])&&(h=t.call(u,u.__data__,f,l))&&("__data__"in u&&(h.__data__=u.__data__),c[f]=h,ur(c[f],e,n,f,c,en(u,n)));return new un(s,this._parents,e,n)}function bp(t){var e=this._name,n=this._id;typeof t!="function"&&(t=$o(t));for(var i=this._groups,r=i.length,s=[],o=[],l=0;l<r;++l)for(var a=i[l],c=a.length,u,h=0;h<c;++h)if(u=a[h]){for(var f=t.call(u,u.__data__,h,a),d,m=en(u,n),p=0,g=f.length;p<g;++p)(d=f[p])&&ur(d,e,n,p,f,m);s.push(f),o.push(u)}return new un(s,o,e,n)}var wp=ui.prototype.constructor;function Sp(){return new wp(this._groups,this._parents)}function kp(t,e){var n,i,r;return function(){var s=Yn(this,t),o=(this.style.removeProperty(t),Yn(this,t));return s===o?null:s===n&&o===i?r:r=e(n=s,i=o)}}function bl(t){return function(){this.style.removeProperty(t)}}function Ep(t,e,n){var i,r=n+"",s;return function(){var o=Yn(this,t);return o===r?null:o===i?s:s=e(i=o,n)}}function Cp(t,e,n){var i,r,s;return function(){var o=Yn(this,t),l=n(this),a=l+"";return l==null&&(a=l=(this.style.removeProperty(t),Yn(this,t))),o===a?null:o===i&&a===r?s:(r=a,s=e(i=o,l))}}function Ip(t,e){var n,i,r,s="style."+e,o="end."+s,l;return function(){var a=nn(this,t),c=a.on,u=a.value[s]==null?l||(l=bl(e)):void 0;(c!==n||r!==u)&&(i=(n=c).copy()).on(o,r=u),a.on=i}}function xp(t,e,n){var i=(t+="")=="transform"?xm:yl;return e==null?this.styleTween(t,kp(t,i)).on("end.style."+t,bl(t)):typeof e=="function"?this.styleTween(t,Cp(t,i,os(this,"style."+t,e))).each(Ip(this._id,t)):this.styleTween(t,Ep(t,i,e),n).on("end.style."+t,null)}function Mp(t,e,n){return function(i){this.style.setProperty(t,e.call(this,i),n)}}function Ap(t,e,n){var i,r;function s(){var o=e.apply(this,arguments);return o!==r&&(i=(r=o)&&Mp(t,o,n)),i}return s._value=e,s}function Tp(t,e,n){var i="style."+(t+="");if(arguments.length<2)return(i=this.tween(i))&&i._value;if(e==null)return this.tween(i,null);if(typeof e!="function")throw new Error;return this.tween(i,Ap(t,e,n??""))}function Np(t){return function(){this.textContent=t}}function Pp(t){return function(){var e=t(this);this.textContent=e??""}}function Op(t){return this.tween("text",typeof t=="function"?Pp(os(this,"text",t)):Np(t==null?"":t+""))}function Lp(t){return function(e){this.textContent=t.call(this,e)}}function Dp(t){var e,n;function i(){var r=t.apply(this,arguments);return r!==n&&(e=(n=r)&&Lp(r)),e}return i._value=t,i}function Rp(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(t==null)return this.tween(e,null);if(typeof t!="function")throw new Error;return this.tween(e,Dp(t))}function $p(){for(var t=this._name,e=this._id,n=wl(),i=this._groups,r=i.length,s=0;s<r;++s)for(var o=i[s],l=o.length,a,c=0;c<l;++c)if(a=o[c]){var u=en(a,e);ur(a,t,n,c,o,{time:u.time+u.delay+u.duration,delay:0,duration:u.duration,ease:u.ease})}return new un(i,this._parents,t,n)}function zp(){var t,e,n=this,i=n._id,r=n.size();return new Promise(function(s,o){var l={value:o},a={value:function(){--r===0&&s()}};n.each(function(){var c=nn(this,i),u=c.on;u!==t&&(e=(t=u).copy(),e._.cancel.push(l),e._.interrupt.push(l),e._.end.push(a)),c.on=e}),r===0&&s()})}var jp=0;function un(t,e,n,i){this._groups=t,this._parents=e,this._name=n,this._id=i}function wl(){return++jp}var fn=ui.prototype;un.prototype={constructor:un,select:yp,selectAll:bp,selectChild:fn.selectChild,selectChildren:fn.selectChildren,filter:dp,merge:hp,selection:Sp,transition:$p,call:fn.call,nodes:fn.nodes,node:fn.node,size:fn.size,empty:fn.empty,each:fn.each,on:gp,attr:Xm,attrTween:tp,style:xp,styleTween:Tp,text:Op,textTween:Rp,remove:vp,tween:Um,delay:rp,duration:lp,ease:cp,easeVarying:fp,end:zp,[Symbol.iterator]:fn[Symbol.iterator]};function Fp(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}var Hp={time:null,delay:0,duration:250,ease:Fp};function Vp(t,e){for(var n;!(n=t.__transition)||!(n=n[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return n}function Up(t){var e,n;t instanceof un?(e=t._id,t=t._name):(e=wl(),(n=Hp).time=es(),t=t==null?null:t+"");for(var i=this._groups,r=i.length,s=0;s<r;++s)for(var o=i[s],l=o.length,a,c=0;c<l;++c)(a=o[c])&&ur(a,t,e,c,o,n||Vp(a,e));return new un(i,this._parents,t,e)}ui.prototype.interrupt=Fm,ui.prototype.transition=Up;function Sl(t,e){var n,i=1;t==null&&(t=0),e==null&&(e=0);function r(){var s,o=n.length,l,a=0,c=0;for(s=0;s<o;++s)l=n[s],a+=l.x,c+=l.y;for(a=(a/o-t)*i,c=(c/o-e)*i,s=0;s<o;++s)l=n[s],l.x-=a,l.y-=c}return r.initialize=function(s){n=s},r.x=function(s){return arguments.length?(t=+s,r):t},r.y=function(s){return arguments.length?(e=+s,r):e},r.strength=function(s){return arguments.length?(i=+s,r):i},r}function Bp(t){const e=+this._x.call(null,t),n=+this._y.call(null,t);return kl(this.cover(e,n),e,n,t)}function kl(t,e,n,i){if(isNaN(e)||isNaN(n))return t;var r,s=t._root,o={data:i},l=t._x0,a=t._y0,c=t._x1,u=t._y1,h,f,d,m,p,g,_,S;if(!s)return t._root=o,t;for(;s.length;)if((p=e>=(h=(l+c)/2))?l=h:c=h,(g=n>=(f=(a+u)/2))?a=f:u=f,r=s,!(s=s[_=g<<1|p]))return r[_]=o,t;if(d=+t._x.call(null,s.data),m=+t._y.call(null,s.data),e===d&&n===m)return o.next=s,r?r[_]=o:t._root=o,t;do r=r?r[_]=new Array(4):t._root=new Array(4),(p=e>=(h=(l+c)/2))?l=h:c=h,(g=n>=(f=(a+u)/2))?a=f:u=f;while((_=g<<1|p)===(S=(m>=f)<<1|d>=h));return r[S]=s,r[_]=o,t}function qp(t){var e,n,i=t.length,r,s,o=new Array(i),l=new Array(i),a=1/0,c=1/0,u=-1/0,h=-1/0;for(n=0;n<i;++n)isNaN(r=+this._x.call(null,e=t[n]))||isNaN(s=+this._y.call(null,e))||(o[n]=r,l[n]=s,r<a&&(a=r),r>u&&(u=r),s<c&&(c=s),s>h&&(h=s));if(a>u||c>h)return this;for(this.cover(a,c).cover(u,h),n=0;n<i;++n)kl(this,o[n],l[n],t[n]);return this}function Kp(t,e){if(isNaN(t=+t)||isNaN(e=+e))return this;var n=this._x0,i=this._y0,r=this._x1,s=this._y1;if(isNaN(n))r=(n=Math.floor(t))+1,s=(i=Math.floor(e))+1;else{for(var o=r-n||1,l=this._root,a,c;n>t||t>=r||i>e||e>=s;)switch(c=(e<i)<<1|t<n,a=new Array(4),a[c]=l,l=a,o*=2,c){case 0:r=n+o,s=i+o;break;case 1:n=r-o,s=i+o;break;case 2:r=n+o,i=s-o;break;case 3:n=r-o,i=s-o;break}this._root&&this._root.length&&(this._root=l)}return this._x0=n,this._y0=i,this._x1=r,this._y1=s,this}function Wp(){var t=[];return this.visit(function(e){if(!e.length)do t.push(e.data);while(e=e.next)}),t}function Yp(t){return arguments.length?this.cover(+t[0][0],+t[0][1]).cover(+t[1][0],+t[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function Pt(t,e,n,i,r){this.node=t,this.x0=e,this.y0=n,this.x1=i,this.y1=r}function Gp(t,e,n){var i,r=this._x0,s=this._y0,o,l,a,c,u=this._x1,h=this._y1,f=[],d=this._root,m,p;for(d&&f.push(new Pt(d,r,s,u,h)),n==null?n=1/0:(r=t-n,s=e-n,u=t+n,h=e+n,n*=n);m=f.pop();)if(!(!(d=m.node)||(o=m.x0)>u||(l=m.y0)>h||(a=m.x1)<r||(c=m.y1)<s))if(d.length){var g=(o+a)/2,_=(l+c)/2;f.push(new Pt(d[3],g,_,a,c),new Pt(d[2],o,_,g,c),new Pt(d[1],g,l,a,_),new Pt(d[0],o,l,g,_)),(p=(e>=_)<<1|t>=g)&&(m=f[f.length-1],f[f.length-1]=f[f.length-1-p],f[f.length-1-p]=m)}else{var S=t-+this._x.call(null,d.data),C=e-+this._y.call(null,d.data),w=S*S+C*C;if(w<n){var k=Math.sqrt(n=w);r=t-k,s=e-k,u=t+k,h=e+k,i=d.data}}return i}function Xp(t){if(isNaN(u=+this._x.call(null,t))||isNaN(h=+this._y.call(null,t)))return this;var e,n=this._root,i,r,s,o=this._x0,l=this._y0,a=this._x1,c=this._y1,u,h,f,d,m,p,g,_;if(!n)return this;if(n.length)for(;;){if((m=u>=(f=(o+a)/2))?o=f:a=f,(p=h>=(d=(l+c)/2))?l=d:c=d,e=n,!(n=n[g=p<<1|m]))return this;if(!n.length)break;(e[g+1&3]||e[g+2&3]||e[g+3&3])&&(i=e,_=g)}for(;n.data!==t;)if(r=n,!(n=n.next))return this;return(s=n.next)&&delete n.next,r?(s?r.next=s:delete r.next,this):e?(s?e[g]=s:delete e[g],(n=e[0]||e[1]||e[2]||e[3])&&n===(e[3]||e[2]||e[1]||e[0])&&!n.length&&(i?i[_]=n:this._root=n),this):(this._root=s,this)}function Jp(t){for(var e=0,n=t.length;e<n;++e)this.remove(t[e]);return this}function Qp(){return this._root}function Zp(){var t=0;return this.visit(function(e){if(!e.length)do++t;while(e=e.next)}),t}function eg(t){var e=[],n,i=this._root,r,s,o,l,a;for(i&&e.push(new Pt(i,this._x0,this._y0,this._x1,this._y1));n=e.pop();)if(!t(i=n.node,s=n.x0,o=n.y0,l=n.x1,a=n.y1)&&i.length){var c=(s+l)/2,u=(o+a)/2;(r=i[3])&&e.push(new Pt(r,c,u,l,a)),(r=i[2])&&e.push(new Pt(r,s,u,c,a)),(r=i[1])&&e.push(new Pt(r,c,o,l,u)),(r=i[0])&&e.push(new Pt(r,s,o,c,u))}return this}function tg(t){var e=[],n=[],i;for(this._root&&e.push(new Pt(this._root,this._x0,this._y0,this._x1,this._y1));i=e.pop();){var r=i.node;if(r.length){var s,o=i.x0,l=i.y0,a=i.x1,c=i.y1,u=(o+a)/2,h=(l+c)/2;(s=r[0])&&e.push(new Pt(s,o,l,u,h)),(s=r[1])&&e.push(new Pt(s,u,l,a,h)),(s=r[2])&&e.push(new Pt(s,o,h,u,c)),(s=r[3])&&e.push(new Pt(s,u,h,a,c))}n.push(i)}for(;i=n.pop();)t(i.node,i.x0,i.y0,i.x1,i.y1);return this}function ng(t){return t[0]}function ig(t){return arguments.length?(this._x=t,this):this._x}function rg(t){return t[1]}function sg(t){return arguments.length?(this._y=t,this):this._y}function ls(t,e,n){var i=new as(e??ng,n??rg,NaN,NaN,NaN,NaN);return t==null?i:i.addAll(t)}function as(t,e,n,i,r,s){this._x=t,this._y=e,this._x0=n,this._y0=i,this._x1=r,this._y1=s,this._root=void 0}function El(t){for(var e={data:t.data},n=e;t=t.next;)n=n.next={data:t.data};return e}var Ot=ls.prototype=as.prototype;Ot.copy=function(){var t=new as(this._x,this._y,this._x0,this._y0,this._x1,this._y1),e=this._root,n,i;if(!e)return t;if(!e.length)return t._root=El(e),t;for(n=[{source:e,target:t._root=new Array(4)}];e=n.pop();)for(var r=0;r<4;++r)(i=e.source[r])&&(i.length?n.push({source:i,target:e.target[r]=new Array(4)}):e.target[r]=El(i));return t},Ot.add=Bp,Ot.addAll=qp,Ot.cover=Kp,Ot.data=Wp,Ot.extent=Yp,Ot.find=Gp,Ot.remove=Xp,Ot.removeAll=Jp,Ot.root=Qp,Ot.size=Zp,Ot.visit=eg,Ot.visitAfter=tg,Ot.x=ig,Ot.y=sg;function Lt(t){return function(){return t}}function kn(t){return(t()-.5)*1e-6}function og(t){return t.x+t.vx}function lg(t){return t.y+t.vy}function Cl(t){var e,n,i,r=1,s=1;typeof t!="function"&&(t=Lt(t==null?1:+t));function o(){for(var c,u=e.length,h,f,d,m,p,g,_=0;_<s;++_)for(h=ls(e,og,lg).visitAfter(l),c=0;c<u;++c)f=e[c],p=n[f.index],g=p*p,d=f.x+f.vx,m=f.y+f.vy,h.visit(S);function S(C,w,k,T,N){var E=C.data,M=C.r,O=p+M;if(E){if(E.index>f.index){var L=d-E.x-E.vx,j=m-E.y-E.vy,R=L*L+j*j;R<O*O&&(L===0&&(L=kn(i),R+=L*L),j===0&&(j=kn(i),R+=j*j),R=(O-(R=Math.sqrt(R)))/R*r,f.vx+=(L*=R)*(O=(M*=M)/(g+M)),f.vy+=(j*=R)*O,E.vx-=L*(O=1-O),E.vy-=j*O)}return}return w>d+O||T<d-O||k>m+O||N<m-O}}function l(c){if(c.data)return c.r=n[c.data.index];for(var u=c.r=0;u<4;++u)c[u]&&c[u].r>c.r&&(c.r=c[u].r)}function a(){if(e){var c,u=e.length,h;for(n=new Array(u),c=0;c<u;++c)h=e[c],n[h.index]=+t(h,c,e)}}return o.initialize=function(c,u){e=c,i=u,a()},o.iterations=function(c){return arguments.length?(s=+c,o):s},o.strength=function(c){return arguments.length?(r=+c,o):r},o.radius=function(c){return arguments.length?(t=typeof c=="function"?c:Lt(+c),a(),o):t},o}function ag(t){return t.index}function Il(t,e){var n=t.get(e);if(!n)throw new Error("node not found: "+e);return n}function xl(t){var e=ag,n=h,i,r=Lt(30),s,o,l,a,c,u=1;t==null&&(t=[]);function h(g){return 1/Math.min(l[g.source.index],l[g.target.index])}function f(g){for(var _=0,S=t.length;_<u;++_)for(var C=0,w,k,T,N,E,M,O;C<S;++C)w=t[C],k=w.source,T=w.target,N=T.x+T.vx-k.x-k.vx||kn(c),E=T.y+T.vy-k.y-k.vy||kn(c),M=Math.sqrt(N*N+E*E),M=(M-s[C])/M*g*i[C],N*=M,E*=M,T.vx-=N*(O=a[C]),T.vy-=E*O,k.vx+=N*(O=1-O),k.vy+=E*O}function d(){if(o){var g,_=o.length,S=t.length,C=new Map(o.map((k,T)=>[e(k,T,o),k])),w;for(g=0,l=new Array(_);g<S;++g)w=t[g],w.index=g,typeof w.source!="object"&&(w.source=Il(C,w.source)),typeof w.target!="object"&&(w.target=Il(C,w.target)),l[w.source.index]=(l[w.source.index]||0)+1,l[w.target.index]=(l[w.target.index]||0)+1;for(g=0,a=new Array(S);g<S;++g)w=t[g],a[g]=l[w.source.index]/(l[w.source.index]+l[w.target.index]);i=new Array(S),m(),s=new Array(S),p()}}function m(){if(o)for(var g=0,_=t.length;g<_;++g)i[g]=+n(t[g],g,t)}function p(){if(o)for(var g=0,_=t.length;g<_;++g)s[g]=+r(t[g],g,t)}return f.initialize=function(g,_){o=g,c=_,d()},f.links=function(g){return arguments.length?(t=g,d(),f):t},f.id=function(g){return arguments.length?(e=g,f):e},f.iterations=function(g){return arguments.length?(u=+g,f):u},f.strength=function(g){return arguments.length?(n=typeof g=="function"?g:Lt(+g),m(),f):n},f.distance=function(g){return arguments.length?(r=typeof g=="function"?g:Lt(+g),p(),f):r},f}const cg=1664525,ug=1013904223,Ml=4294967296;function fg(){let t=1;return()=>(t=(cg*t+ug)%Ml)/Ml}function dg(t){return t.x}function hg(t){return t.y}var mg=10,pg=Math.PI*(3-Math.sqrt(5));function Al(t){var e,n=1,i=.001,r=1-Math.pow(i,1/300),s=0,o=.6,l=new Map,a=ts(h),c=ci("tick","end"),u=fg();t==null&&(t=[]);function h(){f(),c.call("tick",e),n<i&&(a.stop(),c.call("end",e))}function f(p){var g,_=t.length,S;p===void 0&&(p=1);for(var C=0;C<p;++C)for(n+=(s-n)*r,l.forEach(function(w){w(n)}),g=0;g<_;++g)S=t[g],S.fx==null?S.x+=S.vx*=o:(S.x=S.fx,S.vx=0),S.fy==null?S.y+=S.vy*=o:(S.y=S.fy,S.vy=0);return e}function d(){for(var p=0,g=t.length,_;p<g;++p){if(_=t[p],_.index=p,_.fx!=null&&(_.x=_.fx),_.fy!=null&&(_.y=_.fy),isNaN(_.x)||isNaN(_.y)){var S=mg*Math.sqrt(.5+p),C=p*pg;_.x=S*Math.cos(C),_.y=S*Math.sin(C)}(isNaN(_.vx)||isNaN(_.vy))&&(_.vx=_.vy=0)}}function m(p){return p.initialize&&p.initialize(t,u),p}return d(),e={tick:f,restart:function(){return a.restart(h),e},stop:function(){return a.stop(),e},nodes:function(p){return arguments.length?(t=p,d(),l.forEach(m),e):t},alpha:function(p){return arguments.length?(n=+p,e):n},alphaMin:function(p){return arguments.length?(i=+p,e):i},alphaDecay:function(p){return arguments.length?(r=+p,e):+r},alphaTarget:function(p){return arguments.length?(s=+p,e):s},velocityDecay:function(p){return arguments.length?(o=1-p,e):1-o},randomSource:function(p){return arguments.length?(u=p,l.forEach(m),e):u},force:function(p,g){return arguments.length>1?(g==null?l.delete(p):l.set(p,m(g)),e):l.get(p)},find:function(p,g,_){var S=0,C=t.length,w,k,T,N,E;for(_==null?_=1/0:_*=_,S=0;S<C;++S)N=t[S],w=p-N.x,k=g-N.y,T=w*w+k*k,T<_&&(E=N,_=T);return E},on:function(p,g){return arguments.length>1?(c.on(p,g),e):c.on(p)}}}function Tl(){var t,e,n,i,r=Lt(-30),s,o=1,l=1/0,a=.81;function c(d){var m,p=t.length,g=ls(t,dg,hg).visitAfter(h);for(i=d,m=0;m<p;++m)e=t[m],g.visit(f)}function u(){if(t){var d,m=t.length,p;for(s=new Array(m),d=0;d<m;++d)p=t[d],s[p.index]=+r(p,d,t)}}function h(d){var m=0,p,g,_=0,S,C,w;if(d.length){for(S=C=w=0;w<4;++w)(p=d[w])&&(g=Math.abs(p.value))&&(m+=p.value,_+=g,S+=g*p.x,C+=g*p.y);d.x=S/_,d.y=C/_}else{p=d,p.x=p.data.x,p.y=p.data.y;do m+=s[p.data.index];while(p=p.next)}d.value=m}function f(d,m,p,g){if(!d.value)return!0;var _=d.x-e.x,S=d.y-e.y,C=g-m,w=_*_+S*S;if(C*C/a<w)return w<l&&(_===0&&(_=kn(n),w+=_*_),S===0&&(S=kn(n),w+=S*S),w<o&&(w=Math.sqrt(o*w)),e.vx+=_*d.value*i/w,e.vy+=S*d.value*i/w),!0;if(d.length||w>=l)return;(d.data!==e||d.next)&&(_===0&&(_=kn(n),w+=_*_),S===0&&(S=kn(n),w+=S*S),w<o&&(w=Math.sqrt(o*w)));do d.data!==e&&(C=s[d.data.index]*i/w,e.vx+=_*C,e.vy+=S*C);while(d=d.next)}return c.initialize=function(d,m){t=d,n=m,u()},c.strength=function(d){return arguments.length?(r=typeof d=="function"?d:Lt(+d),u(),c):r},c.distanceMin=function(d){return arguments.length?(o=d*d,c):Math.sqrt(o)},c.distanceMax=function(d){return arguments.length?(l=d*d,c):Math.sqrt(l)},c.theta=function(d){return arguments.length?(a=d*d,c):Math.sqrt(a)},c}function Nl(t){var e=Lt(.1),n,i,r;typeof t!="function"&&(t=Lt(t==null?0:+t));function s(l){for(var a=0,c=n.length,u;a<c;++a)u=n[a],u.vx+=(r[a]-u.x)*i[a]*l}function o(){if(n){var l,a=n.length;for(i=new Array(a),r=new Array(a),l=0;l<a;++l)i[l]=isNaN(r[l]=+t(n[l],l,n))?0:+e(n[l],l,n)}}return s.initialize=function(l){n=l,o()},s.strength=function(l){return arguments.length?(e=typeof l=="function"?l:Lt(+l),o(),s):e},s.x=function(l){return arguments.length?(t=typeof l=="function"?l:Lt(+l),o(),s):t},s}function Pl(t){var e=Lt(.1),n,i,r;typeof t!="function"&&(t=Lt(t==null?0:+t));function s(l){for(var a=0,c=n.length,u;a<c;++a)u=n[a],u.vy+=(r[a]-u.y)*i[a]*l}function o(){if(n){var l,a=n.length;for(i=new Array(a),r=new Array(a),l=0;l<a;++l)i[l]=isNaN(r[l]=+t(n[l],l,n))?0:+e(n[l],l,n)}}return s.initialize=function(l){n=l,o()},s.strength=function(l){return arguments.length?(e=typeof l=="function"?l:Lt(+l),o(),s):e},s.y=function(l){return arguments.length?(t=typeof l=="function"?l:Lt(+l),o(),s):t},s}function gg(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)}function dr(t,e){if((n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var n,i=t.slice(0,n);return[i.length>1?i[0]+i.slice(2):i,+t.slice(n+1)]}function Qn(t){return t=dr(Math.abs(t)),t?t[1]:NaN}function _g(t,e){return function(n,i){for(var r=n.length,s=[],o=0,l=t[0],a=0;r>0&&l>0&&(a+l+1>i&&(l=Math.max(1,i-a)),s.push(n.substring(r-=l,r+l)),!((a+=l+1)>i));)l=t[o=(o+1)%t.length];return s.reverse().join(e)}}function vg(t){return function(e){return e.replace(/[0-9]/g,function(n){return t[+n]})}}var yg=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function hr(t){if(!(e=yg.exec(t)))throw new Error("invalid format: "+t);var e;return new cs({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}hr.prototype=cs.prototype;function cs(t){this.fill=t.fill===void 0?" ":t.fill+"",this.align=t.align===void 0?">":t.align+"",this.sign=t.sign===void 0?"-":t.sign+"",this.symbol=t.symbol===void 0?"":t.symbol+"",this.zero=!!t.zero,this.width=t.width===void 0?void 0:+t.width,this.comma=!!t.comma,this.precision=t.precision===void 0?void 0:+t.precision,this.trim=!!t.trim,this.type=t.type===void 0?"":t.type+""}cs.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function bg(t){e:for(var e=t.length,n=1,i=-1,r;n<e;++n)switch(t[n]){case".":i=r=n;break;case"0":i===0&&(i=n),r=n;break;default:if(!+t[n])break e;i>0&&(i=0);break}return i>0?t.slice(0,i)+t.slice(r+1):t}var Ol;function wg(t,e){var n=dr(t,e);if(!n)return t+"";var i=n[0],r=n[1],s=r-(Ol=Math.max(-8,Math.min(8,Math.floor(r/3)))*3)+1,o=i.length;return s===o?i:s>o?i+new Array(s-o+1).join("0"):s>0?i.slice(0,s)+"."+i.slice(s):"0."+new Array(1-s).join("0")+dr(t,Math.max(0,e+s-1))[0]}function Ll(t,e){var n=dr(t,e);if(!n)return t+"";var i=n[0],r=n[1];return r<0?"0."+new Array(-r).join("0")+i:i.length>r+1?i.slice(0,r+1)+"."+i.slice(r+1):i+new Array(r-i.length+2).join("0")}const Dl={"%":(t,e)=>(t*100).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:gg,e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>Ll(t*100,e),r:Ll,s:wg,X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function Rl(t){return t}var $l=Array.prototype.map,zl=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function Sg(t){var e=t.grouping===void 0||t.thousands===void 0?Rl:_g($l.call(t.grouping,Number),t.thousands+""),n=t.currency===void 0?"":t.currency[0]+"",i=t.currency===void 0?"":t.currency[1]+"",r=t.decimal===void 0?".":t.decimal+"",s=t.numerals===void 0?Rl:vg($l.call(t.numerals,String)),o=t.percent===void 0?"%":t.percent+"",l=t.minus===void 0?"−":t.minus+"",a=t.nan===void 0?"NaN":t.nan+"";function c(h){h=hr(h);var f=h.fill,d=h.align,m=h.sign,p=h.symbol,g=h.zero,_=h.width,S=h.comma,C=h.precision,w=h.trim,k=h.type;k==="n"?(S=!0,k="g"):Dl[k]||(C===void 0&&(C=12),w=!0,k="g"),(g||f==="0"&&d==="=")&&(g=!0,f="0",d="=");var T=p==="$"?n:p==="#"&&/[boxX]/.test(k)?"0"+k.toLowerCase():"",N=p==="$"?i:/[%p]/.test(k)?o:"",E=Dl[k],M=/[defgprs%]/.test(k);C=C===void 0?6:/[gprs]/.test(k)?Math.max(1,Math.min(21,C)):Math.max(0,Math.min(20,C));function O(L){var j=T,R=N,x,H,P;if(k==="c")R=E(L)+R,L="";else{L=+L;var X=L<0||1/L<0;if(L=isNaN(L)?a:E(Math.abs(L),C),w&&(L=bg(L)),X&&+L==0&&m!=="+"&&(X=!1),j=(X?m==="("?m:l:m==="-"||m==="("?"":m)+j,R=(k==="s"?zl[8+Ol/3]:"")+R+(X&&m==="("?")":""),M){for(x=-1,H=L.length;++x<H;)if(P=L.charCodeAt(x),48>P||P>57){R=(P===46?r+L.slice(x+1):L.slice(x))+R,L=L.slice(0,x);break}}}S&&!g&&(L=e(L,1/0));var U=j.length+L.length+R.length,K=U<_?new Array(_-U+1).join(f):"";switch(S&&g&&(L=e(K+L,K.length?_-R.length:1/0),K=""),d){case"<":L=j+L+R+K;break;case"=":L=j+K+L+R;break;case"^":L=K.slice(0,U=K.length>>1)+j+L+R+K.slice(U);break;default:L=K+j+L+R;break}return s(L)}return O.toString=function(){return h+""},O}function u(h,f){var d=c((h=hr(h),h.type="f",h)),m=Math.max(-8,Math.min(8,Math.floor(Qn(f)/3)))*3,p=Math.pow(10,-m),g=zl[8+m/3];return function(_){return d(p*_)+g}}return{format:c,formatPrefix:u}}var mr,jl,Fl;kg({thousands:",",grouping:[3],currency:["$",""]});function kg(t){return mr=Sg(t),jl=mr.format,Fl=mr.formatPrefix,mr}function Eg(t){return Math.max(0,-Qn(Math.abs(t)))}function Cg(t,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Qn(e)/3)))*3-Qn(Math.abs(t)))}function Ig(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,Qn(e)-Qn(t))+1}function us(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t);break}return this}const Hl=Symbol("implicit");function Vl(){var t=new xo,e=[],n=[],i=Hl;function r(s){let o=t.get(s);if(o===void 0){if(i!==Hl)return i;t.set(s,o=e.push(s)-1)}return n[o%n.length]}return r.domain=function(s){if(!arguments.length)return e.slice();e=[],t=new xo;for(const o of s)t.has(o)||t.set(o,e.push(o)-1);return r},r.range=function(s){return arguments.length?(n=Array.from(s),r):n.slice()},r.unknown=function(s){return arguments.length?(i=s,r):i},r.copy=function(){return Vl(e,n).unknown(i)},us.apply(r,arguments),r}function Ul(){var t=Vl().unknown(void 0),e=t.domain,n=t.range,i=0,r=1,s,o,l=!1,a=0,c=0,u=.5;delete t.unknown;function h(){var f=e().length,d=r<i,m=d?r:i,p=d?i:r;s=(p-m)/Math.max(1,f-a+c*2),l&&(s=Math.floor(s)),m+=(p-m-s*(f-a))*u,o=s*(1-a),l&&(m=Math.round(m),o=Math.round(o));var g=qi(f).map(function(_){return m+s*_});return n(d?g.reverse():g)}return t.domain=function(f){return arguments.length?(e(f),h()):e()},t.range=function(f){return arguments.length?([i,r]=f,i=+i,r=+r,h()):[i,r]},t.rangeRound=function(f){return[i,r]=f,i=+i,r=+r,l=!0,h()},t.bandwidth=function(){return o},t.step=function(){return s},t.round=function(f){return arguments.length?(l=!!f,h()):l},t.padding=function(f){return arguments.length?(a=Math.min(1,c=+f),h()):a},t.paddingInner=function(f){return arguments.length?(a=Math.min(1,f),h()):a},t.paddingOuter=function(f){return arguments.length?(c=+f,h()):c},t.align=function(f){return arguments.length?(u=Math.max(0,Math.min(1,f)),h()):u},t.copy=function(){return Ul(e(),[i,r]).round(l).paddingInner(a).paddingOuter(c).align(u)},us.apply(h(),arguments)}function xg(t){return function(){return t}}function Mg(t){return+t}var Bl=[0,1];function Zn(t){return t}function fs(t,e){return(e-=t=+t)?function(n){return(n-t)/e}:xg(isNaN(e)?NaN:.5)}function Ag(t,e){var n;return t>e&&(n=t,t=e,e=n),function(i){return Math.max(t,Math.min(e,i))}}function Tg(t,e,n){var i=t[0],r=t[1],s=e[0],o=e[1];return r<i?(i=fs(r,i),s=n(o,s)):(i=fs(i,r),s=n(s,o)),function(l){return s(i(l))}}function Ng(t,e,n){var i=Math.min(t.length,e.length)-1,r=new Array(i),s=new Array(i),o=-1;for(t[i]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++o<i;)r[o]=fs(t[o],t[o+1]),s[o]=n(e[o],e[o+1]);return function(l){var a=ed(t,l,1,i)-1;return s[a](r[a](l))}}function Pg(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function Og(){var t=Bl,e=Bl,n=Qr,i,r,s,o=Zn,l,a,c;function u(){var f=Math.min(t.length,e.length);return o!==Zn&&(o=Ag(t[0],t[f-1])),l=f>2?Ng:Tg,a=c=null,h}function h(f){return f==null||isNaN(f=+f)?s:(a||(a=l(t.map(i),e,n)))(i(o(f)))}return h.invert=function(f){return o(r((c||(c=l(e,t.map(i),Zt)))(f)))},h.domain=function(f){return arguments.length?(t=Array.from(f,Mg),u()):t.slice()},h.range=function(f){return arguments.length?(e=Array.from(f),u()):e.slice()},h.rangeRound=function(f){return e=Array.from(f),n=Em,u()},h.clamp=function(f){return arguments.length?(o=f?!0:Zn,u()):o!==Zn},h.interpolate=function(f){return arguments.length?(n=f,u()):n},h.unknown=function(f){return arguments.length?(s=f,h):s},function(f,d){return i=f,r=d,u()}}function Lg(){return Og()(Zn,Zn)}function Dg(t,e,n,i){var r=ad(t,e,n),s;switch(i=hr(i??",f"),i.type){case"s":{var o=Math.max(Math.abs(t),Math.abs(e));return i.precision==null&&!isNaN(s=Cg(r,o))&&(i.precision=s),Fl(i,o)}case"":case"e":case"g":case"p":case"r":{i.precision==null&&!isNaN(s=Ig(r,Math.max(Math.abs(t),Math.abs(e))))&&(i.precision=s-(i.type==="e"));break}case"f":case"%":{i.precision==null&&!isNaN(s=Eg(r))&&(i.precision=s-(i.type==="%")*2);break}}return jl(i)}function Rg(t){var e=t.domain;return t.ticks=function(n){var i=e();return ld(i[0],i[i.length-1],n??10)},t.tickFormat=function(n,i){var r=e();return Dg(r[0],r[r.length-1],n??10,i)},t.nice=function(n){n==null&&(n=10);var i=e(),r=0,s=i.length-1,o=i[r],l=i[s],a,c,u=10;for(l<o&&(c=o,o=l,l=c,c=r,r=s,s=c);u-- >0;){if(c=jr(o,l,n),c===a)return i[r]=o,i[s]=l,e(i);if(c>0)o=Math.floor(o/c)*c,l=Math.ceil(l/c)*c;else if(c<0)o=Math.ceil(o*c)/c,l=Math.floor(l*c)/c;else break;a=c}return t},t}function yi(){var t=Lg();return t.copy=function(){return Pg(t,yi())},us.apply(t,arguments),Rg(t)}const pr=t=>()=>t;function $g(t,{sourceEvent:e,target:n,transform:i,dispatch:r}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:i,enumerable:!0,configurable:!0},_:{value:r}})}function dn(t,e,n){this.k=t,this.x=e,this.y=n}dn.prototype={constructor:dn,scale:function(t){return t===1?this:new dn(this.k*t,this.x,this.y)},translate:function(t,e){return t===0&e===0?this:new dn(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var ds=new dn(1,0,0);dn.prototype;function hs(t){t.stopImmediatePropagation()}function bi(t){t.preventDefault(),t.stopImmediatePropagation()}function zg(t){return(!t.ctrlKey||t.type==="wheel")&&!t.button}function jg(){var t=this;return t instanceof SVGElement?(t=t.ownerSVGElement||t,t.hasAttribute("viewBox")?(t=t.viewBox.baseVal,[[t.x,t.y],[t.x+t.width,t.y+t.height]]):[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]):[[0,0],[t.clientWidth,t.clientHeight]]}function ql(){return this.__zoom||ds}function Fg(t){return-t.deltaY*(t.deltaMode===1?.05:t.deltaMode?1:.002)*(t.ctrlKey?10:1)}function Hg(){return navigator.maxTouchPoints||"ontouchstart"in this}function Vg(t,e,n){var i=t.invertX(e[0][0])-n[0][0],r=t.invertX(e[1][0])-n[1][0],s=t.invertY(e[0][1])-n[0][1],o=t.invertY(e[1][1])-n[1][1];return t.translate(r>i?(i+r)/2:Math.min(0,i)||Math.max(0,r),o>s?(s+o)/2:Math.min(0,s)||Math.max(0,o))}function Kl(){var t=zg,e=jg,n=Vg,i=Fg,r=Hg,s=[0,1/0],o=[[-1/0,-1/0],[1/0,1/0]],l=250,a=Pm,c=ci("start","zoom","end"),u,h,f,d=500,m=150,p=0,g=10;function _(x){x.property("__zoom",ql).on("wheel.zoom",E,{passive:!1}).on("mousedown.zoom",M).on("dblclick.zoom",O).filter(r).on("touchstart.zoom",L).on("touchmove.zoom",j).on("touchend.zoom touchcancel.zoom",R).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}_.transform=function(x,H,P,X){var U=x.selection?x.selection():x;U.property("__zoom",ql),x!==U?k(x,H,P,X):U.interrupt().each(function(){T(this,arguments).event(X).start().zoom(null,typeof H=="function"?H.apply(this,arguments):H).end()})},_.scaleBy=function(x,H,P,X){_.scaleTo(x,function(){var U=this.__zoom.k,K=typeof H=="function"?H.apply(this,arguments):H;return U*K},P,X)},_.scaleTo=function(x,H,P,X){_.transform(x,function(){var U=e.apply(this,arguments),K=this.__zoom,Z=P==null?w(U):typeof P=="function"?P.apply(this,arguments):P,ae=K.invert(Z),ce=typeof H=="function"?H.apply(this,arguments):H;return n(C(S(K,ce),Z,ae),U,o)},P,X)},_.translateBy=function(x,H,P,X){_.transform(x,function(){return n(this.__zoom.translate(typeof H=="function"?H.apply(this,arguments):H,typeof P=="function"?P.apply(this,arguments):P),e.apply(this,arguments),o)},null,X)},_.translateTo=function(x,H,P,X,U){_.transform(x,function(){var K=e.apply(this,arguments),Z=this.__zoom,ae=X==null?w(K):typeof X=="function"?X.apply(this,arguments):X;return n(ds.translate(ae[0],ae[1]).scale(Z.k).translate(typeof H=="function"?-H.apply(this,arguments):-H,typeof P=="function"?-P.apply(this,arguments):-P),K,o)},X,U)};function S(x,H){return H=Math.max(s[0],Math.min(s[1],H)),H===x.k?x:new dn(H,x.x,x.y)}function C(x,H,P){var X=H[0]-P[0]*x.k,U=H[1]-P[1]*x.k;return X===x.x&&U===x.y?x:new dn(x.k,X,U)}function w(x){return[(+x[0][0]+ +x[1][0])/2,(+x[0][1]+ +x[1][1])/2]}function k(x,H,P,X){x.on("start.zoom",function(){T(this,arguments).event(X).start()}).on("interrupt.zoom end.zoom",function(){T(this,arguments).event(X).end()}).tween("zoom",function(){var U=this,K=arguments,Z=T(U,K).event(X),ae=e.apply(U,K),ce=P==null?w(ae):typeof P=="function"?P.apply(U,K):P,de=Math.max(ae[1][0]-ae[0][0],ae[1][1]-ae[0][1]),fe=U.__zoom,De=typeof H=="function"?H.apply(U,K):H,Ke=a(fe.invert(ce).concat(de/fe.k),De.invert(ce).concat(de/De.k));return function(he){if(he===1)he=De;else{var Y=Ke(he),te=de/Y[2];he=new dn(te,ce[0]-Y[0]*te,ce[1]-Y[1]*te)}Z.zoom(null,he)}})}function T(x,H,P){return!P&&x.__zooming||new N(x,H)}function N(x,H){this.that=x,this.args=H,this.active=0,this.sourceEvent=null,this.extent=e.apply(x,H),this.taps=0}N.prototype={event:function(x){return x&&(this.sourceEvent=x),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(x,H){return this.mouse&&x!=="mouse"&&(this.mouse[1]=H.invert(this.mouse[0])),this.touch0&&x!=="touch"&&(this.touch0[1]=H.invert(this.touch0[0])),this.touch1&&x!=="touch"&&(this.touch1[1]=H.invert(this.touch1[0])),this.that.__zoom=H,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(x){var H=mt(this.that).datum();c.call(x,this.that,new $g(x,{sourceEvent:this.sourceEvent,target:_,type:x,transform:this.that.__zoom,dispatch:c}),H)}};function E(x,...H){if(!t.apply(this,arguments))return;var P=T(this,H).event(x),X=this.__zoom,U=Math.max(s[0],Math.min(s[1],X.k*Math.pow(2,i.apply(this,arguments)))),K=wt(x);if(P.wheel)(P.mouse[0][0]!==K[0]||P.mouse[0][1]!==K[1])&&(P.mouse[1]=X.invert(P.mouse[0]=K)),clearTimeout(P.wheel);else{if(X.k===U)return;P.mouse=[K,X.invert(K)],fr(this),P.start()}bi(x),P.wheel=setTimeout(Z,m),P.zoom("mouse",n(C(S(X,U),P.mouse[0],P.mouse[1]),P.extent,o));function Z(){P.wheel=null,P.end()}}function M(x,...H){if(f||!t.apply(this,arguments))return;var P=x.currentTarget,X=T(this,H,!0).event(x),U=mt(x.view).on("mousemove.zoom",ce,!0).on("mouseup.zoom",de,!0),K=wt(x,P),Z=x.clientX,ae=x.clientY;Yo(x.view),hs(x),X.mouse=[K,this.__zoom.invert(K)],fr(this),X.start();function ce(fe){if(bi(fe),!X.moved){var De=fe.clientX-Z,Ke=fe.clientY-ae;X.moved=De*De+Ke*Ke>p}X.event(fe).zoom("mouse",n(C(X.that.__zoom,X.mouse[0]=wt(fe,P),X.mouse[1]),X.extent,o))}function de(fe){U.on("mousemove.zoom mouseup.zoom",null),Go(fe.view,X.moved),bi(fe),X.event(fe).end()}}function O(x,...H){if(t.apply(this,arguments)){var P=this.__zoom,X=wt(x.changedTouches?x.changedTouches[0]:x,this),U=P.invert(X),K=P.k*(x.shiftKey?.5:2),Z=n(C(S(P,K),X,U),e.apply(this,H),o);bi(x),l>0?mt(this).transition().duration(l).call(k,Z,X,x):mt(this).call(_.transform,Z,X,x)}}function L(x,...H){if(t.apply(this,arguments)){var P=x.touches,X=P.length,U=T(this,H,x.changedTouches.length===X).event(x),K,Z,ae,ce;for(hs(x),Z=0;Z<X;++Z)ae=P[Z],ce=wt(ae,this),ce=[ce,this.__zoom.invert(ce),ae.identifier],U.touch0?!U.touch1&&U.touch0[2]!==ce[2]&&(U.touch1=ce,U.taps=0):(U.touch0=ce,K=!0,U.taps=1+!!u);u&&(u=clearTimeout(u)),K&&(U.taps<2&&(h=ce[0],u=setTimeout(function(){u=null},d)),fr(this),U.start())}}function j(x,...H){if(this.__zooming){var P=T(this,H).event(x),X=x.changedTouches,U=X.length,K,Z,ae,ce;for(bi(x),K=0;K<U;++K)Z=X[K],ae=wt(Z,this),P.touch0&&P.touch0[2]===Z.identifier?P.touch0[0]=ae:P.touch1&&P.touch1[2]===Z.identifier&&(P.touch1[0]=ae);if(Z=P.that.__zoom,P.touch1){var de=P.touch0[0],fe=P.touch0[1],De=P.touch1[0],Ke=P.touch1[1],he=(he=De[0]-de[0])*he+(he=De[1]-de[1])*he,Y=(Y=Ke[0]-fe[0])*Y+(Y=Ke[1]-fe[1])*Y;Z=S(Z,Math.sqrt(he/Y)),ae=[(de[0]+De[0])/2,(de[1]+De[1])/2],ce=[(fe[0]+Ke[0])/2,(fe[1]+Ke[1])/2]}else if(P.touch0)ae=P.touch0[0],ce=P.touch0[1];else return;P.zoom("touch",n(C(Z,ae,ce),P.extent,o))}}function R(x,...H){if(this.__zooming){var P=T(this,H).event(x),X=x.changedTouches,U=X.length,K,Z;for(hs(x),f&&clearTimeout(f),f=setTimeout(function(){f=null},d),K=0;K<U;++K)Z=X[K],P.touch0&&P.touch0[2]===Z.identifier?delete P.touch0:P.touch1&&P.touch1[2]===Z.identifier&&delete P.touch1;if(P.touch1&&!P.touch0&&(P.touch0=P.touch1,delete P.touch1),P.touch0)P.touch0[1]=this.__zoom.invert(P.touch0[0]);else if(P.end(),P.taps===2&&(Z=wt(Z,this),Math.hypot(h[0]-Z[0],h[1]-Z[1])<g)){var ae=mt(this).on("dblclick.zoom");ae&&ae.apply(this,arguments)}}}return _.wheelDelta=function(x){return arguments.length?(i=typeof x=="function"?x:pr(+x),_):i},_.filter=function(x){return arguments.length?(t=typeof x=="function"?x:pr(!!x),_):t},_.touchable=function(x){return arguments.length?(r=typeof x=="function"?x:pr(!!x),_):r},_.extent=function(x){return arguments.length?(e=typeof x=="function"?x:pr([[+x[0][0],+x[0][1]],[+x[1][0],+x[1][1]]]),_):e},_.scaleExtent=function(x){return arguments.length?(s[0]=+x[0],s[1]=+x[1],_):[s[0],s[1]]},_.translateExtent=function(x){return arguments.length?(o[0][0]=+x[0][0],o[1][0]=+x[1][0],o[0][1]=+x[0][1],o[1][1]=+x[1][1],_):[[o[0][0],o[0][1]],[o[1][0],o[1][1]]]},_.constrain=function(x){return arguments.length?(n=x,_):n},_.duration=function(x){return arguments.length?(l=+x,_):l},_.interpolate=function(x){return arguments.length?(a=x,_):a},_.on=function(){var x=c.on.apply(c,arguments);return x===c?_:x},_.clickDistance=function(x){return arguments.length?(p=(x=+x)*x,_):Math.sqrt(p)},_.tapDistance=function(x){return arguments.length?(g=+x,_):g},_}function Ug(t,e,n=null,i,r=null){const s=mt(t);s.selectAll("*").remove();const o=s.node(),l=o.getBoundingClientRect();let a=l.width||800,c=l.height||600;const u=a/2,h=c/2,f=s.append("canvas").attr("class","network-canvas").attr("width",a).attr("height",c).style("width",a+"px").style("height",c+"px").style("cursor","default"),d=f.node().getContext("2d",{alpha:!1});let m=ds;const p=new Set,g={current:null};function _(){const L=o.getBoundingClientRect(),j=L.width||800,R=L.height||600;(j!==a||R!==c)&&(a=j,c=R,f.attr("width",a).attr("height",c).style("width",a+"px").style("height",c+"px"),O())}const S=new ResizeObserver(_);S.observe(o);const C=Al(e).force("link",xl(n).id(L=>L.id).distance(L=>L.distance)).force("charge",Tl().strength(-250)).force("center",Sl(u,h).strength(.7)).force("collide",Cl(L=>L.radius+10).strength(.5)).force("x",Nl(u).strength(.025)).force("y",Pl(h).strength(.025)).alphaDecay(.05).velocityDecay(.6);let w=null;C.on("tick",()=>{w||(w=requestAnimationFrame(()=>{O(),w=null}))}),C.tick(100);for(let L=0;L<100;L++)C.tick();C.alphaTarget(0);const k=Bg({canvas:f,nodes:e,transform:()=>m,hoveredNode:g,onSelectionChange:(L,j)=>{p.clear(),L.forEach(x=>p.add(x));const R=Kg(e,L,j);i(R),O()},render:()=>O()}),T=Kl().scaleExtent([.1,10]).filter(L=>!k.isSelectionMode()||L.type==="wheel").on("zoom",({transform:L})=>{m=L,O()});f.call(T);const{dragstarted:N,dragged:E,dragended:M}=qg(f,e,C,()=>m,g,()=>!k.isSelectionMode(),O);k.setupInteractions(f,{start:N,drag:E,end:M});function O(){d.save(),d.fillRect(0,0,a,c),d.translate(m.x,m.y),d.scale(m.k,m.k),d.strokeStyle="#8a8a8a",d.lineWidth=1/m.k,n.forEach(j=>{const R=j.source.x,x=j.source.y,H=j.target.x,P=j.target.y;d.globalAlpha=Math.max(.2,j.strength),d.lineWidth=j.width/m.k,d.beginPath(),d.moveTo(R,x),d.lineTo(H,P),d.stroke()}),d.globalAlpha=1,e.forEach(j=>{const R=p.has(j.id);d.fillStyle=j.color,d.beginPath(),d.arc(j.x,j.y,j.radius,0,2*Math.PI),d.fill(),R&&(d.strokeStyle="#0f2bff",d.lineWidth=3/m.k,d.stroke())});const L=k.getSelectionRect();if(L){d.strokeStyle="#0f2bff",d.fillStyle="rgba(15, 43, 255, 0.2)",d.lineWidth=2/m.k;const j=Math.min(L.x1,L.x2),R=Math.min(L.y1,L.y2),x=Math.abs(L.x2-L.x1),H=Math.abs(L.y2-L.y1);d.fillRect(j,R,x,H),d.strokeRect(j,R,x,H)}d.restore()}return O(),{destroy:()=>{w&&cancelAnimationFrame(w),C.stop(),S.disconnect(),f.remove()},toggleSelectionMode:()=>{const L=k.toggleSelectionMode();return r&&r(L),O(),L}}}function Bg(t){const{canvas:e,nodes:n,transform:i,hoveredNode:r,onSelectionChange:s,render:o}=t,l=new Set,a=[];let c=!1,u=null;function h(){return c=!c,e.style("cursor",c?"crosshair":"default"),c}function f(p){if(l.has(p)){l.delete(p);const g=a.indexOf(p);g>-1&&a.splice(g,1)}else l.add(p),a.push(p);s(l,a)}function d(p,g){const _=i(),S=(p-_.x)/_.k,C=(g-_.y)/_.k;for(let w=n.length-1;w>=0;w--){const k=n[w],T=S-k.x,N=C-k.y;if(Math.sqrt(T*T+N*N)<k.radius)return k}return null}function m(p,g){let _=null;p.on("mousedown",function(S){const[C,w]=wt(S),k=d(C,w);if(c){const T=i(),N=(C-T.x)/T.k,E=(w-T.y)/T.k;u={x1:N,y1:E,x2:N,y2:E},o()}else k&&(_=k,g.start(S,k))}),p.on("mousemove",function(S){const[C,w]=wt(S);if(c){if(u){const k=i(),T=(C-k.x)/k.k,N=(w-k.y)/k.k;u.x2=T,u.y2=N,o()}}else if(_)g.drag(S,_,C,w);else{const k=d(C,w);r.current!==k&&(r.current=k,p.style("cursor",k?"pointer":"default"),o())}}),p.on("mouseup",function(S){if(c){if(u){const C=Math.min(u.x1,u.x2),w=Math.min(u.y1,u.y2),k=Math.max(u.x1,u.x2),T=Math.max(u.y1,u.y2);l.clear(),a.length=0;const N=[];n.forEach(E=>{E.x>=C&&E.x<=k&&E.y>=w&&E.y<=T&&N.push({id:E.id,y:E.y})}),N.sort((E,M)=>E.y-M.y),N.forEach(({id:E})=>{l.add(E),a.push(E)}),s(l,a),u=null,o()}}else if(_)g.end(S,_),_=null;else{const[C,w]=wt(S),k=d(C,w);k&&f(k.id)}})}return{toggleSelectionMode:h,isSelectionMode:()=>c,setupInteractions:m,getSelectionRect:()=>u}}function qg(t,e,n,i,r,s,o){let l=null;function a(h,f){s()&&(h.active||n.alphaTarget(.3).restart(),l=f,f.fx=f.x,f.fy=f.y)}function c(h,f,d,m){if(!l||!s())return;const p=i();f.fx=(d-p.x)/p.k,f.fy=(m-p.y)/p.k,o()}function u(h,f){!l||!s()||(h.active||n.alphaTarget(0),f.fx=null,f.fy=null,l=null)}return{dragstarted:a,dragged:c,dragended:u}}function Kg(t,e,n){const i=new Map(t.map(r=>[r.id,r]));return n.map(r=>i.get(r)).filter(Boolean)}const Wl=8,Wg=1.5,Yg=50,Yl=.5,Gg=800,Xg=600;function Jg(t,e,n=null,i=null,r=null){const s=Gg/2,o=Xg/2,a=mt(t).append("svg").attr("class","network-svg"),c=a.append("g"),u=c.append("g").selectAll("line").data(n).join("line").attr("class","link").attr("stroke-width",m=>m.width||Wg).attr("stroke-opacity",m=>Math.max(.2,m.strength||Yl)),h=c.append("g").selectAll("circle").data(e).join("circle").attr("class","node").attr("r",m=>m.radius||Wl).attr("fill",m=>m.color);h.append("title").text(m=>m.label);const f=Al(e).force("link",xl(n).id(m=>m.id).distance(m=>m.distance||Yg)).force("charge",Tl().strength(-250)).force("center",Sl(s,o).strength(.7)).force("collide",Cl(m=>(m.radius||Wl)+10).strength(Yl)).force("x",Nl(s).strength(.025)).force("y",Pl(o).strength(.025));let d=null;if(i){d=Qg({svg:a,g:c,nodes:e,onSelectionChange:(_,S)=>{h.classed("selected",w=>_.has(w.id));const C=e_(e,_,S);i(C)}}),a.call(Kl().scaleExtent([.1,10]).filter(_=>!d.isSelectionMode()||_.type==="wheel").on("zoom",({transform:_})=>c.attr("transform",_)));const{dragstarted:m,dragged:p,dragended:g}=Zg(f,u,h);d.setupNodeClick(h),d.setupDrag(h,{start:m,drag:p,end:g})}return{destroy:()=>{f.stop(),a.remove()},toggleSelectionMode:()=>{if(d){const m=d.toggleSelectionMode();return r&&r(m),m}}}}function Qg(t){const{svg:e,g:n,nodes:i,onSelectionChange:r,getNodePosition:s=p=>({x:p.x,y:p.y}),getNodeId:o=p=>p.id}=t,l=new Set,a=[];let c=!1;function u(){return c=!c,e.style("cursor",c?"crosshair":"default"),c}function h(p){if(l.has(p)){l.delete(p);const g=a.indexOf(p);g>-1&&a.splice(g,1)}else l.add(p),a.push(p);r(l,a)}function f(){l.clear(),a.length=0,r(l,a)}let d=null,m=null;return e.on("mousedown",function(p){if(!c)return;p.preventDefault();const[g,_]=wt(p,n.node());d={x:g,y:_},m=n.append("rect").attr("class","selection-rect").attr("x",g).attr("y",_).attr("width",0).attr("height",0)}).on("mousemove",function(p){if(!c||!m)return;const[g,_]=wt(p,n.node()),S=g-d.x,C=_-d.y;m.attr("x",S<0?g:d.x).attr("y",C<0?_:d.y).attr("width",Math.abs(S)).attr("height",Math.abs(C))}).on("mouseup",function(p){if(!c||!m)return;const[g,_]=wt(p,n.node()),S=Math.min(d.x,g),C=Math.min(d.y,_),w=Math.max(d.x,g),k=Math.max(d.y,_);l.clear(),a.length=0;const T=[];i.forEach(N=>{const E=s(N);E.x>=S&&E.x<=w&&E.y>=C&&E.y<=k&&T.push({id:o(N),y:E.y})}),T.sort((N,E)=>N.y-E.y),T.forEach(({id:N})=>{l.add(N),a.push(N)}),r(l,a),m.remove(),m=null,d=null}),{toggleSelectionMode:u,toggleNode:h,clearSelection:f,isSelectionMode:()=>c,getSelectedNodes:()=>l,getSelectionOrder:()=>a,setupNodeClick:p=>{p.on("click",function(g,_){g.stopPropagation(),h(o(_))})},setupDrag:(p,g)=>{p.call(nm().filter(()=>!c).on("start",g.start).on("drag",g.drag).on("end",g.end))}}}function Zg(t,e,n){t.on("tick",()=>{e.attr("x1",o=>o.source.x).attr("y1",o=>o.source.y).attr("x2",o=>o.target.x).attr("y2",o=>o.target.y),n.attr("cx",o=>o.x).attr("cy",o=>o.y)});function i(o){o.active||t.alphaTarget(.3).restart(),o.subject.fx=o.subject.x,o.subject.fy=o.subject.y}function r(o){o.subject.fx=o.x,o.subject.fy=o.y}function s(o){o.active||t.alphaTarget(0),o.subject.fx=null,o.subject.fy=null}return{dragstarted:i,dragged:r,dragended:s}}function e_(t,e,n){const i=new Map(t.map(r=>[r.id,r]));return n.map(r=>i.get(r)).filter(Boolean)}const t_="modulepreload",n_=function(t){return"/"+t},Gl={},ms=function(e,n,i){return e()};function ps(t){const{type:e,modelName:n,title:i,extractMeta:r=d=>d}=t,s={id:null,type:e,title:i,selected:{}},o=JSON.parse(localStorage.getItem(e))||s,l=Pe(o),a=Pe(!1);function c(d,m=!1){a.set(m),localStorage.setItem(e,JSON.stringify(d))}function u(){l.update(d=>{if(e!=="documentSet")return console.error("Document set management is the only type currently supported for saving."),d;const m=Object.fromEntries(Object.entries(d.selected).map(([g,_])=>[g,Object.keys(_)])),p=d.id?`${d.id}/edit`:"new";return fetch(`${window.location.origin}/${n}/${p}`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":bn},body:JSON.stringify({title:d.title,selection:d,...m})}).then(g=>g.json()).then(g=>{if(!(g!=null&&g.document_set_id))throw new Error("Failed to save");l.update(_=>(_.id=g.document_set_id,_.title=g.document_set_title,c(_,!0),_))}).catch(g=>console.error("Error:",g)),d})}const h=d=>l.update(()=>{const m=d.selection.id?d.selection:{...d.selection,id:d.id};return c(m),m}),f=()=>l.update(()=>{const d={...s,selected:{}};return c(d),d});return{type:e,subscribe:l.subscribe,add:d=>l.update(m=>(m.selected[d.class]={...m.selected[d.class]||{},[d.id]:r(d)},c(m),m)),addAll:d=>l.update(m=>(d.forEach(p=>{m.selected[p.class]={...m.selected[p.class]||{},[p.id]:r(p)}}),c(m),m)),remove:(d,m)=>l.update(p=>{const{[d]:g,..._}=p.selected[m];return p.selected[m]=_,c(p),p}),removeAll:(d,m)=>l.update(p=>(d.forEach(g=>{var _;return(_=p.selected[m])==null?!0:delete _[g]}),c(p),p)),toggle:d=>l.update(m=>{var p;if((p=m.selected[d.class])!=null&&p[d.id]){const{[d.id]:g,..._}=m.selected[d.class];m.selected[d.class]=_}else m.selected[d.class]={...m.selected[d.class]||{},[d.id]:r(d)};return c(m),m}),toggleSet:d=>{yt(l).id===d.id?f():h(d)},empty:()=>l.update(d=>(d.id=null,d.title=i,d.selected={},c(d,!0),d)),updateTitle:d=>l.update(m=>(m.title=d,c(m,!0),m)),save:u,isSaved:a,selection:l,selectionTitle:ut(l,d=>d.title),isSelected:ut(l,d=>m=>{var p;return((p=d.selected[m.class])==null?void 0:p[m.id])||!1}),selected:ut(l,d=>d.selected),nbSelected:ut(l,d=>Object.values(d.selected).reduce((m,p)=>m+Object.keys(p).length,0)),isSetSelected:ut(l,d=>m=>d.id===m.id)}}ps({type:"documentSet",modelName:"document-set",title:q==="en"?"Document set":"Set de documents",extractMeta:t=>({title:t.title,url:t.url})});const i_=ps({type:"regionsSet",modelName:"regions-set",title:q==="en"?"Regions set":"Set de régions",extractMeta:t=>t});function r_(t){if(!t.startsWith("wit"))return t;const[e,...n]=t.split("_wit");return`wit${n}`}const gr=ps({type:"clusterSet",modelName:"cluster-set",title:q==="en"?"Selected regions":"Régions sélectionnées",extractMeta:t=>({imgRef:t.id,clusterId:t.clusterId,title:t.title,xywh:t.xywh,img:r_(t.id)})});function s_(){const t=`${window.location.origin}${window.location.pathname}`,e=Pe(1),n=Pe({}),i=Pe({}),r=Pe("");Pr(e,"p");function s(u){r.update(h=>{const f=h===u?"":u;return navigator.clipboard.writeText(f).then(d=>""),f})}const o=(async()=>{try{const u=await fetch(`${t}canvas`);if(!u.ok)return{};const h=await u.json();let f={};return Object.values(h).forEach(d=>{Object.entries(d).forEach(([m,p])=>{f[m]=p})}),n.set(f),h}catch{return{}}})(),l=ut(e,u=>(async()=>{const f=await(await fetch(`${t}canvas?p=${u}`)).json();return i.set(f),f})());function a(u){Or(u,e,"p")}function c(u){n.update(h=>(delete h[u],{...h})),i.update(h=>{for(const f in h)if(h[f][u]){const{[u]:d,...m}=h[f];return h[f]=m,h}return h})}return{currentPage:e,pageRegions:i,allRegions:n,fetchPages:l,fetchAll:o,handlePageUpdate:a,remove:c,clipBoard:r,copyRef:s}}const Xl=s_(),lb="";function o_(t){let e;return{c(){e=Gt("path"),v(e,"d","M384 336H192c-8.8 0-16-7.2-16-16V64c0-8.8 7.2-16 16-16l140.1 0L400 115.9V320c0 8.8-7.2 16-16 16zM192 384H384c35.3 0 64-28.7 64-64V115.9c0-12.7-5.1-24.9-14.1-33.9L366.1 14.1c-9-9-21.2-14.1-33.9-14.1H192c-35.3 0-64 28.7-64 64V320c0 35.3 28.7 64 64 64zM64 128c-35.3 0-64 28.7-64 64V448c0 35.3 28.7 64 64 64H256c35.3 0 64-28.7 64-64V416H272v32c0 8.8-7.2 16-16 16H64c-8.8 0-16-7.2-16-16V192c0-8.8 7.2-16 16-16H96V128H64z"),v(e,"class","svelte-1829hp2")},m(n,i){z(n,e,i)},d(n){n&&$(e)}}}function l_(t){let e;return{c(){e=Gt("path"),v(e,"d","M208 0H332.1c12.7 0 24.9 5.1 33.9 14.1l67.9 67.9c9 9 14.1 21.2 14.1 33.9V336c0 26.5-21.5 48-48 48H208c-26.5 0-48-21.5-48-48V48c0-26.5 21.5-48 48-48zM48 128h80v64H64V448H256V416h64v48c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V176c0-26.5 21.5-48 48-48z"),v(e,"class","svelte-1829hp2")},m(n,i){z(n,e,i)},d(n){n&&$(e)}}}function a_(t){let e=q==="en"?"Copy ID":"Copier l'ID",n;return{c(){n=re(e)},m(i,r){z(i,n,r)},p:ie,d(i){i&&$(n)}}}function c_(t){let e=q==="en"?"Copied!":"Copié !",n;return{c(){n=re(e)},m(i,r){z(i,n,r)},p:ie,d(i){i&&$(n)}}}function Jl(t){let e,n,i;var r=t[7];function s(o){return{props:{mainImgItem:o[1],compareImgItem:o[14]}}}return r&&(e=Ti(r,s(t))),{c(){e&&_e(e.$$.fragment),n=Ct()},m(o,l){e&&me(e,o,l),z(o,n,l),i=!0},p(o,l){const a={};if(l&2&&(a.mainImgItem=o[1]),l&128&&r!==(r=o[7])){if(e){et();const c=e;W(c.$$.fragment,1,0,()=>{pe(c,1)}),tt()}r?(e=Ti(r,s(o)),_e(e.$$.fragment),V(e.$$.fragment,1),me(e,n.parentNode,n)):e=null}else r&&e.$set(a)},i(o){i||(e&&V(e.$$.fragment,o),i=!0)},o(o){e&&W(e.$$.fragment,o),i=!1},d(o){o&&$(n),e&&pe(e,o)}}}function u_(t){let e,n,i,r,s,o,l,a,c,u,h,f,d,m,p,g,_,S,C,w,k,T,N;function E(H,P){return H[8]?l_:o_}let M=E(t),O=M(t);function L(H,P){return H[8]?c_:a_}let j=L(t),R=j(t),x=t[7]&&Jl(t);return{c(){e=b("div"),n=b("figure"),i=b("img"),s=F(),o=b("div"),l=b("span"),u=F(),h=b("div"),f=b("button"),d=Gt("svg"),O.c(),m=F(),p=b("span"),R.c(),_=F(),x&&x.c(),v(i,"class","region-img svelte-1829hp2"),At(i.src,r=t[9])||v(i,"src",r),v(i,"alt","Extracted region"),v(l,"class","overlay-desc"),v(o,"class","overlay is-center svelte-1829hp2"),v(n,"class",a="image card region-image "+(t[0]?"is-96x96":"")+" svelte-1829hp2"),v(n,"tabindex","-1"),v(n,"style",c=(t[2]==="full"?"height: 100%":`height: ${t[2]}px; min-width: ${t[2]}px`)+"; "+(t[3]?`border: 5px solid ${t[3]};`:"")),v(d,"xmlns","http://www.w3.org/2000/svg"),v(d,"viewBox","0 0 384 512"),v(d,"class","svelte-1829hp2"),v(p,"class","tooltip svelte-1829hp2"),v(f,"class","button tag svelte-1829hp2"),v(f,"style",g=t[6]?"":"display: none;"),v(h,"class","region-btn ml-1 svelte-1829hp2"),v(e,"class",S="region is-center "+(t[5]&&t[11](t[1])?"checked":"")+" svelte-1829hp2"),v(e,"style",C=t[2]==="full"?"height: 100%":"")},m(H,P){z(H,e,P),y(e,n),y(n,i),y(n,s),y(n,o),y(o,l),l.innerHTML=t[10],y(e,u),y(e,h),y(h,f),y(f,d),O.m(d,null),y(f,m),y(f,p),R.m(p,null),y(h,_),x&&x.m(h,null),k=!0,T||(N=[be(n,"click",t[19]),be(n,"keyup",f_),be(f,"click",t[20])],T=!0)},p(H,[P]){t=H,(!k||P&512&&!At(i.src,r=t[9]))&&v(i,"src",r),(!k||P&1024)&&(l.innerHTML=t[10]),(!k||P&1&&a!==(a="image card region-image "+(t[0]?"is-96x96":"")+" svelte-1829hp2"))&&v(n,"class",a),(!k||P&12&&c!==(c=(t[2]==="full"?"height: 100%":`height: ${t[2]}px; min-width: ${t[2]}px`)+"; "+(t[3]?`border: 5px solid ${t[3]};`:"")))&&v(n,"style",c),M!==(M=E(t))&&(O.d(1),O=M(t),O&&(O.c(),O.m(d,null))),j===(j=L(t))&&R?R.p(t,P):(R.d(1),R=j(t),R&&(R.c(),R.m(p,null))),(!k||P&64&&g!==(g=t[6]?"":"display: none;"))&&v(f,"style",g),t[7]?x?(x.p(t,P),P&128&&V(x,1)):(x=Jl(t),x.c(),V(x,1),x.m(h,null)):x&&(et(),W(x,1,1,()=>{x=null}),tt()),(!k||P&2082&&S!==(S="region is-center "+(t[5]&&t[11](t[1])?"checked":"")+" svelte-1829hp2"))&&v(e,"class",S),(!k||P&4&&C!==(C=t[2]==="full"?"height: 100%":""))&&v(e,"style",C)},i(H){k||(V(x),Ht(()=>{k&&(w||(w=yn(e,Kn,{duration:t[15]},!0)),w.run(1))}),k=!0)},o(H){W(x),w||(w=yn(e,Kn,{duration:t[15]},!1)),w.run(0),k=!1},d(H){H&&$(e),O.d(),R.d(),x&&x.d(),H&&w&&w.end(),T=!1,vt(N)}}}const f_=()=>null;function d_(t,e,n){let i,r,s,o,l,{selectionStore:a}=e;a||(a=i_);const{isSelected:c}=a;Me(t,c,M=>n(11,l=M));const{clipBoard:u}=Xl;Me(t,u,M=>n(18,o=M));let{item:h}=e,{descPromise:f=void 0}=e,{isSquare:d=!0}=e,{height:m=d?96:140}=e;m==="full"&&(d=!1);let{borderColor:p=null}=e,{toggleSelection:g=a.toggle}=e;const _=Ft("qImgMetadata")||void 0,S=Ft("isInModal")||!1,C=S?0:500;let w;S||ms(()=>Promise.resolve().then(()=>v0),void 0).then(M=>n(7,w=M.default));let{selectable:k=!S}=e,{copyable:T=!0}=e;const N=()=>k?g(h):null,E=()=>T?Xl.copyRef(h.ref):null;return t.$$set=M=>{"selectionStore"in M&&n(16,a=M.selectionStore),"item"in M&&n(1,h=M.item),"descPromise"in M&&n(17,f=M.descPromise),"isSquare"in M&&n(0,d=M.isSquare),"height"in M&&n(2,m=M.height),"borderColor"in M&&n(3,p=M.borderColor),"toggleSelection"in M&&n(4,g=M.toggleSelection),"selectable"in M&&n(5,k=M.selectable),"copyable"in M&&n(6,T=M.copyable)},t.$$.update=()=>{t.$$.dirty&2&&n(10,i=h.title),t.$$.dirty&131072&&f&&f.then(M=>n(10,i=M)),t.$$.dirty&7&&n(9,r=Yt(h.img??h.ref,h.xywh,m==="full"?m:d?`${m},`:`,${m}`)),t.$$.dirty&262146&&n(8,s=h.ref===o)},[d,h,m,p,g,k,T,w,s,r,i,l,c,u,_,C,a,f,o,N,E]}class ei extends Ve{constructor(e){super(),He(this,e,d_,u_,je,{selectionStore:16,item:1,descPromise:17,isSquare:0,height:2,borderColor:3,toggleSelection:4,selectable:5,copyable:6})}}const ab="";function Ql(t,e,n){const i=t.slice();return i[11]=e[n],i}function Zl(t,e,n){const i=t.slice();return i[14]=e[n],i}function gs(t){const e=t.slice(),n=e[2].get(e[11][e[14]].id);return e[17]=n,e}function ea(t,e,n){const i=t.slice();return i[14]=e[n],i}function ta(t){let e,n,i,r,s,o,l,a,c,u,h=t[0].regions,f=[];for(let _=0;_<h.length;_+=1)f[_]=na(ea(t,h,_));const d=_=>W(f[_],1,1,()=>{f[_]=null});let m=t[0].rows,p=[];for(let _=0;_<m.length;_+=1)p[_]=sa(Ql(t,m,_));const g=_=>W(p[_],1,1,()=>{p[_]=null});return{c(){e=b("div"),n=b("h3"),n.textContent="Aligned Documents",i=F(),r=b("div"),s=b("table"),o=b("thead"),l=b("tr");for(let _=0;_<f.length;_+=1)f[_].c();a=F(),c=b("tbody");for(let _=0;_<p.length;_+=1)p[_].c();v(n,"class","title is-5"),v(o,"class","region-header svelte-1hxxzoa"),v(s,"class","table is-fullwidth svelte-1hxxzoa"),v(r,"class","table-container svelte-1hxxzoa"),v(e,"class","box mt-4")},m(_,S){z(_,e,S),y(e,n),y(e,i),y(e,r),y(r,s),y(s,o),y(o,l);for(let C=0;C<f.length;C+=1)f[C]&&f[C].m(l,null);y(s,a),y(s,c);for(let C=0;C<p.length;C+=1)p[C]&&p[C].m(c,null);u=!0},p(_,S){if(S&3){h=_[0].regions;let C;for(C=0;C<h.length;C+=1){const w=ea(_,h,C);f[C]?(f[C].p(w,S),V(f[C],1)):(f[C]=na(w),f[C].c(),V(f[C],1),f[C].m(l,null))}for(et(),C=h.length;C<f.length;C+=1)d(C);tt()}if(S&77){m=_[0].rows;let C;for(C=0;C<m.length;C+=1){const w=Ql(_,m,C);p[C]?(p[C].p(w,S),V(p[C],1)):(p[C]=sa(w),p[C].c(),V(p[C],1),p[C].m(c,null))}for(et(),C=m.length;C<p.length;C+=1)g(C);tt()}},i(_){if(!u){for(let S=0;S<h.length;S+=1)V(f[S]);for(let S=0;S<m.length;S+=1)V(p[S]);u=!0}},o(_){f=f.filter(Boolean);for(let S=0;S<f.length;S+=1)W(f[S]);p=p.filter(Boolean);for(let S=0;S<p.length;S+=1)W(p[S]);u=!1},d(_){_&&$(e),St(f,_),St(p,_)}}}function na(t){let e,n,i,r;return n=new to({props:{id:t[14],meta:t[1].get(t[14])||{},clickable:!1}}),{c(){e=b("th"),_e(n.$$.fragment),i=F(),v(e,"class","is-vcentered")},m(s,o){z(s,e,o),me(n,e,null),y(e,i),r=!0},p(s,o){const l={};o&1&&(l.id=s[14]),o&3&&(l.meta=s[1].get(s[14])||{}),n.$set(l)},i(s){r||(V(n.$$.fragment,s),r=!0)},o(s){W(n.$$.fragment,s),r=!1},d(s){s&&$(e),pe(n)}}}function ia(t){let e,n,i,r,s=t[11][t[14]].page+"",o,l;return e=new ei({props:{item:t[17],selectable:!1,copyable:!1,borderColor:t[6](t[11][t[14]],t[3]),isSquare:!1}}),{c(){_e(e.$$.fragment),n=F(),i=b("div"),r=re("Page "),o=re(s),v(i,"class","has-text-grey-dark mt-2")},m(a,c){me(e,a,c),z(a,n,c),z(a,i,c),y(i,r),y(i,o),l=!0},p(a,c){const u={};c&5&&(u.item=a[17]),c&9&&(u.borderColor=a[6](a[11][a[14]],a[3])),e.$set(u),(!l||c&1)&&s!==(s=a[11][a[14]].page+"")&&Fe(o,s)},i(a){l||(V(e.$$.fragment,a),l=!0)},o(a){W(e.$$.fragment,a),l=!1},d(a){pe(e,a),a&&$(n),a&&$(i)}}}function ra(t){let e,n,i=t[11][t[14]]&&ia(gs(t));return{c(){e=b("td"),i&&i.c(),v(e,"class","has-text-centered"),We(e,"vertical-align","top")},m(r,s){z(r,e,s),i&&i.m(e,null),n=!0},p(r,s){r[11][r[14]]?i?(i.p(gs(r),s),s&1&&V(i,1)):(i=ia(gs(r)),i.c(),V(i,1),i.m(e,null)):i&&(et(),W(i,1,1,()=>{i=null}),tt())},i(r){n||(V(i),n=!0)},o(r){W(i),n=!1},d(r){r&&$(e),i&&i.d()}}}function sa(t){let e,n,i,r=t[0].regions,s=[];for(let l=0;l<r.length;l+=1)s[l]=ra(Zl(t,r,l));const o=l=>W(s[l],1,1,()=>{s[l]=null});return{c(){e=b("tr");for(let l=0;l<s.length;l+=1)s[l].c();n=F()},m(l,a){z(l,e,a);for(let c=0;c<s.length;c+=1)s[c]&&s[c].m(e,null);y(e,n),i=!0},p(l,a){if(a&77){r=l[0].regions;let c;for(c=0;c<r.length;c+=1){const u=Zl(l,r,c);s[c]?(s[c].p(u,a),V(s[c],1)):(s[c]=ra(u),s[c].c(),V(s[c],1),s[c].m(e,n))}for(et(),c=r.length;c<s.length;c+=1)o(c);tt()}},i(l){if(!i){for(let a=0;a<r.length;a+=1)V(s[a]);i=!0}},o(l){s=s.filter(Boolean);for(let a=0;a<s.length;a+=1)W(s[a]);i=!1},d(l){l&&$(e),St(s,l)}}}function h_(t){let e,n,i=t[0]&&ta(t);return{c(){i&&i.c(),e=Ct()},m(r,s){i&&i.m(r,s),z(r,e,s),n=!0},p(r,[s]){r[0]?i?(i.p(r,s),s&1&&V(i,1)):(i=ta(r),i.c(),V(i,1),i.m(e.parentNode,e)):i&&(et(),W(i,1,1,()=>{i=null}),tt())},i(r){n||(V(i),n=!0)},o(r){W(i),n=!1},d(r){i&&i.d(r),r&&$(e)}}}function m_(t){let e=0;for(let o=0;o<t.length;o++)e=t.charCodeAt(o)+((e<<5)-e),e=e&e;const i=e*.618033988749895%1*360,r=65+e%20,s=80+e%10;return`hsl(${Math.floor(i)}, ${r}%, ${s}%)`}function p_(t,e,n){let i,r,s,{selectedDocuments:o=[]}=e,{documentSetStore:l}=e;const{buildAlignedImageMatrix:a,documentNodes:c,imageNodes:u}=l;Me(t,c,m=>n(1,r=m)),Me(t,u,m=>n(2,s=m));let h=null;function f(m,p){if(!m)return;const g=m.id;if(p.get(g)!==1)return d.has(g)||d.set(g,m_(g)),d.get(g)}const d=new Map;return t.$$set=m=>{"selectedDocuments"in m&&n(7,o=m.selectedDocuments),"documentSetStore"in m&&n(8,l=m.documentSetStore)},t.$$.update=()=>{if(t.$$.dirty&134)if(o.length>0&&s&&r){const m=o.map(p=>p.id);n(0,h=a(m))}else n(0,h=null);t.$$.dirty&1&&n(3,i=h?(()=>{const m=new Map;return h.rows.forEach(p=>{Object.values(p).forEach(g=>{m.set(g.id,(m.get(g.id)||0)+1)})}),m})():new Map)},[h,r,s,i,c,u,f,o,l]}class g_ extends Ve{constructor(e){super(),He(this,e,p_,h_,je,{selectedDocuments:7,documentSetStore:8})}}const cb="";function oa(t,e,n){const i=t.slice();return i[15]=e[n],i}function __(t){let e;return{c(){e=b("span"),e.innerHTML='<i class="fas fa-crop-alt"></i>',v(e,"class","icon px-4")},m(n,i){z(n,e,i)},d(n){n&&$(e)}}}function v_(t){let e;return{c(){e=b("span"),e.innerHTML='<i class="fas fa-hand-pointer"></i>',v(e,"class","icon px-4")},m(n,i){z(n,e,i)},d(n){n&&$(e)}}}function la(t){let e,n,i,r;const s=[b_,y_],o=[];function l(a,c){return a[0]==="img"?0:a[0]==="doc"?1:-1}return~(e=l(t))&&(n=o[e]=s[e](t)),{c(){n&&n.c(),i=Ct()},m(a,c){~e&&o[e].m(a,c),z(a,i,c),r=!0},p(a,c){let u=e;e=l(a),e===u?~e&&o[e].p(a,c):(n&&(et(),W(o[u],1,1,()=>{o[u]=null}),tt()),~e?(n=o[e],n?n.p(a,c):(n=o[e]=s[e](a),n.c()),V(n,1),n.m(i.parentNode,i)):n=null)},i(a){r||(V(n),r=!0)},o(a){W(n),r=!1},d(a){~e&&o[e].d(a),a&&$(i)}}}function y_(t){let e,n;return e=new g_({props:{selectedDocuments:t[5],documentSetStore:t[1]}}),{c(){_e(e.$$.fragment)},m(i,r){me(e,i,r),n=!0},p(i,r){const s={};r&32&&(s.selectedDocuments=i[5]),r&2&&(s.documentSetStore=i[1]),e.$set(s)},i(i){n||(V(e.$$.fragment,i),n=!0)},o(i){W(e.$$.fragment,i),n=!1},d(i){pe(e,i)}}}function b_(t){let e,n,i=q==="en"?"Selected regions":"Régions sélectionnées",r,s,o=t[5].length+"",l,a,c,u,h=[],f=new Map,d,m=t[5];const p=g=>g[15].id;for(let g=0;g<m.length;g+=1){let _=oa(t,m,g),S=p(_);f.set(S,h[g]=aa(S,_))}return{c(){e=b("div"),n=b("h3"),r=re(i),s=re(" ("),l=re(o),a=re(")"),c=F(),u=b("div");for(let g=0;g<h.length;g+=1)h[g].c();v(n,"class","title is-5"),v(u,"class","selected-nodes grid is-gap-2 mt-5 svelte-1a3kdxu"),v(e,"class","selected-panel box mt-4 svelte-1a3kdxu")},m(g,_){z(g,e,_),y(e,n),y(n,r),y(n,s),y(n,l),y(n,a),y(e,c),y(e,u);for(let S=0;S<h.length;S+=1)h[S]&&h[S].m(u,null);d=!0},p(g,_){(!d||_&32)&&o!==(o=g[5].length+"")&&Fe(l,o),_&32&&(m=g[5],et(),h=Di(h,_,p,1,g,m,f,u,Mr,aa,null,oa),tt())},i(g){if(!d){for(let _=0;_<m.length;_+=1)V(h[_]);d=!0}},o(g){for(let _=0;_<h.length;_+=1)W(h[_]);d=!1},d(g){g&&$(e);for(let _=0;_<h.length;_+=1)h[_].d()}}}function aa(t,e){let n,i,r;return i=new ei({props:{item:e[15],selectable:!1,copyable:!1}}),{key:t,first:null,c(){n=Ct(),_e(i.$$.fragment),this.first=n},m(s,o){z(s,n,o),me(i,s,o),r=!0},p(s,o){e=s;const l={};o&32&&(l.item=e[15]),i.$set(l)},i(s){r||(V(i.$$.fragment,s),r=!0)},o(s){W(i.$$.fragment,s),r=!1},d(s){s&&$(n),pe(i,s)}}}function w_(t){let e,n,i,r=t[3]?"click":"selection",s,o,l,a,c,u,h,f;function d(_,S){return _[3]?v_:__}let m=d(t),p=m(t),g=t[5].length>0&&la(t);return{c(){e=b("div"),n=b("button"),p.c(),i=re(`
        Switch to `),s=re(r),o=re(" mode"),l=F(),a=b("div"),c=F(),g&&g.c(),v(n,"class","toggle-button button is-small is-link mb-3"),v(a,"class","visualization-container")},m(_,S){z(_,e,S),y(e,n),p.m(n,null),y(n,i),y(n,s),y(n,o),y(e,l),y(e,a),t[9](a),y(e,c),g&&g.m(e,null),u=!0,h||(f=be(n,"click",t[7]),h=!0)},p(_,[S]){m!==(m=d(_))&&(p.d(1),p=m(_),p&&(p.c(),p.m(n,i))),(!u||S&8)&&r!==(r=_[3]?"click":"selection")&&Fe(s,r),_[5].length>0?g?(g.p(_,S),S&32&&V(g,1)):(g=la(_),g.c(),V(g,1),g.m(e,null)):g&&(et(),W(g,1,1,()=>{g=null}),tt())},i(_){u||(V(g),u=!0)},o(_){W(g),u=!1},d(_){_&&$(e),p.d(),t[9](null),g&&g.d(),h=!1,f()}}}const S_=1e3;function k_(t,e,n){let i,r,s=ie,o=()=>(s(),s=Ii(i,w=>n(8,r=w)),i),l;t.$$.on_destroy.push(()=>s());let{type:a="img"}=e,{documentSetStore:c}=e;const{imageNetwork:u,documentNetwork:h,selectedNodes:f,updateSelectedNodes:d}=c;Me(t,f,w=>n(5,l=w));let m,p,g=!1;function _(){m&&(m.destroy(),d([]));function w(T){d(T)}m=(r.nodes.length<S_?Jg:Ug)(p,r.nodes,r.links,w,T=>{n(3,g=T)}),n(3,g=a==="img"),g&&m.toggleSelectionMode()}function S(){m&&n(3,g=m.toggleSelectionMode())}jn(()=>{m==null||m.destroy()});function C(w){vn[w?"unshift":"push"](()=>{p=w,n(2,p)})}return t.$$set=w=>{"type"in w&&n(0,a=w.type),"documentSetStore"in w&&n(1,c=w.documentSetStore)},t.$$.update=()=>{t.$$.dirty&1&&o(n(4,i=a==="img"?u:h)),t.$$.dirty&260&&r&&p&&_()},[a,c,p,g,i,l,f,S,r,C]}class E_ extends Ve{constructor(e){super(),He(this,e,k_,w_,je,{type:0,documentSetStore:1})}}const ub="",{Map:C_}=Gc;function ca(t,e,n){const i=t.slice();return i[64]=e[n],i[66]=n,i}function ua(t,e,n){const i=t.slice();return i[64]=e[n],i[68]=n,i}function fa(t,e,n){const i=t.slice();return i[69]=e[n],i}function da(t,e,n){const i=t.slice();return i[72]=e[n],i}function I_(t){let e,n,i,r,s,o,l,a,c,u,h,f,d,m,p,g=t[23]("normalize")+"",_,S,C,w,k,T,N,E,M,O,L,j,R,x,H,P,X,U,K,Z,ae=["col","row"],ce=[];for(let he=0;he<2;he+=1)ce[he]=ma(fa(t,ae,he));let de=t[2]&&pa(t);function fe(he,Y){return he[2]?A_:M_}let De=fe(t),Ke=De(t);return{c(){e=b("div"),n=b("div"),i=b("div"),r=b("h4"),r.textContent=`${t[23]("title")}`,s=F(),o=b("div"),l=b("div"),a=b("div"),c=b("select"),u=b("option"),u.textContent=`${t[23]("byName")}`,h=b("option"),h.textContent=`${t[23]("byScore")}`,f=F(),d=b("label"),m=b("input"),p=F(),_=re(g),S=F(),C=b("div"),w=b("div"),k=b("div"),T=F();for(let he=0;he<2;he+=1)ce[he].c();N=F(),E=b("div"),M=F(),O=b("div"),L=F(),j=b("div"),R=b("div"),x=b("div"),H=b("h4"),H.textContent=`${t[23]("pageByPage")}`,P=F(),de&&de.c(),X=F(),U=b("div"),Ke.c(),v(r,"class","title is-6 mb-0"),u.__value="name",u.value=u.__value,h.__value="score",h.value=h.__value,t[3]===void 0&&Ht(()=>t[37].call(c)),v(a,"class","select is-small"),v(l,"class","control"),v(m,"type","checkbox"),m.checked=t[9],v(d,"title",t[23]("normalization")),v(d,"class","checkbox is-size-7"),v(o,"class","is-flex is-align-items-center"),We(o,"gap","0.5rem"),v(i,"class","is-flex is-justify-content-space-between is-align-items-center mb-3"),We(i,"flex-wrap","wrap"),We(i,"gap","0.5rem"),v(k,"class","matrix-corner svelte-15delsq"),v(E,"class","matrix-canvas svelte-15delsq"),v(w,"class","matrix-grid svelte-15delsq"),We(w,"--cell-size",wa+"px"),v(C,"class","scroll-area svelte-15delsq"),v(n,"class","box panel-box svelte-15delsq"),v(e,"class","split-panel svelte-15delsq"),We(e,"width",t[14]+"px"),v(O,"class","split-divider svelte-15delsq"),v(O,"role","separator"),v(O,"tabindex","0"),v(H,"class","title is-6 mb-0"),v(x,"class","is-flex is-justify-content-space-between is-align-items-center mb-3"),v(U,"class","scroll-area svelte-15delsq"),v(R,"class","box panel-box svelte-15delsq"),v(j,"class","split-panel svelte-15delsq"),We(j,"width",t[13]+"px")},m(he,Y){z(he,e,Y),y(e,n),y(n,i),y(i,r),y(i,s),y(i,o),y(o,l),y(l,a),y(a,c),y(c,u),y(c,h),_n(c,t[3],!0),y(o,f),y(o,d),y(d,m),y(d,p),y(d,_),y(n,S),y(n,C),y(C,w),y(w,k),y(w,T);for(let te=0;te<2;te+=1)ce[te]&&ce[te].m(w,null);y(w,N),y(w,E),t[39](E),z(he,M,Y),z(he,O,Y),z(he,L,Y),z(he,j,Y),y(j,R),y(R,x),y(x,H),y(x,P),de&&de.m(x,null),y(R,X),y(R,U),Ke.m(U,null),K||(Z=[be(c,"change",t[37]),be(m,"change",t[38]),be(O,"mousedown",t[25]),be(O,"touchstart",t[25])],K=!0)},p(he,Y){if(Y[0]&8&&_n(c,he[3]),Y[0]&512&&(m.checked=he[9]),Y[0]&64){ae=["col","row"];let te;for(te=0;te<2;te+=1){const se=fa(he,ae,te);ce[te]?ce[te].p(se,Y):(ce[te]=ma(se),ce[te].c(),ce[te].m(w,N))}for(;te<2;te+=1)ce[te].d(1)}Y[0]&16384&&We(e,"width",he[14]+"px"),he[2]?de?de.p(he,Y):(de=pa(he),de.c(),de.m(x,null)):de&&(de.d(1),de=null),De===(De=fe(he))&&Ke?Ke.p(he,Y):(Ke.d(1),Ke=De(he),Ke&&(Ke.c(),Ke.m(U,null))),Y[0]&8192&&We(j,"width",he[13]+"px")},d(he){he&&$(e),St(ce,he),t[39](null),he&&$(M),he&&$(O),he&&$(L),he&&$(j),de&&de.d(),Ke.d(),K=!1,vt(Z)}}}function x_(t){let e;return{c(){e=b("div"),e.textContent=`${t[23]("noDocuments")}`,v(e,"class","notification is-info"),We(e,"width","100%")},m(n,i){z(n,e,i)},p:ie,d(n){n&&$(e)}}}function ha(t,e){let n,i,r;return{key:t,first:null,c(){n=b("div"),i=b("span"),v(i,"class","color-dot svelte-15delsq"),We(i,"background-color",e[72].color),v(i,"title",r=e[72].title+" "+Ri.Witness+" #"+e[72].witnessId),v(n,"class","header-cell svelte-15delsq"),this.first=n},m(s,o){z(s,n,o),y(n,i)},p(s,o){e=s,o[0]&64&&We(i,"background-color",e[72].color),o[0]&64&&r!==(r=e[72].title+" "+Ri.Witness+" #"+e[72].witnessId)&&v(i,"title",r)},d(s){s&&$(n)}}}function ma(t){let e,n=[],i=new C_,r=t[6].docs;const s=o=>o[72].id;for(let o=0;o<r.length;o+=1){let l=da(t,r,o),a=s(l);i.set(a,n[o]=ha(a,l))}return{c(){e=b("div");for(let o=0;o<n.length;o+=1)n[o].c();v(e,"class",t[69]+"-headers svelte-15delsq")},m(o,l){z(o,e,l);for(let a=0;a<n.length;a+=1)n[a]&&n[a].m(e,null)},p(o,l){l[0]&64&&(r=o[6].docs,n=Di(n,l,s,1,o,r,i,e,cu,ha,null,da))},d(o){o&&$(e);for(let l=0;l<n.length;l+=1)n[l].d()}}}function pa(t){let e,n,i,r,s,o,l,a;return{c(){e=b("div"),n=b("div"),i=b("div"),r=b("select"),s=b("option"),s.textContent=`${t[23]("byPage")}`,o=b("option"),o.textContent=`${t[23]("byImage")}`,s.__value="page",s.value=s.__value,o.__value="image",o.value=o.__value,t[4]===void 0&&Ht(()=>t[40].call(r)),v(i,"class","select is-small"),v(n,"class","control"),v(e,"class","field mb-0")},m(c,u){z(c,e,u),y(e,n),y(n,i),y(i,r),y(r,s),y(r,o),_n(r,t[4],!0),l||(a=be(r,"change",t[40]),l=!0)},p(c,u){u[0]&16&&_n(r,c[4])},d(c){c&&$(e),l=!1,a()}}}function M_(t){let e;return{c(){e=b("p"),e.textContent=`${t[23]("selectCell")}`,v(e,"class","has-text-grey is-size-7")},m(n,i){z(n,e,i)},p:ie,d(n){n&&$(e)}}}function A_(t){let e;return{c(){e=b("div"),v(e,"class","scatter-container svelte-15delsq")},m(n,i){z(n,e,i),t[41](e)},p:ie,d(n){n&&$(e),t[41](null)}}}function ga(t){let e,n,i,r,s,o,l,a=t[12].items,c=[];for(let d=0;d<a.length;d+=1)c[d]=_a(ua(t,a,d));let u=t[12].score!==void 0&&va(t),h=t[12].items,f=[];for(let d=0;d<h.length;d+=1)f[d]=ya(ca(t,h,d));return{c(){e=b("table"),n=b("thead"),i=b("tr");for(let d=0;d<c.length;d+=1)c[d].c();r=F(),s=b("tbody"),u&&u.c(),o=F(),l=b("tr");for(let d=0;d<f.length;d+=1)f[d].c();v(e,"class","table is-fullwidth p-3 has-text-centered")},m(d,m){z(d,e,m),y(e,n),y(n,i);for(let p=0;p<c.length;p+=1)c[p]&&c[p].m(i,null);y(e,r),y(e,s),u&&u.m(s,null),y(s,o),y(s,l);for(let p=0;p<f.length;p+=1)f[p]&&f[p].m(l,null)},p(d,m){if(m[0]&4096){a=d[12].items;let p;for(p=0;p<a.length;p+=1){const g=ua(d,a,p);c[p]?c[p].p(g,m):(c[p]=_a(g),c[p].c(),c[p].m(i,null))}for(;p<c.length;p+=1)c[p].d(1);c.length=a.length}if(d[12].score!==void 0?u?u.p(d,m):(u=va(d),u.c(),u.m(s,o)):u&&(u.d(1),u=null),m[0]&16781344){h=d[12].items;let p;for(p=0;p<h.length;p+=1){const g=ca(d,h,p);f[p]?f[p].p(g,m):(f[p]=ya(g),f[p].c(),f[p].m(l,null))}for(;p<f.length;p+=1)f[p].d(1);f.length=h.length}},d(d){d&&$(e),St(c,d),u&&u.d(),St(f,d)}}}function _a(t){let e,n,i,r,s,o=t[64].doc.title+"",l,a;return{c(){e=b("th"),n=b("span"),i=re("●"),r=F(),s=b("strong"),l=re(o),a=F(),We(n,"color",t[64].doc.color),v(e,"class","doc-title svelte-15delsq")},m(c,u){z(c,e,u),y(e,n),y(n,i),y(e,r),y(e,s),y(s,l),y(e,a)},p(c,u){u[0]&4096&&We(n,"color",c[64].doc.color),u[0]&4096&&o!==(o=c[64].doc.title+"")&&Fe(l,o)},d(c){c&&$(e)}}}function va(t){let e,n,i,r=t[23]("score")+"",s,o,l,a=t[12].score.toFixed(2)+"",c;return{c(){e=b("tr"),n=b("td"),i=b("span"),s=re(r),o=F(),l=b("b"),c=re(a),v(i,"class","tag is-small"),v(n,"colspan","2"),v(n,"class","has-text-centered")},m(u,h){z(u,e,h),y(e,n),y(n,i),y(i,s),y(i,o),y(i,l),y(l,c)},p(u,h){h[0]&4096&&a!==(a=u[12].score.toFixed(2)+"")&&Fe(c,a)},d(u){u&&$(e)}}}function T_(t){let e;return{c(){e=b("span"),e.innerHTML='<i class="fas fa-chevron-left"></i>',v(e,"class","icon is-small p-0")},m(n,i){z(n,e,i)},d(n){n&&$(e)}}}function N_(t){let e;return{c(){e=b("span"),e.innerHTML='<i class="fas fa-chevron-up"></i>',v(e,"class","icon is-small p-0")},m(n,i){z(n,e,i)},d(n){n&&$(e)}}}function P_(t){let e;return{c(){e=b("span"),e.innerHTML='<i class="fas fa-chevron-right"></i>',v(e,"class","icon is-small")},m(n,i){z(n,e,i)},d(n){n&&$(e)}}}function O_(t){let e;return{c(){e=b("span"),e.innerHTML='<i class="fas fa-chevron-down"></i>',v(e,"class","icon is-small")},m(n,i){z(n,e,i)},d(n){n&&$(e)}}}function ya(t){let e,n,i=t[64].label+"",r,s,o,l,a,c,u,h,f,d,m,p,g,_;function S(O,L){return O[66]!==0?N_:T_}let w=S(t)(t);function k(){return t[43](t[66])}function T(O,L){return O[66]!==0?O_:P_}let E=T(t)(t);function M(){return t[44](t[66])}return{c(){var O;e=b("td"),n=b("p"),r=re(i),s=F(),o=b("div"),l=b("button"),w.c(),a=F(),c=b("figure"),u=b("img"),d=F(),m=b("button"),E.c(),p=F(),v(n,"class","is-size-7 has-text-grey mb-2"),v(l,"class","nav-btn "+(t[66]!==0?"nav-up":"nav-left")+" svelte-15delsq"),At(u.src,h=t[64].imgUrl)||v(u,"src",h),v(u,"alt",f=(((O=t[5])==null?void 0:O.mode)==="image"?"Image":"Page")+" "+t[64].label),v(u,"class","img-preview svelte-15delsq"),v(c,"class","image"),v(m,"class","nav-btn "+(t[66]!==0?"nav-down":"nav-right")+" svelte-15delsq"),v(o,"class","image-nav-container svelte-15delsq"),v(e,"class","modal-cell svelte-15delsq")},m(O,L){z(O,e,L),y(e,n),y(n,r),y(e,s),y(e,o),y(o,l),w.m(l,null),y(o,a),y(o,c),y(c,u),y(o,d),y(o,m),E.m(m,null),y(e,p),g||(_=[be(l,"click",k),be(m,"click",M)],g=!0)},p(O,L){var j;t=O,L[0]&4096&&i!==(i=t[64].label+"")&&Fe(r,i),L[0]&4096&&!At(u.src,h=t[64].imgUrl)&&v(u,"src",h),L[0]&4128&&f!==(f=(((j=t[5])==null?void 0:j.mode)==="image"?"Image":"Page")+" "+t[64].label)&&v(u,"alt",f)},d(O){O&&$(e),w.d(),E.d(),g=!1,vt(_)}}}function L_(t){let e,n,i,r,s,o,l,a,c,u,h,f,d,m,p,g,_,S,C,w;function k(M,O){return M[7].length?I_:x_}let T=k(t),N=T(t),E=t[12]&&ga(t);return{c(){e=b("div"),n=b("label"),n.textContent=`${t[23]("filtering")}`,i=F(),r=b("div"),s=b("div"),o=b("select"),l=b("option"),l.textContent=`${t[23]("allPairs")}`,a=b("option"),a.textContent=`${t[23]("filteredPairs")}`,c=F(),u=b("div"),N.c(),h=F(),f=b("div"),d=b("div"),m=F(),p=b("div"),g=b("div"),E&&E.c(),_=F(),S=b("button"),v(n,"class","label is-small"),v(n,"for","matrix-mode"),l.__value="all",l.value=l.__value,a.__value="filtered",a.value=a.__value,v(o,"id","matrix-mode"),t[8]===void 0&&Ht(()=>t[36].call(o)),v(s,"class","select is-small is-fullwidth"),v(r,"class","control"),v(e,"class","field mb-4"),v(u,"class","split-container svelte-15delsq"),v(d,"class","modal-background"),v(g,"class","box p-5"),v(p,"class","modal-content"),We(p,"width","auto"),We(p,"max-width","70vw"),v(S,"class","modal-close is-large"),v(S,"aria-label","close"),v(f,"id","matrix-page-modal"),v(f,"class","modal")},m(M,O){z(M,e,O),y(e,n),y(e,i),y(e,r),y(r,s),y(s,o),y(o,l),y(o,a),_n(o,t[8],!0),z(M,c,O),z(M,u,O),N.m(u,null),t[42](u),z(M,h,O),z(M,f,O),y(f,d),y(f,m),y(f,p),y(p,g),E&&E.m(g,null),y(f,_),y(f,S),t[45](f),C||(w=[be(o,"change",t[36]),ii(Dr.call(null,f))],C=!0)},p(M,O){O[0]&256&&_n(o,M[8]),T===(T=k(M))&&N?N.p(M,O):(N.d(1),N=T(M),N&&(N.c(),N.m(u,null))),M[12]?E?E.p(M,O):(E=ga(M),E.c(),E.m(g,null)):E&&(E.d(1),E=null)},i:ie,o:ie,d(M){M&&$(e),M&&$(c),M&&$(u),N.d(),t[42](null),M&&$(h),M&&$(f),E&&E.d(),t[45](null),C=!1,vt(w)}}}const ba=300,wa=30,st=5;function D_(t){if(t.mode==="image")return{max1:t.images1.length,max2:t.images2.length};const e=Math.max(...t.points.map(i=>i.page1)),n=Math.max(...t.points.map(i=>i.page2));return{max1:e,max2:n}}function R_(t,e,n){const i=new Map;let r=1/0,s=-1/0;for(const l of n){const[a,c,u]=l.regions_id_1===t.id?[l.page_1,l.page_2,l.weightedScore||0]:[l.page_2,l.page_1,l.weightedScore||0],h=`${a}-${c}`;i.has(h)||i.set(h,{page1:a,page2:c,scores:[]}),i.get(h).scores.push(u),u<r&&(r=u),u>s&&(s=u)}return{mode:"page",points:Array.from(i.values()).map(({page1:l,page2:a,scores:c})=>({page1:l,page2:a,score:c.reduce((u,h)=>u+h,0)/c.length,count:c.length})),minScore:r,maxScore:s,doc1:t,doc2:e}}function $_(t,e,n){const i=t.images||[],r=e.images||[];if(!i.length||!r.length)return null;const s=new Map(i.map((u,h)=>[u.id,h])),o=new Map(r.map((u,h)=>[u.id,h])),l=new Map;let a=1/0,c=-1/0;return n.forEach(u=>{const[h,f,d]=u.regions_id_1===t.id?[u.id_1,u.id_2,u.weightedScore||0]:[u.id_2,u.id_1,u.weightedScore||0],m=s.get(h),p=o.get(f);if(m!==void 0&&p!==void 0){const g=`${m}-${p}`;l.set(g,{idx1:m,idx2:p,imgId1:h,imgId2:f,score:d}),d<a&&(a=d),d>c&&(c=d)}}),{mode:"image",images1:i,images2:r,pairScores:l,minScore:a,maxScore:c,doc1:t,doc2:e}}function Sa(t){const e=[];let n=null,i=0;return t.forEach((r,s)=>{r.canvas!==n&&(n!==null&&e.push({start:i,end:s,page:n,count:s-i}),n=r.canvas,i=s)}),n!==null&&e.push({start:i,end:t.length,page:n,count:t.length-i}),e}function z_(t,e,n){let i,r,s,o,l,a,c,u,h,f,d,m,p,g,_,{documentSetStore:S}=e;const{documentNodes:C,pairIndex:w,activeDocPairStats:k,activeDocStats:T,imageCountMap:N,visiblePairIds:E,matrixMode:M,normalizeByImages:O}=S;Me(t,C,B=>n(35,_=B)),Me(t,w,B=>n(48,u=B)),Me(t,k,B=>n(34,g=B)),Me(t,T,B=>n(33,p=B)),Me(t,N,B=>n(32,d=B)),Me(t,E,B=>n(31,h=B)),Me(t,M,B=>n(8,f=B)),Me(t,O,B=>n(9,m=B));const L={title:{en:"Document Matrix",fr:"Matrice de documents"},order:{en:"Order",fr:"Ordre"},byName:{en:"By title",fr:"Par titre"},byScore:{en:"By score",fr:"Par score"},noDocuments:{en:"No documents available",fr:"Aucun document disponible"},pageByPage:{en:"Page-by-page similarity",fr:"Similarité page par page"},page:{en:"page",fr:"page"},score:{en:"Score",fr:"Score"},noPairs:{en:"No pairs",fr:"Aucune paire"},selectCell:{en:"Click a cell to view page-by-page similarity",fr:"Cliquez sur une cellule pour voir la similarité page par page"},byPage:{en:"By page",fr:"Par page"},byImage:{en:"By image",fr:"Par image"},image:{en:"image",fr:"image"},normalize:{en:"Normalize",fr:"Normaliser"},normalization:{en:"Normalization by document image counts",fr:"Normalisation par le nombre d'images des documents"},allPairs:{en:"All pairs in the document set",fr:"Toutes les paires du corpus"},filteredPairs:{en:"Filtered pairs",fr:"Paires après filtrage"},filtering:{en:"Source of image pairs for the visualizations",fr:"Source des paires d’images pour les visualisations"}},j=B=>{var we,Xe;return((we=L[B])==null?void 0:we[q])||((Xe=L[B])==null?void 0:Xe.en)||B};let R,x,H,P,X=null,U="name",K=.5,Z=!1,ae=0,ce,de=null,fe="page";function De(B,we){const Xe="full";return Yt(`wit${B.witnessId}_${B.digitizationRef}_${String(we).padStart(B.zeros,"0")}`,"full",Xe)}function Ke(B){var we;return Yt(B.ref,(we=B.xywh)==null?void 0:we.join(","),"full")}function he(B,we,Xe){var ze,ke;if(!B||!we||!Xe)return null;const{doc1:qe,doc2:rt}=we;if(we.mode==="image"){const G=(ze=we.images1)==null?void 0:ze[B.idx1],Se=(ke=we.images2)==null?void 0:ke[B.idx2];if(!G||!Se)return null;const ve=`${B.idx1}-${B.idx2}`,ct=we.pairScores.get(ve);return{items:[{doc:qe,label:`Page ${G.canvas} Image #${B.idx1+1}`,imgUrl:Ke(G)},{doc:rt,label:`Page ${Se.canvas} Image #${B.idx2+1}`,imgUrl:Ke(Se)}],score:ct==null?void 0:ct.score}}const Te=B.idx1+1,ht=B.idx2+1,Ne=we.points.find(G=>G.page1===Te&&G.page2===ht);return{items:[{doc:qe,label:`Page ${Te}`,imgUrl:De(qe,Te)},{doc:rt,label:`Page ${ht}`,imgUrl:De(rt,ht)}],score:Ne==null?void 0:Ne.score}}function Y(B,we){!de||!s||(B==="horizontal"?n(29,de.idx1=(de.idx1+we+a.max1)%a.max1,de):n(29,de.idx2=(de.idx2+we+a.max2)%a.max2,de),n(29,de))}function te(B){if(!de||!(P!=null&&P.classList.contains("is-active")))return;const Xe={ArrowUp:["vertical",-1],ArrowDown:["vertical",1],ArrowLeft:["horizontal",-1],ArrowRight:["horizontal",1]}[B.key];Xe&&(B.preventDefault(),Y(Xe[0],Xe[1]))}function se(B,we,Xe,qe,rt,Te){var Se;if(!B.length)return{docs:[],matrix:[],maxScore:0};B.forEach((ve,ct)=>{var I;ve.index=ct,ve.count=((I=Xe==null?void 0:Xe.get(ve.id))==null?void 0:I.count)||0});const Ne={name:qi(B.length).sort((ve,ct)=>B[ve].title.localeCompare(B[ct].title)),score:qi(B.length).sort((ve,ct)=>B[ct].count-B[ve].count)}[qe].map(ve=>B[ve]),ze=Ne.length,ke=[];let G=0;for(let ve=0;ve<ze;ve++){const ct=[];for(let I=0;I<ze;I++)if(ve!==I){const A=Ne[ve].id<Ne[I].id?`${Ne[ve].id}-${Ne[I].id}`:`${Ne[I].id}-${Ne[ve].id}`;let D=((Se=we==null?void 0:we.get(A))==null?void 0:Se.score)||0;if(rt&&D>0){const J=Te.get(Ne[ve].id)||1,ee=Te.get(Ne[I].id)||1;D/=Math.sqrt(J*ee)}D>G&&(G=D),ct.push({x:I,y:ve,z:D,doc1:Ne[ve],doc2:Ne[I]})}else ct.push({x:I,y:ve,z:0,diagonal:!0});ke.push(ct)}return{docs:Ne,matrix:ke,maxScore:G}}function Q(B,we,Xe,qe){const{doc1:rt,doc2:Te}=B,ht=rt.id<Te.id?`${rt.id}-${Te.id}`:`${Te.id}-${rt.id}`;let Ne=u.byDocPair.get(ht)||[];return Xe&&qe.size>0&&(Ne=Ne.filter(ze=>qe.has(`${ze.id_1}-${ze.id_2}`))),Ne.length?we==="image"?$_(rt,Te,Ne):R_(rt,Te,Ne):null}function oe(){if(!x||!r.docs.length)return;const{docs:B,matrix:we,maxScore:Xe}=r,qe=B.length*wa;mt(x).selectAll("*").remove();const rt=mt(x).append("svg").attr("width",qe).attr("height",qe),Te=Ul().range([0,qe]).domain(qi(B.length)).padding(.02),ht=mt("body").selectAll(".matrix-tooltip").data([0]).join("div").attr("class","matrix-tooltip").style("position","fixed").style("background","var(--bulma-scheme-main)").style("border","1px solid var(--bulma-border)").style("border-radius","4px").style("padding","8px").style("pointer-events","none").style("opacity",0).style("font-size","12px").style("box-shadow","0 2px 4px rgba(0,0,0,0.15)").style("z-index","9999").style("color","var(--bulma-text)");rt.selectAll(".row").data(we).join("g").attr("class","row").attr("transform",(ze,ke)=>`translate(0,${Te(ke)})`).each(function(ze){mt(this).selectAll(".cell").data(ze.filter(ke=>!ke.diagonal)).join("rect").attr("class","cell").attr("x",ke=>Te(ke.x)).attr("width",Te.bandwidth()).attr("height",Te.bandwidth()).attr("fill",ke=>{if(ke.z===0)return"var(--bulma-text)";const G=er(233,.951,.52);return G.opacity=Xe>0?.2+.8*(ke.z/Xe):.2,G}).attr("stroke",ke=>Ee(ke)?"var(--bulma-text)":"var(--bulma-scheme-main)").attr("stroke-width",ke=>Ee(ke)?2:.5).style("cursor","pointer").on("mouseover",function(ke,G){Ee(G)||mt(this).attr("stroke","var(--bulma-text)").attr("stroke-width",2),ht.style("opacity",1)}).on("mousemove",function(ke,G){const Se=`<span style="color:${G.doc1.color}">●</span> ${G.doc1.title}<br/>↔<br/><span style="color:${G.doc2.color}">●</span> ${G.doc2.title}`,ve=G.z===0?`${Se}<br/><br/><em>${j("noPairs")}</em>`:`${Se}<br/><br/>${j("score")}: ${G.z.toFixed(2)}`;ht.html(ve).style("left",ke.clientX+15+"px").style("top",ke.clientY+15+"px")}).on("mouseleave",function(ke,G){Ee(G)||mt(this).attr("stroke","var(--bulma-scheme-main)").attr("stroke-width",.5),ht.style("opacity",0)}).on("click",(ke,G)=>{n(2,X={row:G.y,col:G.x,doc1:G.doc1,doc2:G.doc2}),Ge()})}),rt.selectAll(".row").selectAll(".cell-diagonal").data(ze=>ze.filter(ke=>ke.diagonal)).join("rect").attr("class","cell-diagonal").attr("x",ze=>Te(ze.x)).attr("width",Te.bandwidth()).attr("height",Te.bandwidth()).attr("fill","var(--contrasted)")}function Ee(B){return X&&X.doc1.id===B.doc1.id&&X.doc2.id===B.doc2.id}function Ge(){x&&mt(x).selectAll(".cell").attr("stroke",B=>Ee(B)?"var(--bulma-text)":"var(--bulma-scheme-main)").attr("stroke-width",B=>Ee(B)?2:.5)}function Je(){!H||!s||(mt(H).selectAll("*").remove(),s.mode==="image"?Oe():Ce())}function Ce(){const{points:B,minScore:we,maxScore:Xe,doc1:qe,doc2:rt}=s;if(!B.length)return;const Te={top:65,right:40,bottom:20,left:80},ht=10,Ne=Math.max(...B.map(ue=>ue.page1)),ze=Math.max(...B.map(ue=>ue.page2)),ke=Ne*st,G=ze*st,Se=new Map(B.map(ue=>[`${ue.page1}-${ue.page2}`,ue])),ve=ke+Te.left+Te.right,ct=G+Te.top+Te.bottom,A=mt(H).append("svg").attr("width",ve).attr("height",ct).append("g").attr("transform",`translate(${Te.left},${Te.top})`),D=yi().domain([0,Ne]).range([0,ke]),J=yi().domain([0,ze]).range([0,G]),ee=mt("body").selectAll(".scatter-tooltip").data([0]).join("div").attr("class","scatter-tooltip").style("position","fixed").style("background","var(--bulma-scheme-main)").style("border","1px solid var(--bulma-border)").style("border-radius","4px").style("padding","6px 10px").style("pointer-events","none").style("opacity",0).style("font-size","11px").style("box-shadow","0 2px 4px rgba(0,0,0,0.15)").style("z-index","9999").style("color","var(--bulma-text)"),ne=new Array(Ne).fill(0),ge=new Array(ze).fill(0);B.forEach(ue=>{ne[ue.page1-1]++,ge[ue.page2-1]++});const le=Math.max(...ne),nt=Math.max(...ge),it=A.append("g").attr("transform",`translate(0,${-22-ht})`);ne.forEach((ue,Ie)=>{ue!==0&&it.append("rect").attr("x",Ie*st).attr("width",st).attr("height",ht).attr("fill",qe.color).attr("opacity",.15+.85*(ue/le)).style("cursor","default").on("mouseover",()=>ee.style("opacity",1)).on("mousemove",xe=>{ee.html(`<strong>${ue}</strong> image${ue>1?"s":""}<br/>${j("page")} ${Ie+1}`).style("left",xe.clientX+10+"px").style("top",xe.clientY-30+"px")}).on("mouseleave",()=>ee.style("opacity",0))});const lt=A.append("g").attr("transform","translate(-55,0)");ge.forEach((ue,Ie)=>{ue!==0&&lt.append("rect").attr("x",0).attr("y",Ie*st).attr("width",ht).attr("height",st).attr("fill",rt.color).attr("opacity",.15+.85*(ue/nt)).style("cursor","default").on("mouseover",()=>ee.style("opacity",1)).on("mousemove",xe=>{ee.html(`<strong>${ue}</strong> image${ue>1?"s":""}<br/>${j("page")} ${Ie+1}`).style("left",xe.clientX+10+"px").style("top",xe.clientY-30+"px")}).on("mouseleave",()=>ee.style("opacity",0))}),A.append("g").call(Po(D).ticks(Math.min(Ne,10))),A.append("g").call(Oo(J).ticks(Math.min(ze,10)));const at=(ue,Ie)=>{const xe=Math.floor(Ie/6);return ue.length>xe?ue.slice(0,xe-1)+"…":ue},ye=A.append("g").attr("transform",`translate(${ke/2},-50)`);ye.append("circle").attr("r",4).attr("cx",-ke/2+4).attr("fill",qe.color),ye.append("text").attr("x",-ke/2+14).attr("text-anchor","start").attr("dominant-baseline","middle").attr("font-size","11px").attr("fill","var(--bulma-text)").text(at(`${qe.title} (${j("page")})`,ke-20));const Ze=A.append("g").attr("transform",`translate(-68,${G/2}) rotate(-90)`);Ze.append("circle").attr("r",4).attr("cx",-G/2+4).attr("fill",rt.color),Ze.append("text").attr("x",-G/2+14).attr("text-anchor","start").attr("dominant-baseline","middle").attr("font-size","11px").attr("fill","var(--bulma-text)").text(at(`${rt.title} (${j("page")})`,G-20)),A.append("rect").attr("class","hover-overlay").attr("width",ke).attr("height",G).attr("fill","transparent").style("cursor","pointer").on("mousemove",ue=>{const[Ie,xe]=wt(ue,A.node()),zt=Math.floor(Ie/st)+1,jt=Math.floor(xe/st)+1;if(zt<1||zt>Ne||jt<1||jt>ze){ee.style("opacity",0);return}const gn=Se.get(`${zt}-${jt}`),In=`<span style="color:${qe.color}">●</span> ${j("page")} ${zt}<br/><span style="color:${rt.color}">●</span> ${j("page")} ${jt}`,Ln=gn?`${In}<br/>${j("score")}: ${gn.score.toFixed(2)}`:In;ee.style("opacity",1).html(Ln).style("left",ue.clientX+10+"px").style("top",ue.clientY-40+"px")}).on("mouseleave",()=>ee.style("opacity",0)).on("click",ue=>{const[Ie,xe]=wt(ue,A.node()),zt=Math.floor(Ie/st)+1,jt=Math.floor(xe/st)+1;zt<1||zt>Ne||jt<1||jt>ze||(n(29,de={idx1:zt-1,idx2:jt-1}),P==null||P.classList.add("is-active"))}),A.selectAll(".cell").data(B).join("rect").attr("class","cell").attr("x",ue=>(ue.page1-1)*st).attr("y",ue=>(ue.page2-1)*st).attr("width",st).attr("height",st).attr("fill",er(233,.951,.52)).attr("opacity",ue=>Xe>we?.2+.8*(ue.score-we)/(Xe-we):.5).attr("pointer-events","none"),n(1,H.style.width=ve+"px",H),n(1,H.style.height=ct+"px",H)}function Oe(){const{images1:B,images2:we,pairScores:Xe,minScore:qe,maxScore:rt,doc1:Te,doc2:ht}=s;if(!B.length||!we.length)return;const Ne={top:65,right:40,bottom:20,left:80},ze=10,ke=B.length*st,G=we.length*st,Se=ke+Ne.left+Ne.right,ve=G+Ne.top+Ne.bottom,I=mt(H).append("svg").attr("width",Se).attr("height",ve).append("g").attr("transform",`translate(${Ne.left},${Ne.top})`),A=yi().domain([0,B.length]).range([0,ke]),D=yi().domain([0,we.length]).range([0,G]),J=mt("body").selectAll(".scatter-tooltip").data([0]).join("div").attr("class","scatter-tooltip").style("position","fixed").style("background","var(--bulma-scheme-main)").style("border","1px solid var(--bulma-border)").style("border-radius","4px").style("padding","6px 10px").style("pointer-events","none").style("opacity",0).style("font-size","11px").style("box-shadow","0 2px 4px rgba(0,0,0,0.15)").style("z-index","9999").style("color","var(--bulma-text)"),ee=Sa(B),ne=Sa(we),ge=I.append("g").attr("transform",`translate(0,${-22-ze})`);ee.forEach(({start:ye,end:Ze,page:ue,count:Ie})=>{ge.append("rect").attr("x",ye*st).attr("width",(Ze-ye)*st).attr("height",ze).attr("fill",Te.color).attr("opacity",.5).style("cursor","default").on("mouseover",()=>J.style("opacity",1)).on("mousemove",xe=>{J.html(`${j("page")} ${ue}<br/><strong>${Ie}</strong> image${Ie>1?"s":""}`).style("left",xe.clientX+10+"px").style("top",xe.clientY-30+"px")}).on("mouseleave",()=>J.style("opacity",0))});const le=I.append("g").attr("transform","translate(-55,0)");ne.forEach(({start:ye,end:Ze,page:ue,count:Ie})=>{le.append("rect").attr("x",0).attr("y",ye*st).attr("width",ze).attr("height",(Ze-ye)*st).attr("fill",ht.color).attr("opacity",.5).style("cursor","default").on("mouseover",()=>J.style("opacity",1)).on("mousemove",xe=>{J.html(`${j("page")} ${ue}<br/><strong>${Ie}</strong> image${Ie>1?"s":""}`).style("left",xe.clientX+10+"px").style("top",xe.clientY-30+"px")}).on("mouseleave",()=>J.style("opacity",0))}),I.append("g").call(Po(A).ticks(Math.min(B.length,10))),I.append("g").call(Oo(D).ticks(Math.min(we.length,10)));const nt=(ye,Ze)=>{const ue=Math.floor(Ze/6);return ye.length>ue?ye.slice(0,ue-1)+"…":ye},it=I.append("g").attr("transform",`translate(${ke/2},-50)`);it.append("circle").attr("r",4).attr("cx",-ke/2+4).attr("fill",Te.color),it.append("text").attr("x",-ke/2+14).attr("text-anchor","start").attr("dominant-baseline","middle").attr("font-size","11px").attr("fill","var(--bulma-text)").text(nt(`${Te.title} (${j("image")})`,ke-20));const lt=I.append("g").attr("transform",`translate(-68,${G/2}) rotate(-90)`);lt.append("circle").attr("r",4).attr("cx",-G/2+4).attr("fill",ht.color),lt.append("text").attr("x",-G/2+14).attr("text-anchor","start").attr("dominant-baseline","middle").attr("font-size","11px").attr("fill","var(--bulma-text)").text(nt(`${ht.title} (${j("image")})`,G-20)),I.append("rect").attr("class","hover-overlay").attr("width",ke).attr("height",G).attr("fill","transparent").style("cursor","pointer").on("mousemove",ye=>{const[Ze,ue]=wt(ye,I.node()),Ie=Math.floor(Ze/st),xe=Math.floor(ue/st);if(Ie<0||Ie>=B.length||xe<0||xe>=we.length){J.style("opacity",0);return}const zt=B[Ie],jt=we[xe],gn=Xe.get(`${Ie}-${xe}`),In=`<span style="color:${Te.color}">●</span> ${j("page")} ${zt.canvas}, ${j("image")} ${Ie+1}<br/><span style="color:${ht.color}">●</span> ${j("page")} ${jt.canvas}, ${j("image")} ${xe+1}`,Ln=gn?`${In}<br/>${j("score")}: ${gn.score.toFixed(2)}`:In;J.style("opacity",1).html(Ln).style("left",ye.clientX+10+"px").style("top",ye.clientY-40+"px")}).on("mouseleave",()=>J.style("opacity",0)).on("click",ye=>{const[Ze,ue]=wt(ye,I.node()),Ie=Math.floor(Ze/st),xe=Math.floor(ue/st);Ie>=0&&Ie<B.length&&xe>=0&&xe<we.length&&(n(29,de={idx1:Ie,idx2:xe}),P==null||P.classList.add("is-active"))});const at=Array.from(Xe.values());I.selectAll(".cell").data(at).join("rect").attr("class","cell").attr("x",ye=>ye.idx1*st).attr("y",ye=>ye.idx2*st).attr("width",st).attr("height",st).attr("fill",er(233,.951,.52)).attr("opacity",ye=>rt>qe?.2+.8*(ye.score-qe)/(rt-qe):.5).attr("pointer-events","none"),n(1,H.style.width=Se+"px",H),n(1,H.style.height=ve+"px",H)}function Re(B){Z=!0,B.preventDefault()}function Qe(B){var qe,rt;if(!Z||!R)return;const we=R.getBoundingClientRect(),Xe=(B.clientX||((rt=(qe=B.touches)==null?void 0:qe[0])==null?void 0:rt.clientX))-we.left;n(27,K=Math.max(.2,Math.min(.8,Xe/we.width)))}function ft(){Z=!1}zn(()=>{R&&(n(28,ae=R.offsetWidth),ce=new ResizeObserver(B=>{n(28,ae=B[0].contentRect.width)}),ce.observe(R)),window.addEventListener("mousemove",Qe),window.addEventListener("mouseup",ft),window.addEventListener("touchmove",Qe),window.addEventListener("touchend",ft),window.addEventListener("keydown",te)}),jn(()=>{ce==null||ce.disconnect(),window.removeEventListener("mousemove",Qe),window.removeEventListener("mouseup",ft),window.removeEventListener("touchmove",Qe),window.removeEventListener("touchend",ft),window.removeEventListener("keydown",te)});function kt(){f=Ai(this),M.set(f)}function ot(){U=Ai(this),n(3,U)}const $e=B=>O.set(B.target.checked);function Mt(B){vn[B?"unshift":"push"](()=>{x=B,n(0,x)})}function Ue(){fe=Ai(this),n(4,fe)}function pt(B){vn[B?"unshift":"push"](()=>{H=B,n(1,H)})}function Be(B){vn[B?"unshift":"push"](()=>{R=B,n(10,R)})}const gt=B=>Y(B!==0?"vertical":"horizontal",-1),dt=B=>Y(B!==0?"vertical":"horizontal",1);function bt(B){vn[B?"unshift":"push"](()=>{P=B,n(11,P)})}return t.$$set=B=>{"documentSetStore"in B&&n(26,S=B.documentSetStore)},t.$$.update=()=>{t.$$.dirty[1]&16&&n(7,i=Array.from((_==null?void 0:_.values())||[])),t.$$.dirty[0]&648|t.$$.dirty[1]&14&&n(6,r=se(i,g.scoreCount,p.scoreCount,U,m,d)),t.$$.dirty[0]&276|t.$$.dirty[1]&1&&n(5,s=X?Q(X,fe,f==="filtered",h):null),t.$$.dirty[0]&402653184&&n(14,o=Math.max(ba,ae*K-4)),t.$$.dirty[0]&402653184&&n(13,l=Math.max(ba,ae*(1-K)-4)),t.$$.dirty[0]&32&&n(30,a=s?D_(s):{max1:0,max2:0,pages1:[],pages2:[]}),t.$$.dirty[0]&1610612768&&n(12,c=de&&s&&a?he(de,s,a):null),t.$$.dirty[0]&65&&x&&r.docs.length&&oe(),t.$$.dirty[0]&34&&H&&s&&Je()},[x,H,X,U,fe,s,r,i,f,m,R,P,c,l,o,C,w,k,T,N,E,M,O,j,Y,Re,S,K,ae,de,a,h,d,p,g,_,kt,ot,$e,Mt,Ue,pt,Be,gt,dt,bt]}class j_ extends Ve{constructor(e){super(),He(this,e,z_,L_,je,{documentSetStore:26},null,[-1,-1,-1])}}const F_=1e4;async function H_(t,e,n={}){const{onProgress:i,onError:r,signal:s}=n,o=await fetch(t,{signal:s});if(!o.ok){const d=await o.json().catch(()=>({error:o.statusText}));throw new Error(d.error||`HTTP ${o.status}`)}const l=o.body.getReader(),a=new TextDecoder;let c="",u=[],h=0,f=!1;try{for(;;){const{done:d,value:m}=await l.read();if(d){if(c.trim()){const g=ka(c);g&&u.push(g)}return u.length>0?(h+=u.length,e.postMessage({type:"batch",pairs:u,isLast:!0})):e.postMessage({type:"done"}),i==null||i(h,!0),h}c+=a.decode(m,{stream:!0});const p=c.split(`
`);c=p.pop()||"";for(const g of p){if(!g)continue;const _=ka(g);_&&(u.push(_),u.length>=F_&&(f||(e.postMessage({type:"init"}),f=!0),h+=u.length,e.postMessage({type:"batch",pairs:u,isLast:!1}),u=[],i==null||i(h,!1)))}}}catch(d){throw d.name==="AbortError"?(e.postMessage({type:"abort"}),d):(r==null||r(d),d)}}function ka(t){try{return JSON.parse(t)}catch{return console.warn("Parse error:",t.slice(0,50)),null}}const Ea="https://vhs.huma-num.fr",V_=()=>new Worker("/static/js/pairWorker.js",{type:"module"});function U_(t){const e=Pe(null),n=Pe(!1),i=Pe({loaded:0,done:!1}),r=Pe([]),s=Pe(new Set),o=Pe([]),l=Pe(0),a=Pe(3),c=Pe(!1),u=Pe("threshold"),h=Pe([]),f=Pe(new Map);let d,m=null;const p=Pe({byImage:new Map,byDocPair:new Map,byDoc:new Map}),g=Pe(new Map),_=Pe(new Map),S=Pe({}),C=Pe({}),w=Pe({}),k=Pe({}),T=Pe({documents:0,pairs:null,images:0,categories:{}}),N=ut(r,(Y,te)=>{if(Y.length===0){te(Promise.resolve(0));return}d&&d.terminate()&&(d=null),m&&m.abort(),m=new AbortController;const se=413,Q=new Promise((oe,Ee)=>{n.set(!0),i.set({loaded:0,done:!1}),e.set(null),(async()=>{try{d=V_(),d.onmessage=async Ce=>{const{type:Oe}=Ce.data;if(Oe==="progress"){i.set({loaded:Ce.data.count,done:!1});return}if(Oe!=="complete")return;const{allPairs:Re,imageNodes:Qe,pairIndex:ft,categories:kt,stats:ot}=Ce.data;p.set(ft),S.set(ot.pairStats),K(),C.set(ot.documentStats),w.set(ot.imageStats),k.set(ot.docPairStats);const $e=Array.from(ot.documentStats.scoreCount.keys());yt(s).size===0&&s.set(new Set($e));const Mt=await Promise.all($e.map(Be=>E(Be).then(gt=>({id:Be,info:gt})))),Ue=new Map;Mt.forEach(({id:Be,info:gt})=>Ue.set(Be,gt)),f.set(Ue);const pt=new Map;$e.forEach((Be,gt)=>{const dt=Ue.get(Be)||{};pt.set(Be,{id:Be,title:dt.title||`Region Extraction ${Be}`,color:dt.color||Iu(gt),images:[],...dt})}),Qe.forEach(Be=>{const gt=pt.get(Be.regionId);gt&&(Be.color=gt.color,Be.title=`${gt.title} | Page ${Be.canvas}`,gt.images.push(Be))}),pt.forEach(Be=>Be.images.sort((gt,dt)=>{var bt,B;return gt.canvas!==dt.canvas?gt.canvas-dt.canvas:(parseInt((bt=gt.xywh)==null?void 0:bt[1])||0)-(parseInt((B=dt.xywh)==null?void 0:B[1])||0)})),g.set(Qe),_.set(pt),T.set({documents:$e.length,pairs:Re.length,images:Qe.size,categories:kt}),h.set(Re),n.set(!1),i.set({loaded:Re.length,done:!0}),d.terminate(),d=null,oe(Re.length)},d.onerror=Ce=>{console.error("Worker error",Ce),e.set(`Worker error: ${Ce.message}`),n.set(!1),Ee(Ce)};const Je=`${Ea}/document-set/${se}/pairs/stream?category=${Y.join(",")}`;await H_(Je,d,{signal:m.signal,onProgress:(Ce,Oe)=>{i.set({loaded:Ce,done:Oe})},onError:Ce=>{e.set(`Stream error: ${Ce.message}`)}})}catch(Je){if(Je.name==="AbortError"){console.log("Request aborted");return}e.set(`Fetch error: ${Je.message}`),n.set(!1),Ee(Je)}})()});te(Q)});async function E(Y){try{const te=await fetch(`${Ea}/search/regions/?id=${Y}`);if(!te.ok)throw new Error(`HTTP ${te.status}`);const{results:se}=await te.json();if(!(se!=null&&se.length))return{title:`Region Extraction ${Y}`};const Q=se[0],[,...oe]=Q.title.split(" | "),[Ee,Ge]=(Q.ref||"_").split("_");return{title:oe.join(" | "),ref:Q.ref,witnessId:Nr(Ee),digitizationRef:Ge,zeros:Q.zeros,img_nb:Q.img_nb,url:Q.url}}catch(te){return e.set(`Error fetching region #${Y}: ${te.message}`),{title:`Region Extraction ${Y}`}}}const M=ut([h,l,a,c,s],([Y,te,se,Q,oe])=>{if(!Y)return[];const Ee=[],Ge=yt(u);for(let Je=0;Je<Y.length;Je++){const Ce=Y[Je];if(Ge==="threshold"&&Ce.weightedScore<te)break;if(!(!oe.has(Ce.regions_id_1)||!oe.has(Ce.regions_id_2))){if(Ge==="topk"&&se!==null){const Oe=Ce.rank_1??1/0,Re=Ce.rank_2??1/0;if(Q){if(Oe>se||Re>se)continue}else if(Oe>se&&Re>se)continue}Ee.push(Ce)}}return Ee}),O=ut([M,_],([Y,te])=>{if(!Y.length||te.size===0)return[];const se=new Set;for(const oe of Y)se.add(oe.regions_id_1),se.add(oe.regions_id_2);const Q=[];return se.forEach(oe=>{const Ee=te.get(oe);Ee&&Q.push(Ee)}),Q.sort((oe,Ee)=>Ee.id-oe.id)});function L(Y,te,se=10,Q=200,oe=2,Ee=25){if(!te)return{strength:.5,distance:100,width:2};const{min:Ge,_:Je,range:Ce}=te,Oe=Ce===0?.5:(Y-Ge)/Ce,Re=Q-Oe*(Q-se),Qe=oe+Oe*(Ee-oe);return{strength:Oe,distance:Re,width:Qe}}function j(Y,te,se=10,Q=60){if(!te)return se;const{min:oe,_:Ee,range:Ge}=te;return Ge===0?(se+Q)/2:se+(Y-oe)/Ge*(Q-se)}const R=ut([M],([Y])=>{var Je;const te=yt(g),se=yt(w),Q=yt(S),oe=new Set,Ee=[];for(const Ce of Y){const{strength:Oe,distance:Re,width:Qe}=L(Ce.weightedScore,Q.scoreRange);Ee.push({source:Ce.id_1,target:Ce.id_2,strength:Oe,distance:Re,width:Qe}),oe.has(Ce.id_1)||oe.add(Ce.id_1),oe.has(Ce.id_2)||oe.add(Ce.id_2)}const Ge=[];for(const Ce of oe){const Oe=te.get(Ce);if(Oe){const Re=(Je=se.scoreCount)==null?void 0:Je.get(Ce),{count:Qe,score:ft}=Re;Ge.push({...Oe,radius:j(ft,se.scoreRange),label:`Region: ${Oe.regionId}
Page: ${Oe.canvas}
Connections: ${Qe}
Total score: ${ft.toFixed(2)}`})}}return{nodes:Ge,links:Ee}}),x=ut(O,Y=>{const te=yt(k),se=yt(C);if(Y.size===0)return{nodes:[],links:[]};const Q=Array.from(Y.values()).map(Ee=>{var Oe;const Ge=(Oe=se.scoreCount)==null?void 0:Oe.get(Ee.id),{count:Je,score:Ce}=Ge;return{...Ee,radius:j(Je,se.countRange),label:`${Ee.title}
Images: ${Je}
Total score: ${Ce.toFixed(2)}`}}),oe=Array.from(te.scoreCount.entries()).map(([Ee,Ge])=>{const[Je,Ce]=Ee.split("-").map(Number),{strength:Oe,distance:Re,width:Qe}=L(Ge.score,te.scoreRange);return{source:Je,target:Ce,strength:Oe,distance:Re,width:Qe}});return{nodes:Q,links:oe}});function H(Y){if(!Y.length)return{regions:[],rows:[]};const te=yt(_),se=yt(p),Q=Y[0],oe=te.get(Q);if(!(oe!=null&&oe.images))return{regions:Y,rows:[]};const Ee=oe.images,Ge=(Re,Qe,ft)=>{const{r1:kt,r2:ot}={r1:Qe,r2:ft},$e=kt<ot?`${kt}-${ot}`:`${ot}-${kt}`;return(se.byDocPair.get($e)||[]).map(Ue=>Ue.id_1===Re&&Ue.regions_id_1===Qe?{id:Ue.id_2,page:Ue.page_2}:Ue.id_2===Re&&Ue.regions_id_2===Qe?{id:Ue.id_1,page:Ue.page_1}:null).filter(Boolean)},Je=[];for(const Re of Ee){let Qe=[{[Q]:{id:Re.id,page:Re.canvas}}];for(let ft=1;ft<Y.length;ft++){const kt=Y[ft],ot=[];for(const $e of Qe){const Mt=[];for(let Ue=0;Ue<ft;Ue++){const pt=Y[Ue];if($e[pt]){const Be=Ge($e[pt].id,pt,kt);Mt.push(...Be)}}if(Mt.length===0)ot.push($e);else{const Ue=new Map;Mt.forEach(pt=>{Ue.has(pt.id)||Ue.set(pt.id,pt)});for(const pt of Ue.values()){const Be={...$e,[kt]:pt};ot.push(Be)}}}Qe=ot}Je.push(...Qe)}const Ce=[],Oe=new Set;for(const Re of Je){const Qe=Y.map(ft=>{var kt;return((kt=Re[ft])==null?void 0:kt.id)||""}).join("|");Oe.has(Qe)||(Oe.add(Qe),Ce.push(Re))}return{regions:Y,rows:Ce}}function P(Y){r.update(te=>te.indexOf(Y)>-1?te.filter(Q=>Q!==Y):[...te,Y].sort((Q,oe)=>Q-oe))}function X(Y){s.update(te=>{const se=new Set(te);return se.has(Y)?se.delete(Y):se.add(Y),se})}function U(){const Y=Array.from(yt(_).keys());s.set(new Set(Y))}function K(){if(!yt(r).includes(0))return;const{min:Y,max:te}=yt(S).scoreRange||{};Y==null||te==null||yt(l)===Y&&l.set((Y+te)/2)}const Z=Pe("filtered"),ae=Pe(!1),ce=ut(M,Y=>{const te=new Set;for(const se of Y)te.add(`${se.id_1}-${se.id_2}`);return te}),de=ut(M,Y=>{const te=new Map;if(!(Y!=null&&Y.length))return{scoreCount:te,scoreRange:{min:0,max:0,range:0}};let se=1/0,Q=-1/0;for(const oe of Y){const Ee=oe.regions_id_1<oe.regions_id_2?`${oe.regions_id_1}-${oe.regions_id_2}`:`${oe.regions_id_2}-${oe.regions_id_1}`,Ge=te.get(Ee)||{score:0,count:0};Ge.score+=oe.weightedScore||0,Ge.count++,te.set(Ee,Ge)}for(const{score:oe}of te.values())oe<se&&(se=oe),oe>Q&&(Q=oe);return se===1/0&&(se=Q=0),{scoreCount:te,scoreRange:{min:se,max:Q,range:Q-se}}}),fe=ut(M,Y=>{const te=new Map;if(!(Y!=null&&Y.length))return{scoreCount:te,countRange:{min:0,max:0,range:0}};for(const oe of Y)for(const Ee of[oe.regions_id_1,oe.regions_id_2]){const Ge=te.get(Ee)||{score:0,count:0};Ge.score+=oe.weightedScore||0,Ge.count++,te.set(Ee,Ge)}let se=1/0,Q=-1/0;for(const{count:oe}of te.values())oe<se&&(se=oe),oe>Q&&(Q=oe);return se===1/0&&(se=Q=0),{scoreCount:te,countRange:{min:se,max:Q,range:Q-se}}}),De=ut([Z,k,de],([Y,te,se])=>Y==="filtered"?se:te),Ke=ut([Z,C,fe],([Y,te,se])=>Y==="filtered"?se:te),he=ut(_,Y=>{var se;const te=new Map;for(const[Q,oe]of Y)te.set(Q,Math.max(1,((se=oe.images)==null?void 0:se.length)||oe.img_nb||1));return te});return{error:e,loadingProgress:i,cancelLoading:()=>{m&&(m.abort(),n.set(!1))},allPairs:h,visiblePairs:M,pairIndex:p,documentNodes:_,imageNodes:g,fetchPairs:N,imageNetwork:R,documentNetwork:x,selectedCategories:r,pairStats:S,documentStats:C,imageStats:w,docPairStats:k,docSetNumber:T,selectedNodes:o,selectedRegions:s,updateSelectedNodes:Y=>o.set(Y),toggleCategory:P,toggleRegion:X,selectAllRegions:U,buildAlignedImageMatrix:H,threshold:l,setThreshold:Y=>l.set(Y),topK:a,setTopK:Y=>a.set(Y),mutualTopK:c,setMutualTopK:Y=>c.set(Y),scoreMode:u,setScoreMode:Y=>u.set(Y),matrixMode:Z,setMatrixMode:Y=>Z.set(Y),normalizeByImages:ae,activeDocPairStats:De,activeDocStats:Ke,imageCountMap:he,visiblePairIds:ce}}function B_(t){let e,n,i;const r=t[1].default,s=Bt(r,t,t[0],null);return{c(){e=b("table"),n=b("tbody"),s&&s.c(),v(e,"class","table is-fullwidth")},m(o,l){z(o,e,l),y(e,n),s&&s.m(n,null),i=!0},p(o,[l]){s&&s.p&&(!i||l&1)&&Kt(s,r,o,o[0],i?qt(r,o[0],l,null):Wt(o[0]),null)},i(o){i||(V(s,o),i=!0)},o(o){W(s,o),i=!1},d(o){o&&$(e),s&&s.d(o)}}}function q_(t,e,n){let{$$slots:i={},$$scope:r}=e;return t.$$set=s=>{"$$scope"in s&&n(0,r=s.$$scope)},[r,i]}class K_ extends Ve{constructor(e){super(),He(this,e,q_,B_,je,{})}}const W_=t=>({}),Ca=t=>({}),Y_=t=>({}),Ia=t=>({}),G_=t=>({}),xa=t=>({});function X_(t){let e;const n=t[4]["row-body"],i=Bt(n,t,t[3],Ca);return{c(){i&&i.c()},m(r,s){i&&i.m(r,s),e=!0},p(r,s){i&&i.p&&(!e||s&8)&&Kt(i,n,r,r[3],e?qt(n,r[3],s,W_):Wt(r[3]),Ca)},i(r){e||(V(i,r),e=!0)},o(r){W(i,r),e=!1},d(r){i&&i.d(r)}}}function J_(t){let e,n,i,r;const s=t[4]["row-body"],o=Bt(s,t,t[3],Ia);return{c(){e=b("div"),n=b("div"),o&&o.c(),v(n,"class","grid is-gap-2"),v(e,"class",i="fixed-grid has-"+t[2]+"-cols")},m(l,a){z(l,e,a),y(e,n),o&&o.m(n,null),r=!0},p(l,a){o&&o.p&&(!r||a&8)&&Kt(o,s,l,l[3],r?qt(s,l[3],a,Y_):Wt(l[3]),Ia),(!r||a&4&&i!==(i="fixed-grid has-"+l[2]+"-cols"))&&v(e,"class",i)},i(l){r||(V(o,l),r=!0)},o(l){W(o,l),r=!1},d(l){l&&$(e),o&&o.d(l)}}}function Q_(t){let e,n,i,r,s,o,l,a,c,u;Ht(t[5]);const h=t[4]["row-header"],f=Bt(h,t,t[3],xa),d=[J_,X_],m=[];function p(g,_){return g[0]?0:1}return o=p(t),l=m[o]=d[o](t),{c(){e=b("tr"),n=b("th"),i=b("div"),f&&f.c(),r=F(),s=b("td"),l.c(),v(i,"class","content-wrapper py-5"),v(n,"class","is-3 center-flex is-narrow"),We(n,"width","15vw"),v(s,"class","p-5 is-fullwidth")},m(g,_){z(g,e,_),y(e,n),y(n,i),f&&f.m(i,null),y(e,r),y(e,s),m[o].m(s,null),a=!0,c||(u=be(window,"resize",t[5]),c=!0)},p(g,[_]){f&&f.p&&(!a||_&8)&&Kt(f,h,g,g[3],a?qt(h,g[3],_,G_):Wt(g[3]),xa);let S=o;o=p(g),o===S?m[o].p(g,_):(et(),W(m[S],1,1,()=>{m[S]=null}),tt(),l=m[o],l?l.p(g,_):(l=m[o]=d[o](g),l.c()),V(l,1),l.m(s,null))},i(g){a||(V(f,g),V(l),a=!0)},o(g){W(f,g),W(l),a=!1},d(g){g&&$(e),f&&f.d(g),m[o].d(),c=!1,u()}}}function Z_(t,e,n){let i,{$$slots:r={},$$scope:s}=e,{useGrid:o=!0}=e,l=0;function a(){n(1,l=window.innerWidth)}return t.$$set=c=>{"useGrid"in c&&n(0,o=c.useGrid),"$$scope"in c&&n(3,s=c.$$scope)},t.$$.update=()=>{t.$$.dirty&2&&n(2,i=Bs(l))},[o,l,i,s,r,a]}class Ma extends Ve{constructor(e){super(),He(this,e,Z_,Q_,je,{useGrid:0})}}const fb="",e1=t=>({}),Aa=t=>({}),t1=t=>({}),Ta=t=>({});function Na(t){let e,n,i,r,s,o,l,a,c,u,h,f=t[1]&&Pa(t);return a=new Vi({props:{tooltipText:t[2][t[1]][q]}}),{c(){f&&f.c(),e=F(),n=b("div"),i=b("button"),r=Gt("svg"),s=Gt("path"),l=F(),_e(a.$$.fragment),v(s,"fill","none"),v(s,"stroke","currentColor"),v(s,"stroke-linecap","round"),v(s,"stroke-linejoin","round"),v(s,"stroke-width","1.5"),v(s,"d","M12 3v18m0 0l8.5-8.5M12 21l-8.5-8.5"),v(r,"style",o=`transform: rotate(${t[1]?"180":"0"}deg)`),v(r,"xmlns","http://www.w3.org/2000/svg"),v(r,"width","24"),v(r,"height","24"),v(r,"viewBox","0 0 24 24"),v(r,"class","svelte-jbs1sd"),v(i,"class","button is-link svelte-jbs1sd"),v(n,"class","ctrl-toggle svelte-jbs1sd")},m(d,m){f&&f.m(d,m),z(d,e,m),z(d,n,m),y(n,i),y(i,r),y(r,s),y(i,l),me(a,i,null),c=!0,u||(h=be(i,"click",ln(t[3])),u=!0)},p(d,m){d[1]?f?(f.p(d,m),m&2&&V(f,1)):(f=Pa(d),f.c(),V(f,1),f.m(e.parentNode,e)):f&&(et(),W(f,1,1,()=>{f=null}),tt()),(!c||m&2&&o!==(o=`transform: rotate(${d[1]?"180":"0"}deg)`))&&v(r,"style",o);const p={};m&2&&(p.tooltipText=d[2][d[1]][q]),a.$set(p)},i(d){c||(V(f),V(a.$$.fragment,d),c=!0)},o(d){W(f),W(a.$$.fragment,d),c=!1},d(d){f&&f.d(d),d&&$(e),d&&$(n),pe(a),u=!1,h()}}}function Pa(t){let e,n,i;const r=t[5]["toolbar-hidden"],s=Bt(r,t,t[4],Aa);return{c(){e=b("div"),s&&s.c(),v(e,"class","ctrl-extra")},m(o,l){z(o,e,l),s&&s.m(e,null),i=!0},p(o,l){s&&s.p&&(!i||l&16)&&Kt(s,r,o,o[4],i?qt(r,o[4],l,e1):Wt(o[4]),Aa)},i(o){i||(V(s,o),Ht(()=>{i&&(n||(n=yn(e,Ks,{axis:"y"},!0)),n.run(1))}),i=!0)},o(o){W(s,o),n||(n=yn(e,Ks,{axis:"y"},!1)),n.run(0),i=!1},d(o){o&&$(e),s&&s.d(o),o&&n&&n.end()}}}function n1(t){let e,n,i,r,s,o,l,a;const c=t[5]["toolbar-visible"],u=Bt(c,t,t[4],Ta);let h=t[0]&&Na(t);return{c(){e=b("div"),n=b("form"),i=b("div"),r=b("div"),s=b("div"),u&&u.c(),o=F(),h&&h.c(),v(s,"class","ctrl-block svelte-jbs1sd"),v(r,"class","ctrl-block-wrapper svelte-jbs1sd"),v(i,"class","ctrl-base"),v(n,"class","ctrl svelte-jbs1sd"),v(e,"id","toolbar"),v(e,"class",l="ctrl-wrapper is-flex is-justify-content-center is-align-items-center "+(t[1]?"toolbar-expanded":"toolbar-collapsed")+" svelte-jbs1sd")},m(f,d){z(f,e,d),y(e,n),y(n,i),y(i,r),y(r,s),u&&u.m(s,null),y(n,o),h&&h.m(n,null),a=!0},p(f,[d]){u&&u.p&&(!a||d&16)&&Kt(u,c,f,f[4],a?qt(c,f[4],d,t1):Wt(f[4]),Ta),f[0]?h?(h.p(f,d),d&1&&V(h,1)):(h=Na(f),h.c(),V(h,1),h.m(n,null)):h&&(et(),W(h,1,1,()=>{h=null}),tt()),(!a||d&2&&l!==(l="ctrl-wrapper is-flex is-justify-content-center is-align-items-center "+(f[1]?"toolbar-expanded":"toolbar-collapsed")+" svelte-jbs1sd"))&&v(e,"class",l)},i(f){a||(V(u,f),V(h),a=!0)},o(f){W(u,f),W(h),a=!1},d(f){f&&$(e),u&&u.d(f),h&&h.d()}}}function i1(t,e,n){let i,{$$slots:r={},$$scope:s}=e,{expandable:o=!0}=e;const l={true:{en:"Collapse the toolbar",fr:"Refermer le menu"},false:{en:"Expand the toolbar",fr:"Ouvrir le menu"}},a=()=>n(1,i=!i);return t.$$set=c=>{"expandable"in c&&n(0,o=c.expandable),"$$scope"in c&&n(4,s=c.$$scope)},n(1,i=!1),[o,i,l,a,s,r]}class r1 extends Ve{constructor(e){super(),He(this,e,i1,n1,je,{expandable:0})}}function Oa(t){let e,n,i,r,s,o,l,a,c,u=t[5]>1&&La(t),h=t[5]<t[3]&&$a(t);return{c(){e=b("nav"),n=b("ul"),u&&u.c(),i=F(),r=b("li"),s=b("a"),o=re(t[5]),l=F(),h&&h.c(),v(s,"class","pagination-link is-current"),v(s,"href",null),v(n,"class","pagination-list ml-0"),v(e,"class","pagination is-centered mb-2"),v(e,"aria-label","pagination")},m(f,d){z(f,e,d),y(e,n),u&&u.m(n,null),y(n,i),y(n,r),y(r,s),y(s,o),y(n,l),h&&h.m(n,null),a||(c=be(s,"click",ln(t[9])),a=!0)},p(f,d){f[5]>1?u?u.p(f,d):(u=La(f),u.c(),u.m(n,i)):u&&(u.d(1),u=null),d&32&&Fe(o,f[5]),f[5]<f[3]?h?h.p(f,d):(h=$a(f),h.c(),h.m(n,null)):h&&(h.d(1),h=null)},d(f){f&&$(e),u&&u.d(),h&&h.d(),a=!1,c()}}}function La(t){let e,n,i,r,s,o,l=t[5]-1>1&&Da(t);return{c(){e=b("li"),n=b("a"),n.textContent="1",i=F(),l&&l.c(),r=Ct(),v(n,"class","pagination-link"),v(n,"href",null)},m(a,c){z(a,e,c),y(e,n),z(a,i,c),l&&l.m(a,c),z(a,r,c),s||(o=be(n,"click",ln(t[7])),s=!0)},p(a,c){a[5]-1>1?l?l.p(a,c):(l=Da(a),l.c(),l.m(r.parentNode,r)):l&&(l.d(1),l=null)},d(a){a&&$(e),a&&$(i),l&&l.d(a),a&&$(r),s=!1,o()}}}function Da(t){let e,n,i,r=t[5]-1+"",s,o,l,a=t[5]-1>2&&Ra();return{c(){a&&a.c(),e=F(),n=b("li"),i=b("a"),s=re(r),v(i,"class","pagination-link"),v(i,"href",null)},m(c,u){a&&a.m(c,u),z(c,e,u),z(c,n,u),y(n,i),y(i,s),o||(l=be(i,"click",ln(t[8])),o=!0)},p(c,u){c[5]-1>2?a||(a=Ra(),a.c(),a.m(e.parentNode,e)):a&&(a.d(1),a=null),u&32&&r!==(r=c[5]-1+"")&&Fe(s,r)},d(c){a&&a.d(c),c&&$(e),c&&$(n),o=!1,l()}}}function Ra(t){let e;return{c(){e=b("li"),e.innerHTML='<span class="pagination-ellipsis">…</span>'},m(n,i){z(n,e,i)},d(n){n&&$(e)}}}function $a(t){let e,n,i,r,s,o,l=t[5]+1<t[3]&&za(t);return{c(){l&&l.c(),e=F(),n=b("li"),i=b("a"),r=re(t[3]),v(i,"class","pagination-link"),v(i,"href",null)},m(a,c){l&&l.m(a,c),z(a,e,c),z(a,n,c),y(n,i),y(i,r),s||(o=be(i,"click",ln(t[11])),s=!0)},p(a,c){a[5]+1<a[3]?l?l.p(a,c):(l=za(a),l.c(),l.m(e.parentNode,e)):l&&(l.d(1),l=null),c&8&&Fe(r,a[3])},d(a){l&&l.d(a),a&&$(e),a&&$(n),s=!1,o()}}}function za(t){let e,n,i=t[5]+1+"",r,s,o,l,a,c=t[5]+2<t[3]&&ja();return{c(){e=b("li"),n=b("a"),r=re(i),s=F(),c&&c.c(),o=Ct(),v(n,"class","pagination-link"),v(n,"href",null)},m(u,h){z(u,e,h),y(e,n),y(n,r),z(u,s,h),c&&c.m(u,h),z(u,o,h),l||(a=be(n,"click",ln(t[10])),l=!0)},p(u,h){h&32&&i!==(i=u[5]+1+"")&&Fe(r,i),u[5]+2<u[3]?c||(c=ja(),c.c(),c.m(o.parentNode,o)):c&&(c.d(1),c=null)},d(u){u&&$(e),u&&$(s),c&&c.d(u),u&&$(o),l=!1,a()}}}function ja(t){let e;return{c(){e=b("li"),e.innerHTML='<span class="pagination-ellipsis">…</span>'},m(n,i){z(n,e,i)},d(n){n&&$(e)}}}function s1(t){let e,n,i=t[5]*t[2]-t[2]+1+"",r,s,o=Math.min(t[5]*t[2],t[1])+"",l,a,c,u,h=t[4]&&Oa(t);return{c(){h&&h.c(),e=F(),n=b("div"),r=re(i),s=re(" - "),l=re(o),a=re(" / "),c=re(t[1]),v(n,"class",u="is-size-7 is-center mb-4 "+(t[4]?"":"mt-4"))},m(f,d){h&&h.m(f,d),z(f,e,d),z(f,n,d),y(n,r),y(n,s),y(n,l),y(n,a),y(n,c)},p(f,[d]){f[4]?h?h.p(f,d):(h=Oa(f),h.c(),h.m(e.parentNode,e)):h&&(h.d(1),h=null),d&36&&i!==(i=f[5]*f[2]-f[2]+1+"")&&Fe(r,i),d&38&&o!==(o=Math.min(f[5]*f[2],f[1])+"")&&Fe(l,o),d&2&&Fe(c,f[1]),d&16&&u!==(u="is-size-7 is-center mb-4 "+(f[4]?"":"mt-4"))&&v(n,"class",u)},i:ie,o:ie,d(f){h&&h.d(f),f&&$(e),f&&$(n)}}}function o1(t,e,n){let i,r,s,{store:o}=e;const{currentPage:l}=o;Me(t,l,p=>n(5,s=p));let{nbOfItems:a}=e,{pageLength:c=gu}=e;const u=()=>o.handlePageUpdate(1),h=()=>o.handlePageUpdate(s-1),f=()=>o.handlePageUpdate(s),d=()=>o.handlePageUpdate(s+1),m=()=>o.handlePageUpdate(i);return t.$$set=p=>{"store"in p&&n(0,o=p.store),"nbOfItems"in p&&n(1,a=p.nbOfItems),"pageLength"in p&&n(2,c=p.pageLength)},t.$$.update=()=>{t.$$.dirty&6&&n(3,i=c>0?Math.ceil(a/c):1),t.$$.dirty&14&&n(4,r=i>1||a>c)},[o,a,c,i,r,s,l,u,h,f,d,m]}class Fa extends Ve{constructor(e){super(),He(this,e,o1,s1,je,{store:0,nbOfItems:1,pageLength:2})}}function l1(t){let e,n,i,r,s=q==="en"?"Save selection":"Sauvegarder la sélection",o,l,a;return{c(){e=b("button"),n=b("span"),i=b("i"),r=F(),o=re(s),v(i,"class","fa-solid fa-floppy-disk"),v(e,"class","button is-link")},m(c,u){z(c,e,u),y(e,n),y(n,i),y(n,r),y(n,o),l||(a=be(e,"click",t[7]),l=!0)},p:ie,d(c){c&&$(e),l=!1,a()}}}function a1(t){let e,n,i,r,s=q==="en"?"Go to treatment":"Accéder au traitement",o,l;return{c(){var a;e=b("a"),n=b("span"),i=b("i"),r=F(),o=re(s),v(i,"class","fa-solid fa-gear"),v(e,"class","button is-link"),v(e,"href",l="/"+Xt+"/treatment/add/?document_set="+((a=t[3])==null?void 0:a.id))},m(a,c){z(a,e,c),y(e,n),y(n,i),y(n,r),y(n,o)},p(a,c){var u;c&8&&l!==(l="/"+Xt+"/treatment/add/?document_set="+((u=a[3])==null?void 0:u.id))&&v(e,"href",l)},d(a){a&&$(e)}}}function Ha(t){let e,n,i,r,s,o,l;return{c(){var a,c;e=b("a"),n=b("span"),n.innerHTML='<i class="fa-solid fa-file-export"></i> JSON',r=F(),s=b("a"),o=b("span"),o.innerHTML='<i class="fa-solid fa-file-zipper"></i> ZIP',v(e,"class","button is-link is-dark"),v(e,"href",i="/"+Xt+"/document-set/"+((a=t[3])==null?void 0:a.id)+"/json"),v(e,"target","_blank"),v(s,"class","button is-link is-dark"),v(s,"href",l="/"+Xt+"/document-set/"+((c=t[3])==null?void 0:c.id)+"/zip"),v(s,"target","_blank")},m(a,c){z(a,e,c),y(e,n),z(a,r,c),z(a,s,c),y(s,o)},p(a,c){var u,h;c&8&&i!==(i="/"+Xt+"/document-set/"+((u=a[3])==null?void 0:u.id)+"/json")&&v(e,"href",i),c&8&&l!==(l="/"+Xt+"/document-set/"+((h=a[3])==null?void 0:h.id)+"/zip")&&v(s,"href",l)},d(a){a&&$(e),a&&$(r),a&&$(s)}}}function c1(t){let e,n,i,r,s,o,l;function a(f,d){return f[2]&&!f[1]?a1:l1}let c=a(t),u=c(t),h=!t[1]&&Ha(t);return{c(){e=b("footer"),n=b("div"),i=b("button"),i.textContent=`${q==="en"?"Clear selection":"Vider la sélection"}`,r=F(),u.c(),s=F(),h&&h.c(),v(i,"class","button button-close is-link is-light"),v(n,"class","buttons"),v(e,"class","modal-card-foot is-center")},m(f,d){z(f,e,d),y(e,n),y(n,i),y(n,r),u.m(n,null),y(n,s),h&&h.m(n,null),o||(l=be(i,"click",t[6]),o=!0)},p(f,[d]){c===(c=a(f))&&u?u.p(f,d):(u.d(1),u=c(f),u&&(u.c(),u.m(n,s))),f[1]?h&&(h.d(1),h=null):h?h.p(f,d):(h=Ha(f),h.c(),h.m(n,null))},i:ie,o:ie,d(f){f&&$(e),u.d(),h&&h.d(),o=!1,l()}}}function u1(t,e,n){let i,r,{selectionStore:s}=e;const{isSaved:o,selection:l}=s;Me(t,o,h=>n(2,i=h)),Me(t,l,h=>n(3,r=h));let{isRegion:a=s.type!=="documentSet"}=e;const c=()=>s.empty(),u=()=>s.save();return t.$$set=h=>{"selectionStore"in h&&n(0,s=h.selectionStore),"isRegion"in h&&n(1,a=h.isRegion)},[s,a,i,r,o,l,c,u]}class f1 extends Ve{constructor(e){super(),He(this,e,u1,c1,je,{selectionStore:0,isRegion:1})}}const db="";function d1(t){let e,n,i,r,s,o;return{c(){e=b("span"),n=re(t[5]),i=F(),r=b("span"),r.innerHTML='<i class="fas fa-edit"></i>',v(r,"class","pl-3 smaller has-text-link")},m(l,a){z(l,e,a),y(e,n),y(e,i),y(e,r),s||(o=[be(e,"click",t[7]),be(e,"keyup",null)],s=!0)},p(l,a){a&32&&Fe(n,l[5])},d(l){l&&$(e),s=!1,vt(o)}}}function h1(t){let e,n,i;return{c(){e=b("input"),v(e,"class","input selection-title svelte-sgypdx")},m(r,s){z(r,e,s),t[12](e),Mi(e,t[4]),n||(i=[be(e,"input",t[13]),be(e,"keydown",t[8]),be(e,"blur",t[9])],n=!0)},p(r,s){s&16&&e.value!==r[4]&&Mi(e,r[4])},d(r){r&&$(e),t[12](null),n=!1,vt(i)}}}function m1(t){let e,n,i,r,s,o,l,a,c,u,h,f,d,m,p,g,_,S,C,w;function k(O,L){return O[2]?h1:d1}let T=k(t),N=T(t);const E=t[11].default,M=Bt(E,t,t[10],null);return _=new f1({props:{selectionStore:t[0]}}),{c(){e=b("div"),n=b("div"),i=F(),r=b("div"),s=b("div"),o=b("div"),l=b("i"),a=F(),N.c(),c=re(`
                (`),u=re(t[1]),h=re(")"),f=F(),d=b("button"),m=F(),p=b("section"),M&&M.c(),g=F(),_e(_.$$.fragment),v(n,"class","modal-background"),v(l,"class","fa-solid fa-book-bookmark"),v(o,"class","title is-4 mb-0 media-content"),v(d,"class","delete media-left"),v(d,"aria-label","close"),v(s,"class","modal-card-head media mb-0 is-middle"),v(p,"class","modal-card-body"),v(r,"class","modal-content"),v(e,"id","selection-modal"),v(e,"class","modal fade"),v(e,"tabindex","-1"),v(e,"aria-labelledby","selection-modal-label"),v(e,"aria-hidden","true")},m(O,L){z(O,e,L),y(e,n),y(e,i),y(e,r),y(r,s),y(s,o),y(o,l),y(o,a),N.m(o,null),y(o,c),y(o,u),y(o,h),y(s,f),y(s,d),y(r,m),y(r,p),M&&M.m(p,null),y(r,g),me(_,r,null),S=!0,C||(w=ii(Dr.call(null,e)),C=!0)},p(O,[L]){T===(T=k(O))&&N?N.p(O,L):(N.d(1),N=T(O),N&&(N.c(),N.m(o,c))),(!S||L&2)&&Fe(u,O[1]),M&&M.p&&(!S||L&1024)&&Kt(M,E,O,O[10],S?qt(E,O[10],L,null):Wt(O[10]),null);const j={};L&1&&(j.selectionStore=O[0]),_.$set(j)},i(O){S||(V(M,O),V(_.$$.fragment,O),S=!0)},o(O){W(M,O),W(_.$$.fragment,O),S=!1},d(O){O&&$(e),N.d(),M&&M.d(O),pe(_),C=!1,w()}}}function p1(t,e,n){let i,{$$slots:r={},$$scope:s}=e,{selectionStore:o}=e;const{selectionTitle:l,updateTitle:a,save:c}=o;Me(t,l,C=>n(5,i=C));let{selectionLength:u=!1}=e,h=!1,f,d;function m(){n(2,h=!0),n(4,d=i),setTimeout(()=>f&&f.focus(),0)}function p(C){C.key==="Enter"&&g()}function g(){n(2,h=!1),a(d),c()}function _(C){vn[C?"unshift":"push"](()=>{f=C,n(3,f)})}function S(){d=this.value,n(4,d)}return t.$$set=C=>{"selectionStore"in C&&n(0,o=C.selectionStore),"selectionLength"in C&&n(1,u=C.selectionLength),"$$scope"in C&&n(10,s=C.$$scope)},[o,u,h,f,d,i,l,m,p,g,s,r,_,S]}class g1 extends Ve{constructor(e){super(),He(this,e,p1,m1,je,{selectionStore:0,selectionLength:1})}}const hb="";function _1(t){let e,n,i,r,s,o=q==="en"?"Selection":"Sélection",l,a,c,u,h,f;return{c(){e=b("div"),n=b("button"),i=b("span"),r=b("i"),s=F(),l=re(o),a=re(`
            (`),c=re(t[0]),u=re(")"),v(r,"class","fa-solid fa-book-bookmark"),v(i,"id","btn-content"),v(n,"id","set-btn"),v(n,"class","button px-5 py-4 is-link svelte-gmt9z5"),v(n,"data-target","selection-modal"),v(e,"class","set-container svelte-gmt9z5")},m(d,m){z(d,e,m),y(e,n),y(n,i),y(i,r),y(i,s),y(i,l),y(i,a),y(i,c),y(i,u),h||(f=ii(qs.call(null,n)),h=!0)},p(d,[m]){m&1&&Fe(c,d[0])},i:ie,o:ie,d(d){d&&$(e),h=!1,f()}}}function v1(t,e,n){let{selectionLength:i=0}=e,r=i;return t.$$set=s=>{"selectionLength"in s&&n(0,i=s.selectionLength)},t.$$.update=()=>{if(t.$$.dirty&3&&i!==r){const s=i>r;n(1,r=i);const o=document.getElementById("btn-content");o&&o.animate([{transform:s?"translateY(-7px)":"translateX(-5px)"},{transform:s?"translateY(7px)":"translateX(5px)"},{transform:"translate(0)"}],{duration:300,easing:"cubic-bezier(0.65, 0, 0.35, 1)"})}},[i,r]}class y1 extends Ve{constructor(e){super(),He(this,e,v1,_1,je,{selectionLength:0})}}const mb="";function Va(t,e,n){const i=t.slice();return i[7]=e[n][0],i[8]=e[n][1],i}function b1(t){let e;return{c(){e=b("div"),e.textContent=`${q==="en"?"No regions in selection":"Aucune région sélectionnée"}`},m(n,i){z(n,e,i)},p:ie,d(n){n&&$(e)}}}function w1(t){let e,n,i=Object.entries(t[2]),r=[];for(let s=0;s<i.length;s+=1)r[s]=Ua(Va(t,i,s));return{c(){e=b("div"),n=b("div");for(let s=0;s<r.length;s+=1)r[s].c();v(n,"class","grid is-gap-2"),v(e,"class","fixed-grid has-6-cols")},m(s,o){z(s,e,o),y(e,n);for(let l=0;l<r.length;l+=1)r[l]&&r[l].m(n,null)},p(s,o){if(o&13){i=Object.entries(s[2]);let l;for(l=0;l<i.length;l+=1){const a=Va(s,i,l);r[l]?r[l].p(a,o):(r[l]=Ua(a),r[l].c(),r[l].m(n,null))}for(;l<r.length;l+=1)r[l].d(1);r.length=i.length}},d(s){s&&$(e),St(r,s)}}}function Ua(t){let e,n,i,r,s,o,l,a=t[8].title+"",c,u,h,f,d,m;function p(){return t[6](t[7])}return{c(){e=b("div"),n=b("figure"),i=b("img"),s=F(),o=b("div"),l=b("span"),c=re(a),u=F(),h=b("button"),f=F(),At(i.src,r=Yt(t[8].img,t[8].xywh,"96,"))||v(i,"src",r),v(i,"alt","Extracted region"),v(l,"class","overlay-desc"),v(o,"class","overlay is-center svelte-g8ij5d"),v(n,"class","image is-64x64 card"),v(h,"class","delete region-btn svelte-g8ij5d"),v(h,"aria-label","remove from selection"),v(e,"class","selection cell svelte-g8ij5d")},m(g,_){z(g,e,_),y(e,n),y(n,i),y(n,s),y(n,o),y(o,l),y(l,c),y(e,u),y(e,h),y(e,f),d||(m=be(h,"click",p),d=!0)},p(g,_){t=g,_&4&&!At(i.src,r=Yt(t[8].img,t[8].xywh,"96,"))&&v(i,"src",r),_&4&&a!==(a=t[8].title+"")&&Fe(c,a)},d(g){g&&$(e),d=!1,m()}}}function S1(t){let e;function n(s,o){return s[4]?w1:b1}let i=n(t),r=i(t);return{c(){r.c(),e=Ct()},m(s,o){r.m(s,o),z(s,e,o)},p(s,o){i===(i=n(s))&&r?r.p(s,o):(r.d(1),r=i(s),r&&(r.c(),r.m(e.parentNode,e)))},d(s){r.d(s),s&&$(e)}}}function k1(t){let e,n,i,r;return e=new y1({props:{selectionLength:t[1]}}),i=new g1({props:{selectionLength:t[1],selectionStore:t[0],$$slots:{default:[S1]},$$scope:{ctx:t}}}),{c(){_e(e.$$.fragment),n=F(),_e(i.$$.fragment)},m(s,o){me(e,s,o),z(s,n,o),me(i,s,o),r=!0},p(s,[o]){const l={};o&2&&(l.selectionLength=s[1]),e.$set(l);const a={};o&2&&(a.selectionLength=s[1]),o&1&&(a.selectionStore=s[0]),o&2077&&(a.$$scope={dirty:o,ctx:s}),i.$set(a)},i(s){r||(V(e.$$.fragment,s),V(i.$$.fragment,s),r=!0)},o(s){W(e.$$.fragment,s),W(i.$$.fragment,s),r=!1},d(s){pe(e,s),s&&$(n),pe(i,s)}}}function E1(t,e,n){let i,r,s,o,{selectionStore:l}=e;const{selected:a}=l;Me(t,a,u=>n(3,o=u));const c=u=>l.remove(u,Object.keys(o)[0]);return t.$$set=u=>{"selectionStore"in u&&n(0,l=u.selectionStore)},t.$$.update=()=>{t.$$.dirty&8&&n(2,i=Object.values(o)[0]||{}),t.$$.dirty&4&&n(1,r=Object.keys(i).length),t.$$.dirty&2&&n(4,s=r>0)},[l,r,i,o,s,a,c]}class C1 extends Ve{constructor(e){super(),He(this,e,E1,k1,je,{selectionStore:0})}}const pb="";function Ba(t,e,n){const i=t.slice();return i[17]=e[n],i}function qa(t,e,n){const i=t.slice();return i[20]=e[n],i}function Ka(t,e,n){const i=t.slice();return i[23]=e[n],i}function I1(t){let e,n;return e=new r1({props:{expandable:!1,$$slots:{"toolbar-visible":[x1]},$$scope:{ctx:t}}}),{c(){_e(e.$$.fragment)},m(i,r){me(e,i,r),n=!0},p(i,r){const s={};r&67108864&&(s.$$scope={dirty:r,ctx:i}),e.$set(s)},i(i){n||(V(e.$$.fragment,i),n=!0)},o(i){W(e.$$.fragment,i),n=!1},d(i){pe(e,i)}}}function Wa(t){let e,n,i,r,s,o=t[23].title+"",l,a,c,u=t[23].shortcut+"",h,f,d,m;return{c(){e=b("p"),n=b("button"),i=b("span"),r=b("i"),s=F(),l=re(o),a=F(),c=b("span"),h=re(u),f=F(),v(r,"class","fas "+t[23].icon+" svelte-7vjt6f"),v(i,"class","icon is-small"),v(c,"class","shortcut svelte-7vjt6f"),v(n,"class","button pl-5"),v(n,"title",t[23].desc),v(e,"class","control")},m(p,g){z(p,e,g),y(e,n),y(n,i),y(i,r),y(n,s),y(n,l),y(n,a),y(n,c),y(c,h),y(e,f),d||(m=be(n,"click",ln(t[23].fct)),d=!0)},p(p,g){t=p},d(p){p&&$(e),d=!1,m()}}}function x1(t){let e,n,i,r,s,o,l,a=Object.values(t[10]),c=[];for(let u=0;u<a.length;u+=1)c[u]=Wa(Ka(t,a,u));return{c(){e=b("div"),n=b("div"),i=b("div"),r=b("span"),r.textContent=`${q==="en"?"Process selection":"Agir sur la sélection"}`,s=F(),o=b("div"),l=b("div");for(let u=0;u<c.length;u+=1)c[u].c();v(r,"class","tag is-medium is-link mr-5"),v(i,"class","column is-narrow mr-5"),v(l,"class","field has-addons"),v(o,"class","column"),v(n,"class","columns is-vcentered is-mobile py-4"),v(e,"slot","toolbar-visible")},m(u,h){z(u,e,h),y(e,n),y(n,i),y(i,r),y(n,s),y(n,o),y(o,l);for(let f=0;f<c.length;f+=1)c[f]&&c[f].m(l,null)},p(u,h){if(h&1024){a=Object.values(u[10]);let f;for(f=0;f<a.length;f+=1){const d=Ka(u,a,f);c[f]?c[f].p(d,h):(c[f]=Wa(d),c[f].c(),c[f].m(l,null))}for(;f<c.length;f+=1)c[f].d(1);c.length=a.length}},d(u){u&&$(e),St(c,u)}}}function M1(t){let e,n=t[9].title+"",i;return{c(){e=b("span"),i=re(n),v(e,"class","button is-small is-success"),v(e,"title",t[9].desc)},m(r,s){z(r,e,s),y(e,i)},p:ie,d(r){r&&$(e)}}}function A1(t){let e,n=t[8].title+"",i,r,s;function o(){return t[12](t[17])}return{c(){e=b("button"),i=re(n),v(e,"class","button is-small is-warning"),v(e,"title",t[8].desc)},m(l,a){z(l,e,a),y(e,i),r||(s=be(e,"click",o),r=!0)},p(l,a){t=l},d(l){l&&$(e),r=!1,s()}}}function T1(t){let e,n,i=t[17].size+"",r,s,o,l,a,c;function u(d,m){return d[17].fullyConnected?M1:A1}let h=u(t),f=h(t);return{c(){e=b("div"),n=b("span"),r=re(i),s=re(" images"),o=F(),l=b("hr"),a=F(),f.c(),c=F(),v(n,"class","cluster-size"),v(e,"class","cluster-info is-center is-fullwidth")},m(d,m){z(d,e,m),y(e,n),y(n,r),y(n,s),y(e,o),y(e,l),y(e,a),f.m(e,null),z(d,c,m)},p(d,m){m&4&&i!==(i=d[17].size+"")&&Fe(r,i),h===(h=u(d))&&f?f.p(d,m):(f.d(1),f=h(d),f&&(f.c(),f.m(e,null)))},d(d){d&&$(e),f.d(),d&&$(c)}}}function Ya(t){let e,n;return e=new ei({props:{item:{...t[3].get(t[20]),clusterId:t[17].id},copyable:!1,selectionStore:gr}}),{c(){_e(e.$$.fragment)},m(i,r){me(e,i,r),n=!0},p(i,r){const s={};r&12&&(s.item={...i[3].get(i[20]),clusterId:i[17].id}),e.$set(s)},i(i){n||(V(e.$$.fragment,i),n=!0)},o(i){W(e.$$.fragment,i),n=!1},d(i){pe(e,i)}}}function N1(t){let e,n,i=t[17].members,r=[];for(let o=0;o<i.length;o+=1)r[o]=Ya(qa(t,i,o));const s=o=>W(r[o],1,1,()=>{r[o]=null});return{c(){for(let o=0;o<r.length;o+=1)r[o].c();e=F()},m(o,l){for(let a=0;a<r.length;a+=1)r[a]&&r[a].m(o,l);z(o,e,l),n=!0},p(o,l){if(l&12){i=o[17].members;let a;for(a=0;a<i.length;a+=1){const c=qa(o,i,a);r[a]?(r[a].p(c,l),V(r[a],1)):(r[a]=Ya(c),r[a].c(),V(r[a],1),r[a].m(e.parentNode,e))}for(et(),a=i.length;a<r.length;a+=1)s(a);tt()}},i(o){if(!n){for(let l=0;l<i.length;l+=1)V(r[l]);n=!0}},o(o){r=r.filter(Boolean);for(let l=0;l<r.length;l+=1)W(r[l]);n=!1},d(o){St(r,o),o&&$(e)}}}function Ga(t,e){let n,i,r;return i=new Ma({props:{$$slots:{"row-body":[N1],"row-header":[T1]},$$scope:{ctx:e}}}),{key:t,first:null,c(){n=Ct(),_e(i.$$.fragment),this.first=n},m(s,o){z(s,n,o),me(i,s,o),r=!0},p(s,o){e=s;const l={};o&67108876&&(l.$$scope={dirty:o,ctx:e}),i.$set(l)},i(s){r||(V(i.$$.fragment,s),r=!0)},o(s){W(i.$$.fragment,s),r=!1},d(s){s&&$(n),pe(i,s)}}}function P1(t){let e=[],n=new Map,i,r,s=t[2];const o=l=>l[17].id;for(let l=0;l<s.length;l+=1){let a=Ba(t,s,l),c=o(a);n.set(c,e[l]=Ga(c,a))}return{c(){for(let l=0;l<e.length;l+=1)e[l].c();i=Ct()},m(l,a){for(let c=0;c<e.length;c+=1)e[c]&&e[c].m(l,a);z(l,i,a),r=!0},p(l,a){a&780&&(s=l[2],et(),e=Di(e,a,o,1,l,s,n,i.parentNode,Mr,Ga,i,Ba),tt())},i(l){if(!r){for(let a=0;a<s.length;a+=1)V(e[a]);r=!0}},o(l){for(let a=0;a<e.length;a+=1)W(e[a]);r=!1},d(l){for(let a=0;a<e.length;a+=1)e[a].d(l);l&&$(i)}}}function O1(t){let e,n,i,r,s,o,l,a,c,u=Tr&&I1(t);return n=new Fa({props:{store:t[0],nbOfItems:t[1],pageLength:t[7]}}),r=new C1({props:{selectionStore:gr}}),o=new K_({props:{$$slots:{default:[P1]},$$scope:{ctx:t}}}),a=new Fa({props:{store:t[0],nbOfItems:t[1],pageLength:t[7]}}),{c(){u&&u.c(),e=F(),_e(n.$$.fragment),i=F(),_e(r.$$.fragment),s=F(),_e(o.$$.fragment),l=F(),_e(a.$$.fragment)},m(h,f){u&&u.m(h,f),z(h,e,f),me(n,h,f),z(h,i,f),me(r,h,f),z(h,s,f),me(o,h,f),z(h,l,f),me(a,h,f),c=!0},p(h,[f]){Tr&&u.p(h,f);const d={};f&1&&(d.store=h[0]),f&2&&(d.nbOfItems=h[1]),n.$set(d);const m={};f&67108876&&(m.$$scope={dirty:f,ctx:h}),o.$set(m);const p={};f&1&&(p.store=h[0]),f&2&&(p.nbOfItems=h[1]),a.$set(p)},i(h){c||(V(u),V(n.$$.fragment,h),V(r.$$.fragment,h),V(o.$$.fragment,h),V(a.$$.fragment,h),c=!0)},o(h){W(u),W(n.$$.fragment,h),W(r.$$.fragment,h),W(o.$$.fragment,h),W(a.$$.fragment,h),c=!1},d(h){u&&u.d(h),h&&$(e),pe(n,h),h&&$(i),pe(r,h),h&&$(s),pe(o,h),h&&$(l),pe(a,h)}}}function L1(t,e,n){let i,r,s,{documentSetStore:o}=e;const{imageNodes:l}=o;Me(t,l,w=>n(3,s=w));let{clusterStore:a}=e;const{clusterNb:c,paginatedClusters:u,pageLength:h,validateCluster:f,newCluster:d,removeFromClusters:m}=a;Me(t,c,w=>n(1,i=w)),Me(t,u,w=>n(2,r=w));const p={create:{title:q==="en"?"New cluster":"Nouveau cluster",desc:q==="en"?"Create a new validated cluster from the selected regions":"Créer un nouveau cluster valide à partir des régions sélectionnées",icon:"fa-object-group",shortcut:"Shift + C",fct:d},remove:{title:q==="en"?"Remove from cluster":"Retirer du cluster",desc:q==="en"?"Remove the selected regions from their cluster":"Retirer les régions sélectionnées de leur cluster",icon:"fa-chain-broken",shortcut:"Shift + D",fct:m},validate:{title:q==="en"?"Validate cluster":"Valider le cluster",desc:q==="en"?"Set as exact match all the pairs of regions in the cluster":"Définir comme correspondance exacte toutes les paires de régions dans le cluster",icon:"fa-check",fct:f},validated:{title:q==="en"?"Validated cluster":"Cluster valide",desc:q==="en"?"All pairs of regions have be categorized as exact matches":"Toutes les paires de régions ont été catégorisées comme des correspondances exactes",icon:"fa-check"}},{validate:g,validated:_,...S}=p,C=w=>g.fct(w);return t.$$set=w=>{"documentSetStore"in w&&n(11,o=w.documentSetStore),"clusterStore"in w&&n(0,a=w.clusterStore)},[a,i,r,s,l,c,u,h,g,_,S,o,C]}class D1 extends Ve{constructor(e){super(),He(this,e,L1,O1,je,{documentSetStore:11,clusterStore:0})}}function R1(t,e){const i=Pe(1),{visiblePairs:r,imageNodes:s}=t;Pr(i,"p");function o(w){Or(w,i,"p")}function l(w){if(w.length===0)return[];const k=new Map,T=O=>k.has(O)?(k.get(O)!==O&&k.set(O,T(k.get(O))),k.get(O)):(k.set(O,O),O),N=(O,L)=>{const j=T(O),R=T(L);j!==R&&k.set(R,j)},E=new Set;w.forEach(O=>{N(O.id_1,O.id_2),E.add(O.id_1),E.add(O.id_2)});const M=new Map;return E.forEach(O=>{const L=T(O);M.has(L)||M.set(L,[]),M.get(L).push(O)}),Array.from(M.values()).map(O=>{const L=O.length,j=L*(L-1)/2,R=new Set(O),x=w.filter(H=>R.has(H.id_1)&&R.has(H.id_2)).length;return{id:crypto.randomUUID(),members:O,size:L,fullyConnected:x===j}}).filter(O=>O.size>1).sort((O,L)=>L.size-O.size)}const a=ut(r,w=>w.length?l(w):[]),c=Pe([]);a.subscribe(w=>{c.set(w)});const u=ut([c,i],([w,k])=>{const T=(k-1)*10,N=T+10;return w.slice(T,N)}),h=(w,k)=>{const T=yt(s).get(w),N=yt(s).get(k);return{img_1:w,img_2:k,regions_id_1:T==null?void 0:T.regionId,regions_id_2:N==null?void 0:N.regionId}},f=(w,k)=>(c.update(T=>T.map(N=>{if(!k[N.id])return N;const E=N.members.filter(M=>!w.has(M));return{...N,members:E,size:E.length}}).filter(N=>N.size>0)),!0),d=async w=>{const k=Array.isArray(w)?w:Object.keys(w),T=new Set(k),N={};yt(c).forEach(M=>{const O=M.members.filter(L=>T.has(L));O.length>0&&(N[M.id]=O)});const E=Object.entries(N).flatMap(([M,O])=>{const L=yt(c).find(R=>R.id===M);if(!L)return[];const j=L.members.filter(R=>!T.has(R));return O.flatMap(R=>j.map(x=>h(R,x)))});if(E.length===0)return f(T,N),!0;try{const M=await Vs(()=>fetch(`${window.location.origin}/${Xt}/uncategorize-pair-batch`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":bn},body:JSON.stringify({pairs:E})}));return M.ok?(f(T,N),!0):(console.log(M),await Tt(q==="en"?"Batch un-categorization failed":"La dé-catégorisation par lot a échoué",q==="en"?"Error":"Erreur"),!1)}catch(M){return await Tt(M,q==="en"?"Error":"Erreur"),!1}},m=async w=>{const k=w.flatMap((T,N)=>w.slice(N+1).map(E=>h(T,E)));try{const T=await Vs(()=>fetch(`${window.location.origin}/${Xt}/exact-match-batch`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":bn},body:JSON.stringify({pairs:k})}));return T.ok?!0:(console.log(T),await Tt(q==="en"?"Batch validation failed":"La validation par lot a échoué",q==="en"?"Error":"Erreur"),!1)}catch(T){return await Tt(T,q==="en"?"Error":"Erreur"),console.error("Error:",T),!1}},p=async w=>{if(!Tr)return await Tt(q==="en"?"You do not have permission to validate clusters":"Vous n'avez pas la permission, de valider les clusters.",q==="en"?"Permission Denied":"Permission refusée"),!1;const k=await m(w.members);return k&&c.update(T=>T.map(N=>N.id===w.id?{...N,fullyConnected:!0}:N)),k},g=async w=>{if(w.length<2)return!1;const k=await m(w);return k&&c.update(T=>[{id:crypto.randomUUID(),members:w,size:w.length,fullyConnected:!0},...T].sort((E,M)=>M.size-E.size)),k},_=()=>Object.values(yt(e).selected)[0]||{},S=async()=>{if(!await Tt(q==="en"?"Do you want to create a cluster out of these images?":"Voulez-vous créer un cluster à partir de ces images ?",q==="en"?"Confirm creation":"Confirmer la création",!0))return;const k=_(),T=Object.keys(k);return T.length<2?(await Tt(q==="en"?"Cluster creation requires at least 2 images":"La création d'un nouveau cluster nécessite a minima 2 images",q==="en"?"Impossible creation":"Création impossible"),!1):!await d(T)||!await g(T)?!1:(e.empty(),!0)},C=async()=>{if(!await Tt(q==="en"?"Do you want to remove these images from their clusters?":"Voulez-vous supprimer ces images de leurs clusters ?",q==="en"?"Confirm deletion":"Confirmer la suppression",!0))return;const k=_();return await d(Object.keys(k))?(e.empty(),!0):!1};return{imageClusters:a,interfaceClusters:c,clusterNb:ut(c,w=>w.length),validateCluster:p,removeFromClusters:C,newCluster:S,paginatedClusters:u,handlePageUpdate:o,pageLength:10,currentPage:i}}function Xa(t,e,n){const i=t.slice();return i[25]=e[n],i}function $1(t){let e;return{c(){e=b("p"),e.textContent=`${q==="en"?"Groups of images that share a similarity connection above the score threshold.":"Groupes d'images partageant une connexion de similarité au-dessus du seuil de score."}`},m(n,i){z(n,e,i)},p:ie,d(n){n&&$(e)}}}function z1(t){let e;return{c(){e=b("p"),e.textContent=`${q==="en"?"Matrix showing aggregated similarity scores between documents. Click a cell to explore page-level similarities in a scatter plot interface.":"Matrice affichant les scores de similarité agrégés entre documents. Cliquez sur une cellule pour explorer les similarités entre paires de documents."}`},m(n,i){z(n,e,i)},p:ie,d(n){n&&$(e)}}}function j1(t){let e;return{c(){e=b("p"),e.textContent=`${q==="en"?"Network where each node is a document. Edge thickness reflects the cumulative similarity score between document pairs. Node size indicates the number of connections.":"Réseau où chaque nœud est un document. L'épaisseur des liens reflète le score de similarité cumulé entre paires de documents. La taille des nœuds indique le nombre de connexions."}`},m(n,i){z(n,e,i)},p:ie,d(n){n&&$(e)}}}function F1(t){let e;return{c(){e=b("p"),e.textContent=`${q==="en"?"Network where each node is an image region. Edges connect regions with similarity scores above the threshold. Node color indicates the source document.":"Réseau où chaque nœud est une région d'image. Les liens connectent les régions dont le score de similarité dépasse le seuil. La couleur indique le document source."}`},m(n,i){z(n,e,i)},p:ie,d(n){n&&$(e)}}}function H1(t){let e;function n(s,o){if(s[23]==="img")return F1;if(s[23]==="doc")return j1;if(s[23]==="matrix")return z1;if(s[23]==="clusters")return $1}let i=n(t),r=i&&i(t);return{c(){e=b("div"),r&&r.c(),v(e,"slot","datavizInfo")},m(s,o){z(s,e,o),r&&r.m(e,null)},p(s,o){i===(i=n(s))&&r?r.p(s,o):(r&&r.d(1),r=i&&i(s),r&&(r.c(),r.m(e,null)))},d(s){s&&$(e),r&&r.d()}}}function V1(t){let e,n,i;return n=new Gf({props:{docSet:t[0],documentSetStore:t[4],clusterStore:t[8],$$slots:{datavizInfo:[H1]},$$scope:{ctx:t}}}),{c(){e=b("div"),_e(n.$$.fragment),v(e,"slot","sidebar")},m(r,s){z(r,e,s),me(n,e,null),i=!0},p(r,s){const o={};s&1&&(o.docSet=r[0]),s&276824064&&(o.$$scope={dirty:s,ctx:r}),n.$set(o)},i(r){i||(V(n.$$.fragment,r),i=!0)},o(r){W(n.$$.fragment,r),i=!1},d(r){r&&$(e),pe(n)}}}function Ja(t){let e,n,i,r,s,o,l,a=t[25].title+"",c,u;return{c(){e=b("div"),n=b("figure"),i=b("img"),s=F(),o=b("div"),l=b("span"),c=re(a),u=F(),At(i.src,r=Yt(t[25].img,t[25].xywh,"96,"))||v(i,"src",r),v(i,"alt","Extracted region"),v(l,"class","overlay-desc"),v(o,"class","overlay is-center"),v(n,"class","image is-64x64 card"),v(e,"class","selection cell")},m(h,f){z(h,e,f),y(e,n),y(n,i),y(n,s),y(n,o),y(o,l),y(l,c),y(e,u)},p(h,f){f&2&&!At(i.src,r=Yt(h[25].img,h[25].xywh,"96,"))&&v(i,"src",r),f&2&&a!==(a=h[25].title+"")&&Fe(c,a)},d(h){h&&$(e)}}}function U1(t){let e,n,i=Object.values(Object.values(t[1])[0]||{}),r=[];for(let s=0;s<i.length;s+=1)r[s]=Ja(Xa(t,i,s));return{c(){e=b("div"),n=b("div");for(let s=0;s<r.length;s+=1)r[s].c();v(n,"class","grid is-gap-2"),v(e,"slot","content"),v(e,"class","fixed-grid has-6-cols")},m(s,o){z(s,e,o),y(e,n);for(let l=0;l<r.length;l+=1)r[l]&&r[l].m(n,null)},p(s,o){if(o&2){i=Object.values(Object.values(s[1])[0]||{});let l;for(l=0;l<i.length;l+=1){const a=Xa(s,i,l);r[l]?r[l].p(a,o):(r[l]=Ja(a),r[l].c(),r[l].m(n,null))}for(;l<r.length;l+=1)r[l].d(1);r.length=i.length}},d(s){s&&$(e),St(r,s)}}}function B1(t){let e,n,i,r={ctx:t,current:null,token:null,hasCatch:!1,pending:Z1,then:W1,catch:K1,value:24,blocks:[,,,]};return xr(n=t[3],r),{c(){e=Ct(),r.block.c()},m(s,o){z(s,e,o),r.block.m(s,r.anchor=o),r.mount=()=>e.parentNode,r.anchor=e,i=!0},p(s,o){t=s,r.ctx=t,o&8&&n!==(n=t[3])&&xr(n,r)||Fs(r,t,o)},i(s){i||(V(r.block),i=!0)},o(s){for(let o=0;o<3;o+=1){const l=r.blocks[o];W(l)}i=!1},d(s){s&&$(e),r.block.d(s),r.token=null,r=null}}}function q1(t){let e,n,i;return{c(){e=b("article"),n=b("div"),i=re(t[2]),v(n,"class","message-body"),v(e,"class","message is-danger")},m(r,s){z(r,e,s),y(e,n),y(n,i)},p(r,s){s&4&&Fe(i,r[2])},i:ie,o:ie,d(r){r&&$(e)}}}function K1(t){return{c:ie,m:ie,p:ie,i:ie,o:ie,d:ie}}function W1(t){let e,n,i,r;const s=[G1,Y1],o=[];function l(a,c){return a[24]===0?0:1}return e=l(t),n=o[e]=s[e](t),{c(){n.c(),i=Ct()},m(a,c){o[e].m(a,c),z(a,i,c),r=!0},p(a,c){let u=e;e=l(a),e===u?o[e].p(a,c):(et(),W(o[u],1,1,()=>{o[u]=null}),tt(),n=o[e],n?n.p(a,c):(n=o[e]=s[e](a),n.c()),V(n,1),n.m(i.parentNode,i))},i(a){r||(V(n),r=!0)},o(a){W(n),r=!1},d(a){o[e].d(a),a&&$(i)}}}function Y1(t){let e,n,i=t[9][t[23]]+"",r,s,o,l,a;const c=[Q1,J1,X1],u=[];function h(f,d){return f[23]==="img"||f[23]==="doc"?0:f[23]==="sim"?1:f[23]==="mat"?2:-1}return~(o=h(t))&&(l=u[o]=c[o](t)),{c(){e=b("div"),n=b("h2"),r=re(i),s=F(),l&&l.c(),v(n,"class","title is-3 has-text-link")},m(f,d){z(f,e,d),y(e,n),y(n,r),y(e,s),~o&&u[o].m(e,null),a=!0},p(f,d){(!a||d&8388608)&&i!==(i=f[9][f[23]]+"")&&Fe(r,i);let m=o;o=h(f),o===m?~o&&u[o].p(f,d):(l&&(et(),W(u[m],1,1,()=>{u[m]=null}),tt()),~o?(l=u[o],l?l.p(f,d):(l=u[o]=c[o](f),l.c()),V(l,1),l.m(e,null)):l=null)},i(f){a||(V(l),a=!0)},o(f){W(l),a=!1},d(f){f&&$(e),~o&&u[o].d()}}}function G1(t){let e;return{c(){e=b("article"),e.innerHTML=`<div class="message-body">No document pairs found for this configuration.
                            Please adjust your selection criteria in the sidebar to include more documents or
                            categories.</div>`,v(e,"class","message is-warning")},m(n,i){z(n,e,i)},p:ie,i:ie,o:ie,d(n){n&&$(e)}}}function X1(t){let e,n;return e=new j_({props:{documentSetStore:t[4]}}),{c(){_e(e.$$.fragment)},m(i,r){me(e,i,r),n=!0},p:ie,i(i){n||(V(e.$$.fragment,i),n=!0)},o(i){W(e.$$.fragment,i),n=!1},d(i){pe(e,i)}}}function J1(t){let e,n;return e=new D1({props:{documentSetStore:t[4],clusterStore:t[8]}}),{c(){_e(e.$$.fragment)},m(i,r){me(e,i,r),n=!0},p:ie,i(i){n||(V(e.$$.fragment,i),n=!0)},o(i){W(e.$$.fragment,i),n=!1},d(i){pe(e,i)}}}function Q1(t){let e,n;return e=new E_({props:{documentSetStore:t[4],type:t[23]}}),{c(){_e(e.$$.fragment)},m(i,r){me(e,i,r),n=!0},p(i,r){const s={};r&8388608&&(s.type=i[23]),e.$set(s)},i(i){n||(V(e.$$.fragment,i),n=!0)},o(i){W(e.$$.fragment,i),n=!1},d(i){pe(e,i)}}}function Z1(t){let e;return{c(){e=b("progress"),e.textContent="Loading...",v(e,"class","progress is-link"),v(e,"max","100")},m(n,i){z(n,e,i)},p:ie,i:ie,o:ie,d(n){n&&$(e)}}}function e0(t){let e,n,i,r,s,o;n=new Lu({props:{$$slots:{content:[U1]},$$scope:{ctx:t}}});const l=[q1,B1],a=[];function c(u,h){return u[2]?0:1}return r=c(t),s=a[r]=l[r](t),{c(){e=b("div"),_e(n.$$.fragment),i=F(),s.c(),v(e,"slot","content")},m(u,h){z(u,e,h),me(n,e,null),y(e,i),a[r].m(e,null),o=!0},p(u,h){const f={};h&268435458&&(f.$$scope={dirty:h,ctx:u}),n.$set(f);let d=r;r=c(u),r===d?a[r].p(u,h):(et(),W(a[d],1,1,()=>{a[d]=null}),tt(),s=a[r],s?s.p(u,h):(s=a[r]=l[r](u),s.c()),V(s,1),s.m(e,null))},i(u){o||(V(n.$$.fragment,u),V(s),o=!0)},o(u){W(n.$$.fragment,u),W(s),o=!1},d(u){u&&$(e),pe(n),a[r].d()}}}function t0(t){let e,n;return e=new Uu({props:{tabList:t[9],$$slots:{content:[e0,({activeTab:i})=>({23:i}),({activeTab:i})=>i?8388608:0],sidebar:[V1,({activeTab:i})=>({23:i}),({activeTab:i})=>i?8388608:0]},$$scope:{ctx:t}}}),{c(){_e(e.$$.fragment)},m(i,r){me(e,i,r),n=!0},p(i,[r]){const s={};r&276824079&&(s.$$scope={dirty:r,ctx:i}),e.$set(s)},i(i){n||(V(e.$$.fragment,i),n=!0)},o(i){W(e.$$.fragment,i),n=!1},d(i){pe(e,i)}}}function n0(t,e,n){var O;let i,r,s,{docSet:o}=e;const l=U_(o.id),{error:a,fetchPairs:c,selectedRegions:u,selectedCategories:h,threshold:f,topK:d,mutualTopK:m,scoreMode:p}=l;Me(t,a,L=>n(2,r=L)),Me(t,c,L=>n(3,s=L));let g,_,S,C,w,k;zn(()=>{g=qn(u,"regions","set"),_=qn(h,"categories","array",[1]),S=qn(f,"threshold","number"),C=qn(d,"topk","number"),w=qn(m,"mutual","boolean"),k=qn(p,"mode","string");const L=u.subscribe(g),j=h.subscribe(_),R=f.subscribe(S),x=d.subscribe(C),H=m.subscribe(w),P=p.subscribe(k);return()=>{L(),j(),R(),x(),H(),P()}});const{selected:T}=gr;Me(t,T,L=>n(1,i=L));const N=R1(l,gr),E={sim:q==="en"?"Copy Clusters":"Groupe de copies",mat:q==="en"?"Document Matrix":"Matrice de documents",img:q==="en"?"Image Network":"Réseau d'images",doc:q==="en"?"Document Network":"Réseau de documents"},M=((O=o==null?void 0:o.selection)==null?void 0:O.selected)||{Witness:{},Series:{},Work:{}};return Fn("selectedDocuments",M),t.$$set=L=>{"docSet"in L&&n(0,o=L.docSet)},[o,i,r,s,l,a,c,T,N,E]}class i0 extends Ve{constructor(e){super(),He(this,e,n0,t0,je,{docSet:0})}}new i0({target:document.getElementById("document-set"),props:{docSet}});const gb="";function r0(t){let e,n,i;return n=new ei({props:{item:t[0],height:"full"}}),{c(){e=b("div"),_e(n.$$.fragment),v(e,"class","img-wrapper svelte-1duc3w1")},m(r,s){z(r,e,s),me(n,e,null),i=!0},p(r,[s]){const o={};s&1&&(o.item=r[0]),n.$set(o)},i(r){i||(V(n.$$.fragment,r),i=!0)},o(r){W(n.$$.fragment,r),i=!1},d(r){r&&$(e),pe(n)}}}function s0(t,e,n){let{mainImgItem:i}=e;return t.$$set=r=>{"mainImgItem"in r&&n(0,i=r.mainImgItem)},[i]}class Qa extends Ve{constructor(e){super(),He(this,e,s0,r0,je,{mainImgItem:0})}}const _b="";function o0(t){return{c:ie,m:ie,p:ie,d:ie}}function l0(t){let e,n=`${t[5][0]}%`,i=`${t[5][1]}%`,r=`${t[5][2]}%`,s=`${t[5][3]}%`;return{c(){e=b("div"),v(e,"class","modal-context-bbox svelte-zgr10j"),v(e,"aria-description",q==="fr"?"Position de la région extraite sur la page":"Position of the extracted region on the page"),We(e,"left",n),We(e,"top",i),We(e,"width",r),We(e,"height",s)},m(o,l){z(o,e,l)},p:ie,d(o){o&&$(e)}}}function a0(t){return{c:ie,m:ie,p:ie,d:ie}}function c0(t){let e,n,i,r,s,o={ctx:t,current:null,token:null,hasCatch:!1,pending:a0,then:l0,catch:o0,value:5};return xr(t[1],o),{c(){e=b("div"),n=b("div"),i=b("img"),s=F(),o.block.c(),v(i,"class","card modal-context-full-page svelte-zgr10j"),At(i.src,r=t[0])||v(i,"src",r),v(i,"alt",q==="fr"?"Vue de la page d'où la région est extraite":"View of the page the region is extracted from"),v(n,"class","modal-context-wrapper svelte-zgr10j"),v(e,"class","modal-context-outer pb-4 svelte-zgr10j")},m(l,a){z(l,e,a),y(e,n),y(n,i),y(n,s),o.block.m(n,o.anchor=null),o.mount=()=>n,o.anchor=null},p(l,[a]){t=l,Fs(o,t,a)},i:ie,o:ie,d(l){l&&$(e),o.block.d(),o.token=null,o=null}}}function u0(t,e,n){let{mainImgItem:i}=e;const r=Yt(i.img,"full","full"),s=Eu(i.img),o=i.xywh.map(Number),l=fetch(s).then(a=>a.json()).then(a=>[o[0]/a.width,o[1]/a.height,o[2]/a.width,o[3]/a.height].map(c=>c*100));return t.$$set=a=>{"mainImgItem"in a&&n(2,i=a.mainImgItem)},[r,l,i]}class f0 extends Ve{constructor(e){super(),He(this,e,u0,c0,je,{mainImgItem:2})}}const vb="";function Za(t,e,n){const i=t.slice();return i[13]=e[n].id,i[14]=e[n].label,i}function ec(t){let e,n,i=t[14]+"",r,s,o,l,a;function c(){return t[9](t[13])}return{c(){e=b("li"),n=b("a"),r=re(i),s=F(),v(n,"href",""),v(e,"class",o=t[13]===t[2]?"is-active":"")},m(u,h){z(u,e,h),y(e,n),y(n,r),y(e,s),l||(a=be(n,"click",ln(c)),l=!0)},p(u,h){t=u,h&4&&o!==(o=t[13]===t[2]?"is-active":"")&&v(e,"class",o)},d(u){u&&$(e),l=!1,a()}}}function d0(t){let e,n,i,r,s,o,l,a,c,u,h,f,d,m,p,g=t[3],_=[];for(let k=0;k<g.length;k+=1)_[k]=ec(Za(t,g,k));const S=[t[1][t[2]]||{}];var C=t[0][t[2]]||null;function w(k){let T={};for(let N=0;N<S.length;N+=1)T=Ts(T,S[N]);return{props:T}}return C&&(u=Ti(C,w())),{c(){e=b("div"),n=b("div"),i=F(),r=b("div"),s=b("div"),o=b("div"),l=b("ul");for(let k=0;k<_.length;k+=1)_[k].c();a=F(),c=b("div"),u&&_e(u.$$.fragment),h=F(),f=b("button"),v(n,"class","modal-background"),v(o,"class","tabs is-centered"),We(o,"height","fit-content"),v(c,"class","ml-4 mr-4 modal-main-wrapper svelte-1uakzh2"),Ye(c,"pb-4",t[2]==="main"),v(s,"class","modal-inner svelte-1uakzh2"),v(r,"class","modal-content svelte-1uakzh2"),v(f,"class","modal-close is-large"),v(f,"aria-label","close"),v(e,"id","region-modal-wrapper"),v(e,"class","modal is-active")},m(k,T){z(k,e,T),y(e,n),y(e,i),y(e,r),y(r,s),y(s,o),y(o,l);for(let N=0;N<_.length;N+=1)_[N]&&_[N].m(l,null);y(s,a),y(s,c),u&&me(u,c,null),y(e,h),y(e,f),d=!0,m||(p=[be(n,"click",t[6]),be(n,"keyup",t[5]),be(f,"click",t[6])],m=!0)},p(k,[T]){if(T&28){g=k[3];let E;for(E=0;E<g.length;E+=1){const M=Za(k,g,E);_[E]?_[E].p(M,T):(_[E]=ec(M),_[E].c(),_[E].m(l,null))}for(;E<_.length;E+=1)_[E].d(1);_.length=g.length}const N=T&6?uu(S,[fu(k[1][k[2]]||{})]):{};if(T&5&&C!==(C=k[0][k[2]]||null)){if(u){et();const E=u;W(E.$$.fragment,1,0,()=>{pe(E,1)}),tt()}C?(u=Ti(C,w()),_e(u.$$.fragment),V(u.$$.fragment,1),me(u,c,null)):u=null}else C&&u.$set(N);(!d||T&4)&&Ye(c,"pb-4",k[2]==="main")},i(k){d||(u&&V(u.$$.fragment,k),d=!0)},o(k){u&&W(u.$$.fragment,k),d=!1},d(k){k&&$(e),St(_,k),u&&pe(u),m=!1,vt(p)}}}function h0(t,e,n){let i,{mainImgItem:r}=e,{compareImgItem:s}=e;const o=Oi(),l=s?["main","page","similarity","expansion"]:["main","page"],a={expansion:{fr:"Expansion de requête",en:"Query expansion"},similarity:{fr:"Comparaison",en:"Comparison"},page:{fr:"Vue de la page",en:"Page view"},main:{fr:"Vue principale",en:"Main view"}},c=l.map(g=>{var _;return{id:g,label:((_=a[g])==null?void 0:_[q])??"Main view"}}),u={main:Qa,page:f0};s&&Promise.all([ms(()=>Promise.resolve().then(()=>hy),void 0).then(g=>g.default),ms(()=>Promise.resolve().then(()=>Fy),void 0).then(g=>g.default)]).then(([g,_])=>{const S=Object.keys(u);l.filter(C=>!S.includes(C)).map(C=>n(0,u[C]=C==="expansion"?_:C==="similarity"?g:Qa,u))});const h={};l.map(g=>n(1,h[g]=g==="similarity"?{compareImgItem:s,mainImgItem:r}:{mainImgItem:r},h));const f=g=>n(2,i=g),d=g=>{g.key==="Escape"&&o("closeModal")},m=()=>o("closeModal");zn(()=>{document.addEventListener("keyup",d)}),jn(()=>{document.removeEventListener("keydown",d)});const p=g=>f(g);return t.$$set=g=>{"mainImgItem"in g&&n(7,r=g.mainImgItem),"compareImgItem"in g&&n(8,s=g.compareImgItem)},n(2,i=l[0]),[u,h,i,c,f,d,m,r,s,p]}class m0 extends Ve{constructor(e){super(),He(this,e,h0,d0,je,{mainImgItem:7,compareImgItem:8})}}const yb="";function p0(t){let e,n,i,r,s,o,l,a,c,u,h;return n=new Vi({props:{targetHtmlId:t[0],tooltipText:t[1]}}),{c(){e=b("div"),_e(n.$$.fragment),i=F(),r=b("button"),s=Gt("svg"),o=Gt("path"),l=Gt("path"),a=Gt("path"),v(o,"d","M53.6443 14.25C47.7042 5.33 37.7293 0 26.9801 0C16.2206 0 6.24576 5.33 0.305653 14.25L0 14.71L0.305653 15.17C6.24576 24.09 16.2206 29.42 26.9801 29.42C37.7293 29.42 47.7042 24.09 53.6443 15.16L53.95 14.71L53.6443 14.25ZM3.25025 14.71C7.63146 8.69001 14.0606 4.65 21.2641 3.22C20.0619 3.83 18.9411 4.62 17.963 5.59C15.5176 8.02 14.1625 11.25 14.1625 14.67C14.1625 18.11 15.5176 21.34 17.963 23.76C19.0124 24.79 20.1943 25.61 21.4781 26.23C14.1829 24.85 7.6824 20.78 3.25025 14.71ZM27.1125 22.64C22.7008 22.64 19.1041 19.08 19.1041 14.7C19.1041 12.59 19.9396 10.6 21.4475 9.10001C22.9555 7.60001 24.9729 6.77 27.1125 6.77C29.2522 6.77 31.2594 7.60001 32.7775 9.10001C34.2855 10.6 35.121 12.59 35.121 14.7C35.121 16.82 34.2855 18.82 32.7775 20.32C31.2594 21.81 29.242 22.64 27.1125 22.64ZM32.9915 26.14C34.204 25.53 35.3146 24.74 36.3029 23.77C38.7482 21.34 40.0932 18.11 40.0932 14.68C40.0932 9.75 37.281 5.47001 33.1647 3.32001C40.1747 4.81001 46.4102 8.83001 50.6896 14.71C46.3797 20.64 40.0728 24.67 32.9915 26.14Z"),v(o,"fill","black"),v(o,"class","svelte-19wutme"),v(l,"d","M26.9804 25.98C33.3222 25.98 38.4633 20.9343 38.4633 14.71C38.4633 8.48576 33.3222 3.44 26.9804 3.44C20.6386 3.44 15.4976 8.48576 15.4976 14.71C15.4976 20.9343 20.6386 25.98 26.9804 25.98Z"),v(l,"fill","black"),v(l,"class","svelte-19wutme"),v(a,"d","M17.9529 23.85L36.2928 5.85001"),v(a,"stroke","black"),v(a,"stroke-width","3"),v(a,"stroke-miterlimit","10"),v(a,"class","svelte-19wutme"),v(s,"width","54"),v(s,"height","30"),v(s,"viewBox","0 0 54 30"),v(s,"fill","none"),v(s,"xmlns","http://www.w3.org/2000/svg"),v(s,"class","svelte-19wutme"),v(r,"class","button tag svelte-19wutme"),v(r,"title",t[1]),v(e,"id",t[0])},m(f,d){z(f,e,d),me(n,e,null),y(e,i),y(e,r),y(r,s),y(s,o),y(s,l),y(s,a),c=!0,u||(h=be(r,"click",t[2]),u=!0)},p:ie,i(f){c||(V(n.$$.fragment,f),c=!0)},o(f){W(n.$$.fragment,f),c=!1},d(f){f&&$(e),pe(n),u=!1,h()}}}function g0(t,e,n){let i,r,{mainImgItem:s}=e,{compareImgItem:o=void 0}=e;Fn("isInModal",!0);const l=`modal-opener-${window.crypto.randomUUID()}`,a=q==="fr"?"Vue détaillée":"Detailed view",c=(f,d)=>(f?(d=new m0({target:document.querySelector("body"),props:{mainImgItem:s,compareImgItem:o}}),d.$on("closeModal",h)):!f&&r!=null&&d.$destroy(),d),u=()=>n(5,i=!i),h=()=>n(5,i=!1);return t.$$set=f=>{"mainImgItem"in f&&n(3,s=f.mainImgItem),"compareImgItem"in f&&n(4,o=f.compareImgItem)},t.$$.update=()=>{t.$$.dirty&96&&n(6,r=c(i,r))},n(5,i=!1),[l,a,u,s,o,i,r]}class _0 extends Ve{constructor(e){super(),He(this,e,g0,p0,je,{mainImgItem:3,compareImgItem:4})}}const v0=Object.freeze(Object.defineProperty({__proto__:null,default:_0},Symbol.toStringTag,{value:"Module"})),bb="";function y0(t){let e,n,i,r,s,o,l;return{c(){e=b("button"),n=b("span"),n.innerHTML='<span class="switch-control svelte-g5g8im"><span class="switch-spot"></span></span>',i=F(),r=b("span"),s=re(t[0]),v(n,"class","switch mr-2 svelte-g5g8im"),v(r,"class","label svelte-g5g8im"),v(e,"id",t[3]),v(e,"name",t[3]),v(e,"class","input-checkbox-wrapper is-flex is-align-items-center-is-justify-content-center p-2 pl-3 pr-3 svelte-g5g8im"),v(e,"aria-label",t[0]),Ye(e,"is-checked",t[2]),Ye(e,"is-clickable",t[1]),Ye(e,"button",t[1])},m(a,c){z(a,e,c),y(e,n),y(e,i),y(e,r),y(r,s),o||(l=be(e,"click",ln(t[4])),o=!0)},p(a,[c]){c&1&&Fe(s,a[0]),c&1&&v(e,"aria-label",a[0]),c&4&&Ye(e,"is-checked",a[2]),c&2&&Ye(e,"is-clickable",a[1]),c&2&&Ye(e,"button",a[1])},i:ie,o:ie,d(a){a&&$(e),o=!1,l()}}}function b0(t,e,n){let i,{toggleLabel:r}=e,{start:s=!1}=e,{buttonDisplay:o=!1}=e;const l=`input-toggle-${window.crypto.randomUUID()}`,a=Oi(),c=Ft("resetTrigger")||void 0;c==null||c.subscribe(h);const u=()=>n(2,i=!i);function h(){n(2,i=s)}return t.$$set=f=>{"toggleLabel"in f&&n(0,r=f.toggleLabel),"start"in f&&n(5,s=f.start),"buttonDisplay"in f&&n(1,o=f.buttonDisplay)},t.$$.update=()=>{t.$$.dirty&32&&n(2,i=s),t.$$.dirty&4&&a("updateChecked",i)},[r,o,i,l,u,s]}class w0 extends Ve{constructor(e){super(),He(this,e,b0,y0,je,{toggleLabel:0,start:5,buttonDisplay:1})}}/*! choices.js v11.1.0 | © 2025 Josh Johnson | https://github.com/jshjohnson/Choices#readme */var _s=function(t,e){return _s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(n[r]=i[r])},_s(t,e)};function tc(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");_s(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}var Rt=function(){return Rt=Object.assign||function(e){for(var n,i=1,r=arguments.length;i<r;i++){n=arguments[i];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},Rt.apply(this,arguments)};function S0(t,e,n){if(n||arguments.length===2)for(var i=0,r=e.length,s;i<r;i++)(s||!(i in e))&&(s||(s=Array.prototype.slice.call(e,0,i)),s[i]=e[i]);return t.concat(s||Array.prototype.slice.call(e))}typeof SuppressedError=="function"&&SuppressedError;var _t={ADD_CHOICE:"ADD_CHOICE",REMOVE_CHOICE:"REMOVE_CHOICE",FILTER_CHOICES:"FILTER_CHOICES",ACTIVATE_CHOICES:"ACTIVATE_CHOICES",CLEAR_CHOICES:"CLEAR_CHOICES",ADD_GROUP:"ADD_GROUP",ADD_ITEM:"ADD_ITEM",REMOVE_ITEM:"REMOVE_ITEM",HIGHLIGHT_ITEM:"HIGHLIGHT_ITEM"},$t={showDropdown:"showDropdown",hideDropdown:"hideDropdown",change:"change",choice:"choice",search:"search",addItem:"addItem",removeItem:"removeItem",highlightItem:"highlightItem",highlightChoice:"highlightChoice",unhighlightItem:"unhighlightItem"},xt={TAB_KEY:9,SHIFT_KEY:16,BACK_KEY:46,DELETE_KEY:8,ENTER_KEY:13,A_KEY:65,ESC_KEY:27,UP_KEY:38,DOWN_KEY:40,PAGE_UP_KEY:33,PAGE_DOWN_KEY:34},k0=["fuseOptions","classNames"],En={Text:"text",SelectOne:"select-one",SelectMultiple:"select-multiple"},nc=function(t){return{type:_t.ADD_CHOICE,choice:t}},E0=function(t){return{type:_t.REMOVE_CHOICE,choice:t}},C0=function(t){return{type:_t.FILTER_CHOICES,results:t}},I0=function(t){return{type:_t.ACTIVATE_CHOICES,active:t}},x0=function(t){return{type:_t.ADD_GROUP,group:t}},ic=function(t){return{type:_t.ADD_ITEM,item:t}},rc=function(t){return{type:_t.REMOVE_ITEM,item:t}},_r=function(t,e){return{type:_t.HIGHLIGHT_ITEM,item:t,highlighted:e}},M0=function(t,e){return Math.floor(Math.random()*(e-t)+t)},sc=function(t){return Array.from({length:t},function(){return M0(0,36).toString(36)}).join("")},A0=function(t,e){var n=t.id||t.name&&"".concat(t.name,"-").concat(sc(2))||sc(4);return n=n.replace(/(:|\.|\[|\]|,)/g,""),n="".concat(e,"-").concat(n),n},T0=function(t,e,n){n===void 0&&(n=1);for(var i="".concat(n>0?"next":"previous","ElementSibling"),r=t[i];r;){if(r.matches(e))return r;r=r[i]}return null},N0=function(t,e,n){n===void 0&&(n=1);var i;return n>0?i=e.scrollTop+e.offsetHeight>=t.offsetTop+t.offsetHeight:i=t.offsetTop>=e.scrollTop,i},vr=function(t){if(typeof t!="string"){if(t==null)return"";if(typeof t=="object"){if("raw"in t)return vr(t.raw);if("trusted"in t)return t.trusted}return t}return t.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/'/g,"&#039;").replace(/"/g,"&quot;")},P0=function(){var t=document.createElement("div");return function(e){t.innerHTML=e.trim();for(var n=t.children[0];t.firstChild;)t.removeChild(t.firstChild);return n}}(),wi=function(t,e){return typeof t=="function"?t(vr(e),e):t},oc=function(t){return typeof t=="function"?t():t},Pn=function(t){if(typeof t=="string")return t;if(typeof t=="object"){if("trusted"in t)return t.trusted;if("raw"in t)return t.raw}return""},lc=function(t){if(typeof t=="string")return t;if(typeof t=="object"){if("escaped"in t)return t.escaped;if("trusted"in t)return t.trusted}return""},vs=function(t,e){return t?lc(e):vr(e)},hn=function(t,e,n){t.innerHTML=vs(e,n)},O0=function(t,e){var n=t.value,i=t.label,r=i===void 0?n:i,s=e.value,o=e.label,l=o===void 0?s:o;return Pn(r).localeCompare(Pn(l),[],{sensitivity:"base",ignorePunctuation:!0,numeric:!0})},L0=function(t,e){return t.rank-e.rank},D0=function(t,e,n){n===void 0&&(n=null);var i=new CustomEvent(e,{detail:n,bubbles:!0,cancelable:!0});return t.dispatchEvent(i)},R0=function(t,e){var n=Object.keys(t).sort(),i=Object.keys(e).sort();return n.filter(function(r){return i.indexOf(r)<0})},yr=function(t){return Array.isArray(t)?t:[t]},Si=function(t){return t&&Array.isArray(t)?t.map(function(e){return".".concat(e)}).join(""):".".concat(t)},Le=function(t,e){var n;(n=t.classList).add.apply(n,yr(e))},rn=function(t,e){var n;(n=t.classList).remove.apply(n,yr(e))},$0=function(t){if(typeof t<"u")try{return JSON.parse(t)}catch{return t}return{}},z0=function(t,e,n){var i=t.itemEl;i&&(rn(i,n),Le(i,e))},j0=function(){function t(e){var n=e.element,i=e.type,r=e.classNames;this.element=n,this.classNames=r,this.type=i,this.isActive=!1}return t.prototype.show=function(){return Le(this.element,this.classNames.activeState),this.element.setAttribute("aria-expanded","true"),this.isActive=!0,this},t.prototype.hide=function(){return rn(this.element,this.classNames.activeState),this.element.setAttribute("aria-expanded","false"),this.isActive=!1,this},t}(),ac=function(){function t(e){var n=e.element,i=e.type,r=e.classNames,s=e.position;this.element=n,this.classNames=r,this.type=i,this.position=s,this.isOpen=!1,this.isFlipped=!1,this.isDisabled=!1,this.isLoading=!1}return t.prototype.shouldFlip=function(e,n){var i=!1;return this.position==="auto"?i=this.element.getBoundingClientRect().top-n>=0&&!window.matchMedia("(min-height: ".concat(e+1,"px)")).matches:this.position==="top"&&(i=!0),i},t.prototype.setActiveDescendant=function(e){this.element.setAttribute("aria-activedescendant",e)},t.prototype.removeActiveDescendant=function(){this.element.removeAttribute("aria-activedescendant")},t.prototype.open=function(e,n){Le(this.element,this.classNames.openState),this.element.setAttribute("aria-expanded","true"),this.isOpen=!0,this.shouldFlip(e,n)&&(Le(this.element,this.classNames.flippedState),this.isFlipped=!0)},t.prototype.close=function(){rn(this.element,this.classNames.openState),this.element.setAttribute("aria-expanded","false"),this.removeActiveDescendant(),this.isOpen=!1,this.isFlipped&&(rn(this.element,this.classNames.flippedState),this.isFlipped=!1)},t.prototype.addFocusState=function(){Le(this.element,this.classNames.focusState)},t.prototype.removeFocusState=function(){rn(this.element,this.classNames.focusState)},t.prototype.enable=function(){rn(this.element,this.classNames.disabledState),this.element.removeAttribute("aria-disabled"),this.type===En.SelectOne&&this.element.setAttribute("tabindex","0"),this.isDisabled=!1},t.prototype.disable=function(){Le(this.element,this.classNames.disabledState),this.element.setAttribute("aria-disabled","true"),this.type===En.SelectOne&&this.element.setAttribute("tabindex","-1"),this.isDisabled=!0},t.prototype.wrap=function(e){var n=this.element,i=e.parentNode;i&&(e.nextSibling?i.insertBefore(n,e.nextSibling):i.appendChild(n)),n.appendChild(e)},t.prototype.unwrap=function(e){var n=this.element,i=n.parentNode;i&&(i.insertBefore(e,n),i.removeChild(n))},t.prototype.addLoadingState=function(){Le(this.element,this.classNames.loadingState),this.element.setAttribute("aria-busy","true"),this.isLoading=!0},t.prototype.removeLoadingState=function(){rn(this.element,this.classNames.loadingState),this.element.removeAttribute("aria-busy"),this.isLoading=!1},t}(),F0=function(){function t(e){var n=e.element,i=e.type,r=e.classNames,s=e.preventPaste;this.element=n,this.type=i,this.classNames=r,this.preventPaste=s,this.isFocussed=this.element.isEqualNode(document.activeElement),this.isDisabled=n.disabled,this._onPaste=this._onPaste.bind(this),this._onInput=this._onInput.bind(this),this._onFocus=this._onFocus.bind(this),this._onBlur=this._onBlur.bind(this)}return Object.defineProperty(t.prototype,"placeholder",{set:function(e){this.element.placeholder=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){return this.element.value},set:function(e){this.element.value=e},enumerable:!1,configurable:!0}),t.prototype.addEventListeners=function(){var e=this.element;e.addEventListener("paste",this._onPaste),e.addEventListener("input",this._onInput,{passive:!0}),e.addEventListener("focus",this._onFocus,{passive:!0}),e.addEventListener("blur",this._onBlur,{passive:!0})},t.prototype.removeEventListeners=function(){var e=this.element;e.removeEventListener("input",this._onInput),e.removeEventListener("paste",this._onPaste),e.removeEventListener("focus",this._onFocus),e.removeEventListener("blur",this._onBlur)},t.prototype.enable=function(){var e=this.element;e.removeAttribute("disabled"),this.isDisabled=!1},t.prototype.disable=function(){var e=this.element;e.setAttribute("disabled",""),this.isDisabled=!0},t.prototype.focus=function(){this.isFocussed||this.element.focus()},t.prototype.blur=function(){this.isFocussed&&this.element.blur()},t.prototype.clear=function(e){return e===void 0&&(e=!0),this.element.value="",e&&this.setWidth(),this},t.prototype.setWidth=function(){var e=this.element;e.style.minWidth="".concat(e.placeholder.length+1,"ch"),e.style.width="".concat(e.value.length+1,"ch")},t.prototype.setActiveDescendant=function(e){this.element.setAttribute("aria-activedescendant",e)},t.prototype.removeActiveDescendant=function(){this.element.removeAttribute("aria-activedescendant")},t.prototype._onInput=function(){this.type!==En.SelectOne&&this.setWidth()},t.prototype._onPaste=function(e){this.preventPaste&&e.preventDefault()},t.prototype._onFocus=function(){this.isFocussed=!0},t.prototype._onBlur=function(){this.isFocussed=!1},t}(),H0=4,cc=function(){function t(e){var n=e.element;this.element=n,this.scrollPos=this.element.scrollTop,this.height=this.element.offsetHeight}return t.prototype.prepend=function(e){var n=this.element.firstElementChild;n?this.element.insertBefore(e,n):this.element.append(e)},t.prototype.scrollToTop=function(){this.element.scrollTop=0},t.prototype.scrollToChildElement=function(e,n){var i=this;if(e){var r=this.element.offsetHeight,s=this.element.scrollTop+r,o=e.offsetHeight,l=e.offsetTop+o,a=n>0?this.element.scrollTop+l-s:e.offsetTop;requestAnimationFrame(function(){i._animateScroll(a,n)})}},t.prototype._scrollDown=function(e,n,i){var r=(i-e)/n,s=r>1?r:1;this.element.scrollTop=e+s},t.prototype._scrollUp=function(e,n,i){var r=(e-i)/n,s=r>1?r:1;this.element.scrollTop=e-s},t.prototype._animateScroll=function(e,n){var i=this,r=H0,s=this.element.scrollTop,o=!1;n>0?(this._scrollDown(s,r,e),s<e&&(o=!0)):(this._scrollUp(s,r,e),s>e&&(o=!0)),o&&requestAnimationFrame(function(){i._animateScroll(e,n)})},t}(),uc=function(){function t(e){var n=e.element,i=e.classNames;this.element=n,this.classNames=i,this.isDisabled=!1}return Object.defineProperty(t.prototype,"isActive",{get:function(){return this.element.dataset.choice==="active"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dir",{get:function(){return this.element.dir},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){return this.element.value},set:function(e){this.element.setAttribute("value",e),this.element.value=e},enumerable:!1,configurable:!0}),t.prototype.conceal=function(){var e=this.element;Le(e,this.classNames.input),e.hidden=!0,e.tabIndex=-1;var n=e.getAttribute("style");n&&e.setAttribute("data-choice-orig-style",n),e.setAttribute("data-choice","active")},t.prototype.reveal=function(){var e=this.element;rn(e,this.classNames.input),e.hidden=!1,e.removeAttribute("tabindex");var n=e.getAttribute("data-choice-orig-style");n?(e.removeAttribute("data-choice-orig-style"),e.setAttribute("style",n)):e.removeAttribute("style"),e.removeAttribute("data-choice")},t.prototype.enable=function(){this.element.removeAttribute("disabled"),this.element.disabled=!1,this.isDisabled=!1},t.prototype.disable=function(){this.element.setAttribute("disabled",""),this.element.disabled=!0,this.isDisabled=!0},t.prototype.triggerEvent=function(e,n){D0(this.element,e,n||{})},t}(),V0=function(t){tc(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e}(uc),ki=function(t,e){return e===void 0&&(e=!0),typeof t>"u"?e:!!t},fc=function(t){if(typeof t=="string"&&(t=t.split(" ").filter(function(e){return e.length})),Array.isArray(t)&&t.length)return t},sn=function(t,e,n){if(n===void 0&&(n=!0),typeof t=="string"){var i=vr(t),r=n||i===t?t:{escaped:i,raw:t},s=sn({value:t,label:r,selected:!0},!1);return s}var o=t;if("choices"in o){if(!e)throw new TypeError("optGroup is not allowed");var l=o,a=l.choices.map(function(f){return sn(f,!1)}),c={id:0,label:Pn(l.label)||l.value,active:!!a.length,disabled:!!l.disabled,choices:a};return c}var u=o,h={id:0,group:null,score:0,rank:0,value:u.value,label:u.label||u.value,active:ki(u.active),selected:ki(u.selected,!1),disabled:ki(u.disabled,!1),placeholder:ki(u.placeholder,!1),highlighted:!1,labelClass:fc(u.labelClass),labelDescription:u.labelDescription,customProperties:u.customProperties};return h},U0=function(t){return t.tagName==="INPUT"},dc=function(t){return t.tagName==="SELECT"},B0=function(t){return t.tagName==="OPTION"},q0=function(t){return t.tagName==="OPTGROUP"},K0=function(t){tc(e,t);function e(n){var i=n.element,r=n.classNames,s=n.template,o=n.extractPlaceholder,l=t.call(this,{element:i,classNames:r})||this;return l.template=s,l.extractPlaceholder=o,l}return Object.defineProperty(e.prototype,"placeholderOption",{get:function(){return this.element.querySelector('option[value=""]')||this.element.querySelector("option[placeholder]")},enumerable:!1,configurable:!0}),e.prototype.addOptions=function(n){var i=this,r=document.createDocumentFragment();n.forEach(function(s){var o=s;if(!o.element){var l=i.template(o);r.appendChild(l),o.element=l}}),this.element.appendChild(r)},e.prototype.optionsAsChoices=function(){var n=this,i=[];return this.element.querySelectorAll(":scope > option, :scope > optgroup").forEach(function(r){B0(r)?i.push(n._optionToChoice(r)):q0(r)&&i.push(n._optgroupToChoice(r))}),i},e.prototype._optionToChoice=function(n){return!n.hasAttribute("value")&&n.hasAttribute("placeholder")&&(n.setAttribute("value",""),n.value=""),{id:0,group:null,score:0,rank:0,value:n.value,label:n.label,element:n,active:!0,selected:this.extractPlaceholder?n.selected:n.hasAttribute("selected"),disabled:n.disabled,highlighted:!1,placeholder:this.extractPlaceholder&&(!n.value||n.hasAttribute("placeholder")),labelClass:typeof n.dataset.labelClass<"u"?fc(n.dataset.labelClass):void 0,labelDescription:typeof n.dataset.labelDescription<"u"?n.dataset.labelDescription:void 0,customProperties:$0(n.dataset.customProperties)}},e.prototype._optgroupToChoice=function(n){var i=this,r=n.querySelectorAll("option"),s=Array.from(r).map(function(o){return i._optionToChoice(o)});return{id:0,label:n.label||"",element:n,active:!!s.length,disabled:n.disabled,choices:s}},e}(uc),W0={containerOuter:["choices"],containerInner:["choices__inner"],input:["choices__input"],inputCloned:["choices__input--cloned"],list:["choices__list"],listItems:["choices__list--multiple"],listSingle:["choices__list--single"],listDropdown:["choices__list--dropdown"],item:["choices__item"],itemSelectable:["choices__item--selectable"],itemDisabled:["choices__item--disabled"],itemChoice:["choices__item--choice"],description:["choices__description"],placeholder:["choices__placeholder"],group:["choices__group"],groupHeading:["choices__heading"],button:["choices__button"],activeState:["is-active"],focusState:["is-focused"],openState:["is-open"],disabledState:["is-disabled"],highlightedState:["is-highlighted"],selectedState:["is-selected"],flippedState:["is-flipped"],loadingState:["is-loading"],notice:["choices__notice"],addChoice:["choices__item--selectable","add-choice"],noResults:["has-no-results"],noChoices:["has-no-choices"]},hc={items:[],choices:[],silent:!1,renderChoiceLimit:-1,maxItemCount:-1,closeDropdownOnSelect:"auto",singleModeForMultiSelect:!1,addChoices:!1,addItems:!0,addItemFilter:function(t){return!!t&&t!==""},removeItems:!0,removeItemButton:!1,removeItemButtonAlignLeft:!1,editItems:!1,allowHTML:!1,allowHtmlUserInput:!1,duplicateItemsAllowed:!0,delimiter:",",paste:!0,searchEnabled:!0,searchChoices:!0,searchFloor:1,searchResultLimit:4,searchFields:["label","value"],position:"auto",resetScrollPosition:!0,shouldSort:!0,shouldSortItems:!1,sorter:O0,shadowRoot:null,placeholder:!0,placeholderValue:null,searchPlaceholderValue:null,prependValue:null,appendValue:null,renderSelectedChoices:"auto",loadingText:"Loading...",noResultsText:"No results found",noChoicesText:"No choices to choose from",itemSelectText:"Press to select",uniqueItemText:"Only unique values can be added",customAddItemText:"Only values matching specific conditions can be added",addItemText:function(t){return'Press Enter to add <b>"'.concat(t,'"</b>')},removeItemIconText:function(){return"Remove item"},removeItemLabelText:function(t){return"Remove item: ".concat(t)},maxItemText:function(t){return"Only ".concat(t," values can be added")},valueComparer:function(t,e){return t===e},fuseOptions:{includeScore:!0},labelId:"",callbackOnInit:null,callbackOnCreateTemplates:null,classNames:W0,appendGroupInSearch:!1},mc=function(t){var e=t.itemEl;e&&(e.remove(),t.itemEl=void 0)};function Y0(t,e,n){var i=t,r=!0;switch(e.type){case _t.ADD_ITEM:{e.item.selected=!0;var s=e.item.element;s&&(s.selected=!0,s.setAttribute("selected","")),i.push(e.item);break}case _t.REMOVE_ITEM:{e.item.selected=!1;var s=e.item.element;if(s){s.selected=!1,s.removeAttribute("selected");var o=s.parentElement;o&&dc(o)&&o.type===En.SelectOne&&(o.value="")}mc(e.item),i=i.filter(function(u){return u.id!==e.item.id});break}case _t.REMOVE_CHOICE:{mc(e.choice),i=i.filter(function(c){return c.id!==e.choice.id});break}case _t.HIGHLIGHT_ITEM:{var l=e.highlighted,a=i.find(function(c){return c.id===e.item.id});a&&a.highlighted!==l&&(a.highlighted=l,n&&z0(a,l?n.classNames.highlightedState:n.classNames.selectedState,l?n.classNames.selectedState:n.classNames.highlightedState));break}default:{r=!1;break}}return{state:i,update:r}}function G0(t,e){var n=t,i=!0;switch(e.type){case _t.ADD_GROUP:{n.push(e.group);break}case _t.CLEAR_CHOICES:{n=[];break}default:{i=!1;break}}return{state:n,update:i}}function X0(t,e,n){var i=t,r=!0;switch(e.type){case _t.ADD_CHOICE:{i.push(e.choice);break}case _t.REMOVE_CHOICE:{e.choice.choiceEl=void 0,e.choice.group&&(e.choice.group.choices=e.choice.group.choices.filter(function(o){return o.id!==e.choice.id})),i=i.filter(function(o){return o.id!==e.choice.id});break}case _t.ADD_ITEM:case _t.REMOVE_ITEM:{e.item.choiceEl=void 0;break}case _t.FILTER_CHOICES:{var s=[];e.results.forEach(function(o){s[o.item.id]=o}),i.forEach(function(o){var l=s[o.id];l!==void 0?(o.score=l.score,o.rank=l.rank,o.active=!0):(o.score=0,o.rank=0,o.active=!1),n&&n.appendGroupInSearch&&(o.choiceEl=void 0)});break}case _t.ACTIVATE_CHOICES:{i.forEach(function(o){o.active=e.active,n&&n.appendGroupInSearch&&(o.choiceEl=void 0)});break}case _t.CLEAR_CHOICES:{i=[];break}default:{r=!1;break}}return{state:i,update:r}}var pc={groups:G0,items:Y0,choices:X0},J0=function(){function t(e){this._state=this.defaultState,this._listeners=[],this._txn=0,this._context=e}return Object.defineProperty(t.prototype,"defaultState",{get:function(){return{groups:[],items:[],choices:[]}},enumerable:!1,configurable:!0}),t.prototype.changeSet=function(e){return{groups:e,items:e,choices:e}},t.prototype.reset=function(){this._state=this.defaultState;var e=this.changeSet(!0);this._txn?this._changeSet=e:this._listeners.forEach(function(n){return n(e)})},t.prototype.subscribe=function(e){return this._listeners.push(e),this},t.prototype.dispatch=function(e){var n=this,i=this._state,r=!1,s=this._changeSet||this.changeSet(!1);Object.keys(pc).forEach(function(o){var l=pc[o](i[o],e,n._context);l.update&&(r=!0,s[o]=!0,i[o]=l.state)}),r&&(this._txn?this._changeSet=s:this._listeners.forEach(function(o){return o(s)}))},t.prototype.withTxn=function(e){this._txn++;try{e()}finally{if(this._txn=Math.max(0,this._txn-1),!this._txn){var n=this._changeSet;n&&(this._changeSet=void 0,this._listeners.forEach(function(i){return i(n)}))}}},Object.defineProperty(t.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"items",{get:function(){return this.state.items},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"highlightedActiveItems",{get:function(){return this.items.filter(function(e){return e.active&&e.highlighted})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"choices",{get:function(){return this.state.choices},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"activeChoices",{get:function(){return this.choices.filter(function(e){return e.active})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"searchableChoices",{get:function(){return this.choices.filter(function(e){return!e.disabled&&!e.placeholder})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"groups",{get:function(){return this.state.groups},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"activeGroups",{get:function(){var e=this;return this.state.groups.filter(function(n){var i=n.active&&!n.disabled,r=e.state.choices.some(function(s){return s.active&&!s.disabled});return i&&r},[])},enumerable:!1,configurable:!0}),t.prototype.inTxn=function(){return this._txn>0},t.prototype.getChoiceById=function(e){return this.activeChoices.find(function(n){return n.id===e})},t.prototype.getGroupById=function(e){return this.groups.find(function(n){return n.id===e})},t}(),Et={noChoices:"no-choices",noResults:"no-results",addChoice:"add-choice",generic:""};function Q0(t,e,n){return(e=ev(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function gc(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function ti(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?gc(Object(n),!0).forEach(function(i){Q0(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):gc(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}function Z0(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var i=n.call(t,e||"default");if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function ev(t){var e=Z0(t,"string");return typeof e=="symbol"?e:e+""}function mn(t){return Array.isArray?Array.isArray(t):yc(t)==="[object Array]"}const tv=1/0;function nv(t){if(typeof t=="string")return t;let e=t+"";return e=="0"&&1/t==-tv?"-0":e}function iv(t){return t==null?"":nv(t)}function on(t){return typeof t=="string"}function _c(t){return typeof t=="number"}function rv(t){return t===!0||t===!1||sv(t)&&yc(t)=="[object Boolean]"}function vc(t){return typeof t=="object"}function sv(t){return vc(t)&&t!==null}function Ut(t){return t!=null}function ys(t){return!t.trim().length}function yc(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(t)}const wb="Extended search is not available",ov="Incorrect 'index' type",lv=t=>`Invalid value for key ${t}`,av=t=>`Pattern length exceeds max of ${t}.`,cv=t=>`Missing ${t} property in key`,uv=t=>`Property 'weight' in key '${t}' must be a positive integer`,bc=Object.prototype.hasOwnProperty;class fv{constructor(e){this._keys=[],this._keyMap={};let n=0;e.forEach(i=>{let r=wc(i);this._keys.push(r),this._keyMap[r.id]=r,n+=r.weight}),this._keys.forEach(i=>{i.weight/=n})}get(e){return this._keyMap[e]}keys(){return this._keys}toJSON(){return JSON.stringify(this._keys)}}function wc(t){let e=null,n=null,i=null,r=1,s=null;if(on(t)||mn(t))i=t,e=Sc(t),n=bs(t);else{if(!bc.call(t,"name"))throw new Error(cv("name"));const o=t.name;if(i=o,bc.call(t,"weight")&&(r=t.weight,r<=0))throw new Error(uv(o));e=Sc(o),n=bs(o),s=t.getFn}return{path:e,id:n,weight:r,src:i,getFn:s}}function Sc(t){return mn(t)?t:t.split(".")}function bs(t){return mn(t)?t.join("."):t}function dv(t,e){let n=[],i=!1;const r=(s,o,l)=>{if(Ut(s))if(!o[l])n.push(s);else{let a=o[l];const c=s[a];if(!Ut(c))return;if(l===o.length-1&&(on(c)||_c(c)||rv(c)))n.push(iv(c));else if(mn(c)){i=!0;for(let u=0,h=c.length;u<h;u+=1)r(c[u],o,l+1)}else o.length&&r(c,o,l+1)}};return r(t,on(e)?e.split("."):e,0),i?n:n[0]}const hv={includeMatches:!1,findAllMatches:!1,minMatchCharLength:1},mv={isCaseSensitive:!1,includeScore:!1,keys:[],shouldSort:!0,sortFn:(t,e)=>t.score===e.score?t.idx<e.idx?-1:1:t.score<e.score?-1:1},pv={location:0,threshold:.6,distance:100},gv={useExtendedSearch:!1,getFn:dv,ignoreLocation:!1,ignoreFieldNorm:!1,fieldNormWeight:1};var Ae=ti(ti(ti(ti({},mv),hv),pv),gv);const _v=/[^ ]+/g;function vv(t=1,e=3){const n=new Map,i=Math.pow(10,e);return{get(r){const s=r.match(_v).length;if(n.has(s))return n.get(s);const o=1/Math.pow(s,.5*t),l=parseFloat(Math.round(o*i)/i);return n.set(s,l),l},clear(){n.clear()}}}class ws{constructor({getFn:e=Ae.getFn,fieldNormWeight:n=Ae.fieldNormWeight}={}){this.norm=vv(n,3),this.getFn=e,this.isCreated=!1,this.setIndexRecords()}setSources(e=[]){this.docs=e}setIndexRecords(e=[]){this.records=e}setKeys(e=[]){this.keys=e,this._keysMap={},e.forEach((n,i)=>{this._keysMap[n.id]=i})}create(){this.isCreated||!this.docs.length||(this.isCreated=!0,on(this.docs[0])?this.docs.forEach((e,n)=>{this._addString(e,n)}):this.docs.forEach((e,n)=>{this._addObject(e,n)}),this.norm.clear())}add(e){const n=this.size();on(e)?this._addString(e,n):this._addObject(e,n)}removeAt(e){this.records.splice(e,1);for(let n=e,i=this.size();n<i;n+=1)this.records[n].i-=1}getValueForItemAtKeyId(e,n){return e[this._keysMap[n]]}size(){return this.records.length}_addString(e,n){if(!Ut(e)||ys(e))return;let i={v:e,i:n,n:this.norm.get(e)};this.records.push(i)}_addObject(e,n){let i={i:n,$:{}};this.keys.forEach((r,s)=>{let o=r.getFn?r.getFn(e):this.getFn(e,r.path);if(Ut(o)){if(mn(o)){let l=[];const a=[{nestedArrIndex:-1,value:o}];for(;a.length;){const{nestedArrIndex:c,value:u}=a.pop();if(Ut(u))if(on(u)&&!ys(u)){let h={v:u,i:c,n:this.norm.get(u)};l.push(h)}else mn(u)&&u.forEach((h,f)=>{a.push({nestedArrIndex:f,value:h})})}i.$[s]=l}else if(on(o)&&!ys(o)){let l={v:o,n:this.norm.get(o)};i.$[s]=l}}}),this.records.push(i)}toJSON(){return{keys:this.keys,records:this.records}}}function kc(t,e,{getFn:n=Ae.getFn,fieldNormWeight:i=Ae.fieldNormWeight}={}){const r=new ws({getFn:n,fieldNormWeight:i});return r.setKeys(t.map(wc)),r.setSources(e),r.create(),r}function yv(t,{getFn:e=Ae.getFn,fieldNormWeight:n=Ae.fieldNormWeight}={}){const{keys:i,records:r}=t,s=new ws({getFn:e,fieldNormWeight:n});return s.setKeys(i),s.setIndexRecords(r),s}function br(t,{errors:e=0,currentLocation:n=0,expectedLocation:i=0,distance:r=Ae.distance,ignoreLocation:s=Ae.ignoreLocation}={}){const o=e/t.length;if(s)return o;const l=Math.abs(i-n);return r?o+l/r:l?1:o}function bv(t=[],e=Ae.minMatchCharLength){let n=[],i=-1,r=-1,s=0;for(let o=t.length;s<o;s+=1){let l=t[s];l&&i===-1?i=s:!l&&i!==-1&&(r=s-1,r-i+1>=e&&n.push([i,r]),i=-1)}return t[s-1]&&s-i>=e&&n.push([i,s-1]),n}const On=32;function wv(t,e,n,{location:i=Ae.location,distance:r=Ae.distance,threshold:s=Ae.threshold,findAllMatches:o=Ae.findAllMatches,minMatchCharLength:l=Ae.minMatchCharLength,includeMatches:a=Ae.includeMatches,ignoreLocation:c=Ae.ignoreLocation}={}){if(e.length>On)throw new Error(av(On));const u=e.length,h=t.length,f=Math.max(0,Math.min(i,h));let d=s,m=f;const p=l>1||a,g=p?Array(h):[];let _;for(;(_=t.indexOf(e,m))>-1;){let N=br(e,{currentLocation:_,expectedLocation:f,distance:r,ignoreLocation:c});if(d=Math.min(N,d),m=_+u,p){let E=0;for(;E<u;)g[_+E]=1,E+=1}}m=-1;let S=[],C=1,w=u+h;const k=1<<u-1;for(let N=0;N<u;N+=1){let E=0,M=w;for(;E<M;)br(e,{errors:N,currentLocation:f+M,expectedLocation:f,distance:r,ignoreLocation:c})<=d?E=M:w=M,M=Math.floor((w-E)/2+E);w=M;let O=Math.max(1,f-M+1),L=o?h:Math.min(f+M,h)+u,j=Array(L+2);j[L+1]=(1<<N)-1;for(let x=L;x>=O;x-=1){let H=x-1,P=n[t.charAt(H)];if(p&&(g[H]=+!!P),j[x]=(j[x+1]<<1|1)&P,N&&(j[x]|=(S[x+1]|S[x])<<1|1|S[x+1]),j[x]&k&&(C=br(e,{errors:N,currentLocation:H,expectedLocation:f,distance:r,ignoreLocation:c}),C<=d)){if(d=C,m=H,m<=f)break;O=Math.max(1,2*f-m)}}if(br(e,{errors:N+1,currentLocation:f,expectedLocation:f,distance:r,ignoreLocation:c})>d)break;S=j}const T={isMatch:m>=0,score:Math.max(.001,C)};if(p){const N=bv(g,l);N.length?a&&(T.indices=N):T.isMatch=!1}return T}function Sv(t){let e={};for(let n=0,i=t.length;n<i;n+=1){const r=t.charAt(n);e[r]=(e[r]||0)|1<<i-n-1}return e}class Ec{constructor(e,{location:n=Ae.location,threshold:i=Ae.threshold,distance:r=Ae.distance,includeMatches:s=Ae.includeMatches,findAllMatches:o=Ae.findAllMatches,minMatchCharLength:l=Ae.minMatchCharLength,isCaseSensitive:a=Ae.isCaseSensitive,ignoreLocation:c=Ae.ignoreLocation}={}){if(this.options={location:n,threshold:i,distance:r,includeMatches:s,findAllMatches:o,minMatchCharLength:l,isCaseSensitive:a,ignoreLocation:c},this.pattern=a?e:e.toLowerCase(),this.chunks=[],!this.pattern.length)return;const u=(f,d)=>{this.chunks.push({pattern:f,alphabet:Sv(f),startIndex:d})},h=this.pattern.length;if(h>On){let f=0;const d=h%On,m=h-d;for(;f<m;)u(this.pattern.substr(f,On),f),f+=On;if(d){const p=h-On;u(this.pattern.substr(p),p)}}else u(this.pattern,0)}searchIn(e){const{isCaseSensitive:n,includeMatches:i}=this.options;if(n||(e=e.toLowerCase()),this.pattern===e){let m={isMatch:!0,score:0};return i&&(m.indices=[[0,e.length-1]]),m}const{location:r,distance:s,threshold:o,findAllMatches:l,minMatchCharLength:a,ignoreLocation:c}=this.options;let u=[],h=0,f=!1;this.chunks.forEach(({pattern:m,alphabet:p,startIndex:g})=>{const{isMatch:_,score:S,indices:C}=wv(e,m,p,{location:r+g,distance:s,threshold:o,findAllMatches:l,minMatchCharLength:a,includeMatches:i,ignoreLocation:c});_&&(f=!0),h+=S,_&&C&&(u=[...u,...C])});let d={isMatch:f,score:f?h/this.chunks.length:1};return f&&i&&(d.indices=u),d}}class Cn{constructor(e){this.pattern=e}static isMultiMatch(e){return Cc(e,this.multiRegex)}static isSingleMatch(e){return Cc(e,this.singleRegex)}search(){}}function Cc(t,e){const n=t.match(e);return n?n[1]:null}class kv extends Cn{constructor(e){super(e)}static get type(){return"exact"}static get multiRegex(){return/^="(.*)"$/}static get singleRegex(){return/^=(.*)$/}search(e){const n=e===this.pattern;return{isMatch:n,score:n?0:1,indices:[0,this.pattern.length-1]}}}class Ev extends Cn{constructor(e){super(e)}static get type(){return"inverse-exact"}static get multiRegex(){return/^!"(.*)"$/}static get singleRegex(){return/^!(.*)$/}search(e){const i=e.indexOf(this.pattern)===-1;return{isMatch:i,score:i?0:1,indices:[0,e.length-1]}}}class Cv extends Cn{constructor(e){super(e)}static get type(){return"prefix-exact"}static get multiRegex(){return/^\^"(.*)"$/}static get singleRegex(){return/^\^(.*)$/}search(e){const n=e.startsWith(this.pattern);return{isMatch:n,score:n?0:1,indices:[0,this.pattern.length-1]}}}class Iv extends Cn{constructor(e){super(e)}static get type(){return"inverse-prefix-exact"}static get multiRegex(){return/^!\^"(.*)"$/}static get singleRegex(){return/^!\^(.*)$/}search(e){const n=!e.startsWith(this.pattern);return{isMatch:n,score:n?0:1,indices:[0,e.length-1]}}}class xv extends Cn{constructor(e){super(e)}static get type(){return"suffix-exact"}static get multiRegex(){return/^"(.*)"\$$/}static get singleRegex(){return/^(.*)\$$/}search(e){const n=e.endsWith(this.pattern);return{isMatch:n,score:n?0:1,indices:[e.length-this.pattern.length,e.length-1]}}}class Mv extends Cn{constructor(e){super(e)}static get type(){return"inverse-suffix-exact"}static get multiRegex(){return/^!"(.*)"\$$/}static get singleRegex(){return/^!(.*)\$$/}search(e){const n=!e.endsWith(this.pattern);return{isMatch:n,score:n?0:1,indices:[0,e.length-1]}}}class Ic extends Cn{constructor(e,{location:n=Ae.location,threshold:i=Ae.threshold,distance:r=Ae.distance,includeMatches:s=Ae.includeMatches,findAllMatches:o=Ae.findAllMatches,minMatchCharLength:l=Ae.minMatchCharLength,isCaseSensitive:a=Ae.isCaseSensitive,ignoreLocation:c=Ae.ignoreLocation}={}){super(e),this._bitapSearch=new Ec(e,{location:n,threshold:i,distance:r,includeMatches:s,findAllMatches:o,minMatchCharLength:l,isCaseSensitive:a,ignoreLocation:c})}static get type(){return"fuzzy"}static get multiRegex(){return/^"(.*)"$/}static get singleRegex(){return/^(.*)$/}search(e){return this._bitapSearch.searchIn(e)}}class xc extends Cn{constructor(e){super(e)}static get type(){return"include"}static get multiRegex(){return/^'"(.*)"$/}static get singleRegex(){return/^'(.*)$/}search(e){let n=0,i;const r=[],s=this.pattern.length;for(;(i=e.indexOf(this.pattern,n))>-1;)n=i+s,r.push([i,n-1]);const o=!!r.length;return{isMatch:o,score:o?0:1,indices:r}}}const Ss=[kv,xc,Cv,Iv,Mv,xv,Ev,Ic],Mc=Ss.length,Av=/ +(?=(?:[^\"]*\"[^\"]*\")*[^\"]*$)/,Tv="|";function Nv(t,e={}){return t.split(Tv).map(n=>{let i=n.trim().split(Av).filter(s=>s&&!!s.trim()),r=[];for(let s=0,o=i.length;s<o;s+=1){const l=i[s];let a=!1,c=-1;for(;!a&&++c<Mc;){const u=Ss[c];let h=u.isMultiMatch(l);h&&(r.push(new u(h,e)),a=!0)}if(!a)for(c=-1;++c<Mc;){const u=Ss[c];let h=u.isSingleMatch(l);if(h){r.push(new u(h,e));break}}}return r})}const Pv=new Set([Ic.type,xc.type]);class Ov{constructor(e,{isCaseSensitive:n=Ae.isCaseSensitive,includeMatches:i=Ae.includeMatches,minMatchCharLength:r=Ae.minMatchCharLength,ignoreLocation:s=Ae.ignoreLocation,findAllMatches:o=Ae.findAllMatches,location:l=Ae.location,threshold:a=Ae.threshold,distance:c=Ae.distance}={}){this.query=null,this.options={isCaseSensitive:n,includeMatches:i,minMatchCharLength:r,findAllMatches:o,ignoreLocation:s,location:l,threshold:a,distance:c},this.pattern=n?e:e.toLowerCase(),this.query=Nv(this.pattern,this.options)}static condition(e,n){return n.useExtendedSearch}searchIn(e){const n=this.query;if(!n)return{isMatch:!1,score:1};const{includeMatches:i,isCaseSensitive:r}=this.options;e=r?e:e.toLowerCase();let s=0,o=[],l=0;for(let a=0,c=n.length;a<c;a+=1){const u=n[a];o.length=0,s=0;for(let h=0,f=u.length;h<f;h+=1){const d=u[h],{isMatch:m,indices:p,score:g}=d.search(e);if(m){if(s+=1,l+=g,i){const _=d.constructor.type;Pv.has(_)?o=[...o,...p]:o.push(p)}}else{l=0,s=0,o.length=0;break}}if(s){let h={isMatch:!0,score:l/s};return i&&(h.indices=o),h}}return{isMatch:!1,score:1}}}const ks=[];function Lv(...t){ks.push(...t)}function Es(t,e){for(let n=0,i=ks.length;n<i;n+=1){let r=ks[n];if(r.condition(t,e))return new r(t,e)}return new Ec(t,e)}const wr={AND:"$and",OR:"$or"},Cs={PATH:"$path",PATTERN:"$val"},Is=t=>!!(t[wr.AND]||t[wr.OR]),Dv=t=>!!t[Cs.PATH],Rv=t=>!mn(t)&&vc(t)&&!Is(t),Ac=t=>({[wr.AND]:Object.keys(t).map(e=>({[e]:t[e]}))});function Tc(t,e,{auto:n=!0}={}){const i=r=>{let s=Object.keys(r);const o=Dv(r);if(!o&&s.length>1&&!Is(r))return i(Ac(r));if(Rv(r)){const a=o?r[Cs.PATH]:s[0],c=o?r[Cs.PATTERN]:r[a];if(!on(c))throw new Error(lv(a));const u={keyId:bs(a),pattern:c};return n&&(u.searcher=Es(c,e)),u}let l={children:[],operator:s[0]};return s.forEach(a=>{const c=r[a];mn(c)&&c.forEach(u=>{l.children.push(i(u))})}),l};return Is(t)||(t=Ac(t)),i(t)}function $v(t,{ignoreFieldNorm:e=Ae.ignoreFieldNorm}){t.forEach(n=>{let i=1;n.matches.forEach(({key:r,norm:s,score:o})=>{const l=r?r.weight:null;i*=Math.pow(o===0&&l?Number.EPSILON:o,(l||1)*(e?1:s))}),n.score=i})}function zv(t,e){const n=t.matches;e.matches=[],Ut(n)&&n.forEach(i=>{if(!Ut(i.indices)||!i.indices.length)return;const{indices:r,value:s}=i;let o={indices:r,value:s};i.key&&(o.key=i.key.src),i.idx>-1&&(o.refIndex=i.idx),e.matches.push(o)})}function jv(t,e){e.score=t.score}function Fv(t,e,{includeMatches:n=Ae.includeMatches,includeScore:i=Ae.includeScore}={}){const r=[];return n&&r.push(zv),i&&r.push(jv),t.map(s=>{const{idx:o}=s,l={item:e[o],refIndex:o};return r.length&&r.forEach(a=>{a(s,l)}),l})}class ni{constructor(e,n={},i){this.options=ti(ti({},Ae),n),this.options.useExtendedSearch,this._keyStore=new fv(this.options.keys),this.setCollection(e,i)}setCollection(e,n){if(this._docs=e,n&&!(n instanceof ws))throw new Error(ov);this._myIndex=n||kc(this.options.keys,this._docs,{getFn:this.options.getFn,fieldNormWeight:this.options.fieldNormWeight})}add(e){Ut(e)&&(this._docs.push(e),this._myIndex.add(e))}remove(e=()=>!1){const n=[];for(let i=0,r=this._docs.length;i<r;i+=1){const s=this._docs[i];e(s,i)&&(this.removeAt(i),i-=1,r-=1,n.push(s))}return n}removeAt(e){this._docs.splice(e,1),this._myIndex.removeAt(e)}getIndex(){return this._myIndex}search(e,{limit:n=-1}={}){const{includeMatches:i,includeScore:r,shouldSort:s,sortFn:o,ignoreFieldNorm:l}=this.options;let a=on(e)?on(this._docs[0])?this._searchStringList(e):this._searchObjectList(e):this._searchLogical(e);return $v(a,{ignoreFieldNorm:l}),s&&a.sort(o),_c(n)&&n>-1&&(a=a.slice(0,n)),Fv(a,this._docs,{includeMatches:i,includeScore:r})}_searchStringList(e){const n=Es(e,this.options),{records:i}=this._myIndex,r=[];return i.forEach(({v:s,i:o,n:l})=>{if(!Ut(s))return;const{isMatch:a,score:c,indices:u}=n.searchIn(s);a&&r.push({item:s,idx:o,matches:[{score:c,value:s,norm:l,indices:u}]})}),r}_searchLogical(e){const n=Tc(e,this.options),i=(l,a,c)=>{if(!l.children){const{keyId:h,searcher:f}=l,d=this._findMatches({key:this._keyStore.get(h),value:this._myIndex.getValueForItemAtKeyId(a,h),searcher:f});return d&&d.length?[{idx:c,item:a,matches:d}]:[]}const u=[];for(let h=0,f=l.children.length;h<f;h+=1){const d=l.children[h],m=i(d,a,c);if(m.length)u.push(...m);else if(l.operator===wr.AND)return[]}return u},r=this._myIndex.records,s={},o=[];return r.forEach(({$:l,i:a})=>{if(Ut(l)){let c=i(n,l,a);c.length&&(s[a]||(s[a]={idx:a,item:l,matches:[]},o.push(s[a])),c.forEach(({matches:u})=>{s[a].matches.push(...u)}))}}),o}_searchObjectList(e){const n=Es(e,this.options),{keys:i,records:r}=this._myIndex,s=[];return r.forEach(({$:o,i:l})=>{if(!Ut(o))return;let a=[];i.forEach((c,u)=>{a.push(...this._findMatches({key:c,value:o[u],searcher:n}))}),a.length&&s.push({idx:l,item:o,matches:a})}),s}_findMatches({key:e,value:n,searcher:i}){if(!Ut(n))return[];let r=[];if(mn(n))n.forEach(({v:s,i:o,n:l})=>{if(!Ut(s))return;const{isMatch:a,score:c,indices:u}=i.searchIn(s);a&&r.push({score:c,key:e,value:s,idx:o,norm:l,indices:u})});else{const{v:s,n:o}=n,{isMatch:l,score:a,indices:c}=i.searchIn(s);l&&r.push({score:a,key:e,value:s,norm:o,indices:c})}return r}}ni.version="7.0.0",ni.createIndex=kc,ni.parseIndex=yv,ni.config=Ae,ni.parseQuery=Tc,Lv(Ov);var Hv=function(){function t(e){this._haystack=[],this._fuseOptions=Rt(Rt({},e.fuseOptions),{keys:S0([],e.searchFields,!0),includeMatches:!0})}return t.prototype.index=function(e){this._haystack=e,this._fuse&&this._fuse.setCollection(e)},t.prototype.reset=function(){this._haystack=[],this._fuse=void 0},t.prototype.isEmptyIndex=function(){return!this._haystack.length},t.prototype.search=function(e){this._fuse||(this._fuse=new ni(this._haystack,this._fuseOptions));var n=this._fuse.search(e);return n.map(function(i,r){return{item:i.item,score:i.score||0,rank:r+1}})},t}();function Vv(t){return new Hv(t)}var Uv=function(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0},xs=function(t,e,n){var i=t.dataset,r=e.customProperties,s=e.labelClass,o=e.labelDescription;s&&(i.labelClass=yr(s).join(" ")),o&&(i.labelDescription=o),n&&r&&(typeof r=="string"?i.customProperties=r:typeof r=="object"&&!Uv(r)&&(i.customProperties=JSON.stringify(r)))},Nc=function(t,e,n){var i=e&&t.querySelector("label[for='".concat(e,"']")),r=i&&i.innerText;r&&n.setAttribute("aria-label",r)},Bv={containerOuter:function(t,e,n,i,r,s,o){var l=t.classNames.containerOuter,a=document.createElement("div");return Le(a,l),a.dataset.type=s,e&&(a.dir=e),i&&(a.tabIndex=0),n&&(a.setAttribute("role",r?"combobox":"listbox"),r?a.setAttribute("aria-autocomplete","list"):o||Nc(this._docRoot,this.passedElement.element.id,a),a.setAttribute("aria-haspopup","true"),a.setAttribute("aria-expanded","false")),o&&a.setAttribute("aria-labelledby",o),a},containerInner:function(t){var e=t.classNames.containerInner,n=document.createElement("div");return Le(n,e),n},itemList:function(t,e){var n=t.searchEnabled,i=t.classNames,r=i.list,s=i.listSingle,o=i.listItems,l=document.createElement("div");return Le(l,r),Le(l,e?s:o),this._isSelectElement&&n&&l.setAttribute("role","listbox"),l},placeholder:function(t,e){var n=t.allowHTML,i=t.classNames.placeholder,r=document.createElement("div");return Le(r,i),hn(r,n,e),r},item:function(t,e,n){var i=t.allowHTML,r=t.removeItemButtonAlignLeft,s=t.removeItemIconText,o=t.removeItemLabelText,l=t.classNames,a=l.item,c=l.button,u=l.highlightedState,h=l.itemSelectable,f=l.placeholder,d=Pn(e.value),m=document.createElement("div");if(Le(m,a),e.labelClass){var p=document.createElement("span");hn(p,i,e.label),Le(p,e.labelClass),m.appendChild(p)}else hn(m,i,e.label);if(m.dataset.item="",m.dataset.id=e.id,m.dataset.value=d,xs(m,e,!0),(e.disabled||this.containerOuter.isDisabled)&&m.setAttribute("aria-disabled","true"),this._isSelectElement&&(m.setAttribute("aria-selected","true"),m.setAttribute("role","option")),e.placeholder&&(Le(m,f),m.dataset.placeholder=""),Le(m,e.highlighted?u:h),n){e.disabled&&rn(m,h),m.dataset.deletable="";var g=document.createElement("button");g.type="button",Le(g,c),hn(g,!0,wi(s,e.value));var _=wi(o,e.value);_&&g.setAttribute("aria-label",_),g.dataset.button="",r?m.insertAdjacentElement("afterbegin",g):m.appendChild(g)}return m},choiceList:function(t,e){var n=t.classNames.list,i=document.createElement("div");return Le(i,n),e||i.setAttribute("aria-multiselectable","true"),i.setAttribute("role","listbox"),i},choiceGroup:function(t,e){var n=t.allowHTML,i=t.classNames,r=i.group,s=i.groupHeading,o=i.itemDisabled,l=e.id,a=e.label,c=e.disabled,u=Pn(a),h=document.createElement("div");Le(h,r),c&&Le(h,o),h.setAttribute("role","group"),h.dataset.group="",h.dataset.id=l,h.dataset.value=u,c&&h.setAttribute("aria-disabled","true");var f=document.createElement("div");return Le(f,s),hn(f,n,a||""),h.appendChild(f),h},choice:function(t,e,n,i){var r=t.allowHTML,s=t.classNames,o=s.item,l=s.itemChoice,a=s.itemSelectable,c=s.selectedState,u=s.itemDisabled,h=s.description,f=s.placeholder,d=e.label,m=Pn(e.value),p=document.createElement("div");p.id=e.elementId,Le(p,o),Le(p,l),i&&typeof d=="string"&&(d=vs(r,d),d+=" (".concat(i,")"),d={trusted:d});var g=p;if(e.labelClass){var _=document.createElement("span");hn(_,r,d),Le(_,e.labelClass),g=_,p.appendChild(_)}else hn(p,r,d);if(e.labelDescription){var S="".concat(e.elementId,"-description");g.setAttribute("aria-describedby",S);var C=document.createElement("span");hn(C,r,e.labelDescription),C.id=S,Le(C,h),p.appendChild(C)}return e.selected&&Le(p,c),e.placeholder&&Le(p,f),p.setAttribute("role",e.group?"treeitem":"option"),p.dataset.choice="",p.dataset.id=e.id,p.dataset.value=m,n&&(p.dataset.selectText=n),e.group&&(p.dataset.groupId="".concat(e.group.id)),xs(p,e,!1),e.disabled?(Le(p,u),p.dataset.choiceDisabled="",p.setAttribute("aria-disabled","true")):(Le(p,a),p.dataset.choiceSelectable=""),p},input:function(t,e){var n=t.classNames,i=n.input,r=n.inputCloned,s=t.labelId,o=document.createElement("input");return o.type="search",Le(o,i),Le(o,r),o.autocomplete="off",o.autocapitalize="off",o.spellcheck=!1,o.setAttribute("aria-autocomplete","list"),e?o.setAttribute("aria-label",e):s||Nc(this._docRoot,this.passedElement.element.id,o),o},dropdown:function(t){var e=t.classNames,n=e.list,i=e.listDropdown,r=document.createElement("div");return Le(r,n),Le(r,i),r.setAttribute("aria-expanded","false"),r},notice:function(t,e,n){var i=t.classNames,r=i.item,s=i.itemChoice,o=i.addChoice,l=i.noResults,a=i.noChoices,c=i.notice;n===void 0&&(n=Et.generic);var u=document.createElement("div");switch(hn(u,!0,e),Le(u,r),Le(u,s),Le(u,c),n){case Et.addChoice:Le(u,o);break;case Et.noResults:Le(u,l);break;case Et.noChoices:Le(u,a);break}return n===Et.addChoice&&(u.dataset.choiceSelectable="",u.dataset.choice=""),u},option:function(t){var e=Pn(t.label),n=new Option(e,t.value,!1,t.selected);return xs(n,t,!0),n.disabled=t.disabled,t.selected&&n.setAttribute("selected",""),n}},qv="-ms-scroll-limit"in document.documentElement.style&&"-ms-ime-align"in document.documentElement.style,Kv={},Ms=function(t){if(t)return t.dataset.id?parseInt(t.dataset.id,10):void 0},Ei="[data-choice-selectable]",Wv=function(){function t(e,n){e===void 0&&(e="[data-choice]"),n===void 0&&(n={});var i=this;this.initialisedOK=void 0,this._hasNonChoicePlaceholder=!1,this._lastAddedChoiceId=0,this._lastAddedGroupId=0;var r=t.defaults;this.config=Rt(Rt(Rt({},r.allOptions),r.options),n),k0.forEach(function(_){i.config[_]=Rt(Rt(Rt({},r.allOptions[_]),r.options[_]),n[_])});var s=this.config;s.silent||this._validateConfig();var o=s.shadowRoot||document.documentElement;this._docRoot=o;var l=typeof e=="string"?o.querySelector(e):e;if(!l||typeof l!="object"||!(U0(l)||dc(l)))throw TypeError(!l&&typeof e=="string"?"Selector ".concat(e," failed to find an element"):"Expected one of the following types text|select-one|select-multiple");var a=l.type,c=a===En.Text;(c||s.maxItemCount!==1)&&(s.singleModeForMultiSelect=!1),s.singleModeForMultiSelect&&(a=En.SelectMultiple);var u=a===En.SelectOne,h=a===En.SelectMultiple,f=u||h;if(this._elementType=a,this._isTextElement=c,this._isSelectOneElement=u,this._isSelectMultipleElement=h,this._isSelectElement=u||h,this._canAddUserChoices=c&&s.addItems||f&&s.addChoices,typeof s.renderSelectedChoices!="boolean"&&(s.renderSelectedChoices=s.renderSelectedChoices==="always"||u),s.closeDropdownOnSelect==="auto"?s.closeDropdownOnSelect=c||u||s.singleModeForMultiSelect:s.closeDropdownOnSelect=ki(s.closeDropdownOnSelect),s.placeholder&&(s.placeholderValue?this._hasNonChoicePlaceholder=!0:l.dataset.placeholder&&(this._hasNonChoicePlaceholder=!0,s.placeholderValue=l.dataset.placeholder)),n.addItemFilter&&typeof n.addItemFilter!="function"){var d=n.addItemFilter instanceof RegExp?n.addItemFilter:new RegExp(n.addItemFilter);s.addItemFilter=d.test.bind(d)}if(this._isTextElement)this.passedElement=new V0({element:l,classNames:s.classNames});else{var m=l;this.passedElement=new K0({element:m,classNames:s.classNames,template:function(_){return i._templates.option(_)},extractPlaceholder:s.placeholder&&!this._hasNonChoicePlaceholder})}if(this.initialised=!1,this._store=new J0(s),this._currentValue="",s.searchEnabled=!c&&s.searchEnabled||h,this._canSearch=s.searchEnabled,this._isScrollingOnIe=!1,this._highlightPosition=0,this._wasTap=!0,this._placeholderValue=this._generatePlaceholderValue(),this._baseId=A0(l,"choices-"),this._direction=l.dir,!this._direction){var p=window.getComputedStyle(l).direction,g=window.getComputedStyle(document.documentElement).direction;p!==g&&(this._direction=p)}if(this._idNames={itemChoice:"item-choice"},this._templates=r.templates,this._render=this._render.bind(this),this._onFocus=this._onFocus.bind(this),this._onBlur=this._onBlur.bind(this),this._onKeyUp=this._onKeyUp.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onInput=this._onInput.bind(this),this._onClick=this._onClick.bind(this),this._onTouchMove=this._onTouchMove.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._onMouseDown=this._onMouseDown.bind(this),this._onMouseOver=this._onMouseOver.bind(this),this._onFormReset=this._onFormReset.bind(this),this._onSelectKey=this._onSelectKey.bind(this),this._onEnterKey=this._onEnterKey.bind(this),this._onEscapeKey=this._onEscapeKey.bind(this),this._onDirectionKey=this._onDirectionKey.bind(this),this._onDeleteKey=this._onDeleteKey.bind(this),this.passedElement.isActive){s.silent||console.warn("Trying to initialise Choices on element already initialised",{element:e}),this.initialised=!0,this.initialisedOK=!1;return}this.init(),this._initialItems=this._store.items.map(function(_){return _.value})}return Object.defineProperty(t,"defaults",{get:function(){return Object.preventExtensions({get options(){return Kv},get allOptions(){return hc},get templates(){return Bv}})},enumerable:!1,configurable:!0}),t.prototype.init=function(){if(!(this.initialised||this.initialisedOK!==void 0)){this._searcher=Vv(this.config),this._loadChoices(),this._createTemplates(),this._createElements(),this._createStructure(),this._isTextElement&&!this.config.addItems||this.passedElement.element.hasAttribute("disabled")||this.passedElement.element.closest("fieldset:disabled")?this.disable():(this.enable(),this._addEventListeners()),this._initStore(),this.initialised=!0,this.initialisedOK=!0;var e=this.config.callbackOnInit;typeof e=="function"&&e.call(this)}},t.prototype.destroy=function(){this.initialised&&(this._removeEventListeners(),this.passedElement.reveal(),this.containerOuter.unwrap(this.passedElement.element),this._store._listeners=[],this.clearStore(!1),this._stopSearch(),this._templates=t.defaults.templates,this.initialised=!1,this.initialisedOK=void 0)},t.prototype.enable=function(){return this.passedElement.isDisabled&&this.passedElement.enable(),this.containerOuter.isDisabled&&(this._addEventListeners(),this.input.enable(),this.containerOuter.enable()),this},t.prototype.disable=function(){return this.passedElement.isDisabled||this.passedElement.disable(),this.containerOuter.isDisabled||(this._removeEventListeners(),this.input.disable(),this.containerOuter.disable()),this},t.prototype.highlightItem=function(e,n){if(n===void 0&&(n=!0),!e||!e.id)return this;var i=this._store.items.find(function(r){return r.id===e.id});return!i||i.highlighted?this:(this._store.dispatch(_r(i,!0)),n&&this.passedElement.triggerEvent($t.highlightItem,this._getChoiceForOutput(i)),this)},t.prototype.unhighlightItem=function(e,n){if(n===void 0&&(n=!0),!e||!e.id)return this;var i=this._store.items.find(function(r){return r.id===e.id});return!i||!i.highlighted?this:(this._store.dispatch(_r(i,!1)),n&&this.passedElement.triggerEvent($t.unhighlightItem,this._getChoiceForOutput(i)),this)},t.prototype.highlightAll=function(){var e=this;return this._store.withTxn(function(){e._store.items.forEach(function(n){n.highlighted||(e._store.dispatch(_r(n,!0)),e.passedElement.triggerEvent($t.highlightItem,e._getChoiceForOutput(n)))})}),this},t.prototype.unhighlightAll=function(){var e=this;return this._store.withTxn(function(){e._store.items.forEach(function(n){n.highlighted&&(e._store.dispatch(_r(n,!1)),e.passedElement.triggerEvent($t.highlightItem,e._getChoiceForOutput(n)))})}),this},t.prototype.removeActiveItemsByValue=function(e){var n=this;return this._store.withTxn(function(){n._store.items.filter(function(i){return i.value===e}).forEach(function(i){return n._removeItem(i)})}),this},t.prototype.removeActiveItems=function(e){var n=this;return this._store.withTxn(function(){n._store.items.filter(function(i){var r=i.id;return r!==e}).forEach(function(i){return n._removeItem(i)})}),this},t.prototype.removeHighlightedItems=function(e){var n=this;return e===void 0&&(e=!1),this._store.withTxn(function(){n._store.highlightedActiveItems.forEach(function(i){n._removeItem(i),e&&n._triggerChange(i.value)})}),this},t.prototype.showDropdown=function(e){var n=this;return this.dropdown.isActive?this:(e===void 0&&(e=!this._canSearch),requestAnimationFrame(function(){n.dropdown.show();var i=n.dropdown.element.getBoundingClientRect();n.containerOuter.open(i.bottom,i.height),e||n.input.focus(),n.passedElement.triggerEvent($t.showDropdown)}),this)},t.prototype.hideDropdown=function(e){var n=this;return this.dropdown.isActive?(requestAnimationFrame(function(){n.dropdown.hide(),n.containerOuter.close(),!e&&n._canSearch&&(n.input.removeActiveDescendant(),n.input.blur()),n.passedElement.triggerEvent($t.hideDropdown)}),this):this},t.prototype.getValue=function(e){var n=this,i=this._store.items.map(function(r){return e?r.value:n._getChoiceForOutput(r)});return this._isSelectOneElement||this.config.singleModeForMultiSelect?i[0]:i},t.prototype.setValue=function(e){var n=this;return this.initialisedOK?(this._store.withTxn(function(){e.forEach(function(i){i&&n._addChoice(sn(i,!1))})}),this._searcher.reset(),this):(this._warnChoicesInitFailed("setValue"),this)},t.prototype.setChoiceByValue=function(e){var n=this;return this.initialisedOK?this._isTextElement?this:(this._store.withTxn(function(){var i=Array.isArray(e)?e:[e];i.forEach(function(r){return n._findAndSelectChoiceByValue(r)}),n.unhighlightAll()}),this._searcher.reset(),this):(this._warnChoicesInitFailed("setChoiceByValue"),this)},t.prototype.setChoices=function(e,n,i,r,s,o){var l=this;if(e===void 0&&(e=[]),n===void 0&&(n="value"),i===void 0&&(i="label"),r===void 0&&(r=!1),s===void 0&&(s=!0),o===void 0&&(o=!1),!this.initialisedOK)return this._warnChoicesInitFailed("setChoices"),this;if(!this._isSelectElement)throw new TypeError("setChoices can't be used with INPUT based Choices");if(typeof n!="string"||!n)throw new TypeError("value parameter must be a name of 'value' field in passed objects");if(typeof e=="function"){var a=e(this);if(typeof Promise=="function"&&a instanceof Promise)return new Promise(function(c){return requestAnimationFrame(c)}).then(function(){return l._handleLoadingState(!0)}).then(function(){return a}).then(function(c){return l.setChoices(c,n,i,r,s,o)}).catch(function(c){l.config.silent||console.error(c)}).then(function(){return l._handleLoadingState(!1)}).then(function(){return l});if(!Array.isArray(a))throw new TypeError(".setChoices first argument function must return either array of choices or Promise, got: ".concat(typeof a));return this.setChoices(a,n,i,!1)}if(!Array.isArray(e))throw new TypeError(".setChoices must be called either with array of choices with a function resulting into Promise of array of choices");return this.containerOuter.removeLoadingState(),this._store.withTxn(function(){s&&(l._isSearching=!1),r&&l.clearChoices(!0,o);var c=n==="value",u=i==="label";e.forEach(function(h){if("choices"in h){var f=h;u||(f=Rt(Rt({},f),{label:f[i]})),l._addGroup(sn(f,!0))}else{var d=h;(!u||!c)&&(d=Rt(Rt({},d),{value:d[n],label:d[i]}));var m=sn(d,!1);l._addChoice(m),m.placeholder&&!l._hasNonChoicePlaceholder&&(l._placeholderValue=lc(m.label))}}),l.unhighlightAll()}),this._searcher.reset(),this},t.prototype.refresh=function(e,n,i){var r=this;return e===void 0&&(e=!1),n===void 0&&(n=!1),i===void 0&&(i=!1),this._isSelectElement?(this._store.withTxn(function(){var s=r.passedElement.optionsAsChoices(),o={};i||r._store.items.forEach(function(a){a.id&&a.active&&a.selected&&(o[a.value]=!0)}),r.clearStore(!1);var l=function(a){i?r._store.dispatch(rc(a)):o[a.value]&&(a.selected=!0)};s.forEach(function(a){if("choices"in a){a.choices.forEach(l);return}l(a)}),r._addPredefinedChoices(s,n,e),r._isSearching&&r._searchChoices(r.input.value)}),this):(this.config.silent||console.warn("refresh method can only be used on choices backed by a <select> element"),this)},t.prototype.removeChoice=function(e){var n=this._store.choices.find(function(i){return i.value===e});return n?(this._clearNotice(),this._store.dispatch(E0(n)),this._searcher.reset(),n.selected&&this.passedElement.triggerEvent($t.removeItem,this._getChoiceForOutput(n)),this):this},t.prototype.clearChoices=function(e,n){var i=this;return e===void 0&&(e=!0),n===void 0&&(n=!1),e&&(n?this.passedElement.element.replaceChildren(""):this.passedElement.element.querySelectorAll(":not([selected])").forEach(function(r){r.remove()})),this.itemList.element.replaceChildren(""),this.choiceList.element.replaceChildren(""),this._clearNotice(),this._store.withTxn(function(){var r=n?[]:i._store.items;i._store.reset(),r.forEach(function(s){i._store.dispatch(nc(s)),i._store.dispatch(ic(s))})}),this._searcher.reset(),this},t.prototype.clearStore=function(e){return e===void 0&&(e=!0),this.clearChoices(e,!0),this._stopSearch(),this._lastAddedChoiceId=0,this._lastAddedGroupId=0,this},t.prototype.clearInput=function(){var e=!this._isSelectOneElement;return this.input.clear(e),this._stopSearch(),this},t.prototype._validateConfig=function(){var e=this.config,n=R0(e,hc);n.length&&console.warn("Unknown config option(s) passed",n.join(", ")),e.allowHTML&&e.allowHtmlUserInput&&(e.addItems&&console.warn("Warning: allowHTML/allowHtmlUserInput/addItems all being true is strongly not recommended and may lead to XSS attacks"),e.addChoices&&console.warn("Warning: allowHTML/allowHtmlUserInput/addChoices all being true is strongly not recommended and may lead to XSS attacks"))},t.prototype._render=function(e){e===void 0&&(e={choices:!0,groups:!0,items:!0}),!this._store.inTxn()&&(this._isSelectElement&&(e.choices||e.groups)&&this._renderChoices(),e.items&&this._renderItems())},t.prototype._renderChoices=function(){var e=this;if(this._canAddItems()){var n=this,i=n.config,r=n._isSearching,s=this._store,o=s.activeGroups,l=s.activeChoices,a=0;if(r&&i.searchResultLimit>0?a=i.searchResultLimit:i.renderChoiceLimit>0&&(a=i.renderChoiceLimit),this._isSelectElement){var c=l.filter(function(m){return!m.element});c.length&&this.passedElement.addOptions(c)}var u=document.createDocumentFragment(),h=function(m){return m.filter(function(p){return!p.placeholder&&(r?!!p.rank:i.renderSelectedChoices||!p.selected)})},f=!1,d=function(m,p,g){r?m.sort(L0):i.shouldSort&&m.sort(i.sorter);var _=m.length;_=!p&&a&&_>a?a:_,_--,m.every(function(S,C){var w=S.choiceEl||e._templates.choice(i,S,i.itemSelectText,g);return S.choiceEl=w,u.appendChild(w),(r||!S.selected)&&(f=!0),C<_})};l.length&&(i.resetScrollPosition&&requestAnimationFrame(function(){return e.choiceList.scrollToTop()}),!this._hasNonChoicePlaceholder&&!r&&this._isSelectOneElement&&d(l.filter(function(m){return m.placeholder&&!m.group}),!1,void 0),o.length&&!r?(i.shouldSort&&o.sort(i.sorter),d(l.filter(function(m){return!m.placeholder&&!m.group}),!1,void 0),o.forEach(function(m){var p=h(m.choices);if(p.length){if(m.label){var g=m.groupEl||e._templates.choiceGroup(e.config,m);m.groupEl=g,g.remove(),u.appendChild(g)}d(p,!0,i.appendGroupInSearch&&r?m.label:void 0)}})):d(h(l),!1,void 0)),!f&&(r||!u.children.length||!i.renderSelectedChoices)&&(this._notice||(this._notice={text:oc(r?i.noResultsText:i.noChoicesText),type:r?Et.noResults:Et.noChoices}),u.replaceChildren("")),this._renderNotice(u),this.choiceList.element.replaceChildren(u),f&&this._highlightChoice()}},t.prototype._renderItems=function(){var e=this,n=this._store.items||[],i=this.itemList.element,r=this.config,s=document.createDocumentFragment(),o=function(h){return i.querySelector('[data-item][data-id="'.concat(h.id,'"]'))},l=function(h){var f=h.itemEl;f&&f.parentElement||(f=o(h)||e._templates.item(r,h,r.removeItemButton),h.itemEl=f,s.appendChild(f))};n.forEach(l);var a=!!s.childNodes.length;if(this._isSelectOneElement){var c=i.children.length;if(a||c>1){var u=i.querySelector(Si(r.classNames.placeholder));u&&u.remove()}else!a&&!c&&this._placeholderValue&&(a=!0,l(sn({selected:!0,value:"",label:this._placeholderValue,placeholder:!0},!1)))}a&&(i.append(s),r.shouldSortItems&&!this._isSelectOneElement&&(n.sort(r.sorter),n.forEach(function(h){var f=o(h);f&&(f.remove(),s.append(f))}),i.append(s))),this._isTextElement&&(this.passedElement.value=n.map(function(h){var f=h.value;return f}).join(r.delimiter))},t.prototype._displayNotice=function(e,n,i){i===void 0&&(i=!0);var r=this._notice;if(r&&(r.type===n&&r.text===e||r.type===Et.addChoice&&(n===Et.noResults||n===Et.noChoices))){i&&this.showDropdown(!0);return}this._clearNotice(),this._notice=e?{text:e,type:n}:void 0,this._renderNotice(),i&&e&&this.showDropdown(!0)},t.prototype._clearNotice=function(){if(this._notice){var e=this.choiceList.element.querySelector(Si(this.config.classNames.notice));e&&e.remove(),this._notice=void 0}},t.prototype._renderNotice=function(e){var n=this._notice;if(n){var i=this._templates.notice(this.config,n.text,n.type);e?e.append(i):this.choiceList.prepend(i)}},t.prototype._getChoiceForOutput=function(e,n){return{id:e.id,highlighted:e.highlighted,labelClass:e.labelClass,labelDescription:e.labelDescription,customProperties:e.customProperties,disabled:e.disabled,active:e.active,label:e.label,placeholder:e.placeholder,value:e.value,groupValue:e.group?e.group.label:void 0,element:e.element,keyCode:n}},t.prototype._triggerChange=function(e){e!=null&&this.passedElement.triggerEvent($t.change,{value:e})},t.prototype._handleButtonAction=function(e){var n=this,i=this._store.items;if(!(!i.length||!this.config.removeItems||!this.config.removeItemButton)){var r=e&&Ms(e.parentElement),s=r&&i.find(function(o){return o.id===r});s&&this._store.withTxn(function(){if(n._removeItem(s),n._triggerChange(s.value),n._isSelectOneElement&&!n._hasNonChoicePlaceholder){var o=(n.config.shouldSort?n._store.choices.reverse():n._store.choices).find(function(l){return l.placeholder});o&&(n._addItem(o),n.unhighlightAll(),o.value&&n._triggerChange(o.value))}})}},t.prototype._handleItemAction=function(e,n){var i=this;n===void 0&&(n=!1);var r=this._store.items;if(!(!r.length||!this.config.removeItems||this._isSelectOneElement)){var s=Ms(e);s&&(r.forEach(function(o){o.id===s&&!o.highlighted?i.highlightItem(o):!n&&o.highlighted&&i.unhighlightItem(o)}),this.input.focus())}},t.prototype._handleChoiceAction=function(e){var n=this,i=Ms(e),r=i&&this._store.getChoiceById(i);if(!r||r.disabled)return!1;var s=this.dropdown.isActive;if(!r.selected){if(!this._canAddItems())return!0;this._store.withTxn(function(){n._addItem(r,!0,!0),n.clearInput(),n.unhighlightAll()}),this._triggerChange(r.value)}return s&&this.config.closeDropdownOnSelect&&(this.hideDropdown(!0),this.containerOuter.element.focus()),!0},t.prototype._handleBackspace=function(e){var n=this.config;if(!(!n.removeItems||!e.length)){var i=e[e.length-1],r=e.some(function(s){return s.highlighted});n.editItems&&!r&&i?(this.input.value=i.value,this.input.setWidth(),this._removeItem(i),this._triggerChange(i.value)):(r||this.highlightItem(i,!1),this.removeHighlightedItems(!0))}},t.prototype._loadChoices=function(){var e,n=this,i=this.config;if(this._isTextElement){if(this._presetChoices=i.items.map(function(o){return sn(o,!1)}),this.passedElement.value){var r=this.passedElement.value.split(i.delimiter).map(function(o){return sn(o,!1,n.config.allowHtmlUserInput)});this._presetChoices=this._presetChoices.concat(r)}this._presetChoices.forEach(function(o){o.selected=!0})}else if(this._isSelectElement){this._presetChoices=i.choices.map(function(o){return sn(o,!0)});var s=this.passedElement.optionsAsChoices();s&&(e=this._presetChoices).push.apply(e,s)}},t.prototype._handleLoadingState=function(e){e===void 0&&(e=!0);var n=this.itemList.element;e?(this.disable(),this.containerOuter.addLoadingState(),this._isSelectOneElement?n.replaceChildren(this._templates.placeholder(this.config,this.config.loadingText)):this.input.placeholder=this.config.loadingText):(this.enable(),this.containerOuter.removeLoadingState(),this._isSelectOneElement?(n.replaceChildren(""),this._render()):this.input.placeholder=this._placeholderValue||"")},t.prototype._handleSearch=function(e){if(this.input.isFocussed)if(e!==null&&typeof e<"u"&&e.length>=this.config.searchFloor){var n=this.config.searchChoices?this._searchChoices(e):0;n!==null&&this.passedElement.triggerEvent($t.search,{value:e,resultCount:n})}else this._store.choices.some(function(i){return!i.active})&&this._stopSearch()},t.prototype._canAddItems=function(){var e=this.config,n=e.maxItemCount,i=e.maxItemText;return!e.singleModeForMultiSelect&&n>0&&n<=this._store.items.length?(this.choiceList.element.replaceChildren(""),this._notice=void 0,this._displayNotice(typeof i=="function"?i(n):i,Et.addChoice),!1):(this._notice&&this._notice.type===Et.addChoice&&this._clearNotice(),!0)},t.prototype._canCreateItem=function(e){var n=this.config,i=!0,r="";if(i&&typeof n.addItemFilter=="function"&&!n.addItemFilter(e)&&(i=!1,r=wi(n.customAddItemText,e)),i){var s=this._store.choices.find(function(o){return n.valueComparer(o.value,e)});if(s){if(this._isSelectElement)return this._displayNotice("",Et.addChoice),!1;n.duplicateItemsAllowed||(i=!1,r=wi(n.uniqueItemText,e))}}return i&&(r=wi(n.addItemText,e)),r&&this._displayNotice(r,Et.addChoice),i},t.prototype._searchChoices=function(e){var n=e.trim().replace(/\s{2,}/," ");if(!n.length||n===this._currentValue)return null;var i=this._searcher;i.isEmptyIndex()&&i.index(this._store.searchableChoices);var r=i.search(n);this._currentValue=n,this._highlightPosition=0,this._isSearching=!0;var s=this._notice,o=s&&s.type;return o!==Et.addChoice&&(r.length?this._clearNotice():this._displayNotice(oc(this.config.noResultsText),Et.noResults)),this._store.dispatch(C0(r)),r.length},t.prototype._stopSearch=function(){this._isSearching&&(this._currentValue="",this._isSearching=!1,this._clearNotice(),this._store.dispatch(I0(!0)),this.passedElement.triggerEvent($t.search,{value:"",resultCount:0}))},t.prototype._addEventListeners=function(){var e=this._docRoot,n=this.containerOuter.element,i=this.input.element;e.addEventListener("touchend",this._onTouchEnd,!0),n.addEventListener("keydown",this._onKeyDown,!0),n.addEventListener("mousedown",this._onMouseDown,!0),e.addEventListener("click",this._onClick,{passive:!0}),e.addEventListener("touchmove",this._onTouchMove,{passive:!0}),this.dropdown.element.addEventListener("mouseover",this._onMouseOver,{passive:!0}),this._isSelectOneElement&&(n.addEventListener("focus",this._onFocus,{passive:!0}),n.addEventListener("blur",this._onBlur,{passive:!0})),i.addEventListener("keyup",this._onKeyUp,{passive:!0}),i.addEventListener("input",this._onInput,{passive:!0}),i.addEventListener("focus",this._onFocus,{passive:!0}),i.addEventListener("blur",this._onBlur,{passive:!0}),i.form&&i.form.addEventListener("reset",this._onFormReset,{passive:!0}),this.input.addEventListeners()},t.prototype._removeEventListeners=function(){var e=this._docRoot,n=this.containerOuter.element,i=this.input.element;e.removeEventListener("touchend",this._onTouchEnd,!0),n.removeEventListener("keydown",this._onKeyDown,!0),n.removeEventListener("mousedown",this._onMouseDown,!0),e.removeEventListener("click",this._onClick),e.removeEventListener("touchmove",this._onTouchMove),this.dropdown.element.removeEventListener("mouseover",this._onMouseOver),this._isSelectOneElement&&(n.removeEventListener("focus",this._onFocus),n.removeEventListener("blur",this._onBlur)),i.removeEventListener("keyup",this._onKeyUp),i.removeEventListener("input",this._onInput),i.removeEventListener("focus",this._onFocus),i.removeEventListener("blur",this._onBlur),i.form&&i.form.removeEventListener("reset",this._onFormReset),this.input.removeEventListeners()},t.prototype._onKeyDown=function(e){var n=e.keyCode,i=this.dropdown.isActive,r=e.key.length===1||e.key.length===2&&e.key.charCodeAt(0)>=55296||e.key==="Unidentified";switch(!this._isTextElement&&!i&&n!==xt.ESC_KEY&&n!==xt.TAB_KEY&&n!==xt.SHIFT_KEY&&(this.showDropdown(),!this.input.isFocussed&&r&&(this.input.value+=e.key,e.key===" "&&e.preventDefault())),n){case xt.A_KEY:return this._onSelectKey(e,this.itemList.element.hasChildNodes());case xt.ENTER_KEY:return this._onEnterKey(e,i);case xt.ESC_KEY:return this._onEscapeKey(e,i);case xt.UP_KEY:case xt.PAGE_UP_KEY:case xt.DOWN_KEY:case xt.PAGE_DOWN_KEY:return this._onDirectionKey(e,i);case xt.DELETE_KEY:case xt.BACK_KEY:return this._onDeleteKey(e,this._store.items,this.input.isFocussed)}},t.prototype._onKeyUp=function(){this._canSearch=this.config.searchEnabled},t.prototype._onInput=function(){var e=this.input.value;if(!e){this._isTextElement?this.hideDropdown(!0):this._stopSearch();return}this._canAddItems()&&(this._canSearch&&this._handleSearch(e),this._canAddUserChoices&&(this._canCreateItem(e),this._isSelectElement&&(this._highlightPosition=0,this._highlightChoice())))},t.prototype._onSelectKey=function(e,n){if((e.ctrlKey||e.metaKey)&&n){this._canSearch=!1;var i=this.config.removeItems&&!this.input.value&&this.input.element===document.activeElement;i&&this.highlightAll()}},t.prototype._onEnterKey=function(e,n){var i=this,r=this.input.value,s=e.target;if(e.preventDefault(),s&&s.hasAttribute("data-button")){this._handleButtonAction(s);return}if(!n){(this._isSelectElement||this._notice)&&this.showDropdown();return}var o=this.dropdown.element.querySelector(Si(this.config.classNames.highlightedState));if(!(o&&this._handleChoiceAction(o))){if(!s||!r){this.hideDropdown(!0);return}if(this._canAddItems()){var l=!1;this._store.withTxn(function(){if(l=i._findAndSelectChoiceByValue(r,!0),!l){if(!i._canAddUserChoices||!i._canCreateItem(r))return;i._addChoice(sn(r,!1,i.config.allowHtmlUserInput),!0,!0),l=!0}i.clearInput(),i.unhighlightAll()}),l&&(this._triggerChange(r),this.config.closeDropdownOnSelect&&this.hideDropdown(!0))}}},t.prototype._onEscapeKey=function(e,n){n&&(e.stopPropagation(),this.hideDropdown(!0),this._stopSearch(),this.containerOuter.element.focus())},t.prototype._onDirectionKey=function(e,n){var i=e.keyCode;if(n||this._isSelectOneElement){this.showDropdown(),this._canSearch=!1;var r=i===xt.DOWN_KEY||i===xt.PAGE_DOWN_KEY?1:-1,s=e.metaKey||i===xt.PAGE_DOWN_KEY||i===xt.PAGE_UP_KEY,o=void 0;if(s)r>0?o=this.dropdown.element.querySelector("".concat(Ei,":last-of-type")):o=this.dropdown.element.querySelector(Ei);else{var l=this.dropdown.element.querySelector(Si(this.config.classNames.highlightedState));l?o=T0(l,Ei,r):o=this.dropdown.element.querySelector(Ei)}o&&(N0(o,this.choiceList.element,r)||this.choiceList.scrollToChildElement(o,r),this._highlightChoice(o)),e.preventDefault()}},t.prototype._onDeleteKey=function(e,n,i){!this._isSelectOneElement&&!e.target.value&&i&&(this._handleBackspace(n),e.preventDefault())},t.prototype._onTouchMove=function(){this._wasTap&&(this._wasTap=!1)},t.prototype._onTouchEnd=function(e){var n=(e||e.touches[0]).target,i=this._wasTap&&this.containerOuter.element.contains(n);if(i){var r=n===this.containerOuter.element||n===this.containerInner.element;r&&(this._isTextElement?this.input.focus():this._isSelectMultipleElement&&this.showDropdown()),e.stopPropagation()}this._wasTap=!0},t.prototype._onMouseDown=function(e){var n=e.target;if(n instanceof HTMLElement){if(qv&&this.choiceList.element.contains(n)){var i=this.choiceList.element.firstElementChild;this._isScrollingOnIe=this._direction==="ltr"?e.offsetX>=i.offsetWidth:e.offsetX<i.offsetLeft}if(n!==this.input.element){var r=n.closest("[data-button],[data-item],[data-choice]");r instanceof HTMLElement&&("button"in r.dataset?this._handleButtonAction(r):"item"in r.dataset?this._handleItemAction(r,e.shiftKey):"choice"in r.dataset&&this._handleChoiceAction(r)),e.preventDefault()}}},t.prototype._onMouseOver=function(e){var n=e.target;n instanceof HTMLElement&&"choice"in n.dataset&&this._highlightChoice(n)},t.prototype._onClick=function(e){var n=e.target,i=this.containerOuter,r=i.element.contains(n);r?!this.dropdown.isActive&&!i.isDisabled?this._isTextElement?document.activeElement!==this.input.element&&this.input.focus():(this.showDropdown(),i.element.focus()):this._isSelectOneElement&&n!==this.input.element&&!this.dropdown.element.contains(n)&&this.hideDropdown():(i.removeFocusState(),this.hideDropdown(!0),this.unhighlightAll())},t.prototype._onFocus=function(e){var n=e.target,i=this.containerOuter,r=n&&i.element.contains(n);if(r){var s=n===this.input.element;this._isTextElement?s&&i.addFocusState():this._isSelectMultipleElement?s&&(this.showDropdown(!0),i.addFocusState()):(i.addFocusState(),s&&this.showDropdown(!0))}},t.prototype._onBlur=function(e){var n=e.target,i=this.containerOuter,r=n&&i.element.contains(n);r&&!this._isScrollingOnIe?n===this.input.element?(i.removeFocusState(),this.hideDropdown(!0),(this._isTextElement||this._isSelectMultipleElement)&&this.unhighlightAll()):n===this.containerOuter.element&&(i.removeFocusState(),this._canSearch||this.hideDropdown(!0)):(this._isScrollingOnIe=!1,this.input.element.focus())},t.prototype._onFormReset=function(){var e=this;this._store.withTxn(function(){e.clearInput(),e.hideDropdown(),e.refresh(!1,!1,!0),e._initialItems.length&&e.setChoiceByValue(e._initialItems)})},t.prototype._highlightChoice=function(e){e===void 0&&(e=null);var n=Array.from(this.dropdown.element.querySelectorAll(Ei));if(n.length){var i=e,r=this.config.classNames.highlightedState,s=Array.from(this.dropdown.element.querySelectorAll(Si(r)));s.forEach(function(o){rn(o,r),o.setAttribute("aria-selected","false")}),i?this._highlightPosition=n.indexOf(i):(n.length>this._highlightPosition?i=n[this._highlightPosition]:i=n[n.length-1],i||(i=n[0])),Le(i,r),i.setAttribute("aria-selected","true"),this.passedElement.triggerEvent($t.highlightChoice,{el:i}),this.dropdown.isActive&&(this.input.setActiveDescendant(i.id),this.containerOuter.setActiveDescendant(i.id))}},t.prototype._addItem=function(e,n,i){if(n===void 0&&(n=!0),i===void 0&&(i=!1),!e.id)throw new TypeError("item.id must be set before _addItem is called for a choice/item");(this.config.singleModeForMultiSelect||this._isSelectOneElement)&&this.removeActiveItems(e.id),this._store.dispatch(ic(e)),n&&(this.passedElement.triggerEvent($t.addItem,this._getChoiceForOutput(e)),i&&this.passedElement.triggerEvent($t.choice,this._getChoiceForOutput(e)))},t.prototype._removeItem=function(e){if(e.id){this._store.dispatch(rc(e));var n=this._notice;n&&n.type===Et.noChoices&&this._clearNotice(),this.passedElement.triggerEvent($t.removeItem,this._getChoiceForOutput(e))}},t.prototype._addChoice=function(e,n,i){if(n===void 0&&(n=!0),i===void 0&&(i=!1),e.id)throw new TypeError("Can not re-add a choice which has already been added");var r=this.config;if(!(!r.duplicateItemsAllowed&&this._store.choices.find(function(l){return r.valueComparer(l.value,e.value)}))){this._lastAddedChoiceId++,e.id=this._lastAddedChoiceId,e.elementId="".concat(this._baseId,"-").concat(this._idNames.itemChoice,"-").concat(e.id);var s=r.prependValue,o=r.appendValue;s&&(e.value=s+e.value),o&&(e.value+=o.toString()),(s||o)&&e.element&&(e.element.value=e.value),this._clearNotice(),this._store.dispatch(nc(e)),e.selected&&this._addItem(e,n,i)}},t.prototype._addGroup=function(e,n){var i=this;if(n===void 0&&(n=!0),e.id)throw new TypeError("Can not re-add a group which has already been added");this._store.dispatch(x0(e)),e.choices&&(this._lastAddedGroupId++,e.id=this._lastAddedGroupId,e.choices.forEach(function(r){r.group=e,e.disabled&&(r.disabled=!0),i._addChoice(r,n)}))},t.prototype._createTemplates=function(){var e=this,n=this.config.callbackOnCreateTemplates,i={};typeof n=="function"&&(i=n.call(this,P0,vs,yr));var r={};Object.keys(this._templates).forEach(function(s){s in i?r[s]=i[s].bind(e):r[s]=e._templates[s].bind(e)}),this._templates=r},t.prototype._createElements=function(){var e=this._templates,n=this,i=n.config,r=n._isSelectOneElement,s=i.position,o=i.classNames,l=this._elementType;this.containerOuter=new ac({element:e.containerOuter(i,this._direction,this._isSelectElement,r,i.searchEnabled,l,i.labelId),classNames:o,type:l,position:s}),this.containerInner=new ac({element:e.containerInner(i),classNames:o,type:l,position:s}),this.input=new F0({element:e.input(i,this._placeholderValue),classNames:o,type:l,preventPaste:!i.paste}),this.choiceList=new cc({element:e.choiceList(i,r)}),this.itemList=new cc({element:e.itemList(i,r)}),this.dropdown=new j0({element:e.dropdown(i),classNames:o,type:l})},t.prototype._createStructure=function(){var e=this,n=e.containerInner,i=e.containerOuter,r=e.passedElement,s=this.dropdown.element;r.conceal(),n.wrap(r.element),i.wrap(n.element),this._isSelectOneElement?this.input.placeholder=this.config.searchPlaceholderValue||"":(this._placeholderValue&&(this.input.placeholder=this._placeholderValue),this.input.setWidth()),i.element.appendChild(n.element),i.element.appendChild(s),n.element.appendChild(this.itemList.element),s.appendChild(this.choiceList.element),this._isSelectOneElement?this.config.searchEnabled&&s.insertBefore(this.input.element,s.firstChild):n.element.appendChild(this.input.element),this._highlightPosition=0,this._isSearching=!1},t.prototype._initStore=function(){var e=this;this._store.subscribe(this._render).withTxn(function(){e._addPredefinedChoices(e._presetChoices,e._isSelectOneElement&&!e._hasNonChoicePlaceholder,!1)}),(!this._store.choices.length||this._isSelectOneElement&&this._hasNonChoicePlaceholder)&&this._render()},t.prototype._addPredefinedChoices=function(e,n,i){var r=this;if(n===void 0&&(n=!1),i===void 0&&(i=!0),n){var s=e.findIndex(function(o){return o.selected})===-1;s&&e.some(function(o){return o.disabled||"choices"in o?!1:(o.selected=!0,!0)})}e.forEach(function(o){"choices"in o?r._isSelectElement&&r._addGroup(o,i):r._addChoice(o,i)})},t.prototype._findAndSelectChoiceByValue=function(e,n){var i=this;n===void 0&&(n=!1);var r=this._store.choices.find(function(s){return i.config.valueComparer(s.value,e)});return r&&!r.disabled&&!r.selected?(this._addItem(r,!0,n),!0):!1},t.prototype._generatePlaceholderValue=function(){var e=this.config;if(!e.placeholder)return null;if(this._hasNonChoicePlaceholder)return e.placeholderValue;if(this._isSelectElement){var n=this.passedElement.placeholderOption;return n?n.text:null}return null},t.prototype._warnChoicesInitFailed=function(e){if(!this.config.silent)if(this.initialised){if(!this.initialisedOK)throw new TypeError("".concat(e," called for an element which has multiple instances of Choices initialised on it"))}else throw new TypeError("".concat(e," called on a non-initialised instance of Choices"))},t.version="11.1.0",t}();const Sb="",kb="";function Pc(t){let e,n;return{c(){e=b("label"),n=re(t[2]),v(e,"for",t[4])},m(i,r){z(i,e,r),y(e,n)},p(i,r){r&4&&Fe(n,i[2])},d(i){i&&$(e)}}}function Yv(t){let e;return{c(){e=b("select"),v(e,"id",t[4]),v(e,"name",t[4]),v(e,"aria-label",t[2]),v(e,"class","m-1")},m(n,i){z(n,e,i)},p(n,i){i&4&&v(e,"aria-label",n[2])},i:ie,o:ie,d(n){n&&$(e)}}}function Gv(t){let e,n,i,r=t[3].length&&Oc(t);return{c(){r&&r.c(),e=F(),n=b("select"),v(n,"id",t[4]),v(n,"name",t[4]),v(n,"aria-label",t[2]),v(n,"class","m-1"),n.multiple=!0},m(s,o){r&&r.m(s,o),z(s,e,o),z(s,n,o),i=!0},p(s,o){s[3].length?r?(r.p(s,o),o&8&&V(r,1)):(r=Oc(s),r.c(),V(r,1),r.m(e.parentNode,e)):r&&(et(),W(r,1,1,()=>{r=null}),tt()),(!i||o&4)&&v(n,"aria-label",s[2])},i(s){i||(V(r),i=!0)},o(s){W(r),i=!1},d(s){r&&r.d(s),s&&$(e),s&&$(n)}}}function Oc(t){let e,n,i=t[3].length+"",r,s,o,l;return o=new Vi({props:{targetHtmlId:t[5],tooltipText:`${t[3].length}
                                    ${q==="fr"&&t[3].length>1?"valeurs sélectionnées":q==="fr"&&t[3].length===1?"valeur sélectionnée":q==="en"&&t[3].length>1?"selected values":"selected value"}`}}),{c(){e=b("span"),n=b("span"),r=re(i),s=F(),_e(o.$$.fragment),v(n,"id",t[5]),v(n,"class","input-dropdown-count tag m-1 svelte-1epfuu8"),v(e,"class","is-relative")},m(a,c){z(a,e,c),y(e,n),y(n,r),y(e,s),me(o,e,null),l=!0},p(a,c){(!l||c&8)&&i!==(i=a[3].length+"")&&Fe(r,i);const u={};c&8&&(u.tooltipText=`${a[3].length}
                                    ${q==="fr"&&a[3].length>1?"valeurs sélectionnées":q==="fr"&&a[3].length===1?"valeur sélectionnée":q==="en"&&a[3].length>1?"selected values":"selected value"}`),o.$set(u)},i(a){l||(V(o.$$.fragment,a),l=!0)},o(a){W(o.$$.fragment,a),l=!1},d(a){a&&$(e),pe(o)}}}function Xv(t){let e,n,i,r,s,o,l,a=t[2]!==void 0&&Pc(t);const c=[Gv,Yv],u=[];function h(f,d){return f[0]?0:1}return r=h(t),s=u[r]=c[r](t),{c(){e=b("div"),a&&a.c(),n=F(),i=b("div"),s.c(),v(i,"class",o="input-dropdown-select "+(t[0]?"is-multiple":"is-single")+" "+(t[0]&&t[3].length?"is-flex is-justify-content-flex-start is-align-items-center":"")+" "+(t[1]?"light-display":"")+" svelte-1epfuu8"),v(e,"class","input-dropdown-select-wrapper")},m(f,d){z(f,e,d),a&&a.m(e,null),y(e,n),y(e,i),u[r].m(i,null),l=!0},p(f,[d]){f[2]!==void 0?a?a.p(f,d):(a=Pc(f),a.c(),a.m(e,n)):a&&(a.d(1),a=null);let m=r;r=h(f),r===m?u[r].p(f,d):(et(),W(u[m],1,1,()=>{u[m]=null}),tt(),s=u[r],s?s.p(f,d):(s=u[r]=c[r](f),s.c()),V(s,1),s.m(i,null)),(!l||d&11&&o!==(o="input-dropdown-select "+(f[0]?"is-multiple":"is-single")+" "+(f[0]&&f[3].length?"is-flex is-justify-content-flex-start is-align-items-center":"")+" "+(f[1]?"light-display":"")+" svelte-1epfuu8"))&&v(i,"class",o)},i(f){l||(V(s),l=!0)},o(f){W(s),l=!1},d(f){f&&$(e),a&&a.d(),u[r].d()}}}const Jv=250;function Qv(t,e,n){let i,r,{choicesItems:s}=e,{start:o=[]}=e,{multiple:l}=e,{searchable:a=!0}=e,{lightDisplay:c=!1}=e,{placeholder:u=q==="fr"?"Sélectionner une valeur":"Select a value"}=e,{title:h=void 0}=e,{selectAll:f=!!l}=e;const d=`input-dropdown-select-${window.crypto.randomUUID()}`,m=`input-dropdown-counter-${window.crypto.randomUUID()}`,p=`select-all-${window.crypto.randomUUID()}`,g=`unselect-all-${window.crypto.randomUUID()}`,_=Oi();let S;const C=$i();C.setCompareFn(Lr);const w=Ft("resetTrigger")||void 0;w==null||w.subscribe(()=>j(S,s,o,f));const k=()=>{n(11,r=!0),setTimeout(()=>n(11,r=!1),Jv)},T=(P,X)=>{X||(C.set(P),C.same()||_("updateValues",i))},N=P=>`<span class="iconify" data-icon=${P}/>`,E=(P,X)=>P!=null&&X!=null&&P.length&&X.length?`<span class="dropdown-prefix-wrapper">${X==="iconify"?N(P):P}</span>`:"",M=(P,X)=>X?[{value:p,label:`<b>${q==="fr"?"Tout sélectionner":"Select all"}</b>`},{value:g,label:`<b>${q==="fr"?"Tout retirer":"Remove all"}</b>`},...P]:P,O=(P,X)=>M(P,X).map(U=>(U.id=`dropdown-choice-${window.crypto.randomUUID()}`,U.label=`<span>
                ${E(U.prefix||"",U.prefixType||"")}
                <span class="dropdown-prefix-text">${U.label}</span>
            </span>`,U));function L(P,X,U){return P=structuredClone(P),X=structuredClone(X),P=O(P,U).map(K=>X.includes(K.value)?{...K,selected:!0}:{...K,selected:!1}),n(3,i=X),P}function j(P,X,U,K){P&&(X=L(X,U,K),P.clearStore().setChoices(X))}const R=(P,X,U,K,Z,ae)=>(K=structuredClone(K),U=structuredClone(U),P.detail.value===Z?(k(),U=U.map(ce=>[Z,ae].includes(ce.value)?{...ce,selected:!1}:{...ce,selected:!0}),X.removeActiveItems().clearChoices(!0,!0).setValue(U).hideDropdown(),K=[...new Set(U.filter(ce=>ce.selected===!0).map(ce=>ce.value))]):P.detail.value===ae?(X.removeActiveItems().hideDropdown(),K=[]):K=l===!0?[...K,P.detail.value]:[P.detail.value],[...new Set(K)]),x=(P,X)=>structuredClone(X).filter(U=>U!==P.detail.value);function H(P,X){const U=document.getElementById(d);S=new Wv(U,{items:[],choices:P,addChoices:!1,addItems:!1,removeItems:!0,removeItemButton:!0,searchEnabled:a,allowHTML:!0,shouldSort:!X,sorter:(K,Z)=>K.label.localeCompare(Z.label),placeholderValue:u,classNames:{item:["choices__item","dropdown-item"]},loadingText:q==="fr"?"Chargement...":"Loading...",noResultsText:q==="fr"?"Pas de résultats":"No results found",noChoicesText:q==="fr"?"Pas de choix pour faire la sélection":"No choices to choose from",itemSelectText:q==="fr"?"Cliquer pour sélectionner":"Press to select",uniqueItemText:q==="fr"?"Seules des valeurs uniques peuvent être ajoutées":"Only unique values can be added",customAddItemText:q==="fr"?"Les valeurs ne répondent pas aux conditions attendues":"Only values matching specific conditions can be added",removeItemIconText:q==="fr"?"Retirer l'item":"Remove item",addItemText:K=>q==="fr"?`Cliquer sur Entrer pour ajouter <b>${K}</b>`:`Press Enter to add <b>"${K}"</b>`,removeItemLabelText:K=>q==="fr"?`Retirer l'item: ${K}`:`Remove item: ${K}`,maxItemText:K=>q==="fr"?`Seulement ${K} items peuvent être ajoutées`:`Only ${K} items can be added`}),U.addEventListener("addItem",K=>{n(3,i=R(K,S,P,i,p,g))}),U.addEventListener("removeItem",K=>{n(3,i=x(K,i))})}return zn(()=>{const P=L(s,o,f);H(P,f)}),jn(()=>{S.destroy(),S=void 0}),t.$$set=P=>{"choicesItems"in P&&n(6,s=P.choicesItems),"start"in P&&n(7,o=P.start),"multiple"in P&&n(0,l=P.multiple),"searchable"in P&&n(8,a=P.searchable),"lightDisplay"in P&&n(1,c=P.lightDisplay),"placeholder"in P&&n(9,u=P.placeholder),"title"in P&&n(2,h=P.title),"selectAll"in P&&n(10,f=P.selectAll)},t.$$.update=()=>{t.$$.dirty&2056&&T(i,r)},n(3,i=[]),n(11,r=!1),[l,c,h,i,d,m,s,o,a,u,f,r]}class Zv extends Ve{constructor(e){super(),He(this,e,Qv,Xv,je,{choicesItems:6,start:7,multiple:0,searchable:8,lightDisplay:1,placeholder:9,title:2,selectAll:10})}}const Eb="";function ey(t){let e,n,i,r,s,o,l,a,c,u,h,f,d,m,p,g,_,S,C,w,k,T,N,E,M,O,L,j,R,x,H,P,X,U,K,Z,ae,ce,de;return c=new xn({props:{minVal:0,maxVal:1,start:t[5],emitOnUpdate:!0,title:q==="fr"?"Opacité":"Opacity"}}),c.$on("updateSlider",t[9]),f=new xn({props:{minVal:0,maxVal:360,start:t[6],step:1,emitOnUpdate:!0,title:"Rotation"}}),f.$on("updateSlider",t[10]),p=new xn({props:{minVal:0,maxVal:200,step:1,start:t[7],emitOnUpdate:!0,title:q==="fr"?"Redimensionner":"Scale"}}),p.$on("updateSlider",t[11]),S=new xn({props:{minVal:-100,maxVal:100,step:1,start:t[8][0],emitOnUpdate:!0,title:q==="fr"?"Translation horizontale":"Horizontal translate"}}),S.$on("updateSlider",t[12]),k=new xn({props:{minVal:-100,maxVal:100,step:1,start:t[8][1],emitOnUpdate:!0,title:q==="fr"?"Translation verticale":"Vertical translate"}}),k.$on("updateSlider",t[13]),E=new Zv({props:{choicesItems:t[4],start:[],lightDisplay:!0,placeholder:q==="fr"?"Sélectionner":"Select",title:q==="fr"?"Basculer":"Flip"}}),E.$on("updateValues",t[14]),{c(){e=b("div"),n=b("div"),i=b("div"),r=b("div"),s=b("strong"),s.textContent=`${q==="en"?"Query image transformation":"Modification de l'image requête"}`,o=F(),l=b("div"),a=b("div"),_e(c.$$.fragment),u=F(),h=b("div"),_e(f.$$.fragment),d=F(),m=b("div"),_e(p.$$.fragment),g=F(),_=b("div"),_e(S.$$.fragment),C=F(),w=b("div"),_e(k.$$.fragment),T=F(),N=b("div"),_e(E.$$.fragment),M=F(),O=b("div"),L=b("button"),L.textContent=`${q==="fr"?"Réinitialiser":"Reset"}`,j=F(),R=b("div"),x=b("img"),X=F(),U=b("img"),v(r,"class","toolbar-title mt-0 mb-2 svelte-nzei31"),v(a,"class"," svelte-nzei31"),v(h,"class"," svelte-nzei31"),v(m,"class"," svelte-nzei31"),v(_,"class"," svelte-nzei31"),v(w,"class"," svelte-nzei31"),v(N,"class"," svelte-nzei31"),v(L,"class","button is-link"),v(O,"class","mt-2 is-flex is-flex-direction-column is-justify-content-center is-align-items-flex-end svelte-nzei31"),v(l,"class","toolbar-controls is-flex is-flex-direction-column is-align-items-start is-justify-content-center svelte-nzei31"),v(i,"class","toolbar svelte-nzei31"),v(n,"class","toolbar-wrapper is-flex is-flex-direction-column is-justify-content-center is-align-items-center svelte-nzei31"),v(x,"class","compare-img svelte-nzei31"),At(x.src,H=t[0].queryImage.href)||v(x,"src",H),v(x,"alt",P=t[0].queryImage.title),v(U,"class","main-img svelte-nzei31"),At(U.src,K=t[0].similarityImage.href)||v(U,"src",K),v(U,"alt",Z=t[0].similarityImage.title),Ye(U,"overlay-reset",t[2]),We(U,"opacity",t[1]),We(U,"transform",t[3]),v(R,"class","overlay-wrapper svelte-nzei31"),v(e,"class","similarity-overlay-wrapper svelte-nzei31")},m(fe,De){z(fe,e,De),y(e,n),y(n,i),y(i,r),y(r,s),y(i,o),y(i,l),y(l,a),me(c,a,null),y(l,u),y(l,h),me(f,h,null),y(l,d),y(l,m),me(p,m,null),y(l,g),y(l,_),me(S,_,null),y(l,C),y(l,w),me(k,w,null),y(l,T),y(l,N),me(E,N,null),y(l,M),y(l,O),y(O,L),y(e,j),y(e,R),y(R,x),y(R,X),y(R,U),ae=!0,ce||(de=be(L,"click",t[15]),ce=!0)},p(fe,[De]){(!ae||De&1&&!At(x.src,H=fe[0].queryImage.href))&&v(x,"src",H),(!ae||De&1&&P!==(P=fe[0].queryImage.title))&&v(x,"alt",P),(!ae||De&1&&!At(U.src,K=fe[0].similarityImage.href))&&v(U,"src",K),(!ae||De&1&&Z!==(Z=fe[0].similarityImage.title))&&v(U,"alt",Z),(!ae||De&4)&&Ye(U,"overlay-reset",fe[2]),De&2&&We(U,"opacity",fe[1]),De&8&&We(U,"transform",fe[3])},i(fe){ae||(V(c.$$.fragment,fe),V(f.$$.fragment,fe),V(p.$$.fragment,fe),V(S.$$.fragment,fe),V(k.$$.fragment,fe),V(E.$$.fragment,fe),ae=!0)},o(fe){W(c.$$.fragment,fe),W(f.$$.fragment,fe),W(p.$$.fragment,fe),W(S.$$.fragment,fe),W(k.$$.fragment,fe),W(E.$$.fragment,fe),ae=!1},d(fe){fe&&$(e),pe(c),pe(f),pe(p),pe(S),pe(k),pe(E),ce=!1,de()}}}function ty(t,e,n){let i,{imgData:r}=e;const s=[{value:"h",label:q==="fr"?"Basculer horizontalement":"Flip horizontally"},{value:"v",label:q==="fr"?"Basculer verticalement":"Flip vertically"},{value:"hv",label:q==="fr"?"Basculer horizontalement et verticalement":"Flip horizontally and vertically"}];let o=.5;const l=o;let a=0;const c=a;let u=100;const h=u;let f=[1,1];const d=structuredClone(f);let m=[0,0];const p=structuredClone(m);let g=!1;const _=Pe(window.crypto.randomUUID());Fn("resetTrigger",_);const S=M=>n(1,o=M.detail),C=M=>n(16,a=M.detail),w=M=>n(17,u=M.detail),k=M=>n(19,m=[M.detail,m[1]]),T=M=>n(19,m=[m[0],M.detail]),N=M=>{let O=M.detail[0];n(18,f=O==="hv"?[-1,-1]:O==="h"?[-1,1]:O==="v"?[1,-1]:[1,1])},E=()=>{n(1,o=l),n(16,a=c),n(17,u=h),n(18,f=d),n(19,m=p),_.set(window.crypto.randomUUID()),n(2,g=!0),setTimeout(()=>n(2,g=!1),1e3)};return t.$$set=M=>{"imgData"in M&&n(0,r=M.imgData)},t.$$.update=()=>{t.$$.dirty&983040&&n(3,i=`translate(${m[0]-50}%, ${m[1]}%)
                        rotate(${a}deg)
                        scale(${f.map(M=>M*(u/100)).join()})`)},[r,o,g,i,s,l,c,h,p,S,C,w,k,T,N,E,a,u,f,m]}class ny extends Ve{constructor(e){super(),He(this,e,ty,ey,je,{imgData:0})}}function iy(){const t=`${window.location.origin}${window.location.pathname}`,e=25,n=window.location.pathname.match(/\d+/g).join("-"),i={[n]:{}},r=[2,6],s=Pe(1),o=Pe({}),l=Pe(JSON.parse(localStorage.getItem("selectedRegions"))||i);l.subscribe(j=>localStorage.setItem("selectedRegions",JSON.stringify(j)));const a=Pe(JSON.parse(localStorage.getItem("excludedCategories"))||[]);a.subscribe(j=>localStorage.setItem("excludedCategories",JSON.stringify(j)));const c=Pe(JSON.parse(localStorage.getItem("similarityScoreCutoff"))||void 0);c.subscribe(j=>{j!=null&&localStorage.setItem("similarityScoreCutoff",JSON.stringify(j))});const u=Pe(JSON.parse(localStorage.getItem("propagateRecursionDepth"))||r[1]);u.subscribe(j=>localStorage.setItem("propagateRecursionDepth",JSON.stringify(j)));const h=Pe(JSON.parse(localStorage.getItem("propagateFilterByRegions"))||!1);h.subscribe(j=>localStorage.setItem("propagateFilterByRegions",JSON.stringify(j)));const f=ut([u,h],([j,R])=>({propagateRecursionDepth:j,propagateFilterByRegions:R})),d=ut([a,l,c],([j,R,x])=>({excludedCategories:j,regions:R,similarityScoreCutoff:x})),m=ut([f,d],([j,R])=>({propagate:j,similarity:R})),p=Pe([]),g=Pe([]);async function _(){const j=async()=>{const H=await(await fetch(`${t}compared-regions`)).json();o.set(H),l.update(P=>{let X=P[n]||{};if(Object.keys(X).length){let U=Object.keys(X).filter(K=>Object.keys(H).includes(K)).reduce((K,Z)=>(K[Z]=X[Z],K),{});P[n]=U}return P})},R=async()=>{const H=await(await fetch(`${t}query-images`)).json();H.length>0&&(p.set(H),O(N()))};oi.set(!0);try{await Promise.all([j(),R()])}catch(x){console.error("Error:",x),_u.set(x.message)}finally{oi.set(!1)}}function S(j){localStorage.setItem("selectedRegions",JSON.stringify(j))}function C(j){l.update(R=>{const x={...R};return delete x[n][j],S(x),x})}function w(j){l.update(R=>{const x={...R,[n]:{...R[n]||{},[j.ref]:j}};return S(x),x})}const k=ut(l,j=>R=>{var x;return(x=j[n])==null?void 0:x.hasOwnProperty(R)});function T(j){const R=yt(o),x=Object.keys(R).filter(H=>H.startsWith(j));return x.length!==1?{title:"Error"}:R[x[0]]}const N=()=>Pr(s,"sp"),E=ut([s,p],([j,R])=>(async()=>M(j,R))());function M(j,R){const x=(j-1)*e,H=x+e,P=R.slice(x,H);return g.set(P),P}function O(j){Or(j,s,"sp")}function L(j){o.update(R=>({...R,[j.ref]:j}))}return{currentPage:s,comparedRegions:o,excludedCategories:a,qImgs:p,pageQImgs:g,selectedRegions:l,propagateRecursionDepth:u,propagateFilterByRegions:h,similarityToolbarParams:m,propagateParams:f,similarityScoreCutoff:c,allowedPropagateDepthRange:r,fetchSimilarity:_,setPageQImgs:E,getRegionsInfo:T,handlePageUpdate:O,unselect:C,select:w,addComparedRegions:L,isSelected:k,pageLength:e}}const pn=iy(),{getRegionsInfo:ry}=pn;async function Lc(t,e,n,i,r,s,o=!1,l=!0){const a=()=>l?`<b>${!isNaN(parseFloat(n))&&e===1?`Score: ${n}`:e===2&&q==="en"?"Manual similarity":e===2&&q==="fr"?"Correspondance manuelle":e===3&&q==="en"?"Propagated match":"Correspondance propagée"}</b>`:"",c=u=>`${u}<br>
        Page ${parseInt(i)}<br>
        ${a()}`;return o===!0?fetch(`${r}${s}get_regions_title/${t}`).then(u=>u.json()).then(u=>c(u.title)).catch(u=>(console.error("similarity.utils.getDesc()",u),c(q==="fr"?"Titre inconnu":"Unknown title"))):Promise.resolve(c(ry(t).title))}function Dc(t,e,n){const i=t.slice();return i[16]=e[n],i}function Rc(t){let e,n,i=t[16]==="queryImage"&&q==="fr"?"Image requête":t[16]==="similarityImage"&&q==="fr"?"Similarité":t[16]==="queryImage"&&q==="en"?"Query image":"Similarity",r,s,o,l,a;return o=new ei({props:{item:t[0][t[16]],descPromise:t[1][t[16]],height:"full"}}),{c(){e=b("div"),n=b("span"),r=re(i),s=F(),_e(o.$$.fragment),l=F(),v(e,"class","img-legend-wrapper column is-flex is-flex-direction-column is-justify-content-center is-align-items-center")},m(c,u){z(c,e,u),y(e,n),y(n,r),y(e,s),me(o,e,null),y(e,l),a=!0},p(c,u){const h={};u&1&&(h.item=c[0][c[16]]),o.$set(h)},i(c){a||(V(o.$$.fragment,c),a=!0)},o(c){W(o.$$.fragment,c),a=!1},d(c){c&&$(e),pe(o)}}}function sy(t){let e,n,i=["queryImage","similarityImage"],r=[];for(let o=0;o<2;o+=1)r[o]=Rc(Dc(t,i,o));const s=o=>W(r[o],1,1,()=>{r[o]=null});return{c(){e=b("div");for(let o=0;o<2;o+=1)r[o].c();v(e,"class","side-by-side columns")},m(o,l){z(o,e,l);for(let a=0;a<2;a+=1)r[a]&&r[a].m(e,null);n=!0},p(o,[l]){if(l&3){i=["queryImage","similarityImage"];let a;for(a=0;a<2;a+=1){const c=Dc(o,i,a);r[a]?(r[a].p(c,l),V(r[a],1)):(r[a]=Rc(c),r[a].c(),V(r[a],1),r[a].m(e,null))}for(et(),a=2;a<2;a+=1)s(a);tt()}},i(o){if(!n){for(let l=0;l<2;l+=1)V(r[l]);n=!0}},o(o){r=r.filter(Boolean);for(let l=0;l<2;l+=1)W(r[l]);n=!1},d(o){o&&$(e),St(r,o)}}}function oy(t,e,n){let{imgData:i}=e;const r=Ft("similarityPair"),s=new URL(window.location.href),o=s.origin,l=s.pathname,[a,c,u,h]=r.qImg.split(".")[0].split("_"),[f,d,m,p]=r.sImg.split(".")[0].split("_"),g=`${a}_${c}`,_=`${f}_${d}`,S={queryImage:Lc(g,r.similarityType,r.score,u,o,l,!0,!1),similarityImage:Lc(_,r.similarityType,r.score,m,o,l,!0,!0)};return t.$$set=C=>{"imgData"in C&&n(0,i=C.imgData)},[i,S]}class ly extends Ve{constructor(e){super(),He(this,e,oy,sy,je,{imgData:0})}}const Cb="";function ay(t){let e,n;return e=new ly({props:{imgData:t[2]}}),{c(){_e(e.$$.fragment)},m(i,r){me(e,i,r),n=!0},p:ie,i(i){n||(V(e.$$.fragment,i),n=!0)},o(i){W(e.$$.fragment,i),n=!1},d(i){pe(e,i)}}}function cy(t){let e,n;return e=new ny({props:{imgData:t[1]}}),{c(){_e(e.$$.fragment)},m(i,r){me(e,i,r),n=!0},p:ie,i(i){n||(V(e.$$.fragment,i),n=!0)},o(i){W(e.$$.fragment,i),n=!1},d(i){pe(e,i)}}}function uy(t){let e,n,i,r,s,o,l,a,c;const u=[cy,ay],h=[];function f(d,m){return d[0]?0:1}return i=f(t),r=h[i]=u[i](t),a=new w0({props:{start:!1,buttonDisplay:!0,toggleLabel:q==="en"?"Overlay view":"Vue superposée"}}),a.$on("updateChecked",t[3]),{c(){e=b("div"),n=b("div"),r.c(),o=F(),l=b("div"),_e(a.$$.fragment),v(n,"class",s="modal-similarity-images "+(t[0]?"overlay-wrapper":"side-by-side-wrapper")+" svelte-1qvtan5"),v(e,"class","modal-similarity svelte-1qvtan5")},m(d,m){z(d,e,m),y(e,n),h[i].m(n,null),y(e,o),y(e,l),me(a,l,null),c=!0},p(d,[m]){let p=i;i=f(d),i===p?h[i].p(d,m):(et(),W(h[p],1,1,()=>{h[p]=null}),tt(),r=h[i],r?r.p(d,m):(r=h[i]=u[i](d),r.c()),V(r,1),r.m(n,null)),(!c||m&1&&s!==(s="modal-similarity-images "+(d[0]?"overlay-wrapper":"side-by-side-wrapper")+" svelte-1qvtan5"))&&v(n,"class",s)},i(d){c||(V(r),V(a.$$.fragment,d),c=!0)},o(d){W(r),W(a.$$.fragment,d),c=!1},d(d){d&&$(e),h[i].d(),pe(a)}}}function fy(t,e,n){let{mainImgItem:i}=e,{compareImgItem:r}=e;const s={similarityImage:{href:Yt(i.img,i.img.split("_").pop()),title:a(i.title)},queryImage:{href:Yt(r.img,r.img.split("_").pop()),title:a(r.title)}},o={similarityImage:i,queryImage:r};let l=!1;function a(u){return q==="fr"?`Vue principale de la région ${u}`:`Main view of region ${u}`}const c=()=>n(0,l=!l);return t.$$set=u=>{"mainImgItem"in u&&n(4,i=u.mainImgItem),"compareImgItem"in u&&n(5,r=u.compareImgItem)},[l,s,o,c,i,r]}class dy extends Ve{constructor(e){super(),He(this,e,fy,uy,je,{mainImgItem:4,compareImgItem:5})}}const hy=Object.freeze(Object.defineProperty({__proto__:null,default:dy},Symbol.toStringTag,{value:"Module"})),$c=(t,e,n,i)=>({id:t,img:t,title:`Canvas ${i} - ${n} - ${q==="en"?"Witness":"Témoin"} #${Nr(e)}`,xywh:n.split(",").map(Number),canvas:i,ref:t.replace(".jpg",""),type:mu});function my(t){let e,n,i,r,s,o,l,a,c,u,h;return n=new Wn({props:{category:1,isSelected:t[0]===1,toggle:t[4],padding:"pl-3 pr-2"}}),r=new Wn({props:{category:2,isSelected:t[0]===2,toggle:t[4]}}),o=new Wn({props:{category:3,isSelected:t[0]===3,toggle:t[4]}}),a=new Wn({props:{category:4,isSelected:t[0]===4,toggle:t[4]}}),u=new Wn({props:{category:5,isSelected:t[0]===5,toggle:t[4],padding:"pl-2 pr-3"}}),{c(){e=b("div"),_e(n.$$.fragment),i=F(),_e(r.$$.fragment),s=F(),_e(o.$$.fragment),l=F(),_e(a.$$.fragment),c=F(),_e(u.$$.fragment),v(e,"class","tags has-addons is-dark is-center")},m(f,d){z(f,e,d),me(n,e,null),y(e,i),me(r,e,null),y(e,s),me(o,e,null),y(e,l),me(a,e,null),y(e,c),me(u,e,null),h=!0},p(f,d){const m={};d&1&&(m.isSelected=f[0]===1),n.$set(m);const p={};d&1&&(p.isSelected=f[0]===2),r.$set(p);const g={};d&1&&(g.isSelected=f[0]===3),o.$set(g);const _={};d&1&&(_.isSelected=f[0]===4),a.$set(_);const S={};d&1&&(S.isSelected=f[0]===5),u.$set(S)},i(f){h||(V(n.$$.fragment,f),V(r.$$.fragment,f),V(o.$$.fragment,f),V(a.$$.fragment,f),V(u.$$.fragment,f),h=!0)},o(f){W(n.$$.fragment,f),W(r.$$.fragment,f),W(o.$$.fragment,f),W(a.$$.fragment,f),W(u.$$.fragment,f),h=!1},d(f){f&&$(e),pe(n),pe(r),pe(o),pe(a),pe(u)}}}function py(t){let e,n,i,r;n=new ei({props:{item:t[3],size:256,selectable:!1,isSquare:!1}});let s=!t[2]&&my(t);return{c(){e=b("div"),_e(n.$$.fragment),i=F(),s&&s.c()},m(o,l){z(o,e,l),me(n,e,null),y(e,i),s&&s.m(e,null),r=!0},p(o,[l]){o[2]||s.p(o,l)},i(o){r||(V(n.$$.fragment,o),V(s),r=!0)},o(o){W(n.$$.fragment,o),W(s),r=!1},d(o){o&&$(e),pe(n),s&&s.d()}}}function gy(t,e,n){let i,r,s;const{comparedRegions:o}=pn;Me(t,o,R=>n(15,s=R));const l=new URL(window.location.href),a=l.origin;l.pathname;let{qImg:c}=e,{sImg:u}=e,{qRegions:h}=e,{sRegions:f}=e,{score:d=0}=e,{category:m=null}=e,{users:p=[]}=e,{isManual:g}=e,{similarityType:_}=e;const S=Ft("isInModal")||!1,[C,w,k,T]=u.split(".")[0].split("_"),E=(()=>{let R=$c(u,C,T,k);const x=s[`${C}_${w}_anno${f}`]||{title:R.title};return R.title=`${bu(x.title.replace(/^[^|]+/,""))}<br/>Page ${yu(k)}<br/><b>Score: ${d}</b>`,R})();Fn("similarityPair",{qImg:c,sImg:u,qRegions:h,sRegions:f,score:d,category:m,users:p,isManual:g,similarityType:_});function M(R){R=R.slice();let x=R.indexOf(Number(Ar));return r&&x===-1?R.push(Number(Ar)):!r&&x!==-1&&R.splice(x,1),R}const O=()=>({img_1:c,img_2:u,regions_id_1:h,regions_id_2:f,score:d,category:i,category_x:M(p),similarity_type:_});function L(R){R===5?r=!r:n(0,i=i===R?null:R)}async function j(R){L(R);try{(await fetch(`${a}/${Xt}/save-category`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":bn},body:JSON.stringify(O())})).ok||(console.error("Error: Network response was not ok"),L(R))}catch(x){console.error("Error:",x),L(R)}}return t.$$set=R=>{"qImg"in R&&n(5,c=R.qImg),"sImg"in R&&n(6,u=R.sImg),"qRegions"in R&&n(7,h=R.qRegions),"sRegions"in R&&n(8,f=R.sRegions),"score"in R&&n(9,d=R.score),"category"in R&&n(10,m=R.category),"users"in R&&n(11,p=R.users),"isManual"in R&&n(12,g=R.isManual),"similarityType"in R&&n(13,_=R.similarityType)},t.$$.update=()=>{t.$$.dirty&1024&&n(0,i=m),t.$$.dirty&2048&&(r=p.includes(Number(Ar))||!1)},[i,o,S,E,j,c,u,h,f,d,m,p,g,_]}class _y extends Ve{constructor(e){super(),He(this,e,gy,py,je,{qImg:5,sImg:6,qRegions:7,sRegions:8,score:9,category:10,users:11,isManual:12,similarityType:13})}}function zc(t,e,n){const i=t.slice();return i[22]=e[n].uuid,i[23]=e[n].data[0],i[24]=e[n].data[1],i[25]=e[n].data[2],i[26]=e[n].data[3],i[27]=e[n].data[4],i[28]=e[n].data[5],i[29]=e[n].data[6],i[30]=e[n].data[7],i[31]=e[n].data[8],i}function vy(t){let e,n=q==="en"?`Error when retrieving similar regions: ${t[2]}`:`Erreur de recupération des régions similaires: ${t[2]}`,i;return{c(){e=b("div"),i=re(n),v(e,"class","faded is-center")},m(r,s){z(r,e,s),y(e,i)},p(r,s){s[0]&4&&n!==(n=q==="en"?`Error when retrieving similar regions: ${r[2]}`:`Erreur de recupération des régions similaires: ${r[2]}`)&&Fe(i,n)},i:ie,o:ie,d(r){r&&$(e)}}}function yy(t){let e,n,i=t[4].length+"",r,s,o=t[11](t[10],t[4].length)+"",l,a,c,u=[],h=new Map,f,d=t[4];const m=g=>g[22];for(let g=0;g<d.length;g+=1){let _=zc(t,d,g),S=m(_);h.set(S,u[g]=Fc(S,_))}let p=null;return d.length||(p=jc(t)),{c(){e=b("div"),n=b("span"),r=re(i),s=F(),l=re(o),a=F(),c=b("div");for(let g=0;g<u.length;g+=1)u[g].c();p&&p.c(),v(n,"class","m-2"),v(c,"class","m-2 is-gap-2"),Ye(c,"grid",t[4].length>0)},m(g,_){z(g,e,_),y(e,n),y(n,r),y(n,s),y(n,l),y(e,a),y(e,c);for(let S=0;S<u.length;S+=1)u[S]&&u[S].m(c,null);p&&p.m(c,null),f=!0},p(g,_){(!f||_[0]&16)&&i!==(i=g[4].length+"")&&Fe(r,i),(!f||_[0]&16)&&o!==(o=g[11](g[10],g[4].length)+"")&&Fe(l,o),_[0]&49&&(d=g[4],et(),u=Di(u,_,m,1,g,d,h,c,Mr,Fc,null,zc),tt(),!d.length&&p?p.p(g,_):d.length?p&&(p.d(1),p=null):(p=jc(g),p.c(),p.m(c,null))),(!f||_[0]&16)&&Ye(c,"grid",g[4].length>0)},i(g){if(!f){for(let _=0;_<d.length;_+=1)V(u[_]);f=!0}},o(g){for(let _=0;_<u.length;_+=1)W(u[_]);f=!1},d(g){g&&$(e);for(let _=0;_<u.length;_+=1)u[_].d();p&&p.d()}}}function by(t){let e;return{c(){e=b("div"),e.textContent=`${q==="en"&&!t[10]?"Retrieving similar regions...":q==="fr"&&!t[10]?"Récupération des régions similaires...":q==="en"&&t[10]?"Retrieving propagated regions...":"Récupération de similarités propagées..."}`,v(e,"class","faded is-center")},m(n,i){z(n,e,i)},p:ie,i:ie,o:ie,d(n){n&&$(e)}}}function jc(t){let e;function n(s,o){return s[5]?Sy:wy}let i=n(t),r=i(t);return{c(){r.c(),e=Ct()},m(s,o){r.m(s,o),z(s,e,o)},p(s,o){i===(i=n(s))&&r?r.p(s,o):(r.d(1),r=i(s),r&&(r.c(),r.m(e.parentNode,e)))},d(s){r.d(s),s&&$(e)}}}function wy(t){let e;return{c(){e=b("div"),e.textContent=`${q==="en"?"No similar regions":"Pas de régions similaires"}
                    `,v(e,"class","faded is-center")},m(n,i){z(n,e,i)},p:ie,d(n){n&&$(e)}}}function Sy(t){let e;return{c(){e=b("div"),e.textContent=`${q==="en"?"No document selected. Select one to display results.":"Aucun document sélectionné. Sélectionnez-en un pour afficher les résultats."}
                    `,v(e,"class","faded is-center")},m(n,i){z(n,e,i)},p:ie,d(n){n&&$(e)}}}function Fc(t,e){let n,i,r;return i=new _y({props:{qImg:e[0],sImg:e[25],score:e[23],qRegions:e[26],sRegions:e[27],category:e[28],users:e[29],isManual:e[30],similarityType:e[31]}}),{key:t,first:null,c(){n=Ct(),_e(i.$$.fragment),this.first=n},m(s,o){z(s,n,o),me(i,s,o),r=!0},p(s,o){e=s;const l={};o[0]&1&&(l.qImg=e[0]),o[0]&16&&(l.sImg=e[25]),o[0]&16&&(l.score=e[23]),o[0]&16&&(l.qRegions=e[26]),o[0]&16&&(l.sRegions=e[27]),o[0]&16&&(l.category=e[28]),o[0]&16&&(l.users=e[29]),o[0]&16&&(l.isManual=e[30]),o[0]&16&&(l.similarityType=e[31]),i.$set(l)},i(s){r||(V(i.$$.fragment,s),r=!0)},o(s){W(i.$$.fragment,s),r=!1},d(s){s&&$(n),pe(i,s)}}}function ky(t){let e,n,i,r;const s=[by,yy,vy],o=[];function l(a,c){return a[1]&&a[3]==="loading"?0:a[3]==="loaded"?1:a[3]==="error"?2:-1}return~(e=l(t))&&(n=o[e]=s[e](t)),{c(){n&&n.c(),i=Ct()},m(a,c){~e&&o[e].m(a,c),z(a,i,c),r=!0},p(a,c){let u=e;e=l(a),e===u?~e&&o[e].p(a,c):(n&&(et(),W(o[u],1,1,()=>{o[u]=null}),tt()),~e?(n=o[e],n?n.p(a,c):(n=o[e]=s[e](a),n.c()),V(n,1),n.m(i.parentNode,i)):n=null)},i(a){r||(V(n),r=!0)},o(a){W(n),r=!1},d(a){~e&&o[e].d(a),a&&$(i)}}}function Ey(t,e,n){let i,r,s,o,l,a,c,u,{qImg:h}=e,{sImgsPromise:f}=e;const{selectedRegions:d,excludedCategories:m,similarityScoreCutoff:p,propagateFilterByRegions:g}=pn;Me(t,d,M=>n(16,u=M)),Me(t,m,M=>n(15,c=M)),Me(t,p,M=>n(14,a=M)),Me(t,g,M=>n(13,l=M));const _=Ft("similarityPropagatedContext")||!1,S=window.location.pathname.match(/\d+/g).join("-");let C;const w=(M,O)=>M===null||O===void 0||Number(M)>=O,k=(M,O,L)=>!L.includes(M),T=(M,O,L,j,R,x)=>_?!0:w(M,R)&&k(O,L,j),N=(M,O,L,j)=>M.filter(({uuid:R,data:[x,H,P,X,U,K,Z,ae,ce]})=>T(x,K,Z,O,L)),E=(M,O)=>{const L=O>1;return M?q==="fr"?L?"similarités propagées":"similarité propagée":L?"propagated matches":"propagated match":q==="fr"?L?"images similaires":"image similaire":L?"similar images":"similar image"};return t.$$set=M=>{"qImg"in M&&n(0,h=M.qImg),"sImgsPromise"in M&&n(1,f=M.sImgsPromise)},t.$$.update=()=>{t.$$.dirty[0]&65536&&n(5,i=Object.values(u).length===0||u[S]===void 0||!Object.keys(u[S]).length),t.$$.dirty[0]&2&&(M=>{n(3,r="loading"),n(4,o=[]),n(12,s=[])})(),t.$$.dirty[0]&2&&f.then(M=>{n(12,s=M.map(O=>({uuid:window.crypto.randomUUID(),data:O}))),n(3,r="loaded")}).catch(M=>{n(2,C=M),n(3,r="error")}),t.$$.dirty[0]&61440&&n(4,o=N(s,c,a))},n(3,r="loading"),n(12,s=[]),[h,f,C,r,o,i,d,m,p,g,_,E,s,l,a,c,u]}class Hc extends Ve{constructor(e){super(),He(this,e,Ey,ky,je,{qImg:0,sImgsPromise:1},null,[-1,-1])}}function Cy(t){let e,n;return e=new Hc({props:{qImg:t[0],sImgsPromise:t[1]}}),{c(){_e(e.$$.fragment)},m(i,r){me(e,i,r),n=!0},p(i,[r]){const s={};r&1&&(s.qImg=i[0]),r&2&&(s.sImgsPromise=i[1]),e.$set(s)},i(i){n||(V(e.$$.fragment,i),n=!0)},o(i){W(e.$$.fragment,i),n=!1},d(i){pe(e,i)}}}function Iy(t,e,n){let i,r,{qImg:s}=e,o;const l=Ft("isInModal")||!1,{selectedRegions:a,comparedRegions:c}=pn;Me(t,a,m=>n(4,i=m)),Me(t,c,m=>n(5,r=m));const u=`${window.location.origin}${window.location.pathname}`,h=window.location.pathname.match(/\d+/g).join("-"),f=(m,p)=>p?Object.keys(r).map(g=>r[g].id):Object.values(m[h]||{}).map(g=>g.id);async function d(m,p,g){const _=f(p,g);return _.length===0?[]:await(await fetch(`${u}similar-images`,{method:"POST",body:JSON.stringify({regionsIds:_,qImg:m,topk:12}),headers:{"Content-Type":"application/json","X-CSRFToken":bn}})).json()}return l?o=d(s,i,l):a.subscribe(m=>{n(1,o=d(s,m,l))}),t.$$set=m=>{"qImg"in m&&n(0,s=m.qImg)},[s,o,a,c]}class xy extends Ve{constructor(e){super(),He(this,e,Iy,Cy,je,{qImg:0})}}const Ib="";function My(t){let e,n,i,r;return i=new Hc({props:{qImg:t[0],sImgsPromise:t[1]}}),{c(){e=b("div"),n=b("div"),_e(i.$$.fragment),v(n,"class","matches-suggestion svelte-1cb4wg0"),v(e,"class","block matches-suggestion-wrapper svelte-1cb4wg0")},m(s,o){z(s,e,o),y(e,n),me(i,n,null),r=!0},p(s,[o]){const l={};o&1&&(l.qImg=s[0]),o&2&&(l.sImgsPromise=s[1]),i.$set(l)},i(s){r||(V(i.$$.fragment,s),r=!0)},o(s){W(i.$$.fragment,s),r=!1},d(s){s&&$(e),pe(i)}}}function Ay(t,e,n){let i,r,{qImg:s}=e;const{propagateParams:o,selectedRegions:l}=pn;Me(t,o,g=>n(4,i=g)),Me(t,l,g=>n(5,r=g));const a=`${window.location.origin}${window.location.pathname}`,c=window.location.pathname.match(/\d+/g).join("-"),u=Ft("isInModal")||!1;let h;const f=$i();f.setCompareFn((g,_)=>[g,_].every(S=>S&&S.hasOwnProperty("propagateRecursionDepth")&&S.hasOwnProperty("propagateFilterByRegions"))?g.propagateRecursionDepth===_.propagateRecursionDepth&&g.propagateFilterByRegions===_.propagateFilterByRegions:!1);const d=$i();d.setCompareFn(Lr),Fn("similarityPropagatedContext",!0);const m=g=>Object.keys(g).includes(c)?Object.values(g[c]).map(_=>_.id):[],p=async(g,_,S)=>fetch(`${a}propagated-matches/${s}`,{method:"POST",body:JSON.stringify({regionsIds:S?[]:_,filterByRegions:S?!1:g.propagateFilterByRegions,recursionDepth:g.propagateRecursionDepth}),headers:{"Content-Type":"application/json","X-CSRFToken":bn}}).then(C=>C.json()).catch(C=>(console.error("PropagatedMatches.getPropagatedMatches:",C),[]));return o.subscribe(g=>{f.set(g),f.same()||n(1,h=p(f.get(),m(r),u))}),l.subscribe(g=>{d.set(m(g)),i.propagateFilterByRegions===!0&&!d.same()&&n(1,h=p(i,d.get(),u))}),t.$$set=g=>{"qImg"in g&&n(0,s=g.qImg)},[s,h,o,l]}class Ty extends Ve{constructor(e){super(),He(this,e,Ay,My,je,{qImg:0})}}const xb="";function Ny(t){let e,n,i,r=parseInt(t[5])+"",s,o,l,a,c,u,h,f,d,m,p,g,_,S,C,w,k,T,N;return{c(){e=b("a"),n=b("i"),i=re(`
            Page `),s=re(r),o=F(),l=b("img"),c=F(),u=b("div"),h=b("div"),f=b("input"),d=F(),m=b("button"),m.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M256 80c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 144L48 224c-17.7 0-32 14.3-32 32s14.3 32 32 32l144 0 0 144c0 17.7 14.3 32 32 32s32-14.3 32-32l0-144 144 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-144 0 0-144z"></path></svg>',p=F(),g=b("button"),_=Gt("svg"),S=Gt("path"),v(n,"class","fa-solid fa-pen-to-square"),v(e,"class","tag px-2 py-1 mb-2 is-rounded is-hoverable"),v(e,"href",Cu(t[6],parseInt(t[5]))),v(e,"target","_blank"),At(l.src,a=Yt(t[0],t[0].split("_").pop(),"250,"))||v(l,"src",a),v(l,"alt","Query region"),v(l,"class","mb-3 card query-image svelte-f4ylwc"),v(f,"class","input is-small tag"),v(f,"type","text"),v(f,"placeholder",q==="en"?"Add new match":"Ajouter une correspondance"),v(m,"class","button is-small tag is-link is-center"),v(h,"class","tags has-addons"),We(h,"flex-wrap","nowrap"),v(S,"fill","white"),v(S,"d","M376.6 84.5c11.3-13.6 9.5-33.8-4.1-45.1s-33.8-9.5-45.1 4.1L192 206 56.6 43.5C45.3 29.9 25.1 28.1 11.5 39.4S-3.9 70.9 7.4 84.5L150.3 256 7.4 427.5c-11.3 13.6-9.5 33.8 4.1 45.1s33.8 9.5 45.1-4.1L192 306 327.4 468.5c11.3 13.6 31.5 15.4 45.1 4.1s15.4-31.5 4.1-45.1L233.7 256 376.6 84.5z"),v(_,"xmlns","http://www.w3.org/2000/svg"),v(_,"viewBox","0 0 384 512"),v(g,"id","no-match"),v(g,"class",C="button is-small tag is-danger is-center m-0 "+(t[3]===1?"visible":"")+" svelte-f4ylwc"),v(g,"title",q==="en"?"No match for this region in this witness":"Aucune correspondance de cette région pour ce témoin"),v(u,"class","new-similarity control pt-2 is-center svelte-f4ylwc")},m(E,M){z(E,e,M),y(e,n),y(e,i),y(e,s),z(E,o,M),z(E,l,M),z(E,c,M),z(E,u,M),y(u,h),y(h,f),Mi(f,t[1]),y(h,d),y(h,m),y(u,p),y(u,g),y(g,_),y(_,S),k=!0,T||(N=[be(f,"input",t[12]),be(m,"click",t[8]),be(g,"click",t[9])],T=!0)},p(E,M){(!k||M&1&&!At(l.src,a=Yt(E[0],E[0].split("_").pop(),"250,")))&&v(l,"src",a),M&2&&f.value!==E[1]&&Mi(f,E[1]),(!k||M&8&&C!==(C="button is-small tag is-danger is-center m-0 "+(E[3]===1?"visible":"")+" svelte-f4ylwc"))&&v(g,"class",C)},i(E){k||(Ht(()=>{k&&(w||(w=yn(g,Kn,{duration:500},!0)),w.run(1))}),k=!0)},o(E){w||(w=yn(g,Kn,{duration:500},!1)),w.run(0),k=!1},d(E){E&&$(e),E&&$(o),E&&$(l),E&&$(c),E&&$(u),E&&w&&w.end(),T=!1,vt(N)}}}function Py(t){let e,n,i,r,s,o,l,a;return n=new xy({props:{qImg:t[0]}}),o=new Ty({props:{qImg:t[0]}}),{c(){e=b("div"),_e(n.$$.fragment),r=F(),s=b("div"),_e(o.$$.fragment),v(e,"class",i=xi(t[7]?"":t[2])+" svelte-f4ylwc"),v(s,"class",l=xi(t[7]?"":t[2])+" svelte-f4ylwc")},m(c,u){z(c,e,u),me(n,e,null),z(c,r,u),z(c,s,u),me(o,s,null),a=!0},p(c,u){const h={};u&1&&(h.qImg=c[0]),n.$set(h),(!a||u&4&&i!==(i=xi(c[7]?"":c[2])+" svelte-f4ylwc"))&&v(e,"class",i);const f={};u&1&&(f.qImg=c[0]),o.$set(f),(!a||u&4&&l!==(l=xi(c[7]?"":c[2])+" svelte-f4ylwc"))&&v(s,"class",l)},i(c){a||(V(n.$$.fragment,c),V(o.$$.fragment,c),a=!0)},o(c){W(n.$$.fragment,c),W(o.$$.fragment,c),a=!1},d(c){c&&$(e),pe(n),c&&$(r),c&&$(s),pe(o)}}}function Oy(t){let e,n;return e=new Ma({props:{useGrid:!1,$$slots:{"row-body":[Py],"row-header":[Ny]},$$scope:{ctx:t}}}),{c(){_e(e.$$.fragment)},m(i,r){me(e,i,r),n=!0},p(i,[r]){const s={};r&1048591&&(s.$$scope={dirty:r,ctx:i}),e.$set(s)},i(i){n||(V(e.$$.fragment,i),n=!0)},o(i){W(e.$$.fragment,i),n=!1},d(i){pe(e,i)}}}function Ly(t){return t=t.replace(".jpg",""),/^wit\d+_[a-zA-Z]{3}\d+_\d+_\d+,\d+,\d+,\d+$/.test(t)}function Dy(t,e,n){let i,r,s,o;const{selectedRegions:l}=pn;Me(t,l,T=>n(11,o=T));let{qImg:a}=e,c="";const[u,h,f,d]=a.split(".")[0].split("_"),m=`${window.location.origin}${window.location.pathname}`,p=window.location.pathname.match(/\d+/g).join("-"),g=q==="en"?"Error":"Erreur",_=Ft("manifest"),S=Ft("isInModal")||!1;Fn("qImgMetadata",$c(a,u,d,f));async function C(){if(!c||!Ly(c)){await Tt(q==="en"?"Please insert a valid region reference to add a new match":"Veuillez insérer une référence de région valide pour ajouter une nouvelle correspondance","Error");return}try{const T=await fetch(`${m}add-region-pair`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":bn},body:JSON.stringify({q_img:a.replace(".jpg",""),s_img:c,similarity_type:2})});T.ok||(console.error("Error: Network response was not ok"),await Tt(q==="en"?"Problem with network, match was not added":"Problème de réseau, la correspondance n'a pas été ajoutée",g));const N=await T.json();if(N.hasOwnProperty("error")||!N.hasOwnProperty("s_regions")){await Tt(q==="en"?`Request was unsuccessful, match was not added:<br>${N.error}`:`La requête n'a pas abouti, la correspondance n'a pas été ajoutée :<br>${N.error}`,g);return}const E=N.s_regions;pn.addComparedRegions(E),pn.select(E)}catch(T){console.error("Error:",T),await Tt(q==="en"?`An error has occurred, match was not added:<br>${T}`:`Une erreur s'est produite, la correspondance n'a pas été ajoutée :<br>${T}`,g)}}async function w(){const T=Object.values(o[p])[0];if(await Tt(q==="en"?`Do you confirm this region does not have any match in ${T.title}?`:`Confirmez-vous que cette région n'a pas de correspondance dans ${T.title} ?`,q==="en"?"Confirm no match":"Confirmer l'absence de correspondance",!0))try{(await fetch(`${m}no-match`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":bn},body:JSON.stringify({q_img:a,s_regions:T.id})})).ok||(console.error("Error: Network response was not ok"),await Tt(q==="en"?"Problem with network":"Problème de réseau",g)),pn.select(T)}catch(E){console.error("Error:",E),await Tt(q==="en"?`An error has occurred, request was unsuccessful:<br>${E}`:`Une erreur s'est produite, la requête n'a pas abouti :<br>${E}`,g)}}function k(){c=this.value,n(1,c)}return t.$$set=T=>{"qImg"in T&&n(0,a=T.qImg)},t.$$.update=()=>{t.$$.dirty&2048&&n(3,i=o.hasOwnProperty(p)?Object.values(o[p]).length:0),t.$$.dirty&1024&&n(2,s=`fixed-grid has-${r-1}-cols`)},n(10,r=Bs(window.innerWidth)),[a,c,s,i,l,f,_,S,C,w,r,o,k]}class Ry extends Ve{constructor(e){super(),He(this,e,Dy,Oy,je,{qImg:0})}}function $y(t){let e,n,i,r,s,o;return s=new Ry({props:{qImg:t[0].img}}),{c(){e=b("div"),n=b("a"),i=b("button"),i.textContent=`${q==="fr"?"Voir toutes les similarités pour ce document":"View all similarities for this document"}`,r=F(),_e(s.$$.fragment),v(i,"class","button is-link is-small"),v(n,"href",t[1]()),v(e,"class","is-flex is-align-items-center is-justify-content-end")},m(l,a){z(l,e,a),y(e,n),y(n,i),z(l,r,a),me(s,l,a),o=!0},p(l,[a]){const c={};a&1&&(c.qImg=l[0].img),s.$set(c)},i(l){o||(V(s.$$.fragment,l),o=!0)},o(l){W(s.$$.fragment,l),o=!1},d(l){l&&$(e),l&&$(r),pe(s,l)}}}function zy(t,e,n){let{mainImgItem:i}=e;function r(){const s=i.img.match(/wit(\d+)/)[1],o=new URL(window.location.origin);return o.pathname=`${new URL(window.location).pathname.split("/")[1]}/witness/${s}/regions/`,o.searchParams.set("tab","similarity"),o.href}return t.$$set=s=>{"mainImgItem"in s&&n(0,i=s.mainImgItem)},[i,r]}class jy extends Ve{constructor(e){super(),He(this,e,zy,$y,je,{mainImgItem:0})}}const Fy=Object.freeze(Object.defineProperty({__proto__:null,default:jy},Symbol.toStringTag,{value:"Module"}))})();
//# sourceMappingURL=documentSet.js.map
