(function(){"use strict";function X(){}const hs=t=>t;function ds(t,e){for(const n in e)t[n]=e[n];return t}function cc(t){return!!t&&(typeof t=="object"||typeof t=="function")&&typeof t.then=="function"}function ms(t){return t()}function ps(){return Object.create(null)}function Ye(t){t.forEach(ms)}function cn(t){return typeof t=="function"}function pe(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}let ei;function ft(t,e){return ei||(ei=document.createElement("a")),ei.href=e,t===ei.href}function uc(t){return Object.keys(t).length===0}function ti(t,...e){if(t==null)return X;const n=t.subscribe(...e);return n.unsubscribe?()=>n.unsubscribe():n}function et(t){let e;return ti(t,n=>e=n)(),e}function ge(t,e,n){t.$$.on_destroy.push(ti(e,n))}function gt(t,e,n,i){if(t){const r=gs(t,e,n,i);return t[0](r)}}function gs(t,e,n,i){return t[1]&&i?ds(n.ctx.slice(),t[1](i(e))):n.ctx}function _t(t,e,n,i){if(t[2]&&i){const r=t[2](i(n));if(e.dirty===void 0)return r;if(typeof r=="object"){const s=[],o=Math.max(e.dirty.length,r.length);for(let l=0;l<o;l+=1)s[l]=e.dirty[l]|r[l];return s}return e.dirty|r}return e.dirty}function vt(t,e,n,i,r,s){if(r){const o=gs(e,n,i,s);t.p(o,r)}}function yt(t){if(t.ctx.length>32){const e=[],n=t.ctx.length/32;for(let i=0;i<n;i++)e[i]=-1;return e}return-1}function fc(t){const e={};for(const n in t)e[n]=!0;return e}function ni(t){return t??""}function ii(t){return t&&cn(t.destroy)?t.destroy:X}const _s=typeof window<"u";let hc=_s?()=>window.performance.now():()=>Date.now(),Xi=_s?t=>requestAnimationFrame(t):X;const un=new Set;function vs(t){un.forEach(e=>{e.c(t)||(un.delete(e),e.f())}),un.size!==0&&Xi(vs)}function dc(t){let e;return un.size===0&&Xi(vs),{promise:new Promise(n=>{un.add(e={c:t,f:n})}),abort(){un.delete(e)}}}function y(t,e){t.appendChild(e)}function ys(t){if(!t)return document;const e=t.getRootNode?t.getRootNode():t.ownerDocument;return e&&e.host?e:t.ownerDocument}function mc(t){const e=k("style");return pc(ys(t),e),e.sheet}function pc(t,e){return y(t.head||t,e),e.sheet}function j(t,e,n){t.insertBefore(e,n||null)}function $(t){t.parentNode&&t.parentNode.removeChild(t)}function ot(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function k(t){return document.createElement(t)}function bt(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function ne(t){return document.createTextNode(t)}function q(){return ne(" ")}function Ke(){return ne("")}function Se(t,e,n,i){return t.addEventListener(e,n,i),()=>t.removeEventListener(e,n,i)}function Lt(t){return function(e){return e.preventDefault(),t.call(this,e)}}function v(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function gc(t){return Array.from(t.childNodes)}function me(t,e){e=""+e,t.data!==e&&(t.data=e)}function ri(t,e){t.value=e??""}function Le(t,e,n,i){n==null?t.style.removeProperty(e):t.style.setProperty(e,n,i?"important":"")}function Pe(t,e,n){t.classList[n?"add":"remove"](e)}function bs(t,e,{bubbles:n=!1,cancelable:i=!1}={}){const r=document.createEvent("CustomEvent");return r.initCustomEvent(t,n,i,e),r}function si(t,e){return new t(e)}const oi=new Map;let li=0;function _c(t){let e=5381,n=t.length;for(;n--;)e=(e<<5)-e^t.charCodeAt(n);return e>>>0}function vc(t,e){const n={stylesheet:mc(e),rules:{}};return oi.set(t,n),n}function ws(t,e,n,i,r,s,o,l=0){const a=16.666/i;let c=`{
`;for(let p=0;p<=1;p+=a){const _=e+(n-e)*s(p);c+=p*100+`%{${o(_,1-_)}}
`}const u=c+`100% {${o(n,1-n)}}
}`,d=`__svelte_${_c(u)}_${l}`,f=ys(t),{stylesheet:h,rules:m}=oi.get(f)||vc(f,t);m[d]||(m[d]=!0,h.insertRule(`@keyframes ${d} ${u}`,h.cssRules.length));const g=t.style.animation||"";return t.style.animation=`${g?`${g}, `:""}${d} ${i}ms linear ${r}ms 1 both`,li+=1,d}function yc(t,e){const n=(t.style.animation||"").split(", "),i=n.filter(e?s=>s.indexOf(e)<0:s=>s.indexOf("__svelte")===-1),r=n.length-i.length;r&&(t.style.animation=i.join(", "),li-=r,li||bc())}function bc(){Xi(()=>{li||(oi.forEach(t=>{const{ownerNode:e}=t.stylesheet;e&&$(e)}),oi.clear())})}let An;function Dt(t){An=t}function fn(){if(!An)throw new Error("Function called outside component initialization");return An}function Nn(t){fn().$$.on_mount.push(t)}function Tn(t){fn().$$.on_destroy.push(t)}function ai(){const t=fn();return(e,n,{cancelable:i=!1}={})=>{const r=t.$$.callbacks[e];if(r){const s=bs(e,n,{cancelable:i});return r.slice().forEach(o=>{o.call(t,s)}),!s.defaultPrevented}return!0}}function hn(t,e){return fn().$$.context.set(t,e),e}function ht(t){return fn().$$.context.get(t)}const dn=[],mn=[];let pn=[];const Ss=[],wc=Promise.resolve();let Ji=!1;function Sc(){Ji||(Ji=!0,wc.then(Zi))}function Rt(t){pn.push(t)}const Qi=new Set;let gn=0;function Zi(){if(gn!==0)return;const t=An;do{try{for(;gn<dn.length;){const e=dn[gn];gn++,Dt(e),kc(e.$$)}}catch(e){throw dn.length=0,gn=0,e}for(Dt(null),dn.length=0,gn=0;mn.length;)mn.pop()();for(let e=0;e<pn.length;e+=1){const n=pn[e];Qi.has(n)||(Qi.add(n),n())}pn.length=0}while(dn.length);for(;Ss.length;)Ss.pop()();Ji=!1,Qi.clear(),Dt(t)}function kc(t){if(t.fragment!==null){t.update(),Ye(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(Rt)}}function Ec(t){const e=[],n=[];pn.forEach(i=>t.indexOf(i)===-1?e.push(i):n.push(i)),n.forEach(i=>i()),pn=e}let On;function Cc(){return On||(On=Promise.resolve(),On.then(()=>{On=null})),On}function er(t,e,n){t.dispatchEvent(bs(`${e?"intro":"outro"}${n}`))}const ci=new Set;let $t;function Ee(){$t={r:0,c:[],p:$t}}function Ce(){$t.r||Ye($t.c),$t=$t.p}function V(t,e){t&&t.i&&(ci.delete(t),t.i(e))}function K(t,e,n,i){if(t&&t.o){if(ci.has(t))return;ci.add(t),$t.c.push(()=>{ci.delete(t),i&&(n&&t.d(1),i())}),t.o(e)}else i&&i()}const Ic={duration:0};function qt(t,e,n,i){const r={direction:"both"};let s=e(t,n,r),o=i?0:1,l=null,a=null,c=null;function u(){c&&yc(t,c)}function d(h,m){const g=h.b-o;return m*=Math.abs(g),{a:o,b:h.b,d:g,duration:m,start:h.start,end:h.start+m,group:h.group}}function f(h){const{delay:m=0,duration:g=300,easing:p=hs,tick:_=X,css:w}=s||Ic,C={start:hc()+m,b:h};h||(C.group=$t,$t.r+=1),l||a?a=C:(w&&(u(),c=ws(t,o,h,g,m,p,w)),h&&_(0,1),l=d(C,g),Rt(()=>er(t,h,"start")),dc(b=>{if(a&&b>a.start&&(l=d(a,g),a=null,er(t,l.b,"start"),w&&(u(),c=ws(t,o,l.b,l.duration,0,p,s.css))),l){if(b>=l.end)_(o=l.b,1-o),er(t,l.b,"end"),a||(l.b?u():--l.group.r||Ye(l.group.c)),l=null;else if(b>=l.start){const I=b-l.start;o=l.a+l.d*p(I/l.duration),_(o,1-o)}}return!!(l||a)}))}return{run(h){cn(s)?Cc().then(()=>{s=s(r),f(h)}):f(h)},end(){u(),l=a=null}}}function tr(t,e){const n=e.token={};function i(r,s,o,l){if(e.token!==n)return;e.resolved=l;let a=e.ctx;o!==void 0&&(a=a.slice(),a[o]=l);const c=r&&(e.current=r)(a);let u=!1;e.block&&(e.blocks?e.blocks.forEach((d,f)=>{f!==s&&d&&(Ee(),K(d,1,1,()=>{e.blocks[f]===d&&(e.blocks[f]=null)}),Ce())}):e.block.d(1),c.c(),V(c,1),c.m(e.mount(),e.anchor),u=!0),e.block=c,e.blocks&&(e.blocks[s]=c),u&&Zi()}if(cc(t)){const r=fn();if(t.then(s=>{Dt(r),i(e.then,1,e.value,s),Dt(null)},s=>{if(Dt(r),i(e.catch,2,e.error,s),Dt(null),!e.hasCatch)throw s}),e.current!==e.pending)return i(e.pending,0),!0}else{if(e.current!==e.then)return i(e.then,1,e.value,t),!0;e.resolved=t}}function ks(t,e,n){const i=e.slice(),{resolved:r}=t;t.current===t.then&&(i[t.value]=r),t.current===t.catch&&(i[t.error]=r),t.block.p(i,n)}function nr(t,e){K(t,1,1,()=>{e.delete(t.key)})}function ir(t,e,n,i,r,s,o,l,a,c,u,d){let f=t.length,h=s.length,m=f;const g={};for(;m--;)g[t[m].key]=m;const p=[],_=new Map,w=new Map,C=[];for(m=h;m--;){const M=d(r,s,m),E=n(M);let A=o.get(E);A?i&&C.push(()=>A.p(M,e)):(A=c(E,M),A.c()),_.set(E,p[m]=A),E in g&&w.set(E,Math.abs(m-g[E]))}const b=new Set,I=new Set;function T(M){V(M,1),M.m(l,u),o.set(M.key,M),u=M.first,h--}for(;f&&h;){const M=p[h-1],E=t[f-1],A=M.key,O=E.key;M===E?(u=M.first,f--,h--):_.has(O)?!o.has(A)||b.has(A)?T(M):I.has(O)?f--:w.get(A)>w.get(O)?(I.add(A),T(M)):(b.add(O),f--):(a(E,o),f--)}for(;f--;){const M=t[f];_.has(M.key)||a(M,o)}for(;h;)T(p[h-1]);return Ye(C),p}function xc(t,e){const n={},i={},r={$$scope:1};let s=t.length;for(;s--;){const o=t[s],l=e[s];if(l){for(const a in o)a in l||(i[a]=1);for(const a in l)r[a]||(n[a]=l[a],r[a]=1);t[s]=l}else for(const a in o)r[a]=1}for(const o in i)o in n||(n[o]=void 0);return n}function Mc(t){return typeof t=="object"&&t!==null?t:{}}function le(t){t&&t.c()}function se(t,e,n,i){const{fragment:r,after_update:s}=t.$$;r&&r.m(e,n),i||Rt(()=>{const o=t.$$.on_mount.map(ms).filter(cn);t.$$.on_destroy?t.$$.on_destroy.push(...o):Ye(o),t.$$.on_mount=[]}),s.forEach(Rt)}function oe(t,e){const n=t.$$;n.fragment!==null&&(Ec(n.after_update),Ye(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function Ac(t,e){t.$$.dirty[0]===-1&&(dn.push(t),Sc(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function ve(t,e,n,i,r,s,o,l=[-1]){const a=An;Dt(t);const c=t.$$={fragment:null,ctx:[],props:s,update:X,not_equal:r,bound:ps(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(a?a.$$.context:[])),callbacks:ps(),dirty:l,skip_bound:!1,root:e.target||a.$$.root};o&&o(c.root);let u=!1;if(c.ctx=n?n(t,e.props||{},(d,f,...h)=>{const m=h.length?h[0]:f;return c.ctx&&r(c.ctx[d],c.ctx[d]=m)&&(!c.skip_bound&&c.bound[d]&&c.bound[d](m),u&&Ac(t,d)),f}):[],c.update(),u=!0,Ye(c.before_update),c.fragment=i?i(c.ctx):!1,e.target){if(e.hydrate){const d=gc(e.target);c.fragment&&c.fragment.l(d),d.forEach($)}else c.fragment&&c.fragment.c();e.intro&&V(t.$$.fragment),se(t,e.target,e.anchor,e.customElement),Zi()}Dt(a)}class ye{$destroy(){oe(this,1),this.$destroy=X}$on(e,n){if(!cn(n))return X;const i=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return i.push(n),()=>{const r=i.indexOf(n);r!==-1&&i.splice(r,1)}}$set(e){this.$$set&&!uc(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const W=APP_LANG,wt=APP_NAME;WEBAPP_NAME;const rr=USER_ID;IS_SUPERUSER,ADD_PERMISSION;const Kt=CSRF_TOKEN;ADDITIONAL_MODULES;const Nc="Region",Es=APP_URL,Tc=SAS_APP_URL;CANTALOUPE_APP_URL,MEDIA_PATH;const Oc=PAGE_LEN,Pc={Witness:W==="en"?"Witness":"Témoin",Work:W==="en"?"Work":"Œuvre",Series:W==="en"?"Series":"Série d'imprimés",Regions:W==="en"?"Region Extraction":"Extraction d'illustrations"},_n=[];function Lc(t,e){return{subscribe:be(t,e).subscribe}}function be(t,e=X){let n;const i=new Set;function r(l){if(pe(t,l)&&(t=l,n)){const a=!_n.length;for(const c of i)c[1](),_n.push(c,t);if(a){for(let c=0;c<_n.length;c+=2)_n[c][0](_n[c+1]);_n.length=0}}}function s(l){r(l(t))}function o(l,a=X){const c=[l,a];return i.add(c),i.size===1&&(n=e(r)||X),l(t),()=>{i.delete(c),i.size===0&&n&&(n(),n=null)}}return{set:r,update:s,subscribe:o}}function Ue(t,e,n){const i=!Array.isArray(t),r=i?[t]:t,s=e.length<2;return Lc(n,o=>{let l=!1;const a=[];let c=0,u=X;const d=()=>{if(c)return;u();const h=e(i?a[0]:a,o);s?o(h):u=cn(h)?h:X},f=r.map((h,m)=>ti(h,g=>{a[m]=g,c&=~(1<<m),l&&d()},()=>{c|=1<<m}));return l=!0,d(),function(){Ye(f),u(),l=!1}})}const Pn=be(!1),Dc=be(""),Rc=t=>typeof t=="string"||t instanceof String;async function Cs(t){Pn.set(!0);try{return await t()}finally{Pn.set(!1)}}function sr(t){return t.match(/\d+/g).toString()}function $c(t){return parseInt(sr(t),10)}function or(t,e=100){const n=Math.floor(e*.75);return t.length>e?t.slice(0,n)+"..."+t.slice(-e+n):t}function zc(){return"https://vhs.huma-num.fr"}function jc(){return Tc??"http://localhost:8888"}function lr(t,e){if(typeof window<"u"){const n=parseInt(new URLSearchParams(window.location.search).get(e));if(!isNaN(n))return t.set(n),n}return t.set(1),1}function ar(t,e,n){if(e.set(t),typeof window<"u"){const i=new URL(window.location.href);i.searchParams.set(n,t),window.history.pushState({},"",i)}}function Fc(t=null){return t=t.split("_"),t.length<3?void 0:`${t.slice(0,3).join("_").replace(".jpg","")}.jpg`}function Is(t=null){const e=Fc(t);return e===void 0?void 0:`${zc()}/iiif/2/${e}`}function Mt(t=null,e=null,n="full"){if(e=Rc(e)?e.replace(".jpg",""):e,!t)return"https://placehold.co/96x96/png?text=No+image";const i=Is(t);if(i===void 0)return"https://placehold.co/96x96/png?text=No+image";const r=t.split("_");return e||(e=r[r.length-1].includes(",")?r.pop().replace(".jpg",""):"full"),`${i}/${e}/${n}/0/default.jpg`}function Vc(t=null){return`${Is(t)}/info.json`}function Hc(t=null,e=1){return`${jc()}/index.html?iiif-content=${t}&canvas=${e}`}function lt(t,e=null,n=!1){return new Promise(i=>{if(document.getElementById("msg-modal")){n?document.getElementById("modal-footer").hidden=!1:i(void 0),e&&(document.getElementById("modal-title").innerHTML=e),document.getElementById("modal-msg").innerHTML=t,document.getElementById("hidden-msg-btn").click();const s=document.getElementById("cancel-btn"),o=document.getElementById("ok-btn"),l=document.getElementById("modal-bkg"),a=()=>{s.removeEventListener("click",c),l.removeEventListener("click",c),o.removeEventListener("click",u),document.getElementById("modal-footer").hidden=!0},c=()=>{a(),i(!1)},u=()=>{a(),i(!0)};s.addEventListener("click",c),o.addEventListener("click",u)}else n?i(window.confirm(t)):(window.alert(t),i(void 0))})}function ui(){let t,e,n=(i,r)=>i===r;return{set:i=>{e=t,t=i},setCompareFn:i=>n=i,get:()=>t,getNewAndOld:()=>[t,e],same:()=>n(t,e)}}const cr=(t,e)=>Array.isArray(t)&&Array.isArray(e)&&t.length===e.length&&t.every((n,i)=>n===e[i]||void 0);function Uc(t){const n=[85,70,60],i=[50,65,40],r=t*137.5%360,s=n[t%n.length],o=i[Math.floor(t/n.length)%i.length];return`hsl(${Math.floor(r)}, ${s}%, ${o}%)`}function xs(t=null){return t<600?1:t<800?2:t<1e3?3:t<1200?4:t<1400?5:t>=1400?6:4}function Ms(t){const e=t.querySelectorAll(".modal-background, .modal-close, .modal-card-head .delete, .modal-card-foot .button-close"),n=()=>t.classList.remove("is-active");e.forEach(r=>r.addEventListener("click",n));const i=r=>{r.key==="Escape"&&t.classList.contains("is-active")&&n()};return document.addEventListener("keydown",i),{destroy(){e.forEach(r=>r.removeEventListener("click",n)),document.removeEventListener("keydown",i)}}}function As(t){const e=()=>{const n=document.getElementById(t.dataset.target);n==null||n.classList.add("is-active")};return t.addEventListener("click",e),{destroy(){t.removeEventListener("click",e)}}}function Ns(t,e,n="string"){const i={string:s=>s.get(e)||"",array:s=>{const o=s.get(e);return o?o.split(",").map(Number).filter(l=>!isNaN(l)):null},set:s=>{const o=s.get(e);return o?new Set(o.split(",").map(Number).filter(l=>!isNaN(l))):null},number:s=>Number(s.get(e))||0,boolean:s=>s.get(e)==="true"},r={string:(s,o)=>o?s.searchParams.set(e,o):s.searchParams.delete(e),array:(s,o)=>{o.length?s.searchParams.set(e,o.join(",")):s.searchParams.delete(e)},set:(s,o)=>{o.size?s.searchParams.set(e,Array.from(o).join(",")):s.searchParams.delete(e)},number:(s,o)=>s.searchParams.set(e,String(o)),boolean:(s,o)=>o?s.searchParams.set(e,"true"):s.searchParams.delete(e)};if(typeof window<"u"){const s=new URLSearchParams(window.location.search),o=i[n](s);return o!==null&&t.set(o),l=>{const a=new URL(window.location);r[n](a,l),window.history.pushState({},"",a)}}return()=>{}}function Bc(t){const e=t-1;return e*e*e+1}function vn(t,{delay:e=0,duration:n=400,easing:i=hs}={}){const r=+getComputedStyle(t).opacity;return{delay:e,duration:n,easing:i,css:s=>`opacity: ${s*r}`}}function Ts(t,{delay:e=0,duration:n=400,easing:i=Bc,axis:r="y"}={}){const s=getComputedStyle(t),o=+s.opacity,l=r==="y"?"height":"width",a=parseFloat(s[l]),c=r==="y"?["top","bottom"]:["left","right"],u=c.map(_=>`${_[0].toUpperCase()}${_.slice(1)}`),d=parseFloat(s[`padding${u[0]}`]),f=parseFloat(s[`padding${u[1]}`]),h=parseFloat(s[`margin${u[0]}`]),m=parseFloat(s[`margin${u[1]}`]),g=parseFloat(s[`border${u[0]}Width`]),p=parseFloat(s[`border${u[1]}Width`]);return{delay:e,duration:n,easing:i,css:_=>`overflow: hidden;opacity: ${Math.min(_*20,1)*o};${l}: ${_*a}px;padding-${c[0]}: ${_*d}px;padding-${c[1]}: ${_*f}px;margin-${c[0]}: ${_*h}px;margin-${c[1]}: ${_*m}px;border-${c[0]}-width: ${_*g}px;border-${c[1]}-width: ${_*p}px;`}}const Yv="";function Os(t){let e,n,i;return{c(){e=k("div"),e.innerHTML='<div class="loader svelte-vizlcg"></div>',v(e,"class","bkg-shade svelte-vizlcg")},m(r,s){j(r,e,s),i=!0},i(r){i||(Rt(()=>{i&&(n||(n=qt(e,vn,{duration:150},!0)),n.run(1))}),i=!0)},o(r){n||(n=qt(e,vn,{duration:150},!1)),n.run(0),i=!1},d(r){r&&$(e),r&&n&&n.end()}}}function qc(t){let e,n,i=t[0]&&Os();return{c(){i&&i.c(),e=Ke()},m(r,s){i&&i.m(r,s),j(r,e,s),n=!0},p(r,[s]){r[0]?i?s&1&&V(i,1):(i=Os(),i.c(),V(i,1),i.m(e.parentNode,e)):i&&(Ee(),K(i,1,1,()=>{i=null}),Ce())},i(r){n||(V(i),n=!0)},o(r){K(i),n=!1},d(r){i&&i.d(r),r&&$(e)}}}function Kc(t,e,n){let i;return ge(t,Pn,r=>n(0,i=r)),[i]}class Wc extends ye{constructor(e){super(),ve(this,e,Kc,qc,pe,{})}}const Gc=t=>({}),Ps=t=>({});function Yc(t){let e,n,i,r,s,o,l,a,c,u,d,f,h,m,g,p,_,w,C,b,I;const T=t[1].content,M=gt(T,t,t[0],Ps);return{c(){e=k("button"),n=q(),i=k("div"),r=k("div"),s=q(),o=k("div"),l=k("div"),l.innerHTML=`<div class="title is-4 mb-0 media-content"><span id="modal-title" class="mb-0"></span></div>
            <button class="delete media-left" aria-label="close"></button>`,a=q(),c=k("section"),u=k("div"),d=q(),f=k("div"),M&&M.c(),h=q(),m=k("footer"),g=k("div"),p=k("button"),p.textContent=`${W==="en"?"Abort":"Retour"}`,_=q(),w=k("button"),w.textContent="OK",v(e,"id","hidden-msg-btn"),v(e,"data-target","msg-modal"),e.hidden=!0,v(r,"id","modal-bkg"),v(r,"class","modal-background"),v(l,"class","modal-card-head media mb-0"),v(u,"id","modal-msg"),v(f,"class","py-3"),v(c,"id","modal-body"),v(c,"class","modal-card-body"),v(p,"id","cancel-btn"),v(p,"class","button is-link is-light button-close"),v(w,"id","ok-btn"),v(w,"class","button is-link button-close"),v(g,"class","buttons"),v(m,"id","modal-footer"),v(m,"class","modal-card-foot is-center pt-3"),m.hidden=!0,v(o,"class","modal-content"),v(i,"id","msg-modal"),v(i,"class","modal fade"),v(i,"tabindex","-1"),v(i,"aria-labelledby","selection-modal-label"),v(i,"aria-hidden","true")},m(E,A){j(E,e,A),j(E,n,A),j(E,i,A),y(i,r),y(i,s),y(i,o),y(o,l),y(o,a),y(o,c),y(c,u),y(c,d),y(c,f),M&&M.m(f,null),y(o,h),y(o,m),y(m,g),y(g,p),y(g,_),y(g,w),C=!0,b||(I=[ii(As.call(null,e)),ii(Ms.call(null,i))],b=!0)},p(E,[A]){M&&M.p&&(!C||A&1)&&vt(M,T,E,E[0],C?_t(T,E[0],A,Gc):yt(E[0]),Ps)},i(E){C||(V(M,E),C=!0)},o(E){K(M,E),C=!1},d(E){E&&$(e),E&&$(n),E&&$(i),M&&M.d(E),b=!1,Ye(I)}}}function Xc(t,e,n){let{$$slots:i={},$$scope:r}=e;return t.$$set=s=>{"$$scope"in s&&n(0,r=s.$$scope)},[r,i]}class Jc extends ye{constructor(e){super(),ve(this,e,Xc,Yc,pe,{})}}const Xv="",Qc=t=>({activeTab:t&8}),Ls=t=>({activeTab:t[3]});function Ds(t,e,n){const i=t.slice();return i[11]=e[n][0],i[12]=e[n][1],i}const Zc=t=>({activeTab:t&8}),Rs=t=>({activeTab:t[3]}),eu=t=>({}),$s=t=>({});function tu(t){let e,n,i=Object.entries(t[2]),r=[];for(let s=0;s<i.length;s+=1)r[s]=zs(Ds(t,i,s));return{c(){e=k("div"),n=k("ul");for(let s=0;s<r.length;s+=1)r[s].c();v(e,"class","tabs")},m(s,o){j(s,e,o),y(e,n);for(let l=0;l<r.length;l+=1)r[l]&&r[l].m(n,null)},p(s,o){if(o&28){i=Object.entries(s[2]);let l;for(l=0;l<i.length;l+=1){const a=Ds(s,i,l);r[l]?r[l].p(a,o):(r[l]=zs(a),r[l].c(),r[l].m(n,null))}for(;l<r.length;l+=1)r[l].d(1);r.length=i.length}},i:X,o:X,d(s){s&&$(e),ot(r,s)}}}function nu(t){let e;const n=t[8].tabs,i=gt(n,t,t[7],Rs);return{c(){i&&i.c()},m(r,s){i&&i.m(r,s),e=!0},p(r,s){i&&i.p&&(!e||s&136)&&vt(i,n,r,r[7],e?_t(n,r[7],s,Zc):yt(r[7]),Rs)},i(r){e||(V(i,r),e=!0)},o(r){K(i,r),e=!1},d(r){i&&i.d(r)}}}function zs(t){let e,n,i=t[12]+"",r,s,o,l;function a(){return t[9](t[11])}return{c(){e=k("li"),n=k("a"),r=ne(i),s=q(),v(n,"href",null),Pe(e,"is-active",t[3]===t[11])},m(c,u){j(c,e,u),y(e,n),y(n,r),y(e,s),o||(l=Se(n,"click",a),o=!0)},p(c,u){t=c,u&4&&i!==(i=t[12]+"")&&me(r,i),u&12&&Pe(e,"is-active",t[3]===t[11])},d(c){c&&$(e),o=!1,l()}}}function iu(t){let e,n,i,r,s,o,l,a,c,u,d,f,h;e=new Wc({});const m=t[8].sidebar,g=gt(m,t,t[7],$s),p=[nu,tu],_=[];function w(I,T){return T&4&&(a=null),I[5].tabs?0:(a==null&&(a=!!Object.keys(I[2]).length),a?1:-1)}~(c=w(t,-1))&&(u=_[c]=p[c](t));const C=t[8].content,b=gt(C,t,t[7],Ls);return{c(){le(e.$$.fragment),n=q(),i=k("div"),r=k("aside"),g&&g.c(),s=q(),o=k("main"),l=k("nav"),u&&u.c(),d=q(),f=k("div"),b&&b.c(),v(r,"class","sidebar svelte-jexg"),Le(r,"width",t[0]+"%"),Le(r,"min-height",t[1]),v(l,"id","tabs"),v(l,"class","tabs-bar svelte-jexg"),v(f,"class","content-area pl-5 svelte-jexg"),v(o,"class","main-content svelte-jexg"),Le(o,"width",100-t[0]+"%"),Le(o,"min-height",t[1]),v(i,"class","layout svelte-jexg"),Le(i,"min-height",t[1])},m(I,T){se(e,I,T),j(I,n,T),j(I,i,T),y(i,r),g&&g.m(r,null),y(i,s),y(i,o),y(o,l),~c&&_[c].m(l,null),y(o,d),y(o,f),b&&b.m(f,null),h=!0},p(I,[T]){g&&g.p&&(!h||T&128)&&vt(g,m,I,I[7],h?_t(m,I[7],T,eu):yt(I[7]),$s),(!h||T&1)&&Le(r,"width",I[0]+"%");let M=c;c=w(I,T),c===M?~c&&_[c].p(I,T):(u&&(Ee(),K(_[M],1,1,()=>{_[M]=null}),Ce()),~c?(u=_[c],u?u.p(I,T):(u=_[c]=p[c](I),u.c()),V(u,1),u.m(l,null)):u=null),b&&b.p&&(!h||T&136)&&vt(b,C,I,I[7],h?_t(C,I[7],T,Qc):yt(I[7]),Ls),(!h||T&1)&&Le(o,"width",100-I[0]+"%")},i(I){h||(V(e.$$.fragment,I),V(g,I),V(u),V(b,I),h=!0)},o(I){K(e.$$.fragment,I),K(g,I),K(u),K(b,I),h=!1},d(I){oe(e,I),I&&$(n),I&&$(i),g&&g.d(I),~c&&_[c].d(),b&&b.d(I)}}}function ru(t=null){t||(t=document.getElementById("navbar")),document.documentElement.style.setProperty("--top-offset",`${t.offsetHeight}px`)}function su(t,e,n){let i,{$$slots:r={},$$scope:s}=e;const o=fc(r);let{sidebarWidth:l="25"}=e;const a="90vh";let{tabList:c={}}=e,u=Object.keys(c),{topOffsetElement:d=null}=e;ru(d);function f(m){if(!u.includes(m)){console.warn(`Tab "${m}" is not available.`);return}n(3,i=m);const g=new URL(window.location);g.searchParams.set("tab",m),window.history.pushState({},"",g)}const h=m=>f(m);return t.$$set=m=>{"sidebarWidth"in m&&n(0,l=m.sidebarWidth),"tabList"in m&&n(2,c=m.tabList),"topOffsetElement"in m&&n(6,d=m.topOffsetElement),"$$scope"in m&&n(7,s=m.$$scope)},n(3,i=new URLSearchParams(window.location.search).get("tab")??u[0]??null),[l,a,c,i,f,o,d,s,r,h]}class ou extends ye{constructor(e){super(),ve(this,e,su,iu,pe,{sidebarWidth:0,layoutHeight:1,tabList:2,topOffsetElement:6})}get layoutHeight(){return this.$$.ctx[1]}}const fi={0:{title:W==="en"?"no categorization":"aucune catégorisation",svg:`<svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 59 59">
        <rect x="1" y="0.62" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>
    </svg>`},1:{title:W==="en"?"overall visual matches":"correspondances visuelles globales",svg:`<svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 68 69">
        <rect x="10" y="10.62" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>
        <rect x="1" y="1" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>
        <rect x="10" y="10.62" width="46" height="45.71" rx="4.11" ry="4.11" fill="currentColor" stroke="none"/>
    </svg>`},2:{title:W==="en"?"visual matches on part of the image":"correspondances visuelles sur une partie de l'image",svg:`<svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 70 71">
        <rect x="12" y="12.43" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>
        <rect x="1" y="0.81" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>
        <path d="M 12 21.43 L 21 12.43" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
        <path d="M 12 30 L 30 12.43" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
        <path d="M 40 56 L 57 38" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
        <path d="M 48.3 56.29 L 57 47" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
        <path d="M 12 39 L 39 12" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
        <path d="M 12 48 L 48 12" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
        <path d="M 13 56 L 57 12" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
        <path d="M 31 56 L 57 29" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
        <path d="M 21 57 L 57 21" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
    </svg>`},3:{title:W==="en"?"semantic and non-visual matches":"correspondances sémantiques et non-visuelle",svg:`<svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 72 73">
        <rect x="14" y="14.43" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3" stroke-dasharray="9 9"/>
        <rect x="1" y="0.81" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>
    </svg>`},4:{title:W==="en"?"regions without match":"régions sans correspondance",svg:`<svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 59 59">
        <rect x="1" y="0.62" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>
        <path d="M 2.67 54.55 L 55 2" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
        <path d="M 54.37 54.05 L 2.72 2.24" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
    </svg>`},5:{title:W==="en"?"user specific category":"correspondances spécifiques à l'utilisateur",svg:`<svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 59 59">
        <rect x="1" y="0.81" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>
        <path d="M 8.69 55.28 C 9.25 44.15 18.08 35.28 28.86 35.28 C 32.5 35.28 36.07 36.3 39.18 38.25 C 44.96 41.85 48.66 48.3 49.02 55.28 Z M 17.85 21.48 C 17.85 15.37 22.79 10.39 28.86 10.39 C 34.92 10.39 39.86 15.37 39.86 21.48 C 39.86 27.59 34.92 32.56 28.86 32.56 C 22.79 32.56 17.85 27.59 17.85 21.48 Z M 40.37 36.34 C 38.43 35.13 36.32 34.25 34.13 33.7 C 38.82 31.64 42.1 26.94 42.1 21.48 C 42.1 14.13 36.16 8.15 28.86 8.15 C 21.55 8.15 15.61 14.13 15.61 21.48 C 15.61 26.95 18.9 31.66 23.6 33.71 C 13.76 36.18 6.41 45.4 6.41 56.4 C 6.41 57.02 6.92 57.52 7.54 57.52 L 50.17 57.52 C 50.79 57.52 51.3 57.02 51.3 56.4 C 51.3 48.23 47.11 40.54 40.37 36.34 Z" fill="currentColor" stroke="none"/>
    </svg>`}};function lu(t){let e,n=fi[t[2]].svg+"",i,r,s,o;return{c(){e=k("span"),v(e,"class",i="tag py-4 "+t[4]+" "+(t[0]?"is-hoverable":"")),v(e,"title",r=fi[t[2]].title),Pe(e,"is-selected",t[1])},m(l,a){j(l,e,a),e.innerHTML=n,s||(o=[Se(e,"click",t[5]),Se(e,"keyup",null)],s=!0)},p(l,[a]){a&4&&n!==(n=fi[l[2]].svg+"")&&(e.innerHTML=n),a&17&&i!==(i="tag py-4 "+l[4]+" "+(l[0]?"is-hoverable":""))&&v(e,"class",i),a&4&&r!==(r=fi[l[2]].title)&&v(e,"title",r),a&19&&Pe(e,"is-selected",l[1])},i:X,o:X,d(l){l&&$(e),s=!1,Ye(o)}}}function au(t,e,n){let{selectable:i=!0}=e,{isSelected:r=!1}=e,{category:s}=e,{toggle:o=()=>{}}=e,{padding:l="px-2"}=e;const a=()=>o(s);return t.$$set=c=>{"selectable"in c&&n(0,i=c.selectable),"isSelected"in c&&n(1,r=c.isSelected),"category"in c&&n(2,s=c.category),"toggle"in c&&n(3,o=c.toggle),"padding"in c&&n(4,l=c.padding)},[i,r,s,o,l,a]}class yn extends ye{constructor(e){super(),ve(this,e,au,lu,pe,{selectable:0,isSelected:1,category:2,toggle:3,padding:4})}}const cy="";function js(t){let e,n,i=t[3].title+"",r,s;return{c(){e=k("span"),n=k("a"),r=ne(i),v(n,"href",s=`${Es}/${wt}/witness/${t[3].witnessId}/regions/${t[1]}`),v(n,"target","_blank"),v(e,"class","legend-label svelte-w1sf17")},m(o,l){j(o,e,l),y(e,n),y(n,r)},p(o,l){l&8&&i!==(i=o[3].title+"")&&me(r,i),l&10&&s!==(s=`${Es}/${wt}/witness/${o[3].witnessId}/regions/${o[1]}`)&&v(n,"href",s)},d(o){o&&$(e)}}}function cu(t){let e,n,i,r,s,o,l,a,c,u=!t[5]&&js(t);return{c(){e=k("div"),n=k("span"),i=q(),r=k("span"),l=q(),u&&u.c(),v(n,"class","legend-nb svelte-w1sf17"),v(r,"class","legend-color svelte-w1sf17"),v(r,"aria-label",s=t[3].title),v(r,"title",o=t[3].title),Le(r,"background-color",t[0]?t[3].color:"#999"),v(r,"role","button"),v(r,"tabindex","0"),Pe(r,"inactive",!t[0]),Pe(r,"clickable",t[4]),v(e,"class","legend-item svelte-w1sf17"),Pe(e,"inactive",!t[0])},m(d,f){j(d,e,f),y(e,n),y(e,i),y(e,r),y(e,l),u&&u.m(e,null),a||(c=[Se(r,"click",function(){cn(t[2])&&t[2].apply(this,arguments)}),Se(r,"keydown",null)],a=!0)},p(d,[f]){t=d,f&8&&s!==(s=t[3].title)&&v(r,"aria-label",s),f&8&&o!==(o=t[3].title)&&v(r,"title",o),f&9&&Le(r,"background-color",t[0]?t[3].color:"#999"),f&1&&Pe(r,"inactive",!t[0]),f&16&&Pe(r,"clickable",t[4]),t[5]?u&&(u.d(1),u=null):u?u.p(t,f):(u=js(t),u.c(),u.m(e,null)),f&1&&Pe(e,"inactive",!t[0])},i:X,o:X,d(d){d&&$(e),u&&u.d(),a=!1,Ye(c)}}}function uu(t,e,n){let{isActive:i=!0}=e,{id:r}=e,{toggle:s=()=>{}}=e,{meta:o={title:"Region",color:"#999",witnessId:1}}=e,{clickable:l=!0}=e,{onlyColor:a=!1}=e;return t.$$set=c=>{"isActive"in c&&n(0,i=c.isActive),"id"in c&&n(1,r=c.id),"toggle"in c&&n(2,s=c.toggle),"meta"in c&&n(3,o=c.meta),"clickable"in c&&n(4,l=c.clickable),"onlyColor"in c&&n(5,a=c.onlyColor)},[i,r,s,o,l,a]}class ur extends ye{constructor(e){super(),ve(this,e,uu,cu,pe,{isActive:0,id:1,toggle:2,meta:3,clickable:4,onlyColor:5})}}const uy="",fu=t=>({}),Fs=t=>({});function Vs(t,e,n){const i=t.slice();return i[19]=e[n],i}function Hs(t,e,n){const i=t.slice();return i[22]=e[n][0],i[23]=e[n][1],i}function Us(t,e,n){const i=t.slice();i[26]=e[n];const r=Object.keys(i[13][i[26]]||{});return i[27]=r,i}function Bs(t){var Zt;let e,n,i,r=((Zt=t[0])==null?void 0:Zt.title)+"",s,o,l,a,c,u,d,f,h,m=(t[1].pairs||0)+"",g,p,_,w,C,b,I,T=(t[1].images||0)+"",M,E,A,O,D,B,R,S=(t[2]||0)+"",L,x,F,H,U,Y,J,ie,he,te,ce,xe,Ae,we,$e,It,Ie,Be=["Series","Witness","Work"],ze=[];for(let ee=0;ee<3;ee+=1)ze[ee]=qs(Us(t,Be,ee));let Ne=Array.from(t[3]||new Map),_e=[];for(let ee=0;ee<Ne.length;ee+=1)_e[ee]=Ks(Hs(t,Ne,ee));const Bt=ee=>K(_e[ee],1,1,()=>{_e[ee]=null});let Qn=[0,1,2,3,5],Ve=[];for(let ee=0;ee<5;ee+=1)Ve[ee]=Ws(Vs(t,Qn,ee));const Wi=ee=>K(Ve[ee],1,1,()=>{Ve[ee]=null}),ln=t[17].datavizInfo,pt=gt(ln,t,t[16],Fs);return{c(){e=k("div"),n=k("div"),i=k("h1"),s=ne(r),o=q(),l=k("div");for(let ee=0;ee<3;ee+=1)ze[ee].c();a=q(),c=k("div"),u=k("div"),d=k("p"),d.textContent=`${W==="en"?"Pairs":"Paires"}`,f=q(),h=k("p"),g=ne(m),p=q(),_=k("div"),w=k("div"),C=k("p"),C.textContent="Images",b=q(),I=k("p"),M=ne(T),E=q(),A=k("div"),O=k("div"),D=k("p"),D.textContent="Clusters",B=q(),R=k("p"),L=ne(S),x=q(),F=k("div");for(let ee=0;ee<_e.length;ee+=1)_e[ee].c();H=q(),U=k("hr"),Y=q(),J=k("div"),ie=k("h3"),ie.textContent=`${W==="en"?"Similarity categories":"Catégories de similarité"}`,he=q(),te=k("div");for(let ee=0;ee<5;ee+=1)Ve[ee].c();ce=q(),xe=k("hr"),Ae=q(),we=k("div"),$e=k("h3"),$e.textContent=`${W==="en"?"Visualisation information":"Informations sur la visualisation"}`,It=q(),pt&&pt.c(),v(i,"class","title"),v(d,"class","heading"),v(h,"class","title is-5"),v(c,"class","level-item has-text-centered"),v(C,"class","heading"),v(I,"class","title is-5"),v(_,"class","level-item has-text-centered"),v(D,"class","heading"),v(R,"class","title is-5"),v(A,"class","level-item has-text-centered"),v(l,"class","level"),v(F,"class","legend-list svelte-m807yn"),v(n,"class","pb-2"),v(ie,"class","title"),v(te,"class","tags"),v(J,"class","pt-2"),v($e,"class","title"),v(we,"class","py-2"),v(e,"class","content is-small mt-4")},m(ee,ke){j(ee,e,ke),y(e,n),y(n,i),y(i,s),y(n,o),y(n,l);for(let Fe=0;Fe<3;Fe+=1)ze[Fe]&&ze[Fe].m(l,null);y(l,a),y(l,c),y(c,u),y(u,d),y(u,f),y(u,h),y(h,g),y(l,p),y(l,_),y(_,w),y(w,C),y(w,b),y(w,I),y(I,M),y(l,E),y(l,A),y(A,O),y(O,D),y(O,B),y(O,R),y(R,L),y(n,x),y(n,F);for(let Fe=0;Fe<_e.length;Fe+=1)_e[Fe]&&_e[Fe].m(F,null);y(e,H),y(e,U),y(e,Y),y(e,J),y(J,ie),y(J,he),y(J,te);for(let Fe=0;Fe<5;Fe+=1)Ve[Fe]&&Ve[Fe].m(te,null);y(e,ce),y(e,xe),y(e,Ae),y(e,we),y(we,$e),y(we,It),pt&&pt.m(we,null),Ie=!0},p(ee,ke){var Fe;if((!Ie||ke&1)&&r!==(r=((Fe=ee[0])==null?void 0:Fe.title)+"")&&me(s,r),ke&8192){Be=["Series","Witness","Work"];let ue;for(ue=0;ue<3;ue+=1){const xt=Us(ee,Be,ue);ze[ue]?ze[ue].p(xt,ke):(ze[ue]=qs(xt),ze[ue].c(),ze[ue].m(l,a))}for(;ue<3;ue+=1)ze[ue].d(1)}if((!Ie||ke&2)&&m!==(m=(ee[1].pairs||0)+"")&&me(g,m),(!Ie||ke&2)&&T!==(T=(ee[1].images||0)+"")&&me(M,T),(!Ie||ke&4)&&S!==(S=(ee[2]||0)+"")&&me(L,S),ke&2072){Ne=Array.from(ee[3]||new Map);let ue;for(ue=0;ue<Ne.length;ue+=1){const xt=Hs(ee,Ne,ue);_e[ue]?(_e[ue].p(xt,ke),V(_e[ue],1)):(_e[ue]=Ks(xt),_e[ue].c(),V(_e[ue],1),_e[ue].m(F,null))}for(Ee(),ue=Ne.length;ue<_e.length;ue+=1)Bt(ue);Ce()}if(ke&546){Qn=[0,1,2,3,5];let ue;for(ue=0;ue<5;ue+=1){const xt=Vs(ee,Qn,ue);Ve[ue]?(Ve[ue].p(xt,ke),V(Ve[ue],1)):(Ve[ue]=Ws(xt),Ve[ue].c(),V(Ve[ue],1),Ve[ue].m(te,null))}for(Ee(),ue=5;ue<5;ue+=1)Wi(ue);Ce()}pt&&pt.p&&(!Ie||ke&65536)&&vt(pt,ln,ee,ee[16],Ie?_t(ln,ee[16],ke,fu):yt(ee[16]),Fs)},i(ee){if(!Ie){for(let ke=0;ke<Ne.length;ke+=1)V(_e[ke]);for(let ke=0;ke<5;ke+=1)V(Ve[ke]);V(pt,ee),Ie=!0}},o(ee){_e=_e.filter(Boolean);for(let ke=0;ke<_e.length;ke+=1)K(_e[ke]);Ve=Ve.filter(Boolean);for(let ke=0;ke<5;ke+=1)K(Ve[ke]);K(pt,ee),Ie=!1},d(ee){ee&&$(e),ot(ze,ee),ot(_e,ee),ot(Ve,ee),pt&&pt.d(ee)}}}function hu(t){let e,n,i,r=Pc[t[26]]+"",s,o,l,a=(t[27].length||0)+"",c;return{c(){e=k("div"),n=k("div"),i=k("p"),s=ne(r),o=q(),l=k("p"),c=ne(a),v(i,"class","heading"),v(l,"class","title is-5"),v(e,"class","level-item has-text-centered")},m(u,d){j(u,e,d),y(e,n),y(n,i),y(i,s),y(n,o),y(n,l),y(l,c)},p:X,d(u){u&&$(e)}}}function qs(t){let e,n=t[27].length>0&&hu(t);return{c(){n&&n.c(),e=Ke()},m(i,r){n&&n.m(i,r),j(i,e,r)},p(i,r){i[27].length>0&&n.p(i,r)},d(i){n&&n.d(i),i&&$(e)}}}function Ks(t){let e,n;function i(){return t[18](t[22])}return e=new ur({props:{id:t[22],meta:t[23],isActive:t[4].has(parseInt(t[22])),toggle:i}}),{c(){le(e.$$.fragment)},m(r,s){se(e,r,s),n=!0},p(r,s){t=r;const o={};s&8&&(o.id=t[22]),s&8&&(o.meta=t[23]),s&24&&(o.isActive=t[4].has(parseInt(t[22]))),s&8&&(o.toggle=i),e.$set(o)},i(r){n||(V(e.$$.fragment,r),n=!0)},o(r){K(e.$$.fragment,r),n=!1},d(r){oe(e,r)}}}function Ws(t){let e,n,i=(t[1].categories[t[19]]||0)+"",r,s;return e=new yn({props:{category:t[19],isSelected:t[5].includes(t[19]),toggle:t[9]}}),{c(){le(e.$$.fragment),n=q(),r=ne(i)},m(o,l){se(e,o,l),j(o,n,l),j(o,r,l),s=!0},p(o,l){const a={};l&32&&(a.isSelected=o[5].includes(o[19])),e.$set(a),(!s||l&2)&&i!==(i=(o[1].categories[o[19]]||0)+"")&&me(r,i)},i(o){s||(V(e.$$.fragment,o),s=!0)},o(o){K(e.$$.fragment,o),s=!1},d(o){oe(e,o),o&&$(n),o&&$(r)}}}function du(t){let e,n,i=t[1]&&Bs(t);return{c(){e=k("div"),i&&i.c(),v(e,"class","m-4 py-5 px-4")},m(r,s){j(r,e,s),i&&i.m(e,null),n=!0},p(r,[s]){r[1]?i?(i.p(r,s),s&2&&V(i,1)):(i=Bs(r),i.c(),V(i,1),i.m(e,null)):i&&(Ee(),K(i,1,1,()=>{i=null}),Ce())},i(r){n||(V(i),n=!0)},o(r){K(i),n=!1},d(r){r&&$(e),i&&i.d()}}}function mu(t,e,n){let i,r,s,o,l,{$$slots:a={},$$scope:c}=e,{docSet:u=null}=e,{documentSetStore:d}=e,{clusterStore:f}=e;const{docSetNumber:h,documentNodes:m,selectedCategories:g,toggleCategory:p,selectedRegions:_,toggleRegion:w}=d;ge(t,h,T=>n(1,i=T)),ge(t,m,T=>n(3,s=T)),ge(t,g,T=>n(5,l=T)),ge(t,_,T=>n(4,o=T));const{clusterNb:C}=f;ge(t,C,T=>n(2,r=T));const b=ht("selectedDocuments"),I=T=>w(parseInt(T));return t.$$set=T=>{"docSet"in T&&n(0,u=T.docSet),"documentSetStore"in T&&n(14,d=T.documentSetStore),"clusterStore"in T&&n(15,f=T.clusterStore),"$$scope"in T&&n(16,c=T.$$scope)},[u,i,r,s,o,l,h,m,g,p,_,w,C,b,d,f,c,a,I]}class pu extends ye{constructor(e){super(),ve(this,e,mu,du,pe,{docSet:0,documentSetStore:14,clusterStore:15})}}function hi(t,e){return t==null||e==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function gu(t,e){return t==null||e==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function Gs(t){let e,n,i;t.length!==2?(e=hi,n=(l,a)=>hi(t(l),a),i=(l,a)=>t(l)-a):(e=t===hi||t===gu?t:_u,n=t,i=t);function r(l,a,c=0,u=l.length){if(c<u){if(e(a,a)!==0)return u;do{const d=c+u>>>1;n(l[d],a)<0?c=d+1:u=d}while(c<u)}return c}function s(l,a,c=0,u=l.length){if(c<u){if(e(a,a)!==0)return u;do{const d=c+u>>>1;n(l[d],a)<=0?c=d+1:u=d}while(c<u)}return c}function o(l,a,c=0,u=l.length){const d=r(l,a,c,u-1);return d>c&&i(l[d-1],a)>-i(l[d],a)?d-1:d}return{left:r,center:o,right:s}}function _u(){return 0}function vu(t){return t===null?NaN:+t}const yu=Gs(hi).right;Gs(vu).center;const bu=yu,wu=Math.sqrt(50),Su=Math.sqrt(10),ku=Math.sqrt(2);function di(t,e,n){const i=(e-t)/Math.max(0,n),r=Math.floor(Math.log10(i)),s=i/Math.pow(10,r),o=s>=wu?10:s>=Su?5:s>=ku?2:1;let l,a,c;return r<0?(c=Math.pow(10,-r)/o,l=Math.round(t*c),a=Math.round(e*c),l/c<t&&++l,a/c>e&&--a,c=-c):(c=Math.pow(10,r)*o,l=Math.round(t/c),a=Math.round(e/c),l*c<t&&++l,a*c>e&&--a),a<l&&.5<=n&&n<2?di(t,e,n*2):[l,a,c]}function Eu(t,e,n){if(e=+e,t=+t,n=+n,!(n>0))return[];if(t===e)return[t];const i=e<t,[r,s,o]=i?di(e,t,n):di(t,e,n);if(!(s>=r))return[];const l=s-r+1,a=new Array(l);if(i)if(o<0)for(let c=0;c<l;++c)a[c]=(s-c)/-o;else for(let c=0;c<l;++c)a[c]=(s-c)*o;else if(o<0)for(let c=0;c<l;++c)a[c]=(r+c)/-o;else for(let c=0;c<l;++c)a[c]=(r+c)*o;return a}function fr(t,e,n){return e=+e,t=+t,n=+n,di(t,e,n)[2]}function Cu(t,e,n){e=+e,t=+t,n=+n;const i=e<t,r=i?fr(e,t,n):fr(t,e,n);return(i?-1:1)*(r<0?1/-r:r)}function Iu(t){return t}var hr=1,dr=2,mr=3,Ln=4,Ys=1e-6;function xu(t){return"translate("+t+",0)"}function Mu(t){return"translate(0,"+t+")"}function Au(t){return e=>+t(e)}function Nu(t,e){return e=Math.max(0,t.bandwidth()-e*2)/2,t.round()&&(e=Math.round(e)),n=>+t(n)+e}function Tu(){return!this.__axis}function Xs(t,e){var n=[],i=null,r=null,s=6,o=6,l=3,a=typeof window<"u"&&window.devicePixelRatio>1?0:.5,c=t===hr||t===Ln?-1:1,u=t===Ln||t===dr?"x":"y",d=t===hr||t===mr?xu:Mu;function f(h){var m=i??(e.ticks?e.ticks.apply(e,n):e.domain()),g=r??(e.tickFormat?e.tickFormat.apply(e,n):Iu),p=Math.max(s,0)+l,_=e.range(),w=+_[0]+a,C=+_[_.length-1]+a,b=(e.bandwidth?Nu:Au)(e.copy(),a),I=h.selection?h.selection():h,T=I.selectAll(".domain").data([null]),M=I.selectAll(".tick").data(m,e).order(),E=M.exit(),A=M.enter().append("g").attr("class","tick"),O=M.select("line"),D=M.select("text");T=T.merge(T.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),M=M.merge(A),O=O.merge(A.append("line").attr("stroke","currentColor").attr(u+"2",c*s)),D=D.merge(A.append("text").attr("fill","currentColor").attr(u,c*p).attr("dy",t===hr?"0em":t===mr?"0.71em":"0.32em")),h!==I&&(T=T.transition(h),M=M.transition(h),O=O.transition(h),D=D.transition(h),E=E.transition(h).attr("opacity",Ys).attr("transform",function(B){return isFinite(B=b(B))?d(B+a):this.getAttribute("transform")}),A.attr("opacity",Ys).attr("transform",function(B){var R=this.parentNode.__axis;return d((R&&isFinite(R=R(B))?R:b(B))+a)})),E.remove(),T.attr("d",t===Ln||t===dr?o?"M"+c*o+","+w+"H"+a+"V"+C+"H"+c*o:"M"+a+","+w+"V"+C:o?"M"+w+","+c*o+"V"+a+"H"+C+"V"+c*o:"M"+w+","+a+"H"+C),M.attr("opacity",1).attr("transform",function(B){return d(b(B)+a)}),O.attr(u+"2",c*s),D.attr(u,c*p).text(g),I.filter(Tu).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",t===dr?"start":t===Ln?"end":"middle"),I.each(function(){this.__axis=b})}return f.scale=function(h){return arguments.length?(e=h,f):e},f.ticks=function(){return n=Array.from(arguments),f},f.tickArguments=function(h){return arguments.length?(n=h==null?[]:Array.from(h),f):n.slice()},f.tickValues=function(h){return arguments.length?(i=h==null?null:Array.from(h),f):i&&i.slice()},f.tickFormat=function(h){return arguments.length?(r=h,f):r},f.tickSize=function(h){return arguments.length?(s=o=+h,f):s},f.tickSizeInner=function(h){return arguments.length?(s=+h,f):s},f.tickSizeOuter=function(h){return arguments.length?(o=+h,f):o},f.tickPadding=function(h){return arguments.length?(l=+h,f):l},f.offset=function(h){return arguments.length?(a=+h,f):a},f}function Ou(t){return Xs(mr,t)}function Pu(t){return Xs(Ln,t)}var Lu={value:()=>{}};function Dn(){for(var t=0,e=arguments.length,n={},i;t<e;++t){if(!(i=arguments[t]+"")||i in n||/[\s.]/.test(i))throw new Error("illegal type: "+i);n[i]=[]}return new mi(n)}function mi(t){this._=t}function Du(t,e){return t.trim().split(/^|\s+/).map(function(n){var i="",r=n.indexOf(".");if(r>=0&&(i=n.slice(r+1),n=n.slice(0,r)),n&&!e.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:i}})}mi.prototype=Dn.prototype={constructor:mi,on:function(t,e){var n=this._,i=Du(t+"",n),r,s=-1,o=i.length;if(arguments.length<2){for(;++s<o;)if((r=(t=i[s]).type)&&(r=Ru(n[r],t.name)))return r;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++s<o;)if(r=(t=i[s]).type)n[r]=Js(n[r],t.name,e);else if(e==null)for(r in n)n[r]=Js(n[r],t.name,null);return this},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new mi(t)},call:function(t,e){if((r=arguments.length-2)>0)for(var n=new Array(r),i=0,r,s;i<r;++i)n[i]=arguments[i+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(s=this._[t],i=0,r=s.length;i<r;++i)s[i].value.apply(e,n)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var i=this._[t],r=0,s=i.length;r<s;++r)i[r].value.apply(e,n)}};function Ru(t,e){for(var n=0,i=t.length,r;n<i;++n)if((r=t[n]).name===e)return r.value}function Js(t,e,n){for(var i=0,r=t.length;i<r;++i)if(t[i].name===e){t[i]=Lu,t=t.slice(0,i).concat(t.slice(i+1));break}return n!=null&&t.push({name:e,value:n}),t}var pr="http://www.w3.org/1999/xhtml";const Qs={svg:"http://www.w3.org/2000/svg",xhtml:pr,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function pi(t){var e=t+="",n=e.indexOf(":");return n>=0&&(e=t.slice(0,n))!=="xmlns"&&(t=t.slice(n+1)),Qs.hasOwnProperty(e)?{space:Qs[e],local:t}:t}function $u(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===pr&&e.documentElement.namespaceURI===pr?e.createElement(t):e.createElementNS(n,t)}}function zu(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function Zs(t){var e=pi(t);return(e.local?zu:$u)(e)}function ju(){}function gr(t){return t==null?ju:function(){return this.querySelector(t)}}function Fu(t){typeof t!="function"&&(t=gr(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var s=e[r],o=s.length,l=i[r]=new Array(o),a,c,u=0;u<o;++u)(a=s[u])&&(c=t.call(a,a.__data__,u,s))&&("__data__"in a&&(c.__data__=a.__data__),l[u]=c);return new dt(i,this._parents)}function Vu(t){return t==null?[]:Array.isArray(t)?t:Array.from(t)}function Hu(){return[]}function eo(t){return t==null?Hu:function(){return this.querySelectorAll(t)}}function Uu(t){return function(){return Vu(t.apply(this,arguments))}}function Bu(t){typeof t=="function"?t=Uu(t):t=eo(t);for(var e=this._groups,n=e.length,i=[],r=[],s=0;s<n;++s)for(var o=e[s],l=o.length,a,c=0;c<l;++c)(a=o[c])&&(i.push(t.call(a,a.__data__,c,o)),r.push(a));return new dt(i,r)}function to(t){return function(){return this.matches(t)}}function no(t){return function(e){return e.matches(t)}}var qu=Array.prototype.find;function Ku(t){return function(){return qu.call(this.children,t)}}function Wu(){return this.firstElementChild}function Gu(t){return this.select(t==null?Wu:Ku(typeof t=="function"?t:no(t)))}var Yu=Array.prototype.filter;function Xu(){return Array.from(this.children)}function Ju(t){return function(){return Yu.call(this.children,t)}}function Qu(t){return this.selectAll(t==null?Xu:Ju(typeof t=="function"?t:no(t)))}function Zu(t){typeof t!="function"&&(t=to(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var s=e[r],o=s.length,l=i[r]=[],a,c=0;c<o;++c)(a=s[c])&&t.call(a,a.__data__,c,s)&&l.push(a);return new dt(i,this._parents)}function io(t){return new Array(t.length)}function ef(){return new dt(this._enter||this._groups.map(io),this._parents)}function gi(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}gi.prototype={constructor:gi,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function tf(t){return function(){return t}}function nf(t,e,n,i,r,s){for(var o=0,l,a=e.length,c=s.length;o<c;++o)(l=e[o])?(l.__data__=s[o],i[o]=l):n[o]=new gi(t,s[o]);for(;o<a;++o)(l=e[o])&&(r[o]=l)}function rf(t,e,n,i,r,s,o){var l,a,c=new Map,u=e.length,d=s.length,f=new Array(u),h;for(l=0;l<u;++l)(a=e[l])&&(f[l]=h=o.call(a,a.__data__,l,e)+"",c.has(h)?r[l]=a:c.set(h,a));for(l=0;l<d;++l)h=o.call(t,s[l],l,s)+"",(a=c.get(h))?(i[l]=a,a.__data__=s[l],c.delete(h)):n[l]=new gi(t,s[l]);for(l=0;l<u;++l)(a=e[l])&&c.get(f[l])===a&&(r[l]=a)}function sf(t){return t.__data__}function of(t,e){if(!arguments.length)return Array.from(this,sf);var n=e?rf:nf,i=this._parents,r=this._groups;typeof t!="function"&&(t=tf(t));for(var s=r.length,o=new Array(s),l=new Array(s),a=new Array(s),c=0;c<s;++c){var u=i[c],d=r[c],f=d.length,h=lf(t.call(u,u&&u.__data__,c,i)),m=h.length,g=l[c]=new Array(m),p=o[c]=new Array(m),_=a[c]=new Array(f);n(u,d,g,p,_,h,e);for(var w=0,C=0,b,I;w<m;++w)if(b=g[w]){for(w>=C&&(C=w+1);!(I=p[C])&&++C<m;);b._next=I||null}}return o=new dt(o,i),o._enter=l,o._exit=a,o}function lf(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function af(){return new dt(this._exit||this._groups.map(io),this._parents)}function cf(t,e,n){var i=this.enter(),r=this,s=this.exit();return typeof t=="function"?(i=t(i),i&&(i=i.selection())):i=i.append(t+""),e!=null&&(r=e(r),r&&(r=r.selection())),n==null?s.remove():n(s),i&&r?i.merge(r).order():r}function uf(t){for(var e=t.selection?t.selection():t,n=this._groups,i=e._groups,r=n.length,s=i.length,o=Math.min(r,s),l=new Array(r),a=0;a<o;++a)for(var c=n[a],u=i[a],d=c.length,f=l[a]=new Array(d),h,m=0;m<d;++m)(h=c[m]||u[m])&&(f[m]=h);for(;a<r;++a)l[a]=n[a];return new dt(l,this._parents)}function ff(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var i=t[e],r=i.length-1,s=i[r],o;--r>=0;)(o=i[r])&&(s&&o.compareDocumentPosition(s)^4&&s.parentNode.insertBefore(o,s),s=o);return this}function hf(t){t||(t=df);function e(d,f){return d&&f?t(d.__data__,f.__data__):!d-!f}for(var n=this._groups,i=n.length,r=new Array(i),s=0;s<i;++s){for(var o=n[s],l=o.length,a=r[s]=new Array(l),c,u=0;u<l;++u)(c=o[u])&&(a[u]=c);a.sort(e)}return new dt(r,this._parents).order()}function df(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function mf(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function pf(){return Array.from(this)}function gf(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var i=t[e],r=0,s=i.length;r<s;++r){var o=i[r];if(o)return o}return null}function _f(){let t=0;for(const e of this)++t;return t}function vf(){return!this.node()}function yf(t){for(var e=this._groups,n=0,i=e.length;n<i;++n)for(var r=e[n],s=0,o=r.length,l;s<o;++s)(l=r[s])&&t.call(l,l.__data__,s,r);return this}function bf(t){return function(){this.removeAttribute(t)}}function wf(t){return function(){this.removeAttributeNS(t.space,t.local)}}function Sf(t,e){return function(){this.setAttribute(t,e)}}function kf(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function Ef(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttribute(t):this.setAttribute(t,n)}}function Cf(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function If(t,e){var n=pi(t);if(arguments.length<2){var i=this.node();return n.local?i.getAttributeNS(n.space,n.local):i.getAttribute(n)}return this.each((e==null?n.local?wf:bf:typeof e=="function"?n.local?Cf:Ef:n.local?kf:Sf)(n,e))}function ro(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function xf(t){return function(){this.style.removeProperty(t)}}function Mf(t,e,n){return function(){this.style.setProperty(t,e,n)}}function Af(t,e,n){return function(){var i=e.apply(this,arguments);i==null?this.style.removeProperty(t):this.style.setProperty(t,i,n)}}function Nf(t,e,n){return arguments.length>1?this.each((e==null?xf:typeof e=="function"?Af:Mf)(t,e,n??"")):bn(this.node(),t)}function bn(t,e){return t.style.getPropertyValue(e)||ro(t).getComputedStyle(t,null).getPropertyValue(e)}function Tf(t){return function(){delete this[t]}}function Of(t,e){return function(){this[t]=e}}function Pf(t,e){return function(){var n=e.apply(this,arguments);n==null?delete this[t]:this[t]=n}}function Lf(t,e){return arguments.length>1?this.each((e==null?Tf:typeof e=="function"?Pf:Of)(t,e)):this.node()[t]}function so(t){return t.trim().split(/^|\s+/)}function _r(t){return t.classList||new oo(t)}function oo(t){this._node=t,this._names=so(t.getAttribute("class")||"")}oo.prototype={add:function(t){var e=this._names.indexOf(t);e<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function lo(t,e){for(var n=_r(t),i=-1,r=e.length;++i<r;)n.add(e[i])}function ao(t,e){for(var n=_r(t),i=-1,r=e.length;++i<r;)n.remove(e[i])}function Df(t){return function(){lo(this,t)}}function Rf(t){return function(){ao(this,t)}}function $f(t,e){return function(){(e.apply(this,arguments)?lo:ao)(this,t)}}function zf(t,e){var n=so(t+"");if(arguments.length<2){for(var i=_r(this.node()),r=-1,s=n.length;++r<s;)if(!i.contains(n[r]))return!1;return!0}return this.each((typeof e=="function"?$f:e?Df:Rf)(n,e))}function jf(){this.textContent=""}function Ff(t){return function(){this.textContent=t}}function Vf(t){return function(){var e=t.apply(this,arguments);this.textContent=e??""}}function Hf(t){return arguments.length?this.each(t==null?jf:(typeof t=="function"?Vf:Ff)(t)):this.node().textContent}function Uf(){this.innerHTML=""}function Bf(t){return function(){this.innerHTML=t}}function qf(t){return function(){var e=t.apply(this,arguments);this.innerHTML=e??""}}function Kf(t){return arguments.length?this.each(t==null?Uf:(typeof t=="function"?qf:Bf)(t)):this.node().innerHTML}function Wf(){this.nextSibling&&this.parentNode.appendChild(this)}function Gf(){return this.each(Wf)}function Yf(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Xf(){return this.each(Yf)}function Jf(t){var e=typeof t=="function"?t:Zs(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function Qf(){return null}function Zf(t,e){var n=typeof t=="function"?t:Zs(t),i=e==null?Qf:typeof e=="function"?e:gr(e);return this.select(function(){return this.insertBefore(n.apply(this,arguments),i.apply(this,arguments)||null)})}function eh(){var t=this.parentNode;t&&t.removeChild(this)}function th(){return this.each(eh)}function nh(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function ih(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function rh(t){return this.select(t?ih:nh)}function sh(t){return arguments.length?this.property("__data__",t):this.node().__data__}function oh(t){return function(e){t.call(this,e,this.__data__)}}function lh(t){return t.trim().split(/^|\s+/).map(function(e){var n="",i=e.indexOf(".");return i>=0&&(n=e.slice(i+1),e=e.slice(0,i)),{type:e,name:n}})}function ah(t){return function(){var e=this.__on;if(e){for(var n=0,i=-1,r=e.length,s;n<r;++n)s=e[n],(!t.type||s.type===t.type)&&s.name===t.name?this.removeEventListener(s.type,s.listener,s.options):e[++i]=s;++i?e.length=i:delete this.__on}}}function ch(t,e,n){return function(){var i=this.__on,r,s=oh(e);if(i){for(var o=0,l=i.length;o<l;++o)if((r=i[o]).type===t.type&&r.name===t.name){this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=s,r.options=n),r.value=e;return}}this.addEventListener(t.type,s,n),r={type:t.type,name:t.name,value:e,listener:s,options:n},i?i.push(r):this.__on=[r]}}function uh(t,e,n){var i=lh(t+""),r,s=i.length,o;if(arguments.length<2){var l=this.node().__on;if(l){for(var a=0,c=l.length,u;a<c;++a)for(r=0,u=l[a];r<s;++r)if((o=i[r]).type===u.type&&o.name===u.name)return u.value}return}for(l=e?ch:ah,r=0;r<s;++r)this.each(l(i[r],e,n));return this}function co(t,e,n){var i=ro(t),r=i.CustomEvent;typeof r=="function"?r=new r(e,n):(r=i.document.createEvent("Event"),n?(r.initEvent(e,n.bubbles,n.cancelable),r.detail=n.detail):r.initEvent(e,!1,!1)),t.dispatchEvent(r)}function fh(t,e){return function(){return co(this,t,e)}}function hh(t,e){return function(){return co(this,t,e.apply(this,arguments))}}function dh(t,e){return this.each((typeof e=="function"?hh:fh)(t,e))}function*mh(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var i=t[e],r=0,s=i.length,o;r<s;++r)(o=i[r])&&(yield o)}var uo=[null];function dt(t,e){this._groups=t,this._parents=e}function Rn(){return new dt([[document.documentElement]],uo)}function ph(){return this}dt.prototype=Rn.prototype={constructor:dt,select:Fu,selectAll:Bu,selectChild:Gu,selectChildren:Qu,filter:Zu,data:of,enter:ef,exit:af,join:cf,merge:uf,selection:ph,order:ff,sort:hf,call:mf,nodes:pf,node:gf,size:_f,empty:vf,each:yf,attr:If,style:Nf,property:Lf,classed:zf,text:Hf,html:Kf,raise:Gf,lower:Xf,append:Jf,insert:Zf,remove:th,clone:rh,datum:sh,on:uh,dispatch:dh,[Symbol.iterator]:mh};function Xe(t){return typeof t=="string"?new dt([[document.querySelector(t)]],[document.documentElement]):new dt([[t]],uo)}function gh(t){let e;for(;e=t.sourceEvent;)t=e;return t}function tt(t,e){if(t=gh(t),e===void 0&&(e=t.currentTarget),e){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var i=n.createSVGPoint();return i.x=t.clientX,i.y=t.clientY,i=i.matrixTransform(e.getScreenCTM().inverse()),[i.x,i.y]}if(e.getBoundingClientRect){var r=e.getBoundingClientRect();return[t.clientX-r.left-e.clientLeft,t.clientY-r.top-e.clientTop]}}return[t.pageX,t.pageY]}const _h={passive:!1},$n={capture:!0,passive:!1};function vr(t){t.stopImmediatePropagation()}function wn(t){t.preventDefault(),t.stopImmediatePropagation()}function fo(t){var e=t.document.documentElement,n=Xe(t).on("dragstart.drag",wn,$n);"onselectstart"in e?n.on("selectstart.drag",wn,$n):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function ho(t,e){var n=t.document.documentElement,i=Xe(t).on("dragstart.drag",null);e&&(i.on("click.drag",wn,$n),setTimeout(function(){i.on("click.drag",null)},0)),"onselectstart"in n?i.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}const _i=t=>()=>t;function yr(t,{sourceEvent:e,subject:n,target:i,identifier:r,active:s,x:o,y:l,dx:a,dy:c,dispatch:u}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},subject:{value:n,enumerable:!0,configurable:!0},target:{value:i,enumerable:!0,configurable:!0},identifier:{value:r,enumerable:!0,configurable:!0},active:{value:s,enumerable:!0,configurable:!0},x:{value:o,enumerable:!0,configurable:!0},y:{value:l,enumerable:!0,configurable:!0},dx:{value:a,enumerable:!0,configurable:!0},dy:{value:c,enumerable:!0,configurable:!0},_:{value:u}})}yr.prototype.on=function(){var t=this._.on.apply(this._,arguments);return t===this._?this:t};function vh(t){return!t.ctrlKey&&!t.button}function yh(){return this.parentNode}function bh(t,e){return e??{x:t.x,y:t.y}}function wh(){return navigator.maxTouchPoints||"ontouchstart"in this}function Sh(){var t=vh,e=yh,n=bh,i=wh,r={},s=Dn("start","drag","end"),o=0,l,a,c,u,d=0;function f(b){b.on("mousedown.drag",h).filter(i).on("touchstart.drag",p).on("touchmove.drag",_,_h).on("touchend.drag touchcancel.drag",w).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function h(b,I){if(!(u||!t.call(this,b,I))){var T=C(this,e.call(this,b,I),b,I,"mouse");T&&(Xe(b.view).on("mousemove.drag",m,$n).on("mouseup.drag",g,$n),fo(b.view),vr(b),c=!1,l=b.clientX,a=b.clientY,T("start",b))}}function m(b){if(wn(b),!c){var I=b.clientX-l,T=b.clientY-a;c=I*I+T*T>d}r.mouse("drag",b)}function g(b){Xe(b.view).on("mousemove.drag mouseup.drag",null),ho(b.view,c),wn(b),r.mouse("end",b)}function p(b,I){if(t.call(this,b,I)){var T=b.changedTouches,M=e.call(this,b,I),E=T.length,A,O;for(A=0;A<E;++A)(O=C(this,M,b,I,T[A].identifier,T[A]))&&(vr(b),O("start",b,T[A]))}}function _(b){var I=b.changedTouches,T=I.length,M,E;for(M=0;M<T;++M)(E=r[I[M].identifier])&&(wn(b),E("drag",b,I[M]))}function w(b){var I=b.changedTouches,T=I.length,M,E;for(u&&clearTimeout(u),u=setTimeout(function(){u=null},500),M=0;M<T;++M)(E=r[I[M].identifier])&&(vr(b),E("end",b,I[M]))}function C(b,I,T,M,E,A){var O=s.copy(),D=tt(A||T,I),B,R,S;if((S=n.call(b,new yr("beforestart",{sourceEvent:T,target:f,identifier:E,active:o,x:D[0],y:D[1],dx:0,dy:0,dispatch:O}),M))!=null)return B=S.x-D[0]||0,R=S.y-D[1]||0,function L(x,F,H){var U=D,Y;switch(x){case"start":r[E]=L,Y=o++;break;case"end":delete r[E],--o;case"drag":D=tt(H||F,I),Y=o;break}O.call(x,b,new yr(x,{sourceEvent:F,subject:S,target:f,identifier:E,active:Y,x:D[0]+B,y:D[1]+R,dx:D[0]-U[0],dy:D[1]-U[1],dispatch:O}),M)}}return f.filter=function(b){return arguments.length?(t=typeof b=="function"?b:_i(!!b),f):t},f.container=function(b){return arguments.length?(e=typeof b=="function"?b:_i(b),f):e},f.subject=function(b){return arguments.length?(n=typeof b=="function"?b:_i(b),f):n},f.touchable=function(b){return arguments.length?(i=typeof b=="function"?b:_i(!!b),f):i},f.on=function(){var b=s.on.apply(s,arguments);return b===s?f:b},f.clickDistance=function(b){return arguments.length?(d=(b=+b)*b,f):Math.sqrt(d)},f}function br(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function mo(t,e){var n=Object.create(t.prototype);for(var i in e)n[i]=e[i];return n}function zn(){}var jn=.7,vi=1/jn,Sn="\\s*([+-]?\\d+)\\s*",Fn="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",At="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",kh=/^#([0-9a-f]{3,8})$/,Eh=new RegExp(`^rgb\\(${Sn},${Sn},${Sn}\\)$`),Ch=new RegExp(`^rgb\\(${At},${At},${At}\\)$`),Ih=new RegExp(`^rgba\\(${Sn},${Sn},${Sn},${Fn}\\)$`),xh=new RegExp(`^rgba\\(${At},${At},${At},${Fn}\\)$`),Mh=new RegExp(`^hsl\\(${Fn},${At},${At}\\)$`),Ah=new RegExp(`^hsla\\(${Fn},${At},${At},${Fn}\\)$`),po={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};br(zn,en,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:go,formatHex:go,formatHex8:Nh,formatHsl:Th,formatRgb:_o,toString:_o});function go(){return this.rgb().formatHex()}function Nh(){return this.rgb().formatHex8()}function Th(){return So(this).formatHsl()}function _o(){return this.rgb().formatRgb()}function en(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=kh.exec(t))?(n=e[1].length,e=parseInt(e[1],16),n===6?vo(e):n===3?new at(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):n===8?yi(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):n===4?yi(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=Eh.exec(t))?new at(e[1],e[2],e[3],1):(e=Ch.exec(t))?new at(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=Ih.exec(t))?yi(e[1],e[2],e[3],e[4]):(e=xh.exec(t))?yi(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=Mh.exec(t))?wo(e[1],e[2]/100,e[3]/100,1):(e=Ah.exec(t))?wo(e[1],e[2]/100,e[3]/100,e[4]):po.hasOwnProperty(t)?vo(po[t]):t==="transparent"?new at(NaN,NaN,NaN,0):null}function vo(t){return new at(t>>16&255,t>>8&255,t&255,1)}function yi(t,e,n,i){return i<=0&&(t=e=n=NaN),new at(t,e,n,i)}function Oh(t){return t instanceof zn||(t=en(t)),t?(t=t.rgb(),new at(t.r,t.g,t.b,t.opacity)):new at}function wr(t,e,n,i){return arguments.length===1?Oh(t):new at(t,e,n,i??1)}function at(t,e,n,i){this.r=+t,this.g=+e,this.b=+n,this.opacity=+i}br(at,wr,mo(zn,{brighter(t){return t=t==null?vi:Math.pow(vi,t),new at(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?jn:Math.pow(jn,t),new at(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new at(tn(this.r),tn(this.g),tn(this.b),bi(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:yo,formatHex:yo,formatHex8:Ph,formatRgb:bo,toString:bo}));function yo(){return`#${nn(this.r)}${nn(this.g)}${nn(this.b)}`}function Ph(){return`#${nn(this.r)}${nn(this.g)}${nn(this.b)}${nn((isNaN(this.opacity)?1:this.opacity)*255)}`}function bo(){const t=bi(this.opacity);return`${t===1?"rgb(":"rgba("}${tn(this.r)}, ${tn(this.g)}, ${tn(this.b)}${t===1?")":`, ${t})`}`}function bi(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function tn(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function nn(t){return t=tn(t),(t<16?"0":"")+t.toString(16)}function wo(t,e,n,i){return i<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new St(t,e,n,i)}function So(t){if(t instanceof St)return new St(t.h,t.s,t.l,t.opacity);if(t instanceof zn||(t=en(t)),!t)return new St;if(t instanceof St)return t;t=t.rgb();var e=t.r/255,n=t.g/255,i=t.b/255,r=Math.min(e,n,i),s=Math.max(e,n,i),o=NaN,l=s-r,a=(s+r)/2;return l?(e===s?o=(n-i)/l+(n<i)*6:n===s?o=(i-e)/l+2:o=(e-n)/l+4,l/=a<.5?s+r:2-s-r,o*=60):l=a>0&&a<1?0:o,new St(o,l,a,t.opacity)}function Sr(t,e,n,i){return arguments.length===1?So(t):new St(t,e,n,i??1)}function St(t,e,n,i){this.h=+t,this.s=+e,this.l=+n,this.opacity=+i}br(St,Sr,mo(zn,{brighter(t){return t=t==null?vi:Math.pow(vi,t),new St(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?jn:Math.pow(jn,t),new St(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,i=n+(n<.5?n:1-n)*e,r=2*n-i;return new at(kr(t>=240?t-240:t+120,r,i),kr(t,r,i),kr(t<120?t+240:t-120,r,i),this.opacity)},clamp(){return new St(ko(this.h),wi(this.s),wi(this.l),bi(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=bi(this.opacity);return`${t===1?"hsl(":"hsla("}${ko(this.h)}, ${wi(this.s)*100}%, ${wi(this.l)*100}%${t===1?")":`, ${t})`}`}}));function ko(t){return t=(t||0)%360,t<0?t+360:t}function wi(t){return Math.max(0,Math.min(1,t||0))}function kr(t,e,n){return(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)*255}const Er=t=>()=>t;function Lh(t,e){return function(n){return t+n*e}}function Dh(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(i){return Math.pow(t+i*e,n)}}function Rh(t){return(t=+t)==1?Eo:function(e,n){return n-e?Dh(e,n,t):Er(isNaN(e)?n:e)}}function Eo(t,e){var n=e-t;return n?Lh(t,n):Er(isNaN(t)?e:t)}const Si=function t(e){var n=Rh(e);function i(r,s){var o=n((r=wr(r)).r,(s=wr(s)).r),l=n(r.g,s.g),a=n(r.b,s.b),c=Eo(r.opacity,s.opacity);return function(u){return r.r=o(u),r.g=l(u),r.b=a(u),r.opacity=c(u),r+""}}return i.gamma=t,i}(1);function $h(t,e){e||(e=[]);var n=t?Math.min(e.length,t.length):0,i=e.slice(),r;return function(s){for(r=0;r<n;++r)i[r]=t[r]*(1-s)+e[r]*s;return i}}function zh(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function jh(t,e){var n=e?e.length:0,i=t?Math.min(n,t.length):0,r=new Array(i),s=new Array(n),o;for(o=0;o<i;++o)r[o]=xr(t[o],e[o]);for(;o<n;++o)s[o]=e[o];return function(l){for(o=0;o<i;++o)s[o]=r[o](l);return s}}function Fh(t,e){var n=new Date;return t=+t,e=+e,function(i){return n.setTime(t*(1-i)+e*i),n}}function kt(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}function Vh(t,e){var n={},i={},r;(t===null||typeof t!="object")&&(t={}),(e===null||typeof e!="object")&&(e={});for(r in e)r in t?n[r]=xr(t[r],e[r]):i[r]=e[r];return function(s){for(r in n)i[r]=n[r](s);return i}}var Cr=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Ir=new RegExp(Cr.source,"g");function Hh(t){return function(){return t}}function Uh(t){return function(e){return t(e)+""}}function Co(t,e){var n=Cr.lastIndex=Ir.lastIndex=0,i,r,s,o=-1,l=[],a=[];for(t=t+"",e=e+"";(i=Cr.exec(t))&&(r=Ir.exec(e));)(s=r.index)>n&&(s=e.slice(n,s),l[o]?l[o]+=s:l[++o]=s),(i=i[0])===(r=r[0])?l[o]?l[o]+=r:l[++o]=r:(l[++o]=null,a.push({i:o,x:kt(i,r)})),n=Ir.lastIndex;return n<e.length&&(s=e.slice(n),l[o]?l[o]+=s:l[++o]=s),l.length<2?a[0]?Uh(a[0].x):Hh(e):(e=a.length,function(c){for(var u=0,d;u<e;++u)l[(d=a[u]).i]=d.x(c);return l.join("")})}function xr(t,e){var n=typeof e,i;return e==null||n==="boolean"?Er(e):(n==="number"?kt:n==="string"?(i=en(e))?(e=i,Si):Co:e instanceof en?Si:e instanceof Date?Fh:zh(e)?$h:Array.isArray(e)?jh:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?Vh:kt)(t,e)}function Bh(t,e){return t=+t,e=+e,function(n){return Math.round(t*(1-n)+e*n)}}var Io=180/Math.PI,Mr={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function xo(t,e,n,i,r,s){var o,l,a;return(o=Math.sqrt(t*t+e*e))&&(t/=o,e/=o),(a=t*n+e*i)&&(n-=t*a,i-=e*a),(l=Math.sqrt(n*n+i*i))&&(n/=l,i/=l,a/=l),t*i<e*n&&(t=-t,e=-e,a=-a,o=-o),{translateX:r,translateY:s,rotate:Math.atan2(e,t)*Io,skewX:Math.atan(a)*Io,scaleX:o,scaleY:l}}var ki;function qh(t){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?Mr:xo(e.a,e.b,e.c,e.d,e.e,e.f)}function Kh(t){return t==null||(ki||(ki=document.createElementNS("http://www.w3.org/2000/svg","g")),ki.setAttribute("transform",t),!(t=ki.transform.baseVal.consolidate()))?Mr:(t=t.matrix,xo(t.a,t.b,t.c,t.d,t.e,t.f))}function Mo(t,e,n,i){function r(c){return c.length?c.pop()+" ":""}function s(c,u,d,f,h,m){if(c!==d||u!==f){var g=h.push("translate(",null,e,null,n);m.push({i:g-4,x:kt(c,d)},{i:g-2,x:kt(u,f)})}else(d||f)&&h.push("translate("+d+e+f+n)}function o(c,u,d,f){c!==u?(c-u>180?u+=360:u-c>180&&(c+=360),f.push({i:d.push(r(d)+"rotate(",null,i)-2,x:kt(c,u)})):u&&d.push(r(d)+"rotate("+u+i)}function l(c,u,d,f){c!==u?f.push({i:d.push(r(d)+"skewX(",null,i)-2,x:kt(c,u)}):u&&d.push(r(d)+"skewX("+u+i)}function a(c,u,d,f,h,m){if(c!==d||u!==f){var g=h.push(r(h)+"scale(",null,",",null,")");m.push({i:g-4,x:kt(c,d)},{i:g-2,x:kt(u,f)})}else(d!==1||f!==1)&&h.push(r(h)+"scale("+d+","+f+")")}return function(c,u){var d=[],f=[];return c=t(c),u=t(u),s(c.translateX,c.translateY,u.translateX,u.translateY,d,f),o(c.rotate,u.rotate,d,f),l(c.skewX,u.skewX,d,f),a(c.scaleX,c.scaleY,u.scaleX,u.scaleY,d,f),c=u=null,function(h){for(var m=-1,g=f.length,p;++m<g;)d[(p=f[m]).i]=p.x(h);return d.join("")}}}var Wh=Mo(qh,"px, ","px)","deg)"),Gh=Mo(Kh,", ",")",")"),Yh=1e-12;function Ao(t){return((t=Math.exp(t))+1/t)/2}function Xh(t){return((t=Math.exp(t))-1/t)/2}function Jh(t){return((t=Math.exp(2*t))-1)/(t+1)}const Qh=function t(e,n,i){function r(s,o){var l=s[0],a=s[1],c=s[2],u=o[0],d=o[1],f=o[2],h=u-l,m=d-a,g=h*h+m*m,p,_;if(g<Yh)_=Math.log(f/c)/e,p=function(M){return[l+M*h,a+M*m,c*Math.exp(e*M*_)]};else{var w=Math.sqrt(g),C=(f*f-c*c+i*g)/(2*c*n*w),b=(f*f-c*c-i*g)/(2*f*n*w),I=Math.log(Math.sqrt(C*C+1)-C),T=Math.log(Math.sqrt(b*b+1)-b);_=(T-I)/e,p=function(M){var E=M*_,A=Ao(I),O=c/(n*w)*(A*Jh(e*E+I)-Xh(I));return[l+O*h,a+O*m,c*A/Ao(e*E+I)]}}return p.duration=_*1e3*e/Math.SQRT2,p}return r.rho=function(s){var o=Math.max(.001,+s),l=o*o,a=l*l;return t(o,l,a)},r}(Math.SQRT2,2,4);var kn=0,Vn=0,Hn=0,No=1e3,Ei,Un,Ci=0,rn=0,Ii=0,Bn=typeof performance=="object"&&performance.now?performance:Date,To=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function Ar(){return rn||(To(Zh),rn=Bn.now()+Ii)}function Zh(){rn=0}function xi(){this._call=this._time=this._next=null}xi.prototype=Nr.prototype={constructor:xi,restart:function(t,e,n){if(typeof t!="function")throw new TypeError("callback is not a function");n=(n==null?Ar():+n)+(e==null?0:+e),!this._next&&Un!==this&&(Un?Un._next=this:Ei=this,Un=this),this._call=t,this._time=n,Tr()},stop:function(){this._call&&(this._call=null,this._time=1/0,Tr())}};function Nr(t,e,n){var i=new xi;return i.restart(t,e,n),i}function ed(){Ar(),++kn;for(var t=Ei,e;t;)(e=rn-t._time)>=0&&t._call.call(void 0,e),t=t._next;--kn}function Oo(){rn=(Ci=Bn.now())+Ii,kn=Vn=0;try{ed()}finally{kn=0,nd(),rn=0}}function td(){var t=Bn.now(),e=t-Ci;e>No&&(Ii-=e,Ci=t)}function nd(){for(var t,e=Ei,n,i=1/0;e;)e._call?(i>e._time&&(i=e._time),t=e,e=e._next):(n=e._next,e._next=null,e=t?t._next=n:Ei=n);Un=t,Tr(i)}function Tr(t){if(!kn){Vn&&(Vn=clearTimeout(Vn));var e=t-rn;e>24?(t<1/0&&(Vn=setTimeout(Oo,t-Bn.now()-Ii)),Hn&&(Hn=clearInterval(Hn))):(Hn||(Ci=Bn.now(),Hn=setInterval(td,No)),kn=1,To(Oo))}}function Po(t,e,n){var i=new xi;return e=e==null?0:+e,i.restart(r=>{i.stop(),t(r+e)},e,n),i}var id=Dn("start","end","cancel","interrupt"),rd=[],Lo=0,Do=1,Or=2,Mi=3,Ro=4,Pr=5,Ai=6;function Ni(t,e,n,i,r,s){var o=t.__transition;if(!o)t.__transition={};else if(n in o)return;sd(t,n,{name:e,index:i,group:r,on:id,tween:rd,time:s.time,delay:s.delay,duration:s.duration,ease:s.ease,timer:null,state:Lo})}function Lr(t,e){var n=Et(t,e);if(n.state>Lo)throw new Error("too late; already scheduled");return n}function Nt(t,e){var n=Et(t,e);if(n.state>Mi)throw new Error("too late; already running");return n}function Et(t,e){var n=t.__transition;if(!n||!(n=n[e]))throw new Error("transition not found");return n}function sd(t,e,n){var i=t.__transition,r;i[e]=n,n.timer=Nr(s,0,n.time);function s(c){n.state=Do,n.timer.restart(o,n.delay,n.time),n.delay<=c&&o(c-n.delay)}function o(c){var u,d,f,h;if(n.state!==Do)return a();for(u in i)if(h=i[u],h.name===n.name){if(h.state===Mi)return Po(o);h.state===Ro?(h.state=Ai,h.timer.stop(),h.on.call("interrupt",t,t.__data__,h.index,h.group),delete i[u]):+u<e&&(h.state=Ai,h.timer.stop(),h.on.call("cancel",t,t.__data__,h.index,h.group),delete i[u])}if(Po(function(){n.state===Mi&&(n.state=Ro,n.timer.restart(l,n.delay,n.time),l(c))}),n.state=Or,n.on.call("start",t,t.__data__,n.index,n.group),n.state===Or){for(n.state=Mi,r=new Array(f=n.tween.length),u=0,d=-1;u<f;++u)(h=n.tween[u].value.call(t,t.__data__,n.index,n.group))&&(r[++d]=h);r.length=d+1}}function l(c){for(var u=c<n.duration?n.ease.call(null,c/n.duration):(n.timer.restart(a),n.state=Pr,1),d=-1,f=r.length;++d<f;)r[d].call(t,u);n.state===Pr&&(n.on.call("end",t,t.__data__,n.index,n.group),a())}function a(){n.state=Ai,n.timer.stop(),delete i[e];for(var c in i)return;delete t.__transition}}function Ti(t,e){var n=t.__transition,i,r,s=!0,o;if(n){e=e==null?null:e+"";for(o in n){if((i=n[o]).name!==e){s=!1;continue}r=i.state>Or&&i.state<Pr,i.state=Ai,i.timer.stop(),i.on.call(r?"interrupt":"cancel",t,t.__data__,i.index,i.group),delete n[o]}s&&delete t.__transition}}function od(t){return this.each(function(){Ti(this,t)})}function ld(t,e){var n,i;return function(){var r=Nt(this,t),s=r.tween;if(s!==n){i=n=s;for(var o=0,l=i.length;o<l;++o)if(i[o].name===e){i=i.slice(),i.splice(o,1);break}}r.tween=i}}function ad(t,e,n){var i,r;if(typeof n!="function")throw new Error;return function(){var s=Nt(this,t),o=s.tween;if(o!==i){r=(i=o).slice();for(var l={name:e,value:n},a=0,c=r.length;a<c;++a)if(r[a].name===e){r[a]=l;break}a===c&&r.push(l)}s.tween=r}}function cd(t,e){var n=this._id;if(t+="",arguments.length<2){for(var i=Et(this.node(),n).tween,r=0,s=i.length,o;r<s;++r)if((o=i[r]).name===t)return o.value;return null}return this.each((e==null?ld:ad)(n,t,e))}function Dr(t,e,n){var i=t._id;return t.each(function(){var r=Nt(this,i);(r.value||(r.value={}))[e]=n.apply(this,arguments)}),function(r){return Et(r,i).value[e]}}function $o(t,e){var n;return(typeof e=="number"?kt:e instanceof en?Si:(n=en(e))?(e=n,Si):Co)(t,e)}function ud(t){return function(){this.removeAttribute(t)}}function fd(t){return function(){this.removeAttributeNS(t.space,t.local)}}function hd(t,e,n){var i,r=n+"",s;return function(){var o=this.getAttribute(t);return o===r?null:o===i?s:s=e(i=o,n)}}function dd(t,e,n){var i,r=n+"",s;return function(){var o=this.getAttributeNS(t.space,t.local);return o===r?null:o===i?s:s=e(i=o,n)}}function md(t,e,n){var i,r,s;return function(){var o,l=n(this),a;return l==null?void this.removeAttribute(t):(o=this.getAttribute(t),a=l+"",o===a?null:o===i&&a===r?s:(r=a,s=e(i=o,l)))}}function pd(t,e,n){var i,r,s;return function(){var o,l=n(this),a;return l==null?void this.removeAttributeNS(t.space,t.local):(o=this.getAttributeNS(t.space,t.local),a=l+"",o===a?null:o===i&&a===r?s:(r=a,s=e(i=o,l)))}}function gd(t,e){var n=pi(t),i=n==="transform"?Gh:$o;return this.attrTween(t,typeof e=="function"?(n.local?pd:md)(n,i,Dr(this,"attr."+t,e)):e==null?(n.local?fd:ud)(n):(n.local?dd:hd)(n,i,e))}function _d(t,e){return function(n){this.setAttribute(t,e.call(this,n))}}function vd(t,e){return function(n){this.setAttributeNS(t.space,t.local,e.call(this,n))}}function yd(t,e){var n,i;function r(){var s=e.apply(this,arguments);return s!==i&&(n=(i=s)&&vd(t,s)),n}return r._value=e,r}function bd(t,e){var n,i;function r(){var s=e.apply(this,arguments);return s!==i&&(n=(i=s)&&_d(t,s)),n}return r._value=e,r}function wd(t,e){var n="attr."+t;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(e==null)return this.tween(n,null);if(typeof e!="function")throw new Error;var i=pi(t);return this.tween(n,(i.local?yd:bd)(i,e))}function Sd(t,e){return function(){Lr(this,t).delay=+e.apply(this,arguments)}}function kd(t,e){return e=+e,function(){Lr(this,t).delay=e}}function Ed(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?Sd:kd)(e,t)):Et(this.node(),e).delay}function Cd(t,e){return function(){Nt(this,t).duration=+e.apply(this,arguments)}}function Id(t,e){return e=+e,function(){Nt(this,t).duration=e}}function xd(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?Cd:Id)(e,t)):Et(this.node(),e).duration}function Md(t,e){if(typeof e!="function")throw new Error;return function(){Nt(this,t).ease=e}}function Ad(t){var e=this._id;return arguments.length?this.each(Md(e,t)):Et(this.node(),e).ease}function Nd(t,e){return function(){var n=e.apply(this,arguments);if(typeof n!="function")throw new Error;Nt(this,t).ease=n}}function Td(t){if(typeof t!="function")throw new Error;return this.each(Nd(this._id,t))}function Od(t){typeof t!="function"&&(t=to(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var s=e[r],o=s.length,l=i[r]=[],a,c=0;c<o;++c)(a=s[c])&&t.call(a,a.__data__,c,s)&&l.push(a);return new zt(i,this._parents,this._name,this._id)}function Pd(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,n=t._groups,i=e.length,r=n.length,s=Math.min(i,r),o=new Array(i),l=0;l<s;++l)for(var a=e[l],c=n[l],u=a.length,d=o[l]=new Array(u),f,h=0;h<u;++h)(f=a[h]||c[h])&&(d[h]=f);for(;l<i;++l)o[l]=e[l];return new zt(o,this._parents,this._name,this._id)}function Ld(t){return(t+"").trim().split(/^|\s+/).every(function(e){var n=e.indexOf(".");return n>=0&&(e=e.slice(0,n)),!e||e==="start"})}function Dd(t,e,n){var i,r,s=Ld(e)?Lr:Nt;return function(){var o=s(this,t),l=o.on;l!==i&&(r=(i=l).copy()).on(e,n),o.on=r}}function Rd(t,e){var n=this._id;return arguments.length<2?Et(this.node(),n).on.on(t):this.each(Dd(n,t,e))}function $d(t){return function(){var e=this.parentNode;for(var n in this.__transition)if(+n!==t)return;e&&e.removeChild(this)}}function zd(){return this.on("end.remove",$d(this._id))}function jd(t){var e=this._name,n=this._id;typeof t!="function"&&(t=gr(t));for(var i=this._groups,r=i.length,s=new Array(r),o=0;o<r;++o)for(var l=i[o],a=l.length,c=s[o]=new Array(a),u,d,f=0;f<a;++f)(u=l[f])&&(d=t.call(u,u.__data__,f,l))&&("__data__"in u&&(d.__data__=u.__data__),c[f]=d,Ni(c[f],e,n,f,c,Et(u,n)));return new zt(s,this._parents,e,n)}function Fd(t){var e=this._name,n=this._id;typeof t!="function"&&(t=eo(t));for(var i=this._groups,r=i.length,s=[],o=[],l=0;l<r;++l)for(var a=i[l],c=a.length,u,d=0;d<c;++d)if(u=a[d]){for(var f=t.call(u,u.__data__,d,a),h,m=Et(u,n),g=0,p=f.length;g<p;++g)(h=f[g])&&Ni(h,e,n,g,f,m);s.push(f),o.push(u)}return new zt(s,o,e,n)}var Vd=Rn.prototype.constructor;function Hd(){return new Vd(this._groups,this._parents)}function Ud(t,e){var n,i,r;return function(){var s=bn(this,t),o=(this.style.removeProperty(t),bn(this,t));return s===o?null:s===n&&o===i?r:r=e(n=s,i=o)}}function zo(t){return function(){this.style.removeProperty(t)}}function Bd(t,e,n){var i,r=n+"",s;return function(){var o=bn(this,t);return o===r?null:o===i?s:s=e(i=o,n)}}function qd(t,e,n){var i,r,s;return function(){var o=bn(this,t),l=n(this),a=l+"";return l==null&&(a=l=(this.style.removeProperty(t),bn(this,t))),o===a?null:o===i&&a===r?s:(r=a,s=e(i=o,l))}}function Kd(t,e){var n,i,r,s="style."+e,o="end."+s,l;return function(){var a=Nt(this,t),c=a.on,u=a.value[s]==null?l||(l=zo(e)):void 0;(c!==n||r!==u)&&(i=(n=c).copy()).on(o,r=u),a.on=i}}function Wd(t,e,n){var i=(t+="")=="transform"?Wh:$o;return e==null?this.styleTween(t,Ud(t,i)).on("end.style."+t,zo(t)):typeof e=="function"?this.styleTween(t,qd(t,i,Dr(this,"style."+t,e))).each(Kd(this._id,t)):this.styleTween(t,Bd(t,i,e),n).on("end.style."+t,null)}function Gd(t,e,n){return function(i){this.style.setProperty(t,e.call(this,i),n)}}function Yd(t,e,n){var i,r;function s(){var o=e.apply(this,arguments);return o!==r&&(i=(r=o)&&Gd(t,o,n)),i}return s._value=e,s}function Xd(t,e,n){var i="style."+(t+="");if(arguments.length<2)return(i=this.tween(i))&&i._value;if(e==null)return this.tween(i,null);if(typeof e!="function")throw new Error;return this.tween(i,Yd(t,e,n??""))}function Jd(t){return function(){this.textContent=t}}function Qd(t){return function(){var e=t(this);this.textContent=e??""}}function Zd(t){return this.tween("text",typeof t=="function"?Qd(Dr(this,"text",t)):Jd(t==null?"":t+""))}function em(t){return function(e){this.textContent=t.call(this,e)}}function tm(t){var e,n;function i(){var r=t.apply(this,arguments);return r!==n&&(e=(n=r)&&em(r)),e}return i._value=t,i}function nm(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(t==null)return this.tween(e,null);if(typeof t!="function")throw new Error;return this.tween(e,tm(t))}function im(){for(var t=this._name,e=this._id,n=jo(),i=this._groups,r=i.length,s=0;s<r;++s)for(var o=i[s],l=o.length,a,c=0;c<l;++c)if(a=o[c]){var u=Et(a,e);Ni(a,t,n,c,o,{time:u.time+u.delay+u.duration,delay:0,duration:u.duration,ease:u.ease})}return new zt(i,this._parents,t,n)}function rm(){var t,e,n=this,i=n._id,r=n.size();return new Promise(function(s,o){var l={value:o},a={value:function(){--r===0&&s()}};n.each(function(){var c=Nt(this,i),u=c.on;u!==t&&(e=(t=u).copy(),e._.cancel.push(l),e._.interrupt.push(l),e._.end.push(a)),c.on=e}),r===0&&s()})}var sm=0;function zt(t,e,n,i){this._groups=t,this._parents=e,this._name=n,this._id=i}function jo(){return++sm}var jt=Rn.prototype;zt.prototype={constructor:zt,select:jd,selectAll:Fd,selectChild:jt.selectChild,selectChildren:jt.selectChildren,filter:Od,merge:Pd,selection:Hd,transition:im,call:jt.call,nodes:jt.nodes,node:jt.node,size:jt.size,empty:jt.empty,each:jt.each,on:Rd,attr:gd,attrTween:wd,style:Wd,styleTween:Xd,text:Zd,textTween:nm,remove:zd,tween:cd,delay:Ed,duration:xd,ease:Ad,easeVarying:Td,end:rm,[Symbol.iterator]:jt[Symbol.iterator]};function om(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}var lm={time:null,delay:0,duration:250,ease:om};function am(t,e){for(var n;!(n=t.__transition)||!(n=n[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return n}function cm(t){var e,n;t instanceof zt?(e=t._id,t=t._name):(e=jo(),(n=lm).time=Ar(),t=t==null?null:t+"");for(var i=this._groups,r=i.length,s=0;s<r;++s)for(var o=i[s],l=o.length,a,c=0;c<l;++c)(a=o[c])&&Ni(a,t,e,c,o,n||am(a,e));return new zt(i,this._parents,t,e)}Rn.prototype.interrupt=od,Rn.prototype.transition=cm;function Fo(t,e){var n,i=1;t==null&&(t=0),e==null&&(e=0);function r(){var s,o=n.length,l,a=0,c=0;for(s=0;s<o;++s)l=n[s],a+=l.x,c+=l.y;for(a=(a/o-t)*i,c=(c/o-e)*i,s=0;s<o;++s)l=n[s],l.x-=a,l.y-=c}return r.initialize=function(s){n=s},r.x=function(s){return arguments.length?(t=+s,r):t},r.y=function(s){return arguments.length?(e=+s,r):e},r.strength=function(s){return arguments.length?(i=+s,r):i},r}function um(t){const e=+this._x.call(null,t),n=+this._y.call(null,t);return Vo(this.cover(e,n),e,n,t)}function Vo(t,e,n,i){if(isNaN(e)||isNaN(n))return t;var r,s=t._root,o={data:i},l=t._x0,a=t._y0,c=t._x1,u=t._y1,d,f,h,m,g,p,_,w;if(!s)return t._root=o,t;for(;s.length;)if((g=e>=(d=(l+c)/2))?l=d:c=d,(p=n>=(f=(a+u)/2))?a=f:u=f,r=s,!(s=s[_=p<<1|g]))return r[_]=o,t;if(h=+t._x.call(null,s.data),m=+t._y.call(null,s.data),e===h&&n===m)return o.next=s,r?r[_]=o:t._root=o,t;do r=r?r[_]=new Array(4):t._root=new Array(4),(g=e>=(d=(l+c)/2))?l=d:c=d,(p=n>=(f=(a+u)/2))?a=f:u=f;while((_=p<<1|g)===(w=(m>=f)<<1|h>=d));return r[w]=s,r[_]=o,t}function fm(t){var e,n,i=t.length,r,s,o=new Array(i),l=new Array(i),a=1/0,c=1/0,u=-1/0,d=-1/0;for(n=0;n<i;++n)isNaN(r=+this._x.call(null,e=t[n]))||isNaN(s=+this._y.call(null,e))||(o[n]=r,l[n]=s,r<a&&(a=r),r>u&&(u=r),s<c&&(c=s),s>d&&(d=s));if(a>u||c>d)return this;for(this.cover(a,c).cover(u,d),n=0;n<i;++n)Vo(this,o[n],l[n],t[n]);return this}function hm(t,e){if(isNaN(t=+t)||isNaN(e=+e))return this;var n=this._x0,i=this._y0,r=this._x1,s=this._y1;if(isNaN(n))r=(n=Math.floor(t))+1,s=(i=Math.floor(e))+1;else{for(var o=r-n||1,l=this._root,a,c;n>t||t>=r||i>e||e>=s;)switch(c=(e<i)<<1|t<n,a=new Array(4),a[c]=l,l=a,o*=2,c){case 0:r=n+o,s=i+o;break;case 1:n=r-o,s=i+o;break;case 2:r=n+o,i=s-o;break;case 3:n=r-o,i=s-o;break}this._root&&this._root.length&&(this._root=l)}return this._x0=n,this._y0=i,this._x1=r,this._y1=s,this}function dm(){var t=[];return this.visit(function(e){if(!e.length)do t.push(e.data);while(e=e.next)}),t}function mm(t){return arguments.length?this.cover(+t[0][0],+t[0][1]).cover(+t[1][0],+t[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function nt(t,e,n,i,r){this.node=t,this.x0=e,this.y0=n,this.x1=i,this.y1=r}function pm(t,e,n){var i,r=this._x0,s=this._y0,o,l,a,c,u=this._x1,d=this._y1,f=[],h=this._root,m,g;for(h&&f.push(new nt(h,r,s,u,d)),n==null?n=1/0:(r=t-n,s=e-n,u=t+n,d=e+n,n*=n);m=f.pop();)if(!(!(h=m.node)||(o=m.x0)>u||(l=m.y0)>d||(a=m.x1)<r||(c=m.y1)<s))if(h.length){var p=(o+a)/2,_=(l+c)/2;f.push(new nt(h[3],p,_,a,c),new nt(h[2],o,_,p,c),new nt(h[1],p,l,a,_),new nt(h[0],o,l,p,_)),(g=(e>=_)<<1|t>=p)&&(m=f[f.length-1],f[f.length-1]=f[f.length-1-g],f[f.length-1-g]=m)}else{var w=t-+this._x.call(null,h.data),C=e-+this._y.call(null,h.data),b=w*w+C*C;if(b<n){var I=Math.sqrt(n=b);r=t-I,s=e-I,u=t+I,d=e+I,i=h.data}}return i}function gm(t){if(isNaN(u=+this._x.call(null,t))||isNaN(d=+this._y.call(null,t)))return this;var e,n=this._root,i,r,s,o=this._x0,l=this._y0,a=this._x1,c=this._y1,u,d,f,h,m,g,p,_;if(!n)return this;if(n.length)for(;;){if((m=u>=(f=(o+a)/2))?o=f:a=f,(g=d>=(h=(l+c)/2))?l=h:c=h,e=n,!(n=n[p=g<<1|m]))return this;if(!n.length)break;(e[p+1&3]||e[p+2&3]||e[p+3&3])&&(i=e,_=p)}for(;n.data!==t;)if(r=n,!(n=n.next))return this;return(s=n.next)&&delete n.next,r?(s?r.next=s:delete r.next,this):e?(s?e[p]=s:delete e[p],(n=e[0]||e[1]||e[2]||e[3])&&n===(e[3]||e[2]||e[1]||e[0])&&!n.length&&(i?i[_]=n:this._root=n),this):(this._root=s,this)}function _m(t){for(var e=0,n=t.length;e<n;++e)this.remove(t[e]);return this}function vm(){return this._root}function ym(){var t=0;return this.visit(function(e){if(!e.length)do++t;while(e=e.next)}),t}function bm(t){var e=[],n,i=this._root,r,s,o,l,a;for(i&&e.push(new nt(i,this._x0,this._y0,this._x1,this._y1));n=e.pop();)if(!t(i=n.node,s=n.x0,o=n.y0,l=n.x1,a=n.y1)&&i.length){var c=(s+l)/2,u=(o+a)/2;(r=i[3])&&e.push(new nt(r,c,u,l,a)),(r=i[2])&&e.push(new nt(r,s,u,c,a)),(r=i[1])&&e.push(new nt(r,c,o,l,u)),(r=i[0])&&e.push(new nt(r,s,o,c,u))}return this}function wm(t){var e=[],n=[],i;for(this._root&&e.push(new nt(this._root,this._x0,this._y0,this._x1,this._y1));i=e.pop();){var r=i.node;if(r.length){var s,o=i.x0,l=i.y0,a=i.x1,c=i.y1,u=(o+a)/2,d=(l+c)/2;(s=r[0])&&e.push(new nt(s,o,l,u,d)),(s=r[1])&&e.push(new nt(s,u,l,a,d)),(s=r[2])&&e.push(new nt(s,o,d,u,c)),(s=r[3])&&e.push(new nt(s,u,d,a,c))}n.push(i)}for(;i=n.pop();)t(i.node,i.x0,i.y0,i.x1,i.y1);return this}function Sm(t){return t[0]}function km(t){return arguments.length?(this._x=t,this):this._x}function Em(t){return t[1]}function Cm(t){return arguments.length?(this._y=t,this):this._y}function Rr(t,e,n){var i=new $r(e??Sm,n??Em,NaN,NaN,NaN,NaN);return t==null?i:i.addAll(t)}function $r(t,e,n,i,r,s){this._x=t,this._y=e,this._x0=n,this._y0=i,this._x1=r,this._y1=s,this._root=void 0}function Ho(t){for(var e={data:t.data},n=e;t=t.next;)n=n.next={data:t.data};return e}var it=Rr.prototype=$r.prototype;it.copy=function(){var t=new $r(this._x,this._y,this._x0,this._y0,this._x1,this._y1),e=this._root,n,i;if(!e)return t;if(!e.length)return t._root=Ho(e),t;for(n=[{source:e,target:t._root=new Array(4)}];e=n.pop();)for(var r=0;r<4;++r)(i=e.source[r])&&(i.length?n.push({source:i,target:e.target[r]=new Array(4)}):e.target[r]=Ho(i));return t},it.add=um,it.addAll=fm,it.cover=hm,it.data=dm,it.extent=mm,it.find=pm,it.remove=gm,it.removeAll=_m,it.root=vm,it.size=ym,it.visit=bm,it.visitAfter=wm,it.x=km,it.y=Cm;function rt(t){return function(){return t}}function Wt(t){return(t()-.5)*1e-6}function Im(t){return t.x+t.vx}function xm(t){return t.y+t.vy}function Uo(t){var e,n,i,r=1,s=1;typeof t!="function"&&(t=rt(t==null?1:+t));function o(){for(var c,u=e.length,d,f,h,m,g,p,_=0;_<s;++_)for(d=Rr(e,Im,xm).visitAfter(l),c=0;c<u;++c)f=e[c],g=n[f.index],p=g*g,h=f.x+f.vx,m=f.y+f.vy,d.visit(w);function w(C,b,I,T,M){var E=C.data,A=C.r,O=g+A;if(E){if(E.index>f.index){var D=h-E.x-E.vx,B=m-E.y-E.vy,R=D*D+B*B;R<O*O&&(D===0&&(D=Wt(i),R+=D*D),B===0&&(B=Wt(i),R+=B*B),R=(O-(R=Math.sqrt(R)))/R*r,f.vx+=(D*=R)*(O=(A*=A)/(p+A)),f.vy+=(B*=R)*O,E.vx-=D*(O=1-O),E.vy-=B*O)}return}return b>h+O||T<h-O||I>m+O||M<m-O}}function l(c){if(c.data)return c.r=n[c.data.index];for(var u=c.r=0;u<4;++u)c[u]&&c[u].r>c.r&&(c.r=c[u].r)}function a(){if(e){var c,u=e.length,d;for(n=new Array(u),c=0;c<u;++c)d=e[c],n[d.index]=+t(d,c,e)}}return o.initialize=function(c,u){e=c,i=u,a()},o.iterations=function(c){return arguments.length?(s=+c,o):s},o.strength=function(c){return arguments.length?(r=+c,o):r},o.radius=function(c){return arguments.length?(t=typeof c=="function"?c:rt(+c),a(),o):t},o}function Mm(t){return t.index}function Bo(t,e){var n=t.get(e);if(!n)throw new Error("node not found: "+e);return n}function qo(t){var e=Mm,n=d,i,r=rt(30),s,o,l,a,c,u=1;t==null&&(t=[]);function d(p){return 1/Math.min(l[p.source.index],l[p.target.index])}function f(p){for(var _=0,w=t.length;_<u;++_)for(var C=0,b,I,T,M,E,A,O;C<w;++C)b=t[C],I=b.source,T=b.target,M=T.x+T.vx-I.x-I.vx||Wt(c),E=T.y+T.vy-I.y-I.vy||Wt(c),A=Math.sqrt(M*M+E*E),A=(A-s[C])/A*p*i[C],M*=A,E*=A,T.vx-=M*(O=a[C]),T.vy-=E*O,I.vx+=M*(O=1-O),I.vy+=E*O}function h(){if(o){var p,_=o.length,w=t.length,C=new Map(o.map((I,T)=>[e(I,T,o),I])),b;for(p=0,l=new Array(_);p<w;++p)b=t[p],b.index=p,typeof b.source!="object"&&(b.source=Bo(C,b.source)),typeof b.target!="object"&&(b.target=Bo(C,b.target)),l[b.source.index]=(l[b.source.index]||0)+1,l[b.target.index]=(l[b.target.index]||0)+1;for(p=0,a=new Array(w);p<w;++p)b=t[p],a[p]=l[b.source.index]/(l[b.source.index]+l[b.target.index]);i=new Array(w),m(),s=new Array(w),g()}}function m(){if(o)for(var p=0,_=t.length;p<_;++p)i[p]=+n(t[p],p,t)}function g(){if(o)for(var p=0,_=t.length;p<_;++p)s[p]=+r(t[p],p,t)}return f.initialize=function(p,_){o=p,c=_,h()},f.links=function(p){return arguments.length?(t=p,h(),f):t},f.id=function(p){return arguments.length?(e=p,f):e},f.iterations=function(p){return arguments.length?(u=+p,f):u},f.strength=function(p){return arguments.length?(n=typeof p=="function"?p:rt(+p),m(),f):n},f.distance=function(p){return arguments.length?(r=typeof p=="function"?p:rt(+p),g(),f):r},f}const Am=1664525,Nm=1013904223,Ko=4294967296;function Tm(){let t=1;return()=>(t=(Am*t+Nm)%Ko)/Ko}function Om(t){return t.x}function Pm(t){return t.y}var Lm=10,Dm=Math.PI*(3-Math.sqrt(5));function Wo(t){var e,n=1,i=.001,r=1-Math.pow(i,1/300),s=0,o=.6,l=new Map,a=Nr(d),c=Dn("tick","end"),u=Tm();t==null&&(t=[]);function d(){f(),c.call("tick",e),n<i&&(a.stop(),c.call("end",e))}function f(g){var p,_=t.length,w;g===void 0&&(g=1);for(var C=0;C<g;++C)for(n+=(s-n)*r,l.forEach(function(b){b(n)}),p=0;p<_;++p)w=t[p],w.fx==null?w.x+=w.vx*=o:(w.x=w.fx,w.vx=0),w.fy==null?w.y+=w.vy*=o:(w.y=w.fy,w.vy=0);return e}function h(){for(var g=0,p=t.length,_;g<p;++g){if(_=t[g],_.index=g,_.fx!=null&&(_.x=_.fx),_.fy!=null&&(_.y=_.fy),isNaN(_.x)||isNaN(_.y)){var w=Lm*Math.sqrt(.5+g),C=g*Dm;_.x=w*Math.cos(C),_.y=w*Math.sin(C)}(isNaN(_.vx)||isNaN(_.vy))&&(_.vx=_.vy=0)}}function m(g){return g.initialize&&g.initialize(t,u),g}return h(),e={tick:f,restart:function(){return a.restart(d),e},stop:function(){return a.stop(),e},nodes:function(g){return arguments.length?(t=g,h(),l.forEach(m),e):t},alpha:function(g){return arguments.length?(n=+g,e):n},alphaMin:function(g){return arguments.length?(i=+g,e):i},alphaDecay:function(g){return arguments.length?(r=+g,e):+r},alphaTarget:function(g){return arguments.length?(s=+g,e):s},velocityDecay:function(g){return arguments.length?(o=1-g,e):1-o},randomSource:function(g){return arguments.length?(u=g,l.forEach(m),e):u},force:function(g,p){return arguments.length>1?(p==null?l.delete(g):l.set(g,m(p)),e):l.get(g)},find:function(g,p,_){var w=0,C=t.length,b,I,T,M,E;for(_==null?_=1/0:_*=_,w=0;w<C;++w)M=t[w],b=g-M.x,I=p-M.y,T=b*b+I*I,T<_&&(E=M,_=T);return E},on:function(g,p){return arguments.length>1?(c.on(g,p),e):c.on(g)}}}function Go(){var t,e,n,i,r=rt(-30),s,o=1,l=1/0,a=.81;function c(h){var m,g=t.length,p=Rr(t,Om,Pm).visitAfter(d);for(i=h,m=0;m<g;++m)e=t[m],p.visit(f)}function u(){if(t){var h,m=t.length,g;for(s=new Array(m),h=0;h<m;++h)g=t[h],s[g.index]=+r(g,h,t)}}function d(h){var m=0,g,p,_=0,w,C,b;if(h.length){for(w=C=b=0;b<4;++b)(g=h[b])&&(p=Math.abs(g.value))&&(m+=g.value,_+=p,w+=p*g.x,C+=p*g.y);h.x=w/_,h.y=C/_}else{g=h,g.x=g.data.x,g.y=g.data.y;do m+=s[g.data.index];while(g=g.next)}h.value=m}function f(h,m,g,p){if(!h.value)return!0;var _=h.x-e.x,w=h.y-e.y,C=p-m,b=_*_+w*w;if(C*C/a<b)return b<l&&(_===0&&(_=Wt(n),b+=_*_),w===0&&(w=Wt(n),b+=w*w),b<o&&(b=Math.sqrt(o*b)),e.vx+=_*h.value*i/b,e.vy+=w*h.value*i/b),!0;if(h.length||b>=l)return;(h.data!==e||h.next)&&(_===0&&(_=Wt(n),b+=_*_),w===0&&(w=Wt(n),b+=w*w),b<o&&(b=Math.sqrt(o*b)));do h.data!==e&&(C=s[h.data.index]*i/b,e.vx+=_*C,e.vy+=w*C);while(h=h.next)}return c.initialize=function(h,m){t=h,n=m,u()},c.strength=function(h){return arguments.length?(r=typeof h=="function"?h:rt(+h),u(),c):r},c.distanceMin=function(h){return arguments.length?(o=h*h,c):Math.sqrt(o)},c.distanceMax=function(h){return arguments.length?(l=h*h,c):Math.sqrt(l)},c.theta=function(h){return arguments.length?(a=h*h,c):Math.sqrt(a)},c}function Yo(t){var e=rt(.1),n,i,r;typeof t!="function"&&(t=rt(t==null?0:+t));function s(l){for(var a=0,c=n.length,u;a<c;++a)u=n[a],u.vx+=(r[a]-u.x)*i[a]*l}function o(){if(n){var l,a=n.length;for(i=new Array(a),r=new Array(a),l=0;l<a;++l)i[l]=isNaN(r[l]=+t(n[l],l,n))?0:+e(n[l],l,n)}}return s.initialize=function(l){n=l,o()},s.strength=function(l){return arguments.length?(e=typeof l=="function"?l:rt(+l),o(),s):e},s.x=function(l){return arguments.length?(t=typeof l=="function"?l:rt(+l),o(),s):t},s}function Xo(t){var e=rt(.1),n,i,r;typeof t!="function"&&(t=rt(t==null?0:+t));function s(l){for(var a=0,c=n.length,u;a<c;++a)u=n[a],u.vy+=(r[a]-u.y)*i[a]*l}function o(){if(n){var l,a=n.length;for(i=new Array(a),r=new Array(a),l=0;l<a;++l)i[l]=isNaN(r[l]=+t(n[l],l,n))?0:+e(n[l],l,n)}}return s.initialize=function(l){n=l,o()},s.strength=function(l){return arguments.length?(e=typeof l=="function"?l:rt(+l),o(),s):e},s.y=function(l){return arguments.length?(t=typeof l=="function"?l:rt(+l),o(),s):t},s}function Rm(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)}function Oi(t,e){if((n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var n,i=t.slice(0,n);return[i.length>1?i[0]+i.slice(2):i,+t.slice(n+1)]}function En(t){return t=Oi(Math.abs(t)),t?t[1]:NaN}function $m(t,e){return function(n,i){for(var r=n.length,s=[],o=0,l=t[0],a=0;r>0&&l>0&&(a+l+1>i&&(l=Math.max(1,i-a)),s.push(n.substring(r-=l,r+l)),!((a+=l+1)>i));)l=t[o=(o+1)%t.length];return s.reverse().join(e)}}function zm(t){return function(e){return e.replace(/[0-9]/g,function(n){return t[+n]})}}var jm=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Pi(t){if(!(e=jm.exec(t)))throw new Error("invalid format: "+t);var e;return new zr({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}Pi.prototype=zr.prototype;function zr(t){this.fill=t.fill===void 0?" ":t.fill+"",this.align=t.align===void 0?">":t.align+"",this.sign=t.sign===void 0?"-":t.sign+"",this.symbol=t.symbol===void 0?"":t.symbol+"",this.zero=!!t.zero,this.width=t.width===void 0?void 0:+t.width,this.comma=!!t.comma,this.precision=t.precision===void 0?void 0:+t.precision,this.trim=!!t.trim,this.type=t.type===void 0?"":t.type+""}zr.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function Fm(t){e:for(var e=t.length,n=1,i=-1,r;n<e;++n)switch(t[n]){case".":i=r=n;break;case"0":i===0&&(i=n),r=n;break;default:if(!+t[n])break e;i>0&&(i=0);break}return i>0?t.slice(0,i)+t.slice(r+1):t}var Jo;function Vm(t,e){var n=Oi(t,e);if(!n)return t+"";var i=n[0],r=n[1],s=r-(Jo=Math.max(-8,Math.min(8,Math.floor(r/3)))*3)+1,o=i.length;return s===o?i:s>o?i+new Array(s-o+1).join("0"):s>0?i.slice(0,s)+"."+i.slice(s):"0."+new Array(1-s).join("0")+Oi(t,Math.max(0,e+s-1))[0]}function Qo(t,e){var n=Oi(t,e);if(!n)return t+"";var i=n[0],r=n[1];return r<0?"0."+new Array(-r).join("0")+i:i.length>r+1?i.slice(0,r+1)+"."+i.slice(r+1):i+new Array(r-i.length+2).join("0")}const Zo={"%":(t,e)=>(t*100).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:Rm,e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>Qo(t*100,e),r:Qo,s:Vm,X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function el(t){return t}var tl=Array.prototype.map,nl=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function Hm(t){var e=t.grouping===void 0||t.thousands===void 0?el:$m(tl.call(t.grouping,Number),t.thousands+""),n=t.currency===void 0?"":t.currency[0]+"",i=t.currency===void 0?"":t.currency[1]+"",r=t.decimal===void 0?".":t.decimal+"",s=t.numerals===void 0?el:zm(tl.call(t.numerals,String)),o=t.percent===void 0?"%":t.percent+"",l=t.minus===void 0?"−":t.minus+"",a=t.nan===void 0?"NaN":t.nan+"";function c(d){d=Pi(d);var f=d.fill,h=d.align,m=d.sign,g=d.symbol,p=d.zero,_=d.width,w=d.comma,C=d.precision,b=d.trim,I=d.type;I==="n"?(w=!0,I="g"):Zo[I]||(C===void 0&&(C=12),b=!0,I="g"),(p||f==="0"&&h==="=")&&(p=!0,f="0",h="=");var T=g==="$"?n:g==="#"&&/[boxX]/.test(I)?"0"+I.toLowerCase():"",M=g==="$"?i:/[%p]/.test(I)?o:"",E=Zo[I],A=/[defgprs%]/.test(I);C=C===void 0?6:/[gprs]/.test(I)?Math.max(1,Math.min(21,C)):Math.max(0,Math.min(20,C));function O(D){var B=T,R=M,S,L,x;if(I==="c")R=E(D)+R,D="";else{D=+D;var F=D<0||1/D<0;if(D=isNaN(D)?a:E(Math.abs(D),C),b&&(D=Fm(D)),F&&+D==0&&m!=="+"&&(F=!1),B=(F?m==="("?m:l:m==="-"||m==="("?"":m)+B,R=(I==="s"?nl[8+Jo/3]:"")+R+(F&&m==="("?")":""),A){for(S=-1,L=D.length;++S<L;)if(x=D.charCodeAt(S),48>x||x>57){R=(x===46?r+D.slice(S+1):D.slice(S))+R,D=D.slice(0,S);break}}}w&&!p&&(D=e(D,1/0));var H=B.length+D.length+R.length,U=H<_?new Array(_-H+1).join(f):"";switch(w&&p&&(D=e(U+D,U.length?_-R.length:1/0),U=""),h){case"<":D=B+D+R+U;break;case"=":D=B+U+D+R;break;case"^":D=U.slice(0,H=U.length>>1)+B+D+R+U.slice(H);break;default:D=U+B+D+R;break}return s(D)}return O.toString=function(){return d+""},O}function u(d,f){var h=c((d=Pi(d),d.type="f",d)),m=Math.max(-8,Math.min(8,Math.floor(En(f)/3)))*3,g=Math.pow(10,-m),p=nl[8+m/3];return function(_){return h(g*_)+p}}return{format:c,formatPrefix:u}}var Li,Di,il;Um({thousands:",",grouping:[3],currency:["$",""]});function Um(t){return Li=Hm(t),Di=Li.format,il=Li.formatPrefix,Li}function Bm(t){return Math.max(0,-En(Math.abs(t)))}function qm(t,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(En(e)/3)))*3-En(Math.abs(t)))}function Km(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,En(e)-En(t))+1}function Wm(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t);break}return this}function Gm(t){return function(){return t}}function Ym(t){return+t}var rl=[0,1];function Cn(t){return t}function jr(t,e){return(e-=t=+t)?function(n){return(n-t)/e}:Gm(isNaN(e)?NaN:.5)}function Xm(t,e){var n;return t>e&&(n=t,t=e,e=n),function(i){return Math.max(t,Math.min(e,i))}}function Jm(t,e,n){var i=t[0],r=t[1],s=e[0],o=e[1];return r<i?(i=jr(r,i),s=n(o,s)):(i=jr(i,r),s=n(s,o)),function(l){return s(i(l))}}function Qm(t,e,n){var i=Math.min(t.length,e.length)-1,r=new Array(i),s=new Array(i),o=-1;for(t[i]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++o<i;)r[o]=jr(t[o],t[o+1]),s[o]=n(e[o],e[o+1]);return function(l){var a=bu(t,l,1,i)-1;return s[a](r[a](l))}}function Zm(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function ep(){var t=rl,e=rl,n=xr,i,r,s,o=Cn,l,a,c;function u(){var f=Math.min(t.length,e.length);return o!==Cn&&(o=Xm(t[0],t[f-1])),l=f>2?Qm:Jm,a=c=null,d}function d(f){return f==null||isNaN(f=+f)?s:(a||(a=l(t.map(i),e,n)))(i(o(f)))}return d.invert=function(f){return o(r((c||(c=l(e,t.map(i),kt)))(f)))},d.domain=function(f){return arguments.length?(t=Array.from(f,Ym),u()):t.slice()},d.range=function(f){return arguments.length?(e=Array.from(f),u()):e.slice()},d.rangeRound=function(f){return e=Array.from(f),n=Bh,u()},d.clamp=function(f){return arguments.length?(o=f?!0:Cn,u()):o!==Cn},d.interpolate=function(f){return arguments.length?(n=f,u()):n},d.unknown=function(f){return arguments.length?(s=f,d):s},function(f,h){return i=f,r=h,u()}}function tp(){return ep()(Cn,Cn)}function np(t,e,n,i){var r=Cu(t,e,n),s;switch(i=Pi(i??",f"),i.type){case"s":{var o=Math.max(Math.abs(t),Math.abs(e));return i.precision==null&&!isNaN(s=qm(r,o))&&(i.precision=s),il(i,o)}case"":case"e":case"g":case"p":case"r":{i.precision==null&&!isNaN(s=Km(r,Math.max(Math.abs(t),Math.abs(e))))&&(i.precision=s-(i.type==="e"));break}case"f":case"%":{i.precision==null&&!isNaN(s=Bm(r))&&(i.precision=s-(i.type==="%")*2);break}}return Di(i)}function ip(t){var e=t.domain;return t.ticks=function(n){var i=e();return Eu(i[0],i[i.length-1],n??10)},t.tickFormat=function(n,i){var r=e();return np(r[0],r[r.length-1],n??10,i)},t.nice=function(n){n==null&&(n=10);var i=e(),r=0,s=i.length-1,o=i[r],l=i[s],a,c,u=10;for(l<o&&(c=o,o=l,l=c,c=r,r=s,s=c);u-- >0;){if(c=fr(o,l,n),c===a)return i[r]=o,i[s]=l,e(i);if(c>0)o=Math.floor(o/c)*c,l=Math.ceil(l/c)*c;else if(c<0)o=Math.ceil(o*c)/c,l=Math.floor(l*c)/c;else break;a=c}return t},t}function Fr(){var t=tp();return t.copy=function(){return Zm(t,Fr())},Wm.apply(t,arguments),ip(t)}const Ri=t=>()=>t;function rp(t,{sourceEvent:e,target:n,transform:i,dispatch:r}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:i,enumerable:!0,configurable:!0},_:{value:r}})}function Ft(t,e,n){this.k=t,this.x=e,this.y=n}Ft.prototype={constructor:Ft,scale:function(t){return t===1?this:new Ft(this.k*t,this.x,this.y)},translate:function(t,e){return t===0&e===0?this:new Ft(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var Vr=new Ft(1,0,0);Ft.prototype;function Hr(t){t.stopImmediatePropagation()}function qn(t){t.preventDefault(),t.stopImmediatePropagation()}function sp(t){return(!t.ctrlKey||t.type==="wheel")&&!t.button}function op(){var t=this;return t instanceof SVGElement?(t=t.ownerSVGElement||t,t.hasAttribute("viewBox")?(t=t.viewBox.baseVal,[[t.x,t.y],[t.x+t.width,t.y+t.height]]):[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]):[[0,0],[t.clientWidth,t.clientHeight]]}function sl(){return this.__zoom||Vr}function lp(t){return-t.deltaY*(t.deltaMode===1?.05:t.deltaMode?1:.002)*(t.ctrlKey?10:1)}function ap(){return navigator.maxTouchPoints||"ontouchstart"in this}function cp(t,e,n){var i=t.invertX(e[0][0])-n[0][0],r=t.invertX(e[1][0])-n[1][0],s=t.invertY(e[0][1])-n[0][1],o=t.invertY(e[1][1])-n[1][1];return t.translate(r>i?(i+r)/2:Math.min(0,i)||Math.max(0,r),o>s?(s+o)/2:Math.min(0,s)||Math.max(0,o))}function ol(){var t=sp,e=op,n=cp,i=lp,r=ap,s=[0,1/0],o=[[-1/0,-1/0],[1/0,1/0]],l=250,a=Qh,c=Dn("start","zoom","end"),u,d,f,h=500,m=150,g=0,p=10;function _(S){S.property("__zoom",sl).on("wheel.zoom",E,{passive:!1}).on("mousedown.zoom",A).on("dblclick.zoom",O).filter(r).on("touchstart.zoom",D).on("touchmove.zoom",B).on("touchend.zoom touchcancel.zoom",R).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}_.transform=function(S,L,x,F){var H=S.selection?S.selection():S;H.property("__zoom",sl),S!==H?I(S,L,x,F):H.interrupt().each(function(){T(this,arguments).event(F).start().zoom(null,typeof L=="function"?L.apply(this,arguments):L).end()})},_.scaleBy=function(S,L,x,F){_.scaleTo(S,function(){var H=this.__zoom.k,U=typeof L=="function"?L.apply(this,arguments):L;return H*U},x,F)},_.scaleTo=function(S,L,x,F){_.transform(S,function(){var H=e.apply(this,arguments),U=this.__zoom,Y=x==null?b(H):typeof x=="function"?x.apply(this,arguments):x,J=U.invert(Y),ie=typeof L=="function"?L.apply(this,arguments):L;return n(C(w(U,ie),Y,J),H,o)},x,F)},_.translateBy=function(S,L,x,F){_.transform(S,function(){return n(this.__zoom.translate(typeof L=="function"?L.apply(this,arguments):L,typeof x=="function"?x.apply(this,arguments):x),e.apply(this,arguments),o)},null,F)},_.translateTo=function(S,L,x,F,H){_.transform(S,function(){var U=e.apply(this,arguments),Y=this.__zoom,J=F==null?b(U):typeof F=="function"?F.apply(this,arguments):F;return n(Vr.translate(J[0],J[1]).scale(Y.k).translate(typeof L=="function"?-L.apply(this,arguments):-L,typeof x=="function"?-x.apply(this,arguments):-x),U,o)},F,H)};function w(S,L){return L=Math.max(s[0],Math.min(s[1],L)),L===S.k?S:new Ft(L,S.x,S.y)}function C(S,L,x){var F=L[0]-x[0]*S.k,H=L[1]-x[1]*S.k;return F===S.x&&H===S.y?S:new Ft(S.k,F,H)}function b(S){return[(+S[0][0]+ +S[1][0])/2,(+S[0][1]+ +S[1][1])/2]}function I(S,L,x,F){S.on("start.zoom",function(){T(this,arguments).event(F).start()}).on("interrupt.zoom end.zoom",function(){T(this,arguments).event(F).end()}).tween("zoom",function(){var H=this,U=arguments,Y=T(H,U).event(F),J=e.apply(H,U),ie=x==null?b(J):typeof x=="function"?x.apply(H,U):x,he=Math.max(J[1][0]-J[0][0],J[1][1]-J[0][1]),te=H.__zoom,ce=typeof L=="function"?L.apply(H,U):L,xe=a(te.invert(ie).concat(he/te.k),ce.invert(ie).concat(he/ce.k));return function(Ae){if(Ae===1)Ae=ce;else{var we=xe(Ae),$e=he/we[2];Ae=new Ft($e,ie[0]-we[0]*$e,ie[1]-we[1]*$e)}Y.zoom(null,Ae)}})}function T(S,L,x){return!x&&S.__zooming||new M(S,L)}function M(S,L){this.that=S,this.args=L,this.active=0,this.sourceEvent=null,this.extent=e.apply(S,L),this.taps=0}M.prototype={event:function(S){return S&&(this.sourceEvent=S),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(S,L){return this.mouse&&S!=="mouse"&&(this.mouse[1]=L.invert(this.mouse[0])),this.touch0&&S!=="touch"&&(this.touch0[1]=L.invert(this.touch0[0])),this.touch1&&S!=="touch"&&(this.touch1[1]=L.invert(this.touch1[0])),this.that.__zoom=L,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(S){var L=Xe(this.that).datum();c.call(S,this.that,new rp(S,{sourceEvent:this.sourceEvent,target:_,type:S,transform:this.that.__zoom,dispatch:c}),L)}};function E(S,...L){if(!t.apply(this,arguments))return;var x=T(this,L).event(S),F=this.__zoom,H=Math.max(s[0],Math.min(s[1],F.k*Math.pow(2,i.apply(this,arguments)))),U=tt(S);if(x.wheel)(x.mouse[0][0]!==U[0]||x.mouse[0][1]!==U[1])&&(x.mouse[1]=F.invert(x.mouse[0]=U)),clearTimeout(x.wheel);else{if(F.k===H)return;x.mouse=[U,F.invert(U)],Ti(this),x.start()}qn(S),x.wheel=setTimeout(Y,m),x.zoom("mouse",n(C(w(F,H),x.mouse[0],x.mouse[1]),x.extent,o));function Y(){x.wheel=null,x.end()}}function A(S,...L){if(f||!t.apply(this,arguments))return;var x=S.currentTarget,F=T(this,L,!0).event(S),H=Xe(S.view).on("mousemove.zoom",ie,!0).on("mouseup.zoom",he,!0),U=tt(S,x),Y=S.clientX,J=S.clientY;fo(S.view),Hr(S),F.mouse=[U,this.__zoom.invert(U)],Ti(this),F.start();function ie(te){if(qn(te),!F.moved){var ce=te.clientX-Y,xe=te.clientY-J;F.moved=ce*ce+xe*xe>g}F.event(te).zoom("mouse",n(C(F.that.__zoom,F.mouse[0]=tt(te,x),F.mouse[1]),F.extent,o))}function he(te){H.on("mousemove.zoom mouseup.zoom",null),ho(te.view,F.moved),qn(te),F.event(te).end()}}function O(S,...L){if(t.apply(this,arguments)){var x=this.__zoom,F=tt(S.changedTouches?S.changedTouches[0]:S,this),H=x.invert(F),U=x.k*(S.shiftKey?.5:2),Y=n(C(w(x,U),F,H),e.apply(this,L),o);qn(S),l>0?Xe(this).transition().duration(l).call(I,Y,F,S):Xe(this).call(_.transform,Y,F,S)}}function D(S,...L){if(t.apply(this,arguments)){var x=S.touches,F=x.length,H=T(this,L,S.changedTouches.length===F).event(S),U,Y,J,ie;for(Hr(S),Y=0;Y<F;++Y)J=x[Y],ie=tt(J,this),ie=[ie,this.__zoom.invert(ie),J.identifier],H.touch0?!H.touch1&&H.touch0[2]!==ie[2]&&(H.touch1=ie,H.taps=0):(H.touch0=ie,U=!0,H.taps=1+!!u);u&&(u=clearTimeout(u)),U&&(H.taps<2&&(d=ie[0],u=setTimeout(function(){u=null},h)),Ti(this),H.start())}}function B(S,...L){if(this.__zooming){var x=T(this,L).event(S),F=S.changedTouches,H=F.length,U,Y,J,ie;for(qn(S),U=0;U<H;++U)Y=F[U],J=tt(Y,this),x.touch0&&x.touch0[2]===Y.identifier?x.touch0[0]=J:x.touch1&&x.touch1[2]===Y.identifier&&(x.touch1[0]=J);if(Y=x.that.__zoom,x.touch1){var he=x.touch0[0],te=x.touch0[1],ce=x.touch1[0],xe=x.touch1[1],Ae=(Ae=ce[0]-he[0])*Ae+(Ae=ce[1]-he[1])*Ae,we=(we=xe[0]-te[0])*we+(we=xe[1]-te[1])*we;Y=w(Y,Math.sqrt(Ae/we)),J=[(he[0]+ce[0])/2,(he[1]+ce[1])/2],ie=[(te[0]+xe[0])/2,(te[1]+xe[1])/2]}else if(x.touch0)J=x.touch0[0],ie=x.touch0[1];else return;x.zoom("touch",n(C(Y,J,ie),x.extent,o))}}function R(S,...L){if(this.__zooming){var x=T(this,L).event(S),F=S.changedTouches,H=F.length,U,Y;for(Hr(S),f&&clearTimeout(f),f=setTimeout(function(){f=null},h),U=0;U<H;++U)Y=F[U],x.touch0&&x.touch0[2]===Y.identifier?delete x.touch0:x.touch1&&x.touch1[2]===Y.identifier&&delete x.touch1;if(x.touch1&&!x.touch0&&(x.touch0=x.touch1,delete x.touch1),x.touch0)x.touch0[1]=this.__zoom.invert(x.touch0[0]);else if(x.end(),x.taps===2&&(Y=tt(Y,this),Math.hypot(d[0]-Y[0],d[1]-Y[1])<p)){var J=Xe(this).on("dblclick.zoom");J&&J.apply(this,arguments)}}}return _.wheelDelta=function(S){return arguments.length?(i=typeof S=="function"?S:Ri(+S),_):i},_.filter=function(S){return arguments.length?(t=typeof S=="function"?S:Ri(!!S),_):t},_.touchable=function(S){return arguments.length?(r=typeof S=="function"?S:Ri(!!S),_):r},_.extent=function(S){return arguments.length?(e=typeof S=="function"?S:Ri([[+S[0][0],+S[0][1]],[+S[1][0],+S[1][1]]]),_):e},_.scaleExtent=function(S){return arguments.length?(s[0]=+S[0],s[1]=+S[1],_):[s[0],s[1]]},_.translateExtent=function(S){return arguments.length?(o[0][0]=+S[0][0],o[1][0]=+S[1][0],o[0][1]=+S[0][1],o[1][1]=+S[1][1],_):[[o[0][0],o[0][1]],[o[1][0],o[1][1]]]},_.constrain=function(S){return arguments.length?(n=S,_):n},_.duration=function(S){return arguments.length?(l=+S,_):l},_.interpolate=function(S){return arguments.length?(a=S,_):a},_.on=function(){var S=c.on.apply(c,arguments);return S===c?_:S},_.clickDistance=function(S){return arguments.length?(g=(S=+S)*S,_):Math.sqrt(g)},_.tapDistance=function(S){return arguments.length?(p=+S,_):p},_}function up(t,e,n=null,i,r=null){const s=Xe(t);s.selectAll("*").remove();const o=s.node(),l=o.getBoundingClientRect();let a=l.width||800,c=l.height||600;const u=a/2,d=c/2,f=s.append("canvas").attr("class","network-canvas").attr("width",a).attr("height",c).style("width",a+"px").style("height",c+"px").style("cursor","default"),h=f.node().getContext("2d",{alpha:!1});let m=Vr;const g=new Set,p={current:null};function _(){const D=o.getBoundingClientRect(),B=D.width||800,R=D.height||600;(B!==a||R!==c)&&(a=B,c=R,f.attr("width",a).attr("height",c).style("width",a+"px").style("height",c+"px"),O())}const w=new ResizeObserver(_);w.observe(o);const C=Wo(e).force("link",qo(n).id(D=>D.id).distance(D=>D.distance)).force("charge",Go().strength(-250)).force("center",Fo(u,d).strength(.7)).force("collide",Uo(D=>D.radius+10).strength(.5)).force("x",Yo(u).strength(.025)).force("y",Xo(d).strength(.025)).alphaDecay(.05).velocityDecay(.6);let b=null;C.on("tick",()=>{b||(b=requestAnimationFrame(()=>{O(),b=null}))}),C.tick(100);for(let D=0;D<100;D++)C.tick();C.alphaTarget(0);const I=fp({canvas:f,nodes:e,transform:()=>m,hoveredNode:p,onSelectionChange:(D,B)=>{g.clear(),D.forEach(S=>g.add(S));const R=dp(e,D,B);i(R),O()},render:()=>O()}),T=ol().scaleExtent([.1,10]).filter(D=>!I.isSelectionMode()||D.type==="wheel").on("zoom",({transform:D})=>{m=D,O()});f.call(T);const{dragstarted:M,dragged:E,dragended:A}=hp(f,e,C,()=>m,p,()=>!I.isSelectionMode(),O);I.setupInteractions(f,{start:M,drag:E,end:A});function O(){h.save(),h.fillRect(0,0,a,c),h.translate(m.x,m.y),h.scale(m.k,m.k),h.strokeStyle="#8a8a8a",h.lineWidth=1/m.k,n.forEach(B=>{const R=B.source.x,S=B.source.y,L=B.target.x,x=B.target.y;h.globalAlpha=Math.max(.2,B.strength),h.lineWidth=B.width/m.k,h.beginPath(),h.moveTo(R,S),h.lineTo(L,x),h.stroke()}),h.globalAlpha=1,e.forEach(B=>{const R=g.has(B.id);h.fillStyle=B.color,h.beginPath(),h.arc(B.x,B.y,B.radius,0,2*Math.PI),h.fill(),R&&(h.strokeStyle="#0f2bff",h.lineWidth=3/m.k,h.stroke())});const D=I.getSelectionRect();if(D){h.strokeStyle="#0f2bff",h.fillStyle="rgba(15, 43, 255, 0.2)",h.lineWidth=2/m.k;const B=Math.min(D.x1,D.x2),R=Math.min(D.y1,D.y2),S=Math.abs(D.x2-D.x1),L=Math.abs(D.y2-D.y1);h.fillRect(B,R,S,L),h.strokeRect(B,R,S,L)}h.restore()}return O(),{destroy:()=>{b&&cancelAnimationFrame(b),C.stop(),w.disconnect(),f.remove()},toggleSelectionMode:()=>{const D=I.toggleSelectionMode();return r&&r(D),O(),D}}}function fp(t){const{canvas:e,nodes:n,transform:i,hoveredNode:r,onSelectionChange:s,render:o}=t,l=new Set,a=[];let c=!1,u=null;function d(){return c=!c,e.style("cursor",c?"crosshair":"default"),c}function f(g){if(l.has(g)){l.delete(g);const p=a.indexOf(g);p>-1&&a.splice(p,1)}else l.add(g),a.push(g);s(l,a)}function h(g,p){const _=i(),w=(g-_.x)/_.k,C=(p-_.y)/_.k;for(let b=n.length-1;b>=0;b--){const I=n[b],T=w-I.x,M=C-I.y;if(Math.sqrt(T*T+M*M)<I.radius)return I}return null}function m(g,p){let _=null;g.on("mousedown",function(w){const[C,b]=tt(w),I=h(C,b);if(c){const T=i(),M=(C-T.x)/T.k,E=(b-T.y)/T.k;u={x1:M,y1:E,x2:M,y2:E},o()}else I&&(_=I,p.start(w,I))}),g.on("mousemove",function(w){const[C,b]=tt(w);if(c){if(u){const I=i(),T=(C-I.x)/I.k,M=(b-I.y)/I.k;u.x2=T,u.y2=M,o()}}else if(_)p.drag(w,_,C,b);else{const I=h(C,b);r.current!==I&&(r.current=I,g.style("cursor",I?"pointer":"default"),o())}}),g.on("mouseup",function(w){if(c){if(u){const C=Math.min(u.x1,u.x2),b=Math.min(u.y1,u.y2),I=Math.max(u.x1,u.x2),T=Math.max(u.y1,u.y2);l.clear(),a.length=0;const M=[];n.forEach(E=>{E.x>=C&&E.x<=I&&E.y>=b&&E.y<=T&&M.push({id:E.id,y:E.y})}),M.sort((E,A)=>E.y-A.y),M.forEach(({id:E})=>{l.add(E),a.push(E)}),s(l,a),u=null,o()}}else if(_)p.end(w,_),_=null;else{const[C,b]=tt(w),I=h(C,b);I&&f(I.id)}})}return{toggleSelectionMode:d,isSelectionMode:()=>c,setupInteractions:m,getSelectionRect:()=>u}}function hp(t,e,n,i,r,s,o){let l=null;function a(d,f){s()&&(d.active||n.alphaTarget(.3).restart(),l=f,f.fx=f.x,f.fy=f.y)}function c(d,f,h,m){if(!l||!s())return;const g=i();f.fx=(h-g.x)/g.k,f.fy=(m-g.y)/g.k,o()}function u(d,f){!l||!s()||(d.active||n.alphaTarget(0),f.fx=null,f.fy=null,l=null)}return{dragstarted:a,dragged:c,dragended:u}}function dp(t,e,n){const i=new Map(t.map(r=>[r.id,r]));return n.map(r=>i.get(r)).filter(Boolean)}const ll=8,mp=1.5,pp=50,al=.5,gp=800,_p=600;function vp(t,e,n=null,i=null,r=null){const s=gp/2,o=_p/2,a=Xe(t).append("svg").attr("class","network-svg"),c=a.append("g"),u=c.append("g").selectAll("line").data(n).join("line").attr("class","link").attr("stroke-width",m=>m.width||mp).attr("stroke-opacity",m=>Math.max(.2,m.strength||al)),d=c.append("g").selectAll("circle").data(e).join("circle").attr("class","node").attr("r",m=>m.radius||ll).attr("fill",m=>m.color);d.append("title").text(m=>m.label);const f=Wo(e).force("link",qo(n).id(m=>m.id).distance(m=>m.distance||pp)).force("charge",Go().strength(-250)).force("center",Fo(s,o).strength(.7)).force("collide",Uo(m=>(m.radius||ll)+10).strength(al)).force("x",Yo(s).strength(.025)).force("y",Xo(o).strength(.025));let h=null;if(i){h=yp({svg:a,g:c,nodes:e,onSelectionChange:(_,w)=>{d.classed("selected",b=>_.has(b.id));const C=wp(e,_,w);i(C)}}),a.call(ol().scaleExtent([.1,10]).filter(_=>!h.isSelectionMode()||_.type==="wheel").on("zoom",({transform:_})=>c.attr("transform",_)));const{dragstarted:m,dragged:g,dragended:p}=bp(f,u,d);h.setupNodeClick(d),h.setupDrag(d,{start:m,drag:g,end:p})}return{destroy:()=>{f.stop(),a.remove()},toggleSelectionMode:()=>{if(h){const m=h.toggleSelectionMode();return r&&r(m),m}}}}function yp(t){const{svg:e,g:n,nodes:i,onSelectionChange:r,getNodePosition:s=g=>({x:g.x,y:g.y}),getNodeId:o=g=>g.id}=t,l=new Set,a=[];let c=!1;function u(){return c=!c,e.style("cursor",c?"crosshair":"default"),c}function d(g){if(l.has(g)){l.delete(g);const p=a.indexOf(g);p>-1&&a.splice(p,1)}else l.add(g),a.push(g);r(l,a)}function f(){l.clear(),a.length=0,r(l,a)}let h=null,m=null;return e.on("mousedown",function(g){if(!c)return;g.preventDefault();const[p,_]=tt(g,n.node());h={x:p,y:_},m=n.append("rect").attr("class","selection-rect").attr("x",p).attr("y",_).attr("width",0).attr("height",0)}).on("mousemove",function(g){if(!c||!m)return;const[p,_]=tt(g,n.node()),w=p-h.x,C=_-h.y;m.attr("x",w<0?p:h.x).attr("y",C<0?_:h.y).attr("width",Math.abs(w)).attr("height",Math.abs(C))}).on("mouseup",function(g){if(!c||!m)return;const[p,_]=tt(g,n.node()),w=Math.min(h.x,p),C=Math.min(h.y,_),b=Math.max(h.x,p),I=Math.max(h.y,_);l.clear(),a.length=0;const T=[];i.forEach(M=>{const E=s(M);E.x>=w&&E.x<=b&&E.y>=C&&E.y<=I&&T.push({id:o(M),y:E.y})}),T.sort((M,E)=>M.y-E.y),T.forEach(({id:M})=>{l.add(M),a.push(M)}),r(l,a),m.remove(),m=null,h=null}),{toggleSelectionMode:u,toggleNode:d,clearSelection:f,isSelectionMode:()=>c,getSelectedNodes:()=>l,getSelectionOrder:()=>a,setupNodeClick:g=>{g.on("click",function(p,_){p.stopPropagation(),d(o(_))})},setupDrag:(g,p)=>{g.call(Sh().filter(()=>!c).on("start",p.start).on("drag",p.drag).on("end",p.end))}}}function bp(t,e,n){t.on("tick",()=>{e.attr("x1",o=>o.source.x).attr("y1",o=>o.source.y).attr("x2",o=>o.target.x).attr("y2",o=>o.target.y),n.attr("cx",o=>o.x).attr("cy",o=>o.y)});function i(o){o.active||t.alphaTarget(.3).restart(),o.subject.fx=o.subject.x,o.subject.fy=o.subject.y}function r(o){o.subject.fx=o.x,o.subject.fy=o.y}function s(o){o.active||t.alphaTarget(0),o.subject.fx=null,o.subject.fy=null}return{dragstarted:i,dragged:r,dragended:s}}function wp(t,e,n){const i=new Map(t.map(r=>[r.id,r]));return n.map(r=>i.get(r)).filter(Boolean)}const Sp="modulepreload",kp=function(t){return"/"+t},cl={},Ur=function(e,n,i){return e()};function Br(t){const{type:e,modelName:n,title:i,extractMeta:r=h=>h}=t,s={id:null,type:e,title:i,selected:{}},o=JSON.parse(localStorage.getItem(e))||s,l=be(o),a=be(!1);function c(h,m=!1){a.set(m),localStorage.setItem(e,JSON.stringify(h))}function u(){l.update(h=>{if(e!=="documentSet")return console.error("Document set management is the only type currently supported for saving."),h;const m=Object.fromEntries(Object.entries(h.selected).map(([p,_])=>[p,Object.keys(_)])),g=h.id?`${h.id}/edit`:"new";return fetch(`${window.location.origin}/${n}/${g}`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":Kt},body:JSON.stringify({title:h.title,selection:h,...m})}).then(p=>p.json()).then(p=>{if(!(p!=null&&p.document_set_id))throw new Error("Failed to save");l.update(_=>(_.id=p.document_set_id,_.title=p.document_set_title,c(_,!0),_))}).catch(p=>console.error("Error:",p)),h})}const d=h=>l.update(()=>{const m=h.selection.id?h.selection:{...h.selection,id:h.id};return c(m),m}),f=()=>l.update(()=>{const h={...s,selected:{}};return c(h),h});return{type:e,subscribe:l.subscribe,add:h=>l.update(m=>(m.selected[h.class]={...m.selected[h.class]||{},[h.id]:r(h)},c(m),m)),addAll:h=>l.update(m=>(h.forEach(g=>{m.selected[g.class]={...m.selected[g.class]||{},[g.id]:r(g)}}),c(m),m)),remove:(h,m)=>l.update(g=>{const{[h]:p,..._}=g.selected[m];return g.selected[m]=_,c(g),g}),removeAll:(h,m)=>l.update(g=>(h.forEach(p=>{var _;return(_=g.selected[m])==null?!0:delete _[p]}),c(g),g)),toggle:h=>l.update(m=>{var g;if((g=m.selected[h.class])!=null&&g[h.id]){const{[h.id]:p,..._}=m.selected[h.class];m.selected[h.class]=_}else m.selected[h.class]={...m.selected[h.class]||{},[h.id]:r(h)};return c(m),m}),toggleSet:h=>{et(l).id===h.id?f():d(h)},empty:()=>l.update(h=>(h.id=null,h.title=i,h.selected={},c(h,!0),h)),updateTitle:h=>l.update(m=>(m.title=h,c(m,!0),m)),save:u,isSaved:a,selection:l,selectionTitle:Ue(l,h=>h.title),isSelected:Ue(l,h=>m=>{var g;return((g=h.selected[m.class])==null?void 0:g[m.id])||!1}),selected:Ue(l,h=>h.selected),nbSelected:Ue(l,h=>Object.values(h.selected).reduce((m,g)=>m+Object.keys(g).length,0)),isSetSelected:Ue(l,h=>m=>h.id===m.id)}}Br({type:"documentSet",modelName:"document-set",title:W==="en"?"Document set":"Set de documents",extractMeta:t=>({title:t.title,url:t.url})});const Ep=Br({type:"regionsSet",modelName:"regions-set",title:W==="en"?"Regions set":"Set de régions",extractMeta:t=>t}),$i=Br({type:"clusterSet",modelName:"cluster-set",title:W==="en"?"Selected regions":"Régions sélectionnées",extractMeta:t=>({imgRef:t.id,clusterId:t.clusterId,title:t.title,xywh:t.xywh,img:t.img})});function Cp(){const t=`${window.location.origin}${window.location.pathname}`,e=be(1),n=be({}),i=be({}),r=be("");lr(e,"p");function s(u){r.update(d=>{const f=d===u?"":u;return navigator.clipboard.writeText(f).then(h=>""),f})}const o=(async()=>{try{const u=await fetch(`${t}canvas`);if(!u.ok)return{};const d=await u.json();let f={};return Object.values(d).forEach(h=>{Object.entries(h).forEach(([m,g])=>{f[m]=g})}),n.set(f),d}catch{return{}}})(),l=Ue(e,u=>(async()=>{const f=await(await fetch(`${t}canvas?p=${u}`)).json();return i.set(f),f})());function a(u){ar(u,e,"p")}function c(u){n.update(d=>(delete d[u],{...d})),i.update(d=>{for(const f in d)if(d[f][u]){const{[u]:h,...m}=d[f];return d[f]=m,d}return d})}return{currentPage:e,pageRegions:i,allRegions:n,fetchPages:l,fetchAll:o,handlePageUpdate:a,remove:c,clipBoard:r,copyRef:s}}const ul=Cp(),hy="";function Ip(t){let e;return{c(){e=bt("path"),v(e,"d","M384 336H192c-8.8 0-16-7.2-16-16V64c0-8.8 7.2-16 16-16l140.1 0L400 115.9V320c0 8.8-7.2 16-16 16zM192 384H384c35.3 0 64-28.7 64-64V115.9c0-12.7-5.1-24.9-14.1-33.9L366.1 14.1c-9-9-21.2-14.1-33.9-14.1H192c-35.3 0-64 28.7-64 64V320c0 35.3 28.7 64 64 64zM64 128c-35.3 0-64 28.7-64 64V448c0 35.3 28.7 64 64 64H256c35.3 0 64-28.7 64-64V416H272v32c0 8.8-7.2 16-16 16H64c-8.8 0-16-7.2-16-16V192c0-8.8 7.2-16 16-16H96V128H64z"),v(e,"class","svelte-1829hp2")},m(n,i){j(n,e,i)},d(n){n&&$(e)}}}function xp(t){let e;return{c(){e=bt("path"),v(e,"d","M208 0H332.1c12.7 0 24.9 5.1 33.9 14.1l67.9 67.9c9 9 14.1 21.2 14.1 33.9V336c0 26.5-21.5 48-48 48H208c-26.5 0-48-21.5-48-48V48c0-26.5 21.5-48 48-48zM48 128h80v64H64V448H256V416h64v48c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V176c0-26.5 21.5-48 48-48z"),v(e,"class","svelte-1829hp2")},m(n,i){j(n,e,i)},d(n){n&&$(e)}}}function Mp(t){let e=W==="en"?"Copy ID":"Copier l'ID",n;return{c(){n=ne(e)},m(i,r){j(i,n,r)},p:X,d(i){i&&$(n)}}}function Ap(t){let e=W==="en"?"Copied!":"Copié !",n;return{c(){n=ne(e)},m(i,r){j(i,n,r)},p:X,d(i){i&&$(n)}}}function fl(t){let e,n,i;var r=t[7];function s(o){return{props:{mainImgItem:o[1],compareImgItem:o[14]}}}return r&&(e=si(r,s(t))),{c(){e&&le(e.$$.fragment),n=Ke()},m(o,l){e&&se(e,o,l),j(o,n,l),i=!0},p(o,l){const a={};if(l&2&&(a.mainImgItem=o[1]),l&128&&r!==(r=o[7])){if(e){Ee();const c=e;K(c.$$.fragment,1,0,()=>{oe(c,1)}),Ce()}r?(e=si(r,s(o)),le(e.$$.fragment),V(e.$$.fragment,1),se(e,n.parentNode,n)):e=null}else r&&e.$set(a)},i(o){i||(e&&V(e.$$.fragment,o),i=!0)},o(o){e&&K(e.$$.fragment,o),i=!1},d(o){o&&$(n),e&&oe(e,o)}}}function Np(t){let e,n,i,r,s,o,l,a,c,u,d,f,h,m,g,p,_,w,C,b,I,T,M;function E(L,x){return L[8]?xp:Ip}let A=E(t),O=A(t);function D(L,x){return L[8]?Ap:Mp}let B=D(t),R=B(t),S=t[7]&&fl(t);return{c(){e=k("div"),n=k("figure"),i=k("img"),s=q(),o=k("div"),l=k("span"),u=q(),d=k("div"),f=k("button"),h=bt("svg"),O.c(),m=q(),g=k("span"),R.c(),_=q(),S&&S.c(),v(i,"class","region-img svelte-1829hp2"),ft(i.src,r=t[9])||v(i,"src",r),v(i,"alt","Extracted region"),v(l,"class","overlay-desc"),v(o,"class","overlay is-center svelte-1829hp2"),v(n,"class",a="image card region-image "+(t[0]?"is-96x96":"")+" svelte-1829hp2"),v(n,"tabindex","-1"),v(n,"style",c=(t[2]==="full"?"height: 100%":`height: ${t[2]}px; min-width: ${t[2]}px`)+"; "+(t[3]?`border: 5px solid ${t[3]};`:"")),v(h,"xmlns","http://www.w3.org/2000/svg"),v(h,"viewBox","0 0 384 512"),v(h,"class","svelte-1829hp2"),v(g,"class","tooltip svelte-1829hp2"),v(f,"class","button tag svelte-1829hp2"),v(f,"style",p=t[6]?"":"display: none;"),v(d,"class","region-btn ml-1 svelte-1829hp2"),v(e,"class",w="region is-center "+(t[5]&&t[11](t[1])?"checked":"")+" svelte-1829hp2"),v(e,"style",C=t[2]==="full"?"height: 100%":"")},m(L,x){j(L,e,x),y(e,n),y(n,i),y(n,s),y(n,o),y(o,l),l.innerHTML=t[10],y(e,u),y(e,d),y(d,f),y(f,h),O.m(h,null),y(f,m),y(f,g),R.m(g,null),y(d,_),S&&S.m(d,null),I=!0,T||(M=[Se(n,"click",t[19]),Se(n,"keyup",Tp),Se(f,"click",t[20])],T=!0)},p(L,[x]){t=L,(!I||x&512&&!ft(i.src,r=t[9]))&&v(i,"src",r),(!I||x&1024)&&(l.innerHTML=t[10]),(!I||x&1&&a!==(a="image card region-image "+(t[0]?"is-96x96":"")+" svelte-1829hp2"))&&v(n,"class",a),(!I||x&12&&c!==(c=(t[2]==="full"?"height: 100%":`height: ${t[2]}px; min-width: ${t[2]}px`)+"; "+(t[3]?`border: 5px solid ${t[3]};`:"")))&&v(n,"style",c),A!==(A=E(t))&&(O.d(1),O=A(t),O&&(O.c(),O.m(h,null))),B===(B=D(t))&&R?R.p(t,x):(R.d(1),R=B(t),R&&(R.c(),R.m(g,null))),(!I||x&64&&p!==(p=t[6]?"":"display: none;"))&&v(f,"style",p),t[7]?S?(S.p(t,x),x&128&&V(S,1)):(S=fl(t),S.c(),V(S,1),S.m(d,null)):S&&(Ee(),K(S,1,1,()=>{S=null}),Ce()),(!I||x&2082&&w!==(w="region is-center "+(t[5]&&t[11](t[1])?"checked":"")+" svelte-1829hp2"))&&v(e,"class",w),(!I||x&4&&C!==(C=t[2]==="full"?"height: 100%":""))&&v(e,"style",C)},i(L){I||(V(S),Rt(()=>{I&&(b||(b=qt(e,vn,{duration:t[15]},!0)),b.run(1))}),I=!0)},o(L){K(S),b||(b=qt(e,vn,{duration:t[15]},!1)),b.run(0),I=!1},d(L){L&&$(e),O.d(),R.d(),S&&S.d(),L&&b&&b.end(),T=!1,Ye(M)}}}const Tp=()=>null;function Op(t,e,n){let i,r,s,o,l,{selectionStore:a}=e;a||(a=Ep);const{isSelected:c}=a;ge(t,c,A=>n(11,l=A));const{clipBoard:u}=ul;ge(t,u,A=>n(18,o=A));let{item:d}=e,{descPromise:f=void 0}=e,{isSquare:h=!0}=e,{height:m=h?96:140}=e;m==="full"&&(h=!1);let{borderColor:g=null}=e,{toggleSelection:p=a.toggle}=e;const _=ht("qImgMetadata")||void 0,w=ht("isInModal")||!1,C=w?0:500;let b;w||Ur(()=>Promise.resolve().then(()=>T_),void 0).then(A=>n(7,b=A.default));let{selectable:I=!w}=e,{copyable:T=!0}=e;const M=()=>I?p(d):null,E=()=>T?ul.copyRef(d.ref):null;return t.$$set=A=>{"selectionStore"in A&&n(16,a=A.selectionStore),"item"in A&&n(1,d=A.item),"descPromise"in A&&n(17,f=A.descPromise),"isSquare"in A&&n(0,h=A.isSquare),"height"in A&&n(2,m=A.height),"borderColor"in A&&n(3,g=A.borderColor),"toggleSelection"in A&&n(4,p=A.toggleSelection),"selectable"in A&&n(5,I=A.selectable),"copyable"in A&&n(6,T=A.copyable)},t.$$.update=()=>{t.$$.dirty&2&&n(10,i=d.title),t.$$.dirty&131072&&f&&f.then(A=>n(10,i=A)),t.$$.dirty&7&&n(9,r=Mt(d.img??d.ref,d.xywh,m==="full"?m:h?`${m},`:`,${m}`)),t.$$.dirty&262146&&n(8,s=d.ref===o)},[h,d,m,g,p,I,T,b,s,r,i,l,c,u,_,C,a,f,o,M,E]}class In extends ye{constructor(e){super(),ve(this,e,Op,Np,pe,{selectionStore:16,item:1,descPromise:17,isSquare:0,height:2,borderColor:3,toggleSelection:4,selectable:5,copyable:6})}}const dy="";function hl(t,e,n){const i=t.slice();return i[11]=e[n],i}function dl(t,e,n){const i=t.slice();return i[14]=e[n],i}function qr(t){const e=t.slice(),n=e[2].get(e[11][e[14]].id);return e[17]=n,e}function ml(t,e,n){const i=t.slice();return i[14]=e[n],i}function pl(t){let e,n,i,r,s,o,l,a,c,u,d=t[0].regions,f=[];for(let _=0;_<d.length;_+=1)f[_]=gl(ml(t,d,_));const h=_=>K(f[_],1,1,()=>{f[_]=null});let m=t[0].rows,g=[];for(let _=0;_<m.length;_+=1)g[_]=yl(hl(t,m,_));const p=_=>K(g[_],1,1,()=>{g[_]=null});return{c(){e=k("div"),n=k("h3"),n.textContent="Aligned Documents",i=q(),r=k("div"),s=k("table"),o=k("thead"),l=k("tr");for(let _=0;_<f.length;_+=1)f[_].c();a=q(),c=k("tbody");for(let _=0;_<g.length;_+=1)g[_].c();v(n,"class","title is-5"),v(o,"class","region-header svelte-1hxxzoa"),v(s,"class","table is-fullwidth svelte-1hxxzoa"),v(r,"class","table-container svelte-1hxxzoa"),v(e,"class","box mt-4")},m(_,w){j(_,e,w),y(e,n),y(e,i),y(e,r),y(r,s),y(s,o),y(o,l);for(let C=0;C<f.length;C+=1)f[C]&&f[C].m(l,null);y(s,a),y(s,c);for(let C=0;C<g.length;C+=1)g[C]&&g[C].m(c,null);u=!0},p(_,w){if(w&3){d=_[0].regions;let C;for(C=0;C<d.length;C+=1){const b=ml(_,d,C);f[C]?(f[C].p(b,w),V(f[C],1)):(f[C]=gl(b),f[C].c(),V(f[C],1),f[C].m(l,null))}for(Ee(),C=d.length;C<f.length;C+=1)h(C);Ce()}if(w&77){m=_[0].rows;let C;for(C=0;C<m.length;C+=1){const b=hl(_,m,C);g[C]?(g[C].p(b,w),V(g[C],1)):(g[C]=yl(b),g[C].c(),V(g[C],1),g[C].m(c,null))}for(Ee(),C=m.length;C<g.length;C+=1)p(C);Ce()}},i(_){if(!u){for(let w=0;w<d.length;w+=1)V(f[w]);for(let w=0;w<m.length;w+=1)V(g[w]);u=!0}},o(_){f=f.filter(Boolean);for(let w=0;w<f.length;w+=1)K(f[w]);g=g.filter(Boolean);for(let w=0;w<g.length;w+=1)K(g[w]);u=!1},d(_){_&&$(e),ot(f,_),ot(g,_)}}}function gl(t){let e,n,i,r;return n=new ur({props:{id:t[14],meta:t[1].get(t[14])||{},clickable:!1}}),{c(){e=k("th"),le(n.$$.fragment),i=q(),v(e,"class","is-vcentered")},m(s,o){j(s,e,o),se(n,e,null),y(e,i),r=!0},p(s,o){const l={};o&1&&(l.id=s[14]),o&3&&(l.meta=s[1].get(s[14])||{}),n.$set(l)},i(s){r||(V(n.$$.fragment,s),r=!0)},o(s){K(n.$$.fragment,s),r=!1},d(s){s&&$(e),oe(n)}}}function _l(t){let e,n,i,r,s=t[11][t[14]].page+"",o,l;return e=new In({props:{item:t[17],selectable:!1,copyable:!1,borderColor:t[6](t[11][t[14]],t[3]),isSquare:!1}}),{c(){le(e.$$.fragment),n=q(),i=k("div"),r=ne("Page "),o=ne(s),v(i,"class","has-text-grey-dark mt-2")},m(a,c){se(e,a,c),j(a,n,c),j(a,i,c),y(i,r),y(i,o),l=!0},p(a,c){const u={};c&5&&(u.item=a[17]),c&9&&(u.borderColor=a[6](a[11][a[14]],a[3])),e.$set(u),(!l||c&1)&&s!==(s=a[11][a[14]].page+"")&&me(o,s)},i(a){l||(V(e.$$.fragment,a),l=!0)},o(a){K(e.$$.fragment,a),l=!1},d(a){oe(e,a),a&&$(n),a&&$(i)}}}function vl(t){let e,n,i=t[11][t[14]]&&_l(qr(t));return{c(){e=k("td"),i&&i.c(),v(e,"class","has-text-centered"),Le(e,"vertical-align","top")},m(r,s){j(r,e,s),i&&i.m(e,null),n=!0},p(r,s){r[11][r[14]]?i?(i.p(qr(r),s),s&1&&V(i,1)):(i=_l(qr(r)),i.c(),V(i,1),i.m(e,null)):i&&(Ee(),K(i,1,1,()=>{i=null}),Ce())},i(r){n||(V(i),n=!0)},o(r){K(i),n=!1},d(r){r&&$(e),i&&i.d()}}}function yl(t){let e,n,i,r=t[0].regions,s=[];for(let l=0;l<r.length;l+=1)s[l]=vl(dl(t,r,l));const o=l=>K(s[l],1,1,()=>{s[l]=null});return{c(){e=k("tr");for(let l=0;l<s.length;l+=1)s[l].c();n=q()},m(l,a){j(l,e,a);for(let c=0;c<s.length;c+=1)s[c]&&s[c].m(e,null);y(e,n),i=!0},p(l,a){if(a&77){r=l[0].regions;let c;for(c=0;c<r.length;c+=1){const u=dl(l,r,c);s[c]?(s[c].p(u,a),V(s[c],1)):(s[c]=vl(u),s[c].c(),V(s[c],1),s[c].m(e,n))}for(Ee(),c=r.length;c<s.length;c+=1)o(c);Ce()}},i(l){if(!i){for(let a=0;a<r.length;a+=1)V(s[a]);i=!0}},o(l){s=s.filter(Boolean);for(let a=0;a<s.length;a+=1)K(s[a]);i=!1},d(l){l&&$(e),ot(s,l)}}}function Pp(t){let e,n,i=t[0]&&pl(t);return{c(){i&&i.c(),e=Ke()},m(r,s){i&&i.m(r,s),j(r,e,s),n=!0},p(r,[s]){r[0]?i?(i.p(r,s),s&1&&V(i,1)):(i=pl(r),i.c(),V(i,1),i.m(e.parentNode,e)):i&&(Ee(),K(i,1,1,()=>{i=null}),Ce())},i(r){n||(V(i),n=!0)},o(r){K(i),n=!1},d(r){i&&i.d(r),r&&$(e)}}}function Lp(t){let e=0;for(let o=0;o<t.length;o++)e=t.charCodeAt(o)+((e<<5)-e),e=e&e;const i=e*.618033988749895%1*360,r=65+e%20,s=80+e%10;return`hsl(${Math.floor(i)}, ${r}%, ${s}%)`}function Dp(t,e,n){let i,r,s,{selectedDocuments:o=[]}=e,{documentSetStore:l}=e;const{buildAlignedImageMatrix:a,documentNodes:c,imageNodes:u}=l;ge(t,c,m=>n(1,r=m)),ge(t,u,m=>n(2,s=m));let d=null;function f(m,g){if(!m)return;const p=m.id;if(g.get(p)!==1)return h.has(p)||h.set(p,Lp(p)),h.get(p)}const h=new Map;return t.$$set=m=>{"selectedDocuments"in m&&n(7,o=m.selectedDocuments),"documentSetStore"in m&&n(8,l=m.documentSetStore)},t.$$.update=()=>{if(t.$$.dirty&134)if(o.length>0&&s&&r){const m=o.map(g=>g.id);n(0,d=a(m))}else n(0,d=null);t.$$.dirty&1&&n(3,i=d?(()=>{const m=new Map;return d.rows.forEach(g=>{Object.values(g).forEach(p=>{m.set(p.id,(m.get(p.id)||0)+1)})}),m})():new Map)},[d,r,s,i,c,u,f,o,l]}class Rp extends ye{constructor(e){super(),ve(this,e,Dp,Pp,pe,{selectedDocuments:7,documentSetStore:8})}}const my="";function bl(t,e,n){const i=t.slice();return i[15]=e[n],i}function $p(t){let e;return{c(){e=k("span"),e.innerHTML='<i class="fas fa-crop-alt"></i>',v(e,"class","icon px-4")},m(n,i){j(n,e,i)},d(n){n&&$(e)}}}function zp(t){let e;return{c(){e=k("span"),e.innerHTML='<i class="fas fa-hand-pointer"></i>',v(e,"class","icon px-4")},m(n,i){j(n,e,i)},d(n){n&&$(e)}}}function wl(t){let e,n,i,r;const s=[Fp,jp],o=[];function l(a,c){return a[0]==="img"?0:a[0]==="doc"?1:-1}return~(e=l(t))&&(n=o[e]=s[e](t)),{c(){n&&n.c(),i=Ke()},m(a,c){~e&&o[e].m(a,c),j(a,i,c),r=!0},p(a,c){let u=e;e=l(a),e===u?~e&&o[e].p(a,c):(n&&(Ee(),K(o[u],1,1,()=>{o[u]=null}),Ce()),~e?(n=o[e],n?n.p(a,c):(n=o[e]=s[e](a),n.c()),V(n,1),n.m(i.parentNode,i)):n=null)},i(a){r||(V(n),r=!0)},o(a){K(n),r=!1},d(a){~e&&o[e].d(a),a&&$(i)}}}function jp(t){let e,n;return e=new Rp({props:{selectedDocuments:t[5],documentSetStore:t[1]}}),{c(){le(e.$$.fragment)},m(i,r){se(e,i,r),n=!0},p(i,r){const s={};r&32&&(s.selectedDocuments=i[5]),r&2&&(s.documentSetStore=i[1]),e.$set(s)},i(i){n||(V(e.$$.fragment,i),n=!0)},o(i){K(e.$$.fragment,i),n=!1},d(i){oe(e,i)}}}function Fp(t){let e,n,i=W==="en"?"Selected regions":"Régions sélectionnées",r,s,o=t[5].length+"",l,a,c,u,d=[],f=new Map,h,m=t[5];const g=p=>p[15].id;for(let p=0;p<m.length;p+=1){let _=bl(t,m,p),w=g(_);f.set(w,d[p]=Sl(w,_))}return{c(){e=k("div"),n=k("h3"),r=ne(i),s=ne(" ("),l=ne(o),a=ne(")"),c=q(),u=k("div");for(let p=0;p<d.length;p+=1)d[p].c();v(n,"class","title is-5"),v(u,"class","selected-nodes grid is-gap-2 mt-5 svelte-1a3kdxu"),v(e,"class","selected-panel box mt-4 svelte-1a3kdxu")},m(p,_){j(p,e,_),y(e,n),y(n,r),y(n,s),y(n,l),y(n,a),y(e,c),y(e,u);for(let w=0;w<d.length;w+=1)d[w]&&d[w].m(u,null);h=!0},p(p,_){(!h||_&32)&&o!==(o=p[5].length+"")&&me(l,o),_&32&&(m=p[5],Ee(),d=ir(d,_,g,1,p,m,f,u,nr,Sl,null,bl),Ce())},i(p){if(!h){for(let _=0;_<m.length;_+=1)V(d[_]);h=!0}},o(p){for(let _=0;_<d.length;_+=1)K(d[_]);h=!1},d(p){p&&$(e);for(let _=0;_<d.length;_+=1)d[_].d()}}}function Sl(t,e){let n,i,r;return i=new In({props:{item:e[15],selectable:!1,copyable:!1}}),{key:t,first:null,c(){n=Ke(),le(i.$$.fragment),this.first=n},m(s,o){j(s,n,o),se(i,s,o),r=!0},p(s,o){e=s;const l={};o&32&&(l.item=e[15]),i.$set(l)},i(s){r||(V(i.$$.fragment,s),r=!0)},o(s){K(i.$$.fragment,s),r=!1},d(s){s&&$(n),oe(i,s)}}}function Vp(t){let e,n,i,r=t[3]?"click":"selection",s,o,l,a,c,u,d,f;function h(_,w){return _[3]?zp:$p}let m=h(t),g=m(t),p=t[5].length>0&&wl(t);return{c(){e=k("div"),n=k("button"),g.c(),i=ne(`
        Switch to `),s=ne(r),o=ne(" mode"),l=q(),a=k("div"),c=q(),p&&p.c(),v(n,"class","toggle-button button is-small is-link mb-3"),Pe(n,"is-active",t[3]),v(a,"class","visualization-container")},m(_,w){j(_,e,w),y(e,n),g.m(n,null),y(n,i),y(n,s),y(n,o),y(e,l),y(e,a),t[9](a),y(e,c),p&&p.m(e,null),u=!0,d||(f=Se(n,"click",t[7]),d=!0)},p(_,[w]){m!==(m=h(_))&&(g.d(1),g=m(_),g&&(g.c(),g.m(n,i))),(!u||w&8)&&r!==(r=_[3]?"click":"selection")&&me(s,r),(!u||w&8)&&Pe(n,"is-active",_[3]),_[5].length>0?p?(p.p(_,w),w&32&&V(p,1)):(p=wl(_),p.c(),V(p,1),p.m(e,null)):p&&(Ee(),K(p,1,1,()=>{p=null}),Ce())},i(_){u||(V(p),u=!0)},o(_){K(p),u=!1},d(_){_&&$(e),g.d(),t[9](null),p&&p.d(),d=!1,f()}}}const Hp=1e3;function Up(t,e,n){let i,r,s=X,o=()=>(s(),s=ti(i,b=>n(8,r=b)),i),l;t.$$.on_destroy.push(()=>s());let{type:a="img"}=e,{documentSetStore:c}=e;const{imageNetwork:u,documentNetwork:d,selectedNodes:f,updateSelectedNodes:h}=c;ge(t,f,b=>n(5,l=b));let m,g,p=!1;function _(){m&&(m.destroy(),h([]));function b(T){h(T)}m=(r.nodes.length<Hp?vp:up)(g,r.nodes,r.links,b,T=>{n(3,p=T)}),n(3,p=a==="img"),p&&m.toggleSelectionMode()}function w(){m&&n(3,p=m.toggleSelectionMode())}Tn(()=>{m==null||m.destroy()});function C(b){mn[b?"unshift":"push"](()=>{g=b,n(2,g)})}return t.$$set=b=>{"type"in b&&n(0,a=b.type),"documentSetStore"in b&&n(1,c=b.documentSetStore)},t.$$.update=()=>{t.$$.dirty&1&&o(n(4,i=a==="img"?u:d)),t.$$.dirty&260&&r&&g&&_()},[a,c,g,p,i,l,f,w,r,C]}class Bp extends ye{constructor(e){super(),ve(this,e,Up,Vp,pe,{type:0,documentSetStore:1})}}const py="";function kl(t,e,n){const i=t.slice();return i[20]=e[n],i[22]=n,i}function qp(t){let e,n,i,r,s,o,l,a,c,u,d,f=t[3],h=[];for(let p=0;p<f.length;p+=1)h[p]=El(kl(t,f,p));const m=p=>K(h[p],1,1,()=>{h[p]=null});let g=t[2]&&Cl(t);return{c(){e=k("div"),n=k("h3"),n.textContent="Similarity Matrix",i=q(),r=k("div"),s=k("div"),o=k("div");for(let p=0;p<h.length;p+=1)h[p].c();l=q(),a=k("div"),c=q(),g&&g.c(),u=Ke(),v(n,"class","title is-5"),v(o,"class","row-headers svelte-naitnw"),v(a,"class","matrix-container svelte-naitnw"),v(s,"class","matrix-content svelte-naitnw"),v(r,"class","matrix-wrapper svelte-naitnw"),v(e,"class","matrix-panel column svelte-naitnw")},m(p,_){j(p,e,_),y(e,n),y(e,i),y(e,r),y(r,s),y(s,o);for(let w=0;w<h.length;w+=1)h[w]&&h[w].m(o,null);y(s,l),y(s,a),t[13](a),j(p,c,_),g&&g.m(p,_),j(p,u,_),d=!0},p(p,_){if(_&8){f=p[3];let w;for(w=0;w<f.length;w+=1){const C=kl(p,f,w);h[w]?(h[w].p(C,_),V(h[w],1)):(h[w]=El(C),h[w].c(),V(h[w],1),h[w].m(o,null))}for(Ee(),w=f.length;w<h.length;w+=1)m(w);Ce()}p[2]?g?g.p(p,_):(g=Cl(p),g.c(),g.m(u.parentNode,u)):g&&(g.d(1),g=null)},i(p){if(!d){for(let _=0;_<f.length;_+=1)V(h[_]);d=!0}},o(p){h=h.filter(Boolean);for(let _=0;_<h.length;_+=1)K(h[_]);d=!1},d(p){p&&$(e),ot(h,p),t[13](null),p&&$(c),g&&g.d(p),p&&$(u)}}}function Kp(t){let e;return{c(){e=k("div"),e.textContent="Aucun document disponible pour afficher la matrice de similarité.",v(e,"class","notification is-info")},m(n,i){j(n,e,i)},p:X,i:X,o:X,d(n){n&&$(e)}}}function El(t){let e,n,i,r;return n=new ur({props:{id:t[20].id,meta:t[20],onlyColor:!0,clickable:!1}}),{c(){e=k("div"),le(n.$$.fragment),i=q(),v(e,"class","row-header svelte-naitnw"),Le(e,"height",Gt+"px"),Le(e,"line-height",Gt+"px")},m(s,o){j(s,e,o),se(n,e,null),y(e,i),r=!0},p(s,o){const l={};o&8&&(l.id=s[20].id),o&8&&(l.meta=s[20]),n.$set(l)},i(s){r||(V(n.$$.fragment,s),r=!0)},o(s){K(n.$$.fragment,s),r=!1},d(s){s&&$(e),oe(n)}}}function Cl(t){let e,n,i,r;return{c(){e=k("div"),n=k("h3"),n.textContent="Page-by-page similarity",i=q(),r=k("div"),v(n,"class","title is-5"),v(r,"class","scatter-container svelte-naitnw"),v(e,"class","scatter-panel column svelte-naitnw")},m(s,o){j(s,e,o),y(e,n),y(e,i),y(e,r),t[14](r)},p:X,d(s){s&&$(e),t[14](null)}}}function Wp(t){let e,n,i,r;const s=[Kp,qp],o=[];function l(a,c){return a[3].length?1:0}return n=l(t),i=o[n]=s[n](t),{c(){e=k("div"),i.c(),v(e,"class","document-matrix columns svelte-naitnw")},m(a,c){j(a,e,c),o[n].m(e,null),r=!0},p(a,[c]){let u=n;n=l(a),n===u?o[n].p(a,c):(Ee(),K(o[u],1,1,()=>{o[u]=null}),Ce(),i=o[n],i?i.p(a,c):(i=o[n]=s[n](a),i.c()),V(i,1),i.m(e,null))},i(a){r||(V(i),r=!0)},o(a){K(i),r=!1},d(a){a&&$(e),o[n].d()}}}const Gt=30;function Gp(t,e){const n=[];let i=0;e.forEach(({score:r})=>{r>i&&(i=r)});for(let r=0;r<t.length;r++){const s=[];for(let o=0;o<t.length;o++)if(r===o)s.push({score:0,normalized:0,isDiagonal:!0});else{const{r1:l,r2:a}={r1:t[r].id,r2:t[o].id},c=l<a?`${l}-${a}`:`${a}-${l}`,u=e.get(c),d=(u==null?void 0:u.score)||0,f=i>0?d/i*100:0;s.push({score:d,normalized:f,isDiagonal:!1})}n.push(s)}return{docs:t,matrix:n,max:i}}function Yp(t,e,n=.05,i=1){const{min:r,_:s,range:o}=e;return o===0?.55:n+Math.pow((t-r)/o,3)*i}function Xp(t,e,n){let i,r,s,o,l,a,c,{documentSetStore:u}=e;const{documentNodes:d,docPairStats:f,pairIndex:h,selectedCategories:m}=u;ge(t,d,M=>n(12,c=M)),ge(t,f,M=>n(11,a=M)),ge(t,h,M=>n(16,l=M)),ge(t,m,M=>n(15,o=M));let g,p,_=null;function w(M){const{doc1:E,doc2:A}=M,O=E.id<A.id?`${E.id}-${A.id}`:`${A.id}-${E.id}`,D=l.byDocPair.get(O)||[];if(!D.length)return null;const B=new Map;let R=1/0,S=-1/0;return D.forEach(x=>{let F,H,U;x.regions_id_1===E.id?(F=x.page_1,H=x.page_2,U=x.weightedScore||0):(F=x.page_2,H=x.page_1,U=x.weightedScore||0);const Y=`${F}-${H}`;B.has(Y)||B.set(Y,{page1:F,page2:H,scores:[],count:0});const J=B.get(Y);J.scores.push(U),J.count++,U<R&&(R=U),U>S&&(S=U)}),{points:Array.from(B.values()).map(({page1:x,page2:F,scores:H,count:U})=>{const Y=H.reduce((J,ie)=>J+ie,0)/U;return{page1:x,page2:F,score:Y,count:U}}),minScore:R,maxScore:S,doc1:E,doc2:A}}function C(M,E){if(!M||!E.docs.length)return;Xe(M).selectAll("*").remove();const A={top:10,right:20,bottom:20,left:10},O=E.docs.length*Gt+A.left+A.right,D=E.docs.length*Gt+A.top+A.bottom;Xe(M).append("svg").attr("width",O).attr("height",D).append("g").attr("transform",`translate(${A.left},${A.top})`).selectAll(".row").data(E.matrix).join("g").attr("class","row").attr("transform",(L,x)=>`translate(0,${x*Gt})`).selectAll(".cell").data((L,x)=>L.map((F,H)=>({...F,row:x,col:H}))).join("rect").attr("class","cell").attr("x",L=>L.col*Gt).attr("width",Gt).attr("height",Gt).attr("fill",L=>{if(L.isDiagonal)return"#e0e0e0";const x=Sr(233,.951,.52);return x.opacity=L.normalized/100,x}).attr("stroke",L=>_&&_.row===L.row&&_.col===L.col?"#000":"#fff").attr("stroke-width",L=>_&&_.row===L.row&&_.col===L.col?4:1).attr("stroke-opacity",L=>_&&_.row===L.row&&_.col===L.col?1:.3).style("cursor","pointer").on("click",(L,x)=>{n(2,_={row:x.row,col:x.col,doc1:E.docs[x.row],doc2:E.docs[x.col]}),C(M,E)})}function b(M,E){if(!M)return;if(Xe(M).selectAll("*").remove(),!E||!E.points.length){Xe(M).append("div").style("padding","2rem").style("text-align","center").style("color","#999").text("Aucune paire de pages trouvée entre ces deux documents.");return}const A={top:40,right:20,bottom:50,left:60},O=500-A.left-A.right,D=500-A.top-A.bottom,R=Xe(M).append("svg").attr("width",O+A.left+A.right).attr("height",D+A.top+A.bottom).append("g").attr("transform",`translate(${A.left},${A.top})`),S=Math.max(...E.points.map(U=>U.page1),0),L=Math.max(...E.points.map(U=>U.page2),0),x=Fr().domain([0,S]).range([0,O]),F=Fr().domain([0,L]).range([D,0]);R.append("g").attr("transform",`translate(0,${D})`).call(Ou(x).ticks(Math.min(S+1,10)).tickFormat(Di("d"))),R.append("g").call(Pu(F).ticks(Math.min(L+1,10)).tickFormat(Di("d"))),R.append("foreignObject").attr("x",0).attr("y",D+10).attr("width",O).attr("height",100).append("xhtml:div").style("display","flex").style("align-items","center").style("justify-content","center").style("gap","0.5rem").style("margin-top","20px").html(`<span class="legend-color" style="background-color: ${E.doc1.color}; width: 12px; height: 12px; display: inline-block; border-radius: 50%;"></span>
                <span style="font-size: 12px;">${or(E.doc1.title)||`Doc ${E.doc1.id}`} (page)</span>`),R.append("foreignObject").attr("x",-A.left+5).attr("y",0).attr("width",50).attr("height",O).append("xhtml:div").style("display","flex").style("align-items","center").style("justify-content","center").style("gap","0.5rem").style("transform",`rotate(-90deg) translateX(-${D/2}px)`).style("transform-origin","left top").style("white-space","nowrap").html(`<span class="legend-color" style="background-color: ${E.doc2.color}; width: 12px; height: 12px; display: inline-block; border-radius: 50%;"></span>
                <span style="font-size: 12px;">${or(E.doc2.title)||`Doc ${E.doc2.id}`} (page)</span>`);const H=E.maxScore-E.minScore;R.selectAll(".point").data(E.points).join("rect").attr("class","point").attr("x",U=>x(U.page1)-4).attr("y",U=>F(U.page2)-4).attr("width",8).attr("height",8).attr("fill",Sr(233,.951,.52)).attr("opacity",U=>{const Y=o||[];return Y.length===1&&Y[0]===1?1:Yp(U.score,{min:E.minScore,max:E.maxScore,range:H})})}function I(M){mn[M?"unshift":"push"](()=>{g=M,n(0,g)})}function T(M){mn[M?"unshift":"push"](()=>{p=M,n(1,p)})}return t.$$set=M=>{"documentSetStore"in M&&n(8,u=M.documentSetStore)},t.$$.update=()=>{t.$$.dirty&4096&&n(3,i=Array.from((c==null?void 0:c.values())||[])),t.$$.dirty&2056&&n(9,r=Gp(i,a.scoreCount)),t.$$.dirty&4&&n(10,s=_?w(_):null),t.$$.dirty&1026&&p&&s&&b(p,s),t.$$.dirty&513&&g&&r&&C(g,r)},[g,p,_,i,d,f,h,m,u,r,s,a,c,I,T]}class Jp extends ye{constructor(e){super(),ve(this,e,Xp,Wp,pe,{documentSetStore:8})}}const Il="https://vhs.huma-num.fr",Qp=()=>new Worker("/static/js/pairWorker.js",{type:"module"});function Zp(t){const e=be(null),n=be([1]),i=be(new Set),r=be([]),s=be(.5),o=be(null),l=be(!1),a=be([]),c=be(new Map);let u;const d=be({byImage:new Map,byDocPair:new Map,byDoc:new Map}),f=be(new Map),h=be(new Map),m=be({}),g=be({}),p=be({}),_=be({}),w=be({documents:0,pairs:null,images:0,categories:{}}),C=Ue(n,(S,L)=>{u&&u.terminate();const x=414,F=new Promise((H,U)=>{(async()=>{try{const J=await fetch(`${Il}/document-set/${x}/pairs?category=${S.join(",")}`);if(!J.ok)throw new Error(`HTTP ${J.status}`);const ie=await J.json();u=Qp(),u.postMessage({rawPairs:ie,selectedCategories:S}),u.onmessage=async he=>{const{allPairs:te,imageNodes:ce,pairIndex:xe,categories:Ae,stats:we}=he.data;d.set(xe),m.set(we.pairStats),g.set(we.documentStats),p.set(we.imageStats),_.set(we.docPairStats);const $e=Array.from(we.documentStats.scoreCount.keys());et(i).size===0&&i.set(new Set($e));const Ie=await Promise.all($e.map(Ne=>b(Ne).then(_e=>({id:Ne,info:_e})))),Be=new Map;Ie.forEach(({id:Ne,info:_e})=>Be.set(Ne,_e)),c.set(Be);const ze=new Map;$e.forEach((Ne,_e)=>{const Bt=Be.get(Ne)||{};ze.set(Ne,{id:Ne,title:Bt.title||`Region Extraction ${Ne}`,color:Bt.color||Uc(_e),images:[],...Bt})}),ce.forEach(Ne=>{const _e=ze.get(Ne.regionId);_e&&(Ne.color=_e.color,Ne.title=`${_e.title} | Page ${Ne.canvas}`,_e.images.push(Ne))}),ze.forEach(Ne=>Ne.images.sort((_e,Bt)=>_e.canvas-Bt.canvas)),f.set(ce),h.set(ze),w.set({documents:$e.length,pairs:te.length,images:ce.size,categories:Ae}),a.set(te),u.terminate(),u=null,H(te.length)},u.onerror=he=>{console.error("Worker error",he);const te=`Error processing pairs: ${he.message}`;e.set(te),U(new Error(te))}}catch(J){const ie=`Fetch error: ${J.message}`;e.set(ie),U(new Error(ie))}})()});L(F)});async function b(S){try{const L=await fetch(`${Il}/search/regions/?id=${S}`);if(!L.ok)throw new Error(`HTTP ${L.status}`);const{results:x}=await L.json();if(!(x!=null&&x.length))return{title:`Region Extraction ${S}`};const F=x[0],[,...H]=F.title.split(" | "),[U,Y]=(F.ref||"_").split("_");return{title:H.join(" | "),ref:F.ref,witnessId:sr(U),digitizationRef:Y,zeros:F.zeros,img_nb:F.img_nb,url:F.url}}catch(L){return e.set(`Error fetching region #${S}: ${L.message}`),{title:`Region Extraction ${S}`}}}const I=Ue([a,s,o,l,i],([S,L,x,F,H])=>{if(!S)return[];const U=[];for(let Y=0;Y<S.length;Y++){const J=S[Y];if(J.weightedScore<L)break;if(!(!H.has(J.regions_id_1)||!H.has(J.regions_id_2))){if(x!==null){if(F){if(J.rank_1>x||J.rank_2>x)continue}else if(J.rank_1>x&&J.rank_2>x)continue}U.push(J)}}return U}),T=Ue([I,h],([S,L])=>{if(!S.length||L.size===0)return[];const x=new Set;for(const H of S)x.add(H.regions_id_1),x.add(H.regions_id_2);const F=[];return x.forEach(H=>{const U=L.get(H);U&&F.push(U)}),F.sort((H,U)=>U.id-H.id)});function M(S,L,x=10,F=200,H=2,U=25){if(!L)return{strength:.5,distance:100,width:2};const{min:Y,_:J,range:ie}=L,he=ie===0?.5:(S-Y)/ie,te=F-he*(F-x),ce=H+he*(U-H);return{strength:he,distance:te,width:ce}}function E(S,L,x=10,F=60){if(!L)return x;const{min:H,_:U,range:Y}=L;return Y===0?(x+F)/2:x+(S-H)/Y*(F-x)}const A=Ue([I],([S])=>{var J;const L=et(f),x=et(p),F=et(m),H=new Set,U=[];for(const ie of S){const{strength:he,distance:te,width:ce}=M(ie.weightedScore,F.scoreRange);U.push({source:ie.id_1,target:ie.id_2,strength:he,distance:te,width:ce}),H.has(ie.id_1)||H.add(ie.id_1),H.has(ie.id_2)||H.add(ie.id_2)}const Y=[];for(const ie of H){const he=L.get(ie);if(he){const te=(J=x.scoreCount)==null?void 0:J.get(ie),{count:ce,score:xe}=te;Y.push({...he,radius:E(xe,x.scoreRange),label:`Region: ${he.regionId}
Page: ${he.canvas}
Connections: ${ce}
Total score: ${xe.toFixed(2)}`})}}return{nodes:Y,links:U}}),O=Ue(T,S=>{const L=et(_),x=et(g);if(S.size===0)return{nodes:[],links:[]};const F=Array.from(S.values()).map(U=>{var he;const Y=(he=x.scoreCount)==null?void 0:he.get(U.id),{count:J,score:ie}=Y;return{...U,radius:E(J,x.countRange),label:`${U.title}
Images: ${J}
Total score: ${ie.toFixed(2)}`}}),H=Array.from(L.scoreCount.entries()).map(([U,Y])=>{const[J,ie]=U.split("-").map(Number),{strength:he,distance:te,width:ce}=M(Y.score,L.scoreRange);return{source:J,target:ie,strength:he,distance:te,width:ce}});return{nodes:F,links:H}});function D(S){if(!S.length)return{regions:[],rows:[]};const L=et(h),x=et(d),F=S[0],H=L.get(F);if(!(H!=null&&H.images))return{regions:S,rows:[]};const U=H.images,Y=(te,ce,xe)=>{const{r1:Ae,r2:we}={r1:ce,r2:xe},$e=Ae<we?`${Ae}-${we}`:`${we}-${Ae}`;return(x.byDocPair.get($e)||[]).map(Ie=>Ie.id_1===te&&Ie.regions_id_1===ce?{id:Ie.id_2,page:Ie.page_2}:Ie.id_2===te&&Ie.regions_id_2===ce?{id:Ie.id_1,page:Ie.page_1}:null).filter(Boolean)},J=[];for(const te of U){let ce=[{[F]:{id:te.id,page:te.canvas}}];for(let xe=1;xe<S.length;xe++){const Ae=S[xe],we=[];for(const $e of ce){const It=[];for(let Ie=0;Ie<xe;Ie++){const Be=S[Ie];if($e[Be]){const ze=Y($e[Be].id,Be,Ae);It.push(...ze)}}if(It.length===0)we.push($e);else{const Ie=new Map;It.forEach(Be=>{Ie.has(Be.id)||Ie.set(Be.id,Be)});for(const Be of Ie.values()){const ze={...$e,[Ae]:Be};we.push(ze)}}}ce=we}J.push(...ce)}const ie=[],he=new Set;for(const te of J){const ce=S.map(xe=>{var Ae;return((Ae=te[xe])==null?void 0:Ae.id)||""}).join("|");he.has(ce)||(he.add(ce),ie.push(te))}return{regions:S,rows:ie}}function B(S){n.update(L=>L.indexOf(S)>-1?L.filter(F=>F!==S):[...L,S].sort((F,H)=>F-H))}function R(S){i.update(L=>{const x=new Set(L);return x.has(S)?x.delete(S):x.add(S),x})}return{error:e,allPairs:a,visiblePairs:I,pairIndex:d,documentNodes:h,imageNodes:f,fetchPairs:C,imageNetwork:A,documentNetwork:O,selectedCategories:n,pairStats:m,documentStats:g,imageStats:p,docPairStats:_,docSetNumber:w,selectedNodes:r,selectedRegions:i,updateSelectedNodes:S=>r.set(S),toggleCategory:B,toggleRegion:R,buildAlignedImageMatrix:D,threshold:s,setThreshold:S=>s.set(S),topK:o,setTopK:S=>o.set(S),mutualTopK:l,setMutualTopK:S=>l.set(S)}}function xl(t){let e,n,i,r,s,o=(t[0].clusters||0)+"",l;return{c(){e=k("div"),n=k("div"),i=k("p"),i.textContent="Clusters",r=q(),s=k("p"),l=ne(o),v(i,"class","heading"),v(s,"class","title is-5"),v(e,"class","level-item")},m(a,c){j(a,e,c),y(e,n),y(n,i),y(n,r),y(n,s),y(s,l)},p(a,c){c&1&&o!==(o=(a[0].clusters||0)+"")&&me(l,o)},d(a){a&&$(e)}}}function eg(t){var D,B,R;let e,n,i,r,s,o,l=(t[0].count||0)+"",a,c,u,d,f,h,m,g=(t[0].links||0)+"",p,_,w,C,b,I,T,M,E=(((B=(D=t[0])==null?void 0:D.density)==null?void 0:B.toFixed(3))||0)+"",A,O=((R=t[0])==null?void 0:R.clusters)&&xl(t);return{c(){e=k("div"),n=k("div"),i=k("div"),r=k("p"),r.textContent=`${W==="en"?"Nodes":"Nœuds"}`,s=q(),o=k("p"),a=ne(l),c=q(),u=k("div"),d=k("div"),f=k("p"),f.textContent=`${W==="en"?"Edges":"Liens"}`,h=q(),m=k("p"),p=ne(g),_=q(),O&&O.c(),w=q(),C=k("div"),b=k("div"),I=k("p"),I.textContent=`${W==="en"?"Density":"Densité"}`,T=q(),M=k("p"),A=ne(E),v(r,"class","heading"),v(o,"class","title is-5"),v(n,"class","level-item"),v(f,"class","heading"),v(m,"class","title is-5"),v(u,"class","level-item"),v(I,"class","heading"),v(M,"class","title is-5"),v(C,"class","level-item"),v(e,"class","level has-text-centered")},m(S,L){j(S,e,L),y(e,n),y(n,i),y(i,r),y(i,s),y(i,o),y(o,a),y(e,c),y(e,u),y(u,d),y(d,f),y(d,h),y(d,m),y(m,p),y(e,_),O&&O.m(e,null),y(e,w),y(e,C),y(C,b),y(b,I),y(b,T),y(b,M),y(M,A)},p(S,[L]){var x,F,H;L&1&&l!==(l=(S[0].count||0)+"")&&me(a,l),L&1&&g!==(g=(S[0].links||0)+"")&&me(p,g),(x=S[0])!=null&&x.clusters?O?O.p(S,L):(O=xl(S),O.c(),O.m(e,w)):O&&(O.d(1),O=null),L&1&&E!==(E=(((H=(F=S[0])==null?void 0:F.density)==null?void 0:H.toFixed(3))||0)+"")&&me(A,E)},i:X,o:X,d(S){S&&$(e),O&&O.d()}}}function tg(t,e,n){let i,r,s,o,{activeTab:l="img"}=e,{documentSetStore:a}=e;const{imageStats:c,documentStats:u,docPairStats:d}=a;return ge(t,c,f=>n(8,o=f)),ge(t,u,f=>n(7,s=f)),ge(t,d,f=>n(6,r=f)),t.$$set=f=>{"activeTab"in f&&n(4,l=f.activeTab),"documentSetStore"in f&&n(5,a=f.documentSetStore)},t.$$.update=()=>{t.$$.dirty&464&&n(0,i=l==="img"?o:l==="doc"?s:r)},[i,c,u,d,l,a,r,s,o]}class ng extends ye{constructor(e){super(),ve(this,e,tg,eg,pe,{activeTab:4,documentSetStore:5})}}function ig(t){let e,n,i;const r=t[1].default,s=gt(r,t,t[0],null);return{c(){e=k("table"),n=k("tbody"),s&&s.c(),v(e,"class","table is-fullwidth")},m(o,l){j(o,e,l),y(e,n),s&&s.m(n,null),i=!0},p(o,[l]){s&&s.p&&(!i||l&1)&&vt(s,r,o,o[0],i?_t(r,o[0],l,null):yt(o[0]),null)},i(o){i||(V(s,o),i=!0)},o(o){K(s,o),i=!1},d(o){o&&$(e),s&&s.d(o)}}}function rg(t,e,n){let{$$slots:i={},$$scope:r}=e;return t.$$set=s=>{"$$scope"in s&&n(0,r=s.$$scope)},[r,i]}class sg extends ye{constructor(e){super(),ve(this,e,rg,ig,pe,{})}}const og=t=>({}),Ml=t=>({}),lg=t=>({}),Al=t=>({}),ag=t=>({}),Nl=t=>({});function cg(t){let e;const n=t[4]["row-body"],i=gt(n,t,t[3],Ml);return{c(){i&&i.c()},m(r,s){i&&i.m(r,s),e=!0},p(r,s){i&&i.p&&(!e||s&8)&&vt(i,n,r,r[3],e?_t(n,r[3],s,og):yt(r[3]),Ml)},i(r){e||(V(i,r),e=!0)},o(r){K(i,r),e=!1},d(r){i&&i.d(r)}}}function ug(t){let e,n,i,r;const s=t[4]["row-body"],o=gt(s,t,t[3],Al);return{c(){e=k("div"),n=k("div"),o&&o.c(),v(n,"class","grid is-gap-2"),v(e,"class",i="fixed-grid has-"+t[2]+"-cols")},m(l,a){j(l,e,a),y(e,n),o&&o.m(n,null),r=!0},p(l,a){o&&o.p&&(!r||a&8)&&vt(o,s,l,l[3],r?_t(s,l[3],a,lg):yt(l[3]),Al),(!r||a&4&&i!==(i="fixed-grid has-"+l[2]+"-cols"))&&v(e,"class",i)},i(l){r||(V(o,l),r=!0)},o(l){K(o,l),r=!1},d(l){l&&$(e),o&&o.d(l)}}}function fg(t){let e,n,i,r,s,o,l,a,c,u;Rt(t[5]);const d=t[4]["row-header"],f=gt(d,t,t[3],Nl),h=[ug,cg],m=[];function g(p,_){return p[0]?0:1}return o=g(t),l=m[o]=h[o](t),{c(){e=k("tr"),n=k("th"),i=k("div"),f&&f.c(),r=q(),s=k("td"),l.c(),v(i,"class","content-wrapper py-5"),v(n,"class","is-3 center-flex is-narrow"),Le(n,"width","15vw"),v(s,"class","p-5 is-fullwidth")},m(p,_){j(p,e,_),y(e,n),y(n,i),f&&f.m(i,null),y(e,r),y(e,s),m[o].m(s,null),a=!0,c||(u=Se(window,"resize",t[5]),c=!0)},p(p,[_]){f&&f.p&&(!a||_&8)&&vt(f,d,p,p[3],a?_t(d,p[3],_,ag):yt(p[3]),Nl);let w=o;o=g(p),o===w?m[o].p(p,_):(Ee(),K(m[w],1,1,()=>{m[w]=null}),Ce(),l=m[o],l?l.p(p,_):(l=m[o]=h[o](p),l.c()),V(l,1),l.m(s,null))},i(p){a||(V(f,p),V(l),a=!0)},o(p){K(f,p),K(l),a=!1},d(p){p&&$(e),f&&f.d(p),m[o].d(),c=!1,u()}}}function hg(t,e,n){let i,{$$slots:r={},$$scope:s}=e,{useGrid:o=!0}=e,l=0;function a(){n(1,l=window.innerWidth)}return t.$$set=c=>{"useGrid"in c&&n(0,o=c.useGrid),"$$scope"in c&&n(3,s=c.$$scope)},t.$$.update=()=>{t.$$.dirty&2&&n(2,i=xs(l))},[o,l,i,s,r,a]}class Tl extends ye{constructor(e){super(),ve(this,e,hg,fg,pe,{useGrid:0})}}const gy="";function dg(t){let e,n,i;return{c(){e=k("span"),n=ne(t[0]),v(e,"id",t[3]),v(e,"class",i="tooltip "+t[2]+" "+(t[1]?"display":"")+" svelte-1am23me")},m(r,s){j(r,e,s),y(e,n)},p(r,[s]){s&1&&me(n,r[0]),s&6&&i!==(i="tooltip "+r[2]+" "+(r[1]?"display":"")+" svelte-1am23me")&&v(e,"class",i)},i:X,o:X,d(r){r&&$(e)}}}function mg(t,e,n){let i,r,s,o,{tooltipText:l}=e,{targetHtmlId:a}=e;const c=`tooltip-generic-${window.crypto.randomUUID()}`,u=()=>n(1,o=!0),d=()=>n(1,o=!1),f=()=>n(1,o=!o);return Nn(()=>{s=a?document.getElementById(a):document.getElementById(c).parentElement,a&&!s&&(console.error(`TooltipGeneric: element with ID ${a} not found, defaulting to the parent element`),s=document.getElementById(c).targetElement),s.addEventListener("mouseover",u),s.addEventListener("mouseout",d),s.addEventListener("click",f)}),Tn(()=>{s.removeEventListener("mouseover",u),s.removeEventListener("mouseout",d),s.removeEventListener("click",f)}),t.$$set=h=>{"tooltipText"in h&&n(0,l=h.tooltipText),"targetHtmlId"in h&&n(4,a=h.targetHtmlId)},t.$$.update=()=>{t.$$.dirty&33&&n(2,i=r(l))},n(5,r=h=>n(2,i=h.length>100?"tooltip-wide":h.length>20?"tooltip-mid":"tooltip-thin")),s=void 0,n(1,o=!1),[l,o,i,c,a,r]}class zi extends ye{constructor(e){super(),ve(this,e,mg,dg,pe,{tooltipText:0,targetHtmlId:4})}}const _y="",pg=t=>({}),Ol=t=>({}),gg=t=>({}),Pl=t=>({});function Ll(t){let e,n,i,r,s,o,l,a,c,u,d,f=t[1]&&Dl(t);return a=new zi({props:{tooltipText:t[2][t[1]][W]}}),{c(){f&&f.c(),e=q(),n=k("div"),i=k("button"),r=bt("svg"),s=bt("path"),l=q(),le(a.$$.fragment),v(s,"fill","none"),v(s,"stroke","currentColor"),v(s,"stroke-linecap","round"),v(s,"stroke-linejoin","round"),v(s,"stroke-width","1.5"),v(s,"d","M12 3v18m0 0l8.5-8.5M12 21l-8.5-8.5"),v(r,"style",o=`transform: rotate(${t[1]?"180":"0"}deg)`),v(r,"xmlns","http://www.w3.org/2000/svg"),v(r,"width","24"),v(r,"height","24"),v(r,"viewBox","0 0 24 24"),v(r,"class","svelte-jbs1sd"),v(i,"class","button is-link svelte-jbs1sd"),v(n,"class","ctrl-toggle svelte-jbs1sd")},m(h,m){f&&f.m(h,m),j(h,e,m),j(h,n,m),y(n,i),y(i,r),y(r,s),y(i,l),se(a,i,null),c=!0,u||(d=Se(i,"click",Lt(t[3])),u=!0)},p(h,m){h[1]?f?(f.p(h,m),m&2&&V(f,1)):(f=Dl(h),f.c(),V(f,1),f.m(e.parentNode,e)):f&&(Ee(),K(f,1,1,()=>{f=null}),Ce()),(!c||m&2&&o!==(o=`transform: rotate(${h[1]?"180":"0"}deg)`))&&v(r,"style",o);const g={};m&2&&(g.tooltipText=h[2][h[1]][W]),a.$set(g)},i(h){c||(V(f),V(a.$$.fragment,h),c=!0)},o(h){K(f),K(a.$$.fragment,h),c=!1},d(h){f&&f.d(h),h&&$(e),h&&$(n),oe(a),u=!1,d()}}}function Dl(t){let e,n,i;const r=t[5]["toolbar-hidden"],s=gt(r,t,t[4],Ol);return{c(){e=k("div"),s&&s.c(),v(e,"class","ctrl-extra")},m(o,l){j(o,e,l),s&&s.m(e,null),i=!0},p(o,l){s&&s.p&&(!i||l&16)&&vt(s,r,o,o[4],i?_t(r,o[4],l,pg):yt(o[4]),Ol)},i(o){i||(V(s,o),Rt(()=>{i&&(n||(n=qt(e,Ts,{axis:"y"},!0)),n.run(1))}),i=!0)},o(o){K(s,o),n||(n=qt(e,Ts,{axis:"y"},!1)),n.run(0),i=!1},d(o){o&&$(e),s&&s.d(o),o&&n&&n.end()}}}function _g(t){let e,n,i,r,s,o,l,a;const c=t[5]["toolbar-visible"],u=gt(c,t,t[4],Pl);let d=t[0]&&Ll(t);return{c(){e=k("div"),n=k("form"),i=k("div"),r=k("div"),s=k("div"),u&&u.c(),o=q(),d&&d.c(),v(s,"class","ctrl-block svelte-jbs1sd"),v(r,"class","ctrl-block-wrapper svelte-jbs1sd"),v(i,"class","ctrl-base"),v(n,"class","ctrl svelte-jbs1sd"),v(e,"id","toolbar"),v(e,"class",l="ctrl-wrapper is-flex is-justify-content-center is-align-items-center "+(t[1]?"toolbar-expanded":"toolbar-collapsed")+" svelte-jbs1sd")},m(f,h){j(f,e,h),y(e,n),y(n,i),y(i,r),y(r,s),u&&u.m(s,null),y(n,o),d&&d.m(n,null),a=!0},p(f,[h]){u&&u.p&&(!a||h&16)&&vt(u,c,f,f[4],a?_t(c,f[4],h,gg):yt(f[4]),Pl),f[0]?d?(d.p(f,h),h&1&&V(d,1)):(d=Ll(f),d.c(),V(d,1),d.m(n,null)):d&&(Ee(),K(d,1,1,()=>{d=null}),Ce()),(!a||h&2&&l!==(l="ctrl-wrapper is-flex is-justify-content-center is-align-items-center "+(f[1]?"toolbar-expanded":"toolbar-collapsed")+" svelte-jbs1sd"))&&v(e,"class",l)},i(f){a||(V(u,f),V(d),a=!0)},o(f){K(u,f),K(d),a=!1},d(f){f&&$(e),u&&u.d(f),d&&d.d()}}}function vg(t,e,n){let i,{$$slots:r={},$$scope:s}=e,{expandable:o=!0}=e;const l={true:{en:"Collapse the toolbar",fr:"Refermer le menu"},false:{en:"Expand the toolbar",fr:"Ouvrir le menu"}},a=()=>n(1,i=!i);return t.$$set=c=>{"expandable"in c&&n(0,o=c.expandable),"$$scope"in c&&n(4,s=c.$$scope)},n(1,i=!1),[o,i,l,a,s,r]}class yg extends ye{constructor(e){super(),ve(this,e,vg,_g,pe,{expandable:0})}}function Rl(t){let e,n,i,r,s,o,l,a,c,u=t[5]>1&&$l(t),d=t[5]<t[3]&&Fl(t);return{c(){e=k("nav"),n=k("ul"),u&&u.c(),i=q(),r=k("li"),s=k("a"),o=ne(t[5]),l=q(),d&&d.c(),v(s,"class","pagination-link is-current"),v(s,"href",null),v(n,"class","pagination-list ml-0"),v(e,"class","pagination is-centered mb-2"),v(e,"aria-label","pagination")},m(f,h){j(f,e,h),y(e,n),u&&u.m(n,null),y(n,i),y(n,r),y(r,s),y(s,o),y(n,l),d&&d.m(n,null),a||(c=Se(s,"click",Lt(t[9])),a=!0)},p(f,h){f[5]>1?u?u.p(f,h):(u=$l(f),u.c(),u.m(n,i)):u&&(u.d(1),u=null),h&32&&me(o,f[5]),f[5]<f[3]?d?d.p(f,h):(d=Fl(f),d.c(),d.m(n,null)):d&&(d.d(1),d=null)},d(f){f&&$(e),u&&u.d(),d&&d.d(),a=!1,c()}}}function $l(t){let e,n,i,r,s,o,l=t[5]-1>1&&zl(t);return{c(){e=k("li"),n=k("a"),n.textContent="1",i=q(),l&&l.c(),r=Ke(),v(n,"class","pagination-link"),v(n,"href",null)},m(a,c){j(a,e,c),y(e,n),j(a,i,c),l&&l.m(a,c),j(a,r,c),s||(o=Se(n,"click",Lt(t[7])),s=!0)},p(a,c){a[5]-1>1?l?l.p(a,c):(l=zl(a),l.c(),l.m(r.parentNode,r)):l&&(l.d(1),l=null)},d(a){a&&$(e),a&&$(i),l&&l.d(a),a&&$(r),s=!1,o()}}}function zl(t){let e,n,i,r=t[5]-1+"",s,o,l,a=t[5]-1>2&&jl();return{c(){a&&a.c(),e=q(),n=k("li"),i=k("a"),s=ne(r),v(i,"class","pagination-link"),v(i,"href",null)},m(c,u){a&&a.m(c,u),j(c,e,u),j(c,n,u),y(n,i),y(i,s),o||(l=Se(i,"click",Lt(t[8])),o=!0)},p(c,u){c[5]-1>2?a||(a=jl(),a.c(),a.m(e.parentNode,e)):a&&(a.d(1),a=null),u&32&&r!==(r=c[5]-1+"")&&me(s,r)},d(c){a&&a.d(c),c&&$(e),c&&$(n),o=!1,l()}}}function jl(t){let e;return{c(){e=k("li"),e.innerHTML='<span class="pagination-ellipsis">…</span>'},m(n,i){j(n,e,i)},d(n){n&&$(e)}}}function Fl(t){let e,n,i,r,s,o,l=t[5]+1<t[3]&&Vl(t);return{c(){l&&l.c(),e=q(),n=k("li"),i=k("a"),r=ne(t[3]),v(i,"class","pagination-link"),v(i,"href",null)},m(a,c){l&&l.m(a,c),j(a,e,c),j(a,n,c),y(n,i),y(i,r),s||(o=Se(i,"click",Lt(t[11])),s=!0)},p(a,c){a[5]+1<a[3]?l?l.p(a,c):(l=Vl(a),l.c(),l.m(e.parentNode,e)):l&&(l.d(1),l=null),c&8&&me(r,a[3])},d(a){l&&l.d(a),a&&$(e),a&&$(n),s=!1,o()}}}function Vl(t){let e,n,i=t[5]+1+"",r,s,o,l,a,c=t[5]+2<t[3]&&Hl();return{c(){e=k("li"),n=k("a"),r=ne(i),s=q(),c&&c.c(),o=Ke(),v(n,"class","pagination-link"),v(n,"href",null)},m(u,d){j(u,e,d),y(e,n),y(n,r),j(u,s,d),c&&c.m(u,d),j(u,o,d),l||(a=Se(n,"click",Lt(t[10])),l=!0)},p(u,d){d&32&&i!==(i=u[5]+1+"")&&me(r,i),u[5]+2<u[3]?c||(c=Hl(),c.c(),c.m(o.parentNode,o)):c&&(c.d(1),c=null)},d(u){u&&$(e),u&&$(s),c&&c.d(u),u&&$(o),l=!1,a()}}}function Hl(t){let e;return{c(){e=k("li"),e.innerHTML='<span class="pagination-ellipsis">…</span>'},m(n,i){j(n,e,i)},d(n){n&&$(e)}}}function bg(t){let e,n,i=t[5]*t[2]-t[2]+1+"",r,s,o=Math.min(t[5]*t[2],t[1])+"",l,a,c,u,d=t[4]&&Rl(t);return{c(){d&&d.c(),e=q(),n=k("div"),r=ne(i),s=ne(" - "),l=ne(o),a=ne(" / "),c=ne(t[1]),v(n,"class",u="is-size-7 is-center mb-4 "+(t[4]?"":"mt-4"))},m(f,h){d&&d.m(f,h),j(f,e,h),j(f,n,h),y(n,r),y(n,s),y(n,l),y(n,a),y(n,c)},p(f,[h]){f[4]?d?d.p(f,h):(d=Rl(f),d.c(),d.m(e.parentNode,e)):d&&(d.d(1),d=null),h&36&&i!==(i=f[5]*f[2]-f[2]+1+"")&&me(r,i),h&38&&o!==(o=Math.min(f[5]*f[2],f[1])+"")&&me(l,o),h&2&&me(c,f[1]),h&16&&u!==(u="is-size-7 is-center mb-4 "+(f[4]?"":"mt-4"))&&v(n,"class",u)},i:X,o:X,d(f){d&&d.d(f),f&&$(e),f&&$(n)}}}function wg(t,e,n){let i,r,s,{store:o}=e;const{currentPage:l}=o;ge(t,l,g=>n(5,s=g));let{nbOfItems:a}=e,{pageLength:c=Oc}=e;const u=()=>o.handlePageUpdate(1),d=()=>o.handlePageUpdate(s-1),f=()=>o.handlePageUpdate(s),h=()=>o.handlePageUpdate(s+1),m=()=>o.handlePageUpdate(i);return t.$$set=g=>{"store"in g&&n(0,o=g.store),"nbOfItems"in g&&n(1,a=g.nbOfItems),"pageLength"in g&&n(2,c=g.pageLength)},t.$$.update=()=>{t.$$.dirty&6&&n(3,i=c>0?Math.ceil(a/c):1),t.$$.dirty&14&&n(4,r=i>1||a>c)},[o,a,c,i,r,s,l,u,d,f,h,m]}class Ul extends ye{constructor(e){super(),ve(this,e,wg,bg,pe,{store:0,nbOfItems:1,pageLength:2})}}function Sg(t){let e,n,i,r,s=W==="en"?"Save selection":"Sauvegarder la sélection",o,l,a;return{c(){e=k("button"),n=k("span"),i=k("i"),r=q(),o=ne(s),v(i,"class","fa-solid fa-floppy-disk"),v(e,"class","button is-link")},m(c,u){j(c,e,u),y(e,n),y(n,i),y(n,r),y(n,o),l||(a=Se(e,"click",t[7]),l=!0)},p:X,d(c){c&&$(e),l=!1,a()}}}function kg(t){let e,n,i,r,s=W==="en"?"Go to treatment":"Accéder au traitement",o,l;return{c(){var a;e=k("a"),n=k("span"),i=k("i"),r=q(),o=ne(s),v(i,"class","fa-solid fa-gear"),v(e,"class","button is-link"),v(e,"href",l="/"+wt+"/treatment/add/?document_set="+((a=t[3])==null?void 0:a.id))},m(a,c){j(a,e,c),y(e,n),y(n,i),y(n,r),y(n,o)},p(a,c){var u;c&8&&l!==(l="/"+wt+"/treatment/add/?document_set="+((u=a[3])==null?void 0:u.id))&&v(e,"href",l)},d(a){a&&$(e)}}}function Bl(t){let e,n,i,r,s,o,l;return{c(){var a,c;e=k("a"),n=k("span"),n.innerHTML='<i class="fa-solid fa-file-export"></i> JSON',r=q(),s=k("a"),o=k("span"),o.innerHTML='<i class="fa-solid fa-file-zipper"></i> ZIP',v(e,"class","button is-link is-dark"),v(e,"href",i="/"+wt+"/document-set/"+((a=t[3])==null?void 0:a.id)+"/json"),v(e,"target","_blank"),v(s,"class","button is-link is-dark"),v(s,"href",l="/"+wt+"/document-set/"+((c=t[3])==null?void 0:c.id)+"/zip"),v(s,"target","_blank")},m(a,c){j(a,e,c),y(e,n),j(a,r,c),j(a,s,c),y(s,o)},p(a,c){var u,d;c&8&&i!==(i="/"+wt+"/document-set/"+((u=a[3])==null?void 0:u.id)+"/json")&&v(e,"href",i),c&8&&l!==(l="/"+wt+"/document-set/"+((d=a[3])==null?void 0:d.id)+"/zip")&&v(s,"href",l)},d(a){a&&$(e),a&&$(r),a&&$(s)}}}function Eg(t){let e,n,i,r,s,o,l;function a(f,h){return f[2]&&!f[1]?kg:Sg}let c=a(t),u=c(t),d=!t[1]&&Bl(t);return{c(){e=k("footer"),n=k("div"),i=k("button"),i.textContent=`${W==="en"?"Clear selection":"Vider la sélection"}`,r=q(),u.c(),s=q(),d&&d.c(),v(i,"class","button button-close is-link is-light"),v(n,"class","buttons"),v(e,"class","modal-card-foot is-center")},m(f,h){j(f,e,h),y(e,n),y(n,i),y(n,r),u.m(n,null),y(n,s),d&&d.m(n,null),o||(l=Se(i,"click",t[6]),o=!0)},p(f,[h]){c===(c=a(f))&&u?u.p(f,h):(u.d(1),u=c(f),u&&(u.c(),u.m(n,s))),f[1]?d&&(d.d(1),d=null):d?d.p(f,h):(d=Bl(f),d.c(),d.m(n,null))},i:X,o:X,d(f){f&&$(e),u.d(),d&&d.d(),o=!1,l()}}}function Cg(t,e,n){let i,r,{selectionStore:s}=e;const{isSaved:o,selection:l}=s;ge(t,o,d=>n(2,i=d)),ge(t,l,d=>n(3,r=d));let{isRegion:a=s.type!=="documentSet"}=e;const c=()=>s.empty(),u=()=>s.save();return t.$$set=d=>{"selectionStore"in d&&n(0,s=d.selectionStore),"isRegion"in d&&n(1,a=d.isRegion)},[s,a,i,r,o,l,c,u]}class Ig extends ye{constructor(e){super(),ve(this,e,Cg,Eg,pe,{selectionStore:0,isRegion:1})}}const vy="";function xg(t){let e,n,i,r,s,o;return{c(){e=k("span"),n=ne(t[5]),i=q(),r=k("span"),r.innerHTML='<i class="fas fa-edit"></i>',v(r,"class","pl-3 smaller has-text-link")},m(l,a){j(l,e,a),y(e,n),y(e,i),y(e,r),s||(o=[Se(e,"click",t[7]),Se(e,"keyup",null)],s=!0)},p(l,a){a&32&&me(n,l[5])},d(l){l&&$(e),s=!1,Ye(o)}}}function Mg(t){let e,n,i;return{c(){e=k("input"),v(e,"class","input selection-title svelte-sgypdx")},m(r,s){j(r,e,s),t[12](e),ri(e,t[4]),n||(i=[Se(e,"input",t[13]),Se(e,"keydown",t[8]),Se(e,"blur",t[9])],n=!0)},p(r,s){s&16&&e.value!==r[4]&&ri(e,r[4])},d(r){r&&$(e),t[12](null),n=!1,Ye(i)}}}function Ag(t){let e,n,i,r,s,o,l,a,c,u,d,f,h,m,g,p,_,w,C,b;function I(O,D){return O[2]?Mg:xg}let T=I(t),M=T(t);const E=t[11].default,A=gt(E,t,t[10],null);return _=new Ig({props:{selectionStore:t[0]}}),{c(){e=k("div"),n=k("div"),i=q(),r=k("div"),s=k("div"),o=k("div"),l=k("i"),a=q(),M.c(),c=ne(`
                (`),u=ne(t[1]),d=ne(")"),f=q(),h=k("button"),m=q(),g=k("section"),A&&A.c(),p=q(),le(_.$$.fragment),v(n,"class","modal-background"),v(l,"class","fa-solid fa-book-bookmark"),v(o,"class","title is-4 mb-0 media-content"),v(h,"class","delete media-left"),v(h,"aria-label","close"),v(s,"class","modal-card-head media mb-0 is-middle"),v(g,"class","modal-card-body"),v(r,"class","modal-content"),v(e,"id","selection-modal"),v(e,"class","modal fade"),v(e,"tabindex","-1"),v(e,"aria-labelledby","selection-modal-label"),v(e,"aria-hidden","true")},m(O,D){j(O,e,D),y(e,n),y(e,i),y(e,r),y(r,s),y(s,o),y(o,l),y(o,a),M.m(o,null),y(o,c),y(o,u),y(o,d),y(s,f),y(s,h),y(r,m),y(r,g),A&&A.m(g,null),y(r,p),se(_,r,null),w=!0,C||(b=ii(Ms.call(null,e)),C=!0)},p(O,[D]){T===(T=I(O))&&M?M.p(O,D):(M.d(1),M=T(O),M&&(M.c(),M.m(o,c))),(!w||D&2)&&me(u,O[1]),A&&A.p&&(!w||D&1024)&&vt(A,E,O,O[10],w?_t(E,O[10],D,null):yt(O[10]),null);const B={};D&1&&(B.selectionStore=O[0]),_.$set(B)},i(O){w||(V(A,O),V(_.$$.fragment,O),w=!0)},o(O){K(A,O),K(_.$$.fragment,O),w=!1},d(O){O&&$(e),M.d(),A&&A.d(O),oe(_),C=!1,b()}}}function Ng(t,e,n){let i,{$$slots:r={},$$scope:s}=e,{selectionStore:o}=e;const{selectionTitle:l,updateTitle:a,save:c}=o;ge(t,l,C=>n(5,i=C));let{selectionLength:u=!1}=e,d=!1,f,h;function m(){n(2,d=!0),n(4,h=i),setTimeout(()=>f&&f.focus(),0)}function g(C){C.key==="Enter"&&p()}function p(){n(2,d=!1),a(h),c()}function _(C){mn[C?"unshift":"push"](()=>{f=C,n(3,f)})}function w(){h=this.value,n(4,h)}return t.$$set=C=>{"selectionStore"in C&&n(0,o=C.selectionStore),"selectionLength"in C&&n(1,u=C.selectionLength),"$$scope"in C&&n(10,s=C.$$scope)},[o,u,d,f,h,i,l,m,g,p,s,r,_,w]}class Tg extends ye{constructor(e){super(),ve(this,e,Ng,Ag,pe,{selectionStore:0,selectionLength:1})}}const yy="";function Og(t){let e,n,i,r,s,o=W==="en"?"Selection":"Sélection",l,a,c,u,d,f;return{c(){e=k("div"),n=k("button"),i=k("span"),r=k("i"),s=q(),l=ne(o),a=ne(`
            (`),c=ne(t[0]),u=ne(")"),v(r,"class","fa-solid fa-book-bookmark"),v(i,"id","btn-content"),v(n,"id","set-btn"),v(n,"class","button px-5 py-4 is-link svelte-gmt9z5"),v(n,"data-target","selection-modal"),v(e,"class","set-container svelte-gmt9z5")},m(h,m){j(h,e,m),y(e,n),y(n,i),y(i,r),y(i,s),y(i,l),y(i,a),y(i,c),y(i,u),d||(f=ii(As.call(null,n)),d=!0)},p(h,[m]){m&1&&me(c,h[0])},i:X,o:X,d(h){h&&$(e),d=!1,f()}}}function Pg(t,e,n){let{selectionLength:i=0}=e,r=i;return t.$$set=s=>{"selectionLength"in s&&n(0,i=s.selectionLength)},t.$$.update=()=>{if(t.$$.dirty&3&&i!==r){const s=i>r;n(1,r=i);const o=document.getElementById("btn-content");o&&o.animate([{transform:s?"translateY(-7px)":"translateX(-5px)"},{transform:s?"translateY(7px)":"translateX(5px)"},{transform:"translate(0)"}],{duration:300,easing:"cubic-bezier(0.65, 0, 0.35, 1)"})}},[i,r]}class Lg extends ye{constructor(e){super(),ve(this,e,Pg,Og,pe,{selectionLength:0})}}const by="";function ql(t,e,n){const i=t.slice();return i[7]=e[n][0],i[8]=e[n][1],i}function Dg(t){let e;return{c(){e=k("div"),e.textContent=`${W==="en"?"No regions in selection":"Aucune région sélectionnée"}`},m(n,i){j(n,e,i)},p:X,d(n){n&&$(e)}}}function Rg(t){let e,n,i=Object.entries(t[2]),r=[];for(let s=0;s<i.length;s+=1)r[s]=Kl(ql(t,i,s));return{c(){e=k("div"),n=k("div");for(let s=0;s<r.length;s+=1)r[s].c();v(n,"class","grid is-gap-2"),v(e,"class","fixed-grid has-6-cols")},m(s,o){j(s,e,o),y(e,n);for(let l=0;l<r.length;l+=1)r[l]&&r[l].m(n,null)},p(s,o){if(o&13){i=Object.entries(s[2]);let l;for(l=0;l<i.length;l+=1){const a=ql(s,i,l);r[l]?r[l].p(a,o):(r[l]=Kl(a),r[l].c(),r[l].m(n,null))}for(;l<r.length;l+=1)r[l].d(1);r.length=i.length}},d(s){s&&$(e),ot(r,s)}}}function Kl(t){let e,n,i,r,s,o,l,a=t[8].title+"",c,u,d,f,h,m;function g(){return t[6](t[7])}return{c(){e=k("div"),n=k("figure"),i=k("img"),s=q(),o=k("div"),l=k("span"),c=ne(a),u=q(),d=k("button"),f=q(),ft(i.src,r=Mt(t[8].img,t[8].xywh,"96,"))||v(i,"src",r),v(i,"alt","Extracted region"),v(l,"class","overlay-desc"),v(o,"class","overlay is-center svelte-g8ij5d"),v(n,"class","image is-64x64 card"),v(d,"class","delete region-btn svelte-g8ij5d"),v(d,"aria-label","remove from selection"),v(e,"class","selection cell svelte-g8ij5d")},m(p,_){j(p,e,_),y(e,n),y(n,i),y(n,s),y(n,o),y(o,l),y(l,c),y(e,u),y(e,d),y(e,f),h||(m=Se(d,"click",g),h=!0)},p(p,_){t=p,_&4&&!ft(i.src,r=Mt(t[8].img,t[8].xywh,"96,"))&&v(i,"src",r),_&4&&a!==(a=t[8].title+"")&&me(c,a)},d(p){p&&$(e),h=!1,m()}}}function $g(t){let e;function n(s,o){return s[4]?Rg:Dg}let i=n(t),r=i(t);return{c(){r.c(),e=Ke()},m(s,o){r.m(s,o),j(s,e,o)},p(s,o){i===(i=n(s))&&r?r.p(s,o):(r.d(1),r=i(s),r&&(r.c(),r.m(e.parentNode,e)))},d(s){r.d(s),s&&$(e)}}}function zg(t){let e,n,i,r;return e=new Lg({props:{selectionLength:t[1]}}),i=new Tg({props:{selectionLength:t[1],selectionStore:t[0],$$slots:{default:[$g]},$$scope:{ctx:t}}}),{c(){le(e.$$.fragment),n=q(),le(i.$$.fragment)},m(s,o){se(e,s,o),j(s,n,o),se(i,s,o),r=!0},p(s,[o]){const l={};o&2&&(l.selectionLength=s[1]),e.$set(l);const a={};o&2&&(a.selectionLength=s[1]),o&1&&(a.selectionStore=s[0]),o&2077&&(a.$$scope={dirty:o,ctx:s}),i.$set(a)},i(s){r||(V(e.$$.fragment,s),V(i.$$.fragment,s),r=!0)},o(s){K(e.$$.fragment,s),K(i.$$.fragment,s),r=!1},d(s){oe(e,s),s&&$(n),oe(i,s)}}}function jg(t,e,n){let i,r,s,o,{selectionStore:l}=e;const{selected:a}=l;ge(t,a,u=>n(3,o=u));const c=u=>l.remove(u,Object.keys(o)[0]);return t.$$set=u=>{"selectionStore"in u&&n(0,l=u.selectionStore)},t.$$.update=()=>{t.$$.dirty&8&&n(2,i=Object.values(o)[0]||{}),t.$$.dirty&4&&n(1,r=Object.keys(i).length),t.$$.dirty&2&&n(4,s=r>0)},[l,r,i,o,s,a,c]}class Fg extends ye{constructor(e){super(),ve(this,e,jg,zg,pe,{selectionStore:0})}}const wy="";function Wl(t,e,n){const i=t.slice();return i[17]=e[n],i}function Gl(t,e,n){const i=t.slice();return i[20]=e[n],i}function Yl(t,e,n){const i=t.slice();return i[23]=e[n],i}function Xl(t){let e,n,i,r,s,o=t[23].title+"",l,a,c,u=t[23].shortcut+"",d,f,h,m;return{c(){e=k("p"),n=k("button"),i=k("span"),r=k("i"),s=q(),l=ne(o),a=q(),c=k("span"),d=ne(u),f=q(),v(r,"class","fas "+t[23].icon+" svelte-7vjt6f"),v(i,"class","icon is-small"),v(c,"class","shortcut svelte-7vjt6f"),v(n,"class","button pl-5"),v(n,"title",t[23].desc),v(e,"class","control")},m(g,p){j(g,e,p),y(e,n),y(n,i),y(i,r),y(n,s),y(n,l),y(n,a),y(n,c),y(c,d),y(e,f),h||(m=Se(n,"click",Lt(t[23].fct)),h=!0)},p(g,p){t=g},d(g){g&&$(e),h=!1,m()}}}function Vg(t){let e,n,i,r,s,o,l,a=Object.values(t[10]),c=[];for(let u=0;u<a.length;u+=1)c[u]=Xl(Yl(t,a,u));return{c(){e=k("div"),n=k("div"),i=k("div"),r=k("span"),r.textContent=`${W==="en"?"Process selection":"Agir sur la sélection"}`,s=q(),o=k("div"),l=k("div");for(let u=0;u<c.length;u+=1)c[u].c();v(r,"class","tag is-medium is-link mr-5"),v(i,"class","column is-narrow mr-5"),v(l,"class","field has-addons"),v(o,"class","column"),v(n,"class","columns is-vcentered is-mobile py-4"),v(e,"slot","toolbar-visible")},m(u,d){j(u,e,d),y(e,n),y(n,i),y(i,r),y(n,s),y(n,o),y(o,l);for(let f=0;f<c.length;f+=1)c[f]&&c[f].m(l,null)},p(u,d){if(d&1024){a=Object.values(u[10]);let f;for(f=0;f<a.length;f+=1){const h=Yl(u,a,f);c[f]?c[f].p(h,d):(c[f]=Xl(h),c[f].c(),c[f].m(l,null))}for(;f<c.length;f+=1)c[f].d(1);c.length=a.length}},d(u){u&&$(e),ot(c,u)}}}function Hg(t){let e,n=t[9].title+"",i;return{c(){e=k("span"),i=ne(n),v(e,"class","button is-small is-success"),v(e,"title",t[9].desc)},m(r,s){j(r,e,s),y(e,i)},p:X,d(r){r&&$(e)}}}function Ug(t){let e,n=t[8].title+"",i,r,s;function o(){return t[12](t[17])}return{c(){e=k("button"),i=ne(n),v(e,"class","button is-small is-warning"),v(e,"title",t[8].desc)},m(l,a){j(l,e,a),y(e,i),r||(s=Se(e,"click",o),r=!0)},p(l,a){t=l},d(l){l&&$(e),r=!1,s()}}}function Bg(t){let e,n,i=t[17].size+"",r,s,o,l,a,c;function u(h,m){return h[17].fullyConnected?Hg:Ug}let d=u(t),f=d(t);return{c(){e=k("div"),n=k("span"),r=ne(i),s=ne(" images"),o=q(),l=k("hr"),a=q(),f.c(),c=q(),v(n,"class","cluster-size"),v(e,"class","cluster-info is-center is-fullwidth")},m(h,m){j(h,e,m),y(e,n),y(n,r),y(n,s),y(e,o),y(e,l),y(e,a),f.m(e,null),j(h,c,m)},p(h,m){m&4&&i!==(i=h[17].size+"")&&me(r,i),d===(d=u(h))&&f?f.p(h,m):(f.d(1),f=d(h),f&&(f.c(),f.m(e,null)))},d(h){h&&$(e),f.d(),h&&$(c)}}}function Jl(t){let e,n;return e=new In({props:{item:{...t[3].get(t[20]),clusterId:t[17].id},copyable:!1,selectionStore:$i}}),{c(){le(e.$$.fragment)},m(i,r){se(e,i,r),n=!0},p(i,r){const s={};r&12&&(s.item={...i[3].get(i[20]),clusterId:i[17].id}),e.$set(s)},i(i){n||(V(e.$$.fragment,i),n=!0)},o(i){K(e.$$.fragment,i),n=!1},d(i){oe(e,i)}}}function qg(t){let e,n,i=t[17].members,r=[];for(let o=0;o<i.length;o+=1)r[o]=Jl(Gl(t,i,o));const s=o=>K(r[o],1,1,()=>{r[o]=null});return{c(){for(let o=0;o<r.length;o+=1)r[o].c();e=q()},m(o,l){for(let a=0;a<r.length;a+=1)r[a]&&r[a].m(o,l);j(o,e,l),n=!0},p(o,l){if(l&12){i=o[17].members;let a;for(a=0;a<i.length;a+=1){const c=Gl(o,i,a);r[a]?(r[a].p(c,l),V(r[a],1)):(r[a]=Jl(c),r[a].c(),V(r[a],1),r[a].m(e.parentNode,e))}for(Ee(),a=i.length;a<r.length;a+=1)s(a);Ce()}},i(o){if(!n){for(let l=0;l<i.length;l+=1)V(r[l]);n=!0}},o(o){r=r.filter(Boolean);for(let l=0;l<r.length;l+=1)K(r[l]);n=!1},d(o){ot(r,o),o&&$(e)}}}function Ql(t,e){let n,i,r;return i=new Tl({props:{$$slots:{"row-body":[qg],"row-header":[Bg]},$$scope:{ctx:e}}}),{key:t,first:null,c(){n=Ke(),le(i.$$.fragment),this.first=n},m(s,o){j(s,n,o),se(i,s,o),r=!0},p(s,o){e=s;const l={};o&67108876&&(l.$$scope={dirty:o,ctx:e}),i.$set(l)},i(s){r||(V(i.$$.fragment,s),r=!0)},o(s){K(i.$$.fragment,s),r=!1},d(s){s&&$(n),oe(i,s)}}}function Kg(t){let e=[],n=new Map,i,r,s=t[2];const o=l=>l[17].id;for(let l=0;l<s.length;l+=1){let a=Wl(t,s,l),c=o(a);n.set(c,e[l]=Ql(c,a))}return{c(){for(let l=0;l<e.length;l+=1)e[l].c();i=Ke()},m(l,a){for(let c=0;c<e.length;c+=1)e[c]&&e[c].m(l,a);j(l,i,a),r=!0},p(l,a){a&780&&(s=l[2],Ee(),e=ir(e,a,o,1,l,s,n,i.parentNode,nr,Ql,i,Wl),Ce())},i(l){if(!r){for(let a=0;a<s.length;a+=1)V(e[a]);r=!0}},o(l){for(let a=0;a<e.length;a+=1)K(e[a]);r=!1},d(l){for(let a=0;a<e.length;a+=1)e[a].d(l);l&&$(i)}}}function Wg(t){let e,n,i,r,s,o,l,a,c,u;return e=new yg({props:{expandable:!1,$$slots:{"toolbar-visible":[Vg]},$$scope:{ctx:t}}}),i=new Ul({props:{store:t[0],nbOfItems:t[1],pageLength:t[7]}}),s=new Fg({props:{selectionStore:$i}}),l=new sg({props:{$$slots:{default:[Kg]},$$scope:{ctx:t}}}),c=new Ul({props:{store:t[0],nbOfItems:t[1],pageLength:t[7]}}),{c(){le(e.$$.fragment),n=q(),le(i.$$.fragment),r=q(),le(s.$$.fragment),o=q(),le(l.$$.fragment),a=q(),le(c.$$.fragment)},m(d,f){se(e,d,f),j(d,n,f),se(i,d,f),j(d,r,f),se(s,d,f),j(d,o,f),se(l,d,f),j(d,a,f),se(c,d,f),u=!0},p(d,[f]){const h={};f&67108864&&(h.$$scope={dirty:f,ctx:d}),e.$set(h);const m={};f&1&&(m.store=d[0]),f&2&&(m.nbOfItems=d[1]),i.$set(m);const g={};f&67108876&&(g.$$scope={dirty:f,ctx:d}),l.$set(g);const p={};f&1&&(p.store=d[0]),f&2&&(p.nbOfItems=d[1]),c.$set(p)},i(d){u||(V(e.$$.fragment,d),V(i.$$.fragment,d),V(s.$$.fragment,d),V(l.$$.fragment,d),V(c.$$.fragment,d),u=!0)},o(d){K(e.$$.fragment,d),K(i.$$.fragment,d),K(s.$$.fragment,d),K(l.$$.fragment,d),K(c.$$.fragment,d),u=!1},d(d){oe(e,d),d&&$(n),oe(i,d),d&&$(r),oe(s,d),d&&$(o),oe(l,d),d&&$(a),oe(c,d)}}}function Gg(t,e,n){let i,r,s,{documentSetStore:o}=e;const{imageNodes:l}=o;ge(t,l,b=>n(3,s=b));let{clusterStore:a}=e;const{clusterNb:c,paginatedClusters:u,pageLength:d,validateCluster:f,newCluster:h,removeFromClusters:m}=a;ge(t,c,b=>n(1,i=b)),ge(t,u,b=>n(2,r=b));const g={create:{title:W==="en"?"New cluster":"Nouveau cluster",desc:W==="en"?"Create a new validated cluster from the selected regions":"Créer un nouveau cluster valide à partir des régions sélectionnées",icon:"fa-object-group",shortcut:"Shift + C",fct:h},remove:{title:W==="en"?"Remove from cluster":"Retirer du cluster",desc:W==="en"?"Remove the selected regions from their cluster":"Retirer les régions sélectionnées de leur cluster",icon:"fa-chain-broken",shortcut:"Shift + D",fct:m},validate:{title:W==="en"?"Validate cluster":"Valider le cluster",desc:W==="en"?"Set as exact match all the pairs of regions in the cluster":"Définir comme correspondance exacte toutes les paires de régions dans le cluster",icon:"fa-check",fct:f},validated:{title:W==="en"?"Validated cluster":"Cluster valide",desc:W==="en"?"All pairs of regions have be categorized as exact matches":"Toutes les paires de régions ont été catégorisées comme des correspondances exactes",icon:"fa-check"}},{validate:p,validated:_,...w}=g,C=b=>p.fct(b);return t.$$set=b=>{"documentSetStore"in b&&n(11,o=b.documentSetStore),"clusterStore"in b&&n(0,a=b.clusterStore)},[a,i,r,s,l,c,u,d,p,_,w,o,C]}class Yg extends ye{constructor(e){super(),ve(this,e,Gg,Wg,pe,{documentSetStore:11,clusterStore:0})}}function Xg(t,e){const i=be(1),{allPairs:r,imageNodes:s}=t;lr(i,"p");function o(b){ar(b,i,"p")}function l(b){if(b.length===0)return[];const I=new Map,T=O=>I.has(O)?(I.get(O)!==O&&I.set(O,T(I.get(O))),I.get(O)):(I.set(O,O),O),M=(O,D)=>{const B=T(O),R=T(D);B!==R&&I.set(R,B)},E=new Set;b.forEach(O=>{O.category===1&&(M(O.id_1,O.id_2),E.add(O.id_1),E.add(O.id_2))});const A=new Map;return E.forEach(O=>{const D=T(O);A.has(D)||A.set(D,[]),A.get(D).push(O)}),Array.from(A.values()).map(O=>{const D=O.length,B=D*(D-1)/2,R=new Set(O),S=b.filter(L=>L.category===1&&R.has(L.id_1)&&R.has(L.id_2)).length;return{id:crypto.randomUUID(),members:O,size:D,fullyConnected:S===B}}).filter(O=>O.size>1).sort((O,D)=>D.size-O.size)}const a=Ue(r,b=>b.length?l(b):[]),c=be([]);a.subscribe(b=>{c.set(b)});const u=Ue([c,i],([b,I])=>{const T=(I-1)*10,M=T+10;return b.slice(T,M)}),d=(b,I)=>{const T=et(s).get(b),M=et(s).get(I);return{img_1:b,img_2:I,regions_id_1:T==null?void 0:T.regionId,regions_id_2:M==null?void 0:M.regionId}},f=(b,I)=>(c.update(T=>T.map(M=>{if(!I[M.id])return M;const E=M.members.filter(A=>!b.has(A));return{...M,members:E,size:E.length}}).filter(M=>M.size>0)),!0),h=async b=>{const I=Array.isArray(b)?b:Object.keys(b),T=new Set(I),M={};et(c).forEach(A=>{const O=A.members.filter(D=>T.has(D));O.length>0&&(M[A.id]=O)});const E=Object.entries(M).flatMap(([A,O])=>{const D=et(c).find(R=>R.id===A);if(!D)return[];const B=D.members.filter(R=>!T.has(R));return O.flatMap(R=>B.map(S=>d(R,S)))});if(E.length===0)return f(T,M),!0;try{const A=await Cs(()=>fetch(`${window.location.origin}/${wt}/uncategorize-pair-batch`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":Kt},body:JSON.stringify({pairs:E})}));return A.ok?(f(T,M),!0):(console.log(A),await lt(W==="en"?"Batch un-categorization failed":"La dé-catégorisation par lot a échoué",W==="en"?"Error":"Erreur"),!1)}catch(A){return await lt(A,W==="en"?"Error":"Erreur"),!1}},m=async b=>{const I=b.flatMap((T,M)=>b.slice(M+1).map(E=>d(T,E)));try{const T=await Cs(()=>fetch(`${window.location.origin}/${wt}/exact-match-batch`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":Kt},body:JSON.stringify({pairs:I})}));return T.ok?!0:(console.log(T),await lt(W==="en"?"Batch validation failed":"La validation par lot a échoué",W==="en"?"Error":"Erreur"),!1)}catch(T){return await lt(T,W==="en"?"Error":"Erreur"),console.error("Error:",T),!1}},g=async b=>{const I=await m(b.members);return I&&c.update(T=>T.map(M=>M.id===b.id?{...M,fullyConnected:!0}:M)),I},p=async b=>{if(b.length<2)return!1;const I=await m(b);return I&&c.update(T=>[{id:crypto.randomUUID(),members:b,size:b.length,fullyConnected:!0},...T].sort((E,A)=>A.size-E.size)),I},_=()=>Object.values(et(e).selected)[0]||{},w=async()=>{if(!await lt(W==="en"?"Do you want to create a cluster out of these images?":"Voulez-vous créer un cluster à partir de ces images ?",W==="en"?"Confirm creation":"Confirmer la création",!0))return;const I=_(),T=Object.keys(I);return T.length<2?(await lt(W==="en"?"Cluster creation requires at least 2 images":"La création d'un nouveau cluster nécessite a minima 2 images",W==="en"?"Impossible creation":"Création impossible"),!1):!await h(T)||!await p(T)?!1:(e.empty(),!0)},C=async()=>{if(!await lt(W==="en"?"Do you want to remove these images from their clusters?":"Voulez-vous supprimer ces images de leurs clusters ?",W==="en"?"Confirm deletion":"Confirmer la suppression",!0))return;const I=_();return await h(Object.keys(I))?(e.empty(),!0):!1};return{imageClusters:a,interfaceClusters:c,clusterNb:Ue(c,b=>b.length),validateCluster:g,removeFromClusters:C,newCluster:w,paginatedClusters:u,handlePageUpdate:o,pageLength:10,currentPage:i}}function Zl(t,e,n){const i=t.slice();return i[17]=e[n],i}function Jg(t){let e,n,i;return{c(){e=k("p"),e.textContent=`La matrice de documents visualise les scores de similarité globaux entre tous les documents du
                        corpus.
                        Cliquez sur une cellule pour voir les détails des similarités entre pages.`,n=q(),i=k("ul"),i.innerHTML=`<li>Matrice : Scores normalisés entre documents (0-100).</li>
                        <li>Scatter plot : Similarités détaillées par page.</li>`},m(r,s){j(r,e,s),j(r,n,s),j(r,i,s)},d(r){r&&$(e),r&&$(n),r&&$(i)}}}function Qg(t){let e,n,i;return{c(){e=k("p"),e.textContent=`The Documents Network illustrates the connections between different witnesses in the document
                        set.
                        Each node represents a witness, and edges denote relationships based on shared content or other
                        relevant factors.`,n=q(),i=k("ul"),i.innerHTML=`<li>Nodes: Witnesses in the document set.</li>
                        <li>Edges: Relationships based on shared content.</li>`},m(r,s){j(r,e,s),j(r,n,s),j(r,i,s)},d(r){r&&$(e),r&&$(n),r&&$(i)}}}function Zg(t){let e,n,i;return{c(){e=k("p"),e.textContent=`The Regions Network visualizes the relationships between image regions across different witnesses
                        in the document set.
                        Each node represents an image region, and edges indicate similarity or connections based on
                        predefined criteria.`,n=q(),i=k("ul"),i.innerHTML=`<li>Nodes: Image regions from various witnesses.</li>
                        <li>Edges: Similarity links between regions.</li>`},m(r,s){j(r,e,s),j(r,n,s),j(r,i,s)},d(r){r&&$(e),r&&$(n),r&&$(i)}}}function e_(t){let e,n,i,r;function s(a,c){return a[15]==="img"?Zg:a[15]==="doc"?Qg:Jg}let o=s(t),l=o(t);return i=new ng({props:{activeTab:t[15],documentSetStore:t[4]}}),{c(){e=k("div"),l.c(),n=q(),le(i.$$.fragment),v(e,"slot","datavizInfo")},m(a,c){j(a,e,c),l.m(e,null),y(e,n),se(i,e,null),r=!0},p(a,c){o!==(o=s(a))&&(l.d(1),l=o(a),l&&(l.c(),l.m(e,n)));const u={};c&32768&&(u.activeTab=a[15]),i.$set(u)},i(a){r||(V(i.$$.fragment,a),r=!0)},o(a){K(i.$$.fragment,a),r=!1},d(a){a&&$(e),l.d(),oe(i)}}}function t_(t){let e,n,i;return n=new pu({props:{docSet:t[0],documentSetStore:t[4],clusterStore:t[8],$$slots:{datavizInfo:[e_]},$$scope:{ctx:t}}}),{c(){e=k("div"),le(n.$$.fragment),v(e,"slot","sidebar")},m(r,s){j(r,e,s),se(n,e,null),i=!0},p(r,s){const o={};s&1&&(o.docSet=r[0]),s&1081344&&(o.$$scope={dirty:s,ctx:r}),n.$set(o)},i(r){i||(V(n.$$.fragment,r),i=!0)},o(r){K(n.$$.fragment,r),i=!1},d(r){r&&$(e),oe(n)}}}function ea(t){let e,n,i,r,s,o,l,a=t[17].title+"",c,u;return{c(){e=k("div"),n=k("figure"),i=k("img"),s=q(),o=k("div"),l=k("span"),c=ne(a),u=q(),ft(i.src,r=Mt(t[17].img,t[17].xywh,"96,"))||v(i,"src",r),v(i,"alt","Extracted region"),v(l,"class","overlay-desc"),v(o,"class","overlay is-center"),v(n,"class","image is-64x64 card"),v(e,"class","selection cell")},m(d,f){j(d,e,f),y(e,n),y(n,i),y(n,s),y(n,o),y(o,l),y(l,c),y(e,u)},p(d,f){f&2&&!ft(i.src,r=Mt(d[17].img,d[17].xywh,"96,"))&&v(i,"src",r),f&2&&a!==(a=d[17].title+"")&&me(c,a)},d(d){d&&$(e)}}}function n_(t){let e,n,i=Object.values(Object.values(t[1])[0]||{}),r=[];for(let s=0;s<i.length;s+=1)r[s]=ea(Zl(t,i,s));return{c(){e=k("div"),n=k("div");for(let s=0;s<r.length;s+=1)r[s].c();v(n,"class","grid is-gap-2"),v(e,"slot","content"),v(e,"class","fixed-grid has-6-cols")},m(s,o){j(s,e,o),y(e,n);for(let l=0;l<r.length;l+=1)r[l]&&r[l].m(n,null)},p(s,o){if(o&2){i=Object.values(Object.values(s[1])[0]||{});let l;for(l=0;l<i.length;l+=1){const a=Zl(s,i,l);r[l]?r[l].p(a,o):(r[l]=ea(a),r[l].c(),r[l].m(n,null))}for(;l<r.length;l+=1)r[l].d(1);r.length=i.length}},d(s){s&&$(e),ot(r,s)}}}function i_(t){let e,n,i,r={ctx:t,current:null,token:null,hasCatch:!1,pending:h_,then:o_,catch:s_,value:16,blocks:[,,,]};return tr(n=t[3],r),{c(){e=Ke(),r.block.c()},m(s,o){j(s,e,o),r.block.m(s,r.anchor=o),r.mount=()=>e.parentNode,r.anchor=e,i=!0},p(s,o){t=s,r.ctx=t,o&8&&n!==(n=t[3])&&tr(n,r)||ks(r,t,o)},i(s){i||(V(r.block),i=!0)},o(s){for(let o=0;o<3;o+=1){const l=r.blocks[o];K(l)}i=!1},d(s){s&&$(e),r.block.d(s),r.token=null,r=null}}}function r_(t){let e,n,i;return{c(){e=k("article"),n=k("div"),i=ne(t[2]),v(n,"class","message-body"),v(e,"class","message is-danger")},m(r,s){j(r,e,s),y(e,n),y(n,i)},p(r,s){s&4&&me(i,r[2])},i:X,o:X,d(r){r&&$(e)}}}function s_(t){return{c:X,m:X,p:X,i:X,o:X,d:X}}function o_(t){let e,n,i,r;const s=[a_,l_],o=[];function l(a,c){return a[16]===0?0:1}return e=l(t),n=o[e]=s[e](t),{c(){n.c(),i=Ke()},m(a,c){o[e].m(a,c),j(a,i,c),r=!0},p(a,c){let u=e;e=l(a),e===u?o[e].p(a,c):(Ee(),K(o[u],1,1,()=>{o[u]=null}),Ce(),n=o[e],n?n.p(a,c):(n=o[e]=s[e](a),n.c()),V(n,1),n.m(i.parentNode,i))},i(a){r||(V(n),r=!0)},o(a){K(n),r=!1},d(a){o[e].d(a),a&&$(i)}}}function l_(t){let e,n,i=t[9][t[15]]+"",r,s,o,l,a;const c=[f_,u_,c_],u=[];function d(f,h){return f[15]==="img"||f[15]==="doc"?0:f[15]==="sim"?1:f[15]==="mat"?2:-1}return~(o=d(t))&&(l=u[o]=c[o](t)),{c(){e=k("div"),n=k("h2"),r=ne(i),s=q(),l&&l.c(),v(n,"class","title is-3 has-text-link")},m(f,h){j(f,e,h),y(e,n),y(n,r),y(e,s),~o&&u[o].m(e,null),a=!0},p(f,h){(!a||h&32768)&&i!==(i=f[9][f[15]]+"")&&me(r,i);let m=o;o=d(f),o===m?~o&&u[o].p(f,h):(l&&(Ee(),K(u[m],1,1,()=>{u[m]=null}),Ce()),~o?(l=u[o],l?l.p(f,h):(l=u[o]=c[o](f),l.c()),V(l,1),l.m(e,null)):l=null)},i(f){a||(V(l),a=!0)},o(f){K(l),a=!1},d(f){f&&$(e),~o&&u[o].d()}}}function a_(t){let e;return{c(){e=k("article"),e.innerHTML=`<div class="message-body">No document pairs found for this configuration.
                            Please adjust your selection criteria in the sidebar to include more documents or
                            categories.</div>`,v(e,"class","message is-warning")},m(n,i){j(n,e,i)},p:X,i:X,o:X,d(n){n&&$(e)}}}function c_(t){let e,n;return e=new Jp({props:{documentSetStore:t[4]}}),{c(){le(e.$$.fragment)},m(i,r){se(e,i,r),n=!0},p:X,i(i){n||(V(e.$$.fragment,i),n=!0)},o(i){K(e.$$.fragment,i),n=!1},d(i){oe(e,i)}}}function u_(t){let e,n;return e=new Yg({props:{documentSetStore:t[4],clusterStore:t[8]}}),{c(){le(e.$$.fragment)},m(i,r){se(e,i,r),n=!0},p:X,i(i){n||(V(e.$$.fragment,i),n=!0)},o(i){K(e.$$.fragment,i),n=!1},d(i){oe(e,i)}}}function f_(t){let e,n;return e=new Bp({props:{documentSetStore:t[4],type:t[15]}}),{c(){le(e.$$.fragment)},m(i,r){se(e,i,r),n=!0},p(i,r){const s={};r&32768&&(s.type=i[15]),e.$set(s)},i(i){n||(V(e.$$.fragment,i),n=!0)},o(i){K(e.$$.fragment,i),n=!1},d(i){oe(e,i)}}}function h_(t){let e;return{c(){e=k("progress"),e.textContent="Loading...",v(e,"class","progress is-link"),v(e,"max","100")},m(n,i){j(n,e,i)},p:X,i:X,o:X,d(n){n&&$(e)}}}function d_(t){let e,n,i,r,s,o;n=new Jc({props:{$$slots:{content:[n_]},$$scope:{ctx:t}}});const l=[r_,i_],a=[];function c(u,d){return u[2]?0:1}return r=c(t),s=a[r]=l[r](t),{c(){e=k("div"),le(n.$$.fragment),i=q(),s.c(),v(e,"slot","content")},m(u,d){j(u,e,d),se(n,e,null),y(e,i),a[r].m(e,null),o=!0},p(u,d){const f={};d&1048578&&(f.$$scope={dirty:d,ctx:u}),n.$set(f);let h=r;r=c(u),r===h?a[r].p(u,d):(Ee(),K(a[h],1,1,()=>{a[h]=null}),Ce(),s=a[r],s?s.p(u,d):(s=a[r]=l[r](u),s.c()),V(s,1),s.m(e,null))},i(u){o||(V(n.$$.fragment,u),V(s),o=!0)},o(u){K(n.$$.fragment,u),K(s),o=!1},d(u){u&&$(e),oe(n),a[r].d()}}}function m_(t){let e,n;return e=new ou({props:{tabList:t[9],$$slots:{content:[d_,({activeTab:i})=>({15:i}),({activeTab:i})=>i?32768:0],sidebar:[t_,({activeTab:i})=>({15:i}),({activeTab:i})=>i?32768:0]},$$scope:{ctx:t}}}),{c(){le(e.$$.fragment)},m(i,r){se(e,i,r),n=!0},p(i,[r]){const s={};r&1081359&&(s.$$scope={dirty:r,ctx:i}),e.$set(s)},i(i){n||(V(e.$$.fragment,i),n=!0)},o(i){K(e.$$.fragment,i),n=!1},d(i){oe(e,i)}}}function p_(t,e,n){var w;let i,r,s,{docSet:o}=e;const l=Zp(o.id),{error:a,fetchPairs:c,selectedRegions:u,selectedCategories:d}=l;ge(t,a,C=>n(2,r=C)),ge(t,c,C=>n(3,s=C));let f,h;Nn(()=>{f=Ns(u,"regions","set"),h=Ns(d,"categories","array");const C=u.subscribe(f),b=d.subscribe(h);return()=>{C(),b()}});const{selected:m}=$i;ge(t,m,C=>n(1,i=C));const g=Xg(l,$i),p={img:W==="en"?"Image Network":"Réseau d'images",doc:W==="en"?"Document Network":"Réseau de documents",sim:W==="en"?"Copy Clusters":"Groupe de copies",mat:W==="en"?"Document Matrix":"Matrice de documents"},_=((w=o==null?void 0:o.selection)==null?void 0:w.selected)||{Witness:{},Series:{},Work:{}};return hn("selectedDocuments",_),t.$$set=C=>{"docSet"in C&&n(0,o=C.docSet)},[o,i,r,s,l,a,c,m,g,p]}class g_ extends ye{constructor(e){super(),ve(this,e,p_,m_,pe,{docSet:0})}}new g_({target:document.getElementById("document-set"),props:{docSet}});const Sy="";function __(t){let e,n,i;return n=new In({props:{item:t[0],height:"full"}}),{c(){e=k("div"),le(n.$$.fragment),v(e,"class","img-wrapper svelte-1duc3w1")},m(r,s){j(r,e,s),se(n,e,null),i=!0},p(r,[s]){const o={};s&1&&(o.item=r[0]),n.$set(o)},i(r){i||(V(n.$$.fragment,r),i=!0)},o(r){K(n.$$.fragment,r),i=!1},d(r){r&&$(e),oe(n)}}}function v_(t,e,n){let{mainImgItem:i}=e;return t.$$set=r=>{"mainImgItem"in r&&n(0,i=r.mainImgItem)},[i]}class ta extends ye{constructor(e){super(),ve(this,e,v_,__,pe,{mainImgItem:0})}}const ky="";function y_(t){return{c:X,m:X,p:X,d:X}}function b_(t){let e,n=`${t[5][0]}%`,i=`${t[5][1]}%`,r=`${t[5][2]}%`,s=`${t[5][3]}%`;return{c(){e=k("div"),v(e,"class","modal-context-bbox svelte-zgr10j"),v(e,"aria-description",W==="fr"?"Position de la région extraite sur la page":"Position of the extracted region on the page"),Le(e,"left",n),Le(e,"top",i),Le(e,"width",r),Le(e,"height",s)},m(o,l){j(o,e,l)},p:X,d(o){o&&$(e)}}}function w_(t){return{c:X,m:X,p:X,d:X}}function S_(t){let e,n,i,r,s,o={ctx:t,current:null,token:null,hasCatch:!1,pending:w_,then:b_,catch:y_,value:5};return tr(t[1],o),{c(){e=k("div"),n=k("div"),i=k("img"),s=q(),o.block.c(),v(i,"class","card modal-context-full-page svelte-zgr10j"),ft(i.src,r=t[0])||v(i,"src",r),v(i,"alt",W==="fr"?"Vue de la page d'où la région est extraite":"View of the page the region is extracted from"),v(n,"class","modal-context-wrapper svelte-zgr10j"),v(e,"class","modal-context-outer pb-4 svelte-zgr10j")},m(l,a){j(l,e,a),y(e,n),y(n,i),y(n,s),o.block.m(n,o.anchor=null),o.mount=()=>n,o.anchor=null},p(l,[a]){t=l,ks(o,t,a)},i:X,o:X,d(l){l&&$(e),o.block.d(),o.token=null,o=null}}}function k_(t,e,n){let{mainImgItem:i}=e;const r=Mt(i.img,"full","full"),s=Vc(i.img),o=i.xywh.map(Number),l=fetch(s).then(a=>a.json()).then(a=>[o[0]/a.width,o[1]/a.height,o[2]/a.width,o[3]/a.height].map(c=>c*100));return t.$$set=a=>{"mainImgItem"in a&&n(2,i=a.mainImgItem)},[r,l,i]}class E_ extends ye{constructor(e){super(),ve(this,e,k_,S_,pe,{mainImgItem:2})}}const Ey="";function na(t,e,n){const i=t.slice();return i[13]=e[n].id,i[14]=e[n].label,i}function ia(t){let e,n,i=t[14]+"",r,s,o,l,a;function c(){return t[9](t[13])}return{c(){e=k("li"),n=k("a"),r=ne(i),s=q(),v(n,"href",""),v(e,"class",o=t[13]===t[2]?"is-active":"")},m(u,d){j(u,e,d),y(e,n),y(n,r),y(e,s),l||(a=Se(n,"click",Lt(c)),l=!0)},p(u,d){t=u,d&4&&o!==(o=t[13]===t[2]?"is-active":"")&&v(e,"class",o)},d(u){u&&$(e),l=!1,a()}}}function C_(t){let e,n,i,r,s,o,l,a,c,u,d,f,h,m,g,p=t[3],_=[];for(let I=0;I<p.length;I+=1)_[I]=ia(na(t,p,I));const w=[t[1][t[2]]||{}];var C=t[0][t[2]]||null;function b(I){let T={};for(let M=0;M<w.length;M+=1)T=ds(T,w[M]);return{props:T}}return C&&(u=si(C,b())),{c(){e=k("div"),n=k("div"),i=q(),r=k("div"),s=k("div"),o=k("div"),l=k("ul");for(let I=0;I<_.length;I+=1)_[I].c();a=q(),c=k("div"),u&&le(u.$$.fragment),d=q(),f=k("button"),v(n,"class","modal-background"),v(o,"class","tabs is-centered"),Le(o,"height","fit-content"),v(c,"class","ml-4 mr-4 modal-main-wrapper svelte-1uakzh2"),Pe(c,"pb-4",t[2]==="main"),v(s,"class","modal-inner svelte-1uakzh2"),v(r,"class","modal-content svelte-1uakzh2"),v(f,"class","modal-close is-large"),v(f,"aria-label","close"),v(e,"id","region-modal-wrapper"),v(e,"class","modal is-active")},m(I,T){j(I,e,T),y(e,n),y(e,i),y(e,r),y(r,s),y(s,o),y(o,l);for(let M=0;M<_.length;M+=1)_[M]&&_[M].m(l,null);y(s,a),y(s,c),u&&se(u,c,null),y(e,d),y(e,f),h=!0,m||(g=[Se(n,"click",t[6]),Se(n,"keyup",t[5]),Se(f,"click",t[6])],m=!0)},p(I,[T]){if(T&28){p=I[3];let E;for(E=0;E<p.length;E+=1){const A=na(I,p,E);_[E]?_[E].p(A,T):(_[E]=ia(A),_[E].c(),_[E].m(l,null))}for(;E<_.length;E+=1)_[E].d(1);_.length=p.length}const M=T&6?xc(w,[Mc(I[1][I[2]]||{})]):{};if(T&5&&C!==(C=I[0][I[2]]||null)){if(u){Ee();const E=u;K(E.$$.fragment,1,0,()=>{oe(E,1)}),Ce()}C?(u=si(C,b()),le(u.$$.fragment),V(u.$$.fragment,1),se(u,c,null)):u=null}else C&&u.$set(M);(!h||T&4)&&Pe(c,"pb-4",I[2]==="main")},i(I){h||(u&&V(u.$$.fragment,I),h=!0)},o(I){u&&K(u.$$.fragment,I),h=!1},d(I){I&&$(e),ot(_,I),u&&oe(u),m=!1,Ye(g)}}}function I_(t,e,n){let i,{mainImgItem:r}=e,{compareImgItem:s}=e;const o=ai(),l=s?["main","page","similarity","expansion"]:["main","page"],a={expansion:{fr:"Expansion de requête",en:"Query expansion"},similarity:{fr:"Comparaison",en:"Comparison"},page:{fr:"Vue de la page",en:"Page view"},main:{fr:"Vue principale",en:"Main view"}},c=l.map(p=>{var _;return{id:p,label:((_=a[p])==null?void 0:_[W])??"Main view"}}),u={main:ta,page:E_};s&&Promise.all([Ur(()=>Promise.resolve().then(()=>dv),void 0).then(p=>p.default),Ur(()=>Promise.resolve().then(()=>Fv),void 0).then(p=>p.default)]).then(([p,_])=>{const w=Object.keys(u);l.filter(C=>!w.includes(C)).map(C=>n(0,u[C]=C==="expansion"?_:C==="similarity"?p:ta,u))});const d={};l.map(p=>n(1,d[p]=p==="similarity"?{compareImgItem:s,mainImgItem:r}:{mainImgItem:r},d));const f=p=>n(2,i=p),h=p=>{p.key==="Escape"&&o("closeModal")},m=()=>o("closeModal");Nn(()=>{document.addEventListener("keyup",h)}),Tn(()=>{document.removeEventListener("keydown",h)});const g=p=>f(p);return t.$$set=p=>{"mainImgItem"in p&&n(7,r=p.mainImgItem),"compareImgItem"in p&&n(8,s=p.compareImgItem)},n(2,i=l[0]),[u,d,i,c,f,h,m,r,s,g]}class x_ extends ye{constructor(e){super(),ve(this,e,I_,C_,pe,{mainImgItem:7,compareImgItem:8})}}const Cy="";function M_(t){let e,n,i,r,s,o,l,a,c,u,d;return n=new zi({props:{targetHtmlId:t[0],tooltipText:t[1]}}),{c(){e=k("div"),le(n.$$.fragment),i=q(),r=k("button"),s=bt("svg"),o=bt("path"),l=bt("path"),a=bt("path"),v(o,"d","M53.6443 14.25C47.7042 5.33 37.7293 0 26.9801 0C16.2206 0 6.24576 5.33 0.305653 14.25L0 14.71L0.305653 15.17C6.24576 24.09 16.2206 29.42 26.9801 29.42C37.7293 29.42 47.7042 24.09 53.6443 15.16L53.95 14.71L53.6443 14.25ZM3.25025 14.71C7.63146 8.69001 14.0606 4.65 21.2641 3.22C20.0619 3.83 18.9411 4.62 17.963 5.59C15.5176 8.02 14.1625 11.25 14.1625 14.67C14.1625 18.11 15.5176 21.34 17.963 23.76C19.0124 24.79 20.1943 25.61 21.4781 26.23C14.1829 24.85 7.6824 20.78 3.25025 14.71ZM27.1125 22.64C22.7008 22.64 19.1041 19.08 19.1041 14.7C19.1041 12.59 19.9396 10.6 21.4475 9.10001C22.9555 7.60001 24.9729 6.77 27.1125 6.77C29.2522 6.77 31.2594 7.60001 32.7775 9.10001C34.2855 10.6 35.121 12.59 35.121 14.7C35.121 16.82 34.2855 18.82 32.7775 20.32C31.2594 21.81 29.242 22.64 27.1125 22.64ZM32.9915 26.14C34.204 25.53 35.3146 24.74 36.3029 23.77C38.7482 21.34 40.0932 18.11 40.0932 14.68C40.0932 9.75 37.281 5.47001 33.1647 3.32001C40.1747 4.81001 46.4102 8.83001 50.6896 14.71C46.3797 20.64 40.0728 24.67 32.9915 26.14Z"),v(o,"fill","black"),v(o,"class","svelte-19wutme"),v(l,"d","M26.9804 25.98C33.3222 25.98 38.4633 20.9343 38.4633 14.71C38.4633 8.48576 33.3222 3.44 26.9804 3.44C20.6386 3.44 15.4976 8.48576 15.4976 14.71C15.4976 20.9343 20.6386 25.98 26.9804 25.98Z"),v(l,"fill","black"),v(l,"class","svelte-19wutme"),v(a,"d","M17.9529 23.85L36.2928 5.85001"),v(a,"stroke","black"),v(a,"stroke-width","3"),v(a,"stroke-miterlimit","10"),v(a,"class","svelte-19wutme"),v(s,"width","54"),v(s,"height","30"),v(s,"viewBox","0 0 54 30"),v(s,"fill","none"),v(s,"xmlns","http://www.w3.org/2000/svg"),v(s,"class","svelte-19wutme"),v(r,"class","button tag svelte-19wutme"),v(r,"title",t[1]),v(e,"id",t[0])},m(f,h){j(f,e,h),se(n,e,null),y(e,i),y(e,r),y(r,s),y(s,o),y(s,l),y(s,a),c=!0,u||(d=Se(r,"click",t[2]),u=!0)},p:X,i(f){c||(V(n.$$.fragment,f),c=!0)},o(f){K(n.$$.fragment,f),c=!1},d(f){f&&$(e),oe(n),u=!1,d()}}}function A_(t,e,n){let i,r,{mainImgItem:s}=e,{compareImgItem:o=void 0}=e;hn("isInModal",!0);const l=`modal-opener-${window.crypto.randomUUID()}`,a=W==="fr"?"Vue détaillée":"Detailed view",c=(f,h)=>(f?(h=new x_({target:document.querySelector("body"),props:{mainImgItem:s,compareImgItem:o}}),h.$on("closeModal",d)):!f&&r!=null&&h.$destroy(),h),u=()=>n(5,i=!i),d=()=>n(5,i=!1);return t.$$set=f=>{"mainImgItem"in f&&n(3,s=f.mainImgItem),"compareImgItem"in f&&n(4,o=f.compareImgItem)},t.$$.update=()=>{t.$$.dirty&96&&n(6,r=c(i,r))},n(5,i=!1),[l,a,u,s,o,i,r]}class N_ extends ye{constructor(e){super(),ve(this,e,A_,M_,pe,{mainImgItem:3,compareImgItem:4})}}const T_=Object.freeze(Object.defineProperty({__proto__:null,default:N_},Symbol.toStringTag,{value:"Module"})),Iy="";function O_(t){let e,n,i,r,s,o,l;return{c(){e=k("button"),n=k("span"),n.innerHTML='<span class="switch-control svelte-g5g8im"><span class="switch-spot"></span></span>',i=q(),r=k("span"),s=ne(t[0]),v(n,"class","switch mr-2 svelte-g5g8im"),v(r,"class","label svelte-g5g8im"),v(e,"id",t[3]),v(e,"name",t[3]),v(e,"class","input-checkbox-wrapper is-flex is-align-items-center-is-justify-content-center p-2 pl-3 pr-3 svelte-g5g8im"),v(e,"aria-label",t[0]),Pe(e,"is-checked",t[2]),Pe(e,"is-clickable",t[1]),Pe(e,"button",t[1])},m(a,c){j(a,e,c),y(e,n),y(e,i),y(e,r),y(r,s),o||(l=Se(e,"click",Lt(t[4])),o=!0)},p(a,[c]){c&1&&me(s,a[0]),c&1&&v(e,"aria-label",a[0]),c&4&&Pe(e,"is-checked",a[2]),c&2&&Pe(e,"is-clickable",a[1]),c&2&&Pe(e,"button",a[1])},i:X,o:X,d(a){a&&$(e),o=!1,l()}}}function P_(t,e,n){let i,{toggleLabel:r}=e,{start:s=!1}=e,{buttonDisplay:o=!1}=e;const l=`input-toggle-${window.crypto.randomUUID()}`,a=ai(),c=ht("resetTrigger")||void 0;c==null||c.subscribe(d);const u=()=>n(2,i=!i);function d(){n(2,i=s)}return t.$$set=f=>{"toggleLabel"in f&&n(0,r=f.toggleLabel),"start"in f&&n(5,s=f.start),"buttonDisplay"in f&&n(1,o=f.buttonDisplay)},t.$$.update=()=>{t.$$.dirty&32&&n(2,i=s),t.$$.dirty&4&&a("updateChecked",i)},[r,o,i,l,u,s]}class L_ extends ye{constructor(e){super(),ve(this,e,P_,O_,pe,{toggleLabel:0,start:5,buttonDisplay:1})}}/*! choices.js v11.1.0 | © 2025 Josh Johnson | https://github.com/jshjohnson/Choices#readme */var Kr=function(t,e){return Kr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(n[r]=i[r])},Kr(t,e)};function ra(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");Kr(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}var ct=function(){return ct=Object.assign||function(e){for(var n,i=1,r=arguments.length;i<r;i++){n=arguments[i];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},ct.apply(this,arguments)};function D_(t,e,n){if(n||arguments.length===2)for(var i=0,r=e.length,s;i<r;i++)(s||!(i in e))&&(s||(s=Array.prototype.slice.call(e,0,i)),s[i]=e[i]);return t.concat(s||Array.prototype.slice.call(e))}typeof SuppressedError=="function"&&SuppressedError;var je={ADD_CHOICE:"ADD_CHOICE",REMOVE_CHOICE:"REMOVE_CHOICE",FILTER_CHOICES:"FILTER_CHOICES",ACTIVATE_CHOICES:"ACTIVATE_CHOICES",CLEAR_CHOICES:"CLEAR_CHOICES",ADD_GROUP:"ADD_GROUP",ADD_ITEM:"ADD_ITEM",REMOVE_ITEM:"REMOVE_ITEM",HIGHLIGHT_ITEM:"HIGHLIGHT_ITEM"},ut={showDropdown:"showDropdown",hideDropdown:"hideDropdown",change:"change",choice:"choice",search:"search",addItem:"addItem",removeItem:"removeItem",highlightItem:"highlightItem",highlightChoice:"highlightChoice",unhighlightItem:"unhighlightItem"},Je={TAB_KEY:9,SHIFT_KEY:16,BACK_KEY:46,DELETE_KEY:8,ENTER_KEY:13,A_KEY:65,ESC_KEY:27,UP_KEY:38,DOWN_KEY:40,PAGE_UP_KEY:33,PAGE_DOWN_KEY:34},R_=["fuseOptions","classNames"],Yt={Text:"text",SelectOne:"select-one",SelectMultiple:"select-multiple"},sa=function(t){return{type:je.ADD_CHOICE,choice:t}},$_=function(t){return{type:je.REMOVE_CHOICE,choice:t}},z_=function(t){return{type:je.FILTER_CHOICES,results:t}},j_=function(t){return{type:je.ACTIVATE_CHOICES,active:t}},F_=function(t){return{type:je.ADD_GROUP,group:t}},oa=function(t){return{type:je.ADD_ITEM,item:t}},la=function(t){return{type:je.REMOVE_ITEM,item:t}},ji=function(t,e){return{type:je.HIGHLIGHT_ITEM,item:t,highlighted:e}},V_=function(t,e){return Math.floor(Math.random()*(e-t)+t)},aa=function(t){return Array.from({length:t},function(){return V_(0,36).toString(36)}).join("")},H_=function(t,e){var n=t.id||t.name&&"".concat(t.name,"-").concat(aa(2))||aa(4);return n=n.replace(/(:|\.|\[|\]|,)/g,""),n="".concat(e,"-").concat(n),n},U_=function(t,e,n){n===void 0&&(n=1);for(var i="".concat(n>0?"next":"previous","ElementSibling"),r=t[i];r;){if(r.matches(e))return r;r=r[i]}return null},B_=function(t,e,n){n===void 0&&(n=1);var i;return n>0?i=e.scrollTop+e.offsetHeight>=t.offsetTop+t.offsetHeight:i=t.offsetTop>=e.scrollTop,i},Fi=function(t){if(typeof t!="string"){if(t==null)return"";if(typeof t=="object"){if("raw"in t)return Fi(t.raw);if("trusted"in t)return t.trusted}return t}return t.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/'/g,"&#039;").replace(/"/g,"&quot;")},q_=function(){var t=document.createElement("div");return function(e){t.innerHTML=e.trim();for(var n=t.children[0];t.firstChild;)t.removeChild(t.firstChild);return n}}(),Kn=function(t,e){return typeof t=="function"?t(Fi(e),e):t},ca=function(t){return typeof t=="function"?t():t},sn=function(t){if(typeof t=="string")return t;if(typeof t=="object"){if("trusted"in t)return t.trusted;if("raw"in t)return t.raw}return""},ua=function(t){if(typeof t=="string")return t;if(typeof t=="object"){if("escaped"in t)return t.escaped;if("trusted"in t)return t.trusted}return""},Wr=function(t,e){return t?ua(e):Fi(e)},Vt=function(t,e,n){t.innerHTML=Wr(e,n)},K_=function(t,e){var n=t.value,i=t.label,r=i===void 0?n:i,s=e.value,o=e.label,l=o===void 0?s:o;return sn(r).localeCompare(sn(l),[],{sensitivity:"base",ignorePunctuation:!0,numeric:!0})},W_=function(t,e){return t.rank-e.rank},G_=function(t,e,n){n===void 0&&(n=null);var i=new CustomEvent(e,{detail:n,bubbles:!0,cancelable:!0});return t.dispatchEvent(i)},Y_=function(t,e){var n=Object.keys(t).sort(),i=Object.keys(e).sort();return n.filter(function(r){return i.indexOf(r)<0})},Vi=function(t){return Array.isArray(t)?t:[t]},Wn=function(t){return t&&Array.isArray(t)?t.map(function(e){return".".concat(e)}).join(""):".".concat(t)},de=function(t,e){var n;(n=t.classList).add.apply(n,Vi(e))},Tt=function(t,e){var n;(n=t.classList).remove.apply(n,Vi(e))},X_=function(t){if(typeof t<"u")try{return JSON.parse(t)}catch{return t}return{}},J_=function(t,e,n){var i=t.itemEl;i&&(Tt(i,n),de(i,e))},Q_=function(){function t(e){var n=e.element,i=e.type,r=e.classNames;this.element=n,this.classNames=r,this.type=i,this.isActive=!1}return t.prototype.show=function(){return de(this.element,this.classNames.activeState),this.element.setAttribute("aria-expanded","true"),this.isActive=!0,this},t.prototype.hide=function(){return Tt(this.element,this.classNames.activeState),this.element.setAttribute("aria-expanded","false"),this.isActive=!1,this},t}(),fa=function(){function t(e){var n=e.element,i=e.type,r=e.classNames,s=e.position;this.element=n,this.classNames=r,this.type=i,this.position=s,this.isOpen=!1,this.isFlipped=!1,this.isDisabled=!1,this.isLoading=!1}return t.prototype.shouldFlip=function(e,n){var i=!1;return this.position==="auto"?i=this.element.getBoundingClientRect().top-n>=0&&!window.matchMedia("(min-height: ".concat(e+1,"px)")).matches:this.position==="top"&&(i=!0),i},t.prototype.setActiveDescendant=function(e){this.element.setAttribute("aria-activedescendant",e)},t.prototype.removeActiveDescendant=function(){this.element.removeAttribute("aria-activedescendant")},t.prototype.open=function(e,n){de(this.element,this.classNames.openState),this.element.setAttribute("aria-expanded","true"),this.isOpen=!0,this.shouldFlip(e,n)&&(de(this.element,this.classNames.flippedState),this.isFlipped=!0)},t.prototype.close=function(){Tt(this.element,this.classNames.openState),this.element.setAttribute("aria-expanded","false"),this.removeActiveDescendant(),this.isOpen=!1,this.isFlipped&&(Tt(this.element,this.classNames.flippedState),this.isFlipped=!1)},t.prototype.addFocusState=function(){de(this.element,this.classNames.focusState)},t.prototype.removeFocusState=function(){Tt(this.element,this.classNames.focusState)},t.prototype.enable=function(){Tt(this.element,this.classNames.disabledState),this.element.removeAttribute("aria-disabled"),this.type===Yt.SelectOne&&this.element.setAttribute("tabindex","0"),this.isDisabled=!1},t.prototype.disable=function(){de(this.element,this.classNames.disabledState),this.element.setAttribute("aria-disabled","true"),this.type===Yt.SelectOne&&this.element.setAttribute("tabindex","-1"),this.isDisabled=!0},t.prototype.wrap=function(e){var n=this.element,i=e.parentNode;i&&(e.nextSibling?i.insertBefore(n,e.nextSibling):i.appendChild(n)),n.appendChild(e)},t.prototype.unwrap=function(e){var n=this.element,i=n.parentNode;i&&(i.insertBefore(e,n),i.removeChild(n))},t.prototype.addLoadingState=function(){de(this.element,this.classNames.loadingState),this.element.setAttribute("aria-busy","true"),this.isLoading=!0},t.prototype.removeLoadingState=function(){Tt(this.element,this.classNames.loadingState),this.element.removeAttribute("aria-busy"),this.isLoading=!1},t}(),Z_=function(){function t(e){var n=e.element,i=e.type,r=e.classNames,s=e.preventPaste;this.element=n,this.type=i,this.classNames=r,this.preventPaste=s,this.isFocussed=this.element.isEqualNode(document.activeElement),this.isDisabled=n.disabled,this._onPaste=this._onPaste.bind(this),this._onInput=this._onInput.bind(this),this._onFocus=this._onFocus.bind(this),this._onBlur=this._onBlur.bind(this)}return Object.defineProperty(t.prototype,"placeholder",{set:function(e){this.element.placeholder=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){return this.element.value},set:function(e){this.element.value=e},enumerable:!1,configurable:!0}),t.prototype.addEventListeners=function(){var e=this.element;e.addEventListener("paste",this._onPaste),e.addEventListener("input",this._onInput,{passive:!0}),e.addEventListener("focus",this._onFocus,{passive:!0}),e.addEventListener("blur",this._onBlur,{passive:!0})},t.prototype.removeEventListeners=function(){var e=this.element;e.removeEventListener("input",this._onInput),e.removeEventListener("paste",this._onPaste),e.removeEventListener("focus",this._onFocus),e.removeEventListener("blur",this._onBlur)},t.prototype.enable=function(){var e=this.element;e.removeAttribute("disabled"),this.isDisabled=!1},t.prototype.disable=function(){var e=this.element;e.setAttribute("disabled",""),this.isDisabled=!0},t.prototype.focus=function(){this.isFocussed||this.element.focus()},t.prototype.blur=function(){this.isFocussed&&this.element.blur()},t.prototype.clear=function(e){return e===void 0&&(e=!0),this.element.value="",e&&this.setWidth(),this},t.prototype.setWidth=function(){var e=this.element;e.style.minWidth="".concat(e.placeholder.length+1,"ch"),e.style.width="".concat(e.value.length+1,"ch")},t.prototype.setActiveDescendant=function(e){this.element.setAttribute("aria-activedescendant",e)},t.prototype.removeActiveDescendant=function(){this.element.removeAttribute("aria-activedescendant")},t.prototype._onInput=function(){this.type!==Yt.SelectOne&&this.setWidth()},t.prototype._onPaste=function(e){this.preventPaste&&e.preventDefault()},t.prototype._onFocus=function(){this.isFocussed=!0},t.prototype._onBlur=function(){this.isFocussed=!1},t}(),e0=4,ha=function(){function t(e){var n=e.element;this.element=n,this.scrollPos=this.element.scrollTop,this.height=this.element.offsetHeight}return t.prototype.prepend=function(e){var n=this.element.firstElementChild;n?this.element.insertBefore(e,n):this.element.append(e)},t.prototype.scrollToTop=function(){this.element.scrollTop=0},t.prototype.scrollToChildElement=function(e,n){var i=this;if(e){var r=this.element.offsetHeight,s=this.element.scrollTop+r,o=e.offsetHeight,l=e.offsetTop+o,a=n>0?this.element.scrollTop+l-s:e.offsetTop;requestAnimationFrame(function(){i._animateScroll(a,n)})}},t.prototype._scrollDown=function(e,n,i){var r=(i-e)/n,s=r>1?r:1;this.element.scrollTop=e+s},t.prototype._scrollUp=function(e,n,i){var r=(e-i)/n,s=r>1?r:1;this.element.scrollTop=e-s},t.prototype._animateScroll=function(e,n){var i=this,r=e0,s=this.element.scrollTop,o=!1;n>0?(this._scrollDown(s,r,e),s<e&&(o=!0)):(this._scrollUp(s,r,e),s>e&&(o=!0)),o&&requestAnimationFrame(function(){i._animateScroll(e,n)})},t}(),da=function(){function t(e){var n=e.element,i=e.classNames;this.element=n,this.classNames=i,this.isDisabled=!1}return Object.defineProperty(t.prototype,"isActive",{get:function(){return this.element.dataset.choice==="active"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dir",{get:function(){return this.element.dir},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){return this.element.value},set:function(e){this.element.setAttribute("value",e),this.element.value=e},enumerable:!1,configurable:!0}),t.prototype.conceal=function(){var e=this.element;de(e,this.classNames.input),e.hidden=!0,e.tabIndex=-1;var n=e.getAttribute("style");n&&e.setAttribute("data-choice-orig-style",n),e.setAttribute("data-choice","active")},t.prototype.reveal=function(){var e=this.element;Tt(e,this.classNames.input),e.hidden=!1,e.removeAttribute("tabindex");var n=e.getAttribute("data-choice-orig-style");n?(e.removeAttribute("data-choice-orig-style"),e.setAttribute("style",n)):e.removeAttribute("style"),e.removeAttribute("data-choice")},t.prototype.enable=function(){this.element.removeAttribute("disabled"),this.element.disabled=!1,this.isDisabled=!1},t.prototype.disable=function(){this.element.setAttribute("disabled",""),this.element.disabled=!0,this.isDisabled=!0},t.prototype.triggerEvent=function(e,n){G_(this.element,e,n||{})},t}(),t0=function(t){ra(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e}(da),Gn=function(t,e){return e===void 0&&(e=!0),typeof t>"u"?e:!!t},ma=function(t){if(typeof t=="string"&&(t=t.split(" ").filter(function(e){return e.length})),Array.isArray(t)&&t.length)return t},Ot=function(t,e,n){if(n===void 0&&(n=!0),typeof t=="string"){var i=Fi(t),r=n||i===t?t:{escaped:i,raw:t},s=Ot({value:t,label:r,selected:!0},!1);return s}var o=t;if("choices"in o){if(!e)throw new TypeError("optGroup is not allowed");var l=o,a=l.choices.map(function(f){return Ot(f,!1)}),c={id:0,label:sn(l.label)||l.value,active:!!a.length,disabled:!!l.disabled,choices:a};return c}var u=o,d={id:0,group:null,score:0,rank:0,value:u.value,label:u.label||u.value,active:Gn(u.active),selected:Gn(u.selected,!1),disabled:Gn(u.disabled,!1),placeholder:Gn(u.placeholder,!1),highlighted:!1,labelClass:ma(u.labelClass),labelDescription:u.labelDescription,customProperties:u.customProperties};return d},n0=function(t){return t.tagName==="INPUT"},pa=function(t){return t.tagName==="SELECT"},i0=function(t){return t.tagName==="OPTION"},r0=function(t){return t.tagName==="OPTGROUP"},s0=function(t){ra(e,t);function e(n){var i=n.element,r=n.classNames,s=n.template,o=n.extractPlaceholder,l=t.call(this,{element:i,classNames:r})||this;return l.template=s,l.extractPlaceholder=o,l}return Object.defineProperty(e.prototype,"placeholderOption",{get:function(){return this.element.querySelector('option[value=""]')||this.element.querySelector("option[placeholder]")},enumerable:!1,configurable:!0}),e.prototype.addOptions=function(n){var i=this,r=document.createDocumentFragment();n.forEach(function(s){var o=s;if(!o.element){var l=i.template(o);r.appendChild(l),o.element=l}}),this.element.appendChild(r)},e.prototype.optionsAsChoices=function(){var n=this,i=[];return this.element.querySelectorAll(":scope > option, :scope > optgroup").forEach(function(r){i0(r)?i.push(n._optionToChoice(r)):r0(r)&&i.push(n._optgroupToChoice(r))}),i},e.prototype._optionToChoice=function(n){return!n.hasAttribute("value")&&n.hasAttribute("placeholder")&&(n.setAttribute("value",""),n.value=""),{id:0,group:null,score:0,rank:0,value:n.value,label:n.label,element:n,active:!0,selected:this.extractPlaceholder?n.selected:n.hasAttribute("selected"),disabled:n.disabled,highlighted:!1,placeholder:this.extractPlaceholder&&(!n.value||n.hasAttribute("placeholder")),labelClass:typeof n.dataset.labelClass<"u"?ma(n.dataset.labelClass):void 0,labelDescription:typeof n.dataset.labelDescription<"u"?n.dataset.labelDescription:void 0,customProperties:X_(n.dataset.customProperties)}},e.prototype._optgroupToChoice=function(n){var i=this,r=n.querySelectorAll("option"),s=Array.from(r).map(function(o){return i._optionToChoice(o)});return{id:0,label:n.label||"",element:n,active:!!s.length,disabled:n.disabled,choices:s}},e}(da),o0={containerOuter:["choices"],containerInner:["choices__inner"],input:["choices__input"],inputCloned:["choices__input--cloned"],list:["choices__list"],listItems:["choices__list--multiple"],listSingle:["choices__list--single"],listDropdown:["choices__list--dropdown"],item:["choices__item"],itemSelectable:["choices__item--selectable"],itemDisabled:["choices__item--disabled"],itemChoice:["choices__item--choice"],description:["choices__description"],placeholder:["choices__placeholder"],group:["choices__group"],groupHeading:["choices__heading"],button:["choices__button"],activeState:["is-active"],focusState:["is-focused"],openState:["is-open"],disabledState:["is-disabled"],highlightedState:["is-highlighted"],selectedState:["is-selected"],flippedState:["is-flipped"],loadingState:["is-loading"],notice:["choices__notice"],addChoice:["choices__item--selectable","add-choice"],noResults:["has-no-results"],noChoices:["has-no-choices"]},ga={items:[],choices:[],silent:!1,renderChoiceLimit:-1,maxItemCount:-1,closeDropdownOnSelect:"auto",singleModeForMultiSelect:!1,addChoices:!1,addItems:!0,addItemFilter:function(t){return!!t&&t!==""},removeItems:!0,removeItemButton:!1,removeItemButtonAlignLeft:!1,editItems:!1,allowHTML:!1,allowHtmlUserInput:!1,duplicateItemsAllowed:!0,delimiter:",",paste:!0,searchEnabled:!0,searchChoices:!0,searchFloor:1,searchResultLimit:4,searchFields:["label","value"],position:"auto",resetScrollPosition:!0,shouldSort:!0,shouldSortItems:!1,sorter:K_,shadowRoot:null,placeholder:!0,placeholderValue:null,searchPlaceholderValue:null,prependValue:null,appendValue:null,renderSelectedChoices:"auto",loadingText:"Loading...",noResultsText:"No results found",noChoicesText:"No choices to choose from",itemSelectText:"Press to select",uniqueItemText:"Only unique values can be added",customAddItemText:"Only values matching specific conditions can be added",addItemText:function(t){return'Press Enter to add <b>"'.concat(t,'"</b>')},removeItemIconText:function(){return"Remove item"},removeItemLabelText:function(t){return"Remove item: ".concat(t)},maxItemText:function(t){return"Only ".concat(t," values can be added")},valueComparer:function(t,e){return t===e},fuseOptions:{includeScore:!0},labelId:"",callbackOnInit:null,callbackOnCreateTemplates:null,classNames:o0,appendGroupInSearch:!1},_a=function(t){var e=t.itemEl;e&&(e.remove(),t.itemEl=void 0)};function l0(t,e,n){var i=t,r=!0;switch(e.type){case je.ADD_ITEM:{e.item.selected=!0;var s=e.item.element;s&&(s.selected=!0,s.setAttribute("selected","")),i.push(e.item);break}case je.REMOVE_ITEM:{e.item.selected=!1;var s=e.item.element;if(s){s.selected=!1,s.removeAttribute("selected");var o=s.parentElement;o&&pa(o)&&o.type===Yt.SelectOne&&(o.value="")}_a(e.item),i=i.filter(function(u){return u.id!==e.item.id});break}case je.REMOVE_CHOICE:{_a(e.choice),i=i.filter(function(c){return c.id!==e.choice.id});break}case je.HIGHLIGHT_ITEM:{var l=e.highlighted,a=i.find(function(c){return c.id===e.item.id});a&&a.highlighted!==l&&(a.highlighted=l,n&&J_(a,l?n.classNames.highlightedState:n.classNames.selectedState,l?n.classNames.selectedState:n.classNames.highlightedState));break}default:{r=!1;break}}return{state:i,update:r}}function a0(t,e){var n=t,i=!0;switch(e.type){case je.ADD_GROUP:{n.push(e.group);break}case je.CLEAR_CHOICES:{n=[];break}default:{i=!1;break}}return{state:n,update:i}}function c0(t,e,n){var i=t,r=!0;switch(e.type){case je.ADD_CHOICE:{i.push(e.choice);break}case je.REMOVE_CHOICE:{e.choice.choiceEl=void 0,e.choice.group&&(e.choice.group.choices=e.choice.group.choices.filter(function(o){return o.id!==e.choice.id})),i=i.filter(function(o){return o.id!==e.choice.id});break}case je.ADD_ITEM:case je.REMOVE_ITEM:{e.item.choiceEl=void 0;break}case je.FILTER_CHOICES:{var s=[];e.results.forEach(function(o){s[o.item.id]=o}),i.forEach(function(o){var l=s[o.id];l!==void 0?(o.score=l.score,o.rank=l.rank,o.active=!0):(o.score=0,o.rank=0,o.active=!1),n&&n.appendGroupInSearch&&(o.choiceEl=void 0)});break}case je.ACTIVATE_CHOICES:{i.forEach(function(o){o.active=e.active,n&&n.appendGroupInSearch&&(o.choiceEl=void 0)});break}case je.CLEAR_CHOICES:{i=[];break}default:{r=!1;break}}return{state:i,update:r}}var va={groups:a0,items:l0,choices:c0},u0=function(){function t(e){this._state=this.defaultState,this._listeners=[],this._txn=0,this._context=e}return Object.defineProperty(t.prototype,"defaultState",{get:function(){return{groups:[],items:[],choices:[]}},enumerable:!1,configurable:!0}),t.prototype.changeSet=function(e){return{groups:e,items:e,choices:e}},t.prototype.reset=function(){this._state=this.defaultState;var e=this.changeSet(!0);this._txn?this._changeSet=e:this._listeners.forEach(function(n){return n(e)})},t.prototype.subscribe=function(e){return this._listeners.push(e),this},t.prototype.dispatch=function(e){var n=this,i=this._state,r=!1,s=this._changeSet||this.changeSet(!1);Object.keys(va).forEach(function(o){var l=va[o](i[o],e,n._context);l.update&&(r=!0,s[o]=!0,i[o]=l.state)}),r&&(this._txn?this._changeSet=s:this._listeners.forEach(function(o){return o(s)}))},t.prototype.withTxn=function(e){this._txn++;try{e()}finally{if(this._txn=Math.max(0,this._txn-1),!this._txn){var n=this._changeSet;n&&(this._changeSet=void 0,this._listeners.forEach(function(i){return i(n)}))}}},Object.defineProperty(t.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"items",{get:function(){return this.state.items},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"highlightedActiveItems",{get:function(){return this.items.filter(function(e){return e.active&&e.highlighted})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"choices",{get:function(){return this.state.choices},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"activeChoices",{get:function(){return this.choices.filter(function(e){return e.active})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"searchableChoices",{get:function(){return this.choices.filter(function(e){return!e.disabled&&!e.placeholder})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"groups",{get:function(){return this.state.groups},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"activeGroups",{get:function(){var e=this;return this.state.groups.filter(function(n){var i=n.active&&!n.disabled,r=e.state.choices.some(function(s){return s.active&&!s.disabled});return i&&r},[])},enumerable:!1,configurable:!0}),t.prototype.inTxn=function(){return this._txn>0},t.prototype.getChoiceById=function(e){return this.activeChoices.find(function(n){return n.id===e})},t.prototype.getGroupById=function(e){return this.groups.find(function(n){return n.id===e})},t}(),We={noChoices:"no-choices",noResults:"no-results",addChoice:"add-choice",generic:""};function f0(t,e,n){return(e=d0(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function ya(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function xn(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?ya(Object(n),!0).forEach(function(i){f0(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ya(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}function h0(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var i=n.call(t,e||"default");if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function d0(t){var e=h0(t,"string");return typeof e=="symbol"?e:e+""}function Ht(t){return Array.isArray?Array.isArray(t):Sa(t)==="[object Array]"}const m0=1/0;function p0(t){if(typeof t=="string")return t;let e=t+"";return e=="0"&&1/t==-m0?"-0":e}function g0(t){return t==null?"":p0(t)}function Pt(t){return typeof t=="string"}function ba(t){return typeof t=="number"}function _0(t){return t===!0||t===!1||v0(t)&&Sa(t)=="[object Boolean]"}function wa(t){return typeof t=="object"}function v0(t){return wa(t)&&t!==null}function mt(t){return t!=null}function Gr(t){return!t.trim().length}function Sa(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(t)}const xy="Extended search is not available",y0="Incorrect 'index' type",b0=t=>`Invalid value for key ${t}`,w0=t=>`Pattern length exceeds max of ${t}.`,S0=t=>`Missing ${t} property in key`,k0=t=>`Property 'weight' in key '${t}' must be a positive integer`,ka=Object.prototype.hasOwnProperty;class E0{constructor(e){this._keys=[],this._keyMap={};let n=0;e.forEach(i=>{let r=Ea(i);this._keys.push(r),this._keyMap[r.id]=r,n+=r.weight}),this._keys.forEach(i=>{i.weight/=n})}get(e){return this._keyMap[e]}keys(){return this._keys}toJSON(){return JSON.stringify(this._keys)}}function Ea(t){let e=null,n=null,i=null,r=1,s=null;if(Pt(t)||Ht(t))i=t,e=Ca(t),n=Yr(t);else{if(!ka.call(t,"name"))throw new Error(S0("name"));const o=t.name;if(i=o,ka.call(t,"weight")&&(r=t.weight,r<=0))throw new Error(k0(o));e=Ca(o),n=Yr(o),s=t.getFn}return{path:e,id:n,weight:r,src:i,getFn:s}}function Ca(t){return Ht(t)?t:t.split(".")}function Yr(t){return Ht(t)?t.join("."):t}function C0(t,e){let n=[],i=!1;const r=(s,o,l)=>{if(mt(s))if(!o[l])n.push(s);else{let a=o[l];const c=s[a];if(!mt(c))return;if(l===o.length-1&&(Pt(c)||ba(c)||_0(c)))n.push(g0(c));else if(Ht(c)){i=!0;for(let u=0,d=c.length;u<d;u+=1)r(c[u],o,l+1)}else o.length&&r(c,o,l+1)}};return r(t,Pt(e)?e.split("."):e,0),i?n:n[0]}const I0={includeMatches:!1,findAllMatches:!1,minMatchCharLength:1},x0={isCaseSensitive:!1,includeScore:!1,keys:[],shouldSort:!0,sortFn:(t,e)=>t.score===e.score?t.idx<e.idx?-1:1:t.score<e.score?-1:1},M0={location:0,threshold:.6,distance:100},A0={useExtendedSearch:!1,getFn:C0,ignoreLocation:!1,ignoreFieldNorm:!1,fieldNormWeight:1};var fe=xn(xn(xn(xn({},x0),I0),M0),A0);const N0=/[^ ]+/g;function T0(t=1,e=3){const n=new Map,i=Math.pow(10,e);return{get(r){const s=r.match(N0).length;if(n.has(s))return n.get(s);const o=1/Math.pow(s,.5*t),l=parseFloat(Math.round(o*i)/i);return n.set(s,l),l},clear(){n.clear()}}}class Xr{constructor({getFn:e=fe.getFn,fieldNormWeight:n=fe.fieldNormWeight}={}){this.norm=T0(n,3),this.getFn=e,this.isCreated=!1,this.setIndexRecords()}setSources(e=[]){this.docs=e}setIndexRecords(e=[]){this.records=e}setKeys(e=[]){this.keys=e,this._keysMap={},e.forEach((n,i)=>{this._keysMap[n.id]=i})}create(){this.isCreated||!this.docs.length||(this.isCreated=!0,Pt(this.docs[0])?this.docs.forEach((e,n)=>{this._addString(e,n)}):this.docs.forEach((e,n)=>{this._addObject(e,n)}),this.norm.clear())}add(e){const n=this.size();Pt(e)?this._addString(e,n):this._addObject(e,n)}removeAt(e){this.records.splice(e,1);for(let n=e,i=this.size();n<i;n+=1)this.records[n].i-=1}getValueForItemAtKeyId(e,n){return e[this._keysMap[n]]}size(){return this.records.length}_addString(e,n){if(!mt(e)||Gr(e))return;let i={v:e,i:n,n:this.norm.get(e)};this.records.push(i)}_addObject(e,n){let i={i:n,$:{}};this.keys.forEach((r,s)=>{let o=r.getFn?r.getFn(e):this.getFn(e,r.path);if(mt(o)){if(Ht(o)){let l=[];const a=[{nestedArrIndex:-1,value:o}];for(;a.length;){const{nestedArrIndex:c,value:u}=a.pop();if(mt(u))if(Pt(u)&&!Gr(u)){let d={v:u,i:c,n:this.norm.get(u)};l.push(d)}else Ht(u)&&u.forEach((d,f)=>{a.push({nestedArrIndex:f,value:d})})}i.$[s]=l}else if(Pt(o)&&!Gr(o)){let l={v:o,n:this.norm.get(o)};i.$[s]=l}}}),this.records.push(i)}toJSON(){return{keys:this.keys,records:this.records}}}function Ia(t,e,{getFn:n=fe.getFn,fieldNormWeight:i=fe.fieldNormWeight}={}){const r=new Xr({getFn:n,fieldNormWeight:i});return r.setKeys(t.map(Ea)),r.setSources(e),r.create(),r}function O0(t,{getFn:e=fe.getFn,fieldNormWeight:n=fe.fieldNormWeight}={}){const{keys:i,records:r}=t,s=new Xr({getFn:e,fieldNormWeight:n});return s.setKeys(i),s.setIndexRecords(r),s}function Hi(t,{errors:e=0,currentLocation:n=0,expectedLocation:i=0,distance:r=fe.distance,ignoreLocation:s=fe.ignoreLocation}={}){const o=e/t.length;if(s)return o;const l=Math.abs(i-n);return r?o+l/r:l?1:o}function P0(t=[],e=fe.minMatchCharLength){let n=[],i=-1,r=-1,s=0;for(let o=t.length;s<o;s+=1){let l=t[s];l&&i===-1?i=s:!l&&i!==-1&&(r=s-1,r-i+1>=e&&n.push([i,r]),i=-1)}return t[s-1]&&s-i>=e&&n.push([i,s-1]),n}const on=32;function L0(t,e,n,{location:i=fe.location,distance:r=fe.distance,threshold:s=fe.threshold,findAllMatches:o=fe.findAllMatches,minMatchCharLength:l=fe.minMatchCharLength,includeMatches:a=fe.includeMatches,ignoreLocation:c=fe.ignoreLocation}={}){if(e.length>on)throw new Error(w0(on));const u=e.length,d=t.length,f=Math.max(0,Math.min(i,d));let h=s,m=f;const g=l>1||a,p=g?Array(d):[];let _;for(;(_=t.indexOf(e,m))>-1;){let M=Hi(e,{currentLocation:_,expectedLocation:f,distance:r,ignoreLocation:c});if(h=Math.min(M,h),m=_+u,g){let E=0;for(;E<u;)p[_+E]=1,E+=1}}m=-1;let w=[],C=1,b=u+d;const I=1<<u-1;for(let M=0;M<u;M+=1){let E=0,A=b;for(;E<A;)Hi(e,{errors:M,currentLocation:f+A,expectedLocation:f,distance:r,ignoreLocation:c})<=h?E=A:b=A,A=Math.floor((b-E)/2+E);b=A;let O=Math.max(1,f-A+1),D=o?d:Math.min(f+A,d)+u,B=Array(D+2);B[D+1]=(1<<M)-1;for(let S=D;S>=O;S-=1){let L=S-1,x=n[t.charAt(L)];if(g&&(p[L]=+!!x),B[S]=(B[S+1]<<1|1)&x,M&&(B[S]|=(w[S+1]|w[S])<<1|1|w[S+1]),B[S]&I&&(C=Hi(e,{errors:M,currentLocation:L,expectedLocation:f,distance:r,ignoreLocation:c}),C<=h)){if(h=C,m=L,m<=f)break;O=Math.max(1,2*f-m)}}if(Hi(e,{errors:M+1,currentLocation:f,expectedLocation:f,distance:r,ignoreLocation:c})>h)break;w=B}const T={isMatch:m>=0,score:Math.max(.001,C)};if(g){const M=P0(p,l);M.length?a&&(T.indices=M):T.isMatch=!1}return T}function D0(t){let e={};for(let n=0,i=t.length;n<i;n+=1){const r=t.charAt(n);e[r]=(e[r]||0)|1<<i-n-1}return e}class xa{constructor(e,{location:n=fe.location,threshold:i=fe.threshold,distance:r=fe.distance,includeMatches:s=fe.includeMatches,findAllMatches:o=fe.findAllMatches,minMatchCharLength:l=fe.minMatchCharLength,isCaseSensitive:a=fe.isCaseSensitive,ignoreLocation:c=fe.ignoreLocation}={}){if(this.options={location:n,threshold:i,distance:r,includeMatches:s,findAllMatches:o,minMatchCharLength:l,isCaseSensitive:a,ignoreLocation:c},this.pattern=a?e:e.toLowerCase(),this.chunks=[],!this.pattern.length)return;const u=(f,h)=>{this.chunks.push({pattern:f,alphabet:D0(f),startIndex:h})},d=this.pattern.length;if(d>on){let f=0;const h=d%on,m=d-h;for(;f<m;)u(this.pattern.substr(f,on),f),f+=on;if(h){const g=d-on;u(this.pattern.substr(g),g)}}else u(this.pattern,0)}searchIn(e){const{isCaseSensitive:n,includeMatches:i}=this.options;if(n||(e=e.toLowerCase()),this.pattern===e){let m={isMatch:!0,score:0};return i&&(m.indices=[[0,e.length-1]]),m}const{location:r,distance:s,threshold:o,findAllMatches:l,minMatchCharLength:a,ignoreLocation:c}=this.options;let u=[],d=0,f=!1;this.chunks.forEach(({pattern:m,alphabet:g,startIndex:p})=>{const{isMatch:_,score:w,indices:C}=L0(e,m,g,{location:r+p,distance:s,threshold:o,findAllMatches:l,minMatchCharLength:a,includeMatches:i,ignoreLocation:c});_&&(f=!0),d+=w,_&&C&&(u=[...u,...C])});let h={isMatch:f,score:f?d/this.chunks.length:1};return f&&i&&(h.indices=u),h}}class Xt{constructor(e){this.pattern=e}static isMultiMatch(e){return Ma(e,this.multiRegex)}static isSingleMatch(e){return Ma(e,this.singleRegex)}search(){}}function Ma(t,e){const n=t.match(e);return n?n[1]:null}class R0 extends Xt{constructor(e){super(e)}static get type(){return"exact"}static get multiRegex(){return/^="(.*)"$/}static get singleRegex(){return/^=(.*)$/}search(e){const n=e===this.pattern;return{isMatch:n,score:n?0:1,indices:[0,this.pattern.length-1]}}}class $0 extends Xt{constructor(e){super(e)}static get type(){return"inverse-exact"}static get multiRegex(){return/^!"(.*)"$/}static get singleRegex(){return/^!(.*)$/}search(e){const i=e.indexOf(this.pattern)===-1;return{isMatch:i,score:i?0:1,indices:[0,e.length-1]}}}class z0 extends Xt{constructor(e){super(e)}static get type(){return"prefix-exact"}static get multiRegex(){return/^\^"(.*)"$/}static get singleRegex(){return/^\^(.*)$/}search(e){const n=e.startsWith(this.pattern);return{isMatch:n,score:n?0:1,indices:[0,this.pattern.length-1]}}}class j0 extends Xt{constructor(e){super(e)}static get type(){return"inverse-prefix-exact"}static get multiRegex(){return/^!\^"(.*)"$/}static get singleRegex(){return/^!\^(.*)$/}search(e){const n=!e.startsWith(this.pattern);return{isMatch:n,score:n?0:1,indices:[0,e.length-1]}}}class F0 extends Xt{constructor(e){super(e)}static get type(){return"suffix-exact"}static get multiRegex(){return/^"(.*)"\$$/}static get singleRegex(){return/^(.*)\$$/}search(e){const n=e.endsWith(this.pattern);return{isMatch:n,score:n?0:1,indices:[e.length-this.pattern.length,e.length-1]}}}class V0 extends Xt{constructor(e){super(e)}static get type(){return"inverse-suffix-exact"}static get multiRegex(){return/^!"(.*)"\$$/}static get singleRegex(){return/^!(.*)\$$/}search(e){const n=!e.endsWith(this.pattern);return{isMatch:n,score:n?0:1,indices:[0,e.length-1]}}}class Aa extends Xt{constructor(e,{location:n=fe.location,threshold:i=fe.threshold,distance:r=fe.distance,includeMatches:s=fe.includeMatches,findAllMatches:o=fe.findAllMatches,minMatchCharLength:l=fe.minMatchCharLength,isCaseSensitive:a=fe.isCaseSensitive,ignoreLocation:c=fe.ignoreLocation}={}){super(e),this._bitapSearch=new xa(e,{location:n,threshold:i,distance:r,includeMatches:s,findAllMatches:o,minMatchCharLength:l,isCaseSensitive:a,ignoreLocation:c})}static get type(){return"fuzzy"}static get multiRegex(){return/^"(.*)"$/}static get singleRegex(){return/^(.*)$/}search(e){return this._bitapSearch.searchIn(e)}}class Na extends Xt{constructor(e){super(e)}static get type(){return"include"}static get multiRegex(){return/^'"(.*)"$/}static get singleRegex(){return/^'(.*)$/}search(e){let n=0,i;const r=[],s=this.pattern.length;for(;(i=e.indexOf(this.pattern,n))>-1;)n=i+s,r.push([i,n-1]);const o=!!r.length;return{isMatch:o,score:o?0:1,indices:r}}}const Jr=[R0,Na,z0,j0,V0,F0,$0,Aa],Ta=Jr.length,H0=/ +(?=(?:[^\"]*\"[^\"]*\")*[^\"]*$)/,U0="|";function B0(t,e={}){return t.split(U0).map(n=>{let i=n.trim().split(H0).filter(s=>s&&!!s.trim()),r=[];for(let s=0,o=i.length;s<o;s+=1){const l=i[s];let a=!1,c=-1;for(;!a&&++c<Ta;){const u=Jr[c];let d=u.isMultiMatch(l);d&&(r.push(new u(d,e)),a=!0)}if(!a)for(c=-1;++c<Ta;){const u=Jr[c];let d=u.isSingleMatch(l);if(d){r.push(new u(d,e));break}}}return r})}const q0=new Set([Aa.type,Na.type]);class K0{constructor(e,{isCaseSensitive:n=fe.isCaseSensitive,includeMatches:i=fe.includeMatches,minMatchCharLength:r=fe.minMatchCharLength,ignoreLocation:s=fe.ignoreLocation,findAllMatches:o=fe.findAllMatches,location:l=fe.location,threshold:a=fe.threshold,distance:c=fe.distance}={}){this.query=null,this.options={isCaseSensitive:n,includeMatches:i,minMatchCharLength:r,findAllMatches:o,ignoreLocation:s,location:l,threshold:a,distance:c},this.pattern=n?e:e.toLowerCase(),this.query=B0(this.pattern,this.options)}static condition(e,n){return n.useExtendedSearch}searchIn(e){const n=this.query;if(!n)return{isMatch:!1,score:1};const{includeMatches:i,isCaseSensitive:r}=this.options;e=r?e:e.toLowerCase();let s=0,o=[],l=0;for(let a=0,c=n.length;a<c;a+=1){const u=n[a];o.length=0,s=0;for(let d=0,f=u.length;d<f;d+=1){const h=u[d],{isMatch:m,indices:g,score:p}=h.search(e);if(m){if(s+=1,l+=p,i){const _=h.constructor.type;q0.has(_)?o=[...o,...g]:o.push(g)}}else{l=0,s=0,o.length=0;break}}if(s){let d={isMatch:!0,score:l/s};return i&&(d.indices=o),d}}return{isMatch:!1,score:1}}}const Qr=[];function W0(...t){Qr.push(...t)}function Zr(t,e){for(let n=0,i=Qr.length;n<i;n+=1){let r=Qr[n];if(r.condition(t,e))return new r(t,e)}return new xa(t,e)}const Ui={AND:"$and",OR:"$or"},es={PATH:"$path",PATTERN:"$val"},ts=t=>!!(t[Ui.AND]||t[Ui.OR]),G0=t=>!!t[es.PATH],Y0=t=>!Ht(t)&&wa(t)&&!ts(t),Oa=t=>({[Ui.AND]:Object.keys(t).map(e=>({[e]:t[e]}))});function Pa(t,e,{auto:n=!0}={}){const i=r=>{let s=Object.keys(r);const o=G0(r);if(!o&&s.length>1&&!ts(r))return i(Oa(r));if(Y0(r)){const a=o?r[es.PATH]:s[0],c=o?r[es.PATTERN]:r[a];if(!Pt(c))throw new Error(b0(a));const u={keyId:Yr(a),pattern:c};return n&&(u.searcher=Zr(c,e)),u}let l={children:[],operator:s[0]};return s.forEach(a=>{const c=r[a];Ht(c)&&c.forEach(u=>{l.children.push(i(u))})}),l};return ts(t)||(t=Oa(t)),i(t)}function X0(t,{ignoreFieldNorm:e=fe.ignoreFieldNorm}){t.forEach(n=>{let i=1;n.matches.forEach(({key:r,norm:s,score:o})=>{const l=r?r.weight:null;i*=Math.pow(o===0&&l?Number.EPSILON:o,(l||1)*(e?1:s))}),n.score=i})}function J0(t,e){const n=t.matches;e.matches=[],mt(n)&&n.forEach(i=>{if(!mt(i.indices)||!i.indices.length)return;const{indices:r,value:s}=i;let o={indices:r,value:s};i.key&&(o.key=i.key.src),i.idx>-1&&(o.refIndex=i.idx),e.matches.push(o)})}function Q0(t,e){e.score=t.score}function Z0(t,e,{includeMatches:n=fe.includeMatches,includeScore:i=fe.includeScore}={}){const r=[];return n&&r.push(J0),i&&r.push(Q0),t.map(s=>{const{idx:o}=s,l={item:e[o],refIndex:o};return r.length&&r.forEach(a=>{a(s,l)}),l})}class Mn{constructor(e,n={},i){this.options=xn(xn({},fe),n),this.options.useExtendedSearch,this._keyStore=new E0(this.options.keys),this.setCollection(e,i)}setCollection(e,n){if(this._docs=e,n&&!(n instanceof Xr))throw new Error(y0);this._myIndex=n||Ia(this.options.keys,this._docs,{getFn:this.options.getFn,fieldNormWeight:this.options.fieldNormWeight})}add(e){mt(e)&&(this._docs.push(e),this._myIndex.add(e))}remove(e=()=>!1){const n=[];for(let i=0,r=this._docs.length;i<r;i+=1){const s=this._docs[i];e(s,i)&&(this.removeAt(i),i-=1,r-=1,n.push(s))}return n}removeAt(e){this._docs.splice(e,1),this._myIndex.removeAt(e)}getIndex(){return this._myIndex}search(e,{limit:n=-1}={}){const{includeMatches:i,includeScore:r,shouldSort:s,sortFn:o,ignoreFieldNorm:l}=this.options;let a=Pt(e)?Pt(this._docs[0])?this._searchStringList(e):this._searchObjectList(e):this._searchLogical(e);return X0(a,{ignoreFieldNorm:l}),s&&a.sort(o),ba(n)&&n>-1&&(a=a.slice(0,n)),Z0(a,this._docs,{includeMatches:i,includeScore:r})}_searchStringList(e){const n=Zr(e,this.options),{records:i}=this._myIndex,r=[];return i.forEach(({v:s,i:o,n:l})=>{if(!mt(s))return;const{isMatch:a,score:c,indices:u}=n.searchIn(s);a&&r.push({item:s,idx:o,matches:[{score:c,value:s,norm:l,indices:u}]})}),r}_searchLogical(e){const n=Pa(e,this.options),i=(l,a,c)=>{if(!l.children){const{keyId:d,searcher:f}=l,h=this._findMatches({key:this._keyStore.get(d),value:this._myIndex.getValueForItemAtKeyId(a,d),searcher:f});return h&&h.length?[{idx:c,item:a,matches:h}]:[]}const u=[];for(let d=0,f=l.children.length;d<f;d+=1){const h=l.children[d],m=i(h,a,c);if(m.length)u.push(...m);else if(l.operator===Ui.AND)return[]}return u},r=this._myIndex.records,s={},o=[];return r.forEach(({$:l,i:a})=>{if(mt(l)){let c=i(n,l,a);c.length&&(s[a]||(s[a]={idx:a,item:l,matches:[]},o.push(s[a])),c.forEach(({matches:u})=>{s[a].matches.push(...u)}))}}),o}_searchObjectList(e){const n=Zr(e,this.options),{keys:i,records:r}=this._myIndex,s=[];return r.forEach(({$:o,i:l})=>{if(!mt(o))return;let a=[];i.forEach((c,u)=>{a.push(...this._findMatches({key:c,value:o[u],searcher:n}))}),a.length&&s.push({idx:l,item:o,matches:a})}),s}_findMatches({key:e,value:n,searcher:i}){if(!mt(n))return[];let r=[];if(Ht(n))n.forEach(({v:s,i:o,n:l})=>{if(!mt(s))return;const{isMatch:a,score:c,indices:u}=i.searchIn(s);a&&r.push({score:c,key:e,value:s,idx:o,norm:l,indices:u})});else{const{v:s,n:o}=n,{isMatch:l,score:a,indices:c}=i.searchIn(s);l&&r.push({score:a,key:e,value:s,norm:o,indices:c})}return r}}Mn.version="7.0.0",Mn.createIndex=Ia,Mn.parseIndex=O0,Mn.config=fe,Mn.parseQuery=Pa,W0(K0);var e1=function(){function t(e){this._haystack=[],this._fuseOptions=ct(ct({},e.fuseOptions),{keys:D_([],e.searchFields,!0),includeMatches:!0})}return t.prototype.index=function(e){this._haystack=e,this._fuse&&this._fuse.setCollection(e)},t.prototype.reset=function(){this._haystack=[],this._fuse=void 0},t.prototype.isEmptyIndex=function(){return!this._haystack.length},t.prototype.search=function(e){this._fuse||(this._fuse=new Mn(this._haystack,this._fuseOptions));var n=this._fuse.search(e);return n.map(function(i,r){return{item:i.item,score:i.score||0,rank:r+1}})},t}();function t1(t){return new e1(t)}var n1=function(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0},ns=function(t,e,n){var i=t.dataset,r=e.customProperties,s=e.labelClass,o=e.labelDescription;s&&(i.labelClass=Vi(s).join(" ")),o&&(i.labelDescription=o),n&&r&&(typeof r=="string"?i.customProperties=r:typeof r=="object"&&!n1(r)&&(i.customProperties=JSON.stringify(r)))},La=function(t,e,n){var i=e&&t.querySelector("label[for='".concat(e,"']")),r=i&&i.innerText;r&&n.setAttribute("aria-label",r)},i1={containerOuter:function(t,e,n,i,r,s,o){var l=t.classNames.containerOuter,a=document.createElement("div");return de(a,l),a.dataset.type=s,e&&(a.dir=e),i&&(a.tabIndex=0),n&&(a.setAttribute("role",r?"combobox":"listbox"),r?a.setAttribute("aria-autocomplete","list"):o||La(this._docRoot,this.passedElement.element.id,a),a.setAttribute("aria-haspopup","true"),a.setAttribute("aria-expanded","false")),o&&a.setAttribute("aria-labelledby",o),a},containerInner:function(t){var e=t.classNames.containerInner,n=document.createElement("div");return de(n,e),n},itemList:function(t,e){var n=t.searchEnabled,i=t.classNames,r=i.list,s=i.listSingle,o=i.listItems,l=document.createElement("div");return de(l,r),de(l,e?s:o),this._isSelectElement&&n&&l.setAttribute("role","listbox"),l},placeholder:function(t,e){var n=t.allowHTML,i=t.classNames.placeholder,r=document.createElement("div");return de(r,i),Vt(r,n,e),r},item:function(t,e,n){var i=t.allowHTML,r=t.removeItemButtonAlignLeft,s=t.removeItemIconText,o=t.removeItemLabelText,l=t.classNames,a=l.item,c=l.button,u=l.highlightedState,d=l.itemSelectable,f=l.placeholder,h=sn(e.value),m=document.createElement("div");if(de(m,a),e.labelClass){var g=document.createElement("span");Vt(g,i,e.label),de(g,e.labelClass),m.appendChild(g)}else Vt(m,i,e.label);if(m.dataset.item="",m.dataset.id=e.id,m.dataset.value=h,ns(m,e,!0),(e.disabled||this.containerOuter.isDisabled)&&m.setAttribute("aria-disabled","true"),this._isSelectElement&&(m.setAttribute("aria-selected","true"),m.setAttribute("role","option")),e.placeholder&&(de(m,f),m.dataset.placeholder=""),de(m,e.highlighted?u:d),n){e.disabled&&Tt(m,d),m.dataset.deletable="";var p=document.createElement("button");p.type="button",de(p,c),Vt(p,!0,Kn(s,e.value));var _=Kn(o,e.value);_&&p.setAttribute("aria-label",_),p.dataset.button="",r?m.insertAdjacentElement("afterbegin",p):m.appendChild(p)}return m},choiceList:function(t,e){var n=t.classNames.list,i=document.createElement("div");return de(i,n),e||i.setAttribute("aria-multiselectable","true"),i.setAttribute("role","listbox"),i},choiceGroup:function(t,e){var n=t.allowHTML,i=t.classNames,r=i.group,s=i.groupHeading,o=i.itemDisabled,l=e.id,a=e.label,c=e.disabled,u=sn(a),d=document.createElement("div");de(d,r),c&&de(d,o),d.setAttribute("role","group"),d.dataset.group="",d.dataset.id=l,d.dataset.value=u,c&&d.setAttribute("aria-disabled","true");var f=document.createElement("div");return de(f,s),Vt(f,n,a||""),d.appendChild(f),d},choice:function(t,e,n,i){var r=t.allowHTML,s=t.classNames,o=s.item,l=s.itemChoice,a=s.itemSelectable,c=s.selectedState,u=s.itemDisabled,d=s.description,f=s.placeholder,h=e.label,m=sn(e.value),g=document.createElement("div");g.id=e.elementId,de(g,o),de(g,l),i&&typeof h=="string"&&(h=Wr(r,h),h+=" (".concat(i,")"),h={trusted:h});var p=g;if(e.labelClass){var _=document.createElement("span");Vt(_,r,h),de(_,e.labelClass),p=_,g.appendChild(_)}else Vt(g,r,h);if(e.labelDescription){var w="".concat(e.elementId,"-description");p.setAttribute("aria-describedby",w);var C=document.createElement("span");Vt(C,r,e.labelDescription),C.id=w,de(C,d),g.appendChild(C)}return e.selected&&de(g,c),e.placeholder&&de(g,f),g.setAttribute("role",e.group?"treeitem":"option"),g.dataset.choice="",g.dataset.id=e.id,g.dataset.value=m,n&&(g.dataset.selectText=n),e.group&&(g.dataset.groupId="".concat(e.group.id)),ns(g,e,!1),e.disabled?(de(g,u),g.dataset.choiceDisabled="",g.setAttribute("aria-disabled","true")):(de(g,a),g.dataset.choiceSelectable=""),g},input:function(t,e){var n=t.classNames,i=n.input,r=n.inputCloned,s=t.labelId,o=document.createElement("input");return o.type="search",de(o,i),de(o,r),o.autocomplete="off",o.autocapitalize="off",o.spellcheck=!1,o.setAttribute("aria-autocomplete","list"),e?o.setAttribute("aria-label",e):s||La(this._docRoot,this.passedElement.element.id,o),o},dropdown:function(t){var e=t.classNames,n=e.list,i=e.listDropdown,r=document.createElement("div");return de(r,n),de(r,i),r.setAttribute("aria-expanded","false"),r},notice:function(t,e,n){var i=t.classNames,r=i.item,s=i.itemChoice,o=i.addChoice,l=i.noResults,a=i.noChoices,c=i.notice;n===void 0&&(n=We.generic);var u=document.createElement("div");switch(Vt(u,!0,e),de(u,r),de(u,s),de(u,c),n){case We.addChoice:de(u,o);break;case We.noResults:de(u,l);break;case We.noChoices:de(u,a);break}return n===We.addChoice&&(u.dataset.choiceSelectable="",u.dataset.choice=""),u},option:function(t){var e=sn(t.label),n=new Option(e,t.value,!1,t.selected);return ns(n,t,!0),n.disabled=t.disabled,t.selected&&n.setAttribute("selected",""),n}},r1="-ms-scroll-limit"in document.documentElement.style&&"-ms-ime-align"in document.documentElement.style,s1={},is=function(t){if(t)return t.dataset.id?parseInt(t.dataset.id,10):void 0},Yn="[data-choice-selectable]",o1=function(){function t(e,n){e===void 0&&(e="[data-choice]"),n===void 0&&(n={});var i=this;this.initialisedOK=void 0,this._hasNonChoicePlaceholder=!1,this._lastAddedChoiceId=0,this._lastAddedGroupId=0;var r=t.defaults;this.config=ct(ct(ct({},r.allOptions),r.options),n),R_.forEach(function(_){i.config[_]=ct(ct(ct({},r.allOptions[_]),r.options[_]),n[_])});var s=this.config;s.silent||this._validateConfig();var o=s.shadowRoot||document.documentElement;this._docRoot=o;var l=typeof e=="string"?o.querySelector(e):e;if(!l||typeof l!="object"||!(n0(l)||pa(l)))throw TypeError(!l&&typeof e=="string"?"Selector ".concat(e," failed to find an element"):"Expected one of the following types text|select-one|select-multiple");var a=l.type,c=a===Yt.Text;(c||s.maxItemCount!==1)&&(s.singleModeForMultiSelect=!1),s.singleModeForMultiSelect&&(a=Yt.SelectMultiple);var u=a===Yt.SelectOne,d=a===Yt.SelectMultiple,f=u||d;if(this._elementType=a,this._isTextElement=c,this._isSelectOneElement=u,this._isSelectMultipleElement=d,this._isSelectElement=u||d,this._canAddUserChoices=c&&s.addItems||f&&s.addChoices,typeof s.renderSelectedChoices!="boolean"&&(s.renderSelectedChoices=s.renderSelectedChoices==="always"||u),s.closeDropdownOnSelect==="auto"?s.closeDropdownOnSelect=c||u||s.singleModeForMultiSelect:s.closeDropdownOnSelect=Gn(s.closeDropdownOnSelect),s.placeholder&&(s.placeholderValue?this._hasNonChoicePlaceholder=!0:l.dataset.placeholder&&(this._hasNonChoicePlaceholder=!0,s.placeholderValue=l.dataset.placeholder)),n.addItemFilter&&typeof n.addItemFilter!="function"){var h=n.addItemFilter instanceof RegExp?n.addItemFilter:new RegExp(n.addItemFilter);s.addItemFilter=h.test.bind(h)}if(this._isTextElement)this.passedElement=new t0({element:l,classNames:s.classNames});else{var m=l;this.passedElement=new s0({element:m,classNames:s.classNames,template:function(_){return i._templates.option(_)},extractPlaceholder:s.placeholder&&!this._hasNonChoicePlaceholder})}if(this.initialised=!1,this._store=new u0(s),this._currentValue="",s.searchEnabled=!c&&s.searchEnabled||d,this._canSearch=s.searchEnabled,this._isScrollingOnIe=!1,this._highlightPosition=0,this._wasTap=!0,this._placeholderValue=this._generatePlaceholderValue(),this._baseId=H_(l,"choices-"),this._direction=l.dir,!this._direction){var g=window.getComputedStyle(l).direction,p=window.getComputedStyle(document.documentElement).direction;g!==p&&(this._direction=g)}if(this._idNames={itemChoice:"item-choice"},this._templates=r.templates,this._render=this._render.bind(this),this._onFocus=this._onFocus.bind(this),this._onBlur=this._onBlur.bind(this),this._onKeyUp=this._onKeyUp.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onInput=this._onInput.bind(this),this._onClick=this._onClick.bind(this),this._onTouchMove=this._onTouchMove.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._onMouseDown=this._onMouseDown.bind(this),this._onMouseOver=this._onMouseOver.bind(this),this._onFormReset=this._onFormReset.bind(this),this._onSelectKey=this._onSelectKey.bind(this),this._onEnterKey=this._onEnterKey.bind(this),this._onEscapeKey=this._onEscapeKey.bind(this),this._onDirectionKey=this._onDirectionKey.bind(this),this._onDeleteKey=this._onDeleteKey.bind(this),this.passedElement.isActive){s.silent||console.warn("Trying to initialise Choices on element already initialised",{element:e}),this.initialised=!0,this.initialisedOK=!1;return}this.init(),this._initialItems=this._store.items.map(function(_){return _.value})}return Object.defineProperty(t,"defaults",{get:function(){return Object.preventExtensions({get options(){return s1},get allOptions(){return ga},get templates(){return i1}})},enumerable:!1,configurable:!0}),t.prototype.init=function(){if(!(this.initialised||this.initialisedOK!==void 0)){this._searcher=t1(this.config),this._loadChoices(),this._createTemplates(),this._createElements(),this._createStructure(),this._isTextElement&&!this.config.addItems||this.passedElement.element.hasAttribute("disabled")||this.passedElement.element.closest("fieldset:disabled")?this.disable():(this.enable(),this._addEventListeners()),this._initStore(),this.initialised=!0,this.initialisedOK=!0;var e=this.config.callbackOnInit;typeof e=="function"&&e.call(this)}},t.prototype.destroy=function(){this.initialised&&(this._removeEventListeners(),this.passedElement.reveal(),this.containerOuter.unwrap(this.passedElement.element),this._store._listeners=[],this.clearStore(!1),this._stopSearch(),this._templates=t.defaults.templates,this.initialised=!1,this.initialisedOK=void 0)},t.prototype.enable=function(){return this.passedElement.isDisabled&&this.passedElement.enable(),this.containerOuter.isDisabled&&(this._addEventListeners(),this.input.enable(),this.containerOuter.enable()),this},t.prototype.disable=function(){return this.passedElement.isDisabled||this.passedElement.disable(),this.containerOuter.isDisabled||(this._removeEventListeners(),this.input.disable(),this.containerOuter.disable()),this},t.prototype.highlightItem=function(e,n){if(n===void 0&&(n=!0),!e||!e.id)return this;var i=this._store.items.find(function(r){return r.id===e.id});return!i||i.highlighted?this:(this._store.dispatch(ji(i,!0)),n&&this.passedElement.triggerEvent(ut.highlightItem,this._getChoiceForOutput(i)),this)},t.prototype.unhighlightItem=function(e,n){if(n===void 0&&(n=!0),!e||!e.id)return this;var i=this._store.items.find(function(r){return r.id===e.id});return!i||!i.highlighted?this:(this._store.dispatch(ji(i,!1)),n&&this.passedElement.triggerEvent(ut.unhighlightItem,this._getChoiceForOutput(i)),this)},t.prototype.highlightAll=function(){var e=this;return this._store.withTxn(function(){e._store.items.forEach(function(n){n.highlighted||(e._store.dispatch(ji(n,!0)),e.passedElement.triggerEvent(ut.highlightItem,e._getChoiceForOutput(n)))})}),this},t.prototype.unhighlightAll=function(){var e=this;return this._store.withTxn(function(){e._store.items.forEach(function(n){n.highlighted&&(e._store.dispatch(ji(n,!1)),e.passedElement.triggerEvent(ut.highlightItem,e._getChoiceForOutput(n)))})}),this},t.prototype.removeActiveItemsByValue=function(e){var n=this;return this._store.withTxn(function(){n._store.items.filter(function(i){return i.value===e}).forEach(function(i){return n._removeItem(i)})}),this},t.prototype.removeActiveItems=function(e){var n=this;return this._store.withTxn(function(){n._store.items.filter(function(i){var r=i.id;return r!==e}).forEach(function(i){return n._removeItem(i)})}),this},t.prototype.removeHighlightedItems=function(e){var n=this;return e===void 0&&(e=!1),this._store.withTxn(function(){n._store.highlightedActiveItems.forEach(function(i){n._removeItem(i),e&&n._triggerChange(i.value)})}),this},t.prototype.showDropdown=function(e){var n=this;return this.dropdown.isActive?this:(e===void 0&&(e=!this._canSearch),requestAnimationFrame(function(){n.dropdown.show();var i=n.dropdown.element.getBoundingClientRect();n.containerOuter.open(i.bottom,i.height),e||n.input.focus(),n.passedElement.triggerEvent(ut.showDropdown)}),this)},t.prototype.hideDropdown=function(e){var n=this;return this.dropdown.isActive?(requestAnimationFrame(function(){n.dropdown.hide(),n.containerOuter.close(),!e&&n._canSearch&&(n.input.removeActiveDescendant(),n.input.blur()),n.passedElement.triggerEvent(ut.hideDropdown)}),this):this},t.prototype.getValue=function(e){var n=this,i=this._store.items.map(function(r){return e?r.value:n._getChoiceForOutput(r)});return this._isSelectOneElement||this.config.singleModeForMultiSelect?i[0]:i},t.prototype.setValue=function(e){var n=this;return this.initialisedOK?(this._store.withTxn(function(){e.forEach(function(i){i&&n._addChoice(Ot(i,!1))})}),this._searcher.reset(),this):(this._warnChoicesInitFailed("setValue"),this)},t.prototype.setChoiceByValue=function(e){var n=this;return this.initialisedOK?this._isTextElement?this:(this._store.withTxn(function(){var i=Array.isArray(e)?e:[e];i.forEach(function(r){return n._findAndSelectChoiceByValue(r)}),n.unhighlightAll()}),this._searcher.reset(),this):(this._warnChoicesInitFailed("setChoiceByValue"),this)},t.prototype.setChoices=function(e,n,i,r,s,o){var l=this;if(e===void 0&&(e=[]),n===void 0&&(n="value"),i===void 0&&(i="label"),r===void 0&&(r=!1),s===void 0&&(s=!0),o===void 0&&(o=!1),!this.initialisedOK)return this._warnChoicesInitFailed("setChoices"),this;if(!this._isSelectElement)throw new TypeError("setChoices can't be used with INPUT based Choices");if(typeof n!="string"||!n)throw new TypeError("value parameter must be a name of 'value' field in passed objects");if(typeof e=="function"){var a=e(this);if(typeof Promise=="function"&&a instanceof Promise)return new Promise(function(c){return requestAnimationFrame(c)}).then(function(){return l._handleLoadingState(!0)}).then(function(){return a}).then(function(c){return l.setChoices(c,n,i,r,s,o)}).catch(function(c){l.config.silent||console.error(c)}).then(function(){return l._handleLoadingState(!1)}).then(function(){return l});if(!Array.isArray(a))throw new TypeError(".setChoices first argument function must return either array of choices or Promise, got: ".concat(typeof a));return this.setChoices(a,n,i,!1)}if(!Array.isArray(e))throw new TypeError(".setChoices must be called either with array of choices with a function resulting into Promise of array of choices");return this.containerOuter.removeLoadingState(),this._store.withTxn(function(){s&&(l._isSearching=!1),r&&l.clearChoices(!0,o);var c=n==="value",u=i==="label";e.forEach(function(d){if("choices"in d){var f=d;u||(f=ct(ct({},f),{label:f[i]})),l._addGroup(Ot(f,!0))}else{var h=d;(!u||!c)&&(h=ct(ct({},h),{value:h[n],label:h[i]}));var m=Ot(h,!1);l._addChoice(m),m.placeholder&&!l._hasNonChoicePlaceholder&&(l._placeholderValue=ua(m.label))}}),l.unhighlightAll()}),this._searcher.reset(),this},t.prototype.refresh=function(e,n,i){var r=this;return e===void 0&&(e=!1),n===void 0&&(n=!1),i===void 0&&(i=!1),this._isSelectElement?(this._store.withTxn(function(){var s=r.passedElement.optionsAsChoices(),o={};i||r._store.items.forEach(function(a){a.id&&a.active&&a.selected&&(o[a.value]=!0)}),r.clearStore(!1);var l=function(a){i?r._store.dispatch(la(a)):o[a.value]&&(a.selected=!0)};s.forEach(function(a){if("choices"in a){a.choices.forEach(l);return}l(a)}),r._addPredefinedChoices(s,n,e),r._isSearching&&r._searchChoices(r.input.value)}),this):(this.config.silent||console.warn("refresh method can only be used on choices backed by a <select> element"),this)},t.prototype.removeChoice=function(e){var n=this._store.choices.find(function(i){return i.value===e});return n?(this._clearNotice(),this._store.dispatch($_(n)),this._searcher.reset(),n.selected&&this.passedElement.triggerEvent(ut.removeItem,this._getChoiceForOutput(n)),this):this},t.prototype.clearChoices=function(e,n){var i=this;return e===void 0&&(e=!0),n===void 0&&(n=!1),e&&(n?this.passedElement.element.replaceChildren(""):this.passedElement.element.querySelectorAll(":not([selected])").forEach(function(r){r.remove()})),this.itemList.element.replaceChildren(""),this.choiceList.element.replaceChildren(""),this._clearNotice(),this._store.withTxn(function(){var r=n?[]:i._store.items;i._store.reset(),r.forEach(function(s){i._store.dispatch(sa(s)),i._store.dispatch(oa(s))})}),this._searcher.reset(),this},t.prototype.clearStore=function(e){return e===void 0&&(e=!0),this.clearChoices(e,!0),this._stopSearch(),this._lastAddedChoiceId=0,this._lastAddedGroupId=0,this},t.prototype.clearInput=function(){var e=!this._isSelectOneElement;return this.input.clear(e),this._stopSearch(),this},t.prototype._validateConfig=function(){var e=this.config,n=Y_(e,ga);n.length&&console.warn("Unknown config option(s) passed",n.join(", ")),e.allowHTML&&e.allowHtmlUserInput&&(e.addItems&&console.warn("Warning: allowHTML/allowHtmlUserInput/addItems all being true is strongly not recommended and may lead to XSS attacks"),e.addChoices&&console.warn("Warning: allowHTML/allowHtmlUserInput/addChoices all being true is strongly not recommended and may lead to XSS attacks"))},t.prototype._render=function(e){e===void 0&&(e={choices:!0,groups:!0,items:!0}),!this._store.inTxn()&&(this._isSelectElement&&(e.choices||e.groups)&&this._renderChoices(),e.items&&this._renderItems())},t.prototype._renderChoices=function(){var e=this;if(this._canAddItems()){var n=this,i=n.config,r=n._isSearching,s=this._store,o=s.activeGroups,l=s.activeChoices,a=0;if(r&&i.searchResultLimit>0?a=i.searchResultLimit:i.renderChoiceLimit>0&&(a=i.renderChoiceLimit),this._isSelectElement){var c=l.filter(function(m){return!m.element});c.length&&this.passedElement.addOptions(c)}var u=document.createDocumentFragment(),d=function(m){return m.filter(function(g){return!g.placeholder&&(r?!!g.rank:i.renderSelectedChoices||!g.selected)})},f=!1,h=function(m,g,p){r?m.sort(W_):i.shouldSort&&m.sort(i.sorter);var _=m.length;_=!g&&a&&_>a?a:_,_--,m.every(function(w,C){var b=w.choiceEl||e._templates.choice(i,w,i.itemSelectText,p);return w.choiceEl=b,u.appendChild(b),(r||!w.selected)&&(f=!0),C<_})};l.length&&(i.resetScrollPosition&&requestAnimationFrame(function(){return e.choiceList.scrollToTop()}),!this._hasNonChoicePlaceholder&&!r&&this._isSelectOneElement&&h(l.filter(function(m){return m.placeholder&&!m.group}),!1,void 0),o.length&&!r?(i.shouldSort&&o.sort(i.sorter),h(l.filter(function(m){return!m.placeholder&&!m.group}),!1,void 0),o.forEach(function(m){var g=d(m.choices);if(g.length){if(m.label){var p=m.groupEl||e._templates.choiceGroup(e.config,m);m.groupEl=p,p.remove(),u.appendChild(p)}h(g,!0,i.appendGroupInSearch&&r?m.label:void 0)}})):h(d(l),!1,void 0)),!f&&(r||!u.children.length||!i.renderSelectedChoices)&&(this._notice||(this._notice={text:ca(r?i.noResultsText:i.noChoicesText),type:r?We.noResults:We.noChoices}),u.replaceChildren("")),this._renderNotice(u),this.choiceList.element.replaceChildren(u),f&&this._highlightChoice()}},t.prototype._renderItems=function(){var e=this,n=this._store.items||[],i=this.itemList.element,r=this.config,s=document.createDocumentFragment(),o=function(d){return i.querySelector('[data-item][data-id="'.concat(d.id,'"]'))},l=function(d){var f=d.itemEl;f&&f.parentElement||(f=o(d)||e._templates.item(r,d,r.removeItemButton),d.itemEl=f,s.appendChild(f))};n.forEach(l);var a=!!s.childNodes.length;if(this._isSelectOneElement){var c=i.children.length;if(a||c>1){var u=i.querySelector(Wn(r.classNames.placeholder));u&&u.remove()}else!a&&!c&&this._placeholderValue&&(a=!0,l(Ot({selected:!0,value:"",label:this._placeholderValue,placeholder:!0},!1)))}a&&(i.append(s),r.shouldSortItems&&!this._isSelectOneElement&&(n.sort(r.sorter),n.forEach(function(d){var f=o(d);f&&(f.remove(),s.append(f))}),i.append(s))),this._isTextElement&&(this.passedElement.value=n.map(function(d){var f=d.value;return f}).join(r.delimiter))},t.prototype._displayNotice=function(e,n,i){i===void 0&&(i=!0);var r=this._notice;if(r&&(r.type===n&&r.text===e||r.type===We.addChoice&&(n===We.noResults||n===We.noChoices))){i&&this.showDropdown(!0);return}this._clearNotice(),this._notice=e?{text:e,type:n}:void 0,this._renderNotice(),i&&e&&this.showDropdown(!0)},t.prototype._clearNotice=function(){if(this._notice){var e=this.choiceList.element.querySelector(Wn(this.config.classNames.notice));e&&e.remove(),this._notice=void 0}},t.prototype._renderNotice=function(e){var n=this._notice;if(n){var i=this._templates.notice(this.config,n.text,n.type);e?e.append(i):this.choiceList.prepend(i)}},t.prototype._getChoiceForOutput=function(e,n){return{id:e.id,highlighted:e.highlighted,labelClass:e.labelClass,labelDescription:e.labelDescription,customProperties:e.customProperties,disabled:e.disabled,active:e.active,label:e.label,placeholder:e.placeholder,value:e.value,groupValue:e.group?e.group.label:void 0,element:e.element,keyCode:n}},t.prototype._triggerChange=function(e){e!=null&&this.passedElement.triggerEvent(ut.change,{value:e})},t.prototype._handleButtonAction=function(e){var n=this,i=this._store.items;if(!(!i.length||!this.config.removeItems||!this.config.removeItemButton)){var r=e&&is(e.parentElement),s=r&&i.find(function(o){return o.id===r});s&&this._store.withTxn(function(){if(n._removeItem(s),n._triggerChange(s.value),n._isSelectOneElement&&!n._hasNonChoicePlaceholder){var o=(n.config.shouldSort?n._store.choices.reverse():n._store.choices).find(function(l){return l.placeholder});o&&(n._addItem(o),n.unhighlightAll(),o.value&&n._triggerChange(o.value))}})}},t.prototype._handleItemAction=function(e,n){var i=this;n===void 0&&(n=!1);var r=this._store.items;if(!(!r.length||!this.config.removeItems||this._isSelectOneElement)){var s=is(e);s&&(r.forEach(function(o){o.id===s&&!o.highlighted?i.highlightItem(o):!n&&o.highlighted&&i.unhighlightItem(o)}),this.input.focus())}},t.prototype._handleChoiceAction=function(e){var n=this,i=is(e),r=i&&this._store.getChoiceById(i);if(!r||r.disabled)return!1;var s=this.dropdown.isActive;if(!r.selected){if(!this._canAddItems())return!0;this._store.withTxn(function(){n._addItem(r,!0,!0),n.clearInput(),n.unhighlightAll()}),this._triggerChange(r.value)}return s&&this.config.closeDropdownOnSelect&&(this.hideDropdown(!0),this.containerOuter.element.focus()),!0},t.prototype._handleBackspace=function(e){var n=this.config;if(!(!n.removeItems||!e.length)){var i=e[e.length-1],r=e.some(function(s){return s.highlighted});n.editItems&&!r&&i?(this.input.value=i.value,this.input.setWidth(),this._removeItem(i),this._triggerChange(i.value)):(r||this.highlightItem(i,!1),this.removeHighlightedItems(!0))}},t.prototype._loadChoices=function(){var e,n=this,i=this.config;if(this._isTextElement){if(this._presetChoices=i.items.map(function(o){return Ot(o,!1)}),this.passedElement.value){var r=this.passedElement.value.split(i.delimiter).map(function(o){return Ot(o,!1,n.config.allowHtmlUserInput)});this._presetChoices=this._presetChoices.concat(r)}this._presetChoices.forEach(function(o){o.selected=!0})}else if(this._isSelectElement){this._presetChoices=i.choices.map(function(o){return Ot(o,!0)});var s=this.passedElement.optionsAsChoices();s&&(e=this._presetChoices).push.apply(e,s)}},t.prototype._handleLoadingState=function(e){e===void 0&&(e=!0);var n=this.itemList.element;e?(this.disable(),this.containerOuter.addLoadingState(),this._isSelectOneElement?n.replaceChildren(this._templates.placeholder(this.config,this.config.loadingText)):this.input.placeholder=this.config.loadingText):(this.enable(),this.containerOuter.removeLoadingState(),this._isSelectOneElement?(n.replaceChildren(""),this._render()):this.input.placeholder=this._placeholderValue||"")},t.prototype._handleSearch=function(e){if(this.input.isFocussed)if(e!==null&&typeof e<"u"&&e.length>=this.config.searchFloor){var n=this.config.searchChoices?this._searchChoices(e):0;n!==null&&this.passedElement.triggerEvent(ut.search,{value:e,resultCount:n})}else this._store.choices.some(function(i){return!i.active})&&this._stopSearch()},t.prototype._canAddItems=function(){var e=this.config,n=e.maxItemCount,i=e.maxItemText;return!e.singleModeForMultiSelect&&n>0&&n<=this._store.items.length?(this.choiceList.element.replaceChildren(""),this._notice=void 0,this._displayNotice(typeof i=="function"?i(n):i,We.addChoice),!1):(this._notice&&this._notice.type===We.addChoice&&this._clearNotice(),!0)},t.prototype._canCreateItem=function(e){var n=this.config,i=!0,r="";if(i&&typeof n.addItemFilter=="function"&&!n.addItemFilter(e)&&(i=!1,r=Kn(n.customAddItemText,e)),i){var s=this._store.choices.find(function(o){return n.valueComparer(o.value,e)});if(s){if(this._isSelectElement)return this._displayNotice("",We.addChoice),!1;n.duplicateItemsAllowed||(i=!1,r=Kn(n.uniqueItemText,e))}}return i&&(r=Kn(n.addItemText,e)),r&&this._displayNotice(r,We.addChoice),i},t.prototype._searchChoices=function(e){var n=e.trim().replace(/\s{2,}/," ");if(!n.length||n===this._currentValue)return null;var i=this._searcher;i.isEmptyIndex()&&i.index(this._store.searchableChoices);var r=i.search(n);this._currentValue=n,this._highlightPosition=0,this._isSearching=!0;var s=this._notice,o=s&&s.type;return o!==We.addChoice&&(r.length?this._clearNotice():this._displayNotice(ca(this.config.noResultsText),We.noResults)),this._store.dispatch(z_(r)),r.length},t.prototype._stopSearch=function(){this._isSearching&&(this._currentValue="",this._isSearching=!1,this._clearNotice(),this._store.dispatch(j_(!0)),this.passedElement.triggerEvent(ut.search,{value:"",resultCount:0}))},t.prototype._addEventListeners=function(){var e=this._docRoot,n=this.containerOuter.element,i=this.input.element;e.addEventListener("touchend",this._onTouchEnd,!0),n.addEventListener("keydown",this._onKeyDown,!0),n.addEventListener("mousedown",this._onMouseDown,!0),e.addEventListener("click",this._onClick,{passive:!0}),e.addEventListener("touchmove",this._onTouchMove,{passive:!0}),this.dropdown.element.addEventListener("mouseover",this._onMouseOver,{passive:!0}),this._isSelectOneElement&&(n.addEventListener("focus",this._onFocus,{passive:!0}),n.addEventListener("blur",this._onBlur,{passive:!0})),i.addEventListener("keyup",this._onKeyUp,{passive:!0}),i.addEventListener("input",this._onInput,{passive:!0}),i.addEventListener("focus",this._onFocus,{passive:!0}),i.addEventListener("blur",this._onBlur,{passive:!0}),i.form&&i.form.addEventListener("reset",this._onFormReset,{passive:!0}),this.input.addEventListeners()},t.prototype._removeEventListeners=function(){var e=this._docRoot,n=this.containerOuter.element,i=this.input.element;e.removeEventListener("touchend",this._onTouchEnd,!0),n.removeEventListener("keydown",this._onKeyDown,!0),n.removeEventListener("mousedown",this._onMouseDown,!0),e.removeEventListener("click",this._onClick),e.removeEventListener("touchmove",this._onTouchMove),this.dropdown.element.removeEventListener("mouseover",this._onMouseOver),this._isSelectOneElement&&(n.removeEventListener("focus",this._onFocus),n.removeEventListener("blur",this._onBlur)),i.removeEventListener("keyup",this._onKeyUp),i.removeEventListener("input",this._onInput),i.removeEventListener("focus",this._onFocus),i.removeEventListener("blur",this._onBlur),i.form&&i.form.removeEventListener("reset",this._onFormReset),this.input.removeEventListeners()},t.prototype._onKeyDown=function(e){var n=e.keyCode,i=this.dropdown.isActive,r=e.key.length===1||e.key.length===2&&e.key.charCodeAt(0)>=55296||e.key==="Unidentified";switch(!this._isTextElement&&!i&&n!==Je.ESC_KEY&&n!==Je.TAB_KEY&&n!==Je.SHIFT_KEY&&(this.showDropdown(),!this.input.isFocussed&&r&&(this.input.value+=e.key,e.key===" "&&e.preventDefault())),n){case Je.A_KEY:return this._onSelectKey(e,this.itemList.element.hasChildNodes());case Je.ENTER_KEY:return this._onEnterKey(e,i);case Je.ESC_KEY:return this._onEscapeKey(e,i);case Je.UP_KEY:case Je.PAGE_UP_KEY:case Je.DOWN_KEY:case Je.PAGE_DOWN_KEY:return this._onDirectionKey(e,i);case Je.DELETE_KEY:case Je.BACK_KEY:return this._onDeleteKey(e,this._store.items,this.input.isFocussed)}},t.prototype._onKeyUp=function(){this._canSearch=this.config.searchEnabled},t.prototype._onInput=function(){var e=this.input.value;if(!e){this._isTextElement?this.hideDropdown(!0):this._stopSearch();return}this._canAddItems()&&(this._canSearch&&this._handleSearch(e),this._canAddUserChoices&&(this._canCreateItem(e),this._isSelectElement&&(this._highlightPosition=0,this._highlightChoice())))},t.prototype._onSelectKey=function(e,n){if((e.ctrlKey||e.metaKey)&&n){this._canSearch=!1;var i=this.config.removeItems&&!this.input.value&&this.input.element===document.activeElement;i&&this.highlightAll()}},t.prototype._onEnterKey=function(e,n){var i=this,r=this.input.value,s=e.target;if(e.preventDefault(),s&&s.hasAttribute("data-button")){this._handleButtonAction(s);return}if(!n){(this._isSelectElement||this._notice)&&this.showDropdown();return}var o=this.dropdown.element.querySelector(Wn(this.config.classNames.highlightedState));if(!(o&&this._handleChoiceAction(o))){if(!s||!r){this.hideDropdown(!0);return}if(this._canAddItems()){var l=!1;this._store.withTxn(function(){if(l=i._findAndSelectChoiceByValue(r,!0),!l){if(!i._canAddUserChoices||!i._canCreateItem(r))return;i._addChoice(Ot(r,!1,i.config.allowHtmlUserInput),!0,!0),l=!0}i.clearInput(),i.unhighlightAll()}),l&&(this._triggerChange(r),this.config.closeDropdownOnSelect&&this.hideDropdown(!0))}}},t.prototype._onEscapeKey=function(e,n){n&&(e.stopPropagation(),this.hideDropdown(!0),this._stopSearch(),this.containerOuter.element.focus())},t.prototype._onDirectionKey=function(e,n){var i=e.keyCode;if(n||this._isSelectOneElement){this.showDropdown(),this._canSearch=!1;var r=i===Je.DOWN_KEY||i===Je.PAGE_DOWN_KEY?1:-1,s=e.metaKey||i===Je.PAGE_DOWN_KEY||i===Je.PAGE_UP_KEY,o=void 0;if(s)r>0?o=this.dropdown.element.querySelector("".concat(Yn,":last-of-type")):o=this.dropdown.element.querySelector(Yn);else{var l=this.dropdown.element.querySelector(Wn(this.config.classNames.highlightedState));l?o=U_(l,Yn,r):o=this.dropdown.element.querySelector(Yn)}o&&(B_(o,this.choiceList.element,r)||this.choiceList.scrollToChildElement(o,r),this._highlightChoice(o)),e.preventDefault()}},t.prototype._onDeleteKey=function(e,n,i){!this._isSelectOneElement&&!e.target.value&&i&&(this._handleBackspace(n),e.preventDefault())},t.prototype._onTouchMove=function(){this._wasTap&&(this._wasTap=!1)},t.prototype._onTouchEnd=function(e){var n=(e||e.touches[0]).target,i=this._wasTap&&this.containerOuter.element.contains(n);if(i){var r=n===this.containerOuter.element||n===this.containerInner.element;r&&(this._isTextElement?this.input.focus():this._isSelectMultipleElement&&this.showDropdown()),e.stopPropagation()}this._wasTap=!0},t.prototype._onMouseDown=function(e){var n=e.target;if(n instanceof HTMLElement){if(r1&&this.choiceList.element.contains(n)){var i=this.choiceList.element.firstElementChild;this._isScrollingOnIe=this._direction==="ltr"?e.offsetX>=i.offsetWidth:e.offsetX<i.offsetLeft}if(n!==this.input.element){var r=n.closest("[data-button],[data-item],[data-choice]");r instanceof HTMLElement&&("button"in r.dataset?this._handleButtonAction(r):"item"in r.dataset?this._handleItemAction(r,e.shiftKey):"choice"in r.dataset&&this._handleChoiceAction(r)),e.preventDefault()}}},t.prototype._onMouseOver=function(e){var n=e.target;n instanceof HTMLElement&&"choice"in n.dataset&&this._highlightChoice(n)},t.prototype._onClick=function(e){var n=e.target,i=this.containerOuter,r=i.element.contains(n);r?!this.dropdown.isActive&&!i.isDisabled?this._isTextElement?document.activeElement!==this.input.element&&this.input.focus():(this.showDropdown(),i.element.focus()):this._isSelectOneElement&&n!==this.input.element&&!this.dropdown.element.contains(n)&&this.hideDropdown():(i.removeFocusState(),this.hideDropdown(!0),this.unhighlightAll())},t.prototype._onFocus=function(e){var n=e.target,i=this.containerOuter,r=n&&i.element.contains(n);if(r){var s=n===this.input.element;this._isTextElement?s&&i.addFocusState():this._isSelectMultipleElement?s&&(this.showDropdown(!0),i.addFocusState()):(i.addFocusState(),s&&this.showDropdown(!0))}},t.prototype._onBlur=function(e){var n=e.target,i=this.containerOuter,r=n&&i.element.contains(n);r&&!this._isScrollingOnIe?n===this.input.element?(i.removeFocusState(),this.hideDropdown(!0),(this._isTextElement||this._isSelectMultipleElement)&&this.unhighlightAll()):n===this.containerOuter.element&&(i.removeFocusState(),this._canSearch||this.hideDropdown(!0)):(this._isScrollingOnIe=!1,this.input.element.focus())},t.prototype._onFormReset=function(){var e=this;this._store.withTxn(function(){e.clearInput(),e.hideDropdown(),e.refresh(!1,!1,!0),e._initialItems.length&&e.setChoiceByValue(e._initialItems)})},t.prototype._highlightChoice=function(e){e===void 0&&(e=null);var n=Array.from(this.dropdown.element.querySelectorAll(Yn));if(n.length){var i=e,r=this.config.classNames.highlightedState,s=Array.from(this.dropdown.element.querySelectorAll(Wn(r)));s.forEach(function(o){Tt(o,r),o.setAttribute("aria-selected","false")}),i?this._highlightPosition=n.indexOf(i):(n.length>this._highlightPosition?i=n[this._highlightPosition]:i=n[n.length-1],i||(i=n[0])),de(i,r),i.setAttribute("aria-selected","true"),this.passedElement.triggerEvent(ut.highlightChoice,{el:i}),this.dropdown.isActive&&(this.input.setActiveDescendant(i.id),this.containerOuter.setActiveDescendant(i.id))}},t.prototype._addItem=function(e,n,i){if(n===void 0&&(n=!0),i===void 0&&(i=!1),!e.id)throw new TypeError("item.id must be set before _addItem is called for a choice/item");(this.config.singleModeForMultiSelect||this._isSelectOneElement)&&this.removeActiveItems(e.id),this._store.dispatch(oa(e)),n&&(this.passedElement.triggerEvent(ut.addItem,this._getChoiceForOutput(e)),i&&this.passedElement.triggerEvent(ut.choice,this._getChoiceForOutput(e)))},t.prototype._removeItem=function(e){if(e.id){this._store.dispatch(la(e));var n=this._notice;n&&n.type===We.noChoices&&this._clearNotice(),this.passedElement.triggerEvent(ut.removeItem,this._getChoiceForOutput(e))}},t.prototype._addChoice=function(e,n,i){if(n===void 0&&(n=!0),i===void 0&&(i=!1),e.id)throw new TypeError("Can not re-add a choice which has already been added");var r=this.config;if(!(!r.duplicateItemsAllowed&&this._store.choices.find(function(l){return r.valueComparer(l.value,e.value)}))){this._lastAddedChoiceId++,e.id=this._lastAddedChoiceId,e.elementId="".concat(this._baseId,"-").concat(this._idNames.itemChoice,"-").concat(e.id);var s=r.prependValue,o=r.appendValue;s&&(e.value=s+e.value),o&&(e.value+=o.toString()),(s||o)&&e.element&&(e.element.value=e.value),this._clearNotice(),this._store.dispatch(sa(e)),e.selected&&this._addItem(e,n,i)}},t.prototype._addGroup=function(e,n){var i=this;if(n===void 0&&(n=!0),e.id)throw new TypeError("Can not re-add a group which has already been added");this._store.dispatch(F_(e)),e.choices&&(this._lastAddedGroupId++,e.id=this._lastAddedGroupId,e.choices.forEach(function(r){r.group=e,e.disabled&&(r.disabled=!0),i._addChoice(r,n)}))},t.prototype._createTemplates=function(){var e=this,n=this.config.callbackOnCreateTemplates,i={};typeof n=="function"&&(i=n.call(this,q_,Wr,Vi));var r={};Object.keys(this._templates).forEach(function(s){s in i?r[s]=i[s].bind(e):r[s]=e._templates[s].bind(e)}),this._templates=r},t.prototype._createElements=function(){var e=this._templates,n=this,i=n.config,r=n._isSelectOneElement,s=i.position,o=i.classNames,l=this._elementType;this.containerOuter=new fa({element:e.containerOuter(i,this._direction,this._isSelectElement,r,i.searchEnabled,l,i.labelId),classNames:o,type:l,position:s}),this.containerInner=new fa({element:e.containerInner(i),classNames:o,type:l,position:s}),this.input=new Z_({element:e.input(i,this._placeholderValue),classNames:o,type:l,preventPaste:!i.paste}),this.choiceList=new ha({element:e.choiceList(i,r)}),this.itemList=new ha({element:e.itemList(i,r)}),this.dropdown=new Q_({element:e.dropdown(i),classNames:o,type:l})},t.prototype._createStructure=function(){var e=this,n=e.containerInner,i=e.containerOuter,r=e.passedElement,s=this.dropdown.element;r.conceal(),n.wrap(r.element),i.wrap(n.element),this._isSelectOneElement?this.input.placeholder=this.config.searchPlaceholderValue||"":(this._placeholderValue&&(this.input.placeholder=this._placeholderValue),this.input.setWidth()),i.element.appendChild(n.element),i.element.appendChild(s),n.element.appendChild(this.itemList.element),s.appendChild(this.choiceList.element),this._isSelectOneElement?this.config.searchEnabled&&s.insertBefore(this.input.element,s.firstChild):n.element.appendChild(this.input.element),this._highlightPosition=0,this._isSearching=!1},t.prototype._initStore=function(){var e=this;this._store.subscribe(this._render).withTxn(function(){e._addPredefinedChoices(e._presetChoices,e._isSelectOneElement&&!e._hasNonChoicePlaceholder,!1)}),(!this._store.choices.length||this._isSelectOneElement&&this._hasNonChoicePlaceholder)&&this._render()},t.prototype._addPredefinedChoices=function(e,n,i){var r=this;if(n===void 0&&(n=!1),i===void 0&&(i=!0),n){var s=e.findIndex(function(o){return o.selected})===-1;s&&e.some(function(o){return o.disabled||"choices"in o?!1:(o.selected=!0,!0)})}e.forEach(function(o){"choices"in o?r._isSelectElement&&r._addGroup(o,i):r._addChoice(o,i)})},t.prototype._findAndSelectChoiceByValue=function(e,n){var i=this;n===void 0&&(n=!1);var r=this._store.choices.find(function(s){return i.config.valueComparer(s.value,e)});return r&&!r.disabled&&!r.selected?(this._addItem(r,!0,n),!0):!1},t.prototype._generatePlaceholderValue=function(){var e=this.config;if(!e.placeholder)return null;if(this._hasNonChoicePlaceholder)return e.placeholderValue;if(this._isSelectElement){var n=this.passedElement.placeholderOption;return n?n.text:null}return null},t.prototype._warnChoicesInitFailed=function(e){if(!this.config.silent)if(this.initialised){if(!this.initialisedOK)throw new TypeError("".concat(e," called for an element which has multiple instances of Choices initialised on it"))}else throw new TypeError("".concat(e," called on a non-initialised instance of Choices"))},t.version="11.1.0",t}();const My="",Ay="";function Da(t){let e,n;return{c(){e=k("label"),n=ne(t[2]),v(e,"for",t[4])},m(i,r){j(i,e,r),y(e,n)},p(i,r){r&4&&me(n,i[2])},d(i){i&&$(e)}}}function l1(t){let e;return{c(){e=k("select"),v(e,"id",t[4]),v(e,"name",t[4]),v(e,"aria-label",t[2]),v(e,"class","m-1")},m(n,i){j(n,e,i)},p(n,i){i&4&&v(e,"aria-label",n[2])},i:X,o:X,d(n){n&&$(e)}}}function a1(t){let e,n,i,r=t[3].length&&Ra(t);return{c(){r&&r.c(),e=q(),n=k("select"),v(n,"id",t[4]),v(n,"name",t[4]),v(n,"aria-label",t[2]),v(n,"class","m-1"),n.multiple=!0},m(s,o){r&&r.m(s,o),j(s,e,o),j(s,n,o),i=!0},p(s,o){s[3].length?r?(r.p(s,o),o&8&&V(r,1)):(r=Ra(s),r.c(),V(r,1),r.m(e.parentNode,e)):r&&(Ee(),K(r,1,1,()=>{r=null}),Ce()),(!i||o&4)&&v(n,"aria-label",s[2])},i(s){i||(V(r),i=!0)},o(s){K(r),i=!1},d(s){r&&r.d(s),s&&$(e),s&&$(n)}}}function Ra(t){let e,n,i=t[3].length+"",r,s,o,l;return o=new zi({props:{targetHtmlId:t[5],tooltipText:`${t[3].length}
                                    ${W==="fr"&&t[3].length>1?"valeurs sélectionnées":W==="fr"&&t[3].length===1?"valeur sélectionnée":W==="en"&&t[3].length>1?"selected values":"selected value"}`}}),{c(){e=k("span"),n=k("span"),r=ne(i),s=q(),le(o.$$.fragment),v(n,"id",t[5]),v(n,"class","input-dropdown-count tag m-1 svelte-1epfuu8"),v(e,"class","is-relative")},m(a,c){j(a,e,c),y(e,n),y(n,r),y(e,s),se(o,e,null),l=!0},p(a,c){(!l||c&8)&&i!==(i=a[3].length+"")&&me(r,i);const u={};c&8&&(u.tooltipText=`${a[3].length}
                                    ${W==="fr"&&a[3].length>1?"valeurs sélectionnées":W==="fr"&&a[3].length===1?"valeur sélectionnée":W==="en"&&a[3].length>1?"selected values":"selected value"}`),o.$set(u)},i(a){l||(V(o.$$.fragment,a),l=!0)},o(a){K(o.$$.fragment,a),l=!1},d(a){a&&$(e),oe(o)}}}function c1(t){let e,n,i,r,s,o,l,a=t[2]!==void 0&&Da(t);const c=[a1,l1],u=[];function d(f,h){return f[0]?0:1}return r=d(t),s=u[r]=c[r](t),{c(){e=k("div"),a&&a.c(),n=q(),i=k("div"),s.c(),v(i,"class",o="input-dropdown-select "+(t[0]?"is-multiple":"is-single")+" "+(t[0]&&t[3].length?"is-flex is-justify-content-flex-start is-align-items-center":"")+" "+(t[1]?"light-display":"")+" svelte-1epfuu8"),v(e,"class","input-dropdown-select-wrapper")},m(f,h){j(f,e,h),a&&a.m(e,null),y(e,n),y(e,i),u[r].m(i,null),l=!0},p(f,[h]){f[2]!==void 0?a?a.p(f,h):(a=Da(f),a.c(),a.m(e,n)):a&&(a.d(1),a=null);let m=r;r=d(f),r===m?u[r].p(f,h):(Ee(),K(u[m],1,1,()=>{u[m]=null}),Ce(),s=u[r],s?s.p(f,h):(s=u[r]=c[r](f),s.c()),V(s,1),s.m(i,null)),(!l||h&11&&o!==(o="input-dropdown-select "+(f[0]?"is-multiple":"is-single")+" "+(f[0]&&f[3].length?"is-flex is-justify-content-flex-start is-align-items-center":"")+" "+(f[1]?"light-display":"")+" svelte-1epfuu8"))&&v(i,"class",o)},i(f){l||(V(s),l=!0)},o(f){K(s),l=!1},d(f){f&&$(e),a&&a.d(),u[r].d()}}}const u1=250;function f1(t,e,n){let i,r,{choicesItems:s}=e,{start:o=[]}=e,{multiple:l}=e,{searchable:a=!0}=e,{lightDisplay:c=!1}=e,{placeholder:u=W==="fr"?"Sélectionner une valeur":"Select a value"}=e,{title:d=void 0}=e,{selectAll:f=!!l}=e;const h=`input-dropdown-select-${window.crypto.randomUUID()}`,m=`input-dropdown-counter-${window.crypto.randomUUID()}`,g=`select-all-${window.crypto.randomUUID()}`,p=`unselect-all-${window.crypto.randomUUID()}`,_=ai();let w;const C=ui();C.setCompareFn(cr);const b=ht("resetTrigger")||void 0;b==null||b.subscribe(()=>B(w,s,o,f));const I=()=>{n(11,r=!0),setTimeout(()=>n(11,r=!1),u1)},T=(x,F)=>{F||(C.set(x),C.same()||_("updateValues",i))},M=x=>`<span class="iconify" data-icon=${x}/>`,E=(x,F)=>x!=null&&F!=null&&x.length&&F.length?`<span class="dropdown-prefix-wrapper">${F==="iconify"?M(x):x}</span>`:"",A=(x,F)=>F?[{value:g,label:`<b>${W==="fr"?"Tout sélectionner":"Select all"}</b>`},{value:p,label:`<b>${W==="fr"?"Tout retirer":"Remove all"}</b>`},...x]:x,O=(x,F)=>A(x,F).map(H=>(H.id=`dropdown-choice-${window.crypto.randomUUID()}`,H.label=`<span>
                ${E(H.prefix||"",H.prefixType||"")}
                <span class="dropdown-prefix-text">${H.label}</span>
            </span>`,H));function D(x,F,H){return x=structuredClone(x),F=structuredClone(F),x=O(x,H).map(U=>F.includes(U.value)?{...U,selected:!0}:{...U,selected:!1}),n(3,i=F),x}function B(x,F,H,U){x&&(F=D(F,H,U),x.clearStore().setChoices(F))}const R=(x,F,H,U,Y,J)=>(U=structuredClone(U),H=structuredClone(H),x.detail.value===Y?(I(),H=H.map(ie=>[Y,J].includes(ie.value)?{...ie,selected:!1}:{...ie,selected:!0}),F.removeActiveItems().clearChoices(!0,!0).setValue(H).hideDropdown(),U=[...new Set(H.filter(ie=>ie.selected===!0).map(ie=>ie.value))]):x.detail.value===J?(F.removeActiveItems().hideDropdown(),U=[]):U=l===!0?[...U,x.detail.value]:[x.detail.value],[...new Set(U)]),S=(x,F)=>structuredClone(F).filter(H=>H!==x.detail.value);function L(x,F){const H=document.getElementById(h);w=new o1(H,{items:[],choices:x,addChoices:!1,addItems:!1,removeItems:!0,removeItemButton:!0,searchEnabled:a,allowHTML:!0,shouldSort:!F,sorter:(U,Y)=>U.label.localeCompare(Y.label),placeholderValue:u,classNames:{item:["choices__item","dropdown-item"]},loadingText:W==="fr"?"Chargement...":"Loading...",noResultsText:W==="fr"?"Pas de résultats":"No results found",noChoicesText:W==="fr"?"Pas de choix pour faire la sélection":"No choices to choose from",itemSelectText:W==="fr"?"Cliquer pour sélectionner":"Press to select",uniqueItemText:W==="fr"?"Seules des valeurs uniques peuvent être ajoutées":"Only unique values can be added",customAddItemText:W==="fr"?"Les valeurs ne répondent pas aux conditions attendues":"Only values matching specific conditions can be added",removeItemIconText:W==="fr"?"Retirer l'item":"Remove item",addItemText:U=>W==="fr"?`Cliquer sur Entrer pour ajouter <b>${U}</b>`:`Press Enter to add <b>"${U}"</b>`,removeItemLabelText:U=>W==="fr"?`Retirer l'item: ${U}`:`Remove item: ${U}`,maxItemText:U=>W==="fr"?`Seulement ${U} items peuvent être ajoutées`:`Only ${U} items can be added`}),H.addEventListener("addItem",U=>{n(3,i=R(U,w,x,i,g,p))}),H.addEventListener("removeItem",U=>{n(3,i=S(U,i))})}return Nn(()=>{const x=D(s,o,f);L(x,f)}),Tn(()=>{w.destroy(),w=void 0}),t.$$set=x=>{"choicesItems"in x&&n(6,s=x.choicesItems),"start"in x&&n(7,o=x.start),"multiple"in x&&n(0,l=x.multiple),"searchable"in x&&n(8,a=x.searchable),"lightDisplay"in x&&n(1,c=x.lightDisplay),"placeholder"in x&&n(9,u=x.placeholder),"title"in x&&n(2,d=x.title),"selectAll"in x&&n(10,f=x.selectAll)},t.$$.update=()=>{t.$$.dirty&2056&&T(i,r)},n(3,i=[]),n(11,r=!1),[l,c,d,i,h,m,s,o,a,u,f,r]}class h1 extends ye{constructor(e){super(),ve(this,e,f1,c1,pe,{choicesItems:6,start:7,multiple:0,searchable:8,lightDisplay:1,placeholder:9,title:2,selectAll:10})}}var Jt;(function(t){t.Range="range",t.Steps="steps",t.Positions="positions",t.Count="count",t.Values="values"})(Jt||(Jt={}));var st;(function(t){t[t.None=-1]="None",t[t.NoValue=0]="NoValue",t[t.LargeValue=1]="LargeValue",t[t.SmallValue=2]="SmallValue"})(st||(st={}));function d1(t){return Bi(t)&&typeof t.from=="function"}function Bi(t){return typeof t=="object"&&typeof t.to=="function"}function $a(t){t.parentElement.removeChild(t)}function rs(t){return t!=null}function za(t){t.preventDefault()}function m1(t){return t.filter(function(e){return this[e]?!1:this[e]=!0},{})}function p1(t,e){return Math.round(t/e)*e}function g1(t,e){var n=t.getBoundingClientRect(),i=t.ownerDocument,r=i.documentElement,s=Va(i);return/webkit.*Chrome.*Mobile/i.test(navigator.userAgent)&&(s.x=0),e?n.top+s.y-r.clientTop:n.left+s.x-r.clientLeft}function Ct(t){return typeof t=="number"&&!isNaN(t)&&isFinite(t)}function ja(t,e,n){n>0&&(Qe(t,e),setTimeout(function(){Ki(t,e)},n))}function Fa(t){return Math.max(Math.min(t,100),0)}function qi(t){return Array.isArray(t)?t:[t]}function _1(t){t=String(t);var e=t.split(".");return e.length>1?e[1].length:0}function Qe(t,e){t.classList&&!/\s/.test(e)?t.classList.add(e):t.className+=" "+e}function Ki(t,e){t.classList&&!/\s/.test(e)?t.classList.remove(e):t.className=t.className.replace(new RegExp("(^|\\b)"+e.split(" ").join("|")+"(\\b|$)","gi")," ")}function v1(t,e){return t.classList?t.classList.contains(e):new RegExp("\\b"+e+"\\b").test(t.className)}function Va(t){var e=window.pageXOffset!==void 0,n=(t.compatMode||"")==="CSS1Compat",i=e?window.pageXOffset:n?t.documentElement.scrollLeft:t.body.scrollLeft,r=e?window.pageYOffset:n?t.documentElement.scrollTop:t.body.scrollTop;return{x:i,y:r}}function y1(){return window.navigator.pointerEnabled?{start:"pointerdown",move:"pointermove",end:"pointerup"}:window.navigator.msPointerEnabled?{start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:{start:"mousedown touchstart",move:"mousemove touchmove",end:"mouseup touchend"}}function b1(){var t=!1;try{var e=Object.defineProperty({},"passive",{get:function(){t=!0}});window.addEventListener("test",null,e)}catch{}return t}function w1(){return window.CSS&&CSS.supports&&CSS.supports("touch-action","none")}function ss(t,e){return 100/(e-t)}function os(t,e,n){return e*100/(t[n+1]-t[n])}function S1(t,e){return os(t,t[0]<0?e+Math.abs(t[0]):e-t[0],0)}function k1(t,e){return e*(t[1]-t[0])/100+t[0]}function Xn(t,e){for(var n=1;t>=e[n];)n+=1;return n}function E1(t,e,n){if(n>=t.slice(-1)[0])return 100;var i=Xn(n,t),r=t[i-1],s=t[i],o=e[i-1],l=e[i];return o+S1([r,s],n)/ss(o,l)}function C1(t,e,n){if(n>=100)return t.slice(-1)[0];var i=Xn(n,e),r=t[i-1],s=t[i],o=e[i-1],l=e[i];return k1([r,s],(n-o)*ss(o,l))}function I1(t,e,n,i){if(i===100)return i;var r=Xn(i,t),s=t[r-1],o=t[r];return n?i-s>(o-s)/2?o:s:e[r-1]?t[r-1]+p1(i-t[r-1],e[r-1]):i}var Ha=function(){function t(e,n,i){this.xPct=[],this.xVal=[],this.xSteps=[],this.xNumSteps=[],this.xHighestCompleteStep=[],this.xSteps=[i||!1],this.xNumSteps=[!1],this.snap=n;var r,s=[];for(Object.keys(e).forEach(function(o){s.push([qi(e[o]),o])}),s.sort(function(o,l){return o[0][0]-l[0][0]}),r=0;r<s.length;r++)this.handleEntryPoint(s[r][1],s[r][0]);for(this.xNumSteps=this.xSteps.slice(0),r=0;r<this.xNumSteps.length;r++)this.handleStepPoint(r,this.xNumSteps[r])}return t.prototype.getDistance=function(e){for(var n=[],i=0;i<this.xNumSteps.length-1;i++)n[i]=os(this.xVal,e,i);return n},t.prototype.getAbsoluteDistance=function(e,n,i){var r=0;if(e<this.xPct[this.xPct.length-1])for(;e>this.xPct[r+1];)r++;else e===this.xPct[this.xPct.length-1]&&(r=this.xPct.length-2);!i&&e===this.xPct[r+1]&&r++,n===null&&(n=[]);var s,o=1,l=n[r],a=0,c=0,u=0,d=0;for(i?s=(e-this.xPct[r])/(this.xPct[r+1]-this.xPct[r]):s=(this.xPct[r+1]-e)/(this.xPct[r+1]-this.xPct[r]);l>0;)a=this.xPct[r+1+d]-this.xPct[r+d],n[r+d]*o+100-s*100>100?(c=a*s,o=(l-100*s)/n[r+d],s=1):(c=n[r+d]*a/100*o,o=0),i?(u=u-c,this.xPct.length+d>=1&&d--):(u=u+c,this.xPct.length-d>=1&&d++),l=n[r+d]*o;return e+u},t.prototype.toStepping=function(e){return e=E1(this.xVal,this.xPct,e),e},t.prototype.fromStepping=function(e){return C1(this.xVal,this.xPct,e)},t.prototype.getStep=function(e){return e=I1(this.xPct,this.xSteps,this.snap,e),e},t.prototype.getDefaultStep=function(e,n,i){var r=Xn(e,this.xPct);return(e===100||n&&e===this.xPct[r-1])&&(r=Math.max(r-1,1)),(this.xVal[r]-this.xVal[r-1])/i},t.prototype.getNearbySteps=function(e){var n=Xn(e,this.xPct);return{stepBefore:{startValue:this.xVal[n-2],step:this.xNumSteps[n-2],highestStep:this.xHighestCompleteStep[n-2]},thisStep:{startValue:this.xVal[n-1],step:this.xNumSteps[n-1],highestStep:this.xHighestCompleteStep[n-1]},stepAfter:{startValue:this.xVal[n],step:this.xNumSteps[n],highestStep:this.xHighestCompleteStep[n]}}},t.prototype.countStepDecimals=function(){var e=this.xNumSteps.map(_1);return Math.max.apply(null,e)},t.prototype.hasNoSize=function(){return this.xVal[0]===this.xVal[this.xVal.length-1]},t.prototype.convert=function(e){return this.getStep(this.toStepping(e))},t.prototype.handleEntryPoint=function(e,n){var i;if(e==="min"?i=0:e==="max"?i=100:i=parseFloat(e),!Ct(i)||!Ct(n[0]))throw new Error("noUiSlider: 'range' value isn't numeric.");this.xPct.push(i),this.xVal.push(n[0]);var r=Number(n[1]);i?this.xSteps.push(isNaN(r)?!1:r):isNaN(r)||(this.xSteps[0]=r),this.xHighestCompleteStep.push(0)},t.prototype.handleStepPoint=function(e,n){if(n){if(this.xVal[e]===this.xVal[e+1]){this.xSteps[e]=this.xHighestCompleteStep[e]=this.xVal[e];return}this.xSteps[e]=os([this.xVal[e],this.xVal[e+1]],n,0)/ss(this.xPct[e],this.xPct[e+1]);var i=(this.xVal[e+1]-this.xVal[e])/this.xNumSteps[e],r=Math.ceil(Number(i.toFixed(3))-1),s=this.xVal[e]+this.xNumSteps[e]*r;this.xHighestCompleteStep[e]=s}},t}(),Ua={to:function(t){return t===void 0?"":t.toFixed(2)},from:Number},Ba={target:"target",base:"base",origin:"origin",handle:"handle",handleLower:"handle-lower",handleUpper:"handle-upper",touchArea:"touch-area",horizontal:"horizontal",vertical:"vertical",background:"background",connect:"connect",connects:"connects",ltr:"ltr",rtl:"rtl",textDirectionLtr:"txt-dir-ltr",textDirectionRtl:"txt-dir-rtl",draggable:"draggable",drag:"state-drag",tap:"state-tap",active:"active",tooltip:"tooltip",pips:"pips",pipsHorizontal:"pips-horizontal",pipsVertical:"pips-vertical",marker:"marker",markerHorizontal:"marker-horizontal",markerVertical:"marker-vertical",markerNormal:"marker-normal",markerLarge:"marker-large",markerSub:"marker-sub",value:"value",valueHorizontal:"value-horizontal",valueVertical:"value-vertical",valueNormal:"value-normal",valueLarge:"value-large",valueSub:"value-sub"},Qt={tooltips:".__tooltips",aria:".__aria"};function x1(t,e){if(!Ct(e))throw new Error("noUiSlider: 'step' is not numeric.");t.singleStep=e}function M1(t,e){if(!Ct(e))throw new Error("noUiSlider: 'keyboardPageMultiplier' is not numeric.");t.keyboardPageMultiplier=e}function A1(t,e){if(!Ct(e))throw new Error("noUiSlider: 'keyboardMultiplier' is not numeric.");t.keyboardMultiplier=e}function N1(t,e){if(!Ct(e))throw new Error("noUiSlider: 'keyboardDefaultStep' is not numeric.");t.keyboardDefaultStep=e}function T1(t,e){if(typeof e!="object"||Array.isArray(e))throw new Error("noUiSlider: 'range' is not an object.");if(e.min===void 0||e.max===void 0)throw new Error("noUiSlider: Missing 'min' or 'max' in 'range'.");t.spectrum=new Ha(e,t.snap||!1,t.singleStep)}function O1(t,e){if(e=qi(e),!Array.isArray(e)||!e.length)throw new Error("noUiSlider: 'start' option is incorrect.");t.handles=e.length,t.start=e}function P1(t,e){if(typeof e!="boolean")throw new Error("noUiSlider: 'snap' option must be a boolean.");t.snap=e}function L1(t,e){if(typeof e!="boolean")throw new Error("noUiSlider: 'animate' option must be a boolean.");t.animate=e}function D1(t,e){if(typeof e!="number")throw new Error("noUiSlider: 'animationDuration' option must be a number.");t.animationDuration=e}function qa(t,e){var n=[!1],i;if(e==="lower"?e=[!0,!1]:e==="upper"&&(e=[!1,!0]),e===!0||e===!1){for(i=1;i<t.handles;i++)n.push(e);n.push(!1)}else{if(!Array.isArray(e)||!e.length||e.length!==t.handles+1)throw new Error("noUiSlider: 'connect' option doesn't match handle count.");n=e}t.connect=n}function R1(t,e){switch(e){case"horizontal":t.ort=0;break;case"vertical":t.ort=1;break;default:throw new Error("noUiSlider: 'orientation' option is invalid.")}}function Ka(t,e){if(!Ct(e))throw new Error("noUiSlider: 'margin' option must be numeric.");e!==0&&(t.margin=t.spectrum.getDistance(e))}function $1(t,e){if(!Ct(e))throw new Error("noUiSlider: 'limit' option must be numeric.");if(t.limit=t.spectrum.getDistance(e),!t.limit||t.handles<2)throw new Error("noUiSlider: 'limit' option is only supported on linear sliders with 2 or more handles.")}function z1(t,e){var n;if(!Ct(e)&&!Array.isArray(e))throw new Error("noUiSlider: 'padding' option must be numeric or array of exactly 2 numbers.");if(Array.isArray(e)&&!(e.length===2||Ct(e[0])||Ct(e[1])))throw new Error("noUiSlider: 'padding' option must be numeric or array of exactly 2 numbers.");if(e!==0){for(Array.isArray(e)||(e=[e,e]),t.padding=[t.spectrum.getDistance(e[0]),t.spectrum.getDistance(e[1])],n=0;n<t.spectrum.xNumSteps.length-1;n++)if(t.padding[0][n]<0||t.padding[1][n]<0)throw new Error("noUiSlider: 'padding' option must be a positive number(s).");var i=e[0]+e[1],r=t.spectrum.xVal[0],s=t.spectrum.xVal[t.spectrum.xVal.length-1];if(i/(s-r)>1)throw new Error("noUiSlider: 'padding' option must not exceed 100% of the range.")}}function j1(t,e){switch(e){case"ltr":t.dir=0;break;case"rtl":t.dir=1;break;default:throw new Error("noUiSlider: 'direction' option was not recognized.")}}function F1(t,e){if(typeof e!="string")throw new Error("noUiSlider: 'behaviour' must be a string containing options.");var n=e.indexOf("tap")>=0,i=e.indexOf("drag")>=0,r=e.indexOf("fixed")>=0,s=e.indexOf("snap")>=0,o=e.indexOf("hover")>=0,l=e.indexOf("unconstrained")>=0,a=e.indexOf("invert-connects")>=0,c=e.indexOf("drag-all")>=0,u=e.indexOf("smooth-steps")>=0;if(r){if(t.handles!==2)throw new Error("noUiSlider: 'fixed' behaviour must be used with 2 handles");Ka(t,t.start[1]-t.start[0])}if(a&&t.handles!==2)throw new Error("noUiSlider: 'invert-connects' behaviour must be used with 2 handles");if(l&&(t.margin||t.limit))throw new Error("noUiSlider: 'unconstrained' behaviour cannot be used with margin or limit");t.events={tap:n||s,drag:i,dragAll:c,smoothSteps:u,fixed:r,snap:s,hover:o,unconstrained:l,invertConnects:a}}function V1(t,e){if(e!==!1)if(e===!0||Bi(e)){t.tooltips=[];for(var n=0;n<t.handles;n++)t.tooltips.push(e)}else{if(e=qi(e),e.length!==t.handles)throw new Error("noUiSlider: must pass a formatter for all handles.");e.forEach(function(i){if(typeof i!="boolean"&&!Bi(i))throw new Error("noUiSlider: 'tooltips' must be passed a formatter or 'false'.")}),t.tooltips=e}}function H1(t,e){if(e.length!==t.handles)throw new Error("noUiSlider: must pass a attributes for all handles.");t.handleAttributes=e}function U1(t,e){if(!Bi(e))throw new Error("noUiSlider: 'ariaFormat' requires 'to' method.");t.ariaFormat=e}function B1(t,e){if(!d1(e))throw new Error("noUiSlider: 'format' requires 'to' and 'from' methods.");t.format=e}function q1(t,e){if(typeof e!="boolean")throw new Error("noUiSlider: 'keyboardSupport' option must be a boolean.");t.keyboardSupport=e}function K1(t,e){t.documentElement=e}function W1(t,e){if(typeof e!="string"&&e!==!1)throw new Error("noUiSlider: 'cssPrefix' must be a string or `false`.");t.cssPrefix=e}function G1(t,e){if(typeof e!="object")throw new Error("noUiSlider: 'cssClasses' must be an object.");typeof t.cssPrefix=="string"?(t.cssClasses={},Object.keys(e).forEach(function(n){t.cssClasses[n]=t.cssPrefix+e[n]})):t.cssClasses=e}function Wa(t){var e={margin:null,limit:null,padding:null,animate:!0,animationDuration:300,ariaFormat:Ua,format:Ua},n={step:{r:!1,t:x1},keyboardPageMultiplier:{r:!1,t:M1},keyboardMultiplier:{r:!1,t:A1},keyboardDefaultStep:{r:!1,t:N1},start:{r:!0,t:O1},connect:{r:!0,t:qa},direction:{r:!0,t:j1},snap:{r:!1,t:P1},animate:{r:!1,t:L1},animationDuration:{r:!1,t:D1},range:{r:!0,t:T1},orientation:{r:!1,t:R1},margin:{r:!1,t:Ka},limit:{r:!1,t:$1},padding:{r:!1,t:z1},behaviour:{r:!0,t:F1},ariaFormat:{r:!1,t:U1},format:{r:!1,t:B1},tooltips:{r:!1,t:V1},keyboardSupport:{r:!0,t:q1},documentElement:{r:!1,t:K1},cssPrefix:{r:!0,t:W1},cssClasses:{r:!0,t:G1},handleAttributes:{r:!1,t:H1}},i={connect:!1,direction:"ltr",behaviour:"tap",orientation:"horizontal",keyboardSupport:!0,cssPrefix:"noUi-",cssClasses:Ba,keyboardPageMultiplier:5,keyboardMultiplier:1,keyboardDefaultStep:10};t.format&&!t.ariaFormat&&(t.ariaFormat=t.format),Object.keys(n).forEach(function(a){if(!rs(t[a])&&i[a]===void 0){if(n[a].r)throw new Error("noUiSlider: '"+a+"' is required.");return}n[a].t(e,rs(t[a])?t[a]:i[a])}),e.pips=t.pips;var r=document.createElement("div"),s=r.style.msTransform!==void 0,o=r.style.transform!==void 0;e.transformRule=o?"transform":s?"msTransform":"webkitTransform";var l=[["left","top"],["right","bottom"]];return e.style=l[e.dir][e.ort],e}function Y1(t,e,n){var i=y1(),r=w1(),s=r&&b1(),o=t,l,a,c,u,d,f,h=e.spectrum,m=[],g=[],p=[],_=0,w={},C=!1,b=t.ownerDocument,I=e.documentElement||b.documentElement,T=b.body,M=b.dir==="rtl"||e.ort===1?0:100;function E(N,P){var z=b.createElement("div");return P&&Qe(z,P),N.appendChild(z),z}function A(N,P){var z=E(N,e.cssClasses.origin),G=E(z,e.cssClasses.handle);if(E(G,e.cssClasses.touchArea),G.setAttribute("data-handle",String(P)),e.keyboardSupport&&(G.setAttribute("tabindex","0"),G.addEventListener("keydown",function(Z){return Ve(Z,P)})),e.handleAttributes!==void 0){var Q=e.handleAttributes[P];Object.keys(Q).forEach(function(Z){G.setAttribute(Z,Q[Z])})}return G.setAttribute("role","slider"),G.setAttribute("aria-orientation",e.ort?"vertical":"horizontal"),P===0?Qe(G,e.cssClasses.handleLower):P===e.handles-1&&Qe(G,e.cssClasses.handleUpper),z.handle=G,z}function O(N,P){return P?E(N,e.cssClasses.connect):!1}function D(N,P){a=E(P,e.cssClasses.connects),c=[],u=[],u.push(O(a,N[0]));for(var z=0;z<e.handles;z++)c.push(A(P,z)),p[z]=z,u.push(O(a,N[z+1]))}function B(N){Qe(N,e.cssClasses.target),e.dir===0?Qe(N,e.cssClasses.ltr):Qe(N,e.cssClasses.rtl),e.ort===0?Qe(N,e.cssClasses.horizontal):Qe(N,e.cssClasses.vertical);var P=getComputedStyle(N).direction;return P==="rtl"?Qe(N,e.cssClasses.textDirectionRtl):Qe(N,e.cssClasses.textDirectionLtr),E(N,e.cssClasses.base)}function R(N,P){return!e.tooltips||!e.tooltips[P]?!1:E(N.firstChild,e.cssClasses.tooltip)}function S(){return o.hasAttribute("disabled")}function L(N){var P=c[N];return P.hasAttribute("disabled")}function x(N){N!=null?(c[N].setAttribute("disabled",""),c[N].handle.removeAttribute("tabindex")):(o.setAttribute("disabled",""),c.forEach(function(P){P.handle.removeAttribute("tabindex")}))}function F(N){N!=null?(c[N].removeAttribute("disabled"),c[N].handle.setAttribute("tabindex","0")):(o.removeAttribute("disabled"),c.forEach(function(P){P.removeAttribute("disabled"),P.handle.setAttribute("tabindex","0")}))}function H(){f&&(Zt("update"+Qt.tooltips),f.forEach(function(N){N&&$a(N)}),f=null)}function U(){H(),f=c.map(R),ln("update"+Qt.tooltips,function(N,P,z){if(!(!f||!e.tooltips)&&f[P]!==!1){var G=N[P];e.tooltips[P]!==!0&&(G=e.tooltips[P].to(z[P])),f[P].innerHTML=G}})}function Y(){Zt("update"+Qt.aria),ln("update"+Qt.aria,function(N,P,z,G,Q){p.forEach(function(Z){var ae=c[Z],re=ke(g,Z,0,!0,!0,!0),Te=ke(g,Z,100,!0,!0,!0),Oe=Q[Z],De=String(e.ariaFormat.to(z[Z]));re=h.fromStepping(re).toFixed(1),Te=h.fromStepping(Te).toFixed(1),Oe=h.fromStepping(Oe).toFixed(1),ae.children[0].setAttribute("aria-valuemin",re),ae.children[0].setAttribute("aria-valuemax",Te),ae.children[0].setAttribute("aria-valuenow",Oe),ae.children[0].setAttribute("aria-valuetext",De)})})}function J(N){if(N.mode===Jt.Range||N.mode===Jt.Steps)return h.xVal;if(N.mode===Jt.Count){if(N.values<2)throw new Error("noUiSlider: 'values' (>= 2) required for mode 'count'.");for(var P=N.values-1,z=100/P,G=[];P--;)G[P]=P*z;return G.push(100),ie(G,N.stepped)}return N.mode===Jt.Positions?ie(N.values,N.stepped):N.mode===Jt.Values?N.stepped?N.values.map(function(Q){return h.fromStepping(h.getStep(h.toStepping(Q)))}):N.values:[]}function ie(N,P){return N.map(function(z){return h.fromStepping(P?h.getStep(z):z)})}function he(N){function P(Oe,De){return Number((Oe+De).toFixed(7))}var z=J(N),G={},Q=h.xVal[0],Z=h.xVal[h.xVal.length-1],ae=!1,re=!1,Te=0;return z=m1(z.slice().sort(function(Oe,De){return Oe-De})),z[0]!==Q&&(z.unshift(Q),ae=!0),z[z.length-1]!==Z&&(z.push(Z),re=!0),z.forEach(function(Oe,De){var Re,Me,He,Ze=Oe,qe=z[De+1],Ge,as,cs,us,oc,fs,lc,ac=N.mode===Jt.Steps;for(ac&&(Re=h.xNumSteps[De]),Re||(Re=qe-Ze),qe===void 0&&(qe=Ze),Re=Math.max(Re,1e-7),Me=Ze;Me<=qe;Me=P(Me,Re)){for(Ge=h.toStepping(Me),as=Ge-Te,oc=as/(N.density||1),fs=Math.round(oc),lc=as/fs,He=1;He<=fs;He+=1)cs=Te+He*lc,G[cs.toFixed(5)]=[h.fromStepping(cs),0];us=z.indexOf(Me)>-1?st.LargeValue:ac?st.SmallValue:st.NoValue,!De&&ae&&Me!==qe&&(us=0),Me===qe&&re||(G[Ge.toFixed(5)]=[Me,us]),Te=Ge}}),G}function te(N,P,z){var G,Q,Z=b.createElement("div"),ae=(G={},G[st.None]="",G[st.NoValue]=e.cssClasses.valueNormal,G[st.LargeValue]=e.cssClasses.valueLarge,G[st.SmallValue]=e.cssClasses.valueSub,G),re=(Q={},Q[st.None]="",Q[st.NoValue]=e.cssClasses.markerNormal,Q[st.LargeValue]=e.cssClasses.markerLarge,Q[st.SmallValue]=e.cssClasses.markerSub,Q),Te=[e.cssClasses.valueHorizontal,e.cssClasses.valueVertical],Oe=[e.cssClasses.markerHorizontal,e.cssClasses.markerVertical];Qe(Z,e.cssClasses.pips),Qe(Z,e.ort===0?e.cssClasses.pipsHorizontal:e.cssClasses.pipsVertical);function De(Me,He){var Ze=He===e.cssClasses.value,qe=Ze?Te:Oe,Ge=Ze?ae:re;return He+" "+qe[e.ort]+" "+Ge[Me]}function Re(Me,He,Ze){if(Ze=P?P(He,Ze):Ze,Ze!==st.None){var qe=E(Z,!1);qe.className=De(Ze,e.cssClasses.marker),qe.style[e.style]=Me+"%",Ze>st.NoValue&&(qe=E(Z,!1),qe.className=De(Ze,e.cssClasses.value),qe.setAttribute("data-value",String(He)),qe.style[e.style]=Me+"%",qe.innerHTML=String(z.to(He)))}}return Object.keys(N).forEach(function(Me){Re(Me,N[Me][0],N[Me][1])}),Z}function ce(){d&&($a(d),d=null)}function xe(N){ce();var P=he(N),z=N.filter,G=N.format||{to:function(Q){return String(Math.round(Q))}};return d=o.appendChild(te(P,z,G)),d}function Ae(){var N=l.getBoundingClientRect(),P="offset"+["Width","Height"][e.ort];return e.ort===0?N.width||l[P]:N.height||l[P]}function we(N,P,z,G){var Q=function(ae){var re=$e(ae,G.pageOffset,G.target||P);if(!re||S()&&!G.doNotReject||v1(o,e.cssClasses.tap)&&!G.doNotReject||N===i.start&&re.buttons!==void 0&&re.buttons>1||G.hover&&re.buttons)return!1;s||re.preventDefault(),re.calcPoint=re.points[e.ort],z(re,G)},Z=[];return N.split(" ").forEach(function(ae){P.addEventListener(ae,Q,s?{passive:!0}:!1),Z.push([ae,Q])}),Z}function $e(N,P,z){var G=N.type.indexOf("touch")===0,Q=N.type.indexOf("mouse")===0,Z=N.type.indexOf("pointer")===0,ae=0,re=0;if(N.type.indexOf("MSPointer")===0&&(Z=!0),N.type==="mousedown"&&!N.buttons&&!N.touches)return!1;if(G){var Te=function(Re){var Me=Re.target;return Me===z||z.contains(Me)||N.composed&&N.composedPath().shift()===z};if(N.type==="touchstart"){var Oe=Array.prototype.filter.call(N.touches,Te);if(Oe.length>1)return!1;ae=Oe[0].pageX,re=Oe[0].pageY}else{var De=Array.prototype.find.call(N.changedTouches,Te);if(!De)return!1;ae=De.pageX,re=De.pageY}}return P=P||Va(b),(Q||Z)&&(ae=N.clientX+P.x,re=N.clientY+P.y),N.pageOffset=P,N.points=[ae,re],N.cursor=Q||Z,N}function It(N){var P=N-g1(l,e.ort),z=P*100/Ae();return z=Fa(z),e.dir?100-z:z}function Ie(N){var P=100,z=!1;return c.forEach(function(G,Q){if(!L(Q)){var Z=g[Q],ae=Math.abs(Z-N),re=ae===100&&P===100,Te=ae<P,Oe=ae<=P&&N>Z;(Te||Oe||re)&&(z=Q,P=ae)}}),z}function Be(N,P){N.type==="mouseout"&&N.target.nodeName==="HTML"&&N.relatedTarget===null&&Ne(N,P)}function ze(N,P){if(navigator.appVersion.indexOf("MSIE 9")===-1&&N.buttons===0&&P.buttonsProperty!==0)return Ne(N,P);var z=(e.dir?-1:1)*(N.calcPoint-P.startCalcPoint),G=z*100/P.baseSize;ue(z>0,G,P.locations,P.handleNumbers,P.connect)}function Ne(N,P){P.handle&&(Ki(P.handle,e.cssClasses.active),_-=1),P.listeners.forEach(function(z){I.removeEventListener(z[0],z[1])}),_===0&&(Ki(o,e.cssClasses.drag),ls(),N.cursor&&(T.style.cursor="",T.removeEventListener("selectstart",za))),e.events.smoothSteps&&(P.handleNumbers.forEach(function(z){an(z,g[z],!0,!0,!1,!1)}),P.handleNumbers.forEach(function(z){ee("update",z)})),P.handleNumbers.forEach(function(z){ee("change",z),ee("set",z),ee("end",z)})}function _e(N,P){if(!P.handleNumbers.some(L)){var z;if(P.handleNumbers.length===1){var G=c[P.handleNumbers[0]];z=G.children[0],_+=1,Qe(z,e.cssClasses.active)}N.stopPropagation();var Q=[],Z=we(i.move,I,ze,{target:N.target,handle:z,connect:P.connect,listeners:Q,startCalcPoint:N.calcPoint,baseSize:Ae(),pageOffset:N.pageOffset,handleNumbers:P.handleNumbers,buttonsProperty:N.buttons,locations:g.slice()}),ae=we(i.end,I,Ne,{target:N.target,handle:z,listeners:Q,doNotReject:!0,handleNumbers:P.handleNumbers}),re=we("mouseout",I,Be,{target:N.target,handle:z,listeners:Q,doNotReject:!0,handleNumbers:P.handleNumbers});Q.push.apply(Q,Z.concat(ae,re)),N.cursor&&(T.style.cursor=getComputedStyle(N.target).cursor,c.length>1&&Qe(o,e.cssClasses.drag),T.addEventListener("selectstart",za,!1)),P.handleNumbers.forEach(function(Te){ee("start",Te)})}}function Bt(N){N.stopPropagation();var P=It(N.calcPoint),z=Ie(P);z!==!1&&(e.events.snap||ja(o,e.cssClasses.tap,e.animationDuration),an(z,P,!0,!0),ls(),ee("slide",z,!0),ee("update",z,!0),e.events.snap?_e(N,{handleNumbers:[z]}):(ee("change",z,!0),ee("set",z,!0)))}function Qn(N){var P=It(N.calcPoint),z=h.getStep(P),G=h.fromStepping(z);Object.keys(w).forEach(function(Q){Q.split(".")[0]==="hover"&&w[Q].forEach(function(Z){Z.call(Yi,G)})})}function Ve(N,P){if(S()||L(P))return!1;var z=["Left","Right"],G=["Down","Up"],Q=["PageDown","PageUp"],Z=["Home","End"];e.dir&&!e.ort?z.reverse():e.ort&&!e.dir&&(G.reverse(),Q.reverse());var ae=N.key.replace("Arrow",""),re=ae===Q[0],Te=ae===Q[1],Oe=ae===G[0]||ae===z[0]||re,De=ae===G[1]||ae===z[1]||Te,Re=ae===Z[0],Me=ae===Z[1];if(!Oe&&!De&&!Re&&!Me)return!0;N.preventDefault();var He;if(De||Oe){var Ze=Oe?0:1,qe=rc(P),Ge=qe[Ze];if(Ge===null)return!1;Ge===!1&&(Ge=h.getDefaultStep(g[P],Oe,e.keyboardDefaultStep)),Te||re?Ge*=e.keyboardPageMultiplier:Ge*=e.keyboardMultiplier,Ge=Math.max(Ge,1e-7),Ge=(Oe?-1:1)*Ge,He=m[P]+Ge}else Me?He=e.spectrum.xVal[e.spectrum.xVal.length-1]:He=e.spectrum.xVal[0];return an(P,h.toStepping(He),!0,!0),ee("slide",P),ee("update",P),ee("change",P),ee("set",P),!1}function Wi(N){N.fixed||c.forEach(function(P,z){we(i.start,P.children[0],_e,{handleNumbers:[z]})}),N.tap&&we(i.start,l,Bt,{}),N.hover&&we(i.move,l,Qn,{hover:!0}),N.drag&&u.forEach(function(P,z){if(!(P===!1||z===0||z===u.length-1)){var G=c[z-1],Q=c[z],Z=[P],ae=[G,Q],re=[z-1,z];Qe(P,e.cssClasses.draggable),N.fixed&&(Z.push(G.children[0]),Z.push(Q.children[0])),N.dragAll&&(ae=c,re=p),Z.forEach(function(Te){we(i.start,Te,_e,{handles:ae,handleNumbers:re,connect:P})})}})}function ln(N,P){w[N]=w[N]||[],w[N].push(P),N.split(".")[0]==="update"&&c.forEach(function(z,G){ee("update",G)})}function pt(N){return N===Qt.aria||N===Qt.tooltips}function Zt(N){var P=N&&N.split(".")[0],z=P?N.substring(P.length):N;Object.keys(w).forEach(function(G){var Q=G.split(".")[0],Z=G.substring(Q.length);(!P||P===Q)&&(!z||z===Z)&&(!pt(Z)||z===Z)&&delete w[G]})}function ee(N,P,z){Object.keys(w).forEach(function(G){var Q=G.split(".")[0];N===Q&&w[G].forEach(function(Z){Z.call(Yi,m.map(e.format.to),P,m.slice(),z||!1,g.slice(),Yi)})})}function ke(N,P,z,G,Q,Z,ae){var re;return c.length>1&&!e.events.unconstrained&&(G&&P>0&&(re=h.getAbsoluteDistance(N[P-1],e.margin,!1),z=Math.max(z,re)),Q&&P<c.length-1&&(re=h.getAbsoluteDistance(N[P+1],e.margin,!0),z=Math.min(z,re))),c.length>1&&e.limit&&(G&&P>0&&(re=h.getAbsoluteDistance(N[P-1],e.limit,!1),z=Math.min(z,re)),Q&&P<c.length-1&&(re=h.getAbsoluteDistance(N[P+1],e.limit,!0),z=Math.max(z,re))),e.padding&&(P===0&&(re=h.getAbsoluteDistance(0,e.padding[0],!1),z=Math.max(z,re)),P===c.length-1&&(re=h.getAbsoluteDistance(100,e.padding[1],!0),z=Math.min(z,re))),ae||(z=h.getStep(z)),z=Fa(z),z===N[P]&&!Z?!1:z}function Fe(N,P){var z=e.ort;return(z?P:N)+", "+(z?N:P)}function ue(N,P,z,G,Q){var Z=z.slice(),ae=G[0],re=e.events.smoothSteps,Te=[!N,N],Oe=[N,!N];G=G.slice(),N&&G.reverse(),G.length>1?G.forEach(function(Re,Me){var He=ke(Z,Re,Z[Re]+P,Te[Me],Oe[Me],!1,re);He===!1?P=0:(P=He-Z[Re],Z[Re]=He)}):Te=Oe=[!0];var De=!1;G.forEach(function(Re,Me){De=an(Re,z[Re]+P,Te[Me],Oe[Me],!1,re)||De}),De&&(G.forEach(function(Re){ee("update",Re),ee("slide",Re)}),Q!=null&&ee("drag",ae))}function xt(N,P){return e.dir?100-N-P:N}function Vv(N,P){g[N]=P,m[N]=h.fromStepping(P);var z=xt(P,0)-M,G="translate("+Fe(z+"%","0")+")";if(c[N].style[e.transformRule]=G,e.events.invertConnects&&g.length>1){var Q=g.every(function(Z,ae,re){return ae===0||Z>=re[ae-1]});if(C!==!Q){Wv();return}}Zn(N),Zn(N+1),C&&(Zn(N-1),Zn(N+2))}function ls(){p.forEach(function(N){var P=g[N]>50?-1:1,z=3+(c.length+P*N);c[N].style.zIndex=String(z)})}function an(N,P,z,G,Q,Z){return Q||(P=ke(g,N,P,z,G,!1,Z)),P===!1?!1:(Vv(N,P),!0)}function Zn(N){if(u[N]){var P=g.slice();C&&P.sort(function(re,Te){return re-Te});var z=0,G=100;N!==0&&(z=P[N-1]),N!==u.length-1&&(G=P[N]);var Q=G-z,Z="translate("+Fe(xt(z,Q)+"%","0")+")",ae="scale("+Fe(Q/100,"1")+")";u[N].style[e.transformRule]=Z+" "+ae}}function nc(N,P){return N===null||N===!1||N===void 0||(typeof N=="number"&&(N=String(N)),N=e.format.from(N),N!==!1&&(N=h.toStepping(N)),N===!1||isNaN(N))?g[P]:N}function Gi(N,P,z){var G=qi(N),Q=g[0]===void 0;P=P===void 0?!0:P,e.animate&&!Q&&ja(o,e.cssClasses.tap,e.animationDuration),p.forEach(function(re){an(re,nc(G[re],re),!0,!1,z)});var Z=p.length===1?0:1;if(Q&&h.hasNoSize()&&(z=!0,g[0]=0,p.length>1)){var ae=100/(p.length-1);p.forEach(function(re){g[re]=re*ae})}for(;Z<p.length;++Z)p.forEach(function(re){an(re,g[re],!0,!0,z)});ls(),p.forEach(function(re){ee("update",re),G[re]!==null&&P&&ee("set",re)})}function Hv(N){Gi(e.start,N)}function Uv(N,P,z,G){if(N=Number(N),!(N>=0&&N<p.length))throw new Error("noUiSlider: invalid handle number, got: "+N);an(N,nc(P,N),!0,!0,G),ee("update",N),z&&ee("set",N)}function ic(N){if(N===void 0&&(N=!1),N)return m.length===1?m[0]:m.slice(0);var P=m.map(e.format.to);return P.length===1?P[0]:P}function Bv(){for(Zt(Qt.aria),Zt(Qt.tooltips),Object.keys(e.cssClasses).forEach(function(N){Ki(o,e.cssClasses[N])});o.firstChild;)o.removeChild(o.firstChild);delete o.noUiSlider}function rc(N){var P=g[N],z=h.getNearbySteps(P),G=m[N],Q=z.thisStep.step,Z=null;if(e.snap)return[G-z.stepBefore.startValue||null,z.stepAfter.startValue-G||null];Q!==!1&&G+Q>z.stepAfter.startValue&&(Q=z.stepAfter.startValue-G),G>z.thisStep.startValue?Z=z.thisStep.step:z.stepBefore.step===!1?Z=!1:Z=G-z.stepBefore.highestStep,P===100?Q=null:P===0&&(Z=null);var ae=h.countStepDecimals();return Q!==null&&Q!==!1&&(Q=Number(Q.toFixed(ae))),Z!==null&&Z!==!1&&(Z=Number(Z.toFixed(ae))),[Z,Q]}function qv(){return p.map(rc)}function Kv(N,P){var z=ic(),G=["margin","limit","padding","range","animate","snap","step","format","pips","tooltips","connect"];G.forEach(function(Z){N[Z]!==void 0&&(n[Z]=N[Z])});var Q=Wa(n);G.forEach(function(Z){N[Z]!==void 0&&(e[Z]=Q[Z])}),h=Q.spectrum,e.margin=Q.margin,e.limit=Q.limit,e.padding=Q.padding,e.pips?xe(e.pips):ce(),e.tooltips?U():H(),g=[],Gi(rs(N.start)?N.start:z,P),N.connect&&sc()}function sc(){for(;a.firstChild;)a.removeChild(a.firstChild);for(var N=0;N<=e.handles;N++)u[N]=O(a,e.connect[N]),Zn(N);Wi({drag:e.events.drag,fixed:!0})}function Wv(){C=!C,qa(e,e.connect.map(function(N){return!N})),sc()}function Gv(){l=B(o),D(e.connect,l),Wi(e.events),Gi(e.start),e.pips&&xe(e.pips),e.tooltips&&U(),Y()}Gv();var Yi={destroy:Bv,steps:qv,on:ln,off:Zt,get:ic,set:Gi,setHandle:Uv,reset:Hv,disable:x,enable:F,__moveHandles:function(N,P,z){ue(N,P,g,z)},options:n,updateOptions:Kv,target:o,removePips:ce,removeTooltips:H,getPositions:function(){return g.slice()},getTooltips:function(){return f},getOrigins:function(){return c},pips:xe};return Yi}function X1(t,e){if(!t||!t.nodeName)throw new Error("noUiSlider: create requires a single element, got: "+t);if(t.noUiSlider)throw new Error("noUiSlider: Slider was already initialized.");var n=Wa(e),i=Y1(t,n,e);return t.noUiSlider=i,i}const J1={__spectrum:Ha,cssClasses:Ba,create:X1},Ny="",Ty="";function Q1(t){let e,n,i,r,s,o,l,a,c,u,d,f,h,m,g,p;return{c(){e=k("div"),n=k("span"),i=ne(t[2]),r=ne(" ("),s=ne(t[3]),o=ne(")"),l=q(),a=k("div"),c=k("span"),u=ne(t[0]),d=q(),f=k("div"),h=k("div"),m=q(),g=k("span"),p=ne(t[1]),v(c,"class","range-marker svelte-216mtn"),v(h,"class","slider"),v(h,"id",t[4]),v(f,"class","slider-wrapper svelte-216mtn"),v(g,"class","range-marker svelte-216mtn"),v(a,"class","slider-outer-wrapper is-flex flex-direction-row svelte-216mtn")},m(_,w){j(_,e,w),y(e,n),y(n,i),y(n,r),y(n,s),y(n,o),y(e,l),y(e,a),y(a,c),y(c,u),y(a,d),y(a,f),y(f,h),y(a,m),y(a,g),y(g,p)},p(_,[w]){w&4&&me(i,_[2]),w&8&&me(s,_[3]),w&1&&me(u,_[0]),w&2&&me(p,_[1])},i:X,o:X,d(_){_&&$(e)}}}function Z1(t,e,n){let i,{minVal:r}=e,{maxVal:s}=e,{start:o}=e,{step:l=void 0}=e,{roundTo:a=2}=e,{title:c=""}=e,{emitOnUpdate:u=!1}=e;const d=ai(),f=`slider-${window.crypto.randomUUID()}`,h=Array.isArray(o)&&o.length===2&&o.every(E=>!isNaN(parseFloat(E))),m=[],g=h?[`noUi-handle-${window.crypto.randomUUID()}`,`noUi-handle-${window.crypto.randomUUID()}`]:[`noUi-handle-${window.crypto.randomUUID()}`],p=ui();p.setCompareFn(h?cr:(E,A)=>w(E)===w(A)),p.set(o);const _=ht("resetTrigger")||void 0;_==null||_.subscribe(I);const w=E=>Number(E.toFixed(a)),C=(E,A)=>{E=Array.isArray(E)?E.map(w):w(E),n(3,i=E),(A==="set"||A==="update"&&u)&&(p.set(E),p.same()||d("updateSlider",p.get()))};function b(E){m.length&&m.map((A,O)=>A.$set({tooltipText:h?E[O]:E}))}function I(){const E=document.getElementById(f);E!=null&&E.noUiSlider&&E.noUiSlider.reset()}function T(){const E=document.getElementById(f);let A;J1.create(E,{start:o,step:l,connect:h?!0:"lower",range:{min:r,max:s},handleAttributes:g.map(O=>({id:O}))}),E.noUiSlider.on("update",()=>{A=E.noUiSlider.get(!0),C(A,"update")}),E.noUiSlider.on("set",()=>{A=E.noUiSlider.get(!0),C(A,"set")})}function M(){g.map((E,A)=>{m.push(new zi({target:document.getElementById(E),props:h?{tooltipText:i[A]}:{tooltipText:i}}))})}return Nn(()=>{T(),M()}),Tn(()=>{document.getElementById(f)&&(document.getElementById(f).innerHTML="")}),t.$$set=E=>{"minVal"in E&&n(0,r=E.minVal),"maxVal"in E&&n(1,s=E.maxVal),"start"in E&&n(5,o=E.start),"step"in E&&n(6,l=E.step),"roundTo"in E&&n(7,a=E.roundTo),"title"in E&&n(2,c=E.title),"emitOnUpdate"in E&&n(8,u=E.emitOnUpdate)},t.$$.update=()=>{t.$$.dirty&32&&n(3,i=o),t.$$.dirty&8&&b(i)},[r,s,c,i,f,o,l,a,u]}class Jn extends ye{constructor(e){super(),ve(this,e,Z1,Q1,pe,{minVal:0,maxVal:1,start:5,step:6,roundTo:7,title:2,emitOnUpdate:8})}}const Oy="";function ev(t){let e,n,i,r,s,o,l,a,c,u,d,f,h,m,g,p,_,w,C,b,I,T,M,E,A,O,D,B,R,S,L,x,F,H,U,Y,J,ie,he;return c=new Jn({props:{minVal:0,maxVal:1,start:t[5],emitOnUpdate:!0,title:W==="fr"?"Opacité":"Opacity"}}),c.$on("updateSlider",t[9]),f=new Jn({props:{minVal:0,maxVal:360,start:t[6],step:1,emitOnUpdate:!0,title:"Rotation"}}),f.$on("updateSlider",t[10]),g=new Jn({props:{minVal:0,maxVal:200,step:1,start:t[7],emitOnUpdate:!0,title:W==="fr"?"Redimensionner":"Scale"}}),g.$on("updateSlider",t[11]),w=new Jn({props:{minVal:-100,maxVal:100,step:1,start:t[8][0],emitOnUpdate:!0,title:W==="fr"?"Translation horizontale":"Horizontal translate"}}),w.$on("updateSlider",t[12]),I=new Jn({props:{minVal:-100,maxVal:100,step:1,start:t[8][1],emitOnUpdate:!0,title:W==="fr"?"Translation verticale":"Vertical translate"}}),I.$on("updateSlider",t[13]),E=new h1({props:{choicesItems:t[4],start:[],lightDisplay:!0,placeholder:W==="fr"?"Sélectionner":"Select",title:W==="fr"?"Basculer":"Flip"}}),E.$on("updateValues",t[14]),{c(){e=k("div"),n=k("div"),i=k("div"),r=k("div"),s=k("strong"),s.textContent=`${W==="en"?"Query image transformation":"Modification de l'image requête"}`,o=q(),l=k("div"),a=k("div"),le(c.$$.fragment),u=q(),d=k("div"),le(f.$$.fragment),h=q(),m=k("div"),le(g.$$.fragment),p=q(),_=k("div"),le(w.$$.fragment),C=q(),b=k("div"),le(I.$$.fragment),T=q(),M=k("div"),le(E.$$.fragment),A=q(),O=k("div"),D=k("button"),D.textContent=`${W==="fr"?"Réinitialiser":"Reset"}`,B=q(),R=k("div"),S=k("img"),F=q(),H=k("img"),v(r,"class","toolbar-title mt-0 mb-2 svelte-nzei31"),v(a,"class"," svelte-nzei31"),v(d,"class"," svelte-nzei31"),v(m,"class"," svelte-nzei31"),v(_,"class"," svelte-nzei31"),v(b,"class"," svelte-nzei31"),v(M,"class"," svelte-nzei31"),v(D,"class","button is-link"),v(O,"class","mt-2 is-flex is-flex-direction-column is-justify-content-center is-align-items-flex-end svelte-nzei31"),v(l,"class","toolbar-controls is-flex is-flex-direction-column is-align-items-start is-justify-content-center svelte-nzei31"),v(i,"class","toolbar svelte-nzei31"),v(n,"class","toolbar-wrapper is-flex is-flex-direction-column is-justify-content-center is-align-items-center svelte-nzei31"),v(S,"class","compare-img svelte-nzei31"),ft(S.src,L=t[0].queryImage.href)||v(S,"src",L),v(S,"alt",x=t[0].queryImage.title),v(H,"class","main-img svelte-nzei31"),ft(H.src,U=t[0].similarityImage.href)||v(H,"src",U),v(H,"alt",Y=t[0].similarityImage.title),Pe(H,"overlay-reset",t[2]),Le(H,"opacity",t[1]),Le(H,"transform",t[3]),v(R,"class","overlay-wrapper svelte-nzei31"),v(e,"class","similarity-overlay-wrapper svelte-nzei31")},m(te,ce){j(te,e,ce),y(e,n),y(n,i),y(i,r),y(r,s),y(i,o),y(i,l),y(l,a),se(c,a,null),y(l,u),y(l,d),se(f,d,null),y(l,h),y(l,m),se(g,m,null),y(l,p),y(l,_),se(w,_,null),y(l,C),y(l,b),se(I,b,null),y(l,T),y(l,M),se(E,M,null),y(l,A),y(l,O),y(O,D),y(e,B),y(e,R),y(R,S),y(R,F),y(R,H),J=!0,ie||(he=Se(D,"click",t[15]),ie=!0)},p(te,[ce]){(!J||ce&1&&!ft(S.src,L=te[0].queryImage.href))&&v(S,"src",L),(!J||ce&1&&x!==(x=te[0].queryImage.title))&&v(S,"alt",x),(!J||ce&1&&!ft(H.src,U=te[0].similarityImage.href))&&v(H,"src",U),(!J||ce&1&&Y!==(Y=te[0].similarityImage.title))&&v(H,"alt",Y),(!J||ce&4)&&Pe(H,"overlay-reset",te[2]),ce&2&&Le(H,"opacity",te[1]),ce&8&&Le(H,"transform",te[3])},i(te){J||(V(c.$$.fragment,te),V(f.$$.fragment,te),V(g.$$.fragment,te),V(w.$$.fragment,te),V(I.$$.fragment,te),V(E.$$.fragment,te),J=!0)},o(te){K(c.$$.fragment,te),K(f.$$.fragment,te),K(g.$$.fragment,te),K(w.$$.fragment,te),K(I.$$.fragment,te),K(E.$$.fragment,te),J=!1},d(te){te&&$(e),oe(c),oe(f),oe(g),oe(w),oe(I),oe(E),ie=!1,he()}}}function tv(t,e,n){let i,{imgData:r}=e;const s=[{value:"h",label:W==="fr"?"Basculer horizontalement":"Flip horizontally"},{value:"v",label:W==="fr"?"Basculer verticalement":"Flip vertically"},{value:"hv",label:W==="fr"?"Basculer horizontalement et verticalement":"Flip horizontally and vertically"}];let o=.5;const l=o;let a=0;const c=a;let u=100;const d=u;let f=[1,1];const h=structuredClone(f);let m=[0,0];const g=structuredClone(m);let p=!1;const _=be(window.crypto.randomUUID());hn("resetTrigger",_);const w=A=>n(1,o=A.detail),C=A=>n(16,a=A.detail),b=A=>n(17,u=A.detail),I=A=>n(19,m=[A.detail,m[1]]),T=A=>n(19,m=[m[0],A.detail]),M=A=>{let O=A.detail[0];n(18,f=O==="hv"?[-1,-1]:O==="h"?[-1,1]:O==="v"?[1,-1]:[1,1])},E=()=>{n(1,o=l),n(16,a=c),n(17,u=d),n(18,f=h),n(19,m=g),_.set(window.crypto.randomUUID()),n(2,p=!0),setTimeout(()=>n(2,p=!1),1e3)};return t.$$set=A=>{"imgData"in A&&n(0,r=A.imgData)},t.$$.update=()=>{t.$$.dirty&983040&&n(3,i=`translate(${m[0]-50}%, ${m[1]}%)
                        rotate(${a}deg)
                        scale(${f.map(A=>A*(u/100)).join()})`)},[r,o,p,i,s,l,c,d,g,w,C,b,I,T,M,E,a,u,f,m]}class nv extends ye{constructor(e){super(),ve(this,e,tv,ev,pe,{imgData:0})}}function iv(){const t=`${window.location.origin}${window.location.pathname}`,e=25,n=window.location.pathname.match(/\d+/g).join("-"),i={[n]:{}},r=[2,6],s=be(1),o=be({}),l=be(JSON.parse(localStorage.getItem("selectedRegions"))||i);l.subscribe(B=>localStorage.setItem("selectedRegions",JSON.stringify(B)));const a=be(JSON.parse(localStorage.getItem("excludedCategories"))||[]);a.subscribe(B=>localStorage.setItem("excludedCategories",JSON.stringify(B)));const c=be(JSON.parse(localStorage.getItem("similarityScoreCutoff"))||void 0);c.subscribe(B=>{B!=null&&localStorage.setItem("similarityScoreCutoff",JSON.stringify(B))});const u=be(JSON.parse(localStorage.getItem("propagateRecursionDepth"))||r[1]);u.subscribe(B=>localStorage.setItem("propagateRecursionDepth",JSON.stringify(B)));const d=be(JSON.parse(localStorage.getItem("propagateFilterByRegions"))||!1);d.subscribe(B=>localStorage.setItem("propagateFilterByRegions",JSON.stringify(B)));const f=Ue([u,d],([B,R])=>({propagateRecursionDepth:B,propagateFilterByRegions:R})),h=Ue([a,l,c],([B,R,S])=>({excludedCategories:B,regions:R,similarityScoreCutoff:S})),m=Ue([f,h],([B,R])=>({propagate:B,similarity:R})),g=be([]),p=be([]);async function _(){const B=async()=>{const L=await(await fetch(`${t}compared-regions`)).json();o.set(L),l.update(x=>{let F=x[n]||{};if(Object.keys(F).length){let H=Object.keys(F).filter(U=>Object.keys(L).includes(U)).reduce((U,Y)=>(U[Y]=F[Y],U),{});x[n]=H}return x})},R=async()=>{const L=await(await fetch(`${t}query-images`)).json();L.length>0&&(g.set(L),O(M()))};Pn.set(!0);try{await Promise.all([B(),R()])}catch(S){console.error("Error:",S),Dc.set(S.message)}finally{Pn.set(!1)}}function w(B){localStorage.setItem("selectedRegions",JSON.stringify(B))}function C(B){l.update(R=>{const S={...R};return delete S[n][B],w(S),S})}function b(B){l.update(R=>{const S={...R,[n]:{...R[n]||{},[B.ref]:B}};return w(S),S})}const I=Ue(l,B=>R=>{var S;return(S=B[n])==null?void 0:S.hasOwnProperty(R)});function T(B){const R=et(o),S=Object.keys(R).filter(L=>L.startsWith(B));return S.length!==1?{title:"Error"}:R[S[0]]}const M=()=>lr(s,"sp"),E=Ue([s,g],([B,R])=>(async()=>A(B,R))());function A(B,R){const S=(B-1)*e,L=S+e,x=R.slice(S,L);return p.set(x),x}function O(B){ar(B,s,"sp")}function D(B){o.update(R=>({...R,[B.ref]:B}))}return{currentPage:s,comparedRegions:o,excludedCategories:a,qImgs:g,pageQImgs:p,selectedRegions:l,propagateRecursionDepth:u,propagateFilterByRegions:d,similarityToolbarParams:m,propagateParams:f,similarityScoreCutoff:c,allowedPropagateDepthRange:r,fetchSimilarity:_,setPageQImgs:E,getRegionsInfo:T,handlePageUpdate:O,unselect:C,select:b,addComparedRegions:D,isSelected:I,pageLength:e}}const Ut=iv(),{getRegionsInfo:rv}=Ut;async function Ga(t,e,n,i,r,s,o=!1,l=!0){const a=()=>l?`<b>${!isNaN(parseFloat(n))&&e===1?`Score: ${n}`:e===2&&W==="en"?"Manual similarity":e===2&&W==="fr"?"Correspondance manuelle":e===3&&W==="en"?"Propagated match":"Correspondance propagée"}</b>`:"",c=u=>`${u}<br>
        Page ${parseInt(i)}<br>
        ${a()}`;return o===!0?fetch(`${r}${s}get_regions_title/${t}`).then(u=>u.json()).then(u=>c(u.title)).catch(u=>(console.error("similarity.utils.getDesc()",u),c(W==="fr"?"Titre inconnu":"Unknown title"))):Promise.resolve(c(rv(t).title))}function Ya(t,e,n){const i=t.slice();return i[16]=e[n],i}function Xa(t){let e,n,i=t[16]==="queryImage"&&W==="fr"?"Image requête":t[16]==="similarityImage"&&W==="fr"?"Similarité":t[16]==="queryImage"&&W==="en"?"Query image":"Similarity",r,s,o,l,a;return o=new In({props:{item:t[0][t[16]],descPromise:t[1][t[16]],height:"full"}}),{c(){e=k("div"),n=k("span"),r=ne(i),s=q(),le(o.$$.fragment),l=q(),v(e,"class","img-legend-wrapper column is-flex is-flex-direction-column is-justify-content-center is-align-items-center")},m(c,u){j(c,e,u),y(e,n),y(n,r),y(e,s),se(o,e,null),y(e,l),a=!0},p(c,u){const d={};u&1&&(d.item=c[0][c[16]]),o.$set(d)},i(c){a||(V(o.$$.fragment,c),a=!0)},o(c){K(o.$$.fragment,c),a=!1},d(c){c&&$(e),oe(o)}}}function sv(t){let e,n,i=["queryImage","similarityImage"],r=[];for(let o=0;o<2;o+=1)r[o]=Xa(Ya(t,i,o));const s=o=>K(r[o],1,1,()=>{r[o]=null});return{c(){e=k("div");for(let o=0;o<2;o+=1)r[o].c();v(e,"class","side-by-side columns")},m(o,l){j(o,e,l);for(let a=0;a<2;a+=1)r[a]&&r[a].m(e,null);n=!0},p(o,[l]){if(l&3){i=["queryImage","similarityImage"];let a;for(a=0;a<2;a+=1){const c=Ya(o,i,a);r[a]?(r[a].p(c,l),V(r[a],1)):(r[a]=Xa(c),r[a].c(),V(r[a],1),r[a].m(e,null))}for(Ee(),a=2;a<2;a+=1)s(a);Ce()}},i(o){if(!n){for(let l=0;l<2;l+=1)V(r[l]);n=!0}},o(o){r=r.filter(Boolean);for(let l=0;l<2;l+=1)K(r[l]);n=!1},d(o){o&&$(e),ot(r,o)}}}function ov(t,e,n){let{imgData:i}=e;const r=ht("similarityPair"),s=new URL(window.location.href),o=s.origin,l=s.pathname,[a,c,u,d]=r.qImg.split(".")[0].split("_"),[f,h,m,g]=r.sImg.split(".")[0].split("_"),p=`${a}_${c}`,_=`${f}_${h}`,w={queryImage:Ga(p,r.similarityType,r.score,u,o,l,!0,!1),similarityImage:Ga(_,r.similarityType,r.score,m,o,l,!0,!0)};return t.$$set=C=>{"imgData"in C&&n(0,i=C.imgData)},[i,w]}class lv extends ye{constructor(e){super(),ve(this,e,ov,sv,pe,{imgData:0})}}const Py="";function av(t){let e,n;return e=new lv({props:{imgData:t[2]}}),{c(){le(e.$$.fragment)},m(i,r){se(e,i,r),n=!0},p:X,i(i){n||(V(e.$$.fragment,i),n=!0)},o(i){K(e.$$.fragment,i),n=!1},d(i){oe(e,i)}}}function cv(t){let e,n;return e=new nv({props:{imgData:t[1]}}),{c(){le(e.$$.fragment)},m(i,r){se(e,i,r),n=!0},p:X,i(i){n||(V(e.$$.fragment,i),n=!0)},o(i){K(e.$$.fragment,i),n=!1},d(i){oe(e,i)}}}function uv(t){let e,n,i,r,s,o,l,a,c;const u=[cv,av],d=[];function f(h,m){return h[0]?0:1}return i=f(t),r=d[i]=u[i](t),a=new L_({props:{start:!1,buttonDisplay:!0,toggleLabel:W==="en"?"Overlay view":"Vue superposée"}}),a.$on("updateChecked",t[3]),{c(){e=k("div"),n=k("div"),r.c(),o=q(),l=k("div"),le(a.$$.fragment),v(n,"class",s="modal-similarity-images "+(t[0]?"overlay-wrapper":"side-by-side-wrapper")+" svelte-1qvtan5"),v(e,"class","modal-similarity svelte-1qvtan5")},m(h,m){j(h,e,m),y(e,n),d[i].m(n,null),y(e,o),y(e,l),se(a,l,null),c=!0},p(h,[m]){let g=i;i=f(h),i===g?d[i].p(h,m):(Ee(),K(d[g],1,1,()=>{d[g]=null}),Ce(),r=d[i],r?r.p(h,m):(r=d[i]=u[i](h),r.c()),V(r,1),r.m(n,null)),(!c||m&1&&s!==(s="modal-similarity-images "+(h[0]?"overlay-wrapper":"side-by-side-wrapper")+" svelte-1qvtan5"))&&v(n,"class",s)},i(h){c||(V(r),V(a.$$.fragment,h),c=!0)},o(h){K(r),K(a.$$.fragment,h),c=!1},d(h){h&&$(e),d[i].d(),oe(a)}}}function fv(t,e,n){let{mainImgItem:i}=e,{compareImgItem:r}=e;const s={similarityImage:{href:Mt(i.img,i.img.split("_").pop()),title:a(i.title)},queryImage:{href:Mt(r.img,r.img.split("_").pop()),title:a(r.title)}},o={similarityImage:i,queryImage:r};let l=!1;function a(u){return W==="fr"?`Vue principale de la région ${u}`:`Main view of region ${u}`}const c=()=>n(0,l=!l);return t.$$set=u=>{"mainImgItem"in u&&n(4,i=u.mainImgItem),"compareImgItem"in u&&n(5,r=u.compareImgItem)},[l,s,o,c,i,r]}class hv extends ye{constructor(e){super(),ve(this,e,fv,uv,pe,{mainImgItem:4,compareImgItem:5})}}const dv=Object.freeze(Object.defineProperty({__proto__:null,default:hv},Symbol.toStringTag,{value:"Module"})),Ja=(t,e,n,i)=>({id:t,img:t,title:`Canvas ${i} - ${n} - ${W==="en"?"Witness":"Témoin"} #${sr(e)}`,xywh:n.split(",").map(Number),canvas:i,ref:t.replace(".jpg",""),type:Nc});function mv(t){let e,n,i,r,s,o,l,a,c,u,d;return n=new yn({props:{category:1,isSelected:t[0]===1,toggle:t[4],padding:"pl-3 pr-2"}}),r=new yn({props:{category:2,isSelected:t[0]===2,toggle:t[4]}}),o=new yn({props:{category:3,isSelected:t[0]===3,toggle:t[4]}}),a=new yn({props:{category:4,isSelected:t[0]===4,toggle:t[4]}}),u=new yn({props:{category:5,isSelected:t[0]===5,toggle:t[4],padding:"pl-2 pr-3"}}),{c(){e=k("div"),le(n.$$.fragment),i=q(),le(r.$$.fragment),s=q(),le(o.$$.fragment),l=q(),le(a.$$.fragment),c=q(),le(u.$$.fragment),v(e,"class","tags has-addons is-dark is-center")},m(f,h){j(f,e,h),se(n,e,null),y(e,i),se(r,e,null),y(e,s),se(o,e,null),y(e,l),se(a,e,null),y(e,c),se(u,e,null),d=!0},p(f,h){const m={};h&1&&(m.isSelected=f[0]===1),n.$set(m);const g={};h&1&&(g.isSelected=f[0]===2),r.$set(g);const p={};h&1&&(p.isSelected=f[0]===3),o.$set(p);const _={};h&1&&(_.isSelected=f[0]===4),a.$set(_);const w={};h&1&&(w.isSelected=f[0]===5),u.$set(w)},i(f){d||(V(n.$$.fragment,f),V(r.$$.fragment,f),V(o.$$.fragment,f),V(a.$$.fragment,f),V(u.$$.fragment,f),d=!0)},o(f){K(n.$$.fragment,f),K(r.$$.fragment,f),K(o.$$.fragment,f),K(a.$$.fragment,f),K(u.$$.fragment,f),d=!1},d(f){f&&$(e),oe(n),oe(r),oe(o),oe(a),oe(u)}}}function pv(t){let e,n,i,r;n=new In({props:{item:t[3],size:256,selectable:!1,isSquare:!1}});let s=!t[2]&&mv(t);return{c(){e=k("div"),le(n.$$.fragment),i=q(),s&&s.c()},m(o,l){j(o,e,l),se(n,e,null),y(e,i),s&&s.m(e,null),r=!0},p(o,[l]){o[2]||s.p(o,l)},i(o){r||(V(n.$$.fragment,o),V(s),r=!0)},o(o){K(n.$$.fragment,o),K(s),r=!1},d(o){o&&$(e),oe(n),s&&s.d()}}}function gv(t,e,n){let i,r,s;const{comparedRegions:o}=Ut;ge(t,o,R=>n(15,s=R));const l=new URL(window.location.href),a=l.origin;l.pathname;let{qImg:c}=e,{sImg:u}=e,{qRegions:d}=e,{sRegions:f}=e,{score:h=0}=e,{category:m=null}=e,{users:g=[]}=e,{isManual:p}=e,{similarityType:_}=e;const w=ht("isInModal")||!1,[C,b,I,T]=u.split(".")[0].split("_"),E=(()=>{let R=Ja(u,C,T,I);const S=s[`${C}_${b}_anno${f}`]||{title:R.title};return R.title=`${or(S.title.replace(/^[^|]+/,""))}<br/>Page ${$c(I)}<br/><b>Score: ${h}</b>`,R})();hn("similarityPair",{qImg:c,sImg:u,qRegions:d,sRegions:f,score:h,category:m,users:g,isManual:p,similarityType:_});function A(R){R=R.slice();let S=R.indexOf(Number(rr));return r&&S===-1?R.push(Number(rr)):!r&&S!==-1&&R.splice(S,1),R}const O=()=>({img_1:c,img_2:u,regions_id_1:d,regions_id_2:f,score:h,category:i,category_x:A(g),is_manual:p||_===2,similarity_type:_});function D(R){R===5?r=!r:n(0,i=i===R?null:R)}async function B(R){D(R);try{(await fetch(`${a}/${wt}/save-category`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":Kt},body:JSON.stringify(O())})).ok||(console.error("Error: Network response was not ok"),D(R))}catch(S){console.error("Error:",S),D(R)}}return t.$$set=R=>{"qImg"in R&&n(5,c=R.qImg),"sImg"in R&&n(6,u=R.sImg),"qRegions"in R&&n(7,d=R.qRegions),"sRegions"in R&&n(8,f=R.sRegions),"score"in R&&n(9,h=R.score),"category"in R&&n(10,m=R.category),"users"in R&&n(11,g=R.users),"isManual"in R&&n(12,p=R.isManual),"similarityType"in R&&n(13,_=R.similarityType)},t.$$.update=()=>{t.$$.dirty&1024&&n(0,i=m),t.$$.dirty&2048&&(r=g.includes(Number(rr))||!1)},[i,o,w,E,B,c,u,d,f,h,m,g,p,_]}class _v extends ye{constructor(e){super(),ve(this,e,gv,pv,pe,{qImg:5,sImg:6,qRegions:7,sRegions:8,score:9,category:10,users:11,isManual:12,similarityType:13})}}function Qa(t,e,n){const i=t.slice();return i[22]=e[n].uuid,i[23]=e[n].data[0],i[24]=e[n].data[1],i[25]=e[n].data[2],i[26]=e[n].data[3],i[27]=e[n].data[4],i[28]=e[n].data[5],i[29]=e[n].data[6],i[30]=e[n].data[7],i[31]=e[n].data[8],i}function vv(t){let e,n=W==="en"?`Error when retrieving similar regions: ${t[2]}`:`Erreur de recupération des régions similaires: ${t[2]}`,i;return{c(){e=k("div"),i=ne(n),v(e,"class","faded is-center")},m(r,s){j(r,e,s),y(e,i)},p(r,s){s[0]&4&&n!==(n=W==="en"?`Error when retrieving similar regions: ${r[2]}`:`Erreur de recupération des régions similaires: ${r[2]}`)&&me(i,n)},i:X,o:X,d(r){r&&$(e)}}}function yv(t){let e,n,i=t[4].length+"",r,s,o=t[11](t[10],t[4].length)+"",l,a,c,u=[],d=new Map,f,h=t[4];const m=p=>p[22];for(let p=0;p<h.length;p+=1){let _=Qa(t,h,p),w=m(_);d.set(w,u[p]=ec(w,_))}let g=null;return h.length||(g=Za(t)),{c(){e=k("div"),n=k("span"),r=ne(i),s=q(),l=ne(o),a=q(),c=k("div");for(let p=0;p<u.length;p+=1)u[p].c();g&&g.c(),v(n,"class","m-2"),v(c,"class","m-2 is-gap-2"),Pe(c,"grid",t[4].length>0)},m(p,_){j(p,e,_),y(e,n),y(n,r),y(n,s),y(n,l),y(e,a),y(e,c);for(let w=0;w<u.length;w+=1)u[w]&&u[w].m(c,null);g&&g.m(c,null),f=!0},p(p,_){(!f||_[0]&16)&&i!==(i=p[4].length+"")&&me(r,i),(!f||_[0]&16)&&o!==(o=p[11](p[10],p[4].length)+"")&&me(l,o),_[0]&49&&(h=p[4],Ee(),u=ir(u,_,m,1,p,h,d,c,nr,ec,null,Qa),Ce(),!h.length&&g?g.p(p,_):h.length?g&&(g.d(1),g=null):(g=Za(p),g.c(),g.m(c,null))),(!f||_[0]&16)&&Pe(c,"grid",p[4].length>0)},i(p){if(!f){for(let _=0;_<h.length;_+=1)V(u[_]);f=!0}},o(p){for(let _=0;_<u.length;_+=1)K(u[_]);f=!1},d(p){p&&$(e);for(let _=0;_<u.length;_+=1)u[_].d();g&&g.d()}}}function bv(t){let e;return{c(){e=k("div"),e.textContent=`${W==="en"&&!t[10]?"Retrieving similar regions...":W==="fr"&&!t[10]?"Récupération des régions similaires...":W==="en"&&t[10]?"Retrieving propagated regions...":"Récupération de similarités propagées..."}`,v(e,"class","faded is-center")},m(n,i){j(n,e,i)},p:X,i:X,o:X,d(n){n&&$(e)}}}function Za(t){let e;function n(s,o){return s[5]?Sv:wv}let i=n(t),r=i(t);return{c(){r.c(),e=Ke()},m(s,o){r.m(s,o),j(s,e,o)},p(s,o){i===(i=n(s))&&r?r.p(s,o):(r.d(1),r=i(s),r&&(r.c(),r.m(e.parentNode,e)))},d(s){r.d(s),s&&$(e)}}}function wv(t){let e;return{c(){e=k("div"),e.textContent=`${W==="en"?"No similar regions":"Pas de régions similaires"}
                    `,v(e,"class","faded is-center")},m(n,i){j(n,e,i)},p:X,d(n){n&&$(e)}}}function Sv(t){let e;return{c(){e=k("div"),e.textContent=`${W==="en"?"No document selected. Select one to display results.":"Aucun document sélectionné. Sélectionnez-en un pour afficher les résultats."}
                    `,v(e,"class","faded is-center")},m(n,i){j(n,e,i)},p:X,d(n){n&&$(e)}}}function ec(t,e){let n,i,r;return i=new _v({props:{qImg:e[0],sImg:e[25],score:e[23],qRegions:e[26],sRegions:e[27],category:e[28],users:e[29],isManual:e[30],similarityType:e[31]}}),{key:t,first:null,c(){n=Ke(),le(i.$$.fragment),this.first=n},m(s,o){j(s,n,o),se(i,s,o),r=!0},p(s,o){e=s;const l={};o[0]&1&&(l.qImg=e[0]),o[0]&16&&(l.sImg=e[25]),o[0]&16&&(l.score=e[23]),o[0]&16&&(l.qRegions=e[26]),o[0]&16&&(l.sRegions=e[27]),o[0]&16&&(l.category=e[28]),o[0]&16&&(l.users=e[29]),o[0]&16&&(l.isManual=e[30]),o[0]&16&&(l.similarityType=e[31]),i.$set(l)},i(s){r||(V(i.$$.fragment,s),r=!0)},o(s){K(i.$$.fragment,s),r=!1},d(s){s&&$(n),oe(i,s)}}}function kv(t){let e,n,i,r;const s=[bv,yv,vv],o=[];function l(a,c){return a[1]&&a[3]==="loading"?0:a[3]==="loaded"?1:a[3]==="error"?2:-1}return~(e=l(t))&&(n=o[e]=s[e](t)),{c(){n&&n.c(),i=Ke()},m(a,c){~e&&o[e].m(a,c),j(a,i,c),r=!0},p(a,c){let u=e;e=l(a),e===u?~e&&o[e].p(a,c):(n&&(Ee(),K(o[u],1,1,()=>{o[u]=null}),Ce()),~e?(n=o[e],n?n.p(a,c):(n=o[e]=s[e](a),n.c()),V(n,1),n.m(i.parentNode,i)):n=null)},i(a){r||(V(n),r=!0)},o(a){K(n),r=!1},d(a){~e&&o[e].d(a),a&&$(i)}}}function Ev(t,e,n){let i,r,s,o,l,a,c,u,{qImg:d}=e,{sImgsPromise:f}=e;const{selectedRegions:h,excludedCategories:m,similarityScoreCutoff:g,propagateFilterByRegions:p}=Ut;ge(t,h,A=>n(16,u=A)),ge(t,m,A=>n(15,c=A)),ge(t,g,A=>n(14,a=A)),ge(t,p,A=>n(13,l=A));const _=ht("similarityPropagatedContext")||!1,w=window.location.pathname.match(/\d+/g).join("-");let C;const b=(A,O)=>A===null||O===void 0||Number(A)>=O,I=(A,O,D)=>!D.includes(A),T=(A,O,D,B,R,S)=>_?!0:b(A,R)&&I(O,D,B),M=(A,O,D,B)=>A.filter(({uuid:R,data:[S,L,x,F,H,U,Y,J,ie]})=>T(S,U,Y,O,D)),E=(A,O)=>{const D=O>1;return A?W==="fr"?D?"similarités propagées":"similarité propagée":D?"propagated matches":"propagated match":W==="fr"?D?"images similaires":"image similaire":D?"similar images":"similar image"};return t.$$set=A=>{"qImg"in A&&n(0,d=A.qImg),"sImgsPromise"in A&&n(1,f=A.sImgsPromise)},t.$$.update=()=>{t.$$.dirty[0]&65536&&n(5,i=Object.values(u).length===0||u[w]===void 0||!Object.keys(u[w]).length),t.$$.dirty[0]&2&&(A=>{n(3,r="loading"),n(4,o=[]),n(12,s=[])})(),t.$$.dirty[0]&2&&f.then(A=>{n(12,s=A.map(O=>({uuid:window.crypto.randomUUID(),data:O}))),n(3,r="loaded")}).catch(A=>{n(2,C=A),n(3,r="error")}),t.$$.dirty[0]&61440&&n(4,o=M(s,c,a))},n(3,r="loading"),n(12,s=[]),[d,f,C,r,o,i,h,m,g,p,_,E,s,l,a,c,u]}class tc extends ye{constructor(e){super(),ve(this,e,Ev,kv,pe,{qImg:0,sImgsPromise:1},null,[-1,-1])}}function Cv(t){let e,n;return e=new tc({props:{qImg:t[0],sImgsPromise:t[1]}}),{c(){le(e.$$.fragment)},m(i,r){se(e,i,r),n=!0},p(i,[r]){const s={};r&1&&(s.qImg=i[0]),r&2&&(s.sImgsPromise=i[1]),e.$set(s)},i(i){n||(V(e.$$.fragment,i),n=!0)},o(i){K(e.$$.fragment,i),n=!1},d(i){oe(e,i)}}}function Iv(t,e,n){let i,r,{qImg:s}=e,o;const l=ht("isInModal")||!1,{selectedRegions:a,comparedRegions:c}=Ut;ge(t,a,m=>n(4,i=m)),ge(t,c,m=>n(5,r=m));const u=`${window.location.origin}${window.location.pathname}`,d=window.location.pathname.match(/\d+/g).join("-"),f=(m,g)=>g?Object.keys(r).map(p=>r[p].id):Object.values(m[d]||{}).map(p=>p.id);async function h(m,g,p){const _=f(g,p);return _.length===0?[]:await(await fetch(`${u}similar-images`,{method:"POST",body:JSON.stringify({regionsIds:_,qImg:m,topk:12}),headers:{"Content-Type":"application/json","X-CSRFToken":Kt}})).json()}return l?o=h(s,i,l):a.subscribe(m=>{n(1,o=h(s,m,l))}),t.$$set=m=>{"qImg"in m&&n(0,s=m.qImg)},[s,o,a,c]}class xv extends ye{constructor(e){super(),ve(this,e,Iv,Cv,pe,{qImg:0})}}const Ly="";function Mv(t){let e,n,i,r;return i=new tc({props:{qImg:t[0],sImgsPromise:t[1]}}),{c(){e=k("div"),n=k("div"),le(i.$$.fragment),v(n,"class","matches-suggestion svelte-1cb4wg0"),v(e,"class","block matches-suggestion-wrapper svelte-1cb4wg0")},m(s,o){j(s,e,o),y(e,n),se(i,n,null),r=!0},p(s,[o]){const l={};o&1&&(l.qImg=s[0]),o&2&&(l.sImgsPromise=s[1]),i.$set(l)},i(s){r||(V(i.$$.fragment,s),r=!0)},o(s){K(i.$$.fragment,s),r=!1},d(s){s&&$(e),oe(i)}}}function Av(t,e,n){let i,r,{qImg:s}=e;const{propagateParams:o,selectedRegions:l}=Ut;ge(t,o,p=>n(4,i=p)),ge(t,l,p=>n(5,r=p));const a=`${window.location.origin}${window.location.pathname}`,c=window.location.pathname.match(/\d+/g).join("-"),u=ht("isInModal")||!1;let d;const f=ui();f.setCompareFn((p,_)=>[p,_].every(w=>w&&w.hasOwnProperty("propagateRecursionDepth")&&w.hasOwnProperty("propagateFilterByRegions"))?p.propagateRecursionDepth===_.propagateRecursionDepth&&p.propagateFilterByRegions===_.propagateFilterByRegions:!1);const h=ui();h.setCompareFn(cr),hn("similarityPropagatedContext",!0);const m=p=>Object.keys(p).includes(c)?Object.values(p[c]).map(_=>_.id):[],g=async(p,_,w)=>fetch(`${a}propagated-matches/${s}`,{method:"POST",body:JSON.stringify({regionsIds:w?[]:_,filterByRegions:w?!1:p.propagateFilterByRegions,recursionDepth:p.propagateRecursionDepth}),headers:{"Content-Type":"application/json","X-CSRFToken":Kt}}).then(C=>C.json()).catch(C=>(console.error("PropagatedMatches.getPropagatedMatches:",C),[]));return o.subscribe(p=>{f.set(p),f.same()||n(1,d=g(f.get(),m(r),u))}),l.subscribe(p=>{h.set(m(p)),i.propagateFilterByRegions===!0&&!h.same()&&n(1,d=g(i,h.get(),u))}),t.$$set=p=>{"qImg"in p&&n(0,s=p.qImg)},[s,d,o,l]}class Nv extends ye{constructor(e){super(),ve(this,e,Av,Mv,pe,{qImg:0})}}const Dy="";function Tv(t){let e,n,i,r=parseInt(t[5])+"",s,o,l,a,c,u,d,f,h,m,g,p,_,w,C,b,I,T,M;return{c(){e=k("a"),n=k("i"),i=ne(`
            Page `),s=ne(r),o=q(),l=k("img"),c=q(),u=k("div"),d=k("div"),f=k("input"),h=q(),m=k("button"),m.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M256 80c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 144L48 224c-17.7 0-32 14.3-32 32s14.3 32 32 32l144 0 0 144c0 17.7 14.3 32 32 32s32-14.3 32-32l0-144 144 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-144 0 0-144z"></path></svg>',g=q(),p=k("button"),_=bt("svg"),w=bt("path"),v(n,"class","fa-solid fa-pen-to-square"),v(e,"class","tag px-2 py-1 mb-2 is-rounded is-hoverable"),v(e,"href",Hc(t[6],parseInt(t[5]))),v(e,"target","_blank"),ft(l.src,a=Mt(t[0],t[0].split("_").pop(),"250,"))||v(l,"src",a),v(l,"alt","Query region"),v(l,"class","mb-3 card query-image svelte-f4ylwc"),v(f,"class","input is-small tag"),v(f,"type","text"),v(f,"placeholder",W==="en"?"Add new match":"Ajouter une correspondance"),v(m,"class","button is-small tag is-link is-center"),v(d,"class","tags has-addons"),Le(d,"flex-wrap","nowrap"),v(w,"fill","white"),v(w,"d","M376.6 84.5c11.3-13.6 9.5-33.8-4.1-45.1s-33.8-9.5-45.1 4.1L192 206 56.6 43.5C45.3 29.9 25.1 28.1 11.5 39.4S-3.9 70.9 7.4 84.5L150.3 256 7.4 427.5c-11.3 13.6-9.5 33.8 4.1 45.1s33.8 9.5 45.1-4.1L192 306 327.4 468.5c11.3 13.6 31.5 15.4 45.1 4.1s15.4-31.5 4.1-45.1L233.7 256 376.6 84.5z"),v(_,"xmlns","http://www.w3.org/2000/svg"),v(_,"viewBox","0 0 384 512"),v(p,"id","no-match"),v(p,"class",C="button is-small tag is-danger is-center m-0 "+(t[3]===1?"visible":"")+" svelte-f4ylwc"),v(p,"title",W==="en"?"No match for this region in this witness":"Aucune correspondance de cette région pour ce témoin"),v(u,"class","new-similarity control pt-2 is-center svelte-f4ylwc")},m(E,A){j(E,e,A),y(e,n),y(e,i),y(e,s),j(E,o,A),j(E,l,A),j(E,c,A),j(E,u,A),y(u,d),y(d,f),ri(f,t[1]),y(d,h),y(d,m),y(u,g),y(u,p),y(p,_),y(_,w),I=!0,T||(M=[Se(f,"input",t[12]),Se(m,"click",t[8]),Se(p,"click",t[9])],T=!0)},p(E,A){(!I||A&1&&!ft(l.src,a=Mt(E[0],E[0].split("_").pop(),"250,")))&&v(l,"src",a),A&2&&f.value!==E[1]&&ri(f,E[1]),(!I||A&8&&C!==(C="button is-small tag is-danger is-center m-0 "+(E[3]===1?"visible":"")+" svelte-f4ylwc"))&&v(p,"class",C)},i(E){I||(Rt(()=>{I&&(b||(b=qt(p,vn,{duration:500},!0)),b.run(1))}),I=!0)},o(E){b||(b=qt(p,vn,{duration:500},!1)),b.run(0),I=!1},d(E){E&&$(e),E&&$(o),E&&$(l),E&&$(c),E&&$(u),E&&b&&b.end(),T=!1,Ye(M)}}}function Ov(t){let e,n,i,r,s,o,l,a;return n=new xv({props:{qImg:t[0]}}),o=new Nv({props:{qImg:t[0]}}),{c(){e=k("div"),le(n.$$.fragment),r=q(),s=k("div"),le(o.$$.fragment),v(e,"class",i=ni(t[7]?"":t[2])+" svelte-f4ylwc"),v(s,"class",l=ni(t[7]?"":t[2])+" svelte-f4ylwc")},m(c,u){j(c,e,u),se(n,e,null),j(c,r,u),j(c,s,u),se(o,s,null),a=!0},p(c,u){const d={};u&1&&(d.qImg=c[0]),n.$set(d),(!a||u&4&&i!==(i=ni(c[7]?"":c[2])+" svelte-f4ylwc"))&&v(e,"class",i);const f={};u&1&&(f.qImg=c[0]),o.$set(f),(!a||u&4&&l!==(l=ni(c[7]?"":c[2])+" svelte-f4ylwc"))&&v(s,"class",l)},i(c){a||(V(n.$$.fragment,c),V(o.$$.fragment,c),a=!0)},o(c){K(n.$$.fragment,c),K(o.$$.fragment,c),a=!1},d(c){c&&$(e),oe(n),c&&$(r),c&&$(s),oe(o)}}}function Pv(t){let e,n;return e=new Tl({props:{useGrid:!1,$$slots:{"row-body":[Ov],"row-header":[Tv]},$$scope:{ctx:t}}}),{c(){le(e.$$.fragment)},m(i,r){se(e,i,r),n=!0},p(i,[r]){const s={};r&1048591&&(s.$$scope={dirty:r,ctx:i}),e.$set(s)},i(i){n||(V(e.$$.fragment,i),n=!0)},o(i){K(e.$$.fragment,i),n=!1},d(i){oe(e,i)}}}function Lv(t){return t=t.replace(".jpg",""),/^wit\d+_[a-zA-Z]{3}\d+_\d+_\d+,\d+,\d+,\d+$/.test(t)}function Dv(t,e,n){let i,r,s,o;const{selectedRegions:l}=Ut;ge(t,l,T=>n(11,o=T));let{qImg:a}=e,c="";const[u,d,f,h]=a.split(".")[0].split("_"),m=`${window.location.origin}${window.location.pathname}`,g=window.location.pathname.match(/\d+/g).join("-"),p=W==="en"?"Error":"Erreur",_=ht("manifest"),w=ht("isInModal")||!1;hn("qImgMetadata",Ja(a,u,h,f));async function C(){if(!c||!Lv(c)){await lt(W==="en"?"Please insert a valid region reference to add a new match":"Veuillez insérer une référence de région valide pour ajouter une nouvelle correspondance","Error");return}try{const T=await fetch(`${m}add-region-pair`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":Kt},body:JSON.stringify({q_img:a.replace(".jpg",""),s_img:c,similarity_type:2})});T.ok||(console.error("Error: Network response was not ok"),await lt(W==="en"?"Problem with network, match was not added":"Problème de réseau, la correspondance n'a pas été ajoutée",p));const M=await T.json();if(M.hasOwnProperty("error")||!M.hasOwnProperty("s_regions")){await lt(W==="en"?`Request was unsuccessful, match was not added:<br>${M.error}`:`La requête n'a pas abouti, la correspondance n'a pas été ajoutée :<br>${M.error}`,p);return}const E=M.s_regions;Ut.addComparedRegions(E),Ut.select(E)}catch(T){console.error("Error:",T),await lt(W==="en"?`An error has occurred, match was not added:<br>${T}`:`Une erreur s'est produite, la correspondance n'a pas été ajoutée :<br>${T}`,p)}}async function b(){const T=Object.values(o[g])[0];if(await lt(W==="en"?`Do you confirm this region does not have any match in ${T.title}?`:`Confirmez-vous que cette région n'a pas de correspondance dans ${T.title} ?`,W==="en"?"Confirm no match":"Confirmer l'absence de correspondance",!0))try{(await fetch(`${m}no-match`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":Kt},body:JSON.stringify({q_img:a,s_regions:T.id})})).ok||(console.error("Error: Network response was not ok"),await lt(W==="en"?"Problem with network":"Problème de réseau",p)),Ut.select(T)}catch(E){console.error("Error:",E),await lt(W==="en"?`An error has occurred, request was unsuccessful:<br>${E}`:`Une erreur s'est produite, la requête n'a pas abouti :<br>${E}`,p)}}function I(){c=this.value,n(1,c)}return t.$$set=T=>{"qImg"in T&&n(0,a=T.qImg)},t.$$.update=()=>{t.$$.dirty&2048&&n(3,i=o.hasOwnProperty(g)?Object.values(o[g]).length:0),t.$$.dirty&1024&&n(2,s=`fixed-grid has-${r-1}-cols`)},n(10,r=xs(window.innerWidth)),[a,c,s,i,l,f,_,w,C,b,r,o,I]}class Rv extends ye{constructor(e){super(),ve(this,e,Dv,Pv,pe,{qImg:0})}}function $v(t){let e,n,i,r,s,o;return s=new Rv({props:{qImg:t[0].img}}),{c(){e=k("div"),n=k("a"),i=k("button"),i.textContent=`${W==="fr"?"Voir toutes les similarités pour ce document":"View all similarities for this document"}`,r=q(),le(s.$$.fragment),v(i,"class","button is-link is-small"),v(n,"href",t[1]()),v(e,"class","is-flex is-align-items-center is-justify-content-end")},m(l,a){j(l,e,a),y(e,n),y(n,i),j(l,r,a),se(s,l,a),o=!0},p(l,[a]){const c={};a&1&&(c.qImg=l[0].img),s.$set(c)},i(l){o||(V(s.$$.fragment,l),o=!0)},o(l){K(s.$$.fragment,l),o=!1},d(l){l&&$(e),l&&$(r),oe(s,l)}}}function zv(t,e,n){let{mainImgItem:i}=e;function r(){const s=i.img.match(/wit(\d+)/)[1],o=new URL(window.location.origin);return o.pathname=`${new URL(window.location).pathname.split("/")[1]}/witness/${s}/regions/`,o.searchParams.set("tab","similarity"),o.href}return t.$$set=s=>{"mainImgItem"in s&&n(0,i=s.mainImgItem)},[i,r]}class jv extends ye{constructor(e){super(),ve(this,e,zv,$v,pe,{mainImgItem:0})}}const Fv=Object.freeze(Object.defineProperty({__proto__:null,default:jv},Symbol.toStringTag,{value:"Module"}))})();
//# sourceMappingURL=documentSet.js.map
