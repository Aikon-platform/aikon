(function(){"use strict";function ne(){}const Is=t=>t;function Ms(t,e){for(const n in e)t[n]=e[n];return t}function $c(t){return!!t&&(typeof t=="object"||typeof t=="function")&&typeof t.then=="function"}function xs(t){return t()}function As(){return Object.create(null)}function st(t){t.forEach(xs)}function In(t){return typeof t=="function"}function Ee(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}let vi;function Mt(t,e){return vi||(vi=document.createElement("a")),vi.href=e,t===vi.href}function zc(t){return Object.keys(t).length===0}function yi(t,...e){if(t==null)return ne;const n=t.subscribe(...e);return n.unsubscribe?()=>n.unsubscribe():n}function ot(t){let e;return yi(t,n=>e=n)(),e}function ye(t,e,n){t.$$.on_destroy.push(yi(e,n))}function Nt(t,e,n,i){if(t){const r=Ts(t,e,n,i);return t[0](r)}}function Ts(t,e,n,i){return t[1]&&i?Ms(n.ctx.slice(),t[1](i(e))):n.ctx}function Ot(t,e,n,i){if(t[2]&&i){const r=t[2](i(n));if(e.dirty===void 0)return r;if(typeof r=="object"){const s=[],o=Math.max(e.dirty.length,r.length);for(let l=0;l<o;l+=1)s[l]=e.dirty[l]|r[l];return s}return e.dirty|r}return e.dirty}function Pt(t,e,n,i,r,s){if(r){const o=Ts(e,n,i,s);t.p(o,r)}}function Lt(t){if(t.ctx.length>32){const e=[],n=t.ctx.length/32;for(let i=0;i<n;i++)e[i]=-1;return e}return-1}function jc(t){const e={};for(const n in t)e[n]=!0;return e}function bi(t){return t??""}function wi(t){return t&&In(t.destroy)?t.destroy:ne}const Ns=typeof window<"u";let Fc=Ns?()=>window.performance.now():()=>Date.now(),hr=Ns?t=>requestAnimationFrame(t):ne;const Mn=new Set;function Os(t){Mn.forEach(e=>{e.c(t)||(Mn.delete(e),e.f())}),Mn.size!==0&&hr(Os)}function Vc(t){let e;return Mn.size===0&&hr(Os),{promise:new Promise(n=>{Mn.add(e={c:t,f:n})}),abort(){Mn.delete(e)}}}const Hc=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function y(t,e){t.appendChild(e)}function Ps(t){if(!t)return document;const e=t.getRootNode?t.getRootNode():t.ownerDocument;return e&&e.host?e:t.ownerDocument}function Uc(t){const e=w("style");return Bc(Ps(t),e),e.sheet}function Bc(t,e){return y(t.head||t,e),e.sheet}function j(t,e,n){t.insertBefore(e,n||null)}function z(t){t.parentNode&&t.parentNode.removeChild(t)}function dt(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function w(t){return document.createElement(t)}function Dt(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function oe(t){return document.createTextNode(t)}function F(){return oe(" ")}function ct(){return oe("")}function be(t,e,n,i){return t.addEventListener(e,n,i),()=>t.removeEventListener(e,n,i)}function Jt(t){return function(e){return e.preventDefault(),t.call(this,e)}}function v(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function qc(t){return Array.from(t.childNodes)}function Ce(t,e){e=""+e,t.data!==e&&(t.data=e)}function Si(t,e){t.value=e??""}function De(t,e,n,i){n==null?t.style.removeProperty(e):t.style.setProperty(e,n,i?"important":"")}function Ls(t,e,n){for(let i=0;i<t.options.length;i+=1){const r=t.options[i];if(r.__value===e){r.selected=!0;return}}(!n||e!==void 0)&&(t.selectedIndex=-1)}function Kc(t){const e=t.querySelector(":checked");return e&&e.__value}function Ae(t,e,n){t.classList[n?"add":"remove"](e)}function Rs(t,e,{bubbles:n=!1,cancelable:i=!1}={}){const r=document.createEvent("CustomEvent");return r.initCustomEvent(t,n,i,e),r}function ki(t,e){return new t(e)}const Ei=new Map;let Ci=0;function Wc(t){let e=5381,n=t.length;for(;n--;)e=(e<<5)-e^t.charCodeAt(n);return e>>>0}function Yc(t,e){const n={stylesheet:Uc(e),rules:{}};return Ei.set(t,n),n}function Ds(t,e,n,i,r,s,o,l=0){const a=16.666/i;let c=`{
`;for(let g=0;g<=1;g+=a){const _=e+(n-e)*s(g);c+=g*100+`%{${o(_,1-_)}}
`}const u=c+`100% {${o(n,1-n)}}
}`,h=`__svelte_${Wc(u)}_${l}`,f=Ps(t),{stylesheet:d,rules:m}=Ei.get(f)||Yc(f,t);m[h]||(m[h]=!0,d.insertRule(`@keyframes ${h} ${u}`,d.cssRules.length));const p=t.style.animation||"";return t.style.animation=`${p?`${p}, `:""}${h} ${i}ms linear ${r}ms 1 both`,Ci+=1,h}function Gc(t,e){const n=(t.style.animation||"").split(", "),i=n.filter(e?s=>s.indexOf(e)<0:s=>s.indexOf("__svelte")===-1),r=n.length-i.length;r&&(t.style.animation=i.join(", "),Ci-=r,Ci||Xc())}function Xc(){hr(()=>{Ci||(Ei.forEach(t=>{const{ownerNode:e}=t.stylesheet;e&&z(e)}),Ei.clear())})}let Jn;function Qt(t){Jn=t}function xn(){if(!Jn)throw new Error("Function called outside component initialization");return Jn}function An(t){xn().$$.on_mount.push(t)}function Tn(t){xn().$$.on_destroy.push(t)}function Ii(){const t=xn();return(e,n,{cancelable:i=!1}={})=>{const r=t.$$.callbacks[e];if(r){const s=Rs(e,n,{cancelable:i});return r.slice().forEach(o=>{o.call(t,s)}),!s.defaultPrevented}return!0}}function Nn(t,e){return xn().$$.context.set(t,e),e}function xt(t){return xn().$$.context.get(t)}const On=[],gn=[];let Pn=[];const $s=[],Jc=Promise.resolve();let dr=!1;function Qc(){dr||(dr=!0,Jc.then(pr))}function Ut(t){Pn.push(t)}const mr=new Set;let Ln=0;function pr(){if(Ln!==0)return;const t=Jn;do{try{for(;Ln<On.length;){const e=On[Ln];Ln++,Qt(e),Zc(e.$$)}}catch(e){throw On.length=0,Ln=0,e}for(Qt(null),On.length=0,Ln=0;gn.length;)gn.pop()();for(let e=0;e<Pn.length;e+=1){const n=Pn[e];mr.has(n)||(mr.add(n),n())}Pn.length=0}while(On.length);for(;$s.length;)$s.pop()();dr=!1,mr.clear(),Qt(t)}function Zc(t){if(t.fragment!==null){t.update(),st(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(Ut)}}function eu(t){const e=[],n=[];Pn.forEach(i=>t.indexOf(i)===-1?e.push(i):n.push(i)),n.forEach(i=>i()),Pn=e}let Qn;function tu(){return Qn||(Qn=Promise.resolve(),Qn.then(()=>{Qn=null})),Qn}function gr(t,e,n){t.dispatchEvent(Rs(`${e?"intro":"outro"}${n}`))}const Mi=new Set;let Zt;function Pe(){Zt={r:0,c:[],p:Zt}}function Le(){Zt.r||st(Zt.c),Zt=Zt.p}function U(t,e){t&&t.i&&(Mi.delete(t),t.i(e))}function K(t,e,n,i){if(t&&t.o){if(Mi.has(t))return;Mi.add(t),Zt.c.push(()=>{Mi.delete(t),i&&(n&&t.d(1),i())}),t.o(e)}else i&&i()}const nu={duration:0};function ln(t,e,n,i){const r={direction:"both"};let s=e(t,n,r),o=i?0:1,l=null,a=null,c=null;function u(){c&&Gc(t,c)}function h(d,m){const p=d.b-o;return m*=Math.abs(p),{a:o,b:d.b,d:p,duration:m,start:d.start,end:d.start+m,group:d.group}}function f(d){const{delay:m=0,duration:p=300,easing:g=Is,tick:_=ne,css:k}=s||nu,E={start:Fc()+m,b:d};d||(E.group=Zt,Zt.r+=1),l||a?a=E:(k&&(u(),c=Ds(t,o,d,p,m,g,k)),d&&_(0,1),l=h(E,p),Ut(()=>gr(t,d,"start")),Vc(b=>{if(a&&b>a.start&&(l=h(a,p),a=null,gr(t,l.b,"start"),k&&(u(),c=Ds(t,o,l.b,l.duration,0,g,s.css))),l){if(b>=l.end)_(o=l.b,1-o),gr(t,l.b,"end"),a||(l.b?u():--l.group.r||st(l.group.c)),l=null;else if(b>=l.start){const S=b-l.start;o=l.a+l.d*g(S/l.duration),_(o,1-o)}}return!!(l||a)}))}return{run(d){In(s)?tu().then(()=>{s=s(r),f(d)}):f(d)},end(){u(),l=a=null}}}function _r(t,e){const n=e.token={};function i(r,s,o,l){if(e.token!==n)return;e.resolved=l;let a=e.ctx;o!==void 0&&(a=a.slice(),a[o]=l);const c=r&&(e.current=r)(a);let u=!1;e.block&&(e.blocks?e.blocks.forEach((h,f)=>{f!==s&&h&&(Pe(),K(h,1,1,()=>{e.blocks[f]===h&&(e.blocks[f]=null)}),Le())}):e.block.d(1),c.c(),U(c,1),c.m(e.mount(),e.anchor),u=!0),e.block=c,e.blocks&&(e.blocks[s]=c),u&&pr()}if($c(t)){const r=xn();if(t.then(s=>{Qt(r),i(e.then,1,e.value,s),Qt(null)},s=>{if(Qt(r),i(e.catch,2,e.error,s),Qt(null),!e.hasCatch)throw s}),e.current!==e.pending)return i(e.pending,0),!0}else{if(e.current!==e.then)return i(e.then,1,e.value,t),!0;e.resolved=t}}function zs(t,e,n){const i=e.slice(),{resolved:r}=t;t.current===t.then&&(i[t.value]=r),t.current===t.catch&&(i[t.error]=r),t.block.p(i,n)}function js(t,e){t.d(1),e.delete(t.key)}function vr(t,e){K(t,1,1,()=>{e.delete(t.key)})}function Zn(t,e,n,i,r,s,o,l,a,c,u,h){let f=t.length,d=s.length,m=f;const p={};for(;m--;)p[t[m].key]=m;const g=[],_=new Map,k=new Map,E=[];for(m=d;m--;){const M=h(r,s,m),C=n(M);let x=o.get(C);x?i&&E.push(()=>x.p(M,e)):(x=c(C,M),x.c()),_.set(C,g[m]=x),C in p&&k.set(C,Math.abs(m-p[C]))}const b=new Set,S=new Set;function T(M){U(M,1),M.m(l,u),o.set(M.key,M),u=M.first,d--}for(;f&&d;){const M=g[d-1],C=t[f-1],x=M.key,P=C.key;M===C?(u=M.first,f--,d--):_.has(P)?!o.has(x)||b.has(x)?T(M):S.has(P)?f--:k.get(x)>k.get(P)?(S.add(x),T(M)):(b.add(P),f--):(a(C,o),f--)}for(;f--;){const M=t[f];_.has(M.key)||a(M,o)}for(;d;)T(g[d-1]);return st(E),g}function iu(t,e){const n={},i={},r={$$scope:1};let s=t.length;for(;s--;){const o=t[s],l=e[s];if(l){for(const a in o)a in l||(i[a]=1);for(const a in l)r[a]||(n[a]=l[a],r[a]=1);t[s]=l}else for(const a in o)r[a]=1}for(const o in i)o in n||(n[o]=void 0);return n}function ru(t){return typeof t=="object"&&t!==null?t:{}}function pe(t){t&&t.c()}function de(t,e,n,i){const{fragment:r,after_update:s}=t.$$;r&&r.m(e,n),i||Ut(()=>{const o=t.$$.on_mount.map(xs).filter(In);t.$$.on_destroy?t.$$.on_destroy.push(...o):st(o),t.$$.on_mount=[]}),s.forEach(Ut)}function me(t,e){const n=t.$$;n.fragment!==null&&(eu(n.after_update),st(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function su(t,e){t.$$.dirty[0]===-1&&(On.push(t),Qc(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function Ie(t,e,n,i,r,s,o,l=[-1]){const a=Jn;Qt(t);const c=t.$$={fragment:null,ctx:[],props:s,update:ne,not_equal:r,bound:As(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(a?a.$$.context:[])),callbacks:As(),dirty:l,skip_bound:!1,root:e.target||a.$$.root};o&&o(c.root);let u=!1;if(c.ctx=n?n(t,e.props||{},(h,f,...d)=>{const m=d.length?d[0]:f;return c.ctx&&r(c.ctx[h],c.ctx[h]=m)&&(!c.skip_bound&&c.bound[h]&&c.bound[h](m),u&&su(t,h)),f}):[],c.update(),u=!0,st(c.before_update),c.fragment=i?i(c.ctx):!1,e.target){if(e.hydrate){const h=qc(e.target);c.fragment&&c.fragment.l(h),h.forEach(z)}else c.fragment&&c.fragment.c();e.intro&&U(t.$$.fragment),de(t,e.target,e.anchor,e.customElement),pr()}Qt(a)}class Me{$destroy(){me(this,1),this.$destroy=ne}$on(e,n){if(!In(n))return ne;const i=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return i.push(n),()=>{const r=i.indexOf(n);r!==-1&&i.splice(r,1)}}$set(e){this.$$set&&!zc(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const Rn=[];function ou(t,e){return{subscribe:xe(t,e).subscribe}}function xe(t,e=ne){let n;const i=new Set;function r(l){if(Ee(t,l)&&(t=l,n)){const a=!Rn.length;for(const c of i)c[1](),Rn.push(c,t);if(a){for(let c=0;c<Rn.length;c+=2)Rn[c][0](Rn[c+1]);Rn.length=0}}}function s(l){r(l(t))}function o(l,a=ne){const c=[l,a];return i.add(c),i.size===1&&(n=e(r)||ne),l(t),()=>{i.delete(c),i.size===0&&n&&(n(),n=null)}}return{set:r,update:s,subscribe:o}}function tt(t,e,n){const i=!Array.isArray(t),r=i?[t]:t,s=e.length<2;return ou(n,o=>{let l=!1;const a=[];let c=0,u=ne;const h=()=>{if(c)return;u();const d=e(i?a[0]:a,o);s?o(d):u=In(d)?d:ne},f=r.map((d,m)=>yi(d,p=>{a[m]=p,c&=~(1<<m),l&&h()},()=>{c|=1<<m}));return l=!0,h(),function(){st(f),u(),l=!1}})}const W=APP_LANG,$t=APP_NAME;WEBAPP_NAME;const yr=USER_ID;IS_SUPERUSER,ADD_PERMISSION;const an=CSRF_TOKEN;ADDITIONAL_MODULES;const lu="Region",Fs=APP_URL,au=SAS_APP_URL;CANTALOUPE_APP_URL,MEDIA_PATH;const cu=PAGE_LEN,uu={Witness:W==="en"?"Witness":"Témoin",Work:W==="en"?"Work":"Œuvre",Series:W==="en"?"Series":"Série d'imprimés",Regions:W==="en"?"Region Extraction":"Extraction d'illustrations"},ei=xe(!1),fu=xe(""),hu=t=>typeof t=="string"||t instanceof String;async function Vs(t){ei.set(!0);try{return await t()}finally{ei.set(!1)}}function br(t){return t.match(/\d+/g).toString()}function du(t){return parseInt(br(t),10)}function mu(t,e=100){const n=Math.floor(e*.75);return t.length>e?t.slice(0,n)+"..."+t.slice(-e+n):t}function pu(){return"https://vhs.huma-num.fr"}function gu(){return au??"http://localhost:8888"}function wr(t,e){if(typeof window<"u"){const n=parseInt(new URLSearchParams(window.location.search).get(e));if(!isNaN(n))return t.set(n),n}return t.set(1),1}function Sr(t,e,n){if(e.set(t),typeof window<"u"){const i=new URL(window.location.href);i.searchParams.set(n,t),window.history.pushState({},"",i)}}function _u(t=null){return t=t.split("_"),t.length<3?void 0:`${t.slice(0,3).join("_").replace(".jpg","")}.jpg`}function Hs(t=null){const e=_u(t);return e===void 0?void 0:`${pu()}/iiif/2/${e}`}function Bt(t=null,e=null,n="full"){if(e=hu(e)?e.replace(".jpg",""):e,!t)return"https://placehold.co/96x96/png?text=No+image";const i=Hs(t);if(i===void 0)return"https://placehold.co/96x96/png?text=No+image";const r=t.split("_");return e||(e=r[r.length-1].includes(",")?r.pop().replace(".jpg",""):"full"),`${i}/${e}/${n}/0/default.jpg`}function vu(t=null){return`${Hs(t)}/info.json`}function yu(t=null,e=1){return`${gu()}/index.html?iiif-content=${t}&canvas=${e}`}function wt(t,e=null,n=!1){return new Promise(i=>{if(document.getElementById("msg-modal")){n?document.getElementById("modal-footer").hidden=!1:i(void 0),e&&(document.getElementById("modal-title").innerHTML=e),document.getElementById("modal-msg").innerHTML=t,document.getElementById("hidden-msg-btn").click();const s=document.getElementById("cancel-btn"),o=document.getElementById("ok-btn"),l=document.getElementById("modal-bkg"),a=()=>{s.removeEventListener("click",c),l.removeEventListener("click",c),o.removeEventListener("click",u),document.getElementById("modal-footer").hidden=!0},c=()=>{a(),i(!1)},u=()=>{a(),i(!0)};s.addEventListener("click",c),o.addEventListener("click",u)}else n?i(window.confirm(t)):(window.alert(t),i(void 0))})}function xi(){let t,e,n=(i,r)=>i===r;return{set:i=>{e=t,t=i},setCompareFn:i=>n=i,get:()=>t,getNewAndOld:()=>[t,e],same:()=>n(t,e)}}const kr=(t,e)=>Array.isArray(t)&&Array.isArray(e)&&t.length===e.length&&t.every((n,i)=>n===e[i]||void 0);function bu(t){const n=[85,70,60],i=[50,65,40],r=t*137.5%360,s=n[t%n.length],o=i[Math.floor(t/n.length)%i.length];return`hsl(${Math.floor(r)}, ${s}%, ${o}%)`}function Us(t=null){return t<600?1:t<800?2:t<1e3?3:t<1200?4:t<1400?5:t>=1400?6:4}function Bs(t){const e=t.querySelectorAll(".modal-background, .modal-close, .modal-card-head .delete, .modal-card-foot .button-close"),n=()=>t.classList.remove("is-active");e.forEach(r=>r.addEventListener("click",n));const i=r=>{r.key==="Escape"&&t.classList.contains("is-active")&&n()};return document.addEventListener("keydown",i),{destroy(){e.forEach(r=>r.removeEventListener("click",n)),document.removeEventListener("keydown",i)}}}function qs(t){const e=()=>{const n=document.getElementById(t.dataset.target);n==null||n.classList.add("is-active")};return t.addEventListener("click",e),{destroy(){t.removeEventListener("click",e)}}}function Dn(t,e,n="string"){const i={string:s=>{const o=s.get(e);return o!==null?o:null},array:s=>{const o=s.get(e);return o?o.split(",").map(Number).filter(l=>!isNaN(l)):null},set:s=>{const o=s.get(e);return o?new Set(o.split(",").map(Number).filter(l=>!isNaN(l))):null},number:s=>{const o=s.get(e);return o!==null?Number(o):null},boolean:s=>{const o=s.get(e);return o!==null?o==="true":null}},r={string:(s,o)=>o?s.searchParams.set(e,o):s.searchParams.delete(e),array:(s,o)=>{o!=null&&o.length?s.searchParams.set(e,o.join(",")):s.searchParams.delete(e)},set:(s,o)=>{o!=null&&o.size?s.searchParams.set(e,Array.from(o).join(",")):s.searchParams.delete(e)},number:(s,o)=>{o!=null?s.searchParams.set(e,String(o)):s.searchParams.delete(e)},boolean:(s,o)=>o?s.searchParams.set(e,"true"):s.searchParams.delete(e)};if(typeof window<"u"){const s=new URLSearchParams(window.location.search),o=i[n](s);return o!==null&&t.set(o),l=>{const a=new URL(window.location);r[n](a,l),window.history.pushState({},"",a)}}return()=>{}}function wu(t){const e=t-1;return e*e*e+1}function $n(t,{delay:e=0,duration:n=400,easing:i=Is}={}){const r=+getComputedStyle(t).opacity;return{delay:e,duration:n,easing:i,css:s=>`opacity: ${s*r}`}}function Ks(t,{delay:e=0,duration:n=400,easing:i=wu,axis:r="y"}={}){const s=getComputedStyle(t),o=+s.opacity,l=r==="y"?"height":"width",a=parseFloat(s[l]),c=r==="y"?["top","bottom"]:["left","right"],u=c.map(_=>`${_[0].toUpperCase()}${_.slice(1)}`),h=parseFloat(s[`padding${u[0]}`]),f=parseFloat(s[`padding${u[1]}`]),d=parseFloat(s[`margin${u[0]}`]),m=parseFloat(s[`margin${u[1]}`]),p=parseFloat(s[`border${u[0]}Width`]),g=parseFloat(s[`border${u[1]}Width`]);return{delay:e,duration:n,easing:i,css:_=>`overflow: hidden;opacity: ${Math.min(_*20,1)*o};${l}: ${_*a}px;padding-${c[0]}: ${_*h}px;padding-${c[1]}: ${_*f}px;margin-${c[0]}: ${_*d}px;margin-${c[1]}: ${_*m}px;border-${c[0]}-width: ${_*p}px;border-${c[1]}-width: ${_*g}px;`}}const Ny="";function Ws(t){let e,n,i;return{c(){e=w("div"),e.innerHTML='<div class="loader svelte-vizlcg"></div>',v(e,"class","bkg-shade svelte-vizlcg")},m(r,s){j(r,e,s),i=!0},i(r){i||(Ut(()=>{i&&(n||(n=ln(e,$n,{duration:150},!0)),n.run(1))}),i=!0)},o(r){n||(n=ln(e,$n,{duration:150},!1)),n.run(0),i=!1},d(r){r&&z(e),r&&n&&n.end()}}}function Su(t){let e,n,i=t[0]&&Ws();return{c(){i&&i.c(),e=ct()},m(r,s){i&&i.m(r,s),j(r,e,s),n=!0},p(r,[s]){r[0]?i?s&1&&U(i,1):(i=Ws(),i.c(),U(i,1),i.m(e.parentNode,e)):i&&(Pe(),K(i,1,1,()=>{i=null}),Le())},i(r){n||(U(i),n=!0)},o(r){K(i),n=!1},d(r){i&&i.d(r),r&&z(e)}}}function ku(t,e,n){let i;return ye(t,ei,r=>n(0,i=r)),[i]}class Eu extends Me{constructor(e){super(),Ie(this,e,ku,Su,Ee,{})}}const Cu=t=>({}),Ys=t=>({});function Iu(t){let e,n,i,r,s,o,l,a,c,u,h,f,d,m,p,g,_,k,E,b,S;const T=t[1].content,M=Nt(T,t,t[0],Ys);return{c(){e=w("button"),n=F(),i=w("div"),r=w("div"),s=F(),o=w("div"),l=w("div"),l.innerHTML=`<div class="title is-4 mb-0 media-content"><span id="modal-title" class="mb-0"></span></div>
            <button class="delete media-left" aria-label="close"></button>`,a=F(),c=w("section"),u=w("div"),h=F(),f=w("div"),M&&M.c(),d=F(),m=w("footer"),p=w("div"),g=w("button"),g.textContent=`${W==="en"?"Abort":"Retour"}`,_=F(),k=w("button"),k.textContent="OK",v(e,"id","hidden-msg-btn"),v(e,"data-target","msg-modal"),e.hidden=!0,v(r,"id","modal-bkg"),v(r,"class","modal-background"),v(l,"class","modal-card-head media mb-0"),v(u,"id","modal-msg"),v(f,"class","py-3"),v(c,"id","modal-body"),v(c,"class","modal-card-body"),v(g,"id","cancel-btn"),v(g,"class","button is-link is-light button-close"),v(k,"id","ok-btn"),v(k,"class","button is-link button-close"),v(p,"class","buttons"),v(m,"id","modal-footer"),v(m,"class","modal-card-foot is-center pt-3"),m.hidden=!0,v(o,"class","modal-content"),v(i,"id","msg-modal"),v(i,"class","modal fade"),v(i,"tabindex","-1"),v(i,"aria-labelledby","selection-modal-label"),v(i,"aria-hidden","true")},m(C,x){j(C,e,x),j(C,n,x),j(C,i,x),y(i,r),y(i,s),y(i,o),y(o,l),y(o,a),y(o,c),y(c,u),y(c,h),y(c,f),M&&M.m(f,null),y(o,d),y(o,m),y(m,p),y(p,g),y(p,_),y(p,k),E=!0,b||(S=[wi(qs.call(null,e)),wi(Bs.call(null,i))],b=!0)},p(C,[x]){M&&M.p&&(!E||x&1)&&Pt(M,T,C,C[0],E?Ot(T,C[0],x,Cu):Lt(C[0]),Ys)},i(C){E||(U(M,C),E=!0)},o(C){K(M,C),E=!1},d(C){C&&z(e),C&&z(n),C&&z(i),M&&M.d(C),b=!1,st(S)}}}function Mu(t,e,n){let{$$slots:i={},$$scope:r}=e;return t.$$set=s=>{"$$scope"in s&&n(0,r=s.$$scope)},[r,i]}class xu extends Me{constructor(e){super(),Ie(this,e,Mu,Iu,Ee,{})}}const Oy="",Au=t=>({activeTab:t&8}),Gs=t=>({activeTab:t[3]});function Xs(t,e,n){const i=t.slice();return i[11]=e[n][0],i[12]=e[n][1],i}const Tu=t=>({activeTab:t&8}),Js=t=>({activeTab:t[3]}),Nu=t=>({}),Qs=t=>({});function Ou(t){let e,n,i=Object.entries(t[2]),r=[];for(let s=0;s<i.length;s+=1)r[s]=Zs(Xs(t,i,s));return{c(){e=w("div"),n=w("ul");for(let s=0;s<r.length;s+=1)r[s].c();v(e,"class","tabs")},m(s,o){j(s,e,o),y(e,n);for(let l=0;l<r.length;l+=1)r[l]&&r[l].m(n,null)},p(s,o){if(o&28){i=Object.entries(s[2]);let l;for(l=0;l<i.length;l+=1){const a=Xs(s,i,l);r[l]?r[l].p(a,o):(r[l]=Zs(a),r[l].c(),r[l].m(n,null))}for(;l<r.length;l+=1)r[l].d(1);r.length=i.length}},i:ne,o:ne,d(s){s&&z(e),dt(r,s)}}}function Pu(t){let e;const n=t[8].tabs,i=Nt(n,t,t[7],Js);return{c(){i&&i.c()},m(r,s){i&&i.m(r,s),e=!0},p(r,s){i&&i.p&&(!e||s&136)&&Pt(i,n,r,r[7],e?Ot(n,r[7],s,Tu):Lt(r[7]),Js)},i(r){e||(U(i,r),e=!0)},o(r){K(i,r),e=!1},d(r){i&&i.d(r)}}}function Zs(t){let e,n,i=t[12]+"",r,s,o,l;function a(){return t[9](t[11])}return{c(){e=w("li"),n=w("a"),r=oe(i),s=F(),v(n,"href",null),Ae(e,"is-active",t[3]===t[11])},m(c,u){j(c,e,u),y(e,n),y(n,r),y(e,s),o||(l=be(n,"click",a),o=!0)},p(c,u){t=c,u&4&&i!==(i=t[12]+"")&&Ce(r,i),u&12&&Ae(e,"is-active",t[3]===t[11])},d(c){c&&z(e),o=!1,l()}}}function Lu(t){let e,n,i,r,s,o,l,a,c,u,h,f,d;e=new Eu({});const m=t[8].sidebar,p=Nt(m,t,t[7],Qs),g=[Pu,Ou],_=[];function k(S,T){return T&4&&(a=null),S[5].tabs?0:(a==null&&(a=!!Object.keys(S[2]).length),a?1:-1)}~(c=k(t,-1))&&(u=_[c]=g[c](t));const E=t[8].content,b=Nt(E,t,t[7],Gs);return{c(){pe(e.$$.fragment),n=F(),i=w("div"),r=w("aside"),p&&p.c(),s=F(),o=w("main"),l=w("nav"),u&&u.c(),h=F(),f=w("div"),b&&b.c(),v(r,"class","sidebar svelte-jexg"),De(r,"width",t[0]+"%"),De(r,"min-height",t[1]),v(l,"id","tabs"),v(l,"class","tabs-bar svelte-jexg"),v(f,"class","content-area pl-5 svelte-jexg"),v(o,"class","main-content svelte-jexg"),De(o,"width",100-t[0]+"%"),De(o,"min-height",t[1]),v(i,"class","layout svelte-jexg"),De(i,"min-height",t[1])},m(S,T){de(e,S,T),j(S,n,T),j(S,i,T),y(i,r),p&&p.m(r,null),y(i,s),y(i,o),y(o,l),~c&&_[c].m(l,null),y(o,h),y(o,f),b&&b.m(f,null),d=!0},p(S,[T]){p&&p.p&&(!d||T&128)&&Pt(p,m,S,S[7],d?Ot(m,S[7],T,Nu):Lt(S[7]),Qs),(!d||T&1)&&De(r,"width",S[0]+"%");let M=c;c=k(S,T),c===M?~c&&_[c].p(S,T):(u&&(Pe(),K(_[M],1,1,()=>{_[M]=null}),Le()),~c?(u=_[c],u?u.p(S,T):(u=_[c]=g[c](S),u.c()),U(u,1),u.m(l,null)):u=null),b&&b.p&&(!d||T&136)&&Pt(b,E,S,S[7],d?Ot(E,S[7],T,Au):Lt(S[7]),Gs),(!d||T&1)&&De(o,"width",100-S[0]+"%")},i(S){d||(U(e.$$.fragment,S),U(p,S),U(u),U(b,S),d=!0)},o(S){K(e.$$.fragment,S),K(p,S),K(u),K(b,S),d=!1},d(S){me(e,S),S&&z(n),S&&z(i),p&&p.d(S),~c&&_[c].d(),b&&b.d(S)}}}function Ru(t=null){t||(t=document.getElementById("navbar")),document.documentElement.style.setProperty("--top-offset",`${t.offsetHeight}px`)}function Du(t,e,n){let i,{$$slots:r={},$$scope:s}=e;const o=jc(r);let{sidebarWidth:l="25"}=e;const a="90vh";let{tabList:c={}}=e,u=Object.keys(c),{topOffsetElement:h=null}=e;Ru(h);function f(m){if(!u.includes(m)){console.warn(`Tab "${m}" is not available.`);return}n(3,i=m);const p=new URL(window.location);p.searchParams.set("tab",m),window.history.pushState({},"",p)}const d=m=>f(m);return t.$$set=m=>{"sidebarWidth"in m&&n(0,l=m.sidebarWidth),"tabList"in m&&n(2,c=m.tabList),"topOffsetElement"in m&&n(6,h=m.topOffsetElement),"$$scope"in m&&n(7,s=m.$$scope)},n(3,i=new URLSearchParams(window.location.search).get("tab")??u[0]??null),[l,a,c,i,f,o,h,s,r,d]}class $u extends Me{constructor(e){super(),Ie(this,e,Du,Lu,Ee,{sidebarWidth:0,layoutHeight:1,tabList:2,topOffsetElement:6})}get layoutHeight(){return this.$$.ctx[1]}}const Ai={0:{title:W==="en"?"no categorization":"aucune catégorisation",svg:`<svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 59 59">
        <rect x="1" y="0.62" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>
    </svg>`},1:{title:W==="en"?"overall visual matches":"correspondances visuelles globales",svg:`<svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 68 69">
        <rect x="10" y="10.62" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>
        <rect x="1" y="1" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>
        <rect x="10" y="10.62" width="46" height="45.71" rx="4.11" ry="4.11" fill="currentColor" stroke="none"/>
    </svg>`},2:{title:W==="en"?"visual matches on part of the image":"correspondances visuelles sur une partie de l'image",svg:`<svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 70 71">
        <rect x="12" y="12.43" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>
        <rect x="1" y="0.81" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>
        <path d="M 12 21.43 L 21 12.43" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
        <path d="M 12 30 L 30 12.43" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
        <path d="M 40 56 L 57 38" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
        <path d="M 48.3 56.29 L 57 47" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
        <path d="M 12 39 L 39 12" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
        <path d="M 12 48 L 48 12" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
        <path d="M 13 56 L 57 12" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
        <path d="M 31 56 L 57 29" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
        <path d="M 21 57 L 57 21" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
    </svg>`},3:{title:W==="en"?"semantic and non-visual matches":"correspondances sémantiques et non-visuelle",svg:`<svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 72 73">
        <rect x="14" y="14.43" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3" stroke-dasharray="9 9"/>
        <rect x="1" y="0.81" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>
    </svg>`},4:{title:W==="en"?"regions without match":"régions sans correspondance",svg:`<svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 59 59">
        <rect x="1" y="0.62" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>
        <path d="M 2.67 54.55 L 55 2" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
        <path d="M 54.37 54.05 L 2.72 2.24" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
    </svg>`},5:{title:W==="en"?"user specific category":"correspondances spécifiques à l'utilisateur",svg:`<svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 59 59">
        <rect x="1" y="0.81" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>
        <path d="M 8.69 55.28 C 9.25 44.15 18.08 35.28 28.86 35.28 C 32.5 35.28 36.07 36.3 39.18 38.25 C 44.96 41.85 48.66 48.3 49.02 55.28 Z M 17.85 21.48 C 17.85 15.37 22.79 10.39 28.86 10.39 C 34.92 10.39 39.86 15.37 39.86 21.48 C 39.86 27.59 34.92 32.56 28.86 32.56 C 22.79 32.56 17.85 27.59 17.85 21.48 Z M 40.37 36.34 C 38.43 35.13 36.32 34.25 34.13 33.7 C 38.82 31.64 42.1 26.94 42.1 21.48 C 42.1 14.13 36.16 8.15 28.86 8.15 C 21.55 8.15 15.61 14.13 15.61 21.48 C 15.61 26.95 18.9 31.66 23.6 33.71 C 13.76 36.18 6.41 45.4 6.41 56.4 C 6.41 57.02 6.92 57.52 7.54 57.52 L 50.17 57.52 C 50.79 57.52 51.3 57.02 51.3 56.4 C 51.3 48.23 47.11 40.54 40.37 36.34 Z" fill="currentColor" stroke="none"/>
    </svg>`}};function zu(t){let e,n=Ai[t[2]].svg+"",i,r,s,o;return{c(){e=w("span"),v(e,"class",i="tag py-4 "+t[4]+" "+(t[0]?"is-hoverable":"")),v(e,"title",r=Ai[t[2]].title),Ae(e,"is-selected",t[1])},m(l,a){j(l,e,a),e.innerHTML=n,s||(o=[be(e,"click",t[5]),be(e,"keyup",null)],s=!0)},p(l,[a]){a&4&&n!==(n=Ai[l[2]].svg+"")&&(e.innerHTML=n),a&17&&i!==(i="tag py-4 "+l[4]+" "+(l[0]?"is-hoverable":""))&&v(e,"class",i),a&4&&r!==(r=Ai[l[2]].title)&&v(e,"title",r),a&19&&Ae(e,"is-selected",l[1])},i:ne,o:ne,d(l){l&&z(e),s=!1,st(o)}}}function ju(t,e,n){let{selectable:i=!0}=e,{isSelected:r=!1}=e,{category:s}=e,{toggle:o=()=>{}}=e,{padding:l="px-2"}=e;const a=()=>o(s);return t.$$set=c=>{"selectable"in c&&n(0,i=c.selectable),"isSelected"in c&&n(1,r=c.isSelected),"category"in c&&n(2,s=c.category),"toggle"in c&&n(3,o=c.toggle),"padding"in c&&n(4,l=c.padding)},[i,r,s,o,l,a]}class zn extends Me{constructor(e){super(),Ie(this,e,ju,zu,Ee,{selectable:0,isSelected:1,category:2,toggle:3,padding:4})}}const qy="";function eo(t){let e,n,i=t[3].title+"",r,s;return{c(){e=w("span"),n=w("a"),r=oe(i),v(n,"href",s=`${Fs}/${$t}/witness/${t[3].witnessId}/regions/${t[1]}`),v(n,"target","_blank"),v(e,"class","legend-label svelte-w1sf17")},m(o,l){j(o,e,l),y(e,n),y(n,r)},p(o,l){l&8&&i!==(i=o[3].title+"")&&Ce(r,i),l&10&&s!==(s=`${Fs}/${$t}/witness/${o[3].witnessId}/regions/${o[1]}`)&&v(n,"href",s)},d(o){o&&z(e)}}}function Fu(t){let e,n,i,r,s,o,l,a,c,u=!t[5]&&eo(t);return{c(){e=w("div"),n=w("span"),i=F(),r=w("span"),l=F(),u&&u.c(),v(n,"class","legend-nb svelte-w1sf17"),v(r,"class","legend-color svelte-w1sf17"),v(r,"aria-label",s=t[3].title),v(r,"title",o=t[3].title),De(r,"background-color",t[0]?t[3].color:"#999"),v(r,"role","button"),v(r,"tabindex","0"),Ae(r,"inactive",!t[0]),Ae(r,"clickable",t[4]),v(e,"class","legend-item svelte-w1sf17"),Ae(e,"inactive",!t[0])},m(h,f){j(h,e,f),y(e,n),y(e,i),y(e,r),y(e,l),u&&u.m(e,null),a||(c=[be(r,"click",function(){In(t[2])&&t[2].apply(this,arguments)}),be(r,"keydown",null)],a=!0)},p(h,[f]){t=h,f&8&&s!==(s=t[3].title)&&v(r,"aria-label",s),f&8&&o!==(o=t[3].title)&&v(r,"title",o),f&9&&De(r,"background-color",t[0]?t[3].color:"#999"),f&1&&Ae(r,"inactive",!t[0]),f&16&&Ae(r,"clickable",t[4]),t[5]?u&&(u.d(1),u=null):u?u.p(t,f):(u=eo(t),u.c(),u.m(e,null)),f&1&&Ae(e,"inactive",!t[0])},i:ne,o:ne,d(h){h&&z(e),u&&u.d(),a=!1,st(c)}}}function Vu(t,e,n){let{isActive:i=!0}=e,{id:r}=e,{toggle:s=()=>{}}=e,{meta:o={title:"Region",color:"#999",witnessId:1}}=e,{clickable:l=!0}=e,{onlyColor:a=!1}=e;return t.$$set=c=>{"isActive"in c&&n(0,i=c.isActive),"id"in c&&n(1,r=c.id),"toggle"in c&&n(2,s=c.toggle),"meta"in c&&n(3,o=c.meta),"clickable"in c&&n(4,l=c.clickable),"onlyColor"in c&&n(5,a=c.onlyColor)},[i,r,s,o,l,a]}class to extends Me{constructor(e){super(),Ie(this,e,Vu,Fu,Ee,{isActive:0,id:1,toggle:2,meta:3,clickable:4,onlyColor:5})}}const Ky="";function no(t,e,n){const i=t.slice();return i[6]=e[n][0],i[7]=e[n][1],i}function Hu(t){let e;return{c(){e=w("span"),e.innerHTML='<i class="fas fa-chevron-down"></i>',v(e,"class","icon is-small")},m(n,i){j(n,e,i)},d(n){n&&z(e)}}}function Uu(t){let e;return{c(){e=w("span"),e.innerHTML='<i class="fas fa-chevron-up"></i>',v(e,"class","icon is-small")},m(n,i){j(n,e,i)},d(n){n&&z(e)}}}function io(t){let e,n;function i(){return t[5](t[6])}return e=new to({props:{id:t[6],meta:t[7],isActive:t[1].has(parseInt(t[6])),toggle:i,onlyColor:!t[3]}}),{c(){pe(e.$$.fragment)},m(r,s){de(e,r,s),n=!0},p(r,s){t=r;const o={};s&1&&(o.id=t[6]),s&1&&(o.meta=t[7]),s&3&&(o.isActive=t[1].has(parseInt(t[6]))),s&5&&(o.toggle=i),s&8&&(o.onlyColor=!t[3]),e.$set(o)},i(r){n||(U(e.$$.fragment,r),n=!0)},o(r){K(e.$$.fragment,r),n=!1},d(r){me(e,r)}}}function Bu(t){let e,n,i,r,s,o,l,a,c,u,h,f,d,m,p,g;function _(M,C){return M[3]?Uu:Hu}let k=_(t),E=k(t),b=Array.from(t[0]||new Map),S=[];for(let M=0;M<b.length;M+=1)S[M]=io(no(t,b,M));const T=M=>K(S[M],1,1,()=>{S[M]=null});return{c(){e=w("div"),n=w("div"),i=w("div"),r=w("div"),s=w("h3"),s.textContent=`${W==="en"?"Visible documents":"Documents visibles"}`,o=F(),l=w("div"),a=w("div"),c=w("button"),E.c(),f=F(),d=w("div");for(let M=0;M<S.length;M+=1)S[M].c();v(s,"class","title mb-0"),v(r,"class","level-item"),v(i,"class","level-left"),v(c,"class","button is-small is-ghost"),v(c,"aria-label",u=t[3]?"Minify legend":"Expand legend"),v(a,"class","level-item"),v(a,"title",h=t[3]?"Minify legend":"Expand legend"),v(l,"class","level-right"),v(n,"class","level is-mobile mb-3"),v(d,"class","svelte-13ym7ov"),Ae(d,"is-condensed",!t[3]),Ae(d,"is-expanded",t[3])},m(M,C){j(M,e,C),y(e,n),y(n,i),y(i,r),y(r,s),y(n,o),y(n,l),y(l,a),y(a,c),E.m(c,null),y(e,f),y(e,d);for(let x=0;x<S.length;x+=1)S[x]&&S[x].m(d,null);m=!0,p||(g=be(c,"click",t[4]),p=!0)},p(M,[C]){if(k!==(k=_(M))&&(E.d(1),E=k(M),E&&(E.c(),E.m(c,null))),(!m||C&8&&u!==(u=M[3]?"Minify legend":"Expand legend"))&&v(c,"aria-label",u),(!m||C&8&&h!==(h=M[3]?"Minify legend":"Expand legend"))&&v(a,"title",h),C&15){b=Array.from(M[0]||new Map);let x;for(x=0;x<b.length;x+=1){const P=no(M,b,x);S[x]?(S[x].p(P,C),U(S[x],1)):(S[x]=io(P),S[x].c(),U(S[x],1),S[x].m(d,null))}for(Pe(),x=b.length;x<S.length;x+=1)T(x);Le()}(!m||C&8)&&Ae(d,"is-condensed",!M[3]),(!m||C&8)&&Ae(d,"is-expanded",M[3])},i(M){if(!m){for(let C=0;C<b.length;C+=1)U(S[C]);m=!0}},o(M){S=S.filter(Boolean);for(let C=0;C<S.length;C+=1)K(S[C]);m=!1},d(M){M&&z(e),E.d(),dt(S,M),p=!1,g()}}}function qu(t,e,n){let{documentNodes:i}=e,{selectedRegions:r}=e,{toggleRegion:s}=e,o=!0;const l=()=>n(3,o=!o),a=c=>s(parseInt(c));return t.$$set=c=>{"documentNodes"in c&&n(0,i=c.documentNodes),"selectedRegions"in c&&n(1,r=c.selectedRegions),"toggleRegion"in c&&n(2,s=c.toggleRegion)},[i,r,s,o,l,a]}class Ku extends Me{constructor(e){super(),Ie(this,e,qu,Bu,Ee,{documentNodes:0,selectedRegions:1,toggleRegion:2})}}var cn;(function(t){t.Range="range",t.Steps="steps",t.Positions="positions",t.Count="count",t.Values="values"})(cn||(cn={}));var mt;(function(t){t[t.None=-1]="None",t[t.NoValue=0]="NoValue",t[t.LargeValue=1]="LargeValue",t[t.SmallValue=2]="SmallValue"})(mt||(mt={}));function Wu(t){return Ti(t)&&typeof t.from=="function"}function Ti(t){return typeof t=="object"&&typeof t.to=="function"}function ro(t){t.parentElement.removeChild(t)}function Er(t){return t!=null}function so(t){t.preventDefault()}function Yu(t){return t.filter(function(e){return this[e]?!1:this[e]=!0},{})}function Gu(t,e){return Math.round(t/e)*e}function Xu(t,e){var n=t.getBoundingClientRect(),i=t.ownerDocument,r=i.documentElement,s=ao(i);return/webkit.*Chrome.*Mobile/i.test(navigator.userAgent)&&(s.x=0),e?n.top+s.y-r.clientTop:n.left+s.x-r.clientLeft}function zt(t){return typeof t=="number"&&!isNaN(t)&&isFinite(t)}function oo(t,e,n){n>0&&(ut(t,e),setTimeout(function(){Oi(t,e)},n))}function lo(t){return Math.max(Math.min(t,100),0)}function Ni(t){return Array.isArray(t)?t:[t]}function Ju(t){t=String(t);var e=t.split(".");return e.length>1?e[1].length:0}function ut(t,e){t.classList&&!/\s/.test(e)?t.classList.add(e):t.className+=" "+e}function Oi(t,e){t.classList&&!/\s/.test(e)?t.classList.remove(e):t.className=t.className.replace(new RegExp("(^|\\b)"+e.split(" ").join("|")+"(\\b|$)","gi")," ")}function Qu(t,e){return t.classList?t.classList.contains(e):new RegExp("\\b"+e+"\\b").test(t.className)}function ao(t){var e=window.pageXOffset!==void 0,n=(t.compatMode||"")==="CSS1Compat",i=e?window.pageXOffset:n?t.documentElement.scrollLeft:t.body.scrollLeft,r=e?window.pageYOffset:n?t.documentElement.scrollTop:t.body.scrollTop;return{x:i,y:r}}function Zu(){return window.navigator.pointerEnabled?{start:"pointerdown",move:"pointermove",end:"pointerup"}:window.navigator.msPointerEnabled?{start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:{start:"mousedown touchstart",move:"mousemove touchmove",end:"mouseup touchend"}}function ef(){var t=!1;try{var e=Object.defineProperty({},"passive",{get:function(){t=!0}});window.addEventListener("test",null,e)}catch{}return t}function tf(){return window.CSS&&CSS.supports&&CSS.supports("touch-action","none")}function Cr(t,e){return 100/(e-t)}function Ir(t,e,n){return e*100/(t[n+1]-t[n])}function nf(t,e){return Ir(t,t[0]<0?e+Math.abs(t[0]):e-t[0],0)}function rf(t,e){return e*(t[1]-t[0])/100+t[0]}function ti(t,e){for(var n=1;t>=e[n];)n+=1;return n}function sf(t,e,n){if(n>=t.slice(-1)[0])return 100;var i=ti(n,t),r=t[i-1],s=t[i],o=e[i-1],l=e[i];return o+nf([r,s],n)/Cr(o,l)}function of(t,e,n){if(n>=100)return t.slice(-1)[0];var i=ti(n,e),r=t[i-1],s=t[i],o=e[i-1],l=e[i];return rf([r,s],(n-o)*Cr(o,l))}function lf(t,e,n,i){if(i===100)return i;var r=ti(i,t),s=t[r-1],o=t[r];return n?i-s>(o-s)/2?o:s:e[r-1]?t[r-1]+Gu(i-t[r-1],e[r-1]):i}var co=function(){function t(e,n,i){this.xPct=[],this.xVal=[],this.xSteps=[],this.xNumSteps=[],this.xHighestCompleteStep=[],this.xSteps=[i||!1],this.xNumSteps=[!1],this.snap=n;var r,s=[];for(Object.keys(e).forEach(function(o){s.push([Ni(e[o]),o])}),s.sort(function(o,l){return o[0][0]-l[0][0]}),r=0;r<s.length;r++)this.handleEntryPoint(s[r][1],s[r][0]);for(this.xNumSteps=this.xSteps.slice(0),r=0;r<this.xNumSteps.length;r++)this.handleStepPoint(r,this.xNumSteps[r])}return t.prototype.getDistance=function(e){for(var n=[],i=0;i<this.xNumSteps.length-1;i++)n[i]=Ir(this.xVal,e,i);return n},t.prototype.getAbsoluteDistance=function(e,n,i){var r=0;if(e<this.xPct[this.xPct.length-1])for(;e>this.xPct[r+1];)r++;else e===this.xPct[this.xPct.length-1]&&(r=this.xPct.length-2);!i&&e===this.xPct[r+1]&&r++,n===null&&(n=[]);var s,o=1,l=n[r],a=0,c=0,u=0,h=0;for(i?s=(e-this.xPct[r])/(this.xPct[r+1]-this.xPct[r]):s=(this.xPct[r+1]-e)/(this.xPct[r+1]-this.xPct[r]);l>0;)a=this.xPct[r+1+h]-this.xPct[r+h],n[r+h]*o+100-s*100>100?(c=a*s,o=(l-100*s)/n[r+h],s=1):(c=n[r+h]*a/100*o,o=0),i?(u=u-c,this.xPct.length+h>=1&&h--):(u=u+c,this.xPct.length-h>=1&&h++),l=n[r+h]*o;return e+u},t.prototype.toStepping=function(e){return e=sf(this.xVal,this.xPct,e),e},t.prototype.fromStepping=function(e){return of(this.xVal,this.xPct,e)},t.prototype.getStep=function(e){return e=lf(this.xPct,this.xSteps,this.snap,e),e},t.prototype.getDefaultStep=function(e,n,i){var r=ti(e,this.xPct);return(e===100||n&&e===this.xPct[r-1])&&(r=Math.max(r-1,1)),(this.xVal[r]-this.xVal[r-1])/i},t.prototype.getNearbySteps=function(e){var n=ti(e,this.xPct);return{stepBefore:{startValue:this.xVal[n-2],step:this.xNumSteps[n-2],highestStep:this.xHighestCompleteStep[n-2]},thisStep:{startValue:this.xVal[n-1],step:this.xNumSteps[n-1],highestStep:this.xHighestCompleteStep[n-1]},stepAfter:{startValue:this.xVal[n],step:this.xNumSteps[n],highestStep:this.xHighestCompleteStep[n]}}},t.prototype.countStepDecimals=function(){var e=this.xNumSteps.map(Ju);return Math.max.apply(null,e)},t.prototype.hasNoSize=function(){return this.xVal[0]===this.xVal[this.xVal.length-1]},t.prototype.convert=function(e){return this.getStep(this.toStepping(e))},t.prototype.handleEntryPoint=function(e,n){var i;if(e==="min"?i=0:e==="max"?i=100:i=parseFloat(e),!zt(i)||!zt(n[0]))throw new Error("noUiSlider: 'range' value isn't numeric.");this.xPct.push(i),this.xVal.push(n[0]);var r=Number(n[1]);i?this.xSteps.push(isNaN(r)?!1:r):isNaN(r)||(this.xSteps[0]=r),this.xHighestCompleteStep.push(0)},t.prototype.handleStepPoint=function(e,n){if(n){if(this.xVal[e]===this.xVal[e+1]){this.xSteps[e]=this.xHighestCompleteStep[e]=this.xVal[e];return}this.xSteps[e]=Ir([this.xVal[e],this.xVal[e+1]],n,0)/Cr(this.xPct[e],this.xPct[e+1]);var i=(this.xVal[e+1]-this.xVal[e])/this.xNumSteps[e],r=Math.ceil(Number(i.toFixed(3))-1),s=this.xVal[e]+this.xNumSteps[e]*r;this.xHighestCompleteStep[e]=s}},t}(),uo={to:function(t){return t===void 0?"":t.toFixed(2)},from:Number},fo={target:"target",base:"base",origin:"origin",handle:"handle",handleLower:"handle-lower",handleUpper:"handle-upper",touchArea:"touch-area",horizontal:"horizontal",vertical:"vertical",background:"background",connect:"connect",connects:"connects",ltr:"ltr",rtl:"rtl",textDirectionLtr:"txt-dir-ltr",textDirectionRtl:"txt-dir-rtl",draggable:"draggable",drag:"state-drag",tap:"state-tap",active:"active",tooltip:"tooltip",pips:"pips",pipsHorizontal:"pips-horizontal",pipsVertical:"pips-vertical",marker:"marker",markerHorizontal:"marker-horizontal",markerVertical:"marker-vertical",markerNormal:"marker-normal",markerLarge:"marker-large",markerSub:"marker-sub",value:"value",valueHorizontal:"value-horizontal",valueVertical:"value-vertical",valueNormal:"value-normal",valueLarge:"value-large",valueSub:"value-sub"},un={tooltips:".__tooltips",aria:".__aria"};function af(t,e){if(!zt(e))throw new Error("noUiSlider: 'step' is not numeric.");t.singleStep=e}function cf(t,e){if(!zt(e))throw new Error("noUiSlider: 'keyboardPageMultiplier' is not numeric.");t.keyboardPageMultiplier=e}function uf(t,e){if(!zt(e))throw new Error("noUiSlider: 'keyboardMultiplier' is not numeric.");t.keyboardMultiplier=e}function ff(t,e){if(!zt(e))throw new Error("noUiSlider: 'keyboardDefaultStep' is not numeric.");t.keyboardDefaultStep=e}function hf(t,e){if(typeof e!="object"||Array.isArray(e))throw new Error("noUiSlider: 'range' is not an object.");if(e.min===void 0||e.max===void 0)throw new Error("noUiSlider: Missing 'min' or 'max' in 'range'.");t.spectrum=new co(e,t.snap||!1,t.singleStep)}function df(t,e){if(e=Ni(e),!Array.isArray(e)||!e.length)throw new Error("noUiSlider: 'start' option is incorrect.");t.handles=e.length,t.start=e}function mf(t,e){if(typeof e!="boolean")throw new Error("noUiSlider: 'snap' option must be a boolean.");t.snap=e}function pf(t,e){if(typeof e!="boolean")throw new Error("noUiSlider: 'animate' option must be a boolean.");t.animate=e}function gf(t,e){if(typeof e!="number")throw new Error("noUiSlider: 'animationDuration' option must be a number.");t.animationDuration=e}function ho(t,e){var n=[!1],i;if(e==="lower"?e=[!0,!1]:e==="upper"&&(e=[!1,!0]),e===!0||e===!1){for(i=1;i<t.handles;i++)n.push(e);n.push(!1)}else{if(!Array.isArray(e)||!e.length||e.length!==t.handles+1)throw new Error("noUiSlider: 'connect' option doesn't match handle count.");n=e}t.connect=n}function _f(t,e){switch(e){case"horizontal":t.ort=0;break;case"vertical":t.ort=1;break;default:throw new Error("noUiSlider: 'orientation' option is invalid.")}}function mo(t,e){if(!zt(e))throw new Error("noUiSlider: 'margin' option must be numeric.");e!==0&&(t.margin=t.spectrum.getDistance(e))}function vf(t,e){if(!zt(e))throw new Error("noUiSlider: 'limit' option must be numeric.");if(t.limit=t.spectrum.getDistance(e),!t.limit||t.handles<2)throw new Error("noUiSlider: 'limit' option is only supported on linear sliders with 2 or more handles.")}function yf(t,e){var n;if(!zt(e)&&!Array.isArray(e))throw new Error("noUiSlider: 'padding' option must be numeric or array of exactly 2 numbers.");if(Array.isArray(e)&&!(e.length===2||zt(e[0])||zt(e[1])))throw new Error("noUiSlider: 'padding' option must be numeric or array of exactly 2 numbers.");if(e!==0){for(Array.isArray(e)||(e=[e,e]),t.padding=[t.spectrum.getDistance(e[0]),t.spectrum.getDistance(e[1])],n=0;n<t.spectrum.xNumSteps.length-1;n++)if(t.padding[0][n]<0||t.padding[1][n]<0)throw new Error("noUiSlider: 'padding' option must be a positive number(s).");var i=e[0]+e[1],r=t.spectrum.xVal[0],s=t.spectrum.xVal[t.spectrum.xVal.length-1];if(i/(s-r)>1)throw new Error("noUiSlider: 'padding' option must not exceed 100% of the range.")}}function bf(t,e){switch(e){case"ltr":t.dir=0;break;case"rtl":t.dir=1;break;default:throw new Error("noUiSlider: 'direction' option was not recognized.")}}function wf(t,e){if(typeof e!="string")throw new Error("noUiSlider: 'behaviour' must be a string containing options.");var n=e.indexOf("tap")>=0,i=e.indexOf("drag")>=0,r=e.indexOf("fixed")>=0,s=e.indexOf("snap")>=0,o=e.indexOf("hover")>=0,l=e.indexOf("unconstrained")>=0,a=e.indexOf("invert-connects")>=0,c=e.indexOf("drag-all")>=0,u=e.indexOf("smooth-steps")>=0;if(r){if(t.handles!==2)throw new Error("noUiSlider: 'fixed' behaviour must be used with 2 handles");mo(t,t.start[1]-t.start[0])}if(a&&t.handles!==2)throw new Error("noUiSlider: 'invert-connects' behaviour must be used with 2 handles");if(l&&(t.margin||t.limit))throw new Error("noUiSlider: 'unconstrained' behaviour cannot be used with margin or limit");t.events={tap:n||s,drag:i,dragAll:c,smoothSteps:u,fixed:r,snap:s,hover:o,unconstrained:l,invertConnects:a}}function Sf(t,e){if(e!==!1)if(e===!0||Ti(e)){t.tooltips=[];for(var n=0;n<t.handles;n++)t.tooltips.push(e)}else{if(e=Ni(e),e.length!==t.handles)throw new Error("noUiSlider: must pass a formatter for all handles.");e.forEach(function(i){if(typeof i!="boolean"&&!Ti(i))throw new Error("noUiSlider: 'tooltips' must be passed a formatter or 'false'.")}),t.tooltips=e}}function kf(t,e){if(e.length!==t.handles)throw new Error("noUiSlider: must pass a attributes for all handles.");t.handleAttributes=e}function Ef(t,e){if(!Ti(e))throw new Error("noUiSlider: 'ariaFormat' requires 'to' method.");t.ariaFormat=e}function Cf(t,e){if(!Wu(e))throw new Error("noUiSlider: 'format' requires 'to' and 'from' methods.");t.format=e}function If(t,e){if(typeof e!="boolean")throw new Error("noUiSlider: 'keyboardSupport' option must be a boolean.");t.keyboardSupport=e}function Mf(t,e){t.documentElement=e}function xf(t,e){if(typeof e!="string"&&e!==!1)throw new Error("noUiSlider: 'cssPrefix' must be a string or `false`.");t.cssPrefix=e}function Af(t,e){if(typeof e!="object")throw new Error("noUiSlider: 'cssClasses' must be an object.");typeof t.cssPrefix=="string"?(t.cssClasses={},Object.keys(e).forEach(function(n){t.cssClasses[n]=t.cssPrefix+e[n]})):t.cssClasses=e}function po(t){var e={margin:null,limit:null,padding:null,animate:!0,animationDuration:300,ariaFormat:uo,format:uo},n={step:{r:!1,t:af},keyboardPageMultiplier:{r:!1,t:cf},keyboardMultiplier:{r:!1,t:uf},keyboardDefaultStep:{r:!1,t:ff},start:{r:!0,t:df},connect:{r:!0,t:ho},direction:{r:!0,t:bf},snap:{r:!1,t:mf},animate:{r:!1,t:pf},animationDuration:{r:!1,t:gf},range:{r:!0,t:hf},orientation:{r:!1,t:_f},margin:{r:!1,t:mo},limit:{r:!1,t:vf},padding:{r:!1,t:yf},behaviour:{r:!0,t:wf},ariaFormat:{r:!1,t:Ef},format:{r:!1,t:Cf},tooltips:{r:!1,t:Sf},keyboardSupport:{r:!0,t:If},documentElement:{r:!1,t:Mf},cssPrefix:{r:!0,t:xf},cssClasses:{r:!0,t:Af},handleAttributes:{r:!1,t:kf}},i={connect:!1,direction:"ltr",behaviour:"tap",orientation:"horizontal",keyboardSupport:!0,cssPrefix:"noUi-",cssClasses:fo,keyboardPageMultiplier:5,keyboardMultiplier:1,keyboardDefaultStep:10};t.format&&!t.ariaFormat&&(t.ariaFormat=t.format),Object.keys(n).forEach(function(a){if(!Er(t[a])&&i[a]===void 0){if(n[a].r)throw new Error("noUiSlider: '"+a+"' is required.");return}n[a].t(e,Er(t[a])?t[a]:i[a])}),e.pips=t.pips;var r=document.createElement("div"),s=r.style.msTransform!==void 0,o=r.style.transform!==void 0;e.transformRule=o?"transform":s?"msTransform":"webkitTransform";var l=[["left","top"],["right","bottom"]];return e.style=l[e.dir][e.ort],e}function Tf(t,e,n){var i=Zu(),r=tf(),s=r&&ef(),o=t,l,a,c,u,h,f,d=e.spectrum,m=[],p=[],g=[],_=0,k={},E=!1,b=t.ownerDocument,S=e.documentElement||b.documentElement,T=b.body,M=b.dir==="rtl"||e.ort===1?0:100;function C(A,O){var $=b.createElement("div");return O&&ut($,O),A.appendChild($),$}function x(A,O){var $=C(A,e.cssClasses.origin),J=C($,e.cssClasses.handle);if(C(J,e.cssClasses.touchArea),J.setAttribute("data-handle",String(O)),e.keyboardSupport&&(J.setAttribute("tabindex","0"),J.addEventListener("keydown",function(re){return Ne(re,O)})),e.handleAttributes!==void 0){var ie=e.handleAttributes[O];Object.keys(ie).forEach(function(re){J.setAttribute(re,ie[re])})}return J.setAttribute("role","slider"),J.setAttribute("aria-orientation",e.ort?"vertical":"horizontal"),O===0?ut(J,e.cssClasses.handleLower):O===e.handles-1&&ut(J,e.cssClasses.handleUpper),$.handle=J,$}function P(A,O){return O?C(A,e.cssClasses.connect):!1}function L(A,O){a=C(O,e.cssClasses.connects),c=[],u=[],u.push(P(a,A[0]));for(var $=0;$<e.handles;$++)c.push(x(O,$)),g[$]=$,u.push(P(a,A[$+1]))}function H(A){ut(A,e.cssClasses.target),e.dir===0?ut(A,e.cssClasses.ltr):ut(A,e.cssClasses.rtl),e.ort===0?ut(A,e.cssClasses.horizontal):ut(A,e.cssClasses.vertical);var O=getComputedStyle(A).direction;return O==="rtl"?ut(A,e.cssClasses.textDirectionRtl):ut(A,e.cssClasses.textDirectionLtr),C(A,e.cssClasses.base)}function D(A,O){return!e.tooltips||!e.tooltips[O]?!1:C(A.firstChild,e.cssClasses.tooltip)}function I(){return o.hasAttribute("disabled")}function R(A){var O=c[A];return O.hasAttribute("disabled")}function N(A){A!=null?(c[A].setAttribute("disabled",""),c[A].handle.removeAttribute("tabindex")):(o.setAttribute("disabled",""),c.forEach(function(O){O.handle.removeAttribute("tabindex")}))}function V(A){A!=null?(c[A].removeAttribute("disabled"),c[A].handle.setAttribute("tabindex","0")):(o.removeAttribute("disabled"),c.forEach(function(O){O.removeAttribute("disabled"),O.handle.setAttribute("tabindex","0")}))}function q(){f&&(Ct("update"+un.tooltips),f.forEach(function(A){A&&ro(A)}),f=null)}function B(){q(),f=c.map(D),Qe("update"+un.tooltips,function(A,O,$){if(!(!f||!e.tooltips)&&f[O]!==!1){var J=A[O];e.tooltips[O]!==!0&&(J=e.tooltips[O].to($[O])),f[O].innerHTML=J}})}function X(){Ct("update"+un.aria),Qe("update"+un.aria,function(A,O,$,J,ie){g.forEach(function(re){var ge=c[re],ue=yt(p,re,0,!0,!0,!0),He=yt(p,re,100,!0,!0,!0),Ue=ie[re],Ke=String(e.ariaFormat.to($[re]));ue=d.fromStepping(ue).toFixed(1),He=d.fromStepping(He).toFixed(1),Ue=d.fromStepping(Ue).toFixed(1),ge.children[0].setAttribute("aria-valuemin",ue),ge.children[0].setAttribute("aria-valuemax",He),ge.children[0].setAttribute("aria-valuenow",Ue),ge.children[0].setAttribute("aria-valuetext",Ke)})})}function se(A){if(A.mode===cn.Range||A.mode===cn.Steps)return d.xVal;if(A.mode===cn.Count){if(A.values<2)throw new Error("noUiSlider: 'values' (>= 2) required for mode 'count'.");for(var O=A.values-1,$=100/O,J=[];O--;)J[O]=O*$;return J.push(100),le(J,A.stepped)}return A.mode===cn.Positions?le(A.values,A.stepped):A.mode===cn.Values?A.stepped?A.values.map(function(ie){return d.fromStepping(d.getStep(d.toStepping(ie)))}):A.values:[]}function le(A,O){return A.map(function($){return d.fromStepping(O?d.getStep($):$)})}function fe(A){function O(Ue,Ke){return Number((Ue+Ke).toFixed(7))}var $=se(A),J={},ie=d.xVal[0],re=d.xVal[d.xVal.length-1],ge=!1,ue=!1,He=0;return $=Yu($.slice().sort(function(Ue,Ke){return Ue-Ke})),$[0]!==ie&&($.unshift(ie),ge=!0),$[$.length-1]!==re&&($.push(re),ue=!0),$.forEach(function(Ue,Ke){var We,Fe,et,ht=Ue,rt=$[Ke+1],at,Ss,ks,Es,Lc,Cs,Rc,Dc=A.mode===cn.Steps;for(Dc&&(We=d.xNumSteps[Ke]),We||(We=rt-ht),rt===void 0&&(rt=ht),We=Math.max(We,1e-7),Fe=ht;Fe<=rt;Fe=O(Fe,We)){for(at=d.toStepping(Fe),Ss=at-He,Lc=Ss/(A.density||1),Cs=Math.round(Lc),Rc=Ss/Cs,et=1;et<=Cs;et+=1)ks=He+et*Rc,J[ks.toFixed(5)]=[d.fromStepping(ks),0];Es=$.indexOf(Fe)>-1?mt.LargeValue:Dc?mt.SmallValue:mt.NoValue,!Ke&&ge&&Fe!==rt&&(Es=0),Fe===rt&&ue||(J[at.toFixed(5)]=[Fe,Es]),He=at}}),J}function te(A,O,$){var J,ie,re=b.createElement("div"),ge=(J={},J[mt.None]="",J[mt.NoValue]=e.cssClasses.valueNormal,J[mt.LargeValue]=e.cssClasses.valueLarge,J[mt.SmallValue]=e.cssClasses.valueSub,J),ue=(ie={},ie[mt.None]="",ie[mt.NoValue]=e.cssClasses.markerNormal,ie[mt.LargeValue]=e.cssClasses.markerLarge,ie[mt.SmallValue]=e.cssClasses.markerSub,ie),He=[e.cssClasses.valueHorizontal,e.cssClasses.valueVertical],Ue=[e.cssClasses.markerHorizontal,e.cssClasses.markerVertical];ut(re,e.cssClasses.pips),ut(re,e.ort===0?e.cssClasses.pipsHorizontal:e.cssClasses.pipsVertical);function Ke(Fe,et){var ht=et===e.cssClasses.value,rt=ht?He:Ue,at=ht?ge:ue;return et+" "+rt[e.ort]+" "+at[Fe]}function We(Fe,et,ht){if(ht=O?O(et,ht):ht,ht!==mt.None){var rt=C(re,!1);rt.className=Ke(ht,e.cssClasses.marker),rt.style[e.style]=Fe+"%",ht>mt.NoValue&&(rt=C(re,!1),rt.className=Ke(ht,e.cssClasses.value),rt.setAttribute("data-value",String(et)),rt.style[e.style]=Fe+"%",rt.innerHTML=String($.to(et)))}}return Object.keys(A).forEach(function(Fe){We(Fe,A[Fe][0],A[Fe][1])}),re}function he(){h&&(ro(h),h=null)}function Y(A){he();var O=fe(A),$=A.filter,J=A.format||{to:function(ie){return String(Math.round(ie))}};return h=o.appendChild(te(O,$,J)),h}function G(){var A=l.getBoundingClientRect(),O="offset"+["Width","Height"][e.ort];return e.ort===0?A.width||l[O]:A.height||l[O]}function Z(A,O,$,J){var ie=function(ge){var ue=Q(ge,J.pageOffset,J.target||O);if(!ue||I()&&!J.doNotReject||Qu(o,e.cssClasses.tap)&&!J.doNotReject||A===i.start&&ue.buttons!==void 0&&ue.buttons>1||J.hover&&ue.buttons)return!1;s||ue.preventDefault(),ue.calcPoint=ue.points[e.ort],$(ue,J)},re=[];return A.split(" ").forEach(function(ge){O.addEventListener(ge,ie,s?{passive:!0}:!1),re.push([ge,ie])}),re}function Q(A,O,$){var J=A.type.indexOf("touch")===0,ie=A.type.indexOf("mouse")===0,re=A.type.indexOf("pointer")===0,ge=0,ue=0;if(A.type.indexOf("MSPointer")===0&&(re=!0),A.type==="mousedown"&&!A.buttons&&!A.touches)return!1;if(J){var He=function(We){var Fe=We.target;return Fe===$||$.contains(Fe)||A.composed&&A.composedPath().shift()===$};if(A.type==="touchstart"){var Ue=Array.prototype.filter.call(A.touches,He);if(Ue.length>1)return!1;ge=Ue[0].pageX,ue=Ue[0].pageY}else{var Ke=Array.prototype.find.call(A.changedTouches,He);if(!Ke)return!1;ge=Ke.pageX,ue=Ke.pageY}}return O=O||ao(b),(ie||re)&&(ge=A.clientX+O.x,ue=A.clientY+O.y),A.pageOffset=O,A.points=[ge,ue],A.cursor=ie||re,A}function $e(A){var O=A-Xu(l,e.ort),$=O*100/G();return $=lo($),e.dir?100-$:$}function Te(A){var O=100,$=!1;return c.forEach(function(J,ie){if(!R(ie)){var re=p[ie],ge=Math.abs(re-A),ue=ge===100&&O===100,He=ge<O,Ue=ge<=O&&A>re;(He||Ue||ue)&&($=ie,O=ge)}}),$}function we(A,O){A.type==="mouseout"&&A.target.nodeName==="HTML"&&A.relatedTarget===null&&ze(A,O)}function Oe(A,O){if(navigator.appVersion.indexOf("MSIE 9")===-1&&A.buttons===0&&O.buttonsProperty!==0)return ze(A,O);var $=(e.dir?-1:1)*(A.calcPoint-O.startCalcPoint),J=$*100/O.baseSize;Ht($>0,J,O.locations,O.handleNumbers,O.connect)}function ze(A,O){O.handle&&(Oi(O.handle,e.cssClasses.active),_-=1),O.listeners.forEach(function($){S.removeEventListener($[0],$[1])}),_===0&&(Oi(o,e.cssClasses.drag),nt(),A.cursor&&(T.style.cursor="",T.removeEventListener("selectstart",so))),e.events.smoothSteps&&(O.handleNumbers.forEach(function($){it($,p[$],!0,!0,!1,!1)}),O.handleNumbers.forEach(function($){Ve("update",$)})),O.handleNumbers.forEach(function($){Ve("change",$),Ve("set",$),Ve("end",$)})}function ce(A,O){if(!O.handleNumbers.some(R)){var $;if(O.handleNumbers.length===1){var J=c[O.handleNumbers[0]];$=J.children[0],_+=1,ut($,e.cssClasses.active)}A.stopPropagation();var ie=[],re=Z(i.move,S,Oe,{target:A.target,handle:$,connect:O.connect,listeners:ie,startCalcPoint:A.calcPoint,baseSize:G(),pageOffset:A.pageOffset,handleNumbers:O.handleNumbers,buttonsProperty:A.buttons,locations:p.slice()}),ge=Z(i.end,S,ze,{target:A.target,handle:$,listeners:ie,doNotReject:!0,handleNumbers:O.handleNumbers}),ue=Z("mouseout",S,we,{target:A.target,handle:$,listeners:ie,doNotReject:!0,handleNumbers:O.handleNumbers});ie.push.apply(ie,re.concat(ge,ue)),A.cursor&&(T.style.cursor=getComputedStyle(A.target).cursor,c.length>1&&ut(o,e.cssClasses.drag),T.addEventListener("selectstart",so,!1)),O.handleNumbers.forEach(function(He){Ve("start",He)})}}function ae(A){A.stopPropagation();var O=$e(A.calcPoint),$=Te(O);$!==!1&&(e.events.snap||oo(o,e.cssClasses.tap,e.animationDuration),it($,O,!0,!0),nt(),Ve("slide",$,!0),Ve("update",$,!0),e.events.snap?ce(A,{handleNumbers:[$]}):(Ve("change",$,!0),Ve("set",$,!0)))}function Se(A){var O=$e(A.calcPoint),$=d.getStep(O),J=d.fromStepping($);Object.keys(k).forEach(function(ie){ie.split(".")[0]==="hover"&&k[ie].forEach(function(re){re.call(pn,J)})})}function Ne(A,O){if(I()||R(O))return!1;var $=["Left","Right"],J=["Down","Up"],ie=["PageDown","PageUp"],re=["Home","End"];e.dir&&!e.ort?$.reverse():e.ort&&!e.dir&&(J.reverse(),ie.reverse());var ge=A.key.replace("Arrow",""),ue=ge===ie[0],He=ge===ie[1],Ue=ge===J[0]||ge===$[0]||ue,Ke=ge===J[1]||ge===$[1]||He,We=ge===re[0],Fe=ge===re[1];if(!Ue&&!Ke&&!We&&!Fe)return!0;A.preventDefault();var et;if(Ke||Ue){var ht=Ue?0:1,rt=_e(O),at=rt[ht];if(at===null)return!1;at===!1&&(at=d.getDefaultStep(p[O],Ue,e.keyboardDefaultStep)),He||ue?at*=e.keyboardPageMultiplier:at*=e.keyboardMultiplier,at=Math.max(at,1e-7),at=(Ue?-1:1)*at,et=m[O]+at}else Fe?et=e.spectrum.xVal[e.spectrum.xVal.length-1]:et=e.spectrum.xVal[0];return it(O,d.toStepping(et),!0,!0),Ve("slide",O),Ve("update",O),Ve("change",O),Ve("set",O),!1}function Xe(A){A.fixed||c.forEach(function(O,$){Z(i.start,O.children[0],ce,{handleNumbers:[$]})}),A.tap&&Z(i.start,l,ae,{}),A.hover&&Z(i.move,l,Se,{hover:!0}),A.drag&&u.forEach(function(O,$){if(!(O===!1||$===0||$===u.length-1)){var J=c[$-1],ie=c[$],re=[O],ge=[J,ie],ue=[$-1,$];ut(O,e.cssClasses.draggable),A.fixed&&(re.push(J.children[0]),re.push(ie.children[0])),A.dragAll&&(ge=c,ue=g),re.forEach(function(He){Z(i.start,He,ce,{handles:ge,handleNumbers:ue,connect:O})})}})}function Qe(A,O){k[A]=k[A]||[],k[A].push(O),A.split(".")[0]==="update"&&c.forEach(function($,J){Ve("update",J)})}function Gn(A){return A===un.aria||A===un.tooltips}function Ct(A){var O=A&&A.split(".")[0],$=O?A.substring(O.length):A;Object.keys(k).forEach(function(J){var ie=J.split(".")[0],re=J.substring(ie.length);(!O||O===ie)&&(!$||$===re)&&(!Gn(re)||$===re)&&delete k[J]})}function Ve(A,O,$){Object.keys(k).forEach(function(J){var ie=J.split(".")[0];A===ie&&k[J].forEach(function(re){re.call(pn,m.map(e.format.to),O,m.slice(),$||!1,p.slice(),pn)})})}function yt(A,O,$,J,ie,re,ge){var ue;return c.length>1&&!e.events.unconstrained&&(J&&O>0&&(ue=d.getAbsoluteDistance(A[O-1],e.margin,!1),$=Math.max($,ue)),ie&&O<c.length-1&&(ue=d.getAbsoluteDistance(A[O+1],e.margin,!0),$=Math.min($,ue))),c.length>1&&e.limit&&(J&&O>0&&(ue=d.getAbsoluteDistance(A[O-1],e.limit,!1),$=Math.min($,ue)),ie&&O<c.length-1&&(ue=d.getAbsoluteDistance(A[O+1],e.limit,!0),$=Math.max($,ue))),e.padding&&(O===0&&(ue=d.getAbsoluteDistance(0,e.padding[0],!1),$=Math.max($,ue)),O===c.length-1&&(ue=d.getAbsoluteDistance(100,e.padding[1],!0),$=Math.min($,ue))),ge||($=d.getStep($)),$=lo($),$===A[O]&&!re?!1:$}function Ze(A,O){var $=e.ort;return($?O:A)+", "+($?A:O)}function Ht(A,O,$,J,ie){var re=$.slice(),ge=J[0],ue=e.events.smoothSteps,He=[!A,A],Ue=[A,!A];J=J.slice(),A&&J.reverse(),J.length>1?J.forEach(function(We,Fe){var et=yt(re,We,re[We]+O,He[Fe],Ue[Fe],!1,ue);et===!1?O=0:(O=et-re[We],re[We]=et)}):He=Ue=[!0];var Ke=!1;J.forEach(function(We,Fe){Ke=it(We,$[We]+O,He[Fe],Ue[Fe],!1,ue)||Ke}),Ke&&(J.forEach(function(We){Ve("update",We),Ve("slide",We)}),ie!=null&&Ve("drag",ge))}function Je(A,O){return e.dir?100-A-O:A}function mn(A,O){p[A]=O,m[A]=d.fromStepping(O);var $=Je(O,0)-M,J="translate("+Ze($+"%","0")+")";if(c[A].style[e.transformRule]=J,e.events.invertConnects&&p.length>1){var ie=p.every(function(re,ge,ue){return ge===0||re>=ue[ge-1]});if(E!==!ie){Re();return}}je(A),je(A+1),E&&(je(A-1),je(A+2))}function nt(){g.forEach(function(A){var O=p[A]>50?-1:1,$=3+(c.length+O*A);c[A].style.zIndex=String($)})}function it(A,O,$,J,ie,re){return ie||(O=yt(p,A,O,$,J,!1,re)),O===!1?!1:(mn(A,O),!0)}function je(A){if(u[A]){var O=p.slice();E&&O.sort(function(ue,He){return ue-He});var $=0,J=100;A!==0&&($=O[A-1]),A!==u.length-1&&(J=O[A]);var ie=J-$,re="translate("+Ze(Je($,ie)+"%","0")+")",ge="scale("+Ze(ie/100,"1")+")";u[A].style[e.transformRule]=re+" "+ge}}function Xn(A,O){return A===null||A===!1||A===void 0||(typeof A=="number"&&(A=String(A)),A=e.format.from(A),A!==!1&&(A=d.toStepping(A)),A===!1||isNaN(A))?p[O]:A}function Xt(A,O,$){var J=Ni(A),ie=p[0]===void 0;O=O===void 0?!0:O,e.animate&&!ie&&oo(o,e.cssClasses.tap,e.animationDuration),g.forEach(function(ue){it(ue,Xn(J[ue],ue),!0,!1,$)});var re=g.length===1?0:1;if(ie&&d.hasNoSize()&&($=!0,p[0]=0,g.length>1)){var ge=100/(g.length-1);g.forEach(function(ue){p[ue]=ue*ge})}for(;re<g.length;++re)g.forEach(function(ue){it(ue,p[ue],!0,!0,$)});nt(),g.forEach(function(ue){Ve("update",ue),J[ue]!==null&&O&&Ve("set",ue)})}function bt(A){Xt(e.start,A)}function En(A,O,$,J){if(A=Number(A),!(A>=0&&A<g.length))throw new Error("noUiSlider: invalid handle number, got: "+A);it(A,Xn(O,A),!0,!0,J),Ve("update",A),$&&Ve("set",A)}function It(A){if(A===void 0&&(A=!1),A)return m.length===1?m[0]:m.slice(0);var O=m.map(e.format.to);return O.length===1?O[0]:O}function Cn(){for(Ct(un.aria),Ct(un.tooltips),Object.keys(e.cssClasses).forEach(function(A){Oi(o,e.cssClasses[A])});o.firstChild;)o.removeChild(o.firstChild);delete o.noUiSlider}function _e(A){var O=p[A],$=d.getNearbySteps(O),J=m[A],ie=$.thisStep.step,re=null;if(e.snap)return[J-$.stepBefore.startValue||null,$.stepAfter.startValue-J||null];ie!==!1&&J+ie>$.stepAfter.startValue&&(ie=$.stepAfter.startValue-J),J>$.thisStep.startValue?re=$.thisStep.step:$.stepBefore.step===!1?re=!1:re=J-$.stepBefore.highestStep,O===100?ie=null:O===0&&(re=null);var ge=d.countStepDecimals();return ie!==null&&ie!==!1&&(ie=Number(ie.toFixed(ge))),re!==null&&re!==!1&&(re=Number(re.toFixed(ge))),[re,ie]}function qe(){return g.map(_e)}function Rt(A,O){var $=It(),J=["margin","limit","padding","range","animate","snap","step","format","pips","tooltips","connect"];J.forEach(function(re){A[re]!==void 0&&(n[re]=A[re])});var ie=po(n);J.forEach(function(re){A[re]!==void 0&&(e[re]=ie[re])}),d=ie.spectrum,e.margin=ie.margin,e.limit=ie.limit,e.padding=ie.padding,e.pips?Y(e.pips):he(),e.tooltips?B():q(),p=[],Xt(Er(A.start)?A.start:$,O),A.connect&&ee()}function ee(){for(;a.firstChild;)a.removeChild(a.firstChild);for(var A=0;A<=e.handles;A++)u[A]=P(a,e.connect[A]),je(A);Xe({drag:e.events.drag,fixed:!0})}function Re(){E=!E,ho(e,e.connect.map(function(A){return!A})),ee()}function Be(){l=H(o),L(e.connect,l),Xe(e.events),Xt(e.start),e.pips&&Y(e.pips),e.tooltips&&B(),X()}Be();var pn={destroy:Cn,steps:qe,on:Qe,off:Ct,get:It,set:Xt,setHandle:En,reset:bt,disable:N,enable:V,__moveHandles:function(A,O,$){Ht(A,O,p,$)},options:n,updateOptions:Rt,target:o,removePips:he,removeTooltips:q,getPositions:function(){return p.slice()},getTooltips:function(){return f},getOrigins:function(){return c},pips:Y};return pn}function Nf(t,e){if(!t||!t.nodeName)throw new Error("noUiSlider: create requires a single element, got: "+t);if(t.noUiSlider)throw new Error("noUiSlider: Slider was already initialized.");var n=po(e),i=Tf(t,n,e);return t.noUiSlider=i,i}const Of={__spectrum:co,cssClasses:fo,create:Nf},Wy="",Yy="";function Pf(t){let e,n,i;return{c(){e=w("span"),n=oe(t[0]),v(e,"id",t[3]),v(e,"class",i="tooltip "+t[2]+" "+(t[1]?"display":"")+" svelte-1am23me")},m(r,s){j(r,e,s),y(e,n)},p(r,[s]){s&1&&Ce(n,r[0]),s&6&&i!==(i="tooltip "+r[2]+" "+(r[1]?"display":"")+" svelte-1am23me")&&v(e,"class",i)},i:ne,o:ne,d(r){r&&z(e)}}}function Lf(t,e,n){let i,r,s,o,{tooltipText:l}=e,{targetHtmlId:a}=e;const c=`tooltip-generic-${window.crypto.randomUUID()}`,u=()=>n(1,o=!0),h=()=>n(1,o=!1),f=()=>n(1,o=!o);return An(()=>{s=a?document.getElementById(a):document.getElementById(c).parentElement,a&&!s&&(console.error(`TooltipGeneric: element with ID ${a} not found, defaulting to the parent element`),s=document.getElementById(c).targetElement),s.addEventListener("mouseover",u),s.addEventListener("mouseout",h),s.addEventListener("click",f)}),Tn(()=>{s.removeEventListener("mouseover",u),s.removeEventListener("mouseout",h),s.removeEventListener("click",f)}),t.$$set=d=>{"tooltipText"in d&&n(0,l=d.tooltipText),"targetHtmlId"in d&&n(4,a=d.targetHtmlId)},t.$$.update=()=>{t.$$.dirty&33&&n(2,i=r(l))},n(5,r=d=>n(2,i=d.length>100?"tooltip-wide":d.length>20?"tooltip-mid":"tooltip-thin")),s=void 0,n(1,o=!1),[l,o,i,c,a,r]}class Pi extends Me{constructor(e){super(),Ie(this,e,Lf,Pf,Ee,{tooltipText:0,targetHtmlId:4})}}const Gy="";function Rf(t){let e,n,i,r,s,o,l,a,c,u,h,f,d,m,p,g;return{c(){e=w("div"),n=w("span"),i=oe(t[2]),r=oe(" ("),s=oe(t[3]),o=oe(")"),l=F(),a=w("div"),c=w("span"),u=oe(t[0]),h=F(),f=w("div"),d=w("div"),m=F(),p=w("span"),g=oe(t[1]),v(c,"class","range-marker svelte-216mtn"),v(d,"class","slider"),v(d,"id",t[4]),v(f,"class","slider-wrapper svelte-216mtn"),v(p,"class","range-marker svelte-216mtn"),v(a,"class","slider-outer-wrapper is-flex flex-direction-row svelte-216mtn")},m(_,k){j(_,e,k),y(e,n),y(n,i),y(n,r),y(n,s),y(n,o),y(e,l),y(e,a),y(a,c),y(c,u),y(a,h),y(a,f),y(f,d),y(a,m),y(a,p),y(p,g)},p(_,[k]){k&4&&Ce(i,_[2]),k&8&&Ce(s,_[3]),k&1&&Ce(u,_[0]),k&2&&Ce(g,_[1])},i:ne,o:ne,d(_){_&&z(e)}}}function Df(t,e,n){let i,{minVal:r}=e,{maxVal:s}=e,{start:o}=e,{step:l=void 0}=e,{roundTo:a=2}=e,{title:c=""}=e,{emitOnUpdate:u=!1}=e;const h=Ii(),f=`slider-${window.crypto.randomUUID()}`,d=Array.isArray(o)&&o.length===2&&o.every(C=>!isNaN(parseFloat(C))),m=[],p=d?[`noUi-handle-${window.crypto.randomUUID()}`,`noUi-handle-${window.crypto.randomUUID()}`]:[`noUi-handle-${window.crypto.randomUUID()}`],g=xi();g.setCompareFn(d?kr:(C,x)=>k(C)===k(x)),g.set(o);const _=xt("resetTrigger")||void 0;_==null||_.subscribe(S);const k=C=>Number(C.toFixed(a)),E=(C,x)=>{C=Array.isArray(C)?C.map(k):k(C),n(3,i=C),(x==="set"||x==="update"&&u)&&(g.set(C),g.same()||h("updateSlider",g.get()))};function b(C){m.length&&m.map((x,P)=>x.$set({tooltipText:d?C[P]:C}))}function S(){const C=document.getElementById(f);C!=null&&C.noUiSlider&&C.noUiSlider.reset()}function T(){const C=document.getElementById(f);let x;Of.create(C,{start:o,step:l,connect:d?!0:"lower",range:{min:r,max:s},handleAttributes:p.map(P=>({id:P}))}),C.noUiSlider.on("update",()=>{x=C.noUiSlider.get(!0),E(x,"update")}),C.noUiSlider.on("set",()=>{x=C.noUiSlider.get(!0),E(x,"set")})}function M(){p.map((C,x)=>{m.push(new Pi({target:document.getElementById(C),props:d?{tooltipText:i[x]}:{tooltipText:i}}))})}return An(()=>{T(),M()}),Tn(()=>{document.getElementById(f)&&(document.getElementById(f).innerHTML="")}),t.$$set=C=>{"minVal"in C&&n(0,r=C.minVal),"maxVal"in C&&n(1,s=C.maxVal),"start"in C&&n(5,o=C.start),"step"in C&&n(6,l=C.step),"roundTo"in C&&n(7,a=C.roundTo),"title"in C&&n(2,c=C.title),"emitOnUpdate"in C&&n(8,u=C.emitOnUpdate)},t.$$.update=()=>{t.$$.dirty&32&&n(3,i=o),t.$$.dirty&8&&b(i)},[r,s,c,i,f,o,l,a,u]}class _n extends Me{constructor(e){super(),Ie(this,e,Df,Rf,Ee,{minVal:0,maxVal:1,start:5,step:6,roundTo:7,title:2,emitOnUpdate:8})}}const $f=t=>({}),go=t=>({});function _o(t,e,n){const i=t.slice();return i[42]=e[n],i}function vo(t,e,n){const i=t.slice();return i[45]=e[n],i}function yo(t,e,n){const i=t.slice();return i[42]=e[n],i}function bo(t,e,n){const i=t.slice();i[50]=e[n];const r=Object.keys(i[27][i[50]]||{});return i[51]=r,i}function wo(t){var Rt;let e,n,i,r=((Rt=t[0])==null?void 0:Rt.title)+"",s,o,l,a,c,u,h,f,d,m=(t[3].pairs||0)+"",p,g,_,k,E,b,S,T=(t[3].images||0)+"",M,C,x,P,L,H,D,I=(t[4]||0)+"",R,N,V,q,B,X,se,le,fe,te,he,Y,G,Z,Q,$e,Te,we,Oe,ze,ce,ae,Se,Ne,Xe,Qe,Gn,Ct,Ve,yt,Ze,Ht=["Series","Witness","Work"],Je=[];for(let ee=0;ee<3;ee+=1)Je[ee]=So(bo(t,Ht,ee));B=new Ku({props:{documentNodes:t[5],selectedRegions:t[6],toggleRegion:t[17]}});let mn=["all","filtered"],nt=[];for(let ee=0;ee<2;ee+=1)nt[ee]=ko(yo(t,mn,ee));let it=t[28],je=[];for(let ee=0;ee<it.length;ee+=1)je[ee]=Eo(vo(t,it,ee));const Xn=ee=>K(je[ee],1,1,()=>{je[ee]=null});let Xt=["threshold","topk"],bt=[];for(let ee=0;ee<2;ee+=1)bt[ee]=Co(_o(t,Xt,ee));const En=[Ff,jf],It=[];function Cn(ee,Re){return ee[7]==="threshold"?0:1}Se=Cn(t),Ne=It[Se]=En[Se](t);const _e=t[34].datavizInfo,qe=Nt(_e,t,t[33],go);return{c(){e=w("div"),n=w("div"),i=w("h1"),s=oe(r),o=F(),l=w("div");for(let ee=0;ee<3;ee+=1)Je[ee].c();a=F(),c=w("div"),u=w("div"),h=w("p"),h.textContent=`${W==="en"?"Pairs":"Paires"}`,f=F(),d=w("p"),p=oe(m),g=F(),_=w("div"),k=w("div"),E=w("p"),E.textContent="Images",b=F(),S=w("p"),M=oe(T),C=F(),x=w("div"),P=w("div"),L=w("p"),L.textContent="Clusters",H=F(),D=w("p"),R=oe(I),N=F(),V=w("hr"),q=F(),pe(B.$$.fragment),X=F(),se=w("hr"),le=F(),fe=w("div"),te=w("h3"),te.textContent=`${W==="en"?"Similarity categories":"Catégories de similarité"}`,he=F(),Y=w("div");for(let ee=0;ee<2;ee+=1)nt[ee].c();G=F(),Z=w("div");for(let ee=0;ee<je.length;ee+=1)je[ee].c();Q=F(),$e=w("hr"),Te=F(),we=w("div"),Oe=w("h3"),Oe.textContent=`${W==="en"?"Similarity score":"Score de similarité"}`,ze=F(),ce=w("div");for(let ee=0;ee<2;ee+=1)bt[ee].c();ae=F(),Ne.c(),Xe=F(),Qe=w("hr"),Gn=F(),Ct=w("div"),Ve=w("h3"),Ve.textContent=`${W==="en"?"Visualisation information":"Informations sur la visualisation"}`,yt=F(),qe&&qe.c(),v(i,"class","title"),v(h,"class","heading"),v(d,"class","title is-5"),v(c,"class","level-item has-text-centered"),v(E,"class","heading"),v(S,"class","title is-5"),v(_,"class","level-item has-text-centered"),v(L,"class","heading"),v(D,"class","title is-5"),v(x,"class","level-item has-text-centered"),v(l,"class","level"),v(n,"class","pb-2"),v(te,"class","title"),v(Y,"class","buttons mb-3"),v(Z,"class","level"),Ae(Z,"is-disabled",t[1]==="all"),v(fe,"class","pt-2"),v(Oe,"class","title"),v(ce,"class","buttons mb-3"),v(we,"class","pt-2"),v(Ve,"class","title"),v(Ct,"class","py-2"),v(e,"class","content is-small mt-4")},m(ee,Re){j(ee,e,Re),y(e,n),y(n,i),y(i,s),y(n,o),y(n,l);for(let Be=0;Be<3;Be+=1)Je[Be]&&Je[Be].m(l,null);y(l,a),y(l,c),y(c,u),y(u,h),y(u,f),y(u,d),y(d,p),y(l,g),y(l,_),y(_,k),y(k,E),y(k,b),y(k,S),y(S,M),y(l,C),y(l,x),y(x,P),y(P,L),y(P,H),y(P,D),y(D,R),y(e,N),y(e,V),y(e,q),de(B,e,null),y(e,X),y(e,se),y(e,le),y(e,fe),y(fe,te),y(fe,he),y(fe,Y);for(let Be=0;Be<2;Be+=1)nt[Be]&&nt[Be].m(Y,null);y(fe,G),y(fe,Z);for(let Be=0;Be<je.length;Be+=1)je[Be]&&je[Be].m(Z,null);y(e,Q),y(e,$e),y(e,Te),y(e,we),y(we,Oe),y(we,ze),y(we,ce);for(let Be=0;Be<2;Be+=1)bt[Be]&&bt[Be].m(ce,null);y(we,ae),It[Se].m(we,null),y(e,Xe),y(e,Qe),y(e,Gn),y(e,Ct),y(Ct,Ve),y(Ct,yt),qe&&qe.m(Ct,null),Ze=!0},p(ee,Re){var A;if((!Ze||Re[0]&1)&&r!==(r=((A=ee[0])==null?void 0:A.title)+"")&&Ce(s,r),Re[0]&134217728){Ht=["Series","Witness","Work"];let O;for(O=0;O<3;O+=1){const $=bo(ee,Ht,O);Je[O]?Je[O].p($,Re):(Je[O]=So($),Je[O].c(),Je[O].m(l,a))}for(;O<3;O+=1)Je[O].d(1)}(!Ze||Re[0]&8)&&m!==(m=(ee[3].pairs||0)+"")&&Ce(p,m),(!Ze||Re[0]&8)&&T!==(T=(ee[3].images||0)+"")&&Ce(M,T),(!Ze||Re[0]&16)&&I!==(I=(ee[4]||0)+"")&&Ce(R,I);const Be={};if(Re[0]&32&&(Be.documentNodes=ee[5]),Re[0]&64&&(Be.selectedRegions=ee[6]),B.$set(Be),Re[0]&536870914){mn=["all","filtered"];let O;for(O=0;O<2;O+=1){const $=yo(ee,mn,O);nt[O]?nt[O].p($,Re):(nt[O]=ko($),nt[O].c(),nt[O].m(Y,null))}for(;O<2;O+=1)nt[O].d(1)}if(Re[0]&268468238){it=ee[28];let O;for(O=0;O<it.length;O+=1){const $=vo(ee,it,O);je[O]?(je[O].p($,Re),U(je[O],1)):(je[O]=Eo($),je[O].c(),U(je[O],1),je[O].m(Z,null))}for(Pe(),O=it.length;O<je.length;O+=1)Xn(O);Le()}if((!Ze||Re[0]&2)&&Ae(Z,"is-disabled",ee[1]==="all"),Re[0]&1073741952){Xt=["threshold","topk"];let O;for(O=0;O<2;O+=1){const $=_o(ee,Xt,O);bt[O]?bt[O].p($,Re):(bt[O]=Co($),bt[O].c(),bt[O].m(ce,null))}for(;O<2;O+=1)bt[O].d(1)}let pn=Se;Se=Cn(ee),Se===pn?It[Se].p(ee,Re):(Pe(),K(It[pn],1,1,()=>{It[pn]=null}),Le(),Ne=It[Se],Ne?Ne.p(ee,Re):(Ne=It[Se]=En[Se](ee),Ne.c()),U(Ne,1),Ne.m(we,null)),qe&&qe.p&&(!Ze||Re[1]&4)&&Pt(qe,_e,ee,ee[33],Ze?Ot(_e,ee[33],Re,$f):Lt(ee[33]),go)},i(ee){if(!Ze){U(B.$$.fragment,ee);for(let Re=0;Re<it.length;Re+=1)U(je[Re]);U(Ne),U(qe,ee),Ze=!0}},o(ee){K(B.$$.fragment,ee),je=je.filter(Boolean);for(let Re=0;Re<je.length;Re+=1)K(je[Re]);K(Ne),K(qe,ee),Ze=!1},d(ee){ee&&z(e),dt(Je,ee),me(B),dt(nt,ee),dt(je,ee),dt(bt,ee),It[Se].d(),qe&&qe.d(ee)}}}function zf(t){let e,n,i,r=uu[t[50]]+"",s,o,l,a=(t[51].length||0)+"",c;return{c(){e=w("div"),n=w("div"),i=w("p"),s=oe(r),o=F(),l=w("p"),c=oe(a),v(i,"class","heading"),v(l,"class","title is-5"),v(e,"class","level-item has-text-centered")},m(u,h){j(u,e,h),y(e,n),y(n,i),y(i,s),y(n,o),y(n,l),y(l,c)},p:ne,d(u){u&&z(e)}}}function So(t){let e,n=t[51].length>0&&zf(t);return{c(){n&&n.c(),e=ct()},m(i,r){n&&n.m(i,r),j(i,e,r)},p(i,r){i[51].length>0&&n.p(i,r)},d(i){n&&n.d(i),i&&z(e)}}}function ko(t){let e,n=t[42]==="all"?W==="en"?"All pairs":"Toutes les paires":W==="en"?"Filter by category":"Filtrer par catégorie",i,r,s,o;function l(){return t[35](t[42])}return{c(){e=w("button"),i=oe(n),r=F(),v(e,"class","button is-small is-flex-grow-1"),Ae(e,"is-link",t[1]===t[42]),Ae(e,"is-contrasted",t[1]!==t[42])},m(a,c){j(a,e,c),y(e,i),y(e,r),s||(o=be(e,"click",l),s=!0)},p(a,c){t=a,c[0]&2&&Ae(e,"is-link",t[1]===t[42]),c[0]&2&&Ae(e,"is-contrasted",t[1]!==t[42])},d(a){a&&z(e),s=!1,o()}}}function Eo(t){let e,n,i,r,s,o=(t[3].categories[t[45]]||0)+"",l,a,c;return i=new zn({props:{category:t[45],isSelected:t[2].includes(t[45]),toggle:t[36],selectable:t[1]==="filtered"}}),{c(){e=w("div"),n=w("div"),pe(i.$$.fragment),r=F(),s=w("p"),l=oe(o),a=F(),v(s,"class","is-size-7 mt-1"),v(e,"class","level-item has-text-centered")},m(u,h){j(u,e,h),y(e,n),de(i,n,null),y(n,r),y(n,s),y(s,l),y(e,a),c=!0},p(u,h){const f={};h[0]&4&&(f.isSelected=u[2].includes(u[45])),h[0]&2&&(f.toggle=u[36]),h[0]&2&&(f.selectable=u[1]==="filtered"),i.$set(f),(!c||h[0]&8)&&o!==(o=(u[3].categories[u[45]]||0)+"")&&Ce(l,o)},i(u){c||(U(i.$$.fragment,u),c=!0)},o(u){K(i.$$.fragment,u),c=!1},d(u){u&&z(e),me(i)}}}function Co(t){let e,n=t[42]==="threshold"?W==="en"?"Score threshold":"Seuil de score":W==="en"?"Top K pairs":"Top K paires",i,r,s,o;function l(){return t[37](t[42])}return{c(){e=w("button"),i=oe(n),r=F(),v(e,"class","button is-small is-flex-grow-1"),Ae(e,"is-link",t[7]===t[42]),Ae(e,"is-contrasted",t[7]!==t[42])},m(a,c){j(a,e,c),y(e,i),y(e,r),s||(o=be(e,"click",l),s=!0)},p(a,c){t=a,c[0]&128&&Ae(e,"is-link",t[7]===t[42]),c[0]&128&&Ae(e,"is-contrasted",t[7]!==t[42])},d(a){a&&z(e),s=!1,o()}}}function jf(t){let e,n,i,r,s,o,l,a,c,u,h,f;return i=new _n({props:{minVal:1,maxVal:5,start:t[10]||3,step:1,roundTo:0,title:"K"}}),i.$on("updateSlider",t[39]),{c(){e=w("div"),n=w("div"),pe(i.$$.fragment),r=F(),s=w("div"),o=w("label"),l=w("input"),a=F(),c=w("span"),c.textContent=`${W==="en"?"Mutual top K":"Top K mutuel"}`,v(n,"class","column is-two-thirds pl-4"),l.checked=t[11],v(l,"type","checkbox"),v(l,"class","mr-2"),v(c,"class","is-size-7"),v(o,"class","checkbox mt-3 is-flex is-align-items-center"),v(s,"class","column mt-2"),v(e,"class","columns mt-2")},m(d,m){j(d,e,m),y(e,n),de(i,n,null),y(e,r),y(e,s),y(s,o),y(o,l),y(o,a),y(o,c),u=!0,h||(f=be(l,"change",t[40]),h=!0)},p(d,m){const p={};m[0]&1024&&(p.start=d[10]||3),i.$set(p),(!u||m[0]&2048)&&(l.checked=d[11])},i(d){u||(U(i.$$.fragment,d),u=!0)},o(d){K(i.$$.fragment,d),u=!1},d(d){d&&z(e),me(i),h=!1,f()}}}function Ff(t){var i,r;let e,n;return e=new _n({props:{minVal:((i=t[8].scoreRange)==null?void 0:i.min)||0,maxVal:((r=t[8].scoreRange)==null?void 0:r.max)||1,start:t[9],step:.01,roundTo:2,title:W==="en"?"Minimum score":"Score minimum"}}),e.$on("updateSlider",t[38]),{c(){pe(e.$$.fragment)},m(s,o){de(e,s,o),n=!0},p(s,o){var a,c;const l={};o[0]&256&&(l.minVal=((a=s[8].scoreRange)==null?void 0:a.min)||0),o[0]&256&&(l.maxVal=((c=s[8].scoreRange)==null?void 0:c.max)||1),o[0]&512&&(l.start=s[9]),e.$set(l)},i(s){n||(U(e.$$.fragment,s),n=!0)},o(s){K(e.$$.fragment,s),n=!1},d(s){me(e,s)}}}function Vf(t){let e,n,i=t[3]&&wo(t);return{c(){e=w("div"),i&&i.c(),v(e,"class","m-4 py-5 px-4")},m(r,s){j(r,e,s),i&&i.m(e,null),n=!0},p(r,s){r[3]?i?(i.p(r,s),s[0]&8&&U(i,1)):(i=wo(r),i.c(),U(i,1),i.m(e,null)):i&&(Pe(),K(i,1,1,()=>{i=null}),Le())},i(r){n||(U(i),n=!0)},o(r){K(i),n=!1},d(r){r&&z(e),i&&i.d()}}}function Hf(t,e,n){let i,r,s,o,l,a,c,u,h,f,{$$slots:d={},$$scope:m}=e,{docSet:p=null}=e,{documentSetStore:g}=e,{clusterStore:_}=e;const{docSetNumber:k,documentNodes:E,selectedCategories:b,toggleCategory:S,selectedRegions:T,toggleRegion:M,threshold:C,setThreshold:x,topK:P,setTopK:L,mutualTopK:H,setMutualTopK:D,scoreMode:I,setScoreMode:R,pairStats:N}=g;ye(t,k,Q=>n(3,r=Q)),ye(t,E,Q=>n(5,o=Q)),ye(t,b,Q=>n(2,i=Q)),ye(t,T,Q=>n(6,l=Q)),ye(t,C,Q=>n(9,u=Q)),ye(t,P,Q=>n(10,h=Q)),ye(t,H,Q=>n(11,f=Q)),ye(t,I,Q=>n(7,a=Q)),ye(t,N,Q=>n(8,c=Q));const{clusterNb:V}=_;ye(t,V,Q=>n(4,s=Q));const q=xt("selectedDocuments"),B=[0,1,2,3,5];let X="all";function se(Q){n(1,X=Q),Q==="all"&&i.length!==B.length&&b.set(B)}function le(Q){R(Q)}const fe=Q=>se(Q),te=Q=>X==="filtered"?S(Q):null,he=Q=>le(Q),Y=Q=>x(Q.detail),G=Q=>L(Q.detail),Z=()=>D(!f);return t.$$set=Q=>{"docSet"in Q&&n(0,p=Q.docSet),"documentSetStore"in Q&&n(31,g=Q.documentSetStore),"clusterStore"in Q&&n(32,_=Q.clusterStore),"$$scope"in Q&&n(33,m=Q.$$scope)},[p,X,i,r,s,o,l,a,c,u,h,f,k,E,b,S,T,M,C,x,P,L,H,D,I,N,V,q,B,se,le,g,_,m,d,fe,te,he,Y,G,Z]}class Uf extends Me{constructor(e){super(),Ie(this,e,Hf,Vf,Ee,{docSet:0,documentSetStore:31,clusterStore:32},null,[-1,-1])}}function Li(t,e){return t==null||e==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function Bf(t,e){return t==null||e==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function Io(t){let e,n,i;t.length!==2?(e=Li,n=(l,a)=>Li(t(l),a),i=(l,a)=>t(l)-a):(e=t===Li||t===Bf?t:qf,n=t,i=t);function r(l,a,c=0,u=l.length){if(c<u){if(e(a,a)!==0)return u;do{const h=c+u>>>1;n(l[h],a)<0?c=h+1:u=h}while(c<u)}return c}function s(l,a,c=0,u=l.length){if(c<u){if(e(a,a)!==0)return u;do{const h=c+u>>>1;n(l[h],a)<=0?c=h+1:u=h}while(c<u)}return c}function o(l,a,c=0,u=l.length){const h=r(l,a,c,u-1);return h>c&&i(l[h-1],a)>-i(l[h],a)?h-1:h}return{left:r,center:o,right:s}}function qf(){return 0}function Kf(t){return t===null?NaN:+t}const Wf=Io(Li).right;Io(Kf).center;const Mo=Wf;function Yf(t,e){let n=0;if(e===void 0)for(let i of t)i!=null&&(i=+i)>=i&&++n;else{let i=-1;for(let r of t)(r=e(r,++i,t))!=null&&(r=+r)>=r&&++n}return n}function Mr(t,e){let n,i;if(e===void 0)for(const r of t)r!=null&&(n===void 0?r>=r&&(n=i=r):(n>r&&(n=r),i<r&&(i=r)));else{let r=-1;for(let s of t)(s=e(s,++r,t))!=null&&(n===void 0?s>=s&&(n=i=s):(n>s&&(n=s),i<s&&(i=s)))}return[n,i]}class xo extends Map{constructor(e,n=Jf){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:n}}),e!=null)for(const[i,r]of e)this.set(i,r)}get(e){return super.get(Ao(this,e))}has(e){return super.has(Ao(this,e))}set(e,n){return super.set(Gf(this,e),n)}delete(e){return super.delete(Xf(this,e))}}function Ao({_intern:t,_key:e},n){const i=e(n);return t.has(i)?t.get(i):n}function Gf({_intern:t,_key:e},n){const i=e(n);return t.has(i)?t.get(i):(t.set(i,n),n)}function Xf({_intern:t,_key:e},n){const i=e(n);return t.has(i)&&(n=t.get(i),t.delete(i)),n}function Jf(t){return t!==null&&typeof t=="object"?t.valueOf():t}function Qf(t){return t}var Zf=Array.prototype,eh=Zf.slice;function xr(t){return()=>t}const th=Math.sqrt(50),nh=Math.sqrt(10),ih=Math.sqrt(2);function Ri(t,e,n){const i=(e-t)/Math.max(0,n),r=Math.floor(Math.log10(i)),s=i/Math.pow(10,r),o=s>=th?10:s>=nh?5:s>=ih?2:1;let l,a,c;return r<0?(c=Math.pow(10,-r)/o,l=Math.round(t*c),a=Math.round(e*c),l/c<t&&++l,a/c>e&&--a,c=-c):(c=Math.pow(10,r)*o,l=Math.round(t/c),a=Math.round(e/c),l*c<t&&++l,a*c>e&&--a),a<l&&.5<=n&&n<2?Ri(t,e,n*2):[l,a,c]}function To(t,e,n){if(e=+e,t=+t,n=+n,!(n>0))return[];if(t===e)return[t];const i=e<t,[r,s,o]=i?Ri(e,t,n):Ri(t,e,n);if(!(s>=r))return[];const l=s-r+1,a=new Array(l);if(i)if(o<0)for(let c=0;c<l;++c)a[c]=(s-c)/-o;else for(let c=0;c<l;++c)a[c]=(s-c)*o;else if(o<0)for(let c=0;c<l;++c)a[c]=(r+c)/-o;else for(let c=0;c<l;++c)a[c]=(r+c)*o;return a}function jn(t,e,n){return e=+e,t=+t,n=+n,Ri(t,e,n)[2]}function rh(t,e,n){e=+e,t=+t,n=+n;const i=e<t,r=i?jn(e,t,n):jn(t,e,n);return(i?-1:1)*(r<0?1/-r:r)}function sh(t,e,n){let i;for(;;){const r=jn(t,e,n);if(r===i||r===0||!isFinite(r))return[t,e];r>0?(t=Math.floor(t/r)*r,e=Math.ceil(e/r)*r):r<0&&(t=Math.ceil(t*r)/r,e=Math.floor(e*r)/r),i=r}}function oh(t){return Math.max(1,Math.ceil(Math.log(Yf(t))/Math.LN2)+1)}function No(){var t=Qf,e=Mr,n=oh;function i(r){Array.isArray(r)||(r=Array.from(r));var s,o=r.length,l,a,c=new Array(o);for(s=0;s<o;++s)c[s]=t(r[s],s,r);var u=e(c),h=u[0],f=u[1],d=n(c,h,f);if(!Array.isArray(d)){const E=f,b=+d;if(e===Mr&&([h,f]=sh(h,f,b)),d=To(h,f,b),d[0]<=h&&(a=jn(h,f,b)),d[d.length-1]>=f)if(E>=f&&e===Mr){const S=jn(h,f,b);isFinite(S)&&(S>0?f=(Math.floor(f/S)+1)*S:S<0&&(f=(Math.ceil(f*-S)+1)/-S))}else d.pop()}for(var m=d.length,p=0,g=m;d[p]<=h;)++p;for(;d[g-1]>f;)--g;(p||g<m)&&(d=d.slice(p,g),m=g-p);var _=new Array(m+1),k;for(s=0;s<=m;++s)k=_[s]=[],k.x0=s>0?d[s-1]:h,k.x1=s<m?d[s]:f;if(isFinite(a)){if(a>0)for(s=0;s<o;++s)(l=c[s])!=null&&h<=l&&l<=f&&_[Math.min(m,Math.floor((l-h)/a))].push(r[s]);else if(a<0){for(s=0;s<o;++s)if((l=c[s])!=null&&h<=l&&l<=f){const E=Math.floor((h-l)*a);_[Math.min(m,E+(d[E]<=l))].push(r[s])}}}else for(s=0;s<o;++s)(l=c[s])!=null&&h<=l&&l<=f&&_[Mo(d,l,0,m)].push(r[s]);return _}return i.value=function(r){return arguments.length?(t=typeof r=="function"?r:xr(r),i):t},i.domain=function(r){return arguments.length?(e=typeof r=="function"?r:xr([r[0],r[1]]),i):e},i.thresholds=function(r){return arguments.length?(n=typeof r=="function"?r:xr(Array.isArray(r)?eh.call(r):r),i):n},i}function Di(t,e,n){t=+t,e=+e,n=(r=arguments.length)<2?(e=t,t=0,1):r<3?1:+n;for(var i=-1,r=Math.max(0,Math.ceil((e-t)/n))|0,s=new Array(r);++i<r;)s[i]=t+i*n;return s}function lh(t){return t}var Ar=1,Tr=2,Nr=3,ni=4,Oo=1e-6;function ah(t){return"translate("+t+",0)"}function ch(t){return"translate(0,"+t+")"}function uh(t){return e=>+t(e)}function fh(t,e){return e=Math.max(0,t.bandwidth()-e*2)/2,t.round()&&(e=Math.round(e)),n=>+t(n)+e}function hh(){return!this.__axis}function Po(t,e){var n=[],i=null,r=null,s=6,o=6,l=3,a=typeof window<"u"&&window.devicePixelRatio>1?0:.5,c=t===Ar||t===ni?-1:1,u=t===ni||t===Tr?"x":"y",h=t===Ar||t===Nr?ah:ch;function f(d){var m=i??(e.ticks?e.ticks.apply(e,n):e.domain()),p=r??(e.tickFormat?e.tickFormat.apply(e,n):lh),g=Math.max(s,0)+l,_=e.range(),k=+_[0]+a,E=+_[_.length-1]+a,b=(e.bandwidth?fh:uh)(e.copy(),a),S=d.selection?d.selection():d,T=S.selectAll(".domain").data([null]),M=S.selectAll(".tick").data(m,e).order(),C=M.exit(),x=M.enter().append("g").attr("class","tick"),P=M.select("line"),L=M.select("text");T=T.merge(T.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),M=M.merge(x),P=P.merge(x.append("line").attr("stroke","currentColor").attr(u+"2",c*s)),L=L.merge(x.append("text").attr("fill","currentColor").attr(u,c*g).attr("dy",t===Ar?"0em":t===Nr?"0.71em":"0.32em")),d!==S&&(T=T.transition(d),M=M.transition(d),P=P.transition(d),L=L.transition(d),C=C.transition(d).attr("opacity",Oo).attr("transform",function(H){return isFinite(H=b(H))?h(H+a):this.getAttribute("transform")}),x.attr("opacity",Oo).attr("transform",function(H){var D=this.parentNode.__axis;return h((D&&isFinite(D=D(H))?D:b(H))+a)})),C.remove(),T.attr("d",t===ni||t===Tr?o?"M"+c*o+","+k+"H"+a+"V"+E+"H"+c*o:"M"+a+","+k+"V"+E:o?"M"+k+","+c*o+"V"+a+"H"+E+"V"+c*o:"M"+k+","+a+"H"+E),M.attr("opacity",1).attr("transform",function(H){return h(b(H)+a)}),P.attr(u+"2",c*s),L.attr(u,c*g).text(p),S.filter(hh).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",t===Tr?"start":t===ni?"end":"middle"),S.each(function(){this.__axis=b})}return f.scale=function(d){return arguments.length?(e=d,f):e},f.ticks=function(){return n=Array.from(arguments),f},f.tickArguments=function(d){return arguments.length?(n=d==null?[]:Array.from(d),f):n.slice()},f.tickValues=function(d){return arguments.length?(i=d==null?null:Array.from(d),f):i&&i.slice()},f.tickFormat=function(d){return arguments.length?(r=d,f):r},f.tickSize=function(d){return arguments.length?(s=o=+d,f):s},f.tickSizeInner=function(d){return arguments.length?(s=+d,f):s},f.tickSizeOuter=function(d){return arguments.length?(o=+d,f):o},f.tickPadding=function(d){return arguments.length?(l=+d,f):l},f.offset=function(d){return arguments.length?(a=+d,f):a},f}function dh(t){return Po(Nr,t)}function mh(t){return Po(ni,t)}var ph={value:()=>{}};function ii(){for(var t=0,e=arguments.length,n={},i;t<e;++t){if(!(i=arguments[t]+"")||i in n||/[\s.]/.test(i))throw new Error("illegal type: "+i);n[i]=[]}return new $i(n)}function $i(t){this._=t}function gh(t,e){return t.trim().split(/^|\s+/).map(function(n){var i="",r=n.indexOf(".");if(r>=0&&(i=n.slice(r+1),n=n.slice(0,r)),n&&!e.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:i}})}$i.prototype=ii.prototype={constructor:$i,on:function(t,e){var n=this._,i=gh(t+"",n),r,s=-1,o=i.length;if(arguments.length<2){for(;++s<o;)if((r=(t=i[s]).type)&&(r=_h(n[r],t.name)))return r;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++s<o;)if(r=(t=i[s]).type)n[r]=Lo(n[r],t.name,e);else if(e==null)for(r in n)n[r]=Lo(n[r],t.name,null);return this},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new $i(t)},call:function(t,e){if((r=arguments.length-2)>0)for(var n=new Array(r),i=0,r,s;i<r;++i)n[i]=arguments[i+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(s=this._[t],i=0,r=s.length;i<r;++i)s[i].value.apply(e,n)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var i=this._[t],r=0,s=i.length;r<s;++r)i[r].value.apply(e,n)}};function _h(t,e){for(var n=0,i=t.length,r;n<i;++n)if((r=t[n]).name===e)return r.value}function Lo(t,e,n){for(var i=0,r=t.length;i<r;++i)if(t[i].name===e){t[i]=ph,t=t.slice(0,i).concat(t.slice(i+1));break}return n!=null&&t.push({name:e,value:n}),t}var Or="http://www.w3.org/1999/xhtml";const Ro={svg:"http://www.w3.org/2000/svg",xhtml:Or,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function zi(t){var e=t+="",n=e.indexOf(":");return n>=0&&(e=t.slice(0,n))!=="xmlns"&&(t=t.slice(n+1)),Ro.hasOwnProperty(e)?{space:Ro[e],local:t}:t}function vh(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===Or&&e.documentElement.namespaceURI===Or?e.createElement(t):e.createElementNS(n,t)}}function yh(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function Do(t){var e=zi(t);return(e.local?yh:vh)(e)}function bh(){}function Pr(t){return t==null?bh:function(){return this.querySelector(t)}}function wh(t){typeof t!="function"&&(t=Pr(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var s=e[r],o=s.length,l=i[r]=new Array(o),a,c,u=0;u<o;++u)(a=s[u])&&(c=t.call(a,a.__data__,u,s))&&("__data__"in a&&(c.__data__=a.__data__),l[u]=c);return new At(i,this._parents)}function Sh(t){return t==null?[]:Array.isArray(t)?t:Array.from(t)}function kh(){return[]}function $o(t){return t==null?kh:function(){return this.querySelectorAll(t)}}function Eh(t){return function(){return Sh(t.apply(this,arguments))}}function Ch(t){typeof t=="function"?t=Eh(t):t=$o(t);for(var e=this._groups,n=e.length,i=[],r=[],s=0;s<n;++s)for(var o=e[s],l=o.length,a,c=0;c<l;++c)(a=o[c])&&(i.push(t.call(a,a.__data__,c,o)),r.push(a));return new At(i,r)}function zo(t){return function(){return this.matches(t)}}function jo(t){return function(e){return e.matches(t)}}var Ih=Array.prototype.find;function Mh(t){return function(){return Ih.call(this.children,t)}}function xh(){return this.firstElementChild}function Ah(t){return this.select(t==null?xh:Mh(typeof t=="function"?t:jo(t)))}var Th=Array.prototype.filter;function Nh(){return Array.from(this.children)}function Oh(t){return function(){return Th.call(this.children,t)}}function Ph(t){return this.selectAll(t==null?Nh:Oh(typeof t=="function"?t:jo(t)))}function Lh(t){typeof t!="function"&&(t=zo(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var s=e[r],o=s.length,l=i[r]=[],a,c=0;c<o;++c)(a=s[c])&&t.call(a,a.__data__,c,s)&&l.push(a);return new At(i,this._parents)}function Fo(t){return new Array(t.length)}function Rh(){return new At(this._enter||this._groups.map(Fo),this._parents)}function ji(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}ji.prototype={constructor:ji,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function Dh(t){return function(){return t}}function $h(t,e,n,i,r,s){for(var o=0,l,a=e.length,c=s.length;o<c;++o)(l=e[o])?(l.__data__=s[o],i[o]=l):n[o]=new ji(t,s[o]);for(;o<a;++o)(l=e[o])&&(r[o]=l)}function zh(t,e,n,i,r,s,o){var l,a,c=new Map,u=e.length,h=s.length,f=new Array(u),d;for(l=0;l<u;++l)(a=e[l])&&(f[l]=d=o.call(a,a.__data__,l,e)+"",c.has(d)?r[l]=a:c.set(d,a));for(l=0;l<h;++l)d=o.call(t,s[l],l,s)+"",(a=c.get(d))?(i[l]=a,a.__data__=s[l],c.delete(d)):n[l]=new ji(t,s[l]);for(l=0;l<u;++l)(a=e[l])&&c.get(f[l])===a&&(r[l]=a)}function jh(t){return t.__data__}function Fh(t,e){if(!arguments.length)return Array.from(this,jh);var n=e?zh:$h,i=this._parents,r=this._groups;typeof t!="function"&&(t=Dh(t));for(var s=r.length,o=new Array(s),l=new Array(s),a=new Array(s),c=0;c<s;++c){var u=i[c],h=r[c],f=h.length,d=Vh(t.call(u,u&&u.__data__,c,i)),m=d.length,p=l[c]=new Array(m),g=o[c]=new Array(m),_=a[c]=new Array(f);n(u,h,p,g,_,d,e);for(var k=0,E=0,b,S;k<m;++k)if(b=p[k]){for(k>=E&&(E=k+1);!(S=g[E])&&++E<m;);b._next=S||null}}return o=new At(o,i),o._enter=l,o._exit=a,o}function Vh(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function Hh(){return new At(this._exit||this._groups.map(Fo),this._parents)}function Uh(t,e,n){var i=this.enter(),r=this,s=this.exit();return typeof t=="function"?(i=t(i),i&&(i=i.selection())):i=i.append(t+""),e!=null&&(r=e(r),r&&(r=r.selection())),n==null?s.remove():n(s),i&&r?i.merge(r).order():r}function Bh(t){for(var e=t.selection?t.selection():t,n=this._groups,i=e._groups,r=n.length,s=i.length,o=Math.min(r,s),l=new Array(r),a=0;a<o;++a)for(var c=n[a],u=i[a],h=c.length,f=l[a]=new Array(h),d,m=0;m<h;++m)(d=c[m]||u[m])&&(f[m]=d);for(;a<r;++a)l[a]=n[a];return new At(l,this._parents)}function qh(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var i=t[e],r=i.length-1,s=i[r],o;--r>=0;)(o=i[r])&&(s&&o.compareDocumentPosition(s)^4&&s.parentNode.insertBefore(o,s),s=o);return this}function Kh(t){t||(t=Wh);function e(h,f){return h&&f?t(h.__data__,f.__data__):!h-!f}for(var n=this._groups,i=n.length,r=new Array(i),s=0;s<i;++s){for(var o=n[s],l=o.length,a=r[s]=new Array(l),c,u=0;u<l;++u)(c=o[u])&&(a[u]=c);a.sort(e)}return new At(r,this._parents).order()}function Wh(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function Yh(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function Gh(){return Array.from(this)}function Xh(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var i=t[e],r=0,s=i.length;r<s;++r){var o=i[r];if(o)return o}return null}function Jh(){let t=0;for(const e of this)++t;return t}function Qh(){return!this.node()}function Zh(t){for(var e=this._groups,n=0,i=e.length;n<i;++n)for(var r=e[n],s=0,o=r.length,l;s<o;++s)(l=r[s])&&t.call(l,l.__data__,s,r);return this}function ed(t){return function(){this.removeAttribute(t)}}function td(t){return function(){this.removeAttributeNS(t.space,t.local)}}function nd(t,e){return function(){this.setAttribute(t,e)}}function id(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function rd(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttribute(t):this.setAttribute(t,n)}}function sd(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function od(t,e){var n=zi(t);if(arguments.length<2){var i=this.node();return n.local?i.getAttributeNS(n.space,n.local):i.getAttribute(n)}return this.each((e==null?n.local?td:ed:typeof e=="function"?n.local?sd:rd:n.local?id:nd)(n,e))}function Vo(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function ld(t){return function(){this.style.removeProperty(t)}}function ad(t,e,n){return function(){this.style.setProperty(t,e,n)}}function cd(t,e,n){return function(){var i=e.apply(this,arguments);i==null?this.style.removeProperty(t):this.style.setProperty(t,i,n)}}function ud(t,e,n){return arguments.length>1?this.each((e==null?ld:typeof e=="function"?cd:ad)(t,e,n??"")):Fn(this.node(),t)}function Fn(t,e){return t.style.getPropertyValue(e)||Vo(t).getComputedStyle(t,null).getPropertyValue(e)}function fd(t){return function(){delete this[t]}}function hd(t,e){return function(){this[t]=e}}function dd(t,e){return function(){var n=e.apply(this,arguments);n==null?delete this[t]:this[t]=n}}function md(t,e){return arguments.length>1?this.each((e==null?fd:typeof e=="function"?dd:hd)(t,e)):this.node()[t]}function Ho(t){return t.trim().split(/^|\s+/)}function Lr(t){return t.classList||new Uo(t)}function Uo(t){this._node=t,this._names=Ho(t.getAttribute("class")||"")}Uo.prototype={add:function(t){var e=this._names.indexOf(t);e<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function Bo(t,e){for(var n=Lr(t),i=-1,r=e.length;++i<r;)n.add(e[i])}function qo(t,e){for(var n=Lr(t),i=-1,r=e.length;++i<r;)n.remove(e[i])}function pd(t){return function(){Bo(this,t)}}function gd(t){return function(){qo(this,t)}}function _d(t,e){return function(){(e.apply(this,arguments)?Bo:qo)(this,t)}}function vd(t,e){var n=Ho(t+"");if(arguments.length<2){for(var i=Lr(this.node()),r=-1,s=n.length;++r<s;)if(!i.contains(n[r]))return!1;return!0}return this.each((typeof e=="function"?_d:e?pd:gd)(n,e))}function yd(){this.textContent=""}function bd(t){return function(){this.textContent=t}}function wd(t){return function(){var e=t.apply(this,arguments);this.textContent=e??""}}function Sd(t){return arguments.length?this.each(t==null?yd:(typeof t=="function"?wd:bd)(t)):this.node().textContent}function kd(){this.innerHTML=""}function Ed(t){return function(){this.innerHTML=t}}function Cd(t){return function(){var e=t.apply(this,arguments);this.innerHTML=e??""}}function Id(t){return arguments.length?this.each(t==null?kd:(typeof t=="function"?Cd:Ed)(t)):this.node().innerHTML}function Md(){this.nextSibling&&this.parentNode.appendChild(this)}function xd(){return this.each(Md)}function Ad(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Td(){return this.each(Ad)}function Nd(t){var e=typeof t=="function"?t:Do(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function Od(){return null}function Pd(t,e){var n=typeof t=="function"?t:Do(t),i=e==null?Od:typeof e=="function"?e:Pr(e);return this.select(function(){return this.insertBefore(n.apply(this,arguments),i.apply(this,arguments)||null)})}function Ld(){var t=this.parentNode;t&&t.removeChild(this)}function Rd(){return this.each(Ld)}function Dd(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function $d(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function zd(t){return this.select(t?$d:Dd)}function jd(t){return arguments.length?this.property("__data__",t):this.node().__data__}function Fd(t){return function(e){t.call(this,e,this.__data__)}}function Vd(t){return t.trim().split(/^|\s+/).map(function(e){var n="",i=e.indexOf(".");return i>=0&&(n=e.slice(i+1),e=e.slice(0,i)),{type:e,name:n}})}function Hd(t){return function(){var e=this.__on;if(e){for(var n=0,i=-1,r=e.length,s;n<r;++n)s=e[n],(!t.type||s.type===t.type)&&s.name===t.name?this.removeEventListener(s.type,s.listener,s.options):e[++i]=s;++i?e.length=i:delete this.__on}}}function Ud(t,e,n){return function(){var i=this.__on,r,s=Fd(e);if(i){for(var o=0,l=i.length;o<l;++o)if((r=i[o]).type===t.type&&r.name===t.name){this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=s,r.options=n),r.value=e;return}}this.addEventListener(t.type,s,n),r={type:t.type,name:t.name,value:e,listener:s,options:n},i?i.push(r):this.__on=[r]}}function Bd(t,e,n){var i=Vd(t+""),r,s=i.length,o;if(arguments.length<2){var l=this.node().__on;if(l){for(var a=0,c=l.length,u;a<c;++a)for(r=0,u=l[a];r<s;++r)if((o=i[r]).type===u.type&&o.name===u.name)return u.value}return}for(l=e?Ud:Hd,r=0;r<s;++r)this.each(l(i[r],e,n));return this}function Ko(t,e,n){var i=Vo(t),r=i.CustomEvent;typeof r=="function"?r=new r(e,n):(r=i.document.createEvent("Event"),n?(r.initEvent(e,n.bubbles,n.cancelable),r.detail=n.detail):r.initEvent(e,!1,!1)),t.dispatchEvent(r)}function qd(t,e){return function(){return Ko(this,t,e)}}function Kd(t,e){return function(){return Ko(this,t,e.apply(this,arguments))}}function Wd(t,e){return this.each((typeof e=="function"?Kd:qd)(t,e))}function*Yd(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var i=t[e],r=0,s=i.length,o;r<s;++r)(o=i[r])&&(yield o)}var Wo=[null];function At(t,e){this._groups=t,this._parents=e}function ri(){return new At([[document.documentElement]],Wo)}function Gd(){return this}At.prototype=ri.prototype={constructor:At,select:wh,selectAll:Ch,selectChild:Ah,selectChildren:Ph,filter:Lh,data:Fh,enter:Rh,exit:Hh,join:Uh,merge:Bh,selection:Gd,order:qh,sort:Kh,call:Yh,nodes:Gh,node:Xh,size:Jh,empty:Qh,each:Zh,attr:od,style:ud,property:md,classed:vd,text:Sd,html:Id,raise:xd,lower:Td,append:Nd,insert:Pd,remove:Rd,clone:zd,datum:jd,on:Bd,dispatch:Wd,[Symbol.iterator]:Yd};function Ye(t){return typeof t=="string"?new At([[document.querySelector(t)]],[document.documentElement]):new At([[t]],Wo)}function Xd(t){let e;for(;e=t.sourceEvent;)t=e;return t}function pt(t,e){if(t=Xd(t),e===void 0&&(e=t.currentTarget),e){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var i=n.createSVGPoint();return i.x=t.clientX,i.y=t.clientY,i=i.matrixTransform(e.getScreenCTM().inverse()),[i.x,i.y]}if(e.getBoundingClientRect){var r=e.getBoundingClientRect();return[t.clientX-r.left-e.clientLeft,t.clientY-r.top-e.clientTop]}}return[t.pageX,t.pageY]}const Jd={passive:!1},si={capture:!0,passive:!1};function Rr(t){t.stopImmediatePropagation()}function Vn(t){t.preventDefault(),t.stopImmediatePropagation()}function Yo(t){var e=t.document.documentElement,n=Ye(t).on("dragstart.drag",Vn,si);"onselectstart"in e?n.on("selectstart.drag",Vn,si):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function Go(t,e){var n=t.document.documentElement,i=Ye(t).on("dragstart.drag",null);e&&(i.on("click.drag",Vn,si),setTimeout(function(){i.on("click.drag",null)},0)),"onselectstart"in n?i.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}const Fi=t=>()=>t;function Dr(t,{sourceEvent:e,subject:n,target:i,identifier:r,active:s,x:o,y:l,dx:a,dy:c,dispatch:u}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},subject:{value:n,enumerable:!0,configurable:!0},target:{value:i,enumerable:!0,configurable:!0},identifier:{value:r,enumerable:!0,configurable:!0},active:{value:s,enumerable:!0,configurable:!0},x:{value:o,enumerable:!0,configurable:!0},y:{value:l,enumerable:!0,configurable:!0},dx:{value:a,enumerable:!0,configurable:!0},dy:{value:c,enumerable:!0,configurable:!0},_:{value:u}})}Dr.prototype.on=function(){var t=this._.on.apply(this._,arguments);return t===this._?this:t};function Qd(t){return!t.ctrlKey&&!t.button}function Zd(){return this.parentNode}function em(t,e){return e??{x:t.x,y:t.y}}function tm(){return navigator.maxTouchPoints||"ontouchstart"in this}function nm(){var t=Qd,e=Zd,n=em,i=tm,r={},s=ii("start","drag","end"),o=0,l,a,c,u,h=0;function f(b){b.on("mousedown.drag",d).filter(i).on("touchstart.drag",g).on("touchmove.drag",_,Jd).on("touchend.drag touchcancel.drag",k).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function d(b,S){if(!(u||!t.call(this,b,S))){var T=E(this,e.call(this,b,S),b,S,"mouse");T&&(Ye(b.view).on("mousemove.drag",m,si).on("mouseup.drag",p,si),Yo(b.view),Rr(b),c=!1,l=b.clientX,a=b.clientY,T("start",b))}}function m(b){if(Vn(b),!c){var S=b.clientX-l,T=b.clientY-a;c=S*S+T*T>h}r.mouse("drag",b)}function p(b){Ye(b.view).on("mousemove.drag mouseup.drag",null),Go(b.view,c),Vn(b),r.mouse("end",b)}function g(b,S){if(t.call(this,b,S)){var T=b.changedTouches,M=e.call(this,b,S),C=T.length,x,P;for(x=0;x<C;++x)(P=E(this,M,b,S,T[x].identifier,T[x]))&&(Rr(b),P("start",b,T[x]))}}function _(b){var S=b.changedTouches,T=S.length,M,C;for(M=0;M<T;++M)(C=r[S[M].identifier])&&(Vn(b),C("drag",b,S[M]))}function k(b){var S=b.changedTouches,T=S.length,M,C;for(u&&clearTimeout(u),u=setTimeout(function(){u=null},500),M=0;M<T;++M)(C=r[S[M].identifier])&&(Rr(b),C("end",b,S[M]))}function E(b,S,T,M,C,x){var P=s.copy(),L=pt(x||T,S),H,D,I;if((I=n.call(b,new Dr("beforestart",{sourceEvent:T,target:f,identifier:C,active:o,x:L[0],y:L[1],dx:0,dy:0,dispatch:P}),M))!=null)return H=I.x-L[0]||0,D=I.y-L[1]||0,function R(N,V,q){var B=L,X;switch(N){case"start":r[C]=R,X=o++;break;case"end":delete r[C],--o;case"drag":L=pt(q||V,S),X=o;break}P.call(N,b,new Dr(N,{sourceEvent:V,subject:I,target:f,identifier:C,active:X,x:L[0]+H,y:L[1]+D,dx:L[0]-B[0],dy:L[1]-B[1],dispatch:P}),M)}}return f.filter=function(b){return arguments.length?(t=typeof b=="function"?b:Fi(!!b),f):t},f.container=function(b){return arguments.length?(e=typeof b=="function"?b:Fi(b),f):e},f.subject=function(b){return arguments.length?(n=typeof b=="function"?b:Fi(b),f):n},f.touchable=function(b){return arguments.length?(i=typeof b=="function"?b:Fi(!!b),f):i},f.on=function(){var b=s.on.apply(s,arguments);return b===s?f:b},f.clickDistance=function(b){return arguments.length?(h=(b=+b)*b,f):Math.sqrt(h)},f}function $r(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function Xo(t,e){var n=Object.create(t.prototype);for(var i in e)n[i]=e[i];return n}function oi(){}var li=.7,Vi=1/li,Hn="\\s*([+-]?\\d+)\\s*",ai="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",qt="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",im=/^#([0-9a-f]{3,8})$/,rm=new RegExp(`^rgb\\(${Hn},${Hn},${Hn}\\)$`),sm=new RegExp(`^rgb\\(${qt},${qt},${qt}\\)$`),om=new RegExp(`^rgba\\(${Hn},${Hn},${Hn},${ai}\\)$`),lm=new RegExp(`^rgba\\(${qt},${qt},${qt},${ai}\\)$`),am=new RegExp(`^hsl\\(${ai},${qt},${qt}\\)$`),cm=new RegExp(`^hsla\\(${ai},${qt},${qt},${ai}\\)$`),Jo={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};$r(oi,vn,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:Qo,formatHex:Qo,formatHex8:um,formatHsl:fm,formatRgb:Zo,toString:Zo});function Qo(){return this.rgb().formatHex()}function um(){return this.rgb().formatHex8()}function fm(){return rl(this).formatHsl()}function Zo(){return this.rgb().formatRgb()}function vn(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=im.exec(t))?(n=e[1].length,e=parseInt(e[1],16),n===6?el(e):n===3?new St(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):n===8?Hi(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):n===4?Hi(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=rm.exec(t))?new St(e[1],e[2],e[3],1):(e=sm.exec(t))?new St(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=om.exec(t))?Hi(e[1],e[2],e[3],e[4]):(e=lm.exec(t))?Hi(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=am.exec(t))?il(e[1],e[2]/100,e[3]/100,1):(e=cm.exec(t))?il(e[1],e[2]/100,e[3]/100,e[4]):Jo.hasOwnProperty(t)?el(Jo[t]):t==="transparent"?new St(NaN,NaN,NaN,0):null}function el(t){return new St(t>>16&255,t>>8&255,t&255,1)}function Hi(t,e,n,i){return i<=0&&(t=e=n=NaN),new St(t,e,n,i)}function hm(t){return t instanceof oi||(t=vn(t)),t?(t=t.rgb(),new St(t.r,t.g,t.b,t.opacity)):new St}function zr(t,e,n,i){return arguments.length===1?hm(t):new St(t,e,n,i??1)}function St(t,e,n,i){this.r=+t,this.g=+e,this.b=+n,this.opacity=+i}$r(St,zr,Xo(oi,{brighter(t){return t=t==null?Vi:Math.pow(Vi,t),new St(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?li:Math.pow(li,t),new St(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new St(yn(this.r),yn(this.g),yn(this.b),Ui(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:tl,formatHex:tl,formatHex8:dm,formatRgb:nl,toString:nl}));function tl(){return`#${bn(this.r)}${bn(this.g)}${bn(this.b)}`}function dm(){return`#${bn(this.r)}${bn(this.g)}${bn(this.b)}${bn((isNaN(this.opacity)?1:this.opacity)*255)}`}function nl(){const t=Ui(this.opacity);return`${t===1?"rgb(":"rgba("}${yn(this.r)}, ${yn(this.g)}, ${yn(this.b)}${t===1?")":`, ${t})`}`}function Ui(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function yn(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function bn(t){return t=yn(t),(t<16?"0":"")+t.toString(16)}function il(t,e,n,i){return i<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new jt(t,e,n,i)}function rl(t){if(t instanceof jt)return new jt(t.h,t.s,t.l,t.opacity);if(t instanceof oi||(t=vn(t)),!t)return new jt;if(t instanceof jt)return t;t=t.rgb();var e=t.r/255,n=t.g/255,i=t.b/255,r=Math.min(e,n,i),s=Math.max(e,n,i),o=NaN,l=s-r,a=(s+r)/2;return l?(e===s?o=(n-i)/l+(n<i)*6:n===s?o=(i-e)/l+2:o=(e-n)/l+4,l/=a<.5?s+r:2-s-r,o*=60):l=a>0&&a<1?0:o,new jt(o,l,a,t.opacity)}function jr(t,e,n,i){return arguments.length===1?rl(t):new jt(t,e,n,i??1)}function jt(t,e,n,i){this.h=+t,this.s=+e,this.l=+n,this.opacity=+i}$r(jt,jr,Xo(oi,{brighter(t){return t=t==null?Vi:Math.pow(Vi,t),new jt(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?li:Math.pow(li,t),new jt(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,i=n+(n<.5?n:1-n)*e,r=2*n-i;return new St(Fr(t>=240?t-240:t+120,r,i),Fr(t,r,i),Fr(t<120?t+240:t-120,r,i),this.opacity)},clamp(){return new jt(sl(this.h),Bi(this.s),Bi(this.l),Ui(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=Ui(this.opacity);return`${t===1?"hsl(":"hsla("}${sl(this.h)}, ${Bi(this.s)*100}%, ${Bi(this.l)*100}%${t===1?")":`, ${t})`}`}}));function sl(t){return t=(t||0)%360,t<0?t+360:t}function Bi(t){return Math.max(0,Math.min(1,t||0))}function Fr(t,e,n){return(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)*255}const Vr=t=>()=>t;function mm(t,e){return function(n){return t+n*e}}function pm(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(i){return Math.pow(t+i*e,n)}}function gm(t){return(t=+t)==1?ol:function(e,n){return n-e?pm(e,n,t):Vr(isNaN(e)?n:e)}}function ol(t,e){var n=e-t;return n?mm(t,n):Vr(isNaN(t)?e:t)}const qi=function t(e){var n=gm(e);function i(r,s){var o=n((r=zr(r)).r,(s=zr(s)).r),l=n(r.g,s.g),a=n(r.b,s.b),c=ol(r.opacity,s.opacity);return function(u){return r.r=o(u),r.g=l(u),r.b=a(u),r.opacity=c(u),r+""}}return i.gamma=t,i}(1);function _m(t,e){e||(e=[]);var n=t?Math.min(e.length,t.length):0,i=e.slice(),r;return function(s){for(r=0;r<n;++r)i[r]=t[r]*(1-s)+e[r]*s;return i}}function vm(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function ym(t,e){var n=e?e.length:0,i=t?Math.min(n,t.length):0,r=new Array(i),s=new Array(n),o;for(o=0;o<i;++o)r[o]=Br(t[o],e[o]);for(;o<n;++o)s[o]=e[o];return function(l){for(o=0;o<i;++o)s[o]=r[o](l);return s}}function bm(t,e){var n=new Date;return t=+t,e=+e,function(i){return n.setTime(t*(1-i)+e*i),n}}function Ft(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}function wm(t,e){var n={},i={},r;(t===null||typeof t!="object")&&(t={}),(e===null||typeof e!="object")&&(e={});for(r in e)r in t?n[r]=Br(t[r],e[r]):i[r]=e[r];return function(s){for(r in n)i[r]=n[r](s);return i}}var Hr=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Ur=new RegExp(Hr.source,"g");function Sm(t){return function(){return t}}function km(t){return function(e){return t(e)+""}}function ll(t,e){var n=Hr.lastIndex=Ur.lastIndex=0,i,r,s,o=-1,l=[],a=[];for(t=t+"",e=e+"";(i=Hr.exec(t))&&(r=Ur.exec(e));)(s=r.index)>n&&(s=e.slice(n,s),l[o]?l[o]+=s:l[++o]=s),(i=i[0])===(r=r[0])?l[o]?l[o]+=r:l[++o]=r:(l[++o]=null,a.push({i:o,x:Ft(i,r)})),n=Ur.lastIndex;return n<e.length&&(s=e.slice(n),l[o]?l[o]+=s:l[++o]=s),l.length<2?a[0]?km(a[0].x):Sm(e):(e=a.length,function(c){for(var u=0,h;u<e;++u)l[(h=a[u]).i]=h.x(c);return l.join("")})}function Br(t,e){var n=typeof e,i;return e==null||n==="boolean"?Vr(e):(n==="number"?Ft:n==="string"?(i=vn(e))?(e=i,qi):ll:e instanceof vn?qi:e instanceof Date?bm:vm(e)?_m:Array.isArray(e)?ym:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?wm:Ft)(t,e)}function Em(t,e){return t=+t,e=+e,function(n){return Math.round(t*(1-n)+e*n)}}var al=180/Math.PI,qr={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function cl(t,e,n,i,r,s){var o,l,a;return(o=Math.sqrt(t*t+e*e))&&(t/=o,e/=o),(a=t*n+e*i)&&(n-=t*a,i-=e*a),(l=Math.sqrt(n*n+i*i))&&(n/=l,i/=l,a/=l),t*i<e*n&&(t=-t,e=-e,a=-a,o=-o),{translateX:r,translateY:s,rotate:Math.atan2(e,t)*al,skewX:Math.atan(a)*al,scaleX:o,scaleY:l}}var Ki;function Cm(t){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?qr:cl(e.a,e.b,e.c,e.d,e.e,e.f)}function Im(t){return t==null||(Ki||(Ki=document.createElementNS("http://www.w3.org/2000/svg","g")),Ki.setAttribute("transform",t),!(t=Ki.transform.baseVal.consolidate()))?qr:(t=t.matrix,cl(t.a,t.b,t.c,t.d,t.e,t.f))}function ul(t,e,n,i){function r(c){return c.length?c.pop()+" ":""}function s(c,u,h,f,d,m){if(c!==h||u!==f){var p=d.push("translate(",null,e,null,n);m.push({i:p-4,x:Ft(c,h)},{i:p-2,x:Ft(u,f)})}else(h||f)&&d.push("translate("+h+e+f+n)}function o(c,u,h,f){c!==u?(c-u>180?u+=360:u-c>180&&(c+=360),f.push({i:h.push(r(h)+"rotate(",null,i)-2,x:Ft(c,u)})):u&&h.push(r(h)+"rotate("+u+i)}function l(c,u,h,f){c!==u?f.push({i:h.push(r(h)+"skewX(",null,i)-2,x:Ft(c,u)}):u&&h.push(r(h)+"skewX("+u+i)}function a(c,u,h,f,d,m){if(c!==h||u!==f){var p=d.push(r(d)+"scale(",null,",",null,")");m.push({i:p-4,x:Ft(c,h)},{i:p-2,x:Ft(u,f)})}else(h!==1||f!==1)&&d.push(r(d)+"scale("+h+","+f+")")}return function(c,u){var h=[],f=[];return c=t(c),u=t(u),s(c.translateX,c.translateY,u.translateX,u.translateY,h,f),o(c.rotate,u.rotate,h,f),l(c.skewX,u.skewX,h,f),a(c.scaleX,c.scaleY,u.scaleX,u.scaleY,h,f),c=u=null,function(d){for(var m=-1,p=f.length,g;++m<p;)h[(g=f[m]).i]=g.x(d);return h.join("")}}}var Mm=ul(Cm,"px, ","px)","deg)"),xm=ul(Im,", ",")",")"),Am=1e-12;function fl(t){return((t=Math.exp(t))+1/t)/2}function Tm(t){return((t=Math.exp(t))-1/t)/2}function Nm(t){return((t=Math.exp(2*t))-1)/(t+1)}const Om=function t(e,n,i){function r(s,o){var l=s[0],a=s[1],c=s[2],u=o[0],h=o[1],f=o[2],d=u-l,m=h-a,p=d*d+m*m,g,_;if(p<Am)_=Math.log(f/c)/e,g=function(M){return[l+M*d,a+M*m,c*Math.exp(e*M*_)]};else{var k=Math.sqrt(p),E=(f*f-c*c+i*p)/(2*c*n*k),b=(f*f-c*c-i*p)/(2*f*n*k),S=Math.log(Math.sqrt(E*E+1)-E),T=Math.log(Math.sqrt(b*b+1)-b);_=(T-S)/e,g=function(M){var C=M*_,x=fl(S),P=c/(n*k)*(x*Nm(e*C+S)-Tm(S));return[l+P*d,a+P*m,c*x/fl(e*C+S)]}}return g.duration=_*1e3*e/Math.SQRT2,g}return r.rho=function(s){var o=Math.max(.001,+s),l=o*o,a=l*l;return t(o,l,a)},r}(Math.SQRT2,2,4);var Un=0,ci=0,ui=0,hl=1e3,Wi,fi,Yi=0,wn=0,Gi=0,hi=typeof performance=="object"&&performance.now?performance:Date,dl=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function Kr(){return wn||(dl(Pm),wn=hi.now()+Gi)}function Pm(){wn=0}function Xi(){this._call=this._time=this._next=null}Xi.prototype=Wr.prototype={constructor:Xi,restart:function(t,e,n){if(typeof t!="function")throw new TypeError("callback is not a function");n=(n==null?Kr():+n)+(e==null?0:+e),!this._next&&fi!==this&&(fi?fi._next=this:Wi=this,fi=this),this._call=t,this._time=n,Yr()},stop:function(){this._call&&(this._call=null,this._time=1/0,Yr())}};function Wr(t,e,n){var i=new Xi;return i.restart(t,e,n),i}function Lm(){Kr(),++Un;for(var t=Wi,e;t;)(e=wn-t._time)>=0&&t._call.call(void 0,e),t=t._next;--Un}function ml(){wn=(Yi=hi.now())+Gi,Un=ci=0;try{Lm()}finally{Un=0,Dm(),wn=0}}function Rm(){var t=hi.now(),e=t-Yi;e>hl&&(Gi-=e,Yi=t)}function Dm(){for(var t,e=Wi,n,i=1/0;e;)e._call?(i>e._time&&(i=e._time),t=e,e=e._next):(n=e._next,e._next=null,e=t?t._next=n:Wi=n);fi=t,Yr(i)}function Yr(t){if(!Un){ci&&(ci=clearTimeout(ci));var e=t-wn;e>24?(t<1/0&&(ci=setTimeout(ml,t-hi.now()-Gi)),ui&&(ui=clearInterval(ui))):(ui||(Yi=hi.now(),ui=setInterval(Rm,hl)),Un=1,dl(ml))}}function pl(t,e,n){var i=new Xi;return e=e==null?0:+e,i.restart(r=>{i.stop(),t(r+e)},e,n),i}var $m=ii("start","end","cancel","interrupt"),zm=[],gl=0,_l=1,Gr=2,Ji=3,vl=4,Xr=5,Qi=6;function Zi(t,e,n,i,r,s){var o=t.__transition;if(!o)t.__transition={};else if(n in o)return;jm(t,n,{name:e,index:i,group:r,on:$m,tween:zm,time:s.time,delay:s.delay,duration:s.duration,ease:s.ease,timer:null,state:gl})}function Jr(t,e){var n=Vt(t,e);if(n.state>gl)throw new Error("too late; already scheduled");return n}function Kt(t,e){var n=Vt(t,e);if(n.state>Ji)throw new Error("too late; already running");return n}function Vt(t,e){var n=t.__transition;if(!n||!(n=n[e]))throw new Error("transition not found");return n}function jm(t,e,n){var i=t.__transition,r;i[e]=n,n.timer=Wr(s,0,n.time);function s(c){n.state=_l,n.timer.restart(o,n.delay,n.time),n.delay<=c&&o(c-n.delay)}function o(c){var u,h,f,d;if(n.state!==_l)return a();for(u in i)if(d=i[u],d.name===n.name){if(d.state===Ji)return pl(o);d.state===vl?(d.state=Qi,d.timer.stop(),d.on.call("interrupt",t,t.__data__,d.index,d.group),delete i[u]):+u<e&&(d.state=Qi,d.timer.stop(),d.on.call("cancel",t,t.__data__,d.index,d.group),delete i[u])}if(pl(function(){n.state===Ji&&(n.state=vl,n.timer.restart(l,n.delay,n.time),l(c))}),n.state=Gr,n.on.call("start",t,t.__data__,n.index,n.group),n.state===Gr){for(n.state=Ji,r=new Array(f=n.tween.length),u=0,h=-1;u<f;++u)(d=n.tween[u].value.call(t,t.__data__,n.index,n.group))&&(r[++h]=d);r.length=h+1}}function l(c){for(var u=c<n.duration?n.ease.call(null,c/n.duration):(n.timer.restart(a),n.state=Xr,1),h=-1,f=r.length;++h<f;)r[h].call(t,u);n.state===Xr&&(n.on.call("end",t,t.__data__,n.index,n.group),a())}function a(){n.state=Qi,n.timer.stop(),delete i[e];for(var c in i)return;delete t.__transition}}function er(t,e){var n=t.__transition,i,r,s=!0,o;if(n){e=e==null?null:e+"";for(o in n){if((i=n[o]).name!==e){s=!1;continue}r=i.state>Gr&&i.state<Xr,i.state=Qi,i.timer.stop(),i.on.call(r?"interrupt":"cancel",t,t.__data__,i.index,i.group),delete n[o]}s&&delete t.__transition}}function Fm(t){return this.each(function(){er(this,t)})}function Vm(t,e){var n,i;return function(){var r=Kt(this,t),s=r.tween;if(s!==n){i=n=s;for(var o=0,l=i.length;o<l;++o)if(i[o].name===e){i=i.slice(),i.splice(o,1);break}}r.tween=i}}function Hm(t,e,n){var i,r;if(typeof n!="function")throw new Error;return function(){var s=Kt(this,t),o=s.tween;if(o!==i){r=(i=o).slice();for(var l={name:e,value:n},a=0,c=r.length;a<c;++a)if(r[a].name===e){r[a]=l;break}a===c&&r.push(l)}s.tween=r}}function Um(t,e){var n=this._id;if(t+="",arguments.length<2){for(var i=Vt(this.node(),n).tween,r=0,s=i.length,o;r<s;++r)if((o=i[r]).name===t)return o.value;return null}return this.each((e==null?Vm:Hm)(n,t,e))}function Qr(t,e,n){var i=t._id;return t.each(function(){var r=Kt(this,i);(r.value||(r.value={}))[e]=n.apply(this,arguments)}),function(r){return Vt(r,i).value[e]}}function yl(t,e){var n;return(typeof e=="number"?Ft:e instanceof vn?qi:(n=vn(e))?(e=n,qi):ll)(t,e)}function Bm(t){return function(){this.removeAttribute(t)}}function qm(t){return function(){this.removeAttributeNS(t.space,t.local)}}function Km(t,e,n){var i,r=n+"",s;return function(){var o=this.getAttribute(t);return o===r?null:o===i?s:s=e(i=o,n)}}function Wm(t,e,n){var i,r=n+"",s;return function(){var o=this.getAttributeNS(t.space,t.local);return o===r?null:o===i?s:s=e(i=o,n)}}function Ym(t,e,n){var i,r,s;return function(){var o,l=n(this),a;return l==null?void this.removeAttribute(t):(o=this.getAttribute(t),a=l+"",o===a?null:o===i&&a===r?s:(r=a,s=e(i=o,l)))}}function Gm(t,e,n){var i,r,s;return function(){var o,l=n(this),a;return l==null?void this.removeAttributeNS(t.space,t.local):(o=this.getAttributeNS(t.space,t.local),a=l+"",o===a?null:o===i&&a===r?s:(r=a,s=e(i=o,l)))}}function Xm(t,e){var n=zi(t),i=n==="transform"?xm:yl;return this.attrTween(t,typeof e=="function"?(n.local?Gm:Ym)(n,i,Qr(this,"attr."+t,e)):e==null?(n.local?qm:Bm)(n):(n.local?Wm:Km)(n,i,e))}function Jm(t,e){return function(n){this.setAttribute(t,e.call(this,n))}}function Qm(t,e){return function(n){this.setAttributeNS(t.space,t.local,e.call(this,n))}}function Zm(t,e){var n,i;function r(){var s=e.apply(this,arguments);return s!==i&&(n=(i=s)&&Qm(t,s)),n}return r._value=e,r}function ep(t,e){var n,i;function r(){var s=e.apply(this,arguments);return s!==i&&(n=(i=s)&&Jm(t,s)),n}return r._value=e,r}function tp(t,e){var n="attr."+t;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(e==null)return this.tween(n,null);if(typeof e!="function")throw new Error;var i=zi(t);return this.tween(n,(i.local?Zm:ep)(i,e))}function np(t,e){return function(){Jr(this,t).delay=+e.apply(this,arguments)}}function ip(t,e){return e=+e,function(){Jr(this,t).delay=e}}function rp(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?np:ip)(e,t)):Vt(this.node(),e).delay}function sp(t,e){return function(){Kt(this,t).duration=+e.apply(this,arguments)}}function op(t,e){return e=+e,function(){Kt(this,t).duration=e}}function lp(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?sp:op)(e,t)):Vt(this.node(),e).duration}function ap(t,e){if(typeof e!="function")throw new Error;return function(){Kt(this,t).ease=e}}function cp(t){var e=this._id;return arguments.length?this.each(ap(e,t)):Vt(this.node(),e).ease}function up(t,e){return function(){var n=e.apply(this,arguments);if(typeof n!="function")throw new Error;Kt(this,t).ease=n}}function fp(t){if(typeof t!="function")throw new Error;return this.each(up(this._id,t))}function hp(t){typeof t!="function"&&(t=zo(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var s=e[r],o=s.length,l=i[r]=[],a,c=0;c<o;++c)(a=s[c])&&t.call(a,a.__data__,c,s)&&l.push(a);return new en(i,this._parents,this._name,this._id)}function dp(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,n=t._groups,i=e.length,r=n.length,s=Math.min(i,r),o=new Array(i),l=0;l<s;++l)for(var a=e[l],c=n[l],u=a.length,h=o[l]=new Array(u),f,d=0;d<u;++d)(f=a[d]||c[d])&&(h[d]=f);for(;l<i;++l)o[l]=e[l];return new en(o,this._parents,this._name,this._id)}function mp(t){return(t+"").trim().split(/^|\s+/).every(function(e){var n=e.indexOf(".");return n>=0&&(e=e.slice(0,n)),!e||e==="start"})}function pp(t,e,n){var i,r,s=mp(e)?Jr:Kt;return function(){var o=s(this,t),l=o.on;l!==i&&(r=(i=l).copy()).on(e,n),o.on=r}}function gp(t,e){var n=this._id;return arguments.length<2?Vt(this.node(),n).on.on(t):this.each(pp(n,t,e))}function _p(t){return function(){var e=this.parentNode;for(var n in this.__transition)if(+n!==t)return;e&&e.removeChild(this)}}function vp(){return this.on("end.remove",_p(this._id))}function yp(t){var e=this._name,n=this._id;typeof t!="function"&&(t=Pr(t));for(var i=this._groups,r=i.length,s=new Array(r),o=0;o<r;++o)for(var l=i[o],a=l.length,c=s[o]=new Array(a),u,h,f=0;f<a;++f)(u=l[f])&&(h=t.call(u,u.__data__,f,l))&&("__data__"in u&&(h.__data__=u.__data__),c[f]=h,Zi(c[f],e,n,f,c,Vt(u,n)));return new en(s,this._parents,e,n)}function bp(t){var e=this._name,n=this._id;typeof t!="function"&&(t=$o(t));for(var i=this._groups,r=i.length,s=[],o=[],l=0;l<r;++l)for(var a=i[l],c=a.length,u,h=0;h<c;++h)if(u=a[h]){for(var f=t.call(u,u.__data__,h,a),d,m=Vt(u,n),p=0,g=f.length;p<g;++p)(d=f[p])&&Zi(d,e,n,p,f,m);s.push(f),o.push(u)}return new en(s,o,e,n)}var wp=ri.prototype.constructor;function Sp(){return new wp(this._groups,this._parents)}function kp(t,e){var n,i,r;return function(){var s=Fn(this,t),o=(this.style.removeProperty(t),Fn(this,t));return s===o?null:s===n&&o===i?r:r=e(n=s,i=o)}}function bl(t){return function(){this.style.removeProperty(t)}}function Ep(t,e,n){var i,r=n+"",s;return function(){var o=Fn(this,t);return o===r?null:o===i?s:s=e(i=o,n)}}function Cp(t,e,n){var i,r,s;return function(){var o=Fn(this,t),l=n(this),a=l+"";return l==null&&(a=l=(this.style.removeProperty(t),Fn(this,t))),o===a?null:o===i&&a===r?s:(r=a,s=e(i=o,l))}}function Ip(t,e){var n,i,r,s="style."+e,o="end."+s,l;return function(){var a=Kt(this,t),c=a.on,u=a.value[s]==null?l||(l=bl(e)):void 0;(c!==n||r!==u)&&(i=(n=c).copy()).on(o,r=u),a.on=i}}function Mp(t,e,n){var i=(t+="")=="transform"?Mm:yl;return e==null?this.styleTween(t,kp(t,i)).on("end.style."+t,bl(t)):typeof e=="function"?this.styleTween(t,Cp(t,i,Qr(this,"style."+t,e))).each(Ip(this._id,t)):this.styleTween(t,Ep(t,i,e),n).on("end.style."+t,null)}function xp(t,e,n){return function(i){this.style.setProperty(t,e.call(this,i),n)}}function Ap(t,e,n){var i,r;function s(){var o=e.apply(this,arguments);return o!==r&&(i=(r=o)&&xp(t,o,n)),i}return s._value=e,s}function Tp(t,e,n){var i="style."+(t+="");if(arguments.length<2)return(i=this.tween(i))&&i._value;if(e==null)return this.tween(i,null);if(typeof e!="function")throw new Error;return this.tween(i,Ap(t,e,n??""))}function Np(t){return function(){this.textContent=t}}function Op(t){return function(){var e=t(this);this.textContent=e??""}}function Pp(t){return this.tween("text",typeof t=="function"?Op(Qr(this,"text",t)):Np(t==null?"":t+""))}function Lp(t){return function(e){this.textContent=t.call(this,e)}}function Rp(t){var e,n;function i(){var r=t.apply(this,arguments);return r!==n&&(e=(n=r)&&Lp(r)),e}return i._value=t,i}function Dp(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(t==null)return this.tween(e,null);if(typeof t!="function")throw new Error;return this.tween(e,Rp(t))}function $p(){for(var t=this._name,e=this._id,n=wl(),i=this._groups,r=i.length,s=0;s<r;++s)for(var o=i[s],l=o.length,a,c=0;c<l;++c)if(a=o[c]){var u=Vt(a,e);Zi(a,t,n,c,o,{time:u.time+u.delay+u.duration,delay:0,duration:u.duration,ease:u.ease})}return new en(i,this._parents,t,n)}function zp(){var t,e,n=this,i=n._id,r=n.size();return new Promise(function(s,o){var l={value:o},a={value:function(){--r===0&&s()}};n.each(function(){var c=Kt(this,i),u=c.on;u!==t&&(e=(t=u).copy(),e._.cancel.push(l),e._.interrupt.push(l),e._.end.push(a)),c.on=e}),r===0&&s()})}var jp=0;function en(t,e,n,i){this._groups=t,this._parents=e,this._name=n,this._id=i}function wl(){return++jp}var tn=ri.prototype;en.prototype={constructor:en,select:yp,selectAll:bp,selectChild:tn.selectChild,selectChildren:tn.selectChildren,filter:hp,merge:dp,selection:Sp,transition:$p,call:tn.call,nodes:tn.nodes,node:tn.node,size:tn.size,empty:tn.empty,each:tn.each,on:gp,attr:Xm,attrTween:tp,style:Mp,styleTween:Tp,text:Pp,textTween:Dp,remove:vp,tween:Um,delay:rp,duration:lp,ease:cp,easeVarying:fp,end:zp,[Symbol.iterator]:tn[Symbol.iterator]};function Fp(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}var Vp={time:null,delay:0,duration:250,ease:Fp};function Hp(t,e){for(var n;!(n=t.__transition)||!(n=n[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return n}function Up(t){var e,n;t instanceof en?(e=t._id,t=t._name):(e=wl(),(n=Vp).time=Kr(),t=t==null?null:t+"");for(var i=this._groups,r=i.length,s=0;s<r;++s)for(var o=i[s],l=o.length,a,c=0;c<l;++c)(a=o[c])&&Zi(a,t,e,c,o,n||Hp(a,e));return new en(i,this._parents,t,e)}ri.prototype.interrupt=Fm,ri.prototype.transition=Up;function Sl(t,e){var n,i=1;t==null&&(t=0),e==null&&(e=0);function r(){var s,o=n.length,l,a=0,c=0;for(s=0;s<o;++s)l=n[s],a+=l.x,c+=l.y;for(a=(a/o-t)*i,c=(c/o-e)*i,s=0;s<o;++s)l=n[s],l.x-=a,l.y-=c}return r.initialize=function(s){n=s},r.x=function(s){return arguments.length?(t=+s,r):t},r.y=function(s){return arguments.length?(e=+s,r):e},r.strength=function(s){return arguments.length?(i=+s,r):i},r}function Bp(t){const e=+this._x.call(null,t),n=+this._y.call(null,t);return kl(this.cover(e,n),e,n,t)}function kl(t,e,n,i){if(isNaN(e)||isNaN(n))return t;var r,s=t._root,o={data:i},l=t._x0,a=t._y0,c=t._x1,u=t._y1,h,f,d,m,p,g,_,k;if(!s)return t._root=o,t;for(;s.length;)if((p=e>=(h=(l+c)/2))?l=h:c=h,(g=n>=(f=(a+u)/2))?a=f:u=f,r=s,!(s=s[_=g<<1|p]))return r[_]=o,t;if(d=+t._x.call(null,s.data),m=+t._y.call(null,s.data),e===d&&n===m)return o.next=s,r?r[_]=o:t._root=o,t;do r=r?r[_]=new Array(4):t._root=new Array(4),(p=e>=(h=(l+c)/2))?l=h:c=h,(g=n>=(f=(a+u)/2))?a=f:u=f;while((_=g<<1|p)===(k=(m>=f)<<1|d>=h));return r[k]=s,r[_]=o,t}function qp(t){var e,n,i=t.length,r,s,o=new Array(i),l=new Array(i),a=1/0,c=1/0,u=-1/0,h=-1/0;for(n=0;n<i;++n)isNaN(r=+this._x.call(null,e=t[n]))||isNaN(s=+this._y.call(null,e))||(o[n]=r,l[n]=s,r<a&&(a=r),r>u&&(u=r),s<c&&(c=s),s>h&&(h=s));if(a>u||c>h)return this;for(this.cover(a,c).cover(u,h),n=0;n<i;++n)kl(this,o[n],l[n],t[n]);return this}function Kp(t,e){if(isNaN(t=+t)||isNaN(e=+e))return this;var n=this._x0,i=this._y0,r=this._x1,s=this._y1;if(isNaN(n))r=(n=Math.floor(t))+1,s=(i=Math.floor(e))+1;else{for(var o=r-n||1,l=this._root,a,c;n>t||t>=r||i>e||e>=s;)switch(c=(e<i)<<1|t<n,a=new Array(4),a[c]=l,l=a,o*=2,c){case 0:r=n+o,s=i+o;break;case 1:n=r-o,s=i+o;break;case 2:r=n+o,i=s-o;break;case 3:n=r-o,i=s-o;break}this._root&&this._root.length&&(this._root=l)}return this._x0=n,this._y0=i,this._x1=r,this._y1=s,this}function Wp(){var t=[];return this.visit(function(e){if(!e.length)do t.push(e.data);while(e=e.next)}),t}function Yp(t){return arguments.length?this.cover(+t[0][0],+t[0][1]).cover(+t[1][0],+t[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function gt(t,e,n,i,r){this.node=t,this.x0=e,this.y0=n,this.x1=i,this.y1=r}function Gp(t,e,n){var i,r=this._x0,s=this._y0,o,l,a,c,u=this._x1,h=this._y1,f=[],d=this._root,m,p;for(d&&f.push(new gt(d,r,s,u,h)),n==null?n=1/0:(r=t-n,s=e-n,u=t+n,h=e+n,n*=n);m=f.pop();)if(!(!(d=m.node)||(o=m.x0)>u||(l=m.y0)>h||(a=m.x1)<r||(c=m.y1)<s))if(d.length){var g=(o+a)/2,_=(l+c)/2;f.push(new gt(d[3],g,_,a,c),new gt(d[2],o,_,g,c),new gt(d[1],g,l,a,_),new gt(d[0],o,l,g,_)),(p=(e>=_)<<1|t>=g)&&(m=f[f.length-1],f[f.length-1]=f[f.length-1-p],f[f.length-1-p]=m)}else{var k=t-+this._x.call(null,d.data),E=e-+this._y.call(null,d.data),b=k*k+E*E;if(b<n){var S=Math.sqrt(n=b);r=t-S,s=e-S,u=t+S,h=e+S,i=d.data}}return i}function Xp(t){if(isNaN(u=+this._x.call(null,t))||isNaN(h=+this._y.call(null,t)))return this;var e,n=this._root,i,r,s,o=this._x0,l=this._y0,a=this._x1,c=this._y1,u,h,f,d,m,p,g,_;if(!n)return this;if(n.length)for(;;){if((m=u>=(f=(o+a)/2))?o=f:a=f,(p=h>=(d=(l+c)/2))?l=d:c=d,e=n,!(n=n[g=p<<1|m]))return this;if(!n.length)break;(e[g+1&3]||e[g+2&3]||e[g+3&3])&&(i=e,_=g)}for(;n.data!==t;)if(r=n,!(n=n.next))return this;return(s=n.next)&&delete n.next,r?(s?r.next=s:delete r.next,this):e?(s?e[g]=s:delete e[g],(n=e[0]||e[1]||e[2]||e[3])&&n===(e[3]||e[2]||e[1]||e[0])&&!n.length&&(i?i[_]=n:this._root=n),this):(this._root=s,this)}function Jp(t){for(var e=0,n=t.length;e<n;++e)this.remove(t[e]);return this}function Qp(){return this._root}function Zp(){var t=0;return this.visit(function(e){if(!e.length)do++t;while(e=e.next)}),t}function eg(t){var e=[],n,i=this._root,r,s,o,l,a;for(i&&e.push(new gt(i,this._x0,this._y0,this._x1,this._y1));n=e.pop();)if(!t(i=n.node,s=n.x0,o=n.y0,l=n.x1,a=n.y1)&&i.length){var c=(s+l)/2,u=(o+a)/2;(r=i[3])&&e.push(new gt(r,c,u,l,a)),(r=i[2])&&e.push(new gt(r,s,u,c,a)),(r=i[1])&&e.push(new gt(r,c,o,l,u)),(r=i[0])&&e.push(new gt(r,s,o,c,u))}return this}function tg(t){var e=[],n=[],i;for(this._root&&e.push(new gt(this._root,this._x0,this._y0,this._x1,this._y1));i=e.pop();){var r=i.node;if(r.length){var s,o=i.x0,l=i.y0,a=i.x1,c=i.y1,u=(o+a)/2,h=(l+c)/2;(s=r[0])&&e.push(new gt(s,o,l,u,h)),(s=r[1])&&e.push(new gt(s,u,l,a,h)),(s=r[2])&&e.push(new gt(s,o,h,u,c)),(s=r[3])&&e.push(new gt(s,u,h,a,c))}n.push(i)}for(;i=n.pop();)t(i.node,i.x0,i.y0,i.x1,i.y1);return this}function ng(t){return t[0]}function ig(t){return arguments.length?(this._x=t,this):this._x}function rg(t){return t[1]}function sg(t){return arguments.length?(this._y=t,this):this._y}function Zr(t,e,n){var i=new es(e??ng,n??rg,NaN,NaN,NaN,NaN);return t==null?i:i.addAll(t)}function es(t,e,n,i,r,s){this._x=t,this._y=e,this._x0=n,this._y0=i,this._x1=r,this._y1=s,this._root=void 0}function El(t){for(var e={data:t.data},n=e;t=t.next;)n=n.next={data:t.data};return e}var _t=Zr.prototype=es.prototype;_t.copy=function(){var t=new es(this._x,this._y,this._x0,this._y0,this._x1,this._y1),e=this._root,n,i;if(!e)return t;if(!e.length)return t._root=El(e),t;for(n=[{source:e,target:t._root=new Array(4)}];e=n.pop();)for(var r=0;r<4;++r)(i=e.source[r])&&(i.length?n.push({source:i,target:e.target[r]=new Array(4)}):e.target[r]=El(i));return t},_t.add=Bp,_t.addAll=qp,_t.cover=Kp,_t.data=Wp,_t.extent=Yp,_t.find=Gp,_t.remove=Xp,_t.removeAll=Jp,_t.root=Qp,_t.size=Zp,_t.visit=eg,_t.visitAfter=tg,_t.x=ig,_t.y=sg;function vt(t){return function(){return t}}function fn(t){return(t()-.5)*1e-6}function og(t){return t.x+t.vx}function lg(t){return t.y+t.vy}function Cl(t){var e,n,i,r=1,s=1;typeof t!="function"&&(t=vt(t==null?1:+t));function o(){for(var c,u=e.length,h,f,d,m,p,g,_=0;_<s;++_)for(h=Zr(e,og,lg).visitAfter(l),c=0;c<u;++c)f=e[c],p=n[f.index],g=p*p,d=f.x+f.vx,m=f.y+f.vy,h.visit(k);function k(E,b,S,T,M){var C=E.data,x=E.r,P=p+x;if(C){if(C.index>f.index){var L=d-C.x-C.vx,H=m-C.y-C.vy,D=L*L+H*H;D<P*P&&(L===0&&(L=fn(i),D+=L*L),H===0&&(H=fn(i),D+=H*H),D=(P-(D=Math.sqrt(D)))/D*r,f.vx+=(L*=D)*(P=(x*=x)/(g+x)),f.vy+=(H*=D)*P,C.vx-=L*(P=1-P),C.vy-=H*P)}return}return b>d+P||T<d-P||S>m+P||M<m-P}}function l(c){if(c.data)return c.r=n[c.data.index];for(var u=c.r=0;u<4;++u)c[u]&&c[u].r>c.r&&(c.r=c[u].r)}function a(){if(e){var c,u=e.length,h;for(n=new Array(u),c=0;c<u;++c)h=e[c],n[h.index]=+t(h,c,e)}}return o.initialize=function(c,u){e=c,i=u,a()},o.iterations=function(c){return arguments.length?(s=+c,o):s},o.strength=function(c){return arguments.length?(r=+c,o):r},o.radius=function(c){return arguments.length?(t=typeof c=="function"?c:vt(+c),a(),o):t},o}function ag(t){return t.index}function Il(t,e){var n=t.get(e);if(!n)throw new Error("node not found: "+e);return n}function Ml(t){var e=ag,n=h,i,r=vt(30),s,o,l,a,c,u=1;t==null&&(t=[]);function h(g){return 1/Math.min(l[g.source.index],l[g.target.index])}function f(g){for(var _=0,k=t.length;_<u;++_)for(var E=0,b,S,T,M,C,x,P;E<k;++E)b=t[E],S=b.source,T=b.target,M=T.x+T.vx-S.x-S.vx||fn(c),C=T.y+T.vy-S.y-S.vy||fn(c),x=Math.sqrt(M*M+C*C),x=(x-s[E])/x*g*i[E],M*=x,C*=x,T.vx-=M*(P=a[E]),T.vy-=C*P,S.vx+=M*(P=1-P),S.vy+=C*P}function d(){if(o){var g,_=o.length,k=t.length,E=new Map(o.map((S,T)=>[e(S,T,o),S])),b;for(g=0,l=new Array(_);g<k;++g)b=t[g],b.index=g,typeof b.source!="object"&&(b.source=Il(E,b.source)),typeof b.target!="object"&&(b.target=Il(E,b.target)),l[b.source.index]=(l[b.source.index]||0)+1,l[b.target.index]=(l[b.target.index]||0)+1;for(g=0,a=new Array(k);g<k;++g)b=t[g],a[g]=l[b.source.index]/(l[b.source.index]+l[b.target.index]);i=new Array(k),m(),s=new Array(k),p()}}function m(){if(o)for(var g=0,_=t.length;g<_;++g)i[g]=+n(t[g],g,t)}function p(){if(o)for(var g=0,_=t.length;g<_;++g)s[g]=+r(t[g],g,t)}return f.initialize=function(g,_){o=g,c=_,d()},f.links=function(g){return arguments.length?(t=g,d(),f):t},f.id=function(g){return arguments.length?(e=g,f):e},f.iterations=function(g){return arguments.length?(u=+g,f):u},f.strength=function(g){return arguments.length?(n=typeof g=="function"?g:vt(+g),m(),f):n},f.distance=function(g){return arguments.length?(r=typeof g=="function"?g:vt(+g),p(),f):r},f}const cg=1664525,ug=1013904223,xl=4294967296;function fg(){let t=1;return()=>(t=(cg*t+ug)%xl)/xl}function hg(t){return t.x}function dg(t){return t.y}var mg=10,pg=Math.PI*(3-Math.sqrt(5));function Al(t){var e,n=1,i=.001,r=1-Math.pow(i,1/300),s=0,o=.6,l=new Map,a=Wr(h),c=ii("tick","end"),u=fg();t==null&&(t=[]);function h(){f(),c.call("tick",e),n<i&&(a.stop(),c.call("end",e))}function f(p){var g,_=t.length,k;p===void 0&&(p=1);for(var E=0;E<p;++E)for(n+=(s-n)*r,l.forEach(function(b){b(n)}),g=0;g<_;++g)k=t[g],k.fx==null?k.x+=k.vx*=o:(k.x=k.fx,k.vx=0),k.fy==null?k.y+=k.vy*=o:(k.y=k.fy,k.vy=0);return e}function d(){for(var p=0,g=t.length,_;p<g;++p){if(_=t[p],_.index=p,_.fx!=null&&(_.x=_.fx),_.fy!=null&&(_.y=_.fy),isNaN(_.x)||isNaN(_.y)){var k=mg*Math.sqrt(.5+p),E=p*pg;_.x=k*Math.cos(E),_.y=k*Math.sin(E)}(isNaN(_.vx)||isNaN(_.vy))&&(_.vx=_.vy=0)}}function m(p){return p.initialize&&p.initialize(t,u),p}return d(),e={tick:f,restart:function(){return a.restart(h),e},stop:function(){return a.stop(),e},nodes:function(p){return arguments.length?(t=p,d(),l.forEach(m),e):t},alpha:function(p){return arguments.length?(n=+p,e):n},alphaMin:function(p){return arguments.length?(i=+p,e):i},alphaDecay:function(p){return arguments.length?(r=+p,e):+r},alphaTarget:function(p){return arguments.length?(s=+p,e):s},velocityDecay:function(p){return arguments.length?(o=1-p,e):1-o},randomSource:function(p){return arguments.length?(u=p,l.forEach(m),e):u},force:function(p,g){return arguments.length>1?(g==null?l.delete(p):l.set(p,m(g)),e):l.get(p)},find:function(p,g,_){var k=0,E=t.length,b,S,T,M,C;for(_==null?_=1/0:_*=_,k=0;k<E;++k)M=t[k],b=p-M.x,S=g-M.y,T=b*b+S*S,T<_&&(C=M,_=T);return C},on:function(p,g){return arguments.length>1?(c.on(p,g),e):c.on(p)}}}function Tl(){var t,e,n,i,r=vt(-30),s,o=1,l=1/0,a=.81;function c(d){var m,p=t.length,g=Zr(t,hg,dg).visitAfter(h);for(i=d,m=0;m<p;++m)e=t[m],g.visit(f)}function u(){if(t){var d,m=t.length,p;for(s=new Array(m),d=0;d<m;++d)p=t[d],s[p.index]=+r(p,d,t)}}function h(d){var m=0,p,g,_=0,k,E,b;if(d.length){for(k=E=b=0;b<4;++b)(p=d[b])&&(g=Math.abs(p.value))&&(m+=p.value,_+=g,k+=g*p.x,E+=g*p.y);d.x=k/_,d.y=E/_}else{p=d,p.x=p.data.x,p.y=p.data.y;do m+=s[p.data.index];while(p=p.next)}d.value=m}function f(d,m,p,g){if(!d.value)return!0;var _=d.x-e.x,k=d.y-e.y,E=g-m,b=_*_+k*k;if(E*E/a<b)return b<l&&(_===0&&(_=fn(n),b+=_*_),k===0&&(k=fn(n),b+=k*k),b<o&&(b=Math.sqrt(o*b)),e.vx+=_*d.value*i/b,e.vy+=k*d.value*i/b),!0;if(d.length||b>=l)return;(d.data!==e||d.next)&&(_===0&&(_=fn(n),b+=_*_),k===0&&(k=fn(n),b+=k*k),b<o&&(b=Math.sqrt(o*b)));do d.data!==e&&(E=s[d.data.index]*i/b,e.vx+=_*E,e.vy+=k*E);while(d=d.next)}return c.initialize=function(d,m){t=d,n=m,u()},c.strength=function(d){return arguments.length?(r=typeof d=="function"?d:vt(+d),u(),c):r},c.distanceMin=function(d){return arguments.length?(o=d*d,c):Math.sqrt(o)},c.distanceMax=function(d){return arguments.length?(l=d*d,c):Math.sqrt(l)},c.theta=function(d){return arguments.length?(a=d*d,c):Math.sqrt(a)},c}function Nl(t){var e=vt(.1),n,i,r;typeof t!="function"&&(t=vt(t==null?0:+t));function s(l){for(var a=0,c=n.length,u;a<c;++a)u=n[a],u.vx+=(r[a]-u.x)*i[a]*l}function o(){if(n){var l,a=n.length;for(i=new Array(a),r=new Array(a),l=0;l<a;++l)i[l]=isNaN(r[l]=+t(n[l],l,n))?0:+e(n[l],l,n)}}return s.initialize=function(l){n=l,o()},s.strength=function(l){return arguments.length?(e=typeof l=="function"?l:vt(+l),o(),s):e},s.x=function(l){return arguments.length?(t=typeof l=="function"?l:vt(+l),o(),s):t},s}function Ol(t){var e=vt(.1),n,i,r;typeof t!="function"&&(t=vt(t==null?0:+t));function s(l){for(var a=0,c=n.length,u;a<c;++a)u=n[a],u.vy+=(r[a]-u.y)*i[a]*l}function o(){if(n){var l,a=n.length;for(i=new Array(a),r=new Array(a),l=0;l<a;++l)i[l]=isNaN(r[l]=+t(n[l],l,n))?0:+e(n[l],l,n)}}return s.initialize=function(l){n=l,o()},s.strength=function(l){return arguments.length?(e=typeof l=="function"?l:vt(+l),o(),s):e},s.y=function(l){return arguments.length?(t=typeof l=="function"?l:vt(+l),o(),s):t},s}function gg(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)}function tr(t,e){if((n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var n,i=t.slice(0,n);return[i.length>1?i[0]+i.slice(2):i,+t.slice(n+1)]}function Bn(t){return t=tr(Math.abs(t)),t?t[1]:NaN}function _g(t,e){return function(n,i){for(var r=n.length,s=[],o=0,l=t[0],a=0;r>0&&l>0&&(a+l+1>i&&(l=Math.max(1,i-a)),s.push(n.substring(r-=l,r+l)),!((a+=l+1)>i));)l=t[o=(o+1)%t.length];return s.reverse().join(e)}}function vg(t){return function(e){return e.replace(/[0-9]/g,function(n){return t[+n]})}}var yg=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function nr(t){if(!(e=yg.exec(t)))throw new Error("invalid format: "+t);var e;return new ts({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}nr.prototype=ts.prototype;function ts(t){this.fill=t.fill===void 0?" ":t.fill+"",this.align=t.align===void 0?">":t.align+"",this.sign=t.sign===void 0?"-":t.sign+"",this.symbol=t.symbol===void 0?"":t.symbol+"",this.zero=!!t.zero,this.width=t.width===void 0?void 0:+t.width,this.comma=!!t.comma,this.precision=t.precision===void 0?void 0:+t.precision,this.trim=!!t.trim,this.type=t.type===void 0?"":t.type+""}ts.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function bg(t){e:for(var e=t.length,n=1,i=-1,r;n<e;++n)switch(t[n]){case".":i=r=n;break;case"0":i===0&&(i=n),r=n;break;default:if(!+t[n])break e;i>0&&(i=0);break}return i>0?t.slice(0,i)+t.slice(r+1):t}var Pl;function wg(t,e){var n=tr(t,e);if(!n)return t+"";var i=n[0],r=n[1],s=r-(Pl=Math.max(-8,Math.min(8,Math.floor(r/3)))*3)+1,o=i.length;return s===o?i:s>o?i+new Array(s-o+1).join("0"):s>0?i.slice(0,s)+"."+i.slice(s):"0."+new Array(1-s).join("0")+tr(t,Math.max(0,e+s-1))[0]}function Ll(t,e){var n=tr(t,e);if(!n)return t+"";var i=n[0],r=n[1];return r<0?"0."+new Array(-r).join("0")+i:i.length>r+1?i.slice(0,r+1)+"."+i.slice(r+1):i+new Array(r-i.length+2).join("0")}const Rl={"%":(t,e)=>(t*100).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:gg,e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>Ll(t*100,e),r:Ll,s:wg,X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function Dl(t){return t}var $l=Array.prototype.map,zl=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function Sg(t){var e=t.grouping===void 0||t.thousands===void 0?Dl:_g($l.call(t.grouping,Number),t.thousands+""),n=t.currency===void 0?"":t.currency[0]+"",i=t.currency===void 0?"":t.currency[1]+"",r=t.decimal===void 0?".":t.decimal+"",s=t.numerals===void 0?Dl:vg($l.call(t.numerals,String)),o=t.percent===void 0?"%":t.percent+"",l=t.minus===void 0?"−":t.minus+"",a=t.nan===void 0?"NaN":t.nan+"";function c(h){h=nr(h);var f=h.fill,d=h.align,m=h.sign,p=h.symbol,g=h.zero,_=h.width,k=h.comma,E=h.precision,b=h.trim,S=h.type;S==="n"?(k=!0,S="g"):Rl[S]||(E===void 0&&(E=12),b=!0,S="g"),(g||f==="0"&&d==="=")&&(g=!0,f="0",d="=");var T=p==="$"?n:p==="#"&&/[boxX]/.test(S)?"0"+S.toLowerCase():"",M=p==="$"?i:/[%p]/.test(S)?o:"",C=Rl[S],x=/[defgprs%]/.test(S);E=E===void 0?6:/[gprs]/.test(S)?Math.max(1,Math.min(21,E)):Math.max(0,Math.min(20,E));function P(L){var H=T,D=M,I,R,N;if(S==="c")D=C(L)+D,L="";else{L=+L;var V=L<0||1/L<0;if(L=isNaN(L)?a:C(Math.abs(L),E),b&&(L=bg(L)),V&&+L==0&&m!=="+"&&(V=!1),H=(V?m==="("?m:l:m==="-"||m==="("?"":m)+H,D=(S==="s"?zl[8+Pl/3]:"")+D+(V&&m==="("?")":""),x){for(I=-1,R=L.length;++I<R;)if(N=L.charCodeAt(I),48>N||N>57){D=(N===46?r+L.slice(I+1):L.slice(I))+D,L=L.slice(0,I);break}}}k&&!g&&(L=e(L,1/0));var q=H.length+L.length+D.length,B=q<_?new Array(_-q+1).join(f):"";switch(k&&g&&(L=e(B+L,B.length?_-D.length:1/0),B=""),d){case"<":L=H+L+D+B;break;case"=":L=H+B+L+D;break;case"^":L=B.slice(0,q=B.length>>1)+H+L+D+B.slice(q);break;default:L=B+H+L+D;break}return s(L)}return P.toString=function(){return h+""},P}function u(h,f){var d=c((h=nr(h),h.type="f",h)),m=Math.max(-8,Math.min(8,Math.floor(Bn(f)/3)))*3,p=Math.pow(10,-m),g=zl[8+m/3];return function(_){return d(p*_)+g}}return{format:c,formatPrefix:u}}var ir,jl,Fl;kg({thousands:",",grouping:[3],currency:["$",""]});function kg(t){return ir=Sg(t),jl=ir.format,Fl=ir.formatPrefix,ir}function Eg(t){return Math.max(0,-Bn(Math.abs(t)))}function Cg(t,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Bn(e)/3)))*3-Bn(Math.abs(t)))}function Ig(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,Bn(e)-Bn(t))+1}function ns(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t);break}return this}const Vl=Symbol("implicit");function Hl(){var t=new xo,e=[],n=[],i=Vl;function r(s){let o=t.get(s);if(o===void 0){if(i!==Vl)return i;t.set(s,o=e.push(s)-1)}return n[o%n.length]}return r.domain=function(s){if(!arguments.length)return e.slice();e=[],t=new xo;for(const o of s)t.has(o)||t.set(o,e.push(o)-1);return r},r.range=function(s){return arguments.length?(n=Array.from(s),r):n.slice()},r.unknown=function(s){return arguments.length?(i=s,r):i},r.copy=function(){return Hl(e,n).unknown(i)},ns.apply(r,arguments),r}function Ul(){var t=Hl().unknown(void 0),e=t.domain,n=t.range,i=0,r=1,s,o,l=!1,a=0,c=0,u=.5;delete t.unknown;function h(){var f=e().length,d=r<i,m=d?r:i,p=d?i:r;s=(p-m)/Math.max(1,f-a+c*2),l&&(s=Math.floor(s)),m+=(p-m-s*(f-a))*u,o=s*(1-a),l&&(m=Math.round(m),o=Math.round(o));var g=Di(f).map(function(_){return m+s*_});return n(d?g.reverse():g)}return t.domain=function(f){return arguments.length?(e(f),h()):e()},t.range=function(f){return arguments.length?([i,r]=f,i=+i,r=+r,h()):[i,r]},t.rangeRound=function(f){return[i,r]=f,i=+i,r=+r,l=!0,h()},t.bandwidth=function(){return o},t.step=function(){return s},t.round=function(f){return arguments.length?(l=!!f,h()):l},t.padding=function(f){return arguments.length?(a=Math.min(1,c=+f),h()):a},t.paddingInner=function(f){return arguments.length?(a=Math.min(1,f),h()):a},t.paddingOuter=function(f){return arguments.length?(c=+f,h()):c},t.align=function(f){return arguments.length?(u=Math.max(0,Math.min(1,f)),h()):u},t.copy=function(){return Ul(e(),[i,r]).round(l).paddingInner(a).paddingOuter(c).align(u)},ns.apply(h(),arguments)}function Mg(t){return function(){return t}}function xg(t){return+t}var Bl=[0,1];function qn(t){return t}function is(t,e){return(e-=t=+t)?function(n){return(n-t)/e}:Mg(isNaN(e)?NaN:.5)}function Ag(t,e){var n;return t>e&&(n=t,t=e,e=n),function(i){return Math.max(t,Math.min(e,i))}}function Tg(t,e,n){var i=t[0],r=t[1],s=e[0],o=e[1];return r<i?(i=is(r,i),s=n(o,s)):(i=is(i,r),s=n(s,o)),function(l){return s(i(l))}}function Ng(t,e,n){var i=Math.min(t.length,e.length)-1,r=new Array(i),s=new Array(i),o=-1;for(t[i]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++o<i;)r[o]=is(t[o],t[o+1]),s[o]=n(e[o],e[o+1]);return function(l){var a=Mo(t,l,1,i)-1;return s[a](r[a](l))}}function Og(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function Pg(){var t=Bl,e=Bl,n=Br,i,r,s,o=qn,l,a,c;function u(){var f=Math.min(t.length,e.length);return o!==qn&&(o=Ag(t[0],t[f-1])),l=f>2?Ng:Tg,a=c=null,h}function h(f){return f==null||isNaN(f=+f)?s:(a||(a=l(t.map(i),e,n)))(i(o(f)))}return h.invert=function(f){return o(r((c||(c=l(e,t.map(i),Ft)))(f)))},h.domain=function(f){return arguments.length?(t=Array.from(f,xg),u()):t.slice()},h.range=function(f){return arguments.length?(e=Array.from(f),u()):e.slice()},h.rangeRound=function(f){return e=Array.from(f),n=Em,u()},h.clamp=function(f){return arguments.length?(o=f?!0:qn,u()):o!==qn},h.interpolate=function(f){return arguments.length?(n=f,u()):n},h.unknown=function(f){return arguments.length?(s=f,h):s},function(f,d){return i=f,r=d,u()}}function Lg(){return Pg()(qn,qn)}function Rg(t,e,n,i){var r=rh(t,e,n),s;switch(i=nr(i??",f"),i.type){case"s":{var o=Math.max(Math.abs(t),Math.abs(e));return i.precision==null&&!isNaN(s=Cg(r,o))&&(i.precision=s),Fl(i,o)}case"":case"e":case"g":case"p":case"r":{i.precision==null&&!isNaN(s=Ig(r,Math.max(Math.abs(t),Math.abs(e))))&&(i.precision=s-(i.type==="e"));break}case"f":case"%":{i.precision==null&&!isNaN(s=Eg(r))&&(i.precision=s-(i.type==="%")*2);break}}return jl(i)}function Dg(t){var e=t.domain;return t.ticks=function(n){var i=e();return To(i[0],i[i.length-1],n??10)},t.tickFormat=function(n,i){var r=e();return Rg(r[0],r[r.length-1],n??10,i)},t.nice=function(n){n==null&&(n=10);var i=e(),r=0,s=i.length-1,o=i[r],l=i[s],a,c,u=10;for(l<o&&(c=o,o=l,l=c,c=r,r=s,s=c);u-- >0;){if(c=jn(o,l,n),c===a)return i[r]=o,i[s]=l,e(i);if(c>0)o=Math.floor(o/c)*c,l=Math.ceil(l/c)*c;else if(c<0)o=Math.ceil(o*c)/c,l=Math.floor(l*c)/c;else break;a=c}return t},t}function rs(){var t=Lg();return t.copy=function(){return Og(t,rs())},ns.apply(t,arguments),Dg(t)}const rr=t=>()=>t;function $g(t,{sourceEvent:e,target:n,transform:i,dispatch:r}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:i,enumerable:!0,configurable:!0},_:{value:r}})}function nn(t,e,n){this.k=t,this.x=e,this.y=n}nn.prototype={constructor:nn,scale:function(t){return t===1?this:new nn(this.k*t,this.x,this.y)},translate:function(t,e){return t===0&e===0?this:new nn(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var ss=new nn(1,0,0);nn.prototype;function os(t){t.stopImmediatePropagation()}function di(t){t.preventDefault(),t.stopImmediatePropagation()}function zg(t){return(!t.ctrlKey||t.type==="wheel")&&!t.button}function jg(){var t=this;return t instanceof SVGElement?(t=t.ownerSVGElement||t,t.hasAttribute("viewBox")?(t=t.viewBox.baseVal,[[t.x,t.y],[t.x+t.width,t.y+t.height]]):[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]):[[0,0],[t.clientWidth,t.clientHeight]]}function ql(){return this.__zoom||ss}function Fg(t){return-t.deltaY*(t.deltaMode===1?.05:t.deltaMode?1:.002)*(t.ctrlKey?10:1)}function Vg(){return navigator.maxTouchPoints||"ontouchstart"in this}function Hg(t,e,n){var i=t.invertX(e[0][0])-n[0][0],r=t.invertX(e[1][0])-n[1][0],s=t.invertY(e[0][1])-n[0][1],o=t.invertY(e[1][1])-n[1][1];return t.translate(r>i?(i+r)/2:Math.min(0,i)||Math.max(0,r),o>s?(s+o)/2:Math.min(0,s)||Math.max(0,o))}function Kl(){var t=zg,e=jg,n=Hg,i=Fg,r=Vg,s=[0,1/0],o=[[-1/0,-1/0],[1/0,1/0]],l=250,a=Om,c=ii("start","zoom","end"),u,h,f,d=500,m=150,p=0,g=10;function _(I){I.property("__zoom",ql).on("wheel.zoom",C,{passive:!1}).on("mousedown.zoom",x).on("dblclick.zoom",P).filter(r).on("touchstart.zoom",L).on("touchmove.zoom",H).on("touchend.zoom touchcancel.zoom",D).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}_.transform=function(I,R,N,V){var q=I.selection?I.selection():I;q.property("__zoom",ql),I!==q?S(I,R,N,V):q.interrupt().each(function(){T(this,arguments).event(V).start().zoom(null,typeof R=="function"?R.apply(this,arguments):R).end()})},_.scaleBy=function(I,R,N,V){_.scaleTo(I,function(){var q=this.__zoom.k,B=typeof R=="function"?R.apply(this,arguments):R;return q*B},N,V)},_.scaleTo=function(I,R,N,V){_.transform(I,function(){var q=e.apply(this,arguments),B=this.__zoom,X=N==null?b(q):typeof N=="function"?N.apply(this,arguments):N,se=B.invert(X),le=typeof R=="function"?R.apply(this,arguments):R;return n(E(k(B,le),X,se),q,o)},N,V)},_.translateBy=function(I,R,N,V){_.transform(I,function(){return n(this.__zoom.translate(typeof R=="function"?R.apply(this,arguments):R,typeof N=="function"?N.apply(this,arguments):N),e.apply(this,arguments),o)},null,V)},_.translateTo=function(I,R,N,V,q){_.transform(I,function(){var B=e.apply(this,arguments),X=this.__zoom,se=V==null?b(B):typeof V=="function"?V.apply(this,arguments):V;return n(ss.translate(se[0],se[1]).scale(X.k).translate(typeof R=="function"?-R.apply(this,arguments):-R,typeof N=="function"?-N.apply(this,arguments):-N),B,o)},V,q)};function k(I,R){return R=Math.max(s[0],Math.min(s[1],R)),R===I.k?I:new nn(R,I.x,I.y)}function E(I,R,N){var V=R[0]-N[0]*I.k,q=R[1]-N[1]*I.k;return V===I.x&&q===I.y?I:new nn(I.k,V,q)}function b(I){return[(+I[0][0]+ +I[1][0])/2,(+I[0][1]+ +I[1][1])/2]}function S(I,R,N,V){I.on("start.zoom",function(){T(this,arguments).event(V).start()}).on("interrupt.zoom end.zoom",function(){T(this,arguments).event(V).end()}).tween("zoom",function(){var q=this,B=arguments,X=T(q,B).event(V),se=e.apply(q,B),le=N==null?b(se):typeof N=="function"?N.apply(q,B):N,fe=Math.max(se[1][0]-se[0][0],se[1][1]-se[0][1]),te=q.__zoom,he=typeof R=="function"?R.apply(q,B):R,Y=a(te.invert(le).concat(fe/te.k),he.invert(le).concat(fe/he.k));return function(G){if(G===1)G=he;else{var Z=Y(G),Q=fe/Z[2];G=new nn(Q,le[0]-Z[0]*Q,le[1]-Z[1]*Q)}X.zoom(null,G)}})}function T(I,R,N){return!N&&I.__zooming||new M(I,R)}function M(I,R){this.that=I,this.args=R,this.active=0,this.sourceEvent=null,this.extent=e.apply(I,R),this.taps=0}M.prototype={event:function(I){return I&&(this.sourceEvent=I),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(I,R){return this.mouse&&I!=="mouse"&&(this.mouse[1]=R.invert(this.mouse[0])),this.touch0&&I!=="touch"&&(this.touch0[1]=R.invert(this.touch0[0])),this.touch1&&I!=="touch"&&(this.touch1[1]=R.invert(this.touch1[0])),this.that.__zoom=R,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(I){var R=Ye(this.that).datum();c.call(I,this.that,new $g(I,{sourceEvent:this.sourceEvent,target:_,type:I,transform:this.that.__zoom,dispatch:c}),R)}};function C(I,...R){if(!t.apply(this,arguments))return;var N=T(this,R).event(I),V=this.__zoom,q=Math.max(s[0],Math.min(s[1],V.k*Math.pow(2,i.apply(this,arguments)))),B=pt(I);if(N.wheel)(N.mouse[0][0]!==B[0]||N.mouse[0][1]!==B[1])&&(N.mouse[1]=V.invert(N.mouse[0]=B)),clearTimeout(N.wheel);else{if(V.k===q)return;N.mouse=[B,V.invert(B)],er(this),N.start()}di(I),N.wheel=setTimeout(X,m),N.zoom("mouse",n(E(k(V,q),N.mouse[0],N.mouse[1]),N.extent,o));function X(){N.wheel=null,N.end()}}function x(I,...R){if(f||!t.apply(this,arguments))return;var N=I.currentTarget,V=T(this,R,!0).event(I),q=Ye(I.view).on("mousemove.zoom",le,!0).on("mouseup.zoom",fe,!0),B=pt(I,N),X=I.clientX,se=I.clientY;Yo(I.view),os(I),V.mouse=[B,this.__zoom.invert(B)],er(this),V.start();function le(te){if(di(te),!V.moved){var he=te.clientX-X,Y=te.clientY-se;V.moved=he*he+Y*Y>p}V.event(te).zoom("mouse",n(E(V.that.__zoom,V.mouse[0]=pt(te,N),V.mouse[1]),V.extent,o))}function fe(te){q.on("mousemove.zoom mouseup.zoom",null),Go(te.view,V.moved),di(te),V.event(te).end()}}function P(I,...R){if(t.apply(this,arguments)){var N=this.__zoom,V=pt(I.changedTouches?I.changedTouches[0]:I,this),q=N.invert(V),B=N.k*(I.shiftKey?.5:2),X=n(E(k(N,B),V,q),e.apply(this,R),o);di(I),l>0?Ye(this).transition().duration(l).call(S,X,V,I):Ye(this).call(_.transform,X,V,I)}}function L(I,...R){if(t.apply(this,arguments)){var N=I.touches,V=N.length,q=T(this,R,I.changedTouches.length===V).event(I),B,X,se,le;for(os(I),X=0;X<V;++X)se=N[X],le=pt(se,this),le=[le,this.__zoom.invert(le),se.identifier],q.touch0?!q.touch1&&q.touch0[2]!==le[2]&&(q.touch1=le,q.taps=0):(q.touch0=le,B=!0,q.taps=1+!!u);u&&(u=clearTimeout(u)),B&&(q.taps<2&&(h=le[0],u=setTimeout(function(){u=null},d)),er(this),q.start())}}function H(I,...R){if(this.__zooming){var N=T(this,R).event(I),V=I.changedTouches,q=V.length,B,X,se,le;for(di(I),B=0;B<q;++B)X=V[B],se=pt(X,this),N.touch0&&N.touch0[2]===X.identifier?N.touch0[0]=se:N.touch1&&N.touch1[2]===X.identifier&&(N.touch1[0]=se);if(X=N.that.__zoom,N.touch1){var fe=N.touch0[0],te=N.touch0[1],he=N.touch1[0],Y=N.touch1[1],G=(G=he[0]-fe[0])*G+(G=he[1]-fe[1])*G,Z=(Z=Y[0]-te[0])*Z+(Z=Y[1]-te[1])*Z;X=k(X,Math.sqrt(G/Z)),se=[(fe[0]+he[0])/2,(fe[1]+he[1])/2],le=[(te[0]+Y[0])/2,(te[1]+Y[1])/2]}else if(N.touch0)se=N.touch0[0],le=N.touch0[1];else return;N.zoom("touch",n(E(X,se,le),N.extent,o))}}function D(I,...R){if(this.__zooming){var N=T(this,R).event(I),V=I.changedTouches,q=V.length,B,X;for(os(I),f&&clearTimeout(f),f=setTimeout(function(){f=null},d),B=0;B<q;++B)X=V[B],N.touch0&&N.touch0[2]===X.identifier?delete N.touch0:N.touch1&&N.touch1[2]===X.identifier&&delete N.touch1;if(N.touch1&&!N.touch0&&(N.touch0=N.touch1,delete N.touch1),N.touch0)N.touch0[1]=this.__zoom.invert(N.touch0[0]);else if(N.end(),N.taps===2&&(X=pt(X,this),Math.hypot(h[0]-X[0],h[1]-X[1])<g)){var se=Ye(this).on("dblclick.zoom");se&&se.apply(this,arguments)}}}return _.wheelDelta=function(I){return arguments.length?(i=typeof I=="function"?I:rr(+I),_):i},_.filter=function(I){return arguments.length?(t=typeof I=="function"?I:rr(!!I),_):t},_.touchable=function(I){return arguments.length?(r=typeof I=="function"?I:rr(!!I),_):r},_.extent=function(I){return arguments.length?(e=typeof I=="function"?I:rr([[+I[0][0],+I[0][1]],[+I[1][0],+I[1][1]]]),_):e},_.scaleExtent=function(I){return arguments.length?(s[0]=+I[0],s[1]=+I[1],_):[s[0],s[1]]},_.translateExtent=function(I){return arguments.length?(o[0][0]=+I[0][0],o[1][0]=+I[1][0],o[0][1]=+I[0][1],o[1][1]=+I[1][1],_):[[o[0][0],o[0][1]],[o[1][0],o[1][1]]]},_.constrain=function(I){return arguments.length?(n=I,_):n},_.duration=function(I){return arguments.length?(l=+I,_):l},_.interpolate=function(I){return arguments.length?(a=I,_):a},_.on=function(){var I=c.on.apply(c,arguments);return I===c?_:I},_.clickDistance=function(I){return arguments.length?(p=(I=+I)*I,_):Math.sqrt(p)},_.tapDistance=function(I){return arguments.length?(g=+I,_):g},_}function Ug(t,e,n=null,i,r=null){const s=Ye(t);s.selectAll("*").remove();const o=s.node(),l=o.getBoundingClientRect();let a=l.width||800,c=l.height||600;const u=a/2,h=c/2,f=s.append("canvas").attr("class","network-canvas").attr("width",a).attr("height",c).style("width",a+"px").style("height",c+"px").style("cursor","default"),d=f.node().getContext("2d",{alpha:!1});let m=ss;const p=new Set,g={current:null};function _(){const L=o.getBoundingClientRect(),H=L.width||800,D=L.height||600;(H!==a||D!==c)&&(a=H,c=D,f.attr("width",a).attr("height",c).style("width",a+"px").style("height",c+"px"),P())}const k=new ResizeObserver(_);k.observe(o);const E=Al(e).force("link",Ml(n).id(L=>L.id).distance(L=>L.distance)).force("charge",Tl().strength(-250)).force("center",Sl(u,h).strength(.7)).force("collide",Cl(L=>L.radius+10).strength(.5)).force("x",Nl(u).strength(.025)).force("y",Ol(h).strength(.025)).alphaDecay(.05).velocityDecay(.6);let b=null;E.on("tick",()=>{b||(b=requestAnimationFrame(()=>{P(),b=null}))}),E.tick(100);for(let L=0;L<100;L++)E.tick();E.alphaTarget(0);const S=Bg({canvas:f,nodes:e,transform:()=>m,hoveredNode:g,onSelectionChange:(L,H)=>{p.clear(),L.forEach(I=>p.add(I));const D=Kg(e,L,H);i(D),P()},render:()=>P()}),T=Kl().scaleExtent([.1,10]).filter(L=>!S.isSelectionMode()||L.type==="wheel").on("zoom",({transform:L})=>{m=L,P()});f.call(T);const{dragstarted:M,dragged:C,dragended:x}=qg(f,e,E,()=>m,g,()=>!S.isSelectionMode(),P);S.setupInteractions(f,{start:M,drag:C,end:x});function P(){d.save(),d.fillRect(0,0,a,c),d.translate(m.x,m.y),d.scale(m.k,m.k),d.strokeStyle="#8a8a8a",d.lineWidth=1/m.k,n.forEach(H=>{const D=H.source.x,I=H.source.y,R=H.target.x,N=H.target.y;d.globalAlpha=Math.max(.2,H.strength),d.lineWidth=H.width/m.k,d.beginPath(),d.moveTo(D,I),d.lineTo(R,N),d.stroke()}),d.globalAlpha=1,e.forEach(H=>{const D=p.has(H.id);d.fillStyle=H.color,d.beginPath(),d.arc(H.x,H.y,H.radius,0,2*Math.PI),d.fill(),D&&(d.strokeStyle="#0f2bff",d.lineWidth=3/m.k,d.stroke())});const L=S.getSelectionRect();if(L){d.strokeStyle="#0f2bff",d.fillStyle="rgba(15, 43, 255, 0.2)",d.lineWidth=2/m.k;const H=Math.min(L.x1,L.x2),D=Math.min(L.y1,L.y2),I=Math.abs(L.x2-L.x1),R=Math.abs(L.y2-L.y1);d.fillRect(H,D,I,R),d.strokeRect(H,D,I,R)}d.restore()}return P(),{destroy:()=>{b&&cancelAnimationFrame(b),E.stop(),k.disconnect(),f.remove()},toggleSelectionMode:()=>{const L=S.toggleSelectionMode();return r&&r(L),P(),L}}}function Bg(t){const{canvas:e,nodes:n,transform:i,hoveredNode:r,onSelectionChange:s,render:o}=t,l=new Set,a=[];let c=!1,u=null;function h(){return c=!c,e.style("cursor",c?"crosshair":"default"),c}function f(p){if(l.has(p)){l.delete(p);const g=a.indexOf(p);g>-1&&a.splice(g,1)}else l.add(p),a.push(p);s(l,a)}function d(p,g){const _=i(),k=(p-_.x)/_.k,E=(g-_.y)/_.k;for(let b=n.length-1;b>=0;b--){const S=n[b],T=k-S.x,M=E-S.y;if(Math.sqrt(T*T+M*M)<S.radius)return S}return null}function m(p,g){let _=null;p.on("mousedown",function(k){const[E,b]=pt(k),S=d(E,b);if(c){const T=i(),M=(E-T.x)/T.k,C=(b-T.y)/T.k;u={x1:M,y1:C,x2:M,y2:C},o()}else S&&(_=S,g.start(k,S))}),p.on("mousemove",function(k){const[E,b]=pt(k);if(c){if(u){const S=i(),T=(E-S.x)/S.k,M=(b-S.y)/S.k;u.x2=T,u.y2=M,o()}}else if(_)g.drag(k,_,E,b);else{const S=d(E,b);r.current!==S&&(r.current=S,p.style("cursor",S?"pointer":"default"),o())}}),p.on("mouseup",function(k){if(c){if(u){const E=Math.min(u.x1,u.x2),b=Math.min(u.y1,u.y2),S=Math.max(u.x1,u.x2),T=Math.max(u.y1,u.y2);l.clear(),a.length=0;const M=[];n.forEach(C=>{C.x>=E&&C.x<=S&&C.y>=b&&C.y<=T&&M.push({id:C.id,y:C.y})}),M.sort((C,x)=>C.y-x.y),M.forEach(({id:C})=>{l.add(C),a.push(C)}),s(l,a),u=null,o()}}else if(_)g.end(k,_),_=null;else{const[E,b]=pt(k),S=d(E,b);S&&f(S.id)}})}return{toggleSelectionMode:h,isSelectionMode:()=>c,setupInteractions:m,getSelectionRect:()=>u}}function qg(t,e,n,i,r,s,o){let l=null;function a(h,f){s()&&(h.active||n.alphaTarget(.3).restart(),l=f,f.fx=f.x,f.fy=f.y)}function c(h,f,d,m){if(!l||!s())return;const p=i();f.fx=(d-p.x)/p.k,f.fy=(m-p.y)/p.k,o()}function u(h,f){!l||!s()||(h.active||n.alphaTarget(0),f.fx=null,f.fy=null,l=null)}return{dragstarted:a,dragged:c,dragended:u}}function Kg(t,e,n){const i=new Map(t.map(r=>[r.id,r]));return n.map(r=>i.get(r)).filter(Boolean)}const Wl=8,Wg=1.5,Yg=50,Yl=.5,Gg=800,Xg=600;function Jg(t,e,n=null,i=null,r=null){const s=Gg/2,o=Xg/2,a=Ye(t).append("svg").attr("class","network-svg"),c=a.append("g"),u=c.append("g").selectAll("line").data(n).join("line").attr("class","link").attr("stroke-width",m=>m.width||Wg).attr("stroke-opacity",m=>Math.max(.2,m.strength||Yl)),h=c.append("g").selectAll("circle").data(e).join("circle").attr("class","node").attr("r",m=>m.radius||Wl).attr("fill",m=>m.color);h.append("title").text(m=>m.label);const f=Al(e).force("link",Ml(n).id(m=>m.id).distance(m=>m.distance||Yg)).force("charge",Tl().strength(-250)).force("center",Sl(s,o).strength(.7)).force("collide",Cl(m=>(m.radius||Wl)+10).strength(Yl)).force("x",Nl(s).strength(.025)).force("y",Ol(o).strength(.025));let d=null;if(i){d=Qg({svg:a,g:c,nodes:e,onSelectionChange:(_,k)=>{h.classed("selected",b=>_.has(b.id));const E=e_(e,_,k);i(E)}}),a.call(Kl().scaleExtent([.1,10]).filter(_=>!d.isSelectionMode()||_.type==="wheel").on("zoom",({transform:_})=>c.attr("transform",_)));const{dragstarted:m,dragged:p,dragended:g}=Zg(f,u,h);d.setupNodeClick(h),d.setupDrag(h,{start:m,drag:p,end:g})}return{destroy:()=>{f.stop(),a.remove()},toggleSelectionMode:()=>{if(d){const m=d.toggleSelectionMode();return r&&r(m),m}}}}function Qg(t){const{svg:e,g:n,nodes:i,onSelectionChange:r,getNodePosition:s=p=>({x:p.x,y:p.y}),getNodeId:o=p=>p.id}=t,l=new Set,a=[];let c=!1;function u(){return c=!c,e.style("cursor",c?"crosshair":"default"),c}function h(p){if(l.has(p)){l.delete(p);const g=a.indexOf(p);g>-1&&a.splice(g,1)}else l.add(p),a.push(p);r(l,a)}function f(){l.clear(),a.length=0,r(l,a)}let d=null,m=null;return e.on("mousedown",function(p){if(!c)return;p.preventDefault();const[g,_]=pt(p,n.node());d={x:g,y:_},m=n.append("rect").attr("class","selection-rect").attr("x",g).attr("y",_).attr("width",0).attr("height",0)}).on("mousemove",function(p){if(!c||!m)return;const[g,_]=pt(p,n.node()),k=g-d.x,E=_-d.y;m.attr("x",k<0?g:d.x).attr("y",E<0?_:d.y).attr("width",Math.abs(k)).attr("height",Math.abs(E))}).on("mouseup",function(p){if(!c||!m)return;const[g,_]=pt(p,n.node()),k=Math.min(d.x,g),E=Math.min(d.y,_),b=Math.max(d.x,g),S=Math.max(d.y,_);l.clear(),a.length=0;const T=[];i.forEach(M=>{const C=s(M);C.x>=k&&C.x<=b&&C.y>=E&&C.y<=S&&T.push({id:o(M),y:C.y})}),T.sort((M,C)=>M.y-C.y),T.forEach(({id:M})=>{l.add(M),a.push(M)}),r(l,a),m.remove(),m=null,d=null}),{toggleSelectionMode:u,toggleNode:h,clearSelection:f,isSelectionMode:()=>c,getSelectedNodes:()=>l,getSelectionOrder:()=>a,setupNodeClick:p=>{p.on("click",function(g,_){g.stopPropagation(),h(o(_))})},setupDrag:(p,g)=>{p.call(nm().filter(()=>!c).on("start",g.start).on("drag",g.drag).on("end",g.end))}}}function Zg(t,e,n){t.on("tick",()=>{e.attr("x1",o=>o.source.x).attr("y1",o=>o.source.y).attr("x2",o=>o.target.x).attr("y2",o=>o.target.y),n.attr("cx",o=>o.x).attr("cy",o=>o.y)});function i(o){o.active||t.alphaTarget(.3).restart(),o.subject.fx=o.subject.x,o.subject.fy=o.subject.y}function r(o){o.subject.fx=o.x,o.subject.fy=o.y}function s(o){o.active||t.alphaTarget(0),o.subject.fx=null,o.subject.fy=null}return{dragstarted:i,dragged:r,dragended:s}}function e_(t,e,n){const i=new Map(t.map(r=>[r.id,r]));return n.map(r=>i.get(r)).filter(Boolean)}const t_="modulepreload",n_=function(t){return"/"+t},Gl={},ls=function(e,n,i){return e()};function as(t){const{type:e,modelName:n,title:i,extractMeta:r=d=>d}=t,s={id:null,type:e,title:i,selected:{}},o=JSON.parse(localStorage.getItem(e))||s,l=xe(o),a=xe(!1);function c(d,m=!1){a.set(m),localStorage.setItem(e,JSON.stringify(d))}function u(){l.update(d=>{if(e!=="documentSet")return console.error("Document set management is the only type currently supported for saving."),d;const m=Object.fromEntries(Object.entries(d.selected).map(([g,_])=>[g,Object.keys(_)])),p=d.id?`${d.id}/edit`:"new";return fetch(`${window.location.origin}/${n}/${p}`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":an},body:JSON.stringify({title:d.title,selection:d,...m})}).then(g=>g.json()).then(g=>{if(!(g!=null&&g.document_set_id))throw new Error("Failed to save");l.update(_=>(_.id=g.document_set_id,_.title=g.document_set_title,c(_,!0),_))}).catch(g=>console.error("Error:",g)),d})}const h=d=>l.update(()=>{const m=d.selection.id?d.selection:{...d.selection,id:d.id};return c(m),m}),f=()=>l.update(()=>{const d={...s,selected:{}};return c(d),d});return{type:e,subscribe:l.subscribe,add:d=>l.update(m=>(m.selected[d.class]={...m.selected[d.class]||{},[d.id]:r(d)},c(m),m)),addAll:d=>l.update(m=>(d.forEach(p=>{m.selected[p.class]={...m.selected[p.class]||{},[p.id]:r(p)}}),c(m),m)),remove:(d,m)=>l.update(p=>{const{[d]:g,..._}=p.selected[m];return p.selected[m]=_,c(p),p}),removeAll:(d,m)=>l.update(p=>(d.forEach(g=>{var _;return(_=p.selected[m])==null?!0:delete _[g]}),c(p),p)),toggle:d=>l.update(m=>{var p;if((p=m.selected[d.class])!=null&&p[d.id]){const{[d.id]:g,..._}=m.selected[d.class];m.selected[d.class]=_}else m.selected[d.class]={...m.selected[d.class]||{},[d.id]:r(d)};return c(m),m}),toggleSet:d=>{ot(l).id===d.id?f():h(d)},empty:()=>l.update(d=>(d.id=null,d.title=i,d.selected={},c(d,!0),d)),updateTitle:d=>l.update(m=>(m.title=d,c(m,!0),m)),save:u,isSaved:a,selection:l,selectionTitle:tt(l,d=>d.title),isSelected:tt(l,d=>m=>{var p;return((p=d.selected[m.class])==null?void 0:p[m.id])||!1}),selected:tt(l,d=>d.selected),nbSelected:tt(l,d=>Object.values(d.selected).reduce((m,p)=>m+Object.keys(p).length,0)),isSetSelected:tt(l,d=>m=>d.id===m.id)}}as({type:"documentSet",modelName:"document-set",title:W==="en"?"Document set":"Set de documents",extractMeta:t=>({title:t.title,url:t.url})});const i_=as({type:"regionsSet",modelName:"regions-set",title:W==="en"?"Regions set":"Set de régions",extractMeta:t=>t}),sr=as({type:"clusterSet",modelName:"cluster-set",title:W==="en"?"Selected regions":"Régions sélectionnées",extractMeta:t=>({imgRef:t.id,clusterId:t.clusterId,title:t.title,xywh:t.xywh,img:t.img})});function r_(){const t=`${window.location.origin}${window.location.pathname}`,e=xe(1),n=xe({}),i=xe({}),r=xe("");wr(e,"p");function s(u){r.update(h=>{const f=h===u?"":u;return navigator.clipboard.writeText(f).then(d=>""),f})}const o=(async()=>{try{const u=await fetch(`${t}canvas`);if(!u.ok)return{};const h=await u.json();let f={};return Object.values(h).forEach(d=>{Object.entries(d).forEach(([m,p])=>{f[m]=p})}),n.set(f),h}catch{return{}}})(),l=tt(e,u=>(async()=>{const f=await(await fetch(`${t}canvas?p=${u}`)).json();return i.set(f),f})());function a(u){Sr(u,e,"p")}function c(u){n.update(h=>(delete h[u],{...h})),i.update(h=>{for(const f in h)if(h[f][u]){const{[u]:d,...m}=h[f];return h[f]=m,h}return h})}return{currentPage:e,pageRegions:i,allRegions:n,fetchPages:l,fetchAll:o,handlePageUpdate:a,remove:c,clipBoard:r,copyRef:s}}const Xl=r_(),Jy="";function s_(t){let e;return{c(){e=Dt("path"),v(e,"d","M384 336H192c-8.8 0-16-7.2-16-16V64c0-8.8 7.2-16 16-16l140.1 0L400 115.9V320c0 8.8-7.2 16-16 16zM192 384H384c35.3 0 64-28.7 64-64V115.9c0-12.7-5.1-24.9-14.1-33.9L366.1 14.1c-9-9-21.2-14.1-33.9-14.1H192c-35.3 0-64 28.7-64 64V320c0 35.3 28.7 64 64 64zM64 128c-35.3 0-64 28.7-64 64V448c0 35.3 28.7 64 64 64H256c35.3 0 64-28.7 64-64V416H272v32c0 8.8-7.2 16-16 16H64c-8.8 0-16-7.2-16-16V192c0-8.8 7.2-16 16-16H96V128H64z"),v(e,"class","svelte-1829hp2")},m(n,i){j(n,e,i)},d(n){n&&z(e)}}}function o_(t){let e;return{c(){e=Dt("path"),v(e,"d","M208 0H332.1c12.7 0 24.9 5.1 33.9 14.1l67.9 67.9c9 9 14.1 21.2 14.1 33.9V336c0 26.5-21.5 48-48 48H208c-26.5 0-48-21.5-48-48V48c0-26.5 21.5-48 48-48zM48 128h80v64H64V448H256V416h64v48c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V176c0-26.5 21.5-48 48-48z"),v(e,"class","svelte-1829hp2")},m(n,i){j(n,e,i)},d(n){n&&z(e)}}}function l_(t){let e=W==="en"?"Copy ID":"Copier l'ID",n;return{c(){n=oe(e)},m(i,r){j(i,n,r)},p:ne,d(i){i&&z(n)}}}function a_(t){let e=W==="en"?"Copied!":"Copié !",n;return{c(){n=oe(e)},m(i,r){j(i,n,r)},p:ne,d(i){i&&z(n)}}}function Jl(t){let e,n,i;var r=t[7];function s(o){return{props:{mainImgItem:o[1],compareImgItem:o[14]}}}return r&&(e=ki(r,s(t))),{c(){e&&pe(e.$$.fragment),n=ct()},m(o,l){e&&de(e,o,l),j(o,n,l),i=!0},p(o,l){const a={};if(l&2&&(a.mainImgItem=o[1]),l&128&&r!==(r=o[7])){if(e){Pe();const c=e;K(c.$$.fragment,1,0,()=>{me(c,1)}),Le()}r?(e=ki(r,s(o)),pe(e.$$.fragment),U(e.$$.fragment,1),de(e,n.parentNode,n)):e=null}else r&&e.$set(a)},i(o){i||(e&&U(e.$$.fragment,o),i=!0)},o(o){e&&K(e.$$.fragment,o),i=!1},d(o){o&&z(n),e&&me(e,o)}}}function c_(t){let e,n,i,r,s,o,l,a,c,u,h,f,d,m,p,g,_,k,E,b,S,T,M;function C(R,N){return R[8]?o_:s_}let x=C(t),P=x(t);function L(R,N){return R[8]?a_:l_}let H=L(t),D=H(t),I=t[7]&&Jl(t);return{c(){e=w("div"),n=w("figure"),i=w("img"),s=F(),o=w("div"),l=w("span"),u=F(),h=w("div"),f=w("button"),d=Dt("svg"),P.c(),m=F(),p=w("span"),D.c(),_=F(),I&&I.c(),v(i,"class","region-img svelte-1829hp2"),Mt(i.src,r=t[9])||v(i,"src",r),v(i,"alt","Extracted region"),v(l,"class","overlay-desc"),v(o,"class","overlay is-center svelte-1829hp2"),v(n,"class",a="image card region-image "+(t[0]?"is-96x96":"")+" svelte-1829hp2"),v(n,"tabindex","-1"),v(n,"style",c=(t[2]==="full"?"height: 100%":`height: ${t[2]}px; min-width: ${t[2]}px`)+"; "+(t[3]?`border: 5px solid ${t[3]};`:"")),v(d,"xmlns","http://www.w3.org/2000/svg"),v(d,"viewBox","0 0 384 512"),v(d,"class","svelte-1829hp2"),v(p,"class","tooltip svelte-1829hp2"),v(f,"class","button tag svelte-1829hp2"),v(f,"style",g=t[6]?"":"display: none;"),v(h,"class","region-btn ml-1 svelte-1829hp2"),v(e,"class",k="region is-center "+(t[5]&&t[11](t[1])?"checked":"")+" svelte-1829hp2"),v(e,"style",E=t[2]==="full"?"height: 100%":"")},m(R,N){j(R,e,N),y(e,n),y(n,i),y(n,s),y(n,o),y(o,l),l.innerHTML=t[10],y(e,u),y(e,h),y(h,f),y(f,d),P.m(d,null),y(f,m),y(f,p),D.m(p,null),y(h,_),I&&I.m(h,null),S=!0,T||(M=[be(n,"click",t[19]),be(n,"keyup",u_),be(f,"click",t[20])],T=!0)},p(R,[N]){t=R,(!S||N&512&&!Mt(i.src,r=t[9]))&&v(i,"src",r),(!S||N&1024)&&(l.innerHTML=t[10]),(!S||N&1&&a!==(a="image card region-image "+(t[0]?"is-96x96":"")+" svelte-1829hp2"))&&v(n,"class",a),(!S||N&12&&c!==(c=(t[2]==="full"?"height: 100%":`height: ${t[2]}px; min-width: ${t[2]}px`)+"; "+(t[3]?`border: 5px solid ${t[3]};`:"")))&&v(n,"style",c),x!==(x=C(t))&&(P.d(1),P=x(t),P&&(P.c(),P.m(d,null))),H===(H=L(t))&&D?D.p(t,N):(D.d(1),D=H(t),D&&(D.c(),D.m(p,null))),(!S||N&64&&g!==(g=t[6]?"":"display: none;"))&&v(f,"style",g),t[7]?I?(I.p(t,N),N&128&&U(I,1)):(I=Jl(t),I.c(),U(I,1),I.m(h,null)):I&&(Pe(),K(I,1,1,()=>{I=null}),Le()),(!S||N&2082&&k!==(k="region is-center "+(t[5]&&t[11](t[1])?"checked":"")+" svelte-1829hp2"))&&v(e,"class",k),(!S||N&4&&E!==(E=t[2]==="full"?"height: 100%":""))&&v(e,"style",E)},i(R){S||(U(I),Ut(()=>{S&&(b||(b=ln(e,$n,{duration:t[15]},!0)),b.run(1))}),S=!0)},o(R){K(I),b||(b=ln(e,$n,{duration:t[15]},!1)),b.run(0),S=!1},d(R){R&&z(e),P.d(),D.d(),I&&I.d(),R&&b&&b.end(),T=!1,st(M)}}}const u_=()=>null;function f_(t,e,n){let i,r,s,o,l,{selectionStore:a}=e;a||(a=i_);const{isSelected:c}=a;ye(t,c,x=>n(11,l=x));const{clipBoard:u}=Xl;ye(t,u,x=>n(18,o=x));let{item:h}=e,{descPromise:f=void 0}=e,{isSquare:d=!0}=e,{height:m=d?96:140}=e;m==="full"&&(d=!1);let{borderColor:p=null}=e,{toggleSelection:g=a.toggle}=e;const _=xt("qImgMetadata")||void 0,k=xt("isInModal")||!1,E=k?0:500;let b;k||ls(()=>Promise.resolve().then(()=>a1),void 0).then(x=>n(7,b=x.default));let{selectable:S=!k}=e,{copyable:T=!0}=e;const M=()=>S?g(h):null,C=()=>T?Xl.copyRef(h.ref):null;return t.$$set=x=>{"selectionStore"in x&&n(16,a=x.selectionStore),"item"in x&&n(1,h=x.item),"descPromise"in x&&n(17,f=x.descPromise),"isSquare"in x&&n(0,d=x.isSquare),"height"in x&&n(2,m=x.height),"borderColor"in x&&n(3,p=x.borderColor),"toggleSelection"in x&&n(4,g=x.toggleSelection),"selectable"in x&&n(5,S=x.selectable),"copyable"in x&&n(6,T=x.copyable)},t.$$.update=()=>{t.$$.dirty&2&&n(10,i=h.title),t.$$.dirty&131072&&f&&f.then(x=>n(10,i=x)),t.$$.dirty&7&&n(9,r=Bt(h.img??h.ref,h.xywh,m==="full"?m:d?`${m},`:`,${m}`)),t.$$.dirty&262146&&n(8,s=h.ref===o)},[d,h,m,p,g,S,T,b,s,r,i,l,c,u,_,E,a,f,o,M,C]}class Kn extends Me{constructor(e){super(),Ie(this,e,f_,c_,Ee,{selectionStore:16,item:1,descPromise:17,isSquare:0,height:2,borderColor:3,toggleSelection:4,selectable:5,copyable:6})}}const Qy="";function Ql(t,e,n){const i=t.slice();return i[11]=e[n],i}function Zl(t,e,n){const i=t.slice();return i[14]=e[n],i}function cs(t){const e=t.slice(),n=e[2].get(e[11][e[14]].id);return e[17]=n,e}function ea(t,e,n){const i=t.slice();return i[14]=e[n],i}function ta(t){let e,n,i,r,s,o,l,a,c,u,h=t[0].regions,f=[];for(let _=0;_<h.length;_+=1)f[_]=na(ea(t,h,_));const d=_=>K(f[_],1,1,()=>{f[_]=null});let m=t[0].rows,p=[];for(let _=0;_<m.length;_+=1)p[_]=sa(Ql(t,m,_));const g=_=>K(p[_],1,1,()=>{p[_]=null});return{c(){e=w("div"),n=w("h3"),n.textContent="Aligned Documents",i=F(),r=w("div"),s=w("table"),o=w("thead"),l=w("tr");for(let _=0;_<f.length;_+=1)f[_].c();a=F(),c=w("tbody");for(let _=0;_<p.length;_+=1)p[_].c();v(n,"class","title is-5"),v(o,"class","region-header svelte-1hxxzoa"),v(s,"class","table is-fullwidth svelte-1hxxzoa"),v(r,"class","table-container svelte-1hxxzoa"),v(e,"class","box mt-4")},m(_,k){j(_,e,k),y(e,n),y(e,i),y(e,r),y(r,s),y(s,o),y(o,l);for(let E=0;E<f.length;E+=1)f[E]&&f[E].m(l,null);y(s,a),y(s,c);for(let E=0;E<p.length;E+=1)p[E]&&p[E].m(c,null);u=!0},p(_,k){if(k&3){h=_[0].regions;let E;for(E=0;E<h.length;E+=1){const b=ea(_,h,E);f[E]?(f[E].p(b,k),U(f[E],1)):(f[E]=na(b),f[E].c(),U(f[E],1),f[E].m(l,null))}for(Pe(),E=h.length;E<f.length;E+=1)d(E);Le()}if(k&77){m=_[0].rows;let E;for(E=0;E<m.length;E+=1){const b=Ql(_,m,E);p[E]?(p[E].p(b,k),U(p[E],1)):(p[E]=sa(b),p[E].c(),U(p[E],1),p[E].m(c,null))}for(Pe(),E=m.length;E<p.length;E+=1)g(E);Le()}},i(_){if(!u){for(let k=0;k<h.length;k+=1)U(f[k]);for(let k=0;k<m.length;k+=1)U(p[k]);u=!0}},o(_){f=f.filter(Boolean);for(let k=0;k<f.length;k+=1)K(f[k]);p=p.filter(Boolean);for(let k=0;k<p.length;k+=1)K(p[k]);u=!1},d(_){_&&z(e),dt(f,_),dt(p,_)}}}function na(t){let e,n,i,r;return n=new to({props:{id:t[14],meta:t[1].get(t[14])||{},clickable:!1}}),{c(){e=w("th"),pe(n.$$.fragment),i=F(),v(e,"class","is-vcentered")},m(s,o){j(s,e,o),de(n,e,null),y(e,i),r=!0},p(s,o){const l={};o&1&&(l.id=s[14]),o&3&&(l.meta=s[1].get(s[14])||{}),n.$set(l)},i(s){r||(U(n.$$.fragment,s),r=!0)},o(s){K(n.$$.fragment,s),r=!1},d(s){s&&z(e),me(n)}}}function ia(t){let e,n,i,r,s=t[11][t[14]].page+"",o,l;return e=new Kn({props:{item:t[17],selectable:!1,copyable:!1,borderColor:t[6](t[11][t[14]],t[3]),isSquare:!1}}),{c(){pe(e.$$.fragment),n=F(),i=w("div"),r=oe("Page "),o=oe(s),v(i,"class","has-text-grey-dark mt-2")},m(a,c){de(e,a,c),j(a,n,c),j(a,i,c),y(i,r),y(i,o),l=!0},p(a,c){const u={};c&5&&(u.item=a[17]),c&9&&(u.borderColor=a[6](a[11][a[14]],a[3])),e.$set(u),(!l||c&1)&&s!==(s=a[11][a[14]].page+"")&&Ce(o,s)},i(a){l||(U(e.$$.fragment,a),l=!0)},o(a){K(e.$$.fragment,a),l=!1},d(a){me(e,a),a&&z(n),a&&z(i)}}}function ra(t){let e,n,i=t[11][t[14]]&&ia(cs(t));return{c(){e=w("td"),i&&i.c(),v(e,"class","has-text-centered"),De(e,"vertical-align","top")},m(r,s){j(r,e,s),i&&i.m(e,null),n=!0},p(r,s){r[11][r[14]]?i?(i.p(cs(r),s),s&1&&U(i,1)):(i=ia(cs(r)),i.c(),U(i,1),i.m(e,null)):i&&(Pe(),K(i,1,1,()=>{i=null}),Le())},i(r){n||(U(i),n=!0)},o(r){K(i),n=!1},d(r){r&&z(e),i&&i.d()}}}function sa(t){let e,n,i,r=t[0].regions,s=[];for(let l=0;l<r.length;l+=1)s[l]=ra(Zl(t,r,l));const o=l=>K(s[l],1,1,()=>{s[l]=null});return{c(){e=w("tr");for(let l=0;l<s.length;l+=1)s[l].c();n=F()},m(l,a){j(l,e,a);for(let c=0;c<s.length;c+=1)s[c]&&s[c].m(e,null);y(e,n),i=!0},p(l,a){if(a&77){r=l[0].regions;let c;for(c=0;c<r.length;c+=1){const u=Zl(l,r,c);s[c]?(s[c].p(u,a),U(s[c],1)):(s[c]=ra(u),s[c].c(),U(s[c],1),s[c].m(e,n))}for(Pe(),c=r.length;c<s.length;c+=1)o(c);Le()}},i(l){if(!i){for(let a=0;a<r.length;a+=1)U(s[a]);i=!0}},o(l){s=s.filter(Boolean);for(let a=0;a<s.length;a+=1)K(s[a]);i=!1},d(l){l&&z(e),dt(s,l)}}}function h_(t){let e,n,i=t[0]&&ta(t);return{c(){i&&i.c(),e=ct()},m(r,s){i&&i.m(r,s),j(r,e,s),n=!0},p(r,[s]){r[0]?i?(i.p(r,s),s&1&&U(i,1)):(i=ta(r),i.c(),U(i,1),i.m(e.parentNode,e)):i&&(Pe(),K(i,1,1,()=>{i=null}),Le())},i(r){n||(U(i),n=!0)},o(r){K(i),n=!1},d(r){i&&i.d(r),r&&z(e)}}}function d_(t){let e=0;for(let o=0;o<t.length;o++)e=t.charCodeAt(o)+((e<<5)-e),e=e&e;const i=e*.618033988749895%1*360,r=65+e%20,s=80+e%10;return`hsl(${Math.floor(i)}, ${r}%, ${s}%)`}function m_(t,e,n){let i,r,s,{selectedDocuments:o=[]}=e,{documentSetStore:l}=e;const{buildAlignedImageMatrix:a,documentNodes:c,imageNodes:u}=l;ye(t,c,m=>n(1,r=m)),ye(t,u,m=>n(2,s=m));let h=null;function f(m,p){if(!m)return;const g=m.id;if(p.get(g)!==1)return d.has(g)||d.set(g,d_(g)),d.get(g)}const d=new Map;return t.$$set=m=>{"selectedDocuments"in m&&n(7,o=m.selectedDocuments),"documentSetStore"in m&&n(8,l=m.documentSetStore)},t.$$.update=()=>{if(t.$$.dirty&134)if(o.length>0&&s&&r){const m=o.map(p=>p.id);n(0,h=a(m))}else n(0,h=null);t.$$.dirty&1&&n(3,i=h?(()=>{const m=new Map;return h.rows.forEach(p=>{Object.values(p).forEach(g=>{m.set(g.id,(m.get(g.id)||0)+1)})}),m})():new Map)},[h,r,s,i,c,u,f,o,l]}class p_ extends Me{constructor(e){super(),Ie(this,e,m_,h_,Ee,{selectedDocuments:7,documentSetStore:8})}}const Zy="";function oa(t,e,n){const i=t.slice();return i[15]=e[n],i}function g_(t){let e;return{c(){e=w("span"),e.innerHTML='<i class="fas fa-crop-alt"></i>',v(e,"class","icon px-4")},m(n,i){j(n,e,i)},d(n){n&&z(e)}}}function __(t){let e;return{c(){e=w("span"),e.innerHTML='<i class="fas fa-hand-pointer"></i>',v(e,"class","icon px-4")},m(n,i){j(n,e,i)},d(n){n&&z(e)}}}function la(t){let e,n,i,r;const s=[y_,v_],o=[];function l(a,c){return a[0]==="img"?0:a[0]==="doc"?1:-1}return~(e=l(t))&&(n=o[e]=s[e](t)),{c(){n&&n.c(),i=ct()},m(a,c){~e&&o[e].m(a,c),j(a,i,c),r=!0},p(a,c){let u=e;e=l(a),e===u?~e&&o[e].p(a,c):(n&&(Pe(),K(o[u],1,1,()=>{o[u]=null}),Le()),~e?(n=o[e],n?n.p(a,c):(n=o[e]=s[e](a),n.c()),U(n,1),n.m(i.parentNode,i)):n=null)},i(a){r||(U(n),r=!0)},o(a){K(n),r=!1},d(a){~e&&o[e].d(a),a&&z(i)}}}function v_(t){let e,n;return e=new p_({props:{selectedDocuments:t[5],documentSetStore:t[1]}}),{c(){pe(e.$$.fragment)},m(i,r){de(e,i,r),n=!0},p(i,r){const s={};r&32&&(s.selectedDocuments=i[5]),r&2&&(s.documentSetStore=i[1]),e.$set(s)},i(i){n||(U(e.$$.fragment,i),n=!0)},o(i){K(e.$$.fragment,i),n=!1},d(i){me(e,i)}}}function y_(t){let e,n,i=W==="en"?"Selected regions":"Régions sélectionnées",r,s,o=t[5].length+"",l,a,c,u,h=[],f=new Map,d,m=t[5];const p=g=>g[15].id;for(let g=0;g<m.length;g+=1){let _=oa(t,m,g),k=p(_);f.set(k,h[g]=aa(k,_))}return{c(){e=w("div"),n=w("h3"),r=oe(i),s=oe(" ("),l=oe(o),a=oe(")"),c=F(),u=w("div");for(let g=0;g<h.length;g+=1)h[g].c();v(n,"class","title is-5"),v(u,"class","selected-nodes grid is-gap-2 mt-5 svelte-1a3kdxu"),v(e,"class","selected-panel box mt-4 svelte-1a3kdxu")},m(g,_){j(g,e,_),y(e,n),y(n,r),y(n,s),y(n,l),y(n,a),y(e,c),y(e,u);for(let k=0;k<h.length;k+=1)h[k]&&h[k].m(u,null);d=!0},p(g,_){(!d||_&32)&&o!==(o=g[5].length+"")&&Ce(l,o),_&32&&(m=g[5],Pe(),h=Zn(h,_,p,1,g,m,f,u,vr,aa,null,oa),Le())},i(g){if(!d){for(let _=0;_<m.length;_+=1)U(h[_]);d=!0}},o(g){for(let _=0;_<h.length;_+=1)K(h[_]);d=!1},d(g){g&&z(e);for(let _=0;_<h.length;_+=1)h[_].d()}}}function aa(t,e){let n,i,r;return i=new Kn({props:{item:e[15],selectable:!1,copyable:!1}}),{key:t,first:null,c(){n=ct(),pe(i.$$.fragment),this.first=n},m(s,o){j(s,n,o),de(i,s,o),r=!0},p(s,o){e=s;const l={};o&32&&(l.item=e[15]),i.$set(l)},i(s){r||(U(i.$$.fragment,s),r=!0)},o(s){K(i.$$.fragment,s),r=!1},d(s){s&&z(n),me(i,s)}}}function b_(t){let e,n,i,r=t[3]?"click":"selection",s,o,l,a,c,u,h,f;function d(_,k){return _[3]?__:g_}let m=d(t),p=m(t),g=t[5].length>0&&la(t);return{c(){e=w("div"),n=w("button"),p.c(),i=oe(`
        Switch to `),s=oe(r),o=oe(" mode"),l=F(),a=w("div"),c=F(),g&&g.c(),v(n,"class","toggle-button button is-small is-link mb-3"),v(a,"class","visualization-container")},m(_,k){j(_,e,k),y(e,n),p.m(n,null),y(n,i),y(n,s),y(n,o),y(e,l),y(e,a),t[9](a),y(e,c),g&&g.m(e,null),u=!0,h||(f=be(n,"click",t[7]),h=!0)},p(_,[k]){m!==(m=d(_))&&(p.d(1),p=m(_),p&&(p.c(),p.m(n,i))),(!u||k&8)&&r!==(r=_[3]?"click":"selection")&&Ce(s,r),_[5].length>0?g?(g.p(_,k),k&32&&U(g,1)):(g=la(_),g.c(),U(g,1),g.m(e,null)):g&&(Pe(),K(g,1,1,()=>{g=null}),Le())},i(_){u||(U(g),u=!0)},o(_){K(g),u=!1},d(_){_&&z(e),p.d(),t[9](null),g&&g.d(),h=!1,f()}}}const w_=1e3;function S_(t,e,n){let i,r,s=ne,o=()=>(s(),s=yi(i,b=>n(8,r=b)),i),l;t.$$.on_destroy.push(()=>s());let{type:a="img"}=e,{documentSetStore:c}=e;const{imageNetwork:u,documentNetwork:h,selectedNodes:f,updateSelectedNodes:d}=c;ye(t,f,b=>n(5,l=b));let m,p,g=!1;function _(){m&&(m.destroy(),d([]));function b(T){d(T)}m=(r.nodes.length<w_?Jg:Ug)(p,r.nodes,r.links,b,T=>{n(3,g=T)}),n(3,g=a==="img"),g&&m.toggleSelectionMode()}function k(){m&&n(3,g=m.toggleSelectionMode())}Tn(()=>{m==null||m.destroy()});function E(b){gn[b?"unshift":"push"](()=>{p=b,n(2,p)})}return t.$$set=b=>{"type"in b&&n(0,a=b.type),"documentSetStore"in b&&n(1,c=b.documentSetStore)},t.$$.update=()=>{t.$$.dirty&1&&o(n(4,i=a==="img"?u:h)),t.$$.dirty&260&&r&&p&&_()},[a,c,p,g,i,l,f,k,r,E]}class k_ extends Me{constructor(e){super(),Ie(this,e,S_,b_,Ee,{type:0,documentSetStore:1})}}const eb="",{Map:ca}=Hc;function ua(t,e,n){const i=t.slice();return i[39]=e[n],i}function fa(t,e,n){const i=t.slice();return i[39]=e[n],i}function E_(t){let e,n,i,r,s,o,l,a,c,u,h,f,d,m,p,g,_,k=[],E=new ca,b,S,T=[],M=new ca,C,x,P,L,H,D,I,R,N,V,q,B,X=t[6].docs;const se=G=>G[39].id;for(let G=0;G<X.length;G+=1){let Z=fa(t,X,G),Q=se(Z);E.set(Q,k[G]=ha(Q,Z))}let le=t[6].docs;const fe=G=>G[39].id;for(let G=0;G<le.length;G+=1){let Z=ua(t,le,G),Q=fe(Z);M.set(Q,T[G]=da(Q,Z))}function te(G,Z){return G[2]?M_:I_}let he=te(t),Y=he(t);return{c(){e=w("div"),n=w("div"),i=w("div"),r=w("h4"),r.textContent=`${t[14]("title")}`,s=F(),o=w("div"),l=w("div"),a=w("div"),c=w("select"),u=w("option"),u.textContent=`${t[14]("byName")}`,h=w("option"),h.textContent=`${t[14]("byScore")}`,f=F(),d=w("div"),m=w("div"),p=w("div"),g=F(),_=w("div");for(let G=0;G<k.length;G+=1)k[G].c();b=F(),S=w("div");for(let G=0;G<T.length;G+=1)T[G].c();C=F(),x=w("div"),P=F(),L=w("div"),H=F(),D=w("div"),I=w("div"),R=w("h4"),R.textContent=`${t[14]("pageByPage")}`,N=F(),V=w("div"),Y.c(),v(r,"class","title is-6 mb-0"),u.__value="name",u.value=u.__value,h.__value="score",h.value=h.__value,t[3]===void 0&&Ut(()=>t[24].call(c)),v(a,"class","select is-small"),v(l,"class","control"),v(o,"class","field mb-0"),v(i,"class","is-flex is-justify-content-space-between is-align-items-center mb-3"),v(p,"class","matrix-corner svelte-1td2g2u"),v(_,"class","col-headers svelte-1td2g2u"),v(S,"class","row-headers svelte-1td2g2u"),v(x,"class","matrix-canvas svelte-1td2g2u"),v(m,"class","matrix-grid svelte-1td2g2u"),De(m,"--cell-size",ma+"px"),v(d,"class","matrix-scroll svelte-1td2g2u"),v(n,"class","box panel-box svelte-1td2g2u"),v(e,"class","split-panel svelte-1td2g2u"),De(e,"width",t[9]+"px"),v(L,"class","split-divider svelte-1td2g2u"),v(L,"role","separator"),v(L,"tabindex","0"),v(R,"class","title is-6 mb-3"),v(V,"class","scatter-scroll svelte-1td2g2u"),Ae(V,"overflow",t[5]),v(I,"class","box panel-box svelte-1td2g2u"),v(D,"class","split-panel svelte-1td2g2u"),De(D,"width",t[4]+"px")},m(G,Z){j(G,e,Z),y(e,n),y(n,i),y(i,r),y(i,s),y(i,o),y(o,l),y(l,a),y(a,c),y(c,u),y(c,h),Ls(c,t[3],!0),y(n,f),y(n,d),y(d,m),y(m,p),y(m,g),y(m,_);for(let Q=0;Q<k.length;Q+=1)k[Q]&&k[Q].m(_,null);y(m,b),y(m,S);for(let Q=0;Q<T.length;Q+=1)T[Q]&&T[Q].m(S,null);y(m,C),y(m,x),t[25](x),j(G,P,Z),j(G,L,Z),j(G,H,Z),j(G,D,Z),y(D,I),y(I,R),y(I,N),y(I,V),Y.m(V,null),q||(B=[be(c,"change",t[24]),be(L,"mousedown",t[15]),be(L,"touchstart",t[15])],q=!0)},p(G,Z){Z[0]&8&&Ls(c,G[3]),Z[0]&64&&(X=G[6].docs,k=Zn(k,Z,se,1,G,X,E,_,js,ha,null,fa)),Z[0]&64&&(le=G[6].docs,T=Zn(T,Z,fe,1,G,le,M,S,js,da,null,ua)),Z[0]&512&&De(e,"width",G[9]+"px"),he===(he=te(G))&&Y?Y.p(G,Z):(Y.d(1),Y=he(G),Y&&(Y.c(),Y.m(V,null))),Z[0]&32&&Ae(V,"overflow",G[5]),Z[0]&16&&De(D,"width",G[4]+"px")},d(G){G&&z(e);for(let Z=0;Z<k.length;Z+=1)k[Z].d();for(let Z=0;Z<T.length;Z+=1)T[Z].d();t[25](null),G&&z(P),G&&z(L),G&&z(H),G&&z(D),Y.d(),q=!1,st(B)}}}function C_(t){let e;return{c(){e=w("div"),e.textContent=`${t[14]("noDocuments")}`,v(e,"class","notification is-info"),De(e,"width","100%")},m(n,i){j(n,e,i)},p:ne,d(n){n&&z(e)}}}function ha(t,e){let n,i,r,s;return{key:t,first:null,c(){n=w("div"),i=w("span"),s=F(),v(i,"class","color-dot svelte-1td2g2u"),De(i,"background-color",e[39].color),v(i,"title",r=e[39].title),v(n,"class","header-cell svelte-1td2g2u"),this.first=n},m(o,l){j(o,n,l),y(n,i),y(n,s)},p(o,l){e=o,l[0]&64&&De(i,"background-color",e[39].color),l[0]&64&&r!==(r=e[39].title)&&v(i,"title",r)},d(o){o&&z(n)}}}function da(t,e){let n,i,r,s;return{key:t,first:null,c(){n=w("div"),i=w("span"),s=F(),v(i,"class","color-dot svelte-1td2g2u"),De(i,"background-color",e[39].color),v(i,"title",r=e[39].title),v(n,"class","header-cell svelte-1td2g2u"),this.first=n},m(o,l){j(o,n,l),y(n,i),y(n,s)},p(o,l){e=o,l[0]&64&&De(i,"background-color",e[39].color),l[0]&64&&r!==(r=e[39].title)&&v(i,"title",r)},d(o){o&&z(n)}}}function I_(t){let e;return{c(){e=w("p"),e.textContent=`${t[14]("selectCell")}`,v(e,"class","has-text-grey is-size-7")},m(n,i){j(n,e,i)},p:ne,d(n){n&&z(e)}}}function M_(t){let e;return{c(){e=w("div"),v(e,"class","scatter-container svelte-1td2g2u")},m(n,i){j(n,e,i),t[26](e)},p:ne,d(n){n&&z(e),t[26](null)}}}function x_(t){let e;function n(s,o){return s[7].length?E_:C_}let i=n(t),r=i(t);return{c(){e=w("div"),r.c(),v(e,"class","split-container svelte-1td2g2u")},m(s,o){j(s,e,o),r.m(e,null),t[27](e)},p(s,o){i===(i=n(s))&&r?r.p(s,o):(r.d(1),r=i(s),r&&(r.c(),r.m(e,null)))},i:ne,o:ne,d(s){s&&z(e),r.d(),t[27](null)}}}const or=300,ma=30;function A_(t,e,n){let i,r,s,o,l,a,c,u,h,f,{documentSetStore:d}=e;const{documentNodes:m,docPairStats:p,pairIndex:g,documentStats:_}=d;ye(t,m,Y=>n(23,f=Y)),ye(t,p,Y=>n(22,h=Y)),ye(t,g,Y=>n(29,c=Y)),ye(t,_,Y=>n(21,u=Y));const k={title:{en:"Document Matrix",fr:"Matrice de documents"},order:{en:"Order",fr:"Ordre"},byName:{en:"By name",fr:"Par nom"},byScore:{en:"By score",fr:"Par score"},noDocuments:{en:"No documents available",fr:"Aucun document disponible"},pageByPage:{en:"Page-by-page similarity",fr:"Similarité page par page"},page:{en:"page",fr:"page"},score:{en:"Score",fr:"Score"},noPairs:{en:"No pairs",fr:"Aucune paire"},selectCell:{en:"Click a cell to view page-by-page similarity",fr:"Cliquez sur une cellule pour voir la similarité page par page"}},E=Y=>{var G,Z;return((G=k[Y])==null?void 0:G[W])||((Z=k[Y])==null?void 0:Z.en)||Y};let b,S,T,M=null,C="name",x=.5,P=!1,L=0,H;function D(Y,G,Z,Q){var ce;if(!Y.length)return{docs:[],matrix:[],maxScore:0};Y.forEach((ae,Se)=>{var Ne;ae.index=Se,ae.count=((Ne=Z==null?void 0:Z.get(ae.id))==null?void 0:Ne.count)||0});const Te={name:Di(Y.length).sort((ae,Se)=>Y[ae].title.localeCompare(Y[Se].title)),score:Di(Y.length).sort((ae,Se)=>Y[Se].count-Y[ae].count)}[Q].map(ae=>Y[ae]),we=Te.length,Oe=[];let ze=0;for(let ae=0;ae<we;ae++){const Se=[];for(let Ne=0;Ne<we;Ne++)if(ae!==Ne){const Xe=Te[ae].id<Te[Ne].id?`${Te[ae].id}-${Te[Ne].id}`:`${Te[Ne].id}-${Te[ae].id}`,Qe=((ce=G==null?void 0:G.get(Xe))==null?void 0:ce.score)||0;Qe>ze&&(ze=Qe),Se.push({x:Ne,y:ae,z:Qe,doc1:Te[ae],doc2:Te[Ne]})}else Se.push({x:Ne,y:ae,z:0,diagonal:!0});Oe.push(Se)}return{docs:Te,matrix:Oe,maxScore:ze}}function I(Y){const{doc1:G,doc2:Z}=Y,Q=G.id<Z.id?`${G.id}-${Z.id}`:`${Z.id}-${G.id}`,$e=c.byDocPair.get(Q)||[];if(!$e.length)return null;const Te=new Map;let we=1/0,Oe=-1/0;return $e.forEach(ce=>{const[ae,Se,Ne]=ce.regions_id_1===G.id?[ce.page_1,ce.page_2,ce.weightedScore||0]:[ce.page_2,ce.page_1,ce.weightedScore||0],Xe=`${ae}-${Se}`;Te.has(Xe)||Te.set(Xe,{page1:ae,page2:Se,scores:[]}),Te.get(Xe).scores.push(Ne),Ne<we&&(we=Ne),Ne>Oe&&(Oe=Ne)}),{points:Array.from(Te.values()).map(({page1:ce,page2:ae,scores:Se})=>({page1:ce,page2:ae,score:Se.reduce((Ne,Xe)=>Ne+Xe,0)/Se.length,count:Se.length})),minScore:we,maxScore:Oe,doc1:G,doc2:Z}}function R(){if(!S||!r.docs.length)return;const{docs:Y,matrix:G,maxScore:Z}=r,Q=Y.length*ma;Ye(S).selectAll("*").remove();const $e=Ye(S).append("svg").attr("width",Q).attr("height",Q),Te=Ul().range([0,Q]).domain(Di(Y.length)).padding(.02),we=Ye("body").selectAll(".matrix-tooltip").data([0]).join("div").attr("class","matrix-tooltip").style("position","fixed").style("background","var(--bulma-scheme-main)").style("border","1px solid var(--bulma-border)").style("border-radius","4px").style("padding","8px").style("pointer-events","none").style("opacity",0).style("font-size","12px").style("box-shadow","0 2px 4px rgba(0,0,0,0.15)").style("z-index","9999").style("color","var(--bulma-text)");$e.selectAll(".row").data(G).join("g").attr("class","row").attr("transform",(ze,ce)=>`translate(0,${Te(ce)})`).each(function(ze){Ye(this).selectAll(".cell").data(ze.filter(ce=>!ce.diagonal)).join("rect").attr("class","cell").attr("x",ce=>Te(ce.x)).attr("width",Te.bandwidth()).attr("height",Te.bandwidth()).attr("fill",ce=>{if(ce.z===0)return"#666";const ae=jr(233,.951,.52);return ae.opacity=Z>0?.2+.8*(ce.z/Z):.2,ae}).attr("stroke",ce=>N(ce)?"var(--bulma-text)":"var(--bulma-scheme-main)").attr("stroke-width",ce=>N(ce)?2:.5).style("cursor","pointer").on("mouseover",function(ce,ae){N(ae)||Ye(this).attr("stroke","var(--bulma-text)").attr("stroke-width",2),we.style("opacity",1)}).on("mousemove",function(ce,ae){const Se=ae.z===0?`<span style="color:${ae.doc1.color}">●</span> ${ae.doc1.title}<br/>↔<br/><span style="color:${ae.doc2.color}">●</span> ${ae.doc2.title}<br/><br/><em>${E("noPairs")}</em>`:`<span style="color:${ae.doc1.color}">●</span> ${ae.doc1.title}<br/>↔<br/><span style="color:${ae.doc2.color}">●</span> ${ae.doc2.title}<br/><br/>${E("score")}: ${ae.z.toFixed(2)}`;we.html(Se).style("left",ce.clientX+15+"px").style("top",ce.clientY+15+"px")}).on("mouseleave",function(ce,ae){N(ae)||Ye(this).attr("stroke","var(--bulma-scheme-main)").attr("stroke-width",.5),we.style("opacity",0)}).on("click",(ce,ae)=>{n(2,M={row:ae.y,col:ae.x,doc1:ae.doc1,doc2:ae.doc2}),V()})}),$e.selectAll(".row").selectAll(".cell-diagonal").data(ze=>ze.filter(ce=>ce.diagonal)).join("rect").attr("class","cell-diagonal").attr("x",ze=>Te(ze.x)).attr("width",Te.bandwidth()).attr("height",Te.bandwidth()).attr("fill","var(--contrasted)")}function N(Y){return M&&M.doc1.id===Y.doc1.id&&M.doc2.id===Y.doc2.id}function V(){S&&Ye(S).selectAll(".cell").attr("stroke",Y=>N(Y)?"var(--bulma-text)":"var(--bulma-scheme-main)").attr("stroke-width",Y=>N(Y)?2:.5)}function q(Y){if(!T||!(s!=null&&s.points.length))return;Ye(T).selectAll("*").remove();const{points:G,minScore:Z,maxScore:Q,doc1:$e,doc2:Te}=s,we=Math.max(Y-140,200),Oe={top:20,right:40,bottom:65,left:80},ze=10,ce=Math.max(...G.map(_e=>_e.page1)),ae=Math.max(...G.map(_e=>_e.page2)),Se=Math.max(ce,ae),Ne=we,Xe=ce/Se*Ne,Qe=ae/Se*Ne,Gn=Xe+Oe.left+Oe.right,Ct=Qe+Oe.top+Oe.bottom,yt=Ye(T).append("svg").attr("width",Gn).attr("height",Ct).append("g").attr("transform",`translate(${Oe.left},${Oe.top})`),Ze=rs().domain([0,ce]).range([0,Xe]),Ht=rs().domain([0,ae]).range([Qe,0]),Je=Ye("body").selectAll(".heatmap-tooltip").data([0]).join("div").attr("class","heatmap-tooltip").style("position","fixed").style("background","var(--bulma-scheme-main)").style("border","1px solid var(--bulma-border)").style("border-radius","4px").style("padding","6px 10px").style("pointer-events","none").style("opacity",0).style("font-size","11px").style("box-shadow","0 2px 4px rgba(0,0,0,0.15)").style("z-index","9999").style("color","var(--bulma-text)"),mn=Math.min(50,Math.max(10,Math.floor(Xe/8))),nt=No().domain([0,ce]).thresholds(mn)(G.map(_e=>_e.page1)),it=No().domain([0,ae]).thresholds(mn)(G.map(_e=>_e.page2)),je=Math.max(...nt.map(_e=>_e.length)),Xn=Math.max(...it.map(_e=>_e.length)),Xt=yt.append("g").attr("transform",`translate(0,${Qe+22})`);nt.forEach(_e=>{if(_e.length===0)return;const qe=Ze(_e.x0),Rt=Ze(_e.x1);Xt.append("rect").attr("x",qe).attr("width",Rt-qe).attr("height",ze).attr("fill",$e.color).attr("opacity",.15+.85*(_e.length/je)).style("cursor","default").on("mouseover",()=>Je.style("opacity",1)).on("mousemove",ee=>{Je.html(`<strong>${_e.length}</strong> ${_e.length>1?"images":"image"}<br/>${E("page")}s ${Math.floor(_e.x0)}–${Math.floor(_e.x1)}`).style("left",ee.clientX+10+"px").style("top",ee.clientY-30+"px")}).on("mouseleave",()=>Je.style("opacity",0))});const bt=yt.append("g").attr("transform","translate(-55,0)");it.forEach(_e=>{if(_e.length===0)return;const qe=Ht(_e.x0),Rt=Ht(_e.x1);bt.append("rect").attr("x",0).attr("y",Math.min(qe,Rt)).attr("width",ze).attr("height",Math.abs(Rt-qe)).attr("fill",Te.color).attr("opacity",.15+.85*(_e.length/Xn)).style("cursor","default").on("mouseover",()=>Je.style("opacity",1)).on("mousemove",ee=>{Je.html(`<strong>${_e.length}</strong> ${_e.length>1?"images":"image"}<br/>${E("page")}s ${Math.floor(_e.x0)}–${Math.floor(_e.x1)}`).style("left",ee.clientX+10+"px").style("top",ee.clientY-30+"px")}).on("mouseleave",()=>Je.style("opacity",0))}),yt.append("g").attr("transform",`translate(0,${Qe})`).call(dh(Ze).ticks(Math.min(ce,10))),yt.append("g").call(mh(Ht).ticks(Math.min(ae,10)));const En=(_e,qe)=>{const Rt=Math.floor(qe/6);return _e.length>Rt?_e.slice(0,Rt-1)+"…":_e},It=yt.append("g").attr("transform",`translate(${Xe/2},${Qe+50})`);It.append("circle").attr("r",4).attr("cx",-Xe/2+4).attr("fill",$e.color),It.append("text").attr("x",-Xe/2+14).attr("text-anchor","start").attr("dominant-baseline","middle").attr("font-size","11px").attr("fill","var(--bulma-text)").text(En(`${$e.title} (${E("page")})`,Xe-20));const Cn=yt.append("g").attr("transform",`translate(-68,${Qe/2}) rotate(-90)`);Cn.append("circle").attr("r",4).attr("cx",-Qe/2+4).attr("fill",Te.color),Cn.append("text").attr("x",-Qe/2+14).attr("text-anchor","start").attr("dominant-baseline","middle").attr("font-size","11px").attr("fill","var(--bulma-text)").text(En(`${Te.title} (${E("page")})`,Qe-20)),yt.selectAll(".point").data(G).join("circle").attr("cx",_e=>Ze(_e.page1)).attr("cy",_e=>Ht(_e.page2)).attr("r",_e=>Math.max(3,Math.min(8,_e.count))).attr("fill",_e=>{const qe=jr(233,.951,.52);return qe.opacity=Q>Z?.3+.7*(_e.score-Z)/(Q-Z):.7,qe})}function B(Y){n(18,P=!0),Y.preventDefault()}function X(Y){var Q,$e;if(!P||!b)return;const G=b.getBoundingClientRect(),Z=(Y.clientX||(($e=(Q=Y.touches)==null?void 0:Q[0])==null?void 0:$e.clientX))-G.left;n(17,x=Math.max(.2,Math.min(.8,Z/G.width)))}function se(){P&&(n(18,P=!1),s&&!a&&q(l))}An(()=>{b&&(n(19,L=b.offsetWidth),H=new ResizeObserver(Y=>{const G=Y[0].contentRect.width;Math.abs(G-L)>10&&(n(19,L=G),s&&!a&&q(l))}),H.observe(b)),window.addEventListener("mousemove",X),window.addEventListener("mouseup",se),window.addEventListener("touchmove",X),window.addEventListener("touchend",se)}),Tn(()=>{H==null||H.disconnect(),window.removeEventListener("mousemove",X),window.removeEventListener("mouseup",se),window.removeEventListener("touchmove",X),window.removeEventListener("touchend",se)});function le(){C=Kc(this),n(3,C)}function fe(Y){gn[Y?"unshift":"push"](()=>{S=Y,n(0,S)})}function te(Y){gn[Y?"unshift":"push"](()=>{T=Y,n(1,T)})}function he(Y){gn[Y?"unshift":"push"](()=>{b=Y,n(8,b)})}return t.$$set=Y=>{"documentSetStore"in Y&&n(16,d=Y.documentSetStore)},t.$$.update=()=>{t.$$.dirty[0]&8388608&&n(7,i=Array.from((f==null?void 0:f.values())||[])),t.$$.dirty[0]&6291592&&n(6,r=D(i,h.scoreCount,u.scoreCount,C)),t.$$.dirty[0]&4&&n(20,s=M?I(M):null),t.$$.dirty[0]&655360&&n(9,o=Math.max(or,L*x-4)),t.$$.dirty[0]&655360&&n(4,l=Math.max(or,L*(1-x)-4)),t.$$.dirty[0]&16&&n(5,a=l<=or),t.$$.dirty[0]&65&&S&&r.docs.length&&R(),t.$$.dirty[0]&1310770&&T&&s&&l&&!P&&q(a?or:l)},[S,T,M,C,l,a,r,i,b,o,m,p,g,_,E,B,d,x,P,L,s,u,h,f,le,fe,te,he]}class T_ extends Me{constructor(e){super(),Ie(this,e,A_,x_,Ee,{documentSetStore:16},null,[-1,-1])}}const pa="https://vhs.huma-num.fr",N_=()=>new Worker("/static/js/pairWorker.js",{type:"module"});function O_(t){const e=xe(null),n=xe([]),i=xe(new Set),r=xe([]),s=xe(0),o=xe(3),l=xe(!1),a=xe("threshold"),c=xe([]),u=xe(new Map);let h;const f=xe({byImage:new Map,byDocPair:new Map,byDoc:new Map}),d=xe(new Map),m=xe(new Map),p=xe({}),g=xe({}),_=xe({}),k=xe({}),E=xe({documents:0,pairs:null,images:0,categories:{}}),b=tt(n,(R,N)=>{if(R.length===0){N(Promise.resolve(0));return}h&&h.terminate();const V=413,q=new Promise((B,X)=>{(async()=>{try{const le=await fetch(`${pa}/document-set/${V}/pairs?category=${R.join(",")}`);if(!le.ok)throw new Error(`HTTP ${le.status}`);const fe=await le.json();h=N_(),h.postMessage({rawPairs:fe,selectedCategories:R}),h.onmessage=async te=>{const{allPairs:he,imageNodes:Y,pairIndex:G,categories:Z,stats:Q}=te.data;f.set(G),p.set(Q.pairStats),g.set(Q.documentStats),_.set(Q.imageStats),k.set(Q.docPairStats);const $e=Array.from(Q.documentStats.scoreCount.keys());ot(i).size===0&&i.set(new Set($e));const we=await Promise.all($e.map(ce=>S(ce).then(ae=>({id:ce,info:ae})))),Oe=new Map;we.forEach(({id:ce,info:ae})=>Oe.set(ce,ae)),u.set(Oe);const ze=new Map;$e.forEach((ce,ae)=>{const Se=Oe.get(ce)||{};ze.set(ce,{id:ce,title:Se.title||`Region Extraction ${ce}`,color:Se.color||bu(ae),images:[],...Se})}),Y.forEach(ce=>{const ae=ze.get(ce.regionId);ae&&(ce.color=ae.color,ce.title=`${ae.title} | Page ${ce.canvas}`,ae.images.push(ce))}),ze.forEach(ce=>ce.images.sort((ae,Se)=>ae.canvas-Se.canvas)),d.set(Y),m.set(ze),E.set({documents:$e.length,pairs:he.length,images:Y.size,categories:Z}),c.set(he),h.terminate(),h=null,B(he.length)},h.onerror=te=>{console.error("Worker error",te);const he=`Error processing pairs: ${te.message}`;e.set(he),X(new Error(he))}}catch(le){const fe=`Fetch error: ${le.message}`;e.set(fe),X(new Error(fe))}})()});N(q)});async function S(R){try{const N=await fetch(`${pa}/search/regions/?id=${R}`);if(!N.ok)throw new Error(`HTTP ${N.status}`);const{results:V}=await N.json();if(!(V!=null&&V.length))return{title:`Region Extraction ${R}`};const q=V[0],[,...B]=q.title.split(" | "),[X,se]=(q.ref||"_").split("_");return{title:B.join(" | "),ref:q.ref,witnessId:br(X),digitizationRef:se,zeros:q.zeros,img_nb:q.img_nb,url:q.url}}catch(N){return e.set(`Error fetching region #${R}: ${N.message}`),{title:`Region Extraction ${R}`}}}const T=tt([c,s,o,l,i],([R,N,V,q,B])=>{if(!R)return[];const X=[],se=ot(a);for(let le=0;le<R.length;le++){const fe=R[le];if(se==="threshold"&&fe.weightedScore<N)break;if(!(!B.has(fe.regions_id_1)||!B.has(fe.regions_id_2))){if(se==="topk"&&V!==null){const te=fe.rank_1??1/0,he=fe.rank_2??1/0;if(q){if(te>V||he>V)continue}else if(te>V&&he>V)continue}X.push(fe)}}return X}),M=tt([T,m],([R,N])=>{if(!R.length||N.size===0)return[];const V=new Set;for(const B of R)V.add(B.regions_id_1),V.add(B.regions_id_2);const q=[];return V.forEach(B=>{const X=N.get(B);X&&q.push(X)}),q.sort((B,X)=>X.id-B.id)});function C(R,N,V=10,q=200,B=2,X=25){if(!N)return{strength:.5,distance:100,width:2};const{min:se,_:le,range:fe}=N,te=fe===0?.5:(R-se)/fe,he=q-te*(q-V),Y=B+te*(X-B);return{strength:te,distance:he,width:Y}}function x(R,N,V=10,q=60){if(!N)return V;const{min:B,_:X,range:se}=N;return se===0?(V+q)/2:V+(R-B)/se*(q-V)}const P=tt([T],([R])=>{var le;const N=ot(d),V=ot(_),q=ot(p),B=new Set,X=[];for(const fe of R){const{strength:te,distance:he,width:Y}=C(fe.weightedScore,q.scoreRange);X.push({source:fe.id_1,target:fe.id_2,strength:te,distance:he,width:Y}),B.has(fe.id_1)||B.add(fe.id_1),B.has(fe.id_2)||B.add(fe.id_2)}const se=[];for(const fe of B){const te=N.get(fe);if(te){const he=(le=V.scoreCount)==null?void 0:le.get(fe),{count:Y,score:G}=he;se.push({...te,radius:x(G,V.scoreRange),label:`Region: ${te.regionId}
Page: ${te.canvas}
Connections: ${Y}
Total score: ${G.toFixed(2)}`})}}return{nodes:se,links:X}}),L=tt(M,R=>{const N=ot(k),V=ot(g);if(R.size===0)return{nodes:[],links:[]};const q=Array.from(R.values()).map(X=>{var te;const se=(te=V.scoreCount)==null?void 0:te.get(X.id),{count:le,score:fe}=se;return{...X,radius:x(le,V.countRange),label:`${X.title}
Images: ${le}
Total score: ${fe.toFixed(2)}`}}),B=Array.from(N.scoreCount.entries()).map(([X,se])=>{const[le,fe]=X.split("-").map(Number),{strength:te,distance:he,width:Y}=C(se.score,N.scoreRange);return{source:le,target:fe,strength:te,distance:he,width:Y}});return{nodes:q,links:B}});function H(R){if(!R.length)return{regions:[],rows:[]};const N=ot(m),V=ot(f),q=R[0],B=N.get(q);if(!(B!=null&&B.images))return{regions:R,rows:[]};const X=B.images,se=(he,Y,G)=>{const{r1:Z,r2:Q}={r1:Y,r2:G},$e=Z<Q?`${Z}-${Q}`:`${Q}-${Z}`;return(V.byDocPair.get($e)||[]).map(we=>we.id_1===he&&we.regions_id_1===Y?{id:we.id_2,page:we.page_2}:we.id_2===he&&we.regions_id_2===Y?{id:we.id_1,page:we.page_1}:null).filter(Boolean)},le=[];for(const he of X){let Y=[{[q]:{id:he.id,page:he.canvas}}];for(let G=1;G<R.length;G++){const Z=R[G],Q=[];for(const $e of Y){const Te=[];for(let we=0;we<G;we++){const Oe=R[we];if($e[Oe]){const ze=se($e[Oe].id,Oe,Z);Te.push(...ze)}}if(Te.length===0)Q.push($e);else{const we=new Map;Te.forEach(Oe=>{we.has(Oe.id)||we.set(Oe.id,Oe)});for(const Oe of we.values()){const ze={...$e,[Z]:Oe};Q.push(ze)}}}Y=Q}le.push(...Y)}const fe=[],te=new Set;for(const he of le){const Y=R.map(G=>{var Z;return((Z=he[G])==null?void 0:Z.id)||""}).join("|");te.has(Y)||(te.add(Y),fe.push(he))}return{regions:R,rows:fe}}function D(R){n.update(N=>N.indexOf(R)>-1?N.filter(q=>q!==R):[...N,R].sort((q,B)=>q-B))}function I(R){i.update(N=>{const V=new Set(N);return V.has(R)?V.delete(R):V.add(R),V})}return{error:e,allPairs:c,visiblePairs:T,pairIndex:f,documentNodes:m,imageNodes:d,fetchPairs:b,imageNetwork:P,documentNetwork:L,selectedCategories:n,pairStats:p,documentStats:g,imageStats:_,docPairStats:k,docSetNumber:E,selectedNodes:r,selectedRegions:i,updateSelectedNodes:R=>r.set(R),toggleCategory:D,toggleRegion:I,buildAlignedImageMatrix:H,threshold:s,setThreshold:R=>s.set(R),topK:o,setTopK:R=>o.set(R),mutualTopK:l,setMutualTopK:R=>l.set(R),scoreMode:a,setScoreMode:R=>a.set(R)}}function ga(t){let e,n,i,r,s,o=(t[0].clusters||0)+"",l;return{c(){e=w("div"),n=w("div"),i=w("p"),i.textContent="Clusters",r=F(),s=w("p"),l=oe(o),v(i,"class","heading"),v(s,"class","title is-5"),v(e,"class","level-item")},m(a,c){j(a,e,c),y(e,n),y(n,i),y(n,r),y(n,s),y(s,l)},p(a,c){c&1&&o!==(o=(a[0].clusters||0)+"")&&Ce(l,o)},d(a){a&&z(e)}}}function P_(t){var L,H,D;let e,n,i,r,s,o,l=(t[0].count||0)+"",a,c,u,h,f,d,m,p=(t[0].links||0)+"",g,_,k,E,b,S,T,M,C=(((H=(L=t[0])==null?void 0:L.density)==null?void 0:H.toFixed(3))||0)+"",x,P=((D=t[0])==null?void 0:D.clusters)&&ga(t);return{c(){e=w("div"),n=w("div"),i=w("div"),r=w("p"),r.textContent=`${W==="en"?"Nodes":"Nœuds"}`,s=F(),o=w("p"),a=oe(l),c=F(),u=w("div"),h=w("div"),f=w("p"),f.textContent=`${W==="en"?"Edges":"Liens"}`,d=F(),m=w("p"),g=oe(p),_=F(),P&&P.c(),k=F(),E=w("div"),b=w("div"),S=w("p"),S.textContent=`${W==="en"?"Density":"Densité"}`,T=F(),M=w("p"),x=oe(C),v(r,"class","heading"),v(o,"class","title is-5"),v(n,"class","level-item"),v(f,"class","heading"),v(m,"class","title is-5"),v(u,"class","level-item"),v(S,"class","heading"),v(M,"class","title is-5"),v(E,"class","level-item"),v(e,"class","level has-text-centered")},m(I,R){j(I,e,R),y(e,n),y(n,i),y(i,r),y(i,s),y(i,o),y(o,a),y(e,c),y(e,u),y(u,h),y(h,f),y(h,d),y(h,m),y(m,g),y(e,_),P&&P.m(e,null),y(e,k),y(e,E),y(E,b),y(b,S),y(b,T),y(b,M),y(M,x)},p(I,[R]){var N,V,q;R&1&&l!==(l=(I[0].count||0)+"")&&Ce(a,l),R&1&&p!==(p=(I[0].links||0)+"")&&Ce(g,p),(N=I[0])!=null&&N.clusters?P?P.p(I,R):(P=ga(I),P.c(),P.m(e,k)):P&&(P.d(1),P=null),R&1&&C!==(C=(((q=(V=I[0])==null?void 0:V.density)==null?void 0:q.toFixed(3))||0)+"")&&Ce(x,C)},i:ne,o:ne,d(I){I&&z(e),P&&P.d()}}}function L_(t,e,n){let i,r,s,o,{activeTab:l="img"}=e,{documentSetStore:a}=e;const{imageStats:c,documentStats:u,docPairStats:h}=a;return ye(t,c,f=>n(8,o=f)),ye(t,u,f=>n(7,s=f)),ye(t,h,f=>n(6,r=f)),t.$$set=f=>{"activeTab"in f&&n(4,l=f.activeTab),"documentSetStore"in f&&n(5,a=f.documentSetStore)},t.$$.update=()=>{t.$$.dirty&464&&n(0,i=l==="img"?o:l==="doc"?s:r)},[i,c,u,h,l,a,r,s,o]}class R_ extends Me{constructor(e){super(),Ie(this,e,L_,P_,Ee,{activeTab:4,documentSetStore:5})}}function D_(t){let e,n,i;const r=t[1].default,s=Nt(r,t,t[0],null);return{c(){e=w("table"),n=w("tbody"),s&&s.c(),v(e,"class","table is-fullwidth")},m(o,l){j(o,e,l),y(e,n),s&&s.m(n,null),i=!0},p(o,[l]){s&&s.p&&(!i||l&1)&&Pt(s,r,o,o[0],i?Ot(r,o[0],l,null):Lt(o[0]),null)},i(o){i||(U(s,o),i=!0)},o(o){K(s,o),i=!1},d(o){o&&z(e),s&&s.d(o)}}}function $_(t,e,n){let{$$slots:i={},$$scope:r}=e;return t.$$set=s=>{"$$scope"in s&&n(0,r=s.$$scope)},[r,i]}class z_ extends Me{constructor(e){super(),Ie(this,e,$_,D_,Ee,{})}}const j_=t=>({}),_a=t=>({}),F_=t=>({}),va=t=>({}),V_=t=>({}),ya=t=>({});function H_(t){let e;const n=t[4]["row-body"],i=Nt(n,t,t[3],_a);return{c(){i&&i.c()},m(r,s){i&&i.m(r,s),e=!0},p(r,s){i&&i.p&&(!e||s&8)&&Pt(i,n,r,r[3],e?Ot(n,r[3],s,j_):Lt(r[3]),_a)},i(r){e||(U(i,r),e=!0)},o(r){K(i,r),e=!1},d(r){i&&i.d(r)}}}function U_(t){let e,n,i,r;const s=t[4]["row-body"],o=Nt(s,t,t[3],va);return{c(){e=w("div"),n=w("div"),o&&o.c(),v(n,"class","grid is-gap-2"),v(e,"class",i="fixed-grid has-"+t[2]+"-cols")},m(l,a){j(l,e,a),y(e,n),o&&o.m(n,null),r=!0},p(l,a){o&&o.p&&(!r||a&8)&&Pt(o,s,l,l[3],r?Ot(s,l[3],a,F_):Lt(l[3]),va),(!r||a&4&&i!==(i="fixed-grid has-"+l[2]+"-cols"))&&v(e,"class",i)},i(l){r||(U(o,l),r=!0)},o(l){K(o,l),r=!1},d(l){l&&z(e),o&&o.d(l)}}}function B_(t){let e,n,i,r,s,o,l,a,c,u;Ut(t[5]);const h=t[4]["row-header"],f=Nt(h,t,t[3],ya),d=[U_,H_],m=[];function p(g,_){return g[0]?0:1}return o=p(t),l=m[o]=d[o](t),{c(){e=w("tr"),n=w("th"),i=w("div"),f&&f.c(),r=F(),s=w("td"),l.c(),v(i,"class","content-wrapper py-5"),v(n,"class","is-3 center-flex is-narrow"),De(n,"width","15vw"),v(s,"class","p-5 is-fullwidth")},m(g,_){j(g,e,_),y(e,n),y(n,i),f&&f.m(i,null),y(e,r),y(e,s),m[o].m(s,null),a=!0,c||(u=be(window,"resize",t[5]),c=!0)},p(g,[_]){f&&f.p&&(!a||_&8)&&Pt(f,h,g,g[3],a?Ot(h,g[3],_,V_):Lt(g[3]),ya);let k=o;o=p(g),o===k?m[o].p(g,_):(Pe(),K(m[k],1,1,()=>{m[k]=null}),Le(),l=m[o],l?l.p(g,_):(l=m[o]=d[o](g),l.c()),U(l,1),l.m(s,null))},i(g){a||(U(f,g),U(l),a=!0)},o(g){K(f,g),K(l),a=!1},d(g){g&&z(e),f&&f.d(g),m[o].d(),c=!1,u()}}}function q_(t,e,n){let i,{$$slots:r={},$$scope:s}=e,{useGrid:o=!0}=e,l=0;function a(){n(1,l=window.innerWidth)}return t.$$set=c=>{"useGrid"in c&&n(0,o=c.useGrid),"$$scope"in c&&n(3,s=c.$$scope)},t.$$.update=()=>{t.$$.dirty&2&&n(2,i=Us(l))},[o,l,i,s,r,a]}class ba extends Me{constructor(e){super(),Ie(this,e,q_,B_,Ee,{useGrid:0})}}const tb="",K_=t=>({}),wa=t=>({}),W_=t=>({}),Sa=t=>({});function ka(t){let e,n,i,r,s,o,l,a,c,u,h,f=t[1]&&Ea(t);return a=new Pi({props:{tooltipText:t[2][t[1]][W]}}),{c(){f&&f.c(),e=F(),n=w("div"),i=w("button"),r=Dt("svg"),s=Dt("path"),l=F(),pe(a.$$.fragment),v(s,"fill","none"),v(s,"stroke","currentColor"),v(s,"stroke-linecap","round"),v(s,"stroke-linejoin","round"),v(s,"stroke-width","1.5"),v(s,"d","M12 3v18m0 0l8.5-8.5M12 21l-8.5-8.5"),v(r,"style",o=`transform: rotate(${t[1]?"180":"0"}deg)`),v(r,"xmlns","http://www.w3.org/2000/svg"),v(r,"width","24"),v(r,"height","24"),v(r,"viewBox","0 0 24 24"),v(r,"class","svelte-jbs1sd"),v(i,"class","button is-link svelte-jbs1sd"),v(n,"class","ctrl-toggle svelte-jbs1sd")},m(d,m){f&&f.m(d,m),j(d,e,m),j(d,n,m),y(n,i),y(i,r),y(r,s),y(i,l),de(a,i,null),c=!0,u||(h=be(i,"click",Jt(t[3])),u=!0)},p(d,m){d[1]?f?(f.p(d,m),m&2&&U(f,1)):(f=Ea(d),f.c(),U(f,1),f.m(e.parentNode,e)):f&&(Pe(),K(f,1,1,()=>{f=null}),Le()),(!c||m&2&&o!==(o=`transform: rotate(${d[1]?"180":"0"}deg)`))&&v(r,"style",o);const p={};m&2&&(p.tooltipText=d[2][d[1]][W]),a.$set(p)},i(d){c||(U(f),U(a.$$.fragment,d),c=!0)},o(d){K(f),K(a.$$.fragment,d),c=!1},d(d){f&&f.d(d),d&&z(e),d&&z(n),me(a),u=!1,h()}}}function Ea(t){let e,n,i;const r=t[5]["toolbar-hidden"],s=Nt(r,t,t[4],wa);return{c(){e=w("div"),s&&s.c(),v(e,"class","ctrl-extra")},m(o,l){j(o,e,l),s&&s.m(e,null),i=!0},p(o,l){s&&s.p&&(!i||l&16)&&Pt(s,r,o,o[4],i?Ot(r,o[4],l,K_):Lt(o[4]),wa)},i(o){i||(U(s,o),Ut(()=>{i&&(n||(n=ln(e,Ks,{axis:"y"},!0)),n.run(1))}),i=!0)},o(o){K(s,o),n||(n=ln(e,Ks,{axis:"y"},!1)),n.run(0),i=!1},d(o){o&&z(e),s&&s.d(o),o&&n&&n.end()}}}function Y_(t){let e,n,i,r,s,o,l,a;const c=t[5]["toolbar-visible"],u=Nt(c,t,t[4],Sa);let h=t[0]&&ka(t);return{c(){e=w("div"),n=w("form"),i=w("div"),r=w("div"),s=w("div"),u&&u.c(),o=F(),h&&h.c(),v(s,"class","ctrl-block svelte-jbs1sd"),v(r,"class","ctrl-block-wrapper svelte-jbs1sd"),v(i,"class","ctrl-base"),v(n,"class","ctrl svelte-jbs1sd"),v(e,"id","toolbar"),v(e,"class",l="ctrl-wrapper is-flex is-justify-content-center is-align-items-center "+(t[1]?"toolbar-expanded":"toolbar-collapsed")+" svelte-jbs1sd")},m(f,d){j(f,e,d),y(e,n),y(n,i),y(i,r),y(r,s),u&&u.m(s,null),y(n,o),h&&h.m(n,null),a=!0},p(f,[d]){u&&u.p&&(!a||d&16)&&Pt(u,c,f,f[4],a?Ot(c,f[4],d,W_):Lt(f[4]),Sa),f[0]?h?(h.p(f,d),d&1&&U(h,1)):(h=ka(f),h.c(),U(h,1),h.m(n,null)):h&&(Pe(),K(h,1,1,()=>{h=null}),Le()),(!a||d&2&&l!==(l="ctrl-wrapper is-flex is-justify-content-center is-align-items-center "+(f[1]?"toolbar-expanded":"toolbar-collapsed")+" svelte-jbs1sd"))&&v(e,"class",l)},i(f){a||(U(u,f),U(h),a=!0)},o(f){K(u,f),K(h),a=!1},d(f){f&&z(e),u&&u.d(f),h&&h.d()}}}function G_(t,e,n){let i,{$$slots:r={},$$scope:s}=e,{expandable:o=!0}=e;const l={true:{en:"Collapse the toolbar",fr:"Refermer le menu"},false:{en:"Expand the toolbar",fr:"Ouvrir le menu"}},a=()=>n(1,i=!i);return t.$$set=c=>{"expandable"in c&&n(0,o=c.expandable),"$$scope"in c&&n(4,s=c.$$scope)},n(1,i=!1),[o,i,l,a,s,r]}class X_ extends Me{constructor(e){super(),Ie(this,e,G_,Y_,Ee,{expandable:0})}}function Ca(t){let e,n,i,r,s,o,l,a,c,u=t[5]>1&&Ia(t),h=t[5]<t[3]&&Aa(t);return{c(){e=w("nav"),n=w("ul"),u&&u.c(),i=F(),r=w("li"),s=w("a"),o=oe(t[5]),l=F(),h&&h.c(),v(s,"class","pagination-link is-current"),v(s,"href",null),v(n,"class","pagination-list ml-0"),v(e,"class","pagination is-centered mb-2"),v(e,"aria-label","pagination")},m(f,d){j(f,e,d),y(e,n),u&&u.m(n,null),y(n,i),y(n,r),y(r,s),y(s,o),y(n,l),h&&h.m(n,null),a||(c=be(s,"click",Jt(t[9])),a=!0)},p(f,d){f[5]>1?u?u.p(f,d):(u=Ia(f),u.c(),u.m(n,i)):u&&(u.d(1),u=null),d&32&&Ce(o,f[5]),f[5]<f[3]?h?h.p(f,d):(h=Aa(f),h.c(),h.m(n,null)):h&&(h.d(1),h=null)},d(f){f&&z(e),u&&u.d(),h&&h.d(),a=!1,c()}}}function Ia(t){let e,n,i,r,s,o,l=t[5]-1>1&&Ma(t);return{c(){e=w("li"),n=w("a"),n.textContent="1",i=F(),l&&l.c(),r=ct(),v(n,"class","pagination-link"),v(n,"href",null)},m(a,c){j(a,e,c),y(e,n),j(a,i,c),l&&l.m(a,c),j(a,r,c),s||(o=be(n,"click",Jt(t[7])),s=!0)},p(a,c){a[5]-1>1?l?l.p(a,c):(l=Ma(a),l.c(),l.m(r.parentNode,r)):l&&(l.d(1),l=null)},d(a){a&&z(e),a&&z(i),l&&l.d(a),a&&z(r),s=!1,o()}}}function Ma(t){let e,n,i,r=t[5]-1+"",s,o,l,a=t[5]-1>2&&xa();return{c(){a&&a.c(),e=F(),n=w("li"),i=w("a"),s=oe(r),v(i,"class","pagination-link"),v(i,"href",null)},m(c,u){a&&a.m(c,u),j(c,e,u),j(c,n,u),y(n,i),y(i,s),o||(l=be(i,"click",Jt(t[8])),o=!0)},p(c,u){c[5]-1>2?a||(a=xa(),a.c(),a.m(e.parentNode,e)):a&&(a.d(1),a=null),u&32&&r!==(r=c[5]-1+"")&&Ce(s,r)},d(c){a&&a.d(c),c&&z(e),c&&z(n),o=!1,l()}}}function xa(t){let e;return{c(){e=w("li"),e.innerHTML='<span class="pagination-ellipsis">…</span>'},m(n,i){j(n,e,i)},d(n){n&&z(e)}}}function Aa(t){let e,n,i,r,s,o,l=t[5]+1<t[3]&&Ta(t);return{c(){l&&l.c(),e=F(),n=w("li"),i=w("a"),r=oe(t[3]),v(i,"class","pagination-link"),v(i,"href",null)},m(a,c){l&&l.m(a,c),j(a,e,c),j(a,n,c),y(n,i),y(i,r),s||(o=be(i,"click",Jt(t[11])),s=!0)},p(a,c){a[5]+1<a[3]?l?l.p(a,c):(l=Ta(a),l.c(),l.m(e.parentNode,e)):l&&(l.d(1),l=null),c&8&&Ce(r,a[3])},d(a){l&&l.d(a),a&&z(e),a&&z(n),s=!1,o()}}}function Ta(t){let e,n,i=t[5]+1+"",r,s,o,l,a,c=t[5]+2<t[3]&&Na();return{c(){e=w("li"),n=w("a"),r=oe(i),s=F(),c&&c.c(),o=ct(),v(n,"class","pagination-link"),v(n,"href",null)},m(u,h){j(u,e,h),y(e,n),y(n,r),j(u,s,h),c&&c.m(u,h),j(u,o,h),l||(a=be(n,"click",Jt(t[10])),l=!0)},p(u,h){h&32&&i!==(i=u[5]+1+"")&&Ce(r,i),u[5]+2<u[3]?c||(c=Na(),c.c(),c.m(o.parentNode,o)):c&&(c.d(1),c=null)},d(u){u&&z(e),u&&z(s),c&&c.d(u),u&&z(o),l=!1,a()}}}function Na(t){let e;return{c(){e=w("li"),e.innerHTML='<span class="pagination-ellipsis">…</span>'},m(n,i){j(n,e,i)},d(n){n&&z(e)}}}function J_(t){let e,n,i=t[5]*t[2]-t[2]+1+"",r,s,o=Math.min(t[5]*t[2],t[1])+"",l,a,c,u,h=t[4]&&Ca(t);return{c(){h&&h.c(),e=F(),n=w("div"),r=oe(i),s=oe(" - "),l=oe(o),a=oe(" / "),c=oe(t[1]),v(n,"class",u="is-size-7 is-center mb-4 "+(t[4]?"":"mt-4"))},m(f,d){h&&h.m(f,d),j(f,e,d),j(f,n,d),y(n,r),y(n,s),y(n,l),y(n,a),y(n,c)},p(f,[d]){f[4]?h?h.p(f,d):(h=Ca(f),h.c(),h.m(e.parentNode,e)):h&&(h.d(1),h=null),d&36&&i!==(i=f[5]*f[2]-f[2]+1+"")&&Ce(r,i),d&38&&o!==(o=Math.min(f[5]*f[2],f[1])+"")&&Ce(l,o),d&2&&Ce(c,f[1]),d&16&&u!==(u="is-size-7 is-center mb-4 "+(f[4]?"":"mt-4"))&&v(n,"class",u)},i:ne,o:ne,d(f){h&&h.d(f),f&&z(e),f&&z(n)}}}function Q_(t,e,n){let i,r,s,{store:o}=e;const{currentPage:l}=o;ye(t,l,p=>n(5,s=p));let{nbOfItems:a}=e,{pageLength:c=cu}=e;const u=()=>o.handlePageUpdate(1),h=()=>o.handlePageUpdate(s-1),f=()=>o.handlePageUpdate(s),d=()=>o.handlePageUpdate(s+1),m=()=>o.handlePageUpdate(i);return t.$$set=p=>{"store"in p&&n(0,o=p.store),"nbOfItems"in p&&n(1,a=p.nbOfItems),"pageLength"in p&&n(2,c=p.pageLength)},t.$$.update=()=>{t.$$.dirty&6&&n(3,i=c>0?Math.ceil(a/c):1),t.$$.dirty&14&&n(4,r=i>1||a>c)},[o,a,c,i,r,s,l,u,h,f,d,m]}class Oa extends Me{constructor(e){super(),Ie(this,e,Q_,J_,Ee,{store:0,nbOfItems:1,pageLength:2})}}function Z_(t){let e,n,i,r,s=W==="en"?"Save selection":"Sauvegarder la sélection",o,l,a;return{c(){e=w("button"),n=w("span"),i=w("i"),r=F(),o=oe(s),v(i,"class","fa-solid fa-floppy-disk"),v(e,"class","button is-link")},m(c,u){j(c,e,u),y(e,n),y(n,i),y(n,r),y(n,o),l||(a=be(e,"click",t[7]),l=!0)},p:ne,d(c){c&&z(e),l=!1,a()}}}function e0(t){let e,n,i,r,s=W==="en"?"Go to treatment":"Accéder au traitement",o,l;return{c(){var a;e=w("a"),n=w("span"),i=w("i"),r=F(),o=oe(s),v(i,"class","fa-solid fa-gear"),v(e,"class","button is-link"),v(e,"href",l="/"+$t+"/treatment/add/?document_set="+((a=t[3])==null?void 0:a.id))},m(a,c){j(a,e,c),y(e,n),y(n,i),y(n,r),y(n,o)},p(a,c){var u;c&8&&l!==(l="/"+$t+"/treatment/add/?document_set="+((u=a[3])==null?void 0:u.id))&&v(e,"href",l)},d(a){a&&z(e)}}}function Pa(t){let e,n,i,r,s,o,l;return{c(){var a,c;e=w("a"),n=w("span"),n.innerHTML='<i class="fa-solid fa-file-export"></i> JSON',r=F(),s=w("a"),o=w("span"),o.innerHTML='<i class="fa-solid fa-file-zipper"></i> ZIP',v(e,"class","button is-link is-dark"),v(e,"href",i="/"+$t+"/document-set/"+((a=t[3])==null?void 0:a.id)+"/json"),v(e,"target","_blank"),v(s,"class","button is-link is-dark"),v(s,"href",l="/"+$t+"/document-set/"+((c=t[3])==null?void 0:c.id)+"/zip"),v(s,"target","_blank")},m(a,c){j(a,e,c),y(e,n),j(a,r,c),j(a,s,c),y(s,o)},p(a,c){var u,h;c&8&&i!==(i="/"+$t+"/document-set/"+((u=a[3])==null?void 0:u.id)+"/json")&&v(e,"href",i),c&8&&l!==(l="/"+$t+"/document-set/"+((h=a[3])==null?void 0:h.id)+"/zip")&&v(s,"href",l)},d(a){a&&z(e),a&&z(r),a&&z(s)}}}function t0(t){let e,n,i,r,s,o,l;function a(f,d){return f[2]&&!f[1]?e0:Z_}let c=a(t),u=c(t),h=!t[1]&&Pa(t);return{c(){e=w("footer"),n=w("div"),i=w("button"),i.textContent=`${W==="en"?"Clear selection":"Vider la sélection"}`,r=F(),u.c(),s=F(),h&&h.c(),v(i,"class","button button-close is-link is-light"),v(n,"class","buttons"),v(e,"class","modal-card-foot is-center")},m(f,d){j(f,e,d),y(e,n),y(n,i),y(n,r),u.m(n,null),y(n,s),h&&h.m(n,null),o||(l=be(i,"click",t[6]),o=!0)},p(f,[d]){c===(c=a(f))&&u?u.p(f,d):(u.d(1),u=c(f),u&&(u.c(),u.m(n,s))),f[1]?h&&(h.d(1),h=null):h?h.p(f,d):(h=Pa(f),h.c(),h.m(n,null))},i:ne,o:ne,d(f){f&&z(e),u.d(),h&&h.d(),o=!1,l()}}}function n0(t,e,n){let i,r,{selectionStore:s}=e;const{isSaved:o,selection:l}=s;ye(t,o,h=>n(2,i=h)),ye(t,l,h=>n(3,r=h));let{isRegion:a=s.type!=="documentSet"}=e;const c=()=>s.empty(),u=()=>s.save();return t.$$set=h=>{"selectionStore"in h&&n(0,s=h.selectionStore),"isRegion"in h&&n(1,a=h.isRegion)},[s,a,i,r,o,l,c,u]}class i0 extends Me{constructor(e){super(),Ie(this,e,n0,t0,Ee,{selectionStore:0,isRegion:1})}}const nb="";function r0(t){let e,n,i,r,s,o;return{c(){e=w("span"),n=oe(t[5]),i=F(),r=w("span"),r.innerHTML='<i class="fas fa-edit"></i>',v(r,"class","pl-3 smaller has-text-link")},m(l,a){j(l,e,a),y(e,n),y(e,i),y(e,r),s||(o=[be(e,"click",t[7]),be(e,"keyup",null)],s=!0)},p(l,a){a&32&&Ce(n,l[5])},d(l){l&&z(e),s=!1,st(o)}}}function s0(t){let e,n,i;return{c(){e=w("input"),v(e,"class","input selection-title svelte-sgypdx")},m(r,s){j(r,e,s),t[12](e),Si(e,t[4]),n||(i=[be(e,"input",t[13]),be(e,"keydown",t[8]),be(e,"blur",t[9])],n=!0)},p(r,s){s&16&&e.value!==r[4]&&Si(e,r[4])},d(r){r&&z(e),t[12](null),n=!1,st(i)}}}function o0(t){let e,n,i,r,s,o,l,a,c,u,h,f,d,m,p,g,_,k,E,b;function S(P,L){return P[2]?s0:r0}let T=S(t),M=T(t);const C=t[11].default,x=Nt(C,t,t[10],null);return _=new i0({props:{selectionStore:t[0]}}),{c(){e=w("div"),n=w("div"),i=F(),r=w("div"),s=w("div"),o=w("div"),l=w("i"),a=F(),M.c(),c=oe(`
                (`),u=oe(t[1]),h=oe(")"),f=F(),d=w("button"),m=F(),p=w("section"),x&&x.c(),g=F(),pe(_.$$.fragment),v(n,"class","modal-background"),v(l,"class","fa-solid fa-book-bookmark"),v(o,"class","title is-4 mb-0 media-content"),v(d,"class","delete media-left"),v(d,"aria-label","close"),v(s,"class","modal-card-head media mb-0 is-middle"),v(p,"class","modal-card-body"),v(r,"class","modal-content"),v(e,"id","selection-modal"),v(e,"class","modal fade"),v(e,"tabindex","-1"),v(e,"aria-labelledby","selection-modal-label"),v(e,"aria-hidden","true")},m(P,L){j(P,e,L),y(e,n),y(e,i),y(e,r),y(r,s),y(s,o),y(o,l),y(o,a),M.m(o,null),y(o,c),y(o,u),y(o,h),y(s,f),y(s,d),y(r,m),y(r,p),x&&x.m(p,null),y(r,g),de(_,r,null),k=!0,E||(b=wi(Bs.call(null,e)),E=!0)},p(P,[L]){T===(T=S(P))&&M?M.p(P,L):(M.d(1),M=T(P),M&&(M.c(),M.m(o,c))),(!k||L&2)&&Ce(u,P[1]),x&&x.p&&(!k||L&1024)&&Pt(x,C,P,P[10],k?Ot(C,P[10],L,null):Lt(P[10]),null);const H={};L&1&&(H.selectionStore=P[0]),_.$set(H)},i(P){k||(U(x,P),U(_.$$.fragment,P),k=!0)},o(P){K(x,P),K(_.$$.fragment,P),k=!1},d(P){P&&z(e),M.d(),x&&x.d(P),me(_),E=!1,b()}}}function l0(t,e,n){let i,{$$slots:r={},$$scope:s}=e,{selectionStore:o}=e;const{selectionTitle:l,updateTitle:a,save:c}=o;ye(t,l,E=>n(5,i=E));let{selectionLength:u=!1}=e,h=!1,f,d;function m(){n(2,h=!0),n(4,d=i),setTimeout(()=>f&&f.focus(),0)}function p(E){E.key==="Enter"&&g()}function g(){n(2,h=!1),a(d),c()}function _(E){gn[E?"unshift":"push"](()=>{f=E,n(3,f)})}function k(){d=this.value,n(4,d)}return t.$$set=E=>{"selectionStore"in E&&n(0,o=E.selectionStore),"selectionLength"in E&&n(1,u=E.selectionLength),"$$scope"in E&&n(10,s=E.$$scope)},[o,u,h,f,d,i,l,m,p,g,s,r,_,k]}class a0 extends Me{constructor(e){super(),Ie(this,e,l0,o0,Ee,{selectionStore:0,selectionLength:1})}}const ib="";function c0(t){let e,n,i,r,s,o=W==="en"?"Selection":"Sélection",l,a,c,u,h,f;return{c(){e=w("div"),n=w("button"),i=w("span"),r=w("i"),s=F(),l=oe(o),a=oe(`
            (`),c=oe(t[0]),u=oe(")"),v(r,"class","fa-solid fa-book-bookmark"),v(i,"id","btn-content"),v(n,"id","set-btn"),v(n,"class","button px-5 py-4 is-link svelte-gmt9z5"),v(n,"data-target","selection-modal"),v(e,"class","set-container svelte-gmt9z5")},m(d,m){j(d,e,m),y(e,n),y(n,i),y(i,r),y(i,s),y(i,l),y(i,a),y(i,c),y(i,u),h||(f=wi(qs.call(null,n)),h=!0)},p(d,[m]){m&1&&Ce(c,d[0])},i:ne,o:ne,d(d){d&&z(e),h=!1,f()}}}function u0(t,e,n){let{selectionLength:i=0}=e,r=i;return t.$$set=s=>{"selectionLength"in s&&n(0,i=s.selectionLength)},t.$$.update=()=>{if(t.$$.dirty&3&&i!==r){const s=i>r;n(1,r=i);const o=document.getElementById("btn-content");o&&o.animate([{transform:s?"translateY(-7px)":"translateX(-5px)"},{transform:s?"translateY(7px)":"translateX(5px)"},{transform:"translate(0)"}],{duration:300,easing:"cubic-bezier(0.65, 0, 0.35, 1)"})}},[i,r]}class f0 extends Me{constructor(e){super(),Ie(this,e,u0,c0,Ee,{selectionLength:0})}}const rb="";function La(t,e,n){const i=t.slice();return i[7]=e[n][0],i[8]=e[n][1],i}function h0(t){let e;return{c(){e=w("div"),e.textContent=`${W==="en"?"No regions in selection":"Aucune région sélectionnée"}`},m(n,i){j(n,e,i)},p:ne,d(n){n&&z(e)}}}function d0(t){let e,n,i=Object.entries(t[2]),r=[];for(let s=0;s<i.length;s+=1)r[s]=Ra(La(t,i,s));return{c(){e=w("div"),n=w("div");for(let s=0;s<r.length;s+=1)r[s].c();v(n,"class","grid is-gap-2"),v(e,"class","fixed-grid has-6-cols")},m(s,o){j(s,e,o),y(e,n);for(let l=0;l<r.length;l+=1)r[l]&&r[l].m(n,null)},p(s,o){if(o&13){i=Object.entries(s[2]);let l;for(l=0;l<i.length;l+=1){const a=La(s,i,l);r[l]?r[l].p(a,o):(r[l]=Ra(a),r[l].c(),r[l].m(n,null))}for(;l<r.length;l+=1)r[l].d(1);r.length=i.length}},d(s){s&&z(e),dt(r,s)}}}function Ra(t){let e,n,i,r,s,o,l,a=t[8].title+"",c,u,h,f,d,m;function p(){return t[6](t[7])}return{c(){e=w("div"),n=w("figure"),i=w("img"),s=F(),o=w("div"),l=w("span"),c=oe(a),u=F(),h=w("button"),f=F(),Mt(i.src,r=Bt(t[8].img,t[8].xywh,"96,"))||v(i,"src",r),v(i,"alt","Extracted region"),v(l,"class","overlay-desc"),v(o,"class","overlay is-center svelte-g8ij5d"),v(n,"class","image is-64x64 card"),v(h,"class","delete region-btn svelte-g8ij5d"),v(h,"aria-label","remove from selection"),v(e,"class","selection cell svelte-g8ij5d")},m(g,_){j(g,e,_),y(e,n),y(n,i),y(n,s),y(n,o),y(o,l),y(l,c),y(e,u),y(e,h),y(e,f),d||(m=be(h,"click",p),d=!0)},p(g,_){t=g,_&4&&!Mt(i.src,r=Bt(t[8].img,t[8].xywh,"96,"))&&v(i,"src",r),_&4&&a!==(a=t[8].title+"")&&Ce(c,a)},d(g){g&&z(e),d=!1,m()}}}function m0(t){let e;function n(s,o){return s[4]?d0:h0}let i=n(t),r=i(t);return{c(){r.c(),e=ct()},m(s,o){r.m(s,o),j(s,e,o)},p(s,o){i===(i=n(s))&&r?r.p(s,o):(r.d(1),r=i(s),r&&(r.c(),r.m(e.parentNode,e)))},d(s){r.d(s),s&&z(e)}}}function p0(t){let e,n,i,r;return e=new f0({props:{selectionLength:t[1]}}),i=new a0({props:{selectionLength:t[1],selectionStore:t[0],$$slots:{default:[m0]},$$scope:{ctx:t}}}),{c(){pe(e.$$.fragment),n=F(),pe(i.$$.fragment)},m(s,o){de(e,s,o),j(s,n,o),de(i,s,o),r=!0},p(s,[o]){const l={};o&2&&(l.selectionLength=s[1]),e.$set(l);const a={};o&2&&(a.selectionLength=s[1]),o&1&&(a.selectionStore=s[0]),o&2077&&(a.$$scope={dirty:o,ctx:s}),i.$set(a)},i(s){r||(U(e.$$.fragment,s),U(i.$$.fragment,s),r=!0)},o(s){K(e.$$.fragment,s),K(i.$$.fragment,s),r=!1},d(s){me(e,s),s&&z(n),me(i,s)}}}function g0(t,e,n){let i,r,s,o,{selectionStore:l}=e;const{selected:a}=l;ye(t,a,u=>n(3,o=u));const c=u=>l.remove(u,Object.keys(o)[0]);return t.$$set=u=>{"selectionStore"in u&&n(0,l=u.selectionStore)},t.$$.update=()=>{t.$$.dirty&8&&n(2,i=Object.values(o)[0]||{}),t.$$.dirty&4&&n(1,r=Object.keys(i).length),t.$$.dirty&2&&n(4,s=r>0)},[l,r,i,o,s,a,c]}class _0 extends Me{constructor(e){super(),Ie(this,e,g0,p0,Ee,{selectionStore:0})}}const sb="";function Da(t,e,n){const i=t.slice();return i[17]=e[n],i}function $a(t,e,n){const i=t.slice();return i[20]=e[n],i}function za(t,e,n){const i=t.slice();return i[23]=e[n],i}function ja(t){let e,n,i,r,s,o=t[23].title+"",l,a,c,u=t[23].shortcut+"",h,f,d,m;return{c(){e=w("p"),n=w("button"),i=w("span"),r=w("i"),s=F(),l=oe(o),a=F(),c=w("span"),h=oe(u),f=F(),v(r,"class","fas "+t[23].icon+" svelte-7vjt6f"),v(i,"class","icon is-small"),v(c,"class","shortcut svelte-7vjt6f"),v(n,"class","button pl-5"),v(n,"title",t[23].desc),v(e,"class","control")},m(p,g){j(p,e,g),y(e,n),y(n,i),y(i,r),y(n,s),y(n,l),y(n,a),y(n,c),y(c,h),y(e,f),d||(m=be(n,"click",Jt(t[23].fct)),d=!0)},p(p,g){t=p},d(p){p&&z(e),d=!1,m()}}}function v0(t){let e,n,i,r,s,o,l,a=Object.values(t[10]),c=[];for(let u=0;u<a.length;u+=1)c[u]=ja(za(t,a,u));return{c(){e=w("div"),n=w("div"),i=w("div"),r=w("span"),r.textContent=`${W==="en"?"Process selection":"Agir sur la sélection"}`,s=F(),o=w("div"),l=w("div");for(let u=0;u<c.length;u+=1)c[u].c();v(r,"class","tag is-medium is-link mr-5"),v(i,"class","column is-narrow mr-5"),v(l,"class","field has-addons"),v(o,"class","column"),v(n,"class","columns is-vcentered is-mobile py-4"),v(e,"slot","toolbar-visible")},m(u,h){j(u,e,h),y(e,n),y(n,i),y(i,r),y(n,s),y(n,o),y(o,l);for(let f=0;f<c.length;f+=1)c[f]&&c[f].m(l,null)},p(u,h){if(h&1024){a=Object.values(u[10]);let f;for(f=0;f<a.length;f+=1){const d=za(u,a,f);c[f]?c[f].p(d,h):(c[f]=ja(d),c[f].c(),c[f].m(l,null))}for(;f<c.length;f+=1)c[f].d(1);c.length=a.length}},d(u){u&&z(e),dt(c,u)}}}function y0(t){let e,n=t[9].title+"",i;return{c(){e=w("span"),i=oe(n),v(e,"class","button is-small is-success"),v(e,"title",t[9].desc)},m(r,s){j(r,e,s),y(e,i)},p:ne,d(r){r&&z(e)}}}function b0(t){let e,n=t[8].title+"",i,r,s;function o(){return t[12](t[17])}return{c(){e=w("button"),i=oe(n),v(e,"class","button is-small is-warning"),v(e,"title",t[8].desc)},m(l,a){j(l,e,a),y(e,i),r||(s=be(e,"click",o),r=!0)},p(l,a){t=l},d(l){l&&z(e),r=!1,s()}}}function w0(t){let e,n,i=t[17].size+"",r,s,o,l,a,c;function u(d,m){return d[17].fullyConnected?y0:b0}let h=u(t),f=h(t);return{c(){e=w("div"),n=w("span"),r=oe(i),s=oe(" images"),o=F(),l=w("hr"),a=F(),f.c(),c=F(),v(n,"class","cluster-size"),v(e,"class","cluster-info is-center is-fullwidth")},m(d,m){j(d,e,m),y(e,n),y(n,r),y(n,s),y(e,o),y(e,l),y(e,a),f.m(e,null),j(d,c,m)},p(d,m){m&4&&i!==(i=d[17].size+"")&&Ce(r,i),h===(h=u(d))&&f?f.p(d,m):(f.d(1),f=h(d),f&&(f.c(),f.m(e,null)))},d(d){d&&z(e),f.d(),d&&z(c)}}}function Fa(t){let e,n;return e=new Kn({props:{item:{...t[3].get(t[20]),clusterId:t[17].id},copyable:!1,selectionStore:sr}}),{c(){pe(e.$$.fragment)},m(i,r){de(e,i,r),n=!0},p(i,r){const s={};r&12&&(s.item={...i[3].get(i[20]),clusterId:i[17].id}),e.$set(s)},i(i){n||(U(e.$$.fragment,i),n=!0)},o(i){K(e.$$.fragment,i),n=!1},d(i){me(e,i)}}}function S0(t){let e,n,i=t[17].members,r=[];for(let o=0;o<i.length;o+=1)r[o]=Fa($a(t,i,o));const s=o=>K(r[o],1,1,()=>{r[o]=null});return{c(){for(let o=0;o<r.length;o+=1)r[o].c();e=F()},m(o,l){for(let a=0;a<r.length;a+=1)r[a]&&r[a].m(o,l);j(o,e,l),n=!0},p(o,l){if(l&12){i=o[17].members;let a;for(a=0;a<i.length;a+=1){const c=$a(o,i,a);r[a]?(r[a].p(c,l),U(r[a],1)):(r[a]=Fa(c),r[a].c(),U(r[a],1),r[a].m(e.parentNode,e))}for(Pe(),a=i.length;a<r.length;a+=1)s(a);Le()}},i(o){if(!n){for(let l=0;l<i.length;l+=1)U(r[l]);n=!0}},o(o){r=r.filter(Boolean);for(let l=0;l<r.length;l+=1)K(r[l]);n=!1},d(o){dt(r,o),o&&z(e)}}}function Va(t,e){let n,i,r;return i=new ba({props:{$$slots:{"row-body":[S0],"row-header":[w0]},$$scope:{ctx:e}}}),{key:t,first:null,c(){n=ct(),pe(i.$$.fragment),this.first=n},m(s,o){j(s,n,o),de(i,s,o),r=!0},p(s,o){e=s;const l={};o&67108876&&(l.$$scope={dirty:o,ctx:e}),i.$set(l)},i(s){r||(U(i.$$.fragment,s),r=!0)},o(s){K(i.$$.fragment,s),r=!1},d(s){s&&z(n),me(i,s)}}}function k0(t){let e=[],n=new Map,i,r,s=t[2];const o=l=>l[17].id;for(let l=0;l<s.length;l+=1){let a=Da(t,s,l),c=o(a);n.set(c,e[l]=Va(c,a))}return{c(){for(let l=0;l<e.length;l+=1)e[l].c();i=ct()},m(l,a){for(let c=0;c<e.length;c+=1)e[c]&&e[c].m(l,a);j(l,i,a),r=!0},p(l,a){a&780&&(s=l[2],Pe(),e=Zn(e,a,o,1,l,s,n,i.parentNode,vr,Va,i,Da),Le())},i(l){if(!r){for(let a=0;a<s.length;a+=1)U(e[a]);r=!0}},o(l){for(let a=0;a<e.length;a+=1)K(e[a]);r=!1},d(l){for(let a=0;a<e.length;a+=1)e[a].d(l);l&&z(i)}}}function E0(t){let e,n,i,r,s,o,l,a,c,u;return e=new X_({props:{expandable:!1,$$slots:{"toolbar-visible":[v0]},$$scope:{ctx:t}}}),i=new Oa({props:{store:t[0],nbOfItems:t[1],pageLength:t[7]}}),s=new _0({props:{selectionStore:sr}}),l=new z_({props:{$$slots:{default:[k0]},$$scope:{ctx:t}}}),c=new Oa({props:{store:t[0],nbOfItems:t[1],pageLength:t[7]}}),{c(){pe(e.$$.fragment),n=F(),pe(i.$$.fragment),r=F(),pe(s.$$.fragment),o=F(),pe(l.$$.fragment),a=F(),pe(c.$$.fragment)},m(h,f){de(e,h,f),j(h,n,f),de(i,h,f),j(h,r,f),de(s,h,f),j(h,o,f),de(l,h,f),j(h,a,f),de(c,h,f),u=!0},p(h,[f]){const d={};f&67108864&&(d.$$scope={dirty:f,ctx:h}),e.$set(d);const m={};f&1&&(m.store=h[0]),f&2&&(m.nbOfItems=h[1]),i.$set(m);const p={};f&67108876&&(p.$$scope={dirty:f,ctx:h}),l.$set(p);const g={};f&1&&(g.store=h[0]),f&2&&(g.nbOfItems=h[1]),c.$set(g)},i(h){u||(U(e.$$.fragment,h),U(i.$$.fragment,h),U(s.$$.fragment,h),U(l.$$.fragment,h),U(c.$$.fragment,h),u=!0)},o(h){K(e.$$.fragment,h),K(i.$$.fragment,h),K(s.$$.fragment,h),K(l.$$.fragment,h),K(c.$$.fragment,h),u=!1},d(h){me(e,h),h&&z(n),me(i,h),h&&z(r),me(s,h),h&&z(o),me(l,h),h&&z(a),me(c,h)}}}function C0(t,e,n){let i,r,s,{documentSetStore:o}=e;const{imageNodes:l}=o;ye(t,l,b=>n(3,s=b));let{clusterStore:a}=e;const{clusterNb:c,paginatedClusters:u,pageLength:h,validateCluster:f,newCluster:d,removeFromClusters:m}=a;ye(t,c,b=>n(1,i=b)),ye(t,u,b=>n(2,r=b));const p={create:{title:W==="en"?"New cluster":"Nouveau cluster",desc:W==="en"?"Create a new validated cluster from the selected regions":"Créer un nouveau cluster valide à partir des régions sélectionnées",icon:"fa-object-group",shortcut:"Shift + C",fct:d},remove:{title:W==="en"?"Remove from cluster":"Retirer du cluster",desc:W==="en"?"Remove the selected regions from their cluster":"Retirer les régions sélectionnées de leur cluster",icon:"fa-chain-broken",shortcut:"Shift + D",fct:m},validate:{title:W==="en"?"Validate cluster":"Valider le cluster",desc:W==="en"?"Set as exact match all the pairs of regions in the cluster":"Définir comme correspondance exacte toutes les paires de régions dans le cluster",icon:"fa-check",fct:f},validated:{title:W==="en"?"Validated cluster":"Cluster valide",desc:W==="en"?"All pairs of regions have be categorized as exact matches":"Toutes les paires de régions ont été catégorisées comme des correspondances exactes",icon:"fa-check"}},{validate:g,validated:_,...k}=p,E=b=>g.fct(b);return t.$$set=b=>{"documentSetStore"in b&&n(11,o=b.documentSetStore),"clusterStore"in b&&n(0,a=b.clusterStore)},[a,i,r,s,l,c,u,h,g,_,k,o,E]}class I0 extends Me{constructor(e){super(),Ie(this,e,C0,E0,Ee,{documentSetStore:11,clusterStore:0})}}function M0(t,e){const i=xe(1),{visiblePairs:r,imageNodes:s}=t;wr(i,"p");function o(b){Sr(b,i,"p")}function l(b){if(b.length===0)return[];const S=new Map,T=P=>S.has(P)?(S.get(P)!==P&&S.set(P,T(S.get(P))),S.get(P)):(S.set(P,P),P),M=(P,L)=>{const H=T(P),D=T(L);H!==D&&S.set(D,H)},C=new Set;b.forEach(P=>{M(P.id_1,P.id_2),C.add(P.id_1),C.add(P.id_2)});const x=new Map;return C.forEach(P=>{const L=T(P);x.has(L)||x.set(L,[]),x.get(L).push(P)}),Array.from(x.values()).map(P=>{const L=P.length,H=L*(L-1)/2,D=new Set(P),I=b.filter(R=>D.has(R.id_1)&&D.has(R.id_2)).length;return{id:crypto.randomUUID(),members:P,size:L,fullyConnected:I===H}}).filter(P=>P.size>1).sort((P,L)=>L.size-P.size)}const a=tt(r,b=>b.length?l(b):[]),c=xe([]);a.subscribe(b=>{c.set(b)});const u=tt([c,i],([b,S])=>{const T=(S-1)*10,M=T+10;return b.slice(T,M)}),h=(b,S)=>{const T=ot(s).get(b),M=ot(s).get(S);return{img_1:b,img_2:S,regions_id_1:T==null?void 0:T.regionId,regions_id_2:M==null?void 0:M.regionId}},f=(b,S)=>(c.update(T=>T.map(M=>{if(!S[M.id])return M;const C=M.members.filter(x=>!b.has(x));return{...M,members:C,size:C.length}}).filter(M=>M.size>0)),!0),d=async b=>{const S=Array.isArray(b)?b:Object.keys(b),T=new Set(S),M={};ot(c).forEach(x=>{const P=x.members.filter(L=>T.has(L));P.length>0&&(M[x.id]=P)});const C=Object.entries(M).flatMap(([x,P])=>{const L=ot(c).find(D=>D.id===x);if(!L)return[];const H=L.members.filter(D=>!T.has(D));return P.flatMap(D=>H.map(I=>h(D,I)))});if(C.length===0)return f(T,M),!0;try{const x=await Vs(()=>fetch(`${window.location.origin}/${$t}/uncategorize-pair-batch`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":an},body:JSON.stringify({pairs:C})}));return x.ok?(f(T,M),!0):(console.log(x),await wt(W==="en"?"Batch un-categorization failed":"La dé-catégorisation par lot a échoué",W==="en"?"Error":"Erreur"),!1)}catch(x){return await wt(x,W==="en"?"Error":"Erreur"),!1}},m=async b=>{const S=b.flatMap((T,M)=>b.slice(M+1).map(C=>h(T,C)));try{const T=await Vs(()=>fetch(`${window.location.origin}/${$t}/exact-match-batch`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":an},body:JSON.stringify({pairs:S})}));return T.ok?!0:(console.log(T),await wt(W==="en"?"Batch validation failed":"La validation par lot a échoué",W==="en"?"Error":"Erreur"),!1)}catch(T){return await wt(T,W==="en"?"Error":"Erreur"),console.error("Error:",T),!1}},p=async b=>{const S=await m(b.members);return S&&c.update(T=>T.map(M=>M.id===b.id?{...M,fullyConnected:!0}:M)),S},g=async b=>{if(b.length<2)return!1;const S=await m(b);return S&&c.update(T=>[{id:crypto.randomUUID(),members:b,size:b.length,fullyConnected:!0},...T].sort((C,x)=>x.size-C.size)),S},_=()=>Object.values(ot(e).selected)[0]||{},k=async()=>{if(!await wt(W==="en"?"Do you want to create a cluster out of these images?":"Voulez-vous créer un cluster à partir de ces images ?",W==="en"?"Confirm creation":"Confirmer la création",!0))return;const S=_(),T=Object.keys(S);return T.length<2?(await wt(W==="en"?"Cluster creation requires at least 2 images":"La création d'un nouveau cluster nécessite a minima 2 images",W==="en"?"Impossible creation":"Création impossible"),!1):!await d(T)||!await g(T)?!1:(e.empty(),!0)},E=async()=>{if(!await wt(W==="en"?"Do you want to remove these images from their clusters?":"Voulez-vous supprimer ces images de leurs clusters ?",W==="en"?"Confirm deletion":"Confirmer la suppression",!0))return;const S=_();return await d(Object.keys(S))?(e.empty(),!0):!1};return{imageClusters:a,interfaceClusters:c,clusterNb:tt(c,b=>b.length),validateCluster:p,removeFromClusters:E,newCluster:k,paginatedClusters:u,handlePageUpdate:o,pageLength:10,currentPage:i}}function Ha(t,e,n){const i=t.slice();return i[25]=e[n],i}function x0(t){let e,n,i;return{c(){e=w("p"),e.textContent=`La matrice de documents visualise les scores de similarité globaux entre tous les documents du
                        corpus.
                        Cliquez sur une cellule pour voir les détails des similarités entre pages.`,n=F(),i=w("ul"),i.innerHTML=`<li>Matrice : Scores normalisés entre documents (0-100).</li>
                        <li>Scatter plot : Similarités détaillées par page.</li>`},m(r,s){j(r,e,s),j(r,n,s),j(r,i,s)},d(r){r&&z(e),r&&z(n),r&&z(i)}}}function A0(t){let e,n,i;return{c(){e=w("p"),e.textContent=`The Documents Network illustrates the connections between different witnesses in the document
                        set.
                        Each node represents a witness, and edges denote relationships based on shared content or other
                        relevant factors.`,n=F(),i=w("ul"),i.innerHTML=`<li>Nodes: Witnesses in the document set.</li>
                        <li>Edges: Relationships based on shared content.</li>`},m(r,s){j(r,e,s),j(r,n,s),j(r,i,s)},d(r){r&&z(e),r&&z(n),r&&z(i)}}}function T0(t){let e,n,i;return{c(){e=w("p"),e.textContent=`The Regions Network visualizes the relationships between image regions across different witnesses
                        in the document set.
                        Each node represents an image region, and edges indicate similarity or connections based on
                        predefined criteria.`,n=F(),i=w("ul"),i.innerHTML=`<li>Nodes: Image regions from various witnesses.</li>
                        <li>Edges: Similarity links between regions.</li>`},m(r,s){j(r,e,s),j(r,n,s),j(r,i,s)},d(r){r&&z(e),r&&z(n),r&&z(i)}}}function N0(t){let e,n,i,r;function s(a,c){return a[23]==="img"?T0:a[23]==="doc"?A0:x0}let o=s(t),l=o(t);return i=new R_({props:{activeTab:t[23],documentSetStore:t[4]}}),{c(){e=w("div"),l.c(),n=F(),pe(i.$$.fragment),v(e,"slot","datavizInfo")},m(a,c){j(a,e,c),l.m(e,null),y(e,n),de(i,e,null),r=!0},p(a,c){o!==(o=s(a))&&(l.d(1),l=o(a),l&&(l.c(),l.m(e,n)));const u={};c&8388608&&(u.activeTab=a[23]),i.$set(u)},i(a){r||(U(i.$$.fragment,a),r=!0)},o(a){K(i.$$.fragment,a),r=!1},d(a){a&&z(e),l.d(),me(i)}}}function O0(t){let e,n,i;return n=new Uf({props:{docSet:t[0],documentSetStore:t[4],clusterStore:t[8],$$slots:{datavizInfo:[N0]},$$scope:{ctx:t}}}),{c(){e=w("div"),pe(n.$$.fragment),v(e,"slot","sidebar")},m(r,s){j(r,e,s),de(n,e,null),i=!0},p(r,s){const o={};s&1&&(o.docSet=r[0]),s&276824064&&(o.$$scope={dirty:s,ctx:r}),n.$set(o)},i(r){i||(U(n.$$.fragment,r),i=!0)},o(r){K(n.$$.fragment,r),i=!1},d(r){r&&z(e),me(n)}}}function Ua(t){let e,n,i,r,s,o,l,a=t[25].title+"",c,u;return{c(){e=w("div"),n=w("figure"),i=w("img"),s=F(),o=w("div"),l=w("span"),c=oe(a),u=F(),Mt(i.src,r=Bt(t[25].img,t[25].xywh,"96,"))||v(i,"src",r),v(i,"alt","Extracted region"),v(l,"class","overlay-desc"),v(o,"class","overlay is-center"),v(n,"class","image is-64x64 card"),v(e,"class","selection cell")},m(h,f){j(h,e,f),y(e,n),y(n,i),y(n,s),y(n,o),y(o,l),y(l,c),y(e,u)},p(h,f){f&2&&!Mt(i.src,r=Bt(h[25].img,h[25].xywh,"96,"))&&v(i,"src",r),f&2&&a!==(a=h[25].title+"")&&Ce(c,a)},d(h){h&&z(e)}}}function P0(t){let e,n,i=Object.values(Object.values(t[1])[0]||{}),r=[];for(let s=0;s<i.length;s+=1)r[s]=Ua(Ha(t,i,s));return{c(){e=w("div"),n=w("div");for(let s=0;s<r.length;s+=1)r[s].c();v(n,"class","grid is-gap-2"),v(e,"slot","content"),v(e,"class","fixed-grid has-6-cols")},m(s,o){j(s,e,o),y(e,n);for(let l=0;l<r.length;l+=1)r[l]&&r[l].m(n,null)},p(s,o){if(o&2){i=Object.values(Object.values(s[1])[0]||{});let l;for(l=0;l<i.length;l+=1){const a=Ha(s,i,l);r[l]?r[l].p(a,o):(r[l]=Ua(a),r[l].c(),r[l].m(n,null))}for(;l<r.length;l+=1)r[l].d(1);r.length=i.length}},d(s){s&&z(e),dt(r,s)}}}function L0(t){let e,n,i,r={ctx:t,current:null,token:null,hasCatch:!1,pending:U0,then:$0,catch:D0,value:24,blocks:[,,,]};return _r(n=t[3],r),{c(){e=ct(),r.block.c()},m(s,o){j(s,e,o),r.block.m(s,r.anchor=o),r.mount=()=>e.parentNode,r.anchor=e,i=!0},p(s,o){t=s,r.ctx=t,o&8&&n!==(n=t[3])&&_r(n,r)||zs(r,t,o)},i(s){i||(U(r.block),i=!0)},o(s){for(let o=0;o<3;o+=1){const l=r.blocks[o];K(l)}i=!1},d(s){s&&z(e),r.block.d(s),r.token=null,r=null}}}function R0(t){let e,n,i;return{c(){e=w("article"),n=w("div"),i=oe(t[2]),v(n,"class","message-body"),v(e,"class","message is-danger")},m(r,s){j(r,e,s),y(e,n),y(n,i)},p(r,s){s&4&&Ce(i,r[2])},i:ne,o:ne,d(r){r&&z(e)}}}function D0(t){return{c:ne,m:ne,p:ne,i:ne,o:ne,d:ne}}function $0(t){let e,n,i,r;const s=[j0,z0],o=[];function l(a,c){return a[24]===0?0:1}return e=l(t),n=o[e]=s[e](t),{c(){n.c(),i=ct()},m(a,c){o[e].m(a,c),j(a,i,c),r=!0},p(a,c){let u=e;e=l(a),e===u?o[e].p(a,c):(Pe(),K(o[u],1,1,()=>{o[u]=null}),Le(),n=o[e],n?n.p(a,c):(n=o[e]=s[e](a),n.c()),U(n,1),n.m(i.parentNode,i))},i(a){r||(U(n),r=!0)},o(a){K(n),r=!1},d(a){o[e].d(a),a&&z(i)}}}function z0(t){let e,n,i=t[9][t[23]]+"",r,s,o,l,a;const c=[H0,V0,F0],u=[];function h(f,d){return f[23]==="img"||f[23]==="doc"?0:f[23]==="sim"?1:f[23]==="mat"?2:-1}return~(o=h(t))&&(l=u[o]=c[o](t)),{c(){e=w("div"),n=w("h2"),r=oe(i),s=F(),l&&l.c(),v(n,"class","title is-3 has-text-link")},m(f,d){j(f,e,d),y(e,n),y(n,r),y(e,s),~o&&u[o].m(e,null),a=!0},p(f,d){(!a||d&8388608)&&i!==(i=f[9][f[23]]+"")&&Ce(r,i);let m=o;o=h(f),o===m?~o&&u[o].p(f,d):(l&&(Pe(),K(u[m],1,1,()=>{u[m]=null}),Le()),~o?(l=u[o],l?l.p(f,d):(l=u[o]=c[o](f),l.c()),U(l,1),l.m(e,null)):l=null)},i(f){a||(U(l),a=!0)},o(f){K(l),a=!1},d(f){f&&z(e),~o&&u[o].d()}}}function j0(t){let e;return{c(){e=w("article"),e.innerHTML=`<div class="message-body">No document pairs found for this configuration.
                            Please adjust your selection criteria in the sidebar to include more documents or
                            categories.</div>`,v(e,"class","message is-warning")},m(n,i){j(n,e,i)},p:ne,i:ne,o:ne,d(n){n&&z(e)}}}function F0(t){let e,n;return e=new T_({props:{documentSetStore:t[4]}}),{c(){pe(e.$$.fragment)},m(i,r){de(e,i,r),n=!0},p:ne,i(i){n||(U(e.$$.fragment,i),n=!0)},o(i){K(e.$$.fragment,i),n=!1},d(i){me(e,i)}}}function V0(t){let e,n;return e=new I0({props:{documentSetStore:t[4],clusterStore:t[8]}}),{c(){pe(e.$$.fragment)},m(i,r){de(e,i,r),n=!0},p:ne,i(i){n||(U(e.$$.fragment,i),n=!0)},o(i){K(e.$$.fragment,i),n=!1},d(i){me(e,i)}}}function H0(t){let e,n;return e=new k_({props:{documentSetStore:t[4],type:t[23]}}),{c(){pe(e.$$.fragment)},m(i,r){de(e,i,r),n=!0},p(i,r){const s={};r&8388608&&(s.type=i[23]),e.$set(s)},i(i){n||(U(e.$$.fragment,i),n=!0)},o(i){K(e.$$.fragment,i),n=!1},d(i){me(e,i)}}}function U0(t){let e;return{c(){e=w("progress"),e.textContent="Loading...",v(e,"class","progress is-link"),v(e,"max","100")},m(n,i){j(n,e,i)},p:ne,i:ne,o:ne,d(n){n&&z(e)}}}function B0(t){let e,n,i,r,s,o;n=new xu({props:{$$slots:{content:[P0]},$$scope:{ctx:t}}});const l=[R0,L0],a=[];function c(u,h){return u[2]?0:1}return r=c(t),s=a[r]=l[r](t),{c(){e=w("div"),pe(n.$$.fragment),i=F(),s.c(),v(e,"slot","content")},m(u,h){j(u,e,h),de(n,e,null),y(e,i),a[r].m(e,null),o=!0},p(u,h){const f={};h&268435458&&(f.$$scope={dirty:h,ctx:u}),n.$set(f);let d=r;r=c(u),r===d?a[r].p(u,h):(Pe(),K(a[d],1,1,()=>{a[d]=null}),Le(),s=a[r],s?s.p(u,h):(s=a[r]=l[r](u),s.c()),U(s,1),s.m(e,null))},i(u){o||(U(n.$$.fragment,u),U(s),o=!0)},o(u){K(n.$$.fragment,u),K(s),o=!1},d(u){u&&z(e),me(n),a[r].d()}}}function q0(t){let e,n;return e=new $u({props:{tabList:t[9],$$slots:{content:[B0,({activeTab:i})=>({23:i}),({activeTab:i})=>i?8388608:0],sidebar:[O0,({activeTab:i})=>({23:i}),({activeTab:i})=>i?8388608:0]},$$scope:{ctx:t}}}),{c(){pe(e.$$.fragment)},m(i,r){de(e,i,r),n=!0},p(i,[r]){const s={};r&276824079&&(s.$$scope={dirty:r,ctx:i}),e.$set(s)},i(i){n||(U(e.$$.fragment,i),n=!0)},o(i){K(e.$$.fragment,i),n=!1},d(i){me(e,i)}}}function K0(t,e,n){var P;let i,r,s,{docSet:o}=e;const l=O_(o.id),{error:a,fetchPairs:c,selectedRegions:u,selectedCategories:h,threshold:f,topK:d,mutualTopK:m,scoreMode:p}=l;ye(t,a,L=>n(2,r=L)),ye(t,c,L=>n(3,s=L));let g,_,k,E,b,S;An(()=>{g=Dn(u,"regions","set"),_=Dn(h,"categories","array"),k=Dn(f,"threshold","number"),E=Dn(d,"topk","number"),b=Dn(m,"mutual","boolean"),S=Dn(p,"mode","string"),ot(h)||h.set([1]);const L=u.subscribe(g),H=h.subscribe(_),D=f.subscribe(k),I=d.subscribe(E),R=m.subscribe(b),N=p.subscribe(S);return()=>{L(),H(),D(),I(),R(),N()}});const{selected:T}=sr;ye(t,T,L=>n(1,i=L));const M=M0(l,sr),C={img:W==="en"?"Image Network":"Réseau d'images",doc:W==="en"?"Document Network":"Réseau de documents",sim:W==="en"?"Copy Clusters":"Groupe de copies",mat:W==="en"?"Document Matrix":"Matrice de documents"},x=((P=o==null?void 0:o.selection)==null?void 0:P.selected)||{Witness:{},Series:{},Work:{}};return Nn("selectedDocuments",x),t.$$set=L=>{"docSet"in L&&n(0,o=L.docSet)},[o,i,r,s,l,a,c,T,M,C]}class W0 extends Me{constructor(e){super(),Ie(this,e,K0,q0,Ee,{docSet:0})}}new W0({target:document.getElementById("document-set"),props:{docSet}});const ob="";function Y0(t){let e,n,i;return n=new Kn({props:{item:t[0],height:"full"}}),{c(){e=w("div"),pe(n.$$.fragment),v(e,"class","img-wrapper svelte-1duc3w1")},m(r,s){j(r,e,s),de(n,e,null),i=!0},p(r,[s]){const o={};s&1&&(o.item=r[0]),n.$set(o)},i(r){i||(U(n.$$.fragment,r),i=!0)},o(r){K(n.$$.fragment,r),i=!1},d(r){r&&z(e),me(n)}}}function G0(t,e,n){let{mainImgItem:i}=e;return t.$$set=r=>{"mainImgItem"in r&&n(0,i=r.mainImgItem)},[i]}class Ba extends Me{constructor(e){super(),Ie(this,e,G0,Y0,Ee,{mainImgItem:0})}}const lb="";function X0(t){return{c:ne,m:ne,p:ne,d:ne}}function J0(t){let e,n=`${t[5][0]}%`,i=`${t[5][1]}%`,r=`${t[5][2]}%`,s=`${t[5][3]}%`;return{c(){e=w("div"),v(e,"class","modal-context-bbox svelte-zgr10j"),v(e,"aria-description",W==="fr"?"Position de la région extraite sur la page":"Position of the extracted region on the page"),De(e,"left",n),De(e,"top",i),De(e,"width",r),De(e,"height",s)},m(o,l){j(o,e,l)},p:ne,d(o){o&&z(e)}}}function Q0(t){return{c:ne,m:ne,p:ne,d:ne}}function Z0(t){let e,n,i,r,s,o={ctx:t,current:null,token:null,hasCatch:!1,pending:Q0,then:J0,catch:X0,value:5};return _r(t[1],o),{c(){e=w("div"),n=w("div"),i=w("img"),s=F(),o.block.c(),v(i,"class","card modal-context-full-page svelte-zgr10j"),Mt(i.src,r=t[0])||v(i,"src",r),v(i,"alt",W==="fr"?"Vue de la page d'où la région est extraite":"View of the page the region is extracted from"),v(n,"class","modal-context-wrapper svelte-zgr10j"),v(e,"class","modal-context-outer pb-4 svelte-zgr10j")},m(l,a){j(l,e,a),y(e,n),y(n,i),y(n,s),o.block.m(n,o.anchor=null),o.mount=()=>n,o.anchor=null},p(l,[a]){t=l,zs(o,t,a)},i:ne,o:ne,d(l){l&&z(e),o.block.d(),o.token=null,o=null}}}function e1(t,e,n){let{mainImgItem:i}=e;const r=Bt(i.img,"full","full"),s=vu(i.img),o=i.xywh.map(Number),l=fetch(s).then(a=>a.json()).then(a=>[o[0]/a.width,o[1]/a.height,o[2]/a.width,o[3]/a.height].map(c=>c*100));return t.$$set=a=>{"mainImgItem"in a&&n(2,i=a.mainImgItem)},[r,l,i]}class t1 extends Me{constructor(e){super(),Ie(this,e,e1,Z0,Ee,{mainImgItem:2})}}const ab="";function qa(t,e,n){const i=t.slice();return i[13]=e[n].id,i[14]=e[n].label,i}function Ka(t){let e,n,i=t[14]+"",r,s,o,l,a;function c(){return t[9](t[13])}return{c(){e=w("li"),n=w("a"),r=oe(i),s=F(),v(n,"href",""),v(e,"class",o=t[13]===t[2]?"is-active":"")},m(u,h){j(u,e,h),y(e,n),y(n,r),y(e,s),l||(a=be(n,"click",Jt(c)),l=!0)},p(u,h){t=u,h&4&&o!==(o=t[13]===t[2]?"is-active":"")&&v(e,"class",o)},d(u){u&&z(e),l=!1,a()}}}function n1(t){let e,n,i,r,s,o,l,a,c,u,h,f,d,m,p,g=t[3],_=[];for(let S=0;S<g.length;S+=1)_[S]=Ka(qa(t,g,S));const k=[t[1][t[2]]||{}];var E=t[0][t[2]]||null;function b(S){let T={};for(let M=0;M<k.length;M+=1)T=Ms(T,k[M]);return{props:T}}return E&&(u=ki(E,b())),{c(){e=w("div"),n=w("div"),i=F(),r=w("div"),s=w("div"),o=w("div"),l=w("ul");for(let S=0;S<_.length;S+=1)_[S].c();a=F(),c=w("div"),u&&pe(u.$$.fragment),h=F(),f=w("button"),v(n,"class","modal-background"),v(o,"class","tabs is-centered"),De(o,"height","fit-content"),v(c,"class","ml-4 mr-4 modal-main-wrapper svelte-1uakzh2"),Ae(c,"pb-4",t[2]==="main"),v(s,"class","modal-inner svelte-1uakzh2"),v(r,"class","modal-content svelte-1uakzh2"),v(f,"class","modal-close is-large"),v(f,"aria-label","close"),v(e,"id","region-modal-wrapper"),v(e,"class","modal is-active")},m(S,T){j(S,e,T),y(e,n),y(e,i),y(e,r),y(r,s),y(s,o),y(o,l);for(let M=0;M<_.length;M+=1)_[M]&&_[M].m(l,null);y(s,a),y(s,c),u&&de(u,c,null),y(e,h),y(e,f),d=!0,m||(p=[be(n,"click",t[6]),be(n,"keyup",t[5]),be(f,"click",t[6])],m=!0)},p(S,[T]){if(T&28){g=S[3];let C;for(C=0;C<g.length;C+=1){const x=qa(S,g,C);_[C]?_[C].p(x,T):(_[C]=Ka(x),_[C].c(),_[C].m(l,null))}for(;C<_.length;C+=1)_[C].d(1);_.length=g.length}const M=T&6?iu(k,[ru(S[1][S[2]]||{})]):{};if(T&5&&E!==(E=S[0][S[2]]||null)){if(u){Pe();const C=u;K(C.$$.fragment,1,0,()=>{me(C,1)}),Le()}E?(u=ki(E,b()),pe(u.$$.fragment),U(u.$$.fragment,1),de(u,c,null)):u=null}else E&&u.$set(M);(!d||T&4)&&Ae(c,"pb-4",S[2]==="main")},i(S){d||(u&&U(u.$$.fragment,S),d=!0)},o(S){u&&K(u.$$.fragment,S),d=!1},d(S){S&&z(e),dt(_,S),u&&me(u),m=!1,st(p)}}}function i1(t,e,n){let i,{mainImgItem:r}=e,{compareImgItem:s}=e;const o=Ii(),l=s?["main","page","similarity","expansion"]:["main","page"],a={expansion:{fr:"Expansion de requête",en:"Query expansion"},similarity:{fr:"Comparaison",en:"Comparison"},page:{fr:"Vue de la page",en:"Page view"},main:{fr:"Vue principale",en:"Main view"}},c=l.map(g=>{var _;return{id:g,label:((_=a[g])==null?void 0:_[W])??"Main view"}}),u={main:Ba,page:t1};s&&Promise.all([ls(()=>Promise.resolve().then(()=>iy),void 0).then(g=>g.default),ls(()=>Promise.resolve().then(()=>Ty),void 0).then(g=>g.default)]).then(([g,_])=>{const k=Object.keys(u);l.filter(E=>!k.includes(E)).map(E=>n(0,u[E]=E==="expansion"?_:E==="similarity"?g:Ba,u))});const h={};l.map(g=>n(1,h[g]=g==="similarity"?{compareImgItem:s,mainImgItem:r}:{mainImgItem:r},h));const f=g=>n(2,i=g),d=g=>{g.key==="Escape"&&o("closeModal")},m=()=>o("closeModal");An(()=>{document.addEventListener("keyup",d)}),Tn(()=>{document.removeEventListener("keydown",d)});const p=g=>f(g);return t.$$set=g=>{"mainImgItem"in g&&n(7,r=g.mainImgItem),"compareImgItem"in g&&n(8,s=g.compareImgItem)},n(2,i=l[0]),[u,h,i,c,f,d,m,r,s,p]}class r1 extends Me{constructor(e){super(),Ie(this,e,i1,n1,Ee,{mainImgItem:7,compareImgItem:8})}}const cb="";function s1(t){let e,n,i,r,s,o,l,a,c,u,h;return n=new Pi({props:{targetHtmlId:t[0],tooltipText:t[1]}}),{c(){e=w("div"),pe(n.$$.fragment),i=F(),r=w("button"),s=Dt("svg"),o=Dt("path"),l=Dt("path"),a=Dt("path"),v(o,"d","M53.6443 14.25C47.7042 5.33 37.7293 0 26.9801 0C16.2206 0 6.24576 5.33 0.305653 14.25L0 14.71L0.305653 15.17C6.24576 24.09 16.2206 29.42 26.9801 29.42C37.7293 29.42 47.7042 24.09 53.6443 15.16L53.95 14.71L53.6443 14.25ZM3.25025 14.71C7.63146 8.69001 14.0606 4.65 21.2641 3.22C20.0619 3.83 18.9411 4.62 17.963 5.59C15.5176 8.02 14.1625 11.25 14.1625 14.67C14.1625 18.11 15.5176 21.34 17.963 23.76C19.0124 24.79 20.1943 25.61 21.4781 26.23C14.1829 24.85 7.6824 20.78 3.25025 14.71ZM27.1125 22.64C22.7008 22.64 19.1041 19.08 19.1041 14.7C19.1041 12.59 19.9396 10.6 21.4475 9.10001C22.9555 7.60001 24.9729 6.77 27.1125 6.77C29.2522 6.77 31.2594 7.60001 32.7775 9.10001C34.2855 10.6 35.121 12.59 35.121 14.7C35.121 16.82 34.2855 18.82 32.7775 20.32C31.2594 21.81 29.242 22.64 27.1125 22.64ZM32.9915 26.14C34.204 25.53 35.3146 24.74 36.3029 23.77C38.7482 21.34 40.0932 18.11 40.0932 14.68C40.0932 9.75 37.281 5.47001 33.1647 3.32001C40.1747 4.81001 46.4102 8.83001 50.6896 14.71C46.3797 20.64 40.0728 24.67 32.9915 26.14Z"),v(o,"fill","black"),v(o,"class","svelte-19wutme"),v(l,"d","M26.9804 25.98C33.3222 25.98 38.4633 20.9343 38.4633 14.71C38.4633 8.48576 33.3222 3.44 26.9804 3.44C20.6386 3.44 15.4976 8.48576 15.4976 14.71C15.4976 20.9343 20.6386 25.98 26.9804 25.98Z"),v(l,"fill","black"),v(l,"class","svelte-19wutme"),v(a,"d","M17.9529 23.85L36.2928 5.85001"),v(a,"stroke","black"),v(a,"stroke-width","3"),v(a,"stroke-miterlimit","10"),v(a,"class","svelte-19wutme"),v(s,"width","54"),v(s,"height","30"),v(s,"viewBox","0 0 54 30"),v(s,"fill","none"),v(s,"xmlns","http://www.w3.org/2000/svg"),v(s,"class","svelte-19wutme"),v(r,"class","button tag svelte-19wutme"),v(r,"title",t[1]),v(e,"id",t[0])},m(f,d){j(f,e,d),de(n,e,null),y(e,i),y(e,r),y(r,s),y(s,o),y(s,l),y(s,a),c=!0,u||(h=be(r,"click",t[2]),u=!0)},p:ne,i(f){c||(U(n.$$.fragment,f),c=!0)},o(f){K(n.$$.fragment,f),c=!1},d(f){f&&z(e),me(n),u=!1,h()}}}function o1(t,e,n){let i,r,{mainImgItem:s}=e,{compareImgItem:o=void 0}=e;Nn("isInModal",!0);const l=`modal-opener-${window.crypto.randomUUID()}`,a=W==="fr"?"Vue détaillée":"Detailed view",c=(f,d)=>(f?(d=new r1({target:document.querySelector("body"),props:{mainImgItem:s,compareImgItem:o}}),d.$on("closeModal",h)):!f&&r!=null&&d.$destroy(),d),u=()=>n(5,i=!i),h=()=>n(5,i=!1);return t.$$set=f=>{"mainImgItem"in f&&n(3,s=f.mainImgItem),"compareImgItem"in f&&n(4,o=f.compareImgItem)},t.$$.update=()=>{t.$$.dirty&96&&n(6,r=c(i,r))},n(5,i=!1),[l,a,u,s,o,i,r]}class l1 extends Me{constructor(e){super(),Ie(this,e,o1,s1,Ee,{mainImgItem:3,compareImgItem:4})}}const a1=Object.freeze(Object.defineProperty({__proto__:null,default:l1},Symbol.toStringTag,{value:"Module"})),ub="";function c1(t){let e,n,i,r,s,o,l;return{c(){e=w("button"),n=w("span"),n.innerHTML='<span class="switch-control svelte-g5g8im"><span class="switch-spot"></span></span>',i=F(),r=w("span"),s=oe(t[0]),v(n,"class","switch mr-2 svelte-g5g8im"),v(r,"class","label svelte-g5g8im"),v(e,"id",t[3]),v(e,"name",t[3]),v(e,"class","input-checkbox-wrapper is-flex is-align-items-center-is-justify-content-center p-2 pl-3 pr-3 svelte-g5g8im"),v(e,"aria-label",t[0]),Ae(e,"is-checked",t[2]),Ae(e,"is-clickable",t[1]),Ae(e,"button",t[1])},m(a,c){j(a,e,c),y(e,n),y(e,i),y(e,r),y(r,s),o||(l=be(e,"click",Jt(t[4])),o=!0)},p(a,[c]){c&1&&Ce(s,a[0]),c&1&&v(e,"aria-label",a[0]),c&4&&Ae(e,"is-checked",a[2]),c&2&&Ae(e,"is-clickable",a[1]),c&2&&Ae(e,"button",a[1])},i:ne,o:ne,d(a){a&&z(e),o=!1,l()}}}function u1(t,e,n){let i,{toggleLabel:r}=e,{start:s=!1}=e,{buttonDisplay:o=!1}=e;const l=`input-toggle-${window.crypto.randomUUID()}`,a=Ii(),c=xt("resetTrigger")||void 0;c==null||c.subscribe(h);const u=()=>n(2,i=!i);function h(){n(2,i=s)}return t.$$set=f=>{"toggleLabel"in f&&n(0,r=f.toggleLabel),"start"in f&&n(5,s=f.start),"buttonDisplay"in f&&n(1,o=f.buttonDisplay)},t.$$.update=()=>{t.$$.dirty&32&&n(2,i=s),t.$$.dirty&4&&a("updateChecked",i)},[r,o,i,l,u,s]}class f1 extends Me{constructor(e){super(),Ie(this,e,u1,c1,Ee,{toggleLabel:0,start:5,buttonDisplay:1})}}/*! choices.js v11.1.0 | © 2025 Josh Johnson | https://github.com/jshjohnson/Choices#readme */var us=function(t,e){return us=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(n[r]=i[r])},us(t,e)};function Wa(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");us(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}var kt=function(){return kt=Object.assign||function(e){for(var n,i=1,r=arguments.length;i<r;i++){n=arguments[i];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},kt.apply(this,arguments)};function h1(t,e,n){if(n||arguments.length===2)for(var i=0,r=e.length,s;i<r;i++)(s||!(i in e))&&(s||(s=Array.prototype.slice.call(e,0,i)),s[i]=e[i]);return t.concat(s||Array.prototype.slice.call(e))}typeof SuppressedError=="function"&&SuppressedError;var Ge={ADD_CHOICE:"ADD_CHOICE",REMOVE_CHOICE:"REMOVE_CHOICE",FILTER_CHOICES:"FILTER_CHOICES",ACTIVATE_CHOICES:"ACTIVATE_CHOICES",CLEAR_CHOICES:"CLEAR_CHOICES",ADD_GROUP:"ADD_GROUP",ADD_ITEM:"ADD_ITEM",REMOVE_ITEM:"REMOVE_ITEM",HIGHLIGHT_ITEM:"HIGHLIGHT_ITEM"},Et={showDropdown:"showDropdown",hideDropdown:"hideDropdown",change:"change",choice:"choice",search:"search",addItem:"addItem",removeItem:"removeItem",highlightItem:"highlightItem",highlightChoice:"highlightChoice",unhighlightItem:"unhighlightItem"},ft={TAB_KEY:9,SHIFT_KEY:16,BACK_KEY:46,DELETE_KEY:8,ENTER_KEY:13,A_KEY:65,ESC_KEY:27,UP_KEY:38,DOWN_KEY:40,PAGE_UP_KEY:33,PAGE_DOWN_KEY:34},d1=["fuseOptions","classNames"],hn={Text:"text",SelectOne:"select-one",SelectMultiple:"select-multiple"},Ya=function(t){return{type:Ge.ADD_CHOICE,choice:t}},m1=function(t){return{type:Ge.REMOVE_CHOICE,choice:t}},p1=function(t){return{type:Ge.FILTER_CHOICES,results:t}},g1=function(t){return{type:Ge.ACTIVATE_CHOICES,active:t}},_1=function(t){return{type:Ge.ADD_GROUP,group:t}},Ga=function(t){return{type:Ge.ADD_ITEM,item:t}},Xa=function(t){return{type:Ge.REMOVE_ITEM,item:t}},lr=function(t,e){return{type:Ge.HIGHLIGHT_ITEM,item:t,highlighted:e}},v1=function(t,e){return Math.floor(Math.random()*(e-t)+t)},Ja=function(t){return Array.from({length:t},function(){return v1(0,36).toString(36)}).join("")},y1=function(t,e){var n=t.id||t.name&&"".concat(t.name,"-").concat(Ja(2))||Ja(4);return n=n.replace(/(:|\.|\[|\]|,)/g,""),n="".concat(e,"-").concat(n),n},b1=function(t,e,n){n===void 0&&(n=1);for(var i="".concat(n>0?"next":"previous","ElementSibling"),r=t[i];r;){if(r.matches(e))return r;r=r[i]}return null},w1=function(t,e,n){n===void 0&&(n=1);var i;return n>0?i=e.scrollTop+e.offsetHeight>=t.offsetTop+t.offsetHeight:i=t.offsetTop>=e.scrollTop,i},ar=function(t){if(typeof t!="string"){if(t==null)return"";if(typeof t=="object"){if("raw"in t)return ar(t.raw);if("trusted"in t)return t.trusted}return t}return t.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/'/g,"&#039;").replace(/"/g,"&quot;")},S1=function(){var t=document.createElement("div");return function(e){t.innerHTML=e.trim();for(var n=t.children[0];t.firstChild;)t.removeChild(t.firstChild);return n}}(),mi=function(t,e){return typeof t=="function"?t(ar(e),e):t},Qa=function(t){return typeof t=="function"?t():t},Sn=function(t){if(typeof t=="string")return t;if(typeof t=="object"){if("trusted"in t)return t.trusted;if("raw"in t)return t.raw}return""},Za=function(t){if(typeof t=="string")return t;if(typeof t=="object"){if("escaped"in t)return t.escaped;if("trusted"in t)return t.trusted}return""},fs=function(t,e){return t?Za(e):ar(e)},rn=function(t,e,n){t.innerHTML=fs(e,n)},k1=function(t,e){var n=t.value,i=t.label,r=i===void 0?n:i,s=e.value,o=e.label,l=o===void 0?s:o;return Sn(r).localeCompare(Sn(l),[],{sensitivity:"base",ignorePunctuation:!0,numeric:!0})},E1=function(t,e){return t.rank-e.rank},C1=function(t,e,n){n===void 0&&(n=null);var i=new CustomEvent(e,{detail:n,bubbles:!0,cancelable:!0});return t.dispatchEvent(i)},I1=function(t,e){var n=Object.keys(t).sort(),i=Object.keys(e).sort();return n.filter(function(r){return i.indexOf(r)<0})},cr=function(t){return Array.isArray(t)?t:[t]},pi=function(t){return t&&Array.isArray(t)?t.map(function(e){return".".concat(e)}).join(""):".".concat(t)},ke=function(t,e){var n;(n=t.classList).add.apply(n,cr(e))},Wt=function(t,e){var n;(n=t.classList).remove.apply(n,cr(e))},M1=function(t){if(typeof t<"u")try{return JSON.parse(t)}catch{return t}return{}},x1=function(t,e,n){var i=t.itemEl;i&&(Wt(i,n),ke(i,e))},A1=function(){function t(e){var n=e.element,i=e.type,r=e.classNames;this.element=n,this.classNames=r,this.type=i,this.isActive=!1}return t.prototype.show=function(){return ke(this.element,this.classNames.activeState),this.element.setAttribute("aria-expanded","true"),this.isActive=!0,this},t.prototype.hide=function(){return Wt(this.element,this.classNames.activeState),this.element.setAttribute("aria-expanded","false"),this.isActive=!1,this},t}(),ec=function(){function t(e){var n=e.element,i=e.type,r=e.classNames,s=e.position;this.element=n,this.classNames=r,this.type=i,this.position=s,this.isOpen=!1,this.isFlipped=!1,this.isDisabled=!1,this.isLoading=!1}return t.prototype.shouldFlip=function(e,n){var i=!1;return this.position==="auto"?i=this.element.getBoundingClientRect().top-n>=0&&!window.matchMedia("(min-height: ".concat(e+1,"px)")).matches:this.position==="top"&&(i=!0),i},t.prototype.setActiveDescendant=function(e){this.element.setAttribute("aria-activedescendant",e)},t.prototype.removeActiveDescendant=function(){this.element.removeAttribute("aria-activedescendant")},t.prototype.open=function(e,n){ke(this.element,this.classNames.openState),this.element.setAttribute("aria-expanded","true"),this.isOpen=!0,this.shouldFlip(e,n)&&(ke(this.element,this.classNames.flippedState),this.isFlipped=!0)},t.prototype.close=function(){Wt(this.element,this.classNames.openState),this.element.setAttribute("aria-expanded","false"),this.removeActiveDescendant(),this.isOpen=!1,this.isFlipped&&(Wt(this.element,this.classNames.flippedState),this.isFlipped=!1)},t.prototype.addFocusState=function(){ke(this.element,this.classNames.focusState)},t.prototype.removeFocusState=function(){Wt(this.element,this.classNames.focusState)},t.prototype.enable=function(){Wt(this.element,this.classNames.disabledState),this.element.removeAttribute("aria-disabled"),this.type===hn.SelectOne&&this.element.setAttribute("tabindex","0"),this.isDisabled=!1},t.prototype.disable=function(){ke(this.element,this.classNames.disabledState),this.element.setAttribute("aria-disabled","true"),this.type===hn.SelectOne&&this.element.setAttribute("tabindex","-1"),this.isDisabled=!0},t.prototype.wrap=function(e){var n=this.element,i=e.parentNode;i&&(e.nextSibling?i.insertBefore(n,e.nextSibling):i.appendChild(n)),n.appendChild(e)},t.prototype.unwrap=function(e){var n=this.element,i=n.parentNode;i&&(i.insertBefore(e,n),i.removeChild(n))},t.prototype.addLoadingState=function(){ke(this.element,this.classNames.loadingState),this.element.setAttribute("aria-busy","true"),this.isLoading=!0},t.prototype.removeLoadingState=function(){Wt(this.element,this.classNames.loadingState),this.element.removeAttribute("aria-busy"),this.isLoading=!1},t}(),T1=function(){function t(e){var n=e.element,i=e.type,r=e.classNames,s=e.preventPaste;this.element=n,this.type=i,this.classNames=r,this.preventPaste=s,this.isFocussed=this.element.isEqualNode(document.activeElement),this.isDisabled=n.disabled,this._onPaste=this._onPaste.bind(this),this._onInput=this._onInput.bind(this),this._onFocus=this._onFocus.bind(this),this._onBlur=this._onBlur.bind(this)}return Object.defineProperty(t.prototype,"placeholder",{set:function(e){this.element.placeholder=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){return this.element.value},set:function(e){this.element.value=e},enumerable:!1,configurable:!0}),t.prototype.addEventListeners=function(){var e=this.element;e.addEventListener("paste",this._onPaste),e.addEventListener("input",this._onInput,{passive:!0}),e.addEventListener("focus",this._onFocus,{passive:!0}),e.addEventListener("blur",this._onBlur,{passive:!0})},t.prototype.removeEventListeners=function(){var e=this.element;e.removeEventListener("input",this._onInput),e.removeEventListener("paste",this._onPaste),e.removeEventListener("focus",this._onFocus),e.removeEventListener("blur",this._onBlur)},t.prototype.enable=function(){var e=this.element;e.removeAttribute("disabled"),this.isDisabled=!1},t.prototype.disable=function(){var e=this.element;e.setAttribute("disabled",""),this.isDisabled=!0},t.prototype.focus=function(){this.isFocussed||this.element.focus()},t.prototype.blur=function(){this.isFocussed&&this.element.blur()},t.prototype.clear=function(e){return e===void 0&&(e=!0),this.element.value="",e&&this.setWidth(),this},t.prototype.setWidth=function(){var e=this.element;e.style.minWidth="".concat(e.placeholder.length+1,"ch"),e.style.width="".concat(e.value.length+1,"ch")},t.prototype.setActiveDescendant=function(e){this.element.setAttribute("aria-activedescendant",e)},t.prototype.removeActiveDescendant=function(){this.element.removeAttribute("aria-activedescendant")},t.prototype._onInput=function(){this.type!==hn.SelectOne&&this.setWidth()},t.prototype._onPaste=function(e){this.preventPaste&&e.preventDefault()},t.prototype._onFocus=function(){this.isFocussed=!0},t.prototype._onBlur=function(){this.isFocussed=!1},t}(),N1=4,tc=function(){function t(e){var n=e.element;this.element=n,this.scrollPos=this.element.scrollTop,this.height=this.element.offsetHeight}return t.prototype.prepend=function(e){var n=this.element.firstElementChild;n?this.element.insertBefore(e,n):this.element.append(e)},t.prototype.scrollToTop=function(){this.element.scrollTop=0},t.prototype.scrollToChildElement=function(e,n){var i=this;if(e){var r=this.element.offsetHeight,s=this.element.scrollTop+r,o=e.offsetHeight,l=e.offsetTop+o,a=n>0?this.element.scrollTop+l-s:e.offsetTop;requestAnimationFrame(function(){i._animateScroll(a,n)})}},t.prototype._scrollDown=function(e,n,i){var r=(i-e)/n,s=r>1?r:1;this.element.scrollTop=e+s},t.prototype._scrollUp=function(e,n,i){var r=(e-i)/n,s=r>1?r:1;this.element.scrollTop=e-s},t.prototype._animateScroll=function(e,n){var i=this,r=N1,s=this.element.scrollTop,o=!1;n>0?(this._scrollDown(s,r,e),s<e&&(o=!0)):(this._scrollUp(s,r,e),s>e&&(o=!0)),o&&requestAnimationFrame(function(){i._animateScroll(e,n)})},t}(),nc=function(){function t(e){var n=e.element,i=e.classNames;this.element=n,this.classNames=i,this.isDisabled=!1}return Object.defineProperty(t.prototype,"isActive",{get:function(){return this.element.dataset.choice==="active"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dir",{get:function(){return this.element.dir},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){return this.element.value},set:function(e){this.element.setAttribute("value",e),this.element.value=e},enumerable:!1,configurable:!0}),t.prototype.conceal=function(){var e=this.element;ke(e,this.classNames.input),e.hidden=!0,e.tabIndex=-1;var n=e.getAttribute("style");n&&e.setAttribute("data-choice-orig-style",n),e.setAttribute("data-choice","active")},t.prototype.reveal=function(){var e=this.element;Wt(e,this.classNames.input),e.hidden=!1,e.removeAttribute("tabindex");var n=e.getAttribute("data-choice-orig-style");n?(e.removeAttribute("data-choice-orig-style"),e.setAttribute("style",n)):e.removeAttribute("style"),e.removeAttribute("data-choice")},t.prototype.enable=function(){this.element.removeAttribute("disabled"),this.element.disabled=!1,this.isDisabled=!1},t.prototype.disable=function(){this.element.setAttribute("disabled",""),this.element.disabled=!0,this.isDisabled=!0},t.prototype.triggerEvent=function(e,n){C1(this.element,e,n||{})},t}(),O1=function(t){Wa(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e}(nc),gi=function(t,e){return e===void 0&&(e=!0),typeof t>"u"?e:!!t},ic=function(t){if(typeof t=="string"&&(t=t.split(" ").filter(function(e){return e.length})),Array.isArray(t)&&t.length)return t},Yt=function(t,e,n){if(n===void 0&&(n=!0),typeof t=="string"){var i=ar(t),r=n||i===t?t:{escaped:i,raw:t},s=Yt({value:t,label:r,selected:!0},!1);return s}var o=t;if("choices"in o){if(!e)throw new TypeError("optGroup is not allowed");var l=o,a=l.choices.map(function(f){return Yt(f,!1)}),c={id:0,label:Sn(l.label)||l.value,active:!!a.length,disabled:!!l.disabled,choices:a};return c}var u=o,h={id:0,group:null,score:0,rank:0,value:u.value,label:u.label||u.value,active:gi(u.active),selected:gi(u.selected,!1),disabled:gi(u.disabled,!1),placeholder:gi(u.placeholder,!1),highlighted:!1,labelClass:ic(u.labelClass),labelDescription:u.labelDescription,customProperties:u.customProperties};return h},P1=function(t){return t.tagName==="INPUT"},rc=function(t){return t.tagName==="SELECT"},L1=function(t){return t.tagName==="OPTION"},R1=function(t){return t.tagName==="OPTGROUP"},D1=function(t){Wa(e,t);function e(n){var i=n.element,r=n.classNames,s=n.template,o=n.extractPlaceholder,l=t.call(this,{element:i,classNames:r})||this;return l.template=s,l.extractPlaceholder=o,l}return Object.defineProperty(e.prototype,"placeholderOption",{get:function(){return this.element.querySelector('option[value=""]')||this.element.querySelector("option[placeholder]")},enumerable:!1,configurable:!0}),e.prototype.addOptions=function(n){var i=this,r=document.createDocumentFragment();n.forEach(function(s){var o=s;if(!o.element){var l=i.template(o);r.appendChild(l),o.element=l}}),this.element.appendChild(r)},e.prototype.optionsAsChoices=function(){var n=this,i=[];return this.element.querySelectorAll(":scope > option, :scope > optgroup").forEach(function(r){L1(r)?i.push(n._optionToChoice(r)):R1(r)&&i.push(n._optgroupToChoice(r))}),i},e.prototype._optionToChoice=function(n){return!n.hasAttribute("value")&&n.hasAttribute("placeholder")&&(n.setAttribute("value",""),n.value=""),{id:0,group:null,score:0,rank:0,value:n.value,label:n.label,element:n,active:!0,selected:this.extractPlaceholder?n.selected:n.hasAttribute("selected"),disabled:n.disabled,highlighted:!1,placeholder:this.extractPlaceholder&&(!n.value||n.hasAttribute("placeholder")),labelClass:typeof n.dataset.labelClass<"u"?ic(n.dataset.labelClass):void 0,labelDescription:typeof n.dataset.labelDescription<"u"?n.dataset.labelDescription:void 0,customProperties:M1(n.dataset.customProperties)}},e.prototype._optgroupToChoice=function(n){var i=this,r=n.querySelectorAll("option"),s=Array.from(r).map(function(o){return i._optionToChoice(o)});return{id:0,label:n.label||"",element:n,active:!!s.length,disabled:n.disabled,choices:s}},e}(nc),$1={containerOuter:["choices"],containerInner:["choices__inner"],input:["choices__input"],inputCloned:["choices__input--cloned"],list:["choices__list"],listItems:["choices__list--multiple"],listSingle:["choices__list--single"],listDropdown:["choices__list--dropdown"],item:["choices__item"],itemSelectable:["choices__item--selectable"],itemDisabled:["choices__item--disabled"],itemChoice:["choices__item--choice"],description:["choices__description"],placeholder:["choices__placeholder"],group:["choices__group"],groupHeading:["choices__heading"],button:["choices__button"],activeState:["is-active"],focusState:["is-focused"],openState:["is-open"],disabledState:["is-disabled"],highlightedState:["is-highlighted"],selectedState:["is-selected"],flippedState:["is-flipped"],loadingState:["is-loading"],notice:["choices__notice"],addChoice:["choices__item--selectable","add-choice"],noResults:["has-no-results"],noChoices:["has-no-choices"]},sc={items:[],choices:[],silent:!1,renderChoiceLimit:-1,maxItemCount:-1,closeDropdownOnSelect:"auto",singleModeForMultiSelect:!1,addChoices:!1,addItems:!0,addItemFilter:function(t){return!!t&&t!==""},removeItems:!0,removeItemButton:!1,removeItemButtonAlignLeft:!1,editItems:!1,allowHTML:!1,allowHtmlUserInput:!1,duplicateItemsAllowed:!0,delimiter:",",paste:!0,searchEnabled:!0,searchChoices:!0,searchFloor:1,searchResultLimit:4,searchFields:["label","value"],position:"auto",resetScrollPosition:!0,shouldSort:!0,shouldSortItems:!1,sorter:k1,shadowRoot:null,placeholder:!0,placeholderValue:null,searchPlaceholderValue:null,prependValue:null,appendValue:null,renderSelectedChoices:"auto",loadingText:"Loading...",noResultsText:"No results found",noChoicesText:"No choices to choose from",itemSelectText:"Press to select",uniqueItemText:"Only unique values can be added",customAddItemText:"Only values matching specific conditions can be added",addItemText:function(t){return'Press Enter to add <b>"'.concat(t,'"</b>')},removeItemIconText:function(){return"Remove item"},removeItemLabelText:function(t){return"Remove item: ".concat(t)},maxItemText:function(t){return"Only ".concat(t," values can be added")},valueComparer:function(t,e){return t===e},fuseOptions:{includeScore:!0},labelId:"",callbackOnInit:null,callbackOnCreateTemplates:null,classNames:$1,appendGroupInSearch:!1},oc=function(t){var e=t.itemEl;e&&(e.remove(),t.itemEl=void 0)};function z1(t,e,n){var i=t,r=!0;switch(e.type){case Ge.ADD_ITEM:{e.item.selected=!0;var s=e.item.element;s&&(s.selected=!0,s.setAttribute("selected","")),i.push(e.item);break}case Ge.REMOVE_ITEM:{e.item.selected=!1;var s=e.item.element;if(s){s.selected=!1,s.removeAttribute("selected");var o=s.parentElement;o&&rc(o)&&o.type===hn.SelectOne&&(o.value="")}oc(e.item),i=i.filter(function(u){return u.id!==e.item.id});break}case Ge.REMOVE_CHOICE:{oc(e.choice),i=i.filter(function(c){return c.id!==e.choice.id});break}case Ge.HIGHLIGHT_ITEM:{var l=e.highlighted,a=i.find(function(c){return c.id===e.item.id});a&&a.highlighted!==l&&(a.highlighted=l,n&&x1(a,l?n.classNames.highlightedState:n.classNames.selectedState,l?n.classNames.selectedState:n.classNames.highlightedState));break}default:{r=!1;break}}return{state:i,update:r}}function j1(t,e){var n=t,i=!0;switch(e.type){case Ge.ADD_GROUP:{n.push(e.group);break}case Ge.CLEAR_CHOICES:{n=[];break}default:{i=!1;break}}return{state:n,update:i}}function F1(t,e,n){var i=t,r=!0;switch(e.type){case Ge.ADD_CHOICE:{i.push(e.choice);break}case Ge.REMOVE_CHOICE:{e.choice.choiceEl=void 0,e.choice.group&&(e.choice.group.choices=e.choice.group.choices.filter(function(o){return o.id!==e.choice.id})),i=i.filter(function(o){return o.id!==e.choice.id});break}case Ge.ADD_ITEM:case Ge.REMOVE_ITEM:{e.item.choiceEl=void 0;break}case Ge.FILTER_CHOICES:{var s=[];e.results.forEach(function(o){s[o.item.id]=o}),i.forEach(function(o){var l=s[o.id];l!==void 0?(o.score=l.score,o.rank=l.rank,o.active=!0):(o.score=0,o.rank=0,o.active=!1),n&&n.appendGroupInSearch&&(o.choiceEl=void 0)});break}case Ge.ACTIVATE_CHOICES:{i.forEach(function(o){o.active=e.active,n&&n.appendGroupInSearch&&(o.choiceEl=void 0)});break}case Ge.CLEAR_CHOICES:{i=[];break}default:{r=!1;break}}return{state:i,update:r}}var lc={groups:j1,items:z1,choices:F1},V1=function(){function t(e){this._state=this.defaultState,this._listeners=[],this._txn=0,this._context=e}return Object.defineProperty(t.prototype,"defaultState",{get:function(){return{groups:[],items:[],choices:[]}},enumerable:!1,configurable:!0}),t.prototype.changeSet=function(e){return{groups:e,items:e,choices:e}},t.prototype.reset=function(){this._state=this.defaultState;var e=this.changeSet(!0);this._txn?this._changeSet=e:this._listeners.forEach(function(n){return n(e)})},t.prototype.subscribe=function(e){return this._listeners.push(e),this},t.prototype.dispatch=function(e){var n=this,i=this._state,r=!1,s=this._changeSet||this.changeSet(!1);Object.keys(lc).forEach(function(o){var l=lc[o](i[o],e,n._context);l.update&&(r=!0,s[o]=!0,i[o]=l.state)}),r&&(this._txn?this._changeSet=s:this._listeners.forEach(function(o){return o(s)}))},t.prototype.withTxn=function(e){this._txn++;try{e()}finally{if(this._txn=Math.max(0,this._txn-1),!this._txn){var n=this._changeSet;n&&(this._changeSet=void 0,this._listeners.forEach(function(i){return i(n)}))}}},Object.defineProperty(t.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"items",{get:function(){return this.state.items},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"highlightedActiveItems",{get:function(){return this.items.filter(function(e){return e.active&&e.highlighted})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"choices",{get:function(){return this.state.choices},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"activeChoices",{get:function(){return this.choices.filter(function(e){return e.active})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"searchableChoices",{get:function(){return this.choices.filter(function(e){return!e.disabled&&!e.placeholder})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"groups",{get:function(){return this.state.groups},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"activeGroups",{get:function(){var e=this;return this.state.groups.filter(function(n){var i=n.active&&!n.disabled,r=e.state.choices.some(function(s){return s.active&&!s.disabled});return i&&r},[])},enumerable:!1,configurable:!0}),t.prototype.inTxn=function(){return this._txn>0},t.prototype.getChoiceById=function(e){return this.activeChoices.find(function(n){return n.id===e})},t.prototype.getGroupById=function(e){return this.groups.find(function(n){return n.id===e})},t}(),lt={noChoices:"no-choices",noResults:"no-results",addChoice:"add-choice",generic:""};function H1(t,e,n){return(e=B1(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function ac(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function Wn(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?ac(Object(n),!0).forEach(function(i){H1(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ac(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}function U1(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var i=n.call(t,e||"default");if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function B1(t){var e=U1(t,"string");return typeof e=="symbol"?e:e+""}function sn(t){return Array.isArray?Array.isArray(t):fc(t)==="[object Array]"}const q1=1/0;function K1(t){if(typeof t=="string")return t;let e=t+"";return e=="0"&&1/t==-q1?"-0":e}function W1(t){return t==null?"":K1(t)}function Gt(t){return typeof t=="string"}function cc(t){return typeof t=="number"}function Y1(t){return t===!0||t===!1||G1(t)&&fc(t)=="[object Boolean]"}function uc(t){return typeof t=="object"}function G1(t){return uc(t)&&t!==null}function Tt(t){return t!=null}function hs(t){return!t.trim().length}function fc(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(t)}const fb="Extended search is not available",X1="Incorrect 'index' type",J1=t=>`Invalid value for key ${t}`,Q1=t=>`Pattern length exceeds max of ${t}.`,Z1=t=>`Missing ${t} property in key`,ev=t=>`Property 'weight' in key '${t}' must be a positive integer`,hc=Object.prototype.hasOwnProperty;class tv{constructor(e){this._keys=[],this._keyMap={};let n=0;e.forEach(i=>{let r=dc(i);this._keys.push(r),this._keyMap[r.id]=r,n+=r.weight}),this._keys.forEach(i=>{i.weight/=n})}get(e){return this._keyMap[e]}keys(){return this._keys}toJSON(){return JSON.stringify(this._keys)}}function dc(t){let e=null,n=null,i=null,r=1,s=null;if(Gt(t)||sn(t))i=t,e=mc(t),n=ds(t);else{if(!hc.call(t,"name"))throw new Error(Z1("name"));const o=t.name;if(i=o,hc.call(t,"weight")&&(r=t.weight,r<=0))throw new Error(ev(o));e=mc(o),n=ds(o),s=t.getFn}return{path:e,id:n,weight:r,src:i,getFn:s}}function mc(t){return sn(t)?t:t.split(".")}function ds(t){return sn(t)?t.join("."):t}function nv(t,e){let n=[],i=!1;const r=(s,o,l)=>{if(Tt(s))if(!o[l])n.push(s);else{let a=o[l];const c=s[a];if(!Tt(c))return;if(l===o.length-1&&(Gt(c)||cc(c)||Y1(c)))n.push(W1(c));else if(sn(c)){i=!0;for(let u=0,h=c.length;u<h;u+=1)r(c[u],o,l+1)}else o.length&&r(c,o,l+1)}};return r(t,Gt(e)?e.split("."):e,0),i?n:n[0]}const iv={includeMatches:!1,findAllMatches:!1,minMatchCharLength:1},rv={isCaseSensitive:!1,includeScore:!1,keys:[],shouldSort:!0,sortFn:(t,e)=>t.score===e.score?t.idx<e.idx?-1:1:t.score<e.score?-1:1},sv={location:0,threshold:.6,distance:100},ov={useExtendedSearch:!1,getFn:nv,ignoreLocation:!1,ignoreFieldNorm:!1,fieldNormWeight:1};var ve=Wn(Wn(Wn(Wn({},rv),iv),sv),ov);const lv=/[^ ]+/g;function av(t=1,e=3){const n=new Map,i=Math.pow(10,e);return{get(r){const s=r.match(lv).length;if(n.has(s))return n.get(s);const o=1/Math.pow(s,.5*t),l=parseFloat(Math.round(o*i)/i);return n.set(s,l),l},clear(){n.clear()}}}class ms{constructor({getFn:e=ve.getFn,fieldNormWeight:n=ve.fieldNormWeight}={}){this.norm=av(n,3),this.getFn=e,this.isCreated=!1,this.setIndexRecords()}setSources(e=[]){this.docs=e}setIndexRecords(e=[]){this.records=e}setKeys(e=[]){this.keys=e,this._keysMap={},e.forEach((n,i)=>{this._keysMap[n.id]=i})}create(){this.isCreated||!this.docs.length||(this.isCreated=!0,Gt(this.docs[0])?this.docs.forEach((e,n)=>{this._addString(e,n)}):this.docs.forEach((e,n)=>{this._addObject(e,n)}),this.norm.clear())}add(e){const n=this.size();Gt(e)?this._addString(e,n):this._addObject(e,n)}removeAt(e){this.records.splice(e,1);for(let n=e,i=this.size();n<i;n+=1)this.records[n].i-=1}getValueForItemAtKeyId(e,n){return e[this._keysMap[n]]}size(){return this.records.length}_addString(e,n){if(!Tt(e)||hs(e))return;let i={v:e,i:n,n:this.norm.get(e)};this.records.push(i)}_addObject(e,n){let i={i:n,$:{}};this.keys.forEach((r,s)=>{let o=r.getFn?r.getFn(e):this.getFn(e,r.path);if(Tt(o)){if(sn(o)){let l=[];const a=[{nestedArrIndex:-1,value:o}];for(;a.length;){const{nestedArrIndex:c,value:u}=a.pop();if(Tt(u))if(Gt(u)&&!hs(u)){let h={v:u,i:c,n:this.norm.get(u)};l.push(h)}else sn(u)&&u.forEach((h,f)=>{a.push({nestedArrIndex:f,value:h})})}i.$[s]=l}else if(Gt(o)&&!hs(o)){let l={v:o,n:this.norm.get(o)};i.$[s]=l}}}),this.records.push(i)}toJSON(){return{keys:this.keys,records:this.records}}}function pc(t,e,{getFn:n=ve.getFn,fieldNormWeight:i=ve.fieldNormWeight}={}){const r=new ms({getFn:n,fieldNormWeight:i});return r.setKeys(t.map(dc)),r.setSources(e),r.create(),r}function cv(t,{getFn:e=ve.getFn,fieldNormWeight:n=ve.fieldNormWeight}={}){const{keys:i,records:r}=t,s=new ms({getFn:e,fieldNormWeight:n});return s.setKeys(i),s.setIndexRecords(r),s}function ur(t,{errors:e=0,currentLocation:n=0,expectedLocation:i=0,distance:r=ve.distance,ignoreLocation:s=ve.ignoreLocation}={}){const o=e/t.length;if(s)return o;const l=Math.abs(i-n);return r?o+l/r:l?1:o}function uv(t=[],e=ve.minMatchCharLength){let n=[],i=-1,r=-1,s=0;for(let o=t.length;s<o;s+=1){let l=t[s];l&&i===-1?i=s:!l&&i!==-1&&(r=s-1,r-i+1>=e&&n.push([i,r]),i=-1)}return t[s-1]&&s-i>=e&&n.push([i,s-1]),n}const kn=32;function fv(t,e,n,{location:i=ve.location,distance:r=ve.distance,threshold:s=ve.threshold,findAllMatches:o=ve.findAllMatches,minMatchCharLength:l=ve.minMatchCharLength,includeMatches:a=ve.includeMatches,ignoreLocation:c=ve.ignoreLocation}={}){if(e.length>kn)throw new Error(Q1(kn));const u=e.length,h=t.length,f=Math.max(0,Math.min(i,h));let d=s,m=f;const p=l>1||a,g=p?Array(h):[];let _;for(;(_=t.indexOf(e,m))>-1;){let M=ur(e,{currentLocation:_,expectedLocation:f,distance:r,ignoreLocation:c});if(d=Math.min(M,d),m=_+u,p){let C=0;for(;C<u;)g[_+C]=1,C+=1}}m=-1;let k=[],E=1,b=u+h;const S=1<<u-1;for(let M=0;M<u;M+=1){let C=0,x=b;for(;C<x;)ur(e,{errors:M,currentLocation:f+x,expectedLocation:f,distance:r,ignoreLocation:c})<=d?C=x:b=x,x=Math.floor((b-C)/2+C);b=x;let P=Math.max(1,f-x+1),L=o?h:Math.min(f+x,h)+u,H=Array(L+2);H[L+1]=(1<<M)-1;for(let I=L;I>=P;I-=1){let R=I-1,N=n[t.charAt(R)];if(p&&(g[R]=+!!N),H[I]=(H[I+1]<<1|1)&N,M&&(H[I]|=(k[I+1]|k[I])<<1|1|k[I+1]),H[I]&S&&(E=ur(e,{errors:M,currentLocation:R,expectedLocation:f,distance:r,ignoreLocation:c}),E<=d)){if(d=E,m=R,m<=f)break;P=Math.max(1,2*f-m)}}if(ur(e,{errors:M+1,currentLocation:f,expectedLocation:f,distance:r,ignoreLocation:c})>d)break;k=H}const T={isMatch:m>=0,score:Math.max(.001,E)};if(p){const M=uv(g,l);M.length?a&&(T.indices=M):T.isMatch=!1}return T}function hv(t){let e={};for(let n=0,i=t.length;n<i;n+=1){const r=t.charAt(n);e[r]=(e[r]||0)|1<<i-n-1}return e}class gc{constructor(e,{location:n=ve.location,threshold:i=ve.threshold,distance:r=ve.distance,includeMatches:s=ve.includeMatches,findAllMatches:o=ve.findAllMatches,minMatchCharLength:l=ve.minMatchCharLength,isCaseSensitive:a=ve.isCaseSensitive,ignoreLocation:c=ve.ignoreLocation}={}){if(this.options={location:n,threshold:i,distance:r,includeMatches:s,findAllMatches:o,minMatchCharLength:l,isCaseSensitive:a,ignoreLocation:c},this.pattern=a?e:e.toLowerCase(),this.chunks=[],!this.pattern.length)return;const u=(f,d)=>{this.chunks.push({pattern:f,alphabet:hv(f),startIndex:d})},h=this.pattern.length;if(h>kn){let f=0;const d=h%kn,m=h-d;for(;f<m;)u(this.pattern.substr(f,kn),f),f+=kn;if(d){const p=h-kn;u(this.pattern.substr(p),p)}}else u(this.pattern,0)}searchIn(e){const{isCaseSensitive:n,includeMatches:i}=this.options;if(n||(e=e.toLowerCase()),this.pattern===e){let m={isMatch:!0,score:0};return i&&(m.indices=[[0,e.length-1]]),m}const{location:r,distance:s,threshold:o,findAllMatches:l,minMatchCharLength:a,ignoreLocation:c}=this.options;let u=[],h=0,f=!1;this.chunks.forEach(({pattern:m,alphabet:p,startIndex:g})=>{const{isMatch:_,score:k,indices:E}=fv(e,m,p,{location:r+g,distance:s,threshold:o,findAllMatches:l,minMatchCharLength:a,includeMatches:i,ignoreLocation:c});_&&(f=!0),h+=k,_&&E&&(u=[...u,...E])});let d={isMatch:f,score:f?h/this.chunks.length:1};return f&&i&&(d.indices=u),d}}class dn{constructor(e){this.pattern=e}static isMultiMatch(e){return _c(e,this.multiRegex)}static isSingleMatch(e){return _c(e,this.singleRegex)}search(){}}function _c(t,e){const n=t.match(e);return n?n[1]:null}class dv extends dn{constructor(e){super(e)}static get type(){return"exact"}static get multiRegex(){return/^="(.*)"$/}static get singleRegex(){return/^=(.*)$/}search(e){const n=e===this.pattern;return{isMatch:n,score:n?0:1,indices:[0,this.pattern.length-1]}}}class mv extends dn{constructor(e){super(e)}static get type(){return"inverse-exact"}static get multiRegex(){return/^!"(.*)"$/}static get singleRegex(){return/^!(.*)$/}search(e){const i=e.indexOf(this.pattern)===-1;return{isMatch:i,score:i?0:1,indices:[0,e.length-1]}}}class pv extends dn{constructor(e){super(e)}static get type(){return"prefix-exact"}static get multiRegex(){return/^\^"(.*)"$/}static get singleRegex(){return/^\^(.*)$/}search(e){const n=e.startsWith(this.pattern);return{isMatch:n,score:n?0:1,indices:[0,this.pattern.length-1]}}}class gv extends dn{constructor(e){super(e)}static get type(){return"inverse-prefix-exact"}static get multiRegex(){return/^!\^"(.*)"$/}static get singleRegex(){return/^!\^(.*)$/}search(e){const n=!e.startsWith(this.pattern);return{isMatch:n,score:n?0:1,indices:[0,e.length-1]}}}class _v extends dn{constructor(e){super(e)}static get type(){return"suffix-exact"}static get multiRegex(){return/^"(.*)"\$$/}static get singleRegex(){return/^(.*)\$$/}search(e){const n=e.endsWith(this.pattern);return{isMatch:n,score:n?0:1,indices:[e.length-this.pattern.length,e.length-1]}}}class vv extends dn{constructor(e){super(e)}static get type(){return"inverse-suffix-exact"}static get multiRegex(){return/^!"(.*)"\$$/}static get singleRegex(){return/^!(.*)\$$/}search(e){const n=!e.endsWith(this.pattern);return{isMatch:n,score:n?0:1,indices:[0,e.length-1]}}}class vc extends dn{constructor(e,{location:n=ve.location,threshold:i=ve.threshold,distance:r=ve.distance,includeMatches:s=ve.includeMatches,findAllMatches:o=ve.findAllMatches,minMatchCharLength:l=ve.minMatchCharLength,isCaseSensitive:a=ve.isCaseSensitive,ignoreLocation:c=ve.ignoreLocation}={}){super(e),this._bitapSearch=new gc(e,{location:n,threshold:i,distance:r,includeMatches:s,findAllMatches:o,minMatchCharLength:l,isCaseSensitive:a,ignoreLocation:c})}static get type(){return"fuzzy"}static get multiRegex(){return/^"(.*)"$/}static get singleRegex(){return/^(.*)$/}search(e){return this._bitapSearch.searchIn(e)}}class yc extends dn{constructor(e){super(e)}static get type(){return"include"}static get multiRegex(){return/^'"(.*)"$/}static get singleRegex(){return/^'(.*)$/}search(e){let n=0,i;const r=[],s=this.pattern.length;for(;(i=e.indexOf(this.pattern,n))>-1;)n=i+s,r.push([i,n-1]);const o=!!r.length;return{isMatch:o,score:o?0:1,indices:r}}}const ps=[dv,yc,pv,gv,vv,_v,mv,vc],bc=ps.length,yv=/ +(?=(?:[^\"]*\"[^\"]*\")*[^\"]*$)/,bv="|";function wv(t,e={}){return t.split(bv).map(n=>{let i=n.trim().split(yv).filter(s=>s&&!!s.trim()),r=[];for(let s=0,o=i.length;s<o;s+=1){const l=i[s];let a=!1,c=-1;for(;!a&&++c<bc;){const u=ps[c];let h=u.isMultiMatch(l);h&&(r.push(new u(h,e)),a=!0)}if(!a)for(c=-1;++c<bc;){const u=ps[c];let h=u.isSingleMatch(l);if(h){r.push(new u(h,e));break}}}return r})}const Sv=new Set([vc.type,yc.type]);class kv{constructor(e,{isCaseSensitive:n=ve.isCaseSensitive,includeMatches:i=ve.includeMatches,minMatchCharLength:r=ve.minMatchCharLength,ignoreLocation:s=ve.ignoreLocation,findAllMatches:o=ve.findAllMatches,location:l=ve.location,threshold:a=ve.threshold,distance:c=ve.distance}={}){this.query=null,this.options={isCaseSensitive:n,includeMatches:i,minMatchCharLength:r,findAllMatches:o,ignoreLocation:s,location:l,threshold:a,distance:c},this.pattern=n?e:e.toLowerCase(),this.query=wv(this.pattern,this.options)}static condition(e,n){return n.useExtendedSearch}searchIn(e){const n=this.query;if(!n)return{isMatch:!1,score:1};const{includeMatches:i,isCaseSensitive:r}=this.options;e=r?e:e.toLowerCase();let s=0,o=[],l=0;for(let a=0,c=n.length;a<c;a+=1){const u=n[a];o.length=0,s=0;for(let h=0,f=u.length;h<f;h+=1){const d=u[h],{isMatch:m,indices:p,score:g}=d.search(e);if(m){if(s+=1,l+=g,i){const _=d.constructor.type;Sv.has(_)?o=[...o,...p]:o.push(p)}}else{l=0,s=0,o.length=0;break}}if(s){let h={isMatch:!0,score:l/s};return i&&(h.indices=o),h}}return{isMatch:!1,score:1}}}const gs=[];function Ev(...t){gs.push(...t)}function _s(t,e){for(let n=0,i=gs.length;n<i;n+=1){let r=gs[n];if(r.condition(t,e))return new r(t,e)}return new gc(t,e)}const fr={AND:"$and",OR:"$or"},vs={PATH:"$path",PATTERN:"$val"},ys=t=>!!(t[fr.AND]||t[fr.OR]),Cv=t=>!!t[vs.PATH],Iv=t=>!sn(t)&&uc(t)&&!ys(t),wc=t=>({[fr.AND]:Object.keys(t).map(e=>({[e]:t[e]}))});function Sc(t,e,{auto:n=!0}={}){const i=r=>{let s=Object.keys(r);const o=Cv(r);if(!o&&s.length>1&&!ys(r))return i(wc(r));if(Iv(r)){const a=o?r[vs.PATH]:s[0],c=o?r[vs.PATTERN]:r[a];if(!Gt(c))throw new Error(J1(a));const u={keyId:ds(a),pattern:c};return n&&(u.searcher=_s(c,e)),u}let l={children:[],operator:s[0]};return s.forEach(a=>{const c=r[a];sn(c)&&c.forEach(u=>{l.children.push(i(u))})}),l};return ys(t)||(t=wc(t)),i(t)}function Mv(t,{ignoreFieldNorm:e=ve.ignoreFieldNorm}){t.forEach(n=>{let i=1;n.matches.forEach(({key:r,norm:s,score:o})=>{const l=r?r.weight:null;i*=Math.pow(o===0&&l?Number.EPSILON:o,(l||1)*(e?1:s))}),n.score=i})}function xv(t,e){const n=t.matches;e.matches=[],Tt(n)&&n.forEach(i=>{if(!Tt(i.indices)||!i.indices.length)return;const{indices:r,value:s}=i;let o={indices:r,value:s};i.key&&(o.key=i.key.src),i.idx>-1&&(o.refIndex=i.idx),e.matches.push(o)})}function Av(t,e){e.score=t.score}function Tv(t,e,{includeMatches:n=ve.includeMatches,includeScore:i=ve.includeScore}={}){const r=[];return n&&r.push(xv),i&&r.push(Av),t.map(s=>{const{idx:o}=s,l={item:e[o],refIndex:o};return r.length&&r.forEach(a=>{a(s,l)}),l})}class Yn{constructor(e,n={},i){this.options=Wn(Wn({},ve),n),this.options.useExtendedSearch,this._keyStore=new tv(this.options.keys),this.setCollection(e,i)}setCollection(e,n){if(this._docs=e,n&&!(n instanceof ms))throw new Error(X1);this._myIndex=n||pc(this.options.keys,this._docs,{getFn:this.options.getFn,fieldNormWeight:this.options.fieldNormWeight})}add(e){Tt(e)&&(this._docs.push(e),this._myIndex.add(e))}remove(e=()=>!1){const n=[];for(let i=0,r=this._docs.length;i<r;i+=1){const s=this._docs[i];e(s,i)&&(this.removeAt(i),i-=1,r-=1,n.push(s))}return n}removeAt(e){this._docs.splice(e,1),this._myIndex.removeAt(e)}getIndex(){return this._myIndex}search(e,{limit:n=-1}={}){const{includeMatches:i,includeScore:r,shouldSort:s,sortFn:o,ignoreFieldNorm:l}=this.options;let a=Gt(e)?Gt(this._docs[0])?this._searchStringList(e):this._searchObjectList(e):this._searchLogical(e);return Mv(a,{ignoreFieldNorm:l}),s&&a.sort(o),cc(n)&&n>-1&&(a=a.slice(0,n)),Tv(a,this._docs,{includeMatches:i,includeScore:r})}_searchStringList(e){const n=_s(e,this.options),{records:i}=this._myIndex,r=[];return i.forEach(({v:s,i:o,n:l})=>{if(!Tt(s))return;const{isMatch:a,score:c,indices:u}=n.searchIn(s);a&&r.push({item:s,idx:o,matches:[{score:c,value:s,norm:l,indices:u}]})}),r}_searchLogical(e){const n=Sc(e,this.options),i=(l,a,c)=>{if(!l.children){const{keyId:h,searcher:f}=l,d=this._findMatches({key:this._keyStore.get(h),value:this._myIndex.getValueForItemAtKeyId(a,h),searcher:f});return d&&d.length?[{idx:c,item:a,matches:d}]:[]}const u=[];for(let h=0,f=l.children.length;h<f;h+=1){const d=l.children[h],m=i(d,a,c);if(m.length)u.push(...m);else if(l.operator===fr.AND)return[]}return u},r=this._myIndex.records,s={},o=[];return r.forEach(({$:l,i:a})=>{if(Tt(l)){let c=i(n,l,a);c.length&&(s[a]||(s[a]={idx:a,item:l,matches:[]},o.push(s[a])),c.forEach(({matches:u})=>{s[a].matches.push(...u)}))}}),o}_searchObjectList(e){const n=_s(e,this.options),{keys:i,records:r}=this._myIndex,s=[];return r.forEach(({$:o,i:l})=>{if(!Tt(o))return;let a=[];i.forEach((c,u)=>{a.push(...this._findMatches({key:c,value:o[u],searcher:n}))}),a.length&&s.push({idx:l,item:o,matches:a})}),s}_findMatches({key:e,value:n,searcher:i}){if(!Tt(n))return[];let r=[];if(sn(n))n.forEach(({v:s,i:o,n:l})=>{if(!Tt(s))return;const{isMatch:a,score:c,indices:u}=i.searchIn(s);a&&r.push({score:c,key:e,value:s,idx:o,norm:l,indices:u})});else{const{v:s,n:o}=n,{isMatch:l,score:a,indices:c}=i.searchIn(s);l&&r.push({score:a,key:e,value:s,norm:o,indices:c})}return r}}Yn.version="7.0.0",Yn.createIndex=pc,Yn.parseIndex=cv,Yn.config=ve,Yn.parseQuery=Sc,Ev(kv);var Nv=function(){function t(e){this._haystack=[],this._fuseOptions=kt(kt({},e.fuseOptions),{keys:h1([],e.searchFields,!0),includeMatches:!0})}return t.prototype.index=function(e){this._haystack=e,this._fuse&&this._fuse.setCollection(e)},t.prototype.reset=function(){this._haystack=[],this._fuse=void 0},t.prototype.isEmptyIndex=function(){return!this._haystack.length},t.prototype.search=function(e){this._fuse||(this._fuse=new Yn(this._haystack,this._fuseOptions));var n=this._fuse.search(e);return n.map(function(i,r){return{item:i.item,score:i.score||0,rank:r+1}})},t}();function Ov(t){return new Nv(t)}var Pv=function(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0},bs=function(t,e,n){var i=t.dataset,r=e.customProperties,s=e.labelClass,o=e.labelDescription;s&&(i.labelClass=cr(s).join(" ")),o&&(i.labelDescription=o),n&&r&&(typeof r=="string"?i.customProperties=r:typeof r=="object"&&!Pv(r)&&(i.customProperties=JSON.stringify(r)))},kc=function(t,e,n){var i=e&&t.querySelector("label[for='".concat(e,"']")),r=i&&i.innerText;r&&n.setAttribute("aria-label",r)},Lv={containerOuter:function(t,e,n,i,r,s,o){var l=t.classNames.containerOuter,a=document.createElement("div");return ke(a,l),a.dataset.type=s,e&&(a.dir=e),i&&(a.tabIndex=0),n&&(a.setAttribute("role",r?"combobox":"listbox"),r?a.setAttribute("aria-autocomplete","list"):o||kc(this._docRoot,this.passedElement.element.id,a),a.setAttribute("aria-haspopup","true"),a.setAttribute("aria-expanded","false")),o&&a.setAttribute("aria-labelledby",o),a},containerInner:function(t){var e=t.classNames.containerInner,n=document.createElement("div");return ke(n,e),n},itemList:function(t,e){var n=t.searchEnabled,i=t.classNames,r=i.list,s=i.listSingle,o=i.listItems,l=document.createElement("div");return ke(l,r),ke(l,e?s:o),this._isSelectElement&&n&&l.setAttribute("role","listbox"),l},placeholder:function(t,e){var n=t.allowHTML,i=t.classNames.placeholder,r=document.createElement("div");return ke(r,i),rn(r,n,e),r},item:function(t,e,n){var i=t.allowHTML,r=t.removeItemButtonAlignLeft,s=t.removeItemIconText,o=t.removeItemLabelText,l=t.classNames,a=l.item,c=l.button,u=l.highlightedState,h=l.itemSelectable,f=l.placeholder,d=Sn(e.value),m=document.createElement("div");if(ke(m,a),e.labelClass){var p=document.createElement("span");rn(p,i,e.label),ke(p,e.labelClass),m.appendChild(p)}else rn(m,i,e.label);if(m.dataset.item="",m.dataset.id=e.id,m.dataset.value=d,bs(m,e,!0),(e.disabled||this.containerOuter.isDisabled)&&m.setAttribute("aria-disabled","true"),this._isSelectElement&&(m.setAttribute("aria-selected","true"),m.setAttribute("role","option")),e.placeholder&&(ke(m,f),m.dataset.placeholder=""),ke(m,e.highlighted?u:h),n){e.disabled&&Wt(m,h),m.dataset.deletable="";var g=document.createElement("button");g.type="button",ke(g,c),rn(g,!0,mi(s,e.value));var _=mi(o,e.value);_&&g.setAttribute("aria-label",_),g.dataset.button="",r?m.insertAdjacentElement("afterbegin",g):m.appendChild(g)}return m},choiceList:function(t,e){var n=t.classNames.list,i=document.createElement("div");return ke(i,n),e||i.setAttribute("aria-multiselectable","true"),i.setAttribute("role","listbox"),i},choiceGroup:function(t,e){var n=t.allowHTML,i=t.classNames,r=i.group,s=i.groupHeading,o=i.itemDisabled,l=e.id,a=e.label,c=e.disabled,u=Sn(a),h=document.createElement("div");ke(h,r),c&&ke(h,o),h.setAttribute("role","group"),h.dataset.group="",h.dataset.id=l,h.dataset.value=u,c&&h.setAttribute("aria-disabled","true");var f=document.createElement("div");return ke(f,s),rn(f,n,a||""),h.appendChild(f),h},choice:function(t,e,n,i){var r=t.allowHTML,s=t.classNames,o=s.item,l=s.itemChoice,a=s.itemSelectable,c=s.selectedState,u=s.itemDisabled,h=s.description,f=s.placeholder,d=e.label,m=Sn(e.value),p=document.createElement("div");p.id=e.elementId,ke(p,o),ke(p,l),i&&typeof d=="string"&&(d=fs(r,d),d+=" (".concat(i,")"),d={trusted:d});var g=p;if(e.labelClass){var _=document.createElement("span");rn(_,r,d),ke(_,e.labelClass),g=_,p.appendChild(_)}else rn(p,r,d);if(e.labelDescription){var k="".concat(e.elementId,"-description");g.setAttribute("aria-describedby",k);var E=document.createElement("span");rn(E,r,e.labelDescription),E.id=k,ke(E,h),p.appendChild(E)}return e.selected&&ke(p,c),e.placeholder&&ke(p,f),p.setAttribute("role",e.group?"treeitem":"option"),p.dataset.choice="",p.dataset.id=e.id,p.dataset.value=m,n&&(p.dataset.selectText=n),e.group&&(p.dataset.groupId="".concat(e.group.id)),bs(p,e,!1),e.disabled?(ke(p,u),p.dataset.choiceDisabled="",p.setAttribute("aria-disabled","true")):(ke(p,a),p.dataset.choiceSelectable=""),p},input:function(t,e){var n=t.classNames,i=n.input,r=n.inputCloned,s=t.labelId,o=document.createElement("input");return o.type="search",ke(o,i),ke(o,r),o.autocomplete="off",o.autocapitalize="off",o.spellcheck=!1,o.setAttribute("aria-autocomplete","list"),e?o.setAttribute("aria-label",e):s||kc(this._docRoot,this.passedElement.element.id,o),o},dropdown:function(t){var e=t.classNames,n=e.list,i=e.listDropdown,r=document.createElement("div");return ke(r,n),ke(r,i),r.setAttribute("aria-expanded","false"),r},notice:function(t,e,n){var i=t.classNames,r=i.item,s=i.itemChoice,o=i.addChoice,l=i.noResults,a=i.noChoices,c=i.notice;n===void 0&&(n=lt.generic);var u=document.createElement("div");switch(rn(u,!0,e),ke(u,r),ke(u,s),ke(u,c),n){case lt.addChoice:ke(u,o);break;case lt.noResults:ke(u,l);break;case lt.noChoices:ke(u,a);break}return n===lt.addChoice&&(u.dataset.choiceSelectable="",u.dataset.choice=""),u},option:function(t){var e=Sn(t.label),n=new Option(e,t.value,!1,t.selected);return bs(n,t,!0),n.disabled=t.disabled,t.selected&&n.setAttribute("selected",""),n}},Rv="-ms-scroll-limit"in document.documentElement.style&&"-ms-ime-align"in document.documentElement.style,Dv={},ws=function(t){if(t)return t.dataset.id?parseInt(t.dataset.id,10):void 0},_i="[data-choice-selectable]",$v=function(){function t(e,n){e===void 0&&(e="[data-choice]"),n===void 0&&(n={});var i=this;this.initialisedOK=void 0,this._hasNonChoicePlaceholder=!1,this._lastAddedChoiceId=0,this._lastAddedGroupId=0;var r=t.defaults;this.config=kt(kt(kt({},r.allOptions),r.options),n),d1.forEach(function(_){i.config[_]=kt(kt(kt({},r.allOptions[_]),r.options[_]),n[_])});var s=this.config;s.silent||this._validateConfig();var o=s.shadowRoot||document.documentElement;this._docRoot=o;var l=typeof e=="string"?o.querySelector(e):e;if(!l||typeof l!="object"||!(P1(l)||rc(l)))throw TypeError(!l&&typeof e=="string"?"Selector ".concat(e," failed to find an element"):"Expected one of the following types text|select-one|select-multiple");var a=l.type,c=a===hn.Text;(c||s.maxItemCount!==1)&&(s.singleModeForMultiSelect=!1),s.singleModeForMultiSelect&&(a=hn.SelectMultiple);var u=a===hn.SelectOne,h=a===hn.SelectMultiple,f=u||h;if(this._elementType=a,this._isTextElement=c,this._isSelectOneElement=u,this._isSelectMultipleElement=h,this._isSelectElement=u||h,this._canAddUserChoices=c&&s.addItems||f&&s.addChoices,typeof s.renderSelectedChoices!="boolean"&&(s.renderSelectedChoices=s.renderSelectedChoices==="always"||u),s.closeDropdownOnSelect==="auto"?s.closeDropdownOnSelect=c||u||s.singleModeForMultiSelect:s.closeDropdownOnSelect=gi(s.closeDropdownOnSelect),s.placeholder&&(s.placeholderValue?this._hasNonChoicePlaceholder=!0:l.dataset.placeholder&&(this._hasNonChoicePlaceholder=!0,s.placeholderValue=l.dataset.placeholder)),n.addItemFilter&&typeof n.addItemFilter!="function"){var d=n.addItemFilter instanceof RegExp?n.addItemFilter:new RegExp(n.addItemFilter);s.addItemFilter=d.test.bind(d)}if(this._isTextElement)this.passedElement=new O1({element:l,classNames:s.classNames});else{var m=l;this.passedElement=new D1({element:m,classNames:s.classNames,template:function(_){return i._templates.option(_)},extractPlaceholder:s.placeholder&&!this._hasNonChoicePlaceholder})}if(this.initialised=!1,this._store=new V1(s),this._currentValue="",s.searchEnabled=!c&&s.searchEnabled||h,this._canSearch=s.searchEnabled,this._isScrollingOnIe=!1,this._highlightPosition=0,this._wasTap=!0,this._placeholderValue=this._generatePlaceholderValue(),this._baseId=y1(l,"choices-"),this._direction=l.dir,!this._direction){var p=window.getComputedStyle(l).direction,g=window.getComputedStyle(document.documentElement).direction;p!==g&&(this._direction=p)}if(this._idNames={itemChoice:"item-choice"},this._templates=r.templates,this._render=this._render.bind(this),this._onFocus=this._onFocus.bind(this),this._onBlur=this._onBlur.bind(this),this._onKeyUp=this._onKeyUp.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onInput=this._onInput.bind(this),this._onClick=this._onClick.bind(this),this._onTouchMove=this._onTouchMove.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._onMouseDown=this._onMouseDown.bind(this),this._onMouseOver=this._onMouseOver.bind(this),this._onFormReset=this._onFormReset.bind(this),this._onSelectKey=this._onSelectKey.bind(this),this._onEnterKey=this._onEnterKey.bind(this),this._onEscapeKey=this._onEscapeKey.bind(this),this._onDirectionKey=this._onDirectionKey.bind(this),this._onDeleteKey=this._onDeleteKey.bind(this),this.passedElement.isActive){s.silent||console.warn("Trying to initialise Choices on element already initialised",{element:e}),this.initialised=!0,this.initialisedOK=!1;return}this.init(),this._initialItems=this._store.items.map(function(_){return _.value})}return Object.defineProperty(t,"defaults",{get:function(){return Object.preventExtensions({get options(){return Dv},get allOptions(){return sc},get templates(){return Lv}})},enumerable:!1,configurable:!0}),t.prototype.init=function(){if(!(this.initialised||this.initialisedOK!==void 0)){this._searcher=Ov(this.config),this._loadChoices(),this._createTemplates(),this._createElements(),this._createStructure(),this._isTextElement&&!this.config.addItems||this.passedElement.element.hasAttribute("disabled")||this.passedElement.element.closest("fieldset:disabled")?this.disable():(this.enable(),this._addEventListeners()),this._initStore(),this.initialised=!0,this.initialisedOK=!0;var e=this.config.callbackOnInit;typeof e=="function"&&e.call(this)}},t.prototype.destroy=function(){this.initialised&&(this._removeEventListeners(),this.passedElement.reveal(),this.containerOuter.unwrap(this.passedElement.element),this._store._listeners=[],this.clearStore(!1),this._stopSearch(),this._templates=t.defaults.templates,this.initialised=!1,this.initialisedOK=void 0)},t.prototype.enable=function(){return this.passedElement.isDisabled&&this.passedElement.enable(),this.containerOuter.isDisabled&&(this._addEventListeners(),this.input.enable(),this.containerOuter.enable()),this},t.prototype.disable=function(){return this.passedElement.isDisabled||this.passedElement.disable(),this.containerOuter.isDisabled||(this._removeEventListeners(),this.input.disable(),this.containerOuter.disable()),this},t.prototype.highlightItem=function(e,n){if(n===void 0&&(n=!0),!e||!e.id)return this;var i=this._store.items.find(function(r){return r.id===e.id});return!i||i.highlighted?this:(this._store.dispatch(lr(i,!0)),n&&this.passedElement.triggerEvent(Et.highlightItem,this._getChoiceForOutput(i)),this)},t.prototype.unhighlightItem=function(e,n){if(n===void 0&&(n=!0),!e||!e.id)return this;var i=this._store.items.find(function(r){return r.id===e.id});return!i||!i.highlighted?this:(this._store.dispatch(lr(i,!1)),n&&this.passedElement.triggerEvent(Et.unhighlightItem,this._getChoiceForOutput(i)),this)},t.prototype.highlightAll=function(){var e=this;return this._store.withTxn(function(){e._store.items.forEach(function(n){n.highlighted||(e._store.dispatch(lr(n,!0)),e.passedElement.triggerEvent(Et.highlightItem,e._getChoiceForOutput(n)))})}),this},t.prototype.unhighlightAll=function(){var e=this;return this._store.withTxn(function(){e._store.items.forEach(function(n){n.highlighted&&(e._store.dispatch(lr(n,!1)),e.passedElement.triggerEvent(Et.highlightItem,e._getChoiceForOutput(n)))})}),this},t.prototype.removeActiveItemsByValue=function(e){var n=this;return this._store.withTxn(function(){n._store.items.filter(function(i){return i.value===e}).forEach(function(i){return n._removeItem(i)})}),this},t.prototype.removeActiveItems=function(e){var n=this;return this._store.withTxn(function(){n._store.items.filter(function(i){var r=i.id;return r!==e}).forEach(function(i){return n._removeItem(i)})}),this},t.prototype.removeHighlightedItems=function(e){var n=this;return e===void 0&&(e=!1),this._store.withTxn(function(){n._store.highlightedActiveItems.forEach(function(i){n._removeItem(i),e&&n._triggerChange(i.value)})}),this},t.prototype.showDropdown=function(e){var n=this;return this.dropdown.isActive?this:(e===void 0&&(e=!this._canSearch),requestAnimationFrame(function(){n.dropdown.show();var i=n.dropdown.element.getBoundingClientRect();n.containerOuter.open(i.bottom,i.height),e||n.input.focus(),n.passedElement.triggerEvent(Et.showDropdown)}),this)},t.prototype.hideDropdown=function(e){var n=this;return this.dropdown.isActive?(requestAnimationFrame(function(){n.dropdown.hide(),n.containerOuter.close(),!e&&n._canSearch&&(n.input.removeActiveDescendant(),n.input.blur()),n.passedElement.triggerEvent(Et.hideDropdown)}),this):this},t.prototype.getValue=function(e){var n=this,i=this._store.items.map(function(r){return e?r.value:n._getChoiceForOutput(r)});return this._isSelectOneElement||this.config.singleModeForMultiSelect?i[0]:i},t.prototype.setValue=function(e){var n=this;return this.initialisedOK?(this._store.withTxn(function(){e.forEach(function(i){i&&n._addChoice(Yt(i,!1))})}),this._searcher.reset(),this):(this._warnChoicesInitFailed("setValue"),this)},t.prototype.setChoiceByValue=function(e){var n=this;return this.initialisedOK?this._isTextElement?this:(this._store.withTxn(function(){var i=Array.isArray(e)?e:[e];i.forEach(function(r){return n._findAndSelectChoiceByValue(r)}),n.unhighlightAll()}),this._searcher.reset(),this):(this._warnChoicesInitFailed("setChoiceByValue"),this)},t.prototype.setChoices=function(e,n,i,r,s,o){var l=this;if(e===void 0&&(e=[]),n===void 0&&(n="value"),i===void 0&&(i="label"),r===void 0&&(r=!1),s===void 0&&(s=!0),o===void 0&&(o=!1),!this.initialisedOK)return this._warnChoicesInitFailed("setChoices"),this;if(!this._isSelectElement)throw new TypeError("setChoices can't be used with INPUT based Choices");if(typeof n!="string"||!n)throw new TypeError("value parameter must be a name of 'value' field in passed objects");if(typeof e=="function"){var a=e(this);if(typeof Promise=="function"&&a instanceof Promise)return new Promise(function(c){return requestAnimationFrame(c)}).then(function(){return l._handleLoadingState(!0)}).then(function(){return a}).then(function(c){return l.setChoices(c,n,i,r,s,o)}).catch(function(c){l.config.silent||console.error(c)}).then(function(){return l._handleLoadingState(!1)}).then(function(){return l});if(!Array.isArray(a))throw new TypeError(".setChoices first argument function must return either array of choices or Promise, got: ".concat(typeof a));return this.setChoices(a,n,i,!1)}if(!Array.isArray(e))throw new TypeError(".setChoices must be called either with array of choices with a function resulting into Promise of array of choices");return this.containerOuter.removeLoadingState(),this._store.withTxn(function(){s&&(l._isSearching=!1),r&&l.clearChoices(!0,o);var c=n==="value",u=i==="label";e.forEach(function(h){if("choices"in h){var f=h;u||(f=kt(kt({},f),{label:f[i]})),l._addGroup(Yt(f,!0))}else{var d=h;(!u||!c)&&(d=kt(kt({},d),{value:d[n],label:d[i]}));var m=Yt(d,!1);l._addChoice(m),m.placeholder&&!l._hasNonChoicePlaceholder&&(l._placeholderValue=Za(m.label))}}),l.unhighlightAll()}),this._searcher.reset(),this},t.prototype.refresh=function(e,n,i){var r=this;return e===void 0&&(e=!1),n===void 0&&(n=!1),i===void 0&&(i=!1),this._isSelectElement?(this._store.withTxn(function(){var s=r.passedElement.optionsAsChoices(),o={};i||r._store.items.forEach(function(a){a.id&&a.active&&a.selected&&(o[a.value]=!0)}),r.clearStore(!1);var l=function(a){i?r._store.dispatch(Xa(a)):o[a.value]&&(a.selected=!0)};s.forEach(function(a){if("choices"in a){a.choices.forEach(l);return}l(a)}),r._addPredefinedChoices(s,n,e),r._isSearching&&r._searchChoices(r.input.value)}),this):(this.config.silent||console.warn("refresh method can only be used on choices backed by a <select> element"),this)},t.prototype.removeChoice=function(e){var n=this._store.choices.find(function(i){return i.value===e});return n?(this._clearNotice(),this._store.dispatch(m1(n)),this._searcher.reset(),n.selected&&this.passedElement.triggerEvent(Et.removeItem,this._getChoiceForOutput(n)),this):this},t.prototype.clearChoices=function(e,n){var i=this;return e===void 0&&(e=!0),n===void 0&&(n=!1),e&&(n?this.passedElement.element.replaceChildren(""):this.passedElement.element.querySelectorAll(":not([selected])").forEach(function(r){r.remove()})),this.itemList.element.replaceChildren(""),this.choiceList.element.replaceChildren(""),this._clearNotice(),this._store.withTxn(function(){var r=n?[]:i._store.items;i._store.reset(),r.forEach(function(s){i._store.dispatch(Ya(s)),i._store.dispatch(Ga(s))})}),this._searcher.reset(),this},t.prototype.clearStore=function(e){return e===void 0&&(e=!0),this.clearChoices(e,!0),this._stopSearch(),this._lastAddedChoiceId=0,this._lastAddedGroupId=0,this},t.prototype.clearInput=function(){var e=!this._isSelectOneElement;return this.input.clear(e),this._stopSearch(),this},t.prototype._validateConfig=function(){var e=this.config,n=I1(e,sc);n.length&&console.warn("Unknown config option(s) passed",n.join(", ")),e.allowHTML&&e.allowHtmlUserInput&&(e.addItems&&console.warn("Warning: allowHTML/allowHtmlUserInput/addItems all being true is strongly not recommended and may lead to XSS attacks"),e.addChoices&&console.warn("Warning: allowHTML/allowHtmlUserInput/addChoices all being true is strongly not recommended and may lead to XSS attacks"))},t.prototype._render=function(e){e===void 0&&(e={choices:!0,groups:!0,items:!0}),!this._store.inTxn()&&(this._isSelectElement&&(e.choices||e.groups)&&this._renderChoices(),e.items&&this._renderItems())},t.prototype._renderChoices=function(){var e=this;if(this._canAddItems()){var n=this,i=n.config,r=n._isSearching,s=this._store,o=s.activeGroups,l=s.activeChoices,a=0;if(r&&i.searchResultLimit>0?a=i.searchResultLimit:i.renderChoiceLimit>0&&(a=i.renderChoiceLimit),this._isSelectElement){var c=l.filter(function(m){return!m.element});c.length&&this.passedElement.addOptions(c)}var u=document.createDocumentFragment(),h=function(m){return m.filter(function(p){return!p.placeholder&&(r?!!p.rank:i.renderSelectedChoices||!p.selected)})},f=!1,d=function(m,p,g){r?m.sort(E1):i.shouldSort&&m.sort(i.sorter);var _=m.length;_=!p&&a&&_>a?a:_,_--,m.every(function(k,E){var b=k.choiceEl||e._templates.choice(i,k,i.itemSelectText,g);return k.choiceEl=b,u.appendChild(b),(r||!k.selected)&&(f=!0),E<_})};l.length&&(i.resetScrollPosition&&requestAnimationFrame(function(){return e.choiceList.scrollToTop()}),!this._hasNonChoicePlaceholder&&!r&&this._isSelectOneElement&&d(l.filter(function(m){return m.placeholder&&!m.group}),!1,void 0),o.length&&!r?(i.shouldSort&&o.sort(i.sorter),d(l.filter(function(m){return!m.placeholder&&!m.group}),!1,void 0),o.forEach(function(m){var p=h(m.choices);if(p.length){if(m.label){var g=m.groupEl||e._templates.choiceGroup(e.config,m);m.groupEl=g,g.remove(),u.appendChild(g)}d(p,!0,i.appendGroupInSearch&&r?m.label:void 0)}})):d(h(l),!1,void 0)),!f&&(r||!u.children.length||!i.renderSelectedChoices)&&(this._notice||(this._notice={text:Qa(r?i.noResultsText:i.noChoicesText),type:r?lt.noResults:lt.noChoices}),u.replaceChildren("")),this._renderNotice(u),this.choiceList.element.replaceChildren(u),f&&this._highlightChoice()}},t.prototype._renderItems=function(){var e=this,n=this._store.items||[],i=this.itemList.element,r=this.config,s=document.createDocumentFragment(),o=function(h){return i.querySelector('[data-item][data-id="'.concat(h.id,'"]'))},l=function(h){var f=h.itemEl;f&&f.parentElement||(f=o(h)||e._templates.item(r,h,r.removeItemButton),h.itemEl=f,s.appendChild(f))};n.forEach(l);var a=!!s.childNodes.length;if(this._isSelectOneElement){var c=i.children.length;if(a||c>1){var u=i.querySelector(pi(r.classNames.placeholder));u&&u.remove()}else!a&&!c&&this._placeholderValue&&(a=!0,l(Yt({selected:!0,value:"",label:this._placeholderValue,placeholder:!0},!1)))}a&&(i.append(s),r.shouldSortItems&&!this._isSelectOneElement&&(n.sort(r.sorter),n.forEach(function(h){var f=o(h);f&&(f.remove(),s.append(f))}),i.append(s))),this._isTextElement&&(this.passedElement.value=n.map(function(h){var f=h.value;return f}).join(r.delimiter))},t.prototype._displayNotice=function(e,n,i){i===void 0&&(i=!0);var r=this._notice;if(r&&(r.type===n&&r.text===e||r.type===lt.addChoice&&(n===lt.noResults||n===lt.noChoices))){i&&this.showDropdown(!0);return}this._clearNotice(),this._notice=e?{text:e,type:n}:void 0,this._renderNotice(),i&&e&&this.showDropdown(!0)},t.prototype._clearNotice=function(){if(this._notice){var e=this.choiceList.element.querySelector(pi(this.config.classNames.notice));e&&e.remove(),this._notice=void 0}},t.prototype._renderNotice=function(e){var n=this._notice;if(n){var i=this._templates.notice(this.config,n.text,n.type);e?e.append(i):this.choiceList.prepend(i)}},t.prototype._getChoiceForOutput=function(e,n){return{id:e.id,highlighted:e.highlighted,labelClass:e.labelClass,labelDescription:e.labelDescription,customProperties:e.customProperties,disabled:e.disabled,active:e.active,label:e.label,placeholder:e.placeholder,value:e.value,groupValue:e.group?e.group.label:void 0,element:e.element,keyCode:n}},t.prototype._triggerChange=function(e){e!=null&&this.passedElement.triggerEvent(Et.change,{value:e})},t.prototype._handleButtonAction=function(e){var n=this,i=this._store.items;if(!(!i.length||!this.config.removeItems||!this.config.removeItemButton)){var r=e&&ws(e.parentElement),s=r&&i.find(function(o){return o.id===r});s&&this._store.withTxn(function(){if(n._removeItem(s),n._triggerChange(s.value),n._isSelectOneElement&&!n._hasNonChoicePlaceholder){var o=(n.config.shouldSort?n._store.choices.reverse():n._store.choices).find(function(l){return l.placeholder});o&&(n._addItem(o),n.unhighlightAll(),o.value&&n._triggerChange(o.value))}})}},t.prototype._handleItemAction=function(e,n){var i=this;n===void 0&&(n=!1);var r=this._store.items;if(!(!r.length||!this.config.removeItems||this._isSelectOneElement)){var s=ws(e);s&&(r.forEach(function(o){o.id===s&&!o.highlighted?i.highlightItem(o):!n&&o.highlighted&&i.unhighlightItem(o)}),this.input.focus())}},t.prototype._handleChoiceAction=function(e){var n=this,i=ws(e),r=i&&this._store.getChoiceById(i);if(!r||r.disabled)return!1;var s=this.dropdown.isActive;if(!r.selected){if(!this._canAddItems())return!0;this._store.withTxn(function(){n._addItem(r,!0,!0),n.clearInput(),n.unhighlightAll()}),this._triggerChange(r.value)}return s&&this.config.closeDropdownOnSelect&&(this.hideDropdown(!0),this.containerOuter.element.focus()),!0},t.prototype._handleBackspace=function(e){var n=this.config;if(!(!n.removeItems||!e.length)){var i=e[e.length-1],r=e.some(function(s){return s.highlighted});n.editItems&&!r&&i?(this.input.value=i.value,this.input.setWidth(),this._removeItem(i),this._triggerChange(i.value)):(r||this.highlightItem(i,!1),this.removeHighlightedItems(!0))}},t.prototype._loadChoices=function(){var e,n=this,i=this.config;if(this._isTextElement){if(this._presetChoices=i.items.map(function(o){return Yt(o,!1)}),this.passedElement.value){var r=this.passedElement.value.split(i.delimiter).map(function(o){return Yt(o,!1,n.config.allowHtmlUserInput)});this._presetChoices=this._presetChoices.concat(r)}this._presetChoices.forEach(function(o){o.selected=!0})}else if(this._isSelectElement){this._presetChoices=i.choices.map(function(o){return Yt(o,!0)});var s=this.passedElement.optionsAsChoices();s&&(e=this._presetChoices).push.apply(e,s)}},t.prototype._handleLoadingState=function(e){e===void 0&&(e=!0);var n=this.itemList.element;e?(this.disable(),this.containerOuter.addLoadingState(),this._isSelectOneElement?n.replaceChildren(this._templates.placeholder(this.config,this.config.loadingText)):this.input.placeholder=this.config.loadingText):(this.enable(),this.containerOuter.removeLoadingState(),this._isSelectOneElement?(n.replaceChildren(""),this._render()):this.input.placeholder=this._placeholderValue||"")},t.prototype._handleSearch=function(e){if(this.input.isFocussed)if(e!==null&&typeof e<"u"&&e.length>=this.config.searchFloor){var n=this.config.searchChoices?this._searchChoices(e):0;n!==null&&this.passedElement.triggerEvent(Et.search,{value:e,resultCount:n})}else this._store.choices.some(function(i){return!i.active})&&this._stopSearch()},t.prototype._canAddItems=function(){var e=this.config,n=e.maxItemCount,i=e.maxItemText;return!e.singleModeForMultiSelect&&n>0&&n<=this._store.items.length?(this.choiceList.element.replaceChildren(""),this._notice=void 0,this._displayNotice(typeof i=="function"?i(n):i,lt.addChoice),!1):(this._notice&&this._notice.type===lt.addChoice&&this._clearNotice(),!0)},t.prototype._canCreateItem=function(e){var n=this.config,i=!0,r="";if(i&&typeof n.addItemFilter=="function"&&!n.addItemFilter(e)&&(i=!1,r=mi(n.customAddItemText,e)),i){var s=this._store.choices.find(function(o){return n.valueComparer(o.value,e)});if(s){if(this._isSelectElement)return this._displayNotice("",lt.addChoice),!1;n.duplicateItemsAllowed||(i=!1,r=mi(n.uniqueItemText,e))}}return i&&(r=mi(n.addItemText,e)),r&&this._displayNotice(r,lt.addChoice),i},t.prototype._searchChoices=function(e){var n=e.trim().replace(/\s{2,}/," ");if(!n.length||n===this._currentValue)return null;var i=this._searcher;i.isEmptyIndex()&&i.index(this._store.searchableChoices);var r=i.search(n);this._currentValue=n,this._highlightPosition=0,this._isSearching=!0;var s=this._notice,o=s&&s.type;return o!==lt.addChoice&&(r.length?this._clearNotice():this._displayNotice(Qa(this.config.noResultsText),lt.noResults)),this._store.dispatch(p1(r)),r.length},t.prototype._stopSearch=function(){this._isSearching&&(this._currentValue="",this._isSearching=!1,this._clearNotice(),this._store.dispatch(g1(!0)),this.passedElement.triggerEvent(Et.search,{value:"",resultCount:0}))},t.prototype._addEventListeners=function(){var e=this._docRoot,n=this.containerOuter.element,i=this.input.element;e.addEventListener("touchend",this._onTouchEnd,!0),n.addEventListener("keydown",this._onKeyDown,!0),n.addEventListener("mousedown",this._onMouseDown,!0),e.addEventListener("click",this._onClick,{passive:!0}),e.addEventListener("touchmove",this._onTouchMove,{passive:!0}),this.dropdown.element.addEventListener("mouseover",this._onMouseOver,{passive:!0}),this._isSelectOneElement&&(n.addEventListener("focus",this._onFocus,{passive:!0}),n.addEventListener("blur",this._onBlur,{passive:!0})),i.addEventListener("keyup",this._onKeyUp,{passive:!0}),i.addEventListener("input",this._onInput,{passive:!0}),i.addEventListener("focus",this._onFocus,{passive:!0}),i.addEventListener("blur",this._onBlur,{passive:!0}),i.form&&i.form.addEventListener("reset",this._onFormReset,{passive:!0}),this.input.addEventListeners()},t.prototype._removeEventListeners=function(){var e=this._docRoot,n=this.containerOuter.element,i=this.input.element;e.removeEventListener("touchend",this._onTouchEnd,!0),n.removeEventListener("keydown",this._onKeyDown,!0),n.removeEventListener("mousedown",this._onMouseDown,!0),e.removeEventListener("click",this._onClick),e.removeEventListener("touchmove",this._onTouchMove),this.dropdown.element.removeEventListener("mouseover",this._onMouseOver),this._isSelectOneElement&&(n.removeEventListener("focus",this._onFocus),n.removeEventListener("blur",this._onBlur)),i.removeEventListener("keyup",this._onKeyUp),i.removeEventListener("input",this._onInput),i.removeEventListener("focus",this._onFocus),i.removeEventListener("blur",this._onBlur),i.form&&i.form.removeEventListener("reset",this._onFormReset),this.input.removeEventListeners()},t.prototype._onKeyDown=function(e){var n=e.keyCode,i=this.dropdown.isActive,r=e.key.length===1||e.key.length===2&&e.key.charCodeAt(0)>=55296||e.key==="Unidentified";switch(!this._isTextElement&&!i&&n!==ft.ESC_KEY&&n!==ft.TAB_KEY&&n!==ft.SHIFT_KEY&&(this.showDropdown(),!this.input.isFocussed&&r&&(this.input.value+=e.key,e.key===" "&&e.preventDefault())),n){case ft.A_KEY:return this._onSelectKey(e,this.itemList.element.hasChildNodes());case ft.ENTER_KEY:return this._onEnterKey(e,i);case ft.ESC_KEY:return this._onEscapeKey(e,i);case ft.UP_KEY:case ft.PAGE_UP_KEY:case ft.DOWN_KEY:case ft.PAGE_DOWN_KEY:return this._onDirectionKey(e,i);case ft.DELETE_KEY:case ft.BACK_KEY:return this._onDeleteKey(e,this._store.items,this.input.isFocussed)}},t.prototype._onKeyUp=function(){this._canSearch=this.config.searchEnabled},t.prototype._onInput=function(){var e=this.input.value;if(!e){this._isTextElement?this.hideDropdown(!0):this._stopSearch();return}this._canAddItems()&&(this._canSearch&&this._handleSearch(e),this._canAddUserChoices&&(this._canCreateItem(e),this._isSelectElement&&(this._highlightPosition=0,this._highlightChoice())))},t.prototype._onSelectKey=function(e,n){if((e.ctrlKey||e.metaKey)&&n){this._canSearch=!1;var i=this.config.removeItems&&!this.input.value&&this.input.element===document.activeElement;i&&this.highlightAll()}},t.prototype._onEnterKey=function(e,n){var i=this,r=this.input.value,s=e.target;if(e.preventDefault(),s&&s.hasAttribute("data-button")){this._handleButtonAction(s);return}if(!n){(this._isSelectElement||this._notice)&&this.showDropdown();return}var o=this.dropdown.element.querySelector(pi(this.config.classNames.highlightedState));if(!(o&&this._handleChoiceAction(o))){if(!s||!r){this.hideDropdown(!0);return}if(this._canAddItems()){var l=!1;this._store.withTxn(function(){if(l=i._findAndSelectChoiceByValue(r,!0),!l){if(!i._canAddUserChoices||!i._canCreateItem(r))return;i._addChoice(Yt(r,!1,i.config.allowHtmlUserInput),!0,!0),l=!0}i.clearInput(),i.unhighlightAll()}),l&&(this._triggerChange(r),this.config.closeDropdownOnSelect&&this.hideDropdown(!0))}}},t.prototype._onEscapeKey=function(e,n){n&&(e.stopPropagation(),this.hideDropdown(!0),this._stopSearch(),this.containerOuter.element.focus())},t.prototype._onDirectionKey=function(e,n){var i=e.keyCode;if(n||this._isSelectOneElement){this.showDropdown(),this._canSearch=!1;var r=i===ft.DOWN_KEY||i===ft.PAGE_DOWN_KEY?1:-1,s=e.metaKey||i===ft.PAGE_DOWN_KEY||i===ft.PAGE_UP_KEY,o=void 0;if(s)r>0?o=this.dropdown.element.querySelector("".concat(_i,":last-of-type")):o=this.dropdown.element.querySelector(_i);else{var l=this.dropdown.element.querySelector(pi(this.config.classNames.highlightedState));l?o=b1(l,_i,r):o=this.dropdown.element.querySelector(_i)}o&&(w1(o,this.choiceList.element,r)||this.choiceList.scrollToChildElement(o,r),this._highlightChoice(o)),e.preventDefault()}},t.prototype._onDeleteKey=function(e,n,i){!this._isSelectOneElement&&!e.target.value&&i&&(this._handleBackspace(n),e.preventDefault())},t.prototype._onTouchMove=function(){this._wasTap&&(this._wasTap=!1)},t.prototype._onTouchEnd=function(e){var n=(e||e.touches[0]).target,i=this._wasTap&&this.containerOuter.element.contains(n);if(i){var r=n===this.containerOuter.element||n===this.containerInner.element;r&&(this._isTextElement?this.input.focus():this._isSelectMultipleElement&&this.showDropdown()),e.stopPropagation()}this._wasTap=!0},t.prototype._onMouseDown=function(e){var n=e.target;if(n instanceof HTMLElement){if(Rv&&this.choiceList.element.contains(n)){var i=this.choiceList.element.firstElementChild;this._isScrollingOnIe=this._direction==="ltr"?e.offsetX>=i.offsetWidth:e.offsetX<i.offsetLeft}if(n!==this.input.element){var r=n.closest("[data-button],[data-item],[data-choice]");r instanceof HTMLElement&&("button"in r.dataset?this._handleButtonAction(r):"item"in r.dataset?this._handleItemAction(r,e.shiftKey):"choice"in r.dataset&&this._handleChoiceAction(r)),e.preventDefault()}}},t.prototype._onMouseOver=function(e){var n=e.target;n instanceof HTMLElement&&"choice"in n.dataset&&this._highlightChoice(n)},t.prototype._onClick=function(e){var n=e.target,i=this.containerOuter,r=i.element.contains(n);r?!this.dropdown.isActive&&!i.isDisabled?this._isTextElement?document.activeElement!==this.input.element&&this.input.focus():(this.showDropdown(),i.element.focus()):this._isSelectOneElement&&n!==this.input.element&&!this.dropdown.element.contains(n)&&this.hideDropdown():(i.removeFocusState(),this.hideDropdown(!0),this.unhighlightAll())},t.prototype._onFocus=function(e){var n=e.target,i=this.containerOuter,r=n&&i.element.contains(n);if(r){var s=n===this.input.element;this._isTextElement?s&&i.addFocusState():this._isSelectMultipleElement?s&&(this.showDropdown(!0),i.addFocusState()):(i.addFocusState(),s&&this.showDropdown(!0))}},t.prototype._onBlur=function(e){var n=e.target,i=this.containerOuter,r=n&&i.element.contains(n);r&&!this._isScrollingOnIe?n===this.input.element?(i.removeFocusState(),this.hideDropdown(!0),(this._isTextElement||this._isSelectMultipleElement)&&this.unhighlightAll()):n===this.containerOuter.element&&(i.removeFocusState(),this._canSearch||this.hideDropdown(!0)):(this._isScrollingOnIe=!1,this.input.element.focus())},t.prototype._onFormReset=function(){var e=this;this._store.withTxn(function(){e.clearInput(),e.hideDropdown(),e.refresh(!1,!1,!0),e._initialItems.length&&e.setChoiceByValue(e._initialItems)})},t.prototype._highlightChoice=function(e){e===void 0&&(e=null);var n=Array.from(this.dropdown.element.querySelectorAll(_i));if(n.length){var i=e,r=this.config.classNames.highlightedState,s=Array.from(this.dropdown.element.querySelectorAll(pi(r)));s.forEach(function(o){Wt(o,r),o.setAttribute("aria-selected","false")}),i?this._highlightPosition=n.indexOf(i):(n.length>this._highlightPosition?i=n[this._highlightPosition]:i=n[n.length-1],i||(i=n[0])),ke(i,r),i.setAttribute("aria-selected","true"),this.passedElement.triggerEvent(Et.highlightChoice,{el:i}),this.dropdown.isActive&&(this.input.setActiveDescendant(i.id),this.containerOuter.setActiveDescendant(i.id))}},t.prototype._addItem=function(e,n,i){if(n===void 0&&(n=!0),i===void 0&&(i=!1),!e.id)throw new TypeError("item.id must be set before _addItem is called for a choice/item");(this.config.singleModeForMultiSelect||this._isSelectOneElement)&&this.removeActiveItems(e.id),this._store.dispatch(Ga(e)),n&&(this.passedElement.triggerEvent(Et.addItem,this._getChoiceForOutput(e)),i&&this.passedElement.triggerEvent(Et.choice,this._getChoiceForOutput(e)))},t.prototype._removeItem=function(e){if(e.id){this._store.dispatch(Xa(e));var n=this._notice;n&&n.type===lt.noChoices&&this._clearNotice(),this.passedElement.triggerEvent(Et.removeItem,this._getChoiceForOutput(e))}},t.prototype._addChoice=function(e,n,i){if(n===void 0&&(n=!0),i===void 0&&(i=!1),e.id)throw new TypeError("Can not re-add a choice which has already been added");var r=this.config;if(!(!r.duplicateItemsAllowed&&this._store.choices.find(function(l){return r.valueComparer(l.value,e.value)}))){this._lastAddedChoiceId++,e.id=this._lastAddedChoiceId,e.elementId="".concat(this._baseId,"-").concat(this._idNames.itemChoice,"-").concat(e.id);var s=r.prependValue,o=r.appendValue;s&&(e.value=s+e.value),o&&(e.value+=o.toString()),(s||o)&&e.element&&(e.element.value=e.value),this._clearNotice(),this._store.dispatch(Ya(e)),e.selected&&this._addItem(e,n,i)}},t.prototype._addGroup=function(e,n){var i=this;if(n===void 0&&(n=!0),e.id)throw new TypeError("Can not re-add a group which has already been added");this._store.dispatch(_1(e)),e.choices&&(this._lastAddedGroupId++,e.id=this._lastAddedGroupId,e.choices.forEach(function(r){r.group=e,e.disabled&&(r.disabled=!0),i._addChoice(r,n)}))},t.prototype._createTemplates=function(){var e=this,n=this.config.callbackOnCreateTemplates,i={};typeof n=="function"&&(i=n.call(this,S1,fs,cr));var r={};Object.keys(this._templates).forEach(function(s){s in i?r[s]=i[s].bind(e):r[s]=e._templates[s].bind(e)}),this._templates=r},t.prototype._createElements=function(){var e=this._templates,n=this,i=n.config,r=n._isSelectOneElement,s=i.position,o=i.classNames,l=this._elementType;this.containerOuter=new ec({element:e.containerOuter(i,this._direction,this._isSelectElement,r,i.searchEnabled,l,i.labelId),classNames:o,type:l,position:s}),this.containerInner=new ec({element:e.containerInner(i),classNames:o,type:l,position:s}),this.input=new T1({element:e.input(i,this._placeholderValue),classNames:o,type:l,preventPaste:!i.paste}),this.choiceList=new tc({element:e.choiceList(i,r)}),this.itemList=new tc({element:e.itemList(i,r)}),this.dropdown=new A1({element:e.dropdown(i),classNames:o,type:l})},t.prototype._createStructure=function(){var e=this,n=e.containerInner,i=e.containerOuter,r=e.passedElement,s=this.dropdown.element;r.conceal(),n.wrap(r.element),i.wrap(n.element),this._isSelectOneElement?this.input.placeholder=this.config.searchPlaceholderValue||"":(this._placeholderValue&&(this.input.placeholder=this._placeholderValue),this.input.setWidth()),i.element.appendChild(n.element),i.element.appendChild(s),n.element.appendChild(this.itemList.element),s.appendChild(this.choiceList.element),this._isSelectOneElement?this.config.searchEnabled&&s.insertBefore(this.input.element,s.firstChild):n.element.appendChild(this.input.element),this._highlightPosition=0,this._isSearching=!1},t.prototype._initStore=function(){var e=this;this._store.subscribe(this._render).withTxn(function(){e._addPredefinedChoices(e._presetChoices,e._isSelectOneElement&&!e._hasNonChoicePlaceholder,!1)}),(!this._store.choices.length||this._isSelectOneElement&&this._hasNonChoicePlaceholder)&&this._render()},t.prototype._addPredefinedChoices=function(e,n,i){var r=this;if(n===void 0&&(n=!1),i===void 0&&(i=!0),n){var s=e.findIndex(function(o){return o.selected})===-1;s&&e.some(function(o){return o.disabled||"choices"in o?!1:(o.selected=!0,!0)})}e.forEach(function(o){"choices"in o?r._isSelectElement&&r._addGroup(o,i):r._addChoice(o,i)})},t.prototype._findAndSelectChoiceByValue=function(e,n){var i=this;n===void 0&&(n=!1);var r=this._store.choices.find(function(s){return i.config.valueComparer(s.value,e)});return r&&!r.disabled&&!r.selected?(this._addItem(r,!0,n),!0):!1},t.prototype._generatePlaceholderValue=function(){var e=this.config;if(!e.placeholder)return null;if(this._hasNonChoicePlaceholder)return e.placeholderValue;if(this._isSelectElement){var n=this.passedElement.placeholderOption;return n?n.text:null}return null},t.prototype._warnChoicesInitFailed=function(e){if(!this.config.silent)if(this.initialised){if(!this.initialisedOK)throw new TypeError("".concat(e," called for an element which has multiple instances of Choices initialised on it"))}else throw new TypeError("".concat(e," called on a non-initialised instance of Choices"))},t.version="11.1.0",t}();const hb="",db="";function Ec(t){let e,n;return{c(){e=w("label"),n=oe(t[2]),v(e,"for",t[4])},m(i,r){j(i,e,r),y(e,n)},p(i,r){r&4&&Ce(n,i[2])},d(i){i&&z(e)}}}function zv(t){let e;return{c(){e=w("select"),v(e,"id",t[4]),v(e,"name",t[4]),v(e,"aria-label",t[2]),v(e,"class","m-1")},m(n,i){j(n,e,i)},p(n,i){i&4&&v(e,"aria-label",n[2])},i:ne,o:ne,d(n){n&&z(e)}}}function jv(t){let e,n,i,r=t[3].length&&Cc(t);return{c(){r&&r.c(),e=F(),n=w("select"),v(n,"id",t[4]),v(n,"name",t[4]),v(n,"aria-label",t[2]),v(n,"class","m-1"),n.multiple=!0},m(s,o){r&&r.m(s,o),j(s,e,o),j(s,n,o),i=!0},p(s,o){s[3].length?r?(r.p(s,o),o&8&&U(r,1)):(r=Cc(s),r.c(),U(r,1),r.m(e.parentNode,e)):r&&(Pe(),K(r,1,1,()=>{r=null}),Le()),(!i||o&4)&&v(n,"aria-label",s[2])},i(s){i||(U(r),i=!0)},o(s){K(r),i=!1},d(s){r&&r.d(s),s&&z(e),s&&z(n)}}}function Cc(t){let e,n,i=t[3].length+"",r,s,o,l;return o=new Pi({props:{targetHtmlId:t[5],tooltipText:`${t[3].length}
                                    ${W==="fr"&&t[3].length>1?"valeurs sélectionnées":W==="fr"&&t[3].length===1?"valeur sélectionnée":W==="en"&&t[3].length>1?"selected values":"selected value"}`}}),{c(){e=w("span"),n=w("span"),r=oe(i),s=F(),pe(o.$$.fragment),v(n,"id",t[5]),v(n,"class","input-dropdown-count tag m-1 svelte-1epfuu8"),v(e,"class","is-relative")},m(a,c){j(a,e,c),y(e,n),y(n,r),y(e,s),de(o,e,null),l=!0},p(a,c){(!l||c&8)&&i!==(i=a[3].length+"")&&Ce(r,i);const u={};c&8&&(u.tooltipText=`${a[3].length}
                                    ${W==="fr"&&a[3].length>1?"valeurs sélectionnées":W==="fr"&&a[3].length===1?"valeur sélectionnée":W==="en"&&a[3].length>1?"selected values":"selected value"}`),o.$set(u)},i(a){l||(U(o.$$.fragment,a),l=!0)},o(a){K(o.$$.fragment,a),l=!1},d(a){a&&z(e),me(o)}}}function Fv(t){let e,n,i,r,s,o,l,a=t[2]!==void 0&&Ec(t);const c=[jv,zv],u=[];function h(f,d){return f[0]?0:1}return r=h(t),s=u[r]=c[r](t),{c(){e=w("div"),a&&a.c(),n=F(),i=w("div"),s.c(),v(i,"class",o="input-dropdown-select "+(t[0]?"is-multiple":"is-single")+" "+(t[0]&&t[3].length?"is-flex is-justify-content-flex-start is-align-items-center":"")+" "+(t[1]?"light-display":"")+" svelte-1epfuu8"),v(e,"class","input-dropdown-select-wrapper")},m(f,d){j(f,e,d),a&&a.m(e,null),y(e,n),y(e,i),u[r].m(i,null),l=!0},p(f,[d]){f[2]!==void 0?a?a.p(f,d):(a=Ec(f),a.c(),a.m(e,n)):a&&(a.d(1),a=null);let m=r;r=h(f),r===m?u[r].p(f,d):(Pe(),K(u[m],1,1,()=>{u[m]=null}),Le(),s=u[r],s?s.p(f,d):(s=u[r]=c[r](f),s.c()),U(s,1),s.m(i,null)),(!l||d&11&&o!==(o="input-dropdown-select "+(f[0]?"is-multiple":"is-single")+" "+(f[0]&&f[3].length?"is-flex is-justify-content-flex-start is-align-items-center":"")+" "+(f[1]?"light-display":"")+" svelte-1epfuu8"))&&v(i,"class",o)},i(f){l||(U(s),l=!0)},o(f){K(s),l=!1},d(f){f&&z(e),a&&a.d(),u[r].d()}}}const Vv=250;function Hv(t,e,n){let i,r,{choicesItems:s}=e,{start:o=[]}=e,{multiple:l}=e,{searchable:a=!0}=e,{lightDisplay:c=!1}=e,{placeholder:u=W==="fr"?"Sélectionner une valeur":"Select a value"}=e,{title:h=void 0}=e,{selectAll:f=!!l}=e;const d=`input-dropdown-select-${window.crypto.randomUUID()}`,m=`input-dropdown-counter-${window.crypto.randomUUID()}`,p=`select-all-${window.crypto.randomUUID()}`,g=`unselect-all-${window.crypto.randomUUID()}`,_=Ii();let k;const E=xi();E.setCompareFn(kr);const b=xt("resetTrigger")||void 0;b==null||b.subscribe(()=>H(k,s,o,f));const S=()=>{n(11,r=!0),setTimeout(()=>n(11,r=!1),Vv)},T=(N,V)=>{V||(E.set(N),E.same()||_("updateValues",i))},M=N=>`<span class="iconify" data-icon=${N}/>`,C=(N,V)=>N!=null&&V!=null&&N.length&&V.length?`<span class="dropdown-prefix-wrapper">${V==="iconify"?M(N):N}</span>`:"",x=(N,V)=>V?[{value:p,label:`<b>${W==="fr"?"Tout sélectionner":"Select all"}</b>`},{value:g,label:`<b>${W==="fr"?"Tout retirer":"Remove all"}</b>`},...N]:N,P=(N,V)=>x(N,V).map(q=>(q.id=`dropdown-choice-${window.crypto.randomUUID()}`,q.label=`<span>
                ${C(q.prefix||"",q.prefixType||"")}
                <span class="dropdown-prefix-text">${q.label}</span>
            </span>`,q));function L(N,V,q){return N=structuredClone(N),V=structuredClone(V),N=P(N,q).map(B=>V.includes(B.value)?{...B,selected:!0}:{...B,selected:!1}),n(3,i=V),N}function H(N,V,q,B){N&&(V=L(V,q,B),N.clearStore().setChoices(V))}const D=(N,V,q,B,X,se)=>(B=structuredClone(B),q=structuredClone(q),N.detail.value===X?(S(),q=q.map(le=>[X,se].includes(le.value)?{...le,selected:!1}:{...le,selected:!0}),V.removeActiveItems().clearChoices(!0,!0).setValue(q).hideDropdown(),B=[...new Set(q.filter(le=>le.selected===!0).map(le=>le.value))]):N.detail.value===se?(V.removeActiveItems().hideDropdown(),B=[]):B=l===!0?[...B,N.detail.value]:[N.detail.value],[...new Set(B)]),I=(N,V)=>structuredClone(V).filter(q=>q!==N.detail.value);function R(N,V){const q=document.getElementById(d);k=new $v(q,{items:[],choices:N,addChoices:!1,addItems:!1,removeItems:!0,removeItemButton:!0,searchEnabled:a,allowHTML:!0,shouldSort:!V,sorter:(B,X)=>B.label.localeCompare(X.label),placeholderValue:u,classNames:{item:["choices__item","dropdown-item"]},loadingText:W==="fr"?"Chargement...":"Loading...",noResultsText:W==="fr"?"Pas de résultats":"No results found",noChoicesText:W==="fr"?"Pas de choix pour faire la sélection":"No choices to choose from",itemSelectText:W==="fr"?"Cliquer pour sélectionner":"Press to select",uniqueItemText:W==="fr"?"Seules des valeurs uniques peuvent être ajoutées":"Only unique values can be added",customAddItemText:W==="fr"?"Les valeurs ne répondent pas aux conditions attendues":"Only values matching specific conditions can be added",removeItemIconText:W==="fr"?"Retirer l'item":"Remove item",addItemText:B=>W==="fr"?`Cliquer sur Entrer pour ajouter <b>${B}</b>`:`Press Enter to add <b>"${B}"</b>`,removeItemLabelText:B=>W==="fr"?`Retirer l'item: ${B}`:`Remove item: ${B}`,maxItemText:B=>W==="fr"?`Seulement ${B} items peuvent être ajoutées`:`Only ${B} items can be added`}),q.addEventListener("addItem",B=>{n(3,i=D(B,k,N,i,p,g))}),q.addEventListener("removeItem",B=>{n(3,i=I(B,i))})}return An(()=>{const N=L(s,o,f);R(N,f)}),Tn(()=>{k.destroy(),k=void 0}),t.$$set=N=>{"choicesItems"in N&&n(6,s=N.choicesItems),"start"in N&&n(7,o=N.start),"multiple"in N&&n(0,l=N.multiple),"searchable"in N&&n(8,a=N.searchable),"lightDisplay"in N&&n(1,c=N.lightDisplay),"placeholder"in N&&n(9,u=N.placeholder),"title"in N&&n(2,h=N.title),"selectAll"in N&&n(10,f=N.selectAll)},t.$$.update=()=>{t.$$.dirty&2056&&T(i,r)},n(3,i=[]),n(11,r=!1),[l,c,h,i,d,m,s,o,a,u,f,r]}class Uv extends Me{constructor(e){super(),Ie(this,e,Hv,Fv,Ee,{choicesItems:6,start:7,multiple:0,searchable:8,lightDisplay:1,placeholder:9,title:2,selectAll:10})}}const mb="";function Bv(t){let e,n,i,r,s,o,l,a,c,u,h,f,d,m,p,g,_,k,E,b,S,T,M,C,x,P,L,H,D,I,R,N,V,q,B,X,se,le,fe;return c=new _n({props:{minVal:0,maxVal:1,start:t[5],emitOnUpdate:!0,title:W==="fr"?"Opacité":"Opacity"}}),c.$on("updateSlider",t[9]),f=new _n({props:{minVal:0,maxVal:360,start:t[6],step:1,emitOnUpdate:!0,title:"Rotation"}}),f.$on("updateSlider",t[10]),p=new _n({props:{minVal:0,maxVal:200,step:1,start:t[7],emitOnUpdate:!0,title:W==="fr"?"Redimensionner":"Scale"}}),p.$on("updateSlider",t[11]),k=new _n({props:{minVal:-100,maxVal:100,step:1,start:t[8][0],emitOnUpdate:!0,title:W==="fr"?"Translation horizontale":"Horizontal translate"}}),k.$on("updateSlider",t[12]),S=new _n({props:{minVal:-100,maxVal:100,step:1,start:t[8][1],emitOnUpdate:!0,title:W==="fr"?"Translation verticale":"Vertical translate"}}),S.$on("updateSlider",t[13]),C=new Uv({props:{choicesItems:t[4],start:[],lightDisplay:!0,placeholder:W==="fr"?"Sélectionner":"Select",title:W==="fr"?"Basculer":"Flip"}}),C.$on("updateValues",t[14]),{c(){e=w("div"),n=w("div"),i=w("div"),r=w("div"),s=w("strong"),s.textContent=`${W==="en"?"Query image transformation":"Modification de l'image requête"}`,o=F(),l=w("div"),a=w("div"),pe(c.$$.fragment),u=F(),h=w("div"),pe(f.$$.fragment),d=F(),m=w("div"),pe(p.$$.fragment),g=F(),_=w("div"),pe(k.$$.fragment),E=F(),b=w("div"),pe(S.$$.fragment),T=F(),M=w("div"),pe(C.$$.fragment),x=F(),P=w("div"),L=w("button"),L.textContent=`${W==="fr"?"Réinitialiser":"Reset"}`,H=F(),D=w("div"),I=w("img"),V=F(),q=w("img"),v(r,"class","toolbar-title mt-0 mb-2 svelte-nzei31"),v(a,"class"," svelte-nzei31"),v(h,"class"," svelte-nzei31"),v(m,"class"," svelte-nzei31"),v(_,"class"," svelte-nzei31"),v(b,"class"," svelte-nzei31"),v(M,"class"," svelte-nzei31"),v(L,"class","button is-link"),v(P,"class","mt-2 is-flex is-flex-direction-column is-justify-content-center is-align-items-flex-end svelte-nzei31"),v(l,"class","toolbar-controls is-flex is-flex-direction-column is-align-items-start is-justify-content-center svelte-nzei31"),v(i,"class","toolbar svelte-nzei31"),v(n,"class","toolbar-wrapper is-flex is-flex-direction-column is-justify-content-center is-align-items-center svelte-nzei31"),v(I,"class","compare-img svelte-nzei31"),Mt(I.src,R=t[0].queryImage.href)||v(I,"src",R),v(I,"alt",N=t[0].queryImage.title),v(q,"class","main-img svelte-nzei31"),Mt(q.src,B=t[0].similarityImage.href)||v(q,"src",B),v(q,"alt",X=t[0].similarityImage.title),Ae(q,"overlay-reset",t[2]),De(q,"opacity",t[1]),De(q,"transform",t[3]),v(D,"class","overlay-wrapper svelte-nzei31"),v(e,"class","similarity-overlay-wrapper svelte-nzei31")},m(te,he){j(te,e,he),y(e,n),y(n,i),y(i,r),y(r,s),y(i,o),y(i,l),y(l,a),de(c,a,null),y(l,u),y(l,h),de(f,h,null),y(l,d),y(l,m),de(p,m,null),y(l,g),y(l,_),de(k,_,null),y(l,E),y(l,b),de(S,b,null),y(l,T),y(l,M),de(C,M,null),y(l,x),y(l,P),y(P,L),y(e,H),y(e,D),y(D,I),y(D,V),y(D,q),se=!0,le||(fe=be(L,"click",t[15]),le=!0)},p(te,[he]){(!se||he&1&&!Mt(I.src,R=te[0].queryImage.href))&&v(I,"src",R),(!se||he&1&&N!==(N=te[0].queryImage.title))&&v(I,"alt",N),(!se||he&1&&!Mt(q.src,B=te[0].similarityImage.href))&&v(q,"src",B),(!se||he&1&&X!==(X=te[0].similarityImage.title))&&v(q,"alt",X),(!se||he&4)&&Ae(q,"overlay-reset",te[2]),he&2&&De(q,"opacity",te[1]),he&8&&De(q,"transform",te[3])},i(te){se||(U(c.$$.fragment,te),U(f.$$.fragment,te),U(p.$$.fragment,te),U(k.$$.fragment,te),U(S.$$.fragment,te),U(C.$$.fragment,te),se=!0)},o(te){K(c.$$.fragment,te),K(f.$$.fragment,te),K(p.$$.fragment,te),K(k.$$.fragment,te),K(S.$$.fragment,te),K(C.$$.fragment,te),se=!1},d(te){te&&z(e),me(c),me(f),me(p),me(k),me(S),me(C),le=!1,fe()}}}function qv(t,e,n){let i,{imgData:r}=e;const s=[{value:"h",label:W==="fr"?"Basculer horizontalement":"Flip horizontally"},{value:"v",label:W==="fr"?"Basculer verticalement":"Flip vertically"},{value:"hv",label:W==="fr"?"Basculer horizontalement et verticalement":"Flip horizontally and vertically"}];let o=.5;const l=o;let a=0;const c=a;let u=100;const h=u;let f=[1,1];const d=structuredClone(f);let m=[0,0];const p=structuredClone(m);let g=!1;const _=xe(window.crypto.randomUUID());Nn("resetTrigger",_);const k=x=>n(1,o=x.detail),E=x=>n(16,a=x.detail),b=x=>n(17,u=x.detail),S=x=>n(19,m=[x.detail,m[1]]),T=x=>n(19,m=[m[0],x.detail]),M=x=>{let P=x.detail[0];n(18,f=P==="hv"?[-1,-1]:P==="h"?[-1,1]:P==="v"?[1,-1]:[1,1])},C=()=>{n(1,o=l),n(16,a=c),n(17,u=h),n(18,f=d),n(19,m=p),_.set(window.crypto.randomUUID()),n(2,g=!0),setTimeout(()=>n(2,g=!1),1e3)};return t.$$set=x=>{"imgData"in x&&n(0,r=x.imgData)},t.$$.update=()=>{t.$$.dirty&983040&&n(3,i=`translate(${m[0]-50}%, ${m[1]}%)
                        rotate(${a}deg)
                        scale(${f.map(x=>x*(u/100)).join()})`)},[r,o,g,i,s,l,c,h,p,k,E,b,S,T,M,C,a,u,f,m]}class Kv extends Me{constructor(e){super(),Ie(this,e,qv,Bv,Ee,{imgData:0})}}function Wv(){const t=`${window.location.origin}${window.location.pathname}`,e=25,n=window.location.pathname.match(/\d+/g).join("-"),i={[n]:{}},r=[2,6],s=xe(1),o=xe({}),l=xe(JSON.parse(localStorage.getItem("selectedRegions"))||i);l.subscribe(H=>localStorage.setItem("selectedRegions",JSON.stringify(H)));const a=xe(JSON.parse(localStorage.getItem("excludedCategories"))||[]);a.subscribe(H=>localStorage.setItem("excludedCategories",JSON.stringify(H)));const c=xe(JSON.parse(localStorage.getItem("similarityScoreCutoff"))||void 0);c.subscribe(H=>{H!=null&&localStorage.setItem("similarityScoreCutoff",JSON.stringify(H))});const u=xe(JSON.parse(localStorage.getItem("propagateRecursionDepth"))||r[1]);u.subscribe(H=>localStorage.setItem("propagateRecursionDepth",JSON.stringify(H)));const h=xe(JSON.parse(localStorage.getItem("propagateFilterByRegions"))||!1);h.subscribe(H=>localStorage.setItem("propagateFilterByRegions",JSON.stringify(H)));const f=tt([u,h],([H,D])=>({propagateRecursionDepth:H,propagateFilterByRegions:D})),d=tt([a,l,c],([H,D,I])=>({excludedCategories:H,regions:D,similarityScoreCutoff:I})),m=tt([f,d],([H,D])=>({propagate:H,similarity:D})),p=xe([]),g=xe([]);async function _(){const H=async()=>{const R=await(await fetch(`${t}compared-regions`)).json();o.set(R),l.update(N=>{let V=N[n]||{};if(Object.keys(V).length){let q=Object.keys(V).filter(B=>Object.keys(R).includes(B)).reduce((B,X)=>(B[X]=V[X],B),{});N[n]=q}return N})},D=async()=>{const R=await(await fetch(`${t}query-images`)).json();R.length>0&&(p.set(R),P(M()))};ei.set(!0);try{await Promise.all([H(),D()])}catch(I){console.error("Error:",I),fu.set(I.message)}finally{ei.set(!1)}}function k(H){localStorage.setItem("selectedRegions",JSON.stringify(H))}function E(H){l.update(D=>{const I={...D};return delete I[n][H],k(I),I})}function b(H){l.update(D=>{const I={...D,[n]:{...D[n]||{},[H.ref]:H}};return k(I),I})}const S=tt(l,H=>D=>{var I;return(I=H[n])==null?void 0:I.hasOwnProperty(D)});function T(H){const D=ot(o),I=Object.keys(D).filter(R=>R.startsWith(H));return I.length!==1?{title:"Error"}:D[I[0]]}const M=()=>wr(s,"sp"),C=tt([s,p],([H,D])=>(async()=>x(H,D))());function x(H,D){const I=(H-1)*e,R=I+e,N=D.slice(I,R);return g.set(N),N}function P(H){Sr(H,s,"sp")}function L(H){o.update(D=>({...D,[H.ref]:H}))}return{currentPage:s,comparedRegions:o,excludedCategories:a,qImgs:p,pageQImgs:g,selectedRegions:l,propagateRecursionDepth:u,propagateFilterByRegions:h,similarityToolbarParams:m,propagateParams:f,similarityScoreCutoff:c,allowedPropagateDepthRange:r,fetchSimilarity:_,setPageQImgs:C,getRegionsInfo:T,handlePageUpdate:P,unselect:E,select:b,addComparedRegions:L,isSelected:S,pageLength:e}}const on=Wv(),{getRegionsInfo:Yv}=on;async function Ic(t,e,n,i,r,s,o=!1,l=!0){const a=()=>l?`<b>${!isNaN(parseFloat(n))&&e===1?`Score: ${n}`:e===2&&W==="en"?"Manual similarity":e===2&&W==="fr"?"Correspondance manuelle":e===3&&W==="en"?"Propagated match":"Correspondance propagée"}</b>`:"",c=u=>`${u}<br>
        Page ${parseInt(i)}<br>
        ${a()}`;return o===!0?fetch(`${r}${s}get_regions_title/${t}`).then(u=>u.json()).then(u=>c(u.title)).catch(u=>(console.error("similarity.utils.getDesc()",u),c(W==="fr"?"Titre inconnu":"Unknown title"))):Promise.resolve(c(Yv(t).title))}function Mc(t,e,n){const i=t.slice();return i[16]=e[n],i}function xc(t){let e,n,i=t[16]==="queryImage"&&W==="fr"?"Image requête":t[16]==="similarityImage"&&W==="fr"?"Similarité":t[16]==="queryImage"&&W==="en"?"Query image":"Similarity",r,s,o,l,a;return o=new Kn({props:{item:t[0][t[16]],descPromise:t[1][t[16]],height:"full"}}),{c(){e=w("div"),n=w("span"),r=oe(i),s=F(),pe(o.$$.fragment),l=F(),v(e,"class","img-legend-wrapper column is-flex is-flex-direction-column is-justify-content-center is-align-items-center")},m(c,u){j(c,e,u),y(e,n),y(n,r),y(e,s),de(o,e,null),y(e,l),a=!0},p(c,u){const h={};u&1&&(h.item=c[0][c[16]]),o.$set(h)},i(c){a||(U(o.$$.fragment,c),a=!0)},o(c){K(o.$$.fragment,c),a=!1},d(c){c&&z(e),me(o)}}}function Gv(t){let e,n,i=["queryImage","similarityImage"],r=[];for(let o=0;o<2;o+=1)r[o]=xc(Mc(t,i,o));const s=o=>K(r[o],1,1,()=>{r[o]=null});return{c(){e=w("div");for(let o=0;o<2;o+=1)r[o].c();v(e,"class","side-by-side columns")},m(o,l){j(o,e,l);for(let a=0;a<2;a+=1)r[a]&&r[a].m(e,null);n=!0},p(o,[l]){if(l&3){i=["queryImage","similarityImage"];let a;for(a=0;a<2;a+=1){const c=Mc(o,i,a);r[a]?(r[a].p(c,l),U(r[a],1)):(r[a]=xc(c),r[a].c(),U(r[a],1),r[a].m(e,null))}for(Pe(),a=2;a<2;a+=1)s(a);Le()}},i(o){if(!n){for(let l=0;l<2;l+=1)U(r[l]);n=!0}},o(o){r=r.filter(Boolean);for(let l=0;l<2;l+=1)K(r[l]);n=!1},d(o){o&&z(e),dt(r,o)}}}function Xv(t,e,n){let{imgData:i}=e;const r=xt("similarityPair"),s=new URL(window.location.href),o=s.origin,l=s.pathname,[a,c,u,h]=r.qImg.split(".")[0].split("_"),[f,d,m,p]=r.sImg.split(".")[0].split("_"),g=`${a}_${c}`,_=`${f}_${d}`,k={queryImage:Ic(g,r.similarityType,r.score,u,o,l,!0,!1),similarityImage:Ic(_,r.similarityType,r.score,m,o,l,!0,!0)};return t.$$set=E=>{"imgData"in E&&n(0,i=E.imgData)},[i,k]}class Jv extends Me{constructor(e){super(),Ie(this,e,Xv,Gv,Ee,{imgData:0})}}const pb="";function Qv(t){let e,n;return e=new Jv({props:{imgData:t[2]}}),{c(){pe(e.$$.fragment)},m(i,r){de(e,i,r),n=!0},p:ne,i(i){n||(U(e.$$.fragment,i),n=!0)},o(i){K(e.$$.fragment,i),n=!1},d(i){me(e,i)}}}function Zv(t){let e,n;return e=new Kv({props:{imgData:t[1]}}),{c(){pe(e.$$.fragment)},m(i,r){de(e,i,r),n=!0},p:ne,i(i){n||(U(e.$$.fragment,i),n=!0)},o(i){K(e.$$.fragment,i),n=!1},d(i){me(e,i)}}}function ey(t){let e,n,i,r,s,o,l,a,c;const u=[Zv,Qv],h=[];function f(d,m){return d[0]?0:1}return i=f(t),r=h[i]=u[i](t),a=new f1({props:{start:!1,buttonDisplay:!0,toggleLabel:W==="en"?"Overlay view":"Vue superposée"}}),a.$on("updateChecked",t[3]),{c(){e=w("div"),n=w("div"),r.c(),o=F(),l=w("div"),pe(a.$$.fragment),v(n,"class",s="modal-similarity-images "+(t[0]?"overlay-wrapper":"side-by-side-wrapper")+" svelte-1qvtan5"),v(e,"class","modal-similarity svelte-1qvtan5")},m(d,m){j(d,e,m),y(e,n),h[i].m(n,null),y(e,o),y(e,l),de(a,l,null),c=!0},p(d,[m]){let p=i;i=f(d),i===p?h[i].p(d,m):(Pe(),K(h[p],1,1,()=>{h[p]=null}),Le(),r=h[i],r?r.p(d,m):(r=h[i]=u[i](d),r.c()),U(r,1),r.m(n,null)),(!c||m&1&&s!==(s="modal-similarity-images "+(d[0]?"overlay-wrapper":"side-by-side-wrapper")+" svelte-1qvtan5"))&&v(n,"class",s)},i(d){c||(U(r),U(a.$$.fragment,d),c=!0)},o(d){K(r),K(a.$$.fragment,d),c=!1},d(d){d&&z(e),h[i].d(),me(a)}}}function ty(t,e,n){let{mainImgItem:i}=e,{compareImgItem:r}=e;const s={similarityImage:{href:Bt(i.img,i.img.split("_").pop()),title:a(i.title)},queryImage:{href:Bt(r.img,r.img.split("_").pop()),title:a(r.title)}},o={similarityImage:i,queryImage:r};let l=!1;function a(u){return W==="fr"?`Vue principale de la région ${u}`:`Main view of region ${u}`}const c=()=>n(0,l=!l);return t.$$set=u=>{"mainImgItem"in u&&n(4,i=u.mainImgItem),"compareImgItem"in u&&n(5,r=u.compareImgItem)},[l,s,o,c,i,r]}class ny extends Me{constructor(e){super(),Ie(this,e,ty,ey,Ee,{mainImgItem:4,compareImgItem:5})}}const iy=Object.freeze(Object.defineProperty({__proto__:null,default:ny},Symbol.toStringTag,{value:"Module"})),Ac=(t,e,n,i)=>({id:t,img:t,title:`Canvas ${i} - ${n} - ${W==="en"?"Witness":"Témoin"} #${br(e)}`,xywh:n.split(",").map(Number),canvas:i,ref:t.replace(".jpg",""),type:lu});function ry(t){let e,n,i,r,s,o,l,a,c,u,h;return n=new zn({props:{category:1,isSelected:t[0]===1,toggle:t[4],padding:"pl-3 pr-2"}}),r=new zn({props:{category:2,isSelected:t[0]===2,toggle:t[4]}}),o=new zn({props:{category:3,isSelected:t[0]===3,toggle:t[4]}}),a=new zn({props:{category:4,isSelected:t[0]===4,toggle:t[4]}}),u=new zn({props:{category:5,isSelected:t[0]===5,toggle:t[4],padding:"pl-2 pr-3"}}),{c(){e=w("div"),pe(n.$$.fragment),i=F(),pe(r.$$.fragment),s=F(),pe(o.$$.fragment),l=F(),pe(a.$$.fragment),c=F(),pe(u.$$.fragment),v(e,"class","tags has-addons is-dark is-center")},m(f,d){j(f,e,d),de(n,e,null),y(e,i),de(r,e,null),y(e,s),de(o,e,null),y(e,l),de(a,e,null),y(e,c),de(u,e,null),h=!0},p(f,d){const m={};d&1&&(m.isSelected=f[0]===1),n.$set(m);const p={};d&1&&(p.isSelected=f[0]===2),r.$set(p);const g={};d&1&&(g.isSelected=f[0]===3),o.$set(g);const _={};d&1&&(_.isSelected=f[0]===4),a.$set(_);const k={};d&1&&(k.isSelected=f[0]===5),u.$set(k)},i(f){h||(U(n.$$.fragment,f),U(r.$$.fragment,f),U(o.$$.fragment,f),U(a.$$.fragment,f),U(u.$$.fragment,f),h=!0)},o(f){K(n.$$.fragment,f),K(r.$$.fragment,f),K(o.$$.fragment,f),K(a.$$.fragment,f),K(u.$$.fragment,f),h=!1},d(f){f&&z(e),me(n),me(r),me(o),me(a),me(u)}}}function sy(t){let e,n,i,r;n=new Kn({props:{item:t[3],size:256,selectable:!1,isSquare:!1}});let s=!t[2]&&ry(t);return{c(){e=w("div"),pe(n.$$.fragment),i=F(),s&&s.c()},m(o,l){j(o,e,l),de(n,e,null),y(e,i),s&&s.m(e,null),r=!0},p(o,[l]){o[2]||s.p(o,l)},i(o){r||(U(n.$$.fragment,o),U(s),r=!0)},o(o){K(n.$$.fragment,o),K(s),r=!1},d(o){o&&z(e),me(n),s&&s.d()}}}function oy(t,e,n){let i,r,s;const{comparedRegions:o}=on;ye(t,o,D=>n(15,s=D));const l=new URL(window.location.href),a=l.origin;l.pathname;let{qImg:c}=e,{sImg:u}=e,{qRegions:h}=e,{sRegions:f}=e,{score:d=0}=e,{category:m=null}=e,{users:p=[]}=e,{isManual:g}=e,{similarityType:_}=e;const k=xt("isInModal")||!1,[E,b,S,T]=u.split(".")[0].split("_"),C=(()=>{let D=Ac(u,E,T,S);const I=s[`${E}_${b}_anno${f}`]||{title:D.title};return D.title=`${mu(I.title.replace(/^[^|]+/,""))}<br/>Page ${du(S)}<br/><b>Score: ${d}</b>`,D})();Nn("similarityPair",{qImg:c,sImg:u,qRegions:h,sRegions:f,score:d,category:m,users:p,isManual:g,similarityType:_});function x(D){D=D.slice();let I=D.indexOf(Number(yr));return r&&I===-1?D.push(Number(yr)):!r&&I!==-1&&D.splice(I,1),D}const P=()=>({img_1:c,img_2:u,regions_id_1:h,regions_id_2:f,score:d,category:i,category_x:x(p),similarity_type:_});function L(D){D===5?r=!r:n(0,i=i===D?null:D)}async function H(D){L(D);try{(await fetch(`${a}/${$t}/save-category`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":an},body:JSON.stringify(P())})).ok||(console.error("Error: Network response was not ok"),L(D))}catch(I){console.error("Error:",I),L(D)}}return t.$$set=D=>{"qImg"in D&&n(5,c=D.qImg),"sImg"in D&&n(6,u=D.sImg),"qRegions"in D&&n(7,h=D.qRegions),"sRegions"in D&&n(8,f=D.sRegions),"score"in D&&n(9,d=D.score),"category"in D&&n(10,m=D.category),"users"in D&&n(11,p=D.users),"isManual"in D&&n(12,g=D.isManual),"similarityType"in D&&n(13,_=D.similarityType)},t.$$.update=()=>{t.$$.dirty&1024&&n(0,i=m),t.$$.dirty&2048&&(r=p.includes(Number(yr))||!1)},[i,o,k,C,H,c,u,h,f,d,m,p,g,_]}class ly extends Me{constructor(e){super(),Ie(this,e,oy,sy,Ee,{qImg:5,sImg:6,qRegions:7,sRegions:8,score:9,category:10,users:11,isManual:12,similarityType:13})}}function Tc(t,e,n){const i=t.slice();return i[22]=e[n].uuid,i[23]=e[n].data[0],i[24]=e[n].data[1],i[25]=e[n].data[2],i[26]=e[n].data[3],i[27]=e[n].data[4],i[28]=e[n].data[5],i[29]=e[n].data[6],i[30]=e[n].data[7],i[31]=e[n].data[8],i}function ay(t){let e,n=W==="en"?`Error when retrieving similar regions: ${t[2]}`:`Erreur de recupération des régions similaires: ${t[2]}`,i;return{c(){e=w("div"),i=oe(n),v(e,"class","faded is-center")},m(r,s){j(r,e,s),y(e,i)},p(r,s){s[0]&4&&n!==(n=W==="en"?`Error when retrieving similar regions: ${r[2]}`:`Erreur de recupération des régions similaires: ${r[2]}`)&&Ce(i,n)},i:ne,o:ne,d(r){r&&z(e)}}}function cy(t){let e,n,i=t[4].length+"",r,s,o=t[11](t[10],t[4].length)+"",l,a,c,u=[],h=new Map,f,d=t[4];const m=g=>g[22];for(let g=0;g<d.length;g+=1){let _=Tc(t,d,g),k=m(_);h.set(k,u[g]=Oc(k,_))}let p=null;return d.length||(p=Nc(t)),{c(){e=w("div"),n=w("span"),r=oe(i),s=F(),l=oe(o),a=F(),c=w("div");for(let g=0;g<u.length;g+=1)u[g].c();p&&p.c(),v(n,"class","m-2"),v(c,"class","m-2 is-gap-2"),Ae(c,"grid",t[4].length>0)},m(g,_){j(g,e,_),y(e,n),y(n,r),y(n,s),y(n,l),y(e,a),y(e,c);for(let k=0;k<u.length;k+=1)u[k]&&u[k].m(c,null);p&&p.m(c,null),f=!0},p(g,_){(!f||_[0]&16)&&i!==(i=g[4].length+"")&&Ce(r,i),(!f||_[0]&16)&&o!==(o=g[11](g[10],g[4].length)+"")&&Ce(l,o),_[0]&49&&(d=g[4],Pe(),u=Zn(u,_,m,1,g,d,h,c,vr,Oc,null,Tc),Le(),!d.length&&p?p.p(g,_):d.length?p&&(p.d(1),p=null):(p=Nc(g),p.c(),p.m(c,null))),(!f||_[0]&16)&&Ae(c,"grid",g[4].length>0)},i(g){if(!f){for(let _=0;_<d.length;_+=1)U(u[_]);f=!0}},o(g){for(let _=0;_<u.length;_+=1)K(u[_]);f=!1},d(g){g&&z(e);for(let _=0;_<u.length;_+=1)u[_].d();p&&p.d()}}}function uy(t){let e;return{c(){e=w("div"),e.textContent=`${W==="en"&&!t[10]?"Retrieving similar regions...":W==="fr"&&!t[10]?"Récupération des régions similaires...":W==="en"&&t[10]?"Retrieving propagated regions...":"Récupération de similarités propagées..."}`,v(e,"class","faded is-center")},m(n,i){j(n,e,i)},p:ne,i:ne,o:ne,d(n){n&&z(e)}}}function Nc(t){let e;function n(s,o){return s[5]?hy:fy}let i=n(t),r=i(t);return{c(){r.c(),e=ct()},m(s,o){r.m(s,o),j(s,e,o)},p(s,o){i===(i=n(s))&&r?r.p(s,o):(r.d(1),r=i(s),r&&(r.c(),r.m(e.parentNode,e)))},d(s){r.d(s),s&&z(e)}}}function fy(t){let e;return{c(){e=w("div"),e.textContent=`${W==="en"?"No similar regions":"Pas de régions similaires"}
                    `,v(e,"class","faded is-center")},m(n,i){j(n,e,i)},p:ne,d(n){n&&z(e)}}}function hy(t){let e;return{c(){e=w("div"),e.textContent=`${W==="en"?"No document selected. Select one to display results.":"Aucun document sélectionné. Sélectionnez-en un pour afficher les résultats."}
                    `,v(e,"class","faded is-center")},m(n,i){j(n,e,i)},p:ne,d(n){n&&z(e)}}}function Oc(t,e){let n,i,r;return i=new ly({props:{qImg:e[0],sImg:e[25],score:e[23],qRegions:e[26],sRegions:e[27],category:e[28],users:e[29],isManual:e[30],similarityType:e[31]}}),{key:t,first:null,c(){n=ct(),pe(i.$$.fragment),this.first=n},m(s,o){j(s,n,o),de(i,s,o),r=!0},p(s,o){e=s;const l={};o[0]&1&&(l.qImg=e[0]),o[0]&16&&(l.sImg=e[25]),o[0]&16&&(l.score=e[23]),o[0]&16&&(l.qRegions=e[26]),o[0]&16&&(l.sRegions=e[27]),o[0]&16&&(l.category=e[28]),o[0]&16&&(l.users=e[29]),o[0]&16&&(l.isManual=e[30]),o[0]&16&&(l.similarityType=e[31]),i.$set(l)},i(s){r||(U(i.$$.fragment,s),r=!0)},o(s){K(i.$$.fragment,s),r=!1},d(s){s&&z(n),me(i,s)}}}function dy(t){let e,n,i,r;const s=[uy,cy,ay],o=[];function l(a,c){return a[1]&&a[3]==="loading"?0:a[3]==="loaded"?1:a[3]==="error"?2:-1}return~(e=l(t))&&(n=o[e]=s[e](t)),{c(){n&&n.c(),i=ct()},m(a,c){~e&&o[e].m(a,c),j(a,i,c),r=!0},p(a,c){let u=e;e=l(a),e===u?~e&&o[e].p(a,c):(n&&(Pe(),K(o[u],1,1,()=>{o[u]=null}),Le()),~e?(n=o[e],n?n.p(a,c):(n=o[e]=s[e](a),n.c()),U(n,1),n.m(i.parentNode,i)):n=null)},i(a){r||(U(n),r=!0)},o(a){K(n),r=!1},d(a){~e&&o[e].d(a),a&&z(i)}}}function my(t,e,n){let i,r,s,o,l,a,c,u,{qImg:h}=e,{sImgsPromise:f}=e;const{selectedRegions:d,excludedCategories:m,similarityScoreCutoff:p,propagateFilterByRegions:g}=on;ye(t,d,x=>n(16,u=x)),ye(t,m,x=>n(15,c=x)),ye(t,p,x=>n(14,a=x)),ye(t,g,x=>n(13,l=x));const _=xt("similarityPropagatedContext")||!1,k=window.location.pathname.match(/\d+/g).join("-");let E;const b=(x,P)=>x===null||P===void 0||Number(x)>=P,S=(x,P,L)=>!L.includes(x),T=(x,P,L,H,D,I)=>_?!0:b(x,D)&&S(P,L,H),M=(x,P,L,H)=>x.filter(({uuid:D,data:[I,R,N,V,q,B,X,se,le]})=>T(I,B,X,P,L)),C=(x,P)=>{const L=P>1;return x?W==="fr"?L?"similarités propagées":"similarité propagée":L?"propagated matches":"propagated match":W==="fr"?L?"images similaires":"image similaire":L?"similar images":"similar image"};return t.$$set=x=>{"qImg"in x&&n(0,h=x.qImg),"sImgsPromise"in x&&n(1,f=x.sImgsPromise)},t.$$.update=()=>{t.$$.dirty[0]&65536&&n(5,i=Object.values(u).length===0||u[k]===void 0||!Object.keys(u[k]).length),t.$$.dirty[0]&2&&(x=>{n(3,r="loading"),n(4,o=[]),n(12,s=[])})(),t.$$.dirty[0]&2&&f.then(x=>{n(12,s=x.map(P=>({uuid:window.crypto.randomUUID(),data:P}))),n(3,r="loaded")}).catch(x=>{n(2,E=x),n(3,r="error")}),t.$$.dirty[0]&61440&&n(4,o=M(s,c,a))},n(3,r="loading"),n(12,s=[]),[h,f,E,r,o,i,d,m,p,g,_,C,s,l,a,c,u]}class Pc extends Me{constructor(e){super(),Ie(this,e,my,dy,Ee,{qImg:0,sImgsPromise:1},null,[-1,-1])}}function py(t){let e,n;return e=new Pc({props:{qImg:t[0],sImgsPromise:t[1]}}),{c(){pe(e.$$.fragment)},m(i,r){de(e,i,r),n=!0},p(i,[r]){const s={};r&1&&(s.qImg=i[0]),r&2&&(s.sImgsPromise=i[1]),e.$set(s)},i(i){n||(U(e.$$.fragment,i),n=!0)},o(i){K(e.$$.fragment,i),n=!1},d(i){me(e,i)}}}function gy(t,e,n){let i,r,{qImg:s}=e,o;const l=xt("isInModal")||!1,{selectedRegions:a,comparedRegions:c}=on;ye(t,a,m=>n(4,i=m)),ye(t,c,m=>n(5,r=m));const u=`${window.location.origin}${window.location.pathname}`,h=window.location.pathname.match(/\d+/g).join("-"),f=(m,p)=>p?Object.keys(r).map(g=>r[g].id):Object.values(m[h]||{}).map(g=>g.id);async function d(m,p,g){const _=f(p,g);return _.length===0?[]:await(await fetch(`${u}similar-images`,{method:"POST",body:JSON.stringify({regionsIds:_,qImg:m,topk:12}),headers:{"Content-Type":"application/json","X-CSRFToken":an}})).json()}return l?o=d(s,i,l):a.subscribe(m=>{n(1,o=d(s,m,l))}),t.$$set=m=>{"qImg"in m&&n(0,s=m.qImg)},[s,o,a,c]}class _y extends Me{constructor(e){super(),Ie(this,e,gy,py,Ee,{qImg:0})}}const gb="";function vy(t){let e,n,i,r;return i=new Pc({props:{qImg:t[0],sImgsPromise:t[1]}}),{c(){e=w("div"),n=w("div"),pe(i.$$.fragment),v(n,"class","matches-suggestion svelte-1cb4wg0"),v(e,"class","block matches-suggestion-wrapper svelte-1cb4wg0")},m(s,o){j(s,e,o),y(e,n),de(i,n,null),r=!0},p(s,[o]){const l={};o&1&&(l.qImg=s[0]),o&2&&(l.sImgsPromise=s[1]),i.$set(l)},i(s){r||(U(i.$$.fragment,s),r=!0)},o(s){K(i.$$.fragment,s),r=!1},d(s){s&&z(e),me(i)}}}function yy(t,e,n){let i,r,{qImg:s}=e;const{propagateParams:o,selectedRegions:l}=on;ye(t,o,g=>n(4,i=g)),ye(t,l,g=>n(5,r=g));const a=`${window.location.origin}${window.location.pathname}`,c=window.location.pathname.match(/\d+/g).join("-"),u=xt("isInModal")||!1;let h;const f=xi();f.setCompareFn((g,_)=>[g,_].every(k=>k&&k.hasOwnProperty("propagateRecursionDepth")&&k.hasOwnProperty("propagateFilterByRegions"))?g.propagateRecursionDepth===_.propagateRecursionDepth&&g.propagateFilterByRegions===_.propagateFilterByRegions:!1);const d=xi();d.setCompareFn(kr),Nn("similarityPropagatedContext",!0);const m=g=>Object.keys(g).includes(c)?Object.values(g[c]).map(_=>_.id):[],p=async(g,_,k)=>fetch(`${a}propagated-matches/${s}`,{method:"POST",body:JSON.stringify({regionsIds:k?[]:_,filterByRegions:k?!1:g.propagateFilterByRegions,recursionDepth:g.propagateRecursionDepth}),headers:{"Content-Type":"application/json","X-CSRFToken":an}}).then(E=>E.json()).catch(E=>(console.error("PropagatedMatches.getPropagatedMatches:",E),[]));return o.subscribe(g=>{f.set(g),f.same()||n(1,h=p(f.get(),m(r),u))}),l.subscribe(g=>{d.set(m(g)),i.propagateFilterByRegions===!0&&!d.same()&&n(1,h=p(i,d.get(),u))}),t.$$set=g=>{"qImg"in g&&n(0,s=g.qImg)},[s,h,o,l]}class by extends Me{constructor(e){super(),Ie(this,e,yy,vy,Ee,{qImg:0})}}const _b="";function wy(t){let e,n,i,r=parseInt(t[5])+"",s,o,l,a,c,u,h,f,d,m,p,g,_,k,E,b,S,T,M;return{c(){e=w("a"),n=w("i"),i=oe(`
            Page `),s=oe(r),o=F(),l=w("img"),c=F(),u=w("div"),h=w("div"),f=w("input"),d=F(),m=w("button"),m.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M256 80c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 144L48 224c-17.7 0-32 14.3-32 32s14.3 32 32 32l144 0 0 144c0 17.7 14.3 32 32 32s32-14.3 32-32l0-144 144 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-144 0 0-144z"></path></svg>',p=F(),g=w("button"),_=Dt("svg"),k=Dt("path"),v(n,"class","fa-solid fa-pen-to-square"),v(e,"class","tag px-2 py-1 mb-2 is-rounded is-hoverable"),v(e,"href",yu(t[6],parseInt(t[5]))),v(e,"target","_blank"),Mt(l.src,a=Bt(t[0],t[0].split("_").pop(),"250,"))||v(l,"src",a),v(l,"alt","Query region"),v(l,"class","mb-3 card query-image svelte-f4ylwc"),v(f,"class","input is-small tag"),v(f,"type","text"),v(f,"placeholder",W==="en"?"Add new match":"Ajouter une correspondance"),v(m,"class","button is-small tag is-link is-center"),v(h,"class","tags has-addons"),De(h,"flex-wrap","nowrap"),v(k,"fill","white"),v(k,"d","M376.6 84.5c11.3-13.6 9.5-33.8-4.1-45.1s-33.8-9.5-45.1 4.1L192 206 56.6 43.5C45.3 29.9 25.1 28.1 11.5 39.4S-3.9 70.9 7.4 84.5L150.3 256 7.4 427.5c-11.3 13.6-9.5 33.8 4.1 45.1s33.8 9.5 45.1-4.1L192 306 327.4 468.5c11.3 13.6 31.5 15.4 45.1 4.1s15.4-31.5 4.1-45.1L233.7 256 376.6 84.5z"),v(_,"xmlns","http://www.w3.org/2000/svg"),v(_,"viewBox","0 0 384 512"),v(g,"id","no-match"),v(g,"class",E="button is-small tag is-danger is-center m-0 "+(t[3]===1?"visible":"")+" svelte-f4ylwc"),v(g,"title",W==="en"?"No match for this region in this witness":"Aucune correspondance de cette région pour ce témoin"),v(u,"class","new-similarity control pt-2 is-center svelte-f4ylwc")},m(C,x){j(C,e,x),y(e,n),y(e,i),y(e,s),j(C,o,x),j(C,l,x),j(C,c,x),j(C,u,x),y(u,h),y(h,f),Si(f,t[1]),y(h,d),y(h,m),y(u,p),y(u,g),y(g,_),y(_,k),S=!0,T||(M=[be(f,"input",t[12]),be(m,"click",t[8]),be(g,"click",t[9])],T=!0)},p(C,x){(!S||x&1&&!Mt(l.src,a=Bt(C[0],C[0].split("_").pop(),"250,")))&&v(l,"src",a),x&2&&f.value!==C[1]&&Si(f,C[1]),(!S||x&8&&E!==(E="button is-small tag is-danger is-center m-0 "+(C[3]===1?"visible":"")+" svelte-f4ylwc"))&&v(g,"class",E)},i(C){S||(Ut(()=>{S&&(b||(b=ln(g,$n,{duration:500},!0)),b.run(1))}),S=!0)},o(C){b||(b=ln(g,$n,{duration:500},!1)),b.run(0),S=!1},d(C){C&&z(e),C&&z(o),C&&z(l),C&&z(c),C&&z(u),C&&b&&b.end(),T=!1,st(M)}}}function Sy(t){let e,n,i,r,s,o,l,a;return n=new _y({props:{qImg:t[0]}}),o=new by({props:{qImg:t[0]}}),{c(){e=w("div"),pe(n.$$.fragment),r=F(),s=w("div"),pe(o.$$.fragment),v(e,"class",i=bi(t[7]?"":t[2])+" svelte-f4ylwc"),v(s,"class",l=bi(t[7]?"":t[2])+" svelte-f4ylwc")},m(c,u){j(c,e,u),de(n,e,null),j(c,r,u),j(c,s,u),de(o,s,null),a=!0},p(c,u){const h={};u&1&&(h.qImg=c[0]),n.$set(h),(!a||u&4&&i!==(i=bi(c[7]?"":c[2])+" svelte-f4ylwc"))&&v(e,"class",i);const f={};u&1&&(f.qImg=c[0]),o.$set(f),(!a||u&4&&l!==(l=bi(c[7]?"":c[2])+" svelte-f4ylwc"))&&v(s,"class",l)},i(c){a||(U(n.$$.fragment,c),U(o.$$.fragment,c),a=!0)},o(c){K(n.$$.fragment,c),K(o.$$.fragment,c),a=!1},d(c){c&&z(e),me(n),c&&z(r),c&&z(s),me(o)}}}function ky(t){let e,n;return e=new ba({props:{useGrid:!1,$$slots:{"row-body":[Sy],"row-header":[wy]},$$scope:{ctx:t}}}),{c(){pe(e.$$.fragment)},m(i,r){de(e,i,r),n=!0},p(i,[r]){const s={};r&1048591&&(s.$$scope={dirty:r,ctx:i}),e.$set(s)},i(i){n||(U(e.$$.fragment,i),n=!0)},o(i){K(e.$$.fragment,i),n=!1},d(i){me(e,i)}}}function Ey(t){return t=t.replace(".jpg",""),/^wit\d+_[a-zA-Z]{3}\d+_\d+_\d+,\d+,\d+,\d+$/.test(t)}function Cy(t,e,n){let i,r,s,o;const{selectedRegions:l}=on;ye(t,l,T=>n(11,o=T));let{qImg:a}=e,c="";const[u,h,f,d]=a.split(".")[0].split("_"),m=`${window.location.origin}${window.location.pathname}`,p=window.location.pathname.match(/\d+/g).join("-"),g=W==="en"?"Error":"Erreur",_=xt("manifest"),k=xt("isInModal")||!1;Nn("qImgMetadata",Ac(a,u,d,f));async function E(){if(!c||!Ey(c)){await wt(W==="en"?"Please insert a valid region reference to add a new match":"Veuillez insérer une référence de région valide pour ajouter une nouvelle correspondance","Error");return}try{const T=await fetch(`${m}add-region-pair`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":an},body:JSON.stringify({q_img:a.replace(".jpg",""),s_img:c,similarity_type:2})});T.ok||(console.error("Error: Network response was not ok"),await wt(W==="en"?"Problem with network, match was not added":"Problème de réseau, la correspondance n'a pas été ajoutée",g));const M=await T.json();if(M.hasOwnProperty("error")||!M.hasOwnProperty("s_regions")){await wt(W==="en"?`Request was unsuccessful, match was not added:<br>${M.error}`:`La requête n'a pas abouti, la correspondance n'a pas été ajoutée :<br>${M.error}`,g);return}const C=M.s_regions;on.addComparedRegions(C),on.select(C)}catch(T){console.error("Error:",T),await wt(W==="en"?`An error has occurred, match was not added:<br>${T}`:`Une erreur s'est produite, la correspondance n'a pas été ajoutée :<br>${T}`,g)}}async function b(){const T=Object.values(o[p])[0];if(await wt(W==="en"?`Do you confirm this region does not have any match in ${T.title}?`:`Confirmez-vous que cette région n'a pas de correspondance dans ${T.title} ?`,W==="en"?"Confirm no match":"Confirmer l'absence de correspondance",!0))try{(await fetch(`${m}no-match`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":an},body:JSON.stringify({q_img:a,s_regions:T.id})})).ok||(console.error("Error: Network response was not ok"),await wt(W==="en"?"Problem with network":"Problème de réseau",g)),on.select(T)}catch(C){console.error("Error:",C),await wt(W==="en"?`An error has occurred, request was unsuccessful:<br>${C}`:`Une erreur s'est produite, la requête n'a pas abouti :<br>${C}`,g)}}function S(){c=this.value,n(1,c)}return t.$$set=T=>{"qImg"in T&&n(0,a=T.qImg)},t.$$.update=()=>{t.$$.dirty&2048&&n(3,i=o.hasOwnProperty(p)?Object.values(o[p]).length:0),t.$$.dirty&1024&&n(2,s=`fixed-grid has-${r-1}-cols`)},n(10,r=Us(window.innerWidth)),[a,c,s,i,l,f,_,k,E,b,r,o,S]}class Iy extends Me{constructor(e){super(),Ie(this,e,Cy,ky,Ee,{qImg:0})}}function My(t){let e,n,i,r,s,o;return s=new Iy({props:{qImg:t[0].img}}),{c(){e=w("div"),n=w("a"),i=w("button"),i.textContent=`${W==="fr"?"Voir toutes les similarités pour ce document":"View all similarities for this document"}`,r=F(),pe(s.$$.fragment),v(i,"class","button is-link is-small"),v(n,"href",t[1]()),v(e,"class","is-flex is-align-items-center is-justify-content-end")},m(l,a){j(l,e,a),y(e,n),y(n,i),j(l,r,a),de(s,l,a),o=!0},p(l,[a]){const c={};a&1&&(c.qImg=l[0].img),s.$set(c)},i(l){o||(U(s.$$.fragment,l),o=!0)},o(l){K(s.$$.fragment,l),o=!1},d(l){l&&z(e),l&&z(r),me(s,l)}}}function xy(t,e,n){let{mainImgItem:i}=e;function r(){const s=i.img.match(/wit(\d+)/)[1],o=new URL(window.location.origin);return o.pathname=`${new URL(window.location).pathname.split("/")[1]}/witness/${s}/regions/`,o.searchParams.set("tab","similarity"),o.href}return t.$$set=s=>{"mainImgItem"in s&&n(0,i=s.mainImgItem)},[i,r]}class Ay extends Me{constructor(e){super(),Ie(this,e,xy,My,Ee,{mainImgItem:0})}}const Ty=Object.freeze(Object.defineProperty({__proto__:null,default:Ay},Symbol.toStringTag,{value:"Module"}))})();
//# sourceMappingURL=documentSet.js.map
