(function(){"use strict";function te(){}const Ms=t=>t;function As(t,e){for(const n in e)t[n]=e[n];return t}function qc(t){return!!t&&(typeof t=="object"||typeof t=="function")&&typeof t.then=="function"}function Ts(t){return t()}function Ns(){return Object.create(null)}function yt(t){t.forEach(Ts)}function Pn(t){return typeof t=="function"}function ze(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}let Si;function At(t,e){return Si||(Si=document.createElement("a")),Si.href=e,t===Si.href}function Kc(t){return Object.keys(t).length===0}function ki(t,...e){if(t==null)return te;const n=t.subscribe(...e);return n.unsubscribe?()=>n.unsubscribe():n}function vt(t){let e;return ki(t,n=>e=n)(),e}function xe(t,e,n){t.$$.on_destroy.push(ki(e,n))}function Vt(t,e,n,i){if(t){const r=Ps(t,e,n,i);return t[0](r)}}function Ps(t,e,n,i){return t[1]&&i?As(n.ctx.slice(),t[1](i(e))):n.ctx}function Ut(t,e,n,i){if(t[2]&&i){const r=t[2](i(n));if(e.dirty===void 0)return r;if(typeof r=="object"){const s=[],o=Math.max(e.dirty.length,r.length);for(let l=0;l<o;l+=1)s[l]=e.dirty[l]|r[l];return s}return e.dirty|r}return e.dirty}function Bt(t,e,n,i,r,s){if(r){const o=Ps(e,n,i,s);t.p(o,r)}}function qt(t){if(t.ctx.length>32){const e=[],n=t.ctx.length/32;for(let i=0;i<n;i++)e[i]=-1;return e}return-1}function Wc(t){const e={};for(const n in t)e[n]=!0;return e}function Ei(t){return t??""}function ei(t){return t&&Pn(t.destroy)?t.destroy:te}const Os=typeof window<"u";let Yc=Os?()=>window.performance.now():()=>Date.now(),yr=Os?t=>requestAnimationFrame(t):te;const On=new Set;function Ls(t){On.forEach(e=>{e.c(t)||(On.delete(e),e.f())}),On.size!==0&&yr(Ls)}function Gc(t){let e;return On.size===0&&yr(Ls),{promise:new Promise(n=>{On.add(e={c:t,f:n})}),abort(){On.delete(e)}}}const Xc=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function y(t,e){t.appendChild(e)}function Rs(t){if(!t)return document;const e=t.getRootNode?t.getRootNode():t.ownerDocument;return e&&e.host?e:t.ownerDocument}function Jc(t){const e=b("style");return Qc(Rs(t),e),e.sheet}function Qc(t,e){return y(t.head||t,e),e.sheet}function z(t,e,n){t.insertBefore(e,n||null)}function $(t){t.parentNode&&t.parentNode.removeChild(t)}function wt(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function b(t){return document.createElement(t)}function Wt(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function re(t){return document.createTextNode(t)}function j(){return re(" ")}function Ct(){return re("")}function Ce(t,e,n,i){return t.addEventListener(e,n,i),()=>t.removeEventListener(e,n,i)}function sn(t){return function(e){return e.preventDefault(),t.call(this,e)}}function v(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function Zc(t){return Array.from(t.childNodes)}function je(t,e){e=""+e,t.data!==e&&(t.data=e)}function Ci(t,e){t.value=e??""}function We(t,e,n,i){n==null?t.style.removeProperty(e):t.style.setProperty(e,n,i?"important":"")}function pn(t,e,n){for(let i=0;i<t.options.length;i+=1){const r=t.options[i];if(r.__value===e){r.selected=!0;return}}(!n||e!==void 0)&&(t.selectedIndex=-1)}function Ii(t){const e=t.querySelector(":checked");return e&&e.__value}function Ye(t,e,n){t.classList[n?"add":"remove"](e)}function Ds(t,e,{bubbles:n=!1,cancelable:i=!1}={}){const r=document.createEvent("CustomEvent");return r.initCustomEvent(t,n,i,e),r}function xi(t,e){return new t(e)}const Mi=new Map;let Ai=0;function eu(t){let e=5381,n=t.length;for(;n--;)e=(e<<5)-e^t.charCodeAt(n);return e>>>0}function tu(t,e){const n={stylesheet:Jc(e),rules:{}};return Mi.set(t,n),n}function $s(t,e,n,i,r,s,o,l=0){const a=16.666/i;let c=`{
`;for(let g=0;g<=1;g+=a){const _=e+(n-e)*s(g);c+=g*100+`%{${o(_,1-_)}}
`}const u=c+`100% {${o(n,1-n)}}
}`,h=`__svelte_${eu(u)}_${l}`,f=Rs(t),{stylesheet:d,rules:m}=Mi.get(f)||tu(f,t);m[h]||(m[h]=!0,d.insertRule(`@keyframes ${h} ${u}`,d.cssRules.length));const p=t.style.animation||"";return t.style.animation=`${p?`${p}, `:""}${h} ${i}ms linear ${r}ms 1 both`,Ai+=1,h}function nu(t,e){const n=(t.style.animation||"").split(", "),i=n.filter(e?s=>s.indexOf(e)<0:s=>s.indexOf("__svelte")===-1),r=n.length-i.length;r&&(t.style.animation=i.join(", "),Ai-=r,Ai||iu())}function iu(){yr(()=>{Ai||(Mi.forEach(t=>{const{ownerNode:e}=t.stylesheet;e&&$(e)}),Mi.clear())})}let ti;function on(t){ti=t}function Ln(){if(!ti)throw new Error("Function called outside component initialization");return ti}function Rn(t){Ln().$$.on_mount.push(t)}function Dn(t){Ln().$$.on_destroy.push(t)}function Ti(){const t=Ln();return(e,n,{cancelable:i=!1}={})=>{const r=t.$$.callbacks[e];if(r){const s=Ds(e,n,{cancelable:i});return r.slice().forEach(o=>{o.call(t,s)}),!s.defaultPrevented}return!0}}function $n(t,e){return Ln().$$.context.set(t,e),e}function zt(t){return Ln().$$.context.get(t)}const zn=[],gn=[];let jn=[];const zs=[],ru=Promise.resolve();let br=!1;function su(){br||(br=!0,ru.then(Sr))}function jt(t){jn.push(t)}const wr=new Set;let Fn=0;function Sr(){if(Fn!==0)return;const t=ti;do{try{for(;Fn<zn.length;){const e=zn[Fn];Fn++,on(e),ou(e.$$)}}catch(e){throw zn.length=0,Fn=0,e}for(on(null),zn.length=0,Fn=0;gn.length;)gn.pop()();for(let e=0;e<jn.length;e+=1){const n=jn[e];wr.has(n)||(wr.add(n),n())}jn.length=0}while(zn.length);for(;zs.length;)zs.pop()();br=!1,wr.clear(),on(t)}function ou(t){if(t.fragment!==null){t.update(),yt(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(jt)}}function lu(t){const e=[],n=[];jn.forEach(i=>t.indexOf(i)===-1?e.push(i):n.push(i)),n.forEach(i=>i()),jn=e}let ni;function au(){return ni||(ni=Promise.resolve(),ni.then(()=>{ni=null})),ni}function kr(t,e,n){t.dispatchEvent(Ds(`${e?"intro":"outro"}${n}`))}const Ni=new Set;let ln;function tt(){ln={r:0,c:[],p:ln}}function nt(){ln.r||yt(ln.c),ln=ln.p}function H(t,e){t&&t.i&&(Ni.delete(t),t.i(e))}function K(t,e,n,i){if(t&&t.o){if(Ni.has(t))return;Ni.add(t),ln.c.push(()=>{Ni.delete(t),i&&(n&&t.d(1),i())}),t.o(e)}else i&&i()}const cu={duration:0};function _n(t,e,n,i){const r={direction:"both"};let s=e(t,n,r),o=i?0:1,l=null,a=null,c=null;function u(){c&&nu(t,c)}function h(d,m){const p=d.b-o;return m*=Math.abs(p),{a:o,b:d.b,d:p,duration:m,start:d.start,end:d.start+m,group:d.group}}function f(d){const{delay:m=0,duration:p=300,easing:g=Ms,tick:_=te,css:S}=s||cu,C={start:Yc()+m,b:d};d||(C.group=ln,ln.r+=1),l||a?a=C:(S&&(u(),c=$s(t,o,d,p,m,g,S)),d&&_(0,1),l=h(C,p),jt(()=>kr(t,d,"start")),Gc(w=>{if(a&&w>a.start&&(l=h(a,p),a=null,kr(t,l.b,"start"),S&&(u(),c=$s(t,o,l.b,l.duration,0,g,s.css))),l){if(w>=l.end)_(o=l.b,1-o),kr(t,l.b,"end"),a||(l.b?u():--l.group.r||yt(l.group.c)),l=null;else if(w>=l.start){const k=w-l.start;o=l.a+l.d*g(k/l.duration),_(o,1-o)}}return!!(l||a)}))}return{run(d){Pn(s)?au().then(()=>{s=s(r),f(d)}):f(d)},end(){u(),l=a=null}}}function Er(t,e){const n=e.token={};function i(r,s,o,l){if(e.token!==n)return;e.resolved=l;let a=e.ctx;o!==void 0&&(a=a.slice(),a[o]=l);const c=r&&(e.current=r)(a);let u=!1;e.block&&(e.blocks?e.blocks.forEach((h,f)=>{f!==s&&h&&(tt(),K(h,1,1,()=>{e.blocks[f]===h&&(e.blocks[f]=null)}),nt())}):e.block.d(1),c.c(),H(c,1),c.m(e.mount(),e.anchor),u=!0),e.block=c,e.blocks&&(e.blocks[s]=c),u&&Sr()}if(qc(t)){const r=Ln();if(t.then(s=>{on(r),i(e.then,1,e.value,s),on(null)},s=>{if(on(r),i(e.catch,2,e.error,s),on(null),!e.hasCatch)throw s}),e.current!==e.pending)return i(e.pending,0),!0}else{if(e.current!==e.then)return i(e.then,1,e.value,t),!0;e.resolved=t}}function js(t,e,n){const i=e.slice(),{resolved:r}=t;t.current===t.then&&(i[t.value]=r),t.current===t.catch&&(i[t.error]=r),t.block.p(i,n)}function uu(t,e){t.d(1),e.delete(t.key)}function Cr(t,e){K(t,1,1,()=>{e.delete(t.key)})}function Pi(t,e,n,i,r,s,o,l,a,c,u,h){let f=t.length,d=s.length,m=f;const p={};for(;m--;)p[t[m].key]=m;const g=[],_=new Map,S=new Map,C=[];for(m=d;m--;){const N=h(r,s,m),E=n(N);let x=o.get(E);x?i&&C.push(()=>x.p(N,e)):(x=c(E,N),x.c()),_.set(E,g[m]=x),E in p&&S.set(E,Math.abs(m-p[E]))}const w=new Set,k=new Set;function T(N){H(N,1),N.m(l,u),o.set(N.key,N),u=N.first,d--}for(;f&&d;){const N=g[d-1],E=t[f-1],x=N.key,L=E.key;N===E?(u=N.first,f--,d--):_.has(L)?!o.has(x)||w.has(x)?T(N):k.has(L)?f--:S.get(x)>S.get(L)?(k.add(x),T(N)):(w.add(L),f--):(a(E,o),f--)}for(;f--;){const N=t[f];_.has(N.key)||a(N,o)}for(;d;)T(g[d-1]);return yt(C),g}function fu(t,e){const n={},i={},r={$$scope:1};let s=t.length;for(;s--;){const o=t[s],l=e[s];if(l){for(const a in o)a in l||(i[a]=1);for(const a in l)r[a]||(n[a]=l[a],r[a]=1);t[s]=l}else for(const a in o)r[a]=1}for(const o in i)o in n||(n[o]=void 0);return n}function du(t){return typeof t=="object"&&t!==null?t:{}}function ve(t){t&&t.c()}function ge(t,e,n,i){const{fragment:r,after_update:s}=t.$$;r&&r.m(e,n),i||jt(()=>{const o=t.$$.on_mount.map(Ts).filter(Pn);t.$$.on_destroy?t.$$.on_destroy.push(...o):yt(o),t.$$.on_mount=[]}),s.forEach(jt)}function _e(t,e){const n=t.$$;n.fragment!==null&&(lu(n.after_update),yt(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function hu(t,e){t.$$.dirty[0]===-1&&(zn.push(t),su(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function He(t,e,n,i,r,s,o,l=[-1]){const a=ti;on(t);const c=t.$$={fragment:null,ctx:[],props:s,update:te,not_equal:r,bound:Ns(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(a?a.$$.context:[])),callbacks:Ns(),dirty:l,skip_bound:!1,root:e.target||a.$$.root};o&&o(c.root);let u=!1;if(c.ctx=n?n(t,e.props||{},(h,f,...d)=>{const m=d.length?d[0]:f;return c.ctx&&r(c.ctx[h],c.ctx[h]=m)&&(!c.skip_bound&&c.bound[h]&&c.bound[h](m),u&&hu(t,h)),f}):[],c.update(),u=!0,yt(c.before_update),c.fragment=i?i(c.ctx):!1,e.target){if(e.hydrate){const h=Zc(e.target);c.fragment&&c.fragment.l(h),h.forEach($)}else c.fragment&&c.fragment.c();e.intro&&H(t.$$.fragment),ge(t,e.target,e.anchor,e.customElement),Sr()}on(a)}class Ve{$destroy(){_e(this,1),this.$destroy=te}$on(e,n){if(!Pn(n))return te;const i=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return i.push(n),()=>{const r=i.indexOf(n);r!==-1&&i.splice(r,1)}}$set(e){this.$$set&&!Kc(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const Hn=[];function mu(t,e){return{subscribe:Ne(t,e).subscribe}}function Ne(t,e=te){let n;const i=new Set;function r(l){if(ze(t,l)&&(t=l,n)){const a=!Hn.length;for(const c of i)c[1](),Hn.push(c,t);if(a){for(let c=0;c<Hn.length;c+=2)Hn[c][0](Hn[c+1]);Hn.length=0}}}function s(l){r(l(t))}function o(l,a=te){const c=[l,a];return i.add(c),i.size===1&&(n=e(r)||te),l(t),()=>{i.delete(c),i.size===0&&n&&(n(),n=null)}}return{set:r,update:s,subscribe:o}}function dt(t,e,n){const i=!Array.isArray(t),r=i?[t]:t,s=e.length<2;return mu(n,o=>{let l=!1;const a=[];let c=0,u=te;const h=()=>{if(c)return;u();const d=e(i?a[0]:a,o);s?o(d):u=Pn(d)?d:te},f=r.map((d,m)=>ki(d,p=>{a[m]=p,c&=~(1<<m),l&&h()},()=>{c|=1<<m}));return l=!0,h(),function(){yt(f),u(),l=!1}})}const B=APP_LANG,Yt=APP_NAME;WEBAPP_NAME;const Ir=USER_ID,xr=IS_SUPERUSER;ADD_PERMISSION;const vn=CSRF_TOKEN;ADDITIONAL_MODULES;const pu="Region",Fs=APP_URL,gu=SAS_APP_URL;CANTALOUPE_APP_URL,MEDIA_PATH;const _u=PAGE_LEN,Oi={Witness:B==="en"?"Witness":"Témoin",Work:B==="en"?"Work":"Œuvre",Series:B==="en"?"Series":"Série d'imprimés",Regions:B==="en"?"Region Extraction":"Extraction d'illustrations"},ii=Ne(!1),vu=Ne(""),yu=t=>typeof t=="string"||t instanceof String;async function Hs(t){ii.set(!0);try{return await t()}finally{ii.set(!1)}}function Mr(t){return t.match(/\d+/g).toString()}function bu(t){return parseInt(Mr(t),10)}function wu(t,e=100){const n=Math.floor(e*.75);return t.length>e?t.slice(0,n)+"..."+t.slice(-e+n):t}function Su(){return"https://vhs.huma-num.fr"}function ku(){return gu??"http://localhost:8888"}function Ar(t,e){if(typeof window<"u"){const n=parseInt(new URLSearchParams(window.location.search).get(e));if(!isNaN(n))return t.set(n),n}return t.set(1),1}function Tr(t,e,n){if(e.set(t),typeof window<"u"){const i=new URL(window.location.href);i.searchParams.set(n,t),window.history.pushState({},"",i)}}function Eu(t=null){return t=t.split("_"),t.length<3?void 0:`${t.slice(0,3).join("_").replace(".jpg","")}.jpg`}function Vs(t=null){const e=Eu(t);return e===void 0?void 0:`${Su()}/iiif/2/${e}`}function Kt(t=null,e=null,n="full"){if(e=yu(e)?e.replace(".jpg",""):e,!t)return"https://placehold.co/96x96/png?text=No+image";const i=Vs(t);if(i===void 0)return"https://placehold.co/96x96/png?text=No+image";const r=t.split("_");return e||(e=r[r.length-1].includes(",")?r.pop().replace(".jpg",""):"full"),`${i}/${e}/${n}/0/default.jpg`}function Cu(t=null){return`${Vs(t)}/info.json`}function Iu(t=null,e=1){return`${ku()}/index.html?iiif-content=${t}&canvas=${e}`}function Tt(t,e=null,n=!1){return new Promise(i=>{if(document.getElementById("msg-modal")){n?document.getElementById("modal-footer").hidden=!1:i(void 0),e&&(document.getElementById("modal-title").innerHTML=e),document.getElementById("modal-msg").innerHTML=t,document.getElementById("hidden-msg-btn").click();const s=document.getElementById("cancel-btn"),o=document.getElementById("ok-btn"),l=document.getElementById("modal-bkg"),a=()=>{s.removeEventListener("click",c),l.removeEventListener("click",c),o.removeEventListener("click",u),document.getElementById("modal-footer").hidden=!0},c=()=>{a(),i(!1)},u=()=>{a(),i(!0)};s.addEventListener("click",c),o.addEventListener("click",u)}else n?i(window.confirm(t)):(window.alert(t),i(void 0))})}function Li(){let t,e,n=(i,r)=>i===r;return{set:i=>{e=t,t=i},setCompareFn:i=>n=i,get:()=>t,getNewAndOld:()=>[t,e],same:()=>n(t,e)}}const Nr=(t,e)=>Array.isArray(t)&&Array.isArray(e)&&t.length===e.length&&t.every((n,i)=>n===e[i]||void 0);function xu(t){const n=[85,70,60],i=[50,65,40],r=t*137.5%360,s=n[t%n.length],o=i[Math.floor(t/n.length)%i.length];return`hsl(${Math.floor(r)}, ${s}%, ${o}%)`}function Us(t=null){return t<600?1:t<800?2:t<1e3?3:t<1200?4:t<1400?5:t>=1400?6:4}function Pr(t){const e=t.querySelectorAll(".modal-background, .modal-close, .modal-card-head .delete, .modal-card-foot .button-close"),n=()=>t.classList.remove("is-active");e.forEach(r=>r.addEventListener("click",n));const i=r=>{r.key==="Escape"&&t.classList.contains("is-active")&&n()};return document.addEventListener("keydown",i),{destroy(){e.forEach(r=>r.removeEventListener("click",n)),document.removeEventListener("keydown",i)}}}function Bs(t){const e=()=>{const n=document.getElementById(t.dataset.target);n==null||n.classList.add("is-active")};return t.addEventListener("click",e),{destroy(){t.removeEventListener("click",e)}}}function Vn(t,e,n="string",i=null){const r={string:o=>{const l=o.get(e);return l!==null?l:null},array:o=>{const l=o.get(e);return l?l.split(",").map(Number).filter(a=>!isNaN(a)):null},set:o=>{const l=o.get(e);return l?new Set(l.split(",").map(Number).filter(a=>!isNaN(a))):null},number:o=>{const l=o.get(e);return l!==null?Number(l):null},boolean:o=>{const l=o.get(e);return l!==null?l==="true":null}},s={string:(o,l)=>l?o.searchParams.set(e,l):o.searchParams.delete(e),array:(o,l)=>{l!=null&&l.length?o.searchParams.set(e,l.join(",")):o.searchParams.delete(e)},set:(o,l)=>{l!=null&&l.size?o.searchParams.set(e,Array.from(l).join(",")):o.searchParams.delete(e)},number:(o,l)=>{l!=null?o.searchParams.set(e,String(l)):o.searchParams.delete(e)},boolean:(o,l)=>l?o.searchParams.set(e,"true"):o.searchParams.delete(e)};if(typeof window<"u"){const o=new URLSearchParams(window.location.search),l=r[n](o);if(l!==null)t.set(l);else if(i!==null){const a=typeof i=="function"?i():i;t.set(a)}return a=>{const c=new URL(window.location);s[n](c,a),window.history.pushState({},"",c)}}return()=>{}}function Mu(t){const e=t-1;return e*e*e+1}function Un(t,{delay:e=0,duration:n=400,easing:i=Ms}={}){const r=+getComputedStyle(t).opacity;return{delay:e,duration:n,easing:i,css:s=>`opacity: ${s*r}`}}function qs(t,{delay:e=0,duration:n=400,easing:i=Mu,axis:r="y"}={}){const s=getComputedStyle(t),o=+s.opacity,l=r==="y"?"height":"width",a=parseFloat(s[l]),c=r==="y"?["top","bottom"]:["left","right"],u=c.map(_=>`${_[0].toUpperCase()}${_.slice(1)}`),h=parseFloat(s[`padding${u[0]}`]),f=parseFloat(s[`padding${u[1]}`]),d=parseFloat(s[`margin${u[0]}`]),m=parseFloat(s[`margin${u[1]}`]),p=parseFloat(s[`border${u[0]}Width`]),g=parseFloat(s[`border${u[1]}Width`]);return{delay:e,duration:n,easing:i,css:_=>`overflow: hidden;opacity: ${Math.min(_*20,1)*o};${l}: ${_*a}px;padding-${c[0]}: ${_*h}px;padding-${c[1]}: ${_*f}px;margin-${c[0]}: ${_*d}px;margin-${c[1]}: ${_*m}px;border-${c[0]}-width: ${_*p}px;border-${c[1]}-width: ${_*g}px;`}}const $y="";function Ks(t){let e,n,i;return{c(){e=b("div"),e.innerHTML='<div class="loader svelte-vizlcg"></div>',v(e,"class","bkg-shade svelte-vizlcg")},m(r,s){z(r,e,s),i=!0},i(r){i||(jt(()=>{i&&(n||(n=_n(e,Un,{duration:150},!0)),n.run(1))}),i=!0)},o(r){n||(n=_n(e,Un,{duration:150},!1)),n.run(0),i=!1},d(r){r&&$(e),r&&n&&n.end()}}}function Au(t){let e,n,i=t[0]&&Ks();return{c(){i&&i.c(),e=Ct()},m(r,s){i&&i.m(r,s),z(r,e,s),n=!0},p(r,[s]){r[0]?i?s&1&&H(i,1):(i=Ks(),i.c(),H(i,1),i.m(e.parentNode,e)):i&&(tt(),K(i,1,1,()=>{i=null}),nt())},i(r){n||(H(i),n=!0)},o(r){K(i),n=!1},d(r){i&&i.d(r),r&&$(e)}}}function Tu(t,e,n){let i;return xe(t,ii,r=>n(0,i=r)),[i]}class Nu extends Ve{constructor(e){super(),He(this,e,Tu,Au,ze,{})}}const Pu=t=>({}),Ws=t=>({});function Ou(t){let e,n,i,r,s,o,l,a,c,u,h,f,d,m,p,g,_,S,C,w,k;const T=t[1].content,N=Vt(T,t,t[0],Ws);return{c(){e=b("button"),n=j(),i=b("div"),r=b("div"),s=j(),o=b("div"),l=b("div"),l.innerHTML=`<div class="title is-4 mb-0 media-content"><span id="modal-title" class="mb-0"></span></div>
            <button class="delete media-left" aria-label="close"></button>`,a=j(),c=b("section"),u=b("div"),h=j(),f=b("div"),N&&N.c(),d=j(),m=b("footer"),p=b("div"),g=b("button"),g.textContent=`${B==="en"?"Abort":"Retour"}`,_=j(),S=b("button"),S.textContent="OK",v(e,"id","hidden-msg-btn"),v(e,"data-target","msg-modal"),e.hidden=!0,v(r,"id","modal-bkg"),v(r,"class","modal-background"),v(l,"class","modal-card-head media mb-0"),v(u,"id","modal-msg"),v(f,"class","py-3"),v(c,"id","modal-body"),v(c,"class","modal-card-body"),v(g,"id","cancel-btn"),v(g,"class","button is-link is-light button-close"),v(S,"id","ok-btn"),v(S,"class","button is-link button-close"),v(p,"class","buttons"),v(m,"id","modal-footer"),v(m,"class","modal-card-foot is-center pt-3"),m.hidden=!0,v(o,"class","modal-content"),v(i,"id","msg-modal"),v(i,"class","modal fade"),v(i,"tabindex","-1"),v(i,"aria-labelledby","selection-modal-label"),v(i,"aria-hidden","true")},m(E,x){z(E,e,x),z(E,n,x),z(E,i,x),y(i,r),y(i,s),y(i,o),y(o,l),y(o,a),y(o,c),y(c,u),y(c,h),y(c,f),N&&N.m(f,null),y(o,d),y(o,m),y(m,p),y(p,g),y(p,_),y(p,S),C=!0,w||(k=[ei(Bs.call(null,e)),ei(Pr.call(null,i))],w=!0)},p(E,[x]){N&&N.p&&(!C||x&1)&&Bt(N,T,E,E[0],C?Ut(T,E[0],x,Pu):qt(E[0]),Ws)},i(E){C||(H(N,E),C=!0)},o(E){K(N,E),C=!1},d(E){E&&$(e),E&&$(n),E&&$(i),N&&N.d(E),w=!1,yt(k)}}}function Lu(t,e,n){let{$$slots:i={},$$scope:r}=e;return t.$$set=s=>{"$$scope"in s&&n(0,r=s.$$scope)},[r,i]}class Ru extends Ve{constructor(e){super(),He(this,e,Lu,Ou,ze,{})}}const zy="",Du=t=>({activeTab:t&8}),Ys=t=>({activeTab:t[3]});function Gs(t,e,n){const i=t.slice();return i[11]=e[n][0],i[12]=e[n][1],i}const $u=t=>({activeTab:t&8}),Xs=t=>({activeTab:t[3]}),zu=t=>({}),Js=t=>({});function ju(t){let e,n,i=Object.entries(t[2]),r=[];for(let s=0;s<i.length;s+=1)r[s]=Qs(Gs(t,i,s));return{c(){e=b("div"),n=b("ul");for(let s=0;s<r.length;s+=1)r[s].c();v(e,"class","tabs")},m(s,o){z(s,e,o),y(e,n);for(let l=0;l<r.length;l+=1)r[l]&&r[l].m(n,null)},p(s,o){if(o&28){i=Object.entries(s[2]);let l;for(l=0;l<i.length;l+=1){const a=Gs(s,i,l);r[l]?r[l].p(a,o):(r[l]=Qs(a),r[l].c(),r[l].m(n,null))}for(;l<r.length;l+=1)r[l].d(1);r.length=i.length}},i:te,o:te,d(s){s&&$(e),wt(r,s)}}}function Fu(t){let e;const n=t[8].tabs,i=Vt(n,t,t[7],Xs);return{c(){i&&i.c()},m(r,s){i&&i.m(r,s),e=!0},p(r,s){i&&i.p&&(!e||s&136)&&Bt(i,n,r,r[7],e?Ut(n,r[7],s,$u):qt(r[7]),Xs)},i(r){e||(H(i,r),e=!0)},o(r){K(i,r),e=!1},d(r){i&&i.d(r)}}}function Qs(t){let e,n,i=t[12]+"",r,s,o,l;function a(){return t[9](t[11])}return{c(){e=b("li"),n=b("a"),r=re(i),s=j(),v(n,"href",null),Ye(e,"is-active",t[3]===t[11])},m(c,u){z(c,e,u),y(e,n),y(n,r),y(e,s),o||(l=Ce(n,"click",a),o=!0)},p(c,u){t=c,u&4&&i!==(i=t[12]+"")&&je(r,i),u&12&&Ye(e,"is-active",t[3]===t[11])},d(c){c&&$(e),o=!1,l()}}}function Hu(t){let e,n,i,r,s,o,l,a,c,u,h,f,d;e=new Nu({});const m=t[8].sidebar,p=Vt(m,t,t[7],Js),g=[Fu,ju],_=[];function S(k,T){return T&4&&(a=null),k[5].tabs?0:(a==null&&(a=!!Object.keys(k[2]).length),a?1:-1)}~(c=S(t,-1))&&(u=_[c]=g[c](t));const C=t[8].content,w=Vt(C,t,t[7],Ys);return{c(){ve(e.$$.fragment),n=j(),i=b("div"),r=b("aside"),p&&p.c(),s=j(),o=b("main"),l=b("nav"),u&&u.c(),h=j(),f=b("div"),w&&w.c(),v(r,"class","sidebar svelte-jexg"),We(r,"width",t[0]+"%"),We(r,"min-height",t[1]),v(l,"id","tabs"),v(l,"class","tabs-bar svelte-jexg"),v(f,"class","content-area pl-5 svelte-jexg"),v(o,"class","main-content svelte-jexg"),We(o,"width",100-t[0]+"%"),We(o,"min-height",t[1]),v(i,"class","layout svelte-jexg"),We(i,"min-height",t[1])},m(k,T){ge(e,k,T),z(k,n,T),z(k,i,T),y(i,r),p&&p.m(r,null),y(i,s),y(i,o),y(o,l),~c&&_[c].m(l,null),y(o,h),y(o,f),w&&w.m(f,null),d=!0},p(k,[T]){p&&p.p&&(!d||T&128)&&Bt(p,m,k,k[7],d?Ut(m,k[7],T,zu):qt(k[7]),Js),(!d||T&1)&&We(r,"width",k[0]+"%");let N=c;c=S(k,T),c===N?~c&&_[c].p(k,T):(u&&(tt(),K(_[N],1,1,()=>{_[N]=null}),nt()),~c?(u=_[c],u?u.p(k,T):(u=_[c]=g[c](k),u.c()),H(u,1),u.m(l,null)):u=null),w&&w.p&&(!d||T&136)&&Bt(w,C,k,k[7],d?Ut(C,k[7],T,Du):qt(k[7]),Ys),(!d||T&1)&&We(o,"width",100-k[0]+"%")},i(k){d||(H(e.$$.fragment,k),H(p,k),H(u),H(w,k),d=!0)},o(k){K(e.$$.fragment,k),K(p,k),K(u),K(w,k),d=!1},d(k){_e(e,k),k&&$(n),k&&$(i),p&&p.d(k),~c&&_[c].d(),w&&w.d(k)}}}function Vu(t=null){t||(t=document.getElementById("navbar")),document.documentElement.style.setProperty("--top-offset",`${t.offsetHeight}px`)}function Uu(t,e,n){let i,{$$slots:r={},$$scope:s}=e;const o=Wc(r);let{sidebarWidth:l="25"}=e;const a="90vh";let{tabList:c={}}=e,u=Object.keys(c),{topOffsetElement:h=null}=e;Vu(h);function f(m){if(!u.includes(m)){console.warn(`Tab "${m}" is not available.`);return}n(3,i=m);const p=new URL(window.location);p.searchParams.set("tab",m),window.history.pushState({},"",p)}const d=m=>f(m);return t.$$set=m=>{"sidebarWidth"in m&&n(0,l=m.sidebarWidth),"tabList"in m&&n(2,c=m.tabList),"topOffsetElement"in m&&n(6,h=m.topOffsetElement),"$$scope"in m&&n(7,s=m.$$scope)},n(3,i=new URLSearchParams(window.location.search).get("tab")??u[0]??null),[l,a,c,i,f,o,h,s,r,d]}class Bu extends Ve{constructor(e){super(),He(this,e,Uu,Hu,ze,{sidebarWidth:0,layoutHeight:1,tabList:2,topOffsetElement:6})}get layoutHeight(){return this.$$.ctx[1]}}const Ri={0:{title:B==="en"?"no categorization":"aucune catégorisation",svg:`<svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 59 59">
        <rect x="1" y="0.62" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>
    </svg>`},1:{title:B==="en"?"overall visual matches":"correspondances visuelles globales",svg:`<svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 68 69">
        <rect x="10" y="10.62" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>
        <rect x="1" y="1" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>
        <rect x="10" y="10.62" width="46" height="45.71" rx="4.11" ry="4.11" fill="currentColor" stroke="none"/>
    </svg>`},2:{title:B==="en"?"visual matches on part of the image":"correspondances visuelles sur une partie de l'image",svg:`<svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 70 71">
        <rect x="12" y="12.43" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>
        <rect x="1" y="0.81" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>
        <path d="M 12 21.43 L 21 12.43" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
        <path d="M 12 30 L 30 12.43" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
        <path d="M 40 56 L 57 38" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
        <path d="M 48.3 56.29 L 57 47" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
        <path d="M 12 39 L 39 12" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
        <path d="M 12 48 L 48 12" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
        <path d="M 13 56 L 57 12" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
        <path d="M 31 56 L 57 29" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
        <path d="M 21 57 L 57 21" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
    </svg>`},3:{title:B==="en"?"semantic and non-visual matches":"correspondances sémantiques et non-visuelle",svg:`<svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 72 73">
        <rect x="14" y="14.43" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3" stroke-dasharray="9 9"/>
        <rect x="1" y="0.81" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>
    </svg>`},4:{title:B==="en"?"regions without match":"régions sans correspondance",svg:`<svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 59 59">
        <rect x="1" y="0.62" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>
        <path d="M 2.67 54.55 L 55 2" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
        <path d="M 54.37 54.05 L 2.72 2.24" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
    </svg>`},5:{title:B==="en"?"user specific category":"correspondances spécifiques à l'utilisateur",svg:`<svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 59 59">
        <rect x="1" y="0.81" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>
        <path d="M 8.69 55.28 C 9.25 44.15 18.08 35.28 28.86 35.28 C 32.5 35.28 36.07 36.3 39.18 38.25 C 44.96 41.85 48.66 48.3 49.02 55.28 Z M 17.85 21.48 C 17.85 15.37 22.79 10.39 28.86 10.39 C 34.92 10.39 39.86 15.37 39.86 21.48 C 39.86 27.59 34.92 32.56 28.86 32.56 C 22.79 32.56 17.85 27.59 17.85 21.48 Z M 40.37 36.34 C 38.43 35.13 36.32 34.25 34.13 33.7 C 38.82 31.64 42.1 26.94 42.1 21.48 C 42.1 14.13 36.16 8.15 28.86 8.15 C 21.55 8.15 15.61 14.13 15.61 21.48 C 15.61 26.95 18.9 31.66 23.6 33.71 C 13.76 36.18 6.41 45.4 6.41 56.4 C 6.41 57.02 6.92 57.52 7.54 57.52 L 50.17 57.52 C 50.79 57.52 51.3 57.02 51.3 56.4 C 51.3 48.23 47.11 40.54 40.37 36.34 Z" fill="currentColor" stroke="none"/>
    </svg>`}};function qu(t){let e,n=Ri[t[2]].svg+"",i,r,s,o;return{c(){e=b("span"),v(e,"class",i="tag py-4 "+t[4]+" "+(t[0]?"is-hoverable":"")),v(e,"title",r=Ri[t[2]].title),Ye(e,"is-selected",t[1])},m(l,a){z(l,e,a),e.innerHTML=n,s||(o=[Ce(e,"click",t[5]),Ce(e,"keyup",null)],s=!0)},p(l,[a]){a&4&&n!==(n=Ri[l[2]].svg+"")&&(e.innerHTML=n),a&17&&i!==(i="tag py-4 "+l[4]+" "+(l[0]?"is-hoverable":""))&&v(e,"class",i),a&4&&r!==(r=Ri[l[2]].title)&&v(e,"title",r),a&19&&Ye(e,"is-selected",l[1])},i:te,o:te,d(l){l&&$(e),s=!1,yt(o)}}}function Ku(t,e,n){let{selectable:i=!0}=e,{isSelected:r=!1}=e,{category:s}=e,{toggle:o=()=>{}}=e,{padding:l="px-2"}=e;const a=()=>o(s);return t.$$set=c=>{"selectable"in c&&n(0,i=c.selectable),"isSelected"in c&&n(1,r=c.isSelected),"category"in c&&n(2,s=c.category),"toggle"in c&&n(3,o=c.toggle),"padding"in c&&n(4,l=c.padding)},[i,r,s,o,l,a]}class Bn extends Ve{constructor(e){super(),He(this,e,Ku,qu,ze,{selectable:0,isSelected:1,category:2,toggle:3,padding:4})}}const Jy="";function Zs(t){let e,n,i=t[3].title+"",r,s;return{c(){e=b("span"),n=b("a"),r=re(i),v(n,"href",s=`${Fs}/${Yt}/witness/${t[3].witnessId}/regions/${t[1]}`),v(n,"target","_blank"),v(e,"class","legend-label svelte-w1sf17")},m(o,l){z(o,e,l),y(e,n),y(n,r)},p(o,l){l&8&&i!==(i=o[3].title+"")&&je(r,i),l&10&&s!==(s=`${Fs}/${Yt}/witness/${o[3].witnessId}/regions/${o[1]}`)&&v(n,"href",s)},d(o){o&&$(e)}}}function Wu(t){let e,n,i,r,s,o,l,a,c,u=!t[5]&&Zs(t);return{c(){e=b("div"),n=b("span"),i=j(),r=b("span"),l=j(),u&&u.c(),v(n,"class","legend-nb svelte-w1sf17"),v(r,"class","legend-color svelte-w1sf17"),v(r,"aria-label",s=t[3].title),v(r,"title",o=t[3].title),We(r,"background-color",t[0]?t[3].color:"#999"),v(r,"role","button"),v(r,"tabindex","0"),Ye(r,"inactive",!t[0]),Ye(r,"clickable",t[4]),v(e,"class","legend-item svelte-w1sf17"),Ye(e,"inactive",!t[0])},m(h,f){z(h,e,f),y(e,n),y(e,i),y(e,r),y(e,l),u&&u.m(e,null),a||(c=[Ce(r,"click",function(){Pn(t[2])&&t[2].apply(this,arguments)}),Ce(r,"keydown",null)],a=!0)},p(h,[f]){t=h,f&8&&s!==(s=t[3].title)&&v(r,"aria-label",s),f&8&&o!==(o=t[3].title)&&v(r,"title",o),f&9&&We(r,"background-color",t[0]?t[3].color:"#999"),f&1&&Ye(r,"inactive",!t[0]),f&16&&Ye(r,"clickable",t[4]),t[5]?u&&(u.d(1),u=null):u?u.p(t,f):(u=Zs(t),u.c(),u.m(e,null)),f&1&&Ye(e,"inactive",!t[0])},i:te,o:te,d(h){h&&$(e),u&&u.d(),a=!1,yt(c)}}}function Yu(t,e,n){let{isActive:i=!0}=e,{id:r}=e,{toggle:s=()=>{}}=e,{meta:o={title:"Region",color:"#999",witnessId:1}}=e,{clickable:l=!0}=e,{onlyColor:a=!1}=e;return t.$$set=c=>{"isActive"in c&&n(0,i=c.isActive),"id"in c&&n(1,r=c.id),"toggle"in c&&n(2,s=c.toggle),"meta"in c&&n(3,o=c.meta),"clickable"in c&&n(4,l=c.clickable),"onlyColor"in c&&n(5,a=c.onlyColor)},[i,r,s,o,l,a]}class eo extends Ve{constructor(e){super(),He(this,e,Yu,Wu,ze,{isActive:0,id:1,toggle:2,meta:3,clickable:4,onlyColor:5})}}const Qy="";function to(t,e,n){const i=t.slice();return i[12]=e[n][0],i[13]=e[n][1],i}function Gu(t){let e;return{c(){e=b("span"),e.innerHTML='<i class="fas fa-chevron-down"></i>',v(e,"class","icon is-small")},m(n,i){z(n,e,i)},d(n){n&&$(e)}}}function Xu(t){let e;return{c(){e=b("span"),e.innerHTML='<i class="fas fa-chevron-up"></i>',v(e,"class","icon is-small")},m(n,i){z(n,e,i)},d(n){n&&$(e)}}}function no(t){let e,n;function i(){return t[10](t[12])}return e=new eo({props:{id:t[12],meta:t[13],isActive:t[0].has(parseInt(t[12])),toggle:i,onlyColor:!t[4]}}),{c(){ve(e.$$.fragment)},m(r,s){ge(e,r,s),n=!0},p(r,s){t=r;const o={};s&32&&(o.id=t[12]),s&32&&(o.meta=t[13]),s&33&&(o.isActive=t[0].has(parseInt(t[12]))),s&34&&(o.toggle=i),s&16&&(o.onlyColor=!t[4]),e.$set(o)},i(r){n||(H(e.$$.fragment,r),n=!0)},o(r){K(e.$$.fragment,r),n=!1},d(r){_e(e,r)}}}function Ju(t){let e,n,i,r,s,o,l,a,c,u,h,f,d,m,p,g,_,S,C,w,k,T,N,E,x,L,O;function F(V,q){return V[4]?Xu:Gu}let R=F(t),I=R(t),U=t[5],P=[];for(let V=0;V<U.length;V+=1)P[V]=no(to(t,U,V));const G=V=>K(P[V],1,1,()=>{P[V]=null});return{c(){e=b("div"),n=b("div"),i=b("div"),r=b("div"),s=b("h3"),s.textContent=`${B==="en"?"Visible documents":"Documents visibles"}`,o=j(),l=b("div"),a=b("div"),c=b("p"),u=b("span"),h=b("select"),f=b("option"),f.textContent="ID",d=b("option"),d.textContent=`${Oi.Witness}`,m=b("option"),m.textContent=`${B==="en"?"Title":"Titre"}`,p=j(),g=b("p"),_=b("button"),_.innerHTML='<span class="icon is-small has-text-link pl-2"><i class="fas fa-check"></i></span>',S=j(),C=b("div"),w=b("button"),I.c(),N=j(),E=b("div");for(let V=0;V<P.length;V+=1)P[V].c();v(s,"class","title mb-0"),v(r,"class","level-item"),v(i,"class","level-left"),f.__value="id",f.value=f.__value,d.__value="witnessId",d.value=d.__value,m.__value="title",m.value=m.__value,t[3]===void 0&&jt(()=>t[7].call(h)),v(u,"class","select is-small"),v(c,"class","control mb-0"),v(c,"title",B==="en"?"Sort documents by":"Trier les documents par"),v(_,"class","button is-small is-shadowless"),v(g,"class","control"),v(g,"title",B==="en"?"Select all documents":"Sélectionner tous les documents"),v(a,"class","level-item mb-0 field has-addons is-small"),v(w,"class","button is-small is-ghost"),v(w,"aria-label",k=t[4]?"Minify legend":"Expand legend"),v(C,"class","level-item"),v(C,"title",T=t[4]?"Minify legend":"Expand legend"),v(l,"class","level-right"),v(n,"class","level is-mobile mb-3"),v(E,"class","svelte-13ym7ov"),Ye(E,"is-condensed",!t[4]),Ye(E,"is-expanded",t[4])},m(V,q){z(V,e,q),y(e,n),y(n,i),y(i,r),y(r,s),y(n,o),y(n,l),y(l,a),y(a,c),y(c,u),y(u,h),y(h,f),y(h,d),y(h,m),pn(h,t[3],!0),y(a,p),y(a,g),y(g,_),y(l,S),y(l,C),y(C,w),I.m(w,null),y(e,N),y(e,E);for(let J=0;J<P.length;J+=1)P[J]&&P[J].m(E,null);x=!0,L||(O=[Ce(h,"change",t[7]),Ce(_,"click",t[8]),Ce(w,"click",t[9])],L=!0)},p(V,[q]){if(q&8&&pn(h,V[3]),R!==(R=F(V))&&(I.d(1),I=R(V),I&&(I.c(),I.m(w,null))),(!x||q&16&&k!==(k=V[4]?"Minify legend":"Expand legend"))&&v(w,"aria-label",k),(!x||q&16&&T!==(T=V[4]?"Minify legend":"Expand legend"))&&v(C,"title",T),q&51){U=V[5];let J;for(J=0;J<U.length;J+=1){const ue=to(V,U,J);P[J]?(P[J].p(ue,q),H(P[J],1)):(P[J]=no(ue),P[J].c(),H(P[J],1),P[J].m(E,null))}for(tt(),J=U.length;J<P.length;J+=1)G(J);nt()}(!x||q&16)&&Ye(E,"is-condensed",!V[4]),(!x||q&16)&&Ye(E,"is-expanded",V[4])},i(V){if(!x){for(let q=0;q<U.length;q+=1)H(P[q]);x=!0}},o(V){P=P.filter(Boolean);for(let q=0;q<P.length;q+=1)K(P[q]);x=!1},d(V){V&&$(e),I.d(),wt(P,V),L=!1,yt(O)}}}function Qu(t,e,n){let i,{documentNodes:r}=e,{selectedRegions:s}=e,{toggleRegion:o}=e,{selectAllRegions:l}=e,a=!0,c="id";const u={id:(p,g)=>p[0]-g[0],witnessId:(p,g)=>(p[1].witnessId||0)-(g[1].witnessId||0),title:(p,g)=>(p[1].title||"").localeCompare(g[1].title||"")};function h(){c=Ii(this),n(3,c)}const f=()=>l(),d=()=>n(4,a=!a),m=p=>o(parseInt(p));return t.$$set=p=>{"documentNodes"in p&&n(6,r=p.documentNodes),"selectedRegions"in p&&n(0,s=p.selectedRegions),"toggleRegion"in p&&n(1,o=p.toggleRegion),"selectAllRegions"in p&&n(2,l=p.selectAllRegions)},t.$$.update=()=>{t.$$.dirty&72&&n(5,i=Array.from(r||new Map).sort(u[c]))},[s,o,l,c,a,i,r,h,f,d,m]}class Zu extends Ve{constructor(e){super(),He(this,e,Qu,Ju,ze,{documentNodes:6,selectedRegions:0,toggleRegion:1,selectAllRegions:2})}}var yn;(function(t){t.Range="range",t.Steps="steps",t.Positions="positions",t.Count="count",t.Values="values"})(yn||(yn={}));var Nt;(function(t){t[t.None=-1]="None",t[t.NoValue=0]="NoValue",t[t.LargeValue=1]="LargeValue",t[t.SmallValue=2]="SmallValue"})(Nt||(Nt={}));function ef(t){return Di(t)&&typeof t.from=="function"}function Di(t){return typeof t=="object"&&typeof t.to=="function"}function io(t){t.parentElement.removeChild(t)}function Or(t){return t!=null}function ro(t){t.preventDefault()}function tf(t){return t.filter(function(e){return this[e]?!1:this[e]=!0},{})}function nf(t,e){return Math.round(t/e)*e}function rf(t,e){var n=t.getBoundingClientRect(),i=t.ownerDocument,r=i.documentElement,s=lo(i);return/webkit.*Chrome.*Mobile/i.test(navigator.userAgent)&&(s.x=0),e?n.top+s.y-r.clientTop:n.left+s.x-r.clientLeft}function Gt(t){return typeof t=="number"&&!isNaN(t)&&isFinite(t)}function so(t,e,n){n>0&&(It(t,e),setTimeout(function(){zi(t,e)},n))}function oo(t){return Math.max(Math.min(t,100),0)}function $i(t){return Array.isArray(t)?t:[t]}function sf(t){t=String(t);var e=t.split(".");return e.length>1?e[1].length:0}function It(t,e){t.classList&&!/\s/.test(e)?t.classList.add(e):t.className+=" "+e}function zi(t,e){t.classList&&!/\s/.test(e)?t.classList.remove(e):t.className=t.className.replace(new RegExp("(^|\\b)"+e.split(" ").join("|")+"(\\b|$)","gi")," ")}function of(t,e){return t.classList?t.classList.contains(e):new RegExp("\\b"+e+"\\b").test(t.className)}function lo(t){var e=window.pageXOffset!==void 0,n=(t.compatMode||"")==="CSS1Compat",i=e?window.pageXOffset:n?t.documentElement.scrollLeft:t.body.scrollLeft,r=e?window.pageYOffset:n?t.documentElement.scrollTop:t.body.scrollTop;return{x:i,y:r}}function lf(){return window.navigator.pointerEnabled?{start:"pointerdown",move:"pointermove",end:"pointerup"}:window.navigator.msPointerEnabled?{start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:{start:"mousedown touchstart",move:"mousemove touchmove",end:"mouseup touchend"}}function af(){var t=!1;try{var e=Object.defineProperty({},"passive",{get:function(){t=!0}});window.addEventListener("test",null,e)}catch{}return t}function cf(){return window.CSS&&CSS.supports&&CSS.supports("touch-action","none")}function Lr(t,e){return 100/(e-t)}function Rr(t,e,n){return e*100/(t[n+1]-t[n])}function uf(t,e){return Rr(t,t[0]<0?e+Math.abs(t[0]):e-t[0],0)}function ff(t,e){return e*(t[1]-t[0])/100+t[0]}function ri(t,e){for(var n=1;t>=e[n];)n+=1;return n}function df(t,e,n){if(n>=t.slice(-1)[0])return 100;var i=ri(n,t),r=t[i-1],s=t[i],o=e[i-1],l=e[i];return o+uf([r,s],n)/Lr(o,l)}function hf(t,e,n){if(n>=100)return t.slice(-1)[0];var i=ri(n,e),r=t[i-1],s=t[i],o=e[i-1],l=e[i];return ff([r,s],(n-o)*Lr(o,l))}function mf(t,e,n,i){if(i===100)return i;var r=ri(i,t),s=t[r-1],o=t[r];return n?i-s>(o-s)/2?o:s:e[r-1]?t[r-1]+nf(i-t[r-1],e[r-1]):i}var ao=function(){function t(e,n,i){this.xPct=[],this.xVal=[],this.xSteps=[],this.xNumSteps=[],this.xHighestCompleteStep=[],this.xSteps=[i||!1],this.xNumSteps=[!1],this.snap=n;var r,s=[];for(Object.keys(e).forEach(function(o){s.push([$i(e[o]),o])}),s.sort(function(o,l){return o[0][0]-l[0][0]}),r=0;r<s.length;r++)this.handleEntryPoint(s[r][1],s[r][0]);for(this.xNumSteps=this.xSteps.slice(0),r=0;r<this.xNumSteps.length;r++)this.handleStepPoint(r,this.xNumSteps[r])}return t.prototype.getDistance=function(e){for(var n=[],i=0;i<this.xNumSteps.length-1;i++)n[i]=Rr(this.xVal,e,i);return n},t.prototype.getAbsoluteDistance=function(e,n,i){var r=0;if(e<this.xPct[this.xPct.length-1])for(;e>this.xPct[r+1];)r++;else e===this.xPct[this.xPct.length-1]&&(r=this.xPct.length-2);!i&&e===this.xPct[r+1]&&r++,n===null&&(n=[]);var s,o=1,l=n[r],a=0,c=0,u=0,h=0;for(i?s=(e-this.xPct[r])/(this.xPct[r+1]-this.xPct[r]):s=(this.xPct[r+1]-e)/(this.xPct[r+1]-this.xPct[r]);l>0;)a=this.xPct[r+1+h]-this.xPct[r+h],n[r+h]*o+100-s*100>100?(c=a*s,o=(l-100*s)/n[r+h],s=1):(c=n[r+h]*a/100*o,o=0),i?(u=u-c,this.xPct.length+h>=1&&h--):(u=u+c,this.xPct.length-h>=1&&h++),l=n[r+h]*o;return e+u},t.prototype.toStepping=function(e){return e=df(this.xVal,this.xPct,e),e},t.prototype.fromStepping=function(e){return hf(this.xVal,this.xPct,e)},t.prototype.getStep=function(e){return e=mf(this.xPct,this.xSteps,this.snap,e),e},t.prototype.getDefaultStep=function(e,n,i){var r=ri(e,this.xPct);return(e===100||n&&e===this.xPct[r-1])&&(r=Math.max(r-1,1)),(this.xVal[r]-this.xVal[r-1])/i},t.prototype.getNearbySteps=function(e){var n=ri(e,this.xPct);return{stepBefore:{startValue:this.xVal[n-2],step:this.xNumSteps[n-2],highestStep:this.xHighestCompleteStep[n-2]},thisStep:{startValue:this.xVal[n-1],step:this.xNumSteps[n-1],highestStep:this.xHighestCompleteStep[n-1]},stepAfter:{startValue:this.xVal[n],step:this.xNumSteps[n],highestStep:this.xHighestCompleteStep[n]}}},t.prototype.countStepDecimals=function(){var e=this.xNumSteps.map(sf);return Math.max.apply(null,e)},t.prototype.hasNoSize=function(){return this.xVal[0]===this.xVal[this.xVal.length-1]},t.prototype.convert=function(e){return this.getStep(this.toStepping(e))},t.prototype.handleEntryPoint=function(e,n){var i;if(e==="min"?i=0:e==="max"?i=100:i=parseFloat(e),!Gt(i)||!Gt(n[0]))throw new Error("noUiSlider: 'range' value isn't numeric.");this.xPct.push(i),this.xVal.push(n[0]);var r=Number(n[1]);i?this.xSteps.push(isNaN(r)?!1:r):isNaN(r)||(this.xSteps[0]=r),this.xHighestCompleteStep.push(0)},t.prototype.handleStepPoint=function(e,n){if(n){if(this.xVal[e]===this.xVal[e+1]){this.xSteps[e]=this.xHighestCompleteStep[e]=this.xVal[e];return}this.xSteps[e]=Rr([this.xVal[e],this.xVal[e+1]],n,0)/Lr(this.xPct[e],this.xPct[e+1]);var i=(this.xVal[e+1]-this.xVal[e])/this.xNumSteps[e],r=Math.ceil(Number(i.toFixed(3))-1),s=this.xVal[e]+this.xNumSteps[e]*r;this.xHighestCompleteStep[e]=s}},t}(),co={to:function(t){return t===void 0?"":t.toFixed(2)},from:Number},uo={target:"target",base:"base",origin:"origin",handle:"handle",handleLower:"handle-lower",handleUpper:"handle-upper",touchArea:"touch-area",horizontal:"horizontal",vertical:"vertical",background:"background",connect:"connect",connects:"connects",ltr:"ltr",rtl:"rtl",textDirectionLtr:"txt-dir-ltr",textDirectionRtl:"txt-dir-rtl",draggable:"draggable",drag:"state-drag",tap:"state-tap",active:"active",tooltip:"tooltip",pips:"pips",pipsHorizontal:"pips-horizontal",pipsVertical:"pips-vertical",marker:"marker",markerHorizontal:"marker-horizontal",markerVertical:"marker-vertical",markerNormal:"marker-normal",markerLarge:"marker-large",markerSub:"marker-sub",value:"value",valueHorizontal:"value-horizontal",valueVertical:"value-vertical",valueNormal:"value-normal",valueLarge:"value-large",valueSub:"value-sub"},bn={tooltips:".__tooltips",aria:".__aria"};function pf(t,e){if(!Gt(e))throw new Error("noUiSlider: 'step' is not numeric.");t.singleStep=e}function gf(t,e){if(!Gt(e))throw new Error("noUiSlider: 'keyboardPageMultiplier' is not numeric.");t.keyboardPageMultiplier=e}function _f(t,e){if(!Gt(e))throw new Error("noUiSlider: 'keyboardMultiplier' is not numeric.");t.keyboardMultiplier=e}function vf(t,e){if(!Gt(e))throw new Error("noUiSlider: 'keyboardDefaultStep' is not numeric.");t.keyboardDefaultStep=e}function yf(t,e){if(typeof e!="object"||Array.isArray(e))throw new Error("noUiSlider: 'range' is not an object.");if(e.min===void 0||e.max===void 0)throw new Error("noUiSlider: Missing 'min' or 'max' in 'range'.");t.spectrum=new ao(e,t.snap||!1,t.singleStep)}function bf(t,e){if(e=$i(e),!Array.isArray(e)||!e.length)throw new Error("noUiSlider: 'start' option is incorrect.");t.handles=e.length,t.start=e}function wf(t,e){if(typeof e!="boolean")throw new Error("noUiSlider: 'snap' option must be a boolean.");t.snap=e}function Sf(t,e){if(typeof e!="boolean")throw new Error("noUiSlider: 'animate' option must be a boolean.");t.animate=e}function kf(t,e){if(typeof e!="number")throw new Error("noUiSlider: 'animationDuration' option must be a number.");t.animationDuration=e}function fo(t,e){var n=[!1],i;if(e==="lower"?e=[!0,!1]:e==="upper"&&(e=[!1,!0]),e===!0||e===!1){for(i=1;i<t.handles;i++)n.push(e);n.push(!1)}else{if(!Array.isArray(e)||!e.length||e.length!==t.handles+1)throw new Error("noUiSlider: 'connect' option doesn't match handle count.");n=e}t.connect=n}function Ef(t,e){switch(e){case"horizontal":t.ort=0;break;case"vertical":t.ort=1;break;default:throw new Error("noUiSlider: 'orientation' option is invalid.")}}function ho(t,e){if(!Gt(e))throw new Error("noUiSlider: 'margin' option must be numeric.");e!==0&&(t.margin=t.spectrum.getDistance(e))}function Cf(t,e){if(!Gt(e))throw new Error("noUiSlider: 'limit' option must be numeric.");if(t.limit=t.spectrum.getDistance(e),!t.limit||t.handles<2)throw new Error("noUiSlider: 'limit' option is only supported on linear sliders with 2 or more handles.")}function If(t,e){var n;if(!Gt(e)&&!Array.isArray(e))throw new Error("noUiSlider: 'padding' option must be numeric or array of exactly 2 numbers.");if(Array.isArray(e)&&!(e.length===2||Gt(e[0])||Gt(e[1])))throw new Error("noUiSlider: 'padding' option must be numeric or array of exactly 2 numbers.");if(e!==0){for(Array.isArray(e)||(e=[e,e]),t.padding=[t.spectrum.getDistance(e[0]),t.spectrum.getDistance(e[1])],n=0;n<t.spectrum.xNumSteps.length-1;n++)if(t.padding[0][n]<0||t.padding[1][n]<0)throw new Error("noUiSlider: 'padding' option must be a positive number(s).");var i=e[0]+e[1],r=t.spectrum.xVal[0],s=t.spectrum.xVal[t.spectrum.xVal.length-1];if(i/(s-r)>1)throw new Error("noUiSlider: 'padding' option must not exceed 100% of the range.")}}function xf(t,e){switch(e){case"ltr":t.dir=0;break;case"rtl":t.dir=1;break;default:throw new Error("noUiSlider: 'direction' option was not recognized.")}}function Mf(t,e){if(typeof e!="string")throw new Error("noUiSlider: 'behaviour' must be a string containing options.");var n=e.indexOf("tap")>=0,i=e.indexOf("drag")>=0,r=e.indexOf("fixed")>=0,s=e.indexOf("snap")>=0,o=e.indexOf("hover")>=0,l=e.indexOf("unconstrained")>=0,a=e.indexOf("invert-connects")>=0,c=e.indexOf("drag-all")>=0,u=e.indexOf("smooth-steps")>=0;if(r){if(t.handles!==2)throw new Error("noUiSlider: 'fixed' behaviour must be used with 2 handles");ho(t,t.start[1]-t.start[0])}if(a&&t.handles!==2)throw new Error("noUiSlider: 'invert-connects' behaviour must be used with 2 handles");if(l&&(t.margin||t.limit))throw new Error("noUiSlider: 'unconstrained' behaviour cannot be used with margin or limit");t.events={tap:n||s,drag:i,dragAll:c,smoothSteps:u,fixed:r,snap:s,hover:o,unconstrained:l,invertConnects:a}}function Af(t,e){if(e!==!1)if(e===!0||Di(e)){t.tooltips=[];for(var n=0;n<t.handles;n++)t.tooltips.push(e)}else{if(e=$i(e),e.length!==t.handles)throw new Error("noUiSlider: must pass a formatter for all handles.");e.forEach(function(i){if(typeof i!="boolean"&&!Di(i))throw new Error("noUiSlider: 'tooltips' must be passed a formatter or 'false'.")}),t.tooltips=e}}function Tf(t,e){if(e.length!==t.handles)throw new Error("noUiSlider: must pass a attributes for all handles.");t.handleAttributes=e}function Nf(t,e){if(!Di(e))throw new Error("noUiSlider: 'ariaFormat' requires 'to' method.");t.ariaFormat=e}function Pf(t,e){if(!ef(e))throw new Error("noUiSlider: 'format' requires 'to' and 'from' methods.");t.format=e}function Of(t,e){if(typeof e!="boolean")throw new Error("noUiSlider: 'keyboardSupport' option must be a boolean.");t.keyboardSupport=e}function Lf(t,e){t.documentElement=e}function Rf(t,e){if(typeof e!="string"&&e!==!1)throw new Error("noUiSlider: 'cssPrefix' must be a string or `false`.");t.cssPrefix=e}function Df(t,e){if(typeof e!="object")throw new Error("noUiSlider: 'cssClasses' must be an object.");typeof t.cssPrefix=="string"?(t.cssClasses={},Object.keys(e).forEach(function(n){t.cssClasses[n]=t.cssPrefix+e[n]})):t.cssClasses=e}function mo(t){var e={margin:null,limit:null,padding:null,animate:!0,animationDuration:300,ariaFormat:co,format:co},n={step:{r:!1,t:pf},keyboardPageMultiplier:{r:!1,t:gf},keyboardMultiplier:{r:!1,t:_f},keyboardDefaultStep:{r:!1,t:vf},start:{r:!0,t:bf},connect:{r:!0,t:fo},direction:{r:!0,t:xf},snap:{r:!1,t:wf},animate:{r:!1,t:Sf},animationDuration:{r:!1,t:kf},range:{r:!0,t:yf},orientation:{r:!1,t:Ef},margin:{r:!1,t:ho},limit:{r:!1,t:Cf},padding:{r:!1,t:If},behaviour:{r:!0,t:Mf},ariaFormat:{r:!1,t:Nf},format:{r:!1,t:Pf},tooltips:{r:!1,t:Af},keyboardSupport:{r:!0,t:Of},documentElement:{r:!1,t:Lf},cssPrefix:{r:!0,t:Rf},cssClasses:{r:!0,t:Df},handleAttributes:{r:!1,t:Tf}},i={connect:!1,direction:"ltr",behaviour:"tap",orientation:"horizontal",keyboardSupport:!0,cssPrefix:"noUi-",cssClasses:uo,keyboardPageMultiplier:5,keyboardMultiplier:1,keyboardDefaultStep:10};t.format&&!t.ariaFormat&&(t.ariaFormat=t.format),Object.keys(n).forEach(function(a){if(!Or(t[a])&&i[a]===void 0){if(n[a].r)throw new Error("noUiSlider: '"+a+"' is required.");return}n[a].t(e,Or(t[a])?t[a]:i[a])}),e.pips=t.pips;var r=document.createElement("div"),s=r.style.msTransform!==void 0,o=r.style.transform!==void 0;e.transformRule=o?"transform":s?"msTransform":"webkitTransform";var l=[["left","top"],["right","bottom"]];return e.style=l[e.dir][e.ort],e}function $f(t,e,n){var i=lf(),r=cf(),s=r&&af(),o=t,l,a,c,u,h,f,d=e.spectrum,m=[],p=[],g=[],_=0,S={},C=!1,w=t.ownerDocument,k=e.documentElement||w.documentElement,T=w.body,N=w.dir==="rtl"||e.ort===1?0:100;function E(M,A){var D=w.createElement("div");return A&&It(D,A),M.appendChild(D),D}function x(M,A){var D=E(M,e.cssClasses.origin),X=E(D,e.cssClasses.handle);if(E(X,e.cssClasses.touchArea),X.setAttribute("data-handle",String(A)),e.keyboardSupport&&(X.setAttribute("tabindex","0"),X.addEventListener("keydown",function(ne){return Re(ne,A)})),e.handleAttributes!==void 0){var ie=e.handleAttributes[A];Object.keys(ie).forEach(function(ne){X.setAttribute(ne,ie[ne])})}return X.setAttribute("role","slider"),X.setAttribute("aria-orientation",e.ort?"vertical":"horizontal"),A===0?It(X,e.cssClasses.handleLower):A===e.handles-1&&It(X,e.cssClasses.handleUpper),D.handle=X,D}function L(M,A){return A?E(M,e.cssClasses.connect):!1}function O(M,A){a=E(A,e.cssClasses.connects),c=[],u=[],u.push(L(a,M[0]));for(var D=0;D<e.handles;D++)c.push(x(A,D)),g[D]=D,u.push(L(a,M[D+1]))}function F(M){It(M,e.cssClasses.target),e.dir===0?It(M,e.cssClasses.ltr):It(M,e.cssClasses.rtl),e.ort===0?It(M,e.cssClasses.horizontal):It(M,e.cssClasses.vertical);var A=getComputedStyle(M).direction;return A==="rtl"?It(M,e.cssClasses.textDirectionRtl):It(M,e.cssClasses.textDirectionLtr),E(M,e.cssClasses.base)}function R(M,A){return!e.tooltips||!e.tooltips[A]?!1:E(M.firstChild,e.cssClasses.tooltip)}function I(){return o.hasAttribute("disabled")}function U(M){var A=c[M];return A.hasAttribute("disabled")}function P(M){M!=null?(c[M].setAttribute("disabled",""),c[M].handle.removeAttribute("tabindex")):(o.setAttribute("disabled",""),c.forEach(function(A){A.handle.removeAttribute("tabindex")}))}function G(M){M!=null?(c[M].removeAttribute("disabled"),c[M].handle.setAttribute("tabindex","0")):(o.removeAttribute("disabled"),c.forEach(function(A){A.removeAttribute("disabled"),A.handle.setAttribute("tabindex","0")}))}function V(){f&&(ut("update"+bn.tooltips),f.forEach(function(M){M&&io(M)}),f=null)}function q(){V(),f=c.map(R),gt("update"+bn.tooltips,function(M,A,D){if(!(!f||!e.tooltips)&&f[A]!==!1){var X=M[A];e.tooltips[A]!==!0&&(X=e.tooltips[A].to(D[A])),f[A].innerHTML=X}})}function J(){ut("update"+bn.aria),gt("update"+bn.aria,function(M,A,D,X,ie){g.forEach(function(ne){var ye=c[ne],le=Mt(p,ne,0,!0,!0,!0),it=Mt(p,ne,100,!0,!0,!0),Se=ie[ne],Je=String(e.ariaFormat.to(D[ne]));le=d.fromStepping(le).toFixed(1),it=d.fromStepping(it).toFixed(1),Se=d.fromStepping(Se).toFixed(1),ye.children[0].setAttribute("aria-valuemin",le),ye.children[0].setAttribute("aria-valuemax",it),ye.children[0].setAttribute("aria-valuenow",Se),ye.children[0].setAttribute("aria-valuetext",Je)})})}function ue(M){if(M.mode===yn.Range||M.mode===yn.Steps)return d.xVal;if(M.mode===yn.Count){if(M.values<2)throw new Error("noUiSlider: 'values' (>= 2) required for mode 'count'.");for(var A=M.values-1,D=100/A,X=[];A--;)X[A]=A*D;return X.push(100),ce(X,M.stepped)}return M.mode===yn.Positions?ce(M.values,M.stepped):M.mode===yn.Values?M.stepped?M.values.map(function(ie){return d.fromStepping(d.getStep(d.toStepping(ie)))}):M.values:[]}function ce(M,A){return M.map(function(D){return d.fromStepping(A?d.getStep(D):D)})}function we(M){function A(Se,Je){return Number((Se+Je).toFixed(7))}var D=ue(M),X={},ie=d.xVal[0],ne=d.xVal[d.xVal.length-1],ye=!1,le=!1,it=0;return D=tf(D.slice().sort(function(Se,Je){return Se-Je})),D[0]!==ie&&(D.unshift(ie),ye=!0),D[D.length-1]!==ne&&(D.push(ne),le=!0),D.forEach(function(Se,Je){var ae,pe,ke,rt=Se,at=D[Je+1],ft,mn,Nn,Is,Vc,xs,Uc,Bc=M.mode===yn.Steps;for(Bc&&(ae=d.xNumSteps[Je]),ae||(ae=at-rt),at===void 0&&(at=rt),ae=Math.max(ae,1e-7),pe=rt;pe<=at;pe=A(pe,ae)){for(ft=d.toStepping(pe),mn=ft-it,Vc=mn/(M.density||1),xs=Math.round(Vc),Uc=mn/xs,ke=1;ke<=xs;ke+=1)Nn=it+ke*Uc,X[Nn.toFixed(5)]=[d.fromStepping(Nn),0];Is=D.indexOf(pe)>-1?Nt.LargeValue:Bc?Nt.SmallValue:Nt.NoValue,!Je&&ye&&pe!==at&&(Is=0),pe===at&&le||(X[ft.toFixed(5)]=[pe,Is]),it=ft}}),X}function fe(M,A,D){var X,ie,ne=w.createElement("div"),ye=(X={},X[Nt.None]="",X[Nt.NoValue]=e.cssClasses.valueNormal,X[Nt.LargeValue]=e.cssClasses.valueLarge,X[Nt.SmallValue]=e.cssClasses.valueSub,X),le=(ie={},ie[Nt.None]="",ie[Nt.NoValue]=e.cssClasses.markerNormal,ie[Nt.LargeValue]=e.cssClasses.markerLarge,ie[Nt.SmallValue]=e.cssClasses.markerSub,ie),it=[e.cssClasses.valueHorizontal,e.cssClasses.valueVertical],Se=[e.cssClasses.markerHorizontal,e.cssClasses.markerVertical];It(ne,e.cssClasses.pips),It(ne,e.ort===0?e.cssClasses.pipsHorizontal:e.cssClasses.pipsVertical);function Je(pe,ke){var rt=ke===e.cssClasses.value,at=rt?it:Se,ft=rt?ye:le;return ke+" "+at[e.ort]+" "+ft[pe]}function ae(pe,ke,rt){if(rt=A?A(ke,rt):rt,rt!==Nt.None){var at=E(ne,!1);at.className=Je(rt,e.cssClasses.marker),at.style[e.style]=pe+"%",rt>Nt.NoValue&&(at=E(ne,!1),at.className=Je(rt,e.cssClasses.value),at.setAttribute("data-value",String(ke)),at.style[e.style]=pe+"%",at.innerHTML=String(D.to(ke)))}}return Object.keys(M).forEach(function(pe){ae(pe,M[pe][0],M[pe][1])}),ne}function Fe(){h&&(io(h),h=null)}function Ge(M){Fe();var A=we(M),D=M.filter,X=M.format||{to:function(ie){return String(Math.round(ie))}};return h=o.appendChild(fe(A,D,X)),h}function he(){var M=l.getBoundingClientRect(),A="offset"+["Width","Height"][e.ort];return e.ort===0?M.width||l[A]:M.height||l[A]}function W(M,A,D,X){var ie=function(ye){var le=ee(ye,X.pageOffset,X.target||A);if(!le||I()&&!X.doNotReject||of(o,e.cssClasses.tap)&&!X.doNotReject||M===i.start&&le.buttons!==void 0&&le.buttons>1||X.hover&&le.buttons)return!1;s||le.preventDefault(),le.calcPoint=le.points[e.ort],D(le,X)},ne=[];return M.split(" ").forEach(function(ye){A.addEventListener(ye,ie,s?{passive:!0}:!1),ne.push([ye,ie])}),ne}function ee(M,A,D){var X=M.type.indexOf("touch")===0,ie=M.type.indexOf("mouse")===0,ne=M.type.indexOf("pointer")===0,ye=0,le=0;if(M.type.indexOf("MSPointer")===0&&(ne=!0),M.type==="mousedown"&&!M.buttons&&!M.touches)return!1;if(X){var it=function(ae){var pe=ae.target;return pe===D||D.contains(pe)||M.composed&&M.composedPath().shift()===D};if(M.type==="touchstart"){var Se=Array.prototype.filter.call(M.touches,it);if(Se.length>1)return!1;ye=Se[0].pageX,le=Se[0].pageY}else{var Je=Array.prototype.find.call(M.changedTouches,it);if(!Je)return!1;ye=Je.pageX,le=Je.pageY}}return A=A||lo(w),(ie||ne)&&(ye=M.clientX+A.x,le=M.clientY+A.y),M.pageOffset=A,M.points=[ye,le],M.cursor=ie||ne,M}function se(M){var A=M-rf(l,e.ort),D=A*100/he();return D=oo(D),e.dir?100-D:D}function Q(M){var A=100,D=!1;return c.forEach(function(X,ie){if(!U(ie)){var ne=p[ie],ye=Math.abs(ne-M),le=ye===100&&A===100,it=ye<A,Se=ye<=A&&M>ne;(it||Se||le)&&(D=ie,A=ye)}}),D}function oe(M,A){M.type==="mouseout"&&M.target.nodeName==="HTML"&&M.relatedTarget===null&&Xe(M,A)}function Le(M,A){if(navigator.appVersion.indexOf("MSIE 9")===-1&&M.buttons===0&&A.buttonsProperty!==0)return Xe(M,A);var D=(e.dir?-1:1)*(M.calcPoint-A.startCalcPoint),X=D*100/A.baseSize;pt(D>0,X,A.locations,A.handleNumbers,A.connect)}function Xe(M,A){A.handle&&(zi(A.handle,e.cssClasses.active),_-=1),A.listeners.forEach(function(D){k.removeEventListener(D[0],D[1])}),_===0&&(zi(o,e.cssClasses.drag),de(),M.cursor&&(T.style.cursor="",T.removeEventListener("selectstart",ro))),e.events.smoothSteps&&(A.handleNumbers.forEach(function(D){Pe(D,p[D],!0,!0,!1,!1)}),A.handleNumbers.forEach(function(D){De("update",D)})),A.handleNumbers.forEach(function(D){De("change",D),De("set",D),De("end",D)})}function Ze(M,A){if(!A.handleNumbers.some(U)){var D;if(A.handleNumbers.length===1){var X=c[A.handleNumbers[0]];D=X.children[0],_+=1,It(D,e.cssClasses.active)}M.stopPropagation();var ie=[],ne=W(i.move,k,Le,{target:M.target,handle:D,connect:A.connect,listeners:ie,startCalcPoint:M.calcPoint,baseSize:he(),pageOffset:M.pageOffset,handleNumbers:A.handleNumbers,buttonsProperty:M.buttons,locations:p.slice()}),ye=W(i.end,k,Xe,{target:M.target,handle:D,listeners:ie,doNotReject:!0,handleNumbers:A.handleNumbers}),le=W("mouseout",k,oe,{target:M.target,handle:D,listeners:ie,doNotReject:!0,handleNumbers:A.handleNumbers});ie.push.apply(ie,ne.concat(ye,le)),M.cursor&&(T.style.cursor=getComputedStyle(M.target).cursor,c.length>1&&It(o,e.cssClasses.drag),T.addEventListener("selectstart",ro,!1)),A.handleNumbers.forEach(function(it){De("start",it)})}}function Ee(M){M.stopPropagation();var A=se(M.calcPoint),D=Q(A);D!==!1&&(e.events.snap||so(o,e.cssClasses.tap,e.animationDuration),Pe(D,A,!0,!0),de(),De("slide",D,!0),De("update",D,!0),e.events.snap?Ze(M,{handleNumbers:[D]}):(De("change",D,!0),De("set",D,!0)))}function Ie(M){var A=se(M.calcPoint),D=d.getStep(A),X=d.fromStepping(D);Object.keys(S).forEach(function(ie){ie.split(".")[0]==="hover"&&S[ie].forEach(function(ne){ne.call(kt,X)})})}function Re(M,A){if(I()||U(A))return!1;var D=["Left","Right"],X=["Down","Up"],ie=["PageDown","PageUp"],ne=["Home","End"];e.dir&&!e.ort?D.reverse():e.ort&&!e.dir&&(X.reverse(),ie.reverse());var ye=M.key.replace("Arrow",""),le=ye===ie[0],it=ye===ie[1],Se=ye===X[0]||ye===D[0]||le,Je=ye===X[1]||ye===D[1]||it,ae=ye===ne[0],pe=ye===ne[1];if(!Se&&!Je&&!ae&&!pe)return!0;M.preventDefault();var ke;if(Je||Se){var rt=Se?0:1,at=Ae(A),ft=at[rt];if(ft===null)return!1;ft===!1&&(ft=d.getDefaultStep(p[A],Se,e.keyboardDefaultStep)),it||le?ft*=e.keyboardPageMultiplier:ft*=e.keyboardMultiplier,ft=Math.max(ft,1e-7),ft=(Se?-1:1)*ft,ke=m[A]+ft}else pe?ke=e.spectrum.xVal[e.spectrum.xVal.length-1]:ke=e.spectrum.xVal[0];return Pe(A,d.toStepping(ke),!0,!0),De("slide",A),De("update",A),De("change",A),De("set",A),!1}function ot(M){M.fixed||c.forEach(function(A,D){W(i.start,A.children[0],Ze,{handleNumbers:[D]})}),M.tap&&W(i.start,l,Ee,{}),M.hover&&W(i.move,l,Ie,{hover:!0}),M.drag&&u.forEach(function(A,D){if(!(A===!1||D===0||D===u.length-1)){var X=c[D-1],ie=c[D],ne=[A],ye=[X,ie],le=[D-1,D];It(A,e.cssClasses.draggable),M.fixed&&(ne.push(X.children[0]),ne.push(ie.children[0])),M.dragAll&&(ye=c,le=g),ne.forEach(function(it){W(i.start,it,Ze,{handles:ye,handleNumbers:le,connect:A})})}})}function gt(M,A){S[M]=S[M]||[],S[M].push(A),M.split(".")[0]==="update"&&c.forEach(function(D,X){De("update",X)})}function St(M){return M===bn.aria||M===bn.tooltips}function ut(M){var A=M&&M.split(".")[0],D=A?M.substring(A.length):M;Object.keys(S).forEach(function(X){var ie=X.split(".")[0],ne=X.substring(ie.length);(!A||A===ie)&&(!D||D===ne)&&(!St(ne)||D===ne)&&delete S[X]})}function De(M,A,D){Object.keys(S).forEach(function(X){var ie=X.split(".")[0];M===ie&&S[X].forEach(function(ne){ne.call(kt,m.map(e.format.to),A,m.slice(),D||!1,p.slice(),kt)})})}function Mt(M,A,D,X,ie,ne,ye){var le;return c.length>1&&!e.events.unconstrained&&(X&&A>0&&(le=d.getAbsoluteDistance(M[A-1],e.margin,!1),D=Math.max(D,le)),ie&&A<c.length-1&&(le=d.getAbsoluteDistance(M[A+1],e.margin,!0),D=Math.min(D,le))),c.length>1&&e.limit&&(X&&A>0&&(le=d.getAbsoluteDistance(M[A-1],e.limit,!1),D=Math.min(D,le)),ie&&A<c.length-1&&(le=d.getAbsoluteDistance(M[A+1],e.limit,!0),D=Math.max(D,le))),e.padding&&(A===0&&(le=d.getAbsoluteDistance(0,e.padding[0],!1),D=Math.max(D,le)),A===c.length-1&&(le=d.getAbsoluteDistance(100,e.padding[1],!0),D=Math.min(D,le))),ye||(D=d.getStep(D)),D=oo(D),D===M[A]&&!ne?!1:D}function Ue(M,A){var D=e.ort;return(D?A:M)+", "+(D?M:A)}function pt(M,A,D,X,ie){var ne=D.slice(),ye=X[0],le=e.events.smoothSteps,it=[!M,M],Se=[M,!M];X=X.slice(),M&&X.reverse(),X.length>1?X.forEach(function(ae,pe){var ke=Mt(ne,ae,ne[ae]+A,it[pe],Se[pe],!1,le);ke===!1?A=0:(A=ke-ne[ae],ne[ae]=ke)}):it=Se=[!0];var Je=!1;X.forEach(function(ae,pe){Je=Pe(ae,D[ae]+A,it[pe],Se[pe],!1,le)||Je}),Je&&(X.forEach(function(ae){De("update",ae),De("slide",ae)}),ie!=null&&De("drag",ye))}function Be(M,A){return e.dir?100-M-A:M}function Y(M,A){p[M]=A,m[M]=d.fromStepping(A);var D=Be(A,0)-N,X="translate("+Ue(D+"%","0")+")";if(c[M].style[e.transformRule]=X,e.events.invertConnects&&p.length>1){var ie=p.every(function(ne,ye,le){return ye===0||ne>=le[ye-1]});if(C!==!ie){me();return}}be(M),be(M+1),C&&(be(M-1),be(M+2))}function de(){g.forEach(function(M){var A=p[M]>50?-1:1,D=3+(c.length+A*M);c[M].style.zIndex=String(D)})}function Pe(M,A,D,X,ie,ne){return ie||(A=Mt(p,M,A,D,X,!1,ne)),A===!1?!1:(Y(M,A),!0)}function be(M){if(u[M]){var A=p.slice();C&&A.sort(function(le,it){return le-it});var D=0,X=100;M!==0&&(D=A[M-1]),M!==u.length-1&&(X=A[M]);var ie=X-D,ne="translate("+Ue(Be(D,ie)+"%","0")+")",ye="scale("+Ue(ie/100,"1")+")";u[M].style[e.transformRule]=ne+" "+ye}}function st(M,A){return M===null||M===!1||M===void 0||(typeof M=="number"&&(M=String(M)),M=e.format.from(M),M!==!1&&(M=d.toStepping(M)),M===!1||isNaN(M))?p[A]:M}function qe(M,A,D){var X=$i(M),ie=p[0]===void 0;A=A===void 0?!0:A,e.animate&&!ie&&so(o,e.cssClasses.tap,e.animationDuration),g.forEach(function(le){Pe(le,st(X[le],le),!0,!1,D)});var ne=g.length===1?0:1;if(ie&&d.hasNoSize()&&(D=!0,p[0]=0,g.length>1)){var ye=100/(g.length-1);g.forEach(function(le){p[le]=le*ye})}for(;ne<g.length;++ne)g.forEach(function(le){Pe(le,p[le],!0,!0,D)});de(),g.forEach(function(le){De("update",le),X[le]!==null&&A&&De("set",le)})}function lt(M){qe(e.start,M)}function Ke(M,A,D,X){if(M=Number(M),!(M>=0&&M<g.length))throw new Error("noUiSlider: invalid handle number, got: "+M);Pe(M,st(A,M),!0,!0,X),De("update",M),D&&De("set",M)}function Qe(M){if(M===void 0&&(M=!1),M)return m.length===1?m[0]:m.slice(0);var A=m.map(e.format.to);return A.length===1?A[0]:A}function Te(){for(ut(bn.aria),ut(bn.tooltips),Object.keys(e.cssClasses).forEach(function(M){zi(o,e.cssClasses[M])});o.firstChild;)o.removeChild(o.firstChild);delete o.noUiSlider}function Ae(M){var A=p[M],D=d.getNearbySteps(A),X=m[M],ie=D.thisStep.step,ne=null;if(e.snap)return[X-D.stepBefore.startValue||null,D.stepAfter.startValue-X||null];ie!==!1&&X+ie>D.stepAfter.startValue&&(ie=D.stepAfter.startValue-X),X>D.thisStep.startValue?ne=D.thisStep.step:D.stepBefore.step===!1?ne=!1:ne=X-D.stepBefore.highestStep,A===100?ie=null:A===0&&(ne=null);var ye=d.countStepDecimals();return ie!==null&&ie!==!1&&(ie=Number(ie.toFixed(ye))),ne!==null&&ne!==!1&&(ne=Number(ne.toFixed(ye))),[ne,ie]}function ht(){return g.map(Ae)}function et(M,A){var D=Qe(),X=["margin","limit","padding","range","animate","snap","step","format","pips","tooltips","connect"];X.forEach(function(ne){M[ne]!==void 0&&(n[ne]=M[ne])});var ie=mo(n);X.forEach(function(ne){M[ne]!==void 0&&(e[ne]=ie[ne])}),d=ie.spectrum,e.margin=ie.margin,e.limit=ie.limit,e.padding=ie.padding,e.pips?Ge(e.pips):Fe(),e.tooltips?q():V(),p=[],qe(Or(M.start)?M.start:D,A),M.connect&&Z()}function Z(){for(;a.firstChild;)a.removeChild(a.firstChild);for(var M=0;M<=e.handles;M++)u[M]=L(a,e.connect[M]),be(M);ot({drag:e.events.drag,fixed:!0})}function me(){C=!C,fo(e,e.connect.map(function(M){return!M})),Z()}function $e(){l=F(o),O(e.connect,l),ot(e.events),qe(e.start),e.pips&&Ge(e.pips),e.tooltips&&q(),J()}$e();var kt={destroy:Te,steps:ht,on:gt,off:ut,get:Qe,set:qe,setHandle:Ke,reset:lt,disable:P,enable:G,__moveHandles:function(M,A,D){pt(M,A,p,D)},options:n,updateOptions:et,target:o,removePips:Fe,removeTooltips:V,getPositions:function(){return p.slice()},getTooltips:function(){return f},getOrigins:function(){return c},pips:Ge};return kt}function zf(t,e){if(!t||!t.nodeName)throw new Error("noUiSlider: create requires a single element, got: "+t);if(t.noUiSlider)throw new Error("noUiSlider: Slider was already initialized.");var n=mo(e),i=$f(t,n,e);return t.noUiSlider=i,i}const jf={__spectrum:ao,cssClasses:uo,create:zf},Zy="",eb="";function Ff(t){let e,n,i;return{c(){e=b("span"),n=re(t[0]),v(e,"id",t[3]),v(e,"class",i="tooltip "+t[2]+" "+(t[1]?"display":"")+" svelte-1am23me")},m(r,s){z(r,e,s),y(e,n)},p(r,[s]){s&1&&je(n,r[0]),s&6&&i!==(i="tooltip "+r[2]+" "+(r[1]?"display":"")+" svelte-1am23me")&&v(e,"class",i)},i:te,o:te,d(r){r&&$(e)}}}function Hf(t,e,n){let i,r,s,o,{tooltipText:l}=e,{targetHtmlId:a}=e;const c=`tooltip-generic-${window.crypto.randomUUID()}`,u=()=>n(1,o=!0),h=()=>n(1,o=!1),f=()=>n(1,o=!o);return Rn(()=>{s=a?document.getElementById(a):document.getElementById(c).parentElement,a&&!s&&(console.error(`TooltipGeneric: element with ID ${a} not found, defaulting to the parent element`),s=document.getElementById(c).targetElement),s.addEventListener("mouseover",u),s.addEventListener("mouseout",h),s.addEventListener("click",f)}),Dn(()=>{s.removeEventListener("mouseover",u),s.removeEventListener("mouseout",h),s.removeEventListener("click",f)}),t.$$set=d=>{"tooltipText"in d&&n(0,l=d.tooltipText),"targetHtmlId"in d&&n(4,a=d.targetHtmlId)},t.$$.update=()=>{t.$$.dirty&33&&n(2,i=r(l))},n(5,r=d=>n(2,i=d.length>100?"tooltip-wide":d.length>20?"tooltip-mid":"tooltip-thin")),s=void 0,n(1,o=!1),[l,o,i,c,a,r]}class ji extends Ve{constructor(e){super(),He(this,e,Hf,Ff,ze,{tooltipText:0,targetHtmlId:4})}}const tb="";function Vf(t){let e,n,i,r,s,o,l,a,c,u,h,f,d,m,p,g;return{c(){e=b("div"),n=b("span"),i=re(t[2]),r=re(" ("),s=re(t[3]),o=re(")"),l=j(),a=b("div"),c=b("span"),u=re(t[0]),h=j(),f=b("div"),d=b("div"),m=j(),p=b("span"),g=re(t[1]),v(c,"class","range-marker svelte-216mtn"),v(d,"class","slider"),v(d,"id",t[4]),v(f,"class","slider-wrapper svelte-216mtn"),v(p,"class","range-marker svelte-216mtn"),v(a,"class","slider-outer-wrapper is-flex flex-direction-row svelte-216mtn")},m(_,S){z(_,e,S),y(e,n),y(n,i),y(n,r),y(n,s),y(n,o),y(e,l),y(e,a),y(a,c),y(c,u),y(a,h),y(a,f),y(f,d),y(a,m),y(a,p),y(p,g)},p(_,[S]){S&4&&je(i,_[2]),S&8&&je(s,_[3]),S&1&&je(u,_[0]),S&2&&je(g,_[1])},i:te,o:te,d(_){_&&$(e)}}}function Uf(t,e,n){let i,{minVal:r}=e,{maxVal:s}=e,{start:o}=e,{step:l=void 0}=e,{roundTo:a=2}=e,{title:c=""}=e,{emitOnUpdate:u=!1}=e;const h=Ti(),f=`slider-${window.crypto.randomUUID()}`,d=Array.isArray(o)&&o.length===2&&o.every(E=>!isNaN(parseFloat(E))),m=[],p=d?[`noUi-handle-${window.crypto.randomUUID()}`,`noUi-handle-${window.crypto.randomUUID()}`]:[`noUi-handle-${window.crypto.randomUUID()}`],g=Li();g.setCompareFn(d?Nr:(E,x)=>S(E)===S(x)),g.set(o);const _=zt("resetTrigger")||void 0;_==null||_.subscribe(k);const S=E=>Number(E.toFixed(a)),C=(E,x)=>{E=Array.isArray(E)?E.map(S):S(E),n(3,i=E),(x==="set"||x==="update"&&u)&&(g.set(E),g.same()||h("updateSlider",g.get()))};function w(E){m.length&&m.map((x,L)=>x.$set({tooltipText:d?E[L]:E}))}function k(){const E=document.getElementById(f);E!=null&&E.noUiSlider&&E.noUiSlider.reset()}function T(){const E=document.getElementById(f);let x;jf.create(E,{start:o,step:l,connect:d?!0:"lower",range:{min:r,max:s},handleAttributes:p.map(L=>({id:L}))}),E.noUiSlider.on("update",()=>{x=E.noUiSlider.get(!0),C(x,"update")}),E.noUiSlider.on("set",()=>{x=E.noUiSlider.get(!0),C(x,"set")})}function N(){p.map((E,x)=>{m.push(new ji({target:document.getElementById(E),props:d?{tooltipText:i[x]}:{tooltipText:i}}))})}return Rn(()=>{T(),N()}),Dn(()=>{document.getElementById(f)&&(document.getElementById(f).innerHTML="")}),t.$$set=E=>{"minVal"in E&&n(0,r=E.minVal),"maxVal"in E&&n(1,s=E.maxVal),"start"in E&&n(5,o=E.start),"step"in E&&n(6,l=E.step),"roundTo"in E&&n(7,a=E.roundTo),"title"in E&&n(2,c=E.title),"emitOnUpdate"in E&&n(8,u=E.emitOnUpdate)},t.$$.update=()=>{t.$$.dirty&32&&n(3,i=o),t.$$.dirty&8&&w(i)},[r,s,c,i,f,o,l,a,u]}class En extends Ve{constructor(e){super(),He(this,e,Uf,Vf,ze,{minVal:0,maxVal:1,start:5,step:6,roundTo:7,title:2,emitOnUpdate:8})}}const Bf=t=>({}),po=t=>({});function go(t,e,n){const i=t.slice();return i[44]=e[n],i}function _o(t,e,n){const i=t.slice();return i[47]=e[n],i}function vo(t,e,n){const i=t.slice();return i[44]=e[n],i}function yo(t,e,n){const i=t.slice();i[52]=e[n];const r=Object.keys(i[28][i[52]]||{});return i[53]=r,i}function bo(t){var et;let e,n,i,r=((et=t[0])==null?void 0:et.title)+"",s,o,l,a,c,u,h,f,d,m=(t[3].pairs||0)+"",p,g,_,S,C,w,k,T=(t[3].images||0)+"",N,E,x,L,O,F,R,I=(t[4]||0)+"",U,P,G,V,q,J,ue,ce,we,fe,Fe,Ge,he,W,ee,se,Q,oe,Le,Xe,Ze,Ee,Ie,Re,ot,gt,St,ut,De,Mt,Ue,pt=["Series","Witness","Work"],Be=[];for(let Z=0;Z<3;Z+=1)Be[Z]=wo(yo(t,pt,Z));q=new Zu({props:{documentNodes:t[5],selectedRegions:t[6],toggleRegion:t[18],selectAllRegions:t[17]}});let Y=["all","filtered"],de=[];for(let Z=0;Z<2;Z+=1)de[Z]=So(vo(t,Y,Z));let Pe=t[29],be=[];for(let Z=0;Z<Pe.length;Z+=1)be[Z]=ko(_o(t,Pe,Z));const st=Z=>K(be[Z],1,1,()=>{be[Z]=null});let qe=["threshold","topk"],lt=[];for(let Z=0;Z<2;Z+=1)lt[Z]=Eo(go(t,qe,Z));const Ke=[Wf,Kf],Qe=[];function Te(Z,me){return Z[7]==="threshold"?0:1}Ie=Te(t),Re=Qe[Ie]=Ke[Ie](t);const Ae=t[35].datavizInfo,ht=Vt(Ae,t,t[34],po);return{c(){e=b("div"),n=b("div"),i=b("h1"),s=re(r),o=j(),l=b("div");for(let Z=0;Z<3;Z+=1)Be[Z].c();a=j(),c=b("div"),u=b("div"),h=b("p"),h.textContent=`${B==="en"?"Pairs":"Paires"}`,f=j(),d=b("p"),p=re(m),g=j(),_=b("div"),S=b("div"),C=b("p"),C.textContent="Images",w=j(),k=b("p"),N=re(T),E=j(),x=b("div"),L=b("div"),O=b("p"),O.textContent="Clusters",F=j(),R=b("p"),U=re(I),P=j(),G=b("hr"),V=j(),ve(q.$$.fragment),J=j(),ue=b("hr"),ce=j(),we=b("div"),fe=b("h3"),fe.textContent=`${B==="en"?"Similarity categories":"Catégories de similarité"}`,Fe=j(),Ge=b("div");for(let Z=0;Z<2;Z+=1)de[Z].c();he=j(),W=b("div");for(let Z=0;Z<be.length;Z+=1)be[Z].c();ee=j(),se=b("hr"),Q=j(),oe=b("div"),Le=b("h3"),Le.textContent=`${B==="en"?"Similarity score":"Score de similarité"}`,Xe=j(),Ze=b("div");for(let Z=0;Z<2;Z+=1)lt[Z].c();Ee=j(),Re.c(),ot=j(),gt=b("hr"),St=j(),ut=b("div"),De=b("h3"),De.textContent=`${B==="en"?"Visualisation information":"Informations sur la visualisation"}`,Mt=j(),ht&&ht.c(),v(i,"class","title"),v(h,"class","heading"),v(d,"class","title is-5"),v(c,"class","level-item has-text-centered"),v(C,"class","heading"),v(k,"class","title is-5"),v(_,"class","level-item has-text-centered"),v(O,"class","heading"),v(R,"class","title is-5"),v(x,"class","level-item has-text-centered"),v(l,"class","level"),v(n,"class","pb-2"),v(fe,"class","title"),v(Ge,"class","buttons mb-3"),v(W,"class","level"),Ye(W,"is-disabled",t[1]==="all"),v(we,"class","pt-2"),v(Le,"class","title"),v(Ze,"class","buttons mb-3"),v(oe,"class","pt-2"),v(De,"class","title"),v(ut,"class","py-2"),v(e,"class","content is-small mt-4")},m(Z,me){z(Z,e,me),y(e,n),y(n,i),y(i,s),y(n,o),y(n,l);for(let $e=0;$e<3;$e+=1)Be[$e]&&Be[$e].m(l,null);y(l,a),y(l,c),y(c,u),y(u,h),y(u,f),y(u,d),y(d,p),y(l,g),y(l,_),y(_,S),y(S,C),y(S,w),y(S,k),y(k,N),y(l,E),y(l,x),y(x,L),y(L,O),y(L,F),y(L,R),y(R,U),y(e,P),y(e,G),y(e,V),ge(q,e,null),y(e,J),y(e,ue),y(e,ce),y(e,we),y(we,fe),y(we,Fe),y(we,Ge);for(let $e=0;$e<2;$e+=1)de[$e]&&de[$e].m(Ge,null);y(we,he),y(we,W);for(let $e=0;$e<be.length;$e+=1)be[$e]&&be[$e].m(W,null);y(e,ee),y(e,se),y(e,Q),y(e,oe),y(oe,Le),y(oe,Xe),y(oe,Ze);for(let $e=0;$e<2;$e+=1)lt[$e]&&lt[$e].m(Ze,null);y(oe,Ee),Qe[Ie].m(oe,null),y(e,ot),y(e,gt),y(e,St),y(e,ut),y(ut,De),y(ut,Mt),ht&&ht.m(ut,null),Ue=!0},p(Z,me){var M;if((!Ue||me[0]&1)&&r!==(r=((M=Z[0])==null?void 0:M.title)+"")&&je(s,r),me[0]&268435456){pt=["Series","Witness","Work"];let A;for(A=0;A<3;A+=1){const D=yo(Z,pt,A);Be[A]?Be[A].p(D,me):(Be[A]=wo(D),Be[A].c(),Be[A].m(l,a))}for(;A<3;A+=1)Be[A].d(1)}(!Ue||me[0]&8)&&m!==(m=(Z[3].pairs||0)+"")&&je(p,m),(!Ue||me[0]&8)&&T!==(T=(Z[3].images||0)+"")&&je(N,T),(!Ue||me[0]&16)&&I!==(I=(Z[4]||0)+"")&&je(U,I);const $e={};if(me[0]&32&&($e.documentNodes=Z[5]),me[0]&64&&($e.selectedRegions=Z[6]),q.$set($e),me[0]&1073741826){Y=["all","filtered"];let A;for(A=0;A<2;A+=1){const D=vo(Z,Y,A);de[A]?de[A].p(D,me):(de[A]=So(D),de[A].c(),de[A].m(Ge,null))}for(;A<2;A+=1)de[A].d(1)}if(me[0]&536903694){Pe=Z[29];let A;for(A=0;A<Pe.length;A+=1){const D=_o(Z,Pe,A);be[A]?(be[A].p(D,me),H(be[A],1)):(be[A]=ko(D),be[A].c(),H(be[A],1),be[A].m(W,null))}for(tt(),A=Pe.length;A<be.length;A+=1)st(A);nt()}if((!Ue||me[0]&2)&&Ye(W,"is-disabled",Z[1]==="all"),me[0]&128|me[1]&1){qe=["threshold","topk"];let A;for(A=0;A<2;A+=1){const D=go(Z,qe,A);lt[A]?lt[A].p(D,me):(lt[A]=Eo(D),lt[A].c(),lt[A].m(Ze,null))}for(;A<2;A+=1)lt[A].d(1)}let kt=Ie;Ie=Te(Z),Ie===kt?Qe[Ie].p(Z,me):(tt(),K(Qe[kt],1,1,()=>{Qe[kt]=null}),nt(),Re=Qe[Ie],Re?Re.p(Z,me):(Re=Qe[Ie]=Ke[Ie](Z),Re.c()),H(Re,1),Re.m(oe,null)),ht&&ht.p&&(!Ue||me[1]&8)&&Bt(ht,Ae,Z,Z[34],Ue?Ut(Ae,Z[34],me,Bf):qt(Z[34]),po)},i(Z){if(!Ue){H(q.$$.fragment,Z);for(let me=0;me<Pe.length;me+=1)H(be[me]);H(Re),H(ht,Z),Ue=!0}},o(Z){K(q.$$.fragment,Z),be=be.filter(Boolean);for(let me=0;me<be.length;me+=1)K(be[me]);K(Re),K(ht,Z),Ue=!1},d(Z){Z&&$(e),wt(Be,Z),_e(q),wt(de,Z),wt(be,Z),wt(lt,Z),Qe[Ie].d(),ht&&ht.d(Z)}}}function qf(t){let e,n,i,r=Oi[t[52]]+"",s,o,l,a=(t[53].length||0)+"",c;return{c(){e=b("div"),n=b("div"),i=b("p"),s=re(r),o=j(),l=b("p"),c=re(a),v(i,"class","heading"),v(l,"class","title is-5"),v(e,"class","level-item has-text-centered")},m(u,h){z(u,e,h),y(e,n),y(n,i),y(i,s),y(n,o),y(n,l),y(l,c)},p:te,d(u){u&&$(e)}}}function wo(t){let e,n=t[53].length>0&&qf(t);return{c(){n&&n.c(),e=Ct()},m(i,r){n&&n.m(i,r),z(i,e,r)},p(i,r){i[53].length>0&&n.p(i,r)},d(i){n&&n.d(i),i&&$(e)}}}function So(t){let e,n=t[44]==="all"?B==="en"?"All pairs":"Toutes les paires":B==="en"?"Filter by category":"Filtrer par catégorie",i,r,s,o;function l(){return t[36](t[44])}return{c(){e=b("button"),i=re(n),r=j(),v(e,"class","button is-small is-flex-grow-1"),Ye(e,"is-link",t[1]===t[44]),Ye(e,"is-contrasted",t[1]!==t[44])},m(a,c){z(a,e,c),y(e,i),y(e,r),s||(o=Ce(e,"click",l),s=!0)},p(a,c){t=a,c[0]&2&&Ye(e,"is-link",t[1]===t[44]),c[0]&2&&Ye(e,"is-contrasted",t[1]!==t[44])},d(a){a&&$(e),s=!1,o()}}}function ko(t){let e,n,i,r,s,o=(t[3].categories[t[47]]||0)+"",l,a,c;return i=new Bn({props:{category:t[47],isSelected:t[2].includes(t[47]),toggle:t[37],selectable:t[1]==="filtered"}}),{c(){e=b("div"),n=b("div"),ve(i.$$.fragment),r=j(),s=b("p"),l=re(o),a=j(),v(s,"class","is-size-7 mt-1"),v(e,"class","level-item has-text-centered")},m(u,h){z(u,e,h),y(e,n),ge(i,n,null),y(n,r),y(n,s),y(s,l),y(e,a),c=!0},p(u,h){const f={};h[0]&4&&(f.isSelected=u[2].includes(u[47])),h[0]&2&&(f.toggle=u[37]),h[0]&2&&(f.selectable=u[1]==="filtered"),i.$set(f),(!c||h[0]&8)&&o!==(o=(u[3].categories[u[47]]||0)+"")&&je(l,o)},i(u){c||(H(i.$$.fragment,u),c=!0)},o(u){K(i.$$.fragment,u),c=!1},d(u){u&&$(e),_e(i)}}}function Eo(t){let e,n=t[44]==="threshold"?B==="en"?"Score threshold":"Seuil de score":B==="en"?"Top K pairs":"Top K paires",i,r,s,o;function l(){return t[38](t[44])}return{c(){e=b("button"),i=re(n),r=j(),v(e,"class","button is-small is-flex-grow-1"),Ye(e,"is-link",t[7]===t[44]),Ye(e,"is-contrasted",t[7]!==t[44])},m(a,c){z(a,e,c),y(e,i),y(e,r),s||(o=Ce(e,"click",l),s=!0)},p(a,c){t=a,c[0]&128&&Ye(e,"is-link",t[7]===t[44]),c[0]&128&&Ye(e,"is-contrasted",t[7]!==t[44])},d(a){a&&$(e),s=!1,o()}}}function Kf(t){let e,n,i,r,s,o,l,a,c,u,h,f;return i=new En({props:{minVal:1,maxVal:5,start:t[10]||3,step:1,roundTo:0,title:"K"}}),i.$on("updateSlider",t[40]),{c(){e=b("div"),n=b("div"),ve(i.$$.fragment),r=j(),s=b("div"),o=b("label"),l=b("input"),a=j(),c=b("span"),c.textContent=`${B==="en"?"Mutual top K":"Top K mutuel"}`,v(n,"class","column is-two-thirds pl-4"),l.checked=t[11],v(l,"type","checkbox"),v(l,"class","mr-2"),v(c,"class","is-size-7"),v(o,"class","checkbox mt-3 is-flex is-align-items-center"),v(s,"class","column mt-2"),v(e,"class","columns mt-2")},m(d,m){z(d,e,m),y(e,n),ge(i,n,null),y(e,r),y(e,s),y(s,o),y(o,l),y(o,a),y(o,c),u=!0,h||(f=Ce(l,"change",t[41]),h=!0)},p(d,m){const p={};m[0]&1024&&(p.start=d[10]||3),i.$set(p),(!u||m[0]&2048)&&(l.checked=d[11])},i(d){u||(H(i.$$.fragment,d),u=!0)},o(d){K(i.$$.fragment,d),u=!1},d(d){d&&$(e),_e(i),h=!1,f()}}}function Wf(t){var i,r;let e,n;return e=new En({props:{minVal:((i=t[8].scoreRange)==null?void 0:i.min)||0,maxVal:((r=t[8].scoreRange)==null?void 0:r.max)||1,start:t[9],step:.01,roundTo:2,title:B==="en"?"Minimum score":"Score minimum"}}),e.$on("updateSlider",t[39]),{c(){ve(e.$$.fragment)},m(s,o){ge(e,s,o),n=!0},p(s,o){var a,c;const l={};o[0]&256&&(l.minVal=((a=s[8].scoreRange)==null?void 0:a.min)||0),o[0]&256&&(l.maxVal=((c=s[8].scoreRange)==null?void 0:c.max)||1),o[0]&512&&(l.start=s[9]),e.$set(l)},i(s){n||(H(e.$$.fragment,s),n=!0)},o(s){K(e.$$.fragment,s),n=!1},d(s){_e(e,s)}}}function Yf(t){let e,n,i=t[3]&&bo(t);return{c(){e=b("div"),i&&i.c(),v(e,"class","m-4 py-5 px-4")},m(r,s){z(r,e,s),i&&i.m(e,null),n=!0},p(r,s){r[3]?i?(i.p(r,s),s[0]&8&&H(i,1)):(i=bo(r),i.c(),H(i,1),i.m(e,null)):i&&(tt(),K(i,1,1,()=>{i=null}),nt())},i(r){n||(H(i),n=!0)},o(r){K(i),n=!1},d(r){r&&$(e),i&&i.d()}}}function Gf(t,e,n){let i,r,s,o,l,a,c,u,h,f,{$$slots:d={},$$scope:m}=e,{docSet:p=null}=e,{documentSetStore:g}=e,{clusterStore:_}=e;const{docSetNumber:S,documentNodes:C,selectedCategories:w,toggleCategory:k,selectedRegions:T,selectAllRegions:N,toggleRegion:E,threshold:x,setThreshold:L,topK:O,setTopK:F,mutualTopK:R,setMutualTopK:I,scoreMode:U,setScoreMode:P,pairStats:G}=g;xe(t,S,Q=>n(3,r=Q)),xe(t,C,Q=>n(5,o=Q)),xe(t,w,Q=>n(2,i=Q)),xe(t,T,Q=>n(6,l=Q)),xe(t,x,Q=>n(9,u=Q)),xe(t,O,Q=>n(10,h=Q)),xe(t,R,Q=>n(11,f=Q)),xe(t,U,Q=>n(7,a=Q)),xe(t,G,Q=>n(8,c=Q));const{clusterNb:V,handlePageUpdate:q}=_;xe(t,V,Q=>n(4,s=Q));const J=zt("selectedDocuments"),ue=[0,1,2,3,5];let ce="filtered";function we(Q){n(1,ce=Q),Q==="all"&&i.length!==ue.length&&w.set(ue)}function fe(Q){q(1),P(Q)}const Fe=Q=>we(Q),Ge=Q=>ce==="filtered"?k(Q):null,he=Q=>fe(Q),W=Q=>L(Q.detail),ee=Q=>F(Q.detail),se=()=>I(!f);return t.$$set=Q=>{"docSet"in Q&&n(0,p=Q.docSet),"documentSetStore"in Q&&n(32,g=Q.documentSetStore),"clusterStore"in Q&&n(33,_=Q.clusterStore),"$$scope"in Q&&n(34,m=Q.$$scope)},[p,ce,i,r,s,o,l,a,c,u,h,f,S,C,w,k,T,N,E,x,L,O,F,R,I,U,G,V,J,ue,we,fe,g,_,m,d,Fe,Ge,he,W,ee,se]}class Xf extends Ve{constructor(e){super(),He(this,e,Gf,Yf,ze,{docSet:0,documentSetStore:32,clusterStore:33},null,[-1,-1])}}function Fi(t,e){return t==null||e==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function Jf(t,e){return t==null||e==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function Co(t){let e,n,i;t.length!==2?(e=Fi,n=(l,a)=>Fi(t(l),a),i=(l,a)=>t(l)-a):(e=t===Fi||t===Jf?t:Qf,n=t,i=t);function r(l,a,c=0,u=l.length){if(c<u){if(e(a,a)!==0)return u;do{const h=c+u>>>1;n(l[h],a)<0?c=h+1:u=h}while(c<u)}return c}function s(l,a,c=0,u=l.length){if(c<u){if(e(a,a)!==0)return u;do{const h=c+u>>>1;n(l[h],a)<=0?c=h+1:u=h}while(c<u)}return c}function o(l,a,c=0,u=l.length){const h=r(l,a,c,u-1);return h>c&&i(l[h-1],a)>-i(l[h],a)?h-1:h}return{left:r,center:o,right:s}}function Qf(){return 0}function Zf(t){return t===null?NaN:+t}const ed=Co(Fi).right;Co(Zf).center;const td=ed;class Io extends Map{constructor(e,n=rd){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:n}}),e!=null)for(const[i,r]of e)this.set(i,r)}get(e){return super.get(xo(this,e))}has(e){return super.has(xo(this,e))}set(e,n){return super.set(nd(this,e),n)}delete(e){return super.delete(id(this,e))}}function xo({_intern:t,_key:e},n){const i=e(n);return t.has(i)?t.get(i):n}function nd({_intern:t,_key:e},n){const i=e(n);return t.has(i)?t.get(i):(t.set(i,n),n)}function id({_intern:t,_key:e},n){const i=e(n);return t.has(i)&&(n=t.get(i),t.delete(i)),n}function rd(t){return t!==null&&typeof t=="object"?t.valueOf():t}const sd=Math.sqrt(50),od=Math.sqrt(10),ld=Math.sqrt(2);function Hi(t,e,n){const i=(e-t)/Math.max(0,n),r=Math.floor(Math.log10(i)),s=i/Math.pow(10,r),o=s>=sd?10:s>=od?5:s>=ld?2:1;let l,a,c;return r<0?(c=Math.pow(10,-r)/o,l=Math.round(t*c),a=Math.round(e*c),l/c<t&&++l,a/c>e&&--a,c=-c):(c=Math.pow(10,r)*o,l=Math.round(t/c),a=Math.round(e/c),l*c<t&&++l,a*c>e&&--a),a<l&&.5<=n&&n<2?Hi(t,e,n*2):[l,a,c]}function ad(t,e,n){if(e=+e,t=+t,n=+n,!(n>0))return[];if(t===e)return[t];const i=e<t,[r,s,o]=i?Hi(e,t,n):Hi(t,e,n);if(!(s>=r))return[];const l=s-r+1,a=new Array(l);if(i)if(o<0)for(let c=0;c<l;++c)a[c]=(s-c)/-o;else for(let c=0;c<l;++c)a[c]=(s-c)*o;else if(o<0)for(let c=0;c<l;++c)a[c]=(r+c)/-o;else for(let c=0;c<l;++c)a[c]=(r+c)*o;return a}function Dr(t,e,n){return e=+e,t=+t,n=+n,Hi(t,e,n)[2]}function cd(t,e,n){e=+e,t=+t,n=+n;const i=e<t,r=i?Dr(e,t,n):Dr(t,e,n);return(i?-1:1)*(r<0?1/-r:r)}function Vi(t,e,n){t=+t,e=+e,n=(r=arguments.length)<2?(e=t,t=0,1):r<3?1:+n;for(var i=-1,r=Math.max(0,Math.ceil((e-t)/n))|0,s=new Array(r);++i<r;)s[i]=t+i*n;return s}function ud(t){return t}var Ui=1,$r=2,Mo=3,si=4,Ao=1e-6;function fd(t){return"translate("+t+",0)"}function dd(t){return"translate(0,"+t+")"}function hd(t){return e=>+t(e)}function md(t,e){return e=Math.max(0,t.bandwidth()-e*2)/2,t.round()&&(e=Math.round(e)),n=>+t(n)+e}function pd(){return!this.__axis}function To(t,e){var n=[],i=null,r=null,s=6,o=6,l=3,a=typeof window<"u"&&window.devicePixelRatio>1?0:.5,c=t===Ui||t===si?-1:1,u=t===si||t===$r?"x":"y",h=t===Ui||t===Mo?fd:dd;function f(d){var m=i??(e.ticks?e.ticks.apply(e,n):e.domain()),p=r??(e.tickFormat?e.tickFormat.apply(e,n):ud),g=Math.max(s,0)+l,_=e.range(),S=+_[0]+a,C=+_[_.length-1]+a,w=(e.bandwidth?md:hd)(e.copy(),a),k=d.selection?d.selection():d,T=k.selectAll(".domain").data([null]),N=k.selectAll(".tick").data(m,e).order(),E=N.exit(),x=N.enter().append("g").attr("class","tick"),L=N.select("line"),O=N.select("text");T=T.merge(T.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),N=N.merge(x),L=L.merge(x.append("line").attr("stroke","currentColor").attr(u+"2",c*s)),O=O.merge(x.append("text").attr("fill","currentColor").attr(u,c*g).attr("dy",t===Ui?"0em":t===Mo?"0.71em":"0.32em")),d!==k&&(T=T.transition(d),N=N.transition(d),L=L.transition(d),O=O.transition(d),E=E.transition(d).attr("opacity",Ao).attr("transform",function(F){return isFinite(F=w(F))?h(F+a):this.getAttribute("transform")}),x.attr("opacity",Ao).attr("transform",function(F){var R=this.parentNode.__axis;return h((R&&isFinite(R=R(F))?R:w(F))+a)})),E.remove(),T.attr("d",t===si||t===$r?o?"M"+c*o+","+S+"H"+a+"V"+C+"H"+c*o:"M"+a+","+S+"V"+C:o?"M"+S+","+c*o+"V"+a+"H"+C+"V"+c*o:"M"+S+","+a+"H"+C),N.attr("opacity",1).attr("transform",function(F){return h(w(F)+a)}),L.attr(u+"2",c*s),O.attr(u,c*g).text(p),k.filter(pd).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",t===$r?"start":t===si?"end":"middle"),k.each(function(){this.__axis=w})}return f.scale=function(d){return arguments.length?(e=d,f):e},f.ticks=function(){return n=Array.from(arguments),f},f.tickArguments=function(d){return arguments.length?(n=d==null?[]:Array.from(d),f):n.slice()},f.tickValues=function(d){return arguments.length?(i=d==null?null:Array.from(d),f):i&&i.slice()},f.tickFormat=function(d){return arguments.length?(r=d,f):r},f.tickSize=function(d){return arguments.length?(s=o=+d,f):s},f.tickSizeInner=function(d){return arguments.length?(s=+d,f):s},f.tickSizeOuter=function(d){return arguments.length?(o=+d,f):o},f.tickPadding=function(d){return arguments.length?(l=+d,f):l},f.offset=function(d){return arguments.length?(a=+d,f):a},f}function No(t){return To(Ui,t)}function Po(t){return To(si,t)}var gd={value:()=>{}};function oi(){for(var t=0,e=arguments.length,n={},i;t<e;++t){if(!(i=arguments[t]+"")||i in n||/[\s.]/.test(i))throw new Error("illegal type: "+i);n[i]=[]}return new Bi(n)}function Bi(t){this._=t}function _d(t,e){return t.trim().split(/^|\s+/).map(function(n){var i="",r=n.indexOf(".");if(r>=0&&(i=n.slice(r+1),n=n.slice(0,r)),n&&!e.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:i}})}Bi.prototype=oi.prototype={constructor:Bi,on:function(t,e){var n=this._,i=_d(t+"",n),r,s=-1,o=i.length;if(arguments.length<2){for(;++s<o;)if((r=(t=i[s]).type)&&(r=vd(n[r],t.name)))return r;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++s<o;)if(r=(t=i[s]).type)n[r]=Oo(n[r],t.name,e);else if(e==null)for(r in n)n[r]=Oo(n[r],t.name,null);return this},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new Bi(t)},call:function(t,e){if((r=arguments.length-2)>0)for(var n=new Array(r),i=0,r,s;i<r;++i)n[i]=arguments[i+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(s=this._[t],i=0,r=s.length;i<r;++i)s[i].value.apply(e,n)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var i=this._[t],r=0,s=i.length;r<s;++r)i[r].value.apply(e,n)}};function vd(t,e){for(var n=0,i=t.length,r;n<i;++n)if((r=t[n]).name===e)return r.value}function Oo(t,e,n){for(var i=0,r=t.length;i<r;++i)if(t[i].name===e){t[i]=gd,t=t.slice(0,i).concat(t.slice(i+1));break}return n!=null&&t.push({name:e,value:n}),t}var zr="http://www.w3.org/1999/xhtml";const Lo={svg:"http://www.w3.org/2000/svg",xhtml:zr,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function qi(t){var e=t+="",n=e.indexOf(":");return n>=0&&(e=t.slice(0,n))!=="xmlns"&&(t=t.slice(n+1)),Lo.hasOwnProperty(e)?{space:Lo[e],local:t}:t}function yd(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===zr&&e.documentElement.namespaceURI===zr?e.createElement(t):e.createElementNS(n,t)}}function bd(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function Ro(t){var e=qi(t);return(e.local?bd:yd)(e)}function wd(){}function jr(t){return t==null?wd:function(){return this.querySelector(t)}}function Sd(t){typeof t!="function"&&(t=jr(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var s=e[r],o=s.length,l=i[r]=new Array(o),a,c,u=0;u<o;++u)(a=s[u])&&(c=t.call(a,a.__data__,u,s))&&("__data__"in a&&(c.__data__=a.__data__),l[u]=c);return new Ft(i,this._parents)}function kd(t){return t==null?[]:Array.isArray(t)?t:Array.from(t)}function Ed(){return[]}function Do(t){return t==null?Ed:function(){return this.querySelectorAll(t)}}function Cd(t){return function(){return kd(t.apply(this,arguments))}}function Id(t){typeof t=="function"?t=Cd(t):t=Do(t);for(var e=this._groups,n=e.length,i=[],r=[],s=0;s<n;++s)for(var o=e[s],l=o.length,a,c=0;c<l;++c)(a=o[c])&&(i.push(t.call(a,a.__data__,c,o)),r.push(a));return new Ft(i,r)}function $o(t){return function(){return this.matches(t)}}function zo(t){return function(e){return e.matches(t)}}var xd=Array.prototype.find;function Md(t){return function(){return xd.call(this.children,t)}}function Ad(){return this.firstElementChild}function Td(t){return this.select(t==null?Ad:Md(typeof t=="function"?t:zo(t)))}var Nd=Array.prototype.filter;function Pd(){return Array.from(this.children)}function Od(t){return function(){return Nd.call(this.children,t)}}function Ld(t){return this.selectAll(t==null?Pd:Od(typeof t=="function"?t:zo(t)))}function Rd(t){typeof t!="function"&&(t=$o(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var s=e[r],o=s.length,l=i[r]=[],a,c=0;c<o;++c)(a=s[c])&&t.call(a,a.__data__,c,s)&&l.push(a);return new Ft(i,this._parents)}function jo(t){return new Array(t.length)}function Dd(){return new Ft(this._enter||this._groups.map(jo),this._parents)}function Ki(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}Ki.prototype={constructor:Ki,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function $d(t){return function(){return t}}function zd(t,e,n,i,r,s){for(var o=0,l,a=e.length,c=s.length;o<c;++o)(l=e[o])?(l.__data__=s[o],i[o]=l):n[o]=new Ki(t,s[o]);for(;o<a;++o)(l=e[o])&&(r[o]=l)}function jd(t,e,n,i,r,s,o){var l,a,c=new Map,u=e.length,h=s.length,f=new Array(u),d;for(l=0;l<u;++l)(a=e[l])&&(f[l]=d=o.call(a,a.__data__,l,e)+"",c.has(d)?r[l]=a:c.set(d,a));for(l=0;l<h;++l)d=o.call(t,s[l],l,s)+"",(a=c.get(d))?(i[l]=a,a.__data__=s[l],c.delete(d)):n[l]=new Ki(t,s[l]);for(l=0;l<u;++l)(a=e[l])&&c.get(f[l])===a&&(r[l]=a)}function Fd(t){return t.__data__}function Hd(t,e){if(!arguments.length)return Array.from(this,Fd);var n=e?jd:zd,i=this._parents,r=this._groups;typeof t!="function"&&(t=$d(t));for(var s=r.length,o=new Array(s),l=new Array(s),a=new Array(s),c=0;c<s;++c){var u=i[c],h=r[c],f=h.length,d=Vd(t.call(u,u&&u.__data__,c,i)),m=d.length,p=l[c]=new Array(m),g=o[c]=new Array(m),_=a[c]=new Array(f);n(u,h,p,g,_,d,e);for(var S=0,C=0,w,k;S<m;++S)if(w=p[S]){for(S>=C&&(C=S+1);!(k=g[C])&&++C<m;);w._next=k||null}}return o=new Ft(o,i),o._enter=l,o._exit=a,o}function Vd(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function Ud(){return new Ft(this._exit||this._groups.map(jo),this._parents)}function Bd(t,e,n){var i=this.enter(),r=this,s=this.exit();return typeof t=="function"?(i=t(i),i&&(i=i.selection())):i=i.append(t+""),e!=null&&(r=e(r),r&&(r=r.selection())),n==null?s.remove():n(s),i&&r?i.merge(r).order():r}function qd(t){for(var e=t.selection?t.selection():t,n=this._groups,i=e._groups,r=n.length,s=i.length,o=Math.min(r,s),l=new Array(r),a=0;a<o;++a)for(var c=n[a],u=i[a],h=c.length,f=l[a]=new Array(h),d,m=0;m<h;++m)(d=c[m]||u[m])&&(f[m]=d);for(;a<r;++a)l[a]=n[a];return new Ft(l,this._parents)}function Kd(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var i=t[e],r=i.length-1,s=i[r],o;--r>=0;)(o=i[r])&&(s&&o.compareDocumentPosition(s)^4&&s.parentNode.insertBefore(o,s),s=o);return this}function Wd(t){t||(t=Yd);function e(h,f){return h&&f?t(h.__data__,f.__data__):!h-!f}for(var n=this._groups,i=n.length,r=new Array(i),s=0;s<i;++s){for(var o=n[s],l=o.length,a=r[s]=new Array(l),c,u=0;u<l;++u)(c=o[u])&&(a[u]=c);a.sort(e)}return new Ft(r,this._parents).order()}function Yd(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function Gd(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function Xd(){return Array.from(this)}function Jd(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var i=t[e],r=0,s=i.length;r<s;++r){var o=i[r];if(o)return o}return null}function Qd(){let t=0;for(const e of this)++t;return t}function Zd(){return!this.node()}function eh(t){for(var e=this._groups,n=0,i=e.length;n<i;++n)for(var r=e[n],s=0,o=r.length,l;s<o;++s)(l=r[s])&&t.call(l,l.__data__,s,r);return this}function th(t){return function(){this.removeAttribute(t)}}function nh(t){return function(){this.removeAttributeNS(t.space,t.local)}}function ih(t,e){return function(){this.setAttribute(t,e)}}function rh(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function sh(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttribute(t):this.setAttribute(t,n)}}function oh(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function lh(t,e){var n=qi(t);if(arguments.length<2){var i=this.node();return n.local?i.getAttributeNS(n.space,n.local):i.getAttribute(n)}return this.each((e==null?n.local?nh:th:typeof e=="function"?n.local?oh:sh:n.local?rh:ih)(n,e))}function Fo(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function ah(t){return function(){this.style.removeProperty(t)}}function ch(t,e,n){return function(){this.style.setProperty(t,e,n)}}function uh(t,e,n){return function(){var i=e.apply(this,arguments);i==null?this.style.removeProperty(t):this.style.setProperty(t,i,n)}}function fh(t,e,n){return arguments.length>1?this.each((e==null?ah:typeof e=="function"?uh:ch)(t,e,n??"")):qn(this.node(),t)}function qn(t,e){return t.style.getPropertyValue(e)||Fo(t).getComputedStyle(t,null).getPropertyValue(e)}function dh(t){return function(){delete this[t]}}function hh(t,e){return function(){this[t]=e}}function mh(t,e){return function(){var n=e.apply(this,arguments);n==null?delete this[t]:this[t]=n}}function ph(t,e){return arguments.length>1?this.each((e==null?dh:typeof e=="function"?mh:hh)(t,e)):this.node()[t]}function Ho(t){return t.trim().split(/^|\s+/)}function Fr(t){return t.classList||new Vo(t)}function Vo(t){this._node=t,this._names=Ho(t.getAttribute("class")||"")}Vo.prototype={add:function(t){var e=this._names.indexOf(t);e<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function Uo(t,e){for(var n=Fr(t),i=-1,r=e.length;++i<r;)n.add(e[i])}function Bo(t,e){for(var n=Fr(t),i=-1,r=e.length;++i<r;)n.remove(e[i])}function gh(t){return function(){Uo(this,t)}}function _h(t){return function(){Bo(this,t)}}function vh(t,e){return function(){(e.apply(this,arguments)?Uo:Bo)(this,t)}}function yh(t,e){var n=Ho(t+"");if(arguments.length<2){for(var i=Fr(this.node()),r=-1,s=n.length;++r<s;)if(!i.contains(n[r]))return!1;return!0}return this.each((typeof e=="function"?vh:e?gh:_h)(n,e))}function bh(){this.textContent=""}function wh(t){return function(){this.textContent=t}}function Sh(t){return function(){var e=t.apply(this,arguments);this.textContent=e??""}}function kh(t){return arguments.length?this.each(t==null?bh:(typeof t=="function"?Sh:wh)(t)):this.node().textContent}function Eh(){this.innerHTML=""}function Ch(t){return function(){this.innerHTML=t}}function Ih(t){return function(){var e=t.apply(this,arguments);this.innerHTML=e??""}}function xh(t){return arguments.length?this.each(t==null?Eh:(typeof t=="function"?Ih:Ch)(t)):this.node().innerHTML}function Mh(){this.nextSibling&&this.parentNode.appendChild(this)}function Ah(){return this.each(Mh)}function Th(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Nh(){return this.each(Th)}function Ph(t){var e=typeof t=="function"?t:Ro(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function Oh(){return null}function Lh(t,e){var n=typeof t=="function"?t:Ro(t),i=e==null?Oh:typeof e=="function"?e:jr(e);return this.select(function(){return this.insertBefore(n.apply(this,arguments),i.apply(this,arguments)||null)})}function Rh(){var t=this.parentNode;t&&t.removeChild(this)}function Dh(){return this.each(Rh)}function $h(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function zh(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function jh(t){return this.select(t?zh:$h)}function Fh(t){return arguments.length?this.property("__data__",t):this.node().__data__}function Hh(t){return function(e){t.call(this,e,this.__data__)}}function Vh(t){return t.trim().split(/^|\s+/).map(function(e){var n="",i=e.indexOf(".");return i>=0&&(n=e.slice(i+1),e=e.slice(0,i)),{type:e,name:n}})}function Uh(t){return function(){var e=this.__on;if(e){for(var n=0,i=-1,r=e.length,s;n<r;++n)s=e[n],(!t.type||s.type===t.type)&&s.name===t.name?this.removeEventListener(s.type,s.listener,s.options):e[++i]=s;++i?e.length=i:delete this.__on}}}function Bh(t,e,n){return function(){var i=this.__on,r,s=Hh(e);if(i){for(var o=0,l=i.length;o<l;++o)if((r=i[o]).type===t.type&&r.name===t.name){this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=s,r.options=n),r.value=e;return}}this.addEventListener(t.type,s,n),r={type:t.type,name:t.name,value:e,listener:s,options:n},i?i.push(r):this.__on=[r]}}function qh(t,e,n){var i=Vh(t+""),r,s=i.length,o;if(arguments.length<2){var l=this.node().__on;if(l){for(var a=0,c=l.length,u;a<c;++a)for(r=0,u=l[a];r<s;++r)if((o=i[r]).type===u.type&&o.name===u.name)return u.value}return}for(l=e?Bh:Uh,r=0;r<s;++r)this.each(l(i[r],e,n));return this}function qo(t,e,n){var i=Fo(t),r=i.CustomEvent;typeof r=="function"?r=new r(e,n):(r=i.document.createEvent("Event"),n?(r.initEvent(e,n.bubbles,n.cancelable),r.detail=n.detail):r.initEvent(e,!1,!1)),t.dispatchEvent(r)}function Kh(t,e){return function(){return qo(this,t,e)}}function Wh(t,e){return function(){return qo(this,t,e.apply(this,arguments))}}function Yh(t,e){return this.each((typeof e=="function"?Wh:Kh)(t,e))}function*Gh(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var i=t[e],r=0,s=i.length,o;r<s;++r)(o=i[r])&&(yield o)}var Ko=[null];function Ft(t,e){this._groups=t,this._parents=e}function li(){return new Ft([[document.documentElement]],Ko)}function Xh(){return this}Ft.prototype=li.prototype={constructor:Ft,select:Sd,selectAll:Id,selectChild:Td,selectChildren:Ld,filter:Rd,data:Hd,enter:Dd,exit:Ud,join:Bd,merge:qd,selection:Xh,order:Kd,sort:Wd,call:Gd,nodes:Xd,node:Jd,size:Qd,empty:Zd,each:eh,attr:lh,style:fh,property:ph,classed:yh,text:kh,html:xh,raise:Ah,lower:Nh,append:Ph,insert:Lh,remove:Dh,clone:jh,datum:Fh,on:qh,dispatch:Yh,[Symbol.iterator]:Gh};function mt(t){return typeof t=="string"?new Ft([[document.querySelector(t)]],[document.documentElement]):new Ft([[t]],Ko)}function Jh(t){let e;for(;e=t.sourceEvent;)t=e;return t}function bt(t,e){if(t=Jh(t),e===void 0&&(e=t.currentTarget),e){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var i=n.createSVGPoint();return i.x=t.clientX,i.y=t.clientY,i=i.matrixTransform(e.getScreenCTM().inverse()),[i.x,i.y]}if(e.getBoundingClientRect){var r=e.getBoundingClientRect();return[t.clientX-r.left-e.clientLeft,t.clientY-r.top-e.clientTop]}}return[t.pageX,t.pageY]}const Qh={passive:!1},ai={capture:!0,passive:!1};function Hr(t){t.stopImmediatePropagation()}function Kn(t){t.preventDefault(),t.stopImmediatePropagation()}function Wo(t){var e=t.document.documentElement,n=mt(t).on("dragstart.drag",Kn,ai);"onselectstart"in e?n.on("selectstart.drag",Kn,ai):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function Yo(t,e){var n=t.document.documentElement,i=mt(t).on("dragstart.drag",null);e&&(i.on("click.drag",Kn,ai),setTimeout(function(){i.on("click.drag",null)},0)),"onselectstart"in n?i.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}const Wi=t=>()=>t;function Vr(t,{sourceEvent:e,subject:n,target:i,identifier:r,active:s,x:o,y:l,dx:a,dy:c,dispatch:u}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},subject:{value:n,enumerable:!0,configurable:!0},target:{value:i,enumerable:!0,configurable:!0},identifier:{value:r,enumerable:!0,configurable:!0},active:{value:s,enumerable:!0,configurable:!0},x:{value:o,enumerable:!0,configurable:!0},y:{value:l,enumerable:!0,configurable:!0},dx:{value:a,enumerable:!0,configurable:!0},dy:{value:c,enumerable:!0,configurable:!0},_:{value:u}})}Vr.prototype.on=function(){var t=this._.on.apply(this._,arguments);return t===this._?this:t};function Zh(t){return!t.ctrlKey&&!t.button}function em(){return this.parentNode}function tm(t,e){return e??{x:t.x,y:t.y}}function nm(){return navigator.maxTouchPoints||"ontouchstart"in this}function im(){var t=Zh,e=em,n=tm,i=nm,r={},s=oi("start","drag","end"),o=0,l,a,c,u,h=0;function f(w){w.on("mousedown.drag",d).filter(i).on("touchstart.drag",g).on("touchmove.drag",_,Qh).on("touchend.drag touchcancel.drag",S).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function d(w,k){if(!(u||!t.call(this,w,k))){var T=C(this,e.call(this,w,k),w,k,"mouse");T&&(mt(w.view).on("mousemove.drag",m,ai).on("mouseup.drag",p,ai),Wo(w.view),Hr(w),c=!1,l=w.clientX,a=w.clientY,T("start",w))}}function m(w){if(Kn(w),!c){var k=w.clientX-l,T=w.clientY-a;c=k*k+T*T>h}r.mouse("drag",w)}function p(w){mt(w.view).on("mousemove.drag mouseup.drag",null),Yo(w.view,c),Kn(w),r.mouse("end",w)}function g(w,k){if(t.call(this,w,k)){var T=w.changedTouches,N=e.call(this,w,k),E=T.length,x,L;for(x=0;x<E;++x)(L=C(this,N,w,k,T[x].identifier,T[x]))&&(Hr(w),L("start",w,T[x]))}}function _(w){var k=w.changedTouches,T=k.length,N,E;for(N=0;N<T;++N)(E=r[k[N].identifier])&&(Kn(w),E("drag",w,k[N]))}function S(w){var k=w.changedTouches,T=k.length,N,E;for(u&&clearTimeout(u),u=setTimeout(function(){u=null},500),N=0;N<T;++N)(E=r[k[N].identifier])&&(Hr(w),E("end",w,k[N]))}function C(w,k,T,N,E,x){var L=s.copy(),O=bt(x||T,k),F,R,I;if((I=n.call(w,new Vr("beforestart",{sourceEvent:T,target:f,identifier:E,active:o,x:O[0],y:O[1],dx:0,dy:0,dispatch:L}),N))!=null)return F=I.x-O[0]||0,R=I.y-O[1]||0,function U(P,G,V){var q=O,J;switch(P){case"start":r[E]=U,J=o++;break;case"end":delete r[E],--o;case"drag":O=bt(V||G,k),J=o;break}L.call(P,w,new Vr(P,{sourceEvent:G,subject:I,target:f,identifier:E,active:J,x:O[0]+F,y:O[1]+R,dx:O[0]-q[0],dy:O[1]-q[1],dispatch:L}),N)}}return f.filter=function(w){return arguments.length?(t=typeof w=="function"?w:Wi(!!w),f):t},f.container=function(w){return arguments.length?(e=typeof w=="function"?w:Wi(w),f):e},f.subject=function(w){return arguments.length?(n=typeof w=="function"?w:Wi(w),f):n},f.touchable=function(w){return arguments.length?(i=typeof w=="function"?w:Wi(!!w),f):i},f.on=function(){var w=s.on.apply(s,arguments);return w===s?f:w},f.clickDistance=function(w){return arguments.length?(h=(w=+w)*w,f):Math.sqrt(h)},f}function Ur(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function Go(t,e){var n=Object.create(t.prototype);for(var i in e)n[i]=e[i];return n}function ci(){}var ui=.7,Yi=1/ui,Wn="\\s*([+-]?\\d+)\\s*",fi="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Zt="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",rm=/^#([0-9a-f]{3,8})$/,sm=new RegExp(`^rgb\\(${Wn},${Wn},${Wn}\\)$`),om=new RegExp(`^rgb\\(${Zt},${Zt},${Zt}\\)$`),lm=new RegExp(`^rgba\\(${Wn},${Wn},${Wn},${fi}\\)$`),am=new RegExp(`^rgba\\(${Zt},${Zt},${Zt},${fi}\\)$`),cm=new RegExp(`^hsl\\(${fi},${Zt},${Zt}\\)$`),um=new RegExp(`^hsla\\(${fi},${Zt},${Zt},${fi}\\)$`),Xo={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Ur(ci,Cn,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:Jo,formatHex:Jo,formatHex8:fm,formatHsl:dm,formatRgb:Qo,toString:Qo});function Jo(){return this.rgb().formatHex()}function fm(){return this.rgb().formatHex8()}function dm(){return il(this).formatHsl()}function Qo(){return this.rgb().formatRgb()}function Cn(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=rm.exec(t))?(n=e[1].length,e=parseInt(e[1],16),n===6?Zo(e):n===3?new Rt(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):n===8?Gi(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):n===4?Gi(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=sm.exec(t))?new Rt(e[1],e[2],e[3],1):(e=om.exec(t))?new Rt(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=lm.exec(t))?Gi(e[1],e[2],e[3],e[4]):(e=am.exec(t))?Gi(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=cm.exec(t))?nl(e[1],e[2]/100,e[3]/100,1):(e=um.exec(t))?nl(e[1],e[2]/100,e[3]/100,e[4]):Xo.hasOwnProperty(t)?Zo(Xo[t]):t==="transparent"?new Rt(NaN,NaN,NaN,0):null}function Zo(t){return new Rt(t>>16&255,t>>8&255,t&255,1)}function Gi(t,e,n,i){return i<=0&&(t=e=n=NaN),new Rt(t,e,n,i)}function hm(t){return t instanceof ci||(t=Cn(t)),t?(t=t.rgb(),new Rt(t.r,t.g,t.b,t.opacity)):new Rt}function Br(t,e,n,i){return arguments.length===1?hm(t):new Rt(t,e,n,i??1)}function Rt(t,e,n,i){this.r=+t,this.g=+e,this.b=+n,this.opacity=+i}Ur(Rt,Br,Go(ci,{brighter(t){return t=t==null?Yi:Math.pow(Yi,t),new Rt(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?ui:Math.pow(ui,t),new Rt(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new Rt(In(this.r),In(this.g),In(this.b),Xi(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:el,formatHex:el,formatHex8:mm,formatRgb:tl,toString:tl}));function el(){return`#${xn(this.r)}${xn(this.g)}${xn(this.b)}`}function mm(){return`#${xn(this.r)}${xn(this.g)}${xn(this.b)}${xn((isNaN(this.opacity)?1:this.opacity)*255)}`}function tl(){const t=Xi(this.opacity);return`${t===1?"rgb(":"rgba("}${In(this.r)}, ${In(this.g)}, ${In(this.b)}${t===1?")":`, ${t})`}`}function Xi(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function In(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function xn(t){return t=In(t),(t<16?"0":"")+t.toString(16)}function nl(t,e,n,i){return i<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new Xt(t,e,n,i)}function il(t){if(t instanceof Xt)return new Xt(t.h,t.s,t.l,t.opacity);if(t instanceof ci||(t=Cn(t)),!t)return new Xt;if(t instanceof Xt)return t;t=t.rgb();var e=t.r/255,n=t.g/255,i=t.b/255,r=Math.min(e,n,i),s=Math.max(e,n,i),o=NaN,l=s-r,a=(s+r)/2;return l?(e===s?o=(n-i)/l+(n<i)*6:n===s?o=(i-e)/l+2:o=(e-n)/l+4,l/=a<.5?s+r:2-s-r,o*=60):l=a>0&&a<1?0:o,new Xt(o,l,a,t.opacity)}function Ji(t,e,n,i){return arguments.length===1?il(t):new Xt(t,e,n,i??1)}function Xt(t,e,n,i){this.h=+t,this.s=+e,this.l=+n,this.opacity=+i}Ur(Xt,Ji,Go(ci,{brighter(t){return t=t==null?Yi:Math.pow(Yi,t),new Xt(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?ui:Math.pow(ui,t),new Xt(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,i=n+(n<.5?n:1-n)*e,r=2*n-i;return new Rt(qr(t>=240?t-240:t+120,r,i),qr(t,r,i),qr(t<120?t+240:t-120,r,i),this.opacity)},clamp(){return new Xt(rl(this.h),Qi(this.s),Qi(this.l),Xi(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=Xi(this.opacity);return`${t===1?"hsl(":"hsla("}${rl(this.h)}, ${Qi(this.s)*100}%, ${Qi(this.l)*100}%${t===1?")":`, ${t})`}`}}));function rl(t){return t=(t||0)%360,t<0?t+360:t}function Qi(t){return Math.max(0,Math.min(1,t||0))}function qr(t,e,n){return(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)*255}const Kr=t=>()=>t;function pm(t,e){return function(n){return t+n*e}}function gm(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(i){return Math.pow(t+i*e,n)}}function _m(t){return(t=+t)==1?sl:function(e,n){return n-e?gm(e,n,t):Kr(isNaN(e)?n:e)}}function sl(t,e){var n=e-t;return n?pm(t,n):Kr(isNaN(t)?e:t)}const Zi=function t(e){var n=_m(e);function i(r,s){var o=n((r=Br(r)).r,(s=Br(s)).r),l=n(r.g,s.g),a=n(r.b,s.b),c=sl(r.opacity,s.opacity);return function(u){return r.r=o(u),r.g=l(u),r.b=a(u),r.opacity=c(u),r+""}}return i.gamma=t,i}(1);function vm(t,e){e||(e=[]);var n=t?Math.min(e.length,t.length):0,i=e.slice(),r;return function(s){for(r=0;r<n;++r)i[r]=t[r]*(1-s)+e[r]*s;return i}}function ym(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function bm(t,e){var n=e?e.length:0,i=t?Math.min(n,t.length):0,r=new Array(i),s=new Array(n),o;for(o=0;o<i;++o)r[o]=Gr(t[o],e[o]);for(;o<n;++o)s[o]=e[o];return function(l){for(o=0;o<i;++o)s[o]=r[o](l);return s}}function wm(t,e){var n=new Date;return t=+t,e=+e,function(i){return n.setTime(t*(1-i)+e*i),n}}function Jt(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}function Sm(t,e){var n={},i={},r;(t===null||typeof t!="object")&&(t={}),(e===null||typeof e!="object")&&(e={});for(r in e)r in t?n[r]=Gr(t[r],e[r]):i[r]=e[r];return function(s){for(r in n)i[r]=n[r](s);return i}}var Wr=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Yr=new RegExp(Wr.source,"g");function km(t){return function(){return t}}function Em(t){return function(e){return t(e)+""}}function ol(t,e){var n=Wr.lastIndex=Yr.lastIndex=0,i,r,s,o=-1,l=[],a=[];for(t=t+"",e=e+"";(i=Wr.exec(t))&&(r=Yr.exec(e));)(s=r.index)>n&&(s=e.slice(n,s),l[o]?l[o]+=s:l[++o]=s),(i=i[0])===(r=r[0])?l[o]?l[o]+=r:l[++o]=r:(l[++o]=null,a.push({i:o,x:Jt(i,r)})),n=Yr.lastIndex;return n<e.length&&(s=e.slice(n),l[o]?l[o]+=s:l[++o]=s),l.length<2?a[0]?Em(a[0].x):km(e):(e=a.length,function(c){for(var u=0,h;u<e;++u)l[(h=a[u]).i]=h.x(c);return l.join("")})}function Gr(t,e){var n=typeof e,i;return e==null||n==="boolean"?Kr(e):(n==="number"?Jt:n==="string"?(i=Cn(e))?(e=i,Zi):ol:e instanceof Cn?Zi:e instanceof Date?wm:ym(e)?vm:Array.isArray(e)?bm:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?Sm:Jt)(t,e)}function Cm(t,e){return t=+t,e=+e,function(n){return Math.round(t*(1-n)+e*n)}}var ll=180/Math.PI,Xr={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function al(t,e,n,i,r,s){var o,l,a;return(o=Math.sqrt(t*t+e*e))&&(t/=o,e/=o),(a=t*n+e*i)&&(n-=t*a,i-=e*a),(l=Math.sqrt(n*n+i*i))&&(n/=l,i/=l,a/=l),t*i<e*n&&(t=-t,e=-e,a=-a,o=-o),{translateX:r,translateY:s,rotate:Math.atan2(e,t)*ll,skewX:Math.atan(a)*ll,scaleX:o,scaleY:l}}var er;function Im(t){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?Xr:al(e.a,e.b,e.c,e.d,e.e,e.f)}function xm(t){return t==null||(er||(er=document.createElementNS("http://www.w3.org/2000/svg","g")),er.setAttribute("transform",t),!(t=er.transform.baseVal.consolidate()))?Xr:(t=t.matrix,al(t.a,t.b,t.c,t.d,t.e,t.f))}function cl(t,e,n,i){function r(c){return c.length?c.pop()+" ":""}function s(c,u,h,f,d,m){if(c!==h||u!==f){var p=d.push("translate(",null,e,null,n);m.push({i:p-4,x:Jt(c,h)},{i:p-2,x:Jt(u,f)})}else(h||f)&&d.push("translate("+h+e+f+n)}function o(c,u,h,f){c!==u?(c-u>180?u+=360:u-c>180&&(c+=360),f.push({i:h.push(r(h)+"rotate(",null,i)-2,x:Jt(c,u)})):u&&h.push(r(h)+"rotate("+u+i)}function l(c,u,h,f){c!==u?f.push({i:h.push(r(h)+"skewX(",null,i)-2,x:Jt(c,u)}):u&&h.push(r(h)+"skewX("+u+i)}function a(c,u,h,f,d,m){if(c!==h||u!==f){var p=d.push(r(d)+"scale(",null,",",null,")");m.push({i:p-4,x:Jt(c,h)},{i:p-2,x:Jt(u,f)})}else(h!==1||f!==1)&&d.push(r(d)+"scale("+h+","+f+")")}return function(c,u){var h=[],f=[];return c=t(c),u=t(u),s(c.translateX,c.translateY,u.translateX,u.translateY,h,f),o(c.rotate,u.rotate,h,f),l(c.skewX,u.skewX,h,f),a(c.scaleX,c.scaleY,u.scaleX,u.scaleY,h,f),c=u=null,function(d){for(var m=-1,p=f.length,g;++m<p;)h[(g=f[m]).i]=g.x(d);return h.join("")}}}var Mm=cl(Im,"px, ","px)","deg)"),Am=cl(xm,", ",")",")"),Tm=1e-12;function ul(t){return((t=Math.exp(t))+1/t)/2}function Nm(t){return((t=Math.exp(t))-1/t)/2}function Pm(t){return((t=Math.exp(2*t))-1)/(t+1)}const Om=function t(e,n,i){function r(s,o){var l=s[0],a=s[1],c=s[2],u=o[0],h=o[1],f=o[2],d=u-l,m=h-a,p=d*d+m*m,g,_;if(p<Tm)_=Math.log(f/c)/e,g=function(N){return[l+N*d,a+N*m,c*Math.exp(e*N*_)]};else{var S=Math.sqrt(p),C=(f*f-c*c+i*p)/(2*c*n*S),w=(f*f-c*c-i*p)/(2*f*n*S),k=Math.log(Math.sqrt(C*C+1)-C),T=Math.log(Math.sqrt(w*w+1)-w);_=(T-k)/e,g=function(N){var E=N*_,x=ul(k),L=c/(n*S)*(x*Pm(e*E+k)-Nm(k));return[l+L*d,a+L*m,c*x/ul(e*E+k)]}}return g.duration=_*1e3*e/Math.SQRT2,g}return r.rho=function(s){var o=Math.max(.001,+s),l=o*o,a=l*l;return t(o,l,a)},r}(Math.SQRT2,2,4);var Yn=0,di=0,hi=0,fl=1e3,tr,mi,nr=0,Mn=0,ir=0,pi=typeof performance=="object"&&performance.now?performance:Date,dl=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function Jr(){return Mn||(dl(Lm),Mn=pi.now()+ir)}function Lm(){Mn=0}function rr(){this._call=this._time=this._next=null}rr.prototype=Qr.prototype={constructor:rr,restart:function(t,e,n){if(typeof t!="function")throw new TypeError("callback is not a function");n=(n==null?Jr():+n)+(e==null?0:+e),!this._next&&mi!==this&&(mi?mi._next=this:tr=this,mi=this),this._call=t,this._time=n,Zr()},stop:function(){this._call&&(this._call=null,this._time=1/0,Zr())}};function Qr(t,e,n){var i=new rr;return i.restart(t,e,n),i}function Rm(){Jr(),++Yn;for(var t=tr,e;t;)(e=Mn-t._time)>=0&&t._call.call(void 0,e),t=t._next;--Yn}function hl(){Mn=(nr=pi.now())+ir,Yn=di=0;try{Rm()}finally{Yn=0,$m(),Mn=0}}function Dm(){var t=pi.now(),e=t-nr;e>fl&&(ir-=e,nr=t)}function $m(){for(var t,e=tr,n,i=1/0;e;)e._call?(i>e._time&&(i=e._time),t=e,e=e._next):(n=e._next,e._next=null,e=t?t._next=n:tr=n);mi=t,Zr(i)}function Zr(t){if(!Yn){di&&(di=clearTimeout(di));var e=t-Mn;e>24?(t<1/0&&(di=setTimeout(hl,t-pi.now()-ir)),hi&&(hi=clearInterval(hi))):(hi||(nr=pi.now(),hi=setInterval(Dm,fl)),Yn=1,dl(hl))}}function ml(t,e,n){var i=new rr;return e=e==null?0:+e,i.restart(r=>{i.stop(),t(r+e)},e,n),i}var zm=oi("start","end","cancel","interrupt"),jm=[],pl=0,gl=1,es=2,sr=3,_l=4,ts=5,or=6;function lr(t,e,n,i,r,s){var o=t.__transition;if(!o)t.__transition={};else if(n in o)return;Fm(t,n,{name:e,index:i,group:r,on:zm,tween:jm,time:s.time,delay:s.delay,duration:s.duration,ease:s.ease,timer:null,state:pl})}function ns(t,e){var n=Qt(t,e);if(n.state>pl)throw new Error("too late; already scheduled");return n}function en(t,e){var n=Qt(t,e);if(n.state>sr)throw new Error("too late; already running");return n}function Qt(t,e){var n=t.__transition;if(!n||!(n=n[e]))throw new Error("transition not found");return n}function Fm(t,e,n){var i=t.__transition,r;i[e]=n,n.timer=Qr(s,0,n.time);function s(c){n.state=gl,n.timer.restart(o,n.delay,n.time),n.delay<=c&&o(c-n.delay)}function o(c){var u,h,f,d;if(n.state!==gl)return a();for(u in i)if(d=i[u],d.name===n.name){if(d.state===sr)return ml(o);d.state===_l?(d.state=or,d.timer.stop(),d.on.call("interrupt",t,t.__data__,d.index,d.group),delete i[u]):+u<e&&(d.state=or,d.timer.stop(),d.on.call("cancel",t,t.__data__,d.index,d.group),delete i[u])}if(ml(function(){n.state===sr&&(n.state=_l,n.timer.restart(l,n.delay,n.time),l(c))}),n.state=es,n.on.call("start",t,t.__data__,n.index,n.group),n.state===es){for(n.state=sr,r=new Array(f=n.tween.length),u=0,h=-1;u<f;++u)(d=n.tween[u].value.call(t,t.__data__,n.index,n.group))&&(r[++h]=d);r.length=h+1}}function l(c){for(var u=c<n.duration?n.ease.call(null,c/n.duration):(n.timer.restart(a),n.state=ts,1),h=-1,f=r.length;++h<f;)r[h].call(t,u);n.state===ts&&(n.on.call("end",t,t.__data__,n.index,n.group),a())}function a(){n.state=or,n.timer.stop(),delete i[e];for(var c in i)return;delete t.__transition}}function ar(t,e){var n=t.__transition,i,r,s=!0,o;if(n){e=e==null?null:e+"";for(o in n){if((i=n[o]).name!==e){s=!1;continue}r=i.state>es&&i.state<ts,i.state=or,i.timer.stop(),i.on.call(r?"interrupt":"cancel",t,t.__data__,i.index,i.group),delete n[o]}s&&delete t.__transition}}function Hm(t){return this.each(function(){ar(this,t)})}function Vm(t,e){var n,i;return function(){var r=en(this,t),s=r.tween;if(s!==n){i=n=s;for(var o=0,l=i.length;o<l;++o)if(i[o].name===e){i=i.slice(),i.splice(o,1);break}}r.tween=i}}function Um(t,e,n){var i,r;if(typeof n!="function")throw new Error;return function(){var s=en(this,t),o=s.tween;if(o!==i){r=(i=o).slice();for(var l={name:e,value:n},a=0,c=r.length;a<c;++a)if(r[a].name===e){r[a]=l;break}a===c&&r.push(l)}s.tween=r}}function Bm(t,e){var n=this._id;if(t+="",arguments.length<2){for(var i=Qt(this.node(),n).tween,r=0,s=i.length,o;r<s;++r)if((o=i[r]).name===t)return o.value;return null}return this.each((e==null?Vm:Um)(n,t,e))}function is(t,e,n){var i=t._id;return t.each(function(){var r=en(this,i);(r.value||(r.value={}))[e]=n.apply(this,arguments)}),function(r){return Qt(r,i).value[e]}}function vl(t,e){var n;return(typeof e=="number"?Jt:e instanceof Cn?Zi:(n=Cn(e))?(e=n,Zi):ol)(t,e)}function qm(t){return function(){this.removeAttribute(t)}}function Km(t){return function(){this.removeAttributeNS(t.space,t.local)}}function Wm(t,e,n){var i,r=n+"",s;return function(){var o=this.getAttribute(t);return o===r?null:o===i?s:s=e(i=o,n)}}function Ym(t,e,n){var i,r=n+"",s;return function(){var o=this.getAttributeNS(t.space,t.local);return o===r?null:o===i?s:s=e(i=o,n)}}function Gm(t,e,n){var i,r,s;return function(){var o,l=n(this),a;return l==null?void this.removeAttribute(t):(o=this.getAttribute(t),a=l+"",o===a?null:o===i&&a===r?s:(r=a,s=e(i=o,l)))}}function Xm(t,e,n){var i,r,s;return function(){var o,l=n(this),a;return l==null?void this.removeAttributeNS(t.space,t.local):(o=this.getAttributeNS(t.space,t.local),a=l+"",o===a?null:o===i&&a===r?s:(r=a,s=e(i=o,l)))}}function Jm(t,e){var n=qi(t),i=n==="transform"?Am:vl;return this.attrTween(t,typeof e=="function"?(n.local?Xm:Gm)(n,i,is(this,"attr."+t,e)):e==null?(n.local?Km:qm)(n):(n.local?Ym:Wm)(n,i,e))}function Qm(t,e){return function(n){this.setAttribute(t,e.call(this,n))}}function Zm(t,e){return function(n){this.setAttributeNS(t.space,t.local,e.call(this,n))}}function ep(t,e){var n,i;function r(){var s=e.apply(this,arguments);return s!==i&&(n=(i=s)&&Zm(t,s)),n}return r._value=e,r}function tp(t,e){var n,i;function r(){var s=e.apply(this,arguments);return s!==i&&(n=(i=s)&&Qm(t,s)),n}return r._value=e,r}function np(t,e){var n="attr."+t;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(e==null)return this.tween(n,null);if(typeof e!="function")throw new Error;var i=qi(t);return this.tween(n,(i.local?ep:tp)(i,e))}function ip(t,e){return function(){ns(this,t).delay=+e.apply(this,arguments)}}function rp(t,e){return e=+e,function(){ns(this,t).delay=e}}function sp(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?ip:rp)(e,t)):Qt(this.node(),e).delay}function op(t,e){return function(){en(this,t).duration=+e.apply(this,arguments)}}function lp(t,e){return e=+e,function(){en(this,t).duration=e}}function ap(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?op:lp)(e,t)):Qt(this.node(),e).duration}function cp(t,e){if(typeof e!="function")throw new Error;return function(){en(this,t).ease=e}}function up(t){var e=this._id;return arguments.length?this.each(cp(e,t)):Qt(this.node(),e).ease}function fp(t,e){return function(){var n=e.apply(this,arguments);if(typeof n!="function")throw new Error;en(this,t).ease=n}}function dp(t){if(typeof t!="function")throw new Error;return this.each(fp(this._id,t))}function hp(t){typeof t!="function"&&(t=$o(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var s=e[r],o=s.length,l=i[r]=[],a,c=0;c<o;++c)(a=s[c])&&t.call(a,a.__data__,c,s)&&l.push(a);return new an(i,this._parents,this._name,this._id)}function mp(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,n=t._groups,i=e.length,r=n.length,s=Math.min(i,r),o=new Array(i),l=0;l<s;++l)for(var a=e[l],c=n[l],u=a.length,h=o[l]=new Array(u),f,d=0;d<u;++d)(f=a[d]||c[d])&&(h[d]=f);for(;l<i;++l)o[l]=e[l];return new an(o,this._parents,this._name,this._id)}function pp(t){return(t+"").trim().split(/^|\s+/).every(function(e){var n=e.indexOf(".");return n>=0&&(e=e.slice(0,n)),!e||e==="start"})}function gp(t,e,n){var i,r,s=pp(e)?ns:en;return function(){var o=s(this,t),l=o.on;l!==i&&(r=(i=l).copy()).on(e,n),o.on=r}}function _p(t,e){var n=this._id;return arguments.length<2?Qt(this.node(),n).on.on(t):this.each(gp(n,t,e))}function vp(t){return function(){var e=this.parentNode;for(var n in this.__transition)if(+n!==t)return;e&&e.removeChild(this)}}function yp(){return this.on("end.remove",vp(this._id))}function bp(t){var e=this._name,n=this._id;typeof t!="function"&&(t=jr(t));for(var i=this._groups,r=i.length,s=new Array(r),o=0;o<r;++o)for(var l=i[o],a=l.length,c=s[o]=new Array(a),u,h,f=0;f<a;++f)(u=l[f])&&(h=t.call(u,u.__data__,f,l))&&("__data__"in u&&(h.__data__=u.__data__),c[f]=h,lr(c[f],e,n,f,c,Qt(u,n)));return new an(s,this._parents,e,n)}function wp(t){var e=this._name,n=this._id;typeof t!="function"&&(t=Do(t));for(var i=this._groups,r=i.length,s=[],o=[],l=0;l<r;++l)for(var a=i[l],c=a.length,u,h=0;h<c;++h)if(u=a[h]){for(var f=t.call(u,u.__data__,h,a),d,m=Qt(u,n),p=0,g=f.length;p<g;++p)(d=f[p])&&lr(d,e,n,p,f,m);s.push(f),o.push(u)}return new an(s,o,e,n)}var Sp=li.prototype.constructor;function kp(){return new Sp(this._groups,this._parents)}function Ep(t,e){var n,i,r;return function(){var s=qn(this,t),o=(this.style.removeProperty(t),qn(this,t));return s===o?null:s===n&&o===i?r:r=e(n=s,i=o)}}function yl(t){return function(){this.style.removeProperty(t)}}function Cp(t,e,n){var i,r=n+"",s;return function(){var o=qn(this,t);return o===r?null:o===i?s:s=e(i=o,n)}}function Ip(t,e,n){var i,r,s;return function(){var o=qn(this,t),l=n(this),a=l+"";return l==null&&(a=l=(this.style.removeProperty(t),qn(this,t))),o===a?null:o===i&&a===r?s:(r=a,s=e(i=o,l))}}function xp(t,e){var n,i,r,s="style."+e,o="end."+s,l;return function(){var a=en(this,t),c=a.on,u=a.value[s]==null?l||(l=yl(e)):void 0;(c!==n||r!==u)&&(i=(n=c).copy()).on(o,r=u),a.on=i}}function Mp(t,e,n){var i=(t+="")=="transform"?Mm:vl;return e==null?this.styleTween(t,Ep(t,i)).on("end.style."+t,yl(t)):typeof e=="function"?this.styleTween(t,Ip(t,i,is(this,"style."+t,e))).each(xp(this._id,t)):this.styleTween(t,Cp(t,i,e),n).on("end.style."+t,null)}function Ap(t,e,n){return function(i){this.style.setProperty(t,e.call(this,i),n)}}function Tp(t,e,n){var i,r;function s(){var o=e.apply(this,arguments);return o!==r&&(i=(r=o)&&Ap(t,o,n)),i}return s._value=e,s}function Np(t,e,n){var i="style."+(t+="");if(arguments.length<2)return(i=this.tween(i))&&i._value;if(e==null)return this.tween(i,null);if(typeof e!="function")throw new Error;return this.tween(i,Tp(t,e,n??""))}function Pp(t){return function(){this.textContent=t}}function Op(t){return function(){var e=t(this);this.textContent=e??""}}function Lp(t){return this.tween("text",typeof t=="function"?Op(is(this,"text",t)):Pp(t==null?"":t+""))}function Rp(t){return function(e){this.textContent=t.call(this,e)}}function Dp(t){var e,n;function i(){var r=t.apply(this,arguments);return r!==n&&(e=(n=r)&&Rp(r)),e}return i._value=t,i}function $p(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(t==null)return this.tween(e,null);if(typeof t!="function")throw new Error;return this.tween(e,Dp(t))}function zp(){for(var t=this._name,e=this._id,n=bl(),i=this._groups,r=i.length,s=0;s<r;++s)for(var o=i[s],l=o.length,a,c=0;c<l;++c)if(a=o[c]){var u=Qt(a,e);lr(a,t,n,c,o,{time:u.time+u.delay+u.duration,delay:0,duration:u.duration,ease:u.ease})}return new an(i,this._parents,t,n)}function jp(){var t,e,n=this,i=n._id,r=n.size();return new Promise(function(s,o){var l={value:o},a={value:function(){--r===0&&s()}};n.each(function(){var c=en(this,i),u=c.on;u!==t&&(e=(t=u).copy(),e._.cancel.push(l),e._.interrupt.push(l),e._.end.push(a)),c.on=e}),r===0&&s()})}var Fp=0;function an(t,e,n,i){this._groups=t,this._parents=e,this._name=n,this._id=i}function bl(){return++Fp}var cn=li.prototype;an.prototype={constructor:an,select:bp,selectAll:wp,selectChild:cn.selectChild,selectChildren:cn.selectChildren,filter:hp,merge:mp,selection:kp,transition:zp,call:cn.call,nodes:cn.nodes,node:cn.node,size:cn.size,empty:cn.empty,each:cn.each,on:_p,attr:Jm,attrTween:np,style:Mp,styleTween:Np,text:Lp,textTween:$p,remove:yp,tween:Bm,delay:sp,duration:ap,ease:up,easeVarying:dp,end:jp,[Symbol.iterator]:cn[Symbol.iterator]};function Hp(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}var Vp={time:null,delay:0,duration:250,ease:Hp};function Up(t,e){for(var n;!(n=t.__transition)||!(n=n[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return n}function Bp(t){var e,n;t instanceof an?(e=t._id,t=t._name):(e=bl(),(n=Vp).time=Jr(),t=t==null?null:t+"");for(var i=this._groups,r=i.length,s=0;s<r;++s)for(var o=i[s],l=o.length,a,c=0;c<l;++c)(a=o[c])&&lr(a,t,e,c,o,n||Up(a,e));return new an(i,this._parents,t,e)}li.prototype.interrupt=Hm,li.prototype.transition=Bp;function wl(t,e){var n,i=1;t==null&&(t=0),e==null&&(e=0);function r(){var s,o=n.length,l,a=0,c=0;for(s=0;s<o;++s)l=n[s],a+=l.x,c+=l.y;for(a=(a/o-t)*i,c=(c/o-e)*i,s=0;s<o;++s)l=n[s],l.x-=a,l.y-=c}return r.initialize=function(s){n=s},r.x=function(s){return arguments.length?(t=+s,r):t},r.y=function(s){return arguments.length?(e=+s,r):e},r.strength=function(s){return arguments.length?(i=+s,r):i},r}function qp(t){const e=+this._x.call(null,t),n=+this._y.call(null,t);return Sl(this.cover(e,n),e,n,t)}function Sl(t,e,n,i){if(isNaN(e)||isNaN(n))return t;var r,s=t._root,o={data:i},l=t._x0,a=t._y0,c=t._x1,u=t._y1,h,f,d,m,p,g,_,S;if(!s)return t._root=o,t;for(;s.length;)if((p=e>=(h=(l+c)/2))?l=h:c=h,(g=n>=(f=(a+u)/2))?a=f:u=f,r=s,!(s=s[_=g<<1|p]))return r[_]=o,t;if(d=+t._x.call(null,s.data),m=+t._y.call(null,s.data),e===d&&n===m)return o.next=s,r?r[_]=o:t._root=o,t;do r=r?r[_]=new Array(4):t._root=new Array(4),(p=e>=(h=(l+c)/2))?l=h:c=h,(g=n>=(f=(a+u)/2))?a=f:u=f;while((_=g<<1|p)===(S=(m>=f)<<1|d>=h));return r[S]=s,r[_]=o,t}function Kp(t){var e,n,i=t.length,r,s,o=new Array(i),l=new Array(i),a=1/0,c=1/0,u=-1/0,h=-1/0;for(n=0;n<i;++n)isNaN(r=+this._x.call(null,e=t[n]))||isNaN(s=+this._y.call(null,e))||(o[n]=r,l[n]=s,r<a&&(a=r),r>u&&(u=r),s<c&&(c=s),s>h&&(h=s));if(a>u||c>h)return this;for(this.cover(a,c).cover(u,h),n=0;n<i;++n)Sl(this,o[n],l[n],t[n]);return this}function Wp(t,e){if(isNaN(t=+t)||isNaN(e=+e))return this;var n=this._x0,i=this._y0,r=this._x1,s=this._y1;if(isNaN(n))r=(n=Math.floor(t))+1,s=(i=Math.floor(e))+1;else{for(var o=r-n||1,l=this._root,a,c;n>t||t>=r||i>e||e>=s;)switch(c=(e<i)<<1|t<n,a=new Array(4),a[c]=l,l=a,o*=2,c){case 0:r=n+o,s=i+o;break;case 1:n=r-o,s=i+o;break;case 2:r=n+o,i=s-o;break;case 3:n=r-o,i=s-o;break}this._root&&this._root.length&&(this._root=l)}return this._x0=n,this._y0=i,this._x1=r,this._y1=s,this}function Yp(){var t=[];return this.visit(function(e){if(!e.length)do t.push(e.data);while(e=e.next)}),t}function Gp(t){return arguments.length?this.cover(+t[0][0],+t[0][1]).cover(+t[1][0],+t[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function Pt(t,e,n,i,r){this.node=t,this.x0=e,this.y0=n,this.x1=i,this.y1=r}function Xp(t,e,n){var i,r=this._x0,s=this._y0,o,l,a,c,u=this._x1,h=this._y1,f=[],d=this._root,m,p;for(d&&f.push(new Pt(d,r,s,u,h)),n==null?n=1/0:(r=t-n,s=e-n,u=t+n,h=e+n,n*=n);m=f.pop();)if(!(!(d=m.node)||(o=m.x0)>u||(l=m.y0)>h||(a=m.x1)<r||(c=m.y1)<s))if(d.length){var g=(o+a)/2,_=(l+c)/2;f.push(new Pt(d[3],g,_,a,c),new Pt(d[2],o,_,g,c),new Pt(d[1],g,l,a,_),new Pt(d[0],o,l,g,_)),(p=(e>=_)<<1|t>=g)&&(m=f[f.length-1],f[f.length-1]=f[f.length-1-p],f[f.length-1-p]=m)}else{var S=t-+this._x.call(null,d.data),C=e-+this._y.call(null,d.data),w=S*S+C*C;if(w<n){var k=Math.sqrt(n=w);r=t-k,s=e-k,u=t+k,h=e+k,i=d.data}}return i}function Jp(t){if(isNaN(u=+this._x.call(null,t))||isNaN(h=+this._y.call(null,t)))return this;var e,n=this._root,i,r,s,o=this._x0,l=this._y0,a=this._x1,c=this._y1,u,h,f,d,m,p,g,_;if(!n)return this;if(n.length)for(;;){if((m=u>=(f=(o+a)/2))?o=f:a=f,(p=h>=(d=(l+c)/2))?l=d:c=d,e=n,!(n=n[g=p<<1|m]))return this;if(!n.length)break;(e[g+1&3]||e[g+2&3]||e[g+3&3])&&(i=e,_=g)}for(;n.data!==t;)if(r=n,!(n=n.next))return this;return(s=n.next)&&delete n.next,r?(s?r.next=s:delete r.next,this):e?(s?e[g]=s:delete e[g],(n=e[0]||e[1]||e[2]||e[3])&&n===(e[3]||e[2]||e[1]||e[0])&&!n.length&&(i?i[_]=n:this._root=n),this):(this._root=s,this)}function Qp(t){for(var e=0,n=t.length;e<n;++e)this.remove(t[e]);return this}function Zp(){return this._root}function eg(){var t=0;return this.visit(function(e){if(!e.length)do++t;while(e=e.next)}),t}function tg(t){var e=[],n,i=this._root,r,s,o,l,a;for(i&&e.push(new Pt(i,this._x0,this._y0,this._x1,this._y1));n=e.pop();)if(!t(i=n.node,s=n.x0,o=n.y0,l=n.x1,a=n.y1)&&i.length){var c=(s+l)/2,u=(o+a)/2;(r=i[3])&&e.push(new Pt(r,c,u,l,a)),(r=i[2])&&e.push(new Pt(r,s,u,c,a)),(r=i[1])&&e.push(new Pt(r,c,o,l,u)),(r=i[0])&&e.push(new Pt(r,s,o,c,u))}return this}function ng(t){var e=[],n=[],i;for(this._root&&e.push(new Pt(this._root,this._x0,this._y0,this._x1,this._y1));i=e.pop();){var r=i.node;if(r.length){var s,o=i.x0,l=i.y0,a=i.x1,c=i.y1,u=(o+a)/2,h=(l+c)/2;(s=r[0])&&e.push(new Pt(s,o,l,u,h)),(s=r[1])&&e.push(new Pt(s,u,l,a,h)),(s=r[2])&&e.push(new Pt(s,o,h,u,c)),(s=r[3])&&e.push(new Pt(s,u,h,a,c))}n.push(i)}for(;i=n.pop();)t(i.node,i.x0,i.y0,i.x1,i.y1);return this}function ig(t){return t[0]}function rg(t){return arguments.length?(this._x=t,this):this._x}function sg(t){return t[1]}function og(t){return arguments.length?(this._y=t,this):this._y}function rs(t,e,n){var i=new ss(e??ig,n??sg,NaN,NaN,NaN,NaN);return t==null?i:i.addAll(t)}function ss(t,e,n,i,r,s){this._x=t,this._y=e,this._x0=n,this._y0=i,this._x1=r,this._y1=s,this._root=void 0}function kl(t){for(var e={data:t.data},n=e;t=t.next;)n=n.next={data:t.data};return e}var Ot=rs.prototype=ss.prototype;Ot.copy=function(){var t=new ss(this._x,this._y,this._x0,this._y0,this._x1,this._y1),e=this._root,n,i;if(!e)return t;if(!e.length)return t._root=kl(e),t;for(n=[{source:e,target:t._root=new Array(4)}];e=n.pop();)for(var r=0;r<4;++r)(i=e.source[r])&&(i.length?n.push({source:i,target:e.target[r]=new Array(4)}):e.target[r]=kl(i));return t},Ot.add=qp,Ot.addAll=Kp,Ot.cover=Wp,Ot.data=Yp,Ot.extent=Gp,Ot.find=Xp,Ot.remove=Jp,Ot.removeAll=Qp,Ot.root=Zp,Ot.size=eg,Ot.visit=tg,Ot.visitAfter=ng,Ot.x=rg,Ot.y=og;function Lt(t){return function(){return t}}function wn(t){return(t()-.5)*1e-6}function lg(t){return t.x+t.vx}function ag(t){return t.y+t.vy}function El(t){var e,n,i,r=1,s=1;typeof t!="function"&&(t=Lt(t==null?1:+t));function o(){for(var c,u=e.length,h,f,d,m,p,g,_=0;_<s;++_)for(h=rs(e,lg,ag).visitAfter(l),c=0;c<u;++c)f=e[c],p=n[f.index],g=p*p,d=f.x+f.vx,m=f.y+f.vy,h.visit(S);function S(C,w,k,T,N){var E=C.data,x=C.r,L=p+x;if(E){if(E.index>f.index){var O=d-E.x-E.vx,F=m-E.y-E.vy,R=O*O+F*F;R<L*L&&(O===0&&(O=wn(i),R+=O*O),F===0&&(F=wn(i),R+=F*F),R=(L-(R=Math.sqrt(R)))/R*r,f.vx+=(O*=R)*(L=(x*=x)/(g+x)),f.vy+=(F*=R)*L,E.vx-=O*(L=1-L),E.vy-=F*L)}return}return w>d+L||T<d-L||k>m+L||N<m-L}}function l(c){if(c.data)return c.r=n[c.data.index];for(var u=c.r=0;u<4;++u)c[u]&&c[u].r>c.r&&(c.r=c[u].r)}function a(){if(e){var c,u=e.length,h;for(n=new Array(u),c=0;c<u;++c)h=e[c],n[h.index]=+t(h,c,e)}}return o.initialize=function(c,u){e=c,i=u,a()},o.iterations=function(c){return arguments.length?(s=+c,o):s},o.strength=function(c){return arguments.length?(r=+c,o):r},o.radius=function(c){return arguments.length?(t=typeof c=="function"?c:Lt(+c),a(),o):t},o}function cg(t){return t.index}function Cl(t,e){var n=t.get(e);if(!n)throw new Error("node not found: "+e);return n}function Il(t){var e=cg,n=h,i,r=Lt(30),s,o,l,a,c,u=1;t==null&&(t=[]);function h(g){return 1/Math.min(l[g.source.index],l[g.target.index])}function f(g){for(var _=0,S=t.length;_<u;++_)for(var C=0,w,k,T,N,E,x,L;C<S;++C)w=t[C],k=w.source,T=w.target,N=T.x+T.vx-k.x-k.vx||wn(c),E=T.y+T.vy-k.y-k.vy||wn(c),x=Math.sqrt(N*N+E*E),x=(x-s[C])/x*g*i[C],N*=x,E*=x,T.vx-=N*(L=a[C]),T.vy-=E*L,k.vx+=N*(L=1-L),k.vy+=E*L}function d(){if(o){var g,_=o.length,S=t.length,C=new Map(o.map((k,T)=>[e(k,T,o),k])),w;for(g=0,l=new Array(_);g<S;++g)w=t[g],w.index=g,typeof w.source!="object"&&(w.source=Cl(C,w.source)),typeof w.target!="object"&&(w.target=Cl(C,w.target)),l[w.source.index]=(l[w.source.index]||0)+1,l[w.target.index]=(l[w.target.index]||0)+1;for(g=0,a=new Array(S);g<S;++g)w=t[g],a[g]=l[w.source.index]/(l[w.source.index]+l[w.target.index]);i=new Array(S),m(),s=new Array(S),p()}}function m(){if(o)for(var g=0,_=t.length;g<_;++g)i[g]=+n(t[g],g,t)}function p(){if(o)for(var g=0,_=t.length;g<_;++g)s[g]=+r(t[g],g,t)}return f.initialize=function(g,_){o=g,c=_,d()},f.links=function(g){return arguments.length?(t=g,d(),f):t},f.id=function(g){return arguments.length?(e=g,f):e},f.iterations=function(g){return arguments.length?(u=+g,f):u},f.strength=function(g){return arguments.length?(n=typeof g=="function"?g:Lt(+g),m(),f):n},f.distance=function(g){return arguments.length?(r=typeof g=="function"?g:Lt(+g),p(),f):r},f}const ug=1664525,fg=1013904223,xl=4294967296;function dg(){let t=1;return()=>(t=(ug*t+fg)%xl)/xl}function hg(t){return t.x}function mg(t){return t.y}var pg=10,gg=Math.PI*(3-Math.sqrt(5));function Ml(t){var e,n=1,i=.001,r=1-Math.pow(i,1/300),s=0,o=.6,l=new Map,a=Qr(h),c=oi("tick","end"),u=dg();t==null&&(t=[]);function h(){f(),c.call("tick",e),n<i&&(a.stop(),c.call("end",e))}function f(p){var g,_=t.length,S;p===void 0&&(p=1);for(var C=0;C<p;++C)for(n+=(s-n)*r,l.forEach(function(w){w(n)}),g=0;g<_;++g)S=t[g],S.fx==null?S.x+=S.vx*=o:(S.x=S.fx,S.vx=0),S.fy==null?S.y+=S.vy*=o:(S.y=S.fy,S.vy=0);return e}function d(){for(var p=0,g=t.length,_;p<g;++p){if(_=t[p],_.index=p,_.fx!=null&&(_.x=_.fx),_.fy!=null&&(_.y=_.fy),isNaN(_.x)||isNaN(_.y)){var S=pg*Math.sqrt(.5+p),C=p*gg;_.x=S*Math.cos(C),_.y=S*Math.sin(C)}(isNaN(_.vx)||isNaN(_.vy))&&(_.vx=_.vy=0)}}function m(p){return p.initialize&&p.initialize(t,u),p}return d(),e={tick:f,restart:function(){return a.restart(h),e},stop:function(){return a.stop(),e},nodes:function(p){return arguments.length?(t=p,d(),l.forEach(m),e):t},alpha:function(p){return arguments.length?(n=+p,e):n},alphaMin:function(p){return arguments.length?(i=+p,e):i},alphaDecay:function(p){return arguments.length?(r=+p,e):+r},alphaTarget:function(p){return arguments.length?(s=+p,e):s},velocityDecay:function(p){return arguments.length?(o=1-p,e):1-o},randomSource:function(p){return arguments.length?(u=p,l.forEach(m),e):u},force:function(p,g){return arguments.length>1?(g==null?l.delete(p):l.set(p,m(g)),e):l.get(p)},find:function(p,g,_){var S=0,C=t.length,w,k,T,N,E;for(_==null?_=1/0:_*=_,S=0;S<C;++S)N=t[S],w=p-N.x,k=g-N.y,T=w*w+k*k,T<_&&(E=N,_=T);return E},on:function(p,g){return arguments.length>1?(c.on(p,g),e):c.on(p)}}}function Al(){var t,e,n,i,r=Lt(-30),s,o=1,l=1/0,a=.81;function c(d){var m,p=t.length,g=rs(t,hg,mg).visitAfter(h);for(i=d,m=0;m<p;++m)e=t[m],g.visit(f)}function u(){if(t){var d,m=t.length,p;for(s=new Array(m),d=0;d<m;++d)p=t[d],s[p.index]=+r(p,d,t)}}function h(d){var m=0,p,g,_=0,S,C,w;if(d.length){for(S=C=w=0;w<4;++w)(p=d[w])&&(g=Math.abs(p.value))&&(m+=p.value,_+=g,S+=g*p.x,C+=g*p.y);d.x=S/_,d.y=C/_}else{p=d,p.x=p.data.x,p.y=p.data.y;do m+=s[p.data.index];while(p=p.next)}d.value=m}function f(d,m,p,g){if(!d.value)return!0;var _=d.x-e.x,S=d.y-e.y,C=g-m,w=_*_+S*S;if(C*C/a<w)return w<l&&(_===0&&(_=wn(n),w+=_*_),S===0&&(S=wn(n),w+=S*S),w<o&&(w=Math.sqrt(o*w)),e.vx+=_*d.value*i/w,e.vy+=S*d.value*i/w),!0;if(d.length||w>=l)return;(d.data!==e||d.next)&&(_===0&&(_=wn(n),w+=_*_),S===0&&(S=wn(n),w+=S*S),w<o&&(w=Math.sqrt(o*w)));do d.data!==e&&(C=s[d.data.index]*i/w,e.vx+=_*C,e.vy+=S*C);while(d=d.next)}return c.initialize=function(d,m){t=d,n=m,u()},c.strength=function(d){return arguments.length?(r=typeof d=="function"?d:Lt(+d),u(),c):r},c.distanceMin=function(d){return arguments.length?(o=d*d,c):Math.sqrt(o)},c.distanceMax=function(d){return arguments.length?(l=d*d,c):Math.sqrt(l)},c.theta=function(d){return arguments.length?(a=d*d,c):Math.sqrt(a)},c}function Tl(t){var e=Lt(.1),n,i,r;typeof t!="function"&&(t=Lt(t==null?0:+t));function s(l){for(var a=0,c=n.length,u;a<c;++a)u=n[a],u.vx+=(r[a]-u.x)*i[a]*l}function o(){if(n){var l,a=n.length;for(i=new Array(a),r=new Array(a),l=0;l<a;++l)i[l]=isNaN(r[l]=+t(n[l],l,n))?0:+e(n[l],l,n)}}return s.initialize=function(l){n=l,o()},s.strength=function(l){return arguments.length?(e=typeof l=="function"?l:Lt(+l),o(),s):e},s.x=function(l){return arguments.length?(t=typeof l=="function"?l:Lt(+l),o(),s):t},s}function Nl(t){var e=Lt(.1),n,i,r;typeof t!="function"&&(t=Lt(t==null?0:+t));function s(l){for(var a=0,c=n.length,u;a<c;++a)u=n[a],u.vy+=(r[a]-u.y)*i[a]*l}function o(){if(n){var l,a=n.length;for(i=new Array(a),r=new Array(a),l=0;l<a;++l)i[l]=isNaN(r[l]=+t(n[l],l,n))?0:+e(n[l],l,n)}}return s.initialize=function(l){n=l,o()},s.strength=function(l){return arguments.length?(e=typeof l=="function"?l:Lt(+l),o(),s):e},s.y=function(l){return arguments.length?(t=typeof l=="function"?l:Lt(+l),o(),s):t},s}function _g(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)}function cr(t,e){if((n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var n,i=t.slice(0,n);return[i.length>1?i[0]+i.slice(2):i,+t.slice(n+1)]}function Gn(t){return t=cr(Math.abs(t)),t?t[1]:NaN}function vg(t,e){return function(n,i){for(var r=n.length,s=[],o=0,l=t[0],a=0;r>0&&l>0&&(a+l+1>i&&(l=Math.max(1,i-a)),s.push(n.substring(r-=l,r+l)),!((a+=l+1)>i));)l=t[o=(o+1)%t.length];return s.reverse().join(e)}}function yg(t){return function(e){return e.replace(/[0-9]/g,function(n){return t[+n]})}}var bg=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function ur(t){if(!(e=bg.exec(t)))throw new Error("invalid format: "+t);var e;return new os({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}ur.prototype=os.prototype;function os(t){this.fill=t.fill===void 0?" ":t.fill+"",this.align=t.align===void 0?">":t.align+"",this.sign=t.sign===void 0?"-":t.sign+"",this.symbol=t.symbol===void 0?"":t.symbol+"",this.zero=!!t.zero,this.width=t.width===void 0?void 0:+t.width,this.comma=!!t.comma,this.precision=t.precision===void 0?void 0:+t.precision,this.trim=!!t.trim,this.type=t.type===void 0?"":t.type+""}os.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function wg(t){e:for(var e=t.length,n=1,i=-1,r;n<e;++n)switch(t[n]){case".":i=r=n;break;case"0":i===0&&(i=n),r=n;break;default:if(!+t[n])break e;i>0&&(i=0);break}return i>0?t.slice(0,i)+t.slice(r+1):t}var Pl;function Sg(t,e){var n=cr(t,e);if(!n)return t+"";var i=n[0],r=n[1],s=r-(Pl=Math.max(-8,Math.min(8,Math.floor(r/3)))*3)+1,o=i.length;return s===o?i:s>o?i+new Array(s-o+1).join("0"):s>0?i.slice(0,s)+"."+i.slice(s):"0."+new Array(1-s).join("0")+cr(t,Math.max(0,e+s-1))[0]}function Ol(t,e){var n=cr(t,e);if(!n)return t+"";var i=n[0],r=n[1];return r<0?"0."+new Array(-r).join("0")+i:i.length>r+1?i.slice(0,r+1)+"."+i.slice(r+1):i+new Array(r-i.length+2).join("0")}const Ll={"%":(t,e)=>(t*100).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:_g,e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>Ol(t*100,e),r:Ol,s:Sg,X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function Rl(t){return t}var Dl=Array.prototype.map,$l=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function kg(t){var e=t.grouping===void 0||t.thousands===void 0?Rl:vg(Dl.call(t.grouping,Number),t.thousands+""),n=t.currency===void 0?"":t.currency[0]+"",i=t.currency===void 0?"":t.currency[1]+"",r=t.decimal===void 0?".":t.decimal+"",s=t.numerals===void 0?Rl:yg(Dl.call(t.numerals,String)),o=t.percent===void 0?"%":t.percent+"",l=t.minus===void 0?"−":t.minus+"",a=t.nan===void 0?"NaN":t.nan+"";function c(h){h=ur(h);var f=h.fill,d=h.align,m=h.sign,p=h.symbol,g=h.zero,_=h.width,S=h.comma,C=h.precision,w=h.trim,k=h.type;k==="n"?(S=!0,k="g"):Ll[k]||(C===void 0&&(C=12),w=!0,k="g"),(g||f==="0"&&d==="=")&&(g=!0,f="0",d="=");var T=p==="$"?n:p==="#"&&/[boxX]/.test(k)?"0"+k.toLowerCase():"",N=p==="$"?i:/[%p]/.test(k)?o:"",E=Ll[k],x=/[defgprs%]/.test(k);C=C===void 0?6:/[gprs]/.test(k)?Math.max(1,Math.min(21,C)):Math.max(0,Math.min(20,C));function L(O){var F=T,R=N,I,U,P;if(k==="c")R=E(O)+R,O="";else{O=+O;var G=O<0||1/O<0;if(O=isNaN(O)?a:E(Math.abs(O),C),w&&(O=wg(O)),G&&+O==0&&m!=="+"&&(G=!1),F=(G?m==="("?m:l:m==="-"||m==="("?"":m)+F,R=(k==="s"?$l[8+Pl/3]:"")+R+(G&&m==="("?")":""),x){for(I=-1,U=O.length;++I<U;)if(P=O.charCodeAt(I),48>P||P>57){R=(P===46?r+O.slice(I+1):O.slice(I))+R,O=O.slice(0,I);break}}}S&&!g&&(O=e(O,1/0));var V=F.length+O.length+R.length,q=V<_?new Array(_-V+1).join(f):"";switch(S&&g&&(O=e(q+O,q.length?_-R.length:1/0),q=""),d){case"<":O=F+O+R+q;break;case"=":O=F+q+O+R;break;case"^":O=q.slice(0,V=q.length>>1)+F+O+R+q.slice(V);break;default:O=q+F+O+R;break}return s(O)}return L.toString=function(){return h+""},L}function u(h,f){var d=c((h=ur(h),h.type="f",h)),m=Math.max(-8,Math.min(8,Math.floor(Gn(f)/3)))*3,p=Math.pow(10,-m),g=$l[8+m/3];return function(_){return d(p*_)+g}}return{format:c,formatPrefix:u}}var fr,zl,jl;Eg({thousands:",",grouping:[3],currency:["$",""]});function Eg(t){return fr=kg(t),zl=fr.format,jl=fr.formatPrefix,fr}function Cg(t){return Math.max(0,-Gn(Math.abs(t)))}function Ig(t,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Gn(e)/3)))*3-Gn(Math.abs(t)))}function xg(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,Gn(e)-Gn(t))+1}function ls(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t);break}return this}const Fl=Symbol("implicit");function Hl(){var t=new Io,e=[],n=[],i=Fl;function r(s){let o=t.get(s);if(o===void 0){if(i!==Fl)return i;t.set(s,o=e.push(s)-1)}return n[o%n.length]}return r.domain=function(s){if(!arguments.length)return e.slice();e=[],t=new Io;for(const o of s)t.has(o)||t.set(o,e.push(o)-1);return r},r.range=function(s){return arguments.length?(n=Array.from(s),r):n.slice()},r.unknown=function(s){return arguments.length?(i=s,r):i},r.copy=function(){return Hl(e,n).unknown(i)},ls.apply(r,arguments),r}function Vl(){var t=Hl().unknown(void 0),e=t.domain,n=t.range,i=0,r=1,s,o,l=!1,a=0,c=0,u=.5;delete t.unknown;function h(){var f=e().length,d=r<i,m=d?r:i,p=d?i:r;s=(p-m)/Math.max(1,f-a+c*2),l&&(s=Math.floor(s)),m+=(p-m-s*(f-a))*u,o=s*(1-a),l&&(m=Math.round(m),o=Math.round(o));var g=Vi(f).map(function(_){return m+s*_});return n(d?g.reverse():g)}return t.domain=function(f){return arguments.length?(e(f),h()):e()},t.range=function(f){return arguments.length?([i,r]=f,i=+i,r=+r,h()):[i,r]},t.rangeRound=function(f){return[i,r]=f,i=+i,r=+r,l=!0,h()},t.bandwidth=function(){return o},t.step=function(){return s},t.round=function(f){return arguments.length?(l=!!f,h()):l},t.padding=function(f){return arguments.length?(a=Math.min(1,c=+f),h()):a},t.paddingInner=function(f){return arguments.length?(a=Math.min(1,f),h()):a},t.paddingOuter=function(f){return arguments.length?(c=+f,h()):c},t.align=function(f){return arguments.length?(u=Math.max(0,Math.min(1,f)),h()):u},t.copy=function(){return Vl(e(),[i,r]).round(l).paddingInner(a).paddingOuter(c).align(u)},ls.apply(h(),arguments)}function Mg(t){return function(){return t}}function Ag(t){return+t}var Ul=[0,1];function Xn(t){return t}function as(t,e){return(e-=t=+t)?function(n){return(n-t)/e}:Mg(isNaN(e)?NaN:.5)}function Tg(t,e){var n;return t>e&&(n=t,t=e,e=n),function(i){return Math.max(t,Math.min(e,i))}}function Ng(t,e,n){var i=t[0],r=t[1],s=e[0],o=e[1];return r<i?(i=as(r,i),s=n(o,s)):(i=as(i,r),s=n(s,o)),function(l){return s(i(l))}}function Pg(t,e,n){var i=Math.min(t.length,e.length)-1,r=new Array(i),s=new Array(i),o=-1;for(t[i]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++o<i;)r[o]=as(t[o],t[o+1]),s[o]=n(e[o],e[o+1]);return function(l){var a=td(t,l,1,i)-1;return s[a](r[a](l))}}function Og(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function Lg(){var t=Ul,e=Ul,n=Gr,i,r,s,o=Xn,l,a,c;function u(){var f=Math.min(t.length,e.length);return o!==Xn&&(o=Tg(t[0],t[f-1])),l=f>2?Pg:Ng,a=c=null,h}function h(f){return f==null||isNaN(f=+f)?s:(a||(a=l(t.map(i),e,n)))(i(o(f)))}return h.invert=function(f){return o(r((c||(c=l(e,t.map(i),Jt)))(f)))},h.domain=function(f){return arguments.length?(t=Array.from(f,Ag),u()):t.slice()},h.range=function(f){return arguments.length?(e=Array.from(f),u()):e.slice()},h.rangeRound=function(f){return e=Array.from(f),n=Cm,u()},h.clamp=function(f){return arguments.length?(o=f?!0:Xn,u()):o!==Xn},h.interpolate=function(f){return arguments.length?(n=f,u()):n},h.unknown=function(f){return arguments.length?(s=f,h):s},function(f,d){return i=f,r=d,u()}}function Rg(){return Lg()(Xn,Xn)}function Dg(t,e,n,i){var r=cd(t,e,n),s;switch(i=ur(i??",f"),i.type){case"s":{var o=Math.max(Math.abs(t),Math.abs(e));return i.precision==null&&!isNaN(s=Ig(r,o))&&(i.precision=s),jl(i,o)}case"":case"e":case"g":case"p":case"r":{i.precision==null&&!isNaN(s=xg(r,Math.max(Math.abs(t),Math.abs(e))))&&(i.precision=s-(i.type==="e"));break}case"f":case"%":{i.precision==null&&!isNaN(s=Cg(r))&&(i.precision=s-(i.type==="%")*2);break}}return zl(i)}function $g(t){var e=t.domain;return t.ticks=function(n){var i=e();return ad(i[0],i[i.length-1],n??10)},t.tickFormat=function(n,i){var r=e();return Dg(r[0],r[r.length-1],n??10,i)},t.nice=function(n){n==null&&(n=10);var i=e(),r=0,s=i.length-1,o=i[r],l=i[s],a,c,u=10;for(l<o&&(c=o,o=l,l=c,c=r,r=s,s=c);u-- >0;){if(c=Dr(o,l,n),c===a)return i[r]=o,i[s]=l,e(i);if(c>0)o=Math.floor(o/c)*c,l=Math.ceil(l/c)*c;else if(c<0)o=Math.ceil(o*c)/c,l=Math.floor(l*c)/c;else break;a=c}return t},t}function gi(){var t=Rg();return t.copy=function(){return Og(t,gi())},ls.apply(t,arguments),$g(t)}const dr=t=>()=>t;function zg(t,{sourceEvent:e,target:n,transform:i,dispatch:r}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:i,enumerable:!0,configurable:!0},_:{value:r}})}function un(t,e,n){this.k=t,this.x=e,this.y=n}un.prototype={constructor:un,scale:function(t){return t===1?this:new un(this.k*t,this.x,this.y)},translate:function(t,e){return t===0&e===0?this:new un(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var cs=new un(1,0,0);un.prototype;function us(t){t.stopImmediatePropagation()}function _i(t){t.preventDefault(),t.stopImmediatePropagation()}function jg(t){return(!t.ctrlKey||t.type==="wheel")&&!t.button}function Fg(){var t=this;return t instanceof SVGElement?(t=t.ownerSVGElement||t,t.hasAttribute("viewBox")?(t=t.viewBox.baseVal,[[t.x,t.y],[t.x+t.width,t.y+t.height]]):[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]):[[0,0],[t.clientWidth,t.clientHeight]]}function Bl(){return this.__zoom||cs}function Hg(t){return-t.deltaY*(t.deltaMode===1?.05:t.deltaMode?1:.002)*(t.ctrlKey?10:1)}function Vg(){return navigator.maxTouchPoints||"ontouchstart"in this}function Ug(t,e,n){var i=t.invertX(e[0][0])-n[0][0],r=t.invertX(e[1][0])-n[1][0],s=t.invertY(e[0][1])-n[0][1],o=t.invertY(e[1][1])-n[1][1];return t.translate(r>i?(i+r)/2:Math.min(0,i)||Math.max(0,r),o>s?(s+o)/2:Math.min(0,s)||Math.max(0,o))}function ql(){var t=jg,e=Fg,n=Ug,i=Hg,r=Vg,s=[0,1/0],o=[[-1/0,-1/0],[1/0,1/0]],l=250,a=Om,c=oi("start","zoom","end"),u,h,f,d=500,m=150,p=0,g=10;function _(I){I.property("__zoom",Bl).on("wheel.zoom",E,{passive:!1}).on("mousedown.zoom",x).on("dblclick.zoom",L).filter(r).on("touchstart.zoom",O).on("touchmove.zoom",F).on("touchend.zoom touchcancel.zoom",R).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}_.transform=function(I,U,P,G){var V=I.selection?I.selection():I;V.property("__zoom",Bl),I!==V?k(I,U,P,G):V.interrupt().each(function(){T(this,arguments).event(G).start().zoom(null,typeof U=="function"?U.apply(this,arguments):U).end()})},_.scaleBy=function(I,U,P,G){_.scaleTo(I,function(){var V=this.__zoom.k,q=typeof U=="function"?U.apply(this,arguments):U;return V*q},P,G)},_.scaleTo=function(I,U,P,G){_.transform(I,function(){var V=e.apply(this,arguments),q=this.__zoom,J=P==null?w(V):typeof P=="function"?P.apply(this,arguments):P,ue=q.invert(J),ce=typeof U=="function"?U.apply(this,arguments):U;return n(C(S(q,ce),J,ue),V,o)},P,G)},_.translateBy=function(I,U,P,G){_.transform(I,function(){return n(this.__zoom.translate(typeof U=="function"?U.apply(this,arguments):U,typeof P=="function"?P.apply(this,arguments):P),e.apply(this,arguments),o)},null,G)},_.translateTo=function(I,U,P,G,V){_.transform(I,function(){var q=e.apply(this,arguments),J=this.__zoom,ue=G==null?w(q):typeof G=="function"?G.apply(this,arguments):G;return n(cs.translate(ue[0],ue[1]).scale(J.k).translate(typeof U=="function"?-U.apply(this,arguments):-U,typeof P=="function"?-P.apply(this,arguments):-P),q,o)},G,V)};function S(I,U){return U=Math.max(s[0],Math.min(s[1],U)),U===I.k?I:new un(U,I.x,I.y)}function C(I,U,P){var G=U[0]-P[0]*I.k,V=U[1]-P[1]*I.k;return G===I.x&&V===I.y?I:new un(I.k,G,V)}function w(I){return[(+I[0][0]+ +I[1][0])/2,(+I[0][1]+ +I[1][1])/2]}function k(I,U,P,G){I.on("start.zoom",function(){T(this,arguments).event(G).start()}).on("interrupt.zoom end.zoom",function(){T(this,arguments).event(G).end()}).tween("zoom",function(){var V=this,q=arguments,J=T(V,q).event(G),ue=e.apply(V,q),ce=P==null?w(ue):typeof P=="function"?P.apply(V,q):P,we=Math.max(ue[1][0]-ue[0][0],ue[1][1]-ue[0][1]),fe=V.__zoom,Fe=typeof U=="function"?U.apply(V,q):U,Ge=a(fe.invert(ce).concat(we/fe.k),Fe.invert(ce).concat(we/Fe.k));return function(he){if(he===1)he=Fe;else{var W=Ge(he),ee=we/W[2];he=new un(ee,ce[0]-W[0]*ee,ce[1]-W[1]*ee)}J.zoom(null,he)}})}function T(I,U,P){return!P&&I.__zooming||new N(I,U)}function N(I,U){this.that=I,this.args=U,this.active=0,this.sourceEvent=null,this.extent=e.apply(I,U),this.taps=0}N.prototype={event:function(I){return I&&(this.sourceEvent=I),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(I,U){return this.mouse&&I!=="mouse"&&(this.mouse[1]=U.invert(this.mouse[0])),this.touch0&&I!=="touch"&&(this.touch0[1]=U.invert(this.touch0[0])),this.touch1&&I!=="touch"&&(this.touch1[1]=U.invert(this.touch1[0])),this.that.__zoom=U,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(I){var U=mt(this.that).datum();c.call(I,this.that,new zg(I,{sourceEvent:this.sourceEvent,target:_,type:I,transform:this.that.__zoom,dispatch:c}),U)}};function E(I,...U){if(!t.apply(this,arguments))return;var P=T(this,U).event(I),G=this.__zoom,V=Math.max(s[0],Math.min(s[1],G.k*Math.pow(2,i.apply(this,arguments)))),q=bt(I);if(P.wheel)(P.mouse[0][0]!==q[0]||P.mouse[0][1]!==q[1])&&(P.mouse[1]=G.invert(P.mouse[0]=q)),clearTimeout(P.wheel);else{if(G.k===V)return;P.mouse=[q,G.invert(q)],ar(this),P.start()}_i(I),P.wheel=setTimeout(J,m),P.zoom("mouse",n(C(S(G,V),P.mouse[0],P.mouse[1]),P.extent,o));function J(){P.wheel=null,P.end()}}function x(I,...U){if(f||!t.apply(this,arguments))return;var P=I.currentTarget,G=T(this,U,!0).event(I),V=mt(I.view).on("mousemove.zoom",ce,!0).on("mouseup.zoom",we,!0),q=bt(I,P),J=I.clientX,ue=I.clientY;Wo(I.view),us(I),G.mouse=[q,this.__zoom.invert(q)],ar(this),G.start();function ce(fe){if(_i(fe),!G.moved){var Fe=fe.clientX-J,Ge=fe.clientY-ue;G.moved=Fe*Fe+Ge*Ge>p}G.event(fe).zoom("mouse",n(C(G.that.__zoom,G.mouse[0]=bt(fe,P),G.mouse[1]),G.extent,o))}function we(fe){V.on("mousemove.zoom mouseup.zoom",null),Yo(fe.view,G.moved),_i(fe),G.event(fe).end()}}function L(I,...U){if(t.apply(this,arguments)){var P=this.__zoom,G=bt(I.changedTouches?I.changedTouches[0]:I,this),V=P.invert(G),q=P.k*(I.shiftKey?.5:2),J=n(C(S(P,q),G,V),e.apply(this,U),o);_i(I),l>0?mt(this).transition().duration(l).call(k,J,G,I):mt(this).call(_.transform,J,G,I)}}function O(I,...U){if(t.apply(this,arguments)){var P=I.touches,G=P.length,V=T(this,U,I.changedTouches.length===G).event(I),q,J,ue,ce;for(us(I),J=0;J<G;++J)ue=P[J],ce=bt(ue,this),ce=[ce,this.__zoom.invert(ce),ue.identifier],V.touch0?!V.touch1&&V.touch0[2]!==ce[2]&&(V.touch1=ce,V.taps=0):(V.touch0=ce,q=!0,V.taps=1+!!u);u&&(u=clearTimeout(u)),q&&(V.taps<2&&(h=ce[0],u=setTimeout(function(){u=null},d)),ar(this),V.start())}}function F(I,...U){if(this.__zooming){var P=T(this,U).event(I),G=I.changedTouches,V=G.length,q,J,ue,ce;for(_i(I),q=0;q<V;++q)J=G[q],ue=bt(J,this),P.touch0&&P.touch0[2]===J.identifier?P.touch0[0]=ue:P.touch1&&P.touch1[2]===J.identifier&&(P.touch1[0]=ue);if(J=P.that.__zoom,P.touch1){var we=P.touch0[0],fe=P.touch0[1],Fe=P.touch1[0],Ge=P.touch1[1],he=(he=Fe[0]-we[0])*he+(he=Fe[1]-we[1])*he,W=(W=Ge[0]-fe[0])*W+(W=Ge[1]-fe[1])*W;J=S(J,Math.sqrt(he/W)),ue=[(we[0]+Fe[0])/2,(we[1]+Fe[1])/2],ce=[(fe[0]+Ge[0])/2,(fe[1]+Ge[1])/2]}else if(P.touch0)ue=P.touch0[0],ce=P.touch0[1];else return;P.zoom("touch",n(C(J,ue,ce),P.extent,o))}}function R(I,...U){if(this.__zooming){var P=T(this,U).event(I),G=I.changedTouches,V=G.length,q,J;for(us(I),f&&clearTimeout(f),f=setTimeout(function(){f=null},d),q=0;q<V;++q)J=G[q],P.touch0&&P.touch0[2]===J.identifier?delete P.touch0:P.touch1&&P.touch1[2]===J.identifier&&delete P.touch1;if(P.touch1&&!P.touch0&&(P.touch0=P.touch1,delete P.touch1),P.touch0)P.touch0[1]=this.__zoom.invert(P.touch0[0]);else if(P.end(),P.taps===2&&(J=bt(J,this),Math.hypot(h[0]-J[0],h[1]-J[1])<g)){var ue=mt(this).on("dblclick.zoom");ue&&ue.apply(this,arguments)}}}return _.wheelDelta=function(I){return arguments.length?(i=typeof I=="function"?I:dr(+I),_):i},_.filter=function(I){return arguments.length?(t=typeof I=="function"?I:dr(!!I),_):t},_.touchable=function(I){return arguments.length?(r=typeof I=="function"?I:dr(!!I),_):r},_.extent=function(I){return arguments.length?(e=typeof I=="function"?I:dr([[+I[0][0],+I[0][1]],[+I[1][0],+I[1][1]]]),_):e},_.scaleExtent=function(I){return arguments.length?(s[0]=+I[0],s[1]=+I[1],_):[s[0],s[1]]},_.translateExtent=function(I){return arguments.length?(o[0][0]=+I[0][0],o[1][0]=+I[1][0],o[0][1]=+I[0][1],o[1][1]=+I[1][1],_):[[o[0][0],o[0][1]],[o[1][0],o[1][1]]]},_.constrain=function(I){return arguments.length?(n=I,_):n},_.duration=function(I){return arguments.length?(l=+I,_):l},_.interpolate=function(I){return arguments.length?(a=I,_):a},_.on=function(){var I=c.on.apply(c,arguments);return I===c?_:I},_.clickDistance=function(I){return arguments.length?(p=(I=+I)*I,_):Math.sqrt(p)},_.tapDistance=function(I){return arguments.length?(g=+I,_):g},_}function Bg(t,e,n=null,i,r=null){const s=mt(t);s.selectAll("*").remove();const o=s.node(),l=o.getBoundingClientRect();let a=l.width||800,c=l.height||600;const u=a/2,h=c/2,f=s.append("canvas").attr("class","network-canvas").attr("width",a).attr("height",c).style("width",a+"px").style("height",c+"px").style("cursor","default"),d=f.node().getContext("2d",{alpha:!1});let m=cs;const p=new Set,g={current:null};function _(){const O=o.getBoundingClientRect(),F=O.width||800,R=O.height||600;(F!==a||R!==c)&&(a=F,c=R,f.attr("width",a).attr("height",c).style("width",a+"px").style("height",c+"px"),L())}const S=new ResizeObserver(_);S.observe(o);const C=Ml(e).force("link",Il(n).id(O=>O.id).distance(O=>O.distance)).force("charge",Al().strength(-250)).force("center",wl(u,h).strength(.7)).force("collide",El(O=>O.radius+10).strength(.5)).force("x",Tl(u).strength(.025)).force("y",Nl(h).strength(.025)).alphaDecay(.05).velocityDecay(.6);let w=null;C.on("tick",()=>{w||(w=requestAnimationFrame(()=>{L(),w=null}))}),C.tick(100);for(let O=0;O<100;O++)C.tick();C.alphaTarget(0);const k=qg({canvas:f,nodes:e,transform:()=>m,hoveredNode:g,onSelectionChange:(O,F)=>{p.clear(),O.forEach(I=>p.add(I));const R=Wg(e,O,F);i(R),L()},render:()=>L()}),T=ql().scaleExtent([.1,10]).filter(O=>!k.isSelectionMode()||O.type==="wheel").on("zoom",({transform:O})=>{m=O,L()});f.call(T);const{dragstarted:N,dragged:E,dragended:x}=Kg(f,e,C,()=>m,g,()=>!k.isSelectionMode(),L);k.setupInteractions(f,{start:N,drag:E,end:x});function L(){d.save(),d.fillRect(0,0,a,c),d.translate(m.x,m.y),d.scale(m.k,m.k),d.strokeStyle="#8a8a8a",d.lineWidth=1/m.k,n.forEach(F=>{const R=F.source.x,I=F.source.y,U=F.target.x,P=F.target.y;d.globalAlpha=Math.max(.2,F.strength),d.lineWidth=F.width/m.k,d.beginPath(),d.moveTo(R,I),d.lineTo(U,P),d.stroke()}),d.globalAlpha=1,e.forEach(F=>{const R=p.has(F.id);d.fillStyle=F.color,d.beginPath(),d.arc(F.x,F.y,F.radius,0,2*Math.PI),d.fill(),R&&(d.strokeStyle="#0f2bff",d.lineWidth=3/m.k,d.stroke())});const O=k.getSelectionRect();if(O){d.strokeStyle="#0f2bff",d.fillStyle="rgba(15, 43, 255, 0.2)",d.lineWidth=2/m.k;const F=Math.min(O.x1,O.x2),R=Math.min(O.y1,O.y2),I=Math.abs(O.x2-O.x1),U=Math.abs(O.y2-O.y1);d.fillRect(F,R,I,U),d.strokeRect(F,R,I,U)}d.restore()}return L(),{destroy:()=>{w&&cancelAnimationFrame(w),C.stop(),S.disconnect(),f.remove()},toggleSelectionMode:()=>{const O=k.toggleSelectionMode();return r&&r(O),L(),O}}}function qg(t){const{canvas:e,nodes:n,transform:i,hoveredNode:r,onSelectionChange:s,render:o}=t,l=new Set,a=[];let c=!1,u=null;function h(){return c=!c,e.style("cursor",c?"crosshair":"default"),c}function f(p){if(l.has(p)){l.delete(p);const g=a.indexOf(p);g>-1&&a.splice(g,1)}else l.add(p),a.push(p);s(l,a)}function d(p,g){const _=i(),S=(p-_.x)/_.k,C=(g-_.y)/_.k;for(let w=n.length-1;w>=0;w--){const k=n[w],T=S-k.x,N=C-k.y;if(Math.sqrt(T*T+N*N)<k.radius)return k}return null}function m(p,g){let _=null;p.on("mousedown",function(S){const[C,w]=bt(S),k=d(C,w);if(c){const T=i(),N=(C-T.x)/T.k,E=(w-T.y)/T.k;u={x1:N,y1:E,x2:N,y2:E},o()}else k&&(_=k,g.start(S,k))}),p.on("mousemove",function(S){const[C,w]=bt(S);if(c){if(u){const k=i(),T=(C-k.x)/k.k,N=(w-k.y)/k.k;u.x2=T,u.y2=N,o()}}else if(_)g.drag(S,_,C,w);else{const k=d(C,w);r.current!==k&&(r.current=k,p.style("cursor",k?"pointer":"default"),o())}}),p.on("mouseup",function(S){if(c){if(u){const C=Math.min(u.x1,u.x2),w=Math.min(u.y1,u.y2),k=Math.max(u.x1,u.x2),T=Math.max(u.y1,u.y2);l.clear(),a.length=0;const N=[];n.forEach(E=>{E.x>=C&&E.x<=k&&E.y>=w&&E.y<=T&&N.push({id:E.id,y:E.y})}),N.sort((E,x)=>E.y-x.y),N.forEach(({id:E})=>{l.add(E),a.push(E)}),s(l,a),u=null,o()}}else if(_)g.end(S,_),_=null;else{const[C,w]=bt(S),k=d(C,w);k&&f(k.id)}})}return{toggleSelectionMode:h,isSelectionMode:()=>c,setupInteractions:m,getSelectionRect:()=>u}}function Kg(t,e,n,i,r,s,o){let l=null;function a(h,f){s()&&(h.active||n.alphaTarget(.3).restart(),l=f,f.fx=f.x,f.fy=f.y)}function c(h,f,d,m){if(!l||!s())return;const p=i();f.fx=(d-p.x)/p.k,f.fy=(m-p.y)/p.k,o()}function u(h,f){!l||!s()||(h.active||n.alphaTarget(0),f.fx=null,f.fy=null,l=null)}return{dragstarted:a,dragged:c,dragended:u}}function Wg(t,e,n){const i=new Map(t.map(r=>[r.id,r]));return n.map(r=>i.get(r)).filter(Boolean)}const Kl=8,Yg=1.5,Gg=50,Wl=.5,Xg=800,Jg=600;function Qg(t,e,n=null,i=null,r=null){const s=Xg/2,o=Jg/2,a=mt(t).append("svg").attr("class","network-svg"),c=a.append("g"),u=c.append("g").selectAll("line").data(n).join("line").attr("class","link").attr("stroke-width",m=>m.width||Yg).attr("stroke-opacity",m=>Math.max(.2,m.strength||Wl)),h=c.append("g").selectAll("circle").data(e).join("circle").attr("class","node").attr("r",m=>m.radius||Kl).attr("fill",m=>m.color);h.append("title").text(m=>m.label);const f=Ml(e).force("link",Il(n).id(m=>m.id).distance(m=>m.distance||Gg)).force("charge",Al().strength(-250)).force("center",wl(s,o).strength(.7)).force("collide",El(m=>(m.radius||Kl)+10).strength(Wl)).force("x",Tl(s).strength(.025)).force("y",Nl(o).strength(.025));let d=null;if(i){d=Zg({svg:a,g:c,nodes:e,onSelectionChange:(_,S)=>{h.classed("selected",w=>_.has(w.id));const C=t_(e,_,S);i(C)}}),a.call(ql().scaleExtent([.1,10]).filter(_=>!d.isSelectionMode()||_.type==="wheel").on("zoom",({transform:_})=>c.attr("transform",_)));const{dragstarted:m,dragged:p,dragended:g}=e_(f,u,h);d.setupNodeClick(h),d.setupDrag(h,{start:m,drag:p,end:g})}return{destroy:()=>{f.stop(),a.remove()},toggleSelectionMode:()=>{if(d){const m=d.toggleSelectionMode();return r&&r(m),m}}}}function Zg(t){const{svg:e,g:n,nodes:i,onSelectionChange:r,getNodePosition:s=p=>({x:p.x,y:p.y}),getNodeId:o=p=>p.id}=t,l=new Set,a=[];let c=!1;function u(){return c=!c,e.style("cursor",c?"crosshair":"default"),c}function h(p){if(l.has(p)){l.delete(p);const g=a.indexOf(p);g>-1&&a.splice(g,1)}else l.add(p),a.push(p);r(l,a)}function f(){l.clear(),a.length=0,r(l,a)}let d=null,m=null;return e.on("mousedown",function(p){if(!c)return;p.preventDefault();const[g,_]=bt(p,n.node());d={x:g,y:_},m=n.append("rect").attr("class","selection-rect").attr("x",g).attr("y",_).attr("width",0).attr("height",0)}).on("mousemove",function(p){if(!c||!m)return;const[g,_]=bt(p,n.node()),S=g-d.x,C=_-d.y;m.attr("x",S<0?g:d.x).attr("y",C<0?_:d.y).attr("width",Math.abs(S)).attr("height",Math.abs(C))}).on("mouseup",function(p){if(!c||!m)return;const[g,_]=bt(p,n.node()),S=Math.min(d.x,g),C=Math.min(d.y,_),w=Math.max(d.x,g),k=Math.max(d.y,_);l.clear(),a.length=0;const T=[];i.forEach(N=>{const E=s(N);E.x>=S&&E.x<=w&&E.y>=C&&E.y<=k&&T.push({id:o(N),y:E.y})}),T.sort((N,E)=>N.y-E.y),T.forEach(({id:N})=>{l.add(N),a.push(N)}),r(l,a),m.remove(),m=null,d=null}),{toggleSelectionMode:u,toggleNode:h,clearSelection:f,isSelectionMode:()=>c,getSelectedNodes:()=>l,getSelectionOrder:()=>a,setupNodeClick:p=>{p.on("click",function(g,_){g.stopPropagation(),h(o(_))})},setupDrag:(p,g)=>{p.call(im().filter(()=>!c).on("start",g.start).on("drag",g.drag).on("end",g.end))}}}function e_(t,e,n){t.on("tick",()=>{e.attr("x1",o=>o.source.x).attr("y1",o=>o.source.y).attr("x2",o=>o.target.x).attr("y2",o=>o.target.y),n.attr("cx",o=>o.x).attr("cy",o=>o.y)});function i(o){o.active||t.alphaTarget(.3).restart(),o.subject.fx=o.subject.x,o.subject.fy=o.subject.y}function r(o){o.subject.fx=o.x,o.subject.fy=o.y}function s(o){o.active||t.alphaTarget(0),o.subject.fx=null,o.subject.fy=null}return{dragstarted:i,dragged:r,dragended:s}}function t_(t,e,n){const i=new Map(t.map(r=>[r.id,r]));return n.map(r=>i.get(r)).filter(Boolean)}const n_="modulepreload",i_=function(t){return"/"+t},Yl={},fs=function(e,n,i){return e()};function ds(t){const{type:e,modelName:n,title:i,extractMeta:r=d=>d}=t,s={id:null,type:e,title:i,selected:{}},o=JSON.parse(localStorage.getItem(e))||s,l=Ne(o),a=Ne(!1);function c(d,m=!1){a.set(m),localStorage.setItem(e,JSON.stringify(d))}function u(){l.update(d=>{if(e!=="documentSet")return console.error("Document set management is the only type currently supported for saving."),d;const m=Object.fromEntries(Object.entries(d.selected).map(([g,_])=>[g,Object.keys(_)])),p=d.id?`${d.id}/edit`:"new";return fetch(`${window.location.origin}/${n}/${p}`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":vn},body:JSON.stringify({title:d.title,selection:d,...m})}).then(g=>g.json()).then(g=>{if(!(g!=null&&g.document_set_id))throw new Error("Failed to save");l.update(_=>(_.id=g.document_set_id,_.title=g.document_set_title,c(_,!0),_))}).catch(g=>console.error("Error:",g)),d})}const h=d=>l.update(()=>{const m=d.selection.id?d.selection:{...d.selection,id:d.id};return c(m),m}),f=()=>l.update(()=>{const d={...s,selected:{}};return c(d),d});return{type:e,subscribe:l.subscribe,add:d=>l.update(m=>(m.selected[d.class]={...m.selected[d.class]||{},[d.id]:r(d)},c(m),m)),addAll:d=>l.update(m=>(d.forEach(p=>{m.selected[p.class]={...m.selected[p.class]||{},[p.id]:r(p)}}),c(m),m)),remove:(d,m)=>l.update(p=>{const{[d]:g,..._}=p.selected[m];return p.selected[m]=_,c(p),p}),removeAll:(d,m)=>l.update(p=>(d.forEach(g=>{var _;return(_=p.selected[m])==null?!0:delete _[g]}),c(p),p)),toggle:d=>l.update(m=>{var p;if((p=m.selected[d.class])!=null&&p[d.id]){const{[d.id]:g,..._}=m.selected[d.class];m.selected[d.class]=_}else m.selected[d.class]={...m.selected[d.class]||{},[d.id]:r(d)};return c(m),m}),toggleSet:d=>{vt(l).id===d.id?f():h(d)},empty:()=>l.update(d=>(d.id=null,d.title=i,d.selected={},c(d,!0),d)),updateTitle:d=>l.update(m=>(m.title=d,c(m,!0),m)),save:u,isSaved:a,selection:l,selectionTitle:dt(l,d=>d.title),isSelected:dt(l,d=>m=>{var p;return((p=d.selected[m.class])==null?void 0:p[m.id])||!1}),selected:dt(l,d=>d.selected),nbSelected:dt(l,d=>Object.values(d.selected).reduce((m,p)=>m+Object.keys(p).length,0)),isSetSelected:dt(l,d=>m=>d.id===m.id)}}ds({type:"documentSet",modelName:"document-set",title:B==="en"?"Document set":"Set de documents",extractMeta:t=>({title:t.title,url:t.url})});const r_=ds({type:"regionsSet",modelName:"regions-set",title:B==="en"?"Regions set":"Set de régions",extractMeta:t=>t});function s_(t){const[e,...n]=t.split("_");return n.join("_")}const hr=ds({type:"clusterSet",modelName:"cluster-set",title:B==="en"?"Selected regions":"Régions sélectionnées",extractMeta:t=>({imgRef:t.id,clusterId:t.clusterId,title:t.title,xywh:t.xywh,img:s_(t.id)})});function o_(){const t=`${window.location.origin}${window.location.pathname}`,e=Ne(1),n=Ne({}),i=Ne({}),r=Ne("");Ar(e,"p");function s(u){r.update(h=>{const f=h===u?"":u;return navigator.clipboard.writeText(f).then(d=>""),f})}const o=(async()=>{try{const u=await fetch(`${t}canvas`);if(!u.ok)return{};const h=await u.json();let f={};return Object.values(h).forEach(d=>{Object.entries(d).forEach(([m,p])=>{f[m]=p})}),n.set(f),h}catch{return{}}})(),l=dt(e,u=>(async()=>{const f=await(await fetch(`${t}canvas?p=${u}`)).json();return i.set(f),f})());function a(u){Tr(u,e,"p")}function c(u){n.update(h=>(delete h[u],{...h})),i.update(h=>{for(const f in h)if(h[f][u]){const{[u]:d,...m}=h[f];return h[f]=m,h}return h})}return{currentPage:e,pageRegions:i,allRegions:n,fetchPages:l,fetchAll:o,handlePageUpdate:a,remove:c,clipBoard:r,copyRef:s}}const Gl=o_(),ib="";function l_(t){let e;return{c(){e=Wt("path"),v(e,"d","M384 336H192c-8.8 0-16-7.2-16-16V64c0-8.8 7.2-16 16-16l140.1 0L400 115.9V320c0 8.8-7.2 16-16 16zM192 384H384c35.3 0 64-28.7 64-64V115.9c0-12.7-5.1-24.9-14.1-33.9L366.1 14.1c-9-9-21.2-14.1-33.9-14.1H192c-35.3 0-64 28.7-64 64V320c0 35.3 28.7 64 64 64zM64 128c-35.3 0-64 28.7-64 64V448c0 35.3 28.7 64 64 64H256c35.3 0 64-28.7 64-64V416H272v32c0 8.8-7.2 16-16 16H64c-8.8 0-16-7.2-16-16V192c0-8.8 7.2-16 16-16H96V128H64z"),v(e,"class","svelte-1829hp2")},m(n,i){z(n,e,i)},d(n){n&&$(e)}}}function a_(t){let e;return{c(){e=Wt("path"),v(e,"d","M208 0H332.1c12.7 0 24.9 5.1 33.9 14.1l67.9 67.9c9 9 14.1 21.2 14.1 33.9V336c0 26.5-21.5 48-48 48H208c-26.5 0-48-21.5-48-48V48c0-26.5 21.5-48 48-48zM48 128h80v64H64V448H256V416h64v48c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V176c0-26.5 21.5-48 48-48z"),v(e,"class","svelte-1829hp2")},m(n,i){z(n,e,i)},d(n){n&&$(e)}}}function c_(t){let e=B==="en"?"Copy ID":"Copier l'ID",n;return{c(){n=re(e)},m(i,r){z(i,n,r)},p:te,d(i){i&&$(n)}}}function u_(t){let e=B==="en"?"Copied!":"Copié !",n;return{c(){n=re(e)},m(i,r){z(i,n,r)},p:te,d(i){i&&$(n)}}}function Xl(t){let e,n,i;var r=t[7];function s(o){return{props:{mainImgItem:o[1],compareImgItem:o[14]}}}return r&&(e=xi(r,s(t))),{c(){e&&ve(e.$$.fragment),n=Ct()},m(o,l){e&&ge(e,o,l),z(o,n,l),i=!0},p(o,l){const a={};if(l&2&&(a.mainImgItem=o[1]),l&128&&r!==(r=o[7])){if(e){tt();const c=e;K(c.$$.fragment,1,0,()=>{_e(c,1)}),nt()}r?(e=xi(r,s(o)),ve(e.$$.fragment),H(e.$$.fragment,1),ge(e,n.parentNode,n)):e=null}else r&&e.$set(a)},i(o){i||(e&&H(e.$$.fragment,o),i=!0)},o(o){e&&K(e.$$.fragment,o),i=!1},d(o){o&&$(n),e&&_e(e,o)}}}function f_(t){let e,n,i,r,s,o,l,a,c,u,h,f,d,m,p,g,_,S,C,w,k,T,N;function E(U,P){return U[8]?a_:l_}let x=E(t),L=x(t);function O(U,P){return U[8]?u_:c_}let F=O(t),R=F(t),I=t[7]&&Xl(t);return{c(){e=b("div"),n=b("figure"),i=b("img"),s=j(),o=b("div"),l=b("span"),u=j(),h=b("div"),f=b("button"),d=Wt("svg"),L.c(),m=j(),p=b("span"),R.c(),_=j(),I&&I.c(),v(i,"class","region-img svelte-1829hp2"),At(i.src,r=t[9])||v(i,"src",r),v(i,"alt","Extracted region"),v(l,"class","overlay-desc"),v(o,"class","overlay is-center svelte-1829hp2"),v(n,"class",a="image card region-image "+(t[0]?"is-96x96":"")+" svelte-1829hp2"),v(n,"tabindex","-1"),v(n,"style",c=(t[2]==="full"?"height: 100%":`height: ${t[2]}px; min-width: ${t[2]}px`)+"; "+(t[3]?`border: 5px solid ${t[3]};`:"")),v(d,"xmlns","http://www.w3.org/2000/svg"),v(d,"viewBox","0 0 384 512"),v(d,"class","svelte-1829hp2"),v(p,"class","tooltip svelte-1829hp2"),v(f,"class","button tag svelte-1829hp2"),v(f,"style",g=t[6]?"":"display: none;"),v(h,"class","region-btn ml-1 svelte-1829hp2"),v(e,"class",S="region is-center "+(t[5]&&t[11](t[1])?"checked":"")+" svelte-1829hp2"),v(e,"style",C=t[2]==="full"?"height: 100%":"")},m(U,P){z(U,e,P),y(e,n),y(n,i),y(n,s),y(n,o),y(o,l),l.innerHTML=t[10],y(e,u),y(e,h),y(h,f),y(f,d),L.m(d,null),y(f,m),y(f,p),R.m(p,null),y(h,_),I&&I.m(h,null),k=!0,T||(N=[Ce(n,"click",t[19]),Ce(n,"keyup",d_),Ce(f,"click",t[20])],T=!0)},p(U,[P]){t=U,(!k||P&512&&!At(i.src,r=t[9]))&&v(i,"src",r),(!k||P&1024)&&(l.innerHTML=t[10]),(!k||P&1&&a!==(a="image card region-image "+(t[0]?"is-96x96":"")+" svelte-1829hp2"))&&v(n,"class",a),(!k||P&12&&c!==(c=(t[2]==="full"?"height: 100%":`height: ${t[2]}px; min-width: ${t[2]}px`)+"; "+(t[3]?`border: 5px solid ${t[3]};`:"")))&&v(n,"style",c),x!==(x=E(t))&&(L.d(1),L=x(t),L&&(L.c(),L.m(d,null))),F===(F=O(t))&&R?R.p(t,P):(R.d(1),R=F(t),R&&(R.c(),R.m(p,null))),(!k||P&64&&g!==(g=t[6]?"":"display: none;"))&&v(f,"style",g),t[7]?I?(I.p(t,P),P&128&&H(I,1)):(I=Xl(t),I.c(),H(I,1),I.m(h,null)):I&&(tt(),K(I,1,1,()=>{I=null}),nt()),(!k||P&2082&&S!==(S="region is-center "+(t[5]&&t[11](t[1])?"checked":"")+" svelte-1829hp2"))&&v(e,"class",S),(!k||P&4&&C!==(C=t[2]==="full"?"height: 100%":""))&&v(e,"style",C)},i(U){k||(H(I),jt(()=>{k&&(w||(w=_n(e,Un,{duration:t[15]},!0)),w.run(1))}),k=!0)},o(U){K(I),w||(w=_n(e,Un,{duration:t[15]},!1)),w.run(0),k=!1},d(U){U&&$(e),L.d(),R.d(),I&&I.d(),U&&w&&w.end(),T=!1,yt(N)}}}const d_=()=>null;function h_(t,e,n){let i,r,s,o,l,{selectionStore:a}=e;a||(a=r_);const{isSelected:c}=a;xe(t,c,x=>n(11,l=x));const{clipBoard:u}=Gl;xe(t,u,x=>n(18,o=x));let{item:h}=e,{descPromise:f=void 0}=e,{isSquare:d=!0}=e,{height:m=d?96:140}=e;m==="full"&&(d=!1);let{borderColor:p=null}=e,{toggleSelection:g=a.toggle}=e;const _=zt("qImgMetadata")||void 0,S=zt("isInModal")||!1,C=S?0:500;let w;S||fs(()=>Promise.resolve().then(()=>m1),void 0).then(x=>n(7,w=x.default));let{selectable:k=!S}=e,{copyable:T=!0}=e;const N=()=>k?g(h):null,E=()=>T?Gl.copyRef(h.ref):null;return t.$$set=x=>{"selectionStore"in x&&n(16,a=x.selectionStore),"item"in x&&n(1,h=x.item),"descPromise"in x&&n(17,f=x.descPromise),"isSquare"in x&&n(0,d=x.isSquare),"height"in x&&n(2,m=x.height),"borderColor"in x&&n(3,p=x.borderColor),"toggleSelection"in x&&n(4,g=x.toggleSelection),"selectable"in x&&n(5,k=x.selectable),"copyable"in x&&n(6,T=x.copyable)},t.$$.update=()=>{t.$$.dirty&2&&n(10,i=h.title),t.$$.dirty&131072&&f&&f.then(x=>n(10,i=x)),t.$$.dirty&7&&n(9,r=Kt(h.img??h.ref,h.xywh,m==="full"?m:d?`${m},`:`,${m}`)),t.$$.dirty&262146&&n(8,s=h.ref===o)},[d,h,m,p,g,k,T,w,s,r,i,l,c,u,_,C,a,f,o,N,E]}class Jn extends Ve{constructor(e){super(),He(this,e,h_,f_,ze,{selectionStore:16,item:1,descPromise:17,isSquare:0,height:2,borderColor:3,toggleSelection:4,selectable:5,copyable:6})}}const rb="";function Jl(t,e,n){const i=t.slice();return i[11]=e[n],i}function Ql(t,e,n){const i=t.slice();return i[14]=e[n],i}function hs(t){const e=t.slice(),n=e[2].get(e[11][e[14]].id);return e[17]=n,e}function Zl(t,e,n){const i=t.slice();return i[14]=e[n],i}function ea(t){let e,n,i,r,s,o,l,a,c,u,h=t[0].regions,f=[];for(let _=0;_<h.length;_+=1)f[_]=ta(Zl(t,h,_));const d=_=>K(f[_],1,1,()=>{f[_]=null});let m=t[0].rows,p=[];for(let _=0;_<m.length;_+=1)p[_]=ra(Jl(t,m,_));const g=_=>K(p[_],1,1,()=>{p[_]=null});return{c(){e=b("div"),n=b("h3"),n.textContent="Aligned Documents",i=j(),r=b("div"),s=b("table"),o=b("thead"),l=b("tr");for(let _=0;_<f.length;_+=1)f[_].c();a=j(),c=b("tbody");for(let _=0;_<p.length;_+=1)p[_].c();v(n,"class","title is-5"),v(o,"class","region-header svelte-1hxxzoa"),v(s,"class","table is-fullwidth svelte-1hxxzoa"),v(r,"class","table-container svelte-1hxxzoa"),v(e,"class","box mt-4")},m(_,S){z(_,e,S),y(e,n),y(e,i),y(e,r),y(r,s),y(s,o),y(o,l);for(let C=0;C<f.length;C+=1)f[C]&&f[C].m(l,null);y(s,a),y(s,c);for(let C=0;C<p.length;C+=1)p[C]&&p[C].m(c,null);u=!0},p(_,S){if(S&3){h=_[0].regions;let C;for(C=0;C<h.length;C+=1){const w=Zl(_,h,C);f[C]?(f[C].p(w,S),H(f[C],1)):(f[C]=ta(w),f[C].c(),H(f[C],1),f[C].m(l,null))}for(tt(),C=h.length;C<f.length;C+=1)d(C);nt()}if(S&77){m=_[0].rows;let C;for(C=0;C<m.length;C+=1){const w=Jl(_,m,C);p[C]?(p[C].p(w,S),H(p[C],1)):(p[C]=ra(w),p[C].c(),H(p[C],1),p[C].m(c,null))}for(tt(),C=m.length;C<p.length;C+=1)g(C);nt()}},i(_){if(!u){for(let S=0;S<h.length;S+=1)H(f[S]);for(let S=0;S<m.length;S+=1)H(p[S]);u=!0}},o(_){f=f.filter(Boolean);for(let S=0;S<f.length;S+=1)K(f[S]);p=p.filter(Boolean);for(let S=0;S<p.length;S+=1)K(p[S]);u=!1},d(_){_&&$(e),wt(f,_),wt(p,_)}}}function ta(t){let e,n,i,r;return n=new eo({props:{id:t[14],meta:t[1].get(t[14])||{},clickable:!1}}),{c(){e=b("th"),ve(n.$$.fragment),i=j(),v(e,"class","is-vcentered")},m(s,o){z(s,e,o),ge(n,e,null),y(e,i),r=!0},p(s,o){const l={};o&1&&(l.id=s[14]),o&3&&(l.meta=s[1].get(s[14])||{}),n.$set(l)},i(s){r||(H(n.$$.fragment,s),r=!0)},o(s){K(n.$$.fragment,s),r=!1},d(s){s&&$(e),_e(n)}}}function na(t){let e,n,i,r,s=t[11][t[14]].page+"",o,l;return e=new Jn({props:{item:t[17],selectable:!1,copyable:!1,borderColor:t[6](t[11][t[14]],t[3]),isSquare:!1}}),{c(){ve(e.$$.fragment),n=j(),i=b("div"),r=re("Page "),o=re(s),v(i,"class","has-text-grey-dark mt-2")},m(a,c){ge(e,a,c),z(a,n,c),z(a,i,c),y(i,r),y(i,o),l=!0},p(a,c){const u={};c&5&&(u.item=a[17]),c&9&&(u.borderColor=a[6](a[11][a[14]],a[3])),e.$set(u),(!l||c&1)&&s!==(s=a[11][a[14]].page+"")&&je(o,s)},i(a){l||(H(e.$$.fragment,a),l=!0)},o(a){K(e.$$.fragment,a),l=!1},d(a){_e(e,a),a&&$(n),a&&$(i)}}}function ia(t){let e,n,i=t[11][t[14]]&&na(hs(t));return{c(){e=b("td"),i&&i.c(),v(e,"class","has-text-centered"),We(e,"vertical-align","top")},m(r,s){z(r,e,s),i&&i.m(e,null),n=!0},p(r,s){r[11][r[14]]?i?(i.p(hs(r),s),s&1&&H(i,1)):(i=na(hs(r)),i.c(),H(i,1),i.m(e,null)):i&&(tt(),K(i,1,1,()=>{i=null}),nt())},i(r){n||(H(i),n=!0)},o(r){K(i),n=!1},d(r){r&&$(e),i&&i.d()}}}function ra(t){let e,n,i,r=t[0].regions,s=[];for(let l=0;l<r.length;l+=1)s[l]=ia(Ql(t,r,l));const o=l=>K(s[l],1,1,()=>{s[l]=null});return{c(){e=b("tr");for(let l=0;l<s.length;l+=1)s[l].c();n=j()},m(l,a){z(l,e,a);for(let c=0;c<s.length;c+=1)s[c]&&s[c].m(e,null);y(e,n),i=!0},p(l,a){if(a&77){r=l[0].regions;let c;for(c=0;c<r.length;c+=1){const u=Ql(l,r,c);s[c]?(s[c].p(u,a),H(s[c],1)):(s[c]=ia(u),s[c].c(),H(s[c],1),s[c].m(e,n))}for(tt(),c=r.length;c<s.length;c+=1)o(c);nt()}},i(l){if(!i){for(let a=0;a<r.length;a+=1)H(s[a]);i=!0}},o(l){s=s.filter(Boolean);for(let a=0;a<s.length;a+=1)K(s[a]);i=!1},d(l){l&&$(e),wt(s,l)}}}function m_(t){let e,n,i=t[0]&&ea(t);return{c(){i&&i.c(),e=Ct()},m(r,s){i&&i.m(r,s),z(r,e,s),n=!0},p(r,[s]){r[0]?i?(i.p(r,s),s&1&&H(i,1)):(i=ea(r),i.c(),H(i,1),i.m(e.parentNode,e)):i&&(tt(),K(i,1,1,()=>{i=null}),nt())},i(r){n||(H(i),n=!0)},o(r){K(i),n=!1},d(r){i&&i.d(r),r&&$(e)}}}function p_(t){let e=0;for(let o=0;o<t.length;o++)e=t.charCodeAt(o)+((e<<5)-e),e=e&e;const i=e*.618033988749895%1*360,r=65+e%20,s=80+e%10;return`hsl(${Math.floor(i)}, ${r}%, ${s}%)`}function g_(t,e,n){let i,r,s,{selectedDocuments:o=[]}=e,{documentSetStore:l}=e;const{buildAlignedImageMatrix:a,documentNodes:c,imageNodes:u}=l;xe(t,c,m=>n(1,r=m)),xe(t,u,m=>n(2,s=m));let h=null;function f(m,p){if(!m)return;const g=m.id;if(p.get(g)!==1)return d.has(g)||d.set(g,p_(g)),d.get(g)}const d=new Map;return t.$$set=m=>{"selectedDocuments"in m&&n(7,o=m.selectedDocuments),"documentSetStore"in m&&n(8,l=m.documentSetStore)},t.$$.update=()=>{if(t.$$.dirty&134)if(o.length>0&&s&&r){const m=o.map(p=>p.id);n(0,h=a(m))}else n(0,h=null);t.$$.dirty&1&&n(3,i=h?(()=>{const m=new Map;return h.rows.forEach(p=>{Object.values(p).forEach(g=>{m.set(g.id,(m.get(g.id)||0)+1)})}),m})():new Map)},[h,r,s,i,c,u,f,o,l]}class __ extends Ve{constructor(e){super(),He(this,e,g_,m_,ze,{selectedDocuments:7,documentSetStore:8})}}const sb="";function sa(t,e,n){const i=t.slice();return i[15]=e[n],i}function v_(t){let e;return{c(){e=b("span"),e.innerHTML='<i class="fas fa-crop-alt"></i>',v(e,"class","icon px-4")},m(n,i){z(n,e,i)},d(n){n&&$(e)}}}function y_(t){let e;return{c(){e=b("span"),e.innerHTML='<i class="fas fa-hand-pointer"></i>',v(e,"class","icon px-4")},m(n,i){z(n,e,i)},d(n){n&&$(e)}}}function oa(t){let e,n,i,r;const s=[w_,b_],o=[];function l(a,c){return a[0]==="img"?0:a[0]==="doc"?1:-1}return~(e=l(t))&&(n=o[e]=s[e](t)),{c(){n&&n.c(),i=Ct()},m(a,c){~e&&o[e].m(a,c),z(a,i,c),r=!0},p(a,c){let u=e;e=l(a),e===u?~e&&o[e].p(a,c):(n&&(tt(),K(o[u],1,1,()=>{o[u]=null}),nt()),~e?(n=o[e],n?n.p(a,c):(n=o[e]=s[e](a),n.c()),H(n,1),n.m(i.parentNode,i)):n=null)},i(a){r||(H(n),r=!0)},o(a){K(n),r=!1},d(a){~e&&o[e].d(a),a&&$(i)}}}function b_(t){let e,n;return e=new __({props:{selectedDocuments:t[5],documentSetStore:t[1]}}),{c(){ve(e.$$.fragment)},m(i,r){ge(e,i,r),n=!0},p(i,r){const s={};r&32&&(s.selectedDocuments=i[5]),r&2&&(s.documentSetStore=i[1]),e.$set(s)},i(i){n||(H(e.$$.fragment,i),n=!0)},o(i){K(e.$$.fragment,i),n=!1},d(i){_e(e,i)}}}function w_(t){let e,n,i=B==="en"?"Selected regions":"Régions sélectionnées",r,s,o=t[5].length+"",l,a,c,u,h=[],f=new Map,d,m=t[5];const p=g=>g[15].id;for(let g=0;g<m.length;g+=1){let _=sa(t,m,g),S=p(_);f.set(S,h[g]=la(S,_))}return{c(){e=b("div"),n=b("h3"),r=re(i),s=re(" ("),l=re(o),a=re(")"),c=j(),u=b("div");for(let g=0;g<h.length;g+=1)h[g].c();v(n,"class","title is-5"),v(u,"class","selected-nodes grid is-gap-2 mt-5 svelte-1a3kdxu"),v(e,"class","selected-panel box mt-4 svelte-1a3kdxu")},m(g,_){z(g,e,_),y(e,n),y(n,r),y(n,s),y(n,l),y(n,a),y(e,c),y(e,u);for(let S=0;S<h.length;S+=1)h[S]&&h[S].m(u,null);d=!0},p(g,_){(!d||_&32)&&o!==(o=g[5].length+"")&&je(l,o),_&32&&(m=g[5],tt(),h=Pi(h,_,p,1,g,m,f,u,Cr,la,null,sa),nt())},i(g){if(!d){for(let _=0;_<m.length;_+=1)H(h[_]);d=!0}},o(g){for(let _=0;_<h.length;_+=1)K(h[_]);d=!1},d(g){g&&$(e);for(let _=0;_<h.length;_+=1)h[_].d()}}}function la(t,e){let n,i,r;return i=new Jn({props:{item:e[15],selectable:!1,copyable:!1}}),{key:t,first:null,c(){n=Ct(),ve(i.$$.fragment),this.first=n},m(s,o){z(s,n,o),ge(i,s,o),r=!0},p(s,o){e=s;const l={};o&32&&(l.item=e[15]),i.$set(l)},i(s){r||(H(i.$$.fragment,s),r=!0)},o(s){K(i.$$.fragment,s),r=!1},d(s){s&&$(n),_e(i,s)}}}function S_(t){let e,n,i,r=t[3]?"click":"selection",s,o,l,a,c,u,h,f;function d(_,S){return _[3]?y_:v_}let m=d(t),p=m(t),g=t[5].length>0&&oa(t);return{c(){e=b("div"),n=b("button"),p.c(),i=re(`
        Switch to `),s=re(r),o=re(" mode"),l=j(),a=b("div"),c=j(),g&&g.c(),v(n,"class","toggle-button button is-small is-link mb-3"),v(a,"class","visualization-container")},m(_,S){z(_,e,S),y(e,n),p.m(n,null),y(n,i),y(n,s),y(n,o),y(e,l),y(e,a),t[9](a),y(e,c),g&&g.m(e,null),u=!0,h||(f=Ce(n,"click",t[7]),h=!0)},p(_,[S]){m!==(m=d(_))&&(p.d(1),p=m(_),p&&(p.c(),p.m(n,i))),(!u||S&8)&&r!==(r=_[3]?"click":"selection")&&je(s,r),_[5].length>0?g?(g.p(_,S),S&32&&H(g,1)):(g=oa(_),g.c(),H(g,1),g.m(e,null)):g&&(tt(),K(g,1,1,()=>{g=null}),nt())},i(_){u||(H(g),u=!0)},o(_){K(g),u=!1},d(_){_&&$(e),p.d(),t[9](null),g&&g.d(),h=!1,f()}}}const k_=1e3;function E_(t,e,n){let i,r,s=te,o=()=>(s(),s=ki(i,w=>n(8,r=w)),i),l;t.$$.on_destroy.push(()=>s());let{type:a="img"}=e,{documentSetStore:c}=e;const{imageNetwork:u,documentNetwork:h,selectedNodes:f,updateSelectedNodes:d}=c;xe(t,f,w=>n(5,l=w));let m,p,g=!1;function _(){m&&(m.destroy(),d([]));function w(T){d(T)}m=(r.nodes.length<k_?Qg:Bg)(p,r.nodes,r.links,w,T=>{n(3,g=T)}),n(3,g=a==="img"),g&&m.toggleSelectionMode()}function S(){m&&n(3,g=m.toggleSelectionMode())}Dn(()=>{m==null||m.destroy()});function C(w){gn[w?"unshift":"push"](()=>{p=w,n(2,p)})}return t.$$set=w=>{"type"in w&&n(0,a=w.type),"documentSetStore"in w&&n(1,c=w.documentSetStore)},t.$$.update=()=>{t.$$.dirty&1&&o(n(4,i=a==="img"?u:h)),t.$$.dirty&260&&r&&p&&_()},[a,c,p,g,i,l,f,S,r,C]}class C_ extends Ve{constructor(e){super(),He(this,e,E_,S_,ze,{type:0,documentSetStore:1})}}const ob="",{Map:I_}=Xc;function aa(t,e,n){const i=t.slice();return i[61]=e[n],i}function ca(t,e,n){const i=t.slice();return i[61]=e[n],i}function ua(t,e,n){const i=t.slice();return i[66]=e[n],i}function fa(t,e,n){const i=t.slice();return i[69]=e[n],i}function x_(t){let e,n,i,r,s,o,l,a,c,u,h,f,d,m,p,g=t[22]("normalize")+"",_,S,C,w,k,T,N,E,x,L,O,F,R,I,U,P,G,V,q,J,ue=["col","row"],ce=[];for(let he=0;he<2;he+=1)ce[he]=ha(ua(t,ue,he));let we=t[2]&&ma(t);function fe(he,W){return he[2]?T_:A_}let Fe=fe(t),Ge=Fe(t);return{c(){e=b("div"),n=b("div"),i=b("div"),r=b("h4"),r.textContent=`${t[22]("title")}`,s=j(),o=b("div"),l=b("div"),a=b("div"),c=b("select"),u=b("option"),u.textContent=`${t[22]("byName")}`,h=b("option"),h.textContent=`${t[22]("byScore")}`,f=j(),d=b("label"),m=b("input"),p=j(),_=re(g),S=j(),C=b("div"),w=b("div"),k=b("div"),T=j();for(let he=0;he<2;he+=1)ce[he].c();N=j(),E=b("div"),x=j(),L=b("div"),O=j(),F=b("div"),R=b("div"),I=b("div"),U=b("h4"),U.textContent=`${t[22]("pageByPage")}`,P=j(),we&&we.c(),G=j(),V=b("div"),Ge.c(),v(r,"class","title is-6 mb-0"),u.__value="name",u.value=u.__value,h.__value="score",h.value=h.__value,t[3]===void 0&&jt(()=>t[36].call(c)),v(a,"class","select is-small"),v(l,"class","control"),v(m,"type","checkbox"),m.checked=t[8],v(d,"title",t[22]("normalization")),v(d,"class","checkbox is-size-7"),v(o,"class","is-flex is-align-items-center"),We(o,"gap","0.5rem"),v(i,"class","is-flex is-justify-content-space-between is-align-items-center mb-3"),We(i,"flex-wrap","wrap"),We(i,"gap","0.5rem"),v(k,"class","matrix-corner svelte-24wn30"),v(E,"class","matrix-canvas svelte-24wn30"),v(w,"class","matrix-grid svelte-24wn30"),We(w,"--cell-size",ba+"px"),v(C,"class","scroll-area svelte-24wn30"),v(n,"class","box panel-box svelte-24wn30"),v(e,"class","split-panel svelte-24wn30"),We(e,"width",t[13]+"px"),v(L,"class","split-divider svelte-24wn30"),v(L,"role","separator"),v(L,"tabindex","0"),v(U,"class","title is-6 mb-0"),v(I,"class","is-flex is-justify-content-space-between is-align-items-center mb-3"),v(V,"class","scroll-area svelte-24wn30"),v(R,"class","box panel-box svelte-24wn30"),v(F,"class","split-panel svelte-24wn30"),We(F,"width",t[12]+"px")},m(he,W){z(he,e,W),y(e,n),y(n,i),y(i,r),y(i,s),y(i,o),y(o,l),y(l,a),y(a,c),y(c,u),y(c,h),pn(c,t[3],!0),y(o,f),y(o,d),y(d,m),y(d,p),y(d,_),y(n,S),y(n,C),y(C,w),y(w,k),y(w,T);for(let ee=0;ee<2;ee+=1)ce[ee]&&ce[ee].m(w,null);y(w,N),y(w,E),t[38](E),z(he,x,W),z(he,L,W),z(he,O,W),z(he,F,W),y(F,R),y(R,I),y(I,U),y(I,P),we&&we.m(I,null),y(R,G),y(R,V),Ge.m(V,null),q||(J=[Ce(c,"change",t[36]),Ce(m,"change",t[37]),Ce(L,"mousedown",t[23]),Ce(L,"touchstart",t[23])],q=!0)},p(he,W){if(W[0]&8&&pn(c,he[3]),W[0]&256&&(m.checked=he[8]),W[0]&32){ue=["col","row"];let ee;for(ee=0;ee<2;ee+=1){const se=ua(he,ue,ee);ce[ee]?ce[ee].p(se,W):(ce[ee]=ha(se),ce[ee].c(),ce[ee].m(w,N))}for(;ee<2;ee+=1)ce[ee].d(1)}W[0]&8192&&We(e,"width",he[13]+"px"),he[2]?we?we.p(he,W):(we=ma(he),we.c(),we.m(I,null)):we&&(we.d(1),we=null),Fe===(Fe=fe(he))&&Ge?Ge.p(he,W):(Ge.d(1),Ge=Fe(he),Ge&&(Ge.c(),Ge.m(V,null))),W[0]&4096&&We(F,"width",he[12]+"px")},d(he){he&&$(e),wt(ce,he),t[38](null),he&&$(x),he&&$(L),he&&$(O),he&&$(F),we&&we.d(),Ge.d(),q=!1,yt(J)}}}function M_(t){let e;return{c(){e=b("div"),e.textContent=`${t[22]("noDocuments")}`,v(e,"class","notification is-info"),We(e,"width","100%")},m(n,i){z(n,e,i)},p:te,d(n){n&&$(e)}}}function da(t,e){let n,i,r;return{key:t,first:null,c(){n=b("div"),i=b("span"),v(i,"class","color-dot svelte-24wn30"),We(i,"background-color",e[69].color),v(i,"title",r=e[69].title+" "+Oi.Witness+" #"+e[69].witnessId),v(n,"class","header-cell svelte-24wn30"),this.first=n},m(s,o){z(s,n,o),y(n,i)},p(s,o){e=s,o[0]&32&&We(i,"background-color",e[69].color),o[0]&32&&r!==(r=e[69].title+" "+Oi.Witness+" #"+e[69].witnessId)&&v(i,"title",r)},d(s){s&&$(n)}}}function ha(t){let e,n=[],i=new I_,r=t[5].docs;const s=o=>o[69].id;for(let o=0;o<r.length;o+=1){let l=fa(t,r,o),a=s(l);i.set(a,n[o]=da(a,l))}return{c(){e=b("div");for(let o=0;o<n.length;o+=1)n[o].c();v(e,"class",t[66]+"-headers svelte-24wn30")},m(o,l){z(o,e,l);for(let a=0;a<n.length;a+=1)n[a]&&n[a].m(e,null)},p(o,l){l[0]&32&&(r=o[5].docs,n=Pi(n,l,s,1,o,r,i,e,uu,da,null,fa))},d(o){o&&$(e);for(let l=0;l<n.length;l+=1)n[l].d()}}}function ma(t){let e,n,i,r,s,o,l,a;return{c(){e=b("div"),n=b("div"),i=b("div"),r=b("select"),s=b("option"),s.textContent=`${t[22]("byPage")}`,o=b("option"),o.textContent=`${t[22]("byImage")}`,s.__value="page",s.value=s.__value,o.__value="image",o.value=o.__value,t[4]===void 0&&jt(()=>t[39].call(r)),v(i,"class","select is-small"),v(n,"class","control"),v(e,"class","field mb-0")},m(c,u){z(c,e,u),y(e,n),y(n,i),y(i,r),y(r,s),y(r,o),pn(r,t[4],!0),l||(a=Ce(r,"change",t[39]),l=!0)},p(c,u){u[0]&16&&pn(r,c[4])},d(c){c&&$(e),l=!1,a()}}}function A_(t){let e;return{c(){e=b("p"),e.textContent=`${t[22]("selectCell")}`,v(e,"class","has-text-grey is-size-7")},m(n,i){z(n,e,i)},p:te,d(n){n&&$(e)}}}function T_(t){let e;return{c(){e=b("div"),v(e,"class","scatter-container svelte-24wn30")},m(n,i){z(n,e,i),t[40](e)},p:te,d(n){n&&$(e),t[40](null)}}}function pa(t){let e,n,i,r,s,o,l,a=t[11].items,c=[];for(let d=0;d<a.length;d+=1)c[d]=ga(ca(t,a,d));let u=t[11].score!==void 0&&_a(t),h=t[11].items,f=[];for(let d=0;d<h.length;d+=1)f[d]=va(aa(t,h,d));return{c(){e=b("table"),n=b("thead"),i=b("tr");for(let d=0;d<c.length;d+=1)c[d].c();r=j(),s=b("tbody"),u&&u.c(),o=j(),l=b("tr");for(let d=0;d<f.length;d+=1)f[d].c();v(e,"class","table is-fullwidth p-3 has-text-centered")},m(d,m){z(d,e,m),y(e,n),y(n,i);for(let p=0;p<c.length;p+=1)c[p]&&c[p].m(i,null);y(e,r),y(e,s),u&&u.m(s,null),y(s,o),y(s,l);for(let p=0;p<f.length;p+=1)f[p]&&f[p].m(l,null)},p(d,m){if(m[0]&2048){a=d[11].items;let p;for(p=0;p<a.length;p+=1){const g=ca(d,a,p);c[p]?c[p].p(g,m):(c[p]=ga(g),c[p].c(),c[p].m(i,null))}for(;p<c.length;p+=1)c[p].d(1);c.length=a.length}if(d[11].score!==void 0?u?u.p(d,m):(u=_a(d),u.c(),u.m(s,o)):u&&(u.d(1),u=null),m[0]&4196352){h=d[11].items;let p;for(p=0;p<h.length;p+=1){const g=aa(d,h,p);f[p]?f[p].p(g,m):(f[p]=va(g),f[p].c(),f[p].m(l,null))}for(;p<f.length;p+=1)f[p].d(1);f.length=h.length}},d(d){d&&$(e),wt(c,d),u&&u.d(),wt(f,d)}}}function ga(t){let e,n,i,r,s,o=t[61].doc.title+"",l,a;return{c(){e=b("th"),n=b("span"),i=re("●"),r=j(),s=b("strong"),l=re(o),a=j(),We(n,"color",t[61].doc.color),v(e,"class","doc-title svelte-24wn30")},m(c,u){z(c,e,u),y(e,n),y(n,i),y(e,r),y(e,s),y(s,l),y(e,a)},p(c,u){u[0]&2048&&We(n,"color",c[61].doc.color),u[0]&2048&&o!==(o=c[61].doc.title+"")&&je(l,o)},d(c){c&&$(e)}}}function _a(t){let e,n,i,r=t[22]("score")+"",s,o,l,a=t[11].score.toFixed(2)+"",c;return{c(){e=b("tr"),n=b("td"),i=b("span"),s=re(r),o=j(),l=b("b"),c=re(a),v(i,"class","tag is-small"),v(n,"colspan","2"),v(n,"class","has-text-centered")},m(u,h){z(u,e,h),y(e,n),y(n,i),y(i,s),y(i,o),y(i,l),y(l,c)},p(u,h){h[0]&2048&&a!==(a=u[11].score.toFixed(2)+"")&&je(c,a)},d(u){u&&$(e)}}}function va(t){let e,n,i=t[22]("page")+"",r,s,o=t[61].label+"",l,a,c,u,h,f,d;return{c(){e=b("td"),n=b("p"),r=re(i),s=j(),l=re(o),a=j(),c=b("figure"),u=b("img"),d=j(),v(n,"class","is-size-7 has-text-grey mb-3"),At(u.src,h=t[61].imgUrl)||v(u,"src",h),v(u,"alt",f="Page "+t[61].label),We(u,"border-radius","5px"),v(c,"class","image")},m(m,p){z(m,e,p),y(e,n),y(n,r),y(n,s),y(n,l),y(e,a),y(e,c),y(c,u),y(e,d)},p(m,p){p[0]&2048&&o!==(o=m[61].label+"")&&je(l,o),p[0]&2048&&!At(u.src,h=m[61].imgUrl)&&v(u,"src",h),p[0]&2048&&f!==(f="Page "+m[61].label)&&v(u,"alt",f)},d(m){m&&$(e)}}}function N_(t){let e,n,i,r,s,o,l,a,c,u,h,f,d,m,p,g,_,S,C,w;function k(x,L){return x[6].length?x_:M_}let T=k(t),N=T(t),E=t[11]&&pa(t);return{c(){e=b("div"),n=b("label"),n.textContent=`${t[22]("filtering")}`,i=j(),r=b("div"),s=b("div"),o=b("select"),l=b("option"),l.textContent=`${t[22]("allPairs")}`,a=b("option"),a.textContent=`${t[22]("filteredPairs")}`,c=j(),u=b("div"),N.c(),h=j(),f=b("div"),d=b("div"),m=j(),p=b("div"),g=b("div"),E&&E.c(),_=j(),S=b("button"),v(n,"class","label is-small"),v(n,"for","matrix-mode"),l.__value="all",l.value=l.__value,a.__value="filtered",a.value=a.__value,v(o,"id","matrix-mode"),t[7]===void 0&&jt(()=>t[35].call(o)),v(s,"class","select is-small is-fullwidth"),v(r,"class","control"),v(e,"class","field mb-4"),v(u,"class","split-container svelte-24wn30"),v(d,"class","modal-background"),v(g,"class","box p-5"),v(p,"class","modal-content"),We(p,"width","auto"),We(p,"max-width","70vw"),v(S,"class","modal-close is-large"),v(S,"aria-label","close"),v(f,"id","matrix-page-modal"),v(f,"class","modal")},m(x,L){z(x,e,L),y(e,n),y(e,i),y(e,r),y(r,s),y(s,o),y(o,l),y(o,a),pn(o,t[7],!0),z(x,c,L),z(x,u,L),N.m(u,null),t[41](u),z(x,h,L),z(x,f,L),y(f,d),y(f,m),y(f,p),y(p,g),E&&E.m(g,null),y(f,_),y(f,S),t[42](f),C||(w=[Ce(o,"change",t[35]),ei(Pr.call(null,f))],C=!0)},p(x,L){L[0]&128&&pn(o,x[7]),T===(T=k(x))&&N?N.p(x,L):(N.d(1),N=T(x),N&&(N.c(),N.m(u,null))),x[11]?E?E.p(x,L):(E=pa(x),E.c(),E.m(g,null)):E&&(E.d(1),E=null)},i:te,o:te,d(x){x&&$(e),x&&$(c),x&&$(u),N.d(),t[41](null),x&&$(h),x&&$(f),E&&E.d(),t[42](null),C=!1,yt(w)}}}const ya=300,ba=30,ct=5;function P_(t,e,n){const i=new Map;let r=1/0,s=-1/0;for(const l of n){const[a,c,u]=l.regions_id_1===t.id?[l.page_1,l.page_2,l.weightedScore||0]:[l.page_2,l.page_1,l.weightedScore||0],h=`${a}-${c}`;i.has(h)||i.set(h,{page1:a,page2:c,scores:[]}),i.get(h).scores.push(u),u<r&&(r=u),u>s&&(s=u)}return{mode:"page",points:Array.from(i.values()).map(({page1:l,page2:a,scores:c})=>({page1:l,page2:a,score:c.reduce((u,h)=>u+h,0)/c.length,count:c.length})),minScore:r,maxScore:s,doc1:t,doc2:e}}function wa(t){return[...t].sort((e,n)=>{var s,o;if(e.canvas!==n.canvas)return e.canvas-n.canvas;const i=parseInt(((s=e.xywh)==null?void 0:s[1])||0),r=parseInt(((o=n.xywh)==null?void 0:o[1])||0);return i-r})}function O_(t,e,n){const i=wa(t.images||[]),r=wa(e.images||[]);if(!i.length||!r.length)return null;const s=new Map(i.map((u,h)=>[u.id,h])),o=new Map(r.map((u,h)=>[u.id,h])),l=new Map;let a=1/0,c=-1/0;return n.forEach(u=>{const[h,f,d]=u.regions_id_1===t.id?[u.id_1,u.id_2,u.weightedScore||0]:[u.id_2,u.id_1,u.weightedScore||0],m=s.get(h),p=o.get(f);if(m!==void 0&&p!==void 0){const g=`${m}-${p}`;l.set(g,{idx1:m,idx2:p,imgId1:h,imgId2:f,score:d}),d<a&&(a=d),d>c&&(c=d)}}),{mode:"image",images1:i,images2:r,pairScores:l,minScore:a,maxScore:c,doc1:t,doc2:e}}function Sa(t){const e=[];let n=null,i=0;return t.forEach((r,s)=>{r.canvas!==n&&(n!==null&&e.push({start:i,end:s,page:n,count:s-i}),n=r.canvas,i=s)}),n!==null&&e.push({start:i,end:t.length,page:n,count:t.length-i}),e}function L_(t,e,n){let i,r,s,o,l,a,c,u,h,f,d,m,p,g,{documentSetStore:_}=e;const{documentNodes:S,pairIndex:C,activeDocPairStats:w,activeDocStats:k,pageCountMap:T,visiblePairIds:N,matrixMode:E,normalizeByPages:x}=_;xe(t,S,Y=>n(34,g=Y)),xe(t,C,Y=>n(45,c=Y)),xe(t,w,Y=>n(33,p=Y)),xe(t,k,Y=>n(32,m=Y)),xe(t,T,Y=>n(31,f=Y)),xe(t,N,Y=>n(30,u=Y)),xe(t,E,Y=>n(7,h=Y)),xe(t,x,Y=>n(8,d=Y));const L={title:{en:"Document Matrix",fr:"Matrice de documents"},order:{en:"Order",fr:"Ordre"},byName:{en:"By title",fr:"Par titre"},byScore:{en:"By score",fr:"Par score"},noDocuments:{en:"No documents available",fr:"Aucun document disponible"},pageByPage:{en:"Page-by-page similarity",fr:"Similarité page par page"},page:{en:"page",fr:"page"},score:{en:"Score",fr:"Score"},noPairs:{en:"No pairs",fr:"Aucune paire"},selectCell:{en:"Click a cell to view page-by-page similarity",fr:"Cliquez sur une cellule pour voir la similarité page par page"},byPage:{en:"By page",fr:"Par page"},byImage:{en:"By image",fr:"Par image"},image:{en:"image",fr:"image"},normalize:{en:"Normalize",fr:"Normaliser"},normalization:{en:"Normalization by document page counts",fr:"Normalisation par le nombre de pages des documents"},allPairs:{en:"All pairs in the document set",fr:"Toutes les paires du corpus"},filteredPairs:{en:"Filtered pairs",fr:"Paires après filtrage"},filtering:{en:"Source of image pairs for the visualizations",fr:"Source des paires d’images pour les visualisations"}},O=Y=>{var de,Pe;return((de=L[Y])==null?void 0:de[B])||((Pe=L[Y])==null?void 0:Pe.en)||Y};let F,R,I,U,P=null,G="name",V=.5,q=!1,J=0,ue,ce=null,we=null,fe="page";function Fe(Y,de,Pe,be,st,qe){var ht;if(!Y.length)return{docs:[],matrix:[],maxScore:0};Y.forEach((et,Z)=>{var me;et.index=Z,et.count=((me=Pe==null?void 0:Pe.get(et.id))==null?void 0:me.count)||0});const Ke={name:Vi(Y.length).sort((et,Z)=>Y[et].title.localeCompare(Y[Z].title)),score:Vi(Y.length).sort((et,Z)=>Y[Z].count-Y[et].count)}[be].map(et=>Y[et]),Qe=Ke.length,Te=[];let Ae=0;for(let et=0;et<Qe;et++){const Z=[];for(let me=0;me<Qe;me++)if(et!==me){const $e=Ke[et].id<Ke[me].id?`${Ke[et].id}-${Ke[me].id}`:`${Ke[me].id}-${Ke[et].id}`;let kt=((ht=de==null?void 0:de.get($e))==null?void 0:ht.score)||0;if(st&&kt>0){const M=qe.get(Ke[et].id)||1,A=qe.get(Ke[me].id)||1;kt/=Math.sqrt(M*A)}kt>Ae&&(Ae=kt),Z.push({x:me,y:et,z:kt,doc1:Ke[et],doc2:Ke[me]})}else Z.push({x:me,y:et,z:0,diagonal:!0});Te.push(Z)}return{docs:Ke,matrix:Te,maxScore:Ae}}function Ge(Y,de,Pe,be){const{doc1:st,doc2:qe}=Y,lt=st.id<qe.id?`${st.id}-${qe.id}`:`${qe.id}-${st.id}`;let Ke=c.byDocPair.get(lt)||[];return Pe&&be.size>0&&(Ke=Ke.filter(Qe=>be.has(`${Qe.id_1}-${Qe.id_2}`))),Ke.length?de==="image"?O_(st,qe,Ke):P_(st,qe,Ke):null}function he(){if(!R||!r.docs.length)return;const{docs:Y,matrix:de,maxScore:Pe}=r,be=Y.length*ba;mt(R).selectAll("*").remove();const st=mt(R).append("svg").attr("width",be).attr("height",be),qe=Vl().range([0,be]).domain(Vi(Y.length)).padding(.02),lt=mt("body").selectAll(".matrix-tooltip").data([0]).join("div").attr("class","matrix-tooltip").style("position","fixed").style("background","var(--bulma-scheme-main)").style("border","1px solid var(--bulma-border)").style("border-radius","4px").style("padding","8px").style("pointer-events","none").style("opacity",0).style("font-size","12px").style("box-shadow","0 2px 4px rgba(0,0,0,0.15)").style("z-index","9999").style("color","var(--bulma-text)");st.selectAll(".row").data(de).join("g").attr("class","row").attr("transform",(Qe,Te)=>`translate(0,${qe(Te)})`).each(function(Qe){mt(this).selectAll(".cell").data(Qe.filter(Te=>!Te.diagonal)).join("rect").attr("class","cell").attr("x",Te=>qe(Te.x)).attr("width",qe.bandwidth()).attr("height",qe.bandwidth()).attr("fill",Te=>{if(Te.z===0)return"var(--bulma-text)";const Ae=Ji(233,.951,.52);return Ae.opacity=Pe>0?.2+.8*(Te.z/Pe):.2,Ae}).attr("stroke",Te=>W(Te)?"var(--bulma-text)":"var(--bulma-scheme-main)").attr("stroke-width",Te=>W(Te)?2:.5).style("cursor","pointer").on("mouseover",function(Te,Ae){W(Ae)||mt(this).attr("stroke","var(--bulma-text)").attr("stroke-width",2),lt.style("opacity",1)}).on("mousemove",function(Te,Ae){const ht=`<span style="color:${Ae.doc1.color}">●</span> ${Ae.doc1.title}<br/>↔<br/><span style="color:${Ae.doc2.color}">●</span> ${Ae.doc2.title}`,et=Ae.z===0?`${ht}<br/><br/><em>${O("noPairs")}</em>`:`${ht}<br/><br/>${O("score")}: ${Ae.z.toFixed(2)}`;lt.html(et).style("left",Te.clientX+15+"px").style("top",Te.clientY+15+"px")}).on("mouseleave",function(Te,Ae){W(Ae)||mt(this).attr("stroke","var(--bulma-scheme-main)").attr("stroke-width",.5),lt.style("opacity",0)}).on("click",(Te,Ae)=>{n(2,P={row:Ae.y,col:Ae.x,doc1:Ae.doc1,doc2:Ae.doc2}),ee()})}),st.selectAll(".row").selectAll(".cell-diagonal").data(Qe=>Qe.filter(Te=>Te.diagonal)).join("rect").attr("class","cell-diagonal").attr("x",Qe=>qe(Qe.x)).attr("width",qe.bandwidth()).attr("height",qe.bandwidth()).attr("fill","var(--contrasted)")}function W(Y){return P&&P.doc1.id===Y.doc1.id&&P.doc2.id===Y.doc2.id}function ee(){R&&mt(R).selectAll(".cell").attr("stroke",Y=>W(Y)?"var(--bulma-text)":"var(--bulma-scheme-main)").attr("stroke-width",Y=>W(Y)?2:.5)}function se(){!I||!s||(mt(I).selectAll("*").remove(),s.mode==="image"?oe():Q())}function Q(){const{points:Y,minScore:de,maxScore:Pe,doc1:be,doc2:st}=s;if(!Y.length)return;const qe={top:65,right:40,bottom:20,left:80},lt=10,Ke=Math.max(...Y.map(ae=>ae.page1)),Qe=Math.max(...Y.map(ae=>ae.page2)),Te=Ke*ct,Ae=Qe*ct,ht=new Map(Y.map(ae=>[`${ae.page1}-${ae.page2}`,ae])),et=Te+qe.left+qe.right,Z=Ae+qe.top+qe.bottom,$e=mt(I).append("svg").attr("width",et).attr("height",Z).append("g").attr("transform",`translate(${qe.left},${qe.top})`),kt=gi().domain([0,Ke]).range([0,Te]),M=gi().domain([0,Qe]).range([0,Ae]),A=mt("body").selectAll(".scatter-tooltip").data([0]).join("div").attr("class","scatter-tooltip").style("position","fixed").style("background","var(--bulma-scheme-main)").style("border","1px solid var(--bulma-border)").style("border-radius","4px").style("padding","6px 10px").style("pointer-events","none").style("opacity",0).style("font-size","11px").style("box-shadow","0 2px 4px rgba(0,0,0,0.15)").style("z-index","9999").style("color","var(--bulma-text)"),D=new Array(Ke).fill(0),X=new Array(Qe).fill(0);Y.forEach(ae=>{D[ae.page1-1]++,X[ae.page2-1]++});const ie=Math.max(...D),ne=Math.max(...X),ye=$e.append("g").attr("transform",`translate(0,${-22-lt})`);D.forEach((ae,pe)=>{ae!==0&&ye.append("rect").attr("x",pe*ct).attr("width",ct).attr("height",lt).attr("fill",be.color).attr("opacity",.15+.85*(ae/ie)).style("cursor","default").on("mouseover",()=>A.style("opacity",1)).on("mousemove",ke=>{A.html(`<strong>${ae}</strong> image${ae>1?"s":""}<br/>${O("page")} ${pe+1}`).style("left",ke.clientX+10+"px").style("top",ke.clientY-30+"px")}).on("mouseleave",()=>A.style("opacity",0))});const le=$e.append("g").attr("transform","translate(-55,0)");X.forEach((ae,pe)=>{ae!==0&&le.append("rect").attr("x",0).attr("y",pe*ct).attr("width",lt).attr("height",ct).attr("fill",st.color).attr("opacity",.15+.85*(ae/ne)).style("cursor","default").on("mouseover",()=>A.style("opacity",1)).on("mousemove",ke=>{A.html(`<strong>${ae}</strong> image${ae>1?"s":""}<br/>${O("page")} ${pe+1}`).style("left",ke.clientX+10+"px").style("top",ke.clientY-30+"px")}).on("mouseleave",()=>A.style("opacity",0))}),$e.append("g").call(No(kt).ticks(Math.min(Ke,10))),$e.append("g").call(Po(M).ticks(Math.min(Qe,10)));const it=(ae,pe)=>{const ke=Math.floor(pe/6);return ae.length>ke?ae.slice(0,ke-1)+"…":ae},Se=$e.append("g").attr("transform",`translate(${Te/2},-50)`);Se.append("circle").attr("r",4).attr("cx",-Te/2+4).attr("fill",be.color),Se.append("text").attr("x",-Te/2+14).attr("text-anchor","start").attr("dominant-baseline","middle").attr("font-size","11px").attr("fill","var(--bulma-text)").text(it(`${be.title} (${O("page")})`,Te-20));const Je=$e.append("g").attr("transform",`translate(-68,${Ae/2}) rotate(-90)`);Je.append("circle").attr("r",4).attr("cx",-Ae/2+4).attr("fill",st.color),Je.append("text").attr("x",-Ae/2+14).attr("text-anchor","start").attr("dominant-baseline","middle").attr("font-size","11px").attr("fill","var(--bulma-text)").text(it(`${st.title} (${O("page")})`,Ae-20)),$e.append("rect").attr("class","hover-overlay").attr("width",Te).attr("height",Ae).attr("fill","transparent").style("cursor","pointer").on("mousemove",ae=>{const[pe,ke]=bt(ae,$e.node()),rt=Math.floor(pe/ct)+1,at=Math.floor(ke/ct)+1;if(rt<1||rt>Ke||at<1||at>Qe){A.style("opacity",0);return}const ft=ht.get(`${rt}-${at}`),mn=`<span style="color:${be.color}">●</span> ${O("page")} ${rt}<br/><span style="color:${st.color}">●</span> ${O("page")} ${at}`,Nn=ft?`${mn}<br/>${O("score")}: ${ft.score.toFixed(2)}`:mn;A.style("opacity",1).html(Nn).style("left",ae.clientX+10+"px").style("top",ae.clientY-40+"px")}).on("mouseleave",()=>A.style("opacity",0)).on("click",ae=>{const[pe,ke]=bt(ae,$e.node()),rt=Math.floor(pe/ct)+1,at=Math.floor(ke/ct)+1;if(rt>=1&&rt<=Ke&&at>=1&&at<=Qe){const ft=ht.get(`${rt}-${at}`);Le(rt,at,be,st,ft==null?void 0:ft.score)}}),$e.selectAll(".cell").data(Y).join("rect").attr("class","cell").attr("x",ae=>(ae.page1-1)*ct).attr("y",ae=>(ae.page2-1)*ct).attr("width",ct).attr("height",ct).attr("fill",Ji(233,.951,.52)).attr("opacity",ae=>Pe>de?.2+.8*(ae.score-de)/(Pe-de):.5).attr("pointer-events","none"),n(1,I.style.width=et+"px",I),n(1,I.style.height=Z+"px",I)}function oe(){const{images1:Y,images2:de,pairScores:Pe,minScore:be,maxScore:st,doc1:qe,doc2:lt}=s;if(!Y.length||!de.length)return;const Ke={top:65,right:40,bottom:20,left:80},Qe=10,Te=Y.length*ct,Ae=de.length*ct,ht=Te+Ke.left+Ke.right,et=Ae+Ke.top+Ke.bottom,me=mt(I).append("svg").attr("width",ht).attr("height",et).append("g").attr("transform",`translate(${Ke.left},${Ke.top})`),$e=gi().domain([0,Y.length]).range([0,Te]),kt=gi().domain([0,de.length]).range([0,Ae]),M=mt("body").selectAll(".scatter-tooltip").data([0]).join("div").attr("class","scatter-tooltip").style("position","fixed").style("background","var(--bulma-scheme-main)").style("border","1px solid var(--bulma-border)").style("border-radius","4px").style("padding","6px 10px").style("pointer-events","none").style("opacity",0).style("font-size","11px").style("box-shadow","0 2px 4px rgba(0,0,0,0.15)").style("z-index","9999").style("color","var(--bulma-text)"),A=Sa(Y),D=Sa(de),X=me.append("g").attr("transform",`translate(0,${-22-Qe})`);A.forEach(({start:Se,end:Je,page:ae,count:pe})=>{X.append("rect").attr("x",Se*ct).attr("width",(Je-Se)*ct).attr("height",Qe).attr("fill",qe.color).attr("opacity",.5).style("cursor","default").on("mouseover",()=>M.style("opacity",1)).on("mousemove",ke=>{M.html(`${O("page")} ${ae}<br/><strong>${pe}</strong> image${pe>1?"s":""}`).style("left",ke.clientX+10+"px").style("top",ke.clientY-30+"px")}).on("mouseleave",()=>M.style("opacity",0))});const ie=me.append("g").attr("transform","translate(-55,0)");D.forEach(({start:Se,end:Je,page:ae,count:pe})=>{ie.append("rect").attr("x",0).attr("y",Se*ct).attr("width",Qe).attr("height",(Je-Se)*ct).attr("fill",lt.color).attr("opacity",.5).style("cursor","default").on("mouseover",()=>M.style("opacity",1)).on("mousemove",ke=>{M.html(`${O("page")} ${ae}<br/><strong>${pe}</strong> image${pe>1?"s":""}`).style("left",ke.clientX+10+"px").style("top",ke.clientY-30+"px")}).on("mouseleave",()=>M.style("opacity",0))}),me.append("g").call(No($e).ticks(Math.min(Y.length,10))),me.append("g").call(Po(kt).ticks(Math.min(de.length,10)));const ne=(Se,Je)=>{const ae=Math.floor(Je/6);return Se.length>ae?Se.slice(0,ae-1)+"…":Se},ye=me.append("g").attr("transform",`translate(${Te/2},-50)`);ye.append("circle").attr("r",4).attr("cx",-Te/2+4).attr("fill",qe.color),ye.append("text").attr("x",-Te/2+14).attr("text-anchor","start").attr("dominant-baseline","middle").attr("font-size","11px").attr("fill","var(--bulma-text)").text(ne(`${qe.title} (${O("image")})`,Te-20));const le=me.append("g").attr("transform",`translate(-68,${Ae/2}) rotate(-90)`);le.append("circle").attr("r",4).attr("cx",-Ae/2+4).attr("fill",lt.color),le.append("text").attr("x",-Ae/2+14).attr("text-anchor","start").attr("dominant-baseline","middle").attr("font-size","11px").attr("fill","var(--bulma-text)").text(ne(`${lt.title} (${O("image")})`,Ae-20)),me.append("rect").attr("class","hover-overlay").attr("width",Te).attr("height",Ae).attr("fill","transparent").style("cursor","pointer").on("mousemove",Se=>{const[Je,ae]=bt(Se,me.node()),pe=Math.floor(Je/ct),ke=Math.floor(ae/ct);if(pe<0||pe>=Y.length||ke<0||ke>=de.length){M.style("opacity",0);return}const rt=Y[pe],at=de[ke],ft=Pe.get(`${pe}-${ke}`),mn=`<span style="color:${qe.color}">●</span> ${O("page")} ${rt.canvas}, ${O("image")} ${pe+1}<br/><span style="color:${lt.color}">●</span> ${O("page")} ${at.canvas}, ${O("image")} ${ke+1}`,Nn=ft?`${mn}<br/>${O("score")}: ${ft.score.toFixed(2)}`:mn;M.style("opacity",1).html(Nn).style("left",Se.clientX+10+"px").style("top",Se.clientY-40+"px")}).on("mouseleave",()=>M.style("opacity",0)).on("click",Se=>{const[Je,ae]=bt(Se,me.node()),pe=Math.floor(Je/ct),ke=Math.floor(ae/ct);if(pe>=0&&pe<Y.length&&ke>=0&&ke<de.length){const rt=Pe.get(`${pe}-${ke}`);Xe(Y[pe],de[ke],qe,lt,rt==null?void 0:rt.score)}});const it=Array.from(Pe.values());me.selectAll(".cell").data(it).join("rect").attr("class","cell").attr("x",Se=>Se.idx1*ct).attr("y",Se=>Se.idx2*ct).attr("width",ct).attr("height",ct).attr("fill",Ji(233,.951,.52)).attr("opacity",Se=>st>be?.2+.8*(Se.score-be)/(st-be):.5).attr("pointer-events","none"),n(1,I.style.width=ht+"px",I),n(1,I.style.height=et+"px",I)}function Le(Y,de,Pe,be,st){n(27,ce={page1:Y,page2:de,doc1:Pe,doc2:be,score:st}),n(28,we=null),U==null||U.classList.add("is-active")}function Xe(Y,de,Pe,be,st){n(28,we={img1:Y,img2:de,doc1:Pe,doc2:be,score:st}),n(27,ce=null),U==null||U.classList.add("is-active")}function Ze(Y){q=!0,Y.preventDefault()}function Ee(Y){var be,st;if(!q||!F)return;const de=F.getBoundingClientRect(),Pe=(Y.clientX||((st=(be=Y.touches)==null?void 0:be[0])==null?void 0:st.clientX))-de.left;n(25,V=Math.max(.2,Math.min(.8,Pe/de.width)))}function Ie(){q=!1}function Re(Y,de){const Pe="full";return Kt(`wit${Y.witnessId}_${Y.digitizationRef}_${String(de).padStart(Y.zeros,"0")}`,"full",Pe)}function ot(Y){var de;return Kt(Y.ref,(de=Y.xywh)==null?void 0:de.join(","),"full")}Rn(()=>{F&&(n(26,J=F.offsetWidth),ue=new ResizeObserver(Y=>{n(26,J=Y[0].contentRect.width)}),ue.observe(F)),window.addEventListener("mousemove",Ee),window.addEventListener("mouseup",Ie),window.addEventListener("touchmove",Ee),window.addEventListener("touchend",Ie)}),Dn(()=>{ue==null||ue.disconnect(),window.removeEventListener("mousemove",Ee),window.removeEventListener("mouseup",Ie),window.removeEventListener("touchmove",Ee),window.removeEventListener("touchend",Ie)});function gt(){h=Ii(this),E.set(h)}function St(){G=Ii(this),n(3,G)}const ut=Y=>x.set(Y.target.checked);function De(Y){gn[Y?"unshift":"push"](()=>{R=Y,n(0,R)})}function Mt(){fe=Ii(this),n(4,fe)}function Ue(Y){gn[Y?"unshift":"push"](()=>{I=Y,n(1,I)})}function pt(Y){gn[Y?"unshift":"push"](()=>{F=Y,n(9,F)})}function Be(Y){gn[Y?"unshift":"push"](()=>{U=Y,n(10,U)})}return t.$$set=Y=>{"documentSetStore"in Y&&n(24,_=Y.documentSetStore)},t.$$.update=()=>{t.$$.dirty[1]&8&&n(6,i=Array.from((g==null?void 0:g.values())||[])),t.$$.dirty[0]&328|t.$$.dirty[1]&7&&n(5,r=Fe(i,p.scoreCount,m.scoreCount,G,d,f)),t.$$.dirty[0]&1073741972&&n(29,s=P?Ge(P,fe,h==="filtered",u):null),t.$$.dirty[0]&100663296&&n(13,o=Math.max(ya,J*V-4)),t.$$.dirty[0]&100663296&&n(12,l=Math.max(ya,J*(1-V)-4)),t.$$.dirty[0]&402653184&&n(11,a=ce?{items:[1,2].map(Y=>({doc:ce[`doc${Y}`],label:ce[`page${Y}`],imgUrl:Re(ce[`doc${Y}`],ce[`page${Y}`])})),score:ce.score}:we?{items:[["img1","doc1"],["img2","doc2"]].map(([Y,de])=>({doc:we[de],label:we[Y].canvas,imgUrl:ot(we[Y])})),score:we.score}:null),t.$$.dirty[0]&33&&R&&r.docs.length&&he(),t.$$.dirty[0]&536870914&&I&&s&&se()},[R,I,P,G,fe,r,i,h,d,F,U,a,l,o,S,C,w,k,T,N,E,x,O,Ze,_,V,J,ce,we,s,u,f,m,p,g,gt,St,ut,De,Mt,Ue,pt,Be]}class R_ extends Ve{constructor(e){super(),He(this,e,L_,N_,ze,{documentSetStore:24},null,[-1,-1,-1])}}const D_=1e4;async function $_(t,e,n={}){const{onProgress:i,onError:r,signal:s}=n,o=await fetch(t,{signal:s});if(!o.ok){const d=await o.json().catch(()=>({error:o.statusText}));throw new Error(d.error||`HTTP ${o.status}`)}const l=o.body.getReader(),a=new TextDecoder;let c="",u=[],h=0,f=!1;try{for(;;){const{done:d,value:m}=await l.read();if(d){if(c.trim()){const g=ka(c);g&&u.push(g)}return u.length>0?(h+=u.length,e.postMessage({type:"batch",pairs:u,isLast:!0})):e.postMessage({type:"done"}),i==null||i(h,!0),h}c+=a.decode(m,{stream:!0});const p=c.split(`
`);c=p.pop()||"";for(const g of p){if(!g)continue;const _=ka(g);_&&(u.push(_),u.length>=D_&&(f||(e.postMessage({type:"init"}),f=!0),h+=u.length,e.postMessage({type:"batch",pairs:u,isLast:!1}),u=[],i==null||i(h,!1)))}}}catch(d){throw d.name==="AbortError"?(e.postMessage({type:"abort"}),d):(r==null||r(d),d)}}function ka(t){try{return JSON.parse(t)}catch{return console.warn("Parse error:",t.slice(0,50)),null}}const Ea="https://vhs.huma-num.fr",z_=()=>new Worker("/static/js/pairWorker.js",{type:"module"});function j_(t){const e=Ne(null),n=Ne(!1),i=Ne({loaded:0,done:!1}),r=Ne([]),s=Ne(new Set),o=Ne([]),l=Ne(0),a=Ne(3),c=Ne(!1),u=Ne("threshold"),h=Ne([]),f=Ne(new Map);let d,m=null;const p=Ne({byImage:new Map,byDocPair:new Map,byDoc:new Map}),g=Ne(new Map),_=Ne(new Map),S=Ne({}),C=Ne({}),w=Ne({}),k=Ne({}),T=Ne({documents:0,pairs:null,images:0,categories:{}}),N=dt(r,(W,ee)=>{if(W.length===0){ee(Promise.resolve(0));return}d&&d.terminate()&&(d=null),m&&m.abort(),m=new AbortController;const se=413,Q=new Promise((oe,Le)=>{n.set(!0),i.set({loaded:0,done:!1}),e.set(null),(async()=>{try{d=z_(),d.onmessage=async Ee=>{const{type:Ie}=Ee.data;if(Ie==="progress"){i.set({loaded:Ee.data.count,done:!1});return}if(Ie!=="complete")return;const{allPairs:Re,imageNodes:ot,pairIndex:gt,categories:St,stats:ut}=Ee.data;p.set(gt),S.set(ut.pairStats),q(),C.set(ut.documentStats),w.set(ut.imageStats),k.set(ut.docPairStats);const De=Array.from(ut.documentStats.scoreCount.keys());vt(s).size===0&&s.set(new Set(De));const Mt=await Promise.all(De.map(Be=>E(Be).then(Y=>({id:Be,info:Y})))),Ue=new Map;Mt.forEach(({id:Be,info:Y})=>Ue.set(Be,Y)),f.set(Ue);const pt=new Map;De.forEach((Be,Y)=>{const de=Ue.get(Be)||{};pt.set(Be,{id:Be,title:de.title||`Region Extraction ${Be}`,color:de.color||xu(Y),images:[],...de})}),ot.forEach(Be=>{const Y=pt.get(Be.regionId);Y&&(Be.color=Y.color,Be.title=`${Y.title} | Page ${Be.canvas}`,Y.images.push(Be))}),pt.forEach(Be=>Be.images.sort((Y,de)=>Y.canvas-de.canvas)),g.set(ot),_.set(pt),T.set({documents:De.length,pairs:Re.length,images:ot.size,categories:St}),h.set(Re),n.set(!1),i.set({loaded:Re.length,done:!0}),d.terminate(),d=null,oe(Re.length)},d.onerror=Ee=>{console.error("Worker error",Ee),e.set(`Worker error: ${Ee.message}`),n.set(!1),Le(Ee)};const Ze=`${Ea}/document-set/${se}/pairs/stream?category=${W.join(",")}`;await $_(Ze,d,{signal:m.signal,onProgress:(Ee,Ie)=>{i.set({loaded:Ee,done:Ie})},onError:Ee=>{e.set(`Stream error: ${Ee.message}`)}})}catch(Ze){if(Ze.name==="AbortError"){console.log("Request aborted");return}e.set(`Fetch error: ${Ze.message}`),n.set(!1),Le(Ze)}})()});ee(Q)});async function E(W){try{const ee=await fetch(`${Ea}/search/regions/?id=${W}`);if(!ee.ok)throw new Error(`HTTP ${ee.status}`);const{results:se}=await ee.json();if(!(se!=null&&se.length))return{title:`Region Extraction ${W}`};const Q=se[0],[,...oe]=Q.title.split(" | "),[Le,Xe]=(Q.ref||"_").split("_");return{title:oe.join(" | "),ref:Q.ref,witnessId:Mr(Le),digitizationRef:Xe,zeros:Q.zeros,img_nb:Q.img_nb,url:Q.url}}catch(ee){return e.set(`Error fetching region #${W}: ${ee.message}`),{title:`Region Extraction ${W}`}}}const x=dt([h,l,a,c,s],([W,ee,se,Q,oe])=>{if(!W)return[];const Le=[],Xe=vt(u);for(let Ze=0;Ze<W.length;Ze++){const Ee=W[Ze];if(Xe==="threshold"&&Ee.weightedScore<ee)break;if(!(!oe.has(Ee.regions_id_1)||!oe.has(Ee.regions_id_2))){if(Xe==="topk"&&se!==null){const Ie=Ee.rank_1??1/0,Re=Ee.rank_2??1/0;if(Q){if(Ie>se||Re>se)continue}else if(Ie>se&&Re>se)continue}Le.push(Ee)}}return Le}),L=dt([x,_],([W,ee])=>{if(!W.length||ee.size===0)return[];const se=new Set;for(const oe of W)se.add(oe.regions_id_1),se.add(oe.regions_id_2);const Q=[];return se.forEach(oe=>{const Le=ee.get(oe);Le&&Q.push(Le)}),Q.sort((oe,Le)=>Le.id-oe.id)});function O(W,ee,se=10,Q=200,oe=2,Le=25){if(!ee)return{strength:.5,distance:100,width:2};const{min:Xe,_:Ze,range:Ee}=ee,Ie=Ee===0?.5:(W-Xe)/Ee,Re=Q-Ie*(Q-se),ot=oe+Ie*(Le-oe);return{strength:Ie,distance:Re,width:ot}}function F(W,ee,se=10,Q=60){if(!ee)return se;const{min:oe,_:Le,range:Xe}=ee;return Xe===0?(se+Q)/2:se+(W-oe)/Xe*(Q-se)}const R=dt([x],([W])=>{var Ze;const ee=vt(g),se=vt(w),Q=vt(S),oe=new Set,Le=[];for(const Ee of W){const{strength:Ie,distance:Re,width:ot}=O(Ee.weightedScore,Q.scoreRange);Le.push({source:Ee.id_1,target:Ee.id_2,strength:Ie,distance:Re,width:ot}),oe.has(Ee.id_1)||oe.add(Ee.id_1),oe.has(Ee.id_2)||oe.add(Ee.id_2)}const Xe=[];for(const Ee of oe){const Ie=ee.get(Ee);if(Ie){const Re=(Ze=se.scoreCount)==null?void 0:Ze.get(Ee),{count:ot,score:gt}=Re;Xe.push({...Ie,radius:F(gt,se.scoreRange),label:`Region: ${Ie.regionId}
Page: ${Ie.canvas}
Connections: ${ot}
Total score: ${gt.toFixed(2)}`})}}return{nodes:Xe,links:Le}}),I=dt(L,W=>{const ee=vt(k),se=vt(C);if(W.size===0)return{nodes:[],links:[]};const Q=Array.from(W.values()).map(Le=>{var Ie;const Xe=(Ie=se.scoreCount)==null?void 0:Ie.get(Le.id),{count:Ze,score:Ee}=Xe;return{...Le,radius:F(Ze,se.countRange),label:`${Le.title}
Images: ${Ze}
Total score: ${Ee.toFixed(2)}`}}),oe=Array.from(ee.scoreCount.entries()).map(([Le,Xe])=>{const[Ze,Ee]=Le.split("-").map(Number),{strength:Ie,distance:Re,width:ot}=O(Xe.score,ee.scoreRange);return{source:Ze,target:Ee,strength:Ie,distance:Re,width:ot}});return{nodes:Q,links:oe}});function U(W){if(!W.length)return{regions:[],rows:[]};const ee=vt(_),se=vt(p),Q=W[0],oe=ee.get(Q);if(!(oe!=null&&oe.images))return{regions:W,rows:[]};const Le=oe.images,Xe=(Re,ot,gt)=>{const{r1:St,r2:ut}={r1:ot,r2:gt},De=St<ut?`${St}-${ut}`:`${ut}-${St}`;return(se.byDocPair.get(De)||[]).map(Ue=>Ue.id_1===Re&&Ue.regions_id_1===ot?{id:Ue.id_2,page:Ue.page_2}:Ue.id_2===Re&&Ue.regions_id_2===ot?{id:Ue.id_1,page:Ue.page_1}:null).filter(Boolean)},Ze=[];for(const Re of Le){let ot=[{[Q]:{id:Re.id,page:Re.canvas}}];for(let gt=1;gt<W.length;gt++){const St=W[gt],ut=[];for(const De of ot){const Mt=[];for(let Ue=0;Ue<gt;Ue++){const pt=W[Ue];if(De[pt]){const Be=Xe(De[pt].id,pt,St);Mt.push(...Be)}}if(Mt.length===0)ut.push(De);else{const Ue=new Map;Mt.forEach(pt=>{Ue.has(pt.id)||Ue.set(pt.id,pt)});for(const pt of Ue.values()){const Be={...De,[St]:pt};ut.push(Be)}}}ot=ut}Ze.push(...ot)}const Ee=[],Ie=new Set;for(const Re of Ze){const ot=W.map(gt=>{var St;return((St=Re[gt])==null?void 0:St.id)||""}).join("|");Ie.has(ot)||(Ie.add(ot),Ee.push(Re))}return{regions:W,rows:Ee}}function P(W){r.update(ee=>ee.indexOf(W)>-1?ee.filter(Q=>Q!==W):[...ee,W].sort((Q,oe)=>Q-oe))}function G(W){s.update(ee=>{const se=new Set(ee);return se.has(W)?se.delete(W):se.add(W),se})}function V(){const W=Array.from(vt(_).keys());s.set(new Set(W))}function q(){if(!vt(r).includes(0))return;const{min:W,max:ee}=vt(S).scoreRange||{};W==null||ee==null||vt(l)===W&&l.set((W+ee)/2)}const J=Ne("filtered"),ue=Ne(!1),ce=dt(x,W=>{const ee=new Set;for(const se of W)ee.add(`${se.id_1}-${se.id_2}`);return ee}),we=dt(x,W=>{const ee=new Map;if(!(W!=null&&W.length))return{scoreCount:ee,scoreRange:{min:0,max:0,range:0}};let se=1/0,Q=-1/0;for(const oe of W){const Le=oe.regions_id_1<oe.regions_id_2?`${oe.regions_id_1}-${oe.regions_id_2}`:`${oe.regions_id_2}-${oe.regions_id_1}`,Xe=ee.get(Le)||{score:0,count:0};Xe.score+=oe.weightedScore||0,Xe.count++,ee.set(Le,Xe)}for(const{score:oe}of ee.values())oe<se&&(se=oe),oe>Q&&(Q=oe);return se===1/0&&(se=Q=0),{scoreCount:ee,scoreRange:{min:se,max:Q,range:Q-se}}}),fe=dt(x,W=>{const ee=new Map;if(!(W!=null&&W.length))return{scoreCount:ee,countRange:{min:0,max:0,range:0}};for(const oe of W)for(const Le of[oe.regions_id_1,oe.regions_id_2]){const Xe=ee.get(Le)||{score:0,count:0};Xe.score+=oe.weightedScore||0,Xe.count++,ee.set(Le,Xe)}let se=1/0,Q=-1/0;for(const{count:oe}of ee.values())oe<se&&(se=oe),oe>Q&&(Q=oe);return se===1/0&&(se=Q=0),{scoreCount:ee,countRange:{min:se,max:Q,range:Q-se}}}),Fe=dt([J,k,we],([W,ee,se])=>W==="filtered"?se:ee),Ge=dt([J,C,fe],([W,ee,se])=>W==="filtered"?se:ee),he=dt(_,W=>{var se;const ee=new Map;for(const[Q,oe]of W)ee.set(Q,Math.max(1,((se=oe.images)==null?void 0:se.length)||oe.img_nb||1));return ee});return{error:e,loadingProgress:i,cancelLoading:()=>{m&&(m.abort(),n.set(!1))},allPairs:h,visiblePairs:x,pairIndex:p,documentNodes:_,imageNodes:g,fetchPairs:N,imageNetwork:R,documentNetwork:I,selectedCategories:r,pairStats:S,documentStats:C,imageStats:w,docPairStats:k,docSetNumber:T,selectedNodes:o,selectedRegions:s,updateSelectedNodes:W=>o.set(W),toggleCategory:P,toggleRegion:G,selectAllRegions:V,buildAlignedImageMatrix:U,threshold:l,setThreshold:W=>l.set(W),topK:a,setTopK:W=>a.set(W),mutualTopK:c,setMutualTopK:W=>c.set(W),scoreMode:u,setScoreMode:W=>u.set(W),matrixMode:J,setMatrixMode:W=>J.set(W),normalizeByPages:ue,setNormalizeByPages:W=>ue.set(W),activeDocPairStats:Fe,activeDocStats:Ge,pageCountMap:he,visiblePairIds:ce}}function F_(t){let e,n,i;const r=t[1].default,s=Vt(r,t,t[0],null);return{c(){e=b("table"),n=b("tbody"),s&&s.c(),v(e,"class","table is-fullwidth")},m(o,l){z(o,e,l),y(e,n),s&&s.m(n,null),i=!0},p(o,[l]){s&&s.p&&(!i||l&1)&&Bt(s,r,o,o[0],i?Ut(r,o[0],l,null):qt(o[0]),null)},i(o){i||(H(s,o),i=!0)},o(o){K(s,o),i=!1},d(o){o&&$(e),s&&s.d(o)}}}function H_(t,e,n){let{$$slots:i={},$$scope:r}=e;return t.$$set=s=>{"$$scope"in s&&n(0,r=s.$$scope)},[r,i]}class V_ extends Ve{constructor(e){super(),He(this,e,H_,F_,ze,{})}}const U_=t=>({}),Ca=t=>({}),B_=t=>({}),Ia=t=>({}),q_=t=>({}),xa=t=>({});function K_(t){let e;const n=t[4]["row-body"],i=Vt(n,t,t[3],Ca);return{c(){i&&i.c()},m(r,s){i&&i.m(r,s),e=!0},p(r,s){i&&i.p&&(!e||s&8)&&Bt(i,n,r,r[3],e?Ut(n,r[3],s,U_):qt(r[3]),Ca)},i(r){e||(H(i,r),e=!0)},o(r){K(i,r),e=!1},d(r){i&&i.d(r)}}}function W_(t){let e,n,i,r;const s=t[4]["row-body"],o=Vt(s,t,t[3],Ia);return{c(){e=b("div"),n=b("div"),o&&o.c(),v(n,"class","grid is-gap-2"),v(e,"class",i="fixed-grid has-"+t[2]+"-cols")},m(l,a){z(l,e,a),y(e,n),o&&o.m(n,null),r=!0},p(l,a){o&&o.p&&(!r||a&8)&&Bt(o,s,l,l[3],r?Ut(s,l[3],a,B_):qt(l[3]),Ia),(!r||a&4&&i!==(i="fixed-grid has-"+l[2]+"-cols"))&&v(e,"class",i)},i(l){r||(H(o,l),r=!0)},o(l){K(o,l),r=!1},d(l){l&&$(e),o&&o.d(l)}}}function Y_(t){let e,n,i,r,s,o,l,a,c,u;jt(t[5]);const h=t[4]["row-header"],f=Vt(h,t,t[3],xa),d=[W_,K_],m=[];function p(g,_){return g[0]?0:1}return o=p(t),l=m[o]=d[o](t),{c(){e=b("tr"),n=b("th"),i=b("div"),f&&f.c(),r=j(),s=b("td"),l.c(),v(i,"class","content-wrapper py-5"),v(n,"class","is-3 center-flex is-narrow"),We(n,"width","15vw"),v(s,"class","p-5 is-fullwidth")},m(g,_){z(g,e,_),y(e,n),y(n,i),f&&f.m(i,null),y(e,r),y(e,s),m[o].m(s,null),a=!0,c||(u=Ce(window,"resize",t[5]),c=!0)},p(g,[_]){f&&f.p&&(!a||_&8)&&Bt(f,h,g,g[3],a?Ut(h,g[3],_,q_):qt(g[3]),xa);let S=o;o=p(g),o===S?m[o].p(g,_):(tt(),K(m[S],1,1,()=>{m[S]=null}),nt(),l=m[o],l?l.p(g,_):(l=m[o]=d[o](g),l.c()),H(l,1),l.m(s,null))},i(g){a||(H(f,g),H(l),a=!0)},o(g){K(f,g),K(l),a=!1},d(g){g&&$(e),f&&f.d(g),m[o].d(),c=!1,u()}}}function G_(t,e,n){let i,{$$slots:r={},$$scope:s}=e,{useGrid:o=!0}=e,l=0;function a(){n(1,l=window.innerWidth)}return t.$$set=c=>{"useGrid"in c&&n(0,o=c.useGrid),"$$scope"in c&&n(3,s=c.$$scope)},t.$$.update=()=>{t.$$.dirty&2&&n(2,i=Us(l))},[o,l,i,s,r,a]}class Ma extends Ve{constructor(e){super(),He(this,e,G_,Y_,ze,{useGrid:0})}}const lb="",X_=t=>({}),Aa=t=>({}),J_=t=>({}),Ta=t=>({});function Na(t){let e,n,i,r,s,o,l,a,c,u,h,f=t[1]&&Pa(t);return a=new ji({props:{tooltipText:t[2][t[1]][B]}}),{c(){f&&f.c(),e=j(),n=b("div"),i=b("button"),r=Wt("svg"),s=Wt("path"),l=j(),ve(a.$$.fragment),v(s,"fill","none"),v(s,"stroke","currentColor"),v(s,"stroke-linecap","round"),v(s,"stroke-linejoin","round"),v(s,"stroke-width","1.5"),v(s,"d","M12 3v18m0 0l8.5-8.5M12 21l-8.5-8.5"),v(r,"style",o=`transform: rotate(${t[1]?"180":"0"}deg)`),v(r,"xmlns","http://www.w3.org/2000/svg"),v(r,"width","24"),v(r,"height","24"),v(r,"viewBox","0 0 24 24"),v(r,"class","svelte-jbs1sd"),v(i,"class","button is-link svelte-jbs1sd"),v(n,"class","ctrl-toggle svelte-jbs1sd")},m(d,m){f&&f.m(d,m),z(d,e,m),z(d,n,m),y(n,i),y(i,r),y(r,s),y(i,l),ge(a,i,null),c=!0,u||(h=Ce(i,"click",sn(t[3])),u=!0)},p(d,m){d[1]?f?(f.p(d,m),m&2&&H(f,1)):(f=Pa(d),f.c(),H(f,1),f.m(e.parentNode,e)):f&&(tt(),K(f,1,1,()=>{f=null}),nt()),(!c||m&2&&o!==(o=`transform: rotate(${d[1]?"180":"0"}deg)`))&&v(r,"style",o);const p={};m&2&&(p.tooltipText=d[2][d[1]][B]),a.$set(p)},i(d){c||(H(f),H(a.$$.fragment,d),c=!0)},o(d){K(f),K(a.$$.fragment,d),c=!1},d(d){f&&f.d(d),d&&$(e),d&&$(n),_e(a),u=!1,h()}}}function Pa(t){let e,n,i;const r=t[5]["toolbar-hidden"],s=Vt(r,t,t[4],Aa);return{c(){e=b("div"),s&&s.c(),v(e,"class","ctrl-extra")},m(o,l){z(o,e,l),s&&s.m(e,null),i=!0},p(o,l){s&&s.p&&(!i||l&16)&&Bt(s,r,o,o[4],i?Ut(r,o[4],l,X_):qt(o[4]),Aa)},i(o){i||(H(s,o),jt(()=>{i&&(n||(n=_n(e,qs,{axis:"y"},!0)),n.run(1))}),i=!0)},o(o){K(s,o),n||(n=_n(e,qs,{axis:"y"},!1)),n.run(0),i=!1},d(o){o&&$(e),s&&s.d(o),o&&n&&n.end()}}}function Q_(t){let e,n,i,r,s,o,l,a;const c=t[5]["toolbar-visible"],u=Vt(c,t,t[4],Ta);let h=t[0]&&Na(t);return{c(){e=b("div"),n=b("form"),i=b("div"),r=b("div"),s=b("div"),u&&u.c(),o=j(),h&&h.c(),v(s,"class","ctrl-block svelte-jbs1sd"),v(r,"class","ctrl-block-wrapper svelte-jbs1sd"),v(i,"class","ctrl-base"),v(n,"class","ctrl svelte-jbs1sd"),v(e,"id","toolbar"),v(e,"class",l="ctrl-wrapper is-flex is-justify-content-center is-align-items-center "+(t[1]?"toolbar-expanded":"toolbar-collapsed")+" svelte-jbs1sd")},m(f,d){z(f,e,d),y(e,n),y(n,i),y(i,r),y(r,s),u&&u.m(s,null),y(n,o),h&&h.m(n,null),a=!0},p(f,[d]){u&&u.p&&(!a||d&16)&&Bt(u,c,f,f[4],a?Ut(c,f[4],d,J_):qt(f[4]),Ta),f[0]?h?(h.p(f,d),d&1&&H(h,1)):(h=Na(f),h.c(),H(h,1),h.m(n,null)):h&&(tt(),K(h,1,1,()=>{h=null}),nt()),(!a||d&2&&l!==(l="ctrl-wrapper is-flex is-justify-content-center is-align-items-center "+(f[1]?"toolbar-expanded":"toolbar-collapsed")+" svelte-jbs1sd"))&&v(e,"class",l)},i(f){a||(H(u,f),H(h),a=!0)},o(f){K(u,f),K(h),a=!1},d(f){f&&$(e),u&&u.d(f),h&&h.d()}}}function Z_(t,e,n){let i,{$$slots:r={},$$scope:s}=e,{expandable:o=!0}=e;const l={true:{en:"Collapse the toolbar",fr:"Refermer le menu"},false:{en:"Expand the toolbar",fr:"Ouvrir le menu"}},a=()=>n(1,i=!i);return t.$$set=c=>{"expandable"in c&&n(0,o=c.expandable),"$$scope"in c&&n(4,s=c.$$scope)},n(1,i=!1),[o,i,l,a,s,r]}class e0 extends Ve{constructor(e){super(),He(this,e,Z_,Q_,ze,{expandable:0})}}function Oa(t){let e,n,i,r,s,o,l,a,c,u=t[5]>1&&La(t),h=t[5]<t[3]&&$a(t);return{c(){e=b("nav"),n=b("ul"),u&&u.c(),i=j(),r=b("li"),s=b("a"),o=re(t[5]),l=j(),h&&h.c(),v(s,"class","pagination-link is-current"),v(s,"href",null),v(n,"class","pagination-list ml-0"),v(e,"class","pagination is-centered mb-2"),v(e,"aria-label","pagination")},m(f,d){z(f,e,d),y(e,n),u&&u.m(n,null),y(n,i),y(n,r),y(r,s),y(s,o),y(n,l),h&&h.m(n,null),a||(c=Ce(s,"click",sn(t[9])),a=!0)},p(f,d){f[5]>1?u?u.p(f,d):(u=La(f),u.c(),u.m(n,i)):u&&(u.d(1),u=null),d&32&&je(o,f[5]),f[5]<f[3]?h?h.p(f,d):(h=$a(f),h.c(),h.m(n,null)):h&&(h.d(1),h=null)},d(f){f&&$(e),u&&u.d(),h&&h.d(),a=!1,c()}}}function La(t){let e,n,i,r,s,o,l=t[5]-1>1&&Ra(t);return{c(){e=b("li"),n=b("a"),n.textContent="1",i=j(),l&&l.c(),r=Ct(),v(n,"class","pagination-link"),v(n,"href",null)},m(a,c){z(a,e,c),y(e,n),z(a,i,c),l&&l.m(a,c),z(a,r,c),s||(o=Ce(n,"click",sn(t[7])),s=!0)},p(a,c){a[5]-1>1?l?l.p(a,c):(l=Ra(a),l.c(),l.m(r.parentNode,r)):l&&(l.d(1),l=null)},d(a){a&&$(e),a&&$(i),l&&l.d(a),a&&$(r),s=!1,o()}}}function Ra(t){let e,n,i,r=t[5]-1+"",s,o,l,a=t[5]-1>2&&Da();return{c(){a&&a.c(),e=j(),n=b("li"),i=b("a"),s=re(r),v(i,"class","pagination-link"),v(i,"href",null)},m(c,u){a&&a.m(c,u),z(c,e,u),z(c,n,u),y(n,i),y(i,s),o||(l=Ce(i,"click",sn(t[8])),o=!0)},p(c,u){c[5]-1>2?a||(a=Da(),a.c(),a.m(e.parentNode,e)):a&&(a.d(1),a=null),u&32&&r!==(r=c[5]-1+"")&&je(s,r)},d(c){a&&a.d(c),c&&$(e),c&&$(n),o=!1,l()}}}function Da(t){let e;return{c(){e=b("li"),e.innerHTML='<span class="pagination-ellipsis">…</span>'},m(n,i){z(n,e,i)},d(n){n&&$(e)}}}function $a(t){let e,n,i,r,s,o,l=t[5]+1<t[3]&&za(t);return{c(){l&&l.c(),e=j(),n=b("li"),i=b("a"),r=re(t[3]),v(i,"class","pagination-link"),v(i,"href",null)},m(a,c){l&&l.m(a,c),z(a,e,c),z(a,n,c),y(n,i),y(i,r),s||(o=Ce(i,"click",sn(t[11])),s=!0)},p(a,c){a[5]+1<a[3]?l?l.p(a,c):(l=za(a),l.c(),l.m(e.parentNode,e)):l&&(l.d(1),l=null),c&8&&je(r,a[3])},d(a){l&&l.d(a),a&&$(e),a&&$(n),s=!1,o()}}}function za(t){let e,n,i=t[5]+1+"",r,s,o,l,a,c=t[5]+2<t[3]&&ja();return{c(){e=b("li"),n=b("a"),r=re(i),s=j(),c&&c.c(),o=Ct(),v(n,"class","pagination-link"),v(n,"href",null)},m(u,h){z(u,e,h),y(e,n),y(n,r),z(u,s,h),c&&c.m(u,h),z(u,o,h),l||(a=Ce(n,"click",sn(t[10])),l=!0)},p(u,h){h&32&&i!==(i=u[5]+1+"")&&je(r,i),u[5]+2<u[3]?c||(c=ja(),c.c(),c.m(o.parentNode,o)):c&&(c.d(1),c=null)},d(u){u&&$(e),u&&$(s),c&&c.d(u),u&&$(o),l=!1,a()}}}function ja(t){let e;return{c(){e=b("li"),e.innerHTML='<span class="pagination-ellipsis">…</span>'},m(n,i){z(n,e,i)},d(n){n&&$(e)}}}function t0(t){let e,n,i=t[5]*t[2]-t[2]+1+"",r,s,o=Math.min(t[5]*t[2],t[1])+"",l,a,c,u,h=t[4]&&Oa(t);return{c(){h&&h.c(),e=j(),n=b("div"),r=re(i),s=re(" - "),l=re(o),a=re(" / "),c=re(t[1]),v(n,"class",u="is-size-7 is-center mb-4 "+(t[4]?"":"mt-4"))},m(f,d){h&&h.m(f,d),z(f,e,d),z(f,n,d),y(n,r),y(n,s),y(n,l),y(n,a),y(n,c)},p(f,[d]){f[4]?h?h.p(f,d):(h=Oa(f),h.c(),h.m(e.parentNode,e)):h&&(h.d(1),h=null),d&36&&i!==(i=f[5]*f[2]-f[2]+1+"")&&je(r,i),d&38&&o!==(o=Math.min(f[5]*f[2],f[1])+"")&&je(l,o),d&2&&je(c,f[1]),d&16&&u!==(u="is-size-7 is-center mb-4 "+(f[4]?"":"mt-4"))&&v(n,"class",u)},i:te,o:te,d(f){h&&h.d(f),f&&$(e),f&&$(n)}}}function n0(t,e,n){let i,r,s,{store:o}=e;const{currentPage:l}=o;xe(t,l,p=>n(5,s=p));let{nbOfItems:a}=e,{pageLength:c=_u}=e;const u=()=>o.handlePageUpdate(1),h=()=>o.handlePageUpdate(s-1),f=()=>o.handlePageUpdate(s),d=()=>o.handlePageUpdate(s+1),m=()=>o.handlePageUpdate(i);return t.$$set=p=>{"store"in p&&n(0,o=p.store),"nbOfItems"in p&&n(1,a=p.nbOfItems),"pageLength"in p&&n(2,c=p.pageLength)},t.$$.update=()=>{t.$$.dirty&6&&n(3,i=c>0?Math.ceil(a/c):1),t.$$.dirty&14&&n(4,r=i>1||a>c)},[o,a,c,i,r,s,l,u,h,f,d,m]}class Fa extends Ve{constructor(e){super(),He(this,e,n0,t0,ze,{store:0,nbOfItems:1,pageLength:2})}}function i0(t){let e,n,i,r,s=B==="en"?"Save selection":"Sauvegarder la sélection",o,l,a;return{c(){e=b("button"),n=b("span"),i=b("i"),r=j(),o=re(s),v(i,"class","fa-solid fa-floppy-disk"),v(e,"class","button is-link")},m(c,u){z(c,e,u),y(e,n),y(n,i),y(n,r),y(n,o),l||(a=Ce(e,"click",t[7]),l=!0)},p:te,d(c){c&&$(e),l=!1,a()}}}function r0(t){let e,n,i,r,s=B==="en"?"Go to treatment":"Accéder au traitement",o,l;return{c(){var a;e=b("a"),n=b("span"),i=b("i"),r=j(),o=re(s),v(i,"class","fa-solid fa-gear"),v(e,"class","button is-link"),v(e,"href",l="/"+Yt+"/treatment/add/?document_set="+((a=t[3])==null?void 0:a.id))},m(a,c){z(a,e,c),y(e,n),y(n,i),y(n,r),y(n,o)},p(a,c){var u;c&8&&l!==(l="/"+Yt+"/treatment/add/?document_set="+((u=a[3])==null?void 0:u.id))&&v(e,"href",l)},d(a){a&&$(e)}}}function Ha(t){let e,n,i,r,s,o,l;return{c(){var a,c;e=b("a"),n=b("span"),n.innerHTML='<i class="fa-solid fa-file-export"></i> JSON',r=j(),s=b("a"),o=b("span"),o.innerHTML='<i class="fa-solid fa-file-zipper"></i> ZIP',v(e,"class","button is-link is-dark"),v(e,"href",i="/"+Yt+"/document-set/"+((a=t[3])==null?void 0:a.id)+"/json"),v(e,"target","_blank"),v(s,"class","button is-link is-dark"),v(s,"href",l="/"+Yt+"/document-set/"+((c=t[3])==null?void 0:c.id)+"/zip"),v(s,"target","_blank")},m(a,c){z(a,e,c),y(e,n),z(a,r,c),z(a,s,c),y(s,o)},p(a,c){var u,h;c&8&&i!==(i="/"+Yt+"/document-set/"+((u=a[3])==null?void 0:u.id)+"/json")&&v(e,"href",i),c&8&&l!==(l="/"+Yt+"/document-set/"+((h=a[3])==null?void 0:h.id)+"/zip")&&v(s,"href",l)},d(a){a&&$(e),a&&$(r),a&&$(s)}}}function s0(t){let e,n,i,r,s,o,l;function a(f,d){return f[2]&&!f[1]?r0:i0}let c=a(t),u=c(t),h=!t[1]&&Ha(t);return{c(){e=b("footer"),n=b("div"),i=b("button"),i.textContent=`${B==="en"?"Clear selection":"Vider la sélection"}`,r=j(),u.c(),s=j(),h&&h.c(),v(i,"class","button button-close is-link is-light"),v(n,"class","buttons"),v(e,"class","modal-card-foot is-center")},m(f,d){z(f,e,d),y(e,n),y(n,i),y(n,r),u.m(n,null),y(n,s),h&&h.m(n,null),o||(l=Ce(i,"click",t[6]),o=!0)},p(f,[d]){c===(c=a(f))&&u?u.p(f,d):(u.d(1),u=c(f),u&&(u.c(),u.m(n,s))),f[1]?h&&(h.d(1),h=null):h?h.p(f,d):(h=Ha(f),h.c(),h.m(n,null))},i:te,o:te,d(f){f&&$(e),u.d(),h&&h.d(),o=!1,l()}}}function o0(t,e,n){let i,r,{selectionStore:s}=e;const{isSaved:o,selection:l}=s;xe(t,o,h=>n(2,i=h)),xe(t,l,h=>n(3,r=h));let{isRegion:a=s.type!=="documentSet"}=e;const c=()=>s.empty(),u=()=>s.save();return t.$$set=h=>{"selectionStore"in h&&n(0,s=h.selectionStore),"isRegion"in h&&n(1,a=h.isRegion)},[s,a,i,r,o,l,c,u]}class l0 extends Ve{constructor(e){super(),He(this,e,o0,s0,ze,{selectionStore:0,isRegion:1})}}const ab="";function a0(t){let e,n,i,r,s,o;return{c(){e=b("span"),n=re(t[5]),i=j(),r=b("span"),r.innerHTML='<i class="fas fa-edit"></i>',v(r,"class","pl-3 smaller has-text-link")},m(l,a){z(l,e,a),y(e,n),y(e,i),y(e,r),s||(o=[Ce(e,"click",t[7]),Ce(e,"keyup",null)],s=!0)},p(l,a){a&32&&je(n,l[5])},d(l){l&&$(e),s=!1,yt(o)}}}function c0(t){let e,n,i;return{c(){e=b("input"),v(e,"class","input selection-title svelte-sgypdx")},m(r,s){z(r,e,s),t[12](e),Ci(e,t[4]),n||(i=[Ce(e,"input",t[13]),Ce(e,"keydown",t[8]),Ce(e,"blur",t[9])],n=!0)},p(r,s){s&16&&e.value!==r[4]&&Ci(e,r[4])},d(r){r&&$(e),t[12](null),n=!1,yt(i)}}}function u0(t){let e,n,i,r,s,o,l,a,c,u,h,f,d,m,p,g,_,S,C,w;function k(L,O){return L[2]?c0:a0}let T=k(t),N=T(t);const E=t[11].default,x=Vt(E,t,t[10],null);return _=new l0({props:{selectionStore:t[0]}}),{c(){e=b("div"),n=b("div"),i=j(),r=b("div"),s=b("div"),o=b("div"),l=b("i"),a=j(),N.c(),c=re(`
                (`),u=re(t[1]),h=re(")"),f=j(),d=b("button"),m=j(),p=b("section"),x&&x.c(),g=j(),ve(_.$$.fragment),v(n,"class","modal-background"),v(l,"class","fa-solid fa-book-bookmark"),v(o,"class","title is-4 mb-0 media-content"),v(d,"class","delete media-left"),v(d,"aria-label","close"),v(s,"class","modal-card-head media mb-0 is-middle"),v(p,"class","modal-card-body"),v(r,"class","modal-content"),v(e,"id","selection-modal"),v(e,"class","modal fade"),v(e,"tabindex","-1"),v(e,"aria-labelledby","selection-modal-label"),v(e,"aria-hidden","true")},m(L,O){z(L,e,O),y(e,n),y(e,i),y(e,r),y(r,s),y(s,o),y(o,l),y(o,a),N.m(o,null),y(o,c),y(o,u),y(o,h),y(s,f),y(s,d),y(r,m),y(r,p),x&&x.m(p,null),y(r,g),ge(_,r,null),S=!0,C||(w=ei(Pr.call(null,e)),C=!0)},p(L,[O]){T===(T=k(L))&&N?N.p(L,O):(N.d(1),N=T(L),N&&(N.c(),N.m(o,c))),(!S||O&2)&&je(u,L[1]),x&&x.p&&(!S||O&1024)&&Bt(x,E,L,L[10],S?Ut(E,L[10],O,null):qt(L[10]),null);const F={};O&1&&(F.selectionStore=L[0]),_.$set(F)},i(L){S||(H(x,L),H(_.$$.fragment,L),S=!0)},o(L){K(x,L),K(_.$$.fragment,L),S=!1},d(L){L&&$(e),N.d(),x&&x.d(L),_e(_),C=!1,w()}}}function f0(t,e,n){let i,{$$slots:r={},$$scope:s}=e,{selectionStore:o}=e;const{selectionTitle:l,updateTitle:a,save:c}=o;xe(t,l,C=>n(5,i=C));let{selectionLength:u=!1}=e,h=!1,f,d;function m(){n(2,h=!0),n(4,d=i),setTimeout(()=>f&&f.focus(),0)}function p(C){C.key==="Enter"&&g()}function g(){n(2,h=!1),a(d),c()}function _(C){gn[C?"unshift":"push"](()=>{f=C,n(3,f)})}function S(){d=this.value,n(4,d)}return t.$$set=C=>{"selectionStore"in C&&n(0,o=C.selectionStore),"selectionLength"in C&&n(1,u=C.selectionLength),"$$scope"in C&&n(10,s=C.$$scope)},[o,u,h,f,d,i,l,m,p,g,s,r,_,S]}class d0 extends Ve{constructor(e){super(),He(this,e,f0,u0,ze,{selectionStore:0,selectionLength:1})}}const cb="";function h0(t){let e,n,i,r,s,o=B==="en"?"Selection":"Sélection",l,a,c,u,h,f;return{c(){e=b("div"),n=b("button"),i=b("span"),r=b("i"),s=j(),l=re(o),a=re(`
            (`),c=re(t[0]),u=re(")"),v(r,"class","fa-solid fa-book-bookmark"),v(i,"id","btn-content"),v(n,"id","set-btn"),v(n,"class","button px-5 py-4 is-link svelte-gmt9z5"),v(n,"data-target","selection-modal"),v(e,"class","set-container svelte-gmt9z5")},m(d,m){z(d,e,m),y(e,n),y(n,i),y(i,r),y(i,s),y(i,l),y(i,a),y(i,c),y(i,u),h||(f=ei(Bs.call(null,n)),h=!0)},p(d,[m]){m&1&&je(c,d[0])},i:te,o:te,d(d){d&&$(e),h=!1,f()}}}function m0(t,e,n){let{selectionLength:i=0}=e,r=i;return t.$$set=s=>{"selectionLength"in s&&n(0,i=s.selectionLength)},t.$$.update=()=>{if(t.$$.dirty&3&&i!==r){const s=i>r;n(1,r=i);const o=document.getElementById("btn-content");o&&o.animate([{transform:s?"translateY(-7px)":"translateX(-5px)"},{transform:s?"translateY(7px)":"translateX(5px)"},{transform:"translate(0)"}],{duration:300,easing:"cubic-bezier(0.65, 0, 0.35, 1)"})}},[i,r]}class p0 extends Ve{constructor(e){super(),He(this,e,m0,h0,ze,{selectionLength:0})}}const ub="";function Va(t,e,n){const i=t.slice();return i[7]=e[n][0],i[8]=e[n][1],i}function g0(t){let e;return{c(){e=b("div"),e.textContent=`${B==="en"?"No regions in selection":"Aucune région sélectionnée"}`},m(n,i){z(n,e,i)},p:te,d(n){n&&$(e)}}}function _0(t){let e,n,i=Object.entries(t[2]),r=[];for(let s=0;s<i.length;s+=1)r[s]=Ua(Va(t,i,s));return{c(){e=b("div"),n=b("div");for(let s=0;s<r.length;s+=1)r[s].c();v(n,"class","grid is-gap-2"),v(e,"class","fixed-grid has-6-cols")},m(s,o){z(s,e,o),y(e,n);for(let l=0;l<r.length;l+=1)r[l]&&r[l].m(n,null)},p(s,o){if(o&13){i=Object.entries(s[2]);let l;for(l=0;l<i.length;l+=1){const a=Va(s,i,l);r[l]?r[l].p(a,o):(r[l]=Ua(a),r[l].c(),r[l].m(n,null))}for(;l<r.length;l+=1)r[l].d(1);r.length=i.length}},d(s){s&&$(e),wt(r,s)}}}function Ua(t){let e,n,i,r,s,o,l,a=t[8].title+"",c,u,h,f,d,m;function p(){return t[6](t[7])}return{c(){e=b("div"),n=b("figure"),i=b("img"),s=j(),o=b("div"),l=b("span"),c=re(a),u=j(),h=b("button"),f=j(),At(i.src,r=Kt(t[8].img,t[8].xywh,"96,"))||v(i,"src",r),v(i,"alt","Extracted region"),v(l,"class","overlay-desc"),v(o,"class","overlay is-center svelte-g8ij5d"),v(n,"class","image is-64x64 card"),v(h,"class","delete region-btn svelte-g8ij5d"),v(h,"aria-label","remove from selection"),v(e,"class","selection cell svelte-g8ij5d")},m(g,_){z(g,e,_),y(e,n),y(n,i),y(n,s),y(n,o),y(o,l),y(l,c),y(e,u),y(e,h),y(e,f),d||(m=Ce(h,"click",p),d=!0)},p(g,_){t=g,_&4&&!At(i.src,r=Kt(t[8].img,t[8].xywh,"96,"))&&v(i,"src",r),_&4&&a!==(a=t[8].title+"")&&je(c,a)},d(g){g&&$(e),d=!1,m()}}}function v0(t){let e;function n(s,o){return s[4]?_0:g0}let i=n(t),r=i(t);return{c(){r.c(),e=Ct()},m(s,o){r.m(s,o),z(s,e,o)},p(s,o){i===(i=n(s))&&r?r.p(s,o):(r.d(1),r=i(s),r&&(r.c(),r.m(e.parentNode,e)))},d(s){r.d(s),s&&$(e)}}}function y0(t){let e,n,i,r;return e=new p0({props:{selectionLength:t[1]}}),i=new d0({props:{selectionLength:t[1],selectionStore:t[0],$$slots:{default:[v0]},$$scope:{ctx:t}}}),{c(){ve(e.$$.fragment),n=j(),ve(i.$$.fragment)},m(s,o){ge(e,s,o),z(s,n,o),ge(i,s,o),r=!0},p(s,[o]){const l={};o&2&&(l.selectionLength=s[1]),e.$set(l);const a={};o&2&&(a.selectionLength=s[1]),o&1&&(a.selectionStore=s[0]),o&2077&&(a.$$scope={dirty:o,ctx:s}),i.$set(a)},i(s){r||(H(e.$$.fragment,s),H(i.$$.fragment,s),r=!0)},o(s){K(e.$$.fragment,s),K(i.$$.fragment,s),r=!1},d(s){_e(e,s),s&&$(n),_e(i,s)}}}function b0(t,e,n){let i,r,s,o,{selectionStore:l}=e;const{selected:a}=l;xe(t,a,u=>n(3,o=u));const c=u=>l.remove(u,Object.keys(o)[0]);return t.$$set=u=>{"selectionStore"in u&&n(0,l=u.selectionStore)},t.$$.update=()=>{t.$$.dirty&8&&n(2,i=Object.values(o)[0]||{}),t.$$.dirty&4&&n(1,r=Object.keys(i).length),t.$$.dirty&2&&n(4,s=r>0)},[l,r,i,o,s,a,c]}class w0 extends Ve{constructor(e){super(),He(this,e,b0,y0,ze,{selectionStore:0})}}const fb="";function Ba(t,e,n){const i=t.slice();return i[17]=e[n],i}function qa(t,e,n){const i=t.slice();return i[20]=e[n],i}function Ka(t,e,n){const i=t.slice();return i[23]=e[n],i}function S0(t){let e,n;return e=new e0({props:{expandable:!1,$$slots:{"toolbar-visible":[k0]},$$scope:{ctx:t}}}),{c(){ve(e.$$.fragment)},m(i,r){ge(e,i,r),n=!0},p(i,r){const s={};r&67108864&&(s.$$scope={dirty:r,ctx:i}),e.$set(s)},i(i){n||(H(e.$$.fragment,i),n=!0)},o(i){K(e.$$.fragment,i),n=!1},d(i){_e(e,i)}}}function Wa(t){let e,n,i,r,s,o=t[23].title+"",l,a,c,u=t[23].shortcut+"",h,f,d,m;return{c(){e=b("p"),n=b("button"),i=b("span"),r=b("i"),s=j(),l=re(o),a=j(),c=b("span"),h=re(u),f=j(),v(r,"class","fas "+t[23].icon+" svelte-7vjt6f"),v(i,"class","icon is-small"),v(c,"class","shortcut svelte-7vjt6f"),v(n,"class","button pl-5"),v(n,"title",t[23].desc),v(e,"class","control")},m(p,g){z(p,e,g),y(e,n),y(n,i),y(i,r),y(n,s),y(n,l),y(n,a),y(n,c),y(c,h),y(e,f),d||(m=Ce(n,"click",sn(t[23].fct)),d=!0)},p(p,g){t=p},d(p){p&&$(e),d=!1,m()}}}function k0(t){let e,n,i,r,s,o,l,a=Object.values(t[10]),c=[];for(let u=0;u<a.length;u+=1)c[u]=Wa(Ka(t,a,u));return{c(){e=b("div"),n=b("div"),i=b("div"),r=b("span"),r.textContent=`${B==="en"?"Process selection":"Agir sur la sélection"}`,s=j(),o=b("div"),l=b("div");for(let u=0;u<c.length;u+=1)c[u].c();v(r,"class","tag is-medium is-link mr-5"),v(i,"class","column is-narrow mr-5"),v(l,"class","field has-addons"),v(o,"class","column"),v(n,"class","columns is-vcentered is-mobile py-4"),v(e,"slot","toolbar-visible")},m(u,h){z(u,e,h),y(e,n),y(n,i),y(i,r),y(n,s),y(n,o),y(o,l);for(let f=0;f<c.length;f+=1)c[f]&&c[f].m(l,null)},p(u,h){if(h&1024){a=Object.values(u[10]);let f;for(f=0;f<a.length;f+=1){const d=Ka(u,a,f);c[f]?c[f].p(d,h):(c[f]=Wa(d),c[f].c(),c[f].m(l,null))}for(;f<c.length;f+=1)c[f].d(1);c.length=a.length}},d(u){u&&$(e),wt(c,u)}}}function E0(t){let e,n=t[9].title+"",i;return{c(){e=b("span"),i=re(n),v(e,"class","button is-small is-success"),v(e,"title",t[9].desc)},m(r,s){z(r,e,s),y(e,i)},p:te,d(r){r&&$(e)}}}function C0(t){let e,n=t[8].title+"",i,r,s;function o(){return t[12](t[17])}return{c(){e=b("button"),i=re(n),v(e,"class","button is-small is-warning"),v(e,"title",t[8].desc)},m(l,a){z(l,e,a),y(e,i),r||(s=Ce(e,"click",o),r=!0)},p(l,a){t=l},d(l){l&&$(e),r=!1,s()}}}function I0(t){let e,n,i=t[17].size+"",r,s,o,l,a,c;function u(d,m){return d[17].fullyConnected?E0:C0}let h=u(t),f=h(t);return{c(){e=b("div"),n=b("span"),r=re(i),s=re(" images"),o=j(),l=b("hr"),a=j(),f.c(),c=j(),v(n,"class","cluster-size"),v(e,"class","cluster-info is-center is-fullwidth")},m(d,m){z(d,e,m),y(e,n),y(n,r),y(n,s),y(e,o),y(e,l),y(e,a),f.m(e,null),z(d,c,m)},p(d,m){m&4&&i!==(i=d[17].size+"")&&je(r,i),h===(h=u(d))&&f?f.p(d,m):(f.d(1),f=h(d),f&&(f.c(),f.m(e,null)))},d(d){d&&$(e),f.d(),d&&$(c)}}}function Ya(t){let e,n;return e=new Jn({props:{item:{...t[3].get(t[20]),clusterId:t[17].id},copyable:!1,selectionStore:hr}}),{c(){ve(e.$$.fragment)},m(i,r){ge(e,i,r),n=!0},p(i,r){const s={};r&12&&(s.item={...i[3].get(i[20]),clusterId:i[17].id}),e.$set(s)},i(i){n||(H(e.$$.fragment,i),n=!0)},o(i){K(e.$$.fragment,i),n=!1},d(i){_e(e,i)}}}function x0(t){let e,n,i=t[17].members,r=[];for(let o=0;o<i.length;o+=1)r[o]=Ya(qa(t,i,o));const s=o=>K(r[o],1,1,()=>{r[o]=null});return{c(){for(let o=0;o<r.length;o+=1)r[o].c();e=j()},m(o,l){for(let a=0;a<r.length;a+=1)r[a]&&r[a].m(o,l);z(o,e,l),n=!0},p(o,l){if(l&12){i=o[17].members;let a;for(a=0;a<i.length;a+=1){const c=qa(o,i,a);r[a]?(r[a].p(c,l),H(r[a],1)):(r[a]=Ya(c),r[a].c(),H(r[a],1),r[a].m(e.parentNode,e))}for(tt(),a=i.length;a<r.length;a+=1)s(a);nt()}},i(o){if(!n){for(let l=0;l<i.length;l+=1)H(r[l]);n=!0}},o(o){r=r.filter(Boolean);for(let l=0;l<r.length;l+=1)K(r[l]);n=!1},d(o){wt(r,o),o&&$(e)}}}function Ga(t,e){let n,i,r;return i=new Ma({props:{$$slots:{"row-body":[x0],"row-header":[I0]},$$scope:{ctx:e}}}),{key:t,first:null,c(){n=Ct(),ve(i.$$.fragment),this.first=n},m(s,o){z(s,n,o),ge(i,s,o),r=!0},p(s,o){e=s;const l={};o&67108876&&(l.$$scope={dirty:o,ctx:e}),i.$set(l)},i(s){r||(H(i.$$.fragment,s),r=!0)},o(s){K(i.$$.fragment,s),r=!1},d(s){s&&$(n),_e(i,s)}}}function M0(t){let e=[],n=new Map,i,r,s=t[2];const o=l=>l[17].id;for(let l=0;l<s.length;l+=1){let a=Ba(t,s,l),c=o(a);n.set(c,e[l]=Ga(c,a))}return{c(){for(let l=0;l<e.length;l+=1)e[l].c();i=Ct()},m(l,a){for(let c=0;c<e.length;c+=1)e[c]&&e[c].m(l,a);z(l,i,a),r=!0},p(l,a){a&780&&(s=l[2],tt(),e=Pi(e,a,o,1,l,s,n,i.parentNode,Cr,Ga,i,Ba),nt())},i(l){if(!r){for(let a=0;a<s.length;a+=1)H(e[a]);r=!0}},o(l){for(let a=0;a<e.length;a+=1)K(e[a]);r=!1},d(l){for(let a=0;a<e.length;a+=1)e[a].d(l);l&&$(i)}}}function A0(t){let e,n,i,r,s,o,l,a,c,u=xr&&S0(t);return n=new Fa({props:{store:t[0],nbOfItems:t[1],pageLength:t[7]}}),r=new w0({props:{selectionStore:hr}}),o=new V_({props:{$$slots:{default:[M0]},$$scope:{ctx:t}}}),a=new Fa({props:{store:t[0],nbOfItems:t[1],pageLength:t[7]}}),{c(){u&&u.c(),e=j(),ve(n.$$.fragment),i=j(),ve(r.$$.fragment),s=j(),ve(o.$$.fragment),l=j(),ve(a.$$.fragment)},m(h,f){u&&u.m(h,f),z(h,e,f),ge(n,h,f),z(h,i,f),ge(r,h,f),z(h,s,f),ge(o,h,f),z(h,l,f),ge(a,h,f),c=!0},p(h,[f]){xr&&u.p(h,f);const d={};f&1&&(d.store=h[0]),f&2&&(d.nbOfItems=h[1]),n.$set(d);const m={};f&67108876&&(m.$$scope={dirty:f,ctx:h}),o.$set(m);const p={};f&1&&(p.store=h[0]),f&2&&(p.nbOfItems=h[1]),a.$set(p)},i(h){c||(H(u),H(n.$$.fragment,h),H(r.$$.fragment,h),H(o.$$.fragment,h),H(a.$$.fragment,h),c=!0)},o(h){K(u),K(n.$$.fragment,h),K(r.$$.fragment,h),K(o.$$.fragment,h),K(a.$$.fragment,h),c=!1},d(h){u&&u.d(h),h&&$(e),_e(n,h),h&&$(i),_e(r,h),h&&$(s),_e(o,h),h&&$(l),_e(a,h)}}}function T0(t,e,n){let i,r,s,{documentSetStore:o}=e;const{imageNodes:l}=o;xe(t,l,w=>n(3,s=w));let{clusterStore:a}=e;const{clusterNb:c,paginatedClusters:u,pageLength:h,validateCluster:f,newCluster:d,removeFromClusters:m}=a;xe(t,c,w=>n(1,i=w)),xe(t,u,w=>n(2,r=w));const p={create:{title:B==="en"?"New cluster":"Nouveau cluster",desc:B==="en"?"Create a new validated cluster from the selected regions":"Créer un nouveau cluster valide à partir des régions sélectionnées",icon:"fa-object-group",shortcut:"Shift + C",fct:d},remove:{title:B==="en"?"Remove from cluster":"Retirer du cluster",desc:B==="en"?"Remove the selected regions from their cluster":"Retirer les régions sélectionnées de leur cluster",icon:"fa-chain-broken",shortcut:"Shift + D",fct:m},validate:{title:B==="en"?"Validate cluster":"Valider le cluster",desc:B==="en"?"Set as exact match all the pairs of regions in the cluster":"Définir comme correspondance exacte toutes les paires de régions dans le cluster",icon:"fa-check",fct:f},validated:{title:B==="en"?"Validated cluster":"Cluster valide",desc:B==="en"?"All pairs of regions have be categorized as exact matches":"Toutes les paires de régions ont été catégorisées comme des correspondances exactes",icon:"fa-check"}},{validate:g,validated:_,...S}=p,C=w=>g.fct(w);return t.$$set=w=>{"documentSetStore"in w&&n(11,o=w.documentSetStore),"clusterStore"in w&&n(0,a=w.clusterStore)},[a,i,r,s,l,c,u,h,g,_,S,o,C]}class N0 extends Ve{constructor(e){super(),He(this,e,T0,A0,ze,{documentSetStore:11,clusterStore:0})}}function P0(t,e){const i=Ne(1),{visiblePairs:r,imageNodes:s}=t;Ar(i,"p");function o(w){Tr(w,i,"p")}function l(w){if(w.length===0)return[];const k=new Map,T=L=>k.has(L)?(k.get(L)!==L&&k.set(L,T(k.get(L))),k.get(L)):(k.set(L,L),L),N=(L,O)=>{const F=T(L),R=T(O);F!==R&&k.set(R,F)},E=new Set;w.forEach(L=>{N(L.id_1,L.id_2),E.add(L.id_1),E.add(L.id_2)});const x=new Map;return E.forEach(L=>{const O=T(L);x.has(O)||x.set(O,[]),x.get(O).push(L)}),Array.from(x.values()).map(L=>{const O=L.length,F=O*(O-1)/2,R=new Set(L),I=w.filter(U=>R.has(U.id_1)&&R.has(U.id_2)).length;return{id:crypto.randomUUID(),members:L,size:O,fullyConnected:I===F}}).filter(L=>L.size>1).sort((L,O)=>O.size-L.size)}const a=dt(r,w=>w.length?l(w):[]),c=Ne([]);a.subscribe(w=>{c.set(w)});const u=dt([c,i],([w,k])=>{const T=(k-1)*10,N=T+10;return w.slice(T,N)}),h=(w,k)=>{const T=vt(s).get(w),N=vt(s).get(k);return{img_1:w,img_2:k,regions_id_1:T==null?void 0:T.regionId,regions_id_2:N==null?void 0:N.regionId}},f=(w,k)=>(c.update(T=>T.map(N=>{if(!k[N.id])return N;const E=N.members.filter(x=>!w.has(x));return{...N,members:E,size:E.length}}).filter(N=>N.size>0)),!0),d=async w=>{const k=Array.isArray(w)?w:Object.keys(w),T=new Set(k),N={};vt(c).forEach(x=>{const L=x.members.filter(O=>T.has(O));L.length>0&&(N[x.id]=L)});const E=Object.entries(N).flatMap(([x,L])=>{const O=vt(c).find(R=>R.id===x);if(!O)return[];const F=O.members.filter(R=>!T.has(R));return L.flatMap(R=>F.map(I=>h(R,I)))});if(E.length===0)return f(T,N),!0;try{const x=await Hs(()=>fetch(`${window.location.origin}/${Yt}/uncategorize-pair-batch`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":vn},body:JSON.stringify({pairs:E})}));return x.ok?(f(T,N),!0):(console.log(x),await Tt(B==="en"?"Batch un-categorization failed":"La dé-catégorisation par lot a échoué",B==="en"?"Error":"Erreur"),!1)}catch(x){return await Tt(x,B==="en"?"Error":"Erreur"),!1}},m=async w=>{const k=w.flatMap((T,N)=>w.slice(N+1).map(E=>h(T,E)));try{const T=await Hs(()=>fetch(`${window.location.origin}/${Yt}/exact-match-batch`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":vn},body:JSON.stringify({pairs:k})}));return T.ok?!0:(console.log(T),await Tt(B==="en"?"Batch validation failed":"La validation par lot a échoué",B==="en"?"Error":"Erreur"),!1)}catch(T){return await Tt(T,B==="en"?"Error":"Erreur"),console.error("Error:",T),!1}},p=async w=>{if(!xr)return await Tt(B==="en"?"You do not have permission to validate clusters":"Vous n'avez pas la permission, de valider les clusters.",B==="en"?"Permission Denied":"Permission refusée"),!1;const k=await m(w.members);return k&&c.update(T=>T.map(N=>N.id===w.id?{...N,fullyConnected:!0}:N)),k},g=async w=>{if(w.length<2)return!1;const k=await m(w);return k&&c.update(T=>[{id:crypto.randomUUID(),members:w,size:w.length,fullyConnected:!0},...T].sort((E,x)=>x.size-E.size)),k},_=()=>Object.values(vt(e).selected)[0]||{},S=async()=>{if(!await Tt(B==="en"?"Do you want to create a cluster out of these images?":"Voulez-vous créer un cluster à partir de ces images ?",B==="en"?"Confirm creation":"Confirmer la création",!0))return;const k=_(),T=Object.keys(k);return T.length<2?(await Tt(B==="en"?"Cluster creation requires at least 2 images":"La création d'un nouveau cluster nécessite a minima 2 images",B==="en"?"Impossible creation":"Création impossible"),!1):!await d(T)||!await g(T)?!1:(e.empty(),!0)},C=async()=>{if(!await Tt(B==="en"?"Do you want to remove these images from their clusters?":"Voulez-vous supprimer ces images de leurs clusters ?",B==="en"?"Confirm deletion":"Confirmer la suppression",!0))return;const k=_();return await d(Object.keys(k))?(e.empty(),!0):!1};return{imageClusters:a,interfaceClusters:c,clusterNb:dt(c,w=>w.length),validateCluster:p,removeFromClusters:C,newCluster:S,paginatedClusters:u,handlePageUpdate:o,pageLength:10,currentPage:i}}function Xa(t,e,n){const i=t.slice();return i[25]=e[n],i}function O0(t){let e;return{c(){e=b("p"),e.textContent=`${B==="en"?"Groups of images that share a similarity connection above the score threshold.":"Groupes d'images partageant une connexion de similarité au-dessus du seuil de score."}`},m(n,i){z(n,e,i)},p:te,d(n){n&&$(e)}}}function L0(t){let e;return{c(){e=b("p"),e.textContent=`${B==="en"?"Matrix showing aggregated similarity scores between documents. Click a cell to explore page-level similarities in a scatter plot interface.":"Matrice affichant les scores de similarité agrégés entre documents. Cliquez sur une cellule pour explorer les similarités entre paires de documents."}`},m(n,i){z(n,e,i)},p:te,d(n){n&&$(e)}}}function R0(t){let e;return{c(){e=b("p"),e.textContent=`${B==="en"?"Network where each node is a document. Edge thickness reflects the cumulative similarity score between document pairs. Node size indicates the number of connections.":"Réseau où chaque nœud est un document. L'épaisseur des liens reflète le score de similarité cumulé entre paires de documents. La taille des nœuds indique le nombre de connexions."}`},m(n,i){z(n,e,i)},p:te,d(n){n&&$(e)}}}function D0(t){let e;return{c(){e=b("p"),e.textContent=`${B==="en"?"Network where each node is an image region. Edges connect regions with similarity scores above the threshold. Node color indicates the source document.":"Réseau où chaque nœud est une région d'image. Les liens connectent les régions dont le score de similarité dépasse le seuil. La couleur indique le document source."}`},m(n,i){z(n,e,i)},p:te,d(n){n&&$(e)}}}function $0(t){let e;function n(s,o){if(s[23]==="img")return D0;if(s[23]==="doc")return R0;if(s[23]==="matrix")return L0;if(s[23]==="clusters")return O0}let i=n(t),r=i&&i(t);return{c(){e=b("div"),r&&r.c(),v(e,"slot","datavizInfo")},m(s,o){z(s,e,o),r&&r.m(e,null)},p(s,o){i===(i=n(s))&&r?r.p(s,o):(r&&r.d(1),r=i&&i(s),r&&(r.c(),r.m(e,null)))},d(s){s&&$(e),r&&r.d()}}}function z0(t){let e,n,i;return n=new Xf({props:{docSet:t[0],documentSetStore:t[4],clusterStore:t[8],$$slots:{datavizInfo:[$0]},$$scope:{ctx:t}}}),{c(){e=b("div"),ve(n.$$.fragment),v(e,"slot","sidebar")},m(r,s){z(r,e,s),ge(n,e,null),i=!0},p(r,s){const o={};s&1&&(o.docSet=r[0]),s&276824064&&(o.$$scope={dirty:s,ctx:r}),n.$set(o)},i(r){i||(H(n.$$.fragment,r),i=!0)},o(r){K(n.$$.fragment,r),i=!1},d(r){r&&$(e),_e(n)}}}function Ja(t){let e,n,i,r,s,o,l,a=t[25].title+"",c,u;return{c(){e=b("div"),n=b("figure"),i=b("img"),s=j(),o=b("div"),l=b("span"),c=re(a),u=j(),At(i.src,r=Kt(t[25].img,t[25].xywh,"96,"))||v(i,"src",r),v(i,"alt","Extracted region"),v(l,"class","overlay-desc"),v(o,"class","overlay is-center"),v(n,"class","image is-64x64 card"),v(e,"class","selection cell")},m(h,f){z(h,e,f),y(e,n),y(n,i),y(n,s),y(n,o),y(o,l),y(l,c),y(e,u)},p(h,f){f&2&&!At(i.src,r=Kt(h[25].img,h[25].xywh,"96,"))&&v(i,"src",r),f&2&&a!==(a=h[25].title+"")&&je(c,a)},d(h){h&&$(e)}}}function j0(t){let e,n,i=Object.values(Object.values(t[1])[0]||{}),r=[];for(let s=0;s<i.length;s+=1)r[s]=Ja(Xa(t,i,s));return{c(){e=b("div"),n=b("div");for(let s=0;s<r.length;s+=1)r[s].c();v(n,"class","grid is-gap-2"),v(e,"slot","content"),v(e,"class","fixed-grid has-6-cols")},m(s,o){z(s,e,o),y(e,n);for(let l=0;l<r.length;l+=1)r[l]&&r[l].m(n,null)},p(s,o){if(o&2){i=Object.values(Object.values(s[1])[0]||{});let l;for(l=0;l<i.length;l+=1){const a=Xa(s,i,l);r[l]?r[l].p(a,o):(r[l]=Ja(a),r[l].c(),r[l].m(n,null))}for(;l<r.length;l+=1)r[l].d(1);r.length=i.length}},d(s){s&&$(e),wt(r,s)}}}function F0(t){let e,n,i,r={ctx:t,current:null,token:null,hasCatch:!1,pending:G0,then:U0,catch:V0,value:24,blocks:[,,,]};return Er(n=t[3],r),{c(){e=Ct(),r.block.c()},m(s,o){z(s,e,o),r.block.m(s,r.anchor=o),r.mount=()=>e.parentNode,r.anchor=e,i=!0},p(s,o){t=s,r.ctx=t,o&8&&n!==(n=t[3])&&Er(n,r)||js(r,t,o)},i(s){i||(H(r.block),i=!0)},o(s){for(let o=0;o<3;o+=1){const l=r.blocks[o];K(l)}i=!1},d(s){s&&$(e),r.block.d(s),r.token=null,r=null}}}function H0(t){let e,n,i;return{c(){e=b("article"),n=b("div"),i=re(t[2]),v(n,"class","message-body"),v(e,"class","message is-danger")},m(r,s){z(r,e,s),y(e,n),y(n,i)},p(r,s){s&4&&je(i,r[2])},i:te,o:te,d(r){r&&$(e)}}}function V0(t){return{c:te,m:te,p:te,i:te,o:te,d:te}}function U0(t){let e,n,i,r;const s=[q0,B0],o=[];function l(a,c){return a[24]===0?0:1}return e=l(t),n=o[e]=s[e](t),{c(){n.c(),i=Ct()},m(a,c){o[e].m(a,c),z(a,i,c),r=!0},p(a,c){let u=e;e=l(a),e===u?o[e].p(a,c):(tt(),K(o[u],1,1,()=>{o[u]=null}),nt(),n=o[e],n?n.p(a,c):(n=o[e]=s[e](a),n.c()),H(n,1),n.m(i.parentNode,i))},i(a){r||(H(n),r=!0)},o(a){K(n),r=!1},d(a){o[e].d(a),a&&$(i)}}}function B0(t){let e,n,i=t[9][t[23]]+"",r,s,o,l,a;const c=[Y0,W0,K0],u=[];function h(f,d){return f[23]==="img"||f[23]==="doc"?0:f[23]==="sim"?1:f[23]==="mat"?2:-1}return~(o=h(t))&&(l=u[o]=c[o](t)),{c(){e=b("div"),n=b("h2"),r=re(i),s=j(),l&&l.c(),v(n,"class","title is-3 has-text-link")},m(f,d){z(f,e,d),y(e,n),y(n,r),y(e,s),~o&&u[o].m(e,null),a=!0},p(f,d){(!a||d&8388608)&&i!==(i=f[9][f[23]]+"")&&je(r,i);let m=o;o=h(f),o===m?~o&&u[o].p(f,d):(l&&(tt(),K(u[m],1,1,()=>{u[m]=null}),nt()),~o?(l=u[o],l?l.p(f,d):(l=u[o]=c[o](f),l.c()),H(l,1),l.m(e,null)):l=null)},i(f){a||(H(l),a=!0)},o(f){K(l),a=!1},d(f){f&&$(e),~o&&u[o].d()}}}function q0(t){let e;return{c(){e=b("article"),e.innerHTML=`<div class="message-body">No document pairs found for this configuration.
                            Please adjust your selection criteria in the sidebar to include more documents or
                            categories.</div>`,v(e,"class","message is-warning")},m(n,i){z(n,e,i)},p:te,i:te,o:te,d(n){n&&$(e)}}}function K0(t){let e,n;return e=new R_({props:{documentSetStore:t[4]}}),{c(){ve(e.$$.fragment)},m(i,r){ge(e,i,r),n=!0},p:te,i(i){n||(H(e.$$.fragment,i),n=!0)},o(i){K(e.$$.fragment,i),n=!1},d(i){_e(e,i)}}}function W0(t){let e,n;return e=new N0({props:{documentSetStore:t[4],clusterStore:t[8]}}),{c(){ve(e.$$.fragment)},m(i,r){ge(e,i,r),n=!0},p:te,i(i){n||(H(e.$$.fragment,i),n=!0)},o(i){K(e.$$.fragment,i),n=!1},d(i){_e(e,i)}}}function Y0(t){let e,n;return e=new C_({props:{documentSetStore:t[4],type:t[23]}}),{c(){ve(e.$$.fragment)},m(i,r){ge(e,i,r),n=!0},p(i,r){const s={};r&8388608&&(s.type=i[23]),e.$set(s)},i(i){n||(H(e.$$.fragment,i),n=!0)},o(i){K(e.$$.fragment,i),n=!1},d(i){_e(e,i)}}}function G0(t){let e;return{c(){e=b("progress"),e.textContent="Loading...",v(e,"class","progress is-link"),v(e,"max","100")},m(n,i){z(n,e,i)},p:te,i:te,o:te,d(n){n&&$(e)}}}function X0(t){let e,n,i,r,s,o;n=new Ru({props:{$$slots:{content:[j0]},$$scope:{ctx:t}}});const l=[H0,F0],a=[];function c(u,h){return u[2]?0:1}return r=c(t),s=a[r]=l[r](t),{c(){e=b("div"),ve(n.$$.fragment),i=j(),s.c(),v(e,"slot","content")},m(u,h){z(u,e,h),ge(n,e,null),y(e,i),a[r].m(e,null),o=!0},p(u,h){const f={};h&268435458&&(f.$$scope={dirty:h,ctx:u}),n.$set(f);let d=r;r=c(u),r===d?a[r].p(u,h):(tt(),K(a[d],1,1,()=>{a[d]=null}),nt(),s=a[r],s?s.p(u,h):(s=a[r]=l[r](u),s.c()),H(s,1),s.m(e,null))},i(u){o||(H(n.$$.fragment,u),H(s),o=!0)},o(u){K(n.$$.fragment,u),K(s),o=!1},d(u){u&&$(e),_e(n),a[r].d()}}}function J0(t){let e,n;return e=new Bu({props:{tabList:t[9],$$slots:{content:[X0,({activeTab:i})=>({23:i}),({activeTab:i})=>i?8388608:0],sidebar:[z0,({activeTab:i})=>({23:i}),({activeTab:i})=>i?8388608:0]},$$scope:{ctx:t}}}),{c(){ve(e.$$.fragment)},m(i,r){ge(e,i,r),n=!0},p(i,[r]){const s={};r&276824079&&(s.$$scope={dirty:r,ctx:i}),e.$set(s)},i(i){n||(H(e.$$.fragment,i),n=!0)},o(i){K(e.$$.fragment,i),n=!1},d(i){_e(e,i)}}}function Q0(t,e,n){var L;let i,r,s,{docSet:o}=e;const l=j_(o.id),{error:a,fetchPairs:c,selectedRegions:u,selectedCategories:h,threshold:f,topK:d,mutualTopK:m,scoreMode:p}=l;xe(t,a,O=>n(2,r=O)),xe(t,c,O=>n(3,s=O));let g,_,S,C,w,k;Rn(()=>{g=Vn(u,"regions","set"),_=Vn(h,"categories","array",[1]),S=Vn(f,"threshold","number"),C=Vn(d,"topk","number"),w=Vn(m,"mutual","boolean"),k=Vn(p,"mode","string");const O=u.subscribe(g),F=h.subscribe(_),R=f.subscribe(S),I=d.subscribe(C),U=m.subscribe(w),P=p.subscribe(k);return()=>{O(),F(),R(),I(),U(),P()}});const{selected:T}=hr;xe(t,T,O=>n(1,i=O));const N=P0(l,hr),E={sim:B==="en"?"Copy Clusters":"Groupe de copies",mat:B==="en"?"Document Matrix":"Matrice de documents",img:B==="en"?"Image Network":"Réseau d'images",doc:B==="en"?"Document Network":"Réseau de documents"},x=((L=o==null?void 0:o.selection)==null?void 0:L.selected)||{Witness:{},Series:{},Work:{}};return $n("selectedDocuments",x),t.$$set=O=>{"docSet"in O&&n(0,o=O.docSet)},[o,i,r,s,l,a,c,T,N,E]}class Z0 extends Ve{constructor(e){super(),He(this,e,Q0,J0,ze,{docSet:0})}}new Z0({target:document.getElementById("document-set"),props:{docSet}});const db="";function e1(t){let e,n,i;return n=new Jn({props:{item:t[0],height:"full"}}),{c(){e=b("div"),ve(n.$$.fragment),v(e,"class","img-wrapper svelte-1duc3w1")},m(r,s){z(r,e,s),ge(n,e,null),i=!0},p(r,[s]){const o={};s&1&&(o.item=r[0]),n.$set(o)},i(r){i||(H(n.$$.fragment,r),i=!0)},o(r){K(n.$$.fragment,r),i=!1},d(r){r&&$(e),_e(n)}}}function t1(t,e,n){let{mainImgItem:i}=e;return t.$$set=r=>{"mainImgItem"in r&&n(0,i=r.mainImgItem)},[i]}class Qa extends Ve{constructor(e){super(),He(this,e,t1,e1,ze,{mainImgItem:0})}}const hb="";function n1(t){return{c:te,m:te,p:te,d:te}}function i1(t){let e,n=`${t[5][0]}%`,i=`${t[5][1]}%`,r=`${t[5][2]}%`,s=`${t[5][3]}%`;return{c(){e=b("div"),v(e,"class","modal-context-bbox svelte-zgr10j"),v(e,"aria-description",B==="fr"?"Position de la région extraite sur la page":"Position of the extracted region on the page"),We(e,"left",n),We(e,"top",i),We(e,"width",r),We(e,"height",s)},m(o,l){z(o,e,l)},p:te,d(o){o&&$(e)}}}function r1(t){return{c:te,m:te,p:te,d:te}}function s1(t){let e,n,i,r,s,o={ctx:t,current:null,token:null,hasCatch:!1,pending:r1,then:i1,catch:n1,value:5};return Er(t[1],o),{c(){e=b("div"),n=b("div"),i=b("img"),s=j(),o.block.c(),v(i,"class","card modal-context-full-page svelte-zgr10j"),At(i.src,r=t[0])||v(i,"src",r),v(i,"alt",B==="fr"?"Vue de la page d'où la région est extraite":"View of the page the region is extracted from"),v(n,"class","modal-context-wrapper svelte-zgr10j"),v(e,"class","modal-context-outer pb-4 svelte-zgr10j")},m(l,a){z(l,e,a),y(e,n),y(n,i),y(n,s),o.block.m(n,o.anchor=null),o.mount=()=>n,o.anchor=null},p(l,[a]){t=l,js(o,t,a)},i:te,o:te,d(l){l&&$(e),o.block.d(),o.token=null,o=null}}}function o1(t,e,n){let{mainImgItem:i}=e;const r=Kt(i.img,"full","full"),s=Cu(i.img),o=i.xywh.map(Number),l=fetch(s).then(a=>a.json()).then(a=>[o[0]/a.width,o[1]/a.height,o[2]/a.width,o[3]/a.height].map(c=>c*100));return t.$$set=a=>{"mainImgItem"in a&&n(2,i=a.mainImgItem)},[r,l,i]}class l1 extends Ve{constructor(e){super(),He(this,e,o1,s1,ze,{mainImgItem:2})}}const mb="";function Za(t,e,n){const i=t.slice();return i[13]=e[n].id,i[14]=e[n].label,i}function ec(t){let e,n,i=t[14]+"",r,s,o,l,a;function c(){return t[9](t[13])}return{c(){e=b("li"),n=b("a"),r=re(i),s=j(),v(n,"href",""),v(e,"class",o=t[13]===t[2]?"is-active":"")},m(u,h){z(u,e,h),y(e,n),y(n,r),y(e,s),l||(a=Ce(n,"click",sn(c)),l=!0)},p(u,h){t=u,h&4&&o!==(o=t[13]===t[2]?"is-active":"")&&v(e,"class",o)},d(u){u&&$(e),l=!1,a()}}}function a1(t){let e,n,i,r,s,o,l,a,c,u,h,f,d,m,p,g=t[3],_=[];for(let k=0;k<g.length;k+=1)_[k]=ec(Za(t,g,k));const S=[t[1][t[2]]||{}];var C=t[0][t[2]]||null;function w(k){let T={};for(let N=0;N<S.length;N+=1)T=As(T,S[N]);return{props:T}}return C&&(u=xi(C,w())),{c(){e=b("div"),n=b("div"),i=j(),r=b("div"),s=b("div"),o=b("div"),l=b("ul");for(let k=0;k<_.length;k+=1)_[k].c();a=j(),c=b("div"),u&&ve(u.$$.fragment),h=j(),f=b("button"),v(n,"class","modal-background"),v(o,"class","tabs is-centered"),We(o,"height","fit-content"),v(c,"class","ml-4 mr-4 modal-main-wrapper svelte-1uakzh2"),Ye(c,"pb-4",t[2]==="main"),v(s,"class","modal-inner svelte-1uakzh2"),v(r,"class","modal-content svelte-1uakzh2"),v(f,"class","modal-close is-large"),v(f,"aria-label","close"),v(e,"id","region-modal-wrapper"),v(e,"class","modal is-active")},m(k,T){z(k,e,T),y(e,n),y(e,i),y(e,r),y(r,s),y(s,o),y(o,l);for(let N=0;N<_.length;N+=1)_[N]&&_[N].m(l,null);y(s,a),y(s,c),u&&ge(u,c,null),y(e,h),y(e,f),d=!0,m||(p=[Ce(n,"click",t[6]),Ce(n,"keyup",t[5]),Ce(f,"click",t[6])],m=!0)},p(k,[T]){if(T&28){g=k[3];let E;for(E=0;E<g.length;E+=1){const x=Za(k,g,E);_[E]?_[E].p(x,T):(_[E]=ec(x),_[E].c(),_[E].m(l,null))}for(;E<_.length;E+=1)_[E].d(1);_.length=g.length}const N=T&6?fu(S,[du(k[1][k[2]]||{})]):{};if(T&5&&C!==(C=k[0][k[2]]||null)){if(u){tt();const E=u;K(E.$$.fragment,1,0,()=>{_e(E,1)}),nt()}C?(u=xi(C,w()),ve(u.$$.fragment),H(u.$$.fragment,1),ge(u,c,null)):u=null}else C&&u.$set(N);(!d||T&4)&&Ye(c,"pb-4",k[2]==="main")},i(k){d||(u&&H(u.$$.fragment,k),d=!0)},o(k){u&&K(u.$$.fragment,k),d=!1},d(k){k&&$(e),wt(_,k),u&&_e(u),m=!1,yt(p)}}}function c1(t,e,n){let i,{mainImgItem:r}=e,{compareImgItem:s}=e;const o=Ti(),l=s?["main","page","similarity","expansion"]:["main","page"],a={expansion:{fr:"Expansion de requête",en:"Query expansion"},similarity:{fr:"Comparaison",en:"Comparison"},page:{fr:"Vue de la page",en:"Page view"},main:{fr:"Vue principale",en:"Main view"}},c=l.map(g=>{var _;return{id:g,label:((_=a[g])==null?void 0:_[B])??"Main view"}}),u={main:Qa,page:l1};s&&Promise.all([fs(()=>Promise.resolve().then(()=>cy),void 0).then(g=>g.default),fs(()=>Promise.resolve().then(()=>Dy),void 0).then(g=>g.default)]).then(([g,_])=>{const S=Object.keys(u);l.filter(C=>!S.includes(C)).map(C=>n(0,u[C]=C==="expansion"?_:C==="similarity"?g:Qa,u))});const h={};l.map(g=>n(1,h[g]=g==="similarity"?{compareImgItem:s,mainImgItem:r}:{mainImgItem:r},h));const f=g=>n(2,i=g),d=g=>{g.key==="Escape"&&o("closeModal")},m=()=>o("closeModal");Rn(()=>{document.addEventListener("keyup",d)}),Dn(()=>{document.removeEventListener("keydown",d)});const p=g=>f(g);return t.$$set=g=>{"mainImgItem"in g&&n(7,r=g.mainImgItem),"compareImgItem"in g&&n(8,s=g.compareImgItem)},n(2,i=l[0]),[u,h,i,c,f,d,m,r,s,p]}class u1 extends Ve{constructor(e){super(),He(this,e,c1,a1,ze,{mainImgItem:7,compareImgItem:8})}}const pb="";function f1(t){let e,n,i,r,s,o,l,a,c,u,h;return n=new ji({props:{targetHtmlId:t[0],tooltipText:t[1]}}),{c(){e=b("div"),ve(n.$$.fragment),i=j(),r=b("button"),s=Wt("svg"),o=Wt("path"),l=Wt("path"),a=Wt("path"),v(o,"d","M53.6443 14.25C47.7042 5.33 37.7293 0 26.9801 0C16.2206 0 6.24576 5.33 0.305653 14.25L0 14.71L0.305653 15.17C6.24576 24.09 16.2206 29.42 26.9801 29.42C37.7293 29.42 47.7042 24.09 53.6443 15.16L53.95 14.71L53.6443 14.25ZM3.25025 14.71C7.63146 8.69001 14.0606 4.65 21.2641 3.22C20.0619 3.83 18.9411 4.62 17.963 5.59C15.5176 8.02 14.1625 11.25 14.1625 14.67C14.1625 18.11 15.5176 21.34 17.963 23.76C19.0124 24.79 20.1943 25.61 21.4781 26.23C14.1829 24.85 7.6824 20.78 3.25025 14.71ZM27.1125 22.64C22.7008 22.64 19.1041 19.08 19.1041 14.7C19.1041 12.59 19.9396 10.6 21.4475 9.10001C22.9555 7.60001 24.9729 6.77 27.1125 6.77C29.2522 6.77 31.2594 7.60001 32.7775 9.10001C34.2855 10.6 35.121 12.59 35.121 14.7C35.121 16.82 34.2855 18.82 32.7775 20.32C31.2594 21.81 29.242 22.64 27.1125 22.64ZM32.9915 26.14C34.204 25.53 35.3146 24.74 36.3029 23.77C38.7482 21.34 40.0932 18.11 40.0932 14.68C40.0932 9.75 37.281 5.47001 33.1647 3.32001C40.1747 4.81001 46.4102 8.83001 50.6896 14.71C46.3797 20.64 40.0728 24.67 32.9915 26.14Z"),v(o,"fill","black"),v(o,"class","svelte-19wutme"),v(l,"d","M26.9804 25.98C33.3222 25.98 38.4633 20.9343 38.4633 14.71C38.4633 8.48576 33.3222 3.44 26.9804 3.44C20.6386 3.44 15.4976 8.48576 15.4976 14.71C15.4976 20.9343 20.6386 25.98 26.9804 25.98Z"),v(l,"fill","black"),v(l,"class","svelte-19wutme"),v(a,"d","M17.9529 23.85L36.2928 5.85001"),v(a,"stroke","black"),v(a,"stroke-width","3"),v(a,"stroke-miterlimit","10"),v(a,"class","svelte-19wutme"),v(s,"width","54"),v(s,"height","30"),v(s,"viewBox","0 0 54 30"),v(s,"fill","none"),v(s,"xmlns","http://www.w3.org/2000/svg"),v(s,"class","svelte-19wutme"),v(r,"class","button tag svelte-19wutme"),v(r,"title",t[1]),v(e,"id",t[0])},m(f,d){z(f,e,d),ge(n,e,null),y(e,i),y(e,r),y(r,s),y(s,o),y(s,l),y(s,a),c=!0,u||(h=Ce(r,"click",t[2]),u=!0)},p:te,i(f){c||(H(n.$$.fragment,f),c=!0)},o(f){K(n.$$.fragment,f),c=!1},d(f){f&&$(e),_e(n),u=!1,h()}}}function d1(t,e,n){let i,r,{mainImgItem:s}=e,{compareImgItem:o=void 0}=e;$n("isInModal",!0);const l=`modal-opener-${window.crypto.randomUUID()}`,a=B==="fr"?"Vue détaillée":"Detailed view",c=(f,d)=>(f?(d=new u1({target:document.querySelector("body"),props:{mainImgItem:s,compareImgItem:o}}),d.$on("closeModal",h)):!f&&r!=null&&d.$destroy(),d),u=()=>n(5,i=!i),h=()=>n(5,i=!1);return t.$$set=f=>{"mainImgItem"in f&&n(3,s=f.mainImgItem),"compareImgItem"in f&&n(4,o=f.compareImgItem)},t.$$.update=()=>{t.$$.dirty&96&&n(6,r=c(i,r))},n(5,i=!1),[l,a,u,s,o,i,r]}class h1 extends Ve{constructor(e){super(),He(this,e,d1,f1,ze,{mainImgItem:3,compareImgItem:4})}}const m1=Object.freeze(Object.defineProperty({__proto__:null,default:h1},Symbol.toStringTag,{value:"Module"})),gb="";function p1(t){let e,n,i,r,s,o,l;return{c(){e=b("button"),n=b("span"),n.innerHTML='<span class="switch-control svelte-g5g8im"><span class="switch-spot"></span></span>',i=j(),r=b("span"),s=re(t[0]),v(n,"class","switch mr-2 svelte-g5g8im"),v(r,"class","label svelte-g5g8im"),v(e,"id",t[3]),v(e,"name",t[3]),v(e,"class","input-checkbox-wrapper is-flex is-align-items-center-is-justify-content-center p-2 pl-3 pr-3 svelte-g5g8im"),v(e,"aria-label",t[0]),Ye(e,"is-checked",t[2]),Ye(e,"is-clickable",t[1]),Ye(e,"button",t[1])},m(a,c){z(a,e,c),y(e,n),y(e,i),y(e,r),y(r,s),o||(l=Ce(e,"click",sn(t[4])),o=!0)},p(a,[c]){c&1&&je(s,a[0]),c&1&&v(e,"aria-label",a[0]),c&4&&Ye(e,"is-checked",a[2]),c&2&&Ye(e,"is-clickable",a[1]),c&2&&Ye(e,"button",a[1])},i:te,o:te,d(a){a&&$(e),o=!1,l()}}}function g1(t,e,n){let i,{toggleLabel:r}=e,{start:s=!1}=e,{buttonDisplay:o=!1}=e;const l=`input-toggle-${window.crypto.randomUUID()}`,a=Ti(),c=zt("resetTrigger")||void 0;c==null||c.subscribe(h);const u=()=>n(2,i=!i);function h(){n(2,i=s)}return t.$$set=f=>{"toggleLabel"in f&&n(0,r=f.toggleLabel),"start"in f&&n(5,s=f.start),"buttonDisplay"in f&&n(1,o=f.buttonDisplay)},t.$$.update=()=>{t.$$.dirty&32&&n(2,i=s),t.$$.dirty&4&&a("updateChecked",i)},[r,o,i,l,u,s]}class _1 extends Ve{constructor(e){super(),He(this,e,g1,p1,ze,{toggleLabel:0,start:5,buttonDisplay:1})}}/*! choices.js v11.1.0 | © 2025 Josh Johnson | https://github.com/jshjohnson/Choices#readme */var ms=function(t,e){return ms=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(n[r]=i[r])},ms(t,e)};function tc(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");ms(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}var Dt=function(){return Dt=Object.assign||function(e){for(var n,i=1,r=arguments.length;i<r;i++){n=arguments[i];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},Dt.apply(this,arguments)};function v1(t,e,n){if(n||arguments.length===2)for(var i=0,r=e.length,s;i<r;i++)(s||!(i in e))&&(s||(s=Array.prototype.slice.call(e,0,i)),s[i]=e[i]);return t.concat(s||Array.prototype.slice.call(e))}typeof SuppressedError=="function"&&SuppressedError;var _t={ADD_CHOICE:"ADD_CHOICE",REMOVE_CHOICE:"REMOVE_CHOICE",FILTER_CHOICES:"FILTER_CHOICES",ACTIVATE_CHOICES:"ACTIVATE_CHOICES",CLEAR_CHOICES:"CLEAR_CHOICES",ADD_GROUP:"ADD_GROUP",ADD_ITEM:"ADD_ITEM",REMOVE_ITEM:"REMOVE_ITEM",HIGHLIGHT_ITEM:"HIGHLIGHT_ITEM"},$t={showDropdown:"showDropdown",hideDropdown:"hideDropdown",change:"change",choice:"choice",search:"search",addItem:"addItem",removeItem:"removeItem",highlightItem:"highlightItem",highlightChoice:"highlightChoice",unhighlightItem:"unhighlightItem"},xt={TAB_KEY:9,SHIFT_KEY:16,BACK_KEY:46,DELETE_KEY:8,ENTER_KEY:13,A_KEY:65,ESC_KEY:27,UP_KEY:38,DOWN_KEY:40,PAGE_UP_KEY:33,PAGE_DOWN_KEY:34},y1=["fuseOptions","classNames"],Sn={Text:"text",SelectOne:"select-one",SelectMultiple:"select-multiple"},nc=function(t){return{type:_t.ADD_CHOICE,choice:t}},b1=function(t){return{type:_t.REMOVE_CHOICE,choice:t}},w1=function(t){return{type:_t.FILTER_CHOICES,results:t}},S1=function(t){return{type:_t.ACTIVATE_CHOICES,active:t}},k1=function(t){return{type:_t.ADD_GROUP,group:t}},ic=function(t){return{type:_t.ADD_ITEM,item:t}},rc=function(t){return{type:_t.REMOVE_ITEM,item:t}},mr=function(t,e){return{type:_t.HIGHLIGHT_ITEM,item:t,highlighted:e}},E1=function(t,e){return Math.floor(Math.random()*(e-t)+t)},sc=function(t){return Array.from({length:t},function(){return E1(0,36).toString(36)}).join("")},C1=function(t,e){var n=t.id||t.name&&"".concat(t.name,"-").concat(sc(2))||sc(4);return n=n.replace(/(:|\.|\[|\]|,)/g,""),n="".concat(e,"-").concat(n),n},I1=function(t,e,n){n===void 0&&(n=1);for(var i="".concat(n>0?"next":"previous","ElementSibling"),r=t[i];r;){if(r.matches(e))return r;r=r[i]}return null},x1=function(t,e,n){n===void 0&&(n=1);var i;return n>0?i=e.scrollTop+e.offsetHeight>=t.offsetTop+t.offsetHeight:i=t.offsetTop>=e.scrollTop,i},pr=function(t){if(typeof t!="string"){if(t==null)return"";if(typeof t=="object"){if("raw"in t)return pr(t.raw);if("trusted"in t)return t.trusted}return t}return t.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/'/g,"&#039;").replace(/"/g,"&quot;")},M1=function(){var t=document.createElement("div");return function(e){t.innerHTML=e.trim();for(var n=t.children[0];t.firstChild;)t.removeChild(t.firstChild);return n}}(),vi=function(t,e){return typeof t=="function"?t(pr(e),e):t},oc=function(t){return typeof t=="function"?t():t},An=function(t){if(typeof t=="string")return t;if(typeof t=="object"){if("trusted"in t)return t.trusted;if("raw"in t)return t.raw}return""},lc=function(t){if(typeof t=="string")return t;if(typeof t=="object"){if("escaped"in t)return t.escaped;if("trusted"in t)return t.trusted}return""},ps=function(t,e){return t?lc(e):pr(e)},fn=function(t,e,n){t.innerHTML=ps(e,n)},A1=function(t,e){var n=t.value,i=t.label,r=i===void 0?n:i,s=e.value,o=e.label,l=o===void 0?s:o;return An(r).localeCompare(An(l),[],{sensitivity:"base",ignorePunctuation:!0,numeric:!0})},T1=function(t,e){return t.rank-e.rank},N1=function(t,e,n){n===void 0&&(n=null);var i=new CustomEvent(e,{detail:n,bubbles:!0,cancelable:!0});return t.dispatchEvent(i)},P1=function(t,e){var n=Object.keys(t).sort(),i=Object.keys(e).sort();return n.filter(function(r){return i.indexOf(r)<0})},gr=function(t){return Array.isArray(t)?t:[t]},yi=function(t){return t&&Array.isArray(t)?t.map(function(e){return".".concat(e)}).join(""):".".concat(t)},Oe=function(t,e){var n;(n=t.classList).add.apply(n,gr(e))},tn=function(t,e){var n;(n=t.classList).remove.apply(n,gr(e))},O1=function(t){if(typeof t<"u")try{return JSON.parse(t)}catch{return t}return{}},L1=function(t,e,n){var i=t.itemEl;i&&(tn(i,n),Oe(i,e))},R1=function(){function t(e){var n=e.element,i=e.type,r=e.classNames;this.element=n,this.classNames=r,this.type=i,this.isActive=!1}return t.prototype.show=function(){return Oe(this.element,this.classNames.activeState),this.element.setAttribute("aria-expanded","true"),this.isActive=!0,this},t.prototype.hide=function(){return tn(this.element,this.classNames.activeState),this.element.setAttribute("aria-expanded","false"),this.isActive=!1,this},t}(),ac=function(){function t(e){var n=e.element,i=e.type,r=e.classNames,s=e.position;this.element=n,this.classNames=r,this.type=i,this.position=s,this.isOpen=!1,this.isFlipped=!1,this.isDisabled=!1,this.isLoading=!1}return t.prototype.shouldFlip=function(e,n){var i=!1;return this.position==="auto"?i=this.element.getBoundingClientRect().top-n>=0&&!window.matchMedia("(min-height: ".concat(e+1,"px)")).matches:this.position==="top"&&(i=!0),i},t.prototype.setActiveDescendant=function(e){this.element.setAttribute("aria-activedescendant",e)},t.prototype.removeActiveDescendant=function(){this.element.removeAttribute("aria-activedescendant")},t.prototype.open=function(e,n){Oe(this.element,this.classNames.openState),this.element.setAttribute("aria-expanded","true"),this.isOpen=!0,this.shouldFlip(e,n)&&(Oe(this.element,this.classNames.flippedState),this.isFlipped=!0)},t.prototype.close=function(){tn(this.element,this.classNames.openState),this.element.setAttribute("aria-expanded","false"),this.removeActiveDescendant(),this.isOpen=!1,this.isFlipped&&(tn(this.element,this.classNames.flippedState),this.isFlipped=!1)},t.prototype.addFocusState=function(){Oe(this.element,this.classNames.focusState)},t.prototype.removeFocusState=function(){tn(this.element,this.classNames.focusState)},t.prototype.enable=function(){tn(this.element,this.classNames.disabledState),this.element.removeAttribute("aria-disabled"),this.type===Sn.SelectOne&&this.element.setAttribute("tabindex","0"),this.isDisabled=!1},t.prototype.disable=function(){Oe(this.element,this.classNames.disabledState),this.element.setAttribute("aria-disabled","true"),this.type===Sn.SelectOne&&this.element.setAttribute("tabindex","-1"),this.isDisabled=!0},t.prototype.wrap=function(e){var n=this.element,i=e.parentNode;i&&(e.nextSibling?i.insertBefore(n,e.nextSibling):i.appendChild(n)),n.appendChild(e)},t.prototype.unwrap=function(e){var n=this.element,i=n.parentNode;i&&(i.insertBefore(e,n),i.removeChild(n))},t.prototype.addLoadingState=function(){Oe(this.element,this.classNames.loadingState),this.element.setAttribute("aria-busy","true"),this.isLoading=!0},t.prototype.removeLoadingState=function(){tn(this.element,this.classNames.loadingState),this.element.removeAttribute("aria-busy"),this.isLoading=!1},t}(),D1=function(){function t(e){var n=e.element,i=e.type,r=e.classNames,s=e.preventPaste;this.element=n,this.type=i,this.classNames=r,this.preventPaste=s,this.isFocussed=this.element.isEqualNode(document.activeElement),this.isDisabled=n.disabled,this._onPaste=this._onPaste.bind(this),this._onInput=this._onInput.bind(this),this._onFocus=this._onFocus.bind(this),this._onBlur=this._onBlur.bind(this)}return Object.defineProperty(t.prototype,"placeholder",{set:function(e){this.element.placeholder=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){return this.element.value},set:function(e){this.element.value=e},enumerable:!1,configurable:!0}),t.prototype.addEventListeners=function(){var e=this.element;e.addEventListener("paste",this._onPaste),e.addEventListener("input",this._onInput,{passive:!0}),e.addEventListener("focus",this._onFocus,{passive:!0}),e.addEventListener("blur",this._onBlur,{passive:!0})},t.prototype.removeEventListeners=function(){var e=this.element;e.removeEventListener("input",this._onInput),e.removeEventListener("paste",this._onPaste),e.removeEventListener("focus",this._onFocus),e.removeEventListener("blur",this._onBlur)},t.prototype.enable=function(){var e=this.element;e.removeAttribute("disabled"),this.isDisabled=!1},t.prototype.disable=function(){var e=this.element;e.setAttribute("disabled",""),this.isDisabled=!0},t.prototype.focus=function(){this.isFocussed||this.element.focus()},t.prototype.blur=function(){this.isFocussed&&this.element.blur()},t.prototype.clear=function(e){return e===void 0&&(e=!0),this.element.value="",e&&this.setWidth(),this},t.prototype.setWidth=function(){var e=this.element;e.style.minWidth="".concat(e.placeholder.length+1,"ch"),e.style.width="".concat(e.value.length+1,"ch")},t.prototype.setActiveDescendant=function(e){this.element.setAttribute("aria-activedescendant",e)},t.prototype.removeActiveDescendant=function(){this.element.removeAttribute("aria-activedescendant")},t.prototype._onInput=function(){this.type!==Sn.SelectOne&&this.setWidth()},t.prototype._onPaste=function(e){this.preventPaste&&e.preventDefault()},t.prototype._onFocus=function(){this.isFocussed=!0},t.prototype._onBlur=function(){this.isFocussed=!1},t}(),$1=4,cc=function(){function t(e){var n=e.element;this.element=n,this.scrollPos=this.element.scrollTop,this.height=this.element.offsetHeight}return t.prototype.prepend=function(e){var n=this.element.firstElementChild;n?this.element.insertBefore(e,n):this.element.append(e)},t.prototype.scrollToTop=function(){this.element.scrollTop=0},t.prototype.scrollToChildElement=function(e,n){var i=this;if(e){var r=this.element.offsetHeight,s=this.element.scrollTop+r,o=e.offsetHeight,l=e.offsetTop+o,a=n>0?this.element.scrollTop+l-s:e.offsetTop;requestAnimationFrame(function(){i._animateScroll(a,n)})}},t.prototype._scrollDown=function(e,n,i){var r=(i-e)/n,s=r>1?r:1;this.element.scrollTop=e+s},t.prototype._scrollUp=function(e,n,i){var r=(e-i)/n,s=r>1?r:1;this.element.scrollTop=e-s},t.prototype._animateScroll=function(e,n){var i=this,r=$1,s=this.element.scrollTop,o=!1;n>0?(this._scrollDown(s,r,e),s<e&&(o=!0)):(this._scrollUp(s,r,e),s>e&&(o=!0)),o&&requestAnimationFrame(function(){i._animateScroll(e,n)})},t}(),uc=function(){function t(e){var n=e.element,i=e.classNames;this.element=n,this.classNames=i,this.isDisabled=!1}return Object.defineProperty(t.prototype,"isActive",{get:function(){return this.element.dataset.choice==="active"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dir",{get:function(){return this.element.dir},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){return this.element.value},set:function(e){this.element.setAttribute("value",e),this.element.value=e},enumerable:!1,configurable:!0}),t.prototype.conceal=function(){var e=this.element;Oe(e,this.classNames.input),e.hidden=!0,e.tabIndex=-1;var n=e.getAttribute("style");n&&e.setAttribute("data-choice-orig-style",n),e.setAttribute("data-choice","active")},t.prototype.reveal=function(){var e=this.element;tn(e,this.classNames.input),e.hidden=!1,e.removeAttribute("tabindex");var n=e.getAttribute("data-choice-orig-style");n?(e.removeAttribute("data-choice-orig-style"),e.setAttribute("style",n)):e.removeAttribute("style"),e.removeAttribute("data-choice")},t.prototype.enable=function(){this.element.removeAttribute("disabled"),this.element.disabled=!1,this.isDisabled=!1},t.prototype.disable=function(){this.element.setAttribute("disabled",""),this.element.disabled=!0,this.isDisabled=!0},t.prototype.triggerEvent=function(e,n){N1(this.element,e,n||{})},t}(),z1=function(t){tc(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e}(uc),bi=function(t,e){return e===void 0&&(e=!0),typeof t>"u"?e:!!t},fc=function(t){if(typeof t=="string"&&(t=t.split(" ").filter(function(e){return e.length})),Array.isArray(t)&&t.length)return t},nn=function(t,e,n){if(n===void 0&&(n=!0),typeof t=="string"){var i=pr(t),r=n||i===t?t:{escaped:i,raw:t},s=nn({value:t,label:r,selected:!0},!1);return s}var o=t;if("choices"in o){if(!e)throw new TypeError("optGroup is not allowed");var l=o,a=l.choices.map(function(f){return nn(f,!1)}),c={id:0,label:An(l.label)||l.value,active:!!a.length,disabled:!!l.disabled,choices:a};return c}var u=o,h={id:0,group:null,score:0,rank:0,value:u.value,label:u.label||u.value,active:bi(u.active),selected:bi(u.selected,!1),disabled:bi(u.disabled,!1),placeholder:bi(u.placeholder,!1),highlighted:!1,labelClass:fc(u.labelClass),labelDescription:u.labelDescription,customProperties:u.customProperties};return h},j1=function(t){return t.tagName==="INPUT"},dc=function(t){return t.tagName==="SELECT"},F1=function(t){return t.tagName==="OPTION"},H1=function(t){return t.tagName==="OPTGROUP"},V1=function(t){tc(e,t);function e(n){var i=n.element,r=n.classNames,s=n.template,o=n.extractPlaceholder,l=t.call(this,{element:i,classNames:r})||this;return l.template=s,l.extractPlaceholder=o,l}return Object.defineProperty(e.prototype,"placeholderOption",{get:function(){return this.element.querySelector('option[value=""]')||this.element.querySelector("option[placeholder]")},enumerable:!1,configurable:!0}),e.prototype.addOptions=function(n){var i=this,r=document.createDocumentFragment();n.forEach(function(s){var o=s;if(!o.element){var l=i.template(o);r.appendChild(l),o.element=l}}),this.element.appendChild(r)},e.prototype.optionsAsChoices=function(){var n=this,i=[];return this.element.querySelectorAll(":scope > option, :scope > optgroup").forEach(function(r){F1(r)?i.push(n._optionToChoice(r)):H1(r)&&i.push(n._optgroupToChoice(r))}),i},e.prototype._optionToChoice=function(n){return!n.hasAttribute("value")&&n.hasAttribute("placeholder")&&(n.setAttribute("value",""),n.value=""),{id:0,group:null,score:0,rank:0,value:n.value,label:n.label,element:n,active:!0,selected:this.extractPlaceholder?n.selected:n.hasAttribute("selected"),disabled:n.disabled,highlighted:!1,placeholder:this.extractPlaceholder&&(!n.value||n.hasAttribute("placeholder")),labelClass:typeof n.dataset.labelClass<"u"?fc(n.dataset.labelClass):void 0,labelDescription:typeof n.dataset.labelDescription<"u"?n.dataset.labelDescription:void 0,customProperties:O1(n.dataset.customProperties)}},e.prototype._optgroupToChoice=function(n){var i=this,r=n.querySelectorAll("option"),s=Array.from(r).map(function(o){return i._optionToChoice(o)});return{id:0,label:n.label||"",element:n,active:!!s.length,disabled:n.disabled,choices:s}},e}(uc),U1={containerOuter:["choices"],containerInner:["choices__inner"],input:["choices__input"],inputCloned:["choices__input--cloned"],list:["choices__list"],listItems:["choices__list--multiple"],listSingle:["choices__list--single"],listDropdown:["choices__list--dropdown"],item:["choices__item"],itemSelectable:["choices__item--selectable"],itemDisabled:["choices__item--disabled"],itemChoice:["choices__item--choice"],description:["choices__description"],placeholder:["choices__placeholder"],group:["choices__group"],groupHeading:["choices__heading"],button:["choices__button"],activeState:["is-active"],focusState:["is-focused"],openState:["is-open"],disabledState:["is-disabled"],highlightedState:["is-highlighted"],selectedState:["is-selected"],flippedState:["is-flipped"],loadingState:["is-loading"],notice:["choices__notice"],addChoice:["choices__item--selectable","add-choice"],noResults:["has-no-results"],noChoices:["has-no-choices"]},hc={items:[],choices:[],silent:!1,renderChoiceLimit:-1,maxItemCount:-1,closeDropdownOnSelect:"auto",singleModeForMultiSelect:!1,addChoices:!1,addItems:!0,addItemFilter:function(t){return!!t&&t!==""},removeItems:!0,removeItemButton:!1,removeItemButtonAlignLeft:!1,editItems:!1,allowHTML:!1,allowHtmlUserInput:!1,duplicateItemsAllowed:!0,delimiter:",",paste:!0,searchEnabled:!0,searchChoices:!0,searchFloor:1,searchResultLimit:4,searchFields:["label","value"],position:"auto",resetScrollPosition:!0,shouldSort:!0,shouldSortItems:!1,sorter:A1,shadowRoot:null,placeholder:!0,placeholderValue:null,searchPlaceholderValue:null,prependValue:null,appendValue:null,renderSelectedChoices:"auto",loadingText:"Loading...",noResultsText:"No results found",noChoicesText:"No choices to choose from",itemSelectText:"Press to select",uniqueItemText:"Only unique values can be added",customAddItemText:"Only values matching specific conditions can be added",addItemText:function(t){return'Press Enter to add <b>"'.concat(t,'"</b>')},removeItemIconText:function(){return"Remove item"},removeItemLabelText:function(t){return"Remove item: ".concat(t)},maxItemText:function(t){return"Only ".concat(t," values can be added")},valueComparer:function(t,e){return t===e},fuseOptions:{includeScore:!0},labelId:"",callbackOnInit:null,callbackOnCreateTemplates:null,classNames:U1,appendGroupInSearch:!1},mc=function(t){var e=t.itemEl;e&&(e.remove(),t.itemEl=void 0)};function B1(t,e,n){var i=t,r=!0;switch(e.type){case _t.ADD_ITEM:{e.item.selected=!0;var s=e.item.element;s&&(s.selected=!0,s.setAttribute("selected","")),i.push(e.item);break}case _t.REMOVE_ITEM:{e.item.selected=!1;var s=e.item.element;if(s){s.selected=!1,s.removeAttribute("selected");var o=s.parentElement;o&&dc(o)&&o.type===Sn.SelectOne&&(o.value="")}mc(e.item),i=i.filter(function(u){return u.id!==e.item.id});break}case _t.REMOVE_CHOICE:{mc(e.choice),i=i.filter(function(c){return c.id!==e.choice.id});break}case _t.HIGHLIGHT_ITEM:{var l=e.highlighted,a=i.find(function(c){return c.id===e.item.id});a&&a.highlighted!==l&&(a.highlighted=l,n&&L1(a,l?n.classNames.highlightedState:n.classNames.selectedState,l?n.classNames.selectedState:n.classNames.highlightedState));break}default:{r=!1;break}}return{state:i,update:r}}function q1(t,e){var n=t,i=!0;switch(e.type){case _t.ADD_GROUP:{n.push(e.group);break}case _t.CLEAR_CHOICES:{n=[];break}default:{i=!1;break}}return{state:n,update:i}}function K1(t,e,n){var i=t,r=!0;switch(e.type){case _t.ADD_CHOICE:{i.push(e.choice);break}case _t.REMOVE_CHOICE:{e.choice.choiceEl=void 0,e.choice.group&&(e.choice.group.choices=e.choice.group.choices.filter(function(o){return o.id!==e.choice.id})),i=i.filter(function(o){return o.id!==e.choice.id});break}case _t.ADD_ITEM:case _t.REMOVE_ITEM:{e.item.choiceEl=void 0;break}case _t.FILTER_CHOICES:{var s=[];e.results.forEach(function(o){s[o.item.id]=o}),i.forEach(function(o){var l=s[o.id];l!==void 0?(o.score=l.score,o.rank=l.rank,o.active=!0):(o.score=0,o.rank=0,o.active=!1),n&&n.appendGroupInSearch&&(o.choiceEl=void 0)});break}case _t.ACTIVATE_CHOICES:{i.forEach(function(o){o.active=e.active,n&&n.appendGroupInSearch&&(o.choiceEl=void 0)});break}case _t.CLEAR_CHOICES:{i=[];break}default:{r=!1;break}}return{state:i,update:r}}var pc={groups:q1,items:B1,choices:K1},W1=function(){function t(e){this._state=this.defaultState,this._listeners=[],this._txn=0,this._context=e}return Object.defineProperty(t.prototype,"defaultState",{get:function(){return{groups:[],items:[],choices:[]}},enumerable:!1,configurable:!0}),t.prototype.changeSet=function(e){return{groups:e,items:e,choices:e}},t.prototype.reset=function(){this._state=this.defaultState;var e=this.changeSet(!0);this._txn?this._changeSet=e:this._listeners.forEach(function(n){return n(e)})},t.prototype.subscribe=function(e){return this._listeners.push(e),this},t.prototype.dispatch=function(e){var n=this,i=this._state,r=!1,s=this._changeSet||this.changeSet(!1);Object.keys(pc).forEach(function(o){var l=pc[o](i[o],e,n._context);l.update&&(r=!0,s[o]=!0,i[o]=l.state)}),r&&(this._txn?this._changeSet=s:this._listeners.forEach(function(o){return o(s)}))},t.prototype.withTxn=function(e){this._txn++;try{e()}finally{if(this._txn=Math.max(0,this._txn-1),!this._txn){var n=this._changeSet;n&&(this._changeSet=void 0,this._listeners.forEach(function(i){return i(n)}))}}},Object.defineProperty(t.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"items",{get:function(){return this.state.items},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"highlightedActiveItems",{get:function(){return this.items.filter(function(e){return e.active&&e.highlighted})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"choices",{get:function(){return this.state.choices},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"activeChoices",{get:function(){return this.choices.filter(function(e){return e.active})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"searchableChoices",{get:function(){return this.choices.filter(function(e){return!e.disabled&&!e.placeholder})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"groups",{get:function(){return this.state.groups},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"activeGroups",{get:function(){var e=this;return this.state.groups.filter(function(n){var i=n.active&&!n.disabled,r=e.state.choices.some(function(s){return s.active&&!s.disabled});return i&&r},[])},enumerable:!1,configurable:!0}),t.prototype.inTxn=function(){return this._txn>0},t.prototype.getChoiceById=function(e){return this.activeChoices.find(function(n){return n.id===e})},t.prototype.getGroupById=function(e){return this.groups.find(function(n){return n.id===e})},t}(),Et={noChoices:"no-choices",noResults:"no-results",addChoice:"add-choice",generic:""};function Y1(t,e,n){return(e=X1(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function gc(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function Qn(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?gc(Object(n),!0).forEach(function(i){Y1(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):gc(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}function G1(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var i=n.call(t,e||"default");if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function X1(t){var e=G1(t,"string");return typeof e=="symbol"?e:e+""}function dn(t){return Array.isArray?Array.isArray(t):yc(t)==="[object Array]"}const J1=1/0;function Q1(t){if(typeof t=="string")return t;let e=t+"";return e=="0"&&1/t==-J1?"-0":e}function Z1(t){return t==null?"":Q1(t)}function rn(t){return typeof t=="string"}function _c(t){return typeof t=="number"}function ev(t){return t===!0||t===!1||tv(t)&&yc(t)=="[object Boolean]"}function vc(t){return typeof t=="object"}function tv(t){return vc(t)&&t!==null}function Ht(t){return t!=null}function gs(t){return!t.trim().length}function yc(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(t)}const _b="Extended search is not available",nv="Incorrect 'index' type",iv=t=>`Invalid value for key ${t}`,rv=t=>`Pattern length exceeds max of ${t}.`,sv=t=>`Missing ${t} property in key`,ov=t=>`Property 'weight' in key '${t}' must be a positive integer`,bc=Object.prototype.hasOwnProperty;class lv{constructor(e){this._keys=[],this._keyMap={};let n=0;e.forEach(i=>{let r=wc(i);this._keys.push(r),this._keyMap[r.id]=r,n+=r.weight}),this._keys.forEach(i=>{i.weight/=n})}get(e){return this._keyMap[e]}keys(){return this._keys}toJSON(){return JSON.stringify(this._keys)}}function wc(t){let e=null,n=null,i=null,r=1,s=null;if(rn(t)||dn(t))i=t,e=Sc(t),n=_s(t);else{if(!bc.call(t,"name"))throw new Error(sv("name"));const o=t.name;if(i=o,bc.call(t,"weight")&&(r=t.weight,r<=0))throw new Error(ov(o));e=Sc(o),n=_s(o),s=t.getFn}return{path:e,id:n,weight:r,src:i,getFn:s}}function Sc(t){return dn(t)?t:t.split(".")}function _s(t){return dn(t)?t.join("."):t}function av(t,e){let n=[],i=!1;const r=(s,o,l)=>{if(Ht(s))if(!o[l])n.push(s);else{let a=o[l];const c=s[a];if(!Ht(c))return;if(l===o.length-1&&(rn(c)||_c(c)||ev(c)))n.push(Z1(c));else if(dn(c)){i=!0;for(let u=0,h=c.length;u<h;u+=1)r(c[u],o,l+1)}else o.length&&r(c,o,l+1)}};return r(t,rn(e)?e.split("."):e,0),i?n:n[0]}const cv={includeMatches:!1,findAllMatches:!1,minMatchCharLength:1},uv={isCaseSensitive:!1,includeScore:!1,keys:[],shouldSort:!0,sortFn:(t,e)=>t.score===e.score?t.idx<e.idx?-1:1:t.score<e.score?-1:1},fv={location:0,threshold:.6,distance:100},dv={useExtendedSearch:!1,getFn:av,ignoreLocation:!1,ignoreFieldNorm:!1,fieldNormWeight:1};var Me=Qn(Qn(Qn(Qn({},uv),cv),fv),dv);const hv=/[^ ]+/g;function mv(t=1,e=3){const n=new Map,i=Math.pow(10,e);return{get(r){const s=r.match(hv).length;if(n.has(s))return n.get(s);const o=1/Math.pow(s,.5*t),l=parseFloat(Math.round(o*i)/i);return n.set(s,l),l},clear(){n.clear()}}}class vs{constructor({getFn:e=Me.getFn,fieldNormWeight:n=Me.fieldNormWeight}={}){this.norm=mv(n,3),this.getFn=e,this.isCreated=!1,this.setIndexRecords()}setSources(e=[]){this.docs=e}setIndexRecords(e=[]){this.records=e}setKeys(e=[]){this.keys=e,this._keysMap={},e.forEach((n,i)=>{this._keysMap[n.id]=i})}create(){this.isCreated||!this.docs.length||(this.isCreated=!0,rn(this.docs[0])?this.docs.forEach((e,n)=>{this._addString(e,n)}):this.docs.forEach((e,n)=>{this._addObject(e,n)}),this.norm.clear())}add(e){const n=this.size();rn(e)?this._addString(e,n):this._addObject(e,n)}removeAt(e){this.records.splice(e,1);for(let n=e,i=this.size();n<i;n+=1)this.records[n].i-=1}getValueForItemAtKeyId(e,n){return e[this._keysMap[n]]}size(){return this.records.length}_addString(e,n){if(!Ht(e)||gs(e))return;let i={v:e,i:n,n:this.norm.get(e)};this.records.push(i)}_addObject(e,n){let i={i:n,$:{}};this.keys.forEach((r,s)=>{let o=r.getFn?r.getFn(e):this.getFn(e,r.path);if(Ht(o)){if(dn(o)){let l=[];const a=[{nestedArrIndex:-1,value:o}];for(;a.length;){const{nestedArrIndex:c,value:u}=a.pop();if(Ht(u))if(rn(u)&&!gs(u)){let h={v:u,i:c,n:this.norm.get(u)};l.push(h)}else dn(u)&&u.forEach((h,f)=>{a.push({nestedArrIndex:f,value:h})})}i.$[s]=l}else if(rn(o)&&!gs(o)){let l={v:o,n:this.norm.get(o)};i.$[s]=l}}}),this.records.push(i)}toJSON(){return{keys:this.keys,records:this.records}}}function kc(t,e,{getFn:n=Me.getFn,fieldNormWeight:i=Me.fieldNormWeight}={}){const r=new vs({getFn:n,fieldNormWeight:i});return r.setKeys(t.map(wc)),r.setSources(e),r.create(),r}function pv(t,{getFn:e=Me.getFn,fieldNormWeight:n=Me.fieldNormWeight}={}){const{keys:i,records:r}=t,s=new vs({getFn:e,fieldNormWeight:n});return s.setKeys(i),s.setIndexRecords(r),s}function _r(t,{errors:e=0,currentLocation:n=0,expectedLocation:i=0,distance:r=Me.distance,ignoreLocation:s=Me.ignoreLocation}={}){const o=e/t.length;if(s)return o;const l=Math.abs(i-n);return r?o+l/r:l?1:o}function gv(t=[],e=Me.minMatchCharLength){let n=[],i=-1,r=-1,s=0;for(let o=t.length;s<o;s+=1){let l=t[s];l&&i===-1?i=s:!l&&i!==-1&&(r=s-1,r-i+1>=e&&n.push([i,r]),i=-1)}return t[s-1]&&s-i>=e&&n.push([i,s-1]),n}const Tn=32;function _v(t,e,n,{location:i=Me.location,distance:r=Me.distance,threshold:s=Me.threshold,findAllMatches:o=Me.findAllMatches,minMatchCharLength:l=Me.minMatchCharLength,includeMatches:a=Me.includeMatches,ignoreLocation:c=Me.ignoreLocation}={}){if(e.length>Tn)throw new Error(rv(Tn));const u=e.length,h=t.length,f=Math.max(0,Math.min(i,h));let d=s,m=f;const p=l>1||a,g=p?Array(h):[];let _;for(;(_=t.indexOf(e,m))>-1;){let N=_r(e,{currentLocation:_,expectedLocation:f,distance:r,ignoreLocation:c});if(d=Math.min(N,d),m=_+u,p){let E=0;for(;E<u;)g[_+E]=1,E+=1}}m=-1;let S=[],C=1,w=u+h;const k=1<<u-1;for(let N=0;N<u;N+=1){let E=0,x=w;for(;E<x;)_r(e,{errors:N,currentLocation:f+x,expectedLocation:f,distance:r,ignoreLocation:c})<=d?E=x:w=x,x=Math.floor((w-E)/2+E);w=x;let L=Math.max(1,f-x+1),O=o?h:Math.min(f+x,h)+u,F=Array(O+2);F[O+1]=(1<<N)-1;for(let I=O;I>=L;I-=1){let U=I-1,P=n[t.charAt(U)];if(p&&(g[U]=+!!P),F[I]=(F[I+1]<<1|1)&P,N&&(F[I]|=(S[I+1]|S[I])<<1|1|S[I+1]),F[I]&k&&(C=_r(e,{errors:N,currentLocation:U,expectedLocation:f,distance:r,ignoreLocation:c}),C<=d)){if(d=C,m=U,m<=f)break;L=Math.max(1,2*f-m)}}if(_r(e,{errors:N+1,currentLocation:f,expectedLocation:f,distance:r,ignoreLocation:c})>d)break;S=F}const T={isMatch:m>=0,score:Math.max(.001,C)};if(p){const N=gv(g,l);N.length?a&&(T.indices=N):T.isMatch=!1}return T}function vv(t){let e={};for(let n=0,i=t.length;n<i;n+=1){const r=t.charAt(n);e[r]=(e[r]||0)|1<<i-n-1}return e}class Ec{constructor(e,{location:n=Me.location,threshold:i=Me.threshold,distance:r=Me.distance,includeMatches:s=Me.includeMatches,findAllMatches:o=Me.findAllMatches,minMatchCharLength:l=Me.minMatchCharLength,isCaseSensitive:a=Me.isCaseSensitive,ignoreLocation:c=Me.ignoreLocation}={}){if(this.options={location:n,threshold:i,distance:r,includeMatches:s,findAllMatches:o,minMatchCharLength:l,isCaseSensitive:a,ignoreLocation:c},this.pattern=a?e:e.toLowerCase(),this.chunks=[],!this.pattern.length)return;const u=(f,d)=>{this.chunks.push({pattern:f,alphabet:vv(f),startIndex:d})},h=this.pattern.length;if(h>Tn){let f=0;const d=h%Tn,m=h-d;for(;f<m;)u(this.pattern.substr(f,Tn),f),f+=Tn;if(d){const p=h-Tn;u(this.pattern.substr(p),p)}}else u(this.pattern,0)}searchIn(e){const{isCaseSensitive:n,includeMatches:i}=this.options;if(n||(e=e.toLowerCase()),this.pattern===e){let m={isMatch:!0,score:0};return i&&(m.indices=[[0,e.length-1]]),m}const{location:r,distance:s,threshold:o,findAllMatches:l,minMatchCharLength:a,ignoreLocation:c}=this.options;let u=[],h=0,f=!1;this.chunks.forEach(({pattern:m,alphabet:p,startIndex:g})=>{const{isMatch:_,score:S,indices:C}=_v(e,m,p,{location:r+g,distance:s,threshold:o,findAllMatches:l,minMatchCharLength:a,includeMatches:i,ignoreLocation:c});_&&(f=!0),h+=S,_&&C&&(u=[...u,...C])});let d={isMatch:f,score:f?h/this.chunks.length:1};return f&&i&&(d.indices=u),d}}class kn{constructor(e){this.pattern=e}static isMultiMatch(e){return Cc(e,this.multiRegex)}static isSingleMatch(e){return Cc(e,this.singleRegex)}search(){}}function Cc(t,e){const n=t.match(e);return n?n[1]:null}class yv extends kn{constructor(e){super(e)}static get type(){return"exact"}static get multiRegex(){return/^="(.*)"$/}static get singleRegex(){return/^=(.*)$/}search(e){const n=e===this.pattern;return{isMatch:n,score:n?0:1,indices:[0,this.pattern.length-1]}}}class bv extends kn{constructor(e){super(e)}static get type(){return"inverse-exact"}static get multiRegex(){return/^!"(.*)"$/}static get singleRegex(){return/^!(.*)$/}search(e){const i=e.indexOf(this.pattern)===-1;return{isMatch:i,score:i?0:1,indices:[0,e.length-1]}}}class wv extends kn{constructor(e){super(e)}static get type(){return"prefix-exact"}static get multiRegex(){return/^\^"(.*)"$/}static get singleRegex(){return/^\^(.*)$/}search(e){const n=e.startsWith(this.pattern);return{isMatch:n,score:n?0:1,indices:[0,this.pattern.length-1]}}}class Sv extends kn{constructor(e){super(e)}static get type(){return"inverse-prefix-exact"}static get multiRegex(){return/^!\^"(.*)"$/}static get singleRegex(){return/^!\^(.*)$/}search(e){const n=!e.startsWith(this.pattern);return{isMatch:n,score:n?0:1,indices:[0,e.length-1]}}}class kv extends kn{constructor(e){super(e)}static get type(){return"suffix-exact"}static get multiRegex(){return/^"(.*)"\$$/}static get singleRegex(){return/^(.*)\$$/}search(e){const n=e.endsWith(this.pattern);return{isMatch:n,score:n?0:1,indices:[e.length-this.pattern.length,e.length-1]}}}class Ev extends kn{constructor(e){super(e)}static get type(){return"inverse-suffix-exact"}static get multiRegex(){return/^!"(.*)"\$$/}static get singleRegex(){return/^!(.*)\$$/}search(e){const n=!e.endsWith(this.pattern);return{isMatch:n,score:n?0:1,indices:[0,e.length-1]}}}class Ic extends kn{constructor(e,{location:n=Me.location,threshold:i=Me.threshold,distance:r=Me.distance,includeMatches:s=Me.includeMatches,findAllMatches:o=Me.findAllMatches,minMatchCharLength:l=Me.minMatchCharLength,isCaseSensitive:a=Me.isCaseSensitive,ignoreLocation:c=Me.ignoreLocation}={}){super(e),this._bitapSearch=new Ec(e,{location:n,threshold:i,distance:r,includeMatches:s,findAllMatches:o,minMatchCharLength:l,isCaseSensitive:a,ignoreLocation:c})}static get type(){return"fuzzy"}static get multiRegex(){return/^"(.*)"$/}static get singleRegex(){return/^(.*)$/}search(e){return this._bitapSearch.searchIn(e)}}class xc extends kn{constructor(e){super(e)}static get type(){return"include"}static get multiRegex(){return/^'"(.*)"$/}static get singleRegex(){return/^'(.*)$/}search(e){let n=0,i;const r=[],s=this.pattern.length;for(;(i=e.indexOf(this.pattern,n))>-1;)n=i+s,r.push([i,n-1]);const o=!!r.length;return{isMatch:o,score:o?0:1,indices:r}}}const ys=[yv,xc,wv,Sv,Ev,kv,bv,Ic],Mc=ys.length,Cv=/ +(?=(?:[^\"]*\"[^\"]*\")*[^\"]*$)/,Iv="|";function xv(t,e={}){return t.split(Iv).map(n=>{let i=n.trim().split(Cv).filter(s=>s&&!!s.trim()),r=[];for(let s=0,o=i.length;s<o;s+=1){const l=i[s];let a=!1,c=-1;for(;!a&&++c<Mc;){const u=ys[c];let h=u.isMultiMatch(l);h&&(r.push(new u(h,e)),a=!0)}if(!a)for(c=-1;++c<Mc;){const u=ys[c];let h=u.isSingleMatch(l);if(h){r.push(new u(h,e));break}}}return r})}const Mv=new Set([Ic.type,xc.type]);class Av{constructor(e,{isCaseSensitive:n=Me.isCaseSensitive,includeMatches:i=Me.includeMatches,minMatchCharLength:r=Me.minMatchCharLength,ignoreLocation:s=Me.ignoreLocation,findAllMatches:o=Me.findAllMatches,location:l=Me.location,threshold:a=Me.threshold,distance:c=Me.distance}={}){this.query=null,this.options={isCaseSensitive:n,includeMatches:i,minMatchCharLength:r,findAllMatches:o,ignoreLocation:s,location:l,threshold:a,distance:c},this.pattern=n?e:e.toLowerCase(),this.query=xv(this.pattern,this.options)}static condition(e,n){return n.useExtendedSearch}searchIn(e){const n=this.query;if(!n)return{isMatch:!1,score:1};const{includeMatches:i,isCaseSensitive:r}=this.options;e=r?e:e.toLowerCase();let s=0,o=[],l=0;for(let a=0,c=n.length;a<c;a+=1){const u=n[a];o.length=0,s=0;for(let h=0,f=u.length;h<f;h+=1){const d=u[h],{isMatch:m,indices:p,score:g}=d.search(e);if(m){if(s+=1,l+=g,i){const _=d.constructor.type;Mv.has(_)?o=[...o,...p]:o.push(p)}}else{l=0,s=0,o.length=0;break}}if(s){let h={isMatch:!0,score:l/s};return i&&(h.indices=o),h}}return{isMatch:!1,score:1}}}const bs=[];function Tv(...t){bs.push(...t)}function ws(t,e){for(let n=0,i=bs.length;n<i;n+=1){let r=bs[n];if(r.condition(t,e))return new r(t,e)}return new Ec(t,e)}const vr={AND:"$and",OR:"$or"},Ss={PATH:"$path",PATTERN:"$val"},ks=t=>!!(t[vr.AND]||t[vr.OR]),Nv=t=>!!t[Ss.PATH],Pv=t=>!dn(t)&&vc(t)&&!ks(t),Ac=t=>({[vr.AND]:Object.keys(t).map(e=>({[e]:t[e]}))});function Tc(t,e,{auto:n=!0}={}){const i=r=>{let s=Object.keys(r);const o=Nv(r);if(!o&&s.length>1&&!ks(r))return i(Ac(r));if(Pv(r)){const a=o?r[Ss.PATH]:s[0],c=o?r[Ss.PATTERN]:r[a];if(!rn(c))throw new Error(iv(a));const u={keyId:_s(a),pattern:c};return n&&(u.searcher=ws(c,e)),u}let l={children:[],operator:s[0]};return s.forEach(a=>{const c=r[a];dn(c)&&c.forEach(u=>{l.children.push(i(u))})}),l};return ks(t)||(t=Ac(t)),i(t)}function Ov(t,{ignoreFieldNorm:e=Me.ignoreFieldNorm}){t.forEach(n=>{let i=1;n.matches.forEach(({key:r,norm:s,score:o})=>{const l=r?r.weight:null;i*=Math.pow(o===0&&l?Number.EPSILON:o,(l||1)*(e?1:s))}),n.score=i})}function Lv(t,e){const n=t.matches;e.matches=[],Ht(n)&&n.forEach(i=>{if(!Ht(i.indices)||!i.indices.length)return;const{indices:r,value:s}=i;let o={indices:r,value:s};i.key&&(o.key=i.key.src),i.idx>-1&&(o.refIndex=i.idx),e.matches.push(o)})}function Rv(t,e){e.score=t.score}function Dv(t,e,{includeMatches:n=Me.includeMatches,includeScore:i=Me.includeScore}={}){const r=[];return n&&r.push(Lv),i&&r.push(Rv),t.map(s=>{const{idx:o}=s,l={item:e[o],refIndex:o};return r.length&&r.forEach(a=>{a(s,l)}),l})}class Zn{constructor(e,n={},i){this.options=Qn(Qn({},Me),n),this.options.useExtendedSearch,this._keyStore=new lv(this.options.keys),this.setCollection(e,i)}setCollection(e,n){if(this._docs=e,n&&!(n instanceof vs))throw new Error(nv);this._myIndex=n||kc(this.options.keys,this._docs,{getFn:this.options.getFn,fieldNormWeight:this.options.fieldNormWeight})}add(e){Ht(e)&&(this._docs.push(e),this._myIndex.add(e))}remove(e=()=>!1){const n=[];for(let i=0,r=this._docs.length;i<r;i+=1){const s=this._docs[i];e(s,i)&&(this.removeAt(i),i-=1,r-=1,n.push(s))}return n}removeAt(e){this._docs.splice(e,1),this._myIndex.removeAt(e)}getIndex(){return this._myIndex}search(e,{limit:n=-1}={}){const{includeMatches:i,includeScore:r,shouldSort:s,sortFn:o,ignoreFieldNorm:l}=this.options;let a=rn(e)?rn(this._docs[0])?this._searchStringList(e):this._searchObjectList(e):this._searchLogical(e);return Ov(a,{ignoreFieldNorm:l}),s&&a.sort(o),_c(n)&&n>-1&&(a=a.slice(0,n)),Dv(a,this._docs,{includeMatches:i,includeScore:r})}_searchStringList(e){const n=ws(e,this.options),{records:i}=this._myIndex,r=[];return i.forEach(({v:s,i:o,n:l})=>{if(!Ht(s))return;const{isMatch:a,score:c,indices:u}=n.searchIn(s);a&&r.push({item:s,idx:o,matches:[{score:c,value:s,norm:l,indices:u}]})}),r}_searchLogical(e){const n=Tc(e,this.options),i=(l,a,c)=>{if(!l.children){const{keyId:h,searcher:f}=l,d=this._findMatches({key:this._keyStore.get(h),value:this._myIndex.getValueForItemAtKeyId(a,h),searcher:f});return d&&d.length?[{idx:c,item:a,matches:d}]:[]}const u=[];for(let h=0,f=l.children.length;h<f;h+=1){const d=l.children[h],m=i(d,a,c);if(m.length)u.push(...m);else if(l.operator===vr.AND)return[]}return u},r=this._myIndex.records,s={},o=[];return r.forEach(({$:l,i:a})=>{if(Ht(l)){let c=i(n,l,a);c.length&&(s[a]||(s[a]={idx:a,item:l,matches:[]},o.push(s[a])),c.forEach(({matches:u})=>{s[a].matches.push(...u)}))}}),o}_searchObjectList(e){const n=ws(e,this.options),{keys:i,records:r}=this._myIndex,s=[];return r.forEach(({$:o,i:l})=>{if(!Ht(o))return;let a=[];i.forEach((c,u)=>{a.push(...this._findMatches({key:c,value:o[u],searcher:n}))}),a.length&&s.push({idx:l,item:o,matches:a})}),s}_findMatches({key:e,value:n,searcher:i}){if(!Ht(n))return[];let r=[];if(dn(n))n.forEach(({v:s,i:o,n:l})=>{if(!Ht(s))return;const{isMatch:a,score:c,indices:u}=i.searchIn(s);a&&r.push({score:c,key:e,value:s,idx:o,norm:l,indices:u})});else{const{v:s,n:o}=n,{isMatch:l,score:a,indices:c}=i.searchIn(s);l&&r.push({score:a,key:e,value:s,norm:o,indices:c})}return r}}Zn.version="7.0.0",Zn.createIndex=kc,Zn.parseIndex=pv,Zn.config=Me,Zn.parseQuery=Tc,Tv(Av);var $v=function(){function t(e){this._haystack=[],this._fuseOptions=Dt(Dt({},e.fuseOptions),{keys:v1([],e.searchFields,!0),includeMatches:!0})}return t.prototype.index=function(e){this._haystack=e,this._fuse&&this._fuse.setCollection(e)},t.prototype.reset=function(){this._haystack=[],this._fuse=void 0},t.prototype.isEmptyIndex=function(){return!this._haystack.length},t.prototype.search=function(e){this._fuse||(this._fuse=new Zn(this._haystack,this._fuseOptions));var n=this._fuse.search(e);return n.map(function(i,r){return{item:i.item,score:i.score||0,rank:r+1}})},t}();function zv(t){return new $v(t)}var jv=function(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0},Es=function(t,e,n){var i=t.dataset,r=e.customProperties,s=e.labelClass,o=e.labelDescription;s&&(i.labelClass=gr(s).join(" ")),o&&(i.labelDescription=o),n&&r&&(typeof r=="string"?i.customProperties=r:typeof r=="object"&&!jv(r)&&(i.customProperties=JSON.stringify(r)))},Nc=function(t,e,n){var i=e&&t.querySelector("label[for='".concat(e,"']")),r=i&&i.innerText;r&&n.setAttribute("aria-label",r)},Fv={containerOuter:function(t,e,n,i,r,s,o){var l=t.classNames.containerOuter,a=document.createElement("div");return Oe(a,l),a.dataset.type=s,e&&(a.dir=e),i&&(a.tabIndex=0),n&&(a.setAttribute("role",r?"combobox":"listbox"),r?a.setAttribute("aria-autocomplete","list"):o||Nc(this._docRoot,this.passedElement.element.id,a),a.setAttribute("aria-haspopup","true"),a.setAttribute("aria-expanded","false")),o&&a.setAttribute("aria-labelledby",o),a},containerInner:function(t){var e=t.classNames.containerInner,n=document.createElement("div");return Oe(n,e),n},itemList:function(t,e){var n=t.searchEnabled,i=t.classNames,r=i.list,s=i.listSingle,o=i.listItems,l=document.createElement("div");return Oe(l,r),Oe(l,e?s:o),this._isSelectElement&&n&&l.setAttribute("role","listbox"),l},placeholder:function(t,e){var n=t.allowHTML,i=t.classNames.placeholder,r=document.createElement("div");return Oe(r,i),fn(r,n,e),r},item:function(t,e,n){var i=t.allowHTML,r=t.removeItemButtonAlignLeft,s=t.removeItemIconText,o=t.removeItemLabelText,l=t.classNames,a=l.item,c=l.button,u=l.highlightedState,h=l.itemSelectable,f=l.placeholder,d=An(e.value),m=document.createElement("div");if(Oe(m,a),e.labelClass){var p=document.createElement("span");fn(p,i,e.label),Oe(p,e.labelClass),m.appendChild(p)}else fn(m,i,e.label);if(m.dataset.item="",m.dataset.id=e.id,m.dataset.value=d,Es(m,e,!0),(e.disabled||this.containerOuter.isDisabled)&&m.setAttribute("aria-disabled","true"),this._isSelectElement&&(m.setAttribute("aria-selected","true"),m.setAttribute("role","option")),e.placeholder&&(Oe(m,f),m.dataset.placeholder=""),Oe(m,e.highlighted?u:h),n){e.disabled&&tn(m,h),m.dataset.deletable="";var g=document.createElement("button");g.type="button",Oe(g,c),fn(g,!0,vi(s,e.value));var _=vi(o,e.value);_&&g.setAttribute("aria-label",_),g.dataset.button="",r?m.insertAdjacentElement("afterbegin",g):m.appendChild(g)}return m},choiceList:function(t,e){var n=t.classNames.list,i=document.createElement("div");return Oe(i,n),e||i.setAttribute("aria-multiselectable","true"),i.setAttribute("role","listbox"),i},choiceGroup:function(t,e){var n=t.allowHTML,i=t.classNames,r=i.group,s=i.groupHeading,o=i.itemDisabled,l=e.id,a=e.label,c=e.disabled,u=An(a),h=document.createElement("div");Oe(h,r),c&&Oe(h,o),h.setAttribute("role","group"),h.dataset.group="",h.dataset.id=l,h.dataset.value=u,c&&h.setAttribute("aria-disabled","true");var f=document.createElement("div");return Oe(f,s),fn(f,n,a||""),h.appendChild(f),h},choice:function(t,e,n,i){var r=t.allowHTML,s=t.classNames,o=s.item,l=s.itemChoice,a=s.itemSelectable,c=s.selectedState,u=s.itemDisabled,h=s.description,f=s.placeholder,d=e.label,m=An(e.value),p=document.createElement("div");p.id=e.elementId,Oe(p,o),Oe(p,l),i&&typeof d=="string"&&(d=ps(r,d),d+=" (".concat(i,")"),d={trusted:d});var g=p;if(e.labelClass){var _=document.createElement("span");fn(_,r,d),Oe(_,e.labelClass),g=_,p.appendChild(_)}else fn(p,r,d);if(e.labelDescription){var S="".concat(e.elementId,"-description");g.setAttribute("aria-describedby",S);var C=document.createElement("span");fn(C,r,e.labelDescription),C.id=S,Oe(C,h),p.appendChild(C)}return e.selected&&Oe(p,c),e.placeholder&&Oe(p,f),p.setAttribute("role",e.group?"treeitem":"option"),p.dataset.choice="",p.dataset.id=e.id,p.dataset.value=m,n&&(p.dataset.selectText=n),e.group&&(p.dataset.groupId="".concat(e.group.id)),Es(p,e,!1),e.disabled?(Oe(p,u),p.dataset.choiceDisabled="",p.setAttribute("aria-disabled","true")):(Oe(p,a),p.dataset.choiceSelectable=""),p},input:function(t,e){var n=t.classNames,i=n.input,r=n.inputCloned,s=t.labelId,o=document.createElement("input");return o.type="search",Oe(o,i),Oe(o,r),o.autocomplete="off",o.autocapitalize="off",o.spellcheck=!1,o.setAttribute("aria-autocomplete","list"),e?o.setAttribute("aria-label",e):s||Nc(this._docRoot,this.passedElement.element.id,o),o},dropdown:function(t){var e=t.classNames,n=e.list,i=e.listDropdown,r=document.createElement("div");return Oe(r,n),Oe(r,i),r.setAttribute("aria-expanded","false"),r},notice:function(t,e,n){var i=t.classNames,r=i.item,s=i.itemChoice,o=i.addChoice,l=i.noResults,a=i.noChoices,c=i.notice;n===void 0&&(n=Et.generic);var u=document.createElement("div");switch(fn(u,!0,e),Oe(u,r),Oe(u,s),Oe(u,c),n){case Et.addChoice:Oe(u,o);break;case Et.noResults:Oe(u,l);break;case Et.noChoices:Oe(u,a);break}return n===Et.addChoice&&(u.dataset.choiceSelectable="",u.dataset.choice=""),u},option:function(t){var e=An(t.label),n=new Option(e,t.value,!1,t.selected);return Es(n,t,!0),n.disabled=t.disabled,t.selected&&n.setAttribute("selected",""),n}},Hv="-ms-scroll-limit"in document.documentElement.style&&"-ms-ime-align"in document.documentElement.style,Vv={},Cs=function(t){if(t)return t.dataset.id?parseInt(t.dataset.id,10):void 0},wi="[data-choice-selectable]",Uv=function(){function t(e,n){e===void 0&&(e="[data-choice]"),n===void 0&&(n={});var i=this;this.initialisedOK=void 0,this._hasNonChoicePlaceholder=!1,this._lastAddedChoiceId=0,this._lastAddedGroupId=0;var r=t.defaults;this.config=Dt(Dt(Dt({},r.allOptions),r.options),n),y1.forEach(function(_){i.config[_]=Dt(Dt(Dt({},r.allOptions[_]),r.options[_]),n[_])});var s=this.config;s.silent||this._validateConfig();var o=s.shadowRoot||document.documentElement;this._docRoot=o;var l=typeof e=="string"?o.querySelector(e):e;if(!l||typeof l!="object"||!(j1(l)||dc(l)))throw TypeError(!l&&typeof e=="string"?"Selector ".concat(e," failed to find an element"):"Expected one of the following types text|select-one|select-multiple");var a=l.type,c=a===Sn.Text;(c||s.maxItemCount!==1)&&(s.singleModeForMultiSelect=!1),s.singleModeForMultiSelect&&(a=Sn.SelectMultiple);var u=a===Sn.SelectOne,h=a===Sn.SelectMultiple,f=u||h;if(this._elementType=a,this._isTextElement=c,this._isSelectOneElement=u,this._isSelectMultipleElement=h,this._isSelectElement=u||h,this._canAddUserChoices=c&&s.addItems||f&&s.addChoices,typeof s.renderSelectedChoices!="boolean"&&(s.renderSelectedChoices=s.renderSelectedChoices==="always"||u),s.closeDropdownOnSelect==="auto"?s.closeDropdownOnSelect=c||u||s.singleModeForMultiSelect:s.closeDropdownOnSelect=bi(s.closeDropdownOnSelect),s.placeholder&&(s.placeholderValue?this._hasNonChoicePlaceholder=!0:l.dataset.placeholder&&(this._hasNonChoicePlaceholder=!0,s.placeholderValue=l.dataset.placeholder)),n.addItemFilter&&typeof n.addItemFilter!="function"){var d=n.addItemFilter instanceof RegExp?n.addItemFilter:new RegExp(n.addItemFilter);s.addItemFilter=d.test.bind(d)}if(this._isTextElement)this.passedElement=new z1({element:l,classNames:s.classNames});else{var m=l;this.passedElement=new V1({element:m,classNames:s.classNames,template:function(_){return i._templates.option(_)},extractPlaceholder:s.placeholder&&!this._hasNonChoicePlaceholder})}if(this.initialised=!1,this._store=new W1(s),this._currentValue="",s.searchEnabled=!c&&s.searchEnabled||h,this._canSearch=s.searchEnabled,this._isScrollingOnIe=!1,this._highlightPosition=0,this._wasTap=!0,this._placeholderValue=this._generatePlaceholderValue(),this._baseId=C1(l,"choices-"),this._direction=l.dir,!this._direction){var p=window.getComputedStyle(l).direction,g=window.getComputedStyle(document.documentElement).direction;p!==g&&(this._direction=p)}if(this._idNames={itemChoice:"item-choice"},this._templates=r.templates,this._render=this._render.bind(this),this._onFocus=this._onFocus.bind(this),this._onBlur=this._onBlur.bind(this),this._onKeyUp=this._onKeyUp.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onInput=this._onInput.bind(this),this._onClick=this._onClick.bind(this),this._onTouchMove=this._onTouchMove.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._onMouseDown=this._onMouseDown.bind(this),this._onMouseOver=this._onMouseOver.bind(this),this._onFormReset=this._onFormReset.bind(this),this._onSelectKey=this._onSelectKey.bind(this),this._onEnterKey=this._onEnterKey.bind(this),this._onEscapeKey=this._onEscapeKey.bind(this),this._onDirectionKey=this._onDirectionKey.bind(this),this._onDeleteKey=this._onDeleteKey.bind(this),this.passedElement.isActive){s.silent||console.warn("Trying to initialise Choices on element already initialised",{element:e}),this.initialised=!0,this.initialisedOK=!1;return}this.init(),this._initialItems=this._store.items.map(function(_){return _.value})}return Object.defineProperty(t,"defaults",{get:function(){return Object.preventExtensions({get options(){return Vv},get allOptions(){return hc},get templates(){return Fv}})},enumerable:!1,configurable:!0}),t.prototype.init=function(){if(!(this.initialised||this.initialisedOK!==void 0)){this._searcher=zv(this.config),this._loadChoices(),this._createTemplates(),this._createElements(),this._createStructure(),this._isTextElement&&!this.config.addItems||this.passedElement.element.hasAttribute("disabled")||this.passedElement.element.closest("fieldset:disabled")?this.disable():(this.enable(),this._addEventListeners()),this._initStore(),this.initialised=!0,this.initialisedOK=!0;var e=this.config.callbackOnInit;typeof e=="function"&&e.call(this)}},t.prototype.destroy=function(){this.initialised&&(this._removeEventListeners(),this.passedElement.reveal(),this.containerOuter.unwrap(this.passedElement.element),this._store._listeners=[],this.clearStore(!1),this._stopSearch(),this._templates=t.defaults.templates,this.initialised=!1,this.initialisedOK=void 0)},t.prototype.enable=function(){return this.passedElement.isDisabled&&this.passedElement.enable(),this.containerOuter.isDisabled&&(this._addEventListeners(),this.input.enable(),this.containerOuter.enable()),this},t.prototype.disable=function(){return this.passedElement.isDisabled||this.passedElement.disable(),this.containerOuter.isDisabled||(this._removeEventListeners(),this.input.disable(),this.containerOuter.disable()),this},t.prototype.highlightItem=function(e,n){if(n===void 0&&(n=!0),!e||!e.id)return this;var i=this._store.items.find(function(r){return r.id===e.id});return!i||i.highlighted?this:(this._store.dispatch(mr(i,!0)),n&&this.passedElement.triggerEvent($t.highlightItem,this._getChoiceForOutput(i)),this)},t.prototype.unhighlightItem=function(e,n){if(n===void 0&&(n=!0),!e||!e.id)return this;var i=this._store.items.find(function(r){return r.id===e.id});return!i||!i.highlighted?this:(this._store.dispatch(mr(i,!1)),n&&this.passedElement.triggerEvent($t.unhighlightItem,this._getChoiceForOutput(i)),this)},t.prototype.highlightAll=function(){var e=this;return this._store.withTxn(function(){e._store.items.forEach(function(n){n.highlighted||(e._store.dispatch(mr(n,!0)),e.passedElement.triggerEvent($t.highlightItem,e._getChoiceForOutput(n)))})}),this},t.prototype.unhighlightAll=function(){var e=this;return this._store.withTxn(function(){e._store.items.forEach(function(n){n.highlighted&&(e._store.dispatch(mr(n,!1)),e.passedElement.triggerEvent($t.highlightItem,e._getChoiceForOutput(n)))})}),this},t.prototype.removeActiveItemsByValue=function(e){var n=this;return this._store.withTxn(function(){n._store.items.filter(function(i){return i.value===e}).forEach(function(i){return n._removeItem(i)})}),this},t.prototype.removeActiveItems=function(e){var n=this;return this._store.withTxn(function(){n._store.items.filter(function(i){var r=i.id;return r!==e}).forEach(function(i){return n._removeItem(i)})}),this},t.prototype.removeHighlightedItems=function(e){var n=this;return e===void 0&&(e=!1),this._store.withTxn(function(){n._store.highlightedActiveItems.forEach(function(i){n._removeItem(i),e&&n._triggerChange(i.value)})}),this},t.prototype.showDropdown=function(e){var n=this;return this.dropdown.isActive?this:(e===void 0&&(e=!this._canSearch),requestAnimationFrame(function(){n.dropdown.show();var i=n.dropdown.element.getBoundingClientRect();n.containerOuter.open(i.bottom,i.height),e||n.input.focus(),n.passedElement.triggerEvent($t.showDropdown)}),this)},t.prototype.hideDropdown=function(e){var n=this;return this.dropdown.isActive?(requestAnimationFrame(function(){n.dropdown.hide(),n.containerOuter.close(),!e&&n._canSearch&&(n.input.removeActiveDescendant(),n.input.blur()),n.passedElement.triggerEvent($t.hideDropdown)}),this):this},t.prototype.getValue=function(e){var n=this,i=this._store.items.map(function(r){return e?r.value:n._getChoiceForOutput(r)});return this._isSelectOneElement||this.config.singleModeForMultiSelect?i[0]:i},t.prototype.setValue=function(e){var n=this;return this.initialisedOK?(this._store.withTxn(function(){e.forEach(function(i){i&&n._addChoice(nn(i,!1))})}),this._searcher.reset(),this):(this._warnChoicesInitFailed("setValue"),this)},t.prototype.setChoiceByValue=function(e){var n=this;return this.initialisedOK?this._isTextElement?this:(this._store.withTxn(function(){var i=Array.isArray(e)?e:[e];i.forEach(function(r){return n._findAndSelectChoiceByValue(r)}),n.unhighlightAll()}),this._searcher.reset(),this):(this._warnChoicesInitFailed("setChoiceByValue"),this)},t.prototype.setChoices=function(e,n,i,r,s,o){var l=this;if(e===void 0&&(e=[]),n===void 0&&(n="value"),i===void 0&&(i="label"),r===void 0&&(r=!1),s===void 0&&(s=!0),o===void 0&&(o=!1),!this.initialisedOK)return this._warnChoicesInitFailed("setChoices"),this;if(!this._isSelectElement)throw new TypeError("setChoices can't be used with INPUT based Choices");if(typeof n!="string"||!n)throw new TypeError("value parameter must be a name of 'value' field in passed objects");if(typeof e=="function"){var a=e(this);if(typeof Promise=="function"&&a instanceof Promise)return new Promise(function(c){return requestAnimationFrame(c)}).then(function(){return l._handleLoadingState(!0)}).then(function(){return a}).then(function(c){return l.setChoices(c,n,i,r,s,o)}).catch(function(c){l.config.silent||console.error(c)}).then(function(){return l._handleLoadingState(!1)}).then(function(){return l});if(!Array.isArray(a))throw new TypeError(".setChoices first argument function must return either array of choices or Promise, got: ".concat(typeof a));return this.setChoices(a,n,i,!1)}if(!Array.isArray(e))throw new TypeError(".setChoices must be called either with array of choices with a function resulting into Promise of array of choices");return this.containerOuter.removeLoadingState(),this._store.withTxn(function(){s&&(l._isSearching=!1),r&&l.clearChoices(!0,o);var c=n==="value",u=i==="label";e.forEach(function(h){if("choices"in h){var f=h;u||(f=Dt(Dt({},f),{label:f[i]})),l._addGroup(nn(f,!0))}else{var d=h;(!u||!c)&&(d=Dt(Dt({},d),{value:d[n],label:d[i]}));var m=nn(d,!1);l._addChoice(m),m.placeholder&&!l._hasNonChoicePlaceholder&&(l._placeholderValue=lc(m.label))}}),l.unhighlightAll()}),this._searcher.reset(),this},t.prototype.refresh=function(e,n,i){var r=this;return e===void 0&&(e=!1),n===void 0&&(n=!1),i===void 0&&(i=!1),this._isSelectElement?(this._store.withTxn(function(){var s=r.passedElement.optionsAsChoices(),o={};i||r._store.items.forEach(function(a){a.id&&a.active&&a.selected&&(o[a.value]=!0)}),r.clearStore(!1);var l=function(a){i?r._store.dispatch(rc(a)):o[a.value]&&(a.selected=!0)};s.forEach(function(a){if("choices"in a){a.choices.forEach(l);return}l(a)}),r._addPredefinedChoices(s,n,e),r._isSearching&&r._searchChoices(r.input.value)}),this):(this.config.silent||console.warn("refresh method can only be used on choices backed by a <select> element"),this)},t.prototype.removeChoice=function(e){var n=this._store.choices.find(function(i){return i.value===e});return n?(this._clearNotice(),this._store.dispatch(b1(n)),this._searcher.reset(),n.selected&&this.passedElement.triggerEvent($t.removeItem,this._getChoiceForOutput(n)),this):this},t.prototype.clearChoices=function(e,n){var i=this;return e===void 0&&(e=!0),n===void 0&&(n=!1),e&&(n?this.passedElement.element.replaceChildren(""):this.passedElement.element.querySelectorAll(":not([selected])").forEach(function(r){r.remove()})),this.itemList.element.replaceChildren(""),this.choiceList.element.replaceChildren(""),this._clearNotice(),this._store.withTxn(function(){var r=n?[]:i._store.items;i._store.reset(),r.forEach(function(s){i._store.dispatch(nc(s)),i._store.dispatch(ic(s))})}),this._searcher.reset(),this},t.prototype.clearStore=function(e){return e===void 0&&(e=!0),this.clearChoices(e,!0),this._stopSearch(),this._lastAddedChoiceId=0,this._lastAddedGroupId=0,this},t.prototype.clearInput=function(){var e=!this._isSelectOneElement;return this.input.clear(e),this._stopSearch(),this},t.prototype._validateConfig=function(){var e=this.config,n=P1(e,hc);n.length&&console.warn("Unknown config option(s) passed",n.join(", ")),e.allowHTML&&e.allowHtmlUserInput&&(e.addItems&&console.warn("Warning: allowHTML/allowHtmlUserInput/addItems all being true is strongly not recommended and may lead to XSS attacks"),e.addChoices&&console.warn("Warning: allowHTML/allowHtmlUserInput/addChoices all being true is strongly not recommended and may lead to XSS attacks"))},t.prototype._render=function(e){e===void 0&&(e={choices:!0,groups:!0,items:!0}),!this._store.inTxn()&&(this._isSelectElement&&(e.choices||e.groups)&&this._renderChoices(),e.items&&this._renderItems())},t.prototype._renderChoices=function(){var e=this;if(this._canAddItems()){var n=this,i=n.config,r=n._isSearching,s=this._store,o=s.activeGroups,l=s.activeChoices,a=0;if(r&&i.searchResultLimit>0?a=i.searchResultLimit:i.renderChoiceLimit>0&&(a=i.renderChoiceLimit),this._isSelectElement){var c=l.filter(function(m){return!m.element});c.length&&this.passedElement.addOptions(c)}var u=document.createDocumentFragment(),h=function(m){return m.filter(function(p){return!p.placeholder&&(r?!!p.rank:i.renderSelectedChoices||!p.selected)})},f=!1,d=function(m,p,g){r?m.sort(T1):i.shouldSort&&m.sort(i.sorter);var _=m.length;_=!p&&a&&_>a?a:_,_--,m.every(function(S,C){var w=S.choiceEl||e._templates.choice(i,S,i.itemSelectText,g);return S.choiceEl=w,u.appendChild(w),(r||!S.selected)&&(f=!0),C<_})};l.length&&(i.resetScrollPosition&&requestAnimationFrame(function(){return e.choiceList.scrollToTop()}),!this._hasNonChoicePlaceholder&&!r&&this._isSelectOneElement&&d(l.filter(function(m){return m.placeholder&&!m.group}),!1,void 0),o.length&&!r?(i.shouldSort&&o.sort(i.sorter),d(l.filter(function(m){return!m.placeholder&&!m.group}),!1,void 0),o.forEach(function(m){var p=h(m.choices);if(p.length){if(m.label){var g=m.groupEl||e._templates.choiceGroup(e.config,m);m.groupEl=g,g.remove(),u.appendChild(g)}d(p,!0,i.appendGroupInSearch&&r?m.label:void 0)}})):d(h(l),!1,void 0)),!f&&(r||!u.children.length||!i.renderSelectedChoices)&&(this._notice||(this._notice={text:oc(r?i.noResultsText:i.noChoicesText),type:r?Et.noResults:Et.noChoices}),u.replaceChildren("")),this._renderNotice(u),this.choiceList.element.replaceChildren(u),f&&this._highlightChoice()}},t.prototype._renderItems=function(){var e=this,n=this._store.items||[],i=this.itemList.element,r=this.config,s=document.createDocumentFragment(),o=function(h){return i.querySelector('[data-item][data-id="'.concat(h.id,'"]'))},l=function(h){var f=h.itemEl;f&&f.parentElement||(f=o(h)||e._templates.item(r,h,r.removeItemButton),h.itemEl=f,s.appendChild(f))};n.forEach(l);var a=!!s.childNodes.length;if(this._isSelectOneElement){var c=i.children.length;if(a||c>1){var u=i.querySelector(yi(r.classNames.placeholder));u&&u.remove()}else!a&&!c&&this._placeholderValue&&(a=!0,l(nn({selected:!0,value:"",label:this._placeholderValue,placeholder:!0},!1)))}a&&(i.append(s),r.shouldSortItems&&!this._isSelectOneElement&&(n.sort(r.sorter),n.forEach(function(h){var f=o(h);f&&(f.remove(),s.append(f))}),i.append(s))),this._isTextElement&&(this.passedElement.value=n.map(function(h){var f=h.value;return f}).join(r.delimiter))},t.prototype._displayNotice=function(e,n,i){i===void 0&&(i=!0);var r=this._notice;if(r&&(r.type===n&&r.text===e||r.type===Et.addChoice&&(n===Et.noResults||n===Et.noChoices))){i&&this.showDropdown(!0);return}this._clearNotice(),this._notice=e?{text:e,type:n}:void 0,this._renderNotice(),i&&e&&this.showDropdown(!0)},t.prototype._clearNotice=function(){if(this._notice){var e=this.choiceList.element.querySelector(yi(this.config.classNames.notice));e&&e.remove(),this._notice=void 0}},t.prototype._renderNotice=function(e){var n=this._notice;if(n){var i=this._templates.notice(this.config,n.text,n.type);e?e.append(i):this.choiceList.prepend(i)}},t.prototype._getChoiceForOutput=function(e,n){return{id:e.id,highlighted:e.highlighted,labelClass:e.labelClass,labelDescription:e.labelDescription,customProperties:e.customProperties,disabled:e.disabled,active:e.active,label:e.label,placeholder:e.placeholder,value:e.value,groupValue:e.group?e.group.label:void 0,element:e.element,keyCode:n}},t.prototype._triggerChange=function(e){e!=null&&this.passedElement.triggerEvent($t.change,{value:e})},t.prototype._handleButtonAction=function(e){var n=this,i=this._store.items;if(!(!i.length||!this.config.removeItems||!this.config.removeItemButton)){var r=e&&Cs(e.parentElement),s=r&&i.find(function(o){return o.id===r});s&&this._store.withTxn(function(){if(n._removeItem(s),n._triggerChange(s.value),n._isSelectOneElement&&!n._hasNonChoicePlaceholder){var o=(n.config.shouldSort?n._store.choices.reverse():n._store.choices).find(function(l){return l.placeholder});o&&(n._addItem(o),n.unhighlightAll(),o.value&&n._triggerChange(o.value))}})}},t.prototype._handleItemAction=function(e,n){var i=this;n===void 0&&(n=!1);var r=this._store.items;if(!(!r.length||!this.config.removeItems||this._isSelectOneElement)){var s=Cs(e);s&&(r.forEach(function(o){o.id===s&&!o.highlighted?i.highlightItem(o):!n&&o.highlighted&&i.unhighlightItem(o)}),this.input.focus())}},t.prototype._handleChoiceAction=function(e){var n=this,i=Cs(e),r=i&&this._store.getChoiceById(i);if(!r||r.disabled)return!1;var s=this.dropdown.isActive;if(!r.selected){if(!this._canAddItems())return!0;this._store.withTxn(function(){n._addItem(r,!0,!0),n.clearInput(),n.unhighlightAll()}),this._triggerChange(r.value)}return s&&this.config.closeDropdownOnSelect&&(this.hideDropdown(!0),this.containerOuter.element.focus()),!0},t.prototype._handleBackspace=function(e){var n=this.config;if(!(!n.removeItems||!e.length)){var i=e[e.length-1],r=e.some(function(s){return s.highlighted});n.editItems&&!r&&i?(this.input.value=i.value,this.input.setWidth(),this._removeItem(i),this._triggerChange(i.value)):(r||this.highlightItem(i,!1),this.removeHighlightedItems(!0))}},t.prototype._loadChoices=function(){var e,n=this,i=this.config;if(this._isTextElement){if(this._presetChoices=i.items.map(function(o){return nn(o,!1)}),this.passedElement.value){var r=this.passedElement.value.split(i.delimiter).map(function(o){return nn(o,!1,n.config.allowHtmlUserInput)});this._presetChoices=this._presetChoices.concat(r)}this._presetChoices.forEach(function(o){o.selected=!0})}else if(this._isSelectElement){this._presetChoices=i.choices.map(function(o){return nn(o,!0)});var s=this.passedElement.optionsAsChoices();s&&(e=this._presetChoices).push.apply(e,s)}},t.prototype._handleLoadingState=function(e){e===void 0&&(e=!0);var n=this.itemList.element;e?(this.disable(),this.containerOuter.addLoadingState(),this._isSelectOneElement?n.replaceChildren(this._templates.placeholder(this.config,this.config.loadingText)):this.input.placeholder=this.config.loadingText):(this.enable(),this.containerOuter.removeLoadingState(),this._isSelectOneElement?(n.replaceChildren(""),this._render()):this.input.placeholder=this._placeholderValue||"")},t.prototype._handleSearch=function(e){if(this.input.isFocussed)if(e!==null&&typeof e<"u"&&e.length>=this.config.searchFloor){var n=this.config.searchChoices?this._searchChoices(e):0;n!==null&&this.passedElement.triggerEvent($t.search,{value:e,resultCount:n})}else this._store.choices.some(function(i){return!i.active})&&this._stopSearch()},t.prototype._canAddItems=function(){var e=this.config,n=e.maxItemCount,i=e.maxItemText;return!e.singleModeForMultiSelect&&n>0&&n<=this._store.items.length?(this.choiceList.element.replaceChildren(""),this._notice=void 0,this._displayNotice(typeof i=="function"?i(n):i,Et.addChoice),!1):(this._notice&&this._notice.type===Et.addChoice&&this._clearNotice(),!0)},t.prototype._canCreateItem=function(e){var n=this.config,i=!0,r="";if(i&&typeof n.addItemFilter=="function"&&!n.addItemFilter(e)&&(i=!1,r=vi(n.customAddItemText,e)),i){var s=this._store.choices.find(function(o){return n.valueComparer(o.value,e)});if(s){if(this._isSelectElement)return this._displayNotice("",Et.addChoice),!1;n.duplicateItemsAllowed||(i=!1,r=vi(n.uniqueItemText,e))}}return i&&(r=vi(n.addItemText,e)),r&&this._displayNotice(r,Et.addChoice),i},t.prototype._searchChoices=function(e){var n=e.trim().replace(/\s{2,}/," ");if(!n.length||n===this._currentValue)return null;var i=this._searcher;i.isEmptyIndex()&&i.index(this._store.searchableChoices);var r=i.search(n);this._currentValue=n,this._highlightPosition=0,this._isSearching=!0;var s=this._notice,o=s&&s.type;return o!==Et.addChoice&&(r.length?this._clearNotice():this._displayNotice(oc(this.config.noResultsText),Et.noResults)),this._store.dispatch(w1(r)),r.length},t.prototype._stopSearch=function(){this._isSearching&&(this._currentValue="",this._isSearching=!1,this._clearNotice(),this._store.dispatch(S1(!0)),this.passedElement.triggerEvent($t.search,{value:"",resultCount:0}))},t.prototype._addEventListeners=function(){var e=this._docRoot,n=this.containerOuter.element,i=this.input.element;e.addEventListener("touchend",this._onTouchEnd,!0),n.addEventListener("keydown",this._onKeyDown,!0),n.addEventListener("mousedown",this._onMouseDown,!0),e.addEventListener("click",this._onClick,{passive:!0}),e.addEventListener("touchmove",this._onTouchMove,{passive:!0}),this.dropdown.element.addEventListener("mouseover",this._onMouseOver,{passive:!0}),this._isSelectOneElement&&(n.addEventListener("focus",this._onFocus,{passive:!0}),n.addEventListener("blur",this._onBlur,{passive:!0})),i.addEventListener("keyup",this._onKeyUp,{passive:!0}),i.addEventListener("input",this._onInput,{passive:!0}),i.addEventListener("focus",this._onFocus,{passive:!0}),i.addEventListener("blur",this._onBlur,{passive:!0}),i.form&&i.form.addEventListener("reset",this._onFormReset,{passive:!0}),this.input.addEventListeners()},t.prototype._removeEventListeners=function(){var e=this._docRoot,n=this.containerOuter.element,i=this.input.element;e.removeEventListener("touchend",this._onTouchEnd,!0),n.removeEventListener("keydown",this._onKeyDown,!0),n.removeEventListener("mousedown",this._onMouseDown,!0),e.removeEventListener("click",this._onClick),e.removeEventListener("touchmove",this._onTouchMove),this.dropdown.element.removeEventListener("mouseover",this._onMouseOver),this._isSelectOneElement&&(n.removeEventListener("focus",this._onFocus),n.removeEventListener("blur",this._onBlur)),i.removeEventListener("keyup",this._onKeyUp),i.removeEventListener("input",this._onInput),i.removeEventListener("focus",this._onFocus),i.removeEventListener("blur",this._onBlur),i.form&&i.form.removeEventListener("reset",this._onFormReset),this.input.removeEventListeners()},t.prototype._onKeyDown=function(e){var n=e.keyCode,i=this.dropdown.isActive,r=e.key.length===1||e.key.length===2&&e.key.charCodeAt(0)>=55296||e.key==="Unidentified";switch(!this._isTextElement&&!i&&n!==xt.ESC_KEY&&n!==xt.TAB_KEY&&n!==xt.SHIFT_KEY&&(this.showDropdown(),!this.input.isFocussed&&r&&(this.input.value+=e.key,e.key===" "&&e.preventDefault())),n){case xt.A_KEY:return this._onSelectKey(e,this.itemList.element.hasChildNodes());case xt.ENTER_KEY:return this._onEnterKey(e,i);case xt.ESC_KEY:return this._onEscapeKey(e,i);case xt.UP_KEY:case xt.PAGE_UP_KEY:case xt.DOWN_KEY:case xt.PAGE_DOWN_KEY:return this._onDirectionKey(e,i);case xt.DELETE_KEY:case xt.BACK_KEY:return this._onDeleteKey(e,this._store.items,this.input.isFocussed)}},t.prototype._onKeyUp=function(){this._canSearch=this.config.searchEnabled},t.prototype._onInput=function(){var e=this.input.value;if(!e){this._isTextElement?this.hideDropdown(!0):this._stopSearch();return}this._canAddItems()&&(this._canSearch&&this._handleSearch(e),this._canAddUserChoices&&(this._canCreateItem(e),this._isSelectElement&&(this._highlightPosition=0,this._highlightChoice())))},t.prototype._onSelectKey=function(e,n){if((e.ctrlKey||e.metaKey)&&n){this._canSearch=!1;var i=this.config.removeItems&&!this.input.value&&this.input.element===document.activeElement;i&&this.highlightAll()}},t.prototype._onEnterKey=function(e,n){var i=this,r=this.input.value,s=e.target;if(e.preventDefault(),s&&s.hasAttribute("data-button")){this._handleButtonAction(s);return}if(!n){(this._isSelectElement||this._notice)&&this.showDropdown();return}var o=this.dropdown.element.querySelector(yi(this.config.classNames.highlightedState));if(!(o&&this._handleChoiceAction(o))){if(!s||!r){this.hideDropdown(!0);return}if(this._canAddItems()){var l=!1;this._store.withTxn(function(){if(l=i._findAndSelectChoiceByValue(r,!0),!l){if(!i._canAddUserChoices||!i._canCreateItem(r))return;i._addChoice(nn(r,!1,i.config.allowHtmlUserInput),!0,!0),l=!0}i.clearInput(),i.unhighlightAll()}),l&&(this._triggerChange(r),this.config.closeDropdownOnSelect&&this.hideDropdown(!0))}}},t.prototype._onEscapeKey=function(e,n){n&&(e.stopPropagation(),this.hideDropdown(!0),this._stopSearch(),this.containerOuter.element.focus())},t.prototype._onDirectionKey=function(e,n){var i=e.keyCode;if(n||this._isSelectOneElement){this.showDropdown(),this._canSearch=!1;var r=i===xt.DOWN_KEY||i===xt.PAGE_DOWN_KEY?1:-1,s=e.metaKey||i===xt.PAGE_DOWN_KEY||i===xt.PAGE_UP_KEY,o=void 0;if(s)r>0?o=this.dropdown.element.querySelector("".concat(wi,":last-of-type")):o=this.dropdown.element.querySelector(wi);else{var l=this.dropdown.element.querySelector(yi(this.config.classNames.highlightedState));l?o=I1(l,wi,r):o=this.dropdown.element.querySelector(wi)}o&&(x1(o,this.choiceList.element,r)||this.choiceList.scrollToChildElement(o,r),this._highlightChoice(o)),e.preventDefault()}},t.prototype._onDeleteKey=function(e,n,i){!this._isSelectOneElement&&!e.target.value&&i&&(this._handleBackspace(n),e.preventDefault())},t.prototype._onTouchMove=function(){this._wasTap&&(this._wasTap=!1)},t.prototype._onTouchEnd=function(e){var n=(e||e.touches[0]).target,i=this._wasTap&&this.containerOuter.element.contains(n);if(i){var r=n===this.containerOuter.element||n===this.containerInner.element;r&&(this._isTextElement?this.input.focus():this._isSelectMultipleElement&&this.showDropdown()),e.stopPropagation()}this._wasTap=!0},t.prototype._onMouseDown=function(e){var n=e.target;if(n instanceof HTMLElement){if(Hv&&this.choiceList.element.contains(n)){var i=this.choiceList.element.firstElementChild;this._isScrollingOnIe=this._direction==="ltr"?e.offsetX>=i.offsetWidth:e.offsetX<i.offsetLeft}if(n!==this.input.element){var r=n.closest("[data-button],[data-item],[data-choice]");r instanceof HTMLElement&&("button"in r.dataset?this._handleButtonAction(r):"item"in r.dataset?this._handleItemAction(r,e.shiftKey):"choice"in r.dataset&&this._handleChoiceAction(r)),e.preventDefault()}}},t.prototype._onMouseOver=function(e){var n=e.target;n instanceof HTMLElement&&"choice"in n.dataset&&this._highlightChoice(n)},t.prototype._onClick=function(e){var n=e.target,i=this.containerOuter,r=i.element.contains(n);r?!this.dropdown.isActive&&!i.isDisabled?this._isTextElement?document.activeElement!==this.input.element&&this.input.focus():(this.showDropdown(),i.element.focus()):this._isSelectOneElement&&n!==this.input.element&&!this.dropdown.element.contains(n)&&this.hideDropdown():(i.removeFocusState(),this.hideDropdown(!0),this.unhighlightAll())},t.prototype._onFocus=function(e){var n=e.target,i=this.containerOuter,r=n&&i.element.contains(n);if(r){var s=n===this.input.element;this._isTextElement?s&&i.addFocusState():this._isSelectMultipleElement?s&&(this.showDropdown(!0),i.addFocusState()):(i.addFocusState(),s&&this.showDropdown(!0))}},t.prototype._onBlur=function(e){var n=e.target,i=this.containerOuter,r=n&&i.element.contains(n);r&&!this._isScrollingOnIe?n===this.input.element?(i.removeFocusState(),this.hideDropdown(!0),(this._isTextElement||this._isSelectMultipleElement)&&this.unhighlightAll()):n===this.containerOuter.element&&(i.removeFocusState(),this._canSearch||this.hideDropdown(!0)):(this._isScrollingOnIe=!1,this.input.element.focus())},t.prototype._onFormReset=function(){var e=this;this._store.withTxn(function(){e.clearInput(),e.hideDropdown(),e.refresh(!1,!1,!0),e._initialItems.length&&e.setChoiceByValue(e._initialItems)})},t.prototype._highlightChoice=function(e){e===void 0&&(e=null);var n=Array.from(this.dropdown.element.querySelectorAll(wi));if(n.length){var i=e,r=this.config.classNames.highlightedState,s=Array.from(this.dropdown.element.querySelectorAll(yi(r)));s.forEach(function(o){tn(o,r),o.setAttribute("aria-selected","false")}),i?this._highlightPosition=n.indexOf(i):(n.length>this._highlightPosition?i=n[this._highlightPosition]:i=n[n.length-1],i||(i=n[0])),Oe(i,r),i.setAttribute("aria-selected","true"),this.passedElement.triggerEvent($t.highlightChoice,{el:i}),this.dropdown.isActive&&(this.input.setActiveDescendant(i.id),this.containerOuter.setActiveDescendant(i.id))}},t.prototype._addItem=function(e,n,i){if(n===void 0&&(n=!0),i===void 0&&(i=!1),!e.id)throw new TypeError("item.id must be set before _addItem is called for a choice/item");(this.config.singleModeForMultiSelect||this._isSelectOneElement)&&this.removeActiveItems(e.id),this._store.dispatch(ic(e)),n&&(this.passedElement.triggerEvent($t.addItem,this._getChoiceForOutput(e)),i&&this.passedElement.triggerEvent($t.choice,this._getChoiceForOutput(e)))},t.prototype._removeItem=function(e){if(e.id){this._store.dispatch(rc(e));var n=this._notice;n&&n.type===Et.noChoices&&this._clearNotice(),this.passedElement.triggerEvent($t.removeItem,this._getChoiceForOutput(e))}},t.prototype._addChoice=function(e,n,i){if(n===void 0&&(n=!0),i===void 0&&(i=!1),e.id)throw new TypeError("Can not re-add a choice which has already been added");var r=this.config;if(!(!r.duplicateItemsAllowed&&this._store.choices.find(function(l){return r.valueComparer(l.value,e.value)}))){this._lastAddedChoiceId++,e.id=this._lastAddedChoiceId,e.elementId="".concat(this._baseId,"-").concat(this._idNames.itemChoice,"-").concat(e.id);var s=r.prependValue,o=r.appendValue;s&&(e.value=s+e.value),o&&(e.value+=o.toString()),(s||o)&&e.element&&(e.element.value=e.value),this._clearNotice(),this._store.dispatch(nc(e)),e.selected&&this._addItem(e,n,i)}},t.prototype._addGroup=function(e,n){var i=this;if(n===void 0&&(n=!0),e.id)throw new TypeError("Can not re-add a group which has already been added");this._store.dispatch(k1(e)),e.choices&&(this._lastAddedGroupId++,e.id=this._lastAddedGroupId,e.choices.forEach(function(r){r.group=e,e.disabled&&(r.disabled=!0),i._addChoice(r,n)}))},t.prototype._createTemplates=function(){var e=this,n=this.config.callbackOnCreateTemplates,i={};typeof n=="function"&&(i=n.call(this,M1,ps,gr));var r={};Object.keys(this._templates).forEach(function(s){s in i?r[s]=i[s].bind(e):r[s]=e._templates[s].bind(e)}),this._templates=r},t.prototype._createElements=function(){var e=this._templates,n=this,i=n.config,r=n._isSelectOneElement,s=i.position,o=i.classNames,l=this._elementType;this.containerOuter=new ac({element:e.containerOuter(i,this._direction,this._isSelectElement,r,i.searchEnabled,l,i.labelId),classNames:o,type:l,position:s}),this.containerInner=new ac({element:e.containerInner(i),classNames:o,type:l,position:s}),this.input=new D1({element:e.input(i,this._placeholderValue),classNames:o,type:l,preventPaste:!i.paste}),this.choiceList=new cc({element:e.choiceList(i,r)}),this.itemList=new cc({element:e.itemList(i,r)}),this.dropdown=new R1({element:e.dropdown(i),classNames:o,type:l})},t.prototype._createStructure=function(){var e=this,n=e.containerInner,i=e.containerOuter,r=e.passedElement,s=this.dropdown.element;r.conceal(),n.wrap(r.element),i.wrap(n.element),this._isSelectOneElement?this.input.placeholder=this.config.searchPlaceholderValue||"":(this._placeholderValue&&(this.input.placeholder=this._placeholderValue),this.input.setWidth()),i.element.appendChild(n.element),i.element.appendChild(s),n.element.appendChild(this.itemList.element),s.appendChild(this.choiceList.element),this._isSelectOneElement?this.config.searchEnabled&&s.insertBefore(this.input.element,s.firstChild):n.element.appendChild(this.input.element),this._highlightPosition=0,this._isSearching=!1},t.prototype._initStore=function(){var e=this;this._store.subscribe(this._render).withTxn(function(){e._addPredefinedChoices(e._presetChoices,e._isSelectOneElement&&!e._hasNonChoicePlaceholder,!1)}),(!this._store.choices.length||this._isSelectOneElement&&this._hasNonChoicePlaceholder)&&this._render()},t.prototype._addPredefinedChoices=function(e,n,i){var r=this;if(n===void 0&&(n=!1),i===void 0&&(i=!0),n){var s=e.findIndex(function(o){return o.selected})===-1;s&&e.some(function(o){return o.disabled||"choices"in o?!1:(o.selected=!0,!0)})}e.forEach(function(o){"choices"in o?r._isSelectElement&&r._addGroup(o,i):r._addChoice(o,i)})},t.prototype._findAndSelectChoiceByValue=function(e,n){var i=this;n===void 0&&(n=!1);var r=this._store.choices.find(function(s){return i.config.valueComparer(s.value,e)});return r&&!r.disabled&&!r.selected?(this._addItem(r,!0,n),!0):!1},t.prototype._generatePlaceholderValue=function(){var e=this.config;if(!e.placeholder)return null;if(this._hasNonChoicePlaceholder)return e.placeholderValue;if(this._isSelectElement){var n=this.passedElement.placeholderOption;return n?n.text:null}return null},t.prototype._warnChoicesInitFailed=function(e){if(!this.config.silent)if(this.initialised){if(!this.initialisedOK)throw new TypeError("".concat(e," called for an element which has multiple instances of Choices initialised on it"))}else throw new TypeError("".concat(e," called on a non-initialised instance of Choices"))},t.version="11.1.0",t}();const vb="",yb="";function Pc(t){let e,n;return{c(){e=b("label"),n=re(t[2]),v(e,"for",t[4])},m(i,r){z(i,e,r),y(e,n)},p(i,r){r&4&&je(n,i[2])},d(i){i&&$(e)}}}function Bv(t){let e;return{c(){e=b("select"),v(e,"id",t[4]),v(e,"name",t[4]),v(e,"aria-label",t[2]),v(e,"class","m-1")},m(n,i){z(n,e,i)},p(n,i){i&4&&v(e,"aria-label",n[2])},i:te,o:te,d(n){n&&$(e)}}}function qv(t){let e,n,i,r=t[3].length&&Oc(t);return{c(){r&&r.c(),e=j(),n=b("select"),v(n,"id",t[4]),v(n,"name",t[4]),v(n,"aria-label",t[2]),v(n,"class","m-1"),n.multiple=!0},m(s,o){r&&r.m(s,o),z(s,e,o),z(s,n,o),i=!0},p(s,o){s[3].length?r?(r.p(s,o),o&8&&H(r,1)):(r=Oc(s),r.c(),H(r,1),r.m(e.parentNode,e)):r&&(tt(),K(r,1,1,()=>{r=null}),nt()),(!i||o&4)&&v(n,"aria-label",s[2])},i(s){i||(H(r),i=!0)},o(s){K(r),i=!1},d(s){r&&r.d(s),s&&$(e),s&&$(n)}}}function Oc(t){let e,n,i=t[3].length+"",r,s,o,l;return o=new ji({props:{targetHtmlId:t[5],tooltipText:`${t[3].length}
                                    ${B==="fr"&&t[3].length>1?"valeurs sélectionnées":B==="fr"&&t[3].length===1?"valeur sélectionnée":B==="en"&&t[3].length>1?"selected values":"selected value"}`}}),{c(){e=b("span"),n=b("span"),r=re(i),s=j(),ve(o.$$.fragment),v(n,"id",t[5]),v(n,"class","input-dropdown-count tag m-1 svelte-1epfuu8"),v(e,"class","is-relative")},m(a,c){z(a,e,c),y(e,n),y(n,r),y(e,s),ge(o,e,null),l=!0},p(a,c){(!l||c&8)&&i!==(i=a[3].length+"")&&je(r,i);const u={};c&8&&(u.tooltipText=`${a[3].length}
                                    ${B==="fr"&&a[3].length>1?"valeurs sélectionnées":B==="fr"&&a[3].length===1?"valeur sélectionnée":B==="en"&&a[3].length>1?"selected values":"selected value"}`),o.$set(u)},i(a){l||(H(o.$$.fragment,a),l=!0)},o(a){K(o.$$.fragment,a),l=!1},d(a){a&&$(e),_e(o)}}}function Kv(t){let e,n,i,r,s,o,l,a=t[2]!==void 0&&Pc(t);const c=[qv,Bv],u=[];function h(f,d){return f[0]?0:1}return r=h(t),s=u[r]=c[r](t),{c(){e=b("div"),a&&a.c(),n=j(),i=b("div"),s.c(),v(i,"class",o="input-dropdown-select "+(t[0]?"is-multiple":"is-single")+" "+(t[0]&&t[3].length?"is-flex is-justify-content-flex-start is-align-items-center":"")+" "+(t[1]?"light-display":"")+" svelte-1epfuu8"),v(e,"class","input-dropdown-select-wrapper")},m(f,d){z(f,e,d),a&&a.m(e,null),y(e,n),y(e,i),u[r].m(i,null),l=!0},p(f,[d]){f[2]!==void 0?a?a.p(f,d):(a=Pc(f),a.c(),a.m(e,n)):a&&(a.d(1),a=null);let m=r;r=h(f),r===m?u[r].p(f,d):(tt(),K(u[m],1,1,()=>{u[m]=null}),nt(),s=u[r],s?s.p(f,d):(s=u[r]=c[r](f),s.c()),H(s,1),s.m(i,null)),(!l||d&11&&o!==(o="input-dropdown-select "+(f[0]?"is-multiple":"is-single")+" "+(f[0]&&f[3].length?"is-flex is-justify-content-flex-start is-align-items-center":"")+" "+(f[1]?"light-display":"")+" svelte-1epfuu8"))&&v(i,"class",o)},i(f){l||(H(s),l=!0)},o(f){K(s),l=!1},d(f){f&&$(e),a&&a.d(),u[r].d()}}}const Wv=250;function Yv(t,e,n){let i,r,{choicesItems:s}=e,{start:o=[]}=e,{multiple:l}=e,{searchable:a=!0}=e,{lightDisplay:c=!1}=e,{placeholder:u=B==="fr"?"Sélectionner une valeur":"Select a value"}=e,{title:h=void 0}=e,{selectAll:f=!!l}=e;const d=`input-dropdown-select-${window.crypto.randomUUID()}`,m=`input-dropdown-counter-${window.crypto.randomUUID()}`,p=`select-all-${window.crypto.randomUUID()}`,g=`unselect-all-${window.crypto.randomUUID()}`,_=Ti();let S;const C=Li();C.setCompareFn(Nr);const w=zt("resetTrigger")||void 0;w==null||w.subscribe(()=>F(S,s,o,f));const k=()=>{n(11,r=!0),setTimeout(()=>n(11,r=!1),Wv)},T=(P,G)=>{G||(C.set(P),C.same()||_("updateValues",i))},N=P=>`<span class="iconify" data-icon=${P}/>`,E=(P,G)=>P!=null&&G!=null&&P.length&&G.length?`<span class="dropdown-prefix-wrapper">${G==="iconify"?N(P):P}</span>`:"",x=(P,G)=>G?[{value:p,label:`<b>${B==="fr"?"Tout sélectionner":"Select all"}</b>`},{value:g,label:`<b>${B==="fr"?"Tout retirer":"Remove all"}</b>`},...P]:P,L=(P,G)=>x(P,G).map(V=>(V.id=`dropdown-choice-${window.crypto.randomUUID()}`,V.label=`<span>
                ${E(V.prefix||"",V.prefixType||"")}
                <span class="dropdown-prefix-text">${V.label}</span>
            </span>`,V));function O(P,G,V){return P=structuredClone(P),G=structuredClone(G),P=L(P,V).map(q=>G.includes(q.value)?{...q,selected:!0}:{...q,selected:!1}),n(3,i=G),P}function F(P,G,V,q){P&&(G=O(G,V,q),P.clearStore().setChoices(G))}const R=(P,G,V,q,J,ue)=>(q=structuredClone(q),V=structuredClone(V),P.detail.value===J?(k(),V=V.map(ce=>[J,ue].includes(ce.value)?{...ce,selected:!1}:{...ce,selected:!0}),G.removeActiveItems().clearChoices(!0,!0).setValue(V).hideDropdown(),q=[...new Set(V.filter(ce=>ce.selected===!0).map(ce=>ce.value))]):P.detail.value===ue?(G.removeActiveItems().hideDropdown(),q=[]):q=l===!0?[...q,P.detail.value]:[P.detail.value],[...new Set(q)]),I=(P,G)=>structuredClone(G).filter(V=>V!==P.detail.value);function U(P,G){const V=document.getElementById(d);S=new Uv(V,{items:[],choices:P,addChoices:!1,addItems:!1,removeItems:!0,removeItemButton:!0,searchEnabled:a,allowHTML:!0,shouldSort:!G,sorter:(q,J)=>q.label.localeCompare(J.label),placeholderValue:u,classNames:{item:["choices__item","dropdown-item"]},loadingText:B==="fr"?"Chargement...":"Loading...",noResultsText:B==="fr"?"Pas de résultats":"No results found",noChoicesText:B==="fr"?"Pas de choix pour faire la sélection":"No choices to choose from",itemSelectText:B==="fr"?"Cliquer pour sélectionner":"Press to select",uniqueItemText:B==="fr"?"Seules des valeurs uniques peuvent être ajoutées":"Only unique values can be added",customAddItemText:B==="fr"?"Les valeurs ne répondent pas aux conditions attendues":"Only values matching specific conditions can be added",removeItemIconText:B==="fr"?"Retirer l'item":"Remove item",addItemText:q=>B==="fr"?`Cliquer sur Entrer pour ajouter <b>${q}</b>`:`Press Enter to add <b>"${q}"</b>`,removeItemLabelText:q=>B==="fr"?`Retirer l'item: ${q}`:`Remove item: ${q}`,maxItemText:q=>B==="fr"?`Seulement ${q} items peuvent être ajoutées`:`Only ${q} items can be added`}),V.addEventListener("addItem",q=>{n(3,i=R(q,S,P,i,p,g))}),V.addEventListener("removeItem",q=>{n(3,i=I(q,i))})}return Rn(()=>{const P=O(s,o,f);U(P,f)}),Dn(()=>{S.destroy(),S=void 0}),t.$$set=P=>{"choicesItems"in P&&n(6,s=P.choicesItems),"start"in P&&n(7,o=P.start),"multiple"in P&&n(0,l=P.multiple),"searchable"in P&&n(8,a=P.searchable),"lightDisplay"in P&&n(1,c=P.lightDisplay),"placeholder"in P&&n(9,u=P.placeholder),"title"in P&&n(2,h=P.title),"selectAll"in P&&n(10,f=P.selectAll)},t.$$.update=()=>{t.$$.dirty&2056&&T(i,r)},n(3,i=[]),n(11,r=!1),[l,c,h,i,d,m,s,o,a,u,f,r]}class Gv extends Ve{constructor(e){super(),He(this,e,Yv,Kv,ze,{choicesItems:6,start:7,multiple:0,searchable:8,lightDisplay:1,placeholder:9,title:2,selectAll:10})}}const bb="";function Xv(t){let e,n,i,r,s,o,l,a,c,u,h,f,d,m,p,g,_,S,C,w,k,T,N,E,x,L,O,F,R,I,U,P,G,V,q,J,ue,ce,we;return c=new En({props:{minVal:0,maxVal:1,start:t[5],emitOnUpdate:!0,title:B==="fr"?"Opacité":"Opacity"}}),c.$on("updateSlider",t[9]),f=new En({props:{minVal:0,maxVal:360,start:t[6],step:1,emitOnUpdate:!0,title:"Rotation"}}),f.$on("updateSlider",t[10]),p=new En({props:{minVal:0,maxVal:200,step:1,start:t[7],emitOnUpdate:!0,title:B==="fr"?"Redimensionner":"Scale"}}),p.$on("updateSlider",t[11]),S=new En({props:{minVal:-100,maxVal:100,step:1,start:t[8][0],emitOnUpdate:!0,title:B==="fr"?"Translation horizontale":"Horizontal translate"}}),S.$on("updateSlider",t[12]),k=new En({props:{minVal:-100,maxVal:100,step:1,start:t[8][1],emitOnUpdate:!0,title:B==="fr"?"Translation verticale":"Vertical translate"}}),k.$on("updateSlider",t[13]),E=new Gv({props:{choicesItems:t[4],start:[],lightDisplay:!0,placeholder:B==="fr"?"Sélectionner":"Select",title:B==="fr"?"Basculer":"Flip"}}),E.$on("updateValues",t[14]),{c(){e=b("div"),n=b("div"),i=b("div"),r=b("div"),s=b("strong"),s.textContent=`${B==="en"?"Query image transformation":"Modification de l'image requête"}`,o=j(),l=b("div"),a=b("div"),ve(c.$$.fragment),u=j(),h=b("div"),ve(f.$$.fragment),d=j(),m=b("div"),ve(p.$$.fragment),g=j(),_=b("div"),ve(S.$$.fragment),C=j(),w=b("div"),ve(k.$$.fragment),T=j(),N=b("div"),ve(E.$$.fragment),x=j(),L=b("div"),O=b("button"),O.textContent=`${B==="fr"?"Réinitialiser":"Reset"}`,F=j(),R=b("div"),I=b("img"),G=j(),V=b("img"),v(r,"class","toolbar-title mt-0 mb-2 svelte-nzei31"),v(a,"class"," svelte-nzei31"),v(h,"class"," svelte-nzei31"),v(m,"class"," svelte-nzei31"),v(_,"class"," svelte-nzei31"),v(w,"class"," svelte-nzei31"),v(N,"class"," svelte-nzei31"),v(O,"class","button is-link"),v(L,"class","mt-2 is-flex is-flex-direction-column is-justify-content-center is-align-items-flex-end svelte-nzei31"),v(l,"class","toolbar-controls is-flex is-flex-direction-column is-align-items-start is-justify-content-center svelte-nzei31"),v(i,"class","toolbar svelte-nzei31"),v(n,"class","toolbar-wrapper is-flex is-flex-direction-column is-justify-content-center is-align-items-center svelte-nzei31"),v(I,"class","compare-img svelte-nzei31"),At(I.src,U=t[0].queryImage.href)||v(I,"src",U),v(I,"alt",P=t[0].queryImage.title),v(V,"class","main-img svelte-nzei31"),At(V.src,q=t[0].similarityImage.href)||v(V,"src",q),v(V,"alt",J=t[0].similarityImage.title),Ye(V,"overlay-reset",t[2]),We(V,"opacity",t[1]),We(V,"transform",t[3]),v(R,"class","overlay-wrapper svelte-nzei31"),v(e,"class","similarity-overlay-wrapper svelte-nzei31")},m(fe,Fe){z(fe,e,Fe),y(e,n),y(n,i),y(i,r),y(r,s),y(i,o),y(i,l),y(l,a),ge(c,a,null),y(l,u),y(l,h),ge(f,h,null),y(l,d),y(l,m),ge(p,m,null),y(l,g),y(l,_),ge(S,_,null),y(l,C),y(l,w),ge(k,w,null),y(l,T),y(l,N),ge(E,N,null),y(l,x),y(l,L),y(L,O),y(e,F),y(e,R),y(R,I),y(R,G),y(R,V),ue=!0,ce||(we=Ce(O,"click",t[15]),ce=!0)},p(fe,[Fe]){(!ue||Fe&1&&!At(I.src,U=fe[0].queryImage.href))&&v(I,"src",U),(!ue||Fe&1&&P!==(P=fe[0].queryImage.title))&&v(I,"alt",P),(!ue||Fe&1&&!At(V.src,q=fe[0].similarityImage.href))&&v(V,"src",q),(!ue||Fe&1&&J!==(J=fe[0].similarityImage.title))&&v(V,"alt",J),(!ue||Fe&4)&&Ye(V,"overlay-reset",fe[2]),Fe&2&&We(V,"opacity",fe[1]),Fe&8&&We(V,"transform",fe[3])},i(fe){ue||(H(c.$$.fragment,fe),H(f.$$.fragment,fe),H(p.$$.fragment,fe),H(S.$$.fragment,fe),H(k.$$.fragment,fe),H(E.$$.fragment,fe),ue=!0)},o(fe){K(c.$$.fragment,fe),K(f.$$.fragment,fe),K(p.$$.fragment,fe),K(S.$$.fragment,fe),K(k.$$.fragment,fe),K(E.$$.fragment,fe),ue=!1},d(fe){fe&&$(e),_e(c),_e(f),_e(p),_e(S),_e(k),_e(E),ce=!1,we()}}}function Jv(t,e,n){let i,{imgData:r}=e;const s=[{value:"h",label:B==="fr"?"Basculer horizontalement":"Flip horizontally"},{value:"v",label:B==="fr"?"Basculer verticalement":"Flip vertically"},{value:"hv",label:B==="fr"?"Basculer horizontalement et verticalement":"Flip horizontally and vertically"}];let o=.5;const l=o;let a=0;const c=a;let u=100;const h=u;let f=[1,1];const d=structuredClone(f);let m=[0,0];const p=structuredClone(m);let g=!1;const _=Ne(window.crypto.randomUUID());$n("resetTrigger",_);const S=x=>n(1,o=x.detail),C=x=>n(16,a=x.detail),w=x=>n(17,u=x.detail),k=x=>n(19,m=[x.detail,m[1]]),T=x=>n(19,m=[m[0],x.detail]),N=x=>{let L=x.detail[0];n(18,f=L==="hv"?[-1,-1]:L==="h"?[-1,1]:L==="v"?[1,-1]:[1,1])},E=()=>{n(1,o=l),n(16,a=c),n(17,u=h),n(18,f=d),n(19,m=p),_.set(window.crypto.randomUUID()),n(2,g=!0),setTimeout(()=>n(2,g=!1),1e3)};return t.$$set=x=>{"imgData"in x&&n(0,r=x.imgData)},t.$$.update=()=>{t.$$.dirty&983040&&n(3,i=`translate(${m[0]-50}%, ${m[1]}%)
                        rotate(${a}deg)
                        scale(${f.map(x=>x*(u/100)).join()})`)},[r,o,g,i,s,l,c,h,p,S,C,w,k,T,N,E,a,u,f,m]}class Qv extends Ve{constructor(e){super(),He(this,e,Jv,Xv,ze,{imgData:0})}}function Zv(){const t=`${window.location.origin}${window.location.pathname}`,e=25,n=window.location.pathname.match(/\d+/g).join("-"),i={[n]:{}},r=[2,6],s=Ne(1),o=Ne({}),l=Ne(JSON.parse(localStorage.getItem("selectedRegions"))||i);l.subscribe(F=>localStorage.setItem("selectedRegions",JSON.stringify(F)));const a=Ne(JSON.parse(localStorage.getItem("excludedCategories"))||[]);a.subscribe(F=>localStorage.setItem("excludedCategories",JSON.stringify(F)));const c=Ne(JSON.parse(localStorage.getItem("similarityScoreCutoff"))||void 0);c.subscribe(F=>{F!=null&&localStorage.setItem("similarityScoreCutoff",JSON.stringify(F))});const u=Ne(JSON.parse(localStorage.getItem("propagateRecursionDepth"))||r[1]);u.subscribe(F=>localStorage.setItem("propagateRecursionDepth",JSON.stringify(F)));const h=Ne(JSON.parse(localStorage.getItem("propagateFilterByRegions"))||!1);h.subscribe(F=>localStorage.setItem("propagateFilterByRegions",JSON.stringify(F)));const f=dt([u,h],([F,R])=>({propagateRecursionDepth:F,propagateFilterByRegions:R})),d=dt([a,l,c],([F,R,I])=>({excludedCategories:F,regions:R,similarityScoreCutoff:I})),m=dt([f,d],([F,R])=>({propagate:F,similarity:R})),p=Ne([]),g=Ne([]);async function _(){const F=async()=>{const U=await(await fetch(`${t}compared-regions`)).json();o.set(U),l.update(P=>{let G=P[n]||{};if(Object.keys(G).length){let V=Object.keys(G).filter(q=>Object.keys(U).includes(q)).reduce((q,J)=>(q[J]=G[J],q),{});P[n]=V}return P})},R=async()=>{const U=await(await fetch(`${t}query-images`)).json();U.length>0&&(p.set(U),L(N()))};ii.set(!0);try{await Promise.all([F(),R()])}catch(I){console.error("Error:",I),vu.set(I.message)}finally{ii.set(!1)}}function S(F){localStorage.setItem("selectedRegions",JSON.stringify(F))}function C(F){l.update(R=>{const I={...R};return delete I[n][F],S(I),I})}function w(F){l.update(R=>{const I={...R,[n]:{...R[n]||{},[F.ref]:F}};return S(I),I})}const k=dt(l,F=>R=>{var I;return(I=F[n])==null?void 0:I.hasOwnProperty(R)});function T(F){const R=vt(o),I=Object.keys(R).filter(U=>U.startsWith(F));return I.length!==1?{title:"Error"}:R[I[0]]}const N=()=>Ar(s,"sp"),E=dt([s,p],([F,R])=>(async()=>x(F,R))());function x(F,R){const I=(F-1)*e,U=I+e,P=R.slice(I,U);return g.set(P),P}function L(F){Tr(F,s,"sp")}function O(F){o.update(R=>({...R,[F.ref]:F}))}return{currentPage:s,comparedRegions:o,excludedCategories:a,qImgs:p,pageQImgs:g,selectedRegions:l,propagateRecursionDepth:u,propagateFilterByRegions:h,similarityToolbarParams:m,propagateParams:f,similarityScoreCutoff:c,allowedPropagateDepthRange:r,fetchSimilarity:_,setPageQImgs:E,getRegionsInfo:T,handlePageUpdate:L,unselect:C,select:w,addComparedRegions:O,isSelected:k,pageLength:e}}const hn=Zv(),{getRegionsInfo:ey}=hn;async function Lc(t,e,n,i,r,s,o=!1,l=!0){const a=()=>l?`<b>${!isNaN(parseFloat(n))&&e===1?`Score: ${n}`:e===2&&B==="en"?"Manual similarity":e===2&&B==="fr"?"Correspondance manuelle":e===3&&B==="en"?"Propagated match":"Correspondance propagée"}</b>`:"",c=u=>`${u}<br>
        Page ${parseInt(i)}<br>
        ${a()}`;return o===!0?fetch(`${r}${s}get_regions_title/${t}`).then(u=>u.json()).then(u=>c(u.title)).catch(u=>(console.error("similarity.utils.getDesc()",u),c(B==="fr"?"Titre inconnu":"Unknown title"))):Promise.resolve(c(ey(t).title))}function Rc(t,e,n){const i=t.slice();return i[16]=e[n],i}function Dc(t){let e,n,i=t[16]==="queryImage"&&B==="fr"?"Image requête":t[16]==="similarityImage"&&B==="fr"?"Similarité":t[16]==="queryImage"&&B==="en"?"Query image":"Similarity",r,s,o,l,a;return o=new Jn({props:{item:t[0][t[16]],descPromise:t[1][t[16]],height:"full"}}),{c(){e=b("div"),n=b("span"),r=re(i),s=j(),ve(o.$$.fragment),l=j(),v(e,"class","img-legend-wrapper column is-flex is-flex-direction-column is-justify-content-center is-align-items-center")},m(c,u){z(c,e,u),y(e,n),y(n,r),y(e,s),ge(o,e,null),y(e,l),a=!0},p(c,u){const h={};u&1&&(h.item=c[0][c[16]]),o.$set(h)},i(c){a||(H(o.$$.fragment,c),a=!0)},o(c){K(o.$$.fragment,c),a=!1},d(c){c&&$(e),_e(o)}}}function ty(t){let e,n,i=["queryImage","similarityImage"],r=[];for(let o=0;o<2;o+=1)r[o]=Dc(Rc(t,i,o));const s=o=>K(r[o],1,1,()=>{r[o]=null});return{c(){e=b("div");for(let o=0;o<2;o+=1)r[o].c();v(e,"class","side-by-side columns")},m(o,l){z(o,e,l);for(let a=0;a<2;a+=1)r[a]&&r[a].m(e,null);n=!0},p(o,[l]){if(l&3){i=["queryImage","similarityImage"];let a;for(a=0;a<2;a+=1){const c=Rc(o,i,a);r[a]?(r[a].p(c,l),H(r[a],1)):(r[a]=Dc(c),r[a].c(),H(r[a],1),r[a].m(e,null))}for(tt(),a=2;a<2;a+=1)s(a);nt()}},i(o){if(!n){for(let l=0;l<2;l+=1)H(r[l]);n=!0}},o(o){r=r.filter(Boolean);for(let l=0;l<2;l+=1)K(r[l]);n=!1},d(o){o&&$(e),wt(r,o)}}}function ny(t,e,n){let{imgData:i}=e;const r=zt("similarityPair"),s=new URL(window.location.href),o=s.origin,l=s.pathname,[a,c,u,h]=r.qImg.split(".")[0].split("_"),[f,d,m,p]=r.sImg.split(".")[0].split("_"),g=`${a}_${c}`,_=`${f}_${d}`,S={queryImage:Lc(g,r.similarityType,r.score,u,o,l,!0,!1),similarityImage:Lc(_,r.similarityType,r.score,m,o,l,!0,!0)};return t.$$set=C=>{"imgData"in C&&n(0,i=C.imgData)},[i,S]}class iy extends Ve{constructor(e){super(),He(this,e,ny,ty,ze,{imgData:0})}}const wb="";function ry(t){let e,n;return e=new iy({props:{imgData:t[2]}}),{c(){ve(e.$$.fragment)},m(i,r){ge(e,i,r),n=!0},p:te,i(i){n||(H(e.$$.fragment,i),n=!0)},o(i){K(e.$$.fragment,i),n=!1},d(i){_e(e,i)}}}function sy(t){let e,n;return e=new Qv({props:{imgData:t[1]}}),{c(){ve(e.$$.fragment)},m(i,r){ge(e,i,r),n=!0},p:te,i(i){n||(H(e.$$.fragment,i),n=!0)},o(i){K(e.$$.fragment,i),n=!1},d(i){_e(e,i)}}}function oy(t){let e,n,i,r,s,o,l,a,c;const u=[sy,ry],h=[];function f(d,m){return d[0]?0:1}return i=f(t),r=h[i]=u[i](t),a=new _1({props:{start:!1,buttonDisplay:!0,toggleLabel:B==="en"?"Overlay view":"Vue superposée"}}),a.$on("updateChecked",t[3]),{c(){e=b("div"),n=b("div"),r.c(),o=j(),l=b("div"),ve(a.$$.fragment),v(n,"class",s="modal-similarity-images "+(t[0]?"overlay-wrapper":"side-by-side-wrapper")+" svelte-1qvtan5"),v(e,"class","modal-similarity svelte-1qvtan5")},m(d,m){z(d,e,m),y(e,n),h[i].m(n,null),y(e,o),y(e,l),ge(a,l,null),c=!0},p(d,[m]){let p=i;i=f(d),i===p?h[i].p(d,m):(tt(),K(h[p],1,1,()=>{h[p]=null}),nt(),r=h[i],r?r.p(d,m):(r=h[i]=u[i](d),r.c()),H(r,1),r.m(n,null)),(!c||m&1&&s!==(s="modal-similarity-images "+(d[0]?"overlay-wrapper":"side-by-side-wrapper")+" svelte-1qvtan5"))&&v(n,"class",s)},i(d){c||(H(r),H(a.$$.fragment,d),c=!0)},o(d){K(r),K(a.$$.fragment,d),c=!1},d(d){d&&$(e),h[i].d(),_e(a)}}}function ly(t,e,n){let{mainImgItem:i}=e,{compareImgItem:r}=e;const s={similarityImage:{href:Kt(i.img,i.img.split("_").pop()),title:a(i.title)},queryImage:{href:Kt(r.img,r.img.split("_").pop()),title:a(r.title)}},o={similarityImage:i,queryImage:r};let l=!1;function a(u){return B==="fr"?`Vue principale de la région ${u}`:`Main view of region ${u}`}const c=()=>n(0,l=!l);return t.$$set=u=>{"mainImgItem"in u&&n(4,i=u.mainImgItem),"compareImgItem"in u&&n(5,r=u.compareImgItem)},[l,s,o,c,i,r]}class ay extends Ve{constructor(e){super(),He(this,e,ly,oy,ze,{mainImgItem:4,compareImgItem:5})}}const cy=Object.freeze(Object.defineProperty({__proto__:null,default:ay},Symbol.toStringTag,{value:"Module"})),$c=(t,e,n,i)=>({id:t,img:t,title:`Canvas ${i} - ${n} - ${B==="en"?"Witness":"Témoin"} #${Mr(e)}`,xywh:n.split(",").map(Number),canvas:i,ref:t.replace(".jpg",""),type:pu});function uy(t){let e,n,i,r,s,o,l,a,c,u,h;return n=new Bn({props:{category:1,isSelected:t[0]===1,toggle:t[4],padding:"pl-3 pr-2"}}),r=new Bn({props:{category:2,isSelected:t[0]===2,toggle:t[4]}}),o=new Bn({props:{category:3,isSelected:t[0]===3,toggle:t[4]}}),a=new Bn({props:{category:4,isSelected:t[0]===4,toggle:t[4]}}),u=new Bn({props:{category:5,isSelected:t[0]===5,toggle:t[4],padding:"pl-2 pr-3"}}),{c(){e=b("div"),ve(n.$$.fragment),i=j(),ve(r.$$.fragment),s=j(),ve(o.$$.fragment),l=j(),ve(a.$$.fragment),c=j(),ve(u.$$.fragment),v(e,"class","tags has-addons is-dark is-center")},m(f,d){z(f,e,d),ge(n,e,null),y(e,i),ge(r,e,null),y(e,s),ge(o,e,null),y(e,l),ge(a,e,null),y(e,c),ge(u,e,null),h=!0},p(f,d){const m={};d&1&&(m.isSelected=f[0]===1),n.$set(m);const p={};d&1&&(p.isSelected=f[0]===2),r.$set(p);const g={};d&1&&(g.isSelected=f[0]===3),o.$set(g);const _={};d&1&&(_.isSelected=f[0]===4),a.$set(_);const S={};d&1&&(S.isSelected=f[0]===5),u.$set(S)},i(f){h||(H(n.$$.fragment,f),H(r.$$.fragment,f),H(o.$$.fragment,f),H(a.$$.fragment,f),H(u.$$.fragment,f),h=!0)},o(f){K(n.$$.fragment,f),K(r.$$.fragment,f),K(o.$$.fragment,f),K(a.$$.fragment,f),K(u.$$.fragment,f),h=!1},d(f){f&&$(e),_e(n),_e(r),_e(o),_e(a),_e(u)}}}function fy(t){let e,n,i,r;n=new Jn({props:{item:t[3],size:256,selectable:!1,isSquare:!1}});let s=!t[2]&&uy(t);return{c(){e=b("div"),ve(n.$$.fragment),i=j(),s&&s.c()},m(o,l){z(o,e,l),ge(n,e,null),y(e,i),s&&s.m(e,null),r=!0},p(o,[l]){o[2]||s.p(o,l)},i(o){r||(H(n.$$.fragment,o),H(s),r=!0)},o(o){K(n.$$.fragment,o),K(s),r=!1},d(o){o&&$(e),_e(n),s&&s.d()}}}function dy(t,e,n){let i,r,s;const{comparedRegions:o}=hn;xe(t,o,R=>n(15,s=R));const l=new URL(window.location.href),a=l.origin;l.pathname;let{qImg:c}=e,{sImg:u}=e,{qRegions:h}=e,{sRegions:f}=e,{score:d=0}=e,{category:m=null}=e,{users:p=[]}=e,{isManual:g}=e,{similarityType:_}=e;const S=zt("isInModal")||!1,[C,w,k,T]=u.split(".")[0].split("_"),E=(()=>{let R=$c(u,C,T,k);const I=s[`${C}_${w}_anno${f}`]||{title:R.title};return R.title=`${wu(I.title.replace(/^[^|]+/,""))}<br/>Page ${bu(k)}<br/><b>Score: ${d}</b>`,R})();$n("similarityPair",{qImg:c,sImg:u,qRegions:h,sRegions:f,score:d,category:m,users:p,isManual:g,similarityType:_});function x(R){R=R.slice();let I=R.indexOf(Number(Ir));return r&&I===-1?R.push(Number(Ir)):!r&&I!==-1&&R.splice(I,1),R}const L=()=>({img_1:c,img_2:u,regions_id_1:h,regions_id_2:f,score:d,category:i,category_x:x(p),similarity_type:_});function O(R){R===5?r=!r:n(0,i=i===R?null:R)}async function F(R){O(R);try{(await fetch(`${a}/${Yt}/save-category`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":vn},body:JSON.stringify(L())})).ok||(console.error("Error: Network response was not ok"),O(R))}catch(I){console.error("Error:",I),O(R)}}return t.$$set=R=>{"qImg"in R&&n(5,c=R.qImg),"sImg"in R&&n(6,u=R.sImg),"qRegions"in R&&n(7,h=R.qRegions),"sRegions"in R&&n(8,f=R.sRegions),"score"in R&&n(9,d=R.score),"category"in R&&n(10,m=R.category),"users"in R&&n(11,p=R.users),"isManual"in R&&n(12,g=R.isManual),"similarityType"in R&&n(13,_=R.similarityType)},t.$$.update=()=>{t.$$.dirty&1024&&n(0,i=m),t.$$.dirty&2048&&(r=p.includes(Number(Ir))||!1)},[i,o,S,E,F,c,u,h,f,d,m,p,g,_]}class hy extends Ve{constructor(e){super(),He(this,e,dy,fy,ze,{qImg:5,sImg:6,qRegions:7,sRegions:8,score:9,category:10,users:11,isManual:12,similarityType:13})}}function zc(t,e,n){const i=t.slice();return i[22]=e[n].uuid,i[23]=e[n].data[0],i[24]=e[n].data[1],i[25]=e[n].data[2],i[26]=e[n].data[3],i[27]=e[n].data[4],i[28]=e[n].data[5],i[29]=e[n].data[6],i[30]=e[n].data[7],i[31]=e[n].data[8],i}function my(t){let e,n=B==="en"?`Error when retrieving similar regions: ${t[2]}`:`Erreur de recupération des régions similaires: ${t[2]}`,i;return{c(){e=b("div"),i=re(n),v(e,"class","faded is-center")},m(r,s){z(r,e,s),y(e,i)},p(r,s){s[0]&4&&n!==(n=B==="en"?`Error when retrieving similar regions: ${r[2]}`:`Erreur de recupération des régions similaires: ${r[2]}`)&&je(i,n)},i:te,o:te,d(r){r&&$(e)}}}function py(t){let e,n,i=t[4].length+"",r,s,o=t[11](t[10],t[4].length)+"",l,a,c,u=[],h=new Map,f,d=t[4];const m=g=>g[22];for(let g=0;g<d.length;g+=1){let _=zc(t,d,g),S=m(_);h.set(S,u[g]=Fc(S,_))}let p=null;return d.length||(p=jc(t)),{c(){e=b("div"),n=b("span"),r=re(i),s=j(),l=re(o),a=j(),c=b("div");for(let g=0;g<u.length;g+=1)u[g].c();p&&p.c(),v(n,"class","m-2"),v(c,"class","m-2 is-gap-2"),Ye(c,"grid",t[4].length>0)},m(g,_){z(g,e,_),y(e,n),y(n,r),y(n,s),y(n,l),y(e,a),y(e,c);for(let S=0;S<u.length;S+=1)u[S]&&u[S].m(c,null);p&&p.m(c,null),f=!0},p(g,_){(!f||_[0]&16)&&i!==(i=g[4].length+"")&&je(r,i),(!f||_[0]&16)&&o!==(o=g[11](g[10],g[4].length)+"")&&je(l,o),_[0]&49&&(d=g[4],tt(),u=Pi(u,_,m,1,g,d,h,c,Cr,Fc,null,zc),nt(),!d.length&&p?p.p(g,_):d.length?p&&(p.d(1),p=null):(p=jc(g),p.c(),p.m(c,null))),(!f||_[0]&16)&&Ye(c,"grid",g[4].length>0)},i(g){if(!f){for(let _=0;_<d.length;_+=1)H(u[_]);f=!0}},o(g){for(let _=0;_<u.length;_+=1)K(u[_]);f=!1},d(g){g&&$(e);for(let _=0;_<u.length;_+=1)u[_].d();p&&p.d()}}}function gy(t){let e;return{c(){e=b("div"),e.textContent=`${B==="en"&&!t[10]?"Retrieving similar regions...":B==="fr"&&!t[10]?"Récupération des régions similaires...":B==="en"&&t[10]?"Retrieving propagated regions...":"Récupération de similarités propagées..."}`,v(e,"class","faded is-center")},m(n,i){z(n,e,i)},p:te,i:te,o:te,d(n){n&&$(e)}}}function jc(t){let e;function n(s,o){return s[5]?vy:_y}let i=n(t),r=i(t);return{c(){r.c(),e=Ct()},m(s,o){r.m(s,o),z(s,e,o)},p(s,o){i===(i=n(s))&&r?r.p(s,o):(r.d(1),r=i(s),r&&(r.c(),r.m(e.parentNode,e)))},d(s){r.d(s),s&&$(e)}}}function _y(t){let e;return{c(){e=b("div"),e.textContent=`${B==="en"?"No similar regions":"Pas de régions similaires"}
                    `,v(e,"class","faded is-center")},m(n,i){z(n,e,i)},p:te,d(n){n&&$(e)}}}function vy(t){let e;return{c(){e=b("div"),e.textContent=`${B==="en"?"No document selected. Select one to display results.":"Aucun document sélectionné. Sélectionnez-en un pour afficher les résultats."}
                    `,v(e,"class","faded is-center")},m(n,i){z(n,e,i)},p:te,d(n){n&&$(e)}}}function Fc(t,e){let n,i,r;return i=new hy({props:{qImg:e[0],sImg:e[25],score:e[23],qRegions:e[26],sRegions:e[27],category:e[28],users:e[29],isManual:e[30],similarityType:e[31]}}),{key:t,first:null,c(){n=Ct(),ve(i.$$.fragment),this.first=n},m(s,o){z(s,n,o),ge(i,s,o),r=!0},p(s,o){e=s;const l={};o[0]&1&&(l.qImg=e[0]),o[0]&16&&(l.sImg=e[25]),o[0]&16&&(l.score=e[23]),o[0]&16&&(l.qRegions=e[26]),o[0]&16&&(l.sRegions=e[27]),o[0]&16&&(l.category=e[28]),o[0]&16&&(l.users=e[29]),o[0]&16&&(l.isManual=e[30]),o[0]&16&&(l.similarityType=e[31]),i.$set(l)},i(s){r||(H(i.$$.fragment,s),r=!0)},o(s){K(i.$$.fragment,s),r=!1},d(s){s&&$(n),_e(i,s)}}}function yy(t){let e,n,i,r;const s=[gy,py,my],o=[];function l(a,c){return a[1]&&a[3]==="loading"?0:a[3]==="loaded"?1:a[3]==="error"?2:-1}return~(e=l(t))&&(n=o[e]=s[e](t)),{c(){n&&n.c(),i=Ct()},m(a,c){~e&&o[e].m(a,c),z(a,i,c),r=!0},p(a,c){let u=e;e=l(a),e===u?~e&&o[e].p(a,c):(n&&(tt(),K(o[u],1,1,()=>{o[u]=null}),nt()),~e?(n=o[e],n?n.p(a,c):(n=o[e]=s[e](a),n.c()),H(n,1),n.m(i.parentNode,i)):n=null)},i(a){r||(H(n),r=!0)},o(a){K(n),r=!1},d(a){~e&&o[e].d(a),a&&$(i)}}}function by(t,e,n){let i,r,s,o,l,a,c,u,{qImg:h}=e,{sImgsPromise:f}=e;const{selectedRegions:d,excludedCategories:m,similarityScoreCutoff:p,propagateFilterByRegions:g}=hn;xe(t,d,x=>n(16,u=x)),xe(t,m,x=>n(15,c=x)),xe(t,p,x=>n(14,a=x)),xe(t,g,x=>n(13,l=x));const _=zt("similarityPropagatedContext")||!1,S=window.location.pathname.match(/\d+/g).join("-");let C;const w=(x,L)=>x===null||L===void 0||Number(x)>=L,k=(x,L,O)=>!O.includes(x),T=(x,L,O,F,R,I)=>_?!0:w(x,R)&&k(L,O,F),N=(x,L,O,F)=>x.filter(({uuid:R,data:[I,U,P,G,V,q,J,ue,ce]})=>T(I,q,J,L,O)),E=(x,L)=>{const O=L>1;return x?B==="fr"?O?"similarités propagées":"similarité propagée":O?"propagated matches":"propagated match":B==="fr"?O?"images similaires":"image similaire":O?"similar images":"similar image"};return t.$$set=x=>{"qImg"in x&&n(0,h=x.qImg),"sImgsPromise"in x&&n(1,f=x.sImgsPromise)},t.$$.update=()=>{t.$$.dirty[0]&65536&&n(5,i=Object.values(u).length===0||u[S]===void 0||!Object.keys(u[S]).length),t.$$.dirty[0]&2&&(x=>{n(3,r="loading"),n(4,o=[]),n(12,s=[])})(),t.$$.dirty[0]&2&&f.then(x=>{n(12,s=x.map(L=>({uuid:window.crypto.randomUUID(),data:L}))),n(3,r="loaded")}).catch(x=>{n(2,C=x),n(3,r="error")}),t.$$.dirty[0]&61440&&n(4,o=N(s,c,a))},n(3,r="loading"),n(12,s=[]),[h,f,C,r,o,i,d,m,p,g,_,E,s,l,a,c,u]}class Hc extends Ve{constructor(e){super(),He(this,e,by,yy,ze,{qImg:0,sImgsPromise:1},null,[-1,-1])}}function wy(t){let e,n;return e=new Hc({props:{qImg:t[0],sImgsPromise:t[1]}}),{c(){ve(e.$$.fragment)},m(i,r){ge(e,i,r),n=!0},p(i,[r]){const s={};r&1&&(s.qImg=i[0]),r&2&&(s.sImgsPromise=i[1]),e.$set(s)},i(i){n||(H(e.$$.fragment,i),n=!0)},o(i){K(e.$$.fragment,i),n=!1},d(i){_e(e,i)}}}function Sy(t,e,n){let i,r,{qImg:s}=e,o;const l=zt("isInModal")||!1,{selectedRegions:a,comparedRegions:c}=hn;xe(t,a,m=>n(4,i=m)),xe(t,c,m=>n(5,r=m));const u=`${window.location.origin}${window.location.pathname}`,h=window.location.pathname.match(/\d+/g).join("-"),f=(m,p)=>p?Object.keys(r).map(g=>r[g].id):Object.values(m[h]||{}).map(g=>g.id);async function d(m,p,g){const _=f(p,g);return _.length===0?[]:await(await fetch(`${u}similar-images`,{method:"POST",body:JSON.stringify({regionsIds:_,qImg:m,topk:12}),headers:{"Content-Type":"application/json","X-CSRFToken":vn}})).json()}return l?o=d(s,i,l):a.subscribe(m=>{n(1,o=d(s,m,l))}),t.$$set=m=>{"qImg"in m&&n(0,s=m.qImg)},[s,o,a,c]}class ky extends Ve{constructor(e){super(),He(this,e,Sy,wy,ze,{qImg:0})}}const Sb="";function Ey(t){let e,n,i,r;return i=new Hc({props:{qImg:t[0],sImgsPromise:t[1]}}),{c(){e=b("div"),n=b("div"),ve(i.$$.fragment),v(n,"class","matches-suggestion svelte-1cb4wg0"),v(e,"class","block matches-suggestion-wrapper svelte-1cb4wg0")},m(s,o){z(s,e,o),y(e,n),ge(i,n,null),r=!0},p(s,[o]){const l={};o&1&&(l.qImg=s[0]),o&2&&(l.sImgsPromise=s[1]),i.$set(l)},i(s){r||(H(i.$$.fragment,s),r=!0)},o(s){K(i.$$.fragment,s),r=!1},d(s){s&&$(e),_e(i)}}}function Cy(t,e,n){let i,r,{qImg:s}=e;const{propagateParams:o,selectedRegions:l}=hn;xe(t,o,g=>n(4,i=g)),xe(t,l,g=>n(5,r=g));const a=`${window.location.origin}${window.location.pathname}`,c=window.location.pathname.match(/\d+/g).join("-"),u=zt("isInModal")||!1;let h;const f=Li();f.setCompareFn((g,_)=>[g,_].every(S=>S&&S.hasOwnProperty("propagateRecursionDepth")&&S.hasOwnProperty("propagateFilterByRegions"))?g.propagateRecursionDepth===_.propagateRecursionDepth&&g.propagateFilterByRegions===_.propagateFilterByRegions:!1);const d=Li();d.setCompareFn(Nr),$n("similarityPropagatedContext",!0);const m=g=>Object.keys(g).includes(c)?Object.values(g[c]).map(_=>_.id):[],p=async(g,_,S)=>fetch(`${a}propagated-matches/${s}`,{method:"POST",body:JSON.stringify({regionsIds:S?[]:_,filterByRegions:S?!1:g.propagateFilterByRegions,recursionDepth:g.propagateRecursionDepth}),headers:{"Content-Type":"application/json","X-CSRFToken":vn}}).then(C=>C.json()).catch(C=>(console.error("PropagatedMatches.getPropagatedMatches:",C),[]));return o.subscribe(g=>{f.set(g),f.same()||n(1,h=p(f.get(),m(r),u))}),l.subscribe(g=>{d.set(m(g)),i.propagateFilterByRegions===!0&&!d.same()&&n(1,h=p(i,d.get(),u))}),t.$$set=g=>{"qImg"in g&&n(0,s=g.qImg)},[s,h,o,l]}class Iy extends Ve{constructor(e){super(),He(this,e,Cy,Ey,ze,{qImg:0})}}const kb="";function xy(t){let e,n,i,r=parseInt(t[5])+"",s,o,l,a,c,u,h,f,d,m,p,g,_,S,C,w,k,T,N;return{c(){e=b("a"),n=b("i"),i=re(`
            Page `),s=re(r),o=j(),l=b("img"),c=j(),u=b("div"),h=b("div"),f=b("input"),d=j(),m=b("button"),m.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M256 80c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 144L48 224c-17.7 0-32 14.3-32 32s14.3 32 32 32l144 0 0 144c0 17.7 14.3 32 32 32s32-14.3 32-32l0-144 144 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-144 0 0-144z"></path></svg>',p=j(),g=b("button"),_=Wt("svg"),S=Wt("path"),v(n,"class","fa-solid fa-pen-to-square"),v(e,"class","tag px-2 py-1 mb-2 is-rounded is-hoverable"),v(e,"href",Iu(t[6],parseInt(t[5]))),v(e,"target","_blank"),At(l.src,a=Kt(t[0],t[0].split("_").pop(),"250,"))||v(l,"src",a),v(l,"alt","Query region"),v(l,"class","mb-3 card query-image svelte-f4ylwc"),v(f,"class","input is-small tag"),v(f,"type","text"),v(f,"placeholder",B==="en"?"Add new match":"Ajouter une correspondance"),v(m,"class","button is-small tag is-link is-center"),v(h,"class","tags has-addons"),We(h,"flex-wrap","nowrap"),v(S,"fill","white"),v(S,"d","M376.6 84.5c11.3-13.6 9.5-33.8-4.1-45.1s-33.8-9.5-45.1 4.1L192 206 56.6 43.5C45.3 29.9 25.1 28.1 11.5 39.4S-3.9 70.9 7.4 84.5L150.3 256 7.4 427.5c-11.3 13.6-9.5 33.8 4.1 45.1s33.8 9.5 45.1-4.1L192 306 327.4 468.5c11.3 13.6 31.5 15.4 45.1 4.1s15.4-31.5 4.1-45.1L233.7 256 376.6 84.5z"),v(_,"xmlns","http://www.w3.org/2000/svg"),v(_,"viewBox","0 0 384 512"),v(g,"id","no-match"),v(g,"class",C="button is-small tag is-danger is-center m-0 "+(t[3]===1?"visible":"")+" svelte-f4ylwc"),v(g,"title",B==="en"?"No match for this region in this witness":"Aucune correspondance de cette région pour ce témoin"),v(u,"class","new-similarity control pt-2 is-center svelte-f4ylwc")},m(E,x){z(E,e,x),y(e,n),y(e,i),y(e,s),z(E,o,x),z(E,l,x),z(E,c,x),z(E,u,x),y(u,h),y(h,f),Ci(f,t[1]),y(h,d),y(h,m),y(u,p),y(u,g),y(g,_),y(_,S),k=!0,T||(N=[Ce(f,"input",t[12]),Ce(m,"click",t[8]),Ce(g,"click",t[9])],T=!0)},p(E,x){(!k||x&1&&!At(l.src,a=Kt(E[0],E[0].split("_").pop(),"250,")))&&v(l,"src",a),x&2&&f.value!==E[1]&&Ci(f,E[1]),(!k||x&8&&C!==(C="button is-small tag is-danger is-center m-0 "+(E[3]===1?"visible":"")+" svelte-f4ylwc"))&&v(g,"class",C)},i(E){k||(jt(()=>{k&&(w||(w=_n(g,Un,{duration:500},!0)),w.run(1))}),k=!0)},o(E){w||(w=_n(g,Un,{duration:500},!1)),w.run(0),k=!1},d(E){E&&$(e),E&&$(o),E&&$(l),E&&$(c),E&&$(u),E&&w&&w.end(),T=!1,yt(N)}}}function My(t){let e,n,i,r,s,o,l,a;return n=new ky({props:{qImg:t[0]}}),o=new Iy({props:{qImg:t[0]}}),{c(){e=b("div"),ve(n.$$.fragment),r=j(),s=b("div"),ve(o.$$.fragment),v(e,"class",i=Ei(t[7]?"":t[2])+" svelte-f4ylwc"),v(s,"class",l=Ei(t[7]?"":t[2])+" svelte-f4ylwc")},m(c,u){z(c,e,u),ge(n,e,null),z(c,r,u),z(c,s,u),ge(o,s,null),a=!0},p(c,u){const h={};u&1&&(h.qImg=c[0]),n.$set(h),(!a||u&4&&i!==(i=Ei(c[7]?"":c[2])+" svelte-f4ylwc"))&&v(e,"class",i);const f={};u&1&&(f.qImg=c[0]),o.$set(f),(!a||u&4&&l!==(l=Ei(c[7]?"":c[2])+" svelte-f4ylwc"))&&v(s,"class",l)},i(c){a||(H(n.$$.fragment,c),H(o.$$.fragment,c),a=!0)},o(c){K(n.$$.fragment,c),K(o.$$.fragment,c),a=!1},d(c){c&&$(e),_e(n),c&&$(r),c&&$(s),_e(o)}}}function Ay(t){let e,n;return e=new Ma({props:{useGrid:!1,$$slots:{"row-body":[My],"row-header":[xy]},$$scope:{ctx:t}}}),{c(){ve(e.$$.fragment)},m(i,r){ge(e,i,r),n=!0},p(i,[r]){const s={};r&1048591&&(s.$$scope={dirty:r,ctx:i}),e.$set(s)},i(i){n||(H(e.$$.fragment,i),n=!0)},o(i){K(e.$$.fragment,i),n=!1},d(i){_e(e,i)}}}function Ty(t){return t=t.replace(".jpg",""),/^wit\d+_[a-zA-Z]{3}\d+_\d+_\d+,\d+,\d+,\d+$/.test(t)}function Ny(t,e,n){let i,r,s,o;const{selectedRegions:l}=hn;xe(t,l,T=>n(11,o=T));let{qImg:a}=e,c="";const[u,h,f,d]=a.split(".")[0].split("_"),m=`${window.location.origin}${window.location.pathname}`,p=window.location.pathname.match(/\d+/g).join("-"),g=B==="en"?"Error":"Erreur",_=zt("manifest"),S=zt("isInModal")||!1;$n("qImgMetadata",$c(a,u,d,f));async function C(){if(!c||!Ty(c)){await Tt(B==="en"?"Please insert a valid region reference to add a new match":"Veuillez insérer une référence de région valide pour ajouter une nouvelle correspondance","Error");return}try{const T=await fetch(`${m}add-region-pair`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":vn},body:JSON.stringify({q_img:a.replace(".jpg",""),s_img:c,similarity_type:2})});T.ok||(console.error("Error: Network response was not ok"),await Tt(B==="en"?"Problem with network, match was not added":"Problème de réseau, la correspondance n'a pas été ajoutée",g));const N=await T.json();if(N.hasOwnProperty("error")||!N.hasOwnProperty("s_regions")){await Tt(B==="en"?`Request was unsuccessful, match was not added:<br>${N.error}`:`La requête n'a pas abouti, la correspondance n'a pas été ajoutée :<br>${N.error}`,g);return}const E=N.s_regions;hn.addComparedRegions(E),hn.select(E)}catch(T){console.error("Error:",T),await Tt(B==="en"?`An error has occurred, match was not added:<br>${T}`:`Une erreur s'est produite, la correspondance n'a pas été ajoutée :<br>${T}`,g)}}async function w(){const T=Object.values(o[p])[0];if(await Tt(B==="en"?`Do you confirm this region does not have any match in ${T.title}?`:`Confirmez-vous que cette région n'a pas de correspondance dans ${T.title} ?`,B==="en"?"Confirm no match":"Confirmer l'absence de correspondance",!0))try{(await fetch(`${m}no-match`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":vn},body:JSON.stringify({q_img:a,s_regions:T.id})})).ok||(console.error("Error: Network response was not ok"),await Tt(B==="en"?"Problem with network":"Problème de réseau",g)),hn.select(T)}catch(E){console.error("Error:",E),await Tt(B==="en"?`An error has occurred, request was unsuccessful:<br>${E}`:`Une erreur s'est produite, la requête n'a pas abouti :<br>${E}`,g)}}function k(){c=this.value,n(1,c)}return t.$$set=T=>{"qImg"in T&&n(0,a=T.qImg)},t.$$.update=()=>{t.$$.dirty&2048&&n(3,i=o.hasOwnProperty(p)?Object.values(o[p]).length:0),t.$$.dirty&1024&&n(2,s=`fixed-grid has-${r-1}-cols`)},n(10,r=Us(window.innerWidth)),[a,c,s,i,l,f,_,S,C,w,r,o,k]}class Py extends Ve{constructor(e){super(),He(this,e,Ny,Ay,ze,{qImg:0})}}function Oy(t){let e,n,i,r,s,o;return s=new Py({props:{qImg:t[0].img}}),{c(){e=b("div"),n=b("a"),i=b("button"),i.textContent=`${B==="fr"?"Voir toutes les similarités pour ce document":"View all similarities for this document"}`,r=j(),ve(s.$$.fragment),v(i,"class","button is-link is-small"),v(n,"href",t[1]()),v(e,"class","is-flex is-align-items-center is-justify-content-end")},m(l,a){z(l,e,a),y(e,n),y(n,i),z(l,r,a),ge(s,l,a),o=!0},p(l,[a]){const c={};a&1&&(c.qImg=l[0].img),s.$set(c)},i(l){o||(H(s.$$.fragment,l),o=!0)},o(l){K(s.$$.fragment,l),o=!1},d(l){l&&$(e),l&&$(r),_e(s,l)}}}function Ly(t,e,n){let{mainImgItem:i}=e;function r(){const s=i.img.match(/wit(\d+)/)[1],o=new URL(window.location.origin);return o.pathname=`${new URL(window.location).pathname.split("/")[1]}/witness/${s}/regions/`,o.searchParams.set("tab","similarity"),o.href}return t.$$set=s=>{"mainImgItem"in s&&n(0,i=s.mainImgItem)},[i,r]}class Ry extends Ve{constructor(e){super(),He(this,e,Ly,Oy,ze,{mainImgItem:0})}}const Dy=Object.freeze(Object.defineProperty({__proto__:null,default:Ry},Symbol.toStringTag,{value:"Module"}))})();
//# sourceMappingURL=documentSet.js.map
