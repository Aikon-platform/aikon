(function(){"use strict";function ie(){}const Ms=t=>t;function As(t,e){for(const n in e)t[n]=e[n];return t}function Kc(t){return!!t&&(typeof t=="object"||typeof t=="function")&&typeof t.then=="function"}function Ts(t){return t()}function Ns(){return Object.create(null)}function vt(t){t.forEach(Ts)}function Nn(t){return typeof t=="function"}function je(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}let ki;function xt(t,e){return ki||(ki=document.createElement("a")),ki.href=e,t===ki.href}function Wc(t){return Object.keys(t).length===0}function Ei(t,...e){if(t==null)return ie;const n=t.subscribe(...e);return n.unsubscribe?()=>n.unsubscribe():n}function St(t){let e;return Ei(t,n=>e=n)(),e}function Me(t,e,n){t.$$.on_destroy.push(Ei(e,n))}function Vt(t,e,n,i){if(t){const r=Ps(t,e,n,i);return t[0](r)}}function Ps(t,e,n,i){return t[1]&&i?As(n.ctx.slice(),t[1](i(e))):n.ctx}function Ut(t,e,n,i){if(t[2]&&i){const r=t[2](i(n));if(e.dirty===void 0)return r;if(typeof r=="object"){const s=[],o=Math.max(e.dirty.length,r.length);for(let l=0;l<o;l+=1)s[l]=e.dirty[l]|r[l];return s}return e.dirty|r}return e.dirty}function Bt(t,e,n,i,r,s){if(r){const o=Ps(e,n,i,s);t.p(o,r)}}function qt(t){if(t.ctx.length>32){const e=[],n=t.ctx.length/32;for(let i=0;i<n;i++)e[i]=-1;return e}return-1}function Yc(t){const e={};for(const n in t)e[n]=!0;return e}function Ci(t){return t??""}function ei(t){return t&&Nn(t.destroy)?t.destroy:ie}const Os=typeof window<"u";let Xc=Os?()=>window.performance.now():()=>Date.now(),vr=Os?t=>requestAnimationFrame(t):ie;const Pn=new Set;function Ls(t){Pn.forEach(e=>{e.c(t)||(Pn.delete(e),e.f())}),Pn.size!==0&&vr(Ls)}function Gc(t){let e;return Pn.size===0&&vr(Ls),{promise:new Promise(n=>{Pn.add(e={c:t,f:n})}),abort(){Pn.delete(e)}}}const Jc=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function y(t,e){t.appendChild(e)}function Ds(t){if(!t)return document;const e=t.getRootNode?t.getRootNode():t.ownerDocument;return e&&e.host?e:t.ownerDocument}function Qc(t){const e=b("style");return Zc(Ds(t),e),e.sheet}function Zc(t,e){return y(t.head||t,e),e.sheet}function $(t,e,n){t.insertBefore(e,n||null)}function D(t){t.parentNode&&t.parentNode.removeChild(t)}function bt(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function b(t){return document.createElement(t)}function Wt(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function re(t){return document.createTextNode(t)}function j(){return re(" ")}function kt(){return re("")}function Ae(t,e,n,i){return t.addEventListener(e,n,i),()=>t.removeEventListener(e,n,i)}function sn(t){return function(e){return e.preventDefault(),t.call(this,e)}}function v(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function eu(t){return Array.from(t.childNodes)}function Le(t,e){e=""+e,t.data!==e&&(t.data=e)}function Ii(t,e){t.value=e??""}function Ue(t,e,n,i){n==null?t.style.removeProperty(e):t.style.setProperty(e,n,i?"important":"")}function On(t,e,n){for(let i=0;i<t.options.length;i+=1){const r=t.options[i];if(r.__value===e){r.selected=!0;return}}(!n||e!==void 0)&&(t.selectedIndex=-1)}function yr(t){const e=t.querySelector(":checked");return e&&e.__value}function Ge(t,e,n){t.classList[n?"add":"remove"](e)}function Rs(t,e,{bubbles:n=!1,cancelable:i=!1}={}){const r=document.createEvent("CustomEvent");return r.initCustomEvent(t,n,i,e),r}function xi(t,e){return new t(e)}const Mi=new Map;let Ai=0;function tu(t){let e=5381,n=t.length;for(;n--;)e=(e<<5)-e^t.charCodeAt(n);return e>>>0}function nu(t,e){const n={stylesheet:Qc(e),rules:{}};return Mi.set(t,n),n}function $s(t,e,n,i,r,s,o,l=0){const a=16.666/i;let c=`{
`;for(let g=0;g<=1;g+=a){const _=e+(n-e)*s(g);c+=g*100+`%{${o(_,1-_)}}
`}const u=c+`100% {${o(n,1-n)}}
}`,h=`__svelte_${tu(u)}_${l}`,f=Ds(t),{stylesheet:d,rules:m}=Mi.get(f)||nu(f,t);m[h]||(m[h]=!0,d.insertRule(`@keyframes ${h} ${u}`,d.cssRules.length));const p=t.style.animation||"";return t.style.animation=`${p?`${p}, `:""}${h} ${i}ms linear ${r}ms 1 both`,Ai+=1,h}function iu(t,e){const n=(t.style.animation||"").split(", "),i=n.filter(e?s=>s.indexOf(e)<0:s=>s.indexOf("__svelte")===-1),r=n.length-i.length;r&&(t.style.animation=i.join(", "),Ai-=r,Ai||ru())}function ru(){vr(()=>{Ai||(Mi.forEach(t=>{const{ownerNode:e}=t.stylesheet;e&&D(e)}),Mi.clear())})}let ti;function on(t){ti=t}function Ln(){if(!ti)throw new Error("Function called outside component initialization");return ti}function Dn(t){Ln().$$.on_mount.push(t)}function Rn(t){Ln().$$.on_destroy.push(t)}function Ti(){const t=Ln();return(e,n,{cancelable:i=!1}={})=>{const r=t.$$.callbacks[e];if(r){const s=Rs(e,n,{cancelable:i});return r.slice().forEach(o=>{o.call(t,s)}),!s.defaultPrevented}return!0}}function $n(t,e){return Ln().$$.context.set(t,e),e}function zt(t){return Ln().$$.context.get(t)}const zn=[],pn=[];let jn=[];const zs=[],su=Promise.resolve();let br=!1;function ou(){br||(br=!0,su.then(Sr))}function Kt(t){jn.push(t)}const wr=new Set;let Fn=0;function Sr(){if(Fn!==0)return;const t=ti;do{try{for(;Fn<zn.length;){const e=zn[Fn];Fn++,on(e),lu(e.$$)}}catch(e){throw zn.length=0,Fn=0,e}for(on(null),zn.length=0,Fn=0;pn.length;)pn.pop()();for(let e=0;e<jn.length;e+=1){const n=jn[e];wr.has(n)||(wr.add(n),n())}jn.length=0}while(zn.length);for(;zs.length;)zs.pop()();br=!1,wr.clear(),on(t)}function lu(t){if(t.fragment!==null){t.update(),vt(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(Kt)}}function au(t){const e=[],n=[];jn.forEach(i=>t.indexOf(i)===-1?e.push(i):n.push(i)),n.forEach(i=>i()),jn=e}let ni;function cu(){return ni||(ni=Promise.resolve(),ni.then(()=>{ni=null})),ni}function kr(t,e,n){t.dispatchEvent(Rs(`${e?"intro":"outro"}${n}`))}const Ni=new Set;let ln;function et(){ln={r:0,c:[],p:ln}}function tt(){ln.r||vt(ln.c),ln=ln.p}function H(t,e){t&&t.i&&(Ni.delete(t),t.i(e))}function B(t,e,n,i){if(t&&t.o){if(Ni.has(t))return;Ni.add(t),ln.c.push(()=>{Ni.delete(t),i&&(n&&t.d(1),i())}),t.o(e)}else i&&i()}const uu={duration:0};function gn(t,e,n,i){const r={direction:"both"};let s=e(t,n,r),o=i?0:1,l=null,a=null,c=null;function u(){c&&iu(t,c)}function h(d,m){const p=d.b-o;return m*=Math.abs(p),{a:o,b:d.b,d:p,duration:m,start:d.start,end:d.start+m,group:d.group}}function f(d){const{delay:m=0,duration:p=300,easing:g=Ms,tick:_=ie,css:k}=s||uu,C={start:Xc()+m,b:d};d||(C.group=ln,ln.r+=1),l||a?a=C:(k&&(u(),c=$s(t,o,d,p,m,g,k)),d&&_(0,1),l=h(C,p),Kt(()=>kr(t,d,"start")),Gc(w=>{if(a&&w>a.start&&(l=h(a,p),a=null,kr(t,l.b,"start"),k&&(u(),c=$s(t,o,l.b,l.duration,0,g,s.css))),l){if(w>=l.end)_(o=l.b,1-o),kr(t,l.b,"end"),a||(l.b?u():--l.group.r||vt(l.group.c)),l=null;else if(w>=l.start){const S=w-l.start;o=l.a+l.d*g(S/l.duration),_(o,1-o)}}return!!(l||a)}))}return{run(d){Nn(s)?cu().then(()=>{s=s(r),f(d)}):f(d)},end(){u(),l=a=null}}}function Er(t,e){const n=e.token={};function i(r,s,o,l){if(e.token!==n)return;e.resolved=l;let a=e.ctx;o!==void 0&&(a=a.slice(),a[o]=l);const c=r&&(e.current=r)(a);let u=!1;e.block&&(e.blocks?e.blocks.forEach((h,f)=>{f!==s&&h&&(et(),B(h,1,1,()=>{e.blocks[f]===h&&(e.blocks[f]=null)}),tt())}):e.block.d(1),c.c(),H(c,1),c.m(e.mount(),e.anchor),u=!0),e.block=c,e.blocks&&(e.blocks[s]=c),u&&Sr()}if(Kc(t)){const r=Ln();if(t.then(s=>{on(r),i(e.then,1,e.value,s),on(null)},s=>{if(on(r),i(e.catch,2,e.error,s),on(null),!e.hasCatch)throw s}),e.current!==e.pending)return i(e.pending,0),!0}else{if(e.current!==e.then)return i(e.then,1,e.value,t),!0;e.resolved=t}}function js(t,e,n){const i=e.slice(),{resolved:r}=t;t.current===t.then&&(i[t.value]=r),t.current===t.catch&&(i[t.error]=r),t.block.p(i,n)}function Fs(t,e){t.d(1),e.delete(t.key)}function Cr(t,e){B(t,1,1,()=>{e.delete(t.key)})}function ii(t,e,n,i,r,s,o,l,a,c,u,h){let f=t.length,d=s.length,m=f;const p={};for(;m--;)p[t[m].key]=m;const g=[],_=new Map,k=new Map,C=[];for(m=d;m--;){const M=h(r,s,m),E=n(M);let I=o.get(E);I?i&&C.push(()=>I.p(M,e)):(I=c(E,M),I.c()),_.set(E,g[m]=I),E in p&&k.set(E,Math.abs(m-p[E]))}const w=new Set,S=new Set;function N(M){H(M,1),M.m(l,u),o.set(M.key,M),u=M.first,d--}for(;f&&d;){const M=g[d-1],E=t[f-1],I=M.key,O=E.key;M===E?(u=M.first,f--,d--):_.has(O)?!o.has(I)||w.has(I)?N(M):S.has(O)?f--:k.get(I)>k.get(O)?(S.add(I),N(M)):(w.add(O),f--):(a(E,o),f--)}for(;f--;){const M=t[f];_.has(M.key)||a(M,o)}for(;d;)N(g[d-1]);return vt(C),g}function fu(t,e){const n={},i={},r={$$scope:1};let s=t.length;for(;s--;){const o=t[s],l=e[s];if(l){for(const a in o)a in l||(i[a]=1);for(const a in l)r[a]||(n[a]=l[a],r[a]=1);t[s]=l}else for(const a in o)r[a]=1}for(const o in i)o in n||(n[o]=void 0);return n}function du(t){return typeof t=="object"&&t!==null?t:{}}function ve(t){t&&t.c()}function pe(t,e,n,i){const{fragment:r,after_update:s}=t.$$;r&&r.m(e,n),i||Kt(()=>{const o=t.$$.on_mount.map(Ts).filter(Nn);t.$$.on_destroy?t.$$.on_destroy.push(...o):vt(o),t.$$.on_mount=[]}),s.forEach(Kt)}function ge(t,e){const n=t.$$;n.fragment!==null&&(au(n.after_update),vt(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function hu(t,e){t.$$.dirty[0]===-1&&(zn.push(t),ou(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function Be(t,e,n,i,r,s,o,l=[-1]){const a=ti;on(t);const c=t.$$={fragment:null,ctx:[],props:s,update:ie,not_equal:r,bound:Ns(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(a?a.$$.context:[])),callbacks:Ns(),dirty:l,skip_bound:!1,root:e.target||a.$$.root};o&&o(c.root);let u=!1;if(c.ctx=n?n(t,e.props||{},(h,f,...d)=>{const m=d.length?d[0]:f;return c.ctx&&r(c.ctx[h],c.ctx[h]=m)&&(!c.skip_bound&&c.bound[h]&&c.bound[h](m),u&&hu(t,h)),f}):[],c.update(),u=!0,vt(c.before_update),c.fragment=i?i(c.ctx):!1,e.target){if(e.hydrate){const h=eu(e.target);c.fragment&&c.fragment.l(h),h.forEach(D)}else c.fragment&&c.fragment.c();e.intro&&H(t.$$.fragment),pe(t,e.target,e.anchor,e.customElement),Sr()}on(a)}class qe{$destroy(){ge(this,1),this.$destroy=ie}$on(e,n){if(!Nn(n))return ie;const i=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return i.push(n),()=>{const r=i.indexOf(n);r!==-1&&i.splice(r,1)}}$set(e){this.$$set&&!Wc(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const Hn=[];function mu(t,e){return{subscribe:De(t,e).subscribe}}function De(t,e=ie){let n;const i=new Set;function r(l){if(je(t,l)&&(t=l,n)){const a=!Hn.length;for(const c of i)c[1](),Hn.push(c,t);if(a){for(let c=0;c<Hn.length;c+=2)Hn[c][0](Hn[c+1]);Hn.length=0}}}function s(l){r(l(t))}function o(l,a=ie){const c=[l,a];return i.add(c),i.size===1&&(n=e(r)||ie),l(t),()=>{i.delete(c),i.size===0&&n&&(n(),n=null)}}return{set:r,update:s,subscribe:o}}function ut(t,e,n){const i=!Array.isArray(t),r=i?[t]:t,s=e.length<2;return mu(n,o=>{let l=!1;const a=[];let c=0,u=ie;const h=()=>{if(c)return;u();const d=e(i?a[0]:a,o);s?o(d):u=Nn(d)?d:ie},f=r.map((d,m)=>Ei(d,p=>{a[m]=p,c&=~(1<<m),l&&h()},()=>{c|=1<<m}));return l=!0,h(),function(){vt(f),u(),l=!1}})}const U=APP_LANG,Yt=APP_NAME;WEBAPP_NAME;const Ir=USER_ID,xr=IS_SUPERUSER;ADD_PERMISSION;const _n=CSRF_TOKEN;ADDITIONAL_MODULES;const pu="Region",Pi=APP_URL,gu=SAS_APP_URL,_u=CANTALOUPE_APP_URL;MEDIA_PATH;const vu=PAGE_LEN,yu={Witness:U==="en"?"Witness":"Témoin",Work:U==="en"?"Work":"Œuvre",Series:U==="en"?"Series":"Série d'imprimés",Regions:U==="en"?"Region Extraction":"Extraction d'illustrations"},ri=De(!1),bu=De(""),wu=t=>typeof t=="string"||t instanceof String;async function Hs(t){ri.set(!0);try{return await t()}finally{ri.set(!1)}}function Mr(t){return t.match(/\d+/g).toString()}function Su(t){return parseInt(Mr(t),10)}function ku(t,e=100){const n=Math.floor(e*.75);return t.length>e?t.slice(0,n)+"..."+t.slice(-e+n):t}function Eu(){return _u??"http://localhost:8182"}function Cu(){return gu??"http://localhost:8888"}function Ar(t,e){if(typeof window<"u"){const n=parseInt(new URLSearchParams(window.location.search).get(e));if(!isNaN(n))return t.set(n),n}return t.set(1),1}function Tr(t,e,n){if(e.set(t),typeof window<"u"){const i=new URL(window.location.href);i.searchParams.set(n,t),window.history.pushState({},"",i)}}function Iu(t=null){return t=t.split("_"),t.length<3?void 0:`${t.slice(0,3).join("_").replace(".jpg","")}.jpg`}function Vs(t=null){const e=Iu(t);return e===void 0?void 0:`${Eu()}/iiif/2/${e}`}function jt(t=null,e=null,n="full"){if(e=wu(e)?e.replace(".jpg",""):e,!t)return"https://placehold.co/96x96/png?text=No+image";const i=Vs(t);if(i===void 0)return"https://placehold.co/96x96/png?text=No+image";const r=t.split("_");return e||(e=r[r.length-1].includes(",")?r.pop().replace(".jpg",""):"full"),`${i}/${e}/${n}/0/default.jpg`}function xu(t=null){return`${Vs(t)}/info.json`}function Mu(t=null,e=1){return`${Cu()}/index.html?iiif-content=${t}&canvas=${e}`}function Mt(t,e=null,n=!1){return new Promise(i=>{if(document.getElementById("msg-modal")){n?document.getElementById("modal-footer").hidden=!1:i(void 0),e&&(document.getElementById("modal-title").innerHTML=e),document.getElementById("modal-msg").innerHTML=t,document.getElementById("hidden-msg-btn").click();const s=document.getElementById("cancel-btn"),o=document.getElementById("ok-btn"),l=document.getElementById("modal-bkg"),a=()=>{s.removeEventListener("click",c),l.removeEventListener("click",c),o.removeEventListener("click",u),document.getElementById("modal-footer").hidden=!0},c=()=>{a(),i(!1)},u=()=>{a(),i(!0)};s.addEventListener("click",c),o.addEventListener("click",u)}else n?i(window.confirm(t)):(window.alert(t),i(void 0))})}function Oi(){let t,e,n=(i,r)=>i===r;return{set:i=>{e=t,t=i},setCompareFn:i=>n=i,get:()=>t,getNewAndOld:()=>[t,e],same:()=>n(t,e)}}const Nr=(t,e)=>Array.isArray(t)&&Array.isArray(e)&&t.length===e.length&&t.every((n,i)=>n===e[i]||void 0);function Au(t){const n=[85,70,60],i=[50,65,40],r=t*137.5%360,s=n[t%n.length],o=i[Math.floor(t/n.length)%i.length];return`hsl(${Math.floor(r)}, ${s}%, ${o}%)`}function Us(t=null){return t<600?1:t<800?2:t<1e3?3:t<1200?4:t<1400?5:t>=1400?6:4}function Pr(t){const e=t.querySelectorAll(".modal-background, .modal-close, .modal-card-head .delete, .modal-card-foot .button-close"),n=()=>t.classList.remove("is-active");e.forEach(r=>r.addEventListener("click",n));const i=r=>{r.key==="Escape"&&t.classList.contains("is-active")&&n()};return document.addEventListener("keydown",i),{destroy(){e.forEach(r=>r.removeEventListener("click",n)),document.removeEventListener("keydown",i)}}}function Bs(t){const e=()=>{const n=document.getElementById(t.dataset.target);n==null||n.classList.add("is-active")};return t.addEventListener("click",e),{destroy(){t.removeEventListener("click",e)}}}function Vn(t,e,n="string",i=null){const r={string:o=>{const l=o.get(e);return l!==null?l:null},array:o=>{const l=o.get(e);return l?l.split(",").map(Number).filter(a=>!isNaN(a)):null},set:o=>{const l=o.get(e);return l?new Set(l.split(",").map(Number).filter(a=>!isNaN(a))):null},number:o=>{const l=o.get(e);return l!==null?Number(l):null},boolean:o=>{const l=o.get(e);return l!==null?l==="true":null}},s={string:(o,l)=>l?o.searchParams.set(e,l):o.searchParams.delete(e),array:(o,l)=>{l!=null&&l.length?o.searchParams.set(e,l.join(",")):o.searchParams.delete(e)},set:(o,l)=>{l!=null&&l.size?o.searchParams.set(e,Array.from(l).join(",")):o.searchParams.delete(e)},number:(o,l)=>{l!=null?o.searchParams.set(e,String(l)):o.searchParams.delete(e)},boolean:(o,l)=>l?o.searchParams.set(e,"true"):o.searchParams.delete(e)};if(typeof window<"u"){const o=new URLSearchParams(window.location.search),l=r[n](o);if(l!==null)t.set(l);else if(i!==null){const a=typeof i=="function"?i():i;t.set(a)}return a=>{const c=new URL(window.location);s[n](c,a),window.history.pushState({},"",c)}}return()=>{}}function Tu(t){const e=t-1;return e*e*e+1}function Un(t,{delay:e=0,duration:n=400,easing:i=Ms}={}){const r=+getComputedStyle(t).opacity;return{delay:e,duration:n,easing:i,css:s=>`opacity: ${s*r}`}}function qs(t,{delay:e=0,duration:n=400,easing:i=Tu,axis:r="y"}={}){const s=getComputedStyle(t),o=+s.opacity,l=r==="y"?"height":"width",a=parseFloat(s[l]),c=r==="y"?["top","bottom"]:["left","right"],u=c.map(_=>`${_[0].toUpperCase()}${_.slice(1)}`),h=parseFloat(s[`padding${u[0]}`]),f=parseFloat(s[`padding${u[1]}`]),d=parseFloat(s[`margin${u[0]}`]),m=parseFloat(s[`margin${u[1]}`]),p=parseFloat(s[`border${u[0]}Width`]),g=parseFloat(s[`border${u[1]}Width`]);return{delay:e,duration:n,easing:i,css:_=>`overflow: hidden;opacity: ${Math.min(_*20,1)*o};${l}: ${_*a}px;padding-${c[0]}: ${_*h}px;padding-${c[1]}: ${_*f}px;margin-${c[0]}: ${_*d}px;margin-${c[1]}: ${_*m}px;border-${c[0]}-width: ${_*p}px;border-${c[1]}-width: ${_*g}px;`}}const Fy="";function Ks(t){let e,n,i;return{c(){e=b("div"),e.innerHTML='<div class="loader svelte-vizlcg"></div>',v(e,"class","bkg-shade svelte-vizlcg")},m(r,s){$(r,e,s),i=!0},i(r){i||(Kt(()=>{i&&(n||(n=gn(e,Un,{duration:150},!0)),n.run(1))}),i=!0)},o(r){n||(n=gn(e,Un,{duration:150},!1)),n.run(0),i=!1},d(r){r&&D(e),r&&n&&n.end()}}}function Nu(t){let e,n,i=t[0]&&Ks();return{c(){i&&i.c(),e=kt()},m(r,s){i&&i.m(r,s),$(r,e,s),n=!0},p(r,[s]){r[0]?i?s&1&&H(i,1):(i=Ks(),i.c(),H(i,1),i.m(e.parentNode,e)):i&&(et(),B(i,1,1,()=>{i=null}),tt())},i(r){n||(H(i),n=!0)},o(r){B(i),n=!1},d(r){i&&i.d(r),r&&D(e)}}}function Pu(t,e,n){let i;return Me(t,ri,r=>n(0,i=r)),[i]}class Ou extends qe{constructor(e){super(),Be(this,e,Pu,Nu,je,{})}}const Lu=t=>({}),Ws=t=>({});function Du(t){let e,n,i,r,s,o,l,a,c,u,h,f,d,m,p,g,_,k,C,w,S;const N=t[1].content,M=Vt(N,t,t[0],Ws);return{c(){e=b("button"),n=j(),i=b("div"),r=b("div"),s=j(),o=b("div"),l=b("div"),l.innerHTML=`<div class="title is-4 mb-0 media-content"><span id="modal-title" class="mb-0"></span></div>
            <button class="delete media-left" aria-label="close"></button>`,a=j(),c=b("section"),u=b("div"),h=j(),f=b("div"),M&&M.c(),d=j(),m=b("footer"),p=b("div"),g=b("button"),g.textContent=`${U==="en"?"Abort":"Retour"}`,_=j(),k=b("button"),k.textContent="OK",v(e,"id","hidden-msg-btn"),v(e,"data-target","msg-modal"),e.hidden=!0,v(r,"id","modal-bkg"),v(r,"class","modal-background"),v(l,"class","modal-card-head media mb-0"),v(u,"id","modal-msg"),v(f,"class","py-3"),v(c,"id","modal-body"),v(c,"class","modal-card-body"),v(g,"id","cancel-btn"),v(g,"class","button is-link is-light button-close"),v(k,"id","ok-btn"),v(k,"class","button is-link button-close"),v(p,"class","buttons"),v(m,"id","modal-footer"),v(m,"class","modal-card-foot is-center pt-3"),m.hidden=!0,v(o,"class","modal-content"),v(i,"id","msg-modal"),v(i,"class","modal fade"),v(i,"tabindex","-1"),v(i,"aria-labelledby","selection-modal-label"),v(i,"aria-hidden","true")},m(E,I){$(E,e,I),$(E,n,I),$(E,i,I),y(i,r),y(i,s),y(i,o),y(o,l),y(o,a),y(o,c),y(c,u),y(c,h),y(c,f),M&&M.m(f,null),y(o,d),y(o,m),y(m,p),y(p,g),y(p,_),y(p,k),C=!0,w||(S=[ei(Bs.call(null,e)),ei(Pr.call(null,i))],w=!0)},p(E,[I]){M&&M.p&&(!C||I&1)&&Bt(M,N,E,E[0],C?Ut(N,E[0],I,Lu):qt(E[0]),Ws)},i(E){C||(H(M,E),C=!0)},o(E){B(M,E),C=!1},d(E){E&&D(e),E&&D(n),E&&D(i),M&&M.d(E),w=!1,vt(S)}}}function Ru(t,e,n){let{$$slots:i={},$$scope:r}=e;return t.$$set=s=>{"$$scope"in s&&n(0,r=s.$$scope)},[r,i]}class $u extends qe{constructor(e){super(),Be(this,e,Ru,Du,je,{})}}const Hy="",zu=t=>({activeTab:t&8}),Ys=t=>({activeTab:t[3]});function Xs(t,e,n){const i=t.slice();return i[11]=e[n][0],i[12]=e[n][1],i}const ju=t=>({activeTab:t&8}),Gs=t=>({activeTab:t[3]}),Fu=t=>({}),Js=t=>({});function Hu(t){let e,n,i=Object.entries(t[2]),r=[];for(let s=0;s<i.length;s+=1)r[s]=Qs(Xs(t,i,s));return{c(){e=b("div"),n=b("ul");for(let s=0;s<r.length;s+=1)r[s].c();v(e,"class","tabs")},m(s,o){$(s,e,o),y(e,n);for(let l=0;l<r.length;l+=1)r[l]&&r[l].m(n,null)},p(s,o){if(o&28){i=Object.entries(s[2]);let l;for(l=0;l<i.length;l+=1){const a=Xs(s,i,l);r[l]?r[l].p(a,o):(r[l]=Qs(a),r[l].c(),r[l].m(n,null))}for(;l<r.length;l+=1)r[l].d(1);r.length=i.length}},i:ie,o:ie,d(s){s&&D(e),bt(r,s)}}}function Vu(t){let e;const n=t[8].tabs,i=Vt(n,t,t[7],Gs);return{c(){i&&i.c()},m(r,s){i&&i.m(r,s),e=!0},p(r,s){i&&i.p&&(!e||s&136)&&Bt(i,n,r,r[7],e?Ut(n,r[7],s,ju):qt(r[7]),Gs)},i(r){e||(H(i,r),e=!0)},o(r){B(i,r),e=!1},d(r){i&&i.d(r)}}}function Qs(t){let e,n,i=t[12]+"",r,s,o,l;function a(){return t[9](t[11])}return{c(){e=b("li"),n=b("a"),r=re(i),s=j(),v(n,"href",null),Ge(e,"is-active",t[3]===t[11])},m(c,u){$(c,e,u),y(e,n),y(n,r),y(e,s),o||(l=Ae(n,"click",a),o=!0)},p(c,u){t=c,u&4&&i!==(i=t[12]+"")&&Le(r,i),u&12&&Ge(e,"is-active",t[3]===t[11])},d(c){c&&D(e),o=!1,l()}}}function Uu(t){let e,n,i,r,s,o,l,a,c,u,h,f,d;e=new Ou({});const m=t[8].sidebar,p=Vt(m,t,t[7],Js),g=[Vu,Hu],_=[];function k(S,N){return N&4&&(a=null),S[5].tabs?0:(a==null&&(a=!!Object.keys(S[2]).length),a?1:-1)}~(c=k(t,-1))&&(u=_[c]=g[c](t));const C=t[8].content,w=Vt(C,t,t[7],Ys);return{c(){ve(e.$$.fragment),n=j(),i=b("div"),r=b("aside"),p&&p.c(),s=j(),o=b("main"),l=b("nav"),u&&u.c(),h=j(),f=b("div"),w&&w.c(),v(r,"class","sidebar svelte-jexg"),Ue(r,"width",t[0]+"%"),Ue(r,"min-height",t[1]),v(l,"id","tabs"),v(l,"class","tabs-bar svelte-jexg"),v(f,"class","content-area pl-5 svelte-jexg"),v(o,"class","main-content svelte-jexg"),Ue(o,"width",100-t[0]+"%"),Ue(o,"min-height",t[1]),v(i,"class","layout svelte-jexg"),Ue(i,"min-height",t[1])},m(S,N){pe(e,S,N),$(S,n,N),$(S,i,N),y(i,r),p&&p.m(r,null),y(i,s),y(i,o),y(o,l),~c&&_[c].m(l,null),y(o,h),y(o,f),w&&w.m(f,null),d=!0},p(S,[N]){p&&p.p&&(!d||N&128)&&Bt(p,m,S,S[7],d?Ut(m,S[7],N,Fu):qt(S[7]),Js),(!d||N&1)&&Ue(r,"width",S[0]+"%");let M=c;c=k(S,N),c===M?~c&&_[c].p(S,N):(u&&(et(),B(_[M],1,1,()=>{_[M]=null}),tt()),~c?(u=_[c],u?u.p(S,N):(u=_[c]=g[c](S),u.c()),H(u,1),u.m(l,null)):u=null),w&&w.p&&(!d||N&136)&&Bt(w,C,S,S[7],d?Ut(C,S[7],N,zu):qt(S[7]),Ys),(!d||N&1)&&Ue(o,"width",100-S[0]+"%")},i(S){d||(H(e.$$.fragment,S),H(p,S),H(u),H(w,S),d=!0)},o(S){B(e.$$.fragment,S),B(p,S),B(u),B(w,S),d=!1},d(S){ge(e,S),S&&D(n),S&&D(i),p&&p.d(S),~c&&_[c].d(),w&&w.d(S)}}}function Bu(t=null){t||(t=document.getElementById("navbar")),document.documentElement.style.setProperty("--top-offset",`${t.offsetHeight}px`)}function qu(t,e,n){let i,{$$slots:r={},$$scope:s}=e;const o=Yc(r);let{sidebarWidth:l="25"}=e;const a="90vh";let{tabList:c={}}=e,u=Object.keys(c),{topOffsetElement:h=null}=e;Bu(h);function f(m){if(!u.includes(m)){console.warn(`Tab "${m}" is not available.`);return}n(3,i=m);const p=new URL(window.location);p.searchParams.set("tab",m),window.history.pushState({},"",p)}const d=m=>f(m);return t.$$set=m=>{"sidebarWidth"in m&&n(0,l=m.sidebarWidth),"tabList"in m&&n(2,c=m.tabList),"topOffsetElement"in m&&n(6,h=m.topOffsetElement),"$$scope"in m&&n(7,s=m.$$scope)},n(3,i=new URLSearchParams(window.location.search).get("tab")??u[0]??null),[l,a,c,i,f,o,h,s,r,d]}class Ku extends qe{constructor(e){super(),Be(this,e,qu,Uu,je,{sidebarWidth:0,layoutHeight:1,tabList:2,topOffsetElement:6})}get layoutHeight(){return this.$$.ctx[1]}}const Li={0:{title:U==="en"?"no categorization":"aucune catégorisation",svg:`<svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 59 59">
        <rect x="1" y="0.62" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>
    </svg>`},1:{title:U==="en"?"overall visual matches":"correspondances visuelles globales",svg:`<svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 68 69">
        <rect x="10" y="10.62" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>
        <rect x="1" y="1" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>
        <rect x="10" y="10.62" width="46" height="45.71" rx="4.11" ry="4.11" fill="currentColor" stroke="none"/>
    </svg>`},2:{title:U==="en"?"visual matches on part of the image":"correspondances visuelles sur une partie de l'image",svg:`<svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 70 71">
        <rect x="12" y="12.43" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>
        <rect x="1" y="0.81" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>
        <path d="M 12 21.43 L 21 12.43" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
        <path d="M 12 30 L 30 12.43" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
        <path d="M 40 56 L 57 38" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
        <path d="M 48.3 56.29 L 57 47" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
        <path d="M 12 39 L 39 12" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
        <path d="M 12 48 L 48 12" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
        <path d="M 13 56 L 57 12" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
        <path d="M 31 56 L 57 29" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
        <path d="M 21 57 L 57 21" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
    </svg>`},3:{title:U==="en"?"semantic and non-visual matches":"correspondances sémantiques et non-visuelle",svg:`<svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 72 73">
        <rect x="14" y="14.43" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3" stroke-dasharray="9 9"/>
        <rect x="1" y="0.81" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>
    </svg>`},4:{title:U==="en"?"regions without match":"régions sans correspondance",svg:`<svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 59 59">
        <rect x="1" y="0.62" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>
        <path d="M 2.67 54.55 L 55 2" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
        <path d="M 54.37 54.05 L 2.72 2.24" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
    </svg>`},5:{title:U==="en"?"user specific category":"correspondances spécifiques à l'utilisateur",svg:`<svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 59 59">
        <rect x="1" y="0.81" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>
        <path d="M 8.69 55.28 C 9.25 44.15 18.08 35.28 28.86 35.28 C 32.5 35.28 36.07 36.3 39.18 38.25 C 44.96 41.85 48.66 48.3 49.02 55.28 Z M 17.85 21.48 C 17.85 15.37 22.79 10.39 28.86 10.39 C 34.92 10.39 39.86 15.37 39.86 21.48 C 39.86 27.59 34.92 32.56 28.86 32.56 C 22.79 32.56 17.85 27.59 17.85 21.48 Z M 40.37 36.34 C 38.43 35.13 36.32 34.25 34.13 33.7 C 38.82 31.64 42.1 26.94 42.1 21.48 C 42.1 14.13 36.16 8.15 28.86 8.15 C 21.55 8.15 15.61 14.13 15.61 21.48 C 15.61 26.95 18.9 31.66 23.6 33.71 C 13.76 36.18 6.41 45.4 6.41 56.4 C 6.41 57.02 6.92 57.52 7.54 57.52 L 50.17 57.52 C 50.79 57.52 51.3 57.02 51.3 56.4 C 51.3 48.23 47.11 40.54 40.37 36.34 Z" fill="currentColor" stroke="none"/>
    </svg>`}};function Wu(t){let e,n=Li[t[2]].svg+"",i,r,s,o;return{c(){e=b("span"),v(e,"class",i="tag py-4 "+t[4]+" "+(t[0]?"is-hoverable":"")),v(e,"title",r=Li[t[2]].title),Ge(e,"is-selected",t[1])},m(l,a){$(l,e,a),e.innerHTML=n,s||(o=[Ae(e,"click",t[5]),Ae(e,"keyup",null)],s=!0)},p(l,[a]){a&4&&n!==(n=Li[l[2]].svg+"")&&(e.innerHTML=n),a&17&&i!==(i="tag py-4 "+l[4]+" "+(l[0]?"is-hoverable":""))&&v(e,"class",i),a&4&&r!==(r=Li[l[2]].title)&&v(e,"title",r),a&19&&Ge(e,"is-selected",l[1])},i:ie,o:ie,d(l){l&&D(e),s=!1,vt(o)}}}function Yu(t,e,n){let{selectable:i=!0}=e,{isSelected:r=!1}=e,{category:s}=e,{toggle:o=()=>{}}=e,{padding:l="px-2"}=e;const a=()=>o(s);return t.$$set=c=>{"selectable"in c&&n(0,i=c.selectable),"isSelected"in c&&n(1,r=c.isSelected),"category"in c&&n(2,s=c.category),"toggle"in c&&n(3,o=c.toggle),"padding"in c&&n(4,l=c.padding)},[i,r,s,o,l,a]}class Bn extends qe{constructor(e){super(),Be(this,e,Yu,Wu,je,{selectable:0,isSelected:1,category:2,toggle:3,padding:4})}}const eb="";function Zs(t){let e,n,i=t[3].title+"",r,s;return{c(){e=b("span"),n=b("a"),r=re(i),v(n,"href",s=`${Pi}/${Yt}/witness/${t[3].witnessId}/regions/${t[1]}`),v(n,"target","_blank"),v(e,"class","legend-label svelte-w1sf17")},m(o,l){$(o,e,l),y(e,n),y(n,r)},p(o,l){l&8&&i!==(i=o[3].title+"")&&Le(r,i),l&10&&s!==(s=`${Pi}/${Yt}/witness/${o[3].witnessId}/regions/${o[1]}`)&&v(n,"href",s)},d(o){o&&D(e)}}}function Xu(t){let e,n,i,r,s,o,l,a,c,u=!t[5]&&Zs(t);return{c(){e=b("div"),n=b("span"),i=j(),r=b("span"),l=j(),u&&u.c(),v(n,"class","legend-nb svelte-w1sf17"),v(r,"class","legend-color svelte-w1sf17"),v(r,"aria-label",s=t[3].title),v(r,"title",o=t[3].title),Ue(r,"background-color",t[0]?t[3].color:"#999"),v(r,"role","button"),v(r,"tabindex","0"),Ge(r,"inactive",!t[0]),Ge(r,"clickable",t[4]),v(e,"class","legend-item svelte-w1sf17"),Ge(e,"inactive",!t[0])},m(h,f){$(h,e,f),y(e,n),y(e,i),y(e,r),y(e,l),u&&u.m(e,null),a||(c=[Ae(r,"click",function(){Nn(t[2])&&t[2].apply(this,arguments)}),Ae(r,"keydown",null)],a=!0)},p(h,[f]){t=h,f&8&&s!==(s=t[3].title)&&v(r,"aria-label",s),f&8&&o!==(o=t[3].title)&&v(r,"title",o),f&9&&Ue(r,"background-color",t[0]?t[3].color:"#999"),f&1&&Ge(r,"inactive",!t[0]),f&16&&Ge(r,"clickable",t[4]),t[5]?u&&(u.d(1),u=null):u?u.p(t,f):(u=Zs(t),u.c(),u.m(e,null)),f&1&&Ge(e,"inactive",!t[0])},i:ie,o:ie,d(h){h&&D(e),u&&u.d(),a=!1,vt(c)}}}function Gu(t,e,n){let{isActive:i=!0}=e,{id:r}=e,{toggle:s=()=>{}}=e,{meta:o={title:"Region",color:"#999",witnessId:1}}=e,{clickable:l=!0}=e,{onlyColor:a=!1}=e;return t.$$set=c=>{"isActive"in c&&n(0,i=c.isActive),"id"in c&&n(1,r=c.id),"toggle"in c&&n(2,s=c.toggle),"meta"in c&&n(3,o=c.meta),"clickable"in c&&n(4,l=c.clickable),"onlyColor"in c&&n(5,a=c.onlyColor)},[i,r,s,o,l,a]}class eo extends qe{constructor(e){super(),Be(this,e,Gu,Xu,je,{isActive:0,id:1,toggle:2,meta:3,clickable:4,onlyColor:5})}}const tb="";function to(t,e,n){const i=t.slice();return i[6]=e[n][0],i[7]=e[n][1],i}function Ju(t){let e;return{c(){e=b("span"),e.innerHTML='<i class="fas fa-chevron-down"></i>',v(e,"class","icon is-small")},m(n,i){$(n,e,i)},d(n){n&&D(e)}}}function Qu(t){let e;return{c(){e=b("span"),e.innerHTML='<i class="fas fa-chevron-up"></i>',v(e,"class","icon is-small")},m(n,i){$(n,e,i)},d(n){n&&D(e)}}}function no(t){let e,n;function i(){return t[5](t[6])}return e=new eo({props:{id:t[6],meta:t[7],isActive:t[1].has(parseInt(t[6])),toggle:i,onlyColor:!t[3]}}),{c(){ve(e.$$.fragment)},m(r,s){pe(e,r,s),n=!0},p(r,s){t=r;const o={};s&1&&(o.id=t[6]),s&1&&(o.meta=t[7]),s&3&&(o.isActive=t[1].has(parseInt(t[6]))),s&5&&(o.toggle=i),s&8&&(o.onlyColor=!t[3]),e.$set(o)},i(r){n||(H(e.$$.fragment,r),n=!0)},o(r){B(e.$$.fragment,r),n=!1},d(r){ge(e,r)}}}function Zu(t){let e,n,i,r,s,o,l,a,c,u,h,f,d,m,p,g;function _(M,E){return M[3]?Qu:Ju}let k=_(t),C=k(t),w=Array.from(t[0]||new Map),S=[];for(let M=0;M<w.length;M+=1)S[M]=no(to(t,w,M));const N=M=>B(S[M],1,1,()=>{S[M]=null});return{c(){e=b("div"),n=b("div"),i=b("div"),r=b("div"),s=b("h3"),s.textContent=`${U==="en"?"Visible documents":"Documents visibles"}`,o=j(),l=b("div"),a=b("div"),c=b("button"),C.c(),f=j(),d=b("div");for(let M=0;M<S.length;M+=1)S[M].c();v(s,"class","title mb-0"),v(r,"class","level-item"),v(i,"class","level-left"),v(c,"class","button is-small is-ghost"),v(c,"aria-label",u=t[3]?"Minify legend":"Expand legend"),v(a,"class","level-item"),v(a,"title",h=t[3]?"Minify legend":"Expand legend"),v(l,"class","level-right"),v(n,"class","level is-mobile mb-3"),v(d,"class","svelte-13ym7ov"),Ge(d,"is-condensed",!t[3]),Ge(d,"is-expanded",t[3])},m(M,E){$(M,e,E),y(e,n),y(n,i),y(i,r),y(r,s),y(n,o),y(n,l),y(l,a),y(a,c),C.m(c,null),y(e,f),y(e,d);for(let I=0;I<S.length;I+=1)S[I]&&S[I].m(d,null);m=!0,p||(g=Ae(c,"click",t[4]),p=!0)},p(M,[E]){if(k!==(k=_(M))&&(C.d(1),C=k(M),C&&(C.c(),C.m(c,null))),(!m||E&8&&u!==(u=M[3]?"Minify legend":"Expand legend"))&&v(c,"aria-label",u),(!m||E&8&&h!==(h=M[3]?"Minify legend":"Expand legend"))&&v(a,"title",h),E&15){w=Array.from(M[0]||new Map);let I;for(I=0;I<w.length;I+=1){const O=to(M,w,I);S[I]?(S[I].p(O,E),H(S[I],1)):(S[I]=no(O),S[I].c(),H(S[I],1),S[I].m(d,null))}for(et(),I=w.length;I<S.length;I+=1)N(I);tt()}(!m||E&8)&&Ge(d,"is-condensed",!M[3]),(!m||E&8)&&Ge(d,"is-expanded",M[3])},i(M){if(!m){for(let E=0;E<w.length;E+=1)H(S[E]);m=!0}},o(M){S=S.filter(Boolean);for(let E=0;E<S.length;E+=1)B(S[E]);m=!1},d(M){M&&D(e),C.d(),bt(S,M),p=!1,g()}}}function ef(t,e,n){let{documentNodes:i}=e,{selectedRegions:r}=e,{toggleRegion:s}=e,o=!0;const l=()=>n(3,o=!o),a=c=>s(parseInt(c));return t.$$set=c=>{"documentNodes"in c&&n(0,i=c.documentNodes),"selectedRegions"in c&&n(1,r=c.selectedRegions),"toggleRegion"in c&&n(2,s=c.toggleRegion)},[i,r,s,o,l,a]}class tf extends qe{constructor(e){super(),Be(this,e,ef,Zu,je,{documentNodes:0,selectedRegions:1,toggleRegion:2})}}var vn;(function(t){t.Range="range",t.Steps="steps",t.Positions="positions",t.Count="count",t.Values="values"})(vn||(vn={}));var At;(function(t){t[t.None=-1]="None",t[t.NoValue=0]="NoValue",t[t.LargeValue=1]="LargeValue",t[t.SmallValue=2]="SmallValue"})(At||(At={}));function nf(t){return Di(t)&&typeof t.from=="function"}function Di(t){return typeof t=="object"&&typeof t.to=="function"}function io(t){t.parentElement.removeChild(t)}function Or(t){return t!=null}function ro(t){t.preventDefault()}function rf(t){return t.filter(function(e){return this[e]?!1:this[e]=!0},{})}function sf(t,e){return Math.round(t/e)*e}function of(t,e){var n=t.getBoundingClientRect(),i=t.ownerDocument,r=i.documentElement,s=lo(i);return/webkit.*Chrome.*Mobile/i.test(navigator.userAgent)&&(s.x=0),e?n.top+s.y-r.clientTop:n.left+s.x-r.clientLeft}function Xt(t){return typeof t=="number"&&!isNaN(t)&&isFinite(t)}function so(t,e,n){n>0&&(Et(t,e),setTimeout(function(){$i(t,e)},n))}function oo(t){return Math.max(Math.min(t,100),0)}function Ri(t){return Array.isArray(t)?t:[t]}function lf(t){t=String(t);var e=t.split(".");return e.length>1?e[1].length:0}function Et(t,e){t.classList&&!/\s/.test(e)?t.classList.add(e):t.className+=" "+e}function $i(t,e){t.classList&&!/\s/.test(e)?t.classList.remove(e):t.className=t.className.replace(new RegExp("(^|\\b)"+e.split(" ").join("|")+"(\\b|$)","gi")," ")}function af(t,e){return t.classList?t.classList.contains(e):new RegExp("\\b"+e+"\\b").test(t.className)}function lo(t){var e=window.pageXOffset!==void 0,n=(t.compatMode||"")==="CSS1Compat",i=e?window.pageXOffset:n?t.documentElement.scrollLeft:t.body.scrollLeft,r=e?window.pageYOffset:n?t.documentElement.scrollTop:t.body.scrollTop;return{x:i,y:r}}function cf(){return window.navigator.pointerEnabled?{start:"pointerdown",move:"pointermove",end:"pointerup"}:window.navigator.msPointerEnabled?{start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:{start:"mousedown touchstart",move:"mousemove touchmove",end:"mouseup touchend"}}function uf(){var t=!1;try{var e=Object.defineProperty({},"passive",{get:function(){t=!0}});window.addEventListener("test",null,e)}catch{}return t}function ff(){return window.CSS&&CSS.supports&&CSS.supports("touch-action","none")}function Lr(t,e){return 100/(e-t)}function Dr(t,e,n){return e*100/(t[n+1]-t[n])}function df(t,e){return Dr(t,t[0]<0?e+Math.abs(t[0]):e-t[0],0)}function hf(t,e){return e*(t[1]-t[0])/100+t[0]}function si(t,e){for(var n=1;t>=e[n];)n+=1;return n}function mf(t,e,n){if(n>=t.slice(-1)[0])return 100;var i=si(n,t),r=t[i-1],s=t[i],o=e[i-1],l=e[i];return o+df([r,s],n)/Lr(o,l)}function pf(t,e,n){if(n>=100)return t.slice(-1)[0];var i=si(n,e),r=t[i-1],s=t[i],o=e[i-1],l=e[i];return hf([r,s],(n-o)*Lr(o,l))}function gf(t,e,n,i){if(i===100)return i;var r=si(i,t),s=t[r-1],o=t[r];return n?i-s>(o-s)/2?o:s:e[r-1]?t[r-1]+sf(i-t[r-1],e[r-1]):i}var ao=function(){function t(e,n,i){this.xPct=[],this.xVal=[],this.xSteps=[],this.xNumSteps=[],this.xHighestCompleteStep=[],this.xSteps=[i||!1],this.xNumSteps=[!1],this.snap=n;var r,s=[];for(Object.keys(e).forEach(function(o){s.push([Ri(e[o]),o])}),s.sort(function(o,l){return o[0][0]-l[0][0]}),r=0;r<s.length;r++)this.handleEntryPoint(s[r][1],s[r][0]);for(this.xNumSteps=this.xSteps.slice(0),r=0;r<this.xNumSteps.length;r++)this.handleStepPoint(r,this.xNumSteps[r])}return t.prototype.getDistance=function(e){for(var n=[],i=0;i<this.xNumSteps.length-1;i++)n[i]=Dr(this.xVal,e,i);return n},t.prototype.getAbsoluteDistance=function(e,n,i){var r=0;if(e<this.xPct[this.xPct.length-1])for(;e>this.xPct[r+1];)r++;else e===this.xPct[this.xPct.length-1]&&(r=this.xPct.length-2);!i&&e===this.xPct[r+1]&&r++,n===null&&(n=[]);var s,o=1,l=n[r],a=0,c=0,u=0,h=0;for(i?s=(e-this.xPct[r])/(this.xPct[r+1]-this.xPct[r]):s=(this.xPct[r+1]-e)/(this.xPct[r+1]-this.xPct[r]);l>0;)a=this.xPct[r+1+h]-this.xPct[r+h],n[r+h]*o+100-s*100>100?(c=a*s,o=(l-100*s)/n[r+h],s=1):(c=n[r+h]*a/100*o,o=0),i?(u=u-c,this.xPct.length+h>=1&&h--):(u=u+c,this.xPct.length-h>=1&&h++),l=n[r+h]*o;return e+u},t.prototype.toStepping=function(e){return e=mf(this.xVal,this.xPct,e),e},t.prototype.fromStepping=function(e){return pf(this.xVal,this.xPct,e)},t.prototype.getStep=function(e){return e=gf(this.xPct,this.xSteps,this.snap,e),e},t.prototype.getDefaultStep=function(e,n,i){var r=si(e,this.xPct);return(e===100||n&&e===this.xPct[r-1])&&(r=Math.max(r-1,1)),(this.xVal[r]-this.xVal[r-1])/i},t.prototype.getNearbySteps=function(e){var n=si(e,this.xPct);return{stepBefore:{startValue:this.xVal[n-2],step:this.xNumSteps[n-2],highestStep:this.xHighestCompleteStep[n-2]},thisStep:{startValue:this.xVal[n-1],step:this.xNumSteps[n-1],highestStep:this.xHighestCompleteStep[n-1]},stepAfter:{startValue:this.xVal[n],step:this.xNumSteps[n],highestStep:this.xHighestCompleteStep[n]}}},t.prototype.countStepDecimals=function(){var e=this.xNumSteps.map(lf);return Math.max.apply(null,e)},t.prototype.hasNoSize=function(){return this.xVal[0]===this.xVal[this.xVal.length-1]},t.prototype.convert=function(e){return this.getStep(this.toStepping(e))},t.prototype.handleEntryPoint=function(e,n){var i;if(e==="min"?i=0:e==="max"?i=100:i=parseFloat(e),!Xt(i)||!Xt(n[0]))throw new Error("noUiSlider: 'range' value isn't numeric.");this.xPct.push(i),this.xVal.push(n[0]);var r=Number(n[1]);i?this.xSteps.push(isNaN(r)?!1:r):isNaN(r)||(this.xSteps[0]=r),this.xHighestCompleteStep.push(0)},t.prototype.handleStepPoint=function(e,n){if(n){if(this.xVal[e]===this.xVal[e+1]){this.xSteps[e]=this.xHighestCompleteStep[e]=this.xVal[e];return}this.xSteps[e]=Dr([this.xVal[e],this.xVal[e+1]],n,0)/Lr(this.xPct[e],this.xPct[e+1]);var i=(this.xVal[e+1]-this.xVal[e])/this.xNumSteps[e],r=Math.ceil(Number(i.toFixed(3))-1),s=this.xVal[e]+this.xNumSteps[e]*r;this.xHighestCompleteStep[e]=s}},t}(),co={to:function(t){return t===void 0?"":t.toFixed(2)},from:Number},uo={target:"target",base:"base",origin:"origin",handle:"handle",handleLower:"handle-lower",handleUpper:"handle-upper",touchArea:"touch-area",horizontal:"horizontal",vertical:"vertical",background:"background",connect:"connect",connects:"connects",ltr:"ltr",rtl:"rtl",textDirectionLtr:"txt-dir-ltr",textDirectionRtl:"txt-dir-rtl",draggable:"draggable",drag:"state-drag",tap:"state-tap",active:"active",tooltip:"tooltip",pips:"pips",pipsHorizontal:"pips-horizontal",pipsVertical:"pips-vertical",marker:"marker",markerHorizontal:"marker-horizontal",markerVertical:"marker-vertical",markerNormal:"marker-normal",markerLarge:"marker-large",markerSub:"marker-sub",value:"value",valueHorizontal:"value-horizontal",valueVertical:"value-vertical",valueNormal:"value-normal",valueLarge:"value-large",valueSub:"value-sub"},yn={tooltips:".__tooltips",aria:".__aria"};function _f(t,e){if(!Xt(e))throw new Error("noUiSlider: 'step' is not numeric.");t.singleStep=e}function vf(t,e){if(!Xt(e))throw new Error("noUiSlider: 'keyboardPageMultiplier' is not numeric.");t.keyboardPageMultiplier=e}function yf(t,e){if(!Xt(e))throw new Error("noUiSlider: 'keyboardMultiplier' is not numeric.");t.keyboardMultiplier=e}function bf(t,e){if(!Xt(e))throw new Error("noUiSlider: 'keyboardDefaultStep' is not numeric.");t.keyboardDefaultStep=e}function wf(t,e){if(typeof e!="object"||Array.isArray(e))throw new Error("noUiSlider: 'range' is not an object.");if(e.min===void 0||e.max===void 0)throw new Error("noUiSlider: Missing 'min' or 'max' in 'range'.");t.spectrum=new ao(e,t.snap||!1,t.singleStep)}function Sf(t,e){if(e=Ri(e),!Array.isArray(e)||!e.length)throw new Error("noUiSlider: 'start' option is incorrect.");t.handles=e.length,t.start=e}function kf(t,e){if(typeof e!="boolean")throw new Error("noUiSlider: 'snap' option must be a boolean.");t.snap=e}function Ef(t,e){if(typeof e!="boolean")throw new Error("noUiSlider: 'animate' option must be a boolean.");t.animate=e}function Cf(t,e){if(typeof e!="number")throw new Error("noUiSlider: 'animationDuration' option must be a number.");t.animationDuration=e}function fo(t,e){var n=[!1],i;if(e==="lower"?e=[!0,!1]:e==="upper"&&(e=[!1,!0]),e===!0||e===!1){for(i=1;i<t.handles;i++)n.push(e);n.push(!1)}else{if(!Array.isArray(e)||!e.length||e.length!==t.handles+1)throw new Error("noUiSlider: 'connect' option doesn't match handle count.");n=e}t.connect=n}function If(t,e){switch(e){case"horizontal":t.ort=0;break;case"vertical":t.ort=1;break;default:throw new Error("noUiSlider: 'orientation' option is invalid.")}}function ho(t,e){if(!Xt(e))throw new Error("noUiSlider: 'margin' option must be numeric.");e!==0&&(t.margin=t.spectrum.getDistance(e))}function xf(t,e){if(!Xt(e))throw new Error("noUiSlider: 'limit' option must be numeric.");if(t.limit=t.spectrum.getDistance(e),!t.limit||t.handles<2)throw new Error("noUiSlider: 'limit' option is only supported on linear sliders with 2 or more handles.")}function Mf(t,e){var n;if(!Xt(e)&&!Array.isArray(e))throw new Error("noUiSlider: 'padding' option must be numeric or array of exactly 2 numbers.");if(Array.isArray(e)&&!(e.length===2||Xt(e[0])||Xt(e[1])))throw new Error("noUiSlider: 'padding' option must be numeric or array of exactly 2 numbers.");if(e!==0){for(Array.isArray(e)||(e=[e,e]),t.padding=[t.spectrum.getDistance(e[0]),t.spectrum.getDistance(e[1])],n=0;n<t.spectrum.xNumSteps.length-1;n++)if(t.padding[0][n]<0||t.padding[1][n]<0)throw new Error("noUiSlider: 'padding' option must be a positive number(s).");var i=e[0]+e[1],r=t.spectrum.xVal[0],s=t.spectrum.xVal[t.spectrum.xVal.length-1];if(i/(s-r)>1)throw new Error("noUiSlider: 'padding' option must not exceed 100% of the range.")}}function Af(t,e){switch(e){case"ltr":t.dir=0;break;case"rtl":t.dir=1;break;default:throw new Error("noUiSlider: 'direction' option was not recognized.")}}function Tf(t,e){if(typeof e!="string")throw new Error("noUiSlider: 'behaviour' must be a string containing options.");var n=e.indexOf("tap")>=0,i=e.indexOf("drag")>=0,r=e.indexOf("fixed")>=0,s=e.indexOf("snap")>=0,o=e.indexOf("hover")>=0,l=e.indexOf("unconstrained")>=0,a=e.indexOf("invert-connects")>=0,c=e.indexOf("drag-all")>=0,u=e.indexOf("smooth-steps")>=0;if(r){if(t.handles!==2)throw new Error("noUiSlider: 'fixed' behaviour must be used with 2 handles");ho(t,t.start[1]-t.start[0])}if(a&&t.handles!==2)throw new Error("noUiSlider: 'invert-connects' behaviour must be used with 2 handles");if(l&&(t.margin||t.limit))throw new Error("noUiSlider: 'unconstrained' behaviour cannot be used with margin or limit");t.events={tap:n||s,drag:i,dragAll:c,smoothSteps:u,fixed:r,snap:s,hover:o,unconstrained:l,invertConnects:a}}function Nf(t,e){if(e!==!1)if(e===!0||Di(e)){t.tooltips=[];for(var n=0;n<t.handles;n++)t.tooltips.push(e)}else{if(e=Ri(e),e.length!==t.handles)throw new Error("noUiSlider: must pass a formatter for all handles.");e.forEach(function(i){if(typeof i!="boolean"&&!Di(i))throw new Error("noUiSlider: 'tooltips' must be passed a formatter or 'false'.")}),t.tooltips=e}}function Pf(t,e){if(e.length!==t.handles)throw new Error("noUiSlider: must pass a attributes for all handles.");t.handleAttributes=e}function Of(t,e){if(!Di(e))throw new Error("noUiSlider: 'ariaFormat' requires 'to' method.");t.ariaFormat=e}function Lf(t,e){if(!nf(e))throw new Error("noUiSlider: 'format' requires 'to' and 'from' methods.");t.format=e}function Df(t,e){if(typeof e!="boolean")throw new Error("noUiSlider: 'keyboardSupport' option must be a boolean.");t.keyboardSupport=e}function Rf(t,e){t.documentElement=e}function $f(t,e){if(typeof e!="string"&&e!==!1)throw new Error("noUiSlider: 'cssPrefix' must be a string or `false`.");t.cssPrefix=e}function zf(t,e){if(typeof e!="object")throw new Error("noUiSlider: 'cssClasses' must be an object.");typeof t.cssPrefix=="string"?(t.cssClasses={},Object.keys(e).forEach(function(n){t.cssClasses[n]=t.cssPrefix+e[n]})):t.cssClasses=e}function mo(t){var e={margin:null,limit:null,padding:null,animate:!0,animationDuration:300,ariaFormat:co,format:co},n={step:{r:!1,t:_f},keyboardPageMultiplier:{r:!1,t:vf},keyboardMultiplier:{r:!1,t:yf},keyboardDefaultStep:{r:!1,t:bf},start:{r:!0,t:Sf},connect:{r:!0,t:fo},direction:{r:!0,t:Af},snap:{r:!1,t:kf},animate:{r:!1,t:Ef},animationDuration:{r:!1,t:Cf},range:{r:!0,t:wf},orientation:{r:!1,t:If},margin:{r:!1,t:ho},limit:{r:!1,t:xf},padding:{r:!1,t:Mf},behaviour:{r:!0,t:Tf},ariaFormat:{r:!1,t:Of},format:{r:!1,t:Lf},tooltips:{r:!1,t:Nf},keyboardSupport:{r:!0,t:Df},documentElement:{r:!1,t:Rf},cssPrefix:{r:!0,t:$f},cssClasses:{r:!0,t:zf},handleAttributes:{r:!1,t:Pf}},i={connect:!1,direction:"ltr",behaviour:"tap",orientation:"horizontal",keyboardSupport:!0,cssPrefix:"noUi-",cssClasses:uo,keyboardPageMultiplier:5,keyboardMultiplier:1,keyboardDefaultStep:10};t.format&&!t.ariaFormat&&(t.ariaFormat=t.format),Object.keys(n).forEach(function(a){if(!Or(t[a])&&i[a]===void 0){if(n[a].r)throw new Error("noUiSlider: '"+a+"' is required.");return}n[a].t(e,Or(t[a])?t[a]:i[a])}),e.pips=t.pips;var r=document.createElement("div"),s=r.style.msTransform!==void 0,o=r.style.transform!==void 0;e.transformRule=o?"transform":s?"msTransform":"webkitTransform";var l=[["left","top"],["right","bottom"]];return e.style=l[e.dir][e.ort],e}function jf(t,e,n){var i=cf(),r=ff(),s=r&&uf(),o=t,l,a,c,u,h,f,d=e.spectrum,m=[],p=[],g=[],_=0,k={},C=!1,w=t.ownerDocument,S=e.documentElement||w.documentElement,N=w.body,M=w.dir==="rtl"||e.ort===1?0:100;function E(A,T){var R=w.createElement("div");return T&&Et(R,T),A.appendChild(R),R}function I(A,T){var R=E(A,e.cssClasses.origin),G=E(R,e.cssClasses.handle);if(E(G,e.cssClasses.touchArea),G.setAttribute("data-handle",String(T)),e.keyboardSupport&&(G.setAttribute("tabindex","0"),G.addEventListener("keydown",function(ee){return Pe(ee,T)})),e.handleAttributes!==void 0){var ne=e.handleAttributes[T];Object.keys(ne).forEach(function(ee){G.setAttribute(ee,ne[ee])})}return G.setAttribute("role","slider"),G.setAttribute("aria-orientation",e.ort?"vertical":"horizontal"),T===0?Et(G,e.cssClasses.handleLower):T===e.handles-1&&Et(G,e.cssClasses.handleUpper),R.handle=G,R}function O(A,T){return T?E(A,e.cssClasses.connect):!1}function L(A,T){a=E(T,e.cssClasses.connects),c=[],u=[],u.push(O(a,A[0]));for(var R=0;R<e.handles;R++)c.push(I(T,R)),g[R]=R,u.push(O(a,A[R+1]))}function F(A){Et(A,e.cssClasses.target),e.dir===0?Et(A,e.cssClasses.ltr):Et(A,e.cssClasses.rtl),e.ort===0?Et(A,e.cssClasses.horizontal):Et(A,e.cssClasses.vertical);var T=getComputedStyle(A).direction;return T==="rtl"?Et(A,e.cssClasses.textDirectionRtl):Et(A,e.cssClasses.textDirectionLtr),E(A,e.cssClasses.base)}function z(A,T){return!e.tooltips||!e.tooltips[T]?!1:E(A.firstChild,e.cssClasses.tooltip)}function x(){return o.hasAttribute("disabled")}function V(A){var T=c[A];return T.hasAttribute("disabled")}function P(A){A!=null?(c[A].setAttribute("disabled",""),c[A].handle.removeAttribute("tabindex")):(o.setAttribute("disabled",""),c.forEach(function(T){T.handle.removeAttribute("tabindex")}))}function q(A){A!=null?(c[A].removeAttribute("disabled"),c[A].handle.setAttribute("tabindex","0")):(o.removeAttribute("disabled"),c.forEach(function(T){T.removeAttribute("disabled"),T.handle.setAttribute("tabindex","0")}))}function W(){f&&(mt("update"+yn.tooltips),f.forEach(function(A){A&&io(A)}),f=null)}function K(){W(),f=c.map(z),gt("update"+yn.tooltips,function(A,T,R){if(!(!f||!e.tooltips)&&f[T]!==!1){var G=A[T];e.tooltips[T]!==!0&&(G=e.tooltips[T].to(R[T])),f[T].innerHTML=G}})}function oe(){mt("update"+yn.aria),gt("update"+yn.aria,function(A,T,R,G,ne){g.forEach(function(ee){var be=c[ee],ae=Xe(p,ee,0,!0,!0,!0),nt=Xe(p,ee,100,!0,!0,!0),ke=ne[ee],Je=String(e.ariaFormat.to(R[ee]));ae=d.fromStepping(ae).toFixed(1),nt=d.fromStepping(nt).toFixed(1),ke=d.fromStepping(ke).toFixed(1),be.children[0].setAttribute("aria-valuemin",ae),be.children[0].setAttribute("aria-valuemax",nt),be.children[0].setAttribute("aria-valuenow",ke),be.children[0].setAttribute("aria-valuetext",Je)})})}function ue(A){if(A.mode===vn.Range||A.mode===vn.Steps)return d.xVal;if(A.mode===vn.Count){if(A.values<2)throw new Error("noUiSlider: 'values' (>= 2) required for mode 'count'.");for(var T=A.values-1,R=100/T,G=[];T--;)G[T]=T*R;return G.push(100),he(G,A.stepped)}return A.mode===vn.Positions?he(A.values,A.stepped):A.mode===vn.Values?A.stepped?A.values.map(function(ne){return d.fromStepping(d.getStep(d.toStepping(ne)))}):A.values:[]}function he(A,T){return A.map(function(R){return d.fromStepping(T?d.getStep(R):R)})}function ze(A){function T(ke,Je){return Number((ke+Je).toFixed(7))}var R=ue(A),G={},ne=d.xVal[0],ee=d.xVal[d.xVal.length-1],be=!1,ae=!1,nt=0;return R=rf(R.slice().sort(function(ke,Je){return ke-Je})),R[0]!==ne&&(R.unshift(ne),be=!0),R[R.length-1]!==ee&&(R.push(ee),ae=!0),R.forEach(function(ke,Je){var ce,_e,Ce,it=ke,lt=R[Je+1],ct,mn,Tn,Is,Uc,xs,Bc,qc=A.mode===vn.Steps;for(qc&&(ce=d.xNumSteps[Je]),ce||(ce=lt-it),lt===void 0&&(lt=it),ce=Math.max(ce,1e-7),_e=it;_e<=lt;_e=T(_e,ce)){for(ct=d.toStepping(_e),mn=ct-nt,Uc=mn/(A.density||1),xs=Math.round(Uc),Bc=mn/xs,Ce=1;Ce<=xs;Ce+=1)Tn=nt+Ce*Bc,G[Tn.toFixed(5)]=[d.fromStepping(Tn),0];Is=R.indexOf(_e)>-1?At.LargeValue:qc?At.SmallValue:At.NoValue,!Je&&be&&_e!==lt&&(Is=0),_e===lt&&ae||(G[ct.toFixed(5)]=[_e,Is]),nt=ct}}),G}function fe(A,T,R){var G,ne,ee=w.createElement("div"),be=(G={},G[At.None]="",G[At.NoValue]=e.cssClasses.valueNormal,G[At.LargeValue]=e.cssClasses.valueLarge,G[At.SmallValue]=e.cssClasses.valueSub,G),ae=(ne={},ne[At.None]="",ne[At.NoValue]=e.cssClasses.markerNormal,ne[At.LargeValue]=e.cssClasses.markerLarge,ne[At.SmallValue]=e.cssClasses.markerSub,ne),nt=[e.cssClasses.valueHorizontal,e.cssClasses.valueVertical],ke=[e.cssClasses.markerHorizontal,e.cssClasses.markerVertical];Et(ee,e.cssClasses.pips),Et(ee,e.ort===0?e.cssClasses.pipsHorizontal:e.cssClasses.pipsVertical);function Je(_e,Ce){var it=Ce===e.cssClasses.value,lt=it?nt:ke,ct=it?be:ae;return Ce+" "+lt[e.ort]+" "+ct[_e]}function ce(_e,Ce,it){if(it=T?T(Ce,it):it,it!==At.None){var lt=E(ee,!1);lt.className=Je(it,e.cssClasses.marker),lt.style[e.style]=_e+"%",it>At.NoValue&&(lt=E(ee,!1),lt.className=Je(it,e.cssClasses.value),lt.setAttribute("data-value",String(Ce)),lt.style[e.style]=_e+"%",lt.innerHTML=String(R.to(Ce)))}}return Object.keys(A).forEach(function(_e){ce(_e,A[_e][0],A[_e][1])}),ee}function Fe(){h&&(io(h),h=null)}function Q(A){Fe();var T=ze(A),R=A.filter,G=A.format||{to:function(ne){return String(Math.round(ne))}};return h=o.appendChild(fe(T,R,G)),h}function se(){var A=l.getBoundingClientRect(),T="offset"+["Width","Height"][e.ort];return e.ort===0?A.width||l[T]:A.height||l[T]}function J(A,T,R,G){var ne=function(be){var ae=me(be,G.pageOffset,G.target||T);if(!ae||x()&&!G.doNotReject||af(o,e.cssClasses.tap)&&!G.doNotReject||A===i.start&&ae.buttons!==void 0&&ae.buttons>1||G.hover&&ae.buttons)return!1;s||ae.preventDefault(),ae.calcPoint=ae.points[e.ort],R(ae,G)},ee=[];return A.split(" ").forEach(function(be){T.addEventListener(be,ne,s?{passive:!0}:!1),ee.push([be,ne])}),ee}function me(A,T,R){var G=A.type.indexOf("touch")===0,ne=A.type.indexOf("mouse")===0,ee=A.type.indexOf("pointer")===0,be=0,ae=0;if(A.type.indexOf("MSPointer")===0&&(ee=!0),A.type==="mousedown"&&!A.buttons&&!A.touches)return!1;if(G){var nt=function(ce){var _e=ce.target;return _e===R||R.contains(_e)||A.composed&&A.composedPath().shift()===R};if(A.type==="touchstart"){var ke=Array.prototype.filter.call(A.touches,nt);if(ke.length>1)return!1;be=ke[0].pageX,ae=ke[0].pageY}else{var Je=Array.prototype.find.call(A.changedTouches,nt);if(!Je)return!1;be=Je.pageX,ae=Je.pageY}}return T=T||lo(w),(ne||ee)&&(be=A.clientX+T.x,ae=A.clientY+T.y),A.pageOffset=T,A.points=[be,ae],A.cursor=ne||ee,A}function Y(A){var T=A-of(l,e.ort),R=T*100/se();return R=oo(R),e.dir?100-R:R}function He(A){var T=100,R=!1;return c.forEach(function(G,ne){if(!V(ne)){var ee=p[ne],be=Math.abs(ee-A),ae=be===100&&T===100,nt=be<T,ke=be<=T&&A>ee;(nt||ke||ae)&&(R=ne,T=be)}}),R}function de(A,T){A.type==="mouseout"&&A.target.nodeName==="HTML"&&A.relatedTarget===null&&Te(A,T)}function Ke(A,T){if(navigator.appVersion.indexOf("MSIE 9")===-1&&A.buttons===0&&T.buttonsProperty!==0)return Te(A,T);var R=(e.dir?-1:1)*(A.calcPoint-T.startCalcPoint),G=R*100/T.baseSize;$t(R>0,G,T.locations,T.handleNumbers,T.connect)}function Te(A,T){T.handle&&($i(T.handle,e.cssClasses.active),_-=1),T.listeners.forEach(function(R){S.removeEventListener(R[0],R[1])}),_===0&&($i(o,e.cssClasses.drag),we(),A.cursor&&(N.style.cursor="",N.removeEventListener("selectstart",ro))),e.events.smoothSteps&&(T.handleNumbers.forEach(function(R){Re(R,p[R],!0,!0,!1,!1)}),T.handleNumbers.forEach(function(R){Ee("update",R)})),T.handleNumbers.forEach(function(R){Ee("change",R),Ee("set",R),Ee("end",R)})}function Ie(A,T){if(!T.handleNumbers.some(V)){var R;if(T.handleNumbers.length===1){var G=c[T.handleNumbers[0]];R=G.children[0],_+=1,Et(R,e.cssClasses.active)}A.stopPropagation();var ne=[],ee=J(i.move,S,Ke,{target:A.target,handle:R,connect:T.connect,listeners:ne,startCalcPoint:A.calcPoint,baseSize:se(),pageOffset:A.pageOffset,handleNumbers:T.handleNumbers,buttonsProperty:A.buttons,locations:p.slice()}),be=J(i.end,S,Te,{target:A.target,handle:R,listeners:ne,doNotReject:!0,handleNumbers:T.handleNumbers}),ae=J("mouseout",S,de,{target:A.target,handle:R,listeners:ne,doNotReject:!0,handleNumbers:T.handleNumbers});ne.push.apply(ne,ee.concat(be,ae)),A.cursor&&(N.style.cursor=getComputedStyle(A.target).cursor,c.length>1&&Et(o,e.cssClasses.drag),N.addEventListener("selectstart",ro,!1)),T.handleNumbers.forEach(function(nt){Ee("start",nt)})}}function te(A){A.stopPropagation();var T=Y(A.calcPoint),R=He(T);R!==!1&&(e.events.snap||so(o,e.cssClasses.tap,e.animationDuration),Re(R,T,!0,!0),we(),Ee("slide",R,!0),Ee("update",R,!0),e.events.snap?Ie(A,{handleNumbers:[R]}):(Ee("change",R,!0),Ee("set",R,!0)))}function le(A){var T=Y(A.calcPoint),R=d.getStep(T),G=d.fromStepping(R);Object.keys(k).forEach(function(ne){ne.split(".")[0]==="hover"&&k[ne].forEach(function(ee){ee.call(yt,G)})})}function Pe(A,T){if(x()||V(T))return!1;var R=["Left","Right"],G=["Down","Up"],ne=["PageDown","PageUp"],ee=["Home","End"];e.dir&&!e.ort?R.reverse():e.ort&&!e.dir&&(G.reverse(),ne.reverse());var be=A.key.replace("Arrow",""),ae=be===ne[0],nt=be===ne[1],ke=be===G[0]||be===R[0]||ae,Je=be===G[1]||be===R[1]||nt,ce=be===ee[0],_e=be===ee[1];if(!ke&&!Je&&!ce&&!_e)return!0;A.preventDefault();var Ce;if(Je||ke){var it=ke?0:1,lt=xe(T),ct=lt[it];if(ct===null)return!1;ct===!1&&(ct=d.getDefaultStep(p[T],ke,e.keyboardDefaultStep)),nt||ae?ct*=e.keyboardPageMultiplier:ct*=e.keyboardMultiplier,ct=Math.max(ct,1e-7),ct=(ke?-1:1)*ct,Ce=m[T]+ct}else _e?Ce=e.spectrum.xVal[e.spectrum.xVal.length-1]:Ce=e.spectrum.xVal[0];return Re(T,d.toStepping(Ce),!0,!0),Ee("slide",T),Ee("update",T),Ee("change",T),Ee("set",T),!1}function ht(A){A.fixed||c.forEach(function(T,R){J(i.start,T.children[0],Ie,{handleNumbers:[R]})}),A.tap&&J(i.start,l,te,{}),A.hover&&J(i.move,l,le,{hover:!0}),A.drag&&u.forEach(function(T,R){if(!(T===!1||R===0||R===u.length-1)){var G=c[R-1],ne=c[R],ee=[T],be=[G,ne],ae=[R-1,R];Et(T,e.cssClasses.draggable),A.fixed&&(ee.push(G.children[0]),ee.push(ne.children[0])),A.dragAll&&(be=c,ae=g),ee.forEach(function(nt){J(i.start,nt,Ie,{handles:be,handleNumbers:ae,connect:T})})}})}function gt(A,T){k[A]=k[A]||[],k[A].push(T),A.split(".")[0]==="update"&&c.forEach(function(R,G){Ee("update",G)})}function Ot(A){return A===yn.aria||A===yn.tooltips}function mt(A){var T=A&&A.split(".")[0],R=T?A.substring(T.length):A;Object.keys(k).forEach(function(G){var ne=G.split(".")[0],ee=G.substring(ne.length);(!T||T===ne)&&(!R||R===ee)&&(!Ot(ee)||R===ee)&&delete k[G]})}function Ee(A,T,R){Object.keys(k).forEach(function(G){var ne=G.split(".")[0];A===ne&&k[G].forEach(function(ee){ee.call(yt,m.map(e.format.to),T,m.slice(),R||!1,p.slice(),yt)})})}function Xe(A,T,R,G,ne,ee,be){var ae;return c.length>1&&!e.events.unconstrained&&(G&&T>0&&(ae=d.getAbsoluteDistance(A[T-1],e.margin,!1),R=Math.max(R,ae)),ne&&T<c.length-1&&(ae=d.getAbsoluteDistance(A[T+1],e.margin,!0),R=Math.min(R,ae))),c.length>1&&e.limit&&(G&&T>0&&(ae=d.getAbsoluteDistance(A[T-1],e.limit,!1),R=Math.min(R,ae)),ne&&T<c.length-1&&(ae=d.getAbsoluteDistance(A[T+1],e.limit,!0),R=Math.max(R,ae))),e.padding&&(T===0&&(ae=d.getAbsoluteDistance(0,e.padding[0],!1),R=Math.max(R,ae)),T===c.length-1&&(ae=d.getAbsoluteDistance(100,e.padding[1],!0),R=Math.min(R,ae))),be||(R=d.getStep(R)),R=oo(R),R===A[T]&&!ee?!1:R}function Ze(A,T){var R=e.ort;return(R?T:A)+", "+(R?A:T)}function $t(A,T,R,G,ne){var ee=R.slice(),be=G[0],ae=e.events.smoothSteps,nt=[!A,A],ke=[A,!A];G=G.slice(),A&&G.reverse(),G.length>1?G.forEach(function(ce,_e){var Ce=Xe(ee,ce,ee[ce]+T,nt[_e],ke[_e],!1,ae);Ce===!1?T=0:(T=Ce-ee[ce],ee[ce]=Ce)}):nt=ke=[!0];var Je=!1;G.forEach(function(ce,_e){Je=Re(ce,R[ce]+T,nt[_e],ke[_e],!1,ae)||Je}),Je&&(G.forEach(function(ce){Ee("update",ce),Ee("slide",ce)}),ne!=null&&Ee("drag",be))}function It(A,T){return e.dir?100-A-T:A}function X(A,T){p[A]=T,m[A]=d.fromStepping(T);var R=It(T,0)-M,G="translate("+Ze(R+"%","0")+")";if(c[A].style[e.transformRule]=G,e.events.invertConnects&&p.length>1){var ne=p.every(function(ee,be,ae){return be===0||ee>=ae[be-1]});if(C!==!ne){ye();return}}Se(A),Se(A+1),C&&(Se(A-1),Se(A+2))}function we(){g.forEach(function(A){var T=p[A]>50?-1:1,R=3+(c.length+T*A);c[A].style.zIndex=String(R)})}function Re(A,T,R,G,ne,ee){return ne||(T=Xe(p,A,T,R,G,!1,ee)),T===!1?!1:(X(A,T),!0)}function Se(A){if(u[A]){var T=p.slice();C&&T.sort(function(ae,nt){return ae-nt});var R=0,G=100;A!==0&&(R=T[A-1]),A!==u.length-1&&(G=T[A]);var ne=G-R,ee="translate("+Ze(It(R,ne)+"%","0")+")",be="scale("+Ze(ne/100,"1")+")";u[A].style[e.transformRule]=ee+" "+be}}function rt(A,T){return A===null||A===!1||A===void 0||(typeof A=="number"&&(A=String(A)),A=e.format.from(A),A!==!1&&(A=d.toStepping(A)),A===!1||isNaN(A))?p[T]:A}function We(A,T,R){var G=Ri(A),ne=p[0]===void 0;T=T===void 0?!0:T,e.animate&&!ne&&so(o,e.cssClasses.tap,e.animationDuration),g.forEach(function(ae){Re(ae,rt(G[ae],ae),!0,!1,R)});var ee=g.length===1?0:1;if(ne&&d.hasNoSize()&&(R=!0,p[0]=0,g.length>1)){var be=100/(g.length-1);g.forEach(function(ae){p[ae]=ae*be})}for(;ee<g.length;++ee)g.forEach(function(ae){Re(ae,p[ae],!0,!0,R)});we(),g.forEach(function(ae){Ee("update",ae),G[ae]!==null&&T&&Ee("set",ae)})}function ot(A){We(e.start,A)}function Ye(A,T,R,G){if(A=Number(A),!(A>=0&&A<g.length))throw new Error("noUiSlider: invalid handle number, got: "+A);Re(A,rt(T,A),!0,!0,G),Ee("update",A),R&&Ee("set",A)}function Qe(A){if(A===void 0&&(A=!1),A)return m.length===1?m[0]:m.slice(0);var T=m.map(e.format.to);return T.length===1?T[0]:T}function Oe(){for(mt(yn.aria),mt(yn.tooltips),Object.keys(e.cssClasses).forEach(function(A){$i(o,e.cssClasses[A])});o.firstChild;)o.removeChild(o.firstChild);delete o.noUiSlider}function xe(A){var T=p[A],R=d.getNearbySteps(T),G=m[A],ne=R.thisStep.step,ee=null;if(e.snap)return[G-R.stepBefore.startValue||null,R.stepAfter.startValue-G||null];ne!==!1&&G+ne>R.stepAfter.startValue&&(ne=R.stepAfter.startValue-G),G>R.thisStep.startValue?ee=R.thisStep.step:R.stepBefore.step===!1?ee=!1:ee=G-R.stepBefore.highestStep,T===100?ne=null:T===0&&(ee=null);var be=d.countStepDecimals();return ne!==null&&ne!==!1&&(ne=Number(ne.toFixed(be))),ee!==null&&ee!==!1&&(ee=Number(ee.toFixed(be))),[ee,ne]}function ft(){return g.map(xe)}function st(A,T){var R=Qe(),G=["margin","limit","padding","range","animate","snap","step","format","pips","tooltips","connect"];G.forEach(function(ee){A[ee]!==void 0&&(n[ee]=A[ee])});var ne=mo(n);G.forEach(function(ee){A[ee]!==void 0&&(e[ee]=ne[ee])}),d=ne.spectrum,e.margin=ne.margin,e.limit=ne.limit,e.padding=ne.padding,e.pips?Q(e.pips):Fe(),e.tooltips?K():W(),p=[],We(Or(A.start)?A.start:R,T),A.connect&&Z()}function Z(){for(;a.firstChild;)a.removeChild(a.firstChild);for(var A=0;A<=e.handles;A++)u[A]=O(a,e.connect[A]),Se(A);ht({drag:e.events.drag,fixed:!0})}function ye(){C=!C,fo(e,e.connect.map(function(A){return!A})),Z()}function Ve(){l=F(o),L(e.connect,l),ht(e.events),We(e.start),e.pips&&Q(e.pips),e.tooltips&&K(),oe()}Ve();var yt={destroy:Oe,steps:ft,on:gt,off:mt,get:Qe,set:We,setHandle:Ye,reset:ot,disable:P,enable:q,__moveHandles:function(A,T,R){$t(A,T,p,R)},options:n,updateOptions:st,target:o,removePips:Fe,removeTooltips:W,getPositions:function(){return p.slice()},getTooltips:function(){return f},getOrigins:function(){return c},pips:Q};return yt}function Ff(t,e){if(!t||!t.nodeName)throw new Error("noUiSlider: create requires a single element, got: "+t);if(t.noUiSlider)throw new Error("noUiSlider: Slider was already initialized.");var n=mo(e),i=jf(t,n,e);return t.noUiSlider=i,i}const Hf={__spectrum:ao,cssClasses:uo,create:Ff},nb="",ib="";function Vf(t){let e,n,i;return{c(){e=b("span"),n=re(t[0]),v(e,"id",t[3]),v(e,"class",i="tooltip "+t[2]+" "+(t[1]?"display":"")+" svelte-1am23me")},m(r,s){$(r,e,s),y(e,n)},p(r,[s]){s&1&&Le(n,r[0]),s&6&&i!==(i="tooltip "+r[2]+" "+(r[1]?"display":"")+" svelte-1am23me")&&v(e,"class",i)},i:ie,o:ie,d(r){r&&D(e)}}}function Uf(t,e,n){let i,r,s,o,{tooltipText:l}=e,{targetHtmlId:a}=e;const c=`tooltip-generic-${window.crypto.randomUUID()}`,u=()=>n(1,o=!0),h=()=>n(1,o=!1),f=()=>n(1,o=!o);return Dn(()=>{s=a?document.getElementById(a):document.getElementById(c).parentElement,a&&!s&&(console.error(`TooltipGeneric: element with ID ${a} not found, defaulting to the parent element`),s=document.getElementById(c).targetElement),s.addEventListener("mouseover",u),s.addEventListener("mouseout",h),s.addEventListener("click",f)}),Rn(()=>{s.removeEventListener("mouseover",u),s.removeEventListener("mouseout",h),s.removeEventListener("click",f)}),t.$$set=d=>{"tooltipText"in d&&n(0,l=d.tooltipText),"targetHtmlId"in d&&n(4,a=d.targetHtmlId)},t.$$.update=()=>{t.$$.dirty&33&&n(2,i=r(l))},n(5,r=d=>n(2,i=d.length>100?"tooltip-wide":d.length>20?"tooltip-mid":"tooltip-thin")),s=void 0,n(1,o=!1),[l,o,i,c,a,r]}class zi extends qe{constructor(e){super(),Be(this,e,Uf,Vf,je,{tooltipText:0,targetHtmlId:4})}}const rb="";function Bf(t){let e,n,i,r,s,o,l,a,c,u,h,f,d,m,p,g;return{c(){e=b("div"),n=b("span"),i=re(t[2]),r=re(" ("),s=re(t[3]),o=re(")"),l=j(),a=b("div"),c=b("span"),u=re(t[0]),h=j(),f=b("div"),d=b("div"),m=j(),p=b("span"),g=re(t[1]),v(c,"class","range-marker svelte-216mtn"),v(d,"class","slider"),v(d,"id",t[4]),v(f,"class","slider-wrapper svelte-216mtn"),v(p,"class","range-marker svelte-216mtn"),v(a,"class","slider-outer-wrapper is-flex flex-direction-row svelte-216mtn")},m(_,k){$(_,e,k),y(e,n),y(n,i),y(n,r),y(n,s),y(n,o),y(e,l),y(e,a),y(a,c),y(c,u),y(a,h),y(a,f),y(f,d),y(a,m),y(a,p),y(p,g)},p(_,[k]){k&4&&Le(i,_[2]),k&8&&Le(s,_[3]),k&1&&Le(u,_[0]),k&2&&Le(g,_[1])},i:ie,o:ie,d(_){_&&D(e)}}}function qf(t,e,n){let i,{minVal:r}=e,{maxVal:s}=e,{start:o}=e,{step:l=void 0}=e,{roundTo:a=2}=e,{title:c=""}=e,{emitOnUpdate:u=!1}=e;const h=Ti(),f=`slider-${window.crypto.randomUUID()}`,d=Array.isArray(o)&&o.length===2&&o.every(E=>!isNaN(parseFloat(E))),m=[],p=d?[`noUi-handle-${window.crypto.randomUUID()}`,`noUi-handle-${window.crypto.randomUUID()}`]:[`noUi-handle-${window.crypto.randomUUID()}`],g=Oi();g.setCompareFn(d?Nr:(E,I)=>k(E)===k(I)),g.set(o);const _=zt("resetTrigger")||void 0;_==null||_.subscribe(S);const k=E=>Number(E.toFixed(a)),C=(E,I)=>{E=Array.isArray(E)?E.map(k):k(E),n(3,i=E),(I==="set"||I==="update"&&u)&&(g.set(E),g.same()||h("updateSlider",g.get()))};function w(E){m.length&&m.map((I,O)=>I.$set({tooltipText:d?E[O]:E}))}function S(){const E=document.getElementById(f);E!=null&&E.noUiSlider&&E.noUiSlider.reset()}function N(){const E=document.getElementById(f);let I;Hf.create(E,{start:o,step:l,connect:d?!0:"lower",range:{min:r,max:s},handleAttributes:p.map(O=>({id:O}))}),E.noUiSlider.on("update",()=>{I=E.noUiSlider.get(!0),C(I,"update")}),E.noUiSlider.on("set",()=>{I=E.noUiSlider.get(!0),C(I,"set")})}function M(){p.map((E,I)=>{m.push(new zi({target:document.getElementById(E),props:d?{tooltipText:i[I]}:{tooltipText:i}}))})}return Dn(()=>{N(),M()}),Rn(()=>{document.getElementById(f)&&(document.getElementById(f).innerHTML="")}),t.$$set=E=>{"minVal"in E&&n(0,r=E.minVal),"maxVal"in E&&n(1,s=E.maxVal),"start"in E&&n(5,o=E.start),"step"in E&&n(6,l=E.step),"roundTo"in E&&n(7,a=E.roundTo),"title"in E&&n(2,c=E.title),"emitOnUpdate"in E&&n(8,u=E.emitOnUpdate)},t.$$.update=()=>{t.$$.dirty&32&&n(3,i=o),t.$$.dirty&8&&w(i)},[r,s,c,i,f,o,l,a,u]}class kn extends qe{constructor(e){super(),Be(this,e,qf,Bf,je,{minVal:0,maxVal:1,start:5,step:6,roundTo:7,title:2,emitOnUpdate:8})}}const Kf=t=>({}),po=t=>({});function go(t,e,n){const i=t.slice();return i[43]=e[n],i}function _o(t,e,n){const i=t.slice();return i[46]=e[n],i}function vo(t,e,n){const i=t.slice();return i[43]=e[n],i}function yo(t,e,n){const i=t.slice();i[51]=e[n];const r=Object.keys(i[27][i[51]]||{});return i[52]=r,i}function bo(t){var st;let e,n,i,r=((st=t[0])==null?void 0:st.title)+"",s,o,l,a,c,u,h,f,d,m=(t[3].pairs||0)+"",p,g,_,k,C,w,S,N=(t[3].images||0)+"",M,E,I,O,L,F,z,x=(t[4]||0)+"",V,P,q,W,K,oe,ue,he,ze,fe,Fe,Q,se,J,me,Y,He,de,Ke,Te,Ie,te,le,Pe,ht,gt,Ot,mt,Ee,Xe,Ze,$t=["Series","Witness","Work"],It=[];for(let Z=0;Z<3;Z+=1)It[Z]=wo(yo(t,$t,Z));K=new tf({props:{documentNodes:t[5],selectedRegions:t[6],toggleRegion:t[17]}});let X=["all","filtered"],we=[];for(let Z=0;Z<2;Z+=1)we[Z]=So(vo(t,X,Z));let Re=t[28],Se=[];for(let Z=0;Z<Re.length;Z+=1)Se[Z]=ko(_o(t,Re,Z));const rt=Z=>B(Se[Z],1,1,()=>{Se[Z]=null});let We=["threshold","topk"],ot=[];for(let Z=0;Z<2;Z+=1)ot[Z]=Eo(go(t,We,Z));const Ye=[Xf,Yf],Qe=[];function Oe(Z,ye){return Z[7]==="threshold"?0:1}le=Oe(t),Pe=Qe[le]=Ye[le](t);const xe=t[34].datavizInfo,ft=Vt(xe,t,t[33],po);return{c(){e=b("div"),n=b("div"),i=b("h1"),s=re(r),o=j(),l=b("div");for(let Z=0;Z<3;Z+=1)It[Z].c();a=j(),c=b("div"),u=b("div"),h=b("p"),h.textContent=`${U==="en"?"Pairs":"Paires"}`,f=j(),d=b("p"),p=re(m),g=j(),_=b("div"),k=b("div"),C=b("p"),C.textContent="Images",w=j(),S=b("p"),M=re(N),E=j(),I=b("div"),O=b("div"),L=b("p"),L.textContent="Clusters",F=j(),z=b("p"),V=re(x),P=j(),q=b("hr"),W=j(),ve(K.$$.fragment),oe=j(),ue=b("hr"),he=j(),ze=b("div"),fe=b("h3"),fe.textContent=`${U==="en"?"Similarity categories":"Catégories de similarité"}`,Fe=j(),Q=b("div");for(let Z=0;Z<2;Z+=1)we[Z].c();se=j(),J=b("div");for(let Z=0;Z<Se.length;Z+=1)Se[Z].c();me=j(),Y=b("hr"),He=j(),de=b("div"),Ke=b("h3"),Ke.textContent=`${U==="en"?"Similarity score":"Score de similarité"}`,Te=j(),Ie=b("div");for(let Z=0;Z<2;Z+=1)ot[Z].c();te=j(),Pe.c(),ht=j(),gt=b("hr"),Ot=j(),mt=b("div"),Ee=b("h3"),Ee.textContent=`${U==="en"?"Visualisation information":"Informations sur la visualisation"}`,Xe=j(),ft&&ft.c(),v(i,"class","title"),v(h,"class","heading"),v(d,"class","title is-5"),v(c,"class","level-item has-text-centered"),v(C,"class","heading"),v(S,"class","title is-5"),v(_,"class","level-item has-text-centered"),v(L,"class","heading"),v(z,"class","title is-5"),v(I,"class","level-item has-text-centered"),v(l,"class","level"),v(n,"class","pb-2"),v(fe,"class","title"),v(Q,"class","buttons mb-3"),v(J,"class","level"),Ge(J,"is-disabled",t[1]==="all"),v(ze,"class","pt-2"),v(Ke,"class","title"),v(Ie,"class","buttons mb-3"),v(de,"class","pt-2"),v(Ee,"class","title"),v(mt,"class","py-2"),v(e,"class","content is-small mt-4")},m(Z,ye){$(Z,e,ye),y(e,n),y(n,i),y(i,s),y(n,o),y(n,l);for(let Ve=0;Ve<3;Ve+=1)It[Ve]&&It[Ve].m(l,null);y(l,a),y(l,c),y(c,u),y(u,h),y(u,f),y(u,d),y(d,p),y(l,g),y(l,_),y(_,k),y(k,C),y(k,w),y(k,S),y(S,M),y(l,E),y(l,I),y(I,O),y(O,L),y(O,F),y(O,z),y(z,V),y(e,P),y(e,q),y(e,W),pe(K,e,null),y(e,oe),y(e,ue),y(e,he),y(e,ze),y(ze,fe),y(ze,Fe),y(ze,Q);for(let Ve=0;Ve<2;Ve+=1)we[Ve]&&we[Ve].m(Q,null);y(ze,se),y(ze,J);for(let Ve=0;Ve<Se.length;Ve+=1)Se[Ve]&&Se[Ve].m(J,null);y(e,me),y(e,Y),y(e,He),y(e,de),y(de,Ke),y(de,Te),y(de,Ie);for(let Ve=0;Ve<2;Ve+=1)ot[Ve]&&ot[Ve].m(Ie,null);y(de,te),Qe[le].m(de,null),y(e,ht),y(e,gt),y(e,Ot),y(e,mt),y(mt,Ee),y(mt,Xe),ft&&ft.m(mt,null),Ze=!0},p(Z,ye){var A;if((!Ze||ye[0]&1)&&r!==(r=((A=Z[0])==null?void 0:A.title)+"")&&Le(s,r),ye[0]&134217728){$t=["Series","Witness","Work"];let T;for(T=0;T<3;T+=1){const R=yo(Z,$t,T);It[T]?It[T].p(R,ye):(It[T]=wo(R),It[T].c(),It[T].m(l,a))}for(;T<3;T+=1)It[T].d(1)}(!Ze||ye[0]&8)&&m!==(m=(Z[3].pairs||0)+"")&&Le(p,m),(!Ze||ye[0]&8)&&N!==(N=(Z[3].images||0)+"")&&Le(M,N),(!Ze||ye[0]&16)&&x!==(x=(Z[4]||0)+"")&&Le(V,x);const Ve={};if(ye[0]&32&&(Ve.documentNodes=Z[5]),ye[0]&64&&(Ve.selectedRegions=Z[6]),K.$set(Ve),ye[0]&536870914){X=["all","filtered"];let T;for(T=0;T<2;T+=1){const R=vo(Z,X,T);we[T]?we[T].p(R,ye):(we[T]=So(R),we[T].c(),we[T].m(Q,null))}for(;T<2;T+=1)we[T].d(1)}if(ye[0]&268468238){Re=Z[28];let T;for(T=0;T<Re.length;T+=1){const R=_o(Z,Re,T);Se[T]?(Se[T].p(R,ye),H(Se[T],1)):(Se[T]=ko(R),Se[T].c(),H(Se[T],1),Se[T].m(J,null))}for(et(),T=Re.length;T<Se.length;T+=1)rt(T);tt()}if((!Ze||ye[0]&2)&&Ge(J,"is-disabled",Z[1]==="all"),ye[0]&1073741952){We=["threshold","topk"];let T;for(T=0;T<2;T+=1){const R=go(Z,We,T);ot[T]?ot[T].p(R,ye):(ot[T]=Eo(R),ot[T].c(),ot[T].m(Ie,null))}for(;T<2;T+=1)ot[T].d(1)}let yt=le;le=Oe(Z),le===yt?Qe[le].p(Z,ye):(et(),B(Qe[yt],1,1,()=>{Qe[yt]=null}),tt(),Pe=Qe[le],Pe?Pe.p(Z,ye):(Pe=Qe[le]=Ye[le](Z),Pe.c()),H(Pe,1),Pe.m(de,null)),ft&&ft.p&&(!Ze||ye[1]&4)&&Bt(ft,xe,Z,Z[33],Ze?Ut(xe,Z[33],ye,Kf):qt(Z[33]),po)},i(Z){if(!Ze){H(K.$$.fragment,Z);for(let ye=0;ye<Re.length;ye+=1)H(Se[ye]);H(Pe),H(ft,Z),Ze=!0}},o(Z){B(K.$$.fragment,Z),Se=Se.filter(Boolean);for(let ye=0;ye<Se.length;ye+=1)B(Se[ye]);B(Pe),B(ft,Z),Ze=!1},d(Z){Z&&D(e),bt(It,Z),ge(K),bt(we,Z),bt(Se,Z),bt(ot,Z),Qe[le].d(),ft&&ft.d(Z)}}}function Wf(t){let e,n,i,r=yu[t[51]]+"",s,o,l,a=(t[52].length||0)+"",c;return{c(){e=b("div"),n=b("div"),i=b("p"),s=re(r),o=j(),l=b("p"),c=re(a),v(i,"class","heading"),v(l,"class","title is-5"),v(e,"class","level-item has-text-centered")},m(u,h){$(u,e,h),y(e,n),y(n,i),y(i,s),y(n,o),y(n,l),y(l,c)},p:ie,d(u){u&&D(e)}}}function wo(t){let e,n=t[52].length>0&&Wf(t);return{c(){n&&n.c(),e=kt()},m(i,r){n&&n.m(i,r),$(i,e,r)},p(i,r){i[52].length>0&&n.p(i,r)},d(i){n&&n.d(i),i&&D(e)}}}function So(t){let e,n=t[43]==="all"?U==="en"?"All pairs":"Toutes les paires":U==="en"?"Filter by category":"Filtrer par catégorie",i,r,s,o;function l(){return t[35](t[43])}return{c(){e=b("button"),i=re(n),r=j(),v(e,"class","button is-small is-flex-grow-1"),Ge(e,"is-link",t[1]===t[43]),Ge(e,"is-contrasted",t[1]!==t[43])},m(a,c){$(a,e,c),y(e,i),y(e,r),s||(o=Ae(e,"click",l),s=!0)},p(a,c){t=a,c[0]&2&&Ge(e,"is-link",t[1]===t[43]),c[0]&2&&Ge(e,"is-contrasted",t[1]!==t[43])},d(a){a&&D(e),s=!1,o()}}}function ko(t){let e,n,i,r,s,o=(t[3].categories[t[46]]||0)+"",l,a,c;return i=new Bn({props:{category:t[46],isSelected:t[2].includes(t[46]),toggle:t[36],selectable:t[1]==="filtered"}}),{c(){e=b("div"),n=b("div"),ve(i.$$.fragment),r=j(),s=b("p"),l=re(o),a=j(),v(s,"class","is-size-7 mt-1"),v(e,"class","level-item has-text-centered")},m(u,h){$(u,e,h),y(e,n),pe(i,n,null),y(n,r),y(n,s),y(s,l),y(e,a),c=!0},p(u,h){const f={};h[0]&4&&(f.isSelected=u[2].includes(u[46])),h[0]&2&&(f.toggle=u[36]),h[0]&2&&(f.selectable=u[1]==="filtered"),i.$set(f),(!c||h[0]&8)&&o!==(o=(u[3].categories[u[46]]||0)+"")&&Le(l,o)},i(u){c||(H(i.$$.fragment,u),c=!0)},o(u){B(i.$$.fragment,u),c=!1},d(u){u&&D(e),ge(i)}}}function Eo(t){let e,n=t[43]==="threshold"?U==="en"?"Score threshold":"Seuil de score":U==="en"?"Top K pairs":"Top K paires",i,r,s,o;function l(){return t[37](t[43])}return{c(){e=b("button"),i=re(n),r=j(),v(e,"class","button is-small is-flex-grow-1"),Ge(e,"is-link",t[7]===t[43]),Ge(e,"is-contrasted",t[7]!==t[43])},m(a,c){$(a,e,c),y(e,i),y(e,r),s||(o=Ae(e,"click",l),s=!0)},p(a,c){t=a,c[0]&128&&Ge(e,"is-link",t[7]===t[43]),c[0]&128&&Ge(e,"is-contrasted",t[7]!==t[43])},d(a){a&&D(e),s=!1,o()}}}function Yf(t){let e,n,i,r,s,o,l,a,c,u,h,f;return i=new kn({props:{minVal:1,maxVal:5,start:t[10]||3,step:1,roundTo:0,title:"K"}}),i.$on("updateSlider",t[39]),{c(){e=b("div"),n=b("div"),ve(i.$$.fragment),r=j(),s=b("div"),o=b("label"),l=b("input"),a=j(),c=b("span"),c.textContent=`${U==="en"?"Mutual top K":"Top K mutuel"}`,v(n,"class","column is-two-thirds pl-4"),l.checked=t[11],v(l,"type","checkbox"),v(l,"class","mr-2"),v(c,"class","is-size-7"),v(o,"class","checkbox mt-3 is-flex is-align-items-center"),v(s,"class","column mt-2"),v(e,"class","columns mt-2")},m(d,m){$(d,e,m),y(e,n),pe(i,n,null),y(e,r),y(e,s),y(s,o),y(o,l),y(o,a),y(o,c),u=!0,h||(f=Ae(l,"change",t[40]),h=!0)},p(d,m){const p={};m[0]&1024&&(p.start=d[10]||3),i.$set(p),(!u||m[0]&2048)&&(l.checked=d[11])},i(d){u||(H(i.$$.fragment,d),u=!0)},o(d){B(i.$$.fragment,d),u=!1},d(d){d&&D(e),ge(i),h=!1,f()}}}function Xf(t){var i,r;let e,n;return e=new kn({props:{minVal:((i=t[8].scoreRange)==null?void 0:i.min)||0,maxVal:((r=t[8].scoreRange)==null?void 0:r.max)||1,start:t[9],step:.01,roundTo:2,title:U==="en"?"Minimum score":"Score minimum"}}),e.$on("updateSlider",t[38]),{c(){ve(e.$$.fragment)},m(s,o){pe(e,s,o),n=!0},p(s,o){var a,c;const l={};o[0]&256&&(l.minVal=((a=s[8].scoreRange)==null?void 0:a.min)||0),o[0]&256&&(l.maxVal=((c=s[8].scoreRange)==null?void 0:c.max)||1),o[0]&512&&(l.start=s[9]),e.$set(l)},i(s){n||(H(e.$$.fragment,s),n=!0)},o(s){B(e.$$.fragment,s),n=!1},d(s){ge(e,s)}}}function Gf(t){let e,n,i=t[3]&&bo(t);return{c(){e=b("div"),i&&i.c(),v(e,"class","m-4 py-5 px-4")},m(r,s){$(r,e,s),i&&i.m(e,null),n=!0},p(r,s){r[3]?i?(i.p(r,s),s[0]&8&&H(i,1)):(i=bo(r),i.c(),H(i,1),i.m(e,null)):i&&(et(),B(i,1,1,()=>{i=null}),tt())},i(r){n||(H(i),n=!0)},o(r){B(i),n=!1},d(r){r&&D(e),i&&i.d()}}}function Jf(t,e,n){let i,r,s,o,l,a,c,u,h,f,{$$slots:d={},$$scope:m}=e,{docSet:p=null}=e,{documentSetStore:g}=e,{clusterStore:_}=e;const{docSetNumber:k,documentNodes:C,selectedCategories:w,toggleCategory:S,selectedRegions:N,toggleRegion:M,threshold:E,setThreshold:I,topK:O,setTopK:L,mutualTopK:F,setMutualTopK:z,scoreMode:x,setScoreMode:V,pairStats:P}=g;Me(t,k,Y=>n(3,r=Y)),Me(t,C,Y=>n(5,o=Y)),Me(t,w,Y=>n(2,i=Y)),Me(t,N,Y=>n(6,l=Y)),Me(t,E,Y=>n(9,u=Y)),Me(t,O,Y=>n(10,h=Y)),Me(t,F,Y=>n(11,f=Y)),Me(t,x,Y=>n(7,a=Y)),Me(t,P,Y=>n(8,c=Y));const{clusterNb:q,handlePageUpdate:W}=_;Me(t,q,Y=>n(4,s=Y));const K=zt("selectedDocuments"),oe=[0,1,2,3,5];let ue="filtered";function he(Y){n(1,ue=Y),Y==="all"&&i.length!==oe.length&&w.set(oe)}function ze(Y){W(1),V(Y)}const fe=Y=>he(Y),Fe=Y=>ue==="filtered"?S(Y):null,Q=Y=>ze(Y),se=Y=>I(Y.detail),J=Y=>L(Y.detail),me=()=>z(!f);return t.$$set=Y=>{"docSet"in Y&&n(0,p=Y.docSet),"documentSetStore"in Y&&n(31,g=Y.documentSetStore),"clusterStore"in Y&&n(32,_=Y.clusterStore),"$$scope"in Y&&n(33,m=Y.$$scope)},[p,ue,i,r,s,o,l,a,c,u,h,f,k,C,w,S,N,M,E,I,O,L,F,z,x,P,q,K,oe,he,ze,g,_,m,d,fe,Fe,Q,se,J,me]}class Qf extends qe{constructor(e){super(),Be(this,e,Jf,Gf,je,{docSet:0,documentSetStore:31,clusterStore:32},null,[-1,-1])}}function ji(t,e){return t==null||e==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function Zf(t,e){return t==null||e==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function Co(t){let e,n,i;t.length!==2?(e=ji,n=(l,a)=>ji(t(l),a),i=(l,a)=>t(l)-a):(e=t===ji||t===Zf?t:ed,n=t,i=t);function r(l,a,c=0,u=l.length){if(c<u){if(e(a,a)!==0)return u;do{const h=c+u>>>1;n(l[h],a)<0?c=h+1:u=h}while(c<u)}return c}function s(l,a,c=0,u=l.length){if(c<u){if(e(a,a)!==0)return u;do{const h=c+u>>>1;n(l[h],a)<=0?c=h+1:u=h}while(c<u)}return c}function o(l,a,c=0,u=l.length){const h=r(l,a,c,u-1);return h>c&&i(l[h-1],a)>-i(l[h],a)?h-1:h}return{left:r,center:o,right:s}}function ed(){return 0}function td(t){return t===null?NaN:+t}const nd=Co(ji).right;Co(td).center;const id=nd;class Io extends Map{constructor(e,n=od){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:n}}),e!=null)for(const[i,r]of e)this.set(i,r)}get(e){return super.get(xo(this,e))}has(e){return super.has(xo(this,e))}set(e,n){return super.set(rd(this,e),n)}delete(e){return super.delete(sd(this,e))}}function xo({_intern:t,_key:e},n){const i=e(n);return t.has(i)?t.get(i):n}function rd({_intern:t,_key:e},n){const i=e(n);return t.has(i)?t.get(i):(t.set(i,n),n)}function sd({_intern:t,_key:e},n){const i=e(n);return t.has(i)&&(n=t.get(i),t.delete(i)),n}function od(t){return t!==null&&typeof t=="object"?t.valueOf():t}const ld=Math.sqrt(50),ad=Math.sqrt(10),cd=Math.sqrt(2);function Fi(t,e,n){const i=(e-t)/Math.max(0,n),r=Math.floor(Math.log10(i)),s=i/Math.pow(10,r),o=s>=ld?10:s>=ad?5:s>=cd?2:1;let l,a,c;return r<0?(c=Math.pow(10,-r)/o,l=Math.round(t*c),a=Math.round(e*c),l/c<t&&++l,a/c>e&&--a,c=-c):(c=Math.pow(10,r)*o,l=Math.round(t/c),a=Math.round(e/c),l*c<t&&++l,a*c>e&&--a),a<l&&.5<=n&&n<2?Fi(t,e,n*2):[l,a,c]}function ud(t,e,n){if(e=+e,t=+t,n=+n,!(n>0))return[];if(t===e)return[t];const i=e<t,[r,s,o]=i?Fi(e,t,n):Fi(t,e,n);if(!(s>=r))return[];const l=s-r+1,a=new Array(l);if(i)if(o<0)for(let c=0;c<l;++c)a[c]=(s-c)/-o;else for(let c=0;c<l;++c)a[c]=(s-c)*o;else if(o<0)for(let c=0;c<l;++c)a[c]=(r+c)/-o;else for(let c=0;c<l;++c)a[c]=(r+c)*o;return a}function Rr(t,e,n){return e=+e,t=+t,n=+n,Fi(t,e,n)[2]}function fd(t,e,n){e=+e,t=+t,n=+n;const i=e<t,r=i?Rr(e,t,n):Rr(t,e,n);return(i?-1:1)*(r<0?1/-r:r)}function Hi(t,e,n){t=+t,e=+e,n=(r=arguments.length)<2?(e=t,t=0,1):r<3?1:+n;for(var i=-1,r=Math.max(0,Math.ceil((e-t)/n))|0,s=new Array(r);++i<r;)s[i]=t+i*n;return s}function dd(t){return t}var Vi=1,$r=2,Mo=3,oi=4,Ao=1e-6;function hd(t){return"translate("+t+",0)"}function md(t){return"translate(0,"+t+")"}function pd(t){return e=>+t(e)}function gd(t,e){return e=Math.max(0,t.bandwidth()-e*2)/2,t.round()&&(e=Math.round(e)),n=>+t(n)+e}function _d(){return!this.__axis}function To(t,e){var n=[],i=null,r=null,s=6,o=6,l=3,a=typeof window<"u"&&window.devicePixelRatio>1?0:.5,c=t===Vi||t===oi?-1:1,u=t===oi||t===$r?"x":"y",h=t===Vi||t===Mo?hd:md;function f(d){var m=i??(e.ticks?e.ticks.apply(e,n):e.domain()),p=r??(e.tickFormat?e.tickFormat.apply(e,n):dd),g=Math.max(s,0)+l,_=e.range(),k=+_[0]+a,C=+_[_.length-1]+a,w=(e.bandwidth?gd:pd)(e.copy(),a),S=d.selection?d.selection():d,N=S.selectAll(".domain").data([null]),M=S.selectAll(".tick").data(m,e).order(),E=M.exit(),I=M.enter().append("g").attr("class","tick"),O=M.select("line"),L=M.select("text");N=N.merge(N.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),M=M.merge(I),O=O.merge(I.append("line").attr("stroke","currentColor").attr(u+"2",c*s)),L=L.merge(I.append("text").attr("fill","currentColor").attr(u,c*g).attr("dy",t===Vi?"0em":t===Mo?"0.71em":"0.32em")),d!==S&&(N=N.transition(d),M=M.transition(d),O=O.transition(d),L=L.transition(d),E=E.transition(d).attr("opacity",Ao).attr("transform",function(F){return isFinite(F=w(F))?h(F+a):this.getAttribute("transform")}),I.attr("opacity",Ao).attr("transform",function(F){var z=this.parentNode.__axis;return h((z&&isFinite(z=z(F))?z:w(F))+a)})),E.remove(),N.attr("d",t===oi||t===$r?o?"M"+c*o+","+k+"H"+a+"V"+C+"H"+c*o:"M"+a+","+k+"V"+C:o?"M"+k+","+c*o+"V"+a+"H"+C+"V"+c*o:"M"+k+","+a+"H"+C),M.attr("opacity",1).attr("transform",function(F){return h(w(F)+a)}),O.attr(u+"2",c*s),L.attr(u,c*g).text(p),S.filter(_d).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",t===$r?"start":t===oi?"end":"middle"),S.each(function(){this.__axis=w})}return f.scale=function(d){return arguments.length?(e=d,f):e},f.ticks=function(){return n=Array.from(arguments),f},f.tickArguments=function(d){return arguments.length?(n=d==null?[]:Array.from(d),f):n.slice()},f.tickValues=function(d){return arguments.length?(i=d==null?null:Array.from(d),f):i&&i.slice()},f.tickFormat=function(d){return arguments.length?(r=d,f):r},f.tickSize=function(d){return arguments.length?(s=o=+d,f):s},f.tickSizeInner=function(d){return arguments.length?(s=+d,f):s},f.tickSizeOuter=function(d){return arguments.length?(o=+d,f):o},f.tickPadding=function(d){return arguments.length?(l=+d,f):l},f.offset=function(d){return arguments.length?(a=+d,f):a},f}function No(t){return To(Vi,t)}function Po(t){return To(oi,t)}var vd={value:()=>{}};function li(){for(var t=0,e=arguments.length,n={},i;t<e;++t){if(!(i=arguments[t]+"")||i in n||/[\s.]/.test(i))throw new Error("illegal type: "+i);n[i]=[]}return new Ui(n)}function Ui(t){this._=t}function yd(t,e){return t.trim().split(/^|\s+/).map(function(n){var i="",r=n.indexOf(".");if(r>=0&&(i=n.slice(r+1),n=n.slice(0,r)),n&&!e.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:i}})}Ui.prototype=li.prototype={constructor:Ui,on:function(t,e){var n=this._,i=yd(t+"",n),r,s=-1,o=i.length;if(arguments.length<2){for(;++s<o;)if((r=(t=i[s]).type)&&(r=bd(n[r],t.name)))return r;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++s<o;)if(r=(t=i[s]).type)n[r]=Oo(n[r],t.name,e);else if(e==null)for(r in n)n[r]=Oo(n[r],t.name,null);return this},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new Ui(t)},call:function(t,e){if((r=arguments.length-2)>0)for(var n=new Array(r),i=0,r,s;i<r;++i)n[i]=arguments[i+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(s=this._[t],i=0,r=s.length;i<r;++i)s[i].value.apply(e,n)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var i=this._[t],r=0,s=i.length;r<s;++r)i[r].value.apply(e,n)}};function bd(t,e){for(var n=0,i=t.length,r;n<i;++n)if((r=t[n]).name===e)return r.value}function Oo(t,e,n){for(var i=0,r=t.length;i<r;++i)if(t[i].name===e){t[i]=vd,t=t.slice(0,i).concat(t.slice(i+1));break}return n!=null&&t.push({name:e,value:n}),t}var zr="http://www.w3.org/1999/xhtml";const Lo={svg:"http://www.w3.org/2000/svg",xhtml:zr,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Bi(t){var e=t+="",n=e.indexOf(":");return n>=0&&(e=t.slice(0,n))!=="xmlns"&&(t=t.slice(n+1)),Lo.hasOwnProperty(e)?{space:Lo[e],local:t}:t}function wd(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===zr&&e.documentElement.namespaceURI===zr?e.createElement(t):e.createElementNS(n,t)}}function Sd(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function Do(t){var e=Bi(t);return(e.local?Sd:wd)(e)}function kd(){}function jr(t){return t==null?kd:function(){return this.querySelector(t)}}function Ed(t){typeof t!="function"&&(t=jr(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var s=e[r],o=s.length,l=i[r]=new Array(o),a,c,u=0;u<o;++u)(a=s[u])&&(c=t.call(a,a.__data__,u,s))&&("__data__"in a&&(c.__data__=a.__data__),l[u]=c);return new Ft(i,this._parents)}function Cd(t){return t==null?[]:Array.isArray(t)?t:Array.from(t)}function Id(){return[]}function Ro(t){return t==null?Id:function(){return this.querySelectorAll(t)}}function xd(t){return function(){return Cd(t.apply(this,arguments))}}function Md(t){typeof t=="function"?t=xd(t):t=Ro(t);for(var e=this._groups,n=e.length,i=[],r=[],s=0;s<n;++s)for(var o=e[s],l=o.length,a,c=0;c<l;++c)(a=o[c])&&(i.push(t.call(a,a.__data__,c,o)),r.push(a));return new Ft(i,r)}function $o(t){return function(){return this.matches(t)}}function zo(t){return function(e){return e.matches(t)}}var Ad=Array.prototype.find;function Td(t){return function(){return Ad.call(this.children,t)}}function Nd(){return this.firstElementChild}function Pd(t){return this.select(t==null?Nd:Td(typeof t=="function"?t:zo(t)))}var Od=Array.prototype.filter;function Ld(){return Array.from(this.children)}function Dd(t){return function(){return Od.call(this.children,t)}}function Rd(t){return this.selectAll(t==null?Ld:Dd(typeof t=="function"?t:zo(t)))}function $d(t){typeof t!="function"&&(t=$o(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var s=e[r],o=s.length,l=i[r]=[],a,c=0;c<o;++c)(a=s[c])&&t.call(a,a.__data__,c,s)&&l.push(a);return new Ft(i,this._parents)}function jo(t){return new Array(t.length)}function zd(){return new Ft(this._enter||this._groups.map(jo),this._parents)}function qi(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}qi.prototype={constructor:qi,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function jd(t){return function(){return t}}function Fd(t,e,n,i,r,s){for(var o=0,l,a=e.length,c=s.length;o<c;++o)(l=e[o])?(l.__data__=s[o],i[o]=l):n[o]=new qi(t,s[o]);for(;o<a;++o)(l=e[o])&&(r[o]=l)}function Hd(t,e,n,i,r,s,o){var l,a,c=new Map,u=e.length,h=s.length,f=new Array(u),d;for(l=0;l<u;++l)(a=e[l])&&(f[l]=d=o.call(a,a.__data__,l,e)+"",c.has(d)?r[l]=a:c.set(d,a));for(l=0;l<h;++l)d=o.call(t,s[l],l,s)+"",(a=c.get(d))?(i[l]=a,a.__data__=s[l],c.delete(d)):n[l]=new qi(t,s[l]);for(l=0;l<u;++l)(a=e[l])&&c.get(f[l])===a&&(r[l]=a)}function Vd(t){return t.__data__}function Ud(t,e){if(!arguments.length)return Array.from(this,Vd);var n=e?Hd:Fd,i=this._parents,r=this._groups;typeof t!="function"&&(t=jd(t));for(var s=r.length,o=new Array(s),l=new Array(s),a=new Array(s),c=0;c<s;++c){var u=i[c],h=r[c],f=h.length,d=Bd(t.call(u,u&&u.__data__,c,i)),m=d.length,p=l[c]=new Array(m),g=o[c]=new Array(m),_=a[c]=new Array(f);n(u,h,p,g,_,d,e);for(var k=0,C=0,w,S;k<m;++k)if(w=p[k]){for(k>=C&&(C=k+1);!(S=g[C])&&++C<m;);w._next=S||null}}return o=new Ft(o,i),o._enter=l,o._exit=a,o}function Bd(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function qd(){return new Ft(this._exit||this._groups.map(jo),this._parents)}function Kd(t,e,n){var i=this.enter(),r=this,s=this.exit();return typeof t=="function"?(i=t(i),i&&(i=i.selection())):i=i.append(t+""),e!=null&&(r=e(r),r&&(r=r.selection())),n==null?s.remove():n(s),i&&r?i.merge(r).order():r}function Wd(t){for(var e=t.selection?t.selection():t,n=this._groups,i=e._groups,r=n.length,s=i.length,o=Math.min(r,s),l=new Array(r),a=0;a<o;++a)for(var c=n[a],u=i[a],h=c.length,f=l[a]=new Array(h),d,m=0;m<h;++m)(d=c[m]||u[m])&&(f[m]=d);for(;a<r;++a)l[a]=n[a];return new Ft(l,this._parents)}function Yd(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var i=t[e],r=i.length-1,s=i[r],o;--r>=0;)(o=i[r])&&(s&&o.compareDocumentPosition(s)^4&&s.parentNode.insertBefore(o,s),s=o);return this}function Xd(t){t||(t=Gd);function e(h,f){return h&&f?t(h.__data__,f.__data__):!h-!f}for(var n=this._groups,i=n.length,r=new Array(i),s=0;s<i;++s){for(var o=n[s],l=o.length,a=r[s]=new Array(l),c,u=0;u<l;++u)(c=o[u])&&(a[u]=c);a.sort(e)}return new Ft(r,this._parents).order()}function Gd(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function Jd(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function Qd(){return Array.from(this)}function Zd(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var i=t[e],r=0,s=i.length;r<s;++r){var o=i[r];if(o)return o}return null}function eh(){let t=0;for(const e of this)++t;return t}function th(){return!this.node()}function nh(t){for(var e=this._groups,n=0,i=e.length;n<i;++n)for(var r=e[n],s=0,o=r.length,l;s<o;++s)(l=r[s])&&t.call(l,l.__data__,s,r);return this}function ih(t){return function(){this.removeAttribute(t)}}function rh(t){return function(){this.removeAttributeNS(t.space,t.local)}}function sh(t,e){return function(){this.setAttribute(t,e)}}function oh(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function lh(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttribute(t):this.setAttribute(t,n)}}function ah(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function ch(t,e){var n=Bi(t);if(arguments.length<2){var i=this.node();return n.local?i.getAttributeNS(n.space,n.local):i.getAttribute(n)}return this.each((e==null?n.local?rh:ih:typeof e=="function"?n.local?ah:lh:n.local?oh:sh)(n,e))}function Fo(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function uh(t){return function(){this.style.removeProperty(t)}}function fh(t,e,n){return function(){this.style.setProperty(t,e,n)}}function dh(t,e,n){return function(){var i=e.apply(this,arguments);i==null?this.style.removeProperty(t):this.style.setProperty(t,i,n)}}function hh(t,e,n){return arguments.length>1?this.each((e==null?uh:typeof e=="function"?dh:fh)(t,e,n??"")):qn(this.node(),t)}function qn(t,e){return t.style.getPropertyValue(e)||Fo(t).getComputedStyle(t,null).getPropertyValue(e)}function mh(t){return function(){delete this[t]}}function ph(t,e){return function(){this[t]=e}}function gh(t,e){return function(){var n=e.apply(this,arguments);n==null?delete this[t]:this[t]=n}}function _h(t,e){return arguments.length>1?this.each((e==null?mh:typeof e=="function"?gh:ph)(t,e)):this.node()[t]}function Ho(t){return t.trim().split(/^|\s+/)}function Fr(t){return t.classList||new Vo(t)}function Vo(t){this._node=t,this._names=Ho(t.getAttribute("class")||"")}Vo.prototype={add:function(t){var e=this._names.indexOf(t);e<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function Uo(t,e){for(var n=Fr(t),i=-1,r=e.length;++i<r;)n.add(e[i])}function Bo(t,e){for(var n=Fr(t),i=-1,r=e.length;++i<r;)n.remove(e[i])}function vh(t){return function(){Uo(this,t)}}function yh(t){return function(){Bo(this,t)}}function bh(t,e){return function(){(e.apply(this,arguments)?Uo:Bo)(this,t)}}function wh(t,e){var n=Ho(t+"");if(arguments.length<2){for(var i=Fr(this.node()),r=-1,s=n.length;++r<s;)if(!i.contains(n[r]))return!1;return!0}return this.each((typeof e=="function"?bh:e?vh:yh)(n,e))}function Sh(){this.textContent=""}function kh(t){return function(){this.textContent=t}}function Eh(t){return function(){var e=t.apply(this,arguments);this.textContent=e??""}}function Ch(t){return arguments.length?this.each(t==null?Sh:(typeof t=="function"?Eh:kh)(t)):this.node().textContent}function Ih(){this.innerHTML=""}function xh(t){return function(){this.innerHTML=t}}function Mh(t){return function(){var e=t.apply(this,arguments);this.innerHTML=e??""}}function Ah(t){return arguments.length?this.each(t==null?Ih:(typeof t=="function"?Mh:xh)(t)):this.node().innerHTML}function Th(){this.nextSibling&&this.parentNode.appendChild(this)}function Nh(){return this.each(Th)}function Ph(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Oh(){return this.each(Ph)}function Lh(t){var e=typeof t=="function"?t:Do(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function Dh(){return null}function Rh(t,e){var n=typeof t=="function"?t:Do(t),i=e==null?Dh:typeof e=="function"?e:jr(e);return this.select(function(){return this.insertBefore(n.apply(this,arguments),i.apply(this,arguments)||null)})}function $h(){var t=this.parentNode;t&&t.removeChild(this)}function zh(){return this.each($h)}function jh(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function Fh(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function Hh(t){return this.select(t?Fh:jh)}function Vh(t){return arguments.length?this.property("__data__",t):this.node().__data__}function Uh(t){return function(e){t.call(this,e,this.__data__)}}function Bh(t){return t.trim().split(/^|\s+/).map(function(e){var n="",i=e.indexOf(".");return i>=0&&(n=e.slice(i+1),e=e.slice(0,i)),{type:e,name:n}})}function qh(t){return function(){var e=this.__on;if(e){for(var n=0,i=-1,r=e.length,s;n<r;++n)s=e[n],(!t.type||s.type===t.type)&&s.name===t.name?this.removeEventListener(s.type,s.listener,s.options):e[++i]=s;++i?e.length=i:delete this.__on}}}function Kh(t,e,n){return function(){var i=this.__on,r,s=Uh(e);if(i){for(var o=0,l=i.length;o<l;++o)if((r=i[o]).type===t.type&&r.name===t.name){this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=s,r.options=n),r.value=e;return}}this.addEventListener(t.type,s,n),r={type:t.type,name:t.name,value:e,listener:s,options:n},i?i.push(r):this.__on=[r]}}function Wh(t,e,n){var i=Bh(t+""),r,s=i.length,o;if(arguments.length<2){var l=this.node().__on;if(l){for(var a=0,c=l.length,u;a<c;++a)for(r=0,u=l[a];r<s;++r)if((o=i[r]).type===u.type&&o.name===u.name)return u.value}return}for(l=e?Kh:qh,r=0;r<s;++r)this.each(l(i[r],e,n));return this}function qo(t,e,n){var i=Fo(t),r=i.CustomEvent;typeof r=="function"?r=new r(e,n):(r=i.document.createEvent("Event"),n?(r.initEvent(e,n.bubbles,n.cancelable),r.detail=n.detail):r.initEvent(e,!1,!1)),t.dispatchEvent(r)}function Yh(t,e){return function(){return qo(this,t,e)}}function Xh(t,e){return function(){return qo(this,t,e.apply(this,arguments))}}function Gh(t,e){return this.each((typeof e=="function"?Xh:Yh)(t,e))}function*Jh(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var i=t[e],r=0,s=i.length,o;r<s;++r)(o=i[r])&&(yield o)}var Ko=[null];function Ft(t,e){this._groups=t,this._parents=e}function ai(){return new Ft([[document.documentElement]],Ko)}function Qh(){return this}Ft.prototype=ai.prototype={constructor:Ft,select:Ed,selectAll:Md,selectChild:Pd,selectChildren:Rd,filter:$d,data:Ud,enter:zd,exit:qd,join:Kd,merge:Wd,selection:Qh,order:Yd,sort:Xd,call:Jd,nodes:Qd,node:Zd,size:eh,empty:th,each:nh,attr:ch,style:hh,property:_h,classed:wh,text:Ch,html:Ah,raise:Nh,lower:Oh,append:Lh,insert:Rh,remove:zh,clone:Hh,datum:Vh,on:Wh,dispatch:Gh,[Symbol.iterator]:Jh};function dt(t){return typeof t=="string"?new Ft([[document.querySelector(t)]],[document.documentElement]):new Ft([[t]],Ko)}function Zh(t){let e;for(;e=t.sourceEvent;)t=e;return t}function _t(t,e){if(t=Zh(t),e===void 0&&(e=t.currentTarget),e){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var i=n.createSVGPoint();return i.x=t.clientX,i.y=t.clientY,i=i.matrixTransform(e.getScreenCTM().inverse()),[i.x,i.y]}if(e.getBoundingClientRect){var r=e.getBoundingClientRect();return[t.clientX-r.left-e.clientLeft,t.clientY-r.top-e.clientTop]}}return[t.pageX,t.pageY]}const em={passive:!1},ci={capture:!0,passive:!1};function Hr(t){t.stopImmediatePropagation()}function Kn(t){t.preventDefault(),t.stopImmediatePropagation()}function Wo(t){var e=t.document.documentElement,n=dt(t).on("dragstart.drag",Kn,ci);"onselectstart"in e?n.on("selectstart.drag",Kn,ci):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function Yo(t,e){var n=t.document.documentElement,i=dt(t).on("dragstart.drag",null);e&&(i.on("click.drag",Kn,ci),setTimeout(function(){i.on("click.drag",null)},0)),"onselectstart"in n?i.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}const Ki=t=>()=>t;function Vr(t,{sourceEvent:e,subject:n,target:i,identifier:r,active:s,x:o,y:l,dx:a,dy:c,dispatch:u}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},subject:{value:n,enumerable:!0,configurable:!0},target:{value:i,enumerable:!0,configurable:!0},identifier:{value:r,enumerable:!0,configurable:!0},active:{value:s,enumerable:!0,configurable:!0},x:{value:o,enumerable:!0,configurable:!0},y:{value:l,enumerable:!0,configurable:!0},dx:{value:a,enumerable:!0,configurable:!0},dy:{value:c,enumerable:!0,configurable:!0},_:{value:u}})}Vr.prototype.on=function(){var t=this._.on.apply(this._,arguments);return t===this._?this:t};function tm(t){return!t.ctrlKey&&!t.button}function nm(){return this.parentNode}function im(t,e){return e??{x:t.x,y:t.y}}function rm(){return navigator.maxTouchPoints||"ontouchstart"in this}function sm(){var t=tm,e=nm,n=im,i=rm,r={},s=li("start","drag","end"),o=0,l,a,c,u,h=0;function f(w){w.on("mousedown.drag",d).filter(i).on("touchstart.drag",g).on("touchmove.drag",_,em).on("touchend.drag touchcancel.drag",k).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function d(w,S){if(!(u||!t.call(this,w,S))){var N=C(this,e.call(this,w,S),w,S,"mouse");N&&(dt(w.view).on("mousemove.drag",m,ci).on("mouseup.drag",p,ci),Wo(w.view),Hr(w),c=!1,l=w.clientX,a=w.clientY,N("start",w))}}function m(w){if(Kn(w),!c){var S=w.clientX-l,N=w.clientY-a;c=S*S+N*N>h}r.mouse("drag",w)}function p(w){dt(w.view).on("mousemove.drag mouseup.drag",null),Yo(w.view,c),Kn(w),r.mouse("end",w)}function g(w,S){if(t.call(this,w,S)){var N=w.changedTouches,M=e.call(this,w,S),E=N.length,I,O;for(I=0;I<E;++I)(O=C(this,M,w,S,N[I].identifier,N[I]))&&(Hr(w),O("start",w,N[I]))}}function _(w){var S=w.changedTouches,N=S.length,M,E;for(M=0;M<N;++M)(E=r[S[M].identifier])&&(Kn(w),E("drag",w,S[M]))}function k(w){var S=w.changedTouches,N=S.length,M,E;for(u&&clearTimeout(u),u=setTimeout(function(){u=null},500),M=0;M<N;++M)(E=r[S[M].identifier])&&(Hr(w),E("end",w,S[M]))}function C(w,S,N,M,E,I){var O=s.copy(),L=_t(I||N,S),F,z,x;if((x=n.call(w,new Vr("beforestart",{sourceEvent:N,target:f,identifier:E,active:o,x:L[0],y:L[1],dx:0,dy:0,dispatch:O}),M))!=null)return F=x.x-L[0]||0,z=x.y-L[1]||0,function V(P,q,W){var K=L,oe;switch(P){case"start":r[E]=V,oe=o++;break;case"end":delete r[E],--o;case"drag":L=_t(W||q,S),oe=o;break}O.call(P,w,new Vr(P,{sourceEvent:q,subject:x,target:f,identifier:E,active:oe,x:L[0]+F,y:L[1]+z,dx:L[0]-K[0],dy:L[1]-K[1],dispatch:O}),M)}}return f.filter=function(w){return arguments.length?(t=typeof w=="function"?w:Ki(!!w),f):t},f.container=function(w){return arguments.length?(e=typeof w=="function"?w:Ki(w),f):e},f.subject=function(w){return arguments.length?(n=typeof w=="function"?w:Ki(w),f):n},f.touchable=function(w){return arguments.length?(i=typeof w=="function"?w:Ki(!!w),f):i},f.on=function(){var w=s.on.apply(s,arguments);return w===s?f:w},f.clickDistance=function(w){return arguments.length?(h=(w=+w)*w,f):Math.sqrt(h)},f}function Ur(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function Xo(t,e){var n=Object.create(t.prototype);for(var i in e)n[i]=e[i];return n}function ui(){}var fi=.7,Wi=1/fi,Wn="\\s*([+-]?\\d+)\\s*",di="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Zt="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",om=/^#([0-9a-f]{3,8})$/,lm=new RegExp(`^rgb\\(${Wn},${Wn},${Wn}\\)$`),am=new RegExp(`^rgb\\(${Zt},${Zt},${Zt}\\)$`),cm=new RegExp(`^rgba\\(${Wn},${Wn},${Wn},${di}\\)$`),um=new RegExp(`^rgba\\(${Zt},${Zt},${Zt},${di}\\)$`),fm=new RegExp(`^hsl\\(${di},${Zt},${Zt}\\)$`),dm=new RegExp(`^hsla\\(${di},${Zt},${Zt},${di}\\)$`),Go={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Ur(ui,En,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:Jo,formatHex:Jo,formatHex8:hm,formatHsl:mm,formatRgb:Qo,toString:Qo});function Jo(){return this.rgb().formatHex()}function hm(){return this.rgb().formatHex8()}function mm(){return il(this).formatHsl()}function Qo(){return this.rgb().formatRgb()}function En(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=om.exec(t))?(n=e[1].length,e=parseInt(e[1],16),n===6?Zo(e):n===3?new Lt(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):n===8?Yi(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):n===4?Yi(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=lm.exec(t))?new Lt(e[1],e[2],e[3],1):(e=am.exec(t))?new Lt(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=cm.exec(t))?Yi(e[1],e[2],e[3],e[4]):(e=um.exec(t))?Yi(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=fm.exec(t))?nl(e[1],e[2]/100,e[3]/100,1):(e=dm.exec(t))?nl(e[1],e[2]/100,e[3]/100,e[4]):Go.hasOwnProperty(t)?Zo(Go[t]):t==="transparent"?new Lt(NaN,NaN,NaN,0):null}function Zo(t){return new Lt(t>>16&255,t>>8&255,t&255,1)}function Yi(t,e,n,i){return i<=0&&(t=e=n=NaN),new Lt(t,e,n,i)}function pm(t){return t instanceof ui||(t=En(t)),t?(t=t.rgb(),new Lt(t.r,t.g,t.b,t.opacity)):new Lt}function Br(t,e,n,i){return arguments.length===1?pm(t):new Lt(t,e,n,i??1)}function Lt(t,e,n,i){this.r=+t,this.g=+e,this.b=+n,this.opacity=+i}Ur(Lt,Br,Xo(ui,{brighter(t){return t=t==null?Wi:Math.pow(Wi,t),new Lt(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?fi:Math.pow(fi,t),new Lt(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new Lt(Cn(this.r),Cn(this.g),Cn(this.b),Xi(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:el,formatHex:el,formatHex8:gm,formatRgb:tl,toString:tl}));function el(){return`#${In(this.r)}${In(this.g)}${In(this.b)}`}function gm(){return`#${In(this.r)}${In(this.g)}${In(this.b)}${In((isNaN(this.opacity)?1:this.opacity)*255)}`}function tl(){const t=Xi(this.opacity);return`${t===1?"rgb(":"rgba("}${Cn(this.r)}, ${Cn(this.g)}, ${Cn(this.b)}${t===1?")":`, ${t})`}`}function Xi(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function Cn(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function In(t){return t=Cn(t),(t<16?"0":"")+t.toString(16)}function nl(t,e,n,i){return i<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new Gt(t,e,n,i)}function il(t){if(t instanceof Gt)return new Gt(t.h,t.s,t.l,t.opacity);if(t instanceof ui||(t=En(t)),!t)return new Gt;if(t instanceof Gt)return t;t=t.rgb();var e=t.r/255,n=t.g/255,i=t.b/255,r=Math.min(e,n,i),s=Math.max(e,n,i),o=NaN,l=s-r,a=(s+r)/2;return l?(e===s?o=(n-i)/l+(n<i)*6:n===s?o=(i-e)/l+2:o=(e-n)/l+4,l/=a<.5?s+r:2-s-r,o*=60):l=a>0&&a<1?0:o,new Gt(o,l,a,t.opacity)}function Gi(t,e,n,i){return arguments.length===1?il(t):new Gt(t,e,n,i??1)}function Gt(t,e,n,i){this.h=+t,this.s=+e,this.l=+n,this.opacity=+i}Ur(Gt,Gi,Xo(ui,{brighter(t){return t=t==null?Wi:Math.pow(Wi,t),new Gt(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?fi:Math.pow(fi,t),new Gt(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,i=n+(n<.5?n:1-n)*e,r=2*n-i;return new Lt(qr(t>=240?t-240:t+120,r,i),qr(t,r,i),qr(t<120?t+240:t-120,r,i),this.opacity)},clamp(){return new Gt(rl(this.h),Ji(this.s),Ji(this.l),Xi(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=Xi(this.opacity);return`${t===1?"hsl(":"hsla("}${rl(this.h)}, ${Ji(this.s)*100}%, ${Ji(this.l)*100}%${t===1?")":`, ${t})`}`}}));function rl(t){return t=(t||0)%360,t<0?t+360:t}function Ji(t){return Math.max(0,Math.min(1,t||0))}function qr(t,e,n){return(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)*255}const Kr=t=>()=>t;function _m(t,e){return function(n){return t+n*e}}function vm(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(i){return Math.pow(t+i*e,n)}}function ym(t){return(t=+t)==1?sl:function(e,n){return n-e?vm(e,n,t):Kr(isNaN(e)?n:e)}}function sl(t,e){var n=e-t;return n?_m(t,n):Kr(isNaN(t)?e:t)}const Qi=function t(e){var n=ym(e);function i(r,s){var o=n((r=Br(r)).r,(s=Br(s)).r),l=n(r.g,s.g),a=n(r.b,s.b),c=sl(r.opacity,s.opacity);return function(u){return r.r=o(u),r.g=l(u),r.b=a(u),r.opacity=c(u),r+""}}return i.gamma=t,i}(1);function bm(t,e){e||(e=[]);var n=t?Math.min(e.length,t.length):0,i=e.slice(),r;return function(s){for(r=0;r<n;++r)i[r]=t[r]*(1-s)+e[r]*s;return i}}function wm(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function Sm(t,e){var n=e?e.length:0,i=t?Math.min(n,t.length):0,r=new Array(i),s=new Array(n),o;for(o=0;o<i;++o)r[o]=Xr(t[o],e[o]);for(;o<n;++o)s[o]=e[o];return function(l){for(o=0;o<i;++o)s[o]=r[o](l);return s}}function km(t,e){var n=new Date;return t=+t,e=+e,function(i){return n.setTime(t*(1-i)+e*i),n}}function Jt(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}function Em(t,e){var n={},i={},r;(t===null||typeof t!="object")&&(t={}),(e===null||typeof e!="object")&&(e={});for(r in e)r in t?n[r]=Xr(t[r],e[r]):i[r]=e[r];return function(s){for(r in n)i[r]=n[r](s);return i}}var Wr=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Yr=new RegExp(Wr.source,"g");function Cm(t){return function(){return t}}function Im(t){return function(e){return t(e)+""}}function ol(t,e){var n=Wr.lastIndex=Yr.lastIndex=0,i,r,s,o=-1,l=[],a=[];for(t=t+"",e=e+"";(i=Wr.exec(t))&&(r=Yr.exec(e));)(s=r.index)>n&&(s=e.slice(n,s),l[o]?l[o]+=s:l[++o]=s),(i=i[0])===(r=r[0])?l[o]?l[o]+=r:l[++o]=r:(l[++o]=null,a.push({i:o,x:Jt(i,r)})),n=Yr.lastIndex;return n<e.length&&(s=e.slice(n),l[o]?l[o]+=s:l[++o]=s),l.length<2?a[0]?Im(a[0].x):Cm(e):(e=a.length,function(c){for(var u=0,h;u<e;++u)l[(h=a[u]).i]=h.x(c);return l.join("")})}function Xr(t,e){var n=typeof e,i;return e==null||n==="boolean"?Kr(e):(n==="number"?Jt:n==="string"?(i=En(e))?(e=i,Qi):ol:e instanceof En?Qi:e instanceof Date?km:wm(e)?bm:Array.isArray(e)?Sm:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?Em:Jt)(t,e)}function xm(t,e){return t=+t,e=+e,function(n){return Math.round(t*(1-n)+e*n)}}var ll=180/Math.PI,Gr={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function al(t,e,n,i,r,s){var o,l,a;return(o=Math.sqrt(t*t+e*e))&&(t/=o,e/=o),(a=t*n+e*i)&&(n-=t*a,i-=e*a),(l=Math.sqrt(n*n+i*i))&&(n/=l,i/=l,a/=l),t*i<e*n&&(t=-t,e=-e,a=-a,o=-o),{translateX:r,translateY:s,rotate:Math.atan2(e,t)*ll,skewX:Math.atan(a)*ll,scaleX:o,scaleY:l}}var Zi;function Mm(t){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?Gr:al(e.a,e.b,e.c,e.d,e.e,e.f)}function Am(t){return t==null||(Zi||(Zi=document.createElementNS("http://www.w3.org/2000/svg","g")),Zi.setAttribute("transform",t),!(t=Zi.transform.baseVal.consolidate()))?Gr:(t=t.matrix,al(t.a,t.b,t.c,t.d,t.e,t.f))}function cl(t,e,n,i){function r(c){return c.length?c.pop()+" ":""}function s(c,u,h,f,d,m){if(c!==h||u!==f){var p=d.push("translate(",null,e,null,n);m.push({i:p-4,x:Jt(c,h)},{i:p-2,x:Jt(u,f)})}else(h||f)&&d.push("translate("+h+e+f+n)}function o(c,u,h,f){c!==u?(c-u>180?u+=360:u-c>180&&(c+=360),f.push({i:h.push(r(h)+"rotate(",null,i)-2,x:Jt(c,u)})):u&&h.push(r(h)+"rotate("+u+i)}function l(c,u,h,f){c!==u?f.push({i:h.push(r(h)+"skewX(",null,i)-2,x:Jt(c,u)}):u&&h.push(r(h)+"skewX("+u+i)}function a(c,u,h,f,d,m){if(c!==h||u!==f){var p=d.push(r(d)+"scale(",null,",",null,")");m.push({i:p-4,x:Jt(c,h)},{i:p-2,x:Jt(u,f)})}else(h!==1||f!==1)&&d.push(r(d)+"scale("+h+","+f+")")}return function(c,u){var h=[],f=[];return c=t(c),u=t(u),s(c.translateX,c.translateY,u.translateX,u.translateY,h,f),o(c.rotate,u.rotate,h,f),l(c.skewX,u.skewX,h,f),a(c.scaleX,c.scaleY,u.scaleX,u.scaleY,h,f),c=u=null,function(d){for(var m=-1,p=f.length,g;++m<p;)h[(g=f[m]).i]=g.x(d);return h.join("")}}}var Tm=cl(Mm,"px, ","px)","deg)"),Nm=cl(Am,", ",")",")"),Pm=1e-12;function ul(t){return((t=Math.exp(t))+1/t)/2}function Om(t){return((t=Math.exp(t))-1/t)/2}function Lm(t){return((t=Math.exp(2*t))-1)/(t+1)}const Dm=function t(e,n,i){function r(s,o){var l=s[0],a=s[1],c=s[2],u=o[0],h=o[1],f=o[2],d=u-l,m=h-a,p=d*d+m*m,g,_;if(p<Pm)_=Math.log(f/c)/e,g=function(M){return[l+M*d,a+M*m,c*Math.exp(e*M*_)]};else{var k=Math.sqrt(p),C=(f*f-c*c+i*p)/(2*c*n*k),w=(f*f-c*c-i*p)/(2*f*n*k),S=Math.log(Math.sqrt(C*C+1)-C),N=Math.log(Math.sqrt(w*w+1)-w);_=(N-S)/e,g=function(M){var E=M*_,I=ul(S),O=c/(n*k)*(I*Lm(e*E+S)-Om(S));return[l+O*d,a+O*m,c*I/ul(e*E+S)]}}return g.duration=_*1e3*e/Math.SQRT2,g}return r.rho=function(s){var o=Math.max(.001,+s),l=o*o,a=l*l;return t(o,l,a)},r}(Math.SQRT2,2,4);var Yn=0,hi=0,mi=0,fl=1e3,er,pi,tr=0,xn=0,nr=0,gi=typeof performance=="object"&&performance.now?performance:Date,dl=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function Jr(){return xn||(dl(Rm),xn=gi.now()+nr)}function Rm(){xn=0}function ir(){this._call=this._time=this._next=null}ir.prototype=Qr.prototype={constructor:ir,restart:function(t,e,n){if(typeof t!="function")throw new TypeError("callback is not a function");n=(n==null?Jr():+n)+(e==null?0:+e),!this._next&&pi!==this&&(pi?pi._next=this:er=this,pi=this),this._call=t,this._time=n,Zr()},stop:function(){this._call&&(this._call=null,this._time=1/0,Zr())}};function Qr(t,e,n){var i=new ir;return i.restart(t,e,n),i}function $m(){Jr(),++Yn;for(var t=er,e;t;)(e=xn-t._time)>=0&&t._call.call(void 0,e),t=t._next;--Yn}function hl(){xn=(tr=gi.now())+nr,Yn=hi=0;try{$m()}finally{Yn=0,jm(),xn=0}}function zm(){var t=gi.now(),e=t-tr;e>fl&&(nr-=e,tr=t)}function jm(){for(var t,e=er,n,i=1/0;e;)e._call?(i>e._time&&(i=e._time),t=e,e=e._next):(n=e._next,e._next=null,e=t?t._next=n:er=n);pi=t,Zr(i)}function Zr(t){if(!Yn){hi&&(hi=clearTimeout(hi));var e=t-xn;e>24?(t<1/0&&(hi=setTimeout(hl,t-gi.now()-nr)),mi&&(mi=clearInterval(mi))):(mi||(tr=gi.now(),mi=setInterval(zm,fl)),Yn=1,dl(hl))}}function ml(t,e,n){var i=new ir;return e=e==null?0:+e,i.restart(r=>{i.stop(),t(r+e)},e,n),i}var Fm=li("start","end","cancel","interrupt"),Hm=[],pl=0,gl=1,es=2,rr=3,_l=4,ts=5,sr=6;function or(t,e,n,i,r,s){var o=t.__transition;if(!o)t.__transition={};else if(n in o)return;Vm(t,n,{name:e,index:i,group:r,on:Fm,tween:Hm,time:s.time,delay:s.delay,duration:s.duration,ease:s.ease,timer:null,state:pl})}function ns(t,e){var n=Qt(t,e);if(n.state>pl)throw new Error("too late; already scheduled");return n}function en(t,e){var n=Qt(t,e);if(n.state>rr)throw new Error("too late; already running");return n}function Qt(t,e){var n=t.__transition;if(!n||!(n=n[e]))throw new Error("transition not found");return n}function Vm(t,e,n){var i=t.__transition,r;i[e]=n,n.timer=Qr(s,0,n.time);function s(c){n.state=gl,n.timer.restart(o,n.delay,n.time),n.delay<=c&&o(c-n.delay)}function o(c){var u,h,f,d;if(n.state!==gl)return a();for(u in i)if(d=i[u],d.name===n.name){if(d.state===rr)return ml(o);d.state===_l?(d.state=sr,d.timer.stop(),d.on.call("interrupt",t,t.__data__,d.index,d.group),delete i[u]):+u<e&&(d.state=sr,d.timer.stop(),d.on.call("cancel",t,t.__data__,d.index,d.group),delete i[u])}if(ml(function(){n.state===rr&&(n.state=_l,n.timer.restart(l,n.delay,n.time),l(c))}),n.state=es,n.on.call("start",t,t.__data__,n.index,n.group),n.state===es){for(n.state=rr,r=new Array(f=n.tween.length),u=0,h=-1;u<f;++u)(d=n.tween[u].value.call(t,t.__data__,n.index,n.group))&&(r[++h]=d);r.length=h+1}}function l(c){for(var u=c<n.duration?n.ease.call(null,c/n.duration):(n.timer.restart(a),n.state=ts,1),h=-1,f=r.length;++h<f;)r[h].call(t,u);n.state===ts&&(n.on.call("end",t,t.__data__,n.index,n.group),a())}function a(){n.state=sr,n.timer.stop(),delete i[e];for(var c in i)return;delete t.__transition}}function lr(t,e){var n=t.__transition,i,r,s=!0,o;if(n){e=e==null?null:e+"";for(o in n){if((i=n[o]).name!==e){s=!1;continue}r=i.state>es&&i.state<ts,i.state=sr,i.timer.stop(),i.on.call(r?"interrupt":"cancel",t,t.__data__,i.index,i.group),delete n[o]}s&&delete t.__transition}}function Um(t){return this.each(function(){lr(this,t)})}function Bm(t,e){var n,i;return function(){var r=en(this,t),s=r.tween;if(s!==n){i=n=s;for(var o=0,l=i.length;o<l;++o)if(i[o].name===e){i=i.slice(),i.splice(o,1);break}}r.tween=i}}function qm(t,e,n){var i,r;if(typeof n!="function")throw new Error;return function(){var s=en(this,t),o=s.tween;if(o!==i){r=(i=o).slice();for(var l={name:e,value:n},a=0,c=r.length;a<c;++a)if(r[a].name===e){r[a]=l;break}a===c&&r.push(l)}s.tween=r}}function Km(t,e){var n=this._id;if(t+="",arguments.length<2){for(var i=Qt(this.node(),n).tween,r=0,s=i.length,o;r<s;++r)if((o=i[r]).name===t)return o.value;return null}return this.each((e==null?Bm:qm)(n,t,e))}function is(t,e,n){var i=t._id;return t.each(function(){var r=en(this,i);(r.value||(r.value={}))[e]=n.apply(this,arguments)}),function(r){return Qt(r,i).value[e]}}function vl(t,e){var n;return(typeof e=="number"?Jt:e instanceof En?Qi:(n=En(e))?(e=n,Qi):ol)(t,e)}function Wm(t){return function(){this.removeAttribute(t)}}function Ym(t){return function(){this.removeAttributeNS(t.space,t.local)}}function Xm(t,e,n){var i,r=n+"",s;return function(){var o=this.getAttribute(t);return o===r?null:o===i?s:s=e(i=o,n)}}function Gm(t,e,n){var i,r=n+"",s;return function(){var o=this.getAttributeNS(t.space,t.local);return o===r?null:o===i?s:s=e(i=o,n)}}function Jm(t,e,n){var i,r,s;return function(){var o,l=n(this),a;return l==null?void this.removeAttribute(t):(o=this.getAttribute(t),a=l+"",o===a?null:o===i&&a===r?s:(r=a,s=e(i=o,l)))}}function Qm(t,e,n){var i,r,s;return function(){var o,l=n(this),a;return l==null?void this.removeAttributeNS(t.space,t.local):(o=this.getAttributeNS(t.space,t.local),a=l+"",o===a?null:o===i&&a===r?s:(r=a,s=e(i=o,l)))}}function Zm(t,e){var n=Bi(t),i=n==="transform"?Nm:vl;return this.attrTween(t,typeof e=="function"?(n.local?Qm:Jm)(n,i,is(this,"attr."+t,e)):e==null?(n.local?Ym:Wm)(n):(n.local?Gm:Xm)(n,i,e))}function ep(t,e){return function(n){this.setAttribute(t,e.call(this,n))}}function tp(t,e){return function(n){this.setAttributeNS(t.space,t.local,e.call(this,n))}}function np(t,e){var n,i;function r(){var s=e.apply(this,arguments);return s!==i&&(n=(i=s)&&tp(t,s)),n}return r._value=e,r}function ip(t,e){var n,i;function r(){var s=e.apply(this,arguments);return s!==i&&(n=(i=s)&&ep(t,s)),n}return r._value=e,r}function rp(t,e){var n="attr."+t;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(e==null)return this.tween(n,null);if(typeof e!="function")throw new Error;var i=Bi(t);return this.tween(n,(i.local?np:ip)(i,e))}function sp(t,e){return function(){ns(this,t).delay=+e.apply(this,arguments)}}function op(t,e){return e=+e,function(){ns(this,t).delay=e}}function lp(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?sp:op)(e,t)):Qt(this.node(),e).delay}function ap(t,e){return function(){en(this,t).duration=+e.apply(this,arguments)}}function cp(t,e){return e=+e,function(){en(this,t).duration=e}}function up(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?ap:cp)(e,t)):Qt(this.node(),e).duration}function fp(t,e){if(typeof e!="function")throw new Error;return function(){en(this,t).ease=e}}function dp(t){var e=this._id;return arguments.length?this.each(fp(e,t)):Qt(this.node(),e).ease}function hp(t,e){return function(){var n=e.apply(this,arguments);if(typeof n!="function")throw new Error;en(this,t).ease=n}}function mp(t){if(typeof t!="function")throw new Error;return this.each(hp(this._id,t))}function pp(t){typeof t!="function"&&(t=$o(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var s=e[r],o=s.length,l=i[r]=[],a,c=0;c<o;++c)(a=s[c])&&t.call(a,a.__data__,c,s)&&l.push(a);return new an(i,this._parents,this._name,this._id)}function gp(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,n=t._groups,i=e.length,r=n.length,s=Math.min(i,r),o=new Array(i),l=0;l<s;++l)for(var a=e[l],c=n[l],u=a.length,h=o[l]=new Array(u),f,d=0;d<u;++d)(f=a[d]||c[d])&&(h[d]=f);for(;l<i;++l)o[l]=e[l];return new an(o,this._parents,this._name,this._id)}function _p(t){return(t+"").trim().split(/^|\s+/).every(function(e){var n=e.indexOf(".");return n>=0&&(e=e.slice(0,n)),!e||e==="start"})}function vp(t,e,n){var i,r,s=_p(e)?ns:en;return function(){var o=s(this,t),l=o.on;l!==i&&(r=(i=l).copy()).on(e,n),o.on=r}}function yp(t,e){var n=this._id;return arguments.length<2?Qt(this.node(),n).on.on(t):this.each(vp(n,t,e))}function bp(t){return function(){var e=this.parentNode;for(var n in this.__transition)if(+n!==t)return;e&&e.removeChild(this)}}function wp(){return this.on("end.remove",bp(this._id))}function Sp(t){var e=this._name,n=this._id;typeof t!="function"&&(t=jr(t));for(var i=this._groups,r=i.length,s=new Array(r),o=0;o<r;++o)for(var l=i[o],a=l.length,c=s[o]=new Array(a),u,h,f=0;f<a;++f)(u=l[f])&&(h=t.call(u,u.__data__,f,l))&&("__data__"in u&&(h.__data__=u.__data__),c[f]=h,or(c[f],e,n,f,c,Qt(u,n)));return new an(s,this._parents,e,n)}function kp(t){var e=this._name,n=this._id;typeof t!="function"&&(t=Ro(t));for(var i=this._groups,r=i.length,s=[],o=[],l=0;l<r;++l)for(var a=i[l],c=a.length,u,h=0;h<c;++h)if(u=a[h]){for(var f=t.call(u,u.__data__,h,a),d,m=Qt(u,n),p=0,g=f.length;p<g;++p)(d=f[p])&&or(d,e,n,p,f,m);s.push(f),o.push(u)}return new an(s,o,e,n)}var Ep=ai.prototype.constructor;function Cp(){return new Ep(this._groups,this._parents)}function Ip(t,e){var n,i,r;return function(){var s=qn(this,t),o=(this.style.removeProperty(t),qn(this,t));return s===o?null:s===n&&o===i?r:r=e(n=s,i=o)}}function yl(t){return function(){this.style.removeProperty(t)}}function xp(t,e,n){var i,r=n+"",s;return function(){var o=qn(this,t);return o===r?null:o===i?s:s=e(i=o,n)}}function Mp(t,e,n){var i,r,s;return function(){var o=qn(this,t),l=n(this),a=l+"";return l==null&&(a=l=(this.style.removeProperty(t),qn(this,t))),o===a?null:o===i&&a===r?s:(r=a,s=e(i=o,l))}}function Ap(t,e){var n,i,r,s="style."+e,o="end."+s,l;return function(){var a=en(this,t),c=a.on,u=a.value[s]==null?l||(l=yl(e)):void 0;(c!==n||r!==u)&&(i=(n=c).copy()).on(o,r=u),a.on=i}}function Tp(t,e,n){var i=(t+="")=="transform"?Tm:vl;return e==null?this.styleTween(t,Ip(t,i)).on("end.style."+t,yl(t)):typeof e=="function"?this.styleTween(t,Mp(t,i,is(this,"style."+t,e))).each(Ap(this._id,t)):this.styleTween(t,xp(t,i,e),n).on("end.style."+t,null)}function Np(t,e,n){return function(i){this.style.setProperty(t,e.call(this,i),n)}}function Pp(t,e,n){var i,r;function s(){var o=e.apply(this,arguments);return o!==r&&(i=(r=o)&&Np(t,o,n)),i}return s._value=e,s}function Op(t,e,n){var i="style."+(t+="");if(arguments.length<2)return(i=this.tween(i))&&i._value;if(e==null)return this.tween(i,null);if(typeof e!="function")throw new Error;return this.tween(i,Pp(t,e,n??""))}function Lp(t){return function(){this.textContent=t}}function Dp(t){return function(){var e=t(this);this.textContent=e??""}}function Rp(t){return this.tween("text",typeof t=="function"?Dp(is(this,"text",t)):Lp(t==null?"":t+""))}function $p(t){return function(e){this.textContent=t.call(this,e)}}function zp(t){var e,n;function i(){var r=t.apply(this,arguments);return r!==n&&(e=(n=r)&&$p(r)),e}return i._value=t,i}function jp(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(t==null)return this.tween(e,null);if(typeof t!="function")throw new Error;return this.tween(e,zp(t))}function Fp(){for(var t=this._name,e=this._id,n=bl(),i=this._groups,r=i.length,s=0;s<r;++s)for(var o=i[s],l=o.length,a,c=0;c<l;++c)if(a=o[c]){var u=Qt(a,e);or(a,t,n,c,o,{time:u.time+u.delay+u.duration,delay:0,duration:u.duration,ease:u.ease})}return new an(i,this._parents,t,n)}function Hp(){var t,e,n=this,i=n._id,r=n.size();return new Promise(function(s,o){var l={value:o},a={value:function(){--r===0&&s()}};n.each(function(){var c=en(this,i),u=c.on;u!==t&&(e=(t=u).copy(),e._.cancel.push(l),e._.interrupt.push(l),e._.end.push(a)),c.on=e}),r===0&&s()})}var Vp=0;function an(t,e,n,i){this._groups=t,this._parents=e,this._name=n,this._id=i}function bl(){return++Vp}var cn=ai.prototype;an.prototype={constructor:an,select:Sp,selectAll:kp,selectChild:cn.selectChild,selectChildren:cn.selectChildren,filter:pp,merge:gp,selection:Cp,transition:Fp,call:cn.call,nodes:cn.nodes,node:cn.node,size:cn.size,empty:cn.empty,each:cn.each,on:yp,attr:Zm,attrTween:rp,style:Tp,styleTween:Op,text:Rp,textTween:jp,remove:wp,tween:Km,delay:lp,duration:up,ease:dp,easeVarying:mp,end:Hp,[Symbol.iterator]:cn[Symbol.iterator]};function Up(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}var Bp={time:null,delay:0,duration:250,ease:Up};function qp(t,e){for(var n;!(n=t.__transition)||!(n=n[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return n}function Kp(t){var e,n;t instanceof an?(e=t._id,t=t._name):(e=bl(),(n=Bp).time=Jr(),t=t==null?null:t+"");for(var i=this._groups,r=i.length,s=0;s<r;++s)for(var o=i[s],l=o.length,a,c=0;c<l;++c)(a=o[c])&&or(a,t,e,c,o,n||qp(a,e));return new an(i,this._parents,t,e)}ai.prototype.interrupt=Um,ai.prototype.transition=Kp;function wl(t,e){var n,i=1;t==null&&(t=0),e==null&&(e=0);function r(){var s,o=n.length,l,a=0,c=0;for(s=0;s<o;++s)l=n[s],a+=l.x,c+=l.y;for(a=(a/o-t)*i,c=(c/o-e)*i,s=0;s<o;++s)l=n[s],l.x-=a,l.y-=c}return r.initialize=function(s){n=s},r.x=function(s){return arguments.length?(t=+s,r):t},r.y=function(s){return arguments.length?(e=+s,r):e},r.strength=function(s){return arguments.length?(i=+s,r):i},r}function Wp(t){const e=+this._x.call(null,t),n=+this._y.call(null,t);return Sl(this.cover(e,n),e,n,t)}function Sl(t,e,n,i){if(isNaN(e)||isNaN(n))return t;var r,s=t._root,o={data:i},l=t._x0,a=t._y0,c=t._x1,u=t._y1,h,f,d,m,p,g,_,k;if(!s)return t._root=o,t;for(;s.length;)if((p=e>=(h=(l+c)/2))?l=h:c=h,(g=n>=(f=(a+u)/2))?a=f:u=f,r=s,!(s=s[_=g<<1|p]))return r[_]=o,t;if(d=+t._x.call(null,s.data),m=+t._y.call(null,s.data),e===d&&n===m)return o.next=s,r?r[_]=o:t._root=o,t;do r=r?r[_]=new Array(4):t._root=new Array(4),(p=e>=(h=(l+c)/2))?l=h:c=h,(g=n>=(f=(a+u)/2))?a=f:u=f;while((_=g<<1|p)===(k=(m>=f)<<1|d>=h));return r[k]=s,r[_]=o,t}function Yp(t){var e,n,i=t.length,r,s,o=new Array(i),l=new Array(i),a=1/0,c=1/0,u=-1/0,h=-1/0;for(n=0;n<i;++n)isNaN(r=+this._x.call(null,e=t[n]))||isNaN(s=+this._y.call(null,e))||(o[n]=r,l[n]=s,r<a&&(a=r),r>u&&(u=r),s<c&&(c=s),s>h&&(h=s));if(a>u||c>h)return this;for(this.cover(a,c).cover(u,h),n=0;n<i;++n)Sl(this,o[n],l[n],t[n]);return this}function Xp(t,e){if(isNaN(t=+t)||isNaN(e=+e))return this;var n=this._x0,i=this._y0,r=this._x1,s=this._y1;if(isNaN(n))r=(n=Math.floor(t))+1,s=(i=Math.floor(e))+1;else{for(var o=r-n||1,l=this._root,a,c;n>t||t>=r||i>e||e>=s;)switch(c=(e<i)<<1|t<n,a=new Array(4),a[c]=l,l=a,o*=2,c){case 0:r=n+o,s=i+o;break;case 1:n=r-o,s=i+o;break;case 2:r=n+o,i=s-o;break;case 3:n=r-o,i=s-o;break}this._root&&this._root.length&&(this._root=l)}return this._x0=n,this._y0=i,this._x1=r,this._y1=s,this}function Gp(){var t=[];return this.visit(function(e){if(!e.length)do t.push(e.data);while(e=e.next)}),t}function Jp(t){return arguments.length?this.cover(+t[0][0],+t[0][1]).cover(+t[1][0],+t[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function Tt(t,e,n,i,r){this.node=t,this.x0=e,this.y0=n,this.x1=i,this.y1=r}function Qp(t,e,n){var i,r=this._x0,s=this._y0,o,l,a,c,u=this._x1,h=this._y1,f=[],d=this._root,m,p;for(d&&f.push(new Tt(d,r,s,u,h)),n==null?n=1/0:(r=t-n,s=e-n,u=t+n,h=e+n,n*=n);m=f.pop();)if(!(!(d=m.node)||(o=m.x0)>u||(l=m.y0)>h||(a=m.x1)<r||(c=m.y1)<s))if(d.length){var g=(o+a)/2,_=(l+c)/2;f.push(new Tt(d[3],g,_,a,c),new Tt(d[2],o,_,g,c),new Tt(d[1],g,l,a,_),new Tt(d[0],o,l,g,_)),(p=(e>=_)<<1|t>=g)&&(m=f[f.length-1],f[f.length-1]=f[f.length-1-p],f[f.length-1-p]=m)}else{var k=t-+this._x.call(null,d.data),C=e-+this._y.call(null,d.data),w=k*k+C*C;if(w<n){var S=Math.sqrt(n=w);r=t-S,s=e-S,u=t+S,h=e+S,i=d.data}}return i}function Zp(t){if(isNaN(u=+this._x.call(null,t))||isNaN(h=+this._y.call(null,t)))return this;var e,n=this._root,i,r,s,o=this._x0,l=this._y0,a=this._x1,c=this._y1,u,h,f,d,m,p,g,_;if(!n)return this;if(n.length)for(;;){if((m=u>=(f=(o+a)/2))?o=f:a=f,(p=h>=(d=(l+c)/2))?l=d:c=d,e=n,!(n=n[g=p<<1|m]))return this;if(!n.length)break;(e[g+1&3]||e[g+2&3]||e[g+3&3])&&(i=e,_=g)}for(;n.data!==t;)if(r=n,!(n=n.next))return this;return(s=n.next)&&delete n.next,r?(s?r.next=s:delete r.next,this):e?(s?e[g]=s:delete e[g],(n=e[0]||e[1]||e[2]||e[3])&&n===(e[3]||e[2]||e[1]||e[0])&&!n.length&&(i?i[_]=n:this._root=n),this):(this._root=s,this)}function eg(t){for(var e=0,n=t.length;e<n;++e)this.remove(t[e]);return this}function tg(){return this._root}function ng(){var t=0;return this.visit(function(e){if(!e.length)do++t;while(e=e.next)}),t}function ig(t){var e=[],n,i=this._root,r,s,o,l,a;for(i&&e.push(new Tt(i,this._x0,this._y0,this._x1,this._y1));n=e.pop();)if(!t(i=n.node,s=n.x0,o=n.y0,l=n.x1,a=n.y1)&&i.length){var c=(s+l)/2,u=(o+a)/2;(r=i[3])&&e.push(new Tt(r,c,u,l,a)),(r=i[2])&&e.push(new Tt(r,s,u,c,a)),(r=i[1])&&e.push(new Tt(r,c,o,l,u)),(r=i[0])&&e.push(new Tt(r,s,o,c,u))}return this}function rg(t){var e=[],n=[],i;for(this._root&&e.push(new Tt(this._root,this._x0,this._y0,this._x1,this._y1));i=e.pop();){var r=i.node;if(r.length){var s,o=i.x0,l=i.y0,a=i.x1,c=i.y1,u=(o+a)/2,h=(l+c)/2;(s=r[0])&&e.push(new Tt(s,o,l,u,h)),(s=r[1])&&e.push(new Tt(s,u,l,a,h)),(s=r[2])&&e.push(new Tt(s,o,h,u,c)),(s=r[3])&&e.push(new Tt(s,u,h,a,c))}n.push(i)}for(;i=n.pop();)t(i.node,i.x0,i.y0,i.x1,i.y1);return this}function sg(t){return t[0]}function og(t){return arguments.length?(this._x=t,this):this._x}function lg(t){return t[1]}function ag(t){return arguments.length?(this._y=t,this):this._y}function rs(t,e,n){var i=new ss(e??sg,n??lg,NaN,NaN,NaN,NaN);return t==null?i:i.addAll(t)}function ss(t,e,n,i,r,s){this._x=t,this._y=e,this._x0=n,this._y0=i,this._x1=r,this._y1=s,this._root=void 0}function kl(t){for(var e={data:t.data},n=e;t=t.next;)n=n.next={data:t.data};return e}var Nt=rs.prototype=ss.prototype;Nt.copy=function(){var t=new ss(this._x,this._y,this._x0,this._y0,this._x1,this._y1),e=this._root,n,i;if(!e)return t;if(!e.length)return t._root=kl(e),t;for(n=[{source:e,target:t._root=new Array(4)}];e=n.pop();)for(var r=0;r<4;++r)(i=e.source[r])&&(i.length?n.push({source:i,target:e.target[r]=new Array(4)}):e.target[r]=kl(i));return t},Nt.add=Wp,Nt.addAll=Yp,Nt.cover=Xp,Nt.data=Gp,Nt.extent=Jp,Nt.find=Qp,Nt.remove=Zp,Nt.removeAll=eg,Nt.root=tg,Nt.size=ng,Nt.visit=ig,Nt.visitAfter=rg,Nt.x=og,Nt.y=ag;function Pt(t){return function(){return t}}function bn(t){return(t()-.5)*1e-6}function cg(t){return t.x+t.vx}function ug(t){return t.y+t.vy}function El(t){var e,n,i,r=1,s=1;typeof t!="function"&&(t=Pt(t==null?1:+t));function o(){for(var c,u=e.length,h,f,d,m,p,g,_=0;_<s;++_)for(h=rs(e,cg,ug).visitAfter(l),c=0;c<u;++c)f=e[c],p=n[f.index],g=p*p,d=f.x+f.vx,m=f.y+f.vy,h.visit(k);function k(C,w,S,N,M){var E=C.data,I=C.r,O=p+I;if(E){if(E.index>f.index){var L=d-E.x-E.vx,F=m-E.y-E.vy,z=L*L+F*F;z<O*O&&(L===0&&(L=bn(i),z+=L*L),F===0&&(F=bn(i),z+=F*F),z=(O-(z=Math.sqrt(z)))/z*r,f.vx+=(L*=z)*(O=(I*=I)/(g+I)),f.vy+=(F*=z)*O,E.vx-=L*(O=1-O),E.vy-=F*O)}return}return w>d+O||N<d-O||S>m+O||M<m-O}}function l(c){if(c.data)return c.r=n[c.data.index];for(var u=c.r=0;u<4;++u)c[u]&&c[u].r>c.r&&(c.r=c[u].r)}function a(){if(e){var c,u=e.length,h;for(n=new Array(u),c=0;c<u;++c)h=e[c],n[h.index]=+t(h,c,e)}}return o.initialize=function(c,u){e=c,i=u,a()},o.iterations=function(c){return arguments.length?(s=+c,o):s},o.strength=function(c){return arguments.length?(r=+c,o):r},o.radius=function(c){return arguments.length?(t=typeof c=="function"?c:Pt(+c),a(),o):t},o}function fg(t){return t.index}function Cl(t,e){var n=t.get(e);if(!n)throw new Error("node not found: "+e);return n}function Il(t){var e=fg,n=h,i,r=Pt(30),s,o,l,a,c,u=1;t==null&&(t=[]);function h(g){return 1/Math.min(l[g.source.index],l[g.target.index])}function f(g){for(var _=0,k=t.length;_<u;++_)for(var C=0,w,S,N,M,E,I,O;C<k;++C)w=t[C],S=w.source,N=w.target,M=N.x+N.vx-S.x-S.vx||bn(c),E=N.y+N.vy-S.y-S.vy||bn(c),I=Math.sqrt(M*M+E*E),I=(I-s[C])/I*g*i[C],M*=I,E*=I,N.vx-=M*(O=a[C]),N.vy-=E*O,S.vx+=M*(O=1-O),S.vy+=E*O}function d(){if(o){var g,_=o.length,k=t.length,C=new Map(o.map((S,N)=>[e(S,N,o),S])),w;for(g=0,l=new Array(_);g<k;++g)w=t[g],w.index=g,typeof w.source!="object"&&(w.source=Cl(C,w.source)),typeof w.target!="object"&&(w.target=Cl(C,w.target)),l[w.source.index]=(l[w.source.index]||0)+1,l[w.target.index]=(l[w.target.index]||0)+1;for(g=0,a=new Array(k);g<k;++g)w=t[g],a[g]=l[w.source.index]/(l[w.source.index]+l[w.target.index]);i=new Array(k),m(),s=new Array(k),p()}}function m(){if(o)for(var g=0,_=t.length;g<_;++g)i[g]=+n(t[g],g,t)}function p(){if(o)for(var g=0,_=t.length;g<_;++g)s[g]=+r(t[g],g,t)}return f.initialize=function(g,_){o=g,c=_,d()},f.links=function(g){return arguments.length?(t=g,d(),f):t},f.id=function(g){return arguments.length?(e=g,f):e},f.iterations=function(g){return arguments.length?(u=+g,f):u},f.strength=function(g){return arguments.length?(n=typeof g=="function"?g:Pt(+g),m(),f):n},f.distance=function(g){return arguments.length?(r=typeof g=="function"?g:Pt(+g),p(),f):r},f}const dg=1664525,hg=1013904223,xl=4294967296;function mg(){let t=1;return()=>(t=(dg*t+hg)%xl)/xl}function pg(t){return t.x}function gg(t){return t.y}var _g=10,vg=Math.PI*(3-Math.sqrt(5));function Ml(t){var e,n=1,i=.001,r=1-Math.pow(i,1/300),s=0,o=.6,l=new Map,a=Qr(h),c=li("tick","end"),u=mg();t==null&&(t=[]);function h(){f(),c.call("tick",e),n<i&&(a.stop(),c.call("end",e))}function f(p){var g,_=t.length,k;p===void 0&&(p=1);for(var C=0;C<p;++C)for(n+=(s-n)*r,l.forEach(function(w){w(n)}),g=0;g<_;++g)k=t[g],k.fx==null?k.x+=k.vx*=o:(k.x=k.fx,k.vx=0),k.fy==null?k.y+=k.vy*=o:(k.y=k.fy,k.vy=0);return e}function d(){for(var p=0,g=t.length,_;p<g;++p){if(_=t[p],_.index=p,_.fx!=null&&(_.x=_.fx),_.fy!=null&&(_.y=_.fy),isNaN(_.x)||isNaN(_.y)){var k=_g*Math.sqrt(.5+p),C=p*vg;_.x=k*Math.cos(C),_.y=k*Math.sin(C)}(isNaN(_.vx)||isNaN(_.vy))&&(_.vx=_.vy=0)}}function m(p){return p.initialize&&p.initialize(t,u),p}return d(),e={tick:f,restart:function(){return a.restart(h),e},stop:function(){return a.stop(),e},nodes:function(p){return arguments.length?(t=p,d(),l.forEach(m),e):t},alpha:function(p){return arguments.length?(n=+p,e):n},alphaMin:function(p){return arguments.length?(i=+p,e):i},alphaDecay:function(p){return arguments.length?(r=+p,e):+r},alphaTarget:function(p){return arguments.length?(s=+p,e):s},velocityDecay:function(p){return arguments.length?(o=1-p,e):1-o},randomSource:function(p){return arguments.length?(u=p,l.forEach(m),e):u},force:function(p,g){return arguments.length>1?(g==null?l.delete(p):l.set(p,m(g)),e):l.get(p)},find:function(p,g,_){var k=0,C=t.length,w,S,N,M,E;for(_==null?_=1/0:_*=_,k=0;k<C;++k)M=t[k],w=p-M.x,S=g-M.y,N=w*w+S*S,N<_&&(E=M,_=N);return E},on:function(p,g){return arguments.length>1?(c.on(p,g),e):c.on(p)}}}function Al(){var t,e,n,i,r=Pt(-30),s,o=1,l=1/0,a=.81;function c(d){var m,p=t.length,g=rs(t,pg,gg).visitAfter(h);for(i=d,m=0;m<p;++m)e=t[m],g.visit(f)}function u(){if(t){var d,m=t.length,p;for(s=new Array(m),d=0;d<m;++d)p=t[d],s[p.index]=+r(p,d,t)}}function h(d){var m=0,p,g,_=0,k,C,w;if(d.length){for(k=C=w=0;w<4;++w)(p=d[w])&&(g=Math.abs(p.value))&&(m+=p.value,_+=g,k+=g*p.x,C+=g*p.y);d.x=k/_,d.y=C/_}else{p=d,p.x=p.data.x,p.y=p.data.y;do m+=s[p.data.index];while(p=p.next)}d.value=m}function f(d,m,p,g){if(!d.value)return!0;var _=d.x-e.x,k=d.y-e.y,C=g-m,w=_*_+k*k;if(C*C/a<w)return w<l&&(_===0&&(_=bn(n),w+=_*_),k===0&&(k=bn(n),w+=k*k),w<o&&(w=Math.sqrt(o*w)),e.vx+=_*d.value*i/w,e.vy+=k*d.value*i/w),!0;if(d.length||w>=l)return;(d.data!==e||d.next)&&(_===0&&(_=bn(n),w+=_*_),k===0&&(k=bn(n),w+=k*k),w<o&&(w=Math.sqrt(o*w)));do d.data!==e&&(C=s[d.data.index]*i/w,e.vx+=_*C,e.vy+=k*C);while(d=d.next)}return c.initialize=function(d,m){t=d,n=m,u()},c.strength=function(d){return arguments.length?(r=typeof d=="function"?d:Pt(+d),u(),c):r},c.distanceMin=function(d){return arguments.length?(o=d*d,c):Math.sqrt(o)},c.distanceMax=function(d){return arguments.length?(l=d*d,c):Math.sqrt(l)},c.theta=function(d){return arguments.length?(a=d*d,c):Math.sqrt(a)},c}function Tl(t){var e=Pt(.1),n,i,r;typeof t!="function"&&(t=Pt(t==null?0:+t));function s(l){for(var a=0,c=n.length,u;a<c;++a)u=n[a],u.vx+=(r[a]-u.x)*i[a]*l}function o(){if(n){var l,a=n.length;for(i=new Array(a),r=new Array(a),l=0;l<a;++l)i[l]=isNaN(r[l]=+t(n[l],l,n))?0:+e(n[l],l,n)}}return s.initialize=function(l){n=l,o()},s.strength=function(l){return arguments.length?(e=typeof l=="function"?l:Pt(+l),o(),s):e},s.x=function(l){return arguments.length?(t=typeof l=="function"?l:Pt(+l),o(),s):t},s}function Nl(t){var e=Pt(.1),n,i,r;typeof t!="function"&&(t=Pt(t==null?0:+t));function s(l){for(var a=0,c=n.length,u;a<c;++a)u=n[a],u.vy+=(r[a]-u.y)*i[a]*l}function o(){if(n){var l,a=n.length;for(i=new Array(a),r=new Array(a),l=0;l<a;++l)i[l]=isNaN(r[l]=+t(n[l],l,n))?0:+e(n[l],l,n)}}return s.initialize=function(l){n=l,o()},s.strength=function(l){return arguments.length?(e=typeof l=="function"?l:Pt(+l),o(),s):e},s.y=function(l){return arguments.length?(t=typeof l=="function"?l:Pt(+l),o(),s):t},s}function yg(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)}function ar(t,e){if((n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var n,i=t.slice(0,n);return[i.length>1?i[0]+i.slice(2):i,+t.slice(n+1)]}function Xn(t){return t=ar(Math.abs(t)),t?t[1]:NaN}function bg(t,e){return function(n,i){for(var r=n.length,s=[],o=0,l=t[0],a=0;r>0&&l>0&&(a+l+1>i&&(l=Math.max(1,i-a)),s.push(n.substring(r-=l,r+l)),!((a+=l+1)>i));)l=t[o=(o+1)%t.length];return s.reverse().join(e)}}function wg(t){return function(e){return e.replace(/[0-9]/g,function(n){return t[+n]})}}var Sg=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function cr(t){if(!(e=Sg.exec(t)))throw new Error("invalid format: "+t);var e;return new os({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}cr.prototype=os.prototype;function os(t){this.fill=t.fill===void 0?" ":t.fill+"",this.align=t.align===void 0?">":t.align+"",this.sign=t.sign===void 0?"-":t.sign+"",this.symbol=t.symbol===void 0?"":t.symbol+"",this.zero=!!t.zero,this.width=t.width===void 0?void 0:+t.width,this.comma=!!t.comma,this.precision=t.precision===void 0?void 0:+t.precision,this.trim=!!t.trim,this.type=t.type===void 0?"":t.type+""}os.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function kg(t){e:for(var e=t.length,n=1,i=-1,r;n<e;++n)switch(t[n]){case".":i=r=n;break;case"0":i===0&&(i=n),r=n;break;default:if(!+t[n])break e;i>0&&(i=0);break}return i>0?t.slice(0,i)+t.slice(r+1):t}var Pl;function Eg(t,e){var n=ar(t,e);if(!n)return t+"";var i=n[0],r=n[1],s=r-(Pl=Math.max(-8,Math.min(8,Math.floor(r/3)))*3)+1,o=i.length;return s===o?i:s>o?i+new Array(s-o+1).join("0"):s>0?i.slice(0,s)+"."+i.slice(s):"0."+new Array(1-s).join("0")+ar(t,Math.max(0,e+s-1))[0]}function Ol(t,e){var n=ar(t,e);if(!n)return t+"";var i=n[0],r=n[1];return r<0?"0."+new Array(-r).join("0")+i:i.length>r+1?i.slice(0,r+1)+"."+i.slice(r+1):i+new Array(r-i.length+2).join("0")}const Ll={"%":(t,e)=>(t*100).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:yg,e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>Ol(t*100,e),r:Ol,s:Eg,X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function Dl(t){return t}var Rl=Array.prototype.map,$l=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function Cg(t){var e=t.grouping===void 0||t.thousands===void 0?Dl:bg(Rl.call(t.grouping,Number),t.thousands+""),n=t.currency===void 0?"":t.currency[0]+"",i=t.currency===void 0?"":t.currency[1]+"",r=t.decimal===void 0?".":t.decimal+"",s=t.numerals===void 0?Dl:wg(Rl.call(t.numerals,String)),o=t.percent===void 0?"%":t.percent+"",l=t.minus===void 0?"−":t.minus+"",a=t.nan===void 0?"NaN":t.nan+"";function c(h){h=cr(h);var f=h.fill,d=h.align,m=h.sign,p=h.symbol,g=h.zero,_=h.width,k=h.comma,C=h.precision,w=h.trim,S=h.type;S==="n"?(k=!0,S="g"):Ll[S]||(C===void 0&&(C=12),w=!0,S="g"),(g||f==="0"&&d==="=")&&(g=!0,f="0",d="=");var N=p==="$"?n:p==="#"&&/[boxX]/.test(S)?"0"+S.toLowerCase():"",M=p==="$"?i:/[%p]/.test(S)?o:"",E=Ll[S],I=/[defgprs%]/.test(S);C=C===void 0?6:/[gprs]/.test(S)?Math.max(1,Math.min(21,C)):Math.max(0,Math.min(20,C));function O(L){var F=N,z=M,x,V,P;if(S==="c")z=E(L)+z,L="";else{L=+L;var q=L<0||1/L<0;if(L=isNaN(L)?a:E(Math.abs(L),C),w&&(L=kg(L)),q&&+L==0&&m!=="+"&&(q=!1),F=(q?m==="("?m:l:m==="-"||m==="("?"":m)+F,z=(S==="s"?$l[8+Pl/3]:"")+z+(q&&m==="("?")":""),I){for(x=-1,V=L.length;++x<V;)if(P=L.charCodeAt(x),48>P||P>57){z=(P===46?r+L.slice(x+1):L.slice(x))+z,L=L.slice(0,x);break}}}k&&!g&&(L=e(L,1/0));var W=F.length+L.length+z.length,K=W<_?new Array(_-W+1).join(f):"";switch(k&&g&&(L=e(K+L,K.length?_-z.length:1/0),K=""),d){case"<":L=F+L+z+K;break;case"=":L=F+K+L+z;break;case"^":L=K.slice(0,W=K.length>>1)+F+L+z+K.slice(W);break;default:L=K+F+L+z;break}return s(L)}return O.toString=function(){return h+""},O}function u(h,f){var d=c((h=cr(h),h.type="f",h)),m=Math.max(-8,Math.min(8,Math.floor(Xn(f)/3)))*3,p=Math.pow(10,-m),g=$l[8+m/3];return function(_){return d(p*_)+g}}return{format:c,formatPrefix:u}}var ur,zl,jl;Ig({thousands:",",grouping:[3],currency:["$",""]});function Ig(t){return ur=Cg(t),zl=ur.format,jl=ur.formatPrefix,ur}function xg(t){return Math.max(0,-Xn(Math.abs(t)))}function Mg(t,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Xn(e)/3)))*3-Xn(Math.abs(t)))}function Ag(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,Xn(e)-Xn(t))+1}function ls(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t);break}return this}const Fl=Symbol("implicit");function Hl(){var t=new Io,e=[],n=[],i=Fl;function r(s){let o=t.get(s);if(o===void 0){if(i!==Fl)return i;t.set(s,o=e.push(s)-1)}return n[o%n.length]}return r.domain=function(s){if(!arguments.length)return e.slice();e=[],t=new Io;for(const o of s)t.has(o)||t.set(o,e.push(o)-1);return r},r.range=function(s){return arguments.length?(n=Array.from(s),r):n.slice()},r.unknown=function(s){return arguments.length?(i=s,r):i},r.copy=function(){return Hl(e,n).unknown(i)},ls.apply(r,arguments),r}function Vl(){var t=Hl().unknown(void 0),e=t.domain,n=t.range,i=0,r=1,s,o,l=!1,a=0,c=0,u=.5;delete t.unknown;function h(){var f=e().length,d=r<i,m=d?r:i,p=d?i:r;s=(p-m)/Math.max(1,f-a+c*2),l&&(s=Math.floor(s)),m+=(p-m-s*(f-a))*u,o=s*(1-a),l&&(m=Math.round(m),o=Math.round(o));var g=Hi(f).map(function(_){return m+s*_});return n(d?g.reverse():g)}return t.domain=function(f){return arguments.length?(e(f),h()):e()},t.range=function(f){return arguments.length?([i,r]=f,i=+i,r=+r,h()):[i,r]},t.rangeRound=function(f){return[i,r]=f,i=+i,r=+r,l=!0,h()},t.bandwidth=function(){return o},t.step=function(){return s},t.round=function(f){return arguments.length?(l=!!f,h()):l},t.padding=function(f){return arguments.length?(a=Math.min(1,c=+f),h()):a},t.paddingInner=function(f){return arguments.length?(a=Math.min(1,f),h()):a},t.paddingOuter=function(f){return arguments.length?(c=+f,h()):c},t.align=function(f){return arguments.length?(u=Math.max(0,Math.min(1,f)),h()):u},t.copy=function(){return Vl(e(),[i,r]).round(l).paddingInner(a).paddingOuter(c).align(u)},ls.apply(h(),arguments)}function Tg(t){return function(){return t}}function Ng(t){return+t}var Ul=[0,1];function Gn(t){return t}function as(t,e){return(e-=t=+t)?function(n){return(n-t)/e}:Tg(isNaN(e)?NaN:.5)}function Pg(t,e){var n;return t>e&&(n=t,t=e,e=n),function(i){return Math.max(t,Math.min(e,i))}}function Og(t,e,n){var i=t[0],r=t[1],s=e[0],o=e[1];return r<i?(i=as(r,i),s=n(o,s)):(i=as(i,r),s=n(s,o)),function(l){return s(i(l))}}function Lg(t,e,n){var i=Math.min(t.length,e.length)-1,r=new Array(i),s=new Array(i),o=-1;for(t[i]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++o<i;)r[o]=as(t[o],t[o+1]),s[o]=n(e[o],e[o+1]);return function(l){var a=id(t,l,1,i)-1;return s[a](r[a](l))}}function Dg(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function Rg(){var t=Ul,e=Ul,n=Xr,i,r,s,o=Gn,l,a,c;function u(){var f=Math.min(t.length,e.length);return o!==Gn&&(o=Pg(t[0],t[f-1])),l=f>2?Lg:Og,a=c=null,h}function h(f){return f==null||isNaN(f=+f)?s:(a||(a=l(t.map(i),e,n)))(i(o(f)))}return h.invert=function(f){return o(r((c||(c=l(e,t.map(i),Jt)))(f)))},h.domain=function(f){return arguments.length?(t=Array.from(f,Ng),u()):t.slice()},h.range=function(f){return arguments.length?(e=Array.from(f),u()):e.slice()},h.rangeRound=function(f){return e=Array.from(f),n=xm,u()},h.clamp=function(f){return arguments.length?(o=f?!0:Gn,u()):o!==Gn},h.interpolate=function(f){return arguments.length?(n=f,u()):n},h.unknown=function(f){return arguments.length?(s=f,h):s},function(f,d){return i=f,r=d,u()}}function $g(){return Rg()(Gn,Gn)}function zg(t,e,n,i){var r=fd(t,e,n),s;switch(i=cr(i??",f"),i.type){case"s":{var o=Math.max(Math.abs(t),Math.abs(e));return i.precision==null&&!isNaN(s=Mg(r,o))&&(i.precision=s),jl(i,o)}case"":case"e":case"g":case"p":case"r":{i.precision==null&&!isNaN(s=Ag(r,Math.max(Math.abs(t),Math.abs(e))))&&(i.precision=s-(i.type==="e"));break}case"f":case"%":{i.precision==null&&!isNaN(s=xg(r))&&(i.precision=s-(i.type==="%")*2);break}}return zl(i)}function jg(t){var e=t.domain;return t.ticks=function(n){var i=e();return ud(i[0],i[i.length-1],n??10)},t.tickFormat=function(n,i){var r=e();return zg(r[0],r[r.length-1],n??10,i)},t.nice=function(n){n==null&&(n=10);var i=e(),r=0,s=i.length-1,o=i[r],l=i[s],a,c,u=10;for(l<o&&(c=o,o=l,l=c,c=r,r=s,s=c);u-- >0;){if(c=Rr(o,l,n),c===a)return i[r]=o,i[s]=l,e(i);if(c>0)o=Math.floor(o/c)*c,l=Math.ceil(l/c)*c;else if(c<0)o=Math.ceil(o*c)/c,l=Math.floor(l*c)/c;else break;a=c}return t},t}function _i(){var t=$g();return t.copy=function(){return Dg(t,_i())},ls.apply(t,arguments),jg(t)}const fr=t=>()=>t;function Fg(t,{sourceEvent:e,target:n,transform:i,dispatch:r}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:i,enumerable:!0,configurable:!0},_:{value:r}})}function un(t,e,n){this.k=t,this.x=e,this.y=n}un.prototype={constructor:un,scale:function(t){return t===1?this:new un(this.k*t,this.x,this.y)},translate:function(t,e){return t===0&e===0?this:new un(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var cs=new un(1,0,0);un.prototype;function us(t){t.stopImmediatePropagation()}function vi(t){t.preventDefault(),t.stopImmediatePropagation()}function Hg(t){return(!t.ctrlKey||t.type==="wheel")&&!t.button}function Vg(){var t=this;return t instanceof SVGElement?(t=t.ownerSVGElement||t,t.hasAttribute("viewBox")?(t=t.viewBox.baseVal,[[t.x,t.y],[t.x+t.width,t.y+t.height]]):[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]):[[0,0],[t.clientWidth,t.clientHeight]]}function Bl(){return this.__zoom||cs}function Ug(t){return-t.deltaY*(t.deltaMode===1?.05:t.deltaMode?1:.002)*(t.ctrlKey?10:1)}function Bg(){return navigator.maxTouchPoints||"ontouchstart"in this}function qg(t,e,n){var i=t.invertX(e[0][0])-n[0][0],r=t.invertX(e[1][0])-n[1][0],s=t.invertY(e[0][1])-n[0][1],o=t.invertY(e[1][1])-n[1][1];return t.translate(r>i?(i+r)/2:Math.min(0,i)||Math.max(0,r),o>s?(s+o)/2:Math.min(0,s)||Math.max(0,o))}function ql(){var t=Hg,e=Vg,n=qg,i=Ug,r=Bg,s=[0,1/0],o=[[-1/0,-1/0],[1/0,1/0]],l=250,a=Dm,c=li("start","zoom","end"),u,h,f,d=500,m=150,p=0,g=10;function _(x){x.property("__zoom",Bl).on("wheel.zoom",E,{passive:!1}).on("mousedown.zoom",I).on("dblclick.zoom",O).filter(r).on("touchstart.zoom",L).on("touchmove.zoom",F).on("touchend.zoom touchcancel.zoom",z).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}_.transform=function(x,V,P,q){var W=x.selection?x.selection():x;W.property("__zoom",Bl),x!==W?S(x,V,P,q):W.interrupt().each(function(){N(this,arguments).event(q).start().zoom(null,typeof V=="function"?V.apply(this,arguments):V).end()})},_.scaleBy=function(x,V,P,q){_.scaleTo(x,function(){var W=this.__zoom.k,K=typeof V=="function"?V.apply(this,arguments):V;return W*K},P,q)},_.scaleTo=function(x,V,P,q){_.transform(x,function(){var W=e.apply(this,arguments),K=this.__zoom,oe=P==null?w(W):typeof P=="function"?P.apply(this,arguments):P,ue=K.invert(oe),he=typeof V=="function"?V.apply(this,arguments):V;return n(C(k(K,he),oe,ue),W,o)},P,q)},_.translateBy=function(x,V,P,q){_.transform(x,function(){return n(this.__zoom.translate(typeof V=="function"?V.apply(this,arguments):V,typeof P=="function"?P.apply(this,arguments):P),e.apply(this,arguments),o)},null,q)},_.translateTo=function(x,V,P,q,W){_.transform(x,function(){var K=e.apply(this,arguments),oe=this.__zoom,ue=q==null?w(K):typeof q=="function"?q.apply(this,arguments):q;return n(cs.translate(ue[0],ue[1]).scale(oe.k).translate(typeof V=="function"?-V.apply(this,arguments):-V,typeof P=="function"?-P.apply(this,arguments):-P),K,o)},q,W)};function k(x,V){return V=Math.max(s[0],Math.min(s[1],V)),V===x.k?x:new un(V,x.x,x.y)}function C(x,V,P){var q=V[0]-P[0]*x.k,W=V[1]-P[1]*x.k;return q===x.x&&W===x.y?x:new un(x.k,q,W)}function w(x){return[(+x[0][0]+ +x[1][0])/2,(+x[0][1]+ +x[1][1])/2]}function S(x,V,P,q){x.on("start.zoom",function(){N(this,arguments).event(q).start()}).on("interrupt.zoom end.zoom",function(){N(this,arguments).event(q).end()}).tween("zoom",function(){var W=this,K=arguments,oe=N(W,K).event(q),ue=e.apply(W,K),he=P==null?w(ue):typeof P=="function"?P.apply(W,K):P,ze=Math.max(ue[1][0]-ue[0][0],ue[1][1]-ue[0][1]),fe=W.__zoom,Fe=typeof V=="function"?V.apply(W,K):V,Q=a(fe.invert(he).concat(ze/fe.k),Fe.invert(he).concat(ze/Fe.k));return function(se){if(se===1)se=Fe;else{var J=Q(se),me=ze/J[2];se=new un(me,he[0]-J[0]*me,he[1]-J[1]*me)}oe.zoom(null,se)}})}function N(x,V,P){return!P&&x.__zooming||new M(x,V)}function M(x,V){this.that=x,this.args=V,this.active=0,this.sourceEvent=null,this.extent=e.apply(x,V),this.taps=0}M.prototype={event:function(x){return x&&(this.sourceEvent=x),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(x,V){return this.mouse&&x!=="mouse"&&(this.mouse[1]=V.invert(this.mouse[0])),this.touch0&&x!=="touch"&&(this.touch0[1]=V.invert(this.touch0[0])),this.touch1&&x!=="touch"&&(this.touch1[1]=V.invert(this.touch1[0])),this.that.__zoom=V,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(x){var V=dt(this.that).datum();c.call(x,this.that,new Fg(x,{sourceEvent:this.sourceEvent,target:_,type:x,transform:this.that.__zoom,dispatch:c}),V)}};function E(x,...V){if(!t.apply(this,arguments))return;var P=N(this,V).event(x),q=this.__zoom,W=Math.max(s[0],Math.min(s[1],q.k*Math.pow(2,i.apply(this,arguments)))),K=_t(x);if(P.wheel)(P.mouse[0][0]!==K[0]||P.mouse[0][1]!==K[1])&&(P.mouse[1]=q.invert(P.mouse[0]=K)),clearTimeout(P.wheel);else{if(q.k===W)return;P.mouse=[K,q.invert(K)],lr(this),P.start()}vi(x),P.wheel=setTimeout(oe,m),P.zoom("mouse",n(C(k(q,W),P.mouse[0],P.mouse[1]),P.extent,o));function oe(){P.wheel=null,P.end()}}function I(x,...V){if(f||!t.apply(this,arguments))return;var P=x.currentTarget,q=N(this,V,!0).event(x),W=dt(x.view).on("mousemove.zoom",he,!0).on("mouseup.zoom",ze,!0),K=_t(x,P),oe=x.clientX,ue=x.clientY;Wo(x.view),us(x),q.mouse=[K,this.__zoom.invert(K)],lr(this),q.start();function he(fe){if(vi(fe),!q.moved){var Fe=fe.clientX-oe,Q=fe.clientY-ue;q.moved=Fe*Fe+Q*Q>p}q.event(fe).zoom("mouse",n(C(q.that.__zoom,q.mouse[0]=_t(fe,P),q.mouse[1]),q.extent,o))}function ze(fe){W.on("mousemove.zoom mouseup.zoom",null),Yo(fe.view,q.moved),vi(fe),q.event(fe).end()}}function O(x,...V){if(t.apply(this,arguments)){var P=this.__zoom,q=_t(x.changedTouches?x.changedTouches[0]:x,this),W=P.invert(q),K=P.k*(x.shiftKey?.5:2),oe=n(C(k(P,K),q,W),e.apply(this,V),o);vi(x),l>0?dt(this).transition().duration(l).call(S,oe,q,x):dt(this).call(_.transform,oe,q,x)}}function L(x,...V){if(t.apply(this,arguments)){var P=x.touches,q=P.length,W=N(this,V,x.changedTouches.length===q).event(x),K,oe,ue,he;for(us(x),oe=0;oe<q;++oe)ue=P[oe],he=_t(ue,this),he=[he,this.__zoom.invert(he),ue.identifier],W.touch0?!W.touch1&&W.touch0[2]!==he[2]&&(W.touch1=he,W.taps=0):(W.touch0=he,K=!0,W.taps=1+!!u);u&&(u=clearTimeout(u)),K&&(W.taps<2&&(h=he[0],u=setTimeout(function(){u=null},d)),lr(this),W.start())}}function F(x,...V){if(this.__zooming){var P=N(this,V).event(x),q=x.changedTouches,W=q.length,K,oe,ue,he;for(vi(x),K=0;K<W;++K)oe=q[K],ue=_t(oe,this),P.touch0&&P.touch0[2]===oe.identifier?P.touch0[0]=ue:P.touch1&&P.touch1[2]===oe.identifier&&(P.touch1[0]=ue);if(oe=P.that.__zoom,P.touch1){var ze=P.touch0[0],fe=P.touch0[1],Fe=P.touch1[0],Q=P.touch1[1],se=(se=Fe[0]-ze[0])*se+(se=Fe[1]-ze[1])*se,J=(J=Q[0]-fe[0])*J+(J=Q[1]-fe[1])*J;oe=k(oe,Math.sqrt(se/J)),ue=[(ze[0]+Fe[0])/2,(ze[1]+Fe[1])/2],he=[(fe[0]+Q[0])/2,(fe[1]+Q[1])/2]}else if(P.touch0)ue=P.touch0[0],he=P.touch0[1];else return;P.zoom("touch",n(C(oe,ue,he),P.extent,o))}}function z(x,...V){if(this.__zooming){var P=N(this,V).event(x),q=x.changedTouches,W=q.length,K,oe;for(us(x),f&&clearTimeout(f),f=setTimeout(function(){f=null},d),K=0;K<W;++K)oe=q[K],P.touch0&&P.touch0[2]===oe.identifier?delete P.touch0:P.touch1&&P.touch1[2]===oe.identifier&&delete P.touch1;if(P.touch1&&!P.touch0&&(P.touch0=P.touch1,delete P.touch1),P.touch0)P.touch0[1]=this.__zoom.invert(P.touch0[0]);else if(P.end(),P.taps===2&&(oe=_t(oe,this),Math.hypot(h[0]-oe[0],h[1]-oe[1])<g)){var ue=dt(this).on("dblclick.zoom");ue&&ue.apply(this,arguments)}}}return _.wheelDelta=function(x){return arguments.length?(i=typeof x=="function"?x:fr(+x),_):i},_.filter=function(x){return arguments.length?(t=typeof x=="function"?x:fr(!!x),_):t},_.touchable=function(x){return arguments.length?(r=typeof x=="function"?x:fr(!!x),_):r},_.extent=function(x){return arguments.length?(e=typeof x=="function"?x:fr([[+x[0][0],+x[0][1]],[+x[1][0],+x[1][1]]]),_):e},_.scaleExtent=function(x){return arguments.length?(s[0]=+x[0],s[1]=+x[1],_):[s[0],s[1]]},_.translateExtent=function(x){return arguments.length?(o[0][0]=+x[0][0],o[1][0]=+x[1][0],o[0][1]=+x[0][1],o[1][1]=+x[1][1],_):[[o[0][0],o[0][1]],[o[1][0],o[1][1]]]},_.constrain=function(x){return arguments.length?(n=x,_):n},_.duration=function(x){return arguments.length?(l=+x,_):l},_.interpolate=function(x){return arguments.length?(a=x,_):a},_.on=function(){var x=c.on.apply(c,arguments);return x===c?_:x},_.clickDistance=function(x){return arguments.length?(p=(x=+x)*x,_):Math.sqrt(p)},_.tapDistance=function(x){return arguments.length?(g=+x,_):g},_}function Kg(t,e,n=null,i,r=null){const s=dt(t);s.selectAll("*").remove();const o=s.node(),l=o.getBoundingClientRect();let a=l.width||800,c=l.height||600;const u=a/2,h=c/2,f=s.append("canvas").attr("class","network-canvas").attr("width",a).attr("height",c).style("width",a+"px").style("height",c+"px").style("cursor","default"),d=f.node().getContext("2d",{alpha:!1});let m=cs;const p=new Set,g={current:null};function _(){const L=o.getBoundingClientRect(),F=L.width||800,z=L.height||600;(F!==a||z!==c)&&(a=F,c=z,f.attr("width",a).attr("height",c).style("width",a+"px").style("height",c+"px"),O())}const k=new ResizeObserver(_);k.observe(o);const C=Ml(e).force("link",Il(n).id(L=>L.id).distance(L=>L.distance)).force("charge",Al().strength(-250)).force("center",wl(u,h).strength(.7)).force("collide",El(L=>L.radius+10).strength(.5)).force("x",Tl(u).strength(.025)).force("y",Nl(h).strength(.025)).alphaDecay(.05).velocityDecay(.6);let w=null;C.on("tick",()=>{w||(w=requestAnimationFrame(()=>{O(),w=null}))}),C.tick(100);for(let L=0;L<100;L++)C.tick();C.alphaTarget(0);const S=Wg({canvas:f,nodes:e,transform:()=>m,hoveredNode:g,onSelectionChange:(L,F)=>{p.clear(),L.forEach(x=>p.add(x));const z=Xg(e,L,F);i(z),O()},render:()=>O()}),N=ql().scaleExtent([.1,10]).filter(L=>!S.isSelectionMode()||L.type==="wheel").on("zoom",({transform:L})=>{m=L,O()});f.call(N);const{dragstarted:M,dragged:E,dragended:I}=Yg(f,e,C,()=>m,g,()=>!S.isSelectionMode(),O);S.setupInteractions(f,{start:M,drag:E,end:I});function O(){d.save(),d.fillRect(0,0,a,c),d.translate(m.x,m.y),d.scale(m.k,m.k),d.strokeStyle="#8a8a8a",d.lineWidth=1/m.k,n.forEach(F=>{const z=F.source.x,x=F.source.y,V=F.target.x,P=F.target.y;d.globalAlpha=Math.max(.2,F.strength),d.lineWidth=F.width/m.k,d.beginPath(),d.moveTo(z,x),d.lineTo(V,P),d.stroke()}),d.globalAlpha=1,e.forEach(F=>{const z=p.has(F.id);d.fillStyle=F.color,d.beginPath(),d.arc(F.x,F.y,F.radius,0,2*Math.PI),d.fill(),z&&(d.strokeStyle="#0f2bff",d.lineWidth=3/m.k,d.stroke())});const L=S.getSelectionRect();if(L){d.strokeStyle="#0f2bff",d.fillStyle="rgba(15, 43, 255, 0.2)",d.lineWidth=2/m.k;const F=Math.min(L.x1,L.x2),z=Math.min(L.y1,L.y2),x=Math.abs(L.x2-L.x1),V=Math.abs(L.y2-L.y1);d.fillRect(F,z,x,V),d.strokeRect(F,z,x,V)}d.restore()}return O(),{destroy:()=>{w&&cancelAnimationFrame(w),C.stop(),k.disconnect(),f.remove()},toggleSelectionMode:()=>{const L=S.toggleSelectionMode();return r&&r(L),O(),L}}}function Wg(t){const{canvas:e,nodes:n,transform:i,hoveredNode:r,onSelectionChange:s,render:o}=t,l=new Set,a=[];let c=!1,u=null;function h(){return c=!c,e.style("cursor",c?"crosshair":"default"),c}function f(p){if(l.has(p)){l.delete(p);const g=a.indexOf(p);g>-1&&a.splice(g,1)}else l.add(p),a.push(p);s(l,a)}function d(p,g){const _=i(),k=(p-_.x)/_.k,C=(g-_.y)/_.k;for(let w=n.length-1;w>=0;w--){const S=n[w],N=k-S.x,M=C-S.y;if(Math.sqrt(N*N+M*M)<S.radius)return S}return null}function m(p,g){let _=null;p.on("mousedown",function(k){const[C,w]=_t(k),S=d(C,w);if(c){const N=i(),M=(C-N.x)/N.k,E=(w-N.y)/N.k;u={x1:M,y1:E,x2:M,y2:E},o()}else S&&(_=S,g.start(k,S))}),p.on("mousemove",function(k){const[C,w]=_t(k);if(c){if(u){const S=i(),N=(C-S.x)/S.k,M=(w-S.y)/S.k;u.x2=N,u.y2=M,o()}}else if(_)g.drag(k,_,C,w);else{const S=d(C,w);r.current!==S&&(r.current=S,p.style("cursor",S?"pointer":"default"),o())}}),p.on("mouseup",function(k){if(c){if(u){const C=Math.min(u.x1,u.x2),w=Math.min(u.y1,u.y2),S=Math.max(u.x1,u.x2),N=Math.max(u.y1,u.y2);l.clear(),a.length=0;const M=[];n.forEach(E=>{E.x>=C&&E.x<=S&&E.y>=w&&E.y<=N&&M.push({id:E.id,y:E.y})}),M.sort((E,I)=>E.y-I.y),M.forEach(({id:E})=>{l.add(E),a.push(E)}),s(l,a),u=null,o()}}else if(_)g.end(k,_),_=null;else{const[C,w]=_t(k),S=d(C,w);S&&f(S.id)}})}return{toggleSelectionMode:h,isSelectionMode:()=>c,setupInteractions:m,getSelectionRect:()=>u}}function Yg(t,e,n,i,r,s,o){let l=null;function a(h,f){s()&&(h.active||n.alphaTarget(.3).restart(),l=f,f.fx=f.x,f.fy=f.y)}function c(h,f,d,m){if(!l||!s())return;const p=i();f.fx=(d-p.x)/p.k,f.fy=(m-p.y)/p.k,o()}function u(h,f){!l||!s()||(h.active||n.alphaTarget(0),f.fx=null,f.fy=null,l=null)}return{dragstarted:a,dragged:c,dragended:u}}function Xg(t,e,n){const i=new Map(t.map(r=>[r.id,r]));return n.map(r=>i.get(r)).filter(Boolean)}const Kl=8,Gg=1.5,Jg=50,Wl=.5,Qg=800,Zg=600;function e_(t,e,n=null,i=null,r=null){const s=Qg/2,o=Zg/2,a=dt(t).append("svg").attr("class","network-svg"),c=a.append("g"),u=c.append("g").selectAll("line").data(n).join("line").attr("class","link").attr("stroke-width",m=>m.width||Gg).attr("stroke-opacity",m=>Math.max(.2,m.strength||Wl)),h=c.append("g").selectAll("circle").data(e).join("circle").attr("class","node").attr("r",m=>m.radius||Kl).attr("fill",m=>m.color);h.append("title").text(m=>m.label);const f=Ml(e).force("link",Il(n).id(m=>m.id).distance(m=>m.distance||Jg)).force("charge",Al().strength(-250)).force("center",wl(s,o).strength(.7)).force("collide",El(m=>(m.radius||Kl)+10).strength(Wl)).force("x",Tl(s).strength(.025)).force("y",Nl(o).strength(.025));let d=null;if(i){d=t_({svg:a,g:c,nodes:e,onSelectionChange:(_,k)=>{h.classed("selected",w=>_.has(w.id));const C=i_(e,_,k);i(C)}}),a.call(ql().scaleExtent([.1,10]).filter(_=>!d.isSelectionMode()||_.type==="wheel").on("zoom",({transform:_})=>c.attr("transform",_)));const{dragstarted:m,dragged:p,dragended:g}=n_(f,u,h);d.setupNodeClick(h),d.setupDrag(h,{start:m,drag:p,end:g})}return{destroy:()=>{f.stop(),a.remove()},toggleSelectionMode:()=>{if(d){const m=d.toggleSelectionMode();return r&&r(m),m}}}}function t_(t){const{svg:e,g:n,nodes:i,onSelectionChange:r,getNodePosition:s=p=>({x:p.x,y:p.y}),getNodeId:o=p=>p.id}=t,l=new Set,a=[];let c=!1;function u(){return c=!c,e.style("cursor",c?"crosshair":"default"),c}function h(p){if(l.has(p)){l.delete(p);const g=a.indexOf(p);g>-1&&a.splice(g,1)}else l.add(p),a.push(p);r(l,a)}function f(){l.clear(),a.length=0,r(l,a)}let d=null,m=null;return e.on("mousedown",function(p){if(!c)return;p.preventDefault();const[g,_]=_t(p,n.node());d={x:g,y:_},m=n.append("rect").attr("class","selection-rect").attr("x",g).attr("y",_).attr("width",0).attr("height",0)}).on("mousemove",function(p){if(!c||!m)return;const[g,_]=_t(p,n.node()),k=g-d.x,C=_-d.y;m.attr("x",k<0?g:d.x).attr("y",C<0?_:d.y).attr("width",Math.abs(k)).attr("height",Math.abs(C))}).on("mouseup",function(p){if(!c||!m)return;const[g,_]=_t(p,n.node()),k=Math.min(d.x,g),C=Math.min(d.y,_),w=Math.max(d.x,g),S=Math.max(d.y,_);l.clear(),a.length=0;const N=[];i.forEach(M=>{const E=s(M);E.x>=k&&E.x<=w&&E.y>=C&&E.y<=S&&N.push({id:o(M),y:E.y})}),N.sort((M,E)=>M.y-E.y),N.forEach(({id:M})=>{l.add(M),a.push(M)}),r(l,a),m.remove(),m=null,d=null}),{toggleSelectionMode:u,toggleNode:h,clearSelection:f,isSelectionMode:()=>c,getSelectedNodes:()=>l,getSelectionOrder:()=>a,setupNodeClick:p=>{p.on("click",function(g,_){g.stopPropagation(),h(o(_))})},setupDrag:(p,g)=>{p.call(sm().filter(()=>!c).on("start",g.start).on("drag",g.drag).on("end",g.end))}}}function n_(t,e,n){t.on("tick",()=>{e.attr("x1",o=>o.source.x).attr("y1",o=>o.source.y).attr("x2",o=>o.target.x).attr("y2",o=>o.target.y),n.attr("cx",o=>o.x).attr("cy",o=>o.y)});function i(o){o.active||t.alphaTarget(.3).restart(),o.subject.fx=o.subject.x,o.subject.fy=o.subject.y}function r(o){o.subject.fx=o.x,o.subject.fy=o.y}function s(o){o.active||t.alphaTarget(0),o.subject.fx=null,o.subject.fy=null}return{dragstarted:i,dragged:r,dragended:s}}function i_(t,e,n){const i=new Map(t.map(r=>[r.id,r]));return n.map(r=>i.get(r)).filter(Boolean)}const r_="modulepreload",s_=function(t){return"/"+t},Yl={},fs=function(e,n,i){return e()};function ds(t){const{type:e,modelName:n,title:i,extractMeta:r=d=>d}=t,s={id:null,type:e,title:i,selected:{}},o=JSON.parse(localStorage.getItem(e))||s,l=De(o),a=De(!1);function c(d,m=!1){a.set(m),localStorage.setItem(e,JSON.stringify(d))}function u(){l.update(d=>{if(e!=="documentSet")return console.error("Document set management is the only type currently supported for saving."),d;const m=Object.fromEntries(Object.entries(d.selected).map(([g,_])=>[g,Object.keys(_)])),p=d.id?`${d.id}/edit`:"new";return fetch(`${window.location.origin}/${n}/${p}`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":_n},body:JSON.stringify({title:d.title,selection:d,...m})}).then(g=>g.json()).then(g=>{if(!(g!=null&&g.document_set_id))throw new Error("Failed to save");l.update(_=>(_.id=g.document_set_id,_.title=g.document_set_title,c(_,!0),_))}).catch(g=>console.error("Error:",g)),d})}const h=d=>l.update(()=>{const m=d.selection.id?d.selection:{...d.selection,id:d.id};return c(m),m}),f=()=>l.update(()=>{const d={...s,selected:{}};return c(d),d});return{type:e,subscribe:l.subscribe,add:d=>l.update(m=>(m.selected[d.class]={...m.selected[d.class]||{},[d.id]:r(d)},c(m),m)),addAll:d=>l.update(m=>(d.forEach(p=>{m.selected[p.class]={...m.selected[p.class]||{},[p.id]:r(p)}}),c(m),m)),remove:(d,m)=>l.update(p=>{const{[d]:g,..._}=p.selected[m];return p.selected[m]=_,c(p),p}),removeAll:(d,m)=>l.update(p=>(d.forEach(g=>{var _;return(_=p.selected[m])==null?!0:delete _[g]}),c(p),p)),toggle:d=>l.update(m=>{var p;if((p=m.selected[d.class])!=null&&p[d.id]){const{[d.id]:g,..._}=m.selected[d.class];m.selected[d.class]=_}else m.selected[d.class]={...m.selected[d.class]||{},[d.id]:r(d)};return c(m),m}),toggleSet:d=>{St(l).id===d.id?f():h(d)},empty:()=>l.update(d=>(d.id=null,d.title=i,d.selected={},c(d,!0),d)),updateTitle:d=>l.update(m=>(m.title=d,c(m,!0),m)),save:u,isSaved:a,selection:l,selectionTitle:ut(l,d=>d.title),isSelected:ut(l,d=>m=>{var p;return((p=d.selected[m.class])==null?void 0:p[m.id])||!1}),selected:ut(l,d=>d.selected),nbSelected:ut(l,d=>Object.values(d.selected).reduce((m,p)=>m+Object.keys(p).length,0)),isSetSelected:ut(l,d=>m=>d.id===m.id)}}ds({type:"documentSet",modelName:"document-set",title:U==="en"?"Document set":"Set de documents",extractMeta:t=>({title:t.title,url:t.url})});const o_=ds({type:"regionsSet",modelName:"regions-set",title:U==="en"?"Regions set":"Set de régions",extractMeta:t=>t});function l_(t){const[e,...n]=t.split("_");return n.join("_")}const dr=ds({type:"clusterSet",modelName:"cluster-set",title:U==="en"?"Selected regions":"Régions sélectionnées",extractMeta:t=>({imgRef:t.id,clusterId:t.clusterId,title:t.title,xywh:t.xywh,img:l_(t.id)})});function a_(){const t=`${window.location.origin}${window.location.pathname}`,e=De(1),n=De({}),i=De({}),r=De("");Ar(e,"p");function s(u){r.update(h=>{const f=h===u?"":u;return navigator.clipboard.writeText(f).then(d=>""),f})}const o=(async()=>{try{const u=await fetch(`${t}canvas`);if(!u.ok)return{};const h=await u.json();let f={};return Object.values(h).forEach(d=>{Object.entries(d).forEach(([m,p])=>{f[m]=p})}),n.set(f),h}catch{return{}}})(),l=ut(e,u=>(async()=>{const f=await(await fetch(`${t}canvas?p=${u}`)).json();return i.set(f),f})());function a(u){Tr(u,e,"p")}function c(u){n.update(h=>(delete h[u],{...h})),i.update(h=>{for(const f in h)if(h[f][u]){const{[u]:d,...m}=h[f];return h[f]=m,h}return h})}return{currentPage:e,pageRegions:i,allRegions:n,fetchPages:l,fetchAll:o,handlePageUpdate:a,remove:c,clipBoard:r,copyRef:s}}const Xl=a_(),ob="";function c_(t){let e;return{c(){e=Wt("path"),v(e,"d","M384 336H192c-8.8 0-16-7.2-16-16V64c0-8.8 7.2-16 16-16l140.1 0L400 115.9V320c0 8.8-7.2 16-16 16zM192 384H384c35.3 0 64-28.7 64-64V115.9c0-12.7-5.1-24.9-14.1-33.9L366.1 14.1c-9-9-21.2-14.1-33.9-14.1H192c-35.3 0-64 28.7-64 64V320c0 35.3 28.7 64 64 64zM64 128c-35.3 0-64 28.7-64 64V448c0 35.3 28.7 64 64 64H256c35.3 0 64-28.7 64-64V416H272v32c0 8.8-7.2 16-16 16H64c-8.8 0-16-7.2-16-16V192c0-8.8 7.2-16 16-16H96V128H64z"),v(e,"class","svelte-1829hp2")},m(n,i){$(n,e,i)},d(n){n&&D(e)}}}function u_(t){let e;return{c(){e=Wt("path"),v(e,"d","M208 0H332.1c12.7 0 24.9 5.1 33.9 14.1l67.9 67.9c9 9 14.1 21.2 14.1 33.9V336c0 26.5-21.5 48-48 48H208c-26.5 0-48-21.5-48-48V48c0-26.5 21.5-48 48-48zM48 128h80v64H64V448H256V416h64v48c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V176c0-26.5 21.5-48 48-48z"),v(e,"class","svelte-1829hp2")},m(n,i){$(n,e,i)},d(n){n&&D(e)}}}function f_(t){let e=U==="en"?"Copy ID":"Copier l'ID",n;return{c(){n=re(e)},m(i,r){$(i,n,r)},p:ie,d(i){i&&D(n)}}}function d_(t){let e=U==="en"?"Copied!":"Copié !",n;return{c(){n=re(e)},m(i,r){$(i,n,r)},p:ie,d(i){i&&D(n)}}}function Gl(t){let e,n,i;var r=t[7];function s(o){return{props:{mainImgItem:o[1],compareImgItem:o[14]}}}return r&&(e=xi(r,s(t))),{c(){e&&ve(e.$$.fragment),n=kt()},m(o,l){e&&pe(e,o,l),$(o,n,l),i=!0},p(o,l){const a={};if(l&2&&(a.mainImgItem=o[1]),l&128&&r!==(r=o[7])){if(e){et();const c=e;B(c.$$.fragment,1,0,()=>{ge(c,1)}),tt()}r?(e=xi(r,s(o)),ve(e.$$.fragment),H(e.$$.fragment,1),pe(e,n.parentNode,n)):e=null}else r&&e.$set(a)},i(o){i||(e&&H(e.$$.fragment,o),i=!0)},o(o){e&&B(e.$$.fragment,o),i=!1},d(o){o&&D(n),e&&ge(e,o)}}}function h_(t){let e,n,i,r,s,o,l,a,c,u,h,f,d,m,p,g,_,k,C,w,S,N,M;function E(V,P){return V[8]?u_:c_}let I=E(t),O=I(t);function L(V,P){return V[8]?d_:f_}let F=L(t),z=F(t),x=t[7]&&Gl(t);return{c(){e=b("div"),n=b("figure"),i=b("img"),s=j(),o=b("div"),l=b("span"),u=j(),h=b("div"),f=b("button"),d=Wt("svg"),O.c(),m=j(),p=b("span"),z.c(),_=j(),x&&x.c(),v(i,"class","region-img svelte-1829hp2"),xt(i.src,r=t[9])||v(i,"src",r),v(i,"alt","Extracted region"),v(l,"class","overlay-desc"),v(o,"class","overlay is-center svelte-1829hp2"),v(n,"class",a="image card region-image "+(t[0]?"is-96x96":"")+" svelte-1829hp2"),v(n,"tabindex","-1"),v(n,"style",c=(t[2]==="full"?"height: 100%":`height: ${t[2]}px; min-width: ${t[2]}px`)+"; "+(t[3]?`border: 5px solid ${t[3]};`:"")),v(d,"xmlns","http://www.w3.org/2000/svg"),v(d,"viewBox","0 0 384 512"),v(d,"class","svelte-1829hp2"),v(p,"class","tooltip svelte-1829hp2"),v(f,"class","button tag svelte-1829hp2"),v(f,"style",g=t[6]?"":"display: none;"),v(h,"class","region-btn ml-1 svelte-1829hp2"),v(e,"class",k="region is-center "+(t[5]&&t[11](t[1])?"checked":"")+" svelte-1829hp2"),v(e,"style",C=t[2]==="full"?"height: 100%":"")},m(V,P){$(V,e,P),y(e,n),y(n,i),y(n,s),y(n,o),y(o,l),l.innerHTML=t[10],y(e,u),y(e,h),y(h,f),y(f,d),O.m(d,null),y(f,m),y(f,p),z.m(p,null),y(h,_),x&&x.m(h,null),S=!0,N||(M=[Ae(n,"click",t[19]),Ae(n,"keyup",m_),Ae(f,"click",t[20])],N=!0)},p(V,[P]){t=V,(!S||P&512&&!xt(i.src,r=t[9]))&&v(i,"src",r),(!S||P&1024)&&(l.innerHTML=t[10]),(!S||P&1&&a!==(a="image card region-image "+(t[0]?"is-96x96":"")+" svelte-1829hp2"))&&v(n,"class",a),(!S||P&12&&c!==(c=(t[2]==="full"?"height: 100%":`height: ${t[2]}px; min-width: ${t[2]}px`)+"; "+(t[3]?`border: 5px solid ${t[3]};`:"")))&&v(n,"style",c),I!==(I=E(t))&&(O.d(1),O=I(t),O&&(O.c(),O.m(d,null))),F===(F=L(t))&&z?z.p(t,P):(z.d(1),z=F(t),z&&(z.c(),z.m(p,null))),(!S||P&64&&g!==(g=t[6]?"":"display: none;"))&&v(f,"style",g),t[7]?x?(x.p(t,P),P&128&&H(x,1)):(x=Gl(t),x.c(),H(x,1),x.m(h,null)):x&&(et(),B(x,1,1,()=>{x=null}),tt()),(!S||P&2082&&k!==(k="region is-center "+(t[5]&&t[11](t[1])?"checked":"")+" svelte-1829hp2"))&&v(e,"class",k),(!S||P&4&&C!==(C=t[2]==="full"?"height: 100%":""))&&v(e,"style",C)},i(V){S||(H(x),Kt(()=>{S&&(w||(w=gn(e,Un,{duration:t[15]},!0)),w.run(1))}),S=!0)},o(V){B(x),w||(w=gn(e,Un,{duration:t[15]},!1)),w.run(0),S=!1},d(V){V&&D(e),O.d(),z.d(),x&&x.d(),V&&w&&w.end(),N=!1,vt(M)}}}const m_=()=>null;function p_(t,e,n){let i,r,s,o,l,{selectionStore:a}=e;a||(a=o_);const{isSelected:c}=a;Me(t,c,I=>n(11,l=I));const{clipBoard:u}=Xl;Me(t,u,I=>n(18,o=I));let{item:h}=e,{descPromise:f=void 0}=e,{isSquare:d=!0}=e,{height:m=d?96:140}=e;m==="full"&&(d=!1);let{borderColor:p=null}=e,{toggleSelection:g=a.toggle}=e;const _=zt("qImgMetadata")||void 0,k=zt("isInModal")||!1,C=k?0:500;let w;k||fs(()=>Promise.resolve().then(()=>_1),void 0).then(I=>n(7,w=I.default));let{selectable:S=!k}=e,{copyable:N=!0}=e;const M=()=>S?g(h):null,E=()=>N?Xl.copyRef(h.ref):null;return t.$$set=I=>{"selectionStore"in I&&n(16,a=I.selectionStore),"item"in I&&n(1,h=I.item),"descPromise"in I&&n(17,f=I.descPromise),"isSquare"in I&&n(0,d=I.isSquare),"height"in I&&n(2,m=I.height),"borderColor"in I&&n(3,p=I.borderColor),"toggleSelection"in I&&n(4,g=I.toggleSelection),"selectable"in I&&n(5,S=I.selectable),"copyable"in I&&n(6,N=I.copyable)},t.$$.update=()=>{t.$$.dirty&2&&n(10,i=h.title),t.$$.dirty&131072&&f&&f.then(I=>n(10,i=I)),t.$$.dirty&7&&n(9,r=jt(h.img??h.ref,h.xywh,m==="full"?m:d?`${m},`:`,${m}`)),t.$$.dirty&262146&&n(8,s=h.ref===o)},[d,h,m,p,g,S,N,w,s,r,i,l,c,u,_,C,a,f,o,M,E]}class Jn extends qe{constructor(e){super(),Be(this,e,p_,h_,je,{selectionStore:16,item:1,descPromise:17,isSquare:0,height:2,borderColor:3,toggleSelection:4,selectable:5,copyable:6})}}const lb="";function Jl(t,e,n){const i=t.slice();return i[11]=e[n],i}function Ql(t,e,n){const i=t.slice();return i[14]=e[n],i}function hs(t){const e=t.slice(),n=e[2].get(e[11][e[14]].id);return e[17]=n,e}function Zl(t,e,n){const i=t.slice();return i[14]=e[n],i}function ea(t){let e,n,i,r,s,o,l,a,c,u,h=t[0].regions,f=[];for(let _=0;_<h.length;_+=1)f[_]=ta(Zl(t,h,_));const d=_=>B(f[_],1,1,()=>{f[_]=null});let m=t[0].rows,p=[];for(let _=0;_<m.length;_+=1)p[_]=ra(Jl(t,m,_));const g=_=>B(p[_],1,1,()=>{p[_]=null});return{c(){e=b("div"),n=b("h3"),n.textContent="Aligned Documents",i=j(),r=b("div"),s=b("table"),o=b("thead"),l=b("tr");for(let _=0;_<f.length;_+=1)f[_].c();a=j(),c=b("tbody");for(let _=0;_<p.length;_+=1)p[_].c();v(n,"class","title is-5"),v(o,"class","region-header svelte-1hxxzoa"),v(s,"class","table is-fullwidth svelte-1hxxzoa"),v(r,"class","table-container svelte-1hxxzoa"),v(e,"class","box mt-4")},m(_,k){$(_,e,k),y(e,n),y(e,i),y(e,r),y(r,s),y(s,o),y(o,l);for(let C=0;C<f.length;C+=1)f[C]&&f[C].m(l,null);y(s,a),y(s,c);for(let C=0;C<p.length;C+=1)p[C]&&p[C].m(c,null);u=!0},p(_,k){if(k&3){h=_[0].regions;let C;for(C=0;C<h.length;C+=1){const w=Zl(_,h,C);f[C]?(f[C].p(w,k),H(f[C],1)):(f[C]=ta(w),f[C].c(),H(f[C],1),f[C].m(l,null))}for(et(),C=h.length;C<f.length;C+=1)d(C);tt()}if(k&77){m=_[0].rows;let C;for(C=0;C<m.length;C+=1){const w=Jl(_,m,C);p[C]?(p[C].p(w,k),H(p[C],1)):(p[C]=ra(w),p[C].c(),H(p[C],1),p[C].m(c,null))}for(et(),C=m.length;C<p.length;C+=1)g(C);tt()}},i(_){if(!u){for(let k=0;k<h.length;k+=1)H(f[k]);for(let k=0;k<m.length;k+=1)H(p[k]);u=!0}},o(_){f=f.filter(Boolean);for(let k=0;k<f.length;k+=1)B(f[k]);p=p.filter(Boolean);for(let k=0;k<p.length;k+=1)B(p[k]);u=!1},d(_){_&&D(e),bt(f,_),bt(p,_)}}}function ta(t){let e,n,i,r;return n=new eo({props:{id:t[14],meta:t[1].get(t[14])||{},clickable:!1}}),{c(){e=b("th"),ve(n.$$.fragment),i=j(),v(e,"class","is-vcentered")},m(s,o){$(s,e,o),pe(n,e,null),y(e,i),r=!0},p(s,o){const l={};o&1&&(l.id=s[14]),o&3&&(l.meta=s[1].get(s[14])||{}),n.$set(l)},i(s){r||(H(n.$$.fragment,s),r=!0)},o(s){B(n.$$.fragment,s),r=!1},d(s){s&&D(e),ge(n)}}}function na(t){let e,n,i,r,s=t[11][t[14]].page+"",o,l;return e=new Jn({props:{item:t[17],selectable:!1,copyable:!1,borderColor:t[6](t[11][t[14]],t[3]),isSquare:!1}}),{c(){ve(e.$$.fragment),n=j(),i=b("div"),r=re("Page "),o=re(s),v(i,"class","has-text-grey-dark mt-2")},m(a,c){pe(e,a,c),$(a,n,c),$(a,i,c),y(i,r),y(i,o),l=!0},p(a,c){const u={};c&5&&(u.item=a[17]),c&9&&(u.borderColor=a[6](a[11][a[14]],a[3])),e.$set(u),(!l||c&1)&&s!==(s=a[11][a[14]].page+"")&&Le(o,s)},i(a){l||(H(e.$$.fragment,a),l=!0)},o(a){B(e.$$.fragment,a),l=!1},d(a){ge(e,a),a&&D(n),a&&D(i)}}}function ia(t){let e,n,i=t[11][t[14]]&&na(hs(t));return{c(){e=b("td"),i&&i.c(),v(e,"class","has-text-centered"),Ue(e,"vertical-align","top")},m(r,s){$(r,e,s),i&&i.m(e,null),n=!0},p(r,s){r[11][r[14]]?i?(i.p(hs(r),s),s&1&&H(i,1)):(i=na(hs(r)),i.c(),H(i,1),i.m(e,null)):i&&(et(),B(i,1,1,()=>{i=null}),tt())},i(r){n||(H(i),n=!0)},o(r){B(i),n=!1},d(r){r&&D(e),i&&i.d()}}}function ra(t){let e,n,i,r=t[0].regions,s=[];for(let l=0;l<r.length;l+=1)s[l]=ia(Ql(t,r,l));const o=l=>B(s[l],1,1,()=>{s[l]=null});return{c(){e=b("tr");for(let l=0;l<s.length;l+=1)s[l].c();n=j()},m(l,a){$(l,e,a);for(let c=0;c<s.length;c+=1)s[c]&&s[c].m(e,null);y(e,n),i=!0},p(l,a){if(a&77){r=l[0].regions;let c;for(c=0;c<r.length;c+=1){const u=Ql(l,r,c);s[c]?(s[c].p(u,a),H(s[c],1)):(s[c]=ia(u),s[c].c(),H(s[c],1),s[c].m(e,n))}for(et(),c=r.length;c<s.length;c+=1)o(c);tt()}},i(l){if(!i){for(let a=0;a<r.length;a+=1)H(s[a]);i=!0}},o(l){s=s.filter(Boolean);for(let a=0;a<s.length;a+=1)B(s[a]);i=!1},d(l){l&&D(e),bt(s,l)}}}function g_(t){let e,n,i=t[0]&&ea(t);return{c(){i&&i.c(),e=kt()},m(r,s){i&&i.m(r,s),$(r,e,s),n=!0},p(r,[s]){r[0]?i?(i.p(r,s),s&1&&H(i,1)):(i=ea(r),i.c(),H(i,1),i.m(e.parentNode,e)):i&&(et(),B(i,1,1,()=>{i=null}),tt())},i(r){n||(H(i),n=!0)},o(r){B(i),n=!1},d(r){i&&i.d(r),r&&D(e)}}}function __(t){let e=0;for(let o=0;o<t.length;o++)e=t.charCodeAt(o)+((e<<5)-e),e=e&e;const i=e*.618033988749895%1*360,r=65+e%20,s=80+e%10;return`hsl(${Math.floor(i)}, ${r}%, ${s}%)`}function v_(t,e,n){let i,r,s,{selectedDocuments:o=[]}=e,{documentSetStore:l}=e;const{buildAlignedImageMatrix:a,documentNodes:c,imageNodes:u}=l;Me(t,c,m=>n(1,r=m)),Me(t,u,m=>n(2,s=m));let h=null;function f(m,p){if(!m)return;const g=m.id;if(p.get(g)!==1)return d.has(g)||d.set(g,__(g)),d.get(g)}const d=new Map;return t.$$set=m=>{"selectedDocuments"in m&&n(7,o=m.selectedDocuments),"documentSetStore"in m&&n(8,l=m.documentSetStore)},t.$$.update=()=>{if(t.$$.dirty&134)if(o.length>0&&s&&r){const m=o.map(p=>p.id);n(0,h=a(m))}else n(0,h=null);t.$$.dirty&1&&n(3,i=h?(()=>{const m=new Map;return h.rows.forEach(p=>{Object.values(p).forEach(g=>{m.set(g.id,(m.get(g.id)||0)+1)})}),m})():new Map)},[h,r,s,i,c,u,f,o,l]}class y_ extends qe{constructor(e){super(),Be(this,e,v_,g_,je,{selectedDocuments:7,documentSetStore:8})}}const ab="";function sa(t,e,n){const i=t.slice();return i[15]=e[n],i}function b_(t){let e;return{c(){e=b("span"),e.innerHTML='<i class="fas fa-crop-alt"></i>',v(e,"class","icon px-4")},m(n,i){$(n,e,i)},d(n){n&&D(e)}}}function w_(t){let e;return{c(){e=b("span"),e.innerHTML='<i class="fas fa-hand-pointer"></i>',v(e,"class","icon px-4")},m(n,i){$(n,e,i)},d(n){n&&D(e)}}}function oa(t){let e,n,i,r;const s=[k_,S_],o=[];function l(a,c){return a[0]==="img"?0:a[0]==="doc"?1:-1}return~(e=l(t))&&(n=o[e]=s[e](t)),{c(){n&&n.c(),i=kt()},m(a,c){~e&&o[e].m(a,c),$(a,i,c),r=!0},p(a,c){let u=e;e=l(a),e===u?~e&&o[e].p(a,c):(n&&(et(),B(o[u],1,1,()=>{o[u]=null}),tt()),~e?(n=o[e],n?n.p(a,c):(n=o[e]=s[e](a),n.c()),H(n,1),n.m(i.parentNode,i)):n=null)},i(a){r||(H(n),r=!0)},o(a){B(n),r=!1},d(a){~e&&o[e].d(a),a&&D(i)}}}function S_(t){let e,n;return e=new y_({props:{selectedDocuments:t[5],documentSetStore:t[1]}}),{c(){ve(e.$$.fragment)},m(i,r){pe(e,i,r),n=!0},p(i,r){const s={};r&32&&(s.selectedDocuments=i[5]),r&2&&(s.documentSetStore=i[1]),e.$set(s)},i(i){n||(H(e.$$.fragment,i),n=!0)},o(i){B(e.$$.fragment,i),n=!1},d(i){ge(e,i)}}}function k_(t){let e,n,i=U==="en"?"Selected regions":"Régions sélectionnées",r,s,o=t[5].length+"",l,a,c,u,h=[],f=new Map,d,m=t[5];const p=g=>g[15].id;for(let g=0;g<m.length;g+=1){let _=sa(t,m,g),k=p(_);f.set(k,h[g]=la(k,_))}return{c(){e=b("div"),n=b("h3"),r=re(i),s=re(" ("),l=re(o),a=re(")"),c=j(),u=b("div");for(let g=0;g<h.length;g+=1)h[g].c();v(n,"class","title is-5"),v(u,"class","selected-nodes grid is-gap-2 mt-5 svelte-1a3kdxu"),v(e,"class","selected-panel box mt-4 svelte-1a3kdxu")},m(g,_){$(g,e,_),y(e,n),y(n,r),y(n,s),y(n,l),y(n,a),y(e,c),y(e,u);for(let k=0;k<h.length;k+=1)h[k]&&h[k].m(u,null);d=!0},p(g,_){(!d||_&32)&&o!==(o=g[5].length+"")&&Le(l,o),_&32&&(m=g[5],et(),h=ii(h,_,p,1,g,m,f,u,Cr,la,null,sa),tt())},i(g){if(!d){for(let _=0;_<m.length;_+=1)H(h[_]);d=!0}},o(g){for(let _=0;_<h.length;_+=1)B(h[_]);d=!1},d(g){g&&D(e);for(let _=0;_<h.length;_+=1)h[_].d()}}}function la(t,e){let n,i,r;return i=new Jn({props:{item:e[15],selectable:!1,copyable:!1}}),{key:t,first:null,c(){n=kt(),ve(i.$$.fragment),this.first=n},m(s,o){$(s,n,o),pe(i,s,o),r=!0},p(s,o){e=s;const l={};o&32&&(l.item=e[15]),i.$set(l)},i(s){r||(H(i.$$.fragment,s),r=!0)},o(s){B(i.$$.fragment,s),r=!1},d(s){s&&D(n),ge(i,s)}}}function E_(t){let e,n,i,r=t[3]?"click":"selection",s,o,l,a,c,u,h,f;function d(_,k){return _[3]?w_:b_}let m=d(t),p=m(t),g=t[5].length>0&&oa(t);return{c(){e=b("div"),n=b("button"),p.c(),i=re(`
        Switch to `),s=re(r),o=re(" mode"),l=j(),a=b("div"),c=j(),g&&g.c(),v(n,"class","toggle-button button is-small is-link mb-3"),v(a,"class","visualization-container")},m(_,k){$(_,e,k),y(e,n),p.m(n,null),y(n,i),y(n,s),y(n,o),y(e,l),y(e,a),t[9](a),y(e,c),g&&g.m(e,null),u=!0,h||(f=Ae(n,"click",t[7]),h=!0)},p(_,[k]){m!==(m=d(_))&&(p.d(1),p=m(_),p&&(p.c(),p.m(n,i))),(!u||k&8)&&r!==(r=_[3]?"click":"selection")&&Le(s,r),_[5].length>0?g?(g.p(_,k),k&32&&H(g,1)):(g=oa(_),g.c(),H(g,1),g.m(e,null)):g&&(et(),B(g,1,1,()=>{g=null}),tt())},i(_){u||(H(g),u=!0)},o(_){B(g),u=!1},d(_){_&&D(e),p.d(),t[9](null),g&&g.d(),h=!1,f()}}}const C_=1e3;function I_(t,e,n){let i,r,s=ie,o=()=>(s(),s=Ei(i,w=>n(8,r=w)),i),l;t.$$.on_destroy.push(()=>s());let{type:a="img"}=e,{documentSetStore:c}=e;const{imageNetwork:u,documentNetwork:h,selectedNodes:f,updateSelectedNodes:d}=c;Me(t,f,w=>n(5,l=w));let m,p,g=!1;function _(){m&&(m.destroy(),d([]));function w(N){d(N)}m=(r.nodes.length<C_?e_:Kg)(p,r.nodes,r.links,w,N=>{n(3,g=N)}),n(3,g=a==="img"),g&&m.toggleSelectionMode()}function k(){m&&n(3,g=m.toggleSelectionMode())}Rn(()=>{m==null||m.destroy()});function C(w){pn[w?"unshift":"push"](()=>{p=w,n(2,p)})}return t.$$set=w=>{"type"in w&&n(0,a=w.type),"documentSetStore"in w&&n(1,c=w.documentSetStore)},t.$$.update=()=>{t.$$.dirty&1&&o(n(4,i=a==="img"?u:h)),t.$$.dirty&260&&r&&p&&_()},[a,c,p,g,i,l,f,k,r,C]}class x_ extends qe{constructor(e){super(),Be(this,e,I_,E_,je,{type:0,documentSetStore:1})}}const cb="",{Map:aa}=Jc;function ca(t,e,n){const i=t.slice();return i[61]=e[n],i}function ua(t,e,n){const i=t.slice();return i[61]=e[n],i}function fa(t,e,n){const i=t.slice();return i[66]=e[n],i}function da(t,e,n){const i=t.slice();return i[66]=e[n],i}function M_(t){let e,n,i,r,s,o,l,a,c,u,h,f,d,m,p,g=t[22]("normalize")+"",_,k,C,w,S,N,M,E=[],I=new aa,O,L,F=[],z=new aa,x,V,P,q,W,K,oe,ue,he,ze,fe,Fe,Q,se,J=t[5].docs;const me=te=>te[66].id;for(let te=0;te<J.length;te+=1){let le=da(t,J,te),Pe=me(le);I.set(Pe,E[te]=ha(Pe,le))}let Y=t[5].docs;const He=te=>te[66].id;for(let te=0;te<Y.length;te+=1){let le=fa(t,Y,te),Pe=He(le);z.set(Pe,F[te]=ma(Pe,le))}let de=t[2]&&pa(t);function Ke(te,le){return te[2]?N_:T_}let Te=Ke(t),Ie=Te(t);return{c(){e=b("div"),n=b("div"),i=b("div"),r=b("h4"),r.textContent=`${t[22]("title")}`,s=j(),o=b("div"),l=b("div"),a=b("div"),c=b("select"),u=b("option"),u.textContent=`${t[22]("byName")}`,h=b("option"),h.textContent=`${t[22]("byScore")}`,f=j(),d=b("label"),m=b("input"),p=j(),_=re(g),k=j(),C=b("div"),w=b("div"),S=b("div"),N=j(),M=b("div");for(let te=0;te<E.length;te+=1)E[te].c();O=j(),L=b("div");for(let te=0;te<F.length;te+=1)F[te].c();x=j(),V=b("div"),P=j(),q=b("div"),W=j(),K=b("div"),oe=b("div"),ue=b("div"),he=b("h4"),he.textContent=`${t[22]("pageByPage")}`,ze=j(),de&&de.c(),fe=j(),Fe=b("div"),Ie.c(),v(r,"class","title is-6 mb-0"),u.__value="name",u.value=u.__value,h.__value="score",h.value=h.__value,t[3]===void 0&&Kt(()=>t[36].call(c)),v(a,"class","select is-small"),v(l,"class","control"),v(m,"type","checkbox"),m.checked=t[8],v(d,"title",t[22]("normalization")),v(d,"class","checkbox is-size-7"),v(o,"class","is-flex is-align-items-center"),Ue(o,"gap","0.5rem"),v(i,"class","is-flex is-justify-content-space-between is-align-items-center mb-3"),Ue(i,"flex-wrap","wrap"),Ue(i,"gap","0.5rem"),v(S,"class","matrix-corner svelte-24wn30"),v(M,"class","col-headers svelte-24wn30"),v(L,"class","row-headers svelte-24wn30"),v(V,"class","matrix-canvas svelte-24wn30"),v(w,"class","matrix-grid svelte-24wn30"),Ue(w,"--cell-size",wa+"px"),v(C,"class","scroll-area svelte-24wn30"),v(n,"class","box panel-box svelte-24wn30"),v(e,"class","split-panel svelte-24wn30"),Ue(e,"width",t[13]+"px"),v(q,"class","split-divider svelte-24wn30"),v(q,"role","separator"),v(q,"tabindex","0"),v(he,"class","title is-6 mb-0"),v(ue,"class","is-flex is-justify-content-space-between is-align-items-center mb-3"),v(Fe,"class","scroll-area svelte-24wn30"),v(oe,"class","box panel-box svelte-24wn30"),v(K,"class","split-panel svelte-24wn30"),Ue(K,"width",t[12]+"px")},m(te,le){$(te,e,le),y(e,n),y(n,i),y(i,r),y(i,s),y(i,o),y(o,l),y(l,a),y(a,c),y(c,u),y(c,h),On(c,t[3],!0),y(o,f),y(o,d),y(d,m),y(d,p),y(d,_),y(n,k),y(n,C),y(C,w),y(w,S),y(w,N),y(w,M);for(let Pe=0;Pe<E.length;Pe+=1)E[Pe]&&E[Pe].m(M,null);y(w,O),y(w,L);for(let Pe=0;Pe<F.length;Pe+=1)F[Pe]&&F[Pe].m(L,null);y(w,x),y(w,V),t[38](V),$(te,P,le),$(te,q,le),$(te,W,le),$(te,K,le),y(K,oe),y(oe,ue),y(ue,he),y(ue,ze),de&&de.m(ue,null),y(oe,fe),y(oe,Fe),Ie.m(Fe,null),Q||(se=[Ae(c,"change",t[36]),Ae(m,"change",t[37]),Ae(q,"mousedown",t[23]),Ae(q,"touchstart",t[23])],Q=!0)},p(te,le){le[0]&8&&On(c,te[3]),le[0]&256&&(m.checked=te[8]),le[0]&32&&(J=te[5].docs,E=ii(E,le,me,1,te,J,I,M,Fs,ha,null,da)),le[0]&32&&(Y=te[5].docs,F=ii(F,le,He,1,te,Y,z,L,Fs,ma,null,fa)),le[0]&8192&&Ue(e,"width",te[13]+"px"),te[2]?de?de.p(te,le):(de=pa(te),de.c(),de.m(ue,null)):de&&(de.d(1),de=null),Te===(Te=Ke(te))&&Ie?Ie.p(te,le):(Ie.d(1),Ie=Te(te),Ie&&(Ie.c(),Ie.m(Fe,null))),le[0]&4096&&Ue(K,"width",te[12]+"px")},d(te){te&&D(e);for(let le=0;le<E.length;le+=1)E[le].d();for(let le=0;le<F.length;le+=1)F[le].d();t[38](null),te&&D(P),te&&D(q),te&&D(W),te&&D(K),de&&de.d(),Ie.d(),Q=!1,vt(se)}}}function A_(t){let e;return{c(){e=b("div"),e.textContent=`${t[22]("noDocuments")}`,v(e,"class","notification is-info"),Ue(e,"width","100%")},m(n,i){$(n,e,i)},p:ie,d(n){n&&D(e)}}}function ha(t,e){let n,i,r,s;return{key:t,first:null,c(){n=b("div"),i=b("span"),s=j(),v(i,"class","color-dot svelte-24wn30"),Ue(i,"background-color",e[66].color),v(i,"title",r=e[66].title),v(n,"class","header-cell svelte-24wn30"),this.first=n},m(o,l){$(o,n,l),y(n,i),y(n,s)},p(o,l){e=o,l[0]&32&&Ue(i,"background-color",e[66].color),l[0]&32&&r!==(r=e[66].title)&&v(i,"title",r)},d(o){o&&D(n)}}}function ma(t,e){let n,i,r,s;return{key:t,first:null,c(){n=b("div"),i=b("span"),s=j(),v(i,"class","color-dot svelte-24wn30"),Ue(i,"background-color",e[66].color),v(i,"title",r=e[66].title),v(n,"class","header-cell svelte-24wn30"),this.first=n},m(o,l){$(o,n,l),y(n,i),y(n,s)},p(o,l){e=o,l[0]&32&&Ue(i,"background-color",e[66].color),l[0]&32&&r!==(r=e[66].title)&&v(i,"title",r)},d(o){o&&D(n)}}}function pa(t){let e,n,i,r,s,o,l,a;return{c(){e=b("div"),n=b("div"),i=b("div"),r=b("select"),s=b("option"),s.textContent=`${t[22]("byPage")}`,o=b("option"),o.textContent=`${t[22]("byImage")}`,s.__value="page",s.value=s.__value,o.__value="image",o.value=o.__value,t[4]===void 0&&Kt(()=>t[39].call(r)),v(i,"class","select is-small"),v(n,"class","control"),v(e,"class","field mb-0")},m(c,u){$(c,e,u),y(e,n),y(n,i),y(i,r),y(r,s),y(r,o),On(r,t[4],!0),l||(a=Ae(r,"change",t[39]),l=!0)},p(c,u){u[0]&16&&On(r,c[4])},d(c){c&&D(e),l=!1,a()}}}function T_(t){let e;return{c(){e=b("p"),e.textContent=`${t[22]("selectCell")}`,v(e,"class","has-text-grey is-size-7")},m(n,i){$(n,e,i)},p:ie,d(n){n&&D(e)}}}function N_(t){let e;return{c(){e=b("div"),v(e,"class","scatter-container svelte-24wn30")},m(n,i){$(n,e,i),t[40](e)},p:ie,d(n){n&&D(e),t[40](null)}}}function ga(t){let e,n,i,r,s,o,l,a=t[11].items,c=[];for(let d=0;d<a.length;d+=1)c[d]=_a(ua(t,a,d));let u=t[11].score!==void 0&&va(t),h=t[11].items,f=[];for(let d=0;d<h.length;d+=1)f[d]=ya(ca(t,h,d));return{c(){e=b("table"),n=b("thead"),i=b("tr");for(let d=0;d<c.length;d+=1)c[d].c();r=j(),s=b("tbody"),u&&u.c(),o=j(),l=b("tr");for(let d=0;d<f.length;d+=1)f[d].c();v(e,"class","table is-fullwidth p-3 has-text-centered")},m(d,m){$(d,e,m),y(e,n),y(n,i);for(let p=0;p<c.length;p+=1)c[p]&&c[p].m(i,null);y(e,r),y(e,s),u&&u.m(s,null),y(s,o),y(s,l);for(let p=0;p<f.length;p+=1)f[p]&&f[p].m(l,null)},p(d,m){if(m[0]&2048){a=d[11].items;let p;for(p=0;p<a.length;p+=1){const g=ua(d,a,p);c[p]?c[p].p(g,m):(c[p]=_a(g),c[p].c(),c[p].m(i,null))}for(;p<c.length;p+=1)c[p].d(1);c.length=a.length}if(d[11].score!==void 0?u?u.p(d,m):(u=va(d),u.c(),u.m(s,o)):u&&(u.d(1),u=null),m[0]&4196352){h=d[11].items;let p;for(p=0;p<h.length;p+=1){const g=ca(d,h,p);f[p]?f[p].p(g,m):(f[p]=ya(g),f[p].c(),f[p].m(l,null))}for(;p<f.length;p+=1)f[p].d(1);f.length=h.length}},d(d){d&&D(e),bt(c,d),u&&u.d(),bt(f,d)}}}function _a(t){let e,n,i,r,s,o=t[61].doc.title+"",l,a;return{c(){e=b("th"),n=b("span"),i=re("●"),r=j(),s=b("strong"),l=re(o),a=j(),Ue(n,"color",t[61].doc.color),v(e,"class","doc-title svelte-24wn30")},m(c,u){$(c,e,u),y(e,n),y(n,i),y(e,r),y(e,s),y(s,l),y(e,a)},p(c,u){u[0]&2048&&Ue(n,"color",c[61].doc.color),u[0]&2048&&o!==(o=c[61].doc.title+"")&&Le(l,o)},d(c){c&&D(e)}}}function va(t){let e,n,i,r=t[22]("score")+"",s,o,l,a=t[11].score.toFixed(2)+"",c;return{c(){e=b("tr"),n=b("td"),i=b("span"),s=re(r),o=j(),l=b("b"),c=re(a),v(i,"class","tag is-small"),v(n,"colspan","2"),v(n,"class","has-text-centered")},m(u,h){$(u,e,h),y(e,n),y(n,i),y(i,s),y(i,o),y(i,l),y(l,c)},p(u,h){h[0]&2048&&a!==(a=u[11].score.toFixed(2)+"")&&Le(c,a)},d(u){u&&D(e)}}}function ya(t){let e,n,i=t[22]("page")+"",r,s,o=t[61].label+"",l,a,c,u,h,f,d;return{c(){e=b("td"),n=b("p"),r=re(i),s=j(),l=re(o),a=j(),c=b("figure"),u=b("img"),d=j(),v(n,"class","is-size-7 has-text-grey mb-3"),xt(u.src,h=t[61].imgUrl)||v(u,"src",h),v(u,"alt",f="Page "+t[61].label),Ue(u,"border-radius","5px"),v(c,"class","image")},m(m,p){$(m,e,p),y(e,n),y(n,r),y(n,s),y(n,l),y(e,a),y(e,c),y(c,u),y(e,d)},p(m,p){p[0]&2048&&o!==(o=m[61].label+"")&&Le(l,o),p[0]&2048&&!xt(u.src,h=m[61].imgUrl)&&v(u,"src",h),p[0]&2048&&f!==(f="Page "+m[61].label)&&v(u,"alt",f)},d(m){m&&D(e)}}}function P_(t){let e,n,i,r,s,o,l,a,c,u,h,f,d,m,p,g,_,k,C,w;function S(I,O){return I[6].length?M_:A_}let N=S(t),M=N(t),E=t[11]&&ga(t);return{c(){e=b("div"),n=b("label"),n.textContent=`${t[22]("filtering")}`,i=j(),r=b("div"),s=b("div"),o=b("select"),l=b("option"),l.textContent=`${t[22]("allPairs")}`,a=b("option"),a.textContent=`${t[22]("filteredPairs")}`,c=j(),u=b("div"),M.c(),h=j(),f=b("div"),d=b("div"),m=j(),p=b("div"),g=b("div"),E&&E.c(),_=j(),k=b("button"),v(n,"class","label is-small"),v(n,"for","matrix-mode"),l.__value="all",l.value=l.__value,a.__value="filtered",a.value=a.__value,v(o,"id","matrix-mode"),t[7]===void 0&&Kt(()=>t[35].call(o)),v(s,"class","select is-small is-fullwidth"),v(r,"class","control"),v(e,"class","field mb-4"),v(u,"class","split-container svelte-24wn30"),v(d,"class","modal-background"),v(g,"class","box p-5"),v(p,"class","modal-content"),Ue(p,"width","auto"),Ue(p,"max-width","70vw"),v(k,"class","modal-close is-large"),v(k,"aria-label","close"),v(f,"id","matrix-page-modal"),v(f,"class","modal")},m(I,O){$(I,e,O),y(e,n),y(e,i),y(e,r),y(r,s),y(s,o),y(o,l),y(o,a),On(o,t[7],!0),$(I,c,O),$(I,u,O),M.m(u,null),t[41](u),$(I,h,O),$(I,f,O),y(f,d),y(f,m),y(f,p),y(p,g),E&&E.m(g,null),y(f,_),y(f,k),t[42](f),C||(w=[Ae(o,"change",t[35]),ei(Pr.call(null,f))],C=!0)},p(I,O){O[0]&128&&On(o,I[7]),N===(N=S(I))&&M?M.p(I,O):(M.d(1),M=N(I),M&&(M.c(),M.m(u,null))),I[11]?E?E.p(I,O):(E=ga(I),E.c(),E.m(g,null)):E&&(E.d(1),E=null)},i:ie,o:ie,d(I){I&&D(e),I&&D(c),I&&D(u),M.d(),t[41](null),I&&D(h),I&&D(f),E&&E.d(),t[42](null),C=!1,vt(w)}}}const ba=300,wa=30,at=5;function O_(t,e,n){const i=new Map;let r=1/0,s=-1/0;for(const l of n){const[a,c,u]=l.regions_id_1===t.id?[l.page_1,l.page_2,l.weightedScore||0]:[l.page_2,l.page_1,l.weightedScore||0],h=`${a}-${c}`;i.has(h)||i.set(h,{page1:a,page2:c,scores:[]}),i.get(h).scores.push(u),u<r&&(r=u),u>s&&(s=u)}return{mode:"page",points:Array.from(i.values()).map(({page1:l,page2:a,scores:c})=>({page1:l,page2:a,score:c.reduce((u,h)=>u+h,0)/c.length,count:c.length})),minScore:r,maxScore:s,doc1:t,doc2:e}}function Sa(t){return[...t].sort((e,n)=>{var s,o;if(e.canvas!==n.canvas)return e.canvas-n.canvas;const i=parseInt(((s=e.xywh)==null?void 0:s[1])||0),r=parseInt(((o=n.xywh)==null?void 0:o[1])||0);return i-r})}function L_(t,e,n){const i=Sa(t.images||[]),r=Sa(e.images||[]);if(!i.length||!r.length)return null;const s=new Map(i.map((u,h)=>[u.id,h])),o=new Map(r.map((u,h)=>[u.id,h])),l=new Map;let a=1/0,c=-1/0;return n.forEach(u=>{const[h,f,d]=u.regions_id_1===t.id?[u.id_1,u.id_2,u.weightedScore||0]:[u.id_2,u.id_1,u.weightedScore||0],m=s.get(h),p=o.get(f);if(m!==void 0&&p!==void 0){const g=`${m}-${p}`;l.set(g,{idx1:m,idx2:p,imgId1:h,imgId2:f,score:d}),d<a&&(a=d),d>c&&(c=d)}}),{mode:"image",images1:i,images2:r,pairScores:l,minScore:a,maxScore:c,doc1:t,doc2:e}}function ka(t){const e=[];let n=null,i=0;return t.forEach((r,s)=>{r.canvas!==n&&(n!==null&&e.push({start:i,end:s,page:n,count:s-i}),n=r.canvas,i=s)}),n!==null&&e.push({start:i,end:t.length,page:n,count:t.length-i}),e}function D_(t,e,n){let i,r,s,o,l,a,c,u,h,f,d,m,p,g,{documentSetStore:_}=e;const{documentNodes:k,pairIndex:C,activeDocPairStats:w,activeDocStats:S,pageCountMap:N,visiblePairIds:M,matrixMode:E,normalizeByPages:I}=_;Me(t,k,X=>n(34,g=X)),Me(t,C,X=>n(45,c=X)),Me(t,w,X=>n(33,p=X)),Me(t,S,X=>n(32,m=X)),Me(t,N,X=>n(31,f=X)),Me(t,M,X=>n(30,u=X)),Me(t,E,X=>n(7,h=X)),Me(t,I,X=>n(8,d=X));const O={title:{en:"Document Matrix",fr:"Matrice de documents"},order:{en:"Order",fr:"Ordre"},byName:{en:"By name",fr:"Par nom"},byScore:{en:"By score",fr:"Par score"},noDocuments:{en:"No documents available",fr:"Aucun document disponible"},pageByPage:{en:"Page-by-page similarity",fr:"Similarité page par page"},page:{en:"page",fr:"page"},score:{en:"Score",fr:"Score"},noPairs:{en:"No pairs",fr:"Aucune paire"},selectCell:{en:"Click a cell to view page-by-page similarity",fr:"Cliquez sur une cellule pour voir la similarité page par page"},byPage:{en:"By page",fr:"Par page"},byImage:{en:"By image",fr:"Par image"},image:{en:"image",fr:"image"},normalize:{en:"Normalize",fr:"Normaliser"},normalization:{en:"Normalization by document page counts",fr:"Normalisation par le nombre de pages des documents"},allPairs:{en:"All pairs in the document set",fr:"Toutes les paires du corpus"},filteredPairs:{en:"Filtered pairs",fr:"Paires après filtrage"},filtering:{en:"Source of image pairs for the visualizations",fr:"Source des paires d’images pour les visualisations"}},L=X=>{var we,Re;return((we=O[X])==null?void 0:we[U])||((Re=O[X])==null?void 0:Re.en)||X};let F,z,x,V,P=null,q="name",W=.5,K=!1,oe=0,ue,he=null,ze=null,fe="page";function Fe(X,we,Re,Se,rt,We){var ft;if(!X.length)return{docs:[],matrix:[],maxScore:0};X.forEach((st,Z)=>{var ye;st.index=Z,st.count=((ye=Re==null?void 0:Re.get(st.id))==null?void 0:ye.count)||0});const Ye={name:Hi(X.length).sort((st,Z)=>X[st].title.localeCompare(X[Z].title)),score:Hi(X.length).sort((st,Z)=>X[Z].count-X[st].count)}[Se].map(st=>X[st]),Qe=Ye.length,Oe=[];let xe=0;for(let st=0;st<Qe;st++){const Z=[];for(let ye=0;ye<Qe;ye++)if(st!==ye){const Ve=Ye[st].id<Ye[ye].id?`${Ye[st].id}-${Ye[ye].id}`:`${Ye[ye].id}-${Ye[st].id}`;let yt=((ft=we==null?void 0:we.get(Ve))==null?void 0:ft.score)||0;if(rt&&yt>0){const A=We.get(Ye[st].id)||1,T=We.get(Ye[ye].id)||1;yt/=Math.sqrt(A*T)}yt>xe&&(xe=yt),Z.push({x:ye,y:st,z:yt,doc1:Ye[st],doc2:Ye[ye]})}else Z.push({x:ye,y:st,z:0,diagonal:!0});Oe.push(Z)}return{docs:Ye,matrix:Oe,maxScore:xe}}function Q(X,we,Re,Se){const{doc1:rt,doc2:We}=X,ot=rt.id<We.id?`${rt.id}-${We.id}`:`${We.id}-${rt.id}`;let Ye=c.byDocPair.get(ot)||[];return Re&&Se.size>0&&(Ye=Ye.filter(Qe=>Se.has(`${Qe.id_1}-${Qe.id_2}`))),Ye.length?we==="image"?L_(rt,We,Ye):O_(rt,We,Ye):null}function se(){if(!z||!r.docs.length)return;const{docs:X,matrix:we,maxScore:Re}=r,Se=X.length*wa;dt(z).selectAll("*").remove();const rt=dt(z).append("svg").attr("width",Se).attr("height",Se),We=Vl().range([0,Se]).domain(Hi(X.length)).padding(.02),ot=dt("body").selectAll(".matrix-tooltip").data([0]).join("div").attr("class","matrix-tooltip").style("position","fixed").style("background","var(--bulma-scheme-main)").style("border","1px solid var(--bulma-border)").style("border-radius","4px").style("padding","8px").style("pointer-events","none").style("opacity",0).style("font-size","12px").style("box-shadow","0 2px 4px rgba(0,0,0,0.15)").style("z-index","9999").style("color","var(--bulma-text)");rt.selectAll(".row").data(we).join("g").attr("class","row").attr("transform",(Qe,Oe)=>`translate(0,${We(Oe)})`).each(function(Qe){dt(this).selectAll(".cell").data(Qe.filter(Oe=>!Oe.diagonal)).join("rect").attr("class","cell").attr("x",Oe=>We(Oe.x)).attr("width",We.bandwidth()).attr("height",We.bandwidth()).attr("fill",Oe=>{if(Oe.z===0)return"var(--bulma-text)";const xe=Gi(233,.951,.52);return xe.opacity=Re>0?.2+.8*(Oe.z/Re):.2,xe}).attr("stroke",Oe=>J(Oe)?"var(--bulma-text)":"var(--bulma-scheme-main)").attr("stroke-width",Oe=>J(Oe)?2:.5).style("cursor","pointer").on("mouseover",function(Oe,xe){J(xe)||dt(this).attr("stroke","var(--bulma-text)").attr("stroke-width",2),ot.style("opacity",1)}).on("mousemove",function(Oe,xe){const ft=xe.z===0?`<span style="color:${xe.doc1.color}">●</span> ${xe.doc1.title}<br/>↔<br/><span style="color:${xe.doc2.color}">●</span> ${xe.doc2.title}<br/><br/><em>${L("noPairs")}</em>`:`<span style="color:${xe.doc1.color}">●</span> ${xe.doc1.title}<br/>↔<br/><span style="color:${xe.doc2.color}">●</span> ${xe.doc2.title}<br/><br/>${L("score")}: ${xe.z.toFixed(2)}`;ot.html(ft).style("left",Oe.clientX+15+"px").style("top",Oe.clientY+15+"px")}).on("mouseleave",function(Oe,xe){J(xe)||dt(this).attr("stroke","var(--bulma-scheme-main)").attr("stroke-width",.5),ot.style("opacity",0)}).on("click",(Oe,xe)=>{n(2,P={row:xe.y,col:xe.x,doc1:xe.doc1,doc2:xe.doc2}),me()})}),rt.selectAll(".row").selectAll(".cell-diagonal").data(Qe=>Qe.filter(Oe=>Oe.diagonal)).join("rect").attr("class","cell-diagonal").attr("x",Qe=>We(Qe.x)).attr("width",We.bandwidth()).attr("height",We.bandwidth()).attr("fill","var(--contrasted)")}function J(X){return P&&P.doc1.id===X.doc1.id&&P.doc2.id===X.doc2.id}function me(){z&&dt(z).selectAll(".cell").attr("stroke",X=>J(X)?"var(--bulma-text)":"var(--bulma-scheme-main)").attr("stroke-width",X=>J(X)?2:.5)}function Y(){!x||!s||(dt(x).selectAll("*").remove(),s.mode==="image"?de():He())}function He(){const{points:X,minScore:we,maxScore:Re,doc1:Se,doc2:rt}=s;if(!X.length)return;const We={top:65,right:40,bottom:20,left:80},ot=10,Ye=Math.max(...X.map(ce=>ce.page1)),Qe=Math.max(...X.map(ce=>ce.page2)),Oe=Ye*at,xe=Qe*at,ft=new Map(X.map(ce=>[`${ce.page1}-${ce.page2}`,ce])),st=Oe+We.left+We.right,Z=xe+We.top+We.bottom,Ve=dt(x).append("svg").attr("width",st).attr("height",Z).append("g").attr("transform",`translate(${We.left},${We.top})`),yt=_i().domain([0,Ye]).range([0,Oe]),A=_i().domain([0,Qe]).range([0,xe]),T=dt("body").selectAll(".scatter-tooltip").data([0]).join("div").attr("class","scatter-tooltip").style("position","fixed").style("background","var(--bulma-scheme-main)").style("border","1px solid var(--bulma-border)").style("border-radius","4px").style("padding","6px 10px").style("pointer-events","none").style("opacity",0).style("font-size","11px").style("box-shadow","0 2px 4px rgba(0,0,0,0.15)").style("z-index","9999").style("color","var(--bulma-text)"),R=new Array(Ye).fill(0),G=new Array(Qe).fill(0);X.forEach(ce=>{R[ce.page1-1]++,G[ce.page2-1]++});const ne=Math.max(...R),ee=Math.max(...G),be=Ve.append("g").attr("transform",`translate(0,${-22-ot})`);R.forEach((ce,_e)=>{ce!==0&&be.append("rect").attr("x",_e*at).attr("width",at).attr("height",ot).attr("fill",Se.color).attr("opacity",.15+.85*(ce/ne)).style("cursor","default").on("mouseover",()=>T.style("opacity",1)).on("mousemove",Ce=>{T.html(`<strong>${ce}</strong> image${ce>1?"s":""}<br/>${L("page")} ${_e+1}`).style("left",Ce.clientX+10+"px").style("top",Ce.clientY-30+"px")}).on("mouseleave",()=>T.style("opacity",0))});const ae=Ve.append("g").attr("transform","translate(-55,0)");G.forEach((ce,_e)=>{ce!==0&&ae.append("rect").attr("x",0).attr("y",_e*at).attr("width",ot).attr("height",at).attr("fill",rt.color).attr("opacity",.15+.85*(ce/ee)).style("cursor","default").on("mouseover",()=>T.style("opacity",1)).on("mousemove",Ce=>{T.html(`<strong>${ce}</strong> image${ce>1?"s":""}<br/>${L("page")} ${_e+1}`).style("left",Ce.clientX+10+"px").style("top",Ce.clientY-30+"px")}).on("mouseleave",()=>T.style("opacity",0))}),Ve.append("g").call(No(yt).ticks(Math.min(Ye,10))),Ve.append("g").call(Po(A).ticks(Math.min(Qe,10)));const nt=(ce,_e)=>{const Ce=Math.floor(_e/6);return ce.length>Ce?ce.slice(0,Ce-1)+"…":ce},ke=Ve.append("g").attr("transform",`translate(${Oe/2},-50)`);ke.append("circle").attr("r",4).attr("cx",-Oe/2+4).attr("fill",Se.color),ke.append("text").attr("x",-Oe/2+14).attr("text-anchor","start").attr("dominant-baseline","middle").attr("font-size","11px").attr("fill","var(--bulma-text)").text(nt(`${Se.title} (${L("page")})`,Oe-20));const Je=Ve.append("g").attr("transform",`translate(-68,${xe/2}) rotate(-90)`);Je.append("circle").attr("r",4).attr("cx",-xe/2+4).attr("fill",rt.color),Je.append("text").attr("x",-xe/2+14).attr("text-anchor","start").attr("dominant-baseline","middle").attr("font-size","11px").attr("fill","var(--bulma-text)").text(nt(`${rt.title} (${L("page")})`,xe-20)),Ve.append("rect").attr("class","hover-overlay").attr("width",Oe).attr("height",xe).attr("fill","transparent").style("cursor","pointer").on("mousemove",ce=>{const[_e,Ce]=_t(ce,Ve.node()),it=Math.floor(_e/at)+1,lt=Math.floor(Ce/at)+1;if(it<1||it>Ye||lt<1||lt>Qe){T.style("opacity",0);return}const ct=ft.get(`${it}-${lt}`),mn=`<span style="color:${Se.color}">●</span> ${L("page")} ${it}<br/><span style="color:${rt.color}">●</span> ${L("page")} ${lt}`,Tn=ct?`${mn}<br/>${L("score")}: ${ct.score.toFixed(2)}`:mn;T.style("opacity",1).html(Tn).style("left",ce.clientX+10+"px").style("top",ce.clientY-40+"px")}).on("mouseleave",()=>T.style("opacity",0)).on("click",ce=>{const[_e,Ce]=_t(ce,Ve.node()),it=Math.floor(_e/at)+1,lt=Math.floor(Ce/at)+1;if(it>=1&&it<=Ye&&lt>=1&&lt<=Qe){const ct=ft.get(`${it}-${lt}`);Ke(it,lt,Se,rt,ct==null?void 0:ct.score)}}),Ve.selectAll(".cell").data(X).join("rect").attr("class","cell").attr("x",ce=>(ce.page1-1)*at).attr("y",ce=>(ce.page2-1)*at).attr("width",at).attr("height",at).attr("fill",Gi(233,.951,.52)).attr("opacity",ce=>Re>we?.2+.8*(ce.score-we)/(Re-we):.5).attr("pointer-events","none"),n(1,x.style.width=st+"px",x),n(1,x.style.height=Z+"px",x)}function de(){const{images1:X,images2:we,pairScores:Re,minScore:Se,maxScore:rt,doc1:We,doc2:ot}=s;if(!X.length||!we.length)return;const Ye={top:65,right:40,bottom:20,left:80},Qe=10,Oe=X.length*at,xe=we.length*at,ft=Oe+Ye.left+Ye.right,st=xe+Ye.top+Ye.bottom,ye=dt(x).append("svg").attr("width",ft).attr("height",st).append("g").attr("transform",`translate(${Ye.left},${Ye.top})`),Ve=_i().domain([0,X.length]).range([0,Oe]),yt=_i().domain([0,we.length]).range([0,xe]),A=dt("body").selectAll(".scatter-tooltip").data([0]).join("div").attr("class","scatter-tooltip").style("position","fixed").style("background","var(--bulma-scheme-main)").style("border","1px solid var(--bulma-border)").style("border-radius","4px").style("padding","6px 10px").style("pointer-events","none").style("opacity",0).style("font-size","11px").style("box-shadow","0 2px 4px rgba(0,0,0,0.15)").style("z-index","9999").style("color","var(--bulma-text)"),T=ka(X),R=ka(we),G=ye.append("g").attr("transform",`translate(0,${-22-Qe})`);T.forEach(({start:ke,end:Je,page:ce,count:_e})=>{G.append("rect").attr("x",ke*at).attr("width",(Je-ke)*at).attr("height",Qe).attr("fill",We.color).attr("opacity",.5).style("cursor","default").on("mouseover",()=>A.style("opacity",1)).on("mousemove",Ce=>{A.html(`${L("page")} ${ce}<br/><strong>${_e}</strong> image${_e>1?"s":""}`).style("left",Ce.clientX+10+"px").style("top",Ce.clientY-30+"px")}).on("mouseleave",()=>A.style("opacity",0))});const ne=ye.append("g").attr("transform","translate(-55,0)");R.forEach(({start:ke,end:Je,page:ce,count:_e})=>{ne.append("rect").attr("x",0).attr("y",ke*at).attr("width",Qe).attr("height",(Je-ke)*at).attr("fill",ot.color).attr("opacity",.5).style("cursor","default").on("mouseover",()=>A.style("opacity",1)).on("mousemove",Ce=>{A.html(`${L("page")} ${ce}<br/><strong>${_e}</strong> image${_e>1?"s":""}`).style("left",Ce.clientX+10+"px").style("top",Ce.clientY-30+"px")}).on("mouseleave",()=>A.style("opacity",0))}),ye.append("g").call(No(Ve).ticks(Math.min(X.length,10))),ye.append("g").call(Po(yt).ticks(Math.min(we.length,10)));const ee=(ke,Je)=>{const ce=Math.floor(Je/6);return ke.length>ce?ke.slice(0,ce-1)+"…":ke},be=ye.append("g").attr("transform",`translate(${Oe/2},-50)`);be.append("circle").attr("r",4).attr("cx",-Oe/2+4).attr("fill",We.color),be.append("text").attr("x",-Oe/2+14).attr("text-anchor","start").attr("dominant-baseline","middle").attr("font-size","11px").attr("fill","var(--bulma-text)").text(ee(`${We.title} (${L("image")})`,Oe-20));const ae=ye.append("g").attr("transform",`translate(-68,${xe/2}) rotate(-90)`);ae.append("circle").attr("r",4).attr("cx",-xe/2+4).attr("fill",ot.color),ae.append("text").attr("x",-xe/2+14).attr("text-anchor","start").attr("dominant-baseline","middle").attr("font-size","11px").attr("fill","var(--bulma-text)").text(ee(`${ot.title} (${L("image")})`,xe-20)),ye.append("rect").attr("class","hover-overlay").attr("width",Oe).attr("height",xe).attr("fill","transparent").style("cursor","pointer").on("mousemove",ke=>{const[Je,ce]=_t(ke,ye.node()),_e=Math.floor(Je/at),Ce=Math.floor(ce/at);if(_e<0||_e>=X.length||Ce<0||Ce>=we.length){A.style("opacity",0);return}const it=X[_e],lt=we[Ce],ct=Re.get(`${_e}-${Ce}`),mn=`<span style="color:${We.color}">●</span> ${L("page")} ${it.canvas}, ${L("image")} ${_e+1}<br/><span style="color:${ot.color}">●</span> ${L("page")} ${lt.canvas}, ${L("image")} ${Ce+1}`,Tn=ct?`${mn}<br/>${L("score")}: ${ct.score.toFixed(2)}`:mn;A.style("opacity",1).html(Tn).style("left",ke.clientX+10+"px").style("top",ke.clientY-40+"px")}).on("mouseleave",()=>A.style("opacity",0)).on("click",ke=>{const[Je,ce]=_t(ke,ye.node()),_e=Math.floor(Je/at),Ce=Math.floor(ce/at);if(_e>=0&&_e<X.length&&Ce>=0&&Ce<we.length){const it=Re.get(`${_e}-${Ce}`);Te(X[_e],we[Ce],We,ot,it==null?void 0:it.score)}});const nt=Array.from(Re.values());ye.selectAll(".cell").data(nt).join("rect").attr("class","cell").attr("x",ke=>ke.idx1*at).attr("y",ke=>ke.idx2*at).attr("width",at).attr("height",at).attr("fill",Gi(233,.951,.52)).attr("opacity",ke=>rt>Se?.2+.8*(ke.score-Se)/(rt-Se):.5).attr("pointer-events","none"),n(1,x.style.width=ft+"px",x),n(1,x.style.height=st+"px",x)}function Ke(X,we,Re,Se,rt){n(27,he={page1:X,page2:we,doc1:Re,doc2:Se,score:rt}),n(28,ze=null),V==null||V.classList.add("is-active")}function Te(X,we,Re,Se,rt){n(28,ze={img1:X,img2:we,doc1:Re,doc2:Se,score:rt}),n(27,he=null),V==null||V.classList.add("is-active")}function Ie(X){K=!0,X.preventDefault()}function te(X){var Se,rt;if(!K||!F)return;const we=F.getBoundingClientRect(),Re=(X.clientX||((rt=(Se=X.touches)==null?void 0:Se[0])==null?void 0:rt.clientX))-we.left;n(25,W=Math.max(.2,Math.min(.8,Re/we.width)))}function le(){K=!1}function Pe(X,we){const Re="full";return jt(`wit${X.witnessId}_${X.digitizationRef}_${String(we).padStart(X.zeros,"0")}`,"full",Re)}function ht(X){var we;return jt(X.ref,(we=X.xywh)==null?void 0:we.join(","),"full")}Dn(()=>{F&&(n(26,oe=F.offsetWidth),ue=new ResizeObserver(X=>{n(26,oe=X[0].contentRect.width)}),ue.observe(F)),window.addEventListener("mousemove",te),window.addEventListener("mouseup",le),window.addEventListener("touchmove",te),window.addEventListener("touchend",le)}),Rn(()=>{ue==null||ue.disconnect(),window.removeEventListener("mousemove",te),window.removeEventListener("mouseup",le),window.removeEventListener("touchmove",te),window.removeEventListener("touchend",le)});function gt(){h=yr(this),E.set(h)}function Ot(){q=yr(this),n(3,q)}const mt=X=>I.set(X.target.checked);function Ee(X){pn[X?"unshift":"push"](()=>{z=X,n(0,z)})}function Xe(){fe=yr(this),n(4,fe)}function Ze(X){pn[X?"unshift":"push"](()=>{x=X,n(1,x)})}function $t(X){pn[X?"unshift":"push"](()=>{F=X,n(9,F)})}function It(X){pn[X?"unshift":"push"](()=>{V=X,n(10,V)})}return t.$$set=X=>{"documentSetStore"in X&&n(24,_=X.documentSetStore)},t.$$.update=()=>{t.$$.dirty[1]&8&&n(6,i=Array.from((g==null?void 0:g.values())||[])),t.$$.dirty[0]&328|t.$$.dirty[1]&7&&n(5,r=Fe(i,p.scoreCount,m.scoreCount,q,d,f)),t.$$.dirty[0]&1073741972&&n(29,s=P?Q(P,fe,h==="filtered",u):null),t.$$.dirty[0]&100663296&&n(13,o=Math.max(ba,oe*W-4)),t.$$.dirty[0]&100663296&&n(12,l=Math.max(ba,oe*(1-W)-4)),t.$$.dirty[0]&402653184&&n(11,a=he?{items:[1,2].map(X=>({doc:he[`doc${X}`],label:he[`page${X}`],imgUrl:Pe(he[`doc${X}`],he[`page${X}`])})),score:he.score}:ze?{items:[["img1","doc1"],["img2","doc2"]].map(([X,we])=>({doc:ze[we],label:ze[X].canvas,imgUrl:ht(ze[X])})),score:ze.score}:null),t.$$.dirty[0]&33&&z&&r.docs.length&&se(),t.$$.dirty[0]&536870914&&x&&s&&Y()},[z,x,P,q,fe,r,i,h,d,F,V,a,l,o,k,C,w,S,N,M,E,I,L,Ie,_,W,oe,he,ze,s,u,f,m,p,g,gt,Ot,mt,Ee,Xe,Ze,$t,It]}class R_ extends qe{constructor(e){super(),Be(this,e,D_,P_,je,{documentSetStore:24},null,[-1,-1,-1])}}const $_=1e4;async function z_(t,e,n={}){const{onProgress:i,onError:r,signal:s}=n,o=await fetch(t,{signal:s});if(!o.ok){const d=await o.json().catch(()=>({error:o.statusText}));throw new Error(d.error||`HTTP ${o.status}`)}const l=o.body.getReader(),a=new TextDecoder;let c="",u=[],h=0,f=!1;try{for(;;){const{done:d,value:m}=await l.read();if(d){if(c.trim()){const g=Ea(c);g&&u.push(g)}return u.length>0?(h+=u.length,e.postMessage({type:"batch",pairs:u,isLast:!0})):e.postMessage({type:"done"}),i==null||i(h,!0),h}c+=a.decode(m,{stream:!0});const p=c.split(`
`);c=p.pop()||"";for(const g of p){if(!g)continue;const _=Ea(g);_&&(u.push(_),u.length>=$_&&(f||(e.postMessage({type:"init"}),f=!0),h+=u.length,e.postMessage({type:"batch",pairs:u,isLast:!1}),u=[],i==null||i(h,!1)))}}}catch(d){throw d.name==="AbortError"?(e.postMessage({type:"abort"}),d):(r==null||r(d),d)}}function Ea(t){try{return JSON.parse(t)}catch{return console.warn("Parse error:",t.slice(0,50)),null}}const j_=()=>new Worker("/static/js/pairWorker.js",{type:"module"});function F_(t){const e=De(null),n=De(!1),i=De({loaded:0,done:!1}),r=De([]),s=De(new Set),o=De([]),l=De(0),a=De(3),c=De(!1),u=De("threshold"),h=De([]),f=De(new Map);let d,m=null;const p=De({byImage:new Map,byDocPair:new Map,byDoc:new Map}),g=De(new Map),_=De(new Map),k=De({}),C=De({}),w=De({}),S=De({}),N=De({documents:0,pairs:null,images:0,categories:{}}),M=ut(r,(Q,se)=>{if(Q.length===0){se(Promise.resolve(0));return}d&&d.terminate()&&(d=null),m&&m.abort(),m=new AbortController;const J=new Promise((me,Y)=>{n.set(!0),i.set({loaded:0,done:!1}),e.set(null),(async()=>{try{d=j_(),d.onmessage=async Ke=>{const{type:Te}=Ke.data;if(Te==="progress"){i.set({loaded:Ke.data.count,done:!1});return}if(Te!=="complete")return;const{allPairs:Ie,imageNodes:te,pairIndex:le,categories:Pe,stats:ht}=Ke.data;p.set(le),k.set(ht.pairStats),C.set(ht.documentStats),w.set(ht.imageStats),S.set(ht.docPairStats);const gt=Array.from(ht.documentStats.scoreCount.keys());St(s).size===0&&s.set(new Set(gt));const Ot=await Promise.all(gt.map(Xe=>E(Xe).then(Ze=>({id:Xe,info:Ze})))),mt=new Map;Ot.forEach(({id:Xe,info:Ze})=>mt.set(Xe,Ze)),f.set(mt);const Ee=new Map;gt.forEach((Xe,Ze)=>{const $t=mt.get(Xe)||{};Ee.set(Xe,{id:Xe,title:$t.title||`Region Extraction ${Xe}`,color:$t.color||Au(Ze),images:[],...$t})}),te.forEach(Xe=>{const Ze=Ee.get(Xe.regionId);Ze&&(Xe.color=Ze.color,Xe.title=`${Ze.title} | Page ${Xe.canvas}`,Ze.images.push(Xe))}),Ee.forEach(Xe=>Xe.images.sort((Ze,$t)=>Ze.canvas-$t.canvas)),g.set(te),_.set(Ee),N.set({documents:gt.length,pairs:Ie.length,images:te.size,categories:Pe}),h.set(Ie),n.set(!1),i.set({loaded:Ie.length,done:!0}),d.terminate(),d=null,me(Ie.length)},d.onerror=Ke=>{console.error("Worker error",Ke),e.set(`Worker error: ${Ke.message}`),n.set(!1),Y(Ke)};const de=`${Pi}/document-set/${t}/pairs/stream?category=${Q.join(",")}`;await z_(de,d,{signal:m.signal,onProgress:(Ke,Te)=>{i.set({loaded:Ke,done:Te})},onError:Ke=>{e.set(`Stream error: ${Ke.message}`)}})}catch(de){if(de.name==="AbortError"){console.log("Request aborted");return}e.set(`Fetch error: ${de.message}`),n.set(!1),Y(de)}})()});se(J)});async function E(Q){try{const se=await fetch(`${Pi}/search/regions/?id=${Q}`);if(!se.ok)throw new Error(`HTTP ${se.status}`);const{results:J}=await se.json();if(!(J!=null&&J.length))return{title:`Region Extraction ${Q}`};const me=J[0],[,...Y]=me.title.split(" | "),[He,de]=(me.ref||"_").split("_");return{title:Y.join(" | "),ref:me.ref,witnessId:Mr(He),digitizationRef:de,zeros:me.zeros,img_nb:me.img_nb,url:me.url}}catch(se){return e.set(`Error fetching region #${Q}: ${se.message}`),{title:`Region Extraction ${Q}`}}}const I=ut([h,l,a,c,s],([Q,se,J,me,Y])=>{if(!Q)return[];const He=[],de=St(u);for(let Ke=0;Ke<Q.length;Ke++){const Te=Q[Ke];if(de==="threshold"&&Te.weightedScore<se)break;if(!(!Y.has(Te.regions_id_1)||!Y.has(Te.regions_id_2))){if(de==="topk"&&J!==null){const Ie=Te.rank_1??1/0,te=Te.rank_2??1/0;if(me){if(Ie>J||te>J)continue}else if(Ie>J&&te>J)continue}He.push(Te)}}return He}),O=ut([I,_],([Q,se])=>{if(!Q.length||se.size===0)return[];const J=new Set;for(const Y of Q)J.add(Y.regions_id_1),J.add(Y.regions_id_2);const me=[];return J.forEach(Y=>{const He=se.get(Y);He&&me.push(He)}),me.sort((Y,He)=>He.id-Y.id)});function L(Q,se,J=10,me=200,Y=2,He=25){if(!se)return{strength:.5,distance:100,width:2};const{min:de,_:Ke,range:Te}=se,Ie=Te===0?.5:(Q-de)/Te,te=me-Ie*(me-J),le=Y+Ie*(He-Y);return{strength:Ie,distance:te,width:le}}function F(Q,se,J=10,me=60){if(!se)return J;const{min:Y,_:He,range:de}=se;return de===0?(J+me)/2:J+(Q-Y)/de*(me-J)}const z=ut([I],([Q])=>{var Ke;const se=St(g),J=St(w),me=St(k),Y=new Set,He=[];for(const Te of Q){const{strength:Ie,distance:te,width:le}=L(Te.weightedScore,me.scoreRange);He.push({source:Te.id_1,target:Te.id_2,strength:Ie,distance:te,width:le}),Y.has(Te.id_1)||Y.add(Te.id_1),Y.has(Te.id_2)||Y.add(Te.id_2)}const de=[];for(const Te of Y){const Ie=se.get(Te);if(Ie){const te=(Ke=J.scoreCount)==null?void 0:Ke.get(Te),{count:le,score:Pe}=te;de.push({...Ie,radius:F(Pe,J.scoreRange),label:`Region: ${Ie.regionId}
Page: ${Ie.canvas}
Connections: ${le}
Total score: ${Pe.toFixed(2)}`})}}return{nodes:de,links:He}}),x=ut(O,Q=>{const se=St(S),J=St(C);if(Q.size===0)return{nodes:[],links:[]};const me=Array.from(Q.values()).map(He=>{var Ie;const de=(Ie=J.scoreCount)==null?void 0:Ie.get(He.id),{count:Ke,score:Te}=de;return{...He,radius:F(Ke,J.countRange),label:`${He.title}
Images: ${Ke}
Total score: ${Te.toFixed(2)}`}}),Y=Array.from(se.scoreCount.entries()).map(([He,de])=>{const[Ke,Te]=He.split("-").map(Number),{strength:Ie,distance:te,width:le}=L(de.score,se.scoreRange);return{source:Ke,target:Te,strength:Ie,distance:te,width:le}});return{nodes:me,links:Y}});function V(Q){if(!Q.length)return{regions:[],rows:[]};const se=St(_),J=St(p),me=Q[0],Y=se.get(me);if(!(Y!=null&&Y.images))return{regions:Q,rows:[]};const He=Y.images,de=(te,le,Pe)=>{const{r1:ht,r2:gt}={r1:le,r2:Pe},Ot=ht<gt?`${ht}-${gt}`:`${gt}-${ht}`;return(J.byDocPair.get(Ot)||[]).map(Ee=>Ee.id_1===te&&Ee.regions_id_1===le?{id:Ee.id_2,page:Ee.page_2}:Ee.id_2===te&&Ee.regions_id_2===le?{id:Ee.id_1,page:Ee.page_1}:null).filter(Boolean)},Ke=[];for(const te of He){let le=[{[me]:{id:te.id,page:te.canvas}}];for(let Pe=1;Pe<Q.length;Pe++){const ht=Q[Pe],gt=[];for(const Ot of le){const mt=[];for(let Ee=0;Ee<Pe;Ee++){const Xe=Q[Ee];if(Ot[Xe]){const Ze=de(Ot[Xe].id,Xe,ht);mt.push(...Ze)}}if(mt.length===0)gt.push(Ot);else{const Ee=new Map;mt.forEach(Xe=>{Ee.has(Xe.id)||Ee.set(Xe.id,Xe)});for(const Xe of Ee.values()){const Ze={...Ot,[ht]:Xe};gt.push(Ze)}}}le=gt}Ke.push(...le)}const Te=[],Ie=new Set;for(const te of Ke){const le=Q.map(Pe=>{var ht;return((ht=te[Pe])==null?void 0:ht.id)||""}).join("|");Ie.has(le)||(Ie.add(le),Te.push(te))}return{regions:Q,rows:Te}}function P(Q){r.update(se=>se.indexOf(Q)>-1?se.filter(me=>me!==Q):[...se,Q].sort((me,Y)=>me-Y))}function q(Q){s.update(se=>{const J=new Set(se);return J.has(Q)?J.delete(Q):J.add(Q),J})}const W=De("filtered"),K=De(!1),oe=ut(I,Q=>{const se=new Set;for(const J of Q)se.add(`${J.id_1}-${J.id_2}`);return se}),ue=ut(I,Q=>{const se=new Map;if(!(Q!=null&&Q.length))return{scoreCount:se,scoreRange:{min:0,max:0,range:0}};let J=1/0,me=-1/0;for(const Y of Q){const He=Y.regions_id_1<Y.regions_id_2?`${Y.regions_id_1}-${Y.regions_id_2}`:`${Y.regions_id_2}-${Y.regions_id_1}`,de=se.get(He)||{score:0,count:0};de.score+=Y.weightedScore||0,de.count++,se.set(He,de)}for(const{score:Y}of se.values())Y<J&&(J=Y),Y>me&&(me=Y);return J===1/0&&(J=me=0),{scoreCount:se,scoreRange:{min:J,max:me,range:me-J}}}),he=ut(I,Q=>{const se=new Map;if(!(Q!=null&&Q.length))return{scoreCount:se,countRange:{min:0,max:0,range:0}};for(const Y of Q)for(const He of[Y.regions_id_1,Y.regions_id_2]){const de=se.get(He)||{score:0,count:0};de.score+=Y.weightedScore||0,de.count++,se.set(He,de)}let J=1/0,me=-1/0;for(const{count:Y}of se.values())Y<J&&(J=Y),Y>me&&(me=Y);return J===1/0&&(J=me=0),{scoreCount:se,countRange:{min:J,max:me,range:me-J}}}),ze=ut([W,S,ue],([Q,se,J])=>Q==="filtered"?J:se),fe=ut([W,C,he],([Q,se,J])=>Q==="filtered"?J:se),Fe=ut(_,Q=>{var J;const se=new Map;for(const[me,Y]of Q)se.set(me,Math.max(1,((J=Y.images)==null?void 0:J.length)||Y.img_nb||1));return se});return{error:e,loadingProgress:i,cancelLoading:()=>{m&&(m.abort(),n.set(!1))},allPairs:h,visiblePairs:I,pairIndex:p,documentNodes:_,imageNodes:g,fetchPairs:M,imageNetwork:z,documentNetwork:x,selectedCategories:r,pairStats:k,documentStats:C,imageStats:w,docPairStats:S,docSetNumber:N,selectedNodes:o,selectedRegions:s,updateSelectedNodes:Q=>o.set(Q),toggleCategory:P,toggleRegion:q,buildAlignedImageMatrix:V,threshold:l,setThreshold:Q=>l.set(Q),topK:a,setTopK:Q=>a.set(Q),mutualTopK:c,setMutualTopK:Q=>c.set(Q),scoreMode:u,setScoreMode:Q=>u.set(Q),matrixMode:W,setMatrixMode:Q=>W.set(Q),normalizeByPages:K,setNormalizeByPages:Q=>K.set(Q),activeDocPairStats:ze,activeDocStats:fe,pageCountMap:Fe,visiblePairIds:oe}}function Ca(t){let e,n,i,r,s,o=(t[0].clusters||0)+"",l;return{c(){e=b("div"),n=b("div"),i=b("p"),i.textContent="Clusters",r=j(),s=b("p"),l=re(o),v(i,"class","heading"),v(s,"class","title is-5"),v(e,"class","level-item")},m(a,c){$(a,e,c),y(e,n),y(n,i),y(n,r),y(n,s),y(s,l)},p(a,c){c&1&&o!==(o=(a[0].clusters||0)+"")&&Le(l,o)},d(a){a&&D(e)}}}function H_(t){var L,F,z;let e,n,i,r,s,o,l=(t[0].count||0)+"",a,c,u,h,f,d,m,p=(t[0].links||0)+"",g,_,k,C,w,S,N,M,E=(((F=(L=t[0])==null?void 0:L.density)==null?void 0:F.toFixed(3))||0)+"",I,O=((z=t[0])==null?void 0:z.clusters)&&Ca(t);return{c(){e=b("div"),n=b("div"),i=b("div"),r=b("p"),r.textContent=`${U==="en"?"Nodes":"Nœuds"}`,s=j(),o=b("p"),a=re(l),c=j(),u=b("div"),h=b("div"),f=b("p"),f.textContent=`${U==="en"?"Edges":"Liens"}`,d=j(),m=b("p"),g=re(p),_=j(),O&&O.c(),k=j(),C=b("div"),w=b("div"),S=b("p"),S.textContent=`${U==="en"?"Density":"Densité"}`,N=j(),M=b("p"),I=re(E),v(r,"class","heading"),v(o,"class","title is-5"),v(n,"class","level-item"),v(f,"class","heading"),v(m,"class","title is-5"),v(u,"class","level-item"),v(S,"class","heading"),v(M,"class","title is-5"),v(C,"class","level-item"),v(e,"class","level has-text-centered")},m(x,V){$(x,e,V),y(e,n),y(n,i),y(i,r),y(i,s),y(i,o),y(o,a),y(e,c),y(e,u),y(u,h),y(h,f),y(h,d),y(h,m),y(m,g),y(e,_),O&&O.m(e,null),y(e,k),y(e,C),y(C,w),y(w,S),y(w,N),y(w,M),y(M,I)},p(x,[V]){var P,q,W;V&1&&l!==(l=(x[0].count||0)+"")&&Le(a,l),V&1&&p!==(p=(x[0].links||0)+"")&&Le(g,p),(P=x[0])!=null&&P.clusters?O?O.p(x,V):(O=Ca(x),O.c(),O.m(e,k)):O&&(O.d(1),O=null),V&1&&E!==(E=(((W=(q=x[0])==null?void 0:q.density)==null?void 0:W.toFixed(3))||0)+"")&&Le(I,E)},i:ie,o:ie,d(x){x&&D(e),O&&O.d()}}}function V_(t,e,n){let i,r,s,o,{activeTab:l="img"}=e,{documentSetStore:a}=e;const{imageStats:c,documentStats:u,docPairStats:h}=a;return Me(t,c,f=>n(8,o=f)),Me(t,u,f=>n(7,s=f)),Me(t,h,f=>n(6,r=f)),t.$$set=f=>{"activeTab"in f&&n(4,l=f.activeTab),"documentSetStore"in f&&n(5,a=f.documentSetStore)},t.$$.update=()=>{t.$$.dirty&464&&n(0,i=l==="img"?o:l==="doc"?s:r)},[i,c,u,h,l,a,r,s,o]}class U_ extends qe{constructor(e){super(),Be(this,e,V_,H_,je,{activeTab:4,documentSetStore:5})}}function B_(t){let e,n,i;const r=t[1].default,s=Vt(r,t,t[0],null);return{c(){e=b("table"),n=b("tbody"),s&&s.c(),v(e,"class","table is-fullwidth")},m(o,l){$(o,e,l),y(e,n),s&&s.m(n,null),i=!0},p(o,[l]){s&&s.p&&(!i||l&1)&&Bt(s,r,o,o[0],i?Ut(r,o[0],l,null):qt(o[0]),null)},i(o){i||(H(s,o),i=!0)},o(o){B(s,o),i=!1},d(o){o&&D(e),s&&s.d(o)}}}function q_(t,e,n){let{$$slots:i={},$$scope:r}=e;return t.$$set=s=>{"$$scope"in s&&n(0,r=s.$$scope)},[r,i]}class K_ extends qe{constructor(e){super(),Be(this,e,q_,B_,je,{})}}const W_=t=>({}),Ia=t=>({}),Y_=t=>({}),xa=t=>({}),X_=t=>({}),Ma=t=>({});function G_(t){let e;const n=t[4]["row-body"],i=Vt(n,t,t[3],Ia);return{c(){i&&i.c()},m(r,s){i&&i.m(r,s),e=!0},p(r,s){i&&i.p&&(!e||s&8)&&Bt(i,n,r,r[3],e?Ut(n,r[3],s,W_):qt(r[3]),Ia)},i(r){e||(H(i,r),e=!0)},o(r){B(i,r),e=!1},d(r){i&&i.d(r)}}}function J_(t){let e,n,i,r;const s=t[4]["row-body"],o=Vt(s,t,t[3],xa);return{c(){e=b("div"),n=b("div"),o&&o.c(),v(n,"class","grid is-gap-2"),v(e,"class",i="fixed-grid has-"+t[2]+"-cols")},m(l,a){$(l,e,a),y(e,n),o&&o.m(n,null),r=!0},p(l,a){o&&o.p&&(!r||a&8)&&Bt(o,s,l,l[3],r?Ut(s,l[3],a,Y_):qt(l[3]),xa),(!r||a&4&&i!==(i="fixed-grid has-"+l[2]+"-cols"))&&v(e,"class",i)},i(l){r||(H(o,l),r=!0)},o(l){B(o,l),r=!1},d(l){l&&D(e),o&&o.d(l)}}}function Q_(t){let e,n,i,r,s,o,l,a,c,u;Kt(t[5]);const h=t[4]["row-header"],f=Vt(h,t,t[3],Ma),d=[J_,G_],m=[];function p(g,_){return g[0]?0:1}return o=p(t),l=m[o]=d[o](t),{c(){e=b("tr"),n=b("th"),i=b("div"),f&&f.c(),r=j(),s=b("td"),l.c(),v(i,"class","content-wrapper py-5"),v(n,"class","is-3 center-flex is-narrow"),Ue(n,"width","15vw"),v(s,"class","p-5 is-fullwidth")},m(g,_){$(g,e,_),y(e,n),y(n,i),f&&f.m(i,null),y(e,r),y(e,s),m[o].m(s,null),a=!0,c||(u=Ae(window,"resize",t[5]),c=!0)},p(g,[_]){f&&f.p&&(!a||_&8)&&Bt(f,h,g,g[3],a?Ut(h,g[3],_,X_):qt(g[3]),Ma);let k=o;o=p(g),o===k?m[o].p(g,_):(et(),B(m[k],1,1,()=>{m[k]=null}),tt(),l=m[o],l?l.p(g,_):(l=m[o]=d[o](g),l.c()),H(l,1),l.m(s,null))},i(g){a||(H(f,g),H(l),a=!0)},o(g){B(f,g),B(l),a=!1},d(g){g&&D(e),f&&f.d(g),m[o].d(),c=!1,u()}}}function Z_(t,e,n){let i,{$$slots:r={},$$scope:s}=e,{useGrid:o=!0}=e,l=0;function a(){n(1,l=window.innerWidth)}return t.$$set=c=>{"useGrid"in c&&n(0,o=c.useGrid),"$$scope"in c&&n(3,s=c.$$scope)},t.$$.update=()=>{t.$$.dirty&2&&n(2,i=Us(l))},[o,l,i,s,r,a]}class Aa extends qe{constructor(e){super(),Be(this,e,Z_,Q_,je,{useGrid:0})}}const ub="",e0=t=>({}),Ta=t=>({}),t0=t=>({}),Na=t=>({});function Pa(t){let e,n,i,r,s,o,l,a,c,u,h,f=t[1]&&Oa(t);return a=new zi({props:{tooltipText:t[2][t[1]][U]}}),{c(){f&&f.c(),e=j(),n=b("div"),i=b("button"),r=Wt("svg"),s=Wt("path"),l=j(),ve(a.$$.fragment),v(s,"fill","none"),v(s,"stroke","currentColor"),v(s,"stroke-linecap","round"),v(s,"stroke-linejoin","round"),v(s,"stroke-width","1.5"),v(s,"d","M12 3v18m0 0l8.5-8.5M12 21l-8.5-8.5"),v(r,"style",o=`transform: rotate(${t[1]?"180":"0"}deg)`),v(r,"xmlns","http://www.w3.org/2000/svg"),v(r,"width","24"),v(r,"height","24"),v(r,"viewBox","0 0 24 24"),v(r,"class","svelte-jbs1sd"),v(i,"class","button is-link svelte-jbs1sd"),v(n,"class","ctrl-toggle svelte-jbs1sd")},m(d,m){f&&f.m(d,m),$(d,e,m),$(d,n,m),y(n,i),y(i,r),y(r,s),y(i,l),pe(a,i,null),c=!0,u||(h=Ae(i,"click",sn(t[3])),u=!0)},p(d,m){d[1]?f?(f.p(d,m),m&2&&H(f,1)):(f=Oa(d),f.c(),H(f,1),f.m(e.parentNode,e)):f&&(et(),B(f,1,1,()=>{f=null}),tt()),(!c||m&2&&o!==(o=`transform: rotate(${d[1]?"180":"0"}deg)`))&&v(r,"style",o);const p={};m&2&&(p.tooltipText=d[2][d[1]][U]),a.$set(p)},i(d){c||(H(f),H(a.$$.fragment,d),c=!0)},o(d){B(f),B(a.$$.fragment,d),c=!1},d(d){f&&f.d(d),d&&D(e),d&&D(n),ge(a),u=!1,h()}}}function Oa(t){let e,n,i;const r=t[5]["toolbar-hidden"],s=Vt(r,t,t[4],Ta);return{c(){e=b("div"),s&&s.c(),v(e,"class","ctrl-extra")},m(o,l){$(o,e,l),s&&s.m(e,null),i=!0},p(o,l){s&&s.p&&(!i||l&16)&&Bt(s,r,o,o[4],i?Ut(r,o[4],l,e0):qt(o[4]),Ta)},i(o){i||(H(s,o),Kt(()=>{i&&(n||(n=gn(e,qs,{axis:"y"},!0)),n.run(1))}),i=!0)},o(o){B(s,o),n||(n=gn(e,qs,{axis:"y"},!1)),n.run(0),i=!1},d(o){o&&D(e),s&&s.d(o),o&&n&&n.end()}}}function n0(t){let e,n,i,r,s,o,l,a;const c=t[5]["toolbar-visible"],u=Vt(c,t,t[4],Na);let h=t[0]&&Pa(t);return{c(){e=b("div"),n=b("form"),i=b("div"),r=b("div"),s=b("div"),u&&u.c(),o=j(),h&&h.c(),v(s,"class","ctrl-block svelte-jbs1sd"),v(r,"class","ctrl-block-wrapper svelte-jbs1sd"),v(i,"class","ctrl-base"),v(n,"class","ctrl svelte-jbs1sd"),v(e,"id","toolbar"),v(e,"class",l="ctrl-wrapper is-flex is-justify-content-center is-align-items-center "+(t[1]?"toolbar-expanded":"toolbar-collapsed")+" svelte-jbs1sd")},m(f,d){$(f,e,d),y(e,n),y(n,i),y(i,r),y(r,s),u&&u.m(s,null),y(n,o),h&&h.m(n,null),a=!0},p(f,[d]){u&&u.p&&(!a||d&16)&&Bt(u,c,f,f[4],a?Ut(c,f[4],d,t0):qt(f[4]),Na),f[0]?h?(h.p(f,d),d&1&&H(h,1)):(h=Pa(f),h.c(),H(h,1),h.m(n,null)):h&&(et(),B(h,1,1,()=>{h=null}),tt()),(!a||d&2&&l!==(l="ctrl-wrapper is-flex is-justify-content-center is-align-items-center "+(f[1]?"toolbar-expanded":"toolbar-collapsed")+" svelte-jbs1sd"))&&v(e,"class",l)},i(f){a||(H(u,f),H(h),a=!0)},o(f){B(u,f),B(h),a=!1},d(f){f&&D(e),u&&u.d(f),h&&h.d()}}}function i0(t,e,n){let i,{$$slots:r={},$$scope:s}=e,{expandable:o=!0}=e;const l={true:{en:"Collapse the toolbar",fr:"Refermer le menu"},false:{en:"Expand the toolbar",fr:"Ouvrir le menu"}},a=()=>n(1,i=!i);return t.$$set=c=>{"expandable"in c&&n(0,o=c.expandable),"$$scope"in c&&n(4,s=c.$$scope)},n(1,i=!1),[o,i,l,a,s,r]}class r0 extends qe{constructor(e){super(),Be(this,e,i0,n0,je,{expandable:0})}}function La(t){let e,n,i,r,s,o,l,a,c,u=t[5]>1&&Da(t),h=t[5]<t[3]&&za(t);return{c(){e=b("nav"),n=b("ul"),u&&u.c(),i=j(),r=b("li"),s=b("a"),o=re(t[5]),l=j(),h&&h.c(),v(s,"class","pagination-link is-current"),v(s,"href",null),v(n,"class","pagination-list ml-0"),v(e,"class","pagination is-centered mb-2"),v(e,"aria-label","pagination")},m(f,d){$(f,e,d),y(e,n),u&&u.m(n,null),y(n,i),y(n,r),y(r,s),y(s,o),y(n,l),h&&h.m(n,null),a||(c=Ae(s,"click",sn(t[9])),a=!0)},p(f,d){f[5]>1?u?u.p(f,d):(u=Da(f),u.c(),u.m(n,i)):u&&(u.d(1),u=null),d&32&&Le(o,f[5]),f[5]<f[3]?h?h.p(f,d):(h=za(f),h.c(),h.m(n,null)):h&&(h.d(1),h=null)},d(f){f&&D(e),u&&u.d(),h&&h.d(),a=!1,c()}}}function Da(t){let e,n,i,r,s,o,l=t[5]-1>1&&Ra(t);return{c(){e=b("li"),n=b("a"),n.textContent="1",i=j(),l&&l.c(),r=kt(),v(n,"class","pagination-link"),v(n,"href",null)},m(a,c){$(a,e,c),y(e,n),$(a,i,c),l&&l.m(a,c),$(a,r,c),s||(o=Ae(n,"click",sn(t[7])),s=!0)},p(a,c){a[5]-1>1?l?l.p(a,c):(l=Ra(a),l.c(),l.m(r.parentNode,r)):l&&(l.d(1),l=null)},d(a){a&&D(e),a&&D(i),l&&l.d(a),a&&D(r),s=!1,o()}}}function Ra(t){let e,n,i,r=t[5]-1+"",s,o,l,a=t[5]-1>2&&$a();return{c(){a&&a.c(),e=j(),n=b("li"),i=b("a"),s=re(r),v(i,"class","pagination-link"),v(i,"href",null)},m(c,u){a&&a.m(c,u),$(c,e,u),$(c,n,u),y(n,i),y(i,s),o||(l=Ae(i,"click",sn(t[8])),o=!0)},p(c,u){c[5]-1>2?a||(a=$a(),a.c(),a.m(e.parentNode,e)):a&&(a.d(1),a=null),u&32&&r!==(r=c[5]-1+"")&&Le(s,r)},d(c){a&&a.d(c),c&&D(e),c&&D(n),o=!1,l()}}}function $a(t){let e;return{c(){e=b("li"),e.innerHTML='<span class="pagination-ellipsis">…</span>'},m(n,i){$(n,e,i)},d(n){n&&D(e)}}}function za(t){let e,n,i,r,s,o,l=t[5]+1<t[3]&&ja(t);return{c(){l&&l.c(),e=j(),n=b("li"),i=b("a"),r=re(t[3]),v(i,"class","pagination-link"),v(i,"href",null)},m(a,c){l&&l.m(a,c),$(a,e,c),$(a,n,c),y(n,i),y(i,r),s||(o=Ae(i,"click",sn(t[11])),s=!0)},p(a,c){a[5]+1<a[3]?l?l.p(a,c):(l=ja(a),l.c(),l.m(e.parentNode,e)):l&&(l.d(1),l=null),c&8&&Le(r,a[3])},d(a){l&&l.d(a),a&&D(e),a&&D(n),s=!1,o()}}}function ja(t){let e,n,i=t[5]+1+"",r,s,o,l,a,c=t[5]+2<t[3]&&Fa();return{c(){e=b("li"),n=b("a"),r=re(i),s=j(),c&&c.c(),o=kt(),v(n,"class","pagination-link"),v(n,"href",null)},m(u,h){$(u,e,h),y(e,n),y(n,r),$(u,s,h),c&&c.m(u,h),$(u,o,h),l||(a=Ae(n,"click",sn(t[10])),l=!0)},p(u,h){h&32&&i!==(i=u[5]+1+"")&&Le(r,i),u[5]+2<u[3]?c||(c=Fa(),c.c(),c.m(o.parentNode,o)):c&&(c.d(1),c=null)},d(u){u&&D(e),u&&D(s),c&&c.d(u),u&&D(o),l=!1,a()}}}function Fa(t){let e;return{c(){e=b("li"),e.innerHTML='<span class="pagination-ellipsis">…</span>'},m(n,i){$(n,e,i)},d(n){n&&D(e)}}}function s0(t){let e,n,i=t[5]*t[2]-t[2]+1+"",r,s,o=Math.min(t[5]*t[2],t[1])+"",l,a,c,u,h=t[4]&&La(t);return{c(){h&&h.c(),e=j(),n=b("div"),r=re(i),s=re(" - "),l=re(o),a=re(" / "),c=re(t[1]),v(n,"class",u="is-size-7 is-center mb-4 "+(t[4]?"":"mt-4"))},m(f,d){h&&h.m(f,d),$(f,e,d),$(f,n,d),y(n,r),y(n,s),y(n,l),y(n,a),y(n,c)},p(f,[d]){f[4]?h?h.p(f,d):(h=La(f),h.c(),h.m(e.parentNode,e)):h&&(h.d(1),h=null),d&36&&i!==(i=f[5]*f[2]-f[2]+1+"")&&Le(r,i),d&38&&o!==(o=Math.min(f[5]*f[2],f[1])+"")&&Le(l,o),d&2&&Le(c,f[1]),d&16&&u!==(u="is-size-7 is-center mb-4 "+(f[4]?"":"mt-4"))&&v(n,"class",u)},i:ie,o:ie,d(f){h&&h.d(f),f&&D(e),f&&D(n)}}}function o0(t,e,n){let i,r,s,{store:o}=e;const{currentPage:l}=o;Me(t,l,p=>n(5,s=p));let{nbOfItems:a}=e,{pageLength:c=vu}=e;const u=()=>o.handlePageUpdate(1),h=()=>o.handlePageUpdate(s-1),f=()=>o.handlePageUpdate(s),d=()=>o.handlePageUpdate(s+1),m=()=>o.handlePageUpdate(i);return t.$$set=p=>{"store"in p&&n(0,o=p.store),"nbOfItems"in p&&n(1,a=p.nbOfItems),"pageLength"in p&&n(2,c=p.pageLength)},t.$$.update=()=>{t.$$.dirty&6&&n(3,i=c>0?Math.ceil(a/c):1),t.$$.dirty&14&&n(4,r=i>1||a>c)},[o,a,c,i,r,s,l,u,h,f,d,m]}class Ha extends qe{constructor(e){super(),Be(this,e,o0,s0,je,{store:0,nbOfItems:1,pageLength:2})}}function l0(t){let e,n,i,r,s=U==="en"?"Save selection":"Sauvegarder la sélection",o,l,a;return{c(){e=b("button"),n=b("span"),i=b("i"),r=j(),o=re(s),v(i,"class","fa-solid fa-floppy-disk"),v(e,"class","button is-link")},m(c,u){$(c,e,u),y(e,n),y(n,i),y(n,r),y(n,o),l||(a=Ae(e,"click",t[7]),l=!0)},p:ie,d(c){c&&D(e),l=!1,a()}}}function a0(t){let e,n,i,r,s=U==="en"?"Go to treatment":"Accéder au traitement",o,l;return{c(){var a;e=b("a"),n=b("span"),i=b("i"),r=j(),o=re(s),v(i,"class","fa-solid fa-gear"),v(e,"class","button is-link"),v(e,"href",l="/"+Yt+"/treatment/add/?document_set="+((a=t[3])==null?void 0:a.id))},m(a,c){$(a,e,c),y(e,n),y(n,i),y(n,r),y(n,o)},p(a,c){var u;c&8&&l!==(l="/"+Yt+"/treatment/add/?document_set="+((u=a[3])==null?void 0:u.id))&&v(e,"href",l)},d(a){a&&D(e)}}}function Va(t){let e,n,i,r,s,o,l;return{c(){var a,c;e=b("a"),n=b("span"),n.innerHTML='<i class="fa-solid fa-file-export"></i> JSON',r=j(),s=b("a"),o=b("span"),o.innerHTML='<i class="fa-solid fa-file-zipper"></i> ZIP',v(e,"class","button is-link is-dark"),v(e,"href",i="/"+Yt+"/document-set/"+((a=t[3])==null?void 0:a.id)+"/json"),v(e,"target","_blank"),v(s,"class","button is-link is-dark"),v(s,"href",l="/"+Yt+"/document-set/"+((c=t[3])==null?void 0:c.id)+"/zip"),v(s,"target","_blank")},m(a,c){$(a,e,c),y(e,n),$(a,r,c),$(a,s,c),y(s,o)},p(a,c){var u,h;c&8&&i!==(i="/"+Yt+"/document-set/"+((u=a[3])==null?void 0:u.id)+"/json")&&v(e,"href",i),c&8&&l!==(l="/"+Yt+"/document-set/"+((h=a[3])==null?void 0:h.id)+"/zip")&&v(s,"href",l)},d(a){a&&D(e),a&&D(r),a&&D(s)}}}function c0(t){let e,n,i,r,s,o,l;function a(f,d){return f[2]&&!f[1]?a0:l0}let c=a(t),u=c(t),h=!t[1]&&Va(t);return{c(){e=b("footer"),n=b("div"),i=b("button"),i.textContent=`${U==="en"?"Clear selection":"Vider la sélection"}`,r=j(),u.c(),s=j(),h&&h.c(),v(i,"class","button button-close is-link is-light"),v(n,"class","buttons"),v(e,"class","modal-card-foot is-center")},m(f,d){$(f,e,d),y(e,n),y(n,i),y(n,r),u.m(n,null),y(n,s),h&&h.m(n,null),o||(l=Ae(i,"click",t[6]),o=!0)},p(f,[d]){c===(c=a(f))&&u?u.p(f,d):(u.d(1),u=c(f),u&&(u.c(),u.m(n,s))),f[1]?h&&(h.d(1),h=null):h?h.p(f,d):(h=Va(f),h.c(),h.m(n,null))},i:ie,o:ie,d(f){f&&D(e),u.d(),h&&h.d(),o=!1,l()}}}function u0(t,e,n){let i,r,{selectionStore:s}=e;const{isSaved:o,selection:l}=s;Me(t,o,h=>n(2,i=h)),Me(t,l,h=>n(3,r=h));let{isRegion:a=s.type!=="documentSet"}=e;const c=()=>s.empty(),u=()=>s.save();return t.$$set=h=>{"selectionStore"in h&&n(0,s=h.selectionStore),"isRegion"in h&&n(1,a=h.isRegion)},[s,a,i,r,o,l,c,u]}class f0 extends qe{constructor(e){super(),Be(this,e,u0,c0,je,{selectionStore:0,isRegion:1})}}const fb="";function d0(t){let e,n,i,r,s,o;return{c(){e=b("span"),n=re(t[5]),i=j(),r=b("span"),r.innerHTML='<i class="fas fa-edit"></i>',v(r,"class","pl-3 smaller has-text-link")},m(l,a){$(l,e,a),y(e,n),y(e,i),y(e,r),s||(o=[Ae(e,"click",t[7]),Ae(e,"keyup",null)],s=!0)},p(l,a){a&32&&Le(n,l[5])},d(l){l&&D(e),s=!1,vt(o)}}}function h0(t){let e,n,i;return{c(){e=b("input"),v(e,"class","input selection-title svelte-sgypdx")},m(r,s){$(r,e,s),t[12](e),Ii(e,t[4]),n||(i=[Ae(e,"input",t[13]),Ae(e,"keydown",t[8]),Ae(e,"blur",t[9])],n=!0)},p(r,s){s&16&&e.value!==r[4]&&Ii(e,r[4])},d(r){r&&D(e),t[12](null),n=!1,vt(i)}}}function m0(t){let e,n,i,r,s,o,l,a,c,u,h,f,d,m,p,g,_,k,C,w;function S(O,L){return O[2]?h0:d0}let N=S(t),M=N(t);const E=t[11].default,I=Vt(E,t,t[10],null);return _=new f0({props:{selectionStore:t[0]}}),{c(){e=b("div"),n=b("div"),i=j(),r=b("div"),s=b("div"),o=b("div"),l=b("i"),a=j(),M.c(),c=re(`
                (`),u=re(t[1]),h=re(")"),f=j(),d=b("button"),m=j(),p=b("section"),I&&I.c(),g=j(),ve(_.$$.fragment),v(n,"class","modal-background"),v(l,"class","fa-solid fa-book-bookmark"),v(o,"class","title is-4 mb-0 media-content"),v(d,"class","delete media-left"),v(d,"aria-label","close"),v(s,"class","modal-card-head media mb-0 is-middle"),v(p,"class","modal-card-body"),v(r,"class","modal-content"),v(e,"id","selection-modal"),v(e,"class","modal fade"),v(e,"tabindex","-1"),v(e,"aria-labelledby","selection-modal-label"),v(e,"aria-hidden","true")},m(O,L){$(O,e,L),y(e,n),y(e,i),y(e,r),y(r,s),y(s,o),y(o,l),y(o,a),M.m(o,null),y(o,c),y(o,u),y(o,h),y(s,f),y(s,d),y(r,m),y(r,p),I&&I.m(p,null),y(r,g),pe(_,r,null),k=!0,C||(w=ei(Pr.call(null,e)),C=!0)},p(O,[L]){N===(N=S(O))&&M?M.p(O,L):(M.d(1),M=N(O),M&&(M.c(),M.m(o,c))),(!k||L&2)&&Le(u,O[1]),I&&I.p&&(!k||L&1024)&&Bt(I,E,O,O[10],k?Ut(E,O[10],L,null):qt(O[10]),null);const F={};L&1&&(F.selectionStore=O[0]),_.$set(F)},i(O){k||(H(I,O),H(_.$$.fragment,O),k=!0)},o(O){B(I,O),B(_.$$.fragment,O),k=!1},d(O){O&&D(e),M.d(),I&&I.d(O),ge(_),C=!1,w()}}}function p0(t,e,n){let i,{$$slots:r={},$$scope:s}=e,{selectionStore:o}=e;const{selectionTitle:l,updateTitle:a,save:c}=o;Me(t,l,C=>n(5,i=C));let{selectionLength:u=!1}=e,h=!1,f,d;function m(){n(2,h=!0),n(4,d=i),setTimeout(()=>f&&f.focus(),0)}function p(C){C.key==="Enter"&&g()}function g(){n(2,h=!1),a(d),c()}function _(C){pn[C?"unshift":"push"](()=>{f=C,n(3,f)})}function k(){d=this.value,n(4,d)}return t.$$set=C=>{"selectionStore"in C&&n(0,o=C.selectionStore),"selectionLength"in C&&n(1,u=C.selectionLength),"$$scope"in C&&n(10,s=C.$$scope)},[o,u,h,f,d,i,l,m,p,g,s,r,_,k]}class g0 extends qe{constructor(e){super(),Be(this,e,p0,m0,je,{selectionStore:0,selectionLength:1})}}const db="";function _0(t){let e,n,i,r,s,o=U==="en"?"Selection":"Sélection",l,a,c,u,h,f;return{c(){e=b("div"),n=b("button"),i=b("span"),r=b("i"),s=j(),l=re(o),a=re(`
            (`),c=re(t[0]),u=re(")"),v(r,"class","fa-solid fa-book-bookmark"),v(i,"id","btn-content"),v(n,"id","set-btn"),v(n,"class","button px-5 py-4 is-link svelte-gmt9z5"),v(n,"data-target","selection-modal"),v(e,"class","set-container svelte-gmt9z5")},m(d,m){$(d,e,m),y(e,n),y(n,i),y(i,r),y(i,s),y(i,l),y(i,a),y(i,c),y(i,u),h||(f=ei(Bs.call(null,n)),h=!0)},p(d,[m]){m&1&&Le(c,d[0])},i:ie,o:ie,d(d){d&&D(e),h=!1,f()}}}function v0(t,e,n){let{selectionLength:i=0}=e,r=i;return t.$$set=s=>{"selectionLength"in s&&n(0,i=s.selectionLength)},t.$$.update=()=>{if(t.$$.dirty&3&&i!==r){const s=i>r;n(1,r=i);const o=document.getElementById("btn-content");o&&o.animate([{transform:s?"translateY(-7px)":"translateX(-5px)"},{transform:s?"translateY(7px)":"translateX(5px)"},{transform:"translate(0)"}],{duration:300,easing:"cubic-bezier(0.65, 0, 0.35, 1)"})}},[i,r]}class y0 extends qe{constructor(e){super(),Be(this,e,v0,_0,je,{selectionLength:0})}}const hb="";function Ua(t,e,n){const i=t.slice();return i[7]=e[n][0],i[8]=e[n][1],i}function b0(t){let e;return{c(){e=b("div"),e.textContent=`${U==="en"?"No regions in selection":"Aucune région sélectionnée"}`},m(n,i){$(n,e,i)},p:ie,d(n){n&&D(e)}}}function w0(t){let e,n,i=Object.entries(t[2]),r=[];for(let s=0;s<i.length;s+=1)r[s]=Ba(Ua(t,i,s));return{c(){e=b("div"),n=b("div");for(let s=0;s<r.length;s+=1)r[s].c();v(n,"class","grid is-gap-2"),v(e,"class","fixed-grid has-6-cols")},m(s,o){$(s,e,o),y(e,n);for(let l=0;l<r.length;l+=1)r[l]&&r[l].m(n,null)},p(s,o){if(o&13){i=Object.entries(s[2]);let l;for(l=0;l<i.length;l+=1){const a=Ua(s,i,l);r[l]?r[l].p(a,o):(r[l]=Ba(a),r[l].c(),r[l].m(n,null))}for(;l<r.length;l+=1)r[l].d(1);r.length=i.length}},d(s){s&&D(e),bt(r,s)}}}function Ba(t){let e,n,i,r,s,o,l,a=t[8].title+"",c,u,h,f,d,m;function p(){return t[6](t[7])}return{c(){e=b("div"),n=b("figure"),i=b("img"),s=j(),o=b("div"),l=b("span"),c=re(a),u=j(),h=b("button"),f=j(),xt(i.src,r=jt(t[8].img,t[8].xywh,"96,"))||v(i,"src",r),v(i,"alt","Extracted region"),v(l,"class","overlay-desc"),v(o,"class","overlay is-center svelte-g8ij5d"),v(n,"class","image is-64x64 card"),v(h,"class","delete region-btn svelte-g8ij5d"),v(h,"aria-label","remove from selection"),v(e,"class","selection cell svelte-g8ij5d")},m(g,_){$(g,e,_),y(e,n),y(n,i),y(n,s),y(n,o),y(o,l),y(l,c),y(e,u),y(e,h),y(e,f),d||(m=Ae(h,"click",p),d=!0)},p(g,_){t=g,_&4&&!xt(i.src,r=jt(t[8].img,t[8].xywh,"96,"))&&v(i,"src",r),_&4&&a!==(a=t[8].title+"")&&Le(c,a)},d(g){g&&D(e),d=!1,m()}}}function S0(t){let e;function n(s,o){return s[4]?w0:b0}let i=n(t),r=i(t);return{c(){r.c(),e=kt()},m(s,o){r.m(s,o),$(s,e,o)},p(s,o){i===(i=n(s))&&r?r.p(s,o):(r.d(1),r=i(s),r&&(r.c(),r.m(e.parentNode,e)))},d(s){r.d(s),s&&D(e)}}}function k0(t){let e,n,i,r;return e=new y0({props:{selectionLength:t[1]}}),i=new g0({props:{selectionLength:t[1],selectionStore:t[0],$$slots:{default:[S0]},$$scope:{ctx:t}}}),{c(){ve(e.$$.fragment),n=j(),ve(i.$$.fragment)},m(s,o){pe(e,s,o),$(s,n,o),pe(i,s,o),r=!0},p(s,[o]){const l={};o&2&&(l.selectionLength=s[1]),e.$set(l);const a={};o&2&&(a.selectionLength=s[1]),o&1&&(a.selectionStore=s[0]),o&2077&&(a.$$scope={dirty:o,ctx:s}),i.$set(a)},i(s){r||(H(e.$$.fragment,s),H(i.$$.fragment,s),r=!0)},o(s){B(e.$$.fragment,s),B(i.$$.fragment,s),r=!1},d(s){ge(e,s),s&&D(n),ge(i,s)}}}function E0(t,e,n){let i,r,s,o,{selectionStore:l}=e;const{selected:a}=l;Me(t,a,u=>n(3,o=u));const c=u=>l.remove(u,Object.keys(o)[0]);return t.$$set=u=>{"selectionStore"in u&&n(0,l=u.selectionStore)},t.$$.update=()=>{t.$$.dirty&8&&n(2,i=Object.values(o)[0]||{}),t.$$.dirty&4&&n(1,r=Object.keys(i).length),t.$$.dirty&2&&n(4,s=r>0)},[l,r,i,o,s,a,c]}class C0 extends qe{constructor(e){super(),Be(this,e,E0,k0,je,{selectionStore:0})}}const mb="";function qa(t,e,n){const i=t.slice();return i[17]=e[n],i}function Ka(t,e,n){const i=t.slice();return i[20]=e[n],i}function Wa(t,e,n){const i=t.slice();return i[23]=e[n],i}function I0(t){let e,n;return e=new r0({props:{expandable:!1,$$slots:{"toolbar-visible":[x0]},$$scope:{ctx:t}}}),{c(){ve(e.$$.fragment)},m(i,r){pe(e,i,r),n=!0},p(i,r){const s={};r&67108864&&(s.$$scope={dirty:r,ctx:i}),e.$set(s)},i(i){n||(H(e.$$.fragment,i),n=!0)},o(i){B(e.$$.fragment,i),n=!1},d(i){ge(e,i)}}}function Ya(t){let e,n,i,r,s,o=t[23].title+"",l,a,c,u=t[23].shortcut+"",h,f,d,m;return{c(){e=b("p"),n=b("button"),i=b("span"),r=b("i"),s=j(),l=re(o),a=j(),c=b("span"),h=re(u),f=j(),v(r,"class","fas "+t[23].icon+" svelte-7vjt6f"),v(i,"class","icon is-small"),v(c,"class","shortcut svelte-7vjt6f"),v(n,"class","button pl-5"),v(n,"title",t[23].desc),v(e,"class","control")},m(p,g){$(p,e,g),y(e,n),y(n,i),y(i,r),y(n,s),y(n,l),y(n,a),y(n,c),y(c,h),y(e,f),d||(m=Ae(n,"click",sn(t[23].fct)),d=!0)},p(p,g){t=p},d(p){p&&D(e),d=!1,m()}}}function x0(t){let e,n,i,r,s,o,l,a=Object.values(t[10]),c=[];for(let u=0;u<a.length;u+=1)c[u]=Ya(Wa(t,a,u));return{c(){e=b("div"),n=b("div"),i=b("div"),r=b("span"),r.textContent=`${U==="en"?"Process selection":"Agir sur la sélection"}`,s=j(),o=b("div"),l=b("div");for(let u=0;u<c.length;u+=1)c[u].c();v(r,"class","tag is-medium is-link mr-5"),v(i,"class","column is-narrow mr-5"),v(l,"class","field has-addons"),v(o,"class","column"),v(n,"class","columns is-vcentered is-mobile py-4"),v(e,"slot","toolbar-visible")},m(u,h){$(u,e,h),y(e,n),y(n,i),y(i,r),y(n,s),y(n,o),y(o,l);for(let f=0;f<c.length;f+=1)c[f]&&c[f].m(l,null)},p(u,h){if(h&1024){a=Object.values(u[10]);let f;for(f=0;f<a.length;f+=1){const d=Wa(u,a,f);c[f]?c[f].p(d,h):(c[f]=Ya(d),c[f].c(),c[f].m(l,null))}for(;f<c.length;f+=1)c[f].d(1);c.length=a.length}},d(u){u&&D(e),bt(c,u)}}}function M0(t){let e,n=t[9].title+"",i;return{c(){e=b("span"),i=re(n),v(e,"class","button is-small is-success"),v(e,"title",t[9].desc)},m(r,s){$(r,e,s),y(e,i)},p:ie,d(r){r&&D(e)}}}function A0(t){let e,n=t[8].title+"",i,r,s;function o(){return t[12](t[17])}return{c(){e=b("button"),i=re(n),v(e,"class","button is-small is-warning"),v(e,"title",t[8].desc)},m(l,a){$(l,e,a),y(e,i),r||(s=Ae(e,"click",o),r=!0)},p(l,a){t=l},d(l){l&&D(e),r=!1,s()}}}function T0(t){let e,n,i=t[17].size+"",r,s,o,l,a,c;function u(d,m){return d[17].fullyConnected?M0:A0}let h=u(t),f=h(t);return{c(){e=b("div"),n=b("span"),r=re(i),s=re(" images"),o=j(),l=b("hr"),a=j(),f.c(),c=j(),v(n,"class","cluster-size"),v(e,"class","cluster-info is-center is-fullwidth")},m(d,m){$(d,e,m),y(e,n),y(n,r),y(n,s),y(e,o),y(e,l),y(e,a),f.m(e,null),$(d,c,m)},p(d,m){m&4&&i!==(i=d[17].size+"")&&Le(r,i),h===(h=u(d))&&f?f.p(d,m):(f.d(1),f=h(d),f&&(f.c(),f.m(e,null)))},d(d){d&&D(e),f.d(),d&&D(c)}}}function Xa(t){let e,n;return e=new Jn({props:{item:{...t[3].get(t[20]),clusterId:t[17].id},copyable:!1,selectionStore:dr}}),{c(){ve(e.$$.fragment)},m(i,r){pe(e,i,r),n=!0},p(i,r){const s={};r&12&&(s.item={...i[3].get(i[20]),clusterId:i[17].id}),e.$set(s)},i(i){n||(H(e.$$.fragment,i),n=!0)},o(i){B(e.$$.fragment,i),n=!1},d(i){ge(e,i)}}}function N0(t){let e,n,i=t[17].members,r=[];for(let o=0;o<i.length;o+=1)r[o]=Xa(Ka(t,i,o));const s=o=>B(r[o],1,1,()=>{r[o]=null});return{c(){for(let o=0;o<r.length;o+=1)r[o].c();e=j()},m(o,l){for(let a=0;a<r.length;a+=1)r[a]&&r[a].m(o,l);$(o,e,l),n=!0},p(o,l){if(l&12){i=o[17].members;let a;for(a=0;a<i.length;a+=1){const c=Ka(o,i,a);r[a]?(r[a].p(c,l),H(r[a],1)):(r[a]=Xa(c),r[a].c(),H(r[a],1),r[a].m(e.parentNode,e))}for(et(),a=i.length;a<r.length;a+=1)s(a);tt()}},i(o){if(!n){for(let l=0;l<i.length;l+=1)H(r[l]);n=!0}},o(o){r=r.filter(Boolean);for(let l=0;l<r.length;l+=1)B(r[l]);n=!1},d(o){bt(r,o),o&&D(e)}}}function Ga(t,e){let n,i,r;return i=new Aa({props:{$$slots:{"row-body":[N0],"row-header":[T0]},$$scope:{ctx:e}}}),{key:t,first:null,c(){n=kt(),ve(i.$$.fragment),this.first=n},m(s,o){$(s,n,o),pe(i,s,o),r=!0},p(s,o){e=s;const l={};o&67108876&&(l.$$scope={dirty:o,ctx:e}),i.$set(l)},i(s){r||(H(i.$$.fragment,s),r=!0)},o(s){B(i.$$.fragment,s),r=!1},d(s){s&&D(n),ge(i,s)}}}function P0(t){let e=[],n=new Map,i,r,s=t[2];const o=l=>l[17].id;for(let l=0;l<s.length;l+=1){let a=qa(t,s,l),c=o(a);n.set(c,e[l]=Ga(c,a))}return{c(){for(let l=0;l<e.length;l+=1)e[l].c();i=kt()},m(l,a){for(let c=0;c<e.length;c+=1)e[c]&&e[c].m(l,a);$(l,i,a),r=!0},p(l,a){a&780&&(s=l[2],et(),e=ii(e,a,o,1,l,s,n,i.parentNode,Cr,Ga,i,qa),tt())},i(l){if(!r){for(let a=0;a<s.length;a+=1)H(e[a]);r=!0}},o(l){for(let a=0;a<e.length;a+=1)B(e[a]);r=!1},d(l){for(let a=0;a<e.length;a+=1)e[a].d(l);l&&D(i)}}}function O0(t){let e,n,i,r,s,o,l,a,c,u=xr&&I0(t);return n=new Ha({props:{store:t[0],nbOfItems:t[1],pageLength:t[7]}}),r=new C0({props:{selectionStore:dr}}),o=new K_({props:{$$slots:{default:[P0]},$$scope:{ctx:t}}}),a=new Ha({props:{store:t[0],nbOfItems:t[1],pageLength:t[7]}}),{c(){u&&u.c(),e=j(),ve(n.$$.fragment),i=j(),ve(r.$$.fragment),s=j(),ve(o.$$.fragment),l=j(),ve(a.$$.fragment)},m(h,f){u&&u.m(h,f),$(h,e,f),pe(n,h,f),$(h,i,f),pe(r,h,f),$(h,s,f),pe(o,h,f),$(h,l,f),pe(a,h,f),c=!0},p(h,[f]){xr&&u.p(h,f);const d={};f&1&&(d.store=h[0]),f&2&&(d.nbOfItems=h[1]),n.$set(d);const m={};f&67108876&&(m.$$scope={dirty:f,ctx:h}),o.$set(m);const p={};f&1&&(p.store=h[0]),f&2&&(p.nbOfItems=h[1]),a.$set(p)},i(h){c||(H(u),H(n.$$.fragment,h),H(r.$$.fragment,h),H(o.$$.fragment,h),H(a.$$.fragment,h),c=!0)},o(h){B(u),B(n.$$.fragment,h),B(r.$$.fragment,h),B(o.$$.fragment,h),B(a.$$.fragment,h),c=!1},d(h){u&&u.d(h),h&&D(e),ge(n,h),h&&D(i),ge(r,h),h&&D(s),ge(o,h),h&&D(l),ge(a,h)}}}function L0(t,e,n){let i,r,s,{documentSetStore:o}=e;const{imageNodes:l}=o;Me(t,l,w=>n(3,s=w));let{clusterStore:a}=e;const{clusterNb:c,paginatedClusters:u,pageLength:h,validateCluster:f,newCluster:d,removeFromClusters:m}=a;Me(t,c,w=>n(1,i=w)),Me(t,u,w=>n(2,r=w));const p={create:{title:U==="en"?"New cluster":"Nouveau cluster",desc:U==="en"?"Create a new validated cluster from the selected regions":"Créer un nouveau cluster valide à partir des régions sélectionnées",icon:"fa-object-group",shortcut:"Shift + C",fct:d},remove:{title:U==="en"?"Remove from cluster":"Retirer du cluster",desc:U==="en"?"Remove the selected regions from their cluster":"Retirer les régions sélectionnées de leur cluster",icon:"fa-chain-broken",shortcut:"Shift + D",fct:m},validate:{title:U==="en"?"Validate cluster":"Valider le cluster",desc:U==="en"?"Set as exact match all the pairs of regions in the cluster":"Définir comme correspondance exacte toutes les paires de régions dans le cluster",icon:"fa-check",fct:f},validated:{title:U==="en"?"Validated cluster":"Cluster valide",desc:U==="en"?"All pairs of regions have be categorized as exact matches":"Toutes les paires de régions ont été catégorisées comme des correspondances exactes",icon:"fa-check"}},{validate:g,validated:_,...k}=p,C=w=>g.fct(w);return t.$$set=w=>{"documentSetStore"in w&&n(11,o=w.documentSetStore),"clusterStore"in w&&n(0,a=w.clusterStore)},[a,i,r,s,l,c,u,h,g,_,k,o,C]}class D0 extends qe{constructor(e){super(),Be(this,e,L0,O0,je,{documentSetStore:11,clusterStore:0})}}function R0(t,e){const i=De(1),{visiblePairs:r,imageNodes:s}=t;Ar(i,"p");function o(w){Tr(w,i,"p")}function l(w){if(w.length===0)return[];const S=new Map,N=O=>S.has(O)?(S.get(O)!==O&&S.set(O,N(S.get(O))),S.get(O)):(S.set(O,O),O),M=(O,L)=>{const F=N(O),z=N(L);F!==z&&S.set(z,F)},E=new Set;w.forEach(O=>{M(O.id_1,O.id_2),E.add(O.id_1),E.add(O.id_2)});const I=new Map;return E.forEach(O=>{const L=N(O);I.has(L)||I.set(L,[]),I.get(L).push(O)}),Array.from(I.values()).map(O=>{const L=O.length,F=L*(L-1)/2,z=new Set(O),x=w.filter(V=>z.has(V.id_1)&&z.has(V.id_2)).length;return{id:crypto.randomUUID(),members:O,size:L,fullyConnected:x===F}}).filter(O=>O.size>1).sort((O,L)=>L.size-O.size)}const a=ut(r,w=>w.length?l(w):[]),c=De([]);a.subscribe(w=>{c.set(w)});const u=ut([c,i],([w,S])=>{const N=(S-1)*10,M=N+10;return w.slice(N,M)}),h=(w,S)=>{const N=St(s).get(w),M=St(s).get(S);return{img_1:w,img_2:S,regions_id_1:N==null?void 0:N.regionId,regions_id_2:M==null?void 0:M.regionId}},f=(w,S)=>(c.update(N=>N.map(M=>{if(!S[M.id])return M;const E=M.members.filter(I=>!w.has(I));return{...M,members:E,size:E.length}}).filter(M=>M.size>0)),!0),d=async w=>{const S=Array.isArray(w)?w:Object.keys(w),N=new Set(S),M={};St(c).forEach(I=>{const O=I.members.filter(L=>N.has(L));O.length>0&&(M[I.id]=O)});const E=Object.entries(M).flatMap(([I,O])=>{const L=St(c).find(z=>z.id===I);if(!L)return[];const F=L.members.filter(z=>!N.has(z));return O.flatMap(z=>F.map(x=>h(z,x)))});if(E.length===0)return f(N,M),!0;try{const I=await Hs(()=>fetch(`${window.location.origin}/${Yt}/uncategorize-pair-batch`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":_n},body:JSON.stringify({pairs:E})}));return I.ok?(f(N,M),!0):(console.log(I),await Mt(U==="en"?"Batch un-categorization failed":"La dé-catégorisation par lot a échoué",U==="en"?"Error":"Erreur"),!1)}catch(I){return await Mt(I,U==="en"?"Error":"Erreur"),!1}},m=async w=>{const S=w.flatMap((N,M)=>w.slice(M+1).map(E=>h(N,E)));try{const N=await Hs(()=>fetch(`${window.location.origin}/${Yt}/exact-match-batch`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":_n},body:JSON.stringify({pairs:S})}));return N.ok?!0:(console.log(N),await Mt(U==="en"?"Batch validation failed":"La validation par lot a échoué",U==="en"?"Error":"Erreur"),!1)}catch(N){return await Mt(N,U==="en"?"Error":"Erreur"),console.error("Error:",N),!1}},p=async w=>{if(!xr)return await Mt(U==="en"?"You do not have permission to validate clusters":"Vous n'avez pas la permission, de valider les clusters.",U==="en"?"Permission Denied":"Permission refusée"),!1;const S=await m(w.members);return S&&c.update(N=>N.map(M=>M.id===w.id?{...M,fullyConnected:!0}:M)),S},g=async w=>{if(w.length<2)return!1;const S=await m(w);return S&&c.update(N=>[{id:crypto.randomUUID(),members:w,size:w.length,fullyConnected:!0},...N].sort((E,I)=>I.size-E.size)),S},_=()=>Object.values(St(e).selected)[0]||{},k=async()=>{if(!await Mt(U==="en"?"Do you want to create a cluster out of these images?":"Voulez-vous créer un cluster à partir de ces images ?",U==="en"?"Confirm creation":"Confirmer la création",!0))return;const S=_(),N=Object.keys(S);return N.length<2?(await Mt(U==="en"?"Cluster creation requires at least 2 images":"La création d'un nouveau cluster nécessite a minima 2 images",U==="en"?"Impossible creation":"Création impossible"),!1):!await d(N)||!await g(N)?!1:(e.empty(),!0)},C=async()=>{if(!await Mt(U==="en"?"Do you want to remove these images from their clusters?":"Voulez-vous supprimer ces images de leurs clusters ?",U==="en"?"Confirm deletion":"Confirmer la suppression",!0))return;const S=_();return await d(Object.keys(S))?(e.empty(),!0):!1};return{imageClusters:a,interfaceClusters:c,clusterNb:ut(c,w=>w.length),validateCluster:p,removeFromClusters:C,newCluster:k,paginatedClusters:u,handlePageUpdate:o,pageLength:10,currentPage:i}}function Ja(t,e,n){const i=t.slice();return i[25]=e[n],i}function $0(t){let e,n,i;return{c(){e=b("p"),e.textContent=`La matrice de documents visualise les scores de similarité globaux entre tous les documents du
                        corpus.
                        Cliquez sur une cellule pour voir les détails des similarités entre pages.`,n=j(),i=b("ul"),i.innerHTML=`<li>Matrice : Scores normalisés entre documents (0-100).</li>
                        <li>Scatter plot : Similarités détaillées par page.</li>`},m(r,s){$(r,e,s),$(r,n,s),$(r,i,s)},d(r){r&&D(e),r&&D(n),r&&D(i)}}}function z0(t){let e,n,i;return{c(){e=b("p"),e.textContent=`The Documents Network illustrates the connections between different witnesses in the document
                        set.
                        Each node represents a witness, and edges denote relationships based on shared content or other
                        relevant factors.`,n=j(),i=b("ul"),i.innerHTML=`<li>Nodes: Witnesses in the document set.</li>
                        <li>Edges: Relationships based on shared content.</li>`},m(r,s){$(r,e,s),$(r,n,s),$(r,i,s)},d(r){r&&D(e),r&&D(n),r&&D(i)}}}function j0(t){let e,n,i;return{c(){e=b("p"),e.textContent=`The Regions Network visualizes the relationships between image regions across different witnesses
                        in the document set.
                        Each node represents an image region, and edges indicate similarity or connections based on
                        predefined criteria.`,n=j(),i=b("ul"),i.innerHTML=`<li>Nodes: Image regions from various witnesses.</li>
                        <li>Edges: Similarity links between regions.</li>`},m(r,s){$(r,e,s),$(r,n,s),$(r,i,s)},d(r){r&&D(e),r&&D(n),r&&D(i)}}}function F0(t){let e,n,i,r;function s(a,c){return a[23]==="img"?j0:a[23]==="doc"?z0:$0}let o=s(t),l=o(t);return i=new U_({props:{activeTab:t[23],documentSetStore:t[4]}}),{c(){e=b("div"),l.c(),n=j(),ve(i.$$.fragment),v(e,"slot","datavizInfo")},m(a,c){$(a,e,c),l.m(e,null),y(e,n),pe(i,e,null),r=!0},p(a,c){o!==(o=s(a))&&(l.d(1),l=o(a),l&&(l.c(),l.m(e,n)));const u={};c&8388608&&(u.activeTab=a[23]),i.$set(u)},i(a){r||(H(i.$$.fragment,a),r=!0)},o(a){B(i.$$.fragment,a),r=!1},d(a){a&&D(e),l.d(),ge(i)}}}function H0(t){let e,n,i;return n=new Qf({props:{docSet:t[0],documentSetStore:t[4],clusterStore:t[8],$$slots:{datavizInfo:[F0]},$$scope:{ctx:t}}}),{c(){e=b("div"),ve(n.$$.fragment),v(e,"slot","sidebar")},m(r,s){$(r,e,s),pe(n,e,null),i=!0},p(r,s){const o={};s&1&&(o.docSet=r[0]),s&276824064&&(o.$$scope={dirty:s,ctx:r}),n.$set(o)},i(r){i||(H(n.$$.fragment,r),i=!0)},o(r){B(n.$$.fragment,r),i=!1},d(r){r&&D(e),ge(n)}}}function Qa(t){let e,n,i,r,s,o,l,a=t[25].title+"",c,u;return{c(){e=b("div"),n=b("figure"),i=b("img"),s=j(),o=b("div"),l=b("span"),c=re(a),u=j(),xt(i.src,r=jt(t[25].img,t[25].xywh,"96,"))||v(i,"src",r),v(i,"alt","Extracted region"),v(l,"class","overlay-desc"),v(o,"class","overlay is-center"),v(n,"class","image is-64x64 card"),v(e,"class","selection cell")},m(h,f){$(h,e,f),y(e,n),y(n,i),y(n,s),y(n,o),y(o,l),y(l,c),y(e,u)},p(h,f){f&2&&!xt(i.src,r=jt(h[25].img,h[25].xywh,"96,"))&&v(i,"src",r),f&2&&a!==(a=h[25].title+"")&&Le(c,a)},d(h){h&&D(e)}}}function V0(t){let e,n,i=Object.values(Object.values(t[1])[0]||{}),r=[];for(let s=0;s<i.length;s+=1)r[s]=Qa(Ja(t,i,s));return{c(){e=b("div"),n=b("div");for(let s=0;s<r.length;s+=1)r[s].c();v(n,"class","grid is-gap-2"),v(e,"slot","content"),v(e,"class","fixed-grid has-6-cols")},m(s,o){$(s,e,o),y(e,n);for(let l=0;l<r.length;l+=1)r[l]&&r[l].m(n,null)},p(s,o){if(o&2){i=Object.values(Object.values(s[1])[0]||{});let l;for(l=0;l<i.length;l+=1){const a=Ja(s,i,l);r[l]?r[l].p(a,o):(r[l]=Qa(a),r[l].c(),r[l].m(n,null))}for(;l<r.length;l+=1)r[l].d(1);r.length=i.length}},d(s){s&&D(e),bt(r,s)}}}function U0(t){let e,n,i,r={ctx:t,current:null,token:null,hasCatch:!1,pending:Q0,then:K0,catch:q0,value:24,blocks:[,,,]};return Er(n=t[3],r),{c(){e=kt(),r.block.c()},m(s,o){$(s,e,o),r.block.m(s,r.anchor=o),r.mount=()=>e.parentNode,r.anchor=e,i=!0},p(s,o){t=s,r.ctx=t,o&8&&n!==(n=t[3])&&Er(n,r)||js(r,t,o)},i(s){i||(H(r.block),i=!0)},o(s){for(let o=0;o<3;o+=1){const l=r.blocks[o];B(l)}i=!1},d(s){s&&D(e),r.block.d(s),r.token=null,r=null}}}function B0(t){let e,n,i;return{c(){e=b("article"),n=b("div"),i=re(t[2]),v(n,"class","message-body"),v(e,"class","message is-danger")},m(r,s){$(r,e,s),y(e,n),y(n,i)},p(r,s){s&4&&Le(i,r[2])},i:ie,o:ie,d(r){r&&D(e)}}}function q0(t){return{c:ie,m:ie,p:ie,i:ie,o:ie,d:ie}}function K0(t){let e,n,i,r;const s=[Y0,W0],o=[];function l(a,c){return a[24]===0?0:1}return e=l(t),n=o[e]=s[e](t),{c(){n.c(),i=kt()},m(a,c){o[e].m(a,c),$(a,i,c),r=!0},p(a,c){let u=e;e=l(a),e===u?o[e].p(a,c):(et(),B(o[u],1,1,()=>{o[u]=null}),tt(),n=o[e],n?n.p(a,c):(n=o[e]=s[e](a),n.c()),H(n,1),n.m(i.parentNode,i))},i(a){r||(H(n),r=!0)},o(a){B(n),r=!1},d(a){o[e].d(a),a&&D(i)}}}function W0(t){let e,n,i=t[9][t[23]]+"",r,s,o,l,a;const c=[J0,G0,X0],u=[];function h(f,d){return f[23]==="img"||f[23]==="doc"?0:f[23]==="sim"?1:f[23]==="mat"?2:-1}return~(o=h(t))&&(l=u[o]=c[o](t)),{c(){e=b("div"),n=b("h2"),r=re(i),s=j(),l&&l.c(),v(n,"class","title is-3 has-text-link")},m(f,d){$(f,e,d),y(e,n),y(n,r),y(e,s),~o&&u[o].m(e,null),a=!0},p(f,d){(!a||d&8388608)&&i!==(i=f[9][f[23]]+"")&&Le(r,i);let m=o;o=h(f),o===m?~o&&u[o].p(f,d):(l&&(et(),B(u[m],1,1,()=>{u[m]=null}),tt()),~o?(l=u[o],l?l.p(f,d):(l=u[o]=c[o](f),l.c()),H(l,1),l.m(e,null)):l=null)},i(f){a||(H(l),a=!0)},o(f){B(l),a=!1},d(f){f&&D(e),~o&&u[o].d()}}}function Y0(t){let e;return{c(){e=b("article"),e.innerHTML=`<div class="message-body">No document pairs found for this configuration.
                            Please adjust your selection criteria in the sidebar to include more documents or
                            categories.</div>`,v(e,"class","message is-warning")},m(n,i){$(n,e,i)},p:ie,i:ie,o:ie,d(n){n&&D(e)}}}function X0(t){let e,n;return e=new R_({props:{documentSetStore:t[4]}}),{c(){ve(e.$$.fragment)},m(i,r){pe(e,i,r),n=!0},p:ie,i(i){n||(H(e.$$.fragment,i),n=!0)},o(i){B(e.$$.fragment,i),n=!1},d(i){ge(e,i)}}}function G0(t){let e,n;return e=new D0({props:{documentSetStore:t[4],clusterStore:t[8]}}),{c(){ve(e.$$.fragment)},m(i,r){pe(e,i,r),n=!0},p:ie,i(i){n||(H(e.$$.fragment,i),n=!0)},o(i){B(e.$$.fragment,i),n=!1},d(i){ge(e,i)}}}function J0(t){let e,n;return e=new x_({props:{documentSetStore:t[4],type:t[23]}}),{c(){ve(e.$$.fragment)},m(i,r){pe(e,i,r),n=!0},p(i,r){const s={};r&8388608&&(s.type=i[23]),e.$set(s)},i(i){n||(H(e.$$.fragment,i),n=!0)},o(i){B(e.$$.fragment,i),n=!1},d(i){ge(e,i)}}}function Q0(t){let e;return{c(){e=b("progress"),e.textContent="Loading...",v(e,"class","progress is-link"),v(e,"max","100")},m(n,i){$(n,e,i)},p:ie,i:ie,o:ie,d(n){n&&D(e)}}}function Z0(t){let e,n,i,r,s,o;n=new $u({props:{$$slots:{content:[V0]},$$scope:{ctx:t}}});const l=[B0,U0],a=[];function c(u,h){return u[2]?0:1}return r=c(t),s=a[r]=l[r](t),{c(){e=b("div"),ve(n.$$.fragment),i=j(),s.c(),v(e,"slot","content")},m(u,h){$(u,e,h),pe(n,e,null),y(e,i),a[r].m(e,null),o=!0},p(u,h){const f={};h&268435458&&(f.$$scope={dirty:h,ctx:u}),n.$set(f);let d=r;r=c(u),r===d?a[r].p(u,h):(et(),B(a[d],1,1,()=>{a[d]=null}),tt(),s=a[r],s?s.p(u,h):(s=a[r]=l[r](u),s.c()),H(s,1),s.m(e,null))},i(u){o||(H(n.$$.fragment,u),H(s),o=!0)},o(u){B(n.$$.fragment,u),B(s),o=!1},d(u){u&&D(e),ge(n),a[r].d()}}}function e1(t){let e,n;return e=new Ku({props:{tabList:t[9],$$slots:{content:[Z0,({activeTab:i})=>({23:i}),({activeTab:i})=>i?8388608:0],sidebar:[H0,({activeTab:i})=>({23:i}),({activeTab:i})=>i?8388608:0]},$$scope:{ctx:t}}}),{c(){ve(e.$$.fragment)},m(i,r){pe(e,i,r),n=!0},p(i,[r]){const s={};r&276824079&&(s.$$scope={dirty:r,ctx:i}),e.$set(s)},i(i){n||(H(e.$$.fragment,i),n=!0)},o(i){B(e.$$.fragment,i),n=!1},d(i){ge(e,i)}}}function t1(t,e,n){var O;let i,r,s,{docSet:o}=e;const l=F_(o.id),{error:a,fetchPairs:c,selectedRegions:u,selectedCategories:h,threshold:f,topK:d,mutualTopK:m,scoreMode:p}=l;Me(t,a,L=>n(2,r=L)),Me(t,c,L=>n(3,s=L));let g,_,k,C,w,S;Dn(()=>{g=Vn(u,"regions","set"),_=Vn(h,"categories","array",[1]),k=Vn(f,"threshold","number"),C=Vn(d,"topk","number"),w=Vn(m,"mutual","boolean"),S=Vn(p,"mode","string");const L=u.subscribe(g),F=h.subscribe(_),z=f.subscribe(k),x=d.subscribe(C),V=m.subscribe(w),P=p.subscribe(S);return()=>{L(),F(),z(),x(),V(),P()}});const{selected:N}=dr;Me(t,N,L=>n(1,i=L));const M=R0(l,dr),E={sim:U==="en"?"Copy Clusters":"Groupe de copies",mat:U==="en"?"Document Matrix":"Matrice de documents",img:U==="en"?"Image Network":"Réseau d'images",doc:U==="en"?"Document Network":"Réseau de documents"},I=((O=o==null?void 0:o.selection)==null?void 0:O.selected)||{Witness:{},Series:{},Work:{}};return $n("selectedDocuments",I),t.$$set=L=>{"docSet"in L&&n(0,o=L.docSet)},[o,i,r,s,l,a,c,N,M,E]}class n1 extends qe{constructor(e){super(),Be(this,e,t1,e1,je,{docSet:0})}}new n1({target:document.getElementById("document-set"),props:{docSet}});const pb="";function i1(t){let e,n,i;return n=new Jn({props:{item:t[0],height:"full"}}),{c(){e=b("div"),ve(n.$$.fragment),v(e,"class","img-wrapper svelte-1duc3w1")},m(r,s){$(r,e,s),pe(n,e,null),i=!0},p(r,[s]){const o={};s&1&&(o.item=r[0]),n.$set(o)},i(r){i||(H(n.$$.fragment,r),i=!0)},o(r){B(n.$$.fragment,r),i=!1},d(r){r&&D(e),ge(n)}}}function r1(t,e,n){let{mainImgItem:i}=e;return t.$$set=r=>{"mainImgItem"in r&&n(0,i=r.mainImgItem)},[i]}class Za extends qe{constructor(e){super(),Be(this,e,r1,i1,je,{mainImgItem:0})}}const gb="";function s1(t){return{c:ie,m:ie,p:ie,d:ie}}function o1(t){let e,n=`${t[5][0]}%`,i=`${t[5][1]}%`,r=`${t[5][2]}%`,s=`${t[5][3]}%`;return{c(){e=b("div"),v(e,"class","modal-context-bbox svelte-zgr10j"),v(e,"aria-description",U==="fr"?"Position de la région extraite sur la page":"Position of the extracted region on the page"),Ue(e,"left",n),Ue(e,"top",i),Ue(e,"width",r),Ue(e,"height",s)},m(o,l){$(o,e,l)},p:ie,d(o){o&&D(e)}}}function l1(t){return{c:ie,m:ie,p:ie,d:ie}}function a1(t){let e,n,i,r,s,o={ctx:t,current:null,token:null,hasCatch:!1,pending:l1,then:o1,catch:s1,value:5};return Er(t[1],o),{c(){e=b("div"),n=b("div"),i=b("img"),s=j(),o.block.c(),v(i,"class","card modal-context-full-page svelte-zgr10j"),xt(i.src,r=t[0])||v(i,"src",r),v(i,"alt",U==="fr"?"Vue de la page d'où la région est extraite":"View of the page the region is extracted from"),v(n,"class","modal-context-wrapper svelte-zgr10j"),v(e,"class","modal-context-outer pb-4 svelte-zgr10j")},m(l,a){$(l,e,a),y(e,n),y(n,i),y(n,s),o.block.m(n,o.anchor=null),o.mount=()=>n,o.anchor=null},p(l,[a]){t=l,js(o,t,a)},i:ie,o:ie,d(l){l&&D(e),o.block.d(),o.token=null,o=null}}}function c1(t,e,n){let{mainImgItem:i}=e;const r=jt(i.img,"full","full"),s=xu(i.img),o=i.xywh.map(Number),l=fetch(s).then(a=>a.json()).then(a=>[o[0]/a.width,o[1]/a.height,o[2]/a.width,o[3]/a.height].map(c=>c*100));return t.$$set=a=>{"mainImgItem"in a&&n(2,i=a.mainImgItem)},[r,l,i]}class u1 extends qe{constructor(e){super(),Be(this,e,c1,a1,je,{mainImgItem:2})}}const _b="";function ec(t,e,n){const i=t.slice();return i[13]=e[n].id,i[14]=e[n].label,i}function tc(t){let e,n,i=t[14]+"",r,s,o,l,a;function c(){return t[9](t[13])}return{c(){e=b("li"),n=b("a"),r=re(i),s=j(),v(n,"href",""),v(e,"class",o=t[13]===t[2]?"is-active":"")},m(u,h){$(u,e,h),y(e,n),y(n,r),y(e,s),l||(a=Ae(n,"click",sn(c)),l=!0)},p(u,h){t=u,h&4&&o!==(o=t[13]===t[2]?"is-active":"")&&v(e,"class",o)},d(u){u&&D(e),l=!1,a()}}}function f1(t){let e,n,i,r,s,o,l,a,c,u,h,f,d,m,p,g=t[3],_=[];for(let S=0;S<g.length;S+=1)_[S]=tc(ec(t,g,S));const k=[t[1][t[2]]||{}];var C=t[0][t[2]]||null;function w(S){let N={};for(let M=0;M<k.length;M+=1)N=As(N,k[M]);return{props:N}}return C&&(u=xi(C,w())),{c(){e=b("div"),n=b("div"),i=j(),r=b("div"),s=b("div"),o=b("div"),l=b("ul");for(let S=0;S<_.length;S+=1)_[S].c();a=j(),c=b("div"),u&&ve(u.$$.fragment),h=j(),f=b("button"),v(n,"class","modal-background"),v(o,"class","tabs is-centered"),Ue(o,"height","fit-content"),v(c,"class","ml-4 mr-4 modal-main-wrapper svelte-1uakzh2"),Ge(c,"pb-4",t[2]==="main"),v(s,"class","modal-inner svelte-1uakzh2"),v(r,"class","modal-content svelte-1uakzh2"),v(f,"class","modal-close is-large"),v(f,"aria-label","close"),v(e,"id","region-modal-wrapper"),v(e,"class","modal is-active")},m(S,N){$(S,e,N),y(e,n),y(e,i),y(e,r),y(r,s),y(s,o),y(o,l);for(let M=0;M<_.length;M+=1)_[M]&&_[M].m(l,null);y(s,a),y(s,c),u&&pe(u,c,null),y(e,h),y(e,f),d=!0,m||(p=[Ae(n,"click",t[6]),Ae(n,"keyup",t[5]),Ae(f,"click",t[6])],m=!0)},p(S,[N]){if(N&28){g=S[3];let E;for(E=0;E<g.length;E+=1){const I=ec(S,g,E);_[E]?_[E].p(I,N):(_[E]=tc(I),_[E].c(),_[E].m(l,null))}for(;E<_.length;E+=1)_[E].d(1);_.length=g.length}const M=N&6?fu(k,[du(S[1][S[2]]||{})]):{};if(N&5&&C!==(C=S[0][S[2]]||null)){if(u){et();const E=u;B(E.$$.fragment,1,0,()=>{ge(E,1)}),tt()}C?(u=xi(C,w()),ve(u.$$.fragment),H(u.$$.fragment,1),pe(u,c,null)):u=null}else C&&u.$set(M);(!d||N&4)&&Ge(c,"pb-4",S[2]==="main")},i(S){d||(u&&H(u.$$.fragment,S),d=!0)},o(S){u&&B(u.$$.fragment,S),d=!1},d(S){S&&D(e),bt(_,S),u&&ge(u),m=!1,vt(p)}}}function d1(t,e,n){let i,{mainImgItem:r}=e,{compareImgItem:s}=e;const o=Ti(),l=s?["main","page","similarity","expansion"]:["main","page"],a={expansion:{fr:"Expansion de requête",en:"Query expansion"},similarity:{fr:"Comparaison",en:"Comparison"},page:{fr:"Vue de la page",en:"Page view"},main:{fr:"Vue principale",en:"Main view"}},c=l.map(g=>{var _;return{id:g,label:((_=a[g])==null?void 0:_[U])??"Main view"}}),u={main:Za,page:u1};s&&Promise.all([fs(()=>Promise.resolve().then(()=>dy),void 0).then(g=>g.default),fs(()=>Promise.resolve().then(()=>jy),void 0).then(g=>g.default)]).then(([g,_])=>{const k=Object.keys(u);l.filter(C=>!k.includes(C)).map(C=>n(0,u[C]=C==="expansion"?_:C==="similarity"?g:Za,u))});const h={};l.map(g=>n(1,h[g]=g==="similarity"?{compareImgItem:s,mainImgItem:r}:{mainImgItem:r},h));const f=g=>n(2,i=g),d=g=>{g.key==="Escape"&&o("closeModal")},m=()=>o("closeModal");Dn(()=>{document.addEventListener("keyup",d)}),Rn(()=>{document.removeEventListener("keydown",d)});const p=g=>f(g);return t.$$set=g=>{"mainImgItem"in g&&n(7,r=g.mainImgItem),"compareImgItem"in g&&n(8,s=g.compareImgItem)},n(2,i=l[0]),[u,h,i,c,f,d,m,r,s,p]}class h1 extends qe{constructor(e){super(),Be(this,e,d1,f1,je,{mainImgItem:7,compareImgItem:8})}}const vb="";function m1(t){let e,n,i,r,s,o,l,a,c,u,h;return n=new zi({props:{targetHtmlId:t[0],tooltipText:t[1]}}),{c(){e=b("div"),ve(n.$$.fragment),i=j(),r=b("button"),s=Wt("svg"),o=Wt("path"),l=Wt("path"),a=Wt("path"),v(o,"d","M53.6443 14.25C47.7042 5.33 37.7293 0 26.9801 0C16.2206 0 6.24576 5.33 0.305653 14.25L0 14.71L0.305653 15.17C6.24576 24.09 16.2206 29.42 26.9801 29.42C37.7293 29.42 47.7042 24.09 53.6443 15.16L53.95 14.71L53.6443 14.25ZM3.25025 14.71C7.63146 8.69001 14.0606 4.65 21.2641 3.22C20.0619 3.83 18.9411 4.62 17.963 5.59C15.5176 8.02 14.1625 11.25 14.1625 14.67C14.1625 18.11 15.5176 21.34 17.963 23.76C19.0124 24.79 20.1943 25.61 21.4781 26.23C14.1829 24.85 7.6824 20.78 3.25025 14.71ZM27.1125 22.64C22.7008 22.64 19.1041 19.08 19.1041 14.7C19.1041 12.59 19.9396 10.6 21.4475 9.10001C22.9555 7.60001 24.9729 6.77 27.1125 6.77C29.2522 6.77 31.2594 7.60001 32.7775 9.10001C34.2855 10.6 35.121 12.59 35.121 14.7C35.121 16.82 34.2855 18.82 32.7775 20.32C31.2594 21.81 29.242 22.64 27.1125 22.64ZM32.9915 26.14C34.204 25.53 35.3146 24.74 36.3029 23.77C38.7482 21.34 40.0932 18.11 40.0932 14.68C40.0932 9.75 37.281 5.47001 33.1647 3.32001C40.1747 4.81001 46.4102 8.83001 50.6896 14.71C46.3797 20.64 40.0728 24.67 32.9915 26.14Z"),v(o,"fill","black"),v(o,"class","svelte-19wutme"),v(l,"d","M26.9804 25.98C33.3222 25.98 38.4633 20.9343 38.4633 14.71C38.4633 8.48576 33.3222 3.44 26.9804 3.44C20.6386 3.44 15.4976 8.48576 15.4976 14.71C15.4976 20.9343 20.6386 25.98 26.9804 25.98Z"),v(l,"fill","black"),v(l,"class","svelte-19wutme"),v(a,"d","M17.9529 23.85L36.2928 5.85001"),v(a,"stroke","black"),v(a,"stroke-width","3"),v(a,"stroke-miterlimit","10"),v(a,"class","svelte-19wutme"),v(s,"width","54"),v(s,"height","30"),v(s,"viewBox","0 0 54 30"),v(s,"fill","none"),v(s,"xmlns","http://www.w3.org/2000/svg"),v(s,"class","svelte-19wutme"),v(r,"class","button tag svelte-19wutme"),v(r,"title",t[1]),v(e,"id",t[0])},m(f,d){$(f,e,d),pe(n,e,null),y(e,i),y(e,r),y(r,s),y(s,o),y(s,l),y(s,a),c=!0,u||(h=Ae(r,"click",t[2]),u=!0)},p:ie,i(f){c||(H(n.$$.fragment,f),c=!0)},o(f){B(n.$$.fragment,f),c=!1},d(f){f&&D(e),ge(n),u=!1,h()}}}function p1(t,e,n){let i,r,{mainImgItem:s}=e,{compareImgItem:o=void 0}=e;$n("isInModal",!0);const l=`modal-opener-${window.crypto.randomUUID()}`,a=U==="fr"?"Vue détaillée":"Detailed view",c=(f,d)=>(f?(d=new h1({target:document.querySelector("body"),props:{mainImgItem:s,compareImgItem:o}}),d.$on("closeModal",h)):!f&&r!=null&&d.$destroy(),d),u=()=>n(5,i=!i),h=()=>n(5,i=!1);return t.$$set=f=>{"mainImgItem"in f&&n(3,s=f.mainImgItem),"compareImgItem"in f&&n(4,o=f.compareImgItem)},t.$$.update=()=>{t.$$.dirty&96&&n(6,r=c(i,r))},n(5,i=!1),[l,a,u,s,o,i,r]}class g1 extends qe{constructor(e){super(),Be(this,e,p1,m1,je,{mainImgItem:3,compareImgItem:4})}}const _1=Object.freeze(Object.defineProperty({__proto__:null,default:g1},Symbol.toStringTag,{value:"Module"})),yb="";function v1(t){let e,n,i,r,s,o,l;return{c(){e=b("button"),n=b("span"),n.innerHTML='<span class="switch-control svelte-g5g8im"><span class="switch-spot"></span></span>',i=j(),r=b("span"),s=re(t[0]),v(n,"class","switch mr-2 svelte-g5g8im"),v(r,"class","label svelte-g5g8im"),v(e,"id",t[3]),v(e,"name",t[3]),v(e,"class","input-checkbox-wrapper is-flex is-align-items-center-is-justify-content-center p-2 pl-3 pr-3 svelte-g5g8im"),v(e,"aria-label",t[0]),Ge(e,"is-checked",t[2]),Ge(e,"is-clickable",t[1]),Ge(e,"button",t[1])},m(a,c){$(a,e,c),y(e,n),y(e,i),y(e,r),y(r,s),o||(l=Ae(e,"click",sn(t[4])),o=!0)},p(a,[c]){c&1&&Le(s,a[0]),c&1&&v(e,"aria-label",a[0]),c&4&&Ge(e,"is-checked",a[2]),c&2&&Ge(e,"is-clickable",a[1]),c&2&&Ge(e,"button",a[1])},i:ie,o:ie,d(a){a&&D(e),o=!1,l()}}}function y1(t,e,n){let i,{toggleLabel:r}=e,{start:s=!1}=e,{buttonDisplay:o=!1}=e;const l=`input-toggle-${window.crypto.randomUUID()}`,a=Ti(),c=zt("resetTrigger")||void 0;c==null||c.subscribe(h);const u=()=>n(2,i=!i);function h(){n(2,i=s)}return t.$$set=f=>{"toggleLabel"in f&&n(0,r=f.toggleLabel),"start"in f&&n(5,s=f.start),"buttonDisplay"in f&&n(1,o=f.buttonDisplay)},t.$$.update=()=>{t.$$.dirty&32&&n(2,i=s),t.$$.dirty&4&&a("updateChecked",i)},[r,o,i,l,u,s]}class b1 extends qe{constructor(e){super(),Be(this,e,y1,v1,je,{toggleLabel:0,start:5,buttonDisplay:1})}}/*! choices.js v11.1.0 | © 2025 Josh Johnson | https://github.com/jshjohnson/Choices#readme */var ms=function(t,e){return ms=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(n[r]=i[r])},ms(t,e)};function nc(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");ms(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}var Dt=function(){return Dt=Object.assign||function(e){for(var n,i=1,r=arguments.length;i<r;i++){n=arguments[i];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},Dt.apply(this,arguments)};function w1(t,e,n){if(n||arguments.length===2)for(var i=0,r=e.length,s;i<r;i++)(s||!(i in e))&&(s||(s=Array.prototype.slice.call(e,0,i)),s[i]=e[i]);return t.concat(s||Array.prototype.slice.call(e))}typeof SuppressedError=="function"&&SuppressedError;var pt={ADD_CHOICE:"ADD_CHOICE",REMOVE_CHOICE:"REMOVE_CHOICE",FILTER_CHOICES:"FILTER_CHOICES",ACTIVATE_CHOICES:"ACTIVATE_CHOICES",CLEAR_CHOICES:"CLEAR_CHOICES",ADD_GROUP:"ADD_GROUP",ADD_ITEM:"ADD_ITEM",REMOVE_ITEM:"REMOVE_ITEM",HIGHLIGHT_ITEM:"HIGHLIGHT_ITEM"},Rt={showDropdown:"showDropdown",hideDropdown:"hideDropdown",change:"change",choice:"choice",search:"search",addItem:"addItem",removeItem:"removeItem",highlightItem:"highlightItem",highlightChoice:"highlightChoice",unhighlightItem:"unhighlightItem"},Ct={TAB_KEY:9,SHIFT_KEY:16,BACK_KEY:46,DELETE_KEY:8,ENTER_KEY:13,A_KEY:65,ESC_KEY:27,UP_KEY:38,DOWN_KEY:40,PAGE_UP_KEY:33,PAGE_DOWN_KEY:34},S1=["fuseOptions","classNames"],wn={Text:"text",SelectOne:"select-one",SelectMultiple:"select-multiple"},ic=function(t){return{type:pt.ADD_CHOICE,choice:t}},k1=function(t){return{type:pt.REMOVE_CHOICE,choice:t}},E1=function(t){return{type:pt.FILTER_CHOICES,results:t}},C1=function(t){return{type:pt.ACTIVATE_CHOICES,active:t}},I1=function(t){return{type:pt.ADD_GROUP,group:t}},rc=function(t){return{type:pt.ADD_ITEM,item:t}},sc=function(t){return{type:pt.REMOVE_ITEM,item:t}},hr=function(t,e){return{type:pt.HIGHLIGHT_ITEM,item:t,highlighted:e}},x1=function(t,e){return Math.floor(Math.random()*(e-t)+t)},oc=function(t){return Array.from({length:t},function(){return x1(0,36).toString(36)}).join("")},M1=function(t,e){var n=t.id||t.name&&"".concat(t.name,"-").concat(oc(2))||oc(4);return n=n.replace(/(:|\.|\[|\]|,)/g,""),n="".concat(e,"-").concat(n),n},A1=function(t,e,n){n===void 0&&(n=1);for(var i="".concat(n>0?"next":"previous","ElementSibling"),r=t[i];r;){if(r.matches(e))return r;r=r[i]}return null},T1=function(t,e,n){n===void 0&&(n=1);var i;return n>0?i=e.scrollTop+e.offsetHeight>=t.offsetTop+t.offsetHeight:i=t.offsetTop>=e.scrollTop,i},mr=function(t){if(typeof t!="string"){if(t==null)return"";if(typeof t=="object"){if("raw"in t)return mr(t.raw);if("trusted"in t)return t.trusted}return t}return t.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/'/g,"&#039;").replace(/"/g,"&quot;")},N1=function(){var t=document.createElement("div");return function(e){t.innerHTML=e.trim();for(var n=t.children[0];t.firstChild;)t.removeChild(t.firstChild);return n}}(),yi=function(t,e){return typeof t=="function"?t(mr(e),e):t},lc=function(t){return typeof t=="function"?t():t},Mn=function(t){if(typeof t=="string")return t;if(typeof t=="object"){if("trusted"in t)return t.trusted;if("raw"in t)return t.raw}return""},ac=function(t){if(typeof t=="string")return t;if(typeof t=="object"){if("escaped"in t)return t.escaped;if("trusted"in t)return t.trusted}return""},ps=function(t,e){return t?ac(e):mr(e)},fn=function(t,e,n){t.innerHTML=ps(e,n)},P1=function(t,e){var n=t.value,i=t.label,r=i===void 0?n:i,s=e.value,o=e.label,l=o===void 0?s:o;return Mn(r).localeCompare(Mn(l),[],{sensitivity:"base",ignorePunctuation:!0,numeric:!0})},O1=function(t,e){return t.rank-e.rank},L1=function(t,e,n){n===void 0&&(n=null);var i=new CustomEvent(e,{detail:n,bubbles:!0,cancelable:!0});return t.dispatchEvent(i)},D1=function(t,e){var n=Object.keys(t).sort(),i=Object.keys(e).sort();return n.filter(function(r){return i.indexOf(r)<0})},pr=function(t){return Array.isArray(t)?t:[t]},bi=function(t){return t&&Array.isArray(t)?t.map(function(e){return".".concat(e)}).join(""):".".concat(t)},$e=function(t,e){var n;(n=t.classList).add.apply(n,pr(e))},tn=function(t,e){var n;(n=t.classList).remove.apply(n,pr(e))},R1=function(t){if(typeof t<"u")try{return JSON.parse(t)}catch{return t}return{}},$1=function(t,e,n){var i=t.itemEl;i&&(tn(i,n),$e(i,e))},z1=function(){function t(e){var n=e.element,i=e.type,r=e.classNames;this.element=n,this.classNames=r,this.type=i,this.isActive=!1}return t.prototype.show=function(){return $e(this.element,this.classNames.activeState),this.element.setAttribute("aria-expanded","true"),this.isActive=!0,this},t.prototype.hide=function(){return tn(this.element,this.classNames.activeState),this.element.setAttribute("aria-expanded","false"),this.isActive=!1,this},t}(),cc=function(){function t(e){var n=e.element,i=e.type,r=e.classNames,s=e.position;this.element=n,this.classNames=r,this.type=i,this.position=s,this.isOpen=!1,this.isFlipped=!1,this.isDisabled=!1,this.isLoading=!1}return t.prototype.shouldFlip=function(e,n){var i=!1;return this.position==="auto"?i=this.element.getBoundingClientRect().top-n>=0&&!window.matchMedia("(min-height: ".concat(e+1,"px)")).matches:this.position==="top"&&(i=!0),i},t.prototype.setActiveDescendant=function(e){this.element.setAttribute("aria-activedescendant",e)},t.prototype.removeActiveDescendant=function(){this.element.removeAttribute("aria-activedescendant")},t.prototype.open=function(e,n){$e(this.element,this.classNames.openState),this.element.setAttribute("aria-expanded","true"),this.isOpen=!0,this.shouldFlip(e,n)&&($e(this.element,this.classNames.flippedState),this.isFlipped=!0)},t.prototype.close=function(){tn(this.element,this.classNames.openState),this.element.setAttribute("aria-expanded","false"),this.removeActiveDescendant(),this.isOpen=!1,this.isFlipped&&(tn(this.element,this.classNames.flippedState),this.isFlipped=!1)},t.prototype.addFocusState=function(){$e(this.element,this.classNames.focusState)},t.prototype.removeFocusState=function(){tn(this.element,this.classNames.focusState)},t.prototype.enable=function(){tn(this.element,this.classNames.disabledState),this.element.removeAttribute("aria-disabled"),this.type===wn.SelectOne&&this.element.setAttribute("tabindex","0"),this.isDisabled=!1},t.prototype.disable=function(){$e(this.element,this.classNames.disabledState),this.element.setAttribute("aria-disabled","true"),this.type===wn.SelectOne&&this.element.setAttribute("tabindex","-1"),this.isDisabled=!0},t.prototype.wrap=function(e){var n=this.element,i=e.parentNode;i&&(e.nextSibling?i.insertBefore(n,e.nextSibling):i.appendChild(n)),n.appendChild(e)},t.prototype.unwrap=function(e){var n=this.element,i=n.parentNode;i&&(i.insertBefore(e,n),i.removeChild(n))},t.prototype.addLoadingState=function(){$e(this.element,this.classNames.loadingState),this.element.setAttribute("aria-busy","true"),this.isLoading=!0},t.prototype.removeLoadingState=function(){tn(this.element,this.classNames.loadingState),this.element.removeAttribute("aria-busy"),this.isLoading=!1},t}(),j1=function(){function t(e){var n=e.element,i=e.type,r=e.classNames,s=e.preventPaste;this.element=n,this.type=i,this.classNames=r,this.preventPaste=s,this.isFocussed=this.element.isEqualNode(document.activeElement),this.isDisabled=n.disabled,this._onPaste=this._onPaste.bind(this),this._onInput=this._onInput.bind(this),this._onFocus=this._onFocus.bind(this),this._onBlur=this._onBlur.bind(this)}return Object.defineProperty(t.prototype,"placeholder",{set:function(e){this.element.placeholder=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){return this.element.value},set:function(e){this.element.value=e},enumerable:!1,configurable:!0}),t.prototype.addEventListeners=function(){var e=this.element;e.addEventListener("paste",this._onPaste),e.addEventListener("input",this._onInput,{passive:!0}),e.addEventListener("focus",this._onFocus,{passive:!0}),e.addEventListener("blur",this._onBlur,{passive:!0})},t.prototype.removeEventListeners=function(){var e=this.element;e.removeEventListener("input",this._onInput),e.removeEventListener("paste",this._onPaste),e.removeEventListener("focus",this._onFocus),e.removeEventListener("blur",this._onBlur)},t.prototype.enable=function(){var e=this.element;e.removeAttribute("disabled"),this.isDisabled=!1},t.prototype.disable=function(){var e=this.element;e.setAttribute("disabled",""),this.isDisabled=!0},t.prototype.focus=function(){this.isFocussed||this.element.focus()},t.prototype.blur=function(){this.isFocussed&&this.element.blur()},t.prototype.clear=function(e){return e===void 0&&(e=!0),this.element.value="",e&&this.setWidth(),this},t.prototype.setWidth=function(){var e=this.element;e.style.minWidth="".concat(e.placeholder.length+1,"ch"),e.style.width="".concat(e.value.length+1,"ch")},t.prototype.setActiveDescendant=function(e){this.element.setAttribute("aria-activedescendant",e)},t.prototype.removeActiveDescendant=function(){this.element.removeAttribute("aria-activedescendant")},t.prototype._onInput=function(){this.type!==wn.SelectOne&&this.setWidth()},t.prototype._onPaste=function(e){this.preventPaste&&e.preventDefault()},t.prototype._onFocus=function(){this.isFocussed=!0},t.prototype._onBlur=function(){this.isFocussed=!1},t}(),F1=4,uc=function(){function t(e){var n=e.element;this.element=n,this.scrollPos=this.element.scrollTop,this.height=this.element.offsetHeight}return t.prototype.prepend=function(e){var n=this.element.firstElementChild;n?this.element.insertBefore(e,n):this.element.append(e)},t.prototype.scrollToTop=function(){this.element.scrollTop=0},t.prototype.scrollToChildElement=function(e,n){var i=this;if(e){var r=this.element.offsetHeight,s=this.element.scrollTop+r,o=e.offsetHeight,l=e.offsetTop+o,a=n>0?this.element.scrollTop+l-s:e.offsetTop;requestAnimationFrame(function(){i._animateScroll(a,n)})}},t.prototype._scrollDown=function(e,n,i){var r=(i-e)/n,s=r>1?r:1;this.element.scrollTop=e+s},t.prototype._scrollUp=function(e,n,i){var r=(e-i)/n,s=r>1?r:1;this.element.scrollTop=e-s},t.prototype._animateScroll=function(e,n){var i=this,r=F1,s=this.element.scrollTop,o=!1;n>0?(this._scrollDown(s,r,e),s<e&&(o=!0)):(this._scrollUp(s,r,e),s>e&&(o=!0)),o&&requestAnimationFrame(function(){i._animateScroll(e,n)})},t}(),fc=function(){function t(e){var n=e.element,i=e.classNames;this.element=n,this.classNames=i,this.isDisabled=!1}return Object.defineProperty(t.prototype,"isActive",{get:function(){return this.element.dataset.choice==="active"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dir",{get:function(){return this.element.dir},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){return this.element.value},set:function(e){this.element.setAttribute("value",e),this.element.value=e},enumerable:!1,configurable:!0}),t.prototype.conceal=function(){var e=this.element;$e(e,this.classNames.input),e.hidden=!0,e.tabIndex=-1;var n=e.getAttribute("style");n&&e.setAttribute("data-choice-orig-style",n),e.setAttribute("data-choice","active")},t.prototype.reveal=function(){var e=this.element;tn(e,this.classNames.input),e.hidden=!1,e.removeAttribute("tabindex");var n=e.getAttribute("data-choice-orig-style");n?(e.removeAttribute("data-choice-orig-style"),e.setAttribute("style",n)):e.removeAttribute("style"),e.removeAttribute("data-choice")},t.prototype.enable=function(){this.element.removeAttribute("disabled"),this.element.disabled=!1,this.isDisabled=!1},t.prototype.disable=function(){this.element.setAttribute("disabled",""),this.element.disabled=!0,this.isDisabled=!0},t.prototype.triggerEvent=function(e,n){L1(this.element,e,n||{})},t}(),H1=function(t){nc(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e}(fc),wi=function(t,e){return e===void 0&&(e=!0),typeof t>"u"?e:!!t},dc=function(t){if(typeof t=="string"&&(t=t.split(" ").filter(function(e){return e.length})),Array.isArray(t)&&t.length)return t},nn=function(t,e,n){if(n===void 0&&(n=!0),typeof t=="string"){var i=mr(t),r=n||i===t?t:{escaped:i,raw:t},s=nn({value:t,label:r,selected:!0},!1);return s}var o=t;if("choices"in o){if(!e)throw new TypeError("optGroup is not allowed");var l=o,a=l.choices.map(function(f){return nn(f,!1)}),c={id:0,label:Mn(l.label)||l.value,active:!!a.length,disabled:!!l.disabled,choices:a};return c}var u=o,h={id:0,group:null,score:0,rank:0,value:u.value,label:u.label||u.value,active:wi(u.active),selected:wi(u.selected,!1),disabled:wi(u.disabled,!1),placeholder:wi(u.placeholder,!1),highlighted:!1,labelClass:dc(u.labelClass),labelDescription:u.labelDescription,customProperties:u.customProperties};return h},V1=function(t){return t.tagName==="INPUT"},hc=function(t){return t.tagName==="SELECT"},U1=function(t){return t.tagName==="OPTION"},B1=function(t){return t.tagName==="OPTGROUP"},q1=function(t){nc(e,t);function e(n){var i=n.element,r=n.classNames,s=n.template,o=n.extractPlaceholder,l=t.call(this,{element:i,classNames:r})||this;return l.template=s,l.extractPlaceholder=o,l}return Object.defineProperty(e.prototype,"placeholderOption",{get:function(){return this.element.querySelector('option[value=""]')||this.element.querySelector("option[placeholder]")},enumerable:!1,configurable:!0}),e.prototype.addOptions=function(n){var i=this,r=document.createDocumentFragment();n.forEach(function(s){var o=s;if(!o.element){var l=i.template(o);r.appendChild(l),o.element=l}}),this.element.appendChild(r)},e.prototype.optionsAsChoices=function(){var n=this,i=[];return this.element.querySelectorAll(":scope > option, :scope > optgroup").forEach(function(r){U1(r)?i.push(n._optionToChoice(r)):B1(r)&&i.push(n._optgroupToChoice(r))}),i},e.prototype._optionToChoice=function(n){return!n.hasAttribute("value")&&n.hasAttribute("placeholder")&&(n.setAttribute("value",""),n.value=""),{id:0,group:null,score:0,rank:0,value:n.value,label:n.label,element:n,active:!0,selected:this.extractPlaceholder?n.selected:n.hasAttribute("selected"),disabled:n.disabled,highlighted:!1,placeholder:this.extractPlaceholder&&(!n.value||n.hasAttribute("placeholder")),labelClass:typeof n.dataset.labelClass<"u"?dc(n.dataset.labelClass):void 0,labelDescription:typeof n.dataset.labelDescription<"u"?n.dataset.labelDescription:void 0,customProperties:R1(n.dataset.customProperties)}},e.prototype._optgroupToChoice=function(n){var i=this,r=n.querySelectorAll("option"),s=Array.from(r).map(function(o){return i._optionToChoice(o)});return{id:0,label:n.label||"",element:n,active:!!s.length,disabled:n.disabled,choices:s}},e}(fc),K1={containerOuter:["choices"],containerInner:["choices__inner"],input:["choices__input"],inputCloned:["choices__input--cloned"],list:["choices__list"],listItems:["choices__list--multiple"],listSingle:["choices__list--single"],listDropdown:["choices__list--dropdown"],item:["choices__item"],itemSelectable:["choices__item--selectable"],itemDisabled:["choices__item--disabled"],itemChoice:["choices__item--choice"],description:["choices__description"],placeholder:["choices__placeholder"],group:["choices__group"],groupHeading:["choices__heading"],button:["choices__button"],activeState:["is-active"],focusState:["is-focused"],openState:["is-open"],disabledState:["is-disabled"],highlightedState:["is-highlighted"],selectedState:["is-selected"],flippedState:["is-flipped"],loadingState:["is-loading"],notice:["choices__notice"],addChoice:["choices__item--selectable","add-choice"],noResults:["has-no-results"],noChoices:["has-no-choices"]},mc={items:[],choices:[],silent:!1,renderChoiceLimit:-1,maxItemCount:-1,closeDropdownOnSelect:"auto",singleModeForMultiSelect:!1,addChoices:!1,addItems:!0,addItemFilter:function(t){return!!t&&t!==""},removeItems:!0,removeItemButton:!1,removeItemButtonAlignLeft:!1,editItems:!1,allowHTML:!1,allowHtmlUserInput:!1,duplicateItemsAllowed:!0,delimiter:",",paste:!0,searchEnabled:!0,searchChoices:!0,searchFloor:1,searchResultLimit:4,searchFields:["label","value"],position:"auto",resetScrollPosition:!0,shouldSort:!0,shouldSortItems:!1,sorter:P1,shadowRoot:null,placeholder:!0,placeholderValue:null,searchPlaceholderValue:null,prependValue:null,appendValue:null,renderSelectedChoices:"auto",loadingText:"Loading...",noResultsText:"No results found",noChoicesText:"No choices to choose from",itemSelectText:"Press to select",uniqueItemText:"Only unique values can be added",customAddItemText:"Only values matching specific conditions can be added",addItemText:function(t){return'Press Enter to add <b>"'.concat(t,'"</b>')},removeItemIconText:function(){return"Remove item"},removeItemLabelText:function(t){return"Remove item: ".concat(t)},maxItemText:function(t){return"Only ".concat(t," values can be added")},valueComparer:function(t,e){return t===e},fuseOptions:{includeScore:!0},labelId:"",callbackOnInit:null,callbackOnCreateTemplates:null,classNames:K1,appendGroupInSearch:!1},pc=function(t){var e=t.itemEl;e&&(e.remove(),t.itemEl=void 0)};function W1(t,e,n){var i=t,r=!0;switch(e.type){case pt.ADD_ITEM:{e.item.selected=!0;var s=e.item.element;s&&(s.selected=!0,s.setAttribute("selected","")),i.push(e.item);break}case pt.REMOVE_ITEM:{e.item.selected=!1;var s=e.item.element;if(s){s.selected=!1,s.removeAttribute("selected");var o=s.parentElement;o&&hc(o)&&o.type===wn.SelectOne&&(o.value="")}pc(e.item),i=i.filter(function(u){return u.id!==e.item.id});break}case pt.REMOVE_CHOICE:{pc(e.choice),i=i.filter(function(c){return c.id!==e.choice.id});break}case pt.HIGHLIGHT_ITEM:{var l=e.highlighted,a=i.find(function(c){return c.id===e.item.id});a&&a.highlighted!==l&&(a.highlighted=l,n&&$1(a,l?n.classNames.highlightedState:n.classNames.selectedState,l?n.classNames.selectedState:n.classNames.highlightedState));break}default:{r=!1;break}}return{state:i,update:r}}function Y1(t,e){var n=t,i=!0;switch(e.type){case pt.ADD_GROUP:{n.push(e.group);break}case pt.CLEAR_CHOICES:{n=[];break}default:{i=!1;break}}return{state:n,update:i}}function X1(t,e,n){var i=t,r=!0;switch(e.type){case pt.ADD_CHOICE:{i.push(e.choice);break}case pt.REMOVE_CHOICE:{e.choice.choiceEl=void 0,e.choice.group&&(e.choice.group.choices=e.choice.group.choices.filter(function(o){return o.id!==e.choice.id})),i=i.filter(function(o){return o.id!==e.choice.id});break}case pt.ADD_ITEM:case pt.REMOVE_ITEM:{e.item.choiceEl=void 0;break}case pt.FILTER_CHOICES:{var s=[];e.results.forEach(function(o){s[o.item.id]=o}),i.forEach(function(o){var l=s[o.id];l!==void 0?(o.score=l.score,o.rank=l.rank,o.active=!0):(o.score=0,o.rank=0,o.active=!1),n&&n.appendGroupInSearch&&(o.choiceEl=void 0)});break}case pt.ACTIVATE_CHOICES:{i.forEach(function(o){o.active=e.active,n&&n.appendGroupInSearch&&(o.choiceEl=void 0)});break}case pt.CLEAR_CHOICES:{i=[];break}default:{r=!1;break}}return{state:i,update:r}}var gc={groups:Y1,items:W1,choices:X1},G1=function(){function t(e){this._state=this.defaultState,this._listeners=[],this._txn=0,this._context=e}return Object.defineProperty(t.prototype,"defaultState",{get:function(){return{groups:[],items:[],choices:[]}},enumerable:!1,configurable:!0}),t.prototype.changeSet=function(e){return{groups:e,items:e,choices:e}},t.prototype.reset=function(){this._state=this.defaultState;var e=this.changeSet(!0);this._txn?this._changeSet=e:this._listeners.forEach(function(n){return n(e)})},t.prototype.subscribe=function(e){return this._listeners.push(e),this},t.prototype.dispatch=function(e){var n=this,i=this._state,r=!1,s=this._changeSet||this.changeSet(!1);Object.keys(gc).forEach(function(o){var l=gc[o](i[o],e,n._context);l.update&&(r=!0,s[o]=!0,i[o]=l.state)}),r&&(this._txn?this._changeSet=s:this._listeners.forEach(function(o){return o(s)}))},t.prototype.withTxn=function(e){this._txn++;try{e()}finally{if(this._txn=Math.max(0,this._txn-1),!this._txn){var n=this._changeSet;n&&(this._changeSet=void 0,this._listeners.forEach(function(i){return i(n)}))}}},Object.defineProperty(t.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"items",{get:function(){return this.state.items},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"highlightedActiveItems",{get:function(){return this.items.filter(function(e){return e.active&&e.highlighted})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"choices",{get:function(){return this.state.choices},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"activeChoices",{get:function(){return this.choices.filter(function(e){return e.active})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"searchableChoices",{get:function(){return this.choices.filter(function(e){return!e.disabled&&!e.placeholder})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"groups",{get:function(){return this.state.groups},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"activeGroups",{get:function(){var e=this;return this.state.groups.filter(function(n){var i=n.active&&!n.disabled,r=e.state.choices.some(function(s){return s.active&&!s.disabled});return i&&r},[])},enumerable:!1,configurable:!0}),t.prototype.inTxn=function(){return this._txn>0},t.prototype.getChoiceById=function(e){return this.activeChoices.find(function(n){return n.id===e})},t.prototype.getGroupById=function(e){return this.groups.find(function(n){return n.id===e})},t}(),wt={noChoices:"no-choices",noResults:"no-results",addChoice:"add-choice",generic:""};function J1(t,e,n){return(e=Z1(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function _c(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function Qn(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?_c(Object(n),!0).forEach(function(i){J1(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):_c(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}function Q1(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var i=n.call(t,e||"default");if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function Z1(t){var e=Q1(t,"string");return typeof e=="symbol"?e:e+""}function dn(t){return Array.isArray?Array.isArray(t):bc(t)==="[object Array]"}const ev=1/0;function tv(t){if(typeof t=="string")return t;let e=t+"";return e=="0"&&1/t==-ev?"-0":e}function nv(t){return t==null?"":tv(t)}function rn(t){return typeof t=="string"}function vc(t){return typeof t=="number"}function iv(t){return t===!0||t===!1||rv(t)&&bc(t)=="[object Boolean]"}function yc(t){return typeof t=="object"}function rv(t){return yc(t)&&t!==null}function Ht(t){return t!=null}function gs(t){return!t.trim().length}function bc(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(t)}const bb="Extended search is not available",sv="Incorrect 'index' type",ov=t=>`Invalid value for key ${t}`,lv=t=>`Pattern length exceeds max of ${t}.`,av=t=>`Missing ${t} property in key`,cv=t=>`Property 'weight' in key '${t}' must be a positive integer`,wc=Object.prototype.hasOwnProperty;class uv{constructor(e){this._keys=[],this._keyMap={};let n=0;e.forEach(i=>{let r=Sc(i);this._keys.push(r),this._keyMap[r.id]=r,n+=r.weight}),this._keys.forEach(i=>{i.weight/=n})}get(e){return this._keyMap[e]}keys(){return this._keys}toJSON(){return JSON.stringify(this._keys)}}function Sc(t){let e=null,n=null,i=null,r=1,s=null;if(rn(t)||dn(t))i=t,e=kc(t),n=_s(t);else{if(!wc.call(t,"name"))throw new Error(av("name"));const o=t.name;if(i=o,wc.call(t,"weight")&&(r=t.weight,r<=0))throw new Error(cv(o));e=kc(o),n=_s(o),s=t.getFn}return{path:e,id:n,weight:r,src:i,getFn:s}}function kc(t){return dn(t)?t:t.split(".")}function _s(t){return dn(t)?t.join("."):t}function fv(t,e){let n=[],i=!1;const r=(s,o,l)=>{if(Ht(s))if(!o[l])n.push(s);else{let a=o[l];const c=s[a];if(!Ht(c))return;if(l===o.length-1&&(rn(c)||vc(c)||iv(c)))n.push(nv(c));else if(dn(c)){i=!0;for(let u=0,h=c.length;u<h;u+=1)r(c[u],o,l+1)}else o.length&&r(c,o,l+1)}};return r(t,rn(e)?e.split("."):e,0),i?n:n[0]}const dv={includeMatches:!1,findAllMatches:!1,minMatchCharLength:1},hv={isCaseSensitive:!1,includeScore:!1,keys:[],shouldSort:!0,sortFn:(t,e)=>t.score===e.score?t.idx<e.idx?-1:1:t.score<e.score?-1:1},mv={location:0,threshold:.6,distance:100},pv={useExtendedSearch:!1,getFn:fv,ignoreLocation:!1,ignoreFieldNorm:!1,fieldNormWeight:1};var Ne=Qn(Qn(Qn(Qn({},hv),dv),mv),pv);const gv=/[^ ]+/g;function _v(t=1,e=3){const n=new Map,i=Math.pow(10,e);return{get(r){const s=r.match(gv).length;if(n.has(s))return n.get(s);const o=1/Math.pow(s,.5*t),l=parseFloat(Math.round(o*i)/i);return n.set(s,l),l},clear(){n.clear()}}}class vs{constructor({getFn:e=Ne.getFn,fieldNormWeight:n=Ne.fieldNormWeight}={}){this.norm=_v(n,3),this.getFn=e,this.isCreated=!1,this.setIndexRecords()}setSources(e=[]){this.docs=e}setIndexRecords(e=[]){this.records=e}setKeys(e=[]){this.keys=e,this._keysMap={},e.forEach((n,i)=>{this._keysMap[n.id]=i})}create(){this.isCreated||!this.docs.length||(this.isCreated=!0,rn(this.docs[0])?this.docs.forEach((e,n)=>{this._addString(e,n)}):this.docs.forEach((e,n)=>{this._addObject(e,n)}),this.norm.clear())}add(e){const n=this.size();rn(e)?this._addString(e,n):this._addObject(e,n)}removeAt(e){this.records.splice(e,1);for(let n=e,i=this.size();n<i;n+=1)this.records[n].i-=1}getValueForItemAtKeyId(e,n){return e[this._keysMap[n]]}size(){return this.records.length}_addString(e,n){if(!Ht(e)||gs(e))return;let i={v:e,i:n,n:this.norm.get(e)};this.records.push(i)}_addObject(e,n){let i={i:n,$:{}};this.keys.forEach((r,s)=>{let o=r.getFn?r.getFn(e):this.getFn(e,r.path);if(Ht(o)){if(dn(o)){let l=[];const a=[{nestedArrIndex:-1,value:o}];for(;a.length;){const{nestedArrIndex:c,value:u}=a.pop();if(Ht(u))if(rn(u)&&!gs(u)){let h={v:u,i:c,n:this.norm.get(u)};l.push(h)}else dn(u)&&u.forEach((h,f)=>{a.push({nestedArrIndex:f,value:h})})}i.$[s]=l}else if(rn(o)&&!gs(o)){let l={v:o,n:this.norm.get(o)};i.$[s]=l}}}),this.records.push(i)}toJSON(){return{keys:this.keys,records:this.records}}}function Ec(t,e,{getFn:n=Ne.getFn,fieldNormWeight:i=Ne.fieldNormWeight}={}){const r=new vs({getFn:n,fieldNormWeight:i});return r.setKeys(t.map(Sc)),r.setSources(e),r.create(),r}function vv(t,{getFn:e=Ne.getFn,fieldNormWeight:n=Ne.fieldNormWeight}={}){const{keys:i,records:r}=t,s=new vs({getFn:e,fieldNormWeight:n});return s.setKeys(i),s.setIndexRecords(r),s}function gr(t,{errors:e=0,currentLocation:n=0,expectedLocation:i=0,distance:r=Ne.distance,ignoreLocation:s=Ne.ignoreLocation}={}){const o=e/t.length;if(s)return o;const l=Math.abs(i-n);return r?o+l/r:l?1:o}function yv(t=[],e=Ne.minMatchCharLength){let n=[],i=-1,r=-1,s=0;for(let o=t.length;s<o;s+=1){let l=t[s];l&&i===-1?i=s:!l&&i!==-1&&(r=s-1,r-i+1>=e&&n.push([i,r]),i=-1)}return t[s-1]&&s-i>=e&&n.push([i,s-1]),n}const An=32;function bv(t,e,n,{location:i=Ne.location,distance:r=Ne.distance,threshold:s=Ne.threshold,findAllMatches:o=Ne.findAllMatches,minMatchCharLength:l=Ne.minMatchCharLength,includeMatches:a=Ne.includeMatches,ignoreLocation:c=Ne.ignoreLocation}={}){if(e.length>An)throw new Error(lv(An));const u=e.length,h=t.length,f=Math.max(0,Math.min(i,h));let d=s,m=f;const p=l>1||a,g=p?Array(h):[];let _;for(;(_=t.indexOf(e,m))>-1;){let M=gr(e,{currentLocation:_,expectedLocation:f,distance:r,ignoreLocation:c});if(d=Math.min(M,d),m=_+u,p){let E=0;for(;E<u;)g[_+E]=1,E+=1}}m=-1;let k=[],C=1,w=u+h;const S=1<<u-1;for(let M=0;M<u;M+=1){let E=0,I=w;for(;E<I;)gr(e,{errors:M,currentLocation:f+I,expectedLocation:f,distance:r,ignoreLocation:c})<=d?E=I:w=I,I=Math.floor((w-E)/2+E);w=I;let O=Math.max(1,f-I+1),L=o?h:Math.min(f+I,h)+u,F=Array(L+2);F[L+1]=(1<<M)-1;for(let x=L;x>=O;x-=1){let V=x-1,P=n[t.charAt(V)];if(p&&(g[V]=+!!P),F[x]=(F[x+1]<<1|1)&P,M&&(F[x]|=(k[x+1]|k[x])<<1|1|k[x+1]),F[x]&S&&(C=gr(e,{errors:M,currentLocation:V,expectedLocation:f,distance:r,ignoreLocation:c}),C<=d)){if(d=C,m=V,m<=f)break;O=Math.max(1,2*f-m)}}if(gr(e,{errors:M+1,currentLocation:f,expectedLocation:f,distance:r,ignoreLocation:c})>d)break;k=F}const N={isMatch:m>=0,score:Math.max(.001,C)};if(p){const M=yv(g,l);M.length?a&&(N.indices=M):N.isMatch=!1}return N}function wv(t){let e={};for(let n=0,i=t.length;n<i;n+=1){const r=t.charAt(n);e[r]=(e[r]||0)|1<<i-n-1}return e}class Cc{constructor(e,{location:n=Ne.location,threshold:i=Ne.threshold,distance:r=Ne.distance,includeMatches:s=Ne.includeMatches,findAllMatches:o=Ne.findAllMatches,minMatchCharLength:l=Ne.minMatchCharLength,isCaseSensitive:a=Ne.isCaseSensitive,ignoreLocation:c=Ne.ignoreLocation}={}){if(this.options={location:n,threshold:i,distance:r,includeMatches:s,findAllMatches:o,minMatchCharLength:l,isCaseSensitive:a,ignoreLocation:c},this.pattern=a?e:e.toLowerCase(),this.chunks=[],!this.pattern.length)return;const u=(f,d)=>{this.chunks.push({pattern:f,alphabet:wv(f),startIndex:d})},h=this.pattern.length;if(h>An){let f=0;const d=h%An,m=h-d;for(;f<m;)u(this.pattern.substr(f,An),f),f+=An;if(d){const p=h-An;u(this.pattern.substr(p),p)}}else u(this.pattern,0)}searchIn(e){const{isCaseSensitive:n,includeMatches:i}=this.options;if(n||(e=e.toLowerCase()),this.pattern===e){let m={isMatch:!0,score:0};return i&&(m.indices=[[0,e.length-1]]),m}const{location:r,distance:s,threshold:o,findAllMatches:l,minMatchCharLength:a,ignoreLocation:c}=this.options;let u=[],h=0,f=!1;this.chunks.forEach(({pattern:m,alphabet:p,startIndex:g})=>{const{isMatch:_,score:k,indices:C}=bv(e,m,p,{location:r+g,distance:s,threshold:o,findAllMatches:l,minMatchCharLength:a,includeMatches:i,ignoreLocation:c});_&&(f=!0),h+=k,_&&C&&(u=[...u,...C])});let d={isMatch:f,score:f?h/this.chunks.length:1};return f&&i&&(d.indices=u),d}}class Sn{constructor(e){this.pattern=e}static isMultiMatch(e){return Ic(e,this.multiRegex)}static isSingleMatch(e){return Ic(e,this.singleRegex)}search(){}}function Ic(t,e){const n=t.match(e);return n?n[1]:null}class Sv extends Sn{constructor(e){super(e)}static get type(){return"exact"}static get multiRegex(){return/^="(.*)"$/}static get singleRegex(){return/^=(.*)$/}search(e){const n=e===this.pattern;return{isMatch:n,score:n?0:1,indices:[0,this.pattern.length-1]}}}class kv extends Sn{constructor(e){super(e)}static get type(){return"inverse-exact"}static get multiRegex(){return/^!"(.*)"$/}static get singleRegex(){return/^!(.*)$/}search(e){const i=e.indexOf(this.pattern)===-1;return{isMatch:i,score:i?0:1,indices:[0,e.length-1]}}}class Ev extends Sn{constructor(e){super(e)}static get type(){return"prefix-exact"}static get multiRegex(){return/^\^"(.*)"$/}static get singleRegex(){return/^\^(.*)$/}search(e){const n=e.startsWith(this.pattern);return{isMatch:n,score:n?0:1,indices:[0,this.pattern.length-1]}}}class Cv extends Sn{constructor(e){super(e)}static get type(){return"inverse-prefix-exact"}static get multiRegex(){return/^!\^"(.*)"$/}static get singleRegex(){return/^!\^(.*)$/}search(e){const n=!e.startsWith(this.pattern);return{isMatch:n,score:n?0:1,indices:[0,e.length-1]}}}class Iv extends Sn{constructor(e){super(e)}static get type(){return"suffix-exact"}static get multiRegex(){return/^"(.*)"\$$/}static get singleRegex(){return/^(.*)\$$/}search(e){const n=e.endsWith(this.pattern);return{isMatch:n,score:n?0:1,indices:[e.length-this.pattern.length,e.length-1]}}}class xv extends Sn{constructor(e){super(e)}static get type(){return"inverse-suffix-exact"}static get multiRegex(){return/^!"(.*)"\$$/}static get singleRegex(){return/^!(.*)\$$/}search(e){const n=!e.endsWith(this.pattern);return{isMatch:n,score:n?0:1,indices:[0,e.length-1]}}}class xc extends Sn{constructor(e,{location:n=Ne.location,threshold:i=Ne.threshold,distance:r=Ne.distance,includeMatches:s=Ne.includeMatches,findAllMatches:o=Ne.findAllMatches,minMatchCharLength:l=Ne.minMatchCharLength,isCaseSensitive:a=Ne.isCaseSensitive,ignoreLocation:c=Ne.ignoreLocation}={}){super(e),this._bitapSearch=new Cc(e,{location:n,threshold:i,distance:r,includeMatches:s,findAllMatches:o,minMatchCharLength:l,isCaseSensitive:a,ignoreLocation:c})}static get type(){return"fuzzy"}static get multiRegex(){return/^"(.*)"$/}static get singleRegex(){return/^(.*)$/}search(e){return this._bitapSearch.searchIn(e)}}class Mc extends Sn{constructor(e){super(e)}static get type(){return"include"}static get multiRegex(){return/^'"(.*)"$/}static get singleRegex(){return/^'(.*)$/}search(e){let n=0,i;const r=[],s=this.pattern.length;for(;(i=e.indexOf(this.pattern,n))>-1;)n=i+s,r.push([i,n-1]);const o=!!r.length;return{isMatch:o,score:o?0:1,indices:r}}}const ys=[Sv,Mc,Ev,Cv,xv,Iv,kv,xc],Ac=ys.length,Mv=/ +(?=(?:[^\"]*\"[^\"]*\")*[^\"]*$)/,Av="|";function Tv(t,e={}){return t.split(Av).map(n=>{let i=n.trim().split(Mv).filter(s=>s&&!!s.trim()),r=[];for(let s=0,o=i.length;s<o;s+=1){const l=i[s];let a=!1,c=-1;for(;!a&&++c<Ac;){const u=ys[c];let h=u.isMultiMatch(l);h&&(r.push(new u(h,e)),a=!0)}if(!a)for(c=-1;++c<Ac;){const u=ys[c];let h=u.isSingleMatch(l);if(h){r.push(new u(h,e));break}}}return r})}const Nv=new Set([xc.type,Mc.type]);class Pv{constructor(e,{isCaseSensitive:n=Ne.isCaseSensitive,includeMatches:i=Ne.includeMatches,minMatchCharLength:r=Ne.minMatchCharLength,ignoreLocation:s=Ne.ignoreLocation,findAllMatches:o=Ne.findAllMatches,location:l=Ne.location,threshold:a=Ne.threshold,distance:c=Ne.distance}={}){this.query=null,this.options={isCaseSensitive:n,includeMatches:i,minMatchCharLength:r,findAllMatches:o,ignoreLocation:s,location:l,threshold:a,distance:c},this.pattern=n?e:e.toLowerCase(),this.query=Tv(this.pattern,this.options)}static condition(e,n){return n.useExtendedSearch}searchIn(e){const n=this.query;if(!n)return{isMatch:!1,score:1};const{includeMatches:i,isCaseSensitive:r}=this.options;e=r?e:e.toLowerCase();let s=0,o=[],l=0;for(let a=0,c=n.length;a<c;a+=1){const u=n[a];o.length=0,s=0;for(let h=0,f=u.length;h<f;h+=1){const d=u[h],{isMatch:m,indices:p,score:g}=d.search(e);if(m){if(s+=1,l+=g,i){const _=d.constructor.type;Nv.has(_)?o=[...o,...p]:o.push(p)}}else{l=0,s=0,o.length=0;break}}if(s){let h={isMatch:!0,score:l/s};return i&&(h.indices=o),h}}return{isMatch:!1,score:1}}}const bs=[];function Ov(...t){bs.push(...t)}function ws(t,e){for(let n=0,i=bs.length;n<i;n+=1){let r=bs[n];if(r.condition(t,e))return new r(t,e)}return new Cc(t,e)}const _r={AND:"$and",OR:"$or"},Ss={PATH:"$path",PATTERN:"$val"},ks=t=>!!(t[_r.AND]||t[_r.OR]),Lv=t=>!!t[Ss.PATH],Dv=t=>!dn(t)&&yc(t)&&!ks(t),Tc=t=>({[_r.AND]:Object.keys(t).map(e=>({[e]:t[e]}))});function Nc(t,e,{auto:n=!0}={}){const i=r=>{let s=Object.keys(r);const o=Lv(r);if(!o&&s.length>1&&!ks(r))return i(Tc(r));if(Dv(r)){const a=o?r[Ss.PATH]:s[0],c=o?r[Ss.PATTERN]:r[a];if(!rn(c))throw new Error(ov(a));const u={keyId:_s(a),pattern:c};return n&&(u.searcher=ws(c,e)),u}let l={children:[],operator:s[0]};return s.forEach(a=>{const c=r[a];dn(c)&&c.forEach(u=>{l.children.push(i(u))})}),l};return ks(t)||(t=Tc(t)),i(t)}function Rv(t,{ignoreFieldNorm:e=Ne.ignoreFieldNorm}){t.forEach(n=>{let i=1;n.matches.forEach(({key:r,norm:s,score:o})=>{const l=r?r.weight:null;i*=Math.pow(o===0&&l?Number.EPSILON:o,(l||1)*(e?1:s))}),n.score=i})}function $v(t,e){const n=t.matches;e.matches=[],Ht(n)&&n.forEach(i=>{if(!Ht(i.indices)||!i.indices.length)return;const{indices:r,value:s}=i;let o={indices:r,value:s};i.key&&(o.key=i.key.src),i.idx>-1&&(o.refIndex=i.idx),e.matches.push(o)})}function zv(t,e){e.score=t.score}function jv(t,e,{includeMatches:n=Ne.includeMatches,includeScore:i=Ne.includeScore}={}){const r=[];return n&&r.push($v),i&&r.push(zv),t.map(s=>{const{idx:o}=s,l={item:e[o],refIndex:o};return r.length&&r.forEach(a=>{a(s,l)}),l})}class Zn{constructor(e,n={},i){this.options=Qn(Qn({},Ne),n),this.options.useExtendedSearch,this._keyStore=new uv(this.options.keys),this.setCollection(e,i)}setCollection(e,n){if(this._docs=e,n&&!(n instanceof vs))throw new Error(sv);this._myIndex=n||Ec(this.options.keys,this._docs,{getFn:this.options.getFn,fieldNormWeight:this.options.fieldNormWeight})}add(e){Ht(e)&&(this._docs.push(e),this._myIndex.add(e))}remove(e=()=>!1){const n=[];for(let i=0,r=this._docs.length;i<r;i+=1){const s=this._docs[i];e(s,i)&&(this.removeAt(i),i-=1,r-=1,n.push(s))}return n}removeAt(e){this._docs.splice(e,1),this._myIndex.removeAt(e)}getIndex(){return this._myIndex}search(e,{limit:n=-1}={}){const{includeMatches:i,includeScore:r,shouldSort:s,sortFn:o,ignoreFieldNorm:l}=this.options;let a=rn(e)?rn(this._docs[0])?this._searchStringList(e):this._searchObjectList(e):this._searchLogical(e);return Rv(a,{ignoreFieldNorm:l}),s&&a.sort(o),vc(n)&&n>-1&&(a=a.slice(0,n)),jv(a,this._docs,{includeMatches:i,includeScore:r})}_searchStringList(e){const n=ws(e,this.options),{records:i}=this._myIndex,r=[];return i.forEach(({v:s,i:o,n:l})=>{if(!Ht(s))return;const{isMatch:a,score:c,indices:u}=n.searchIn(s);a&&r.push({item:s,idx:o,matches:[{score:c,value:s,norm:l,indices:u}]})}),r}_searchLogical(e){const n=Nc(e,this.options),i=(l,a,c)=>{if(!l.children){const{keyId:h,searcher:f}=l,d=this._findMatches({key:this._keyStore.get(h),value:this._myIndex.getValueForItemAtKeyId(a,h),searcher:f});return d&&d.length?[{idx:c,item:a,matches:d}]:[]}const u=[];for(let h=0,f=l.children.length;h<f;h+=1){const d=l.children[h],m=i(d,a,c);if(m.length)u.push(...m);else if(l.operator===_r.AND)return[]}return u},r=this._myIndex.records,s={},o=[];return r.forEach(({$:l,i:a})=>{if(Ht(l)){let c=i(n,l,a);c.length&&(s[a]||(s[a]={idx:a,item:l,matches:[]},o.push(s[a])),c.forEach(({matches:u})=>{s[a].matches.push(...u)}))}}),o}_searchObjectList(e){const n=ws(e,this.options),{keys:i,records:r}=this._myIndex,s=[];return r.forEach(({$:o,i:l})=>{if(!Ht(o))return;let a=[];i.forEach((c,u)=>{a.push(...this._findMatches({key:c,value:o[u],searcher:n}))}),a.length&&s.push({idx:l,item:o,matches:a})}),s}_findMatches({key:e,value:n,searcher:i}){if(!Ht(n))return[];let r=[];if(dn(n))n.forEach(({v:s,i:o,n:l})=>{if(!Ht(s))return;const{isMatch:a,score:c,indices:u}=i.searchIn(s);a&&r.push({score:c,key:e,value:s,idx:o,norm:l,indices:u})});else{const{v:s,n:o}=n,{isMatch:l,score:a,indices:c}=i.searchIn(s);l&&r.push({score:a,key:e,value:s,norm:o,indices:c})}return r}}Zn.version="7.0.0",Zn.createIndex=Ec,Zn.parseIndex=vv,Zn.config=Ne,Zn.parseQuery=Nc,Ov(Pv);var Fv=function(){function t(e){this._haystack=[],this._fuseOptions=Dt(Dt({},e.fuseOptions),{keys:w1([],e.searchFields,!0),includeMatches:!0})}return t.prototype.index=function(e){this._haystack=e,this._fuse&&this._fuse.setCollection(e)},t.prototype.reset=function(){this._haystack=[],this._fuse=void 0},t.prototype.isEmptyIndex=function(){return!this._haystack.length},t.prototype.search=function(e){this._fuse||(this._fuse=new Zn(this._haystack,this._fuseOptions));var n=this._fuse.search(e);return n.map(function(i,r){return{item:i.item,score:i.score||0,rank:r+1}})},t}();function Hv(t){return new Fv(t)}var Vv=function(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0},Es=function(t,e,n){var i=t.dataset,r=e.customProperties,s=e.labelClass,o=e.labelDescription;s&&(i.labelClass=pr(s).join(" ")),o&&(i.labelDescription=o),n&&r&&(typeof r=="string"?i.customProperties=r:typeof r=="object"&&!Vv(r)&&(i.customProperties=JSON.stringify(r)))},Pc=function(t,e,n){var i=e&&t.querySelector("label[for='".concat(e,"']")),r=i&&i.innerText;r&&n.setAttribute("aria-label",r)},Uv={containerOuter:function(t,e,n,i,r,s,o){var l=t.classNames.containerOuter,a=document.createElement("div");return $e(a,l),a.dataset.type=s,e&&(a.dir=e),i&&(a.tabIndex=0),n&&(a.setAttribute("role",r?"combobox":"listbox"),r?a.setAttribute("aria-autocomplete","list"):o||Pc(this._docRoot,this.passedElement.element.id,a),a.setAttribute("aria-haspopup","true"),a.setAttribute("aria-expanded","false")),o&&a.setAttribute("aria-labelledby",o),a},containerInner:function(t){var e=t.classNames.containerInner,n=document.createElement("div");return $e(n,e),n},itemList:function(t,e){var n=t.searchEnabled,i=t.classNames,r=i.list,s=i.listSingle,o=i.listItems,l=document.createElement("div");return $e(l,r),$e(l,e?s:o),this._isSelectElement&&n&&l.setAttribute("role","listbox"),l},placeholder:function(t,e){var n=t.allowHTML,i=t.classNames.placeholder,r=document.createElement("div");return $e(r,i),fn(r,n,e),r},item:function(t,e,n){var i=t.allowHTML,r=t.removeItemButtonAlignLeft,s=t.removeItemIconText,o=t.removeItemLabelText,l=t.classNames,a=l.item,c=l.button,u=l.highlightedState,h=l.itemSelectable,f=l.placeholder,d=Mn(e.value),m=document.createElement("div");if($e(m,a),e.labelClass){var p=document.createElement("span");fn(p,i,e.label),$e(p,e.labelClass),m.appendChild(p)}else fn(m,i,e.label);if(m.dataset.item="",m.dataset.id=e.id,m.dataset.value=d,Es(m,e,!0),(e.disabled||this.containerOuter.isDisabled)&&m.setAttribute("aria-disabled","true"),this._isSelectElement&&(m.setAttribute("aria-selected","true"),m.setAttribute("role","option")),e.placeholder&&($e(m,f),m.dataset.placeholder=""),$e(m,e.highlighted?u:h),n){e.disabled&&tn(m,h),m.dataset.deletable="";var g=document.createElement("button");g.type="button",$e(g,c),fn(g,!0,yi(s,e.value));var _=yi(o,e.value);_&&g.setAttribute("aria-label",_),g.dataset.button="",r?m.insertAdjacentElement("afterbegin",g):m.appendChild(g)}return m},choiceList:function(t,e){var n=t.classNames.list,i=document.createElement("div");return $e(i,n),e||i.setAttribute("aria-multiselectable","true"),i.setAttribute("role","listbox"),i},choiceGroup:function(t,e){var n=t.allowHTML,i=t.classNames,r=i.group,s=i.groupHeading,o=i.itemDisabled,l=e.id,a=e.label,c=e.disabled,u=Mn(a),h=document.createElement("div");$e(h,r),c&&$e(h,o),h.setAttribute("role","group"),h.dataset.group="",h.dataset.id=l,h.dataset.value=u,c&&h.setAttribute("aria-disabled","true");var f=document.createElement("div");return $e(f,s),fn(f,n,a||""),h.appendChild(f),h},choice:function(t,e,n,i){var r=t.allowHTML,s=t.classNames,o=s.item,l=s.itemChoice,a=s.itemSelectable,c=s.selectedState,u=s.itemDisabled,h=s.description,f=s.placeholder,d=e.label,m=Mn(e.value),p=document.createElement("div");p.id=e.elementId,$e(p,o),$e(p,l),i&&typeof d=="string"&&(d=ps(r,d),d+=" (".concat(i,")"),d={trusted:d});var g=p;if(e.labelClass){var _=document.createElement("span");fn(_,r,d),$e(_,e.labelClass),g=_,p.appendChild(_)}else fn(p,r,d);if(e.labelDescription){var k="".concat(e.elementId,"-description");g.setAttribute("aria-describedby",k);var C=document.createElement("span");fn(C,r,e.labelDescription),C.id=k,$e(C,h),p.appendChild(C)}return e.selected&&$e(p,c),e.placeholder&&$e(p,f),p.setAttribute("role",e.group?"treeitem":"option"),p.dataset.choice="",p.dataset.id=e.id,p.dataset.value=m,n&&(p.dataset.selectText=n),e.group&&(p.dataset.groupId="".concat(e.group.id)),Es(p,e,!1),e.disabled?($e(p,u),p.dataset.choiceDisabled="",p.setAttribute("aria-disabled","true")):($e(p,a),p.dataset.choiceSelectable=""),p},input:function(t,e){var n=t.classNames,i=n.input,r=n.inputCloned,s=t.labelId,o=document.createElement("input");return o.type="search",$e(o,i),$e(o,r),o.autocomplete="off",o.autocapitalize="off",o.spellcheck=!1,o.setAttribute("aria-autocomplete","list"),e?o.setAttribute("aria-label",e):s||Pc(this._docRoot,this.passedElement.element.id,o),o},dropdown:function(t){var e=t.classNames,n=e.list,i=e.listDropdown,r=document.createElement("div");return $e(r,n),$e(r,i),r.setAttribute("aria-expanded","false"),r},notice:function(t,e,n){var i=t.classNames,r=i.item,s=i.itemChoice,o=i.addChoice,l=i.noResults,a=i.noChoices,c=i.notice;n===void 0&&(n=wt.generic);var u=document.createElement("div");switch(fn(u,!0,e),$e(u,r),$e(u,s),$e(u,c),n){case wt.addChoice:$e(u,o);break;case wt.noResults:$e(u,l);break;case wt.noChoices:$e(u,a);break}return n===wt.addChoice&&(u.dataset.choiceSelectable="",u.dataset.choice=""),u},option:function(t){var e=Mn(t.label),n=new Option(e,t.value,!1,t.selected);return Es(n,t,!0),n.disabled=t.disabled,t.selected&&n.setAttribute("selected",""),n}},Bv="-ms-scroll-limit"in document.documentElement.style&&"-ms-ime-align"in document.documentElement.style,qv={},Cs=function(t){if(t)return t.dataset.id?parseInt(t.dataset.id,10):void 0},Si="[data-choice-selectable]",Kv=function(){function t(e,n){e===void 0&&(e="[data-choice]"),n===void 0&&(n={});var i=this;this.initialisedOK=void 0,this._hasNonChoicePlaceholder=!1,this._lastAddedChoiceId=0,this._lastAddedGroupId=0;var r=t.defaults;this.config=Dt(Dt(Dt({},r.allOptions),r.options),n),S1.forEach(function(_){i.config[_]=Dt(Dt(Dt({},r.allOptions[_]),r.options[_]),n[_])});var s=this.config;s.silent||this._validateConfig();var o=s.shadowRoot||document.documentElement;this._docRoot=o;var l=typeof e=="string"?o.querySelector(e):e;if(!l||typeof l!="object"||!(V1(l)||hc(l)))throw TypeError(!l&&typeof e=="string"?"Selector ".concat(e," failed to find an element"):"Expected one of the following types text|select-one|select-multiple");var a=l.type,c=a===wn.Text;(c||s.maxItemCount!==1)&&(s.singleModeForMultiSelect=!1),s.singleModeForMultiSelect&&(a=wn.SelectMultiple);var u=a===wn.SelectOne,h=a===wn.SelectMultiple,f=u||h;if(this._elementType=a,this._isTextElement=c,this._isSelectOneElement=u,this._isSelectMultipleElement=h,this._isSelectElement=u||h,this._canAddUserChoices=c&&s.addItems||f&&s.addChoices,typeof s.renderSelectedChoices!="boolean"&&(s.renderSelectedChoices=s.renderSelectedChoices==="always"||u),s.closeDropdownOnSelect==="auto"?s.closeDropdownOnSelect=c||u||s.singleModeForMultiSelect:s.closeDropdownOnSelect=wi(s.closeDropdownOnSelect),s.placeholder&&(s.placeholderValue?this._hasNonChoicePlaceholder=!0:l.dataset.placeholder&&(this._hasNonChoicePlaceholder=!0,s.placeholderValue=l.dataset.placeholder)),n.addItemFilter&&typeof n.addItemFilter!="function"){var d=n.addItemFilter instanceof RegExp?n.addItemFilter:new RegExp(n.addItemFilter);s.addItemFilter=d.test.bind(d)}if(this._isTextElement)this.passedElement=new H1({element:l,classNames:s.classNames});else{var m=l;this.passedElement=new q1({element:m,classNames:s.classNames,template:function(_){return i._templates.option(_)},extractPlaceholder:s.placeholder&&!this._hasNonChoicePlaceholder})}if(this.initialised=!1,this._store=new G1(s),this._currentValue="",s.searchEnabled=!c&&s.searchEnabled||h,this._canSearch=s.searchEnabled,this._isScrollingOnIe=!1,this._highlightPosition=0,this._wasTap=!0,this._placeholderValue=this._generatePlaceholderValue(),this._baseId=M1(l,"choices-"),this._direction=l.dir,!this._direction){var p=window.getComputedStyle(l).direction,g=window.getComputedStyle(document.documentElement).direction;p!==g&&(this._direction=p)}if(this._idNames={itemChoice:"item-choice"},this._templates=r.templates,this._render=this._render.bind(this),this._onFocus=this._onFocus.bind(this),this._onBlur=this._onBlur.bind(this),this._onKeyUp=this._onKeyUp.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onInput=this._onInput.bind(this),this._onClick=this._onClick.bind(this),this._onTouchMove=this._onTouchMove.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._onMouseDown=this._onMouseDown.bind(this),this._onMouseOver=this._onMouseOver.bind(this),this._onFormReset=this._onFormReset.bind(this),this._onSelectKey=this._onSelectKey.bind(this),this._onEnterKey=this._onEnterKey.bind(this),this._onEscapeKey=this._onEscapeKey.bind(this),this._onDirectionKey=this._onDirectionKey.bind(this),this._onDeleteKey=this._onDeleteKey.bind(this),this.passedElement.isActive){s.silent||console.warn("Trying to initialise Choices on element already initialised",{element:e}),this.initialised=!0,this.initialisedOK=!1;return}this.init(),this._initialItems=this._store.items.map(function(_){return _.value})}return Object.defineProperty(t,"defaults",{get:function(){return Object.preventExtensions({get options(){return qv},get allOptions(){return mc},get templates(){return Uv}})},enumerable:!1,configurable:!0}),t.prototype.init=function(){if(!(this.initialised||this.initialisedOK!==void 0)){this._searcher=Hv(this.config),this._loadChoices(),this._createTemplates(),this._createElements(),this._createStructure(),this._isTextElement&&!this.config.addItems||this.passedElement.element.hasAttribute("disabled")||this.passedElement.element.closest("fieldset:disabled")?this.disable():(this.enable(),this._addEventListeners()),this._initStore(),this.initialised=!0,this.initialisedOK=!0;var e=this.config.callbackOnInit;typeof e=="function"&&e.call(this)}},t.prototype.destroy=function(){this.initialised&&(this._removeEventListeners(),this.passedElement.reveal(),this.containerOuter.unwrap(this.passedElement.element),this._store._listeners=[],this.clearStore(!1),this._stopSearch(),this._templates=t.defaults.templates,this.initialised=!1,this.initialisedOK=void 0)},t.prototype.enable=function(){return this.passedElement.isDisabled&&this.passedElement.enable(),this.containerOuter.isDisabled&&(this._addEventListeners(),this.input.enable(),this.containerOuter.enable()),this},t.prototype.disable=function(){return this.passedElement.isDisabled||this.passedElement.disable(),this.containerOuter.isDisabled||(this._removeEventListeners(),this.input.disable(),this.containerOuter.disable()),this},t.prototype.highlightItem=function(e,n){if(n===void 0&&(n=!0),!e||!e.id)return this;var i=this._store.items.find(function(r){return r.id===e.id});return!i||i.highlighted?this:(this._store.dispatch(hr(i,!0)),n&&this.passedElement.triggerEvent(Rt.highlightItem,this._getChoiceForOutput(i)),this)},t.prototype.unhighlightItem=function(e,n){if(n===void 0&&(n=!0),!e||!e.id)return this;var i=this._store.items.find(function(r){return r.id===e.id});return!i||!i.highlighted?this:(this._store.dispatch(hr(i,!1)),n&&this.passedElement.triggerEvent(Rt.unhighlightItem,this._getChoiceForOutput(i)),this)},t.prototype.highlightAll=function(){var e=this;return this._store.withTxn(function(){e._store.items.forEach(function(n){n.highlighted||(e._store.dispatch(hr(n,!0)),e.passedElement.triggerEvent(Rt.highlightItem,e._getChoiceForOutput(n)))})}),this},t.prototype.unhighlightAll=function(){var e=this;return this._store.withTxn(function(){e._store.items.forEach(function(n){n.highlighted&&(e._store.dispatch(hr(n,!1)),e.passedElement.triggerEvent(Rt.highlightItem,e._getChoiceForOutput(n)))})}),this},t.prototype.removeActiveItemsByValue=function(e){var n=this;return this._store.withTxn(function(){n._store.items.filter(function(i){return i.value===e}).forEach(function(i){return n._removeItem(i)})}),this},t.prototype.removeActiveItems=function(e){var n=this;return this._store.withTxn(function(){n._store.items.filter(function(i){var r=i.id;return r!==e}).forEach(function(i){return n._removeItem(i)})}),this},t.prototype.removeHighlightedItems=function(e){var n=this;return e===void 0&&(e=!1),this._store.withTxn(function(){n._store.highlightedActiveItems.forEach(function(i){n._removeItem(i),e&&n._triggerChange(i.value)})}),this},t.prototype.showDropdown=function(e){var n=this;return this.dropdown.isActive?this:(e===void 0&&(e=!this._canSearch),requestAnimationFrame(function(){n.dropdown.show();var i=n.dropdown.element.getBoundingClientRect();n.containerOuter.open(i.bottom,i.height),e||n.input.focus(),n.passedElement.triggerEvent(Rt.showDropdown)}),this)},t.prototype.hideDropdown=function(e){var n=this;return this.dropdown.isActive?(requestAnimationFrame(function(){n.dropdown.hide(),n.containerOuter.close(),!e&&n._canSearch&&(n.input.removeActiveDescendant(),n.input.blur()),n.passedElement.triggerEvent(Rt.hideDropdown)}),this):this},t.prototype.getValue=function(e){var n=this,i=this._store.items.map(function(r){return e?r.value:n._getChoiceForOutput(r)});return this._isSelectOneElement||this.config.singleModeForMultiSelect?i[0]:i},t.prototype.setValue=function(e){var n=this;return this.initialisedOK?(this._store.withTxn(function(){e.forEach(function(i){i&&n._addChoice(nn(i,!1))})}),this._searcher.reset(),this):(this._warnChoicesInitFailed("setValue"),this)},t.prototype.setChoiceByValue=function(e){var n=this;return this.initialisedOK?this._isTextElement?this:(this._store.withTxn(function(){var i=Array.isArray(e)?e:[e];i.forEach(function(r){return n._findAndSelectChoiceByValue(r)}),n.unhighlightAll()}),this._searcher.reset(),this):(this._warnChoicesInitFailed("setChoiceByValue"),this)},t.prototype.setChoices=function(e,n,i,r,s,o){var l=this;if(e===void 0&&(e=[]),n===void 0&&(n="value"),i===void 0&&(i="label"),r===void 0&&(r=!1),s===void 0&&(s=!0),o===void 0&&(o=!1),!this.initialisedOK)return this._warnChoicesInitFailed("setChoices"),this;if(!this._isSelectElement)throw new TypeError("setChoices can't be used with INPUT based Choices");if(typeof n!="string"||!n)throw new TypeError("value parameter must be a name of 'value' field in passed objects");if(typeof e=="function"){var a=e(this);if(typeof Promise=="function"&&a instanceof Promise)return new Promise(function(c){return requestAnimationFrame(c)}).then(function(){return l._handleLoadingState(!0)}).then(function(){return a}).then(function(c){return l.setChoices(c,n,i,r,s,o)}).catch(function(c){l.config.silent||console.error(c)}).then(function(){return l._handleLoadingState(!1)}).then(function(){return l});if(!Array.isArray(a))throw new TypeError(".setChoices first argument function must return either array of choices or Promise, got: ".concat(typeof a));return this.setChoices(a,n,i,!1)}if(!Array.isArray(e))throw new TypeError(".setChoices must be called either with array of choices with a function resulting into Promise of array of choices");return this.containerOuter.removeLoadingState(),this._store.withTxn(function(){s&&(l._isSearching=!1),r&&l.clearChoices(!0,o);var c=n==="value",u=i==="label";e.forEach(function(h){if("choices"in h){var f=h;u||(f=Dt(Dt({},f),{label:f[i]})),l._addGroup(nn(f,!0))}else{var d=h;(!u||!c)&&(d=Dt(Dt({},d),{value:d[n],label:d[i]}));var m=nn(d,!1);l._addChoice(m),m.placeholder&&!l._hasNonChoicePlaceholder&&(l._placeholderValue=ac(m.label))}}),l.unhighlightAll()}),this._searcher.reset(),this},t.prototype.refresh=function(e,n,i){var r=this;return e===void 0&&(e=!1),n===void 0&&(n=!1),i===void 0&&(i=!1),this._isSelectElement?(this._store.withTxn(function(){var s=r.passedElement.optionsAsChoices(),o={};i||r._store.items.forEach(function(a){a.id&&a.active&&a.selected&&(o[a.value]=!0)}),r.clearStore(!1);var l=function(a){i?r._store.dispatch(sc(a)):o[a.value]&&(a.selected=!0)};s.forEach(function(a){if("choices"in a){a.choices.forEach(l);return}l(a)}),r._addPredefinedChoices(s,n,e),r._isSearching&&r._searchChoices(r.input.value)}),this):(this.config.silent||console.warn("refresh method can only be used on choices backed by a <select> element"),this)},t.prototype.removeChoice=function(e){var n=this._store.choices.find(function(i){return i.value===e});return n?(this._clearNotice(),this._store.dispatch(k1(n)),this._searcher.reset(),n.selected&&this.passedElement.triggerEvent(Rt.removeItem,this._getChoiceForOutput(n)),this):this},t.prototype.clearChoices=function(e,n){var i=this;return e===void 0&&(e=!0),n===void 0&&(n=!1),e&&(n?this.passedElement.element.replaceChildren(""):this.passedElement.element.querySelectorAll(":not([selected])").forEach(function(r){r.remove()})),this.itemList.element.replaceChildren(""),this.choiceList.element.replaceChildren(""),this._clearNotice(),this._store.withTxn(function(){var r=n?[]:i._store.items;i._store.reset(),r.forEach(function(s){i._store.dispatch(ic(s)),i._store.dispatch(rc(s))})}),this._searcher.reset(),this},t.prototype.clearStore=function(e){return e===void 0&&(e=!0),this.clearChoices(e,!0),this._stopSearch(),this._lastAddedChoiceId=0,this._lastAddedGroupId=0,this},t.prototype.clearInput=function(){var e=!this._isSelectOneElement;return this.input.clear(e),this._stopSearch(),this},t.prototype._validateConfig=function(){var e=this.config,n=D1(e,mc);n.length&&console.warn("Unknown config option(s) passed",n.join(", ")),e.allowHTML&&e.allowHtmlUserInput&&(e.addItems&&console.warn("Warning: allowHTML/allowHtmlUserInput/addItems all being true is strongly not recommended and may lead to XSS attacks"),e.addChoices&&console.warn("Warning: allowHTML/allowHtmlUserInput/addChoices all being true is strongly not recommended and may lead to XSS attacks"))},t.prototype._render=function(e){e===void 0&&(e={choices:!0,groups:!0,items:!0}),!this._store.inTxn()&&(this._isSelectElement&&(e.choices||e.groups)&&this._renderChoices(),e.items&&this._renderItems())},t.prototype._renderChoices=function(){var e=this;if(this._canAddItems()){var n=this,i=n.config,r=n._isSearching,s=this._store,o=s.activeGroups,l=s.activeChoices,a=0;if(r&&i.searchResultLimit>0?a=i.searchResultLimit:i.renderChoiceLimit>0&&(a=i.renderChoiceLimit),this._isSelectElement){var c=l.filter(function(m){return!m.element});c.length&&this.passedElement.addOptions(c)}var u=document.createDocumentFragment(),h=function(m){return m.filter(function(p){return!p.placeholder&&(r?!!p.rank:i.renderSelectedChoices||!p.selected)})},f=!1,d=function(m,p,g){r?m.sort(O1):i.shouldSort&&m.sort(i.sorter);var _=m.length;_=!p&&a&&_>a?a:_,_--,m.every(function(k,C){var w=k.choiceEl||e._templates.choice(i,k,i.itemSelectText,g);return k.choiceEl=w,u.appendChild(w),(r||!k.selected)&&(f=!0),C<_})};l.length&&(i.resetScrollPosition&&requestAnimationFrame(function(){return e.choiceList.scrollToTop()}),!this._hasNonChoicePlaceholder&&!r&&this._isSelectOneElement&&d(l.filter(function(m){return m.placeholder&&!m.group}),!1,void 0),o.length&&!r?(i.shouldSort&&o.sort(i.sorter),d(l.filter(function(m){return!m.placeholder&&!m.group}),!1,void 0),o.forEach(function(m){var p=h(m.choices);if(p.length){if(m.label){var g=m.groupEl||e._templates.choiceGroup(e.config,m);m.groupEl=g,g.remove(),u.appendChild(g)}d(p,!0,i.appendGroupInSearch&&r?m.label:void 0)}})):d(h(l),!1,void 0)),!f&&(r||!u.children.length||!i.renderSelectedChoices)&&(this._notice||(this._notice={text:lc(r?i.noResultsText:i.noChoicesText),type:r?wt.noResults:wt.noChoices}),u.replaceChildren("")),this._renderNotice(u),this.choiceList.element.replaceChildren(u),f&&this._highlightChoice()}},t.prototype._renderItems=function(){var e=this,n=this._store.items||[],i=this.itemList.element,r=this.config,s=document.createDocumentFragment(),o=function(h){return i.querySelector('[data-item][data-id="'.concat(h.id,'"]'))},l=function(h){var f=h.itemEl;f&&f.parentElement||(f=o(h)||e._templates.item(r,h,r.removeItemButton),h.itemEl=f,s.appendChild(f))};n.forEach(l);var a=!!s.childNodes.length;if(this._isSelectOneElement){var c=i.children.length;if(a||c>1){var u=i.querySelector(bi(r.classNames.placeholder));u&&u.remove()}else!a&&!c&&this._placeholderValue&&(a=!0,l(nn({selected:!0,value:"",label:this._placeholderValue,placeholder:!0},!1)))}a&&(i.append(s),r.shouldSortItems&&!this._isSelectOneElement&&(n.sort(r.sorter),n.forEach(function(h){var f=o(h);f&&(f.remove(),s.append(f))}),i.append(s))),this._isTextElement&&(this.passedElement.value=n.map(function(h){var f=h.value;return f}).join(r.delimiter))},t.prototype._displayNotice=function(e,n,i){i===void 0&&(i=!0);var r=this._notice;if(r&&(r.type===n&&r.text===e||r.type===wt.addChoice&&(n===wt.noResults||n===wt.noChoices))){i&&this.showDropdown(!0);return}this._clearNotice(),this._notice=e?{text:e,type:n}:void 0,this._renderNotice(),i&&e&&this.showDropdown(!0)},t.prototype._clearNotice=function(){if(this._notice){var e=this.choiceList.element.querySelector(bi(this.config.classNames.notice));e&&e.remove(),this._notice=void 0}},t.prototype._renderNotice=function(e){var n=this._notice;if(n){var i=this._templates.notice(this.config,n.text,n.type);e?e.append(i):this.choiceList.prepend(i)}},t.prototype._getChoiceForOutput=function(e,n){return{id:e.id,highlighted:e.highlighted,labelClass:e.labelClass,labelDescription:e.labelDescription,customProperties:e.customProperties,disabled:e.disabled,active:e.active,label:e.label,placeholder:e.placeholder,value:e.value,groupValue:e.group?e.group.label:void 0,element:e.element,keyCode:n}},t.prototype._triggerChange=function(e){e!=null&&this.passedElement.triggerEvent(Rt.change,{value:e})},t.prototype._handleButtonAction=function(e){var n=this,i=this._store.items;if(!(!i.length||!this.config.removeItems||!this.config.removeItemButton)){var r=e&&Cs(e.parentElement),s=r&&i.find(function(o){return o.id===r});s&&this._store.withTxn(function(){if(n._removeItem(s),n._triggerChange(s.value),n._isSelectOneElement&&!n._hasNonChoicePlaceholder){var o=(n.config.shouldSort?n._store.choices.reverse():n._store.choices).find(function(l){return l.placeholder});o&&(n._addItem(o),n.unhighlightAll(),o.value&&n._triggerChange(o.value))}})}},t.prototype._handleItemAction=function(e,n){var i=this;n===void 0&&(n=!1);var r=this._store.items;if(!(!r.length||!this.config.removeItems||this._isSelectOneElement)){var s=Cs(e);s&&(r.forEach(function(o){o.id===s&&!o.highlighted?i.highlightItem(o):!n&&o.highlighted&&i.unhighlightItem(o)}),this.input.focus())}},t.prototype._handleChoiceAction=function(e){var n=this,i=Cs(e),r=i&&this._store.getChoiceById(i);if(!r||r.disabled)return!1;var s=this.dropdown.isActive;if(!r.selected){if(!this._canAddItems())return!0;this._store.withTxn(function(){n._addItem(r,!0,!0),n.clearInput(),n.unhighlightAll()}),this._triggerChange(r.value)}return s&&this.config.closeDropdownOnSelect&&(this.hideDropdown(!0),this.containerOuter.element.focus()),!0},t.prototype._handleBackspace=function(e){var n=this.config;if(!(!n.removeItems||!e.length)){var i=e[e.length-1],r=e.some(function(s){return s.highlighted});n.editItems&&!r&&i?(this.input.value=i.value,this.input.setWidth(),this._removeItem(i),this._triggerChange(i.value)):(r||this.highlightItem(i,!1),this.removeHighlightedItems(!0))}},t.prototype._loadChoices=function(){var e,n=this,i=this.config;if(this._isTextElement){if(this._presetChoices=i.items.map(function(o){return nn(o,!1)}),this.passedElement.value){var r=this.passedElement.value.split(i.delimiter).map(function(o){return nn(o,!1,n.config.allowHtmlUserInput)});this._presetChoices=this._presetChoices.concat(r)}this._presetChoices.forEach(function(o){o.selected=!0})}else if(this._isSelectElement){this._presetChoices=i.choices.map(function(o){return nn(o,!0)});var s=this.passedElement.optionsAsChoices();s&&(e=this._presetChoices).push.apply(e,s)}},t.prototype._handleLoadingState=function(e){e===void 0&&(e=!0);var n=this.itemList.element;e?(this.disable(),this.containerOuter.addLoadingState(),this._isSelectOneElement?n.replaceChildren(this._templates.placeholder(this.config,this.config.loadingText)):this.input.placeholder=this.config.loadingText):(this.enable(),this.containerOuter.removeLoadingState(),this._isSelectOneElement?(n.replaceChildren(""),this._render()):this.input.placeholder=this._placeholderValue||"")},t.prototype._handleSearch=function(e){if(this.input.isFocussed)if(e!==null&&typeof e<"u"&&e.length>=this.config.searchFloor){var n=this.config.searchChoices?this._searchChoices(e):0;n!==null&&this.passedElement.triggerEvent(Rt.search,{value:e,resultCount:n})}else this._store.choices.some(function(i){return!i.active})&&this._stopSearch()},t.prototype._canAddItems=function(){var e=this.config,n=e.maxItemCount,i=e.maxItemText;return!e.singleModeForMultiSelect&&n>0&&n<=this._store.items.length?(this.choiceList.element.replaceChildren(""),this._notice=void 0,this._displayNotice(typeof i=="function"?i(n):i,wt.addChoice),!1):(this._notice&&this._notice.type===wt.addChoice&&this._clearNotice(),!0)},t.prototype._canCreateItem=function(e){var n=this.config,i=!0,r="";if(i&&typeof n.addItemFilter=="function"&&!n.addItemFilter(e)&&(i=!1,r=yi(n.customAddItemText,e)),i){var s=this._store.choices.find(function(o){return n.valueComparer(o.value,e)});if(s){if(this._isSelectElement)return this._displayNotice("",wt.addChoice),!1;n.duplicateItemsAllowed||(i=!1,r=yi(n.uniqueItemText,e))}}return i&&(r=yi(n.addItemText,e)),r&&this._displayNotice(r,wt.addChoice),i},t.prototype._searchChoices=function(e){var n=e.trim().replace(/\s{2,}/," ");if(!n.length||n===this._currentValue)return null;var i=this._searcher;i.isEmptyIndex()&&i.index(this._store.searchableChoices);var r=i.search(n);this._currentValue=n,this._highlightPosition=0,this._isSearching=!0;var s=this._notice,o=s&&s.type;return o!==wt.addChoice&&(r.length?this._clearNotice():this._displayNotice(lc(this.config.noResultsText),wt.noResults)),this._store.dispatch(E1(r)),r.length},t.prototype._stopSearch=function(){this._isSearching&&(this._currentValue="",this._isSearching=!1,this._clearNotice(),this._store.dispatch(C1(!0)),this.passedElement.triggerEvent(Rt.search,{value:"",resultCount:0}))},t.prototype._addEventListeners=function(){var e=this._docRoot,n=this.containerOuter.element,i=this.input.element;e.addEventListener("touchend",this._onTouchEnd,!0),n.addEventListener("keydown",this._onKeyDown,!0),n.addEventListener("mousedown",this._onMouseDown,!0),e.addEventListener("click",this._onClick,{passive:!0}),e.addEventListener("touchmove",this._onTouchMove,{passive:!0}),this.dropdown.element.addEventListener("mouseover",this._onMouseOver,{passive:!0}),this._isSelectOneElement&&(n.addEventListener("focus",this._onFocus,{passive:!0}),n.addEventListener("blur",this._onBlur,{passive:!0})),i.addEventListener("keyup",this._onKeyUp,{passive:!0}),i.addEventListener("input",this._onInput,{passive:!0}),i.addEventListener("focus",this._onFocus,{passive:!0}),i.addEventListener("blur",this._onBlur,{passive:!0}),i.form&&i.form.addEventListener("reset",this._onFormReset,{passive:!0}),this.input.addEventListeners()},t.prototype._removeEventListeners=function(){var e=this._docRoot,n=this.containerOuter.element,i=this.input.element;e.removeEventListener("touchend",this._onTouchEnd,!0),n.removeEventListener("keydown",this._onKeyDown,!0),n.removeEventListener("mousedown",this._onMouseDown,!0),e.removeEventListener("click",this._onClick),e.removeEventListener("touchmove",this._onTouchMove),this.dropdown.element.removeEventListener("mouseover",this._onMouseOver),this._isSelectOneElement&&(n.removeEventListener("focus",this._onFocus),n.removeEventListener("blur",this._onBlur)),i.removeEventListener("keyup",this._onKeyUp),i.removeEventListener("input",this._onInput),i.removeEventListener("focus",this._onFocus),i.removeEventListener("blur",this._onBlur),i.form&&i.form.removeEventListener("reset",this._onFormReset),this.input.removeEventListeners()},t.prototype._onKeyDown=function(e){var n=e.keyCode,i=this.dropdown.isActive,r=e.key.length===1||e.key.length===2&&e.key.charCodeAt(0)>=55296||e.key==="Unidentified";switch(!this._isTextElement&&!i&&n!==Ct.ESC_KEY&&n!==Ct.TAB_KEY&&n!==Ct.SHIFT_KEY&&(this.showDropdown(),!this.input.isFocussed&&r&&(this.input.value+=e.key,e.key===" "&&e.preventDefault())),n){case Ct.A_KEY:return this._onSelectKey(e,this.itemList.element.hasChildNodes());case Ct.ENTER_KEY:return this._onEnterKey(e,i);case Ct.ESC_KEY:return this._onEscapeKey(e,i);case Ct.UP_KEY:case Ct.PAGE_UP_KEY:case Ct.DOWN_KEY:case Ct.PAGE_DOWN_KEY:return this._onDirectionKey(e,i);case Ct.DELETE_KEY:case Ct.BACK_KEY:return this._onDeleteKey(e,this._store.items,this.input.isFocussed)}},t.prototype._onKeyUp=function(){this._canSearch=this.config.searchEnabled},t.prototype._onInput=function(){var e=this.input.value;if(!e){this._isTextElement?this.hideDropdown(!0):this._stopSearch();return}this._canAddItems()&&(this._canSearch&&this._handleSearch(e),this._canAddUserChoices&&(this._canCreateItem(e),this._isSelectElement&&(this._highlightPosition=0,this._highlightChoice())))},t.prototype._onSelectKey=function(e,n){if((e.ctrlKey||e.metaKey)&&n){this._canSearch=!1;var i=this.config.removeItems&&!this.input.value&&this.input.element===document.activeElement;i&&this.highlightAll()}},t.prototype._onEnterKey=function(e,n){var i=this,r=this.input.value,s=e.target;if(e.preventDefault(),s&&s.hasAttribute("data-button")){this._handleButtonAction(s);return}if(!n){(this._isSelectElement||this._notice)&&this.showDropdown();return}var o=this.dropdown.element.querySelector(bi(this.config.classNames.highlightedState));if(!(o&&this._handleChoiceAction(o))){if(!s||!r){this.hideDropdown(!0);return}if(this._canAddItems()){var l=!1;this._store.withTxn(function(){if(l=i._findAndSelectChoiceByValue(r,!0),!l){if(!i._canAddUserChoices||!i._canCreateItem(r))return;i._addChoice(nn(r,!1,i.config.allowHtmlUserInput),!0,!0),l=!0}i.clearInput(),i.unhighlightAll()}),l&&(this._triggerChange(r),this.config.closeDropdownOnSelect&&this.hideDropdown(!0))}}},t.prototype._onEscapeKey=function(e,n){n&&(e.stopPropagation(),this.hideDropdown(!0),this._stopSearch(),this.containerOuter.element.focus())},t.prototype._onDirectionKey=function(e,n){var i=e.keyCode;if(n||this._isSelectOneElement){this.showDropdown(),this._canSearch=!1;var r=i===Ct.DOWN_KEY||i===Ct.PAGE_DOWN_KEY?1:-1,s=e.metaKey||i===Ct.PAGE_DOWN_KEY||i===Ct.PAGE_UP_KEY,o=void 0;if(s)r>0?o=this.dropdown.element.querySelector("".concat(Si,":last-of-type")):o=this.dropdown.element.querySelector(Si);else{var l=this.dropdown.element.querySelector(bi(this.config.classNames.highlightedState));l?o=A1(l,Si,r):o=this.dropdown.element.querySelector(Si)}o&&(T1(o,this.choiceList.element,r)||this.choiceList.scrollToChildElement(o,r),this._highlightChoice(o)),e.preventDefault()}},t.prototype._onDeleteKey=function(e,n,i){!this._isSelectOneElement&&!e.target.value&&i&&(this._handleBackspace(n),e.preventDefault())},t.prototype._onTouchMove=function(){this._wasTap&&(this._wasTap=!1)},t.prototype._onTouchEnd=function(e){var n=(e||e.touches[0]).target,i=this._wasTap&&this.containerOuter.element.contains(n);if(i){var r=n===this.containerOuter.element||n===this.containerInner.element;r&&(this._isTextElement?this.input.focus():this._isSelectMultipleElement&&this.showDropdown()),e.stopPropagation()}this._wasTap=!0},t.prototype._onMouseDown=function(e){var n=e.target;if(n instanceof HTMLElement){if(Bv&&this.choiceList.element.contains(n)){var i=this.choiceList.element.firstElementChild;this._isScrollingOnIe=this._direction==="ltr"?e.offsetX>=i.offsetWidth:e.offsetX<i.offsetLeft}if(n!==this.input.element){var r=n.closest("[data-button],[data-item],[data-choice]");r instanceof HTMLElement&&("button"in r.dataset?this._handleButtonAction(r):"item"in r.dataset?this._handleItemAction(r,e.shiftKey):"choice"in r.dataset&&this._handleChoiceAction(r)),e.preventDefault()}}},t.prototype._onMouseOver=function(e){var n=e.target;n instanceof HTMLElement&&"choice"in n.dataset&&this._highlightChoice(n)},t.prototype._onClick=function(e){var n=e.target,i=this.containerOuter,r=i.element.contains(n);r?!this.dropdown.isActive&&!i.isDisabled?this._isTextElement?document.activeElement!==this.input.element&&this.input.focus():(this.showDropdown(),i.element.focus()):this._isSelectOneElement&&n!==this.input.element&&!this.dropdown.element.contains(n)&&this.hideDropdown():(i.removeFocusState(),this.hideDropdown(!0),this.unhighlightAll())},t.prototype._onFocus=function(e){var n=e.target,i=this.containerOuter,r=n&&i.element.contains(n);if(r){var s=n===this.input.element;this._isTextElement?s&&i.addFocusState():this._isSelectMultipleElement?s&&(this.showDropdown(!0),i.addFocusState()):(i.addFocusState(),s&&this.showDropdown(!0))}},t.prototype._onBlur=function(e){var n=e.target,i=this.containerOuter,r=n&&i.element.contains(n);r&&!this._isScrollingOnIe?n===this.input.element?(i.removeFocusState(),this.hideDropdown(!0),(this._isTextElement||this._isSelectMultipleElement)&&this.unhighlightAll()):n===this.containerOuter.element&&(i.removeFocusState(),this._canSearch||this.hideDropdown(!0)):(this._isScrollingOnIe=!1,this.input.element.focus())},t.prototype._onFormReset=function(){var e=this;this._store.withTxn(function(){e.clearInput(),e.hideDropdown(),e.refresh(!1,!1,!0),e._initialItems.length&&e.setChoiceByValue(e._initialItems)})},t.prototype._highlightChoice=function(e){e===void 0&&(e=null);var n=Array.from(this.dropdown.element.querySelectorAll(Si));if(n.length){var i=e,r=this.config.classNames.highlightedState,s=Array.from(this.dropdown.element.querySelectorAll(bi(r)));s.forEach(function(o){tn(o,r),o.setAttribute("aria-selected","false")}),i?this._highlightPosition=n.indexOf(i):(n.length>this._highlightPosition?i=n[this._highlightPosition]:i=n[n.length-1],i||(i=n[0])),$e(i,r),i.setAttribute("aria-selected","true"),this.passedElement.triggerEvent(Rt.highlightChoice,{el:i}),this.dropdown.isActive&&(this.input.setActiveDescendant(i.id),this.containerOuter.setActiveDescendant(i.id))}},t.prototype._addItem=function(e,n,i){if(n===void 0&&(n=!0),i===void 0&&(i=!1),!e.id)throw new TypeError("item.id must be set before _addItem is called for a choice/item");(this.config.singleModeForMultiSelect||this._isSelectOneElement)&&this.removeActiveItems(e.id),this._store.dispatch(rc(e)),n&&(this.passedElement.triggerEvent(Rt.addItem,this._getChoiceForOutput(e)),i&&this.passedElement.triggerEvent(Rt.choice,this._getChoiceForOutput(e)))},t.prototype._removeItem=function(e){if(e.id){this._store.dispatch(sc(e));var n=this._notice;n&&n.type===wt.noChoices&&this._clearNotice(),this.passedElement.triggerEvent(Rt.removeItem,this._getChoiceForOutput(e))}},t.prototype._addChoice=function(e,n,i){if(n===void 0&&(n=!0),i===void 0&&(i=!1),e.id)throw new TypeError("Can not re-add a choice which has already been added");var r=this.config;if(!(!r.duplicateItemsAllowed&&this._store.choices.find(function(l){return r.valueComparer(l.value,e.value)}))){this._lastAddedChoiceId++,e.id=this._lastAddedChoiceId,e.elementId="".concat(this._baseId,"-").concat(this._idNames.itemChoice,"-").concat(e.id);var s=r.prependValue,o=r.appendValue;s&&(e.value=s+e.value),o&&(e.value+=o.toString()),(s||o)&&e.element&&(e.element.value=e.value),this._clearNotice(),this._store.dispatch(ic(e)),e.selected&&this._addItem(e,n,i)}},t.prototype._addGroup=function(e,n){var i=this;if(n===void 0&&(n=!0),e.id)throw new TypeError("Can not re-add a group which has already been added");this._store.dispatch(I1(e)),e.choices&&(this._lastAddedGroupId++,e.id=this._lastAddedGroupId,e.choices.forEach(function(r){r.group=e,e.disabled&&(r.disabled=!0),i._addChoice(r,n)}))},t.prototype._createTemplates=function(){var e=this,n=this.config.callbackOnCreateTemplates,i={};typeof n=="function"&&(i=n.call(this,N1,ps,pr));var r={};Object.keys(this._templates).forEach(function(s){s in i?r[s]=i[s].bind(e):r[s]=e._templates[s].bind(e)}),this._templates=r},t.prototype._createElements=function(){var e=this._templates,n=this,i=n.config,r=n._isSelectOneElement,s=i.position,o=i.classNames,l=this._elementType;this.containerOuter=new cc({element:e.containerOuter(i,this._direction,this._isSelectElement,r,i.searchEnabled,l,i.labelId),classNames:o,type:l,position:s}),this.containerInner=new cc({element:e.containerInner(i),classNames:o,type:l,position:s}),this.input=new j1({element:e.input(i,this._placeholderValue),classNames:o,type:l,preventPaste:!i.paste}),this.choiceList=new uc({element:e.choiceList(i,r)}),this.itemList=new uc({element:e.itemList(i,r)}),this.dropdown=new z1({element:e.dropdown(i),classNames:o,type:l})},t.prototype._createStructure=function(){var e=this,n=e.containerInner,i=e.containerOuter,r=e.passedElement,s=this.dropdown.element;r.conceal(),n.wrap(r.element),i.wrap(n.element),this._isSelectOneElement?this.input.placeholder=this.config.searchPlaceholderValue||"":(this._placeholderValue&&(this.input.placeholder=this._placeholderValue),this.input.setWidth()),i.element.appendChild(n.element),i.element.appendChild(s),n.element.appendChild(this.itemList.element),s.appendChild(this.choiceList.element),this._isSelectOneElement?this.config.searchEnabled&&s.insertBefore(this.input.element,s.firstChild):n.element.appendChild(this.input.element),this._highlightPosition=0,this._isSearching=!1},t.prototype._initStore=function(){var e=this;this._store.subscribe(this._render).withTxn(function(){e._addPredefinedChoices(e._presetChoices,e._isSelectOneElement&&!e._hasNonChoicePlaceholder,!1)}),(!this._store.choices.length||this._isSelectOneElement&&this._hasNonChoicePlaceholder)&&this._render()},t.prototype._addPredefinedChoices=function(e,n,i){var r=this;if(n===void 0&&(n=!1),i===void 0&&(i=!0),n){var s=e.findIndex(function(o){return o.selected})===-1;s&&e.some(function(o){return o.disabled||"choices"in o?!1:(o.selected=!0,!0)})}e.forEach(function(o){"choices"in o?r._isSelectElement&&r._addGroup(o,i):r._addChoice(o,i)})},t.prototype._findAndSelectChoiceByValue=function(e,n){var i=this;n===void 0&&(n=!1);var r=this._store.choices.find(function(s){return i.config.valueComparer(s.value,e)});return r&&!r.disabled&&!r.selected?(this._addItem(r,!0,n),!0):!1},t.prototype._generatePlaceholderValue=function(){var e=this.config;if(!e.placeholder)return null;if(this._hasNonChoicePlaceholder)return e.placeholderValue;if(this._isSelectElement){var n=this.passedElement.placeholderOption;return n?n.text:null}return null},t.prototype._warnChoicesInitFailed=function(e){if(!this.config.silent)if(this.initialised){if(!this.initialisedOK)throw new TypeError("".concat(e," called for an element which has multiple instances of Choices initialised on it"))}else throw new TypeError("".concat(e," called on a non-initialised instance of Choices"))},t.version="11.1.0",t}();const wb="",Sb="";function Oc(t){let e,n;return{c(){e=b("label"),n=re(t[2]),v(e,"for",t[4])},m(i,r){$(i,e,r),y(e,n)},p(i,r){r&4&&Le(n,i[2])},d(i){i&&D(e)}}}function Wv(t){let e;return{c(){e=b("select"),v(e,"id",t[4]),v(e,"name",t[4]),v(e,"aria-label",t[2]),v(e,"class","m-1")},m(n,i){$(n,e,i)},p(n,i){i&4&&v(e,"aria-label",n[2])},i:ie,o:ie,d(n){n&&D(e)}}}function Yv(t){let e,n,i,r=t[3].length&&Lc(t);return{c(){r&&r.c(),e=j(),n=b("select"),v(n,"id",t[4]),v(n,"name",t[4]),v(n,"aria-label",t[2]),v(n,"class","m-1"),n.multiple=!0},m(s,o){r&&r.m(s,o),$(s,e,o),$(s,n,o),i=!0},p(s,o){s[3].length?r?(r.p(s,o),o&8&&H(r,1)):(r=Lc(s),r.c(),H(r,1),r.m(e.parentNode,e)):r&&(et(),B(r,1,1,()=>{r=null}),tt()),(!i||o&4)&&v(n,"aria-label",s[2])},i(s){i||(H(r),i=!0)},o(s){B(r),i=!1},d(s){r&&r.d(s),s&&D(e),s&&D(n)}}}function Lc(t){let e,n,i=t[3].length+"",r,s,o,l;return o=new zi({props:{targetHtmlId:t[5],tooltipText:`${t[3].length}
                                    ${U==="fr"&&t[3].length>1?"valeurs sélectionnées":U==="fr"&&t[3].length===1?"valeur sélectionnée":U==="en"&&t[3].length>1?"selected values":"selected value"}`}}),{c(){e=b("span"),n=b("span"),r=re(i),s=j(),ve(o.$$.fragment),v(n,"id",t[5]),v(n,"class","input-dropdown-count tag m-1 svelte-1epfuu8"),v(e,"class","is-relative")},m(a,c){$(a,e,c),y(e,n),y(n,r),y(e,s),pe(o,e,null),l=!0},p(a,c){(!l||c&8)&&i!==(i=a[3].length+"")&&Le(r,i);const u={};c&8&&(u.tooltipText=`${a[3].length}
                                    ${U==="fr"&&a[3].length>1?"valeurs sélectionnées":U==="fr"&&a[3].length===1?"valeur sélectionnée":U==="en"&&a[3].length>1?"selected values":"selected value"}`),o.$set(u)},i(a){l||(H(o.$$.fragment,a),l=!0)},o(a){B(o.$$.fragment,a),l=!1},d(a){a&&D(e),ge(o)}}}function Xv(t){let e,n,i,r,s,o,l,a=t[2]!==void 0&&Oc(t);const c=[Yv,Wv],u=[];function h(f,d){return f[0]?0:1}return r=h(t),s=u[r]=c[r](t),{c(){e=b("div"),a&&a.c(),n=j(),i=b("div"),s.c(),v(i,"class",o="input-dropdown-select "+(t[0]?"is-multiple":"is-single")+" "+(t[0]&&t[3].length?"is-flex is-justify-content-flex-start is-align-items-center":"")+" "+(t[1]?"light-display":"")+" svelte-1epfuu8"),v(e,"class","input-dropdown-select-wrapper")},m(f,d){$(f,e,d),a&&a.m(e,null),y(e,n),y(e,i),u[r].m(i,null),l=!0},p(f,[d]){f[2]!==void 0?a?a.p(f,d):(a=Oc(f),a.c(),a.m(e,n)):a&&(a.d(1),a=null);let m=r;r=h(f),r===m?u[r].p(f,d):(et(),B(u[m],1,1,()=>{u[m]=null}),tt(),s=u[r],s?s.p(f,d):(s=u[r]=c[r](f),s.c()),H(s,1),s.m(i,null)),(!l||d&11&&o!==(o="input-dropdown-select "+(f[0]?"is-multiple":"is-single")+" "+(f[0]&&f[3].length?"is-flex is-justify-content-flex-start is-align-items-center":"")+" "+(f[1]?"light-display":"")+" svelte-1epfuu8"))&&v(i,"class",o)},i(f){l||(H(s),l=!0)},o(f){B(s),l=!1},d(f){f&&D(e),a&&a.d(),u[r].d()}}}const Gv=250;function Jv(t,e,n){let i,r,{choicesItems:s}=e,{start:o=[]}=e,{multiple:l}=e,{searchable:a=!0}=e,{lightDisplay:c=!1}=e,{placeholder:u=U==="fr"?"Sélectionner une valeur":"Select a value"}=e,{title:h=void 0}=e,{selectAll:f=!!l}=e;const d=`input-dropdown-select-${window.crypto.randomUUID()}`,m=`input-dropdown-counter-${window.crypto.randomUUID()}`,p=`select-all-${window.crypto.randomUUID()}`,g=`unselect-all-${window.crypto.randomUUID()}`,_=Ti();let k;const C=Oi();C.setCompareFn(Nr);const w=zt("resetTrigger")||void 0;w==null||w.subscribe(()=>F(k,s,o,f));const S=()=>{n(11,r=!0),setTimeout(()=>n(11,r=!1),Gv)},N=(P,q)=>{q||(C.set(P),C.same()||_("updateValues",i))},M=P=>`<span class="iconify" data-icon=${P}/>`,E=(P,q)=>P!=null&&q!=null&&P.length&&q.length?`<span class="dropdown-prefix-wrapper">${q==="iconify"?M(P):P}</span>`:"",I=(P,q)=>q?[{value:p,label:`<b>${U==="fr"?"Tout sélectionner":"Select all"}</b>`},{value:g,label:`<b>${U==="fr"?"Tout retirer":"Remove all"}</b>`},...P]:P,O=(P,q)=>I(P,q).map(W=>(W.id=`dropdown-choice-${window.crypto.randomUUID()}`,W.label=`<span>
                ${E(W.prefix||"",W.prefixType||"")}
                <span class="dropdown-prefix-text">${W.label}</span>
            </span>`,W));function L(P,q,W){return P=structuredClone(P),q=structuredClone(q),P=O(P,W).map(K=>q.includes(K.value)?{...K,selected:!0}:{...K,selected:!1}),n(3,i=q),P}function F(P,q,W,K){P&&(q=L(q,W,K),P.clearStore().setChoices(q))}const z=(P,q,W,K,oe,ue)=>(K=structuredClone(K),W=structuredClone(W),P.detail.value===oe?(S(),W=W.map(he=>[oe,ue].includes(he.value)?{...he,selected:!1}:{...he,selected:!0}),q.removeActiveItems().clearChoices(!0,!0).setValue(W).hideDropdown(),K=[...new Set(W.filter(he=>he.selected===!0).map(he=>he.value))]):P.detail.value===ue?(q.removeActiveItems().hideDropdown(),K=[]):K=l===!0?[...K,P.detail.value]:[P.detail.value],[...new Set(K)]),x=(P,q)=>structuredClone(q).filter(W=>W!==P.detail.value);function V(P,q){const W=document.getElementById(d);k=new Kv(W,{items:[],choices:P,addChoices:!1,addItems:!1,removeItems:!0,removeItemButton:!0,searchEnabled:a,allowHTML:!0,shouldSort:!q,sorter:(K,oe)=>K.label.localeCompare(oe.label),placeholderValue:u,classNames:{item:["choices__item","dropdown-item"]},loadingText:U==="fr"?"Chargement...":"Loading...",noResultsText:U==="fr"?"Pas de résultats":"No results found",noChoicesText:U==="fr"?"Pas de choix pour faire la sélection":"No choices to choose from",itemSelectText:U==="fr"?"Cliquer pour sélectionner":"Press to select",uniqueItemText:U==="fr"?"Seules des valeurs uniques peuvent être ajoutées":"Only unique values can be added",customAddItemText:U==="fr"?"Les valeurs ne répondent pas aux conditions attendues":"Only values matching specific conditions can be added",removeItemIconText:U==="fr"?"Retirer l'item":"Remove item",addItemText:K=>U==="fr"?`Cliquer sur Entrer pour ajouter <b>${K}</b>`:`Press Enter to add <b>"${K}"</b>`,removeItemLabelText:K=>U==="fr"?`Retirer l'item: ${K}`:`Remove item: ${K}`,maxItemText:K=>U==="fr"?`Seulement ${K} items peuvent être ajoutées`:`Only ${K} items can be added`}),W.addEventListener("addItem",K=>{n(3,i=z(K,k,P,i,p,g))}),W.addEventListener("removeItem",K=>{n(3,i=x(K,i))})}return Dn(()=>{const P=L(s,o,f);V(P,f)}),Rn(()=>{k.destroy(),k=void 0}),t.$$set=P=>{"choicesItems"in P&&n(6,s=P.choicesItems),"start"in P&&n(7,o=P.start),"multiple"in P&&n(0,l=P.multiple),"searchable"in P&&n(8,a=P.searchable),"lightDisplay"in P&&n(1,c=P.lightDisplay),"placeholder"in P&&n(9,u=P.placeholder),"title"in P&&n(2,h=P.title),"selectAll"in P&&n(10,f=P.selectAll)},t.$$.update=()=>{t.$$.dirty&2056&&N(i,r)},n(3,i=[]),n(11,r=!1),[l,c,h,i,d,m,s,o,a,u,f,r]}class Qv extends qe{constructor(e){super(),Be(this,e,Jv,Xv,je,{choicesItems:6,start:7,multiple:0,searchable:8,lightDisplay:1,placeholder:9,title:2,selectAll:10})}}const kb="";function Zv(t){let e,n,i,r,s,o,l,a,c,u,h,f,d,m,p,g,_,k,C,w,S,N,M,E,I,O,L,F,z,x,V,P,q,W,K,oe,ue,he,ze;return c=new kn({props:{minVal:0,maxVal:1,start:t[5],emitOnUpdate:!0,title:U==="fr"?"Opacité":"Opacity"}}),c.$on("updateSlider",t[9]),f=new kn({props:{minVal:0,maxVal:360,start:t[6],step:1,emitOnUpdate:!0,title:"Rotation"}}),f.$on("updateSlider",t[10]),p=new kn({props:{minVal:0,maxVal:200,step:1,start:t[7],emitOnUpdate:!0,title:U==="fr"?"Redimensionner":"Scale"}}),p.$on("updateSlider",t[11]),k=new kn({props:{minVal:-100,maxVal:100,step:1,start:t[8][0],emitOnUpdate:!0,title:U==="fr"?"Translation horizontale":"Horizontal translate"}}),k.$on("updateSlider",t[12]),S=new kn({props:{minVal:-100,maxVal:100,step:1,start:t[8][1],emitOnUpdate:!0,title:U==="fr"?"Translation verticale":"Vertical translate"}}),S.$on("updateSlider",t[13]),E=new Qv({props:{choicesItems:t[4],start:[],lightDisplay:!0,placeholder:U==="fr"?"Sélectionner":"Select",title:U==="fr"?"Basculer":"Flip"}}),E.$on("updateValues",t[14]),{c(){e=b("div"),n=b("div"),i=b("div"),r=b("div"),s=b("strong"),s.textContent=`${U==="en"?"Query image transformation":"Modification de l'image requête"}`,o=j(),l=b("div"),a=b("div"),ve(c.$$.fragment),u=j(),h=b("div"),ve(f.$$.fragment),d=j(),m=b("div"),ve(p.$$.fragment),g=j(),_=b("div"),ve(k.$$.fragment),C=j(),w=b("div"),ve(S.$$.fragment),N=j(),M=b("div"),ve(E.$$.fragment),I=j(),O=b("div"),L=b("button"),L.textContent=`${U==="fr"?"Réinitialiser":"Reset"}`,F=j(),z=b("div"),x=b("img"),q=j(),W=b("img"),v(r,"class","toolbar-title mt-0 mb-2 svelte-nzei31"),v(a,"class"," svelte-nzei31"),v(h,"class"," svelte-nzei31"),v(m,"class"," svelte-nzei31"),v(_,"class"," svelte-nzei31"),v(w,"class"," svelte-nzei31"),v(M,"class"," svelte-nzei31"),v(L,"class","button is-link"),v(O,"class","mt-2 is-flex is-flex-direction-column is-justify-content-center is-align-items-flex-end svelte-nzei31"),v(l,"class","toolbar-controls is-flex is-flex-direction-column is-align-items-start is-justify-content-center svelte-nzei31"),v(i,"class","toolbar svelte-nzei31"),v(n,"class","toolbar-wrapper is-flex is-flex-direction-column is-justify-content-center is-align-items-center svelte-nzei31"),v(x,"class","compare-img svelte-nzei31"),xt(x.src,V=t[0].queryImage.href)||v(x,"src",V),v(x,"alt",P=t[0].queryImage.title),v(W,"class","main-img svelte-nzei31"),xt(W.src,K=t[0].similarityImage.href)||v(W,"src",K),v(W,"alt",oe=t[0].similarityImage.title),Ge(W,"overlay-reset",t[2]),Ue(W,"opacity",t[1]),Ue(W,"transform",t[3]),v(z,"class","overlay-wrapper svelte-nzei31"),v(e,"class","similarity-overlay-wrapper svelte-nzei31")},m(fe,Fe){$(fe,e,Fe),y(e,n),y(n,i),y(i,r),y(r,s),y(i,o),y(i,l),y(l,a),pe(c,a,null),y(l,u),y(l,h),pe(f,h,null),y(l,d),y(l,m),pe(p,m,null),y(l,g),y(l,_),pe(k,_,null),y(l,C),y(l,w),pe(S,w,null),y(l,N),y(l,M),pe(E,M,null),y(l,I),y(l,O),y(O,L),y(e,F),y(e,z),y(z,x),y(z,q),y(z,W),ue=!0,he||(ze=Ae(L,"click",t[15]),he=!0)},p(fe,[Fe]){(!ue||Fe&1&&!xt(x.src,V=fe[0].queryImage.href))&&v(x,"src",V),(!ue||Fe&1&&P!==(P=fe[0].queryImage.title))&&v(x,"alt",P),(!ue||Fe&1&&!xt(W.src,K=fe[0].similarityImage.href))&&v(W,"src",K),(!ue||Fe&1&&oe!==(oe=fe[0].similarityImage.title))&&v(W,"alt",oe),(!ue||Fe&4)&&Ge(W,"overlay-reset",fe[2]),Fe&2&&Ue(W,"opacity",fe[1]),Fe&8&&Ue(W,"transform",fe[3])},i(fe){ue||(H(c.$$.fragment,fe),H(f.$$.fragment,fe),H(p.$$.fragment,fe),H(k.$$.fragment,fe),H(S.$$.fragment,fe),H(E.$$.fragment,fe),ue=!0)},o(fe){B(c.$$.fragment,fe),B(f.$$.fragment,fe),B(p.$$.fragment,fe),B(k.$$.fragment,fe),B(S.$$.fragment,fe),B(E.$$.fragment,fe),ue=!1},d(fe){fe&&D(e),ge(c),ge(f),ge(p),ge(k),ge(S),ge(E),he=!1,ze()}}}function ey(t,e,n){let i,{imgData:r}=e;const s=[{value:"h",label:U==="fr"?"Basculer horizontalement":"Flip horizontally"},{value:"v",label:U==="fr"?"Basculer verticalement":"Flip vertically"},{value:"hv",label:U==="fr"?"Basculer horizontalement et verticalement":"Flip horizontally and vertically"}];let o=.5;const l=o;let a=0;const c=a;let u=100;const h=u;let f=[1,1];const d=structuredClone(f);let m=[0,0];const p=structuredClone(m);let g=!1;const _=De(window.crypto.randomUUID());$n("resetTrigger",_);const k=I=>n(1,o=I.detail),C=I=>n(16,a=I.detail),w=I=>n(17,u=I.detail),S=I=>n(19,m=[I.detail,m[1]]),N=I=>n(19,m=[m[0],I.detail]),M=I=>{let O=I.detail[0];n(18,f=O==="hv"?[-1,-1]:O==="h"?[-1,1]:O==="v"?[1,-1]:[1,1])},E=()=>{n(1,o=l),n(16,a=c),n(17,u=h),n(18,f=d),n(19,m=p),_.set(window.crypto.randomUUID()),n(2,g=!0),setTimeout(()=>n(2,g=!1),1e3)};return t.$$set=I=>{"imgData"in I&&n(0,r=I.imgData)},t.$$.update=()=>{t.$$.dirty&983040&&n(3,i=`translate(${m[0]-50}%, ${m[1]}%)
                        rotate(${a}deg)
                        scale(${f.map(I=>I*(u/100)).join()})`)},[r,o,g,i,s,l,c,h,p,k,C,w,S,N,M,E,a,u,f,m]}class ty extends qe{constructor(e){super(),Be(this,e,ey,Zv,je,{imgData:0})}}function ny(){const t=`${window.location.origin}${window.location.pathname}`,e=25,n=window.location.pathname.match(/\d+/g).join("-"),i={[n]:{}},r=[2,6],s=De(1),o=De({}),l=De(JSON.parse(localStorage.getItem("selectedRegions"))||i);l.subscribe(F=>localStorage.setItem("selectedRegions",JSON.stringify(F)));const a=De(JSON.parse(localStorage.getItem("excludedCategories"))||[]);a.subscribe(F=>localStorage.setItem("excludedCategories",JSON.stringify(F)));const c=De(JSON.parse(localStorage.getItem("similarityScoreCutoff"))||void 0);c.subscribe(F=>{F!=null&&localStorage.setItem("similarityScoreCutoff",JSON.stringify(F))});const u=De(JSON.parse(localStorage.getItem("propagateRecursionDepth"))||r[1]);u.subscribe(F=>localStorage.setItem("propagateRecursionDepth",JSON.stringify(F)));const h=De(JSON.parse(localStorage.getItem("propagateFilterByRegions"))||!1);h.subscribe(F=>localStorage.setItem("propagateFilterByRegions",JSON.stringify(F)));const f=ut([u,h],([F,z])=>({propagateRecursionDepth:F,propagateFilterByRegions:z})),d=ut([a,l,c],([F,z,x])=>({excludedCategories:F,regions:z,similarityScoreCutoff:x})),m=ut([f,d],([F,z])=>({propagate:F,similarity:z})),p=De([]),g=De([]);async function _(){const F=async()=>{const V=await(await fetch(`${t}compared-regions`)).json();o.set(V),l.update(P=>{let q=P[n]||{};if(Object.keys(q).length){let W=Object.keys(q).filter(K=>Object.keys(V).includes(K)).reduce((K,oe)=>(K[oe]=q[oe],K),{});P[n]=W}return P})},z=async()=>{const V=await(await fetch(`${t}query-images`)).json();V.length>0&&(p.set(V),O(M()))};ri.set(!0);try{await Promise.all([F(),z()])}catch(x){console.error("Error:",x),bu.set(x.message)}finally{ri.set(!1)}}function k(F){localStorage.setItem("selectedRegions",JSON.stringify(F))}function C(F){l.update(z=>{const x={...z};return delete x[n][F],k(x),x})}function w(F){l.update(z=>{const x={...z,[n]:{...z[n]||{},[F.ref]:F}};return k(x),x})}const S=ut(l,F=>z=>{var x;return(x=F[n])==null?void 0:x.hasOwnProperty(z)});function N(F){const z=St(o),x=Object.keys(z).filter(V=>V.startsWith(F));return x.length!==1?{title:"Error"}:z[x[0]]}const M=()=>Ar(s,"sp"),E=ut([s,p],([F,z])=>(async()=>I(F,z))());function I(F,z){const x=(F-1)*e,V=x+e,P=z.slice(x,V);return g.set(P),P}function O(F){Tr(F,s,"sp")}function L(F){o.update(z=>({...z,[F.ref]:F}))}return{currentPage:s,comparedRegions:o,excludedCategories:a,qImgs:p,pageQImgs:g,selectedRegions:l,propagateRecursionDepth:u,propagateFilterByRegions:h,similarityToolbarParams:m,propagateParams:f,similarityScoreCutoff:c,allowedPropagateDepthRange:r,fetchSimilarity:_,setPageQImgs:E,getRegionsInfo:N,handlePageUpdate:O,unselect:C,select:w,addComparedRegions:L,isSelected:S,pageLength:e}}const hn=ny(),{getRegionsInfo:iy}=hn;async function Dc(t,e,n,i,r,s,o=!1,l=!0){const a=()=>l?`<b>${!isNaN(parseFloat(n))&&e===1?`Score: ${n}`:e===2&&U==="en"?"Manual similarity":e===2&&U==="fr"?"Correspondance manuelle":e===3&&U==="en"?"Propagated match":"Correspondance propagée"}</b>`:"",c=u=>`${u}<br>
        Page ${parseInt(i)}<br>
        ${a()}`;return o===!0?fetch(`${r}${s}get_regions_title/${t}`).then(u=>u.json()).then(u=>c(u.title)).catch(u=>(console.error("similarity.utils.getDesc()",u),c(U==="fr"?"Titre inconnu":"Unknown title"))):Promise.resolve(c(iy(t).title))}function Rc(t,e,n){const i=t.slice();return i[16]=e[n],i}function $c(t){let e,n,i=t[16]==="queryImage"&&U==="fr"?"Image requête":t[16]==="similarityImage"&&U==="fr"?"Similarité":t[16]==="queryImage"&&U==="en"?"Query image":"Similarity",r,s,o,l,a;return o=new Jn({props:{item:t[0][t[16]],descPromise:t[1][t[16]],height:"full"}}),{c(){e=b("div"),n=b("span"),r=re(i),s=j(),ve(o.$$.fragment),l=j(),v(e,"class","img-legend-wrapper column is-flex is-flex-direction-column is-justify-content-center is-align-items-center")},m(c,u){$(c,e,u),y(e,n),y(n,r),y(e,s),pe(o,e,null),y(e,l),a=!0},p(c,u){const h={};u&1&&(h.item=c[0][c[16]]),o.$set(h)},i(c){a||(H(o.$$.fragment,c),a=!0)},o(c){B(o.$$.fragment,c),a=!1},d(c){c&&D(e),ge(o)}}}function ry(t){let e,n,i=["queryImage","similarityImage"],r=[];for(let o=0;o<2;o+=1)r[o]=$c(Rc(t,i,o));const s=o=>B(r[o],1,1,()=>{r[o]=null});return{c(){e=b("div");for(let o=0;o<2;o+=1)r[o].c();v(e,"class","side-by-side columns")},m(o,l){$(o,e,l);for(let a=0;a<2;a+=1)r[a]&&r[a].m(e,null);n=!0},p(o,[l]){if(l&3){i=["queryImage","similarityImage"];let a;for(a=0;a<2;a+=1){const c=Rc(o,i,a);r[a]?(r[a].p(c,l),H(r[a],1)):(r[a]=$c(c),r[a].c(),H(r[a],1),r[a].m(e,null))}for(et(),a=2;a<2;a+=1)s(a);tt()}},i(o){if(!n){for(let l=0;l<2;l+=1)H(r[l]);n=!0}},o(o){r=r.filter(Boolean);for(let l=0;l<2;l+=1)B(r[l]);n=!1},d(o){o&&D(e),bt(r,o)}}}function sy(t,e,n){let{imgData:i}=e;const r=zt("similarityPair"),s=new URL(window.location.href),o=s.origin,l=s.pathname,[a,c,u,h]=r.qImg.split(".")[0].split("_"),[f,d,m,p]=r.sImg.split(".")[0].split("_"),g=`${a}_${c}`,_=`${f}_${d}`,k={queryImage:Dc(g,r.similarityType,r.score,u,o,l,!0,!1),similarityImage:Dc(_,r.similarityType,r.score,m,o,l,!0,!0)};return t.$$set=C=>{"imgData"in C&&n(0,i=C.imgData)},[i,k]}class oy extends qe{constructor(e){super(),Be(this,e,sy,ry,je,{imgData:0})}}const Eb="";function ly(t){let e,n;return e=new oy({props:{imgData:t[2]}}),{c(){ve(e.$$.fragment)},m(i,r){pe(e,i,r),n=!0},p:ie,i(i){n||(H(e.$$.fragment,i),n=!0)},o(i){B(e.$$.fragment,i),n=!1},d(i){ge(e,i)}}}function ay(t){let e,n;return e=new ty({props:{imgData:t[1]}}),{c(){ve(e.$$.fragment)},m(i,r){pe(e,i,r),n=!0},p:ie,i(i){n||(H(e.$$.fragment,i),n=!0)},o(i){B(e.$$.fragment,i),n=!1},d(i){ge(e,i)}}}function cy(t){let e,n,i,r,s,o,l,a,c;const u=[ay,ly],h=[];function f(d,m){return d[0]?0:1}return i=f(t),r=h[i]=u[i](t),a=new b1({props:{start:!1,buttonDisplay:!0,toggleLabel:U==="en"?"Overlay view":"Vue superposée"}}),a.$on("updateChecked",t[3]),{c(){e=b("div"),n=b("div"),r.c(),o=j(),l=b("div"),ve(a.$$.fragment),v(n,"class",s="modal-similarity-images "+(t[0]?"overlay-wrapper":"side-by-side-wrapper")+" svelte-1qvtan5"),v(e,"class","modal-similarity svelte-1qvtan5")},m(d,m){$(d,e,m),y(e,n),h[i].m(n,null),y(e,o),y(e,l),pe(a,l,null),c=!0},p(d,[m]){let p=i;i=f(d),i===p?h[i].p(d,m):(et(),B(h[p],1,1,()=>{h[p]=null}),tt(),r=h[i],r?r.p(d,m):(r=h[i]=u[i](d),r.c()),H(r,1),r.m(n,null)),(!c||m&1&&s!==(s="modal-similarity-images "+(d[0]?"overlay-wrapper":"side-by-side-wrapper")+" svelte-1qvtan5"))&&v(n,"class",s)},i(d){c||(H(r),H(a.$$.fragment,d),c=!0)},o(d){B(r),B(a.$$.fragment,d),c=!1},d(d){d&&D(e),h[i].d(),ge(a)}}}function uy(t,e,n){let{mainImgItem:i}=e,{compareImgItem:r}=e;const s={similarityImage:{href:jt(i.img,i.img.split("_").pop()),title:a(i.title)},queryImage:{href:jt(r.img,r.img.split("_").pop()),title:a(r.title)}},o={similarityImage:i,queryImage:r};let l=!1;function a(u){return U==="fr"?`Vue principale de la région ${u}`:`Main view of region ${u}`}const c=()=>n(0,l=!l);return t.$$set=u=>{"mainImgItem"in u&&n(4,i=u.mainImgItem),"compareImgItem"in u&&n(5,r=u.compareImgItem)},[l,s,o,c,i,r]}class fy extends qe{constructor(e){super(),Be(this,e,uy,cy,je,{mainImgItem:4,compareImgItem:5})}}const dy=Object.freeze(Object.defineProperty({__proto__:null,default:fy},Symbol.toStringTag,{value:"Module"})),zc=(t,e,n,i)=>({id:t,img:t,title:`Canvas ${i} - ${n} - ${U==="en"?"Witness":"Témoin"} #${Mr(e)}`,xywh:n.split(",").map(Number),canvas:i,ref:t.replace(".jpg",""),type:pu});function hy(t){let e,n,i,r,s,o,l,a,c,u,h;return n=new Bn({props:{category:1,isSelected:t[0]===1,toggle:t[4],padding:"pl-3 pr-2"}}),r=new Bn({props:{category:2,isSelected:t[0]===2,toggle:t[4]}}),o=new Bn({props:{category:3,isSelected:t[0]===3,toggle:t[4]}}),a=new Bn({props:{category:4,isSelected:t[0]===4,toggle:t[4]}}),u=new Bn({props:{category:5,isSelected:t[0]===5,toggle:t[4],padding:"pl-2 pr-3"}}),{c(){e=b("div"),ve(n.$$.fragment),i=j(),ve(r.$$.fragment),s=j(),ve(o.$$.fragment),l=j(),ve(a.$$.fragment),c=j(),ve(u.$$.fragment),v(e,"class","tags has-addons is-dark is-center")},m(f,d){$(f,e,d),pe(n,e,null),y(e,i),pe(r,e,null),y(e,s),pe(o,e,null),y(e,l),pe(a,e,null),y(e,c),pe(u,e,null),h=!0},p(f,d){const m={};d&1&&(m.isSelected=f[0]===1),n.$set(m);const p={};d&1&&(p.isSelected=f[0]===2),r.$set(p);const g={};d&1&&(g.isSelected=f[0]===3),o.$set(g);const _={};d&1&&(_.isSelected=f[0]===4),a.$set(_);const k={};d&1&&(k.isSelected=f[0]===5),u.$set(k)},i(f){h||(H(n.$$.fragment,f),H(r.$$.fragment,f),H(o.$$.fragment,f),H(a.$$.fragment,f),H(u.$$.fragment,f),h=!0)},o(f){B(n.$$.fragment,f),B(r.$$.fragment,f),B(o.$$.fragment,f),B(a.$$.fragment,f),B(u.$$.fragment,f),h=!1},d(f){f&&D(e),ge(n),ge(r),ge(o),ge(a),ge(u)}}}function my(t){let e,n,i,r;n=new Jn({props:{item:t[3],size:256,selectable:!1,isSquare:!1}});let s=!t[2]&&hy(t);return{c(){e=b("div"),ve(n.$$.fragment),i=j(),s&&s.c()},m(o,l){$(o,e,l),pe(n,e,null),y(e,i),s&&s.m(e,null),r=!0},p(o,[l]){o[2]||s.p(o,l)},i(o){r||(H(n.$$.fragment,o),H(s),r=!0)},o(o){B(n.$$.fragment,o),B(s),r=!1},d(o){o&&D(e),ge(n),s&&s.d()}}}function py(t,e,n){let i,r,s;const{comparedRegions:o}=hn;Me(t,o,z=>n(15,s=z));const l=new URL(window.location.href),a=l.origin;l.pathname;let{qImg:c}=e,{sImg:u}=e,{qRegions:h}=e,{sRegions:f}=e,{score:d=0}=e,{category:m=null}=e,{users:p=[]}=e,{isManual:g}=e,{similarityType:_}=e;const k=zt("isInModal")||!1,[C,w,S,N]=u.split(".")[0].split("_"),E=(()=>{let z=zc(u,C,N,S);const x=s[`${C}_${w}_anno${f}`]||{title:z.title};return z.title=`${ku(x.title.replace(/^[^|]+/,""))}<br/>Page ${Su(S)}<br/><b>Score: ${d}</b>`,z})();$n("similarityPair",{qImg:c,sImg:u,qRegions:h,sRegions:f,score:d,category:m,users:p,isManual:g,similarityType:_});function I(z){z=z.slice();let x=z.indexOf(Number(Ir));return r&&x===-1?z.push(Number(Ir)):!r&&x!==-1&&z.splice(x,1),z}const O=()=>({img_1:c,img_2:u,regions_id_1:h,regions_id_2:f,score:d,category:i,category_x:I(p),similarity_type:_});function L(z){z===5?r=!r:n(0,i=i===z?null:z)}async function F(z){L(z);try{(await fetch(`${a}/${Yt}/save-category`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":_n},body:JSON.stringify(O())})).ok||(console.error("Error: Network response was not ok"),L(z))}catch(x){console.error("Error:",x),L(z)}}return t.$$set=z=>{"qImg"in z&&n(5,c=z.qImg),"sImg"in z&&n(6,u=z.sImg),"qRegions"in z&&n(7,h=z.qRegions),"sRegions"in z&&n(8,f=z.sRegions),"score"in z&&n(9,d=z.score),"category"in z&&n(10,m=z.category),"users"in z&&n(11,p=z.users),"isManual"in z&&n(12,g=z.isManual),"similarityType"in z&&n(13,_=z.similarityType)},t.$$.update=()=>{t.$$.dirty&1024&&n(0,i=m),t.$$.dirty&2048&&(r=p.includes(Number(Ir))||!1)},[i,o,k,E,F,c,u,h,f,d,m,p,g,_]}class gy extends qe{constructor(e){super(),Be(this,e,py,my,je,{qImg:5,sImg:6,qRegions:7,sRegions:8,score:9,category:10,users:11,isManual:12,similarityType:13})}}function jc(t,e,n){const i=t.slice();return i[22]=e[n].uuid,i[23]=e[n].data[0],i[24]=e[n].data[1],i[25]=e[n].data[2],i[26]=e[n].data[3],i[27]=e[n].data[4],i[28]=e[n].data[5],i[29]=e[n].data[6],i[30]=e[n].data[7],i[31]=e[n].data[8],i}function _y(t){let e,n=U==="en"?`Error when retrieving similar regions: ${t[2]}`:`Erreur de recupération des régions similaires: ${t[2]}`,i;return{c(){e=b("div"),i=re(n),v(e,"class","faded is-center")},m(r,s){$(r,e,s),y(e,i)},p(r,s){s[0]&4&&n!==(n=U==="en"?`Error when retrieving similar regions: ${r[2]}`:`Erreur de recupération des régions similaires: ${r[2]}`)&&Le(i,n)},i:ie,o:ie,d(r){r&&D(e)}}}function vy(t){let e,n,i=t[4].length+"",r,s,o=t[11](t[10],t[4].length)+"",l,a,c,u=[],h=new Map,f,d=t[4];const m=g=>g[22];for(let g=0;g<d.length;g+=1){let _=jc(t,d,g),k=m(_);h.set(k,u[g]=Hc(k,_))}let p=null;return d.length||(p=Fc(t)),{c(){e=b("div"),n=b("span"),r=re(i),s=j(),l=re(o),a=j(),c=b("div");for(let g=0;g<u.length;g+=1)u[g].c();p&&p.c(),v(n,"class","m-2"),v(c,"class","m-2 is-gap-2"),Ge(c,"grid",t[4].length>0)},m(g,_){$(g,e,_),y(e,n),y(n,r),y(n,s),y(n,l),y(e,a),y(e,c);for(let k=0;k<u.length;k+=1)u[k]&&u[k].m(c,null);p&&p.m(c,null),f=!0},p(g,_){(!f||_[0]&16)&&i!==(i=g[4].length+"")&&Le(r,i),(!f||_[0]&16)&&o!==(o=g[11](g[10],g[4].length)+"")&&Le(l,o),_[0]&49&&(d=g[4],et(),u=ii(u,_,m,1,g,d,h,c,Cr,Hc,null,jc),tt(),!d.length&&p?p.p(g,_):d.length?p&&(p.d(1),p=null):(p=Fc(g),p.c(),p.m(c,null))),(!f||_[0]&16)&&Ge(c,"grid",g[4].length>0)},i(g){if(!f){for(let _=0;_<d.length;_+=1)H(u[_]);f=!0}},o(g){for(let _=0;_<u.length;_+=1)B(u[_]);f=!1},d(g){g&&D(e);for(let _=0;_<u.length;_+=1)u[_].d();p&&p.d()}}}function yy(t){let e;return{c(){e=b("div"),e.textContent=`${U==="en"&&!t[10]?"Retrieving similar regions...":U==="fr"&&!t[10]?"Récupération des régions similaires...":U==="en"&&t[10]?"Retrieving propagated regions...":"Récupération de similarités propagées..."}`,v(e,"class","faded is-center")},m(n,i){$(n,e,i)},p:ie,i:ie,o:ie,d(n){n&&D(e)}}}function Fc(t){let e;function n(s,o){return s[5]?wy:by}let i=n(t),r=i(t);return{c(){r.c(),e=kt()},m(s,o){r.m(s,o),$(s,e,o)},p(s,o){i===(i=n(s))&&r?r.p(s,o):(r.d(1),r=i(s),r&&(r.c(),r.m(e.parentNode,e)))},d(s){r.d(s),s&&D(e)}}}function by(t){let e;return{c(){e=b("div"),e.textContent=`${U==="en"?"No similar regions":"Pas de régions similaires"}
                    `,v(e,"class","faded is-center")},m(n,i){$(n,e,i)},p:ie,d(n){n&&D(e)}}}function wy(t){let e;return{c(){e=b("div"),e.textContent=`${U==="en"?"No document selected. Select one to display results.":"Aucun document sélectionné. Sélectionnez-en un pour afficher les résultats."}
                    `,v(e,"class","faded is-center")},m(n,i){$(n,e,i)},p:ie,d(n){n&&D(e)}}}function Hc(t,e){let n,i,r;return i=new gy({props:{qImg:e[0],sImg:e[25],score:e[23],qRegions:e[26],sRegions:e[27],category:e[28],users:e[29],isManual:e[30],similarityType:e[31]}}),{key:t,first:null,c(){n=kt(),ve(i.$$.fragment),this.first=n},m(s,o){$(s,n,o),pe(i,s,o),r=!0},p(s,o){e=s;const l={};o[0]&1&&(l.qImg=e[0]),o[0]&16&&(l.sImg=e[25]),o[0]&16&&(l.score=e[23]),o[0]&16&&(l.qRegions=e[26]),o[0]&16&&(l.sRegions=e[27]),o[0]&16&&(l.category=e[28]),o[0]&16&&(l.users=e[29]),o[0]&16&&(l.isManual=e[30]),o[0]&16&&(l.similarityType=e[31]),i.$set(l)},i(s){r||(H(i.$$.fragment,s),r=!0)},o(s){B(i.$$.fragment,s),r=!1},d(s){s&&D(n),ge(i,s)}}}function Sy(t){let e,n,i,r;const s=[yy,vy,_y],o=[];function l(a,c){return a[1]&&a[3]==="loading"?0:a[3]==="loaded"?1:a[3]==="error"?2:-1}return~(e=l(t))&&(n=o[e]=s[e](t)),{c(){n&&n.c(),i=kt()},m(a,c){~e&&o[e].m(a,c),$(a,i,c),r=!0},p(a,c){let u=e;e=l(a),e===u?~e&&o[e].p(a,c):(n&&(et(),B(o[u],1,1,()=>{o[u]=null}),tt()),~e?(n=o[e],n?n.p(a,c):(n=o[e]=s[e](a),n.c()),H(n,1),n.m(i.parentNode,i)):n=null)},i(a){r||(H(n),r=!0)},o(a){B(n),r=!1},d(a){~e&&o[e].d(a),a&&D(i)}}}function ky(t,e,n){let i,r,s,o,l,a,c,u,{qImg:h}=e,{sImgsPromise:f}=e;const{selectedRegions:d,excludedCategories:m,similarityScoreCutoff:p,propagateFilterByRegions:g}=hn;Me(t,d,I=>n(16,u=I)),Me(t,m,I=>n(15,c=I)),Me(t,p,I=>n(14,a=I)),Me(t,g,I=>n(13,l=I));const _=zt("similarityPropagatedContext")||!1,k=window.location.pathname.match(/\d+/g).join("-");let C;const w=(I,O)=>I===null||O===void 0||Number(I)>=O,S=(I,O,L)=>!L.includes(I),N=(I,O,L,F,z,x)=>_?!0:w(I,z)&&S(O,L,F),M=(I,O,L,F)=>I.filter(({uuid:z,data:[x,V,P,q,W,K,oe,ue,he]})=>N(x,K,oe,O,L)),E=(I,O)=>{const L=O>1;return I?U==="fr"?L?"similarités propagées":"similarité propagée":L?"propagated matches":"propagated match":U==="fr"?L?"images similaires":"image similaire":L?"similar images":"similar image"};return t.$$set=I=>{"qImg"in I&&n(0,h=I.qImg),"sImgsPromise"in I&&n(1,f=I.sImgsPromise)},t.$$.update=()=>{t.$$.dirty[0]&65536&&n(5,i=Object.values(u).length===0||u[k]===void 0||!Object.keys(u[k]).length),t.$$.dirty[0]&2&&(I=>{n(3,r="loading"),n(4,o=[]),n(12,s=[])})(),t.$$.dirty[0]&2&&f.then(I=>{n(12,s=I.map(O=>({uuid:window.crypto.randomUUID(),data:O}))),n(3,r="loaded")}).catch(I=>{n(2,C=I),n(3,r="error")}),t.$$.dirty[0]&61440&&n(4,o=M(s,c,a))},n(3,r="loading"),n(12,s=[]),[h,f,C,r,o,i,d,m,p,g,_,E,s,l,a,c,u]}class Vc extends qe{constructor(e){super(),Be(this,e,ky,Sy,je,{qImg:0,sImgsPromise:1},null,[-1,-1])}}function Ey(t){let e,n;return e=new Vc({props:{qImg:t[0],sImgsPromise:t[1]}}),{c(){ve(e.$$.fragment)},m(i,r){pe(e,i,r),n=!0},p(i,[r]){const s={};r&1&&(s.qImg=i[0]),r&2&&(s.sImgsPromise=i[1]),e.$set(s)},i(i){n||(H(e.$$.fragment,i),n=!0)},o(i){B(e.$$.fragment,i),n=!1},d(i){ge(e,i)}}}function Cy(t,e,n){let i,r,{qImg:s}=e,o;const l=zt("isInModal")||!1,{selectedRegions:a,comparedRegions:c}=hn;Me(t,a,m=>n(4,i=m)),Me(t,c,m=>n(5,r=m));const u=`${window.location.origin}${window.location.pathname}`,h=window.location.pathname.match(/\d+/g).join("-"),f=(m,p)=>p?Object.keys(r).map(g=>r[g].id):Object.values(m[h]||{}).map(g=>g.id);async function d(m,p,g){const _=f(p,g);return _.length===0?[]:await(await fetch(`${u}similar-images`,{method:"POST",body:JSON.stringify({regionsIds:_,qImg:m,topk:12}),headers:{"Content-Type":"application/json","X-CSRFToken":_n}})).json()}return l?o=d(s,i,l):a.subscribe(m=>{n(1,o=d(s,m,l))}),t.$$set=m=>{"qImg"in m&&n(0,s=m.qImg)},[s,o,a,c]}class Iy extends qe{constructor(e){super(),Be(this,e,Cy,Ey,je,{qImg:0})}}const Cb="";function xy(t){let e,n,i,r;return i=new Vc({props:{qImg:t[0],sImgsPromise:t[1]}}),{c(){e=b("div"),n=b("div"),ve(i.$$.fragment),v(n,"class","matches-suggestion svelte-1cb4wg0"),v(e,"class","block matches-suggestion-wrapper svelte-1cb4wg0")},m(s,o){$(s,e,o),y(e,n),pe(i,n,null),r=!0},p(s,[o]){const l={};o&1&&(l.qImg=s[0]),o&2&&(l.sImgsPromise=s[1]),i.$set(l)},i(s){r||(H(i.$$.fragment,s),r=!0)},o(s){B(i.$$.fragment,s),r=!1},d(s){s&&D(e),ge(i)}}}function My(t,e,n){let i,r,{qImg:s}=e;const{propagateParams:o,selectedRegions:l}=hn;Me(t,o,g=>n(4,i=g)),Me(t,l,g=>n(5,r=g));const a=`${window.location.origin}${window.location.pathname}`,c=window.location.pathname.match(/\d+/g).join("-"),u=zt("isInModal")||!1;let h;const f=Oi();f.setCompareFn((g,_)=>[g,_].every(k=>k&&k.hasOwnProperty("propagateRecursionDepth")&&k.hasOwnProperty("propagateFilterByRegions"))?g.propagateRecursionDepth===_.propagateRecursionDepth&&g.propagateFilterByRegions===_.propagateFilterByRegions:!1);const d=Oi();d.setCompareFn(Nr),$n("similarityPropagatedContext",!0);const m=g=>Object.keys(g).includes(c)?Object.values(g[c]).map(_=>_.id):[],p=async(g,_,k)=>fetch(`${a}propagated-matches/${s}`,{method:"POST",body:JSON.stringify({regionsIds:k?[]:_,filterByRegions:k?!1:g.propagateFilterByRegions,recursionDepth:g.propagateRecursionDepth}),headers:{"Content-Type":"application/json","X-CSRFToken":_n}}).then(C=>C.json()).catch(C=>(console.error("PropagatedMatches.getPropagatedMatches:",C),[]));return o.subscribe(g=>{f.set(g),f.same()||n(1,h=p(f.get(),m(r),u))}),l.subscribe(g=>{d.set(m(g)),i.propagateFilterByRegions===!0&&!d.same()&&n(1,h=p(i,d.get(),u))}),t.$$set=g=>{"qImg"in g&&n(0,s=g.qImg)},[s,h,o,l]}class Ay extends qe{constructor(e){super(),Be(this,e,My,xy,je,{qImg:0})}}const Ib="";function Ty(t){let e,n,i,r=parseInt(t[5])+"",s,o,l,a,c,u,h,f,d,m,p,g,_,k,C,w,S,N,M;return{c(){e=b("a"),n=b("i"),i=re(`
            Page `),s=re(r),o=j(),l=b("img"),c=j(),u=b("div"),h=b("div"),f=b("input"),d=j(),m=b("button"),m.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M256 80c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 144L48 224c-17.7 0-32 14.3-32 32s14.3 32 32 32l144 0 0 144c0 17.7 14.3 32 32 32s32-14.3 32-32l0-144 144 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-144 0 0-144z"></path></svg>',p=j(),g=b("button"),_=Wt("svg"),k=Wt("path"),v(n,"class","fa-solid fa-pen-to-square"),v(e,"class","tag px-2 py-1 mb-2 is-rounded is-hoverable"),v(e,"href",Mu(t[6],parseInt(t[5]))),v(e,"target","_blank"),xt(l.src,a=jt(t[0],t[0].split("_").pop(),"250,"))||v(l,"src",a),v(l,"alt","Query region"),v(l,"class","mb-3 card query-image svelte-f4ylwc"),v(f,"class","input is-small tag"),v(f,"type","text"),v(f,"placeholder",U==="en"?"Add new match":"Ajouter une correspondance"),v(m,"class","button is-small tag is-link is-center"),v(h,"class","tags has-addons"),Ue(h,"flex-wrap","nowrap"),v(k,"fill","white"),v(k,"d","M376.6 84.5c11.3-13.6 9.5-33.8-4.1-45.1s-33.8-9.5-45.1 4.1L192 206 56.6 43.5C45.3 29.9 25.1 28.1 11.5 39.4S-3.9 70.9 7.4 84.5L150.3 256 7.4 427.5c-11.3 13.6-9.5 33.8 4.1 45.1s33.8 9.5 45.1-4.1L192 306 327.4 468.5c11.3 13.6 31.5 15.4 45.1 4.1s15.4-31.5 4.1-45.1L233.7 256 376.6 84.5z"),v(_,"xmlns","http://www.w3.org/2000/svg"),v(_,"viewBox","0 0 384 512"),v(g,"id","no-match"),v(g,"class",C="button is-small tag is-danger is-center m-0 "+(t[3]===1?"visible":"")+" svelte-f4ylwc"),v(g,"title",U==="en"?"No match for this region in this witness":"Aucune correspondance de cette région pour ce témoin"),v(u,"class","new-similarity control pt-2 is-center svelte-f4ylwc")},m(E,I){$(E,e,I),y(e,n),y(e,i),y(e,s),$(E,o,I),$(E,l,I),$(E,c,I),$(E,u,I),y(u,h),y(h,f),Ii(f,t[1]),y(h,d),y(h,m),y(u,p),y(u,g),y(g,_),y(_,k),S=!0,N||(M=[Ae(f,"input",t[12]),Ae(m,"click",t[8]),Ae(g,"click",t[9])],N=!0)},p(E,I){(!S||I&1&&!xt(l.src,a=jt(E[0],E[0].split("_").pop(),"250,")))&&v(l,"src",a),I&2&&f.value!==E[1]&&Ii(f,E[1]),(!S||I&8&&C!==(C="button is-small tag is-danger is-center m-0 "+(E[3]===1?"visible":"")+" svelte-f4ylwc"))&&v(g,"class",C)},i(E){S||(Kt(()=>{S&&(w||(w=gn(g,Un,{duration:500},!0)),w.run(1))}),S=!0)},o(E){w||(w=gn(g,Un,{duration:500},!1)),w.run(0),S=!1},d(E){E&&D(e),E&&D(o),E&&D(l),E&&D(c),E&&D(u),E&&w&&w.end(),N=!1,vt(M)}}}function Ny(t){let e,n,i,r,s,o,l,a;return n=new Iy({props:{qImg:t[0]}}),o=new Ay({props:{qImg:t[0]}}),{c(){e=b("div"),ve(n.$$.fragment),r=j(),s=b("div"),ve(o.$$.fragment),v(e,"class",i=Ci(t[7]?"":t[2])+" svelte-f4ylwc"),v(s,"class",l=Ci(t[7]?"":t[2])+" svelte-f4ylwc")},m(c,u){$(c,e,u),pe(n,e,null),$(c,r,u),$(c,s,u),pe(o,s,null),a=!0},p(c,u){const h={};u&1&&(h.qImg=c[0]),n.$set(h),(!a||u&4&&i!==(i=Ci(c[7]?"":c[2])+" svelte-f4ylwc"))&&v(e,"class",i);const f={};u&1&&(f.qImg=c[0]),o.$set(f),(!a||u&4&&l!==(l=Ci(c[7]?"":c[2])+" svelte-f4ylwc"))&&v(s,"class",l)},i(c){a||(H(n.$$.fragment,c),H(o.$$.fragment,c),a=!0)},o(c){B(n.$$.fragment,c),B(o.$$.fragment,c),a=!1},d(c){c&&D(e),ge(n),c&&D(r),c&&D(s),ge(o)}}}function Py(t){let e,n;return e=new Aa({props:{useGrid:!1,$$slots:{"row-body":[Ny],"row-header":[Ty]},$$scope:{ctx:t}}}),{c(){ve(e.$$.fragment)},m(i,r){pe(e,i,r),n=!0},p(i,[r]){const s={};r&2097167&&(s.$$scope={dirty:r,ctx:i}),e.$set(s)},i(i){n||(H(e.$$.fragment,i),n=!0)},o(i){B(e.$$.fragment,i),n=!1},d(i){ge(e,i)}}}function Oy(t){return t=t.replace(".jpg",""),/^wit\d+_[a-zA-Z]{3}\d+_\d+_\d+,\d+,\d+,\d+$/.test(t)}function Ly(t,e,n){let i,r,s,o;const{selectedRegions:l}=hn;Me(t,l,N=>n(11,o=N));let{qImg:a}=e,c="";const[u,h,f,d]=a.split(".")[0].split("_"),m=`${window.location.origin}${window.location.pathname}`,p=window.location.pathname.match(/\d+/g).join("-"),g=U==="en"?"Error":"Erreur",_=zt("manifest"),k=zt("isInModal")||!1;jt(a,a.split("_").at(-1),"250,"),$n("qImgMetadata",zc(a,u,d,f));async function C(){if(!c||!Oy(c)){await Mt(U==="en"?"Please insert a valid region reference to add a new match":"Veuillez insérer une référence de région valide pour ajouter une nouvelle correspondance","Error");return}try{const N=await fetch(`${m}add-region-pair`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":_n},body:JSON.stringify({q_img:a.replace(".jpg",""),s_img:c,similarity_type:2})});N.ok||(console.error("Error: Network response was not ok"),await Mt(U==="en"?"Problem with network, match was not added":"Problème de réseau, la correspondance n'a pas été ajoutée",g));const M=await N.json();if(M.hasOwnProperty("error")||!M.hasOwnProperty("s_regions")){await Mt(U==="en"?`Request was unsuccessful, match was not added:<br>${M.error}`:`La requête n'a pas abouti, la correspondance n'a pas été ajoutée :<br>${M.error}`,g);return}const E=M.s_regions;hn.addComparedRegions(E),hn.select(E)}catch(N){console.error("Error:",N),await Mt(U==="en"?`An error has occurred, match was not added:<br>${N}`:`Une erreur s'est produite, la correspondance n'a pas été ajoutée :<br>${N}`,g)}}async function w(){const N=Object.values(o[p])[0];if(await Mt(U==="en"?`Do you confirm this region does not have any match in ${N.title}?`:`Confirmez-vous que cette région n'a pas de correspondance dans ${N.title} ?`,U==="en"?"Confirm no match":"Confirmer l'absence de correspondance",!0))try{(await fetch(`${m}no-match`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":_n},body:JSON.stringify({q_img:a,s_regions:N.id})})).ok||(console.error("Error: Network response was not ok"),await Mt(U==="en"?"Problem with network":"Problème de réseau",g)),hn.select(N)}catch(E){console.error("Error:",E),await Mt(U==="en"?`An error has occurred, request was unsuccessful:<br>${E}`:`Une erreur s'est produite, la requête n'a pas abouti :<br>${E}`,g)}}function S(){c=this.value,n(1,c)}return t.$$set=N=>{"qImg"in N&&n(0,a=N.qImg)},t.$$.update=()=>{t.$$.dirty&2048&&n(3,i=o.hasOwnProperty(p)?Object.values(o[p]).length:0),t.$$.dirty&1024&&n(2,s=`fixed-grid has-${r-1}-cols`)},n(10,r=Us(window.innerWidth)),[a,c,s,i,l,f,_,k,C,w,r,o,S]}class Dy extends qe{constructor(e){super(),Be(this,e,Ly,Py,je,{qImg:0})}}function Ry(t){let e,n,i,r,s,o;return s=new Dy({props:{qImg:t[0].img}}),{c(){e=b("div"),n=b("a"),i=b("button"),i.textContent=`${U==="fr"?"Voir toutes les similarités pour ce document":"View all similarities for this document"}`,r=j(),ve(s.$$.fragment),v(i,"class","button is-link is-small"),v(n,"href",t[1]()),v(e,"class","is-flex is-align-items-center is-justify-content-end")},m(l,a){$(l,e,a),y(e,n),y(n,i),$(l,r,a),pe(s,l,a),o=!0},p(l,[a]){const c={};a&1&&(c.qImg=l[0].img),s.$set(c)},i(l){o||(H(s.$$.fragment,l),o=!0)},o(l){B(s.$$.fragment,l),o=!1},d(l){l&&D(e),l&&D(r),ge(s,l)}}}function $y(t,e,n){let{mainImgItem:i}=e;function r(){const s=i.img.match(/wit(\d+)/)[1],o=new URL(window.location.origin);return o.pathname=`${new URL(window.location).pathname.split("/")[1]}/witness/${s}/regions/`,o.searchParams.set("tab","similarity"),o.href}return t.$$set=s=>{"mainImgItem"in s&&n(0,i=s.mainImgItem)},[i,r]}class zy extends qe{constructor(e){super(),Be(this,e,$y,Ry,je,{mainImgItem:0})}}const jy=Object.freeze(Object.defineProperty({__proto__:null,default:zy},Symbol.toStringTag,{value:"Module"}))})();
//# sourceMappingURL=documentSet.js.map
