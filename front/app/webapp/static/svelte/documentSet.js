(function(){"use strict";function X(){}const Cs=t=>t;function Is(t,e){for(const n in e)t[n]=e[n];return t}function wc(t){return!!t&&(typeof t=="object"||typeof t=="function")&&typeof t.then=="function"}function Ms(t){return t()}function xs(){return Object.create(null)}function Ge(t){t.forEach(Ms)}function vn(t){return typeof t=="function"}function pe(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}let hi;function gt(t,e){return hi||(hi=document.createElement("a")),hi.href=e,t===hi.href}function Sc(t){return Object.keys(t).length===0}function di(t,...e){if(t==null)return X;const n=t.subscribe(...e);return n.unsubscribe?()=>n.unsubscribe():n}function et(t){let e;return di(t,n=>e=n)(),e}function de(t,e,n){t.$$.on_destroy.push(di(e,n))}function kt(t,e,n,i){if(t){const r=As(t,e,n,i);return t[0](r)}}function As(t,e,n,i){return t[1]&&i?Is(n.ctx.slice(),t[1](i(e))):n.ctx}function Et(t,e,n,i){if(t[2]&&i){const r=t[2](i(n));if(e.dirty===void 0)return r;if(typeof r=="object"){const s=[],o=Math.max(e.dirty.length,r.length);for(let l=0;l<o;l+=1)s[l]=e.dirty[l]|r[l];return s}return e.dirty|r}return e.dirty}function Ct(t,e,n,i,r,s){if(r){const o=As(e,n,i,s);t.p(o,r)}}function It(t){if(t.ctx.length>32){const e=[],n=t.ctx.length/32;for(let i=0;i<n;i++)e[i]=-1;return e}return-1}function kc(t){const e={};for(const n in t)e[n]=!0;return e}function mi(t){return t??""}function pi(t){return t&&vn(t.destroy)?t.destroy:X}const Ts=typeof window<"u";let Ec=Ts?()=>window.performance.now():()=>Date.now(),ur=Ts?t=>requestAnimationFrame(t):X;const yn=new Set;function Ns(t){yn.forEach(e=>{e.c(t)||(yn.delete(e),e.f())}),yn.size!==0&&ur(Ns)}function Cc(t){let e;return yn.size===0&&ur(Ns),{promise:new Promise(n=>{yn.add(e={c:t,f:n})}),abort(){yn.delete(e)}}}function y(t,e){t.appendChild(e)}function Os(t){if(!t)return document;const e=t.getRootNode?t.getRootNode():t.ownerDocument;return e&&e.host?e:t.ownerDocument}function Ic(t){const e=w("style");return Mc(Os(t),e),e.sheet}function Mc(t,e){return y(t.head||t,e),e.sheet}function j(t,e,n){t.insertBefore(e,n||null)}function z(t){t.parentNode&&t.parentNode.removeChild(t)}function Ye(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function w(t){return document.createElement(t)}function xt(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function ne(t){return document.createTextNode(t)}function U(){return ne(" ")}function qe(){return ne("")}function ge(t,e,n,i){return t.addEventListener(e,n,i),()=>t.removeEventListener(e,n,i)}function Ut(t){return function(e){return e.preventDefault(),t.call(this,e)}}function v(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function xc(t){return Array.from(t.childNodes)}function _e(t,e){e=""+e,t.data!==e&&(t.data=e)}function gi(t,e){t.value=e??""}function De(t,e,n,i){n==null?t.style.removeProperty(e):t.style.setProperty(e,n,i?"important":"")}function Se(t,e,n){t.classList[n?"add":"remove"](e)}function Ps(t,e,{bubbles:n=!1,cancelable:i=!1}={}){const r=document.createEvent("CustomEvent");return r.initCustomEvent(t,n,i,e),r}function _i(t,e){return new t(e)}const vi=new Map;let yi=0;function Ac(t){let e=5381,n=t.length;for(;n--;)e=(e<<5)-e^t.charCodeAt(n);return e>>>0}function Tc(t,e){const n={stylesheet:Ic(e),rules:{}};return vi.set(t,n),n}function Ls(t,e,n,i,r,s,o,l=0){const a=16.666/i;let c=`{
`;for(let p=0;p<=1;p+=a){const _=e+(n-e)*s(p);c+=p*100+`%{${o(_,1-_)}}
`}const u=c+`100% {${o(n,1-n)}}
}`,d=`__svelte_${Ac(u)}_${l}`,f=Os(t),{stylesheet:h,rules:m}=vi.get(f)||Tc(f,t);m[d]||(m[d]=!0,h.insertRule(`@keyframes ${d} ${u}`,h.cssRules.length));const g=t.style.animation||"";return t.style.animation=`${g?`${g}, `:""}${d} ${i}ms linear ${r}ms 1 both`,yi+=1,d}function Nc(t,e){const n=(t.style.animation||"").split(", "),i=n.filter(e?s=>s.indexOf(e)<0:s=>s.indexOf("__svelte")===-1),r=n.length-i.length;r&&(t.style.animation=i.join(", "),yi-=r,yi||Oc())}function Oc(){ur(()=>{yi||(vi.forEach(t=>{const{ownerNode:e}=t.stylesheet;e&&z(e)}),vi.clear())})}let Vn;function Bt(t){Vn=t}function bn(){if(!Vn)throw new Error("Function called outside component initialization");return Vn}function Hn(t){bn().$$.on_mount.push(t)}function Un(t){bn().$$.on_destroy.push(t)}function bi(){const t=bn();return(e,n,{cancelable:i=!1}={})=>{const r=t.$$.callbacks[e];if(r){const s=Ps(e,n,{cancelable:i});return r.slice().forEach(o=>{o.call(t,s)}),!s.defaultPrevented}return!0}}function wn(t,e){return bn().$$.context.set(t,e),e}function _t(t){return bn().$$.context.get(t)}const Sn=[],kn=[];let En=[];const Ds=[],Pc=Promise.resolve();let fr=!1;function Lc(){fr||(fr=!0,Pc.then(dr))}function qt(t){En.push(t)}const hr=new Set;let Cn=0;function dr(){if(Cn!==0)return;const t=Vn;do{try{for(;Cn<Sn.length;){const e=Sn[Cn];Cn++,Bt(e),Dc(e.$$)}}catch(e){throw Sn.length=0,Cn=0,e}for(Bt(null),Sn.length=0,Cn=0;kn.length;)kn.pop()();for(let e=0;e<En.length;e+=1){const n=En[e];hr.has(n)||(hr.add(n),n())}En.length=0}while(Sn.length);for(;Ds.length;)Ds.pop()();fr=!1,hr.clear(),Bt(t)}function Dc(t){if(t.fragment!==null){t.update(),Ge(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(qt)}}function Rc(t){const e=[],n=[];En.forEach(i=>t.indexOf(i)===-1?e.push(i):n.push(i)),n.forEach(i=>i()),En=e}let Bn;function $c(){return Bn||(Bn=Promise.resolve(),Bn.then(()=>{Bn=null})),Bn}function mr(t,e,n){t.dispatchEvent(Ps(`${e?"intro":"outro"}${n}`))}const wi=new Set;let Kt;function ke(){Kt={r:0,c:[],p:Kt}}function Ee(){Kt.r||Ge(Kt.c),Kt=Kt.p}function F(t,e){t&&t.i&&(wi.delete(t),t.i(e))}function K(t,e,n,i){if(t&&t.o){if(wi.has(t))return;wi.add(t),Kt.c.push(()=>{wi.delete(t),i&&(n&&t.d(1),i())}),t.o(e)}else i&&i()}const zc={duration:0};function Zt(t,e,n,i){const r={direction:"both"};let s=e(t,n,r),o=i?0:1,l=null,a=null,c=null;function u(){c&&Nc(t,c)}function d(h,m){const g=h.b-o;return m*=Math.abs(g),{a:o,b:h.b,d:g,duration:m,start:h.start,end:h.start+m,group:h.group}}function f(h){const{delay:m=0,duration:g=300,easing:p=Cs,tick:_=X,css:S}=s||zc,I={start:Ec()+m,b:h};h||(I.group=Kt,Kt.r+=1),l||a?a=I:(S&&(u(),c=Ls(t,o,h,g,m,p,S)),h&&_(0,1),l=d(I,g),qt(()=>mr(t,h,"start")),Cc(b=>{if(a&&b>a.start&&(l=d(a,g),a=null,mr(t,l.b,"start"),S&&(u(),c=Ls(t,o,l.b,l.duration,0,p,s.css))),l){if(b>=l.end)_(o=l.b,1-o),mr(t,l.b,"end"),a||(l.b?u():--l.group.r||Ge(l.group.c)),l=null;else if(b>=l.start){const E=b-l.start;o=l.a+l.d*p(E/l.duration),_(o,1-o)}}return!!(l||a)}))}return{run(h){vn(s)?$c().then(()=>{s=s(r),f(h)}):f(h)},end(){u(),l=a=null}}}function pr(t,e){const n=e.token={};function i(r,s,o,l){if(e.token!==n)return;e.resolved=l;let a=e.ctx;o!==void 0&&(a=a.slice(),a[o]=l);const c=r&&(e.current=r)(a);let u=!1;e.block&&(e.blocks?e.blocks.forEach((d,f)=>{f!==s&&d&&(ke(),K(d,1,1,()=>{e.blocks[f]===d&&(e.blocks[f]=null)}),Ee())}):e.block.d(1),c.c(),F(c,1),c.m(e.mount(),e.anchor),u=!0),e.block=c,e.blocks&&(e.blocks[s]=c),u&&dr()}if(wc(t)){const r=bn();if(t.then(s=>{Bt(r),i(e.then,1,e.value,s),Bt(null)},s=>{if(Bt(r),i(e.catch,2,e.error,s),Bt(null),!e.hasCatch)throw s}),e.current!==e.pending)return i(e.pending,0),!0}else{if(e.current!==e.then)return i(e.then,1,e.value,t),!0;e.resolved=t}}function Rs(t,e,n){const i=e.slice(),{resolved:r}=t;t.current===t.then&&(i[t.value]=r),t.current===t.catch&&(i[t.error]=r),t.block.p(i,n)}function gr(t,e){K(t,1,1,()=>{e.delete(t.key)})}function _r(t,e,n,i,r,s,o,l,a,c,u,d){let f=t.length,h=s.length,m=f;const g={};for(;m--;)g[t[m].key]=m;const p=[],_=new Map,S=new Map,I=[];for(m=h;m--;){const x=d(r,s,m),k=n(x);let M=o.get(k);M?i&&I.push(()=>M.p(x,e)):(M=c(k,x),M.c()),_.set(k,p[m]=M),k in g&&S.set(k,Math.abs(m-g[k]))}const b=new Set,E=new Set;function O(x){F(x,1),x.m(l,u),o.set(x.key,x),u=x.first,h--}for(;f&&h;){const x=p[h-1],k=t[f-1],M=x.key,P=k.key;x===k?(u=x.first,f--,h--):_.has(P)?!o.has(M)||b.has(M)?O(x):E.has(P)?f--:S.get(M)>S.get(P)?(E.add(M),O(x)):(b.add(P),f--):(a(k,o),f--)}for(;f--;){const x=t[f];_.has(x.key)||a(x,o)}for(;h;)O(p[h-1]);return Ge(I),p}function jc(t,e){const n={},i={},r={$$scope:1};let s=t.length;for(;s--;){const o=t[s],l=e[s];if(l){for(const a in o)a in l||(i[a]=1);for(const a in l)r[a]||(n[a]=l[a],r[a]=1);t[s]=l}else for(const a in o)r[a]=1}for(const o in i)o in n||(n[o]=void 0);return n}function Fc(t){return typeof t=="object"&&t!==null?t:{}}function ae(t){t&&t.c()}function oe(t,e,n,i){const{fragment:r,after_update:s}=t.$$;r&&r.m(e,n),i||qt(()=>{const o=t.$$.on_mount.map(Ms).filter(vn);t.$$.on_destroy?t.$$.on_destroy.push(...o):Ge(o),t.$$.on_mount=[]}),s.forEach(qt)}function le(t,e){const n=t.$$;n.fragment!==null&&(Rc(n.after_update),Ge(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function Vc(t,e){t.$$.dirty[0]===-1&&(Sn.push(t),Lc(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function ve(t,e,n,i,r,s,o,l=[-1]){const a=Vn;Bt(t);const c=t.$$={fragment:null,ctx:[],props:s,update:X,not_equal:r,bound:xs(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(a?a.$$.context:[])),callbacks:xs(),dirty:l,skip_bound:!1,root:e.target||a.$$.root};o&&o(c.root);let u=!1;if(c.ctx=n?n(t,e.props||{},(d,f,...h)=>{const m=h.length?h[0]:f;return c.ctx&&r(c.ctx[d],c.ctx[d]=m)&&(!c.skip_bound&&c.bound[d]&&c.bound[d](m),u&&Vc(t,d)),f}):[],c.update(),u=!0,Ge(c.before_update),c.fragment=i?i(c.ctx):!1,e.target){if(e.hydrate){const d=xc(e.target);c.fragment&&c.fragment.l(d),d.forEach(z)}else c.fragment&&c.fragment.c();e.intro&&F(t.$$.fragment),oe(t,e.target,e.anchor,e.customElement),dr()}Bt(a)}class ye{$destroy(){le(this,1),this.$destroy=X}$on(e,n){if(!vn(n))return X;const i=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return i.push(n),()=>{const r=i.indexOf(n);r!==-1&&i.splice(r,1)}}$set(e){this.$$set&&!Sc(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const W=APP_LANG,At=APP_NAME;WEBAPP_NAME;const vr=USER_ID;IS_SUPERUSER,ADD_PERMISSION;const en=CSRF_TOKEN;ADDITIONAL_MODULES;const Hc="Region",$s=APP_URL,Uc=SAS_APP_URL;CANTALOUPE_APP_URL,MEDIA_PATH;const Bc=PAGE_LEN,qc={Witness:W==="en"?"Witness":"Témoin",Work:W==="en"?"Work":"Œuvre",Series:W==="en"?"Series":"Série d'imprimés",Regions:W==="en"?"Region Extraction":"Extraction d'illustrations"},In=[];function Kc(t,e){return{subscribe:we(t,e).subscribe}}function we(t,e=X){let n;const i=new Set;function r(l){if(pe(t,l)&&(t=l,n)){const a=!In.length;for(const c of i)c[1](),In.push(c,t);if(a){for(let c=0;c<In.length;c+=2)In[c][0](In[c+1]);In.length=0}}}function s(l){r(l(t))}function o(l,a=X){const c=[l,a];return i.add(c),i.size===1&&(n=e(r)||X),l(t),()=>{i.delete(c),i.size===0&&n&&(n(),n=null)}}return{set:r,update:s,subscribe:o}}function Ue(t,e,n){const i=!Array.isArray(t),r=i?[t]:t,s=e.length<2;return Kc(n,o=>{let l=!1;const a=[];let c=0,u=X;const d=()=>{if(c)return;u();const h=e(i?a[0]:a,o);s?o(h):u=vn(h)?h:X},f=r.map((h,m)=>di(h,g=>{a[m]=g,c&=~(1<<m),l&&d()},()=>{c|=1<<m}));return l=!0,d(),function(){Ge(f),u(),l=!1}})}const qn=we(!1),Wc=we(""),Gc=t=>typeof t=="string"||t instanceof String;async function zs(t){qn.set(!0);try{return await t()}finally{qn.set(!1)}}function yr(t){return t.match(/\d+/g).toString()}function Yc(t){return parseInt(yr(t),10)}function br(t,e=100){const n=Math.floor(e*.75);return t.length>e?t.slice(0,n)+"..."+t.slice(-e+n):t}function Xc(){return"https://vhs.huma-num.fr"}function Jc(){return Uc??"http://localhost:8888"}function wr(t,e){if(typeof window<"u"){const n=parseInt(new URLSearchParams(window.location.search).get(e));if(!isNaN(n))return t.set(n),n}return t.set(1),1}function Sr(t,e,n){if(e.set(t),typeof window<"u"){const i=new URL(window.location.href);i.searchParams.set(n,t),window.history.pushState({},"",i)}}function Qc(t=null){return t=t.split("_"),t.length<3?void 0:`${t.slice(0,3).join("_").replace(".jpg","")}.jpg`}function js(t=null){const e=Qc(t);return e===void 0?void 0:`${Xc()}/iiif/2/${e}`}function Rt(t=null,e=null,n="full"){if(e=Gc(e)?e.replace(".jpg",""):e,!t)return"https://placehold.co/96x96/png?text=No+image";const i=js(t);if(i===void 0)return"https://placehold.co/96x96/png?text=No+image";const r=t.split("_");return e||(e=r[r.length-1].includes(",")?r.pop().replace(".jpg",""):"full"),`${i}/${e}/${n}/0/default.jpg`}function Zc(t=null){return`${js(t)}/info.json`}function eu(t=null,e=1){return`${Jc()}/index.html?iiif-content=${t}&canvas=${e}`}function ut(t,e=null,n=!1){return new Promise(i=>{if(document.getElementById("msg-modal")){n?document.getElementById("modal-footer").hidden=!1:i(void 0),e&&(document.getElementById("modal-title").innerHTML=e),document.getElementById("modal-msg").innerHTML=t,document.getElementById("hidden-msg-btn").click();const s=document.getElementById("cancel-btn"),o=document.getElementById("ok-btn"),l=document.getElementById("modal-bkg"),a=()=>{s.removeEventListener("click",c),l.removeEventListener("click",c),o.removeEventListener("click",u),document.getElementById("modal-footer").hidden=!0},c=()=>{a(),i(!1)},u=()=>{a(),i(!0)};s.addEventListener("click",c),o.addEventListener("click",u)}else n?i(window.confirm(t)):(window.alert(t),i(void 0))})}function Si(){let t,e,n=(i,r)=>i===r;return{set:i=>{e=t,t=i},setCompareFn:i=>n=i,get:()=>t,getNewAndOld:()=>[t,e],same:()=>n(t,e)}}const kr=(t,e)=>Array.isArray(t)&&Array.isArray(e)&&t.length===e.length&&t.every((n,i)=>n===e[i]||void 0);function tu(t){const n=[85,70,60],i=[50,65,40],r=t*137.5%360,s=n[t%n.length],o=i[Math.floor(t/n.length)%i.length];return`hsl(${Math.floor(r)}, ${s}%, ${o}%)`}function Fs(t=null){return t<600?1:t<800?2:t<1e3?3:t<1200?4:t<1400?5:t>=1400?6:4}function Vs(t){const e=t.querySelectorAll(".modal-background, .modal-close, .modal-card-head .delete, .modal-card-foot .button-close"),n=()=>t.classList.remove("is-active");e.forEach(r=>r.addEventListener("click",n));const i=r=>{r.key==="Escape"&&t.classList.contains("is-active")&&n()};return document.addEventListener("keydown",i),{destroy(){e.forEach(r=>r.removeEventListener("click",n)),document.removeEventListener("keydown",i)}}}function Hs(t){const e=()=>{const n=document.getElementById(t.dataset.target);n==null||n.classList.add("is-active")};return t.addEventListener("click",e),{destroy(){t.removeEventListener("click",e)}}}function Kn(t,e,n="string"){const i={string:s=>s.get(e)||"",array:s=>{const o=s.get(e);return o?o.split(",").map(Number).filter(l=>!isNaN(l)):null},set:s=>{const o=s.get(e);return o?new Set(o.split(",").map(Number).filter(l=>!isNaN(l))):null},number:s=>Number(s.get(e))||0,boolean:s=>s.get(e)==="true"},r={string:(s,o)=>o?s.searchParams.set(e,o):s.searchParams.delete(e),array:(s,o)=>{o.length?s.searchParams.set(e,o.join(",")):s.searchParams.delete(e)},set:(s,o)=>{o.size?s.searchParams.set(e,Array.from(o).join(",")):s.searchParams.delete(e)},number:(s,o)=>s.searchParams.set(e,String(o)),boolean:(s,o)=>o?s.searchParams.set(e,"true"):s.searchParams.delete(e)};if(typeof window<"u"){const s=new URLSearchParams(window.location.search),o=i[n](s);return o!==null&&t.set(o),l=>{const a=new URL(window.location);r[n](a,l),window.history.pushState({},"",a)}}return()=>{}}function nu(t){const e=t-1;return e*e*e+1}function Mn(t,{delay:e=0,duration:n=400,easing:i=Cs}={}){const r=+getComputedStyle(t).opacity;return{delay:e,duration:n,easing:i,css:s=>`opacity: ${s*r}`}}function Us(t,{delay:e=0,duration:n=400,easing:i=nu,axis:r="y"}={}){const s=getComputedStyle(t),o=+s.opacity,l=r==="y"?"height":"width",a=parseFloat(s[l]),c=r==="y"?["top","bottom"]:["left","right"],u=c.map(_=>`${_[0].toUpperCase()}${_.slice(1)}`),d=parseFloat(s[`padding${u[0]}`]),f=parseFloat(s[`padding${u[1]}`]),h=parseFloat(s[`margin${u[0]}`]),m=parseFloat(s[`margin${u[1]}`]),g=parseFloat(s[`border${u[0]}Width`]),p=parseFloat(s[`border${u[1]}Width`]);return{delay:e,duration:n,easing:i,css:_=>`overflow: hidden;opacity: ${Math.min(_*20,1)*o};${l}: ${_*a}px;padding-${c[0]}: ${_*d}px;padding-${c[1]}: ${_*f}px;margin-${c[0]}: ${_*h}px;margin-${c[1]}: ${_*m}px;border-${c[0]}-width: ${_*g}px;border-${c[1]}-width: ${_*p}px;`}}const oy="";function Bs(t){let e,n,i;return{c(){e=w("div"),e.innerHTML='<div class="loader svelte-vizlcg"></div>',v(e,"class","bkg-shade svelte-vizlcg")},m(r,s){j(r,e,s),i=!0},i(r){i||(qt(()=>{i&&(n||(n=Zt(e,Mn,{duration:150},!0)),n.run(1))}),i=!0)},o(r){n||(n=Zt(e,Mn,{duration:150},!1)),n.run(0),i=!1},d(r){r&&z(e),r&&n&&n.end()}}}function iu(t){let e,n,i=t[0]&&Bs();return{c(){i&&i.c(),e=qe()},m(r,s){i&&i.m(r,s),j(r,e,s),n=!0},p(r,[s]){r[0]?i?s&1&&F(i,1):(i=Bs(),i.c(),F(i,1),i.m(e.parentNode,e)):i&&(ke(),K(i,1,1,()=>{i=null}),Ee())},i(r){n||(F(i),n=!0)},o(r){K(i),n=!1},d(r){i&&i.d(r),r&&z(e)}}}function ru(t,e,n){let i;return de(t,qn,r=>n(0,i=r)),[i]}class su extends ye{constructor(e){super(),ve(this,e,ru,iu,pe,{})}}const ou=t=>({}),qs=t=>({});function lu(t){let e,n,i,r,s,o,l,a,c,u,d,f,h,m,g,p,_,S,I,b,E;const O=t[1].content,x=kt(O,t,t[0],qs);return{c(){e=w("button"),n=U(),i=w("div"),r=w("div"),s=U(),o=w("div"),l=w("div"),l.innerHTML=`<div class="title is-4 mb-0 media-content"><span id="modal-title" class="mb-0"></span></div>
            <button class="delete media-left" aria-label="close"></button>`,a=U(),c=w("section"),u=w("div"),d=U(),f=w("div"),x&&x.c(),h=U(),m=w("footer"),g=w("div"),p=w("button"),p.textContent=`${W==="en"?"Abort":"Retour"}`,_=U(),S=w("button"),S.textContent="OK",v(e,"id","hidden-msg-btn"),v(e,"data-target","msg-modal"),e.hidden=!0,v(r,"id","modal-bkg"),v(r,"class","modal-background"),v(l,"class","modal-card-head media mb-0"),v(u,"id","modal-msg"),v(f,"class","py-3"),v(c,"id","modal-body"),v(c,"class","modal-card-body"),v(p,"id","cancel-btn"),v(p,"class","button is-link is-light button-close"),v(S,"id","ok-btn"),v(S,"class","button is-link button-close"),v(g,"class","buttons"),v(m,"id","modal-footer"),v(m,"class","modal-card-foot is-center pt-3"),m.hidden=!0,v(o,"class","modal-content"),v(i,"id","msg-modal"),v(i,"class","modal fade"),v(i,"tabindex","-1"),v(i,"aria-labelledby","selection-modal-label"),v(i,"aria-hidden","true")},m(k,M){j(k,e,M),j(k,n,M),j(k,i,M),y(i,r),y(i,s),y(i,o),y(o,l),y(o,a),y(o,c),y(c,u),y(c,d),y(c,f),x&&x.m(f,null),y(o,h),y(o,m),y(m,g),y(g,p),y(g,_),y(g,S),I=!0,b||(E=[pi(Hs.call(null,e)),pi(Vs.call(null,i))],b=!0)},p(k,[M]){x&&x.p&&(!I||M&1)&&Ct(x,O,k,k[0],I?Et(O,k[0],M,ou):It(k[0]),qs)},i(k){I||(F(x,k),I=!0)},o(k){K(x,k),I=!1},d(k){k&&z(e),k&&z(n),k&&z(i),x&&x.d(k),b=!1,Ge(E)}}}function au(t,e,n){let{$$slots:i={},$$scope:r}=e;return t.$$set=s=>{"$$scope"in s&&n(0,r=s.$$scope)},[r,i]}class cu extends ye{constructor(e){super(),ve(this,e,au,lu,pe,{})}}const ly="",uu=t=>({activeTab:t&8}),Ks=t=>({activeTab:t[3]});function Ws(t,e,n){const i=t.slice();return i[11]=e[n][0],i[12]=e[n][1],i}const fu=t=>({activeTab:t&8}),Gs=t=>({activeTab:t[3]}),hu=t=>({}),Ys=t=>({});function du(t){let e,n,i=Object.entries(t[2]),r=[];for(let s=0;s<i.length;s+=1)r[s]=Xs(Ws(t,i,s));return{c(){e=w("div"),n=w("ul");for(let s=0;s<r.length;s+=1)r[s].c();v(e,"class","tabs")},m(s,o){j(s,e,o),y(e,n);for(let l=0;l<r.length;l+=1)r[l]&&r[l].m(n,null)},p(s,o){if(o&28){i=Object.entries(s[2]);let l;for(l=0;l<i.length;l+=1){const a=Ws(s,i,l);r[l]?r[l].p(a,o):(r[l]=Xs(a),r[l].c(),r[l].m(n,null))}for(;l<r.length;l+=1)r[l].d(1);r.length=i.length}},i:X,o:X,d(s){s&&z(e),Ye(r,s)}}}function mu(t){let e;const n=t[8].tabs,i=kt(n,t,t[7],Gs);return{c(){i&&i.c()},m(r,s){i&&i.m(r,s),e=!0},p(r,s){i&&i.p&&(!e||s&136)&&Ct(i,n,r,r[7],e?Et(n,r[7],s,fu):It(r[7]),Gs)},i(r){e||(F(i,r),e=!0)},o(r){K(i,r),e=!1},d(r){i&&i.d(r)}}}function Xs(t){let e,n,i=t[12]+"",r,s,o,l;function a(){return t[9](t[11])}return{c(){e=w("li"),n=w("a"),r=ne(i),s=U(),v(n,"href",null),Se(e,"is-active",t[3]===t[11])},m(c,u){j(c,e,u),y(e,n),y(n,r),y(e,s),o||(l=ge(n,"click",a),o=!0)},p(c,u){t=c,u&4&&i!==(i=t[12]+"")&&_e(r,i),u&12&&Se(e,"is-active",t[3]===t[11])},d(c){c&&z(e),o=!1,l()}}}function pu(t){let e,n,i,r,s,o,l,a,c,u,d,f,h;e=new su({});const m=t[8].sidebar,g=kt(m,t,t[7],Ys),p=[mu,du],_=[];function S(E,O){return O&4&&(a=null),E[5].tabs?0:(a==null&&(a=!!Object.keys(E[2]).length),a?1:-1)}~(c=S(t,-1))&&(u=_[c]=p[c](t));const I=t[8].content,b=kt(I,t,t[7],Ks);return{c(){ae(e.$$.fragment),n=U(),i=w("div"),r=w("aside"),g&&g.c(),s=U(),o=w("main"),l=w("nav"),u&&u.c(),d=U(),f=w("div"),b&&b.c(),v(r,"class","sidebar svelte-jexg"),De(r,"width",t[0]+"%"),De(r,"min-height",t[1]),v(l,"id","tabs"),v(l,"class","tabs-bar svelte-jexg"),v(f,"class","content-area pl-5 svelte-jexg"),v(o,"class","main-content svelte-jexg"),De(o,"width",100-t[0]+"%"),De(o,"min-height",t[1]),v(i,"class","layout svelte-jexg"),De(i,"min-height",t[1])},m(E,O){oe(e,E,O),j(E,n,O),j(E,i,O),y(i,r),g&&g.m(r,null),y(i,s),y(i,o),y(o,l),~c&&_[c].m(l,null),y(o,d),y(o,f),b&&b.m(f,null),h=!0},p(E,[O]){g&&g.p&&(!h||O&128)&&Ct(g,m,E,E[7],h?Et(m,E[7],O,hu):It(E[7]),Ys),(!h||O&1)&&De(r,"width",E[0]+"%");let x=c;c=S(E,O),c===x?~c&&_[c].p(E,O):(u&&(ke(),K(_[x],1,1,()=>{_[x]=null}),Ee()),~c?(u=_[c],u?u.p(E,O):(u=_[c]=p[c](E),u.c()),F(u,1),u.m(l,null)):u=null),b&&b.p&&(!h||O&136)&&Ct(b,I,E,E[7],h?Et(I,E[7],O,uu):It(E[7]),Ks),(!h||O&1)&&De(o,"width",100-E[0]+"%")},i(E){h||(F(e.$$.fragment,E),F(g,E),F(u),F(b,E),h=!0)},o(E){K(e.$$.fragment,E),K(g,E),K(u),K(b,E),h=!1},d(E){le(e,E),E&&z(n),E&&z(i),g&&g.d(E),~c&&_[c].d(),b&&b.d(E)}}}function gu(t=null){t||(t=document.getElementById("navbar")),document.documentElement.style.setProperty("--top-offset",`${t.offsetHeight}px`)}function _u(t,e,n){let i,{$$slots:r={},$$scope:s}=e;const o=kc(r);let{sidebarWidth:l="25"}=e;const a="90vh";let{tabList:c={}}=e,u=Object.keys(c),{topOffsetElement:d=null}=e;gu(d);function f(m){if(!u.includes(m)){console.warn(`Tab "${m}" is not available.`);return}n(3,i=m);const g=new URL(window.location);g.searchParams.set("tab",m),window.history.pushState({},"",g)}const h=m=>f(m);return t.$$set=m=>{"sidebarWidth"in m&&n(0,l=m.sidebarWidth),"tabList"in m&&n(2,c=m.tabList),"topOffsetElement"in m&&n(6,d=m.topOffsetElement),"$$scope"in m&&n(7,s=m.$$scope)},n(3,i=new URLSearchParams(window.location.search).get("tab")??u[0]??null),[l,a,c,i,f,o,d,s,r,h]}class vu extends ye{constructor(e){super(),ve(this,e,_u,pu,pe,{sidebarWidth:0,layoutHeight:1,tabList:2,topOffsetElement:6})}get layoutHeight(){return this.$$.ctx[1]}}const ki={0:{title:W==="en"?"no categorization":"aucune catégorisation",svg:`<svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 59 59">
        <rect x="1" y="0.62" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>
    </svg>`},1:{title:W==="en"?"overall visual matches":"correspondances visuelles globales",svg:`<svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 68 69">
        <rect x="10" y="10.62" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>
        <rect x="1" y="1" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>
        <rect x="10" y="10.62" width="46" height="45.71" rx="4.11" ry="4.11" fill="currentColor" stroke="none"/>
    </svg>`},2:{title:W==="en"?"visual matches on part of the image":"correspondances visuelles sur une partie de l'image",svg:`<svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 70 71">
        <rect x="12" y="12.43" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>
        <rect x="1" y="0.81" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>
        <path d="M 12 21.43 L 21 12.43" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
        <path d="M 12 30 L 30 12.43" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
        <path d="M 40 56 L 57 38" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
        <path d="M 48.3 56.29 L 57 47" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
        <path d="M 12 39 L 39 12" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
        <path d="M 12 48 L 48 12" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
        <path d="M 13 56 L 57 12" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
        <path d="M 31 56 L 57 29" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
        <path d="M 21 57 L 57 21" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
    </svg>`},3:{title:W==="en"?"semantic and non-visual matches":"correspondances sémantiques et non-visuelle",svg:`<svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 72 73">
        <rect x="14" y="14.43" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3" stroke-dasharray="9 9"/>
        <rect x="1" y="0.81" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>
    </svg>`},4:{title:W==="en"?"regions without match":"régions sans correspondance",svg:`<svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 59 59">
        <rect x="1" y="0.62" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>
        <path d="M 2.67 54.55 L 55 2" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
        <path d="M 54.37 54.05 L 2.72 2.24" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
    </svg>`},5:{title:W==="en"?"user specific category":"correspondances spécifiques à l'utilisateur",svg:`<svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 59 59">
        <rect x="1" y="0.81" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>
        <path d="M 8.69 55.28 C 9.25 44.15 18.08 35.28 28.86 35.28 C 32.5 35.28 36.07 36.3 39.18 38.25 C 44.96 41.85 48.66 48.3 49.02 55.28 Z M 17.85 21.48 C 17.85 15.37 22.79 10.39 28.86 10.39 C 34.92 10.39 39.86 15.37 39.86 21.48 C 39.86 27.59 34.92 32.56 28.86 32.56 C 22.79 32.56 17.85 27.59 17.85 21.48 Z M 40.37 36.34 C 38.43 35.13 36.32 34.25 34.13 33.7 C 38.82 31.64 42.1 26.94 42.1 21.48 C 42.1 14.13 36.16 8.15 28.86 8.15 C 21.55 8.15 15.61 14.13 15.61 21.48 C 15.61 26.95 18.9 31.66 23.6 33.71 C 13.76 36.18 6.41 45.4 6.41 56.4 C 6.41 57.02 6.92 57.52 7.54 57.52 L 50.17 57.52 C 50.79 57.52 51.3 57.02 51.3 56.4 C 51.3 48.23 47.11 40.54 40.37 36.34 Z" fill="currentColor" stroke="none"/>
    </svg>`}};function yu(t){let e,n=ki[t[2]].svg+"",i,r,s,o;return{c(){e=w("span"),v(e,"class",i="tag py-4 "+t[4]+" "+(t[0]?"is-hoverable":"")),v(e,"title",r=ki[t[2]].title),Se(e,"is-selected",t[1])},m(l,a){j(l,e,a),e.innerHTML=n,s||(o=[ge(e,"click",t[5]),ge(e,"keyup",null)],s=!0)},p(l,[a]){a&4&&n!==(n=ki[l[2]].svg+"")&&(e.innerHTML=n),a&17&&i!==(i="tag py-4 "+l[4]+" "+(l[0]?"is-hoverable":""))&&v(e,"class",i),a&4&&r!==(r=ki[l[2]].title)&&v(e,"title",r),a&19&&Se(e,"is-selected",l[1])},i:X,o:X,d(l){l&&z(e),s=!1,Ge(o)}}}function bu(t,e,n){let{selectable:i=!0}=e,{isSelected:r=!1}=e,{category:s}=e,{toggle:o=()=>{}}=e,{padding:l="px-2"}=e;const a=()=>o(s);return t.$$set=c=>{"selectable"in c&&n(0,i=c.selectable),"isSelected"in c&&n(1,r=c.isSelected),"category"in c&&n(2,s=c.category),"toggle"in c&&n(3,o=c.toggle),"padding"in c&&n(4,l=c.padding)},[i,r,s,o,l,a]}class xn extends ye{constructor(e){super(),ve(this,e,bu,yu,pe,{selectable:0,isSelected:1,category:2,toggle:3,padding:4})}}const by="";function Js(t){let e,n,i=t[3].title+"",r,s;return{c(){e=w("span"),n=w("a"),r=ne(i),v(n,"href",s=`${$s}/${At}/witness/${t[3].witnessId}/regions/${t[1]}`),v(n,"target","_blank"),v(e,"class","legend-label svelte-w1sf17")},m(o,l){j(o,e,l),y(e,n),y(n,r)},p(o,l){l&8&&i!==(i=o[3].title+"")&&_e(r,i),l&10&&s!==(s=`${$s}/${At}/witness/${o[3].witnessId}/regions/${o[1]}`)&&v(n,"href",s)},d(o){o&&z(e)}}}function wu(t){let e,n,i,r,s,o,l,a,c,u=!t[5]&&Js(t);return{c(){e=w("div"),n=w("span"),i=U(),r=w("span"),l=U(),u&&u.c(),v(n,"class","legend-nb svelte-w1sf17"),v(r,"class","legend-color svelte-w1sf17"),v(r,"aria-label",s=t[3].title),v(r,"title",o=t[3].title),De(r,"background-color",t[0]?t[3].color:"#999"),v(r,"role","button"),v(r,"tabindex","0"),Se(r,"inactive",!t[0]),Se(r,"clickable",t[4]),v(e,"class","legend-item svelte-w1sf17"),Se(e,"inactive",!t[0])},m(d,f){j(d,e,f),y(e,n),y(e,i),y(e,r),y(e,l),u&&u.m(e,null),a||(c=[ge(r,"click",function(){vn(t[2])&&t[2].apply(this,arguments)}),ge(r,"keydown",null)],a=!0)},p(d,[f]){t=d,f&8&&s!==(s=t[3].title)&&v(r,"aria-label",s),f&8&&o!==(o=t[3].title)&&v(r,"title",o),f&9&&De(r,"background-color",t[0]?t[3].color:"#999"),f&1&&Se(r,"inactive",!t[0]),f&16&&Se(r,"clickable",t[4]),t[5]?u&&(u.d(1),u=null):u?u.p(t,f):(u=Js(t),u.c(),u.m(e,null)),f&1&&Se(e,"inactive",!t[0])},i:X,o:X,d(d){d&&z(e),u&&u.d(),a=!1,Ge(c)}}}function Su(t,e,n){let{isActive:i=!0}=e,{id:r}=e,{toggle:s=()=>{}}=e,{meta:o={title:"Region",color:"#999",witnessId:1}}=e,{clickable:l=!0}=e,{onlyColor:a=!1}=e;return t.$$set=c=>{"isActive"in c&&n(0,i=c.isActive),"id"in c&&n(1,r=c.id),"toggle"in c&&n(2,s=c.toggle),"meta"in c&&n(3,o=c.meta),"clickable"in c&&n(4,l=c.clickable),"onlyColor"in c&&n(5,a=c.onlyColor)},[i,r,s,o,l,a]}class Er extends ye{constructor(e){super(),ve(this,e,Su,wu,pe,{isActive:0,id:1,toggle:2,meta:3,clickable:4,onlyColor:5})}}const wy="";function Qs(t,e,n){const i=t.slice();return i[6]=e[n][0],i[7]=e[n][1],i}function ku(t){let e;return{c(){e=w("span"),e.innerHTML='<i class="fas fa-chevron-down"></i>',v(e,"class","icon is-small")},m(n,i){j(n,e,i)},d(n){n&&z(e)}}}function Eu(t){let e;return{c(){e=w("span"),e.innerHTML='<i class="fas fa-chevron-up"></i>',v(e,"class","icon is-small")},m(n,i){j(n,e,i)},d(n){n&&z(e)}}}function Zs(t){let e,n;function i(){return t[5](t[6])}return e=new Er({props:{id:t[6],meta:t[7],isActive:t[1].has(parseInt(t[6])),toggle:i,onlyColor:!t[3]}}),{c(){ae(e.$$.fragment)},m(r,s){oe(e,r,s),n=!0},p(r,s){t=r;const o={};s&1&&(o.id=t[6]),s&1&&(o.meta=t[7]),s&3&&(o.isActive=t[1].has(parseInt(t[6]))),s&5&&(o.toggle=i),s&8&&(o.onlyColor=!t[3]),e.$set(o)},i(r){n||(F(e.$$.fragment,r),n=!0)},o(r){K(e.$$.fragment,r),n=!1},d(r){le(e,r)}}}function Cu(t){let e,n,i,r,s,o,l,a,c,u,d,f,h,m,g,p;function _(x,k){return x[3]?Eu:ku}let S=_(t),I=S(t),b=Array.from(t[0]||new Map),E=[];for(let x=0;x<b.length;x+=1)E[x]=Zs(Qs(t,b,x));const O=x=>K(E[x],1,1,()=>{E[x]=null});return{c(){e=w("div"),n=w("div"),i=w("div"),r=w("div"),s=w("h3"),s.textContent=`${W==="en"?"Visible documents":"Documents visibles"}`,o=U(),l=w("div"),a=w("div"),c=w("button"),I.c(),f=U(),h=w("div");for(let x=0;x<E.length;x+=1)E[x].c();v(s,"class","title mb-0"),v(r,"class","level-item"),v(i,"class","level-left"),v(c,"class","button is-small is-ghost"),v(c,"aria-label",u=t[3]?"Minify legend":"Expand legend"),v(a,"class","level-item"),v(a,"title",d=t[3]?"Minify legend":"Expand legend"),v(l,"class","level-right"),v(n,"class","level is-mobile mb-3"),v(h,"class","svelte-13ym7ov"),Se(h,"is-condensed",!t[3]),Se(h,"is-expanded",t[3])},m(x,k){j(x,e,k),y(e,n),y(n,i),y(i,r),y(r,s),y(n,o),y(n,l),y(l,a),y(a,c),I.m(c,null),y(e,f),y(e,h);for(let M=0;M<E.length;M+=1)E[M]&&E[M].m(h,null);m=!0,g||(p=ge(c,"click",t[4]),g=!0)},p(x,[k]){if(S!==(S=_(x))&&(I.d(1),I=S(x),I&&(I.c(),I.m(c,null))),(!m||k&8&&u!==(u=x[3]?"Minify legend":"Expand legend"))&&v(c,"aria-label",u),(!m||k&8&&d!==(d=x[3]?"Minify legend":"Expand legend"))&&v(a,"title",d),k&15){b=Array.from(x[0]||new Map);let M;for(M=0;M<b.length;M+=1){const P=Qs(x,b,M);E[M]?(E[M].p(P,k),F(E[M],1)):(E[M]=Zs(P),E[M].c(),F(E[M],1),E[M].m(h,null))}for(ke(),M=b.length;M<E.length;M+=1)O(M);Ee()}(!m||k&8)&&Se(h,"is-condensed",!x[3]),(!m||k&8)&&Se(h,"is-expanded",x[3])},i(x){if(!m){for(let k=0;k<b.length;k+=1)F(E[k]);m=!0}},o(x){E=E.filter(Boolean);for(let k=0;k<E.length;k+=1)K(E[k]);m=!1},d(x){x&&z(e),I.d(),Ye(E,x),g=!1,p()}}}function Iu(t,e,n){let{documentNodes:i}=e,{selectedRegions:r}=e,{toggleRegion:s}=e,o=!0;const l=()=>n(3,o=!o),a=c=>s(parseInt(c));return t.$$set=c=>{"documentNodes"in c&&n(0,i=c.documentNodes),"selectedRegions"in c&&n(1,r=c.selectedRegions),"toggleRegion"in c&&n(2,s=c.toggleRegion)},[i,r,s,o,l,a]}class Mu extends ye{constructor(e){super(),ve(this,e,Iu,Cu,pe,{documentNodes:0,selectedRegions:1,toggleRegion:2})}}var tn;(function(t){t.Range="range",t.Steps="steps",t.Positions="positions",t.Count="count",t.Values="values"})(tn||(tn={}));var tt;(function(t){t[t.None=-1]="None",t[t.NoValue=0]="NoValue",t[t.LargeValue=1]="LargeValue",t[t.SmallValue=2]="SmallValue"})(tt||(tt={}));function xu(t){return Ei(t)&&typeof t.from=="function"}function Ei(t){return typeof t=="object"&&typeof t.to=="function"}function eo(t){t.parentElement.removeChild(t)}function Cr(t){return t!=null}function to(t){t.preventDefault()}function Au(t){return t.filter(function(e){return this[e]?!1:this[e]=!0},{})}function Tu(t,e){return Math.round(t/e)*e}function Nu(t,e){var n=t.getBoundingClientRect(),i=t.ownerDocument,r=i.documentElement,s=ro(i);return/webkit.*Chrome.*Mobile/i.test(navigator.userAgent)&&(s.x=0),e?n.top+s.y-r.clientTop:n.left+s.x-r.clientLeft}function Tt(t){return typeof t=="number"&&!isNaN(t)&&isFinite(t)}function no(t,e,n){n>0&&(Xe(t,e),setTimeout(function(){Ii(t,e)},n))}function io(t){return Math.max(Math.min(t,100),0)}function Ci(t){return Array.isArray(t)?t:[t]}function Ou(t){t=String(t);var e=t.split(".");return e.length>1?e[1].length:0}function Xe(t,e){t.classList&&!/\s/.test(e)?t.classList.add(e):t.className+=" "+e}function Ii(t,e){t.classList&&!/\s/.test(e)?t.classList.remove(e):t.className=t.className.replace(new RegExp("(^|\\b)"+e.split(" ").join("|")+"(\\b|$)","gi")," ")}function Pu(t,e){return t.classList?t.classList.contains(e):new RegExp("\\b"+e+"\\b").test(t.className)}function ro(t){var e=window.pageXOffset!==void 0,n=(t.compatMode||"")==="CSS1Compat",i=e?window.pageXOffset:n?t.documentElement.scrollLeft:t.body.scrollLeft,r=e?window.pageYOffset:n?t.documentElement.scrollTop:t.body.scrollTop;return{x:i,y:r}}function Lu(){return window.navigator.pointerEnabled?{start:"pointerdown",move:"pointermove",end:"pointerup"}:window.navigator.msPointerEnabled?{start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:{start:"mousedown touchstart",move:"mousemove touchmove",end:"mouseup touchend"}}function Du(){var t=!1;try{var e=Object.defineProperty({},"passive",{get:function(){t=!0}});window.addEventListener("test",null,e)}catch{}return t}function Ru(){return window.CSS&&CSS.supports&&CSS.supports("touch-action","none")}function Ir(t,e){return 100/(e-t)}function Mr(t,e,n){return e*100/(t[n+1]-t[n])}function $u(t,e){return Mr(t,t[0]<0?e+Math.abs(t[0]):e-t[0],0)}function zu(t,e){return e*(t[1]-t[0])/100+t[0]}function Wn(t,e){for(var n=1;t>=e[n];)n+=1;return n}function ju(t,e,n){if(n>=t.slice(-1)[0])return 100;var i=Wn(n,t),r=t[i-1],s=t[i],o=e[i-1],l=e[i];return o+$u([r,s],n)/Ir(o,l)}function Fu(t,e,n){if(n>=100)return t.slice(-1)[0];var i=Wn(n,e),r=t[i-1],s=t[i],o=e[i-1],l=e[i];return zu([r,s],(n-o)*Ir(o,l))}function Vu(t,e,n,i){if(i===100)return i;var r=Wn(i,t),s=t[r-1],o=t[r];return n?i-s>(o-s)/2?o:s:e[r-1]?t[r-1]+Tu(i-t[r-1],e[r-1]):i}var so=function(){function t(e,n,i){this.xPct=[],this.xVal=[],this.xSteps=[],this.xNumSteps=[],this.xHighestCompleteStep=[],this.xSteps=[i||!1],this.xNumSteps=[!1],this.snap=n;var r,s=[];for(Object.keys(e).forEach(function(o){s.push([Ci(e[o]),o])}),s.sort(function(o,l){return o[0][0]-l[0][0]}),r=0;r<s.length;r++)this.handleEntryPoint(s[r][1],s[r][0]);for(this.xNumSteps=this.xSteps.slice(0),r=0;r<this.xNumSteps.length;r++)this.handleStepPoint(r,this.xNumSteps[r])}return t.prototype.getDistance=function(e){for(var n=[],i=0;i<this.xNumSteps.length-1;i++)n[i]=Mr(this.xVal,e,i);return n},t.prototype.getAbsoluteDistance=function(e,n,i){var r=0;if(e<this.xPct[this.xPct.length-1])for(;e>this.xPct[r+1];)r++;else e===this.xPct[this.xPct.length-1]&&(r=this.xPct.length-2);!i&&e===this.xPct[r+1]&&r++,n===null&&(n=[]);var s,o=1,l=n[r],a=0,c=0,u=0,d=0;for(i?s=(e-this.xPct[r])/(this.xPct[r+1]-this.xPct[r]):s=(this.xPct[r+1]-e)/(this.xPct[r+1]-this.xPct[r]);l>0;)a=this.xPct[r+1+d]-this.xPct[r+d],n[r+d]*o+100-s*100>100?(c=a*s,o=(l-100*s)/n[r+d],s=1):(c=n[r+d]*a/100*o,o=0),i?(u=u-c,this.xPct.length+d>=1&&d--):(u=u+c,this.xPct.length-d>=1&&d++),l=n[r+d]*o;return e+u},t.prototype.toStepping=function(e){return e=ju(this.xVal,this.xPct,e),e},t.prototype.fromStepping=function(e){return Fu(this.xVal,this.xPct,e)},t.prototype.getStep=function(e){return e=Vu(this.xPct,this.xSteps,this.snap,e),e},t.prototype.getDefaultStep=function(e,n,i){var r=Wn(e,this.xPct);return(e===100||n&&e===this.xPct[r-1])&&(r=Math.max(r-1,1)),(this.xVal[r]-this.xVal[r-1])/i},t.prototype.getNearbySteps=function(e){var n=Wn(e,this.xPct);return{stepBefore:{startValue:this.xVal[n-2],step:this.xNumSteps[n-2],highestStep:this.xHighestCompleteStep[n-2]},thisStep:{startValue:this.xVal[n-1],step:this.xNumSteps[n-1],highestStep:this.xHighestCompleteStep[n-1]},stepAfter:{startValue:this.xVal[n],step:this.xNumSteps[n],highestStep:this.xHighestCompleteStep[n]}}},t.prototype.countStepDecimals=function(){var e=this.xNumSteps.map(Ou);return Math.max.apply(null,e)},t.prototype.hasNoSize=function(){return this.xVal[0]===this.xVal[this.xVal.length-1]},t.prototype.convert=function(e){return this.getStep(this.toStepping(e))},t.prototype.handleEntryPoint=function(e,n){var i;if(e==="min"?i=0:e==="max"?i=100:i=parseFloat(e),!Tt(i)||!Tt(n[0]))throw new Error("noUiSlider: 'range' value isn't numeric.");this.xPct.push(i),this.xVal.push(n[0]);var r=Number(n[1]);i?this.xSteps.push(isNaN(r)?!1:r):isNaN(r)||(this.xSteps[0]=r),this.xHighestCompleteStep.push(0)},t.prototype.handleStepPoint=function(e,n){if(n){if(this.xVal[e]===this.xVal[e+1]){this.xSteps[e]=this.xHighestCompleteStep[e]=this.xVal[e];return}this.xSteps[e]=Mr([this.xVal[e],this.xVal[e+1]],n,0)/Ir(this.xPct[e],this.xPct[e+1]);var i=(this.xVal[e+1]-this.xVal[e])/this.xNumSteps[e],r=Math.ceil(Number(i.toFixed(3))-1),s=this.xVal[e]+this.xNumSteps[e]*r;this.xHighestCompleteStep[e]=s}},t}(),oo={to:function(t){return t===void 0?"":t.toFixed(2)},from:Number},lo={target:"target",base:"base",origin:"origin",handle:"handle",handleLower:"handle-lower",handleUpper:"handle-upper",touchArea:"touch-area",horizontal:"horizontal",vertical:"vertical",background:"background",connect:"connect",connects:"connects",ltr:"ltr",rtl:"rtl",textDirectionLtr:"txt-dir-ltr",textDirectionRtl:"txt-dir-rtl",draggable:"draggable",drag:"state-drag",tap:"state-tap",active:"active",tooltip:"tooltip",pips:"pips",pipsHorizontal:"pips-horizontal",pipsVertical:"pips-vertical",marker:"marker",markerHorizontal:"marker-horizontal",markerVertical:"marker-vertical",markerNormal:"marker-normal",markerLarge:"marker-large",markerSub:"marker-sub",value:"value",valueHorizontal:"value-horizontal",valueVertical:"value-vertical",valueNormal:"value-normal",valueLarge:"value-large",valueSub:"value-sub"},nn={tooltips:".__tooltips",aria:".__aria"};function Hu(t,e){if(!Tt(e))throw new Error("noUiSlider: 'step' is not numeric.");t.singleStep=e}function Uu(t,e){if(!Tt(e))throw new Error("noUiSlider: 'keyboardPageMultiplier' is not numeric.");t.keyboardPageMultiplier=e}function Bu(t,e){if(!Tt(e))throw new Error("noUiSlider: 'keyboardMultiplier' is not numeric.");t.keyboardMultiplier=e}function qu(t,e){if(!Tt(e))throw new Error("noUiSlider: 'keyboardDefaultStep' is not numeric.");t.keyboardDefaultStep=e}function Ku(t,e){if(typeof e!="object"||Array.isArray(e))throw new Error("noUiSlider: 'range' is not an object.");if(e.min===void 0||e.max===void 0)throw new Error("noUiSlider: Missing 'min' or 'max' in 'range'.");t.spectrum=new so(e,t.snap||!1,t.singleStep)}function Wu(t,e){if(e=Ci(e),!Array.isArray(e)||!e.length)throw new Error("noUiSlider: 'start' option is incorrect.");t.handles=e.length,t.start=e}function Gu(t,e){if(typeof e!="boolean")throw new Error("noUiSlider: 'snap' option must be a boolean.");t.snap=e}function Yu(t,e){if(typeof e!="boolean")throw new Error("noUiSlider: 'animate' option must be a boolean.");t.animate=e}function Xu(t,e){if(typeof e!="number")throw new Error("noUiSlider: 'animationDuration' option must be a number.");t.animationDuration=e}function ao(t,e){var n=[!1],i;if(e==="lower"?e=[!0,!1]:e==="upper"&&(e=[!1,!0]),e===!0||e===!1){for(i=1;i<t.handles;i++)n.push(e);n.push(!1)}else{if(!Array.isArray(e)||!e.length||e.length!==t.handles+1)throw new Error("noUiSlider: 'connect' option doesn't match handle count.");n=e}t.connect=n}function Ju(t,e){switch(e){case"horizontal":t.ort=0;break;case"vertical":t.ort=1;break;default:throw new Error("noUiSlider: 'orientation' option is invalid.")}}function co(t,e){if(!Tt(e))throw new Error("noUiSlider: 'margin' option must be numeric.");e!==0&&(t.margin=t.spectrum.getDistance(e))}function Qu(t,e){if(!Tt(e))throw new Error("noUiSlider: 'limit' option must be numeric.");if(t.limit=t.spectrum.getDistance(e),!t.limit||t.handles<2)throw new Error("noUiSlider: 'limit' option is only supported on linear sliders with 2 or more handles.")}function Zu(t,e){var n;if(!Tt(e)&&!Array.isArray(e))throw new Error("noUiSlider: 'padding' option must be numeric or array of exactly 2 numbers.");if(Array.isArray(e)&&!(e.length===2||Tt(e[0])||Tt(e[1])))throw new Error("noUiSlider: 'padding' option must be numeric or array of exactly 2 numbers.");if(e!==0){for(Array.isArray(e)||(e=[e,e]),t.padding=[t.spectrum.getDistance(e[0]),t.spectrum.getDistance(e[1])],n=0;n<t.spectrum.xNumSteps.length-1;n++)if(t.padding[0][n]<0||t.padding[1][n]<0)throw new Error("noUiSlider: 'padding' option must be a positive number(s).");var i=e[0]+e[1],r=t.spectrum.xVal[0],s=t.spectrum.xVal[t.spectrum.xVal.length-1];if(i/(s-r)>1)throw new Error("noUiSlider: 'padding' option must not exceed 100% of the range.")}}function ef(t,e){switch(e){case"ltr":t.dir=0;break;case"rtl":t.dir=1;break;default:throw new Error("noUiSlider: 'direction' option was not recognized.")}}function tf(t,e){if(typeof e!="string")throw new Error("noUiSlider: 'behaviour' must be a string containing options.");var n=e.indexOf("tap")>=0,i=e.indexOf("drag")>=0,r=e.indexOf("fixed")>=0,s=e.indexOf("snap")>=0,o=e.indexOf("hover")>=0,l=e.indexOf("unconstrained")>=0,a=e.indexOf("invert-connects")>=0,c=e.indexOf("drag-all")>=0,u=e.indexOf("smooth-steps")>=0;if(r){if(t.handles!==2)throw new Error("noUiSlider: 'fixed' behaviour must be used with 2 handles");co(t,t.start[1]-t.start[0])}if(a&&t.handles!==2)throw new Error("noUiSlider: 'invert-connects' behaviour must be used with 2 handles");if(l&&(t.margin||t.limit))throw new Error("noUiSlider: 'unconstrained' behaviour cannot be used with margin or limit");t.events={tap:n||s,drag:i,dragAll:c,smoothSteps:u,fixed:r,snap:s,hover:o,unconstrained:l,invertConnects:a}}function nf(t,e){if(e!==!1)if(e===!0||Ei(e)){t.tooltips=[];for(var n=0;n<t.handles;n++)t.tooltips.push(e)}else{if(e=Ci(e),e.length!==t.handles)throw new Error("noUiSlider: must pass a formatter for all handles.");e.forEach(function(i){if(typeof i!="boolean"&&!Ei(i))throw new Error("noUiSlider: 'tooltips' must be passed a formatter or 'false'.")}),t.tooltips=e}}function rf(t,e){if(e.length!==t.handles)throw new Error("noUiSlider: must pass a attributes for all handles.");t.handleAttributes=e}function sf(t,e){if(!Ei(e))throw new Error("noUiSlider: 'ariaFormat' requires 'to' method.");t.ariaFormat=e}function of(t,e){if(!xu(e))throw new Error("noUiSlider: 'format' requires 'to' and 'from' methods.");t.format=e}function lf(t,e){if(typeof e!="boolean")throw new Error("noUiSlider: 'keyboardSupport' option must be a boolean.");t.keyboardSupport=e}function af(t,e){t.documentElement=e}function cf(t,e){if(typeof e!="string"&&e!==!1)throw new Error("noUiSlider: 'cssPrefix' must be a string or `false`.");t.cssPrefix=e}function uf(t,e){if(typeof e!="object")throw new Error("noUiSlider: 'cssClasses' must be an object.");typeof t.cssPrefix=="string"?(t.cssClasses={},Object.keys(e).forEach(function(n){t.cssClasses[n]=t.cssPrefix+e[n]})):t.cssClasses=e}function uo(t){var e={margin:null,limit:null,padding:null,animate:!0,animationDuration:300,ariaFormat:oo,format:oo},n={step:{r:!1,t:Hu},keyboardPageMultiplier:{r:!1,t:Uu},keyboardMultiplier:{r:!1,t:Bu},keyboardDefaultStep:{r:!1,t:qu},start:{r:!0,t:Wu},connect:{r:!0,t:ao},direction:{r:!0,t:ef},snap:{r:!1,t:Gu},animate:{r:!1,t:Yu},animationDuration:{r:!1,t:Xu},range:{r:!0,t:Ku},orientation:{r:!1,t:Ju},margin:{r:!1,t:co},limit:{r:!1,t:Qu},padding:{r:!1,t:Zu},behaviour:{r:!0,t:tf},ariaFormat:{r:!1,t:sf},format:{r:!1,t:of},tooltips:{r:!1,t:nf},keyboardSupport:{r:!0,t:lf},documentElement:{r:!1,t:af},cssPrefix:{r:!0,t:cf},cssClasses:{r:!0,t:uf},handleAttributes:{r:!1,t:rf}},i={connect:!1,direction:"ltr",behaviour:"tap",orientation:"horizontal",keyboardSupport:!0,cssPrefix:"noUi-",cssClasses:lo,keyboardPageMultiplier:5,keyboardMultiplier:1,keyboardDefaultStep:10};t.format&&!t.ariaFormat&&(t.ariaFormat=t.format),Object.keys(n).forEach(function(a){if(!Cr(t[a])&&i[a]===void 0){if(n[a].r)throw new Error("noUiSlider: '"+a+"' is required.");return}n[a].t(e,Cr(t[a])?t[a]:i[a])}),e.pips=t.pips;var r=document.createElement("div"),s=r.style.msTransform!==void 0,o=r.style.transform!==void 0;e.transformRule=o?"transform":s?"msTransform":"webkitTransform";var l=[["left","top"],["right","bottom"]];return e.style=l[e.dir][e.ort],e}function ff(t,e,n){var i=Lu(),r=Ru(),s=r&&Du(),o=t,l,a,c,u,d,f,h=e.spectrum,m=[],g=[],p=[],_=0,S={},I=!1,b=t.ownerDocument,E=e.documentElement||b.documentElement,O=b.body,x=b.dir==="rtl"||e.ort===1?0:100;function k(T,N){var $=b.createElement("div");return N&&Xe($,N),T.appendChild($),$}function M(T,N){var $=k(T,e.cssClasses.origin),G=k($,e.cssClasses.handle);if(k(G,e.cssClasses.touchArea),G.setAttribute("data-handle",String(N)),e.keyboardSupport&&(G.setAttribute("tabindex","0"),G.addEventListener("keydown",function(Q){return bt(Q,N)})),e.handleAttributes!==void 0){var J=e.handleAttributes[N];Object.keys(J).forEach(function(Q){G.setAttribute(Q,J[Q])})}return G.setAttribute("role","slider"),G.setAttribute("aria-orientation",e.ort?"vertical":"horizontal"),N===0?Xe(G,e.cssClasses.handleLower):N===e.handles-1&&Xe(G,e.cssClasses.handleUpper),$.handle=G,$}function P(T,N){return N?k(T,e.cssClasses.connect):!1}function L(T,N){a=k(N,e.cssClasses.connects),c=[],u=[],u.push(P(a,T[0]));for(var $=0;$<e.handles;$++)c.push(M(N,$)),p[$]=$,u.push(P(a,T[$+1]))}function q(T){Xe(T,e.cssClasses.target),e.dir===0?Xe(T,e.cssClasses.ltr):Xe(T,e.cssClasses.rtl),e.ort===0?Xe(T,e.cssClasses.horizontal):Xe(T,e.cssClasses.vertical);var N=getComputedStyle(T).direction;return N==="rtl"?Xe(T,e.cssClasses.textDirectionRtl):Xe(T,e.cssClasses.textDirectionLtr),k(T,e.cssClasses.base)}function R(T,N){return!e.tooltips||!e.tooltips[N]?!1:k(T.firstChild,e.cssClasses.tooltip)}function C(){return o.hasAttribute("disabled")}function D(T){var N=c[T];return N.hasAttribute("disabled")}function A(T){T!=null?(c[T].setAttribute("disabled",""),c[T].handle.removeAttribute("tabindex")):(o.setAttribute("disabled",""),c.forEach(function(N){N.handle.removeAttribute("tabindex")}))}function V(T){T!=null?(c[T].removeAttribute("disabled"),c[T].handle.setAttribute("tabindex","0")):(o.removeAttribute("disabled"),c.forEach(function(N){N.removeAttribute("disabled"),N.handle.setAttribute("tabindex","0")}))}function B(){f&&(Mt("update"+nn.tooltips),f.forEach(function(T){T&&eo(T)}),f=null)}function H(){B(),f=c.map(R),zn("update"+nn.tooltips,function(T,N,$){if(!(!f||!e.tooltips)&&f[N]!==!1){var G=T[N];e.tooltips[N]!==!0&&(G=e.tooltips[N].to($[N])),f[N].innerHTML=G}})}function Y(){Mt("update"+nn.aria),zn("update"+nn.aria,function(T,N,$,G,J){p.forEach(function(Q){var ue=c[Q],se=_n(g,Q,0,!0,!0,!0),Ae=_n(g,Q,100,!0,!0,!0),Te=J[Q],$e=String(e.ariaFormat.to($[Q]));se=h.fromStepping(se).toFixed(1),Ae=h.fromStepping(Ae).toFixed(1),Te=h.fromStepping(Te).toFixed(1),ue.children[0].setAttribute("aria-valuemin",se),ue.children[0].setAttribute("aria-valuemax",Ae),ue.children[0].setAttribute("aria-valuenow",Te),ue.children[0].setAttribute("aria-valuetext",$e)})})}function Z(T){if(T.mode===tn.Range||T.mode===tn.Steps)return h.xVal;if(T.mode===tn.Count){if(T.values<2)throw new Error("noUiSlider: 'values' (>= 2) required for mode 'count'.");for(var N=T.values-1,$=100/N,G=[];N--;)G[N]=N*$;return G.push(100),re(G,T.stepped)}return T.mode===tn.Positions?re(T.values,T.stepped):T.mode===tn.Values?T.stepped?T.values.map(function(J){return h.fromStepping(h.getStep(h.toStepping(J)))}):T.values:[]}function re(T,N){return T.map(function($){return h.fromStepping(N?h.getStep($):$)})}function fe(T){function N(Te,$e){return Number((Te+$e).toFixed(7))}var $=Z(T),G={},J=h.xVal[0],Q=h.xVal[h.xVal.length-1],ue=!1,se=!1,Ae=0;return $=Au($.slice().sort(function(Te,$e){return Te-$e})),$[0]!==J&&($.unshift(J),ue=!0),$[$.length-1]!==Q&&($.push(Q),se=!0),$.forEach(function(Te,$e){var ze,Ie,He,Ze=Te,Be=$[$e+1],We,ws,Ss,ks,vc,Es,yc,bc=T.mode===tn.Steps;for(bc&&(ze=h.xNumSteps[$e]),ze||(ze=Be-Ze),Be===void 0&&(Be=Ze),ze=Math.max(ze,1e-7),Ie=Ze;Ie<=Be;Ie=N(Ie,ze)){for(We=h.toStepping(Ie),ws=We-Ae,vc=ws/(T.density||1),Es=Math.round(vc),yc=ws/Es,He=1;He<=Es;He+=1)Ss=Ae+He*yc,G[Ss.toFixed(5)]=[h.fromStepping(Ss),0];ks=$.indexOf(Ie)>-1?tt.LargeValue:bc?tt.SmallValue:tt.NoValue,!$e&&ue&&Ie!==Be&&(ks=0),Ie===Be&&se||(G[We.toFixed(5)]=[Ie,ks]),Ae=We}}),G}function te(T,N,$){var G,J,Q=b.createElement("div"),ue=(G={},G[tt.None]="",G[tt.NoValue]=e.cssClasses.valueNormal,G[tt.LargeValue]=e.cssClasses.valueLarge,G[tt.SmallValue]=e.cssClasses.valueSub,G),se=(J={},J[tt.None]="",J[tt.NoValue]=e.cssClasses.markerNormal,J[tt.LargeValue]=e.cssClasses.markerLarge,J[tt.SmallValue]=e.cssClasses.markerSub,J),Ae=[e.cssClasses.valueHorizontal,e.cssClasses.valueVertical],Te=[e.cssClasses.markerHorizontal,e.cssClasses.markerVertical];Xe(Q,e.cssClasses.pips),Xe(Q,e.ort===0?e.cssClasses.pipsHorizontal:e.cssClasses.pipsVertical);function $e(Ie,He){var Ze=He===e.cssClasses.value,Be=Ze?Ae:Te,We=Ze?ue:se;return He+" "+Be[e.ort]+" "+We[Ie]}function ze(Ie,He,Ze){if(Ze=N?N(He,Ze):Ze,Ze!==tt.None){var Be=k(Q,!1);Be.className=$e(Ze,e.cssClasses.marker),Be.style[e.style]=Ie+"%",Ze>tt.NoValue&&(Be=k(Q,!1),Be.className=$e(Ze,e.cssClasses.value),Be.setAttribute("data-value",String(He)),Be.style[e.style]=Ie+"%",Be.innerHTML=String($.to(He)))}}return Object.keys(T).forEach(function(Ie){ze(Ie,T[Ie][0],T[Ie][1])}),Q}function ce(){d&&(eo(d),d=null)}function ie(T){ce();var N=fe(T),$=T.filter,G=T.format||{to:function(J){return String(Math.round(J))}};return d=o.appendChild(te(N,$,G)),d}function Me(){var T=l.getBoundingClientRect(),N="offset"+["Width","Height"][e.ort];return e.ort===0?T.width||l[N]:T.height||l[N]}function be(T,N,$,G){var J=function(ue){var se=Ve(ue,G.pageOffset,G.target||N);if(!se||C()&&!G.doNotReject||Pu(o,e.cssClasses.tap)&&!G.doNotReject||T===i.start&&se.buttons!==void 0&&se.buttons>1||G.hover&&se.buttons)return!1;s||se.preventDefault(),se.calcPoint=se.points[e.ort],$(se,G)},Q=[];return T.split(" ").forEach(function(ue){N.addEventListener(ue,J,s?{passive:!0}:!1),Q.push([ue,J])}),Q}function Ve(T,N,$){var G=T.type.indexOf("touch")===0,J=T.type.indexOf("mouse")===0,Q=T.type.indexOf("pointer")===0,ue=0,se=0;if(T.type.indexOf("MSPointer")===0&&(Q=!0),T.type==="mousedown"&&!T.buttons&&!T.touches)return!1;if(G){var Ae=function(ze){var Ie=ze.target;return Ie===$||$.contains(Ie)||T.composed&&T.composedPath().shift()===$};if(T.type==="touchstart"){var Te=Array.prototype.filter.call(T.touches,Ae);if(Te.length>1)return!1;ue=Te[0].pageX,se=Te[0].pageY}else{var $e=Array.prototype.find.call(T.changedTouches,Ae);if(!$e)return!1;ue=$e.pageX,se=$e.pageY}}return N=N||ro(b),(J||Q)&&(ue=T.clientX+N.x,se=T.clientY+N.y),T.pageOffset=N,T.points=[ue,se],T.cursor=J||Q,T}function Lt(T){var N=T-Nu(l,e.ort),$=N*100/Me();return $=io($),e.dir?100-$:$}function Re(T){var N=100,$=!1;return c.forEach(function(G,J){if(!D(J)){var Q=g[J],ue=Math.abs(Q-T),se=ue===100&&N===100,Ae=ue<N,Te=ue<=N&&T>Q;(Ae||Te||se)&&($=J,N=ue)}}),$}function Oe(T,N){T.type==="mouseout"&&T.target.nodeName==="HTML"&&T.relatedTarget===null&&Le(T,N)}function ot(T,N){if(navigator.appVersion.indexOf("MSIE 9")===-1&&T.buttons===0&&N.buttonsProperty!==0)return Le(T,N);var $=(e.dir?-1:1)*(T.calcPoint-N.startCalcPoint),G=$*100/N.baseSize;jn($>0,G,N.locations,N.handleNumbers,N.connect)}function Le(T,N){N.handle&&(Ii(N.handle,e.cssClasses.active),_-=1),N.listeners.forEach(function($){E.removeEventListener($[0],$[1])}),_===0&&(Ii(o,e.cssClasses.drag),at(),T.cursor&&(O.style.cursor="",O.removeEventListener("selectstart",to))),e.events.smoothSteps&&(N.handleNumbers.forEach(function($){ct($,g[$],!0,!0,!1,!1)}),N.handleNumbers.forEach(function($){Ne("update",$)})),N.handleNumbers.forEach(function($){Ne("change",$),Ne("set",$),Ne("end",$)})}function je(T,N){if(!N.handleNumbers.some(D)){var $;if(N.handleNumbers.length===1){var G=c[N.handleNumbers[0]];$=G.children[0],_+=1,Xe($,e.cssClasses.active)}T.stopPropagation();var J=[],Q=be(i.move,E,ot,{target:T.target,handle:$,connect:N.connect,listeners:J,startCalcPoint:T.calcPoint,baseSize:Me(),pageOffset:T.pageOffset,handleNumbers:N.handleNumbers,buttonsProperty:T.buttons,locations:g.slice()}),ue=be(i.end,E,Le,{target:T.target,handle:$,listeners:J,doNotReject:!0,handleNumbers:N.handleNumbers}),se=be("mouseout",E,Oe,{target:T.target,handle:$,listeners:J,doNotReject:!0,handleNumbers:N.handleNumbers});J.push.apply(J,Q.concat(ue,se)),T.cursor&&(O.style.cursor=getComputedStyle(T.target).cursor,c.length>1&&Xe(o,e.cssClasses.drag),O.addEventListener("selectstart",to,!1)),N.handleNumbers.forEach(function(Ae){Ne("start",Ae)})}}function Ht(T){T.stopPropagation();var N=Lt(T.calcPoint),$=Re(N);$!==!1&&(e.events.snap||no(o,e.cssClasses.tap,e.animationDuration),ct($,N,!0,!0),at(),Ne("slide",$,!0),Ne("update",$,!0),e.events.snap?je(T,{handleNumbers:[$]}):(Ne("change",$,!0),Ne("set",$,!0)))}function mt(T){var N=Lt(T.calcPoint),$=h.getStep(N),G=h.fromStepping($);Object.keys(S).forEach(function(J){J.split(".")[0]==="hover"&&S[J].forEach(function(Q){Q.call(cn,G)})})}function bt(T,N){if(C()||D(N))return!1;var $=["Left","Right"],G=["Down","Up"],J=["PageDown","PageUp"],Q=["Home","End"];e.dir&&!e.ort?$.reverse():e.ort&&!e.dir&&(G.reverse(),J.reverse());var ue=T.key.replace("Arrow",""),se=ue===J[0],Ae=ue===J[1],Te=ue===G[0]||ue===$[0]||se,$e=ue===G[1]||ue===$[1]||Ae,ze=ue===Q[0],Ie=ue===Q[1];if(!Te&&!$e&&!ze&&!Ie)return!0;T.preventDefault();var He;if($e||Te){var Ze=Te?0:1,Be=Fn(N),We=Be[Ze];if(We===null)return!1;We===!1&&(We=h.getDefaultStep(g[N],Te,e.keyboardDefaultStep)),Ae||se?We*=e.keyboardPageMultiplier:We*=e.keyboardMultiplier,We=Math.max(We,1e-7),We=(Te?-1:1)*We,He=m[N]+We}else Ie?He=e.spectrum.xVal[e.spectrum.xVal.length-1]:He=e.spectrum.xVal[0];return ct(N,h.toStepping(He),!0,!0),Ne("slide",N),Ne("update",N),Ne("change",N),Ne("set",N),!1}function ui(T){T.fixed||c.forEach(function(N,$){be(i.start,N.children[0],je,{handleNumbers:[$]})}),T.tap&&be(i.start,l,Ht,{}),T.hover&&be(i.move,l,mt,{hover:!0}),T.drag&&u.forEach(function(N,$){if(!(N===!1||$===0||$===u.length-1)){var G=c[$-1],J=c[$],Q=[N],ue=[G,J],se=[$-1,$];Xe(N,e.cssClasses.draggable),T.fixed&&(Q.push(G.children[0]),Q.push(J.children[0])),T.dragAll&&(ue=c,se=p),Q.forEach(function(Ae){be(i.start,Ae,je,{handles:ue,handleNumbers:se,connect:N})})}})}function zn(T,N){S[T]=S[T]||[],S[T].push(N),T.split(".")[0]==="update"&&c.forEach(function($,G){Ne("update",G)})}function sr(T){return T===nn.aria||T===nn.tooltips}function Mt(T){var N=T&&T.split(".")[0],$=N?T.substring(N.length):T;Object.keys(S).forEach(function(G){var J=G.split(".")[0],Q=G.substring(J.length);(!N||N===J)&&(!$||$===Q)&&(!sr(Q)||$===Q)&&delete S[G]})}function Ne(T,N,$){Object.keys(S).forEach(function(G){var J=G.split(".")[0];T===J&&S[G].forEach(function(Q){Q.call(cn,m.map(e.format.to),N,m.slice(),$||!1,g.slice(),cn)})})}function _n(T,N,$,G,J,Q,ue){var se;return c.length>1&&!e.events.unconstrained&&(G&&N>0&&(se=h.getAbsoluteDistance(T[N-1],e.margin,!1),$=Math.max($,se)),J&&N<c.length-1&&(se=h.getAbsoluteDistance(T[N+1],e.margin,!0),$=Math.min($,se))),c.length>1&&e.limit&&(G&&N>0&&(se=h.getAbsoluteDistance(T[N-1],e.limit,!1),$=Math.min($,se)),J&&N<c.length-1&&(se=h.getAbsoluteDistance(T[N+1],e.limit,!0),$=Math.max($,se))),e.padding&&(N===0&&(se=h.getAbsoluteDistance(0,e.padding[0],!1),$=Math.max($,se)),N===c.length-1&&(se=h.getAbsoluteDistance(100,e.padding[1],!0),$=Math.min($,se))),ue||($=h.getStep($)),$=io($),$===T[N]&&!Q?!1:$}function lt(T,N){var $=e.ort;return($?N:T)+", "+($?T:N)}function jn(T,N,$,G,J){var Q=$.slice(),ue=G[0],se=e.events.smoothSteps,Ae=[!T,T],Te=[T,!T];G=G.slice(),T&&G.reverse(),G.length>1?G.forEach(function(ze,Ie){var He=_n(Q,ze,Q[ze]+N,Ae[Ie],Te[Ie],!1,se);He===!1?N=0:(N=He-Q[ze],Q[ze]=He)}):Ae=Te=[!0];var $e=!1;G.forEach(function(ze,Ie){$e=ct(ze,$[ze]+N,Ae[Ie],Te[Ie],!1,se)||$e}),$e&&(G.forEach(function(ze){Ne("update",ze),Ne("slide",ze)}),J!=null&&Ne("drag",ue))}function pt(T,N){return e.dir?100-T-N:T}function fi(T,N){g[T]=N,m[T]=h.fromStepping(N);var $=pt(N,0)-x,G="translate("+lt($+"%","0")+")";if(c[T].style[e.transformRule]=G,e.events.invertConnects&&g.length>1){var J=g.every(function(Q,ue,se){return ue===0||Q>=se[ue-1]});if(I!==!J){Ce();return}}xe(T),xe(T+1),I&&(xe(T-1),xe(T+2))}function at(){p.forEach(function(T){var N=g[T]>50?-1:1,$=3+(c.length+N*T);c[T].style.zIndex=String($)})}function ct(T,N,$,G,J,Q){return J||(N=_n(g,T,N,$,G,!1,Q)),N===!1?!1:(fi(T,N),!0)}function xe(T){if(u[T]){var N=g.slice();I&&N.sort(function(se,Ae){return se-Ae});var $=0,G=100;T!==0&&($=N[T-1]),T!==u.length-1&&(G=N[T]);var J=G-$,Q="translate("+lt(pt($,J)+"%","0")+")",ue="scale("+lt(J/100,"1")+")";u[T].style[e.transformRule]=Q+" "+ue}}function or(T,N){return T===null||T===!1||T===void 0||(typeof T=="number"&&(T=String(T)),T=e.format.from(T),T!==!1&&(T=h.toStepping(T)),T===!1||isNaN(T))?g[N]:T}function an(T,N,$){var G=Ci(T),J=g[0]===void 0;N=N===void 0?!0:N,e.animate&&!J&&no(o,e.cssClasses.tap,e.animationDuration),p.forEach(function(se){ct(se,or(G[se],se),!0,!1,$)});var Q=p.length===1?0:1;if(J&&h.hasNoSize()&&($=!0,g[0]=0,p.length>1)){var ue=100/(p.length-1);p.forEach(function(se){g[se]=se*ue})}for(;Q<p.length;++Q)p.forEach(function(se){ct(se,g[se],!0,!0,$)});at(),p.forEach(function(se){Ne("update",se),G[se]!==null&&N&&Ne("set",se)})}function wt(T){an(e.start,T)}function lr(T,N,$,G){if(T=Number(T),!(T>=0&&T<p.length))throw new Error("noUiSlider: invalid handle number, got: "+T);ct(T,or(N,T),!0,!0,G),Ne("update",T),$&&Ne("set",T)}function Dt(T){if(T===void 0&&(T=!1),T)return m.length===1?m[0]:m.slice(0);var N=m.map(e.format.to);return N.length===1?N[0]:N}function ar(){for(Mt(nn.aria),Mt(nn.tooltips),Object.keys(e.cssClasses).forEach(function(T){Ii(o,e.cssClasses[T])});o.firstChild;)o.removeChild(o.firstChild);delete o.noUiSlider}function Fn(T){var N=g[T],$=h.getNearbySteps(N),G=m[T],J=$.thisStep.step,Q=null;if(e.snap)return[G-$.stepBefore.startValue||null,$.stepAfter.startValue-G||null];J!==!1&&G+J>$.stepAfter.startValue&&(J=$.stepAfter.startValue-G),G>$.thisStep.startValue?Q=$.thisStep.step:$.stepBefore.step===!1?Q=!1:Q=G-$.stepBefore.highestStep,N===100?J=null:N===0&&(Q=null);var ue=h.countStepDecimals();return J!==null&&J!==!1&&(J=Number(J.toFixed(ue))),Q!==null&&Q!==!1&&(Q=Number(Q.toFixed(ue))),[Q,J]}function St(){return p.map(Fn)}function cr(T,N){var $=Dt(),G=["margin","limit","padding","range","animate","snap","step","format","pips","tooltips","connect"];G.forEach(function(Q){T[Q]!==void 0&&(n[Q]=T[Q])});var J=uo(n);G.forEach(function(Q){T[Q]!==void 0&&(e[Q]=J[Q])}),h=J.spectrum,e.margin=J.margin,e.limit=J.limit,e.padding=J.padding,e.pips?ie(e.pips):ce(),e.tooltips?H():B(),g=[],an(Cr(T.start)?T.start:$,N),T.connect&&ee()}function ee(){for(;a.firstChild;)a.removeChild(a.firstChild);for(var T=0;T<=e.handles;T++)u[T]=P(a,e.connect[T]),xe(T);ui({drag:e.events.drag,fixed:!0})}function Ce(){I=!I,ao(e,e.connect.map(function(T){return!T})),ee()}function Pe(){l=q(o),L(e.connect,l),ui(e.events),an(e.start),e.pips&&ie(e.pips),e.tooltips&&H(),Y()}Pe();var cn={destroy:ar,steps:St,on:zn,off:Mt,get:Dt,set:an,setHandle:lr,reset:wt,disable:A,enable:V,__moveHandles:function(T,N,$){jn(T,N,g,$)},options:n,updateOptions:cr,target:o,removePips:ce,removeTooltips:B,getPositions:function(){return g.slice()},getTooltips:function(){return f},getOrigins:function(){return c},pips:ie};return cn}function hf(t,e){if(!t||!t.nodeName)throw new Error("noUiSlider: create requires a single element, got: "+t);if(t.noUiSlider)throw new Error("noUiSlider: Slider was already initialized.");var n=uo(e),i=ff(t,n,e);return t.noUiSlider=i,i}const df={__spectrum:so,cssClasses:lo,create:hf},Sy="",ky="";function mf(t){let e,n,i;return{c(){e=w("span"),n=ne(t[0]),v(e,"id",t[3]),v(e,"class",i="tooltip "+t[2]+" "+(t[1]?"display":"")+" svelte-1am23me")},m(r,s){j(r,e,s),y(e,n)},p(r,[s]){s&1&&_e(n,r[0]),s&6&&i!==(i="tooltip "+r[2]+" "+(r[1]?"display":"")+" svelte-1am23me")&&v(e,"class",i)},i:X,o:X,d(r){r&&z(e)}}}function pf(t,e,n){let i,r,s,o,{tooltipText:l}=e,{targetHtmlId:a}=e;const c=`tooltip-generic-${window.crypto.randomUUID()}`,u=()=>n(1,o=!0),d=()=>n(1,o=!1),f=()=>n(1,o=!o);return Hn(()=>{s=a?document.getElementById(a):document.getElementById(c).parentElement,a&&!s&&(console.error(`TooltipGeneric: element with ID ${a} not found, defaulting to the parent element`),s=document.getElementById(c).targetElement),s.addEventListener("mouseover",u),s.addEventListener("mouseout",d),s.addEventListener("click",f)}),Un(()=>{s.removeEventListener("mouseover",u),s.removeEventListener("mouseout",d),s.removeEventListener("click",f)}),t.$$set=h=>{"tooltipText"in h&&n(0,l=h.tooltipText),"targetHtmlId"in h&&n(4,a=h.targetHtmlId)},t.$$.update=()=>{t.$$.dirty&33&&n(2,i=r(l))},n(5,r=h=>n(2,i=h.length>100?"tooltip-wide":h.length>20?"tooltip-mid":"tooltip-thin")),s=void 0,n(1,o=!1),[l,o,i,c,a,r]}class Mi extends ye{constructor(e){super(),ve(this,e,pf,mf,pe,{tooltipText:0,targetHtmlId:4})}}const Ey="";function gf(t){let e,n,i,r,s,o,l,a,c,u,d,f,h,m,g,p;return{c(){e=w("div"),n=w("span"),i=ne(t[2]),r=ne(" ("),s=ne(t[3]),o=ne(")"),l=U(),a=w("div"),c=w("span"),u=ne(t[0]),d=U(),f=w("div"),h=w("div"),m=U(),g=w("span"),p=ne(t[1]),v(c,"class","range-marker svelte-216mtn"),v(h,"class","slider"),v(h,"id",t[4]),v(f,"class","slider-wrapper svelte-216mtn"),v(g,"class","range-marker svelte-216mtn"),v(a,"class","slider-outer-wrapper is-flex flex-direction-row svelte-216mtn")},m(_,S){j(_,e,S),y(e,n),y(n,i),y(n,r),y(n,s),y(n,o),y(e,l),y(e,a),y(a,c),y(c,u),y(a,d),y(a,f),y(f,h),y(a,m),y(a,g),y(g,p)},p(_,[S]){S&4&&_e(i,_[2]),S&8&&_e(s,_[3]),S&1&&_e(u,_[0]),S&2&&_e(p,_[1])},i:X,o:X,d(_){_&&z(e)}}}function _f(t,e,n){let i,{minVal:r}=e,{maxVal:s}=e,{start:o}=e,{step:l=void 0}=e,{roundTo:a=2}=e,{title:c=""}=e,{emitOnUpdate:u=!1}=e;const d=bi(),f=`slider-${window.crypto.randomUUID()}`,h=Array.isArray(o)&&o.length===2&&o.every(k=>!isNaN(parseFloat(k))),m=[],g=h?[`noUi-handle-${window.crypto.randomUUID()}`,`noUi-handle-${window.crypto.randomUUID()}`]:[`noUi-handle-${window.crypto.randomUUID()}`],p=Si();p.setCompareFn(h?kr:(k,M)=>S(k)===S(M)),p.set(o);const _=_t("resetTrigger")||void 0;_==null||_.subscribe(E);const S=k=>Number(k.toFixed(a)),I=(k,M)=>{k=Array.isArray(k)?k.map(S):S(k),n(3,i=k),(M==="set"||M==="update"&&u)&&(p.set(k),p.same()||d("updateSlider",p.get()))};function b(k){m.length&&m.map((M,P)=>M.$set({tooltipText:h?k[P]:k}))}function E(){const k=document.getElementById(f);k!=null&&k.noUiSlider&&k.noUiSlider.reset()}function O(){const k=document.getElementById(f);let M;df.create(k,{start:o,step:l,connect:h?!0:"lower",range:{min:r,max:s},handleAttributes:g.map(P=>({id:P}))}),k.noUiSlider.on("update",()=>{M=k.noUiSlider.get(!0),I(M,"update")}),k.noUiSlider.on("set",()=>{M=k.noUiSlider.get(!0),I(M,"set")})}function x(){g.map((k,M)=>{m.push(new Mi({target:document.getElementById(k),props:h?{tooltipText:i[M]}:{tooltipText:i}}))})}return Hn(()=>{O(),x()}),Un(()=>{document.getElementById(f)&&(document.getElementById(f).innerHTML="")}),t.$$set=k=>{"minVal"in k&&n(0,r=k.minVal),"maxVal"in k&&n(1,s=k.maxVal),"start"in k&&n(5,o=k.start),"step"in k&&n(6,l=k.step),"roundTo"in k&&n(7,a=k.roundTo),"title"in k&&n(2,c=k.title),"emitOnUpdate"in k&&n(8,u=k.emitOnUpdate)},t.$$.update=()=>{t.$$.dirty&32&&n(3,i=o),t.$$.dirty&8&&b(i)},[r,s,c,i,f,o,l,a,u]}class un extends ye{constructor(e){super(),ve(this,e,_f,gf,pe,{minVal:0,maxVal:1,start:5,step:6,roundTo:7,title:2,emitOnUpdate:8})}}const vf=t=>({}),fo=t=>({});function ho(t,e,n){const i=t.slice();return i[39]=e[n],i}function mo(t,e,n){const i=t.slice();return i[42]=e[n],i}function po(t,e,n){const i=t.slice();return i[39]=e[n],i}function go(t,e,n){const i=t.slice();i[47]=e[n];const r=Object.keys(i[25][i[47]]||{});return i[48]=r,i}function _o(t){var cr;let e,n,i,r=((cr=t[0])==null?void 0:cr.title)+"",s,o,l,a,c,u,d,f,h,m=(t[5].pairs||0)+"",g,p,_,S,I,b,E,O=(t[5].images||0)+"",x,k,M,P,L,q,R,C=(t[6]||0)+"",D,A,V,B,H,Y,Z,re,fe,te,ce,ie,Me,be,Ve,Lt,Re,Oe,ot,Le,je,Ht,mt,bt,ui,zn,sr,Mt,Ne,_n,lt,jn=["Series","Witness","Work"],pt=[];for(let ee=0;ee<3;ee+=1)pt[ee]=vo(go(t,jn,ee));H=new Mu({props:{documentNodes:t[7],selectedRegions:t[8],toggleRegion:t[16]}});let fi=["all","filtered"],at=[];for(let ee=0;ee<2;ee+=1)at[ee]=yo(po(t,fi,ee));let ct=t[26],xe=[];for(let ee=0;ee<ct.length;ee+=1)xe[ee]=bo(mo(t,ct,ee));const or=ee=>K(xe[ee],1,1,()=>{xe[ee]=null});let an=["threshold","topk"],wt=[];for(let ee=0;ee<2;ee+=1)wt[ee]=wo(ho(t,an,ee));const lr=[wf,bf],Dt=[];function ar(ee,Ce){return ee[4]==="threshold"?0:1}mt=ar(t),bt=Dt[mt]=lr[mt](t);const Fn=t[32].datavizInfo,St=kt(Fn,t,t[31],fo);return{c(){e=w("div"),n=w("div"),i=w("h1"),s=ne(r),o=U(),l=w("div");for(let ee=0;ee<3;ee+=1)pt[ee].c();a=U(),c=w("div"),u=w("div"),d=w("p"),d.textContent=`${W==="en"?"Pairs":"Paires"}`,f=U(),h=w("p"),g=ne(m),p=U(),_=w("div"),S=w("div"),I=w("p"),I.textContent="Images",b=U(),E=w("p"),x=ne(O),k=U(),M=w("div"),P=w("div"),L=w("p"),L.textContent="Clusters",q=U(),R=w("p"),D=ne(C),A=U(),V=w("hr"),B=U(),ae(H.$$.fragment),Y=U(),Z=w("hr"),re=U(),fe=w("div"),te=w("h3"),te.textContent=`${W==="en"?"Similarity categories":"Catégories de similarité"}`,ce=U(),ie=w("div");for(let ee=0;ee<2;ee+=1)at[ee].c();Me=U(),be=w("div");for(let ee=0;ee<xe.length;ee+=1)xe[ee].c();Ve=U(),Lt=w("hr"),Re=U(),Oe=w("div"),ot=w("h3"),ot.textContent=`${W==="en"?"Similarity score":"Score de similarité"}`,Le=U(),je=w("div");for(let ee=0;ee<2;ee+=1)wt[ee].c();Ht=U(),bt.c(),ui=U(),zn=w("hr"),sr=U(),Mt=w("div"),Ne=w("h3"),Ne.textContent=`${W==="en"?"Visualisation information":"Informations sur la visualisation"}`,_n=U(),St&&St.c(),v(i,"class","title"),v(d,"class","heading"),v(h,"class","title is-5"),v(c,"class","level-item has-text-centered"),v(I,"class","heading"),v(E,"class","title is-5"),v(_,"class","level-item has-text-centered"),v(L,"class","heading"),v(R,"class","title is-5"),v(M,"class","level-item has-text-centered"),v(l,"class","level"),v(n,"class","pb-2"),v(te,"class","title"),v(ie,"class","buttons mb-3"),v(be,"class","level"),Se(be,"is-disabled",t[1]==="all"),v(fe,"class","pt-2"),v(ot,"class","title"),v(je,"class","buttons mb-3"),v(Oe,"class","pt-2"),v(Ne,"class","title"),v(Mt,"class","py-2"),v(e,"class","content is-small mt-4")},m(ee,Ce){j(ee,e,Ce),y(e,n),y(n,i),y(i,s),y(n,o),y(n,l);for(let Pe=0;Pe<3;Pe+=1)pt[Pe]&&pt[Pe].m(l,null);y(l,a),y(l,c),y(c,u),y(u,d),y(u,f),y(u,h),y(h,g),y(l,p),y(l,_),y(_,S),y(S,I),y(S,b),y(S,E),y(E,x),y(l,k),y(l,M),y(M,P),y(P,L),y(P,q),y(P,R),y(R,D),y(e,A),y(e,V),y(e,B),oe(H,e,null),y(e,Y),y(e,Z),y(e,re),y(e,fe),y(fe,te),y(fe,ce),y(fe,ie);for(let Pe=0;Pe<2;Pe+=1)at[Pe]&&at[Pe].m(ie,null);y(fe,Me),y(fe,be);for(let Pe=0;Pe<xe.length;Pe+=1)xe[Pe]&&xe[Pe].m(be,null);y(e,Ve),y(e,Lt),y(e,Re),y(e,Oe),y(Oe,ot),y(Oe,Le),y(Oe,je);for(let Pe=0;Pe<2;Pe+=1)wt[Pe]&&wt[Pe].m(je,null);y(Oe,Ht),Dt[mt].m(Oe,null),y(e,ui),y(e,zn),y(e,sr),y(e,Mt),y(Mt,Ne),y(Mt,_n),St&&St.m(Mt,null),lt=!0},p(ee,Ce){var T;if((!lt||Ce[0]&1)&&r!==(r=((T=ee[0])==null?void 0:T.title)+"")&&_e(s,r),Ce[0]&33554432){jn=["Series","Witness","Work"];let N;for(N=0;N<3;N+=1){const $=go(ee,jn,N);pt[N]?pt[N].p($,Ce):(pt[N]=vo($),pt[N].c(),pt[N].m(l,a))}for(;N<3;N+=1)pt[N].d(1)}(!lt||Ce[0]&32)&&m!==(m=(ee[5].pairs||0)+"")&&_e(g,m),(!lt||Ce[0]&32)&&O!==(O=(ee[5].images||0)+"")&&_e(x,O),(!lt||Ce[0]&64)&&C!==(C=(ee[6]||0)+"")&&_e(D,C);const Pe={};if(Ce[0]&128&&(Pe.documentNodes=ee[7]),Ce[0]&256&&(Pe.selectedRegions=ee[8]),H.$set(Pe),Ce[0]&268435458){fi=["all","filtered"];let N;for(N=0;N<2;N+=1){const $=po(ee,fi,N);at[N]?at[N].p($,Ce):(at[N]=yo($),at[N].c(),at[N].m(ie,null))}for(;N<2;N+=1)at[N].d(1)}if(Ce[0]&201326630){ct=ee[26];let N;for(N=0;N<ct.length;N+=1){const $=mo(ee,ct,N);xe[N]?(xe[N].p($,Ce),F(xe[N],1)):(xe[N]=bo($),xe[N].c(),F(xe[N],1),xe[N].m(be,null))}for(ke(),N=ct.length;N<xe.length;N+=1)or(N);Ee()}if((!lt||Ce[0]&2)&&Se(be,"is-disabled",ee[1]==="all"),Ce[0]&1048600){an=["threshold","topk"];let N;for(N=0;N<2;N+=1){const $=ho(ee,an,N);wt[N]?wt[N].p($,Ce):(wt[N]=wo($),wt[N].c(),wt[N].m(je,null))}for(;N<2;N+=1)wt[N].d(1)}let cn=mt;mt=ar(ee),mt===cn?Dt[mt].p(ee,Ce):(ke(),K(Dt[cn],1,1,()=>{Dt[cn]=null}),Ee(),bt=Dt[mt],bt?bt.p(ee,Ce):(bt=Dt[mt]=lr[mt](ee),bt.c()),F(bt,1),bt.m(Oe,null)),St&&St.p&&(!lt||Ce[1]&1)&&Ct(St,Fn,ee,ee[31],lt?Et(Fn,ee[31],Ce,vf):It(ee[31]),fo)},i(ee){if(!lt){F(H.$$.fragment,ee);for(let Ce=0;Ce<ct.length;Ce+=1)F(xe[Ce]);F(bt),F(St,ee),lt=!0}},o(ee){K(H.$$.fragment,ee),xe=xe.filter(Boolean);for(let Ce=0;Ce<xe.length;Ce+=1)K(xe[Ce]);K(bt),K(St,ee),lt=!1},d(ee){ee&&z(e),Ye(pt,ee),le(H),Ye(at,ee),Ye(xe,ee),Ye(wt,ee),Dt[mt].d(),St&&St.d(ee)}}}function yf(t){let e,n,i,r=qc[t[47]]+"",s,o,l,a=(t[48].length||0)+"",c;return{c(){e=w("div"),n=w("div"),i=w("p"),s=ne(r),o=U(),l=w("p"),c=ne(a),v(i,"class","heading"),v(l,"class","title is-5"),v(e,"class","level-item has-text-centered")},m(u,d){j(u,e,d),y(e,n),y(n,i),y(i,s),y(n,o),y(n,l),y(l,c)},p:X,d(u){u&&z(e)}}}function vo(t){let e,n=t[48].length>0&&yf(t);return{c(){n&&n.c(),e=qe()},m(i,r){n&&n.m(i,r),j(i,e,r)},p(i,r){i[48].length>0&&n.p(i,r)},d(i){n&&n.d(i),i&&z(e)}}}function yo(t){let e,n=t[39]==="all"?W==="en"?"All pairs":"Toutes les paires":W==="en"?"Filter by category":"Filtrer par catégorie",i,r,s,o;function l(){return t[33](t[39])}return{c(){e=w("button"),i=ne(n),r=U(),v(e,"class","button is-small is-flex-grow-1"),Se(e,"is-link",t[1]===t[39]),Se(e,"is-contrasted",t[1]!==t[39])},m(a,c){j(a,e,c),y(e,i),y(e,r),s||(o=ge(e,"click",l),s=!0)},p(a,c){t=a,c[0]&2&&Se(e,"is-link",t[1]===t[39]),c[0]&2&&Se(e,"is-contrasted",t[1]!==t[39])},d(a){a&&z(e),s=!1,o()}}}function bo(t){let e,n,i,r,s,o=(t[5].categories[t[42]]||0)+"",l,a,c;return i=new xn({props:{category:t[42],isSelected:t[2].includes(t[42]),toggle:t[27],selectable:t[1]==="filtered"}}),{c(){e=w("div"),n=w("div"),ae(i.$$.fragment),r=U(),s=w("p"),l=ne(o),a=U(),v(s,"class","is-size-7 mt-1"),v(e,"class","level-item has-text-centered")},m(u,d){j(u,e,d),y(e,n),oe(i,n,null),y(n,r),y(n,s),y(s,l),y(e,a),c=!0},p(u,d){const f={};d[0]&4&&(f.isSelected=u[2].includes(u[42])),d[0]&2&&(f.selectable=u[1]==="filtered"),i.$set(f),(!c||d[0]&32)&&o!==(o=(u[5].categories[u[42]]||0)+"")&&_e(l,o)},i(u){c||(F(i.$$.fragment,u),c=!0)},o(u){K(i.$$.fragment,u),c=!1},d(u){u&&z(e),le(i)}}}function wo(t){let e,n=t[39]==="threshold"?W==="en"?"Score threshold":"Seuil de score":W==="en"?"Top K pairs":"Top K paires",i,r,s,o;function l(){return t[34](t[39])}return{c(){e=w("button"),i=ne(n),r=U(),v(e,"class","button is-small is-flex-grow-1"),Se(e,"is-link",t[4]===t[39]),Se(e,"is-contrasted",t[4]!==t[39])},m(a,c){j(a,e,c),y(e,i),y(e,r),s||(o=ge(e,"click",l),s=!0)},p(a,c){t=a,c[0]&16&&Se(e,"is-link",t[4]===t[39]),c[0]&16&&Se(e,"is-contrasted",t[4]!==t[39])},d(a){a&&z(e),s=!1,o()}}}function bf(t){let e,n,i,r,s,o,l,a,c,u,d,f;return i=new un({props:{minVal:1,maxVal:5,start:t[3]||3,step:1,roundTo:0,title:"K"}}),i.$on("updateSlider",t[36]),{c(){e=w("div"),n=w("div"),ae(i.$$.fragment),r=U(),s=w("div"),o=w("label"),l=w("input"),a=U(),c=w("span"),c.textContent=`${W==="en"?"Mutual top K":"Top K mutuel"}`,v(n,"class","column is-two-thirds pl-4"),l.checked=t[11],v(l,"type","checkbox"),v(l,"class","mr-2"),v(c,"class","is-size-7"),v(o,"class","checkbox mt-3 is-flex is-align-items-center"),v(s,"class","column mt-2"),v(e,"class","columns mt-2")},m(h,m){j(h,e,m),y(e,n),oe(i,n,null),y(e,r),y(e,s),y(s,o),y(o,l),y(o,a),y(o,c),u=!0,d||(f=ge(l,"change",t[37]),d=!0)},p(h,m){const g={};m[0]&8&&(g.start=h[3]||3),i.$set(g),(!u||m[0]&2048)&&(l.checked=h[11])},i(h){u||(F(i.$$.fragment,h),u=!0)},o(h){K(i.$$.fragment,h),u=!1},d(h){h&&z(e),le(i),d=!1,f()}}}function wf(t){var i,r;let e,n;return e=new un({props:{minVal:((i=t[9].scoreRange)==null?void 0:i.min)||0,maxVal:((r=t[9].scoreRange)==null?void 0:r.max)||1,start:t[10],step:.01,roundTo:2,title:W==="en"?"Minimum score":"Score minimum"}}),e.$on("updateSlider",t[35]),{c(){ae(e.$$.fragment)},m(s,o){oe(e,s,o),n=!0},p(s,o){var a,c;const l={};o[0]&512&&(l.minVal=((a=s[9].scoreRange)==null?void 0:a.min)||0),o[0]&512&&(l.maxVal=((c=s[9].scoreRange)==null?void 0:c.max)||1),o[0]&1024&&(l.start=s[10]),e.$set(l)},i(s){n||(F(e.$$.fragment,s),n=!0)},o(s){K(e.$$.fragment,s),n=!1},d(s){le(e,s)}}}function Sf(t){let e,n,i=t[5]&&_o(t);return{c(){e=w("div"),i&&i.c(),v(e,"class","m-4 py-5 px-4")},m(r,s){j(r,e,s),i&&i.m(e,null),n=!0},p(r,s){r[5]?i?(i.p(r,s),s[0]&32&&F(i,1)):(i=_o(r),i.c(),F(i,1),i.m(e,null)):i&&(ke(),K(i,1,1,()=>{i=null}),Ee())},i(r){n||(F(i),n=!0)},o(r){K(i),n=!1},d(r){r&&z(e),i&&i.d()}}}function kf(t,e,n){let i,r,s,o,l,a,c,u,d,f,{$$slots:h={},$$scope:m}=e,{docSet:g=null}=e,{documentSetStore:p}=e,{clusterStore:_}=e;const{docSetNumber:S,documentNodes:I,selectedCategories:b,toggleCategory:E,selectedRegions:O,toggleRegion:x,threshold:k,setThreshold:M,topK:P,setTopK:L,mutualTopK:q,setMutualTopK:R,pairStats:C}=p;de(t,S,ie=>n(5,o=ie)),de(t,I,ie=>n(7,a=ie)),de(t,b,ie=>n(2,r=ie)),de(t,O,ie=>n(8,c=ie)),de(t,k,ie=>n(10,d=ie)),de(t,P,ie=>n(3,s=ie)),de(t,q,ie=>n(11,f=ie)),de(t,C,ie=>n(9,u=ie));const{clusterNb:D}=_;de(t,D,ie=>n(6,l=ie));const A=_t("selectedDocuments"),V=[0,1,2,3,5];let B="all";function H(ie){B==="filtered"&&E(ie)}function Y(ie){n(1,B=ie),ie==="all"&&r.length!==V.length&&b.set(V)}const Z=ie=>Y(ie),re=ie=>L(ie==="threshold"?null:s??3),fe=ie=>M(ie.detail),te=ie=>L(ie.detail),ce=()=>R(!f);return t.$$set=ie=>{"docSet"in ie&&n(0,g=ie.docSet),"documentSetStore"in ie&&n(29,p=ie.documentSetStore),"clusterStore"in ie&&n(30,_=ie.clusterStore),"$$scope"in ie&&n(31,m=ie.$$scope)},t.$$.update=()=>{t.$$.dirty[0]&8&&n(4,i=s!==null?"topk":"threshold"),t.$$.dirty[0]&6&&B==="all"&&r.length!==V.length&&b.set(V)},[g,B,r,s,i,o,l,a,c,u,d,f,S,I,b,O,x,k,M,P,L,q,R,C,D,A,V,H,Y,p,_,m,h,Z,re,fe,te,ce]}class Ef extends ye{constructor(e){super(),ve(this,e,kf,Sf,pe,{docSet:0,documentSetStore:29,clusterStore:30},null,[-1,-1])}}function xi(t,e){return t==null||e==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function Cf(t,e){return t==null||e==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function So(t){let e,n,i;t.length!==2?(e=xi,n=(l,a)=>xi(t(l),a),i=(l,a)=>t(l)-a):(e=t===xi||t===Cf?t:If,n=t,i=t);function r(l,a,c=0,u=l.length){if(c<u){if(e(a,a)!==0)return u;do{const d=c+u>>>1;n(l[d],a)<0?c=d+1:u=d}while(c<u)}return c}function s(l,a,c=0,u=l.length){if(c<u){if(e(a,a)!==0)return u;do{const d=c+u>>>1;n(l[d],a)<=0?c=d+1:u=d}while(c<u)}return c}function o(l,a,c=0,u=l.length){const d=r(l,a,c,u-1);return d>c&&i(l[d-1],a)>-i(l[d],a)?d-1:d}return{left:r,center:o,right:s}}function If(){return 0}function Mf(t){return t===null?NaN:+t}const xf=So(xi).right;So(Mf).center;const Af=xf,Tf=Math.sqrt(50),Nf=Math.sqrt(10),Of=Math.sqrt(2);function Ai(t,e,n){const i=(e-t)/Math.max(0,n),r=Math.floor(Math.log10(i)),s=i/Math.pow(10,r),o=s>=Tf?10:s>=Nf?5:s>=Of?2:1;let l,a,c;return r<0?(c=Math.pow(10,-r)/o,l=Math.round(t*c),a=Math.round(e*c),l/c<t&&++l,a/c>e&&--a,c=-c):(c=Math.pow(10,r)*o,l=Math.round(t/c),a=Math.round(e/c),l*c<t&&++l,a*c>e&&--a),a<l&&.5<=n&&n<2?Ai(t,e,n*2):[l,a,c]}function Pf(t,e,n){if(e=+e,t=+t,n=+n,!(n>0))return[];if(t===e)return[t];const i=e<t,[r,s,o]=i?Ai(e,t,n):Ai(t,e,n);if(!(s>=r))return[];const l=s-r+1,a=new Array(l);if(i)if(o<0)for(let c=0;c<l;++c)a[c]=(s-c)/-o;else for(let c=0;c<l;++c)a[c]=(s-c)*o;else if(o<0)for(let c=0;c<l;++c)a[c]=(r+c)/-o;else for(let c=0;c<l;++c)a[c]=(r+c)*o;return a}function xr(t,e,n){return e=+e,t=+t,n=+n,Ai(t,e,n)[2]}function Lf(t,e,n){e=+e,t=+t,n=+n;const i=e<t,r=i?xr(e,t,n):xr(t,e,n);return(i?-1:1)*(r<0?1/-r:r)}function Df(t){return t}var Ar=1,Tr=2,Nr=3,Gn=4,ko=1e-6;function Rf(t){return"translate("+t+",0)"}function $f(t){return"translate(0,"+t+")"}function zf(t){return e=>+t(e)}function jf(t,e){return e=Math.max(0,t.bandwidth()-e*2)/2,t.round()&&(e=Math.round(e)),n=>+t(n)+e}function Ff(){return!this.__axis}function Eo(t,e){var n=[],i=null,r=null,s=6,o=6,l=3,a=typeof window<"u"&&window.devicePixelRatio>1?0:.5,c=t===Ar||t===Gn?-1:1,u=t===Gn||t===Tr?"x":"y",d=t===Ar||t===Nr?Rf:$f;function f(h){var m=i??(e.ticks?e.ticks.apply(e,n):e.domain()),g=r??(e.tickFormat?e.tickFormat.apply(e,n):Df),p=Math.max(s,0)+l,_=e.range(),S=+_[0]+a,I=+_[_.length-1]+a,b=(e.bandwidth?jf:zf)(e.copy(),a),E=h.selection?h.selection():h,O=E.selectAll(".domain").data([null]),x=E.selectAll(".tick").data(m,e).order(),k=x.exit(),M=x.enter().append("g").attr("class","tick"),P=x.select("line"),L=x.select("text");O=O.merge(O.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),x=x.merge(M),P=P.merge(M.append("line").attr("stroke","currentColor").attr(u+"2",c*s)),L=L.merge(M.append("text").attr("fill","currentColor").attr(u,c*p).attr("dy",t===Ar?"0em":t===Nr?"0.71em":"0.32em")),h!==E&&(O=O.transition(h),x=x.transition(h),P=P.transition(h),L=L.transition(h),k=k.transition(h).attr("opacity",ko).attr("transform",function(q){return isFinite(q=b(q))?d(q+a):this.getAttribute("transform")}),M.attr("opacity",ko).attr("transform",function(q){var R=this.parentNode.__axis;return d((R&&isFinite(R=R(q))?R:b(q))+a)})),k.remove(),O.attr("d",t===Gn||t===Tr?o?"M"+c*o+","+S+"H"+a+"V"+I+"H"+c*o:"M"+a+","+S+"V"+I:o?"M"+S+","+c*o+"V"+a+"H"+I+"V"+c*o:"M"+S+","+a+"H"+I),x.attr("opacity",1).attr("transform",function(q){return d(b(q)+a)}),P.attr(u+"2",c*s),L.attr(u,c*p).text(g),E.filter(Ff).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",t===Tr?"start":t===Gn?"end":"middle"),E.each(function(){this.__axis=b})}return f.scale=function(h){return arguments.length?(e=h,f):e},f.ticks=function(){return n=Array.from(arguments),f},f.tickArguments=function(h){return arguments.length?(n=h==null?[]:Array.from(h),f):n.slice()},f.tickValues=function(h){return arguments.length?(i=h==null?null:Array.from(h),f):i&&i.slice()},f.tickFormat=function(h){return arguments.length?(r=h,f):r},f.tickSize=function(h){return arguments.length?(s=o=+h,f):s},f.tickSizeInner=function(h){return arguments.length?(s=+h,f):s},f.tickSizeOuter=function(h){return arguments.length?(o=+h,f):o},f.tickPadding=function(h){return arguments.length?(l=+h,f):l},f.offset=function(h){return arguments.length?(a=+h,f):a},f}function Vf(t){return Eo(Nr,t)}function Hf(t){return Eo(Gn,t)}var Uf={value:()=>{}};function Yn(){for(var t=0,e=arguments.length,n={},i;t<e;++t){if(!(i=arguments[t]+"")||i in n||/[\s.]/.test(i))throw new Error("illegal type: "+i);n[i]=[]}return new Ti(n)}function Ti(t){this._=t}function Bf(t,e){return t.trim().split(/^|\s+/).map(function(n){var i="",r=n.indexOf(".");if(r>=0&&(i=n.slice(r+1),n=n.slice(0,r)),n&&!e.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:i}})}Ti.prototype=Yn.prototype={constructor:Ti,on:function(t,e){var n=this._,i=Bf(t+"",n),r,s=-1,o=i.length;if(arguments.length<2){for(;++s<o;)if((r=(t=i[s]).type)&&(r=qf(n[r],t.name)))return r;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++s<o;)if(r=(t=i[s]).type)n[r]=Co(n[r],t.name,e);else if(e==null)for(r in n)n[r]=Co(n[r],t.name,null);return this},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new Ti(t)},call:function(t,e){if((r=arguments.length-2)>0)for(var n=new Array(r),i=0,r,s;i<r;++i)n[i]=arguments[i+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(s=this._[t],i=0,r=s.length;i<r;++i)s[i].value.apply(e,n)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var i=this._[t],r=0,s=i.length;r<s;++r)i[r].value.apply(e,n)}};function qf(t,e){for(var n=0,i=t.length,r;n<i;++n)if((r=t[n]).name===e)return r.value}function Co(t,e,n){for(var i=0,r=t.length;i<r;++i)if(t[i].name===e){t[i]=Uf,t=t.slice(0,i).concat(t.slice(i+1));break}return n!=null&&t.push({name:e,value:n}),t}var Or="http://www.w3.org/1999/xhtml";const Io={svg:"http://www.w3.org/2000/svg",xhtml:Or,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Ni(t){var e=t+="",n=e.indexOf(":");return n>=0&&(e=t.slice(0,n))!=="xmlns"&&(t=t.slice(n+1)),Io.hasOwnProperty(e)?{space:Io[e],local:t}:t}function Kf(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===Or&&e.documentElement.namespaceURI===Or?e.createElement(t):e.createElementNS(n,t)}}function Wf(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function Mo(t){var e=Ni(t);return(e.local?Wf:Kf)(e)}function Gf(){}function Pr(t){return t==null?Gf:function(){return this.querySelector(t)}}function Yf(t){typeof t!="function"&&(t=Pr(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var s=e[r],o=s.length,l=i[r]=new Array(o),a,c,u=0;u<o;++u)(a=s[u])&&(c=t.call(a,a.__data__,u,s))&&("__data__"in a&&(c.__data__=a.__data__),l[u]=c);return new vt(i,this._parents)}function Xf(t){return t==null?[]:Array.isArray(t)?t:Array.from(t)}function Jf(){return[]}function xo(t){return t==null?Jf:function(){return this.querySelectorAll(t)}}function Qf(t){return function(){return Xf(t.apply(this,arguments))}}function Zf(t){typeof t=="function"?t=Qf(t):t=xo(t);for(var e=this._groups,n=e.length,i=[],r=[],s=0;s<n;++s)for(var o=e[s],l=o.length,a,c=0;c<l;++c)(a=o[c])&&(i.push(t.call(a,a.__data__,c,o)),r.push(a));return new vt(i,r)}function Ao(t){return function(){return this.matches(t)}}function To(t){return function(e){return e.matches(t)}}var eh=Array.prototype.find;function th(t){return function(){return eh.call(this.children,t)}}function nh(){return this.firstElementChild}function ih(t){return this.select(t==null?nh:th(typeof t=="function"?t:To(t)))}var rh=Array.prototype.filter;function sh(){return Array.from(this.children)}function oh(t){return function(){return rh.call(this.children,t)}}function lh(t){return this.selectAll(t==null?sh:oh(typeof t=="function"?t:To(t)))}function ah(t){typeof t!="function"&&(t=Ao(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var s=e[r],o=s.length,l=i[r]=[],a,c=0;c<o;++c)(a=s[c])&&t.call(a,a.__data__,c,s)&&l.push(a);return new vt(i,this._parents)}function No(t){return new Array(t.length)}function ch(){return new vt(this._enter||this._groups.map(No),this._parents)}function Oi(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}Oi.prototype={constructor:Oi,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function uh(t){return function(){return t}}function fh(t,e,n,i,r,s){for(var o=0,l,a=e.length,c=s.length;o<c;++o)(l=e[o])?(l.__data__=s[o],i[o]=l):n[o]=new Oi(t,s[o]);for(;o<a;++o)(l=e[o])&&(r[o]=l)}function hh(t,e,n,i,r,s,o){var l,a,c=new Map,u=e.length,d=s.length,f=new Array(u),h;for(l=0;l<u;++l)(a=e[l])&&(f[l]=h=o.call(a,a.__data__,l,e)+"",c.has(h)?r[l]=a:c.set(h,a));for(l=0;l<d;++l)h=o.call(t,s[l],l,s)+"",(a=c.get(h))?(i[l]=a,a.__data__=s[l],c.delete(h)):n[l]=new Oi(t,s[l]);for(l=0;l<u;++l)(a=e[l])&&c.get(f[l])===a&&(r[l]=a)}function dh(t){return t.__data__}function mh(t,e){if(!arguments.length)return Array.from(this,dh);var n=e?hh:fh,i=this._parents,r=this._groups;typeof t!="function"&&(t=uh(t));for(var s=r.length,o=new Array(s),l=new Array(s),a=new Array(s),c=0;c<s;++c){var u=i[c],d=r[c],f=d.length,h=ph(t.call(u,u&&u.__data__,c,i)),m=h.length,g=l[c]=new Array(m),p=o[c]=new Array(m),_=a[c]=new Array(f);n(u,d,g,p,_,h,e);for(var S=0,I=0,b,E;S<m;++S)if(b=g[S]){for(S>=I&&(I=S+1);!(E=p[I])&&++I<m;);b._next=E||null}}return o=new vt(o,i),o._enter=l,o._exit=a,o}function ph(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function gh(){return new vt(this._exit||this._groups.map(No),this._parents)}function _h(t,e,n){var i=this.enter(),r=this,s=this.exit();return typeof t=="function"?(i=t(i),i&&(i=i.selection())):i=i.append(t+""),e!=null&&(r=e(r),r&&(r=r.selection())),n==null?s.remove():n(s),i&&r?i.merge(r).order():r}function vh(t){for(var e=t.selection?t.selection():t,n=this._groups,i=e._groups,r=n.length,s=i.length,o=Math.min(r,s),l=new Array(r),a=0;a<o;++a)for(var c=n[a],u=i[a],d=c.length,f=l[a]=new Array(d),h,m=0;m<d;++m)(h=c[m]||u[m])&&(f[m]=h);for(;a<r;++a)l[a]=n[a];return new vt(l,this._parents)}function yh(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var i=t[e],r=i.length-1,s=i[r],o;--r>=0;)(o=i[r])&&(s&&o.compareDocumentPosition(s)^4&&s.parentNode.insertBefore(o,s),s=o);return this}function bh(t){t||(t=wh);function e(d,f){return d&&f?t(d.__data__,f.__data__):!d-!f}for(var n=this._groups,i=n.length,r=new Array(i),s=0;s<i;++s){for(var o=n[s],l=o.length,a=r[s]=new Array(l),c,u=0;u<l;++u)(c=o[u])&&(a[u]=c);a.sort(e)}return new vt(r,this._parents).order()}function wh(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function Sh(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function kh(){return Array.from(this)}function Eh(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var i=t[e],r=0,s=i.length;r<s;++r){var o=i[r];if(o)return o}return null}function Ch(){let t=0;for(const e of this)++t;return t}function Ih(){return!this.node()}function Mh(t){for(var e=this._groups,n=0,i=e.length;n<i;++n)for(var r=e[n],s=0,o=r.length,l;s<o;++s)(l=r[s])&&t.call(l,l.__data__,s,r);return this}function xh(t){return function(){this.removeAttribute(t)}}function Ah(t){return function(){this.removeAttributeNS(t.space,t.local)}}function Th(t,e){return function(){this.setAttribute(t,e)}}function Nh(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function Oh(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttribute(t):this.setAttribute(t,n)}}function Ph(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function Lh(t,e){var n=Ni(t);if(arguments.length<2){var i=this.node();return n.local?i.getAttributeNS(n.space,n.local):i.getAttribute(n)}return this.each((e==null?n.local?Ah:xh:typeof e=="function"?n.local?Ph:Oh:n.local?Nh:Th)(n,e))}function Oo(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function Dh(t){return function(){this.style.removeProperty(t)}}function Rh(t,e,n){return function(){this.style.setProperty(t,e,n)}}function $h(t,e,n){return function(){var i=e.apply(this,arguments);i==null?this.style.removeProperty(t):this.style.setProperty(t,i,n)}}function zh(t,e,n){return arguments.length>1?this.each((e==null?Dh:typeof e=="function"?$h:Rh)(t,e,n??"")):An(this.node(),t)}function An(t,e){return t.style.getPropertyValue(e)||Oo(t).getComputedStyle(t,null).getPropertyValue(e)}function jh(t){return function(){delete this[t]}}function Fh(t,e){return function(){this[t]=e}}function Vh(t,e){return function(){var n=e.apply(this,arguments);n==null?delete this[t]:this[t]=n}}function Hh(t,e){return arguments.length>1?this.each((e==null?jh:typeof e=="function"?Vh:Fh)(t,e)):this.node()[t]}function Po(t){return t.trim().split(/^|\s+/)}function Lr(t){return t.classList||new Lo(t)}function Lo(t){this._node=t,this._names=Po(t.getAttribute("class")||"")}Lo.prototype={add:function(t){var e=this._names.indexOf(t);e<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function Do(t,e){for(var n=Lr(t),i=-1,r=e.length;++i<r;)n.add(e[i])}function Ro(t,e){for(var n=Lr(t),i=-1,r=e.length;++i<r;)n.remove(e[i])}function Uh(t){return function(){Do(this,t)}}function Bh(t){return function(){Ro(this,t)}}function qh(t,e){return function(){(e.apply(this,arguments)?Do:Ro)(this,t)}}function Kh(t,e){var n=Po(t+"");if(arguments.length<2){for(var i=Lr(this.node()),r=-1,s=n.length;++r<s;)if(!i.contains(n[r]))return!1;return!0}return this.each((typeof e=="function"?qh:e?Uh:Bh)(n,e))}function Wh(){this.textContent=""}function Gh(t){return function(){this.textContent=t}}function Yh(t){return function(){var e=t.apply(this,arguments);this.textContent=e??""}}function Xh(t){return arguments.length?this.each(t==null?Wh:(typeof t=="function"?Yh:Gh)(t)):this.node().textContent}function Jh(){this.innerHTML=""}function Qh(t){return function(){this.innerHTML=t}}function Zh(t){return function(){var e=t.apply(this,arguments);this.innerHTML=e??""}}function ed(t){return arguments.length?this.each(t==null?Jh:(typeof t=="function"?Zh:Qh)(t)):this.node().innerHTML}function td(){this.nextSibling&&this.parentNode.appendChild(this)}function nd(){return this.each(td)}function id(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function rd(){return this.each(id)}function sd(t){var e=typeof t=="function"?t:Mo(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function od(){return null}function ld(t,e){var n=typeof t=="function"?t:Mo(t),i=e==null?od:typeof e=="function"?e:Pr(e);return this.select(function(){return this.insertBefore(n.apply(this,arguments),i.apply(this,arguments)||null)})}function ad(){var t=this.parentNode;t&&t.removeChild(this)}function cd(){return this.each(ad)}function ud(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function fd(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function hd(t){return this.select(t?fd:ud)}function dd(t){return arguments.length?this.property("__data__",t):this.node().__data__}function md(t){return function(e){t.call(this,e,this.__data__)}}function pd(t){return t.trim().split(/^|\s+/).map(function(e){var n="",i=e.indexOf(".");return i>=0&&(n=e.slice(i+1),e=e.slice(0,i)),{type:e,name:n}})}function gd(t){return function(){var e=this.__on;if(e){for(var n=0,i=-1,r=e.length,s;n<r;++n)s=e[n],(!t.type||s.type===t.type)&&s.name===t.name?this.removeEventListener(s.type,s.listener,s.options):e[++i]=s;++i?e.length=i:delete this.__on}}}function _d(t,e,n){return function(){var i=this.__on,r,s=md(e);if(i){for(var o=0,l=i.length;o<l;++o)if((r=i[o]).type===t.type&&r.name===t.name){this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=s,r.options=n),r.value=e;return}}this.addEventListener(t.type,s,n),r={type:t.type,name:t.name,value:e,listener:s,options:n},i?i.push(r):this.__on=[r]}}function vd(t,e,n){var i=pd(t+""),r,s=i.length,o;if(arguments.length<2){var l=this.node().__on;if(l){for(var a=0,c=l.length,u;a<c;++a)for(r=0,u=l[a];r<s;++r)if((o=i[r]).type===u.type&&o.name===u.name)return u.value}return}for(l=e?_d:gd,r=0;r<s;++r)this.each(l(i[r],e,n));return this}function $o(t,e,n){var i=Oo(t),r=i.CustomEvent;typeof r=="function"?r=new r(e,n):(r=i.document.createEvent("Event"),n?(r.initEvent(e,n.bubbles,n.cancelable),r.detail=n.detail):r.initEvent(e,!1,!1)),t.dispatchEvent(r)}function yd(t,e){return function(){return $o(this,t,e)}}function bd(t,e){return function(){return $o(this,t,e.apply(this,arguments))}}function wd(t,e){return this.each((typeof e=="function"?bd:yd)(t,e))}function*Sd(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var i=t[e],r=0,s=i.length,o;r<s;++r)(o=i[r])&&(yield o)}var zo=[null];function vt(t,e){this._groups=t,this._parents=e}function Xn(){return new vt([[document.documentElement]],zo)}function kd(){return this}vt.prototype=Xn.prototype={constructor:vt,select:Yf,selectAll:Zf,selectChild:ih,selectChildren:lh,filter:ah,data:mh,enter:ch,exit:gh,join:_h,merge:vh,selection:kd,order:yh,sort:bh,call:Sh,nodes:kh,node:Eh,size:Ch,empty:Ih,each:Mh,attr:Lh,style:zh,property:Hh,classed:Kh,text:Xh,html:ed,raise:nd,lower:rd,append:sd,insert:ld,remove:cd,clone:hd,datum:dd,on:vd,dispatch:wd,[Symbol.iterator]:Sd};function Je(t){return typeof t=="string"?new vt([[document.querySelector(t)]],[document.documentElement]):new vt([[t]],zo)}function Ed(t){let e;for(;e=t.sourceEvent;)t=e;return t}function nt(t,e){if(t=Ed(t),e===void 0&&(e=t.currentTarget),e){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var i=n.createSVGPoint();return i.x=t.clientX,i.y=t.clientY,i=i.matrixTransform(e.getScreenCTM().inverse()),[i.x,i.y]}if(e.getBoundingClientRect){var r=e.getBoundingClientRect();return[t.clientX-r.left-e.clientLeft,t.clientY-r.top-e.clientTop]}}return[t.pageX,t.pageY]}const Cd={passive:!1},Jn={capture:!0,passive:!1};function Dr(t){t.stopImmediatePropagation()}function Tn(t){t.preventDefault(),t.stopImmediatePropagation()}function jo(t){var e=t.document.documentElement,n=Je(t).on("dragstart.drag",Tn,Jn);"onselectstart"in e?n.on("selectstart.drag",Tn,Jn):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function Fo(t,e){var n=t.document.documentElement,i=Je(t).on("dragstart.drag",null);e&&(i.on("click.drag",Tn,Jn),setTimeout(function(){i.on("click.drag",null)},0)),"onselectstart"in n?i.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}const Pi=t=>()=>t;function Rr(t,{sourceEvent:e,subject:n,target:i,identifier:r,active:s,x:o,y:l,dx:a,dy:c,dispatch:u}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},subject:{value:n,enumerable:!0,configurable:!0},target:{value:i,enumerable:!0,configurable:!0},identifier:{value:r,enumerable:!0,configurable:!0},active:{value:s,enumerable:!0,configurable:!0},x:{value:o,enumerable:!0,configurable:!0},y:{value:l,enumerable:!0,configurable:!0},dx:{value:a,enumerable:!0,configurable:!0},dy:{value:c,enumerable:!0,configurable:!0},_:{value:u}})}Rr.prototype.on=function(){var t=this._.on.apply(this._,arguments);return t===this._?this:t};function Id(t){return!t.ctrlKey&&!t.button}function Md(){return this.parentNode}function xd(t,e){return e??{x:t.x,y:t.y}}function Ad(){return navigator.maxTouchPoints||"ontouchstart"in this}function Td(){var t=Id,e=Md,n=xd,i=Ad,r={},s=Yn("start","drag","end"),o=0,l,a,c,u,d=0;function f(b){b.on("mousedown.drag",h).filter(i).on("touchstart.drag",p).on("touchmove.drag",_,Cd).on("touchend.drag touchcancel.drag",S).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function h(b,E){if(!(u||!t.call(this,b,E))){var O=I(this,e.call(this,b,E),b,E,"mouse");O&&(Je(b.view).on("mousemove.drag",m,Jn).on("mouseup.drag",g,Jn),jo(b.view),Dr(b),c=!1,l=b.clientX,a=b.clientY,O("start",b))}}function m(b){if(Tn(b),!c){var E=b.clientX-l,O=b.clientY-a;c=E*E+O*O>d}r.mouse("drag",b)}function g(b){Je(b.view).on("mousemove.drag mouseup.drag",null),Fo(b.view,c),Tn(b),r.mouse("end",b)}function p(b,E){if(t.call(this,b,E)){var O=b.changedTouches,x=e.call(this,b,E),k=O.length,M,P;for(M=0;M<k;++M)(P=I(this,x,b,E,O[M].identifier,O[M]))&&(Dr(b),P("start",b,O[M]))}}function _(b){var E=b.changedTouches,O=E.length,x,k;for(x=0;x<O;++x)(k=r[E[x].identifier])&&(Tn(b),k("drag",b,E[x]))}function S(b){var E=b.changedTouches,O=E.length,x,k;for(u&&clearTimeout(u),u=setTimeout(function(){u=null},500),x=0;x<O;++x)(k=r[E[x].identifier])&&(Dr(b),k("end",b,E[x]))}function I(b,E,O,x,k,M){var P=s.copy(),L=nt(M||O,E),q,R,C;if((C=n.call(b,new Rr("beforestart",{sourceEvent:O,target:f,identifier:k,active:o,x:L[0],y:L[1],dx:0,dy:0,dispatch:P}),x))!=null)return q=C.x-L[0]||0,R=C.y-L[1]||0,function D(A,V,B){var H=L,Y;switch(A){case"start":r[k]=D,Y=o++;break;case"end":delete r[k],--o;case"drag":L=nt(B||V,E),Y=o;break}P.call(A,b,new Rr(A,{sourceEvent:V,subject:C,target:f,identifier:k,active:Y,x:L[0]+q,y:L[1]+R,dx:L[0]-H[0],dy:L[1]-H[1],dispatch:P}),x)}}return f.filter=function(b){return arguments.length?(t=typeof b=="function"?b:Pi(!!b),f):t},f.container=function(b){return arguments.length?(e=typeof b=="function"?b:Pi(b),f):e},f.subject=function(b){return arguments.length?(n=typeof b=="function"?b:Pi(b),f):n},f.touchable=function(b){return arguments.length?(i=typeof b=="function"?b:Pi(!!b),f):i},f.on=function(){var b=s.on.apply(s,arguments);return b===s?f:b},f.clickDistance=function(b){return arguments.length?(d=(b=+b)*b,f):Math.sqrt(d)},f}function $r(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function Vo(t,e){var n=Object.create(t.prototype);for(var i in e)n[i]=e[i];return n}function Qn(){}var Zn=.7,Li=1/Zn,Nn="\\s*([+-]?\\d+)\\s*",ei="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",$t="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Nd=/^#([0-9a-f]{3,8})$/,Od=new RegExp(`^rgb\\(${Nn},${Nn},${Nn}\\)$`),Pd=new RegExp(`^rgb\\(${$t},${$t},${$t}\\)$`),Ld=new RegExp(`^rgba\\(${Nn},${Nn},${Nn},${ei}\\)$`),Dd=new RegExp(`^rgba\\(${$t},${$t},${$t},${ei}\\)$`),Rd=new RegExp(`^hsl\\(${ei},${$t},${$t}\\)$`),$d=new RegExp(`^hsla\\(${ei},${$t},${$t},${ei}\\)$`),Ho={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};$r(Qn,fn,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:Uo,formatHex:Uo,formatHex8:zd,formatHsl:jd,formatRgb:Bo,toString:Bo});function Uo(){return this.rgb().formatHex()}function zd(){return this.rgb().formatHex8()}function jd(){return Yo(this).formatHsl()}function Bo(){return this.rgb().formatRgb()}function fn(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=Nd.exec(t))?(n=e[1].length,e=parseInt(e[1],16),n===6?qo(e):n===3?new ft(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):n===8?Di(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):n===4?Di(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=Od.exec(t))?new ft(e[1],e[2],e[3],1):(e=Pd.exec(t))?new ft(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=Ld.exec(t))?Di(e[1],e[2],e[3],e[4]):(e=Dd.exec(t))?Di(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=Rd.exec(t))?Go(e[1],e[2]/100,e[3]/100,1):(e=$d.exec(t))?Go(e[1],e[2]/100,e[3]/100,e[4]):Ho.hasOwnProperty(t)?qo(Ho[t]):t==="transparent"?new ft(NaN,NaN,NaN,0):null}function qo(t){return new ft(t>>16&255,t>>8&255,t&255,1)}function Di(t,e,n,i){return i<=0&&(t=e=n=NaN),new ft(t,e,n,i)}function Fd(t){return t instanceof Qn||(t=fn(t)),t?(t=t.rgb(),new ft(t.r,t.g,t.b,t.opacity)):new ft}function zr(t,e,n,i){return arguments.length===1?Fd(t):new ft(t,e,n,i??1)}function ft(t,e,n,i){this.r=+t,this.g=+e,this.b=+n,this.opacity=+i}$r(ft,zr,Vo(Qn,{brighter(t){return t=t==null?Li:Math.pow(Li,t),new ft(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?Zn:Math.pow(Zn,t),new ft(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new ft(hn(this.r),hn(this.g),hn(this.b),Ri(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Ko,formatHex:Ko,formatHex8:Vd,formatRgb:Wo,toString:Wo}));function Ko(){return`#${dn(this.r)}${dn(this.g)}${dn(this.b)}`}function Vd(){return`#${dn(this.r)}${dn(this.g)}${dn(this.b)}${dn((isNaN(this.opacity)?1:this.opacity)*255)}`}function Wo(){const t=Ri(this.opacity);return`${t===1?"rgb(":"rgba("}${hn(this.r)}, ${hn(this.g)}, ${hn(this.b)}${t===1?")":`, ${t})`}`}function Ri(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function hn(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function dn(t){return t=hn(t),(t<16?"0":"")+t.toString(16)}function Go(t,e,n,i){return i<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new Nt(t,e,n,i)}function Yo(t){if(t instanceof Nt)return new Nt(t.h,t.s,t.l,t.opacity);if(t instanceof Qn||(t=fn(t)),!t)return new Nt;if(t instanceof Nt)return t;t=t.rgb();var e=t.r/255,n=t.g/255,i=t.b/255,r=Math.min(e,n,i),s=Math.max(e,n,i),o=NaN,l=s-r,a=(s+r)/2;return l?(e===s?o=(n-i)/l+(n<i)*6:n===s?o=(i-e)/l+2:o=(e-n)/l+4,l/=a<.5?s+r:2-s-r,o*=60):l=a>0&&a<1?0:o,new Nt(o,l,a,t.opacity)}function jr(t,e,n,i){return arguments.length===1?Yo(t):new Nt(t,e,n,i??1)}function Nt(t,e,n,i){this.h=+t,this.s=+e,this.l=+n,this.opacity=+i}$r(Nt,jr,Vo(Qn,{brighter(t){return t=t==null?Li:Math.pow(Li,t),new Nt(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?Zn:Math.pow(Zn,t),new Nt(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,i=n+(n<.5?n:1-n)*e,r=2*n-i;return new ft(Fr(t>=240?t-240:t+120,r,i),Fr(t,r,i),Fr(t<120?t+240:t-120,r,i),this.opacity)},clamp(){return new Nt(Xo(this.h),$i(this.s),$i(this.l),Ri(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=Ri(this.opacity);return`${t===1?"hsl(":"hsla("}${Xo(this.h)}, ${$i(this.s)*100}%, ${$i(this.l)*100}%${t===1?")":`, ${t})`}`}}));function Xo(t){return t=(t||0)%360,t<0?t+360:t}function $i(t){return Math.max(0,Math.min(1,t||0))}function Fr(t,e,n){return(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)*255}const Vr=t=>()=>t;function Hd(t,e){return function(n){return t+n*e}}function Ud(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(i){return Math.pow(t+i*e,n)}}function Bd(t){return(t=+t)==1?Jo:function(e,n){return n-e?Ud(e,n,t):Vr(isNaN(e)?n:e)}}function Jo(t,e){var n=e-t;return n?Hd(t,n):Vr(isNaN(t)?e:t)}const zi=function t(e){var n=Bd(e);function i(r,s){var o=n((r=zr(r)).r,(s=zr(s)).r),l=n(r.g,s.g),a=n(r.b,s.b),c=Jo(r.opacity,s.opacity);return function(u){return r.r=o(u),r.g=l(u),r.b=a(u),r.opacity=c(u),r+""}}return i.gamma=t,i}(1);function qd(t,e){e||(e=[]);var n=t?Math.min(e.length,t.length):0,i=e.slice(),r;return function(s){for(r=0;r<n;++r)i[r]=t[r]*(1-s)+e[r]*s;return i}}function Kd(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function Wd(t,e){var n=e?e.length:0,i=t?Math.min(n,t.length):0,r=new Array(i),s=new Array(n),o;for(o=0;o<i;++o)r[o]=Br(t[o],e[o]);for(;o<n;++o)s[o]=e[o];return function(l){for(o=0;o<i;++o)s[o]=r[o](l);return s}}function Gd(t,e){var n=new Date;return t=+t,e=+e,function(i){return n.setTime(t*(1-i)+e*i),n}}function Ot(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}function Yd(t,e){var n={},i={},r;(t===null||typeof t!="object")&&(t={}),(e===null||typeof e!="object")&&(e={});for(r in e)r in t?n[r]=Br(t[r],e[r]):i[r]=e[r];return function(s){for(r in n)i[r]=n[r](s);return i}}var Hr=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Ur=new RegExp(Hr.source,"g");function Xd(t){return function(){return t}}function Jd(t){return function(e){return t(e)+""}}function Qo(t,e){var n=Hr.lastIndex=Ur.lastIndex=0,i,r,s,o=-1,l=[],a=[];for(t=t+"",e=e+"";(i=Hr.exec(t))&&(r=Ur.exec(e));)(s=r.index)>n&&(s=e.slice(n,s),l[o]?l[o]+=s:l[++o]=s),(i=i[0])===(r=r[0])?l[o]?l[o]+=r:l[++o]=r:(l[++o]=null,a.push({i:o,x:Ot(i,r)})),n=Ur.lastIndex;return n<e.length&&(s=e.slice(n),l[o]?l[o]+=s:l[++o]=s),l.length<2?a[0]?Jd(a[0].x):Xd(e):(e=a.length,function(c){for(var u=0,d;u<e;++u)l[(d=a[u]).i]=d.x(c);return l.join("")})}function Br(t,e){var n=typeof e,i;return e==null||n==="boolean"?Vr(e):(n==="number"?Ot:n==="string"?(i=fn(e))?(e=i,zi):Qo:e instanceof fn?zi:e instanceof Date?Gd:Kd(e)?qd:Array.isArray(e)?Wd:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?Yd:Ot)(t,e)}function Qd(t,e){return t=+t,e=+e,function(n){return Math.round(t*(1-n)+e*n)}}var Zo=180/Math.PI,qr={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function el(t,e,n,i,r,s){var o,l,a;return(o=Math.sqrt(t*t+e*e))&&(t/=o,e/=o),(a=t*n+e*i)&&(n-=t*a,i-=e*a),(l=Math.sqrt(n*n+i*i))&&(n/=l,i/=l,a/=l),t*i<e*n&&(t=-t,e=-e,a=-a,o=-o),{translateX:r,translateY:s,rotate:Math.atan2(e,t)*Zo,skewX:Math.atan(a)*Zo,scaleX:o,scaleY:l}}var ji;function Zd(t){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?qr:el(e.a,e.b,e.c,e.d,e.e,e.f)}function em(t){return t==null||(ji||(ji=document.createElementNS("http://www.w3.org/2000/svg","g")),ji.setAttribute("transform",t),!(t=ji.transform.baseVal.consolidate()))?qr:(t=t.matrix,el(t.a,t.b,t.c,t.d,t.e,t.f))}function tl(t,e,n,i){function r(c){return c.length?c.pop()+" ":""}function s(c,u,d,f,h,m){if(c!==d||u!==f){var g=h.push("translate(",null,e,null,n);m.push({i:g-4,x:Ot(c,d)},{i:g-2,x:Ot(u,f)})}else(d||f)&&h.push("translate("+d+e+f+n)}function o(c,u,d,f){c!==u?(c-u>180?u+=360:u-c>180&&(c+=360),f.push({i:d.push(r(d)+"rotate(",null,i)-2,x:Ot(c,u)})):u&&d.push(r(d)+"rotate("+u+i)}function l(c,u,d,f){c!==u?f.push({i:d.push(r(d)+"skewX(",null,i)-2,x:Ot(c,u)}):u&&d.push(r(d)+"skewX("+u+i)}function a(c,u,d,f,h,m){if(c!==d||u!==f){var g=h.push(r(h)+"scale(",null,",",null,")");m.push({i:g-4,x:Ot(c,d)},{i:g-2,x:Ot(u,f)})}else(d!==1||f!==1)&&h.push(r(h)+"scale("+d+","+f+")")}return function(c,u){var d=[],f=[];return c=t(c),u=t(u),s(c.translateX,c.translateY,u.translateX,u.translateY,d,f),o(c.rotate,u.rotate,d,f),l(c.skewX,u.skewX,d,f),a(c.scaleX,c.scaleY,u.scaleX,u.scaleY,d,f),c=u=null,function(h){for(var m=-1,g=f.length,p;++m<g;)d[(p=f[m]).i]=p.x(h);return d.join("")}}}var tm=tl(Zd,"px, ","px)","deg)"),nm=tl(em,", ",")",")"),im=1e-12;function nl(t){return((t=Math.exp(t))+1/t)/2}function rm(t){return((t=Math.exp(t))-1/t)/2}function sm(t){return((t=Math.exp(2*t))-1)/(t+1)}const om=function t(e,n,i){function r(s,o){var l=s[0],a=s[1],c=s[2],u=o[0],d=o[1],f=o[2],h=u-l,m=d-a,g=h*h+m*m,p,_;if(g<im)_=Math.log(f/c)/e,p=function(x){return[l+x*h,a+x*m,c*Math.exp(e*x*_)]};else{var S=Math.sqrt(g),I=(f*f-c*c+i*g)/(2*c*n*S),b=(f*f-c*c-i*g)/(2*f*n*S),E=Math.log(Math.sqrt(I*I+1)-I),O=Math.log(Math.sqrt(b*b+1)-b);_=(O-E)/e,p=function(x){var k=x*_,M=nl(E),P=c/(n*S)*(M*sm(e*k+E)-rm(E));return[l+P*h,a+P*m,c*M/nl(e*k+E)]}}return p.duration=_*1e3*e/Math.SQRT2,p}return r.rho=function(s){var o=Math.max(.001,+s),l=o*o,a=l*l;return t(o,l,a)},r}(Math.SQRT2,2,4);var On=0,ti=0,ni=0,il=1e3,Fi,ii,Vi=0,mn=0,Hi=0,ri=typeof performance=="object"&&performance.now?performance:Date,rl=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function Kr(){return mn||(rl(lm),mn=ri.now()+Hi)}function lm(){mn=0}function Ui(){this._call=this._time=this._next=null}Ui.prototype=Wr.prototype={constructor:Ui,restart:function(t,e,n){if(typeof t!="function")throw new TypeError("callback is not a function");n=(n==null?Kr():+n)+(e==null?0:+e),!this._next&&ii!==this&&(ii?ii._next=this:Fi=this,ii=this),this._call=t,this._time=n,Gr()},stop:function(){this._call&&(this._call=null,this._time=1/0,Gr())}};function Wr(t,e,n){var i=new Ui;return i.restart(t,e,n),i}function am(){Kr(),++On;for(var t=Fi,e;t;)(e=mn-t._time)>=0&&t._call.call(void 0,e),t=t._next;--On}function sl(){mn=(Vi=ri.now())+Hi,On=ti=0;try{am()}finally{On=0,um(),mn=0}}function cm(){var t=ri.now(),e=t-Vi;e>il&&(Hi-=e,Vi=t)}function um(){for(var t,e=Fi,n,i=1/0;e;)e._call?(i>e._time&&(i=e._time),t=e,e=e._next):(n=e._next,e._next=null,e=t?t._next=n:Fi=n);ii=t,Gr(i)}function Gr(t){if(!On){ti&&(ti=clearTimeout(ti));var e=t-mn;e>24?(t<1/0&&(ti=setTimeout(sl,t-ri.now()-Hi)),ni&&(ni=clearInterval(ni))):(ni||(Vi=ri.now(),ni=setInterval(cm,il)),On=1,rl(sl))}}function ol(t,e,n){var i=new Ui;return e=e==null?0:+e,i.restart(r=>{i.stop(),t(r+e)},e,n),i}var fm=Yn("start","end","cancel","interrupt"),hm=[],ll=0,al=1,Yr=2,Bi=3,cl=4,Xr=5,qi=6;function Ki(t,e,n,i,r,s){var o=t.__transition;if(!o)t.__transition={};else if(n in o)return;dm(t,n,{name:e,index:i,group:r,on:fm,tween:hm,time:s.time,delay:s.delay,duration:s.duration,ease:s.ease,timer:null,state:ll})}function Jr(t,e){var n=Pt(t,e);if(n.state>ll)throw new Error("too late; already scheduled");return n}function zt(t,e){var n=Pt(t,e);if(n.state>Bi)throw new Error("too late; already running");return n}function Pt(t,e){var n=t.__transition;if(!n||!(n=n[e]))throw new Error("transition not found");return n}function dm(t,e,n){var i=t.__transition,r;i[e]=n,n.timer=Wr(s,0,n.time);function s(c){n.state=al,n.timer.restart(o,n.delay,n.time),n.delay<=c&&o(c-n.delay)}function o(c){var u,d,f,h;if(n.state!==al)return a();for(u in i)if(h=i[u],h.name===n.name){if(h.state===Bi)return ol(o);h.state===cl?(h.state=qi,h.timer.stop(),h.on.call("interrupt",t,t.__data__,h.index,h.group),delete i[u]):+u<e&&(h.state=qi,h.timer.stop(),h.on.call("cancel",t,t.__data__,h.index,h.group),delete i[u])}if(ol(function(){n.state===Bi&&(n.state=cl,n.timer.restart(l,n.delay,n.time),l(c))}),n.state=Yr,n.on.call("start",t,t.__data__,n.index,n.group),n.state===Yr){for(n.state=Bi,r=new Array(f=n.tween.length),u=0,d=-1;u<f;++u)(h=n.tween[u].value.call(t,t.__data__,n.index,n.group))&&(r[++d]=h);r.length=d+1}}function l(c){for(var u=c<n.duration?n.ease.call(null,c/n.duration):(n.timer.restart(a),n.state=Xr,1),d=-1,f=r.length;++d<f;)r[d].call(t,u);n.state===Xr&&(n.on.call("end",t,t.__data__,n.index,n.group),a())}function a(){n.state=qi,n.timer.stop(),delete i[e];for(var c in i)return;delete t.__transition}}function Wi(t,e){var n=t.__transition,i,r,s=!0,o;if(n){e=e==null?null:e+"";for(o in n){if((i=n[o]).name!==e){s=!1;continue}r=i.state>Yr&&i.state<Xr,i.state=qi,i.timer.stop(),i.on.call(r?"interrupt":"cancel",t,t.__data__,i.index,i.group),delete n[o]}s&&delete t.__transition}}function mm(t){return this.each(function(){Wi(this,t)})}function pm(t,e){var n,i;return function(){var r=zt(this,t),s=r.tween;if(s!==n){i=n=s;for(var o=0,l=i.length;o<l;++o)if(i[o].name===e){i=i.slice(),i.splice(o,1);break}}r.tween=i}}function gm(t,e,n){var i,r;if(typeof n!="function")throw new Error;return function(){var s=zt(this,t),o=s.tween;if(o!==i){r=(i=o).slice();for(var l={name:e,value:n},a=0,c=r.length;a<c;++a)if(r[a].name===e){r[a]=l;break}a===c&&r.push(l)}s.tween=r}}function _m(t,e){var n=this._id;if(t+="",arguments.length<2){for(var i=Pt(this.node(),n).tween,r=0,s=i.length,o;r<s;++r)if((o=i[r]).name===t)return o.value;return null}return this.each((e==null?pm:gm)(n,t,e))}function Qr(t,e,n){var i=t._id;return t.each(function(){var r=zt(this,i);(r.value||(r.value={}))[e]=n.apply(this,arguments)}),function(r){return Pt(r,i).value[e]}}function ul(t,e){var n;return(typeof e=="number"?Ot:e instanceof fn?zi:(n=fn(e))?(e=n,zi):Qo)(t,e)}function vm(t){return function(){this.removeAttribute(t)}}function ym(t){return function(){this.removeAttributeNS(t.space,t.local)}}function bm(t,e,n){var i,r=n+"",s;return function(){var o=this.getAttribute(t);return o===r?null:o===i?s:s=e(i=o,n)}}function wm(t,e,n){var i,r=n+"",s;return function(){var o=this.getAttributeNS(t.space,t.local);return o===r?null:o===i?s:s=e(i=o,n)}}function Sm(t,e,n){var i,r,s;return function(){var o,l=n(this),a;return l==null?void this.removeAttribute(t):(o=this.getAttribute(t),a=l+"",o===a?null:o===i&&a===r?s:(r=a,s=e(i=o,l)))}}function km(t,e,n){var i,r,s;return function(){var o,l=n(this),a;return l==null?void this.removeAttributeNS(t.space,t.local):(o=this.getAttributeNS(t.space,t.local),a=l+"",o===a?null:o===i&&a===r?s:(r=a,s=e(i=o,l)))}}function Em(t,e){var n=Ni(t),i=n==="transform"?nm:ul;return this.attrTween(t,typeof e=="function"?(n.local?km:Sm)(n,i,Qr(this,"attr."+t,e)):e==null?(n.local?ym:vm)(n):(n.local?wm:bm)(n,i,e))}function Cm(t,e){return function(n){this.setAttribute(t,e.call(this,n))}}function Im(t,e){return function(n){this.setAttributeNS(t.space,t.local,e.call(this,n))}}function Mm(t,e){var n,i;function r(){var s=e.apply(this,arguments);return s!==i&&(n=(i=s)&&Im(t,s)),n}return r._value=e,r}function xm(t,e){var n,i;function r(){var s=e.apply(this,arguments);return s!==i&&(n=(i=s)&&Cm(t,s)),n}return r._value=e,r}function Am(t,e){var n="attr."+t;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(e==null)return this.tween(n,null);if(typeof e!="function")throw new Error;var i=Ni(t);return this.tween(n,(i.local?Mm:xm)(i,e))}function Tm(t,e){return function(){Jr(this,t).delay=+e.apply(this,arguments)}}function Nm(t,e){return e=+e,function(){Jr(this,t).delay=e}}function Om(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?Tm:Nm)(e,t)):Pt(this.node(),e).delay}function Pm(t,e){return function(){zt(this,t).duration=+e.apply(this,arguments)}}function Lm(t,e){return e=+e,function(){zt(this,t).duration=e}}function Dm(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?Pm:Lm)(e,t)):Pt(this.node(),e).duration}function Rm(t,e){if(typeof e!="function")throw new Error;return function(){zt(this,t).ease=e}}function $m(t){var e=this._id;return arguments.length?this.each(Rm(e,t)):Pt(this.node(),e).ease}function zm(t,e){return function(){var n=e.apply(this,arguments);if(typeof n!="function")throw new Error;zt(this,t).ease=n}}function jm(t){if(typeof t!="function")throw new Error;return this.each(zm(this._id,t))}function Fm(t){typeof t!="function"&&(t=Ao(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var s=e[r],o=s.length,l=i[r]=[],a,c=0;c<o;++c)(a=s[c])&&t.call(a,a.__data__,c,s)&&l.push(a);return new Wt(i,this._parents,this._name,this._id)}function Vm(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,n=t._groups,i=e.length,r=n.length,s=Math.min(i,r),o=new Array(i),l=0;l<s;++l)for(var a=e[l],c=n[l],u=a.length,d=o[l]=new Array(u),f,h=0;h<u;++h)(f=a[h]||c[h])&&(d[h]=f);for(;l<i;++l)o[l]=e[l];return new Wt(o,this._parents,this._name,this._id)}function Hm(t){return(t+"").trim().split(/^|\s+/).every(function(e){var n=e.indexOf(".");return n>=0&&(e=e.slice(0,n)),!e||e==="start"})}function Um(t,e,n){var i,r,s=Hm(e)?Jr:zt;return function(){var o=s(this,t),l=o.on;l!==i&&(r=(i=l).copy()).on(e,n),o.on=r}}function Bm(t,e){var n=this._id;return arguments.length<2?Pt(this.node(),n).on.on(t):this.each(Um(n,t,e))}function qm(t){return function(){var e=this.parentNode;for(var n in this.__transition)if(+n!==t)return;e&&e.removeChild(this)}}function Km(){return this.on("end.remove",qm(this._id))}function Wm(t){var e=this._name,n=this._id;typeof t!="function"&&(t=Pr(t));for(var i=this._groups,r=i.length,s=new Array(r),o=0;o<r;++o)for(var l=i[o],a=l.length,c=s[o]=new Array(a),u,d,f=0;f<a;++f)(u=l[f])&&(d=t.call(u,u.__data__,f,l))&&("__data__"in u&&(d.__data__=u.__data__),c[f]=d,Ki(c[f],e,n,f,c,Pt(u,n)));return new Wt(s,this._parents,e,n)}function Gm(t){var e=this._name,n=this._id;typeof t!="function"&&(t=xo(t));for(var i=this._groups,r=i.length,s=[],o=[],l=0;l<r;++l)for(var a=i[l],c=a.length,u,d=0;d<c;++d)if(u=a[d]){for(var f=t.call(u,u.__data__,d,a),h,m=Pt(u,n),g=0,p=f.length;g<p;++g)(h=f[g])&&Ki(h,e,n,g,f,m);s.push(f),o.push(u)}return new Wt(s,o,e,n)}var Ym=Xn.prototype.constructor;function Xm(){return new Ym(this._groups,this._parents)}function Jm(t,e){var n,i,r;return function(){var s=An(this,t),o=(this.style.removeProperty(t),An(this,t));return s===o?null:s===n&&o===i?r:r=e(n=s,i=o)}}function fl(t){return function(){this.style.removeProperty(t)}}function Qm(t,e,n){var i,r=n+"",s;return function(){var o=An(this,t);return o===r?null:o===i?s:s=e(i=o,n)}}function Zm(t,e,n){var i,r,s;return function(){var o=An(this,t),l=n(this),a=l+"";return l==null&&(a=l=(this.style.removeProperty(t),An(this,t))),o===a?null:o===i&&a===r?s:(r=a,s=e(i=o,l))}}function ep(t,e){var n,i,r,s="style."+e,o="end."+s,l;return function(){var a=zt(this,t),c=a.on,u=a.value[s]==null?l||(l=fl(e)):void 0;(c!==n||r!==u)&&(i=(n=c).copy()).on(o,r=u),a.on=i}}function tp(t,e,n){var i=(t+="")=="transform"?tm:ul;return e==null?this.styleTween(t,Jm(t,i)).on("end.style."+t,fl(t)):typeof e=="function"?this.styleTween(t,Zm(t,i,Qr(this,"style."+t,e))).each(ep(this._id,t)):this.styleTween(t,Qm(t,i,e),n).on("end.style."+t,null)}function np(t,e,n){return function(i){this.style.setProperty(t,e.call(this,i),n)}}function ip(t,e,n){var i,r;function s(){var o=e.apply(this,arguments);return o!==r&&(i=(r=o)&&np(t,o,n)),i}return s._value=e,s}function rp(t,e,n){var i="style."+(t+="");if(arguments.length<2)return(i=this.tween(i))&&i._value;if(e==null)return this.tween(i,null);if(typeof e!="function")throw new Error;return this.tween(i,ip(t,e,n??""))}function sp(t){return function(){this.textContent=t}}function op(t){return function(){var e=t(this);this.textContent=e??""}}function lp(t){return this.tween("text",typeof t=="function"?op(Qr(this,"text",t)):sp(t==null?"":t+""))}function ap(t){return function(e){this.textContent=t.call(this,e)}}function cp(t){var e,n;function i(){var r=t.apply(this,arguments);return r!==n&&(e=(n=r)&&ap(r)),e}return i._value=t,i}function up(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(t==null)return this.tween(e,null);if(typeof t!="function")throw new Error;return this.tween(e,cp(t))}function fp(){for(var t=this._name,e=this._id,n=hl(),i=this._groups,r=i.length,s=0;s<r;++s)for(var o=i[s],l=o.length,a,c=0;c<l;++c)if(a=o[c]){var u=Pt(a,e);Ki(a,t,n,c,o,{time:u.time+u.delay+u.duration,delay:0,duration:u.duration,ease:u.ease})}return new Wt(i,this._parents,t,n)}function hp(){var t,e,n=this,i=n._id,r=n.size();return new Promise(function(s,o){var l={value:o},a={value:function(){--r===0&&s()}};n.each(function(){var c=zt(this,i),u=c.on;u!==t&&(e=(t=u).copy(),e._.cancel.push(l),e._.interrupt.push(l),e._.end.push(a)),c.on=e}),r===0&&s()})}var dp=0;function Wt(t,e,n,i){this._groups=t,this._parents=e,this._name=n,this._id=i}function hl(){return++dp}var Gt=Xn.prototype;Wt.prototype={constructor:Wt,select:Wm,selectAll:Gm,selectChild:Gt.selectChild,selectChildren:Gt.selectChildren,filter:Fm,merge:Vm,selection:Xm,transition:fp,call:Gt.call,nodes:Gt.nodes,node:Gt.node,size:Gt.size,empty:Gt.empty,each:Gt.each,on:Bm,attr:Em,attrTween:Am,style:tp,styleTween:rp,text:lp,textTween:up,remove:Km,tween:_m,delay:Om,duration:Dm,ease:$m,easeVarying:jm,end:hp,[Symbol.iterator]:Gt[Symbol.iterator]};function mp(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}var pp={time:null,delay:0,duration:250,ease:mp};function gp(t,e){for(var n;!(n=t.__transition)||!(n=n[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return n}function _p(t){var e,n;t instanceof Wt?(e=t._id,t=t._name):(e=hl(),(n=pp).time=Kr(),t=t==null?null:t+"");for(var i=this._groups,r=i.length,s=0;s<r;++s)for(var o=i[s],l=o.length,a,c=0;c<l;++c)(a=o[c])&&Ki(a,t,e,c,o,n||gp(a,e));return new Wt(i,this._parents,t,e)}Xn.prototype.interrupt=mm,Xn.prototype.transition=_p;function dl(t,e){var n,i=1;t==null&&(t=0),e==null&&(e=0);function r(){var s,o=n.length,l,a=0,c=0;for(s=0;s<o;++s)l=n[s],a+=l.x,c+=l.y;for(a=(a/o-t)*i,c=(c/o-e)*i,s=0;s<o;++s)l=n[s],l.x-=a,l.y-=c}return r.initialize=function(s){n=s},r.x=function(s){return arguments.length?(t=+s,r):t},r.y=function(s){return arguments.length?(e=+s,r):e},r.strength=function(s){return arguments.length?(i=+s,r):i},r}function vp(t){const e=+this._x.call(null,t),n=+this._y.call(null,t);return ml(this.cover(e,n),e,n,t)}function ml(t,e,n,i){if(isNaN(e)||isNaN(n))return t;var r,s=t._root,o={data:i},l=t._x0,a=t._y0,c=t._x1,u=t._y1,d,f,h,m,g,p,_,S;if(!s)return t._root=o,t;for(;s.length;)if((g=e>=(d=(l+c)/2))?l=d:c=d,(p=n>=(f=(a+u)/2))?a=f:u=f,r=s,!(s=s[_=p<<1|g]))return r[_]=o,t;if(h=+t._x.call(null,s.data),m=+t._y.call(null,s.data),e===h&&n===m)return o.next=s,r?r[_]=o:t._root=o,t;do r=r?r[_]=new Array(4):t._root=new Array(4),(g=e>=(d=(l+c)/2))?l=d:c=d,(p=n>=(f=(a+u)/2))?a=f:u=f;while((_=p<<1|g)===(S=(m>=f)<<1|h>=d));return r[S]=s,r[_]=o,t}function yp(t){var e,n,i=t.length,r,s,o=new Array(i),l=new Array(i),a=1/0,c=1/0,u=-1/0,d=-1/0;for(n=0;n<i;++n)isNaN(r=+this._x.call(null,e=t[n]))||isNaN(s=+this._y.call(null,e))||(o[n]=r,l[n]=s,r<a&&(a=r),r>u&&(u=r),s<c&&(c=s),s>d&&(d=s));if(a>u||c>d)return this;for(this.cover(a,c).cover(u,d),n=0;n<i;++n)ml(this,o[n],l[n],t[n]);return this}function bp(t,e){if(isNaN(t=+t)||isNaN(e=+e))return this;var n=this._x0,i=this._y0,r=this._x1,s=this._y1;if(isNaN(n))r=(n=Math.floor(t))+1,s=(i=Math.floor(e))+1;else{for(var o=r-n||1,l=this._root,a,c;n>t||t>=r||i>e||e>=s;)switch(c=(e<i)<<1|t<n,a=new Array(4),a[c]=l,l=a,o*=2,c){case 0:r=n+o,s=i+o;break;case 1:n=r-o,s=i+o;break;case 2:r=n+o,i=s-o;break;case 3:n=r-o,i=s-o;break}this._root&&this._root.length&&(this._root=l)}return this._x0=n,this._y0=i,this._x1=r,this._y1=s,this}function wp(){var t=[];return this.visit(function(e){if(!e.length)do t.push(e.data);while(e=e.next)}),t}function Sp(t){return arguments.length?this.cover(+t[0][0],+t[0][1]).cover(+t[1][0],+t[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function it(t,e,n,i,r){this.node=t,this.x0=e,this.y0=n,this.x1=i,this.y1=r}function kp(t,e,n){var i,r=this._x0,s=this._y0,o,l,a,c,u=this._x1,d=this._y1,f=[],h=this._root,m,g;for(h&&f.push(new it(h,r,s,u,d)),n==null?n=1/0:(r=t-n,s=e-n,u=t+n,d=e+n,n*=n);m=f.pop();)if(!(!(h=m.node)||(o=m.x0)>u||(l=m.y0)>d||(a=m.x1)<r||(c=m.y1)<s))if(h.length){var p=(o+a)/2,_=(l+c)/2;f.push(new it(h[3],p,_,a,c),new it(h[2],o,_,p,c),new it(h[1],p,l,a,_),new it(h[0],o,l,p,_)),(g=(e>=_)<<1|t>=p)&&(m=f[f.length-1],f[f.length-1]=f[f.length-1-g],f[f.length-1-g]=m)}else{var S=t-+this._x.call(null,h.data),I=e-+this._y.call(null,h.data),b=S*S+I*I;if(b<n){var E=Math.sqrt(n=b);r=t-E,s=e-E,u=t+E,d=e+E,i=h.data}}return i}function Ep(t){if(isNaN(u=+this._x.call(null,t))||isNaN(d=+this._y.call(null,t)))return this;var e,n=this._root,i,r,s,o=this._x0,l=this._y0,a=this._x1,c=this._y1,u,d,f,h,m,g,p,_;if(!n)return this;if(n.length)for(;;){if((m=u>=(f=(o+a)/2))?o=f:a=f,(g=d>=(h=(l+c)/2))?l=h:c=h,e=n,!(n=n[p=g<<1|m]))return this;if(!n.length)break;(e[p+1&3]||e[p+2&3]||e[p+3&3])&&(i=e,_=p)}for(;n.data!==t;)if(r=n,!(n=n.next))return this;return(s=n.next)&&delete n.next,r?(s?r.next=s:delete r.next,this):e?(s?e[p]=s:delete e[p],(n=e[0]||e[1]||e[2]||e[3])&&n===(e[3]||e[2]||e[1]||e[0])&&!n.length&&(i?i[_]=n:this._root=n),this):(this._root=s,this)}function Cp(t){for(var e=0,n=t.length;e<n;++e)this.remove(t[e]);return this}function Ip(){return this._root}function Mp(){var t=0;return this.visit(function(e){if(!e.length)do++t;while(e=e.next)}),t}function xp(t){var e=[],n,i=this._root,r,s,o,l,a;for(i&&e.push(new it(i,this._x0,this._y0,this._x1,this._y1));n=e.pop();)if(!t(i=n.node,s=n.x0,o=n.y0,l=n.x1,a=n.y1)&&i.length){var c=(s+l)/2,u=(o+a)/2;(r=i[3])&&e.push(new it(r,c,u,l,a)),(r=i[2])&&e.push(new it(r,s,u,c,a)),(r=i[1])&&e.push(new it(r,c,o,l,u)),(r=i[0])&&e.push(new it(r,s,o,c,u))}return this}function Ap(t){var e=[],n=[],i;for(this._root&&e.push(new it(this._root,this._x0,this._y0,this._x1,this._y1));i=e.pop();){var r=i.node;if(r.length){var s,o=i.x0,l=i.y0,a=i.x1,c=i.y1,u=(o+a)/2,d=(l+c)/2;(s=r[0])&&e.push(new it(s,o,l,u,d)),(s=r[1])&&e.push(new it(s,u,l,a,d)),(s=r[2])&&e.push(new it(s,o,d,u,c)),(s=r[3])&&e.push(new it(s,u,d,a,c))}n.push(i)}for(;i=n.pop();)t(i.node,i.x0,i.y0,i.x1,i.y1);return this}function Tp(t){return t[0]}function Np(t){return arguments.length?(this._x=t,this):this._x}function Op(t){return t[1]}function Pp(t){return arguments.length?(this._y=t,this):this._y}function Zr(t,e,n){var i=new es(e??Tp,n??Op,NaN,NaN,NaN,NaN);return t==null?i:i.addAll(t)}function es(t,e,n,i,r,s){this._x=t,this._y=e,this._x0=n,this._y0=i,this._x1=r,this._y1=s,this._root=void 0}function pl(t){for(var e={data:t.data},n=e;t=t.next;)n=n.next={data:t.data};return e}var rt=Zr.prototype=es.prototype;rt.copy=function(){var t=new es(this._x,this._y,this._x0,this._y0,this._x1,this._y1),e=this._root,n,i;if(!e)return t;if(!e.length)return t._root=pl(e),t;for(n=[{source:e,target:t._root=new Array(4)}];e=n.pop();)for(var r=0;r<4;++r)(i=e.source[r])&&(i.length?n.push({source:i,target:e.target[r]=new Array(4)}):e.target[r]=pl(i));return t},rt.add=vp,rt.addAll=yp,rt.cover=bp,rt.data=wp,rt.extent=Sp,rt.find=kp,rt.remove=Ep,rt.removeAll=Cp,rt.root=Ip,rt.size=Mp,rt.visit=xp,rt.visitAfter=Ap,rt.x=Np,rt.y=Pp;function st(t){return function(){return t}}function rn(t){return(t()-.5)*1e-6}function Lp(t){return t.x+t.vx}function Dp(t){return t.y+t.vy}function gl(t){var e,n,i,r=1,s=1;typeof t!="function"&&(t=st(t==null?1:+t));function o(){for(var c,u=e.length,d,f,h,m,g,p,_=0;_<s;++_)for(d=Zr(e,Lp,Dp).visitAfter(l),c=0;c<u;++c)f=e[c],g=n[f.index],p=g*g,h=f.x+f.vx,m=f.y+f.vy,d.visit(S);function S(I,b,E,O,x){var k=I.data,M=I.r,P=g+M;if(k){if(k.index>f.index){var L=h-k.x-k.vx,q=m-k.y-k.vy,R=L*L+q*q;R<P*P&&(L===0&&(L=rn(i),R+=L*L),q===0&&(q=rn(i),R+=q*q),R=(P-(R=Math.sqrt(R)))/R*r,f.vx+=(L*=R)*(P=(M*=M)/(p+M)),f.vy+=(q*=R)*P,k.vx-=L*(P=1-P),k.vy-=q*P)}return}return b>h+P||O<h-P||E>m+P||x<m-P}}function l(c){if(c.data)return c.r=n[c.data.index];for(var u=c.r=0;u<4;++u)c[u]&&c[u].r>c.r&&(c.r=c[u].r)}function a(){if(e){var c,u=e.length,d;for(n=new Array(u),c=0;c<u;++c)d=e[c],n[d.index]=+t(d,c,e)}}return o.initialize=function(c,u){e=c,i=u,a()},o.iterations=function(c){return arguments.length?(s=+c,o):s},o.strength=function(c){return arguments.length?(r=+c,o):r},o.radius=function(c){return arguments.length?(t=typeof c=="function"?c:st(+c),a(),o):t},o}function Rp(t){return t.index}function _l(t,e){var n=t.get(e);if(!n)throw new Error("node not found: "+e);return n}function vl(t){var e=Rp,n=d,i,r=st(30),s,o,l,a,c,u=1;t==null&&(t=[]);function d(p){return 1/Math.min(l[p.source.index],l[p.target.index])}function f(p){for(var _=0,S=t.length;_<u;++_)for(var I=0,b,E,O,x,k,M,P;I<S;++I)b=t[I],E=b.source,O=b.target,x=O.x+O.vx-E.x-E.vx||rn(c),k=O.y+O.vy-E.y-E.vy||rn(c),M=Math.sqrt(x*x+k*k),M=(M-s[I])/M*p*i[I],x*=M,k*=M,O.vx-=x*(P=a[I]),O.vy-=k*P,E.vx+=x*(P=1-P),E.vy+=k*P}function h(){if(o){var p,_=o.length,S=t.length,I=new Map(o.map((E,O)=>[e(E,O,o),E])),b;for(p=0,l=new Array(_);p<S;++p)b=t[p],b.index=p,typeof b.source!="object"&&(b.source=_l(I,b.source)),typeof b.target!="object"&&(b.target=_l(I,b.target)),l[b.source.index]=(l[b.source.index]||0)+1,l[b.target.index]=(l[b.target.index]||0)+1;for(p=0,a=new Array(S);p<S;++p)b=t[p],a[p]=l[b.source.index]/(l[b.source.index]+l[b.target.index]);i=new Array(S),m(),s=new Array(S),g()}}function m(){if(o)for(var p=0,_=t.length;p<_;++p)i[p]=+n(t[p],p,t)}function g(){if(o)for(var p=0,_=t.length;p<_;++p)s[p]=+r(t[p],p,t)}return f.initialize=function(p,_){o=p,c=_,h()},f.links=function(p){return arguments.length?(t=p,h(),f):t},f.id=function(p){return arguments.length?(e=p,f):e},f.iterations=function(p){return arguments.length?(u=+p,f):u},f.strength=function(p){return arguments.length?(n=typeof p=="function"?p:st(+p),m(),f):n},f.distance=function(p){return arguments.length?(r=typeof p=="function"?p:st(+p),g(),f):r},f}const $p=1664525,zp=1013904223,yl=4294967296;function jp(){let t=1;return()=>(t=($p*t+zp)%yl)/yl}function Fp(t){return t.x}function Vp(t){return t.y}var Hp=10,Up=Math.PI*(3-Math.sqrt(5));function bl(t){var e,n=1,i=.001,r=1-Math.pow(i,1/300),s=0,o=.6,l=new Map,a=Wr(d),c=Yn("tick","end"),u=jp();t==null&&(t=[]);function d(){f(),c.call("tick",e),n<i&&(a.stop(),c.call("end",e))}function f(g){var p,_=t.length,S;g===void 0&&(g=1);for(var I=0;I<g;++I)for(n+=(s-n)*r,l.forEach(function(b){b(n)}),p=0;p<_;++p)S=t[p],S.fx==null?S.x+=S.vx*=o:(S.x=S.fx,S.vx=0),S.fy==null?S.y+=S.vy*=o:(S.y=S.fy,S.vy=0);return e}function h(){for(var g=0,p=t.length,_;g<p;++g){if(_=t[g],_.index=g,_.fx!=null&&(_.x=_.fx),_.fy!=null&&(_.y=_.fy),isNaN(_.x)||isNaN(_.y)){var S=Hp*Math.sqrt(.5+g),I=g*Up;_.x=S*Math.cos(I),_.y=S*Math.sin(I)}(isNaN(_.vx)||isNaN(_.vy))&&(_.vx=_.vy=0)}}function m(g){return g.initialize&&g.initialize(t,u),g}return h(),e={tick:f,restart:function(){return a.restart(d),e},stop:function(){return a.stop(),e},nodes:function(g){return arguments.length?(t=g,h(),l.forEach(m),e):t},alpha:function(g){return arguments.length?(n=+g,e):n},alphaMin:function(g){return arguments.length?(i=+g,e):i},alphaDecay:function(g){return arguments.length?(r=+g,e):+r},alphaTarget:function(g){return arguments.length?(s=+g,e):s},velocityDecay:function(g){return arguments.length?(o=1-g,e):1-o},randomSource:function(g){return arguments.length?(u=g,l.forEach(m),e):u},force:function(g,p){return arguments.length>1?(p==null?l.delete(g):l.set(g,m(p)),e):l.get(g)},find:function(g,p,_){var S=0,I=t.length,b,E,O,x,k;for(_==null?_=1/0:_*=_,S=0;S<I;++S)x=t[S],b=g-x.x,E=p-x.y,O=b*b+E*E,O<_&&(k=x,_=O);return k},on:function(g,p){return arguments.length>1?(c.on(g,p),e):c.on(g)}}}function wl(){var t,e,n,i,r=st(-30),s,o=1,l=1/0,a=.81;function c(h){var m,g=t.length,p=Zr(t,Fp,Vp).visitAfter(d);for(i=h,m=0;m<g;++m)e=t[m],p.visit(f)}function u(){if(t){var h,m=t.length,g;for(s=new Array(m),h=0;h<m;++h)g=t[h],s[g.index]=+r(g,h,t)}}function d(h){var m=0,g,p,_=0,S,I,b;if(h.length){for(S=I=b=0;b<4;++b)(g=h[b])&&(p=Math.abs(g.value))&&(m+=g.value,_+=p,S+=p*g.x,I+=p*g.y);h.x=S/_,h.y=I/_}else{g=h,g.x=g.data.x,g.y=g.data.y;do m+=s[g.data.index];while(g=g.next)}h.value=m}function f(h,m,g,p){if(!h.value)return!0;var _=h.x-e.x,S=h.y-e.y,I=p-m,b=_*_+S*S;if(I*I/a<b)return b<l&&(_===0&&(_=rn(n),b+=_*_),S===0&&(S=rn(n),b+=S*S),b<o&&(b=Math.sqrt(o*b)),e.vx+=_*h.value*i/b,e.vy+=S*h.value*i/b),!0;if(h.length||b>=l)return;(h.data!==e||h.next)&&(_===0&&(_=rn(n),b+=_*_),S===0&&(S=rn(n),b+=S*S),b<o&&(b=Math.sqrt(o*b)));do h.data!==e&&(I=s[h.data.index]*i/b,e.vx+=_*I,e.vy+=S*I);while(h=h.next)}return c.initialize=function(h,m){t=h,n=m,u()},c.strength=function(h){return arguments.length?(r=typeof h=="function"?h:st(+h),u(),c):r},c.distanceMin=function(h){return arguments.length?(o=h*h,c):Math.sqrt(o)},c.distanceMax=function(h){return arguments.length?(l=h*h,c):Math.sqrt(l)},c.theta=function(h){return arguments.length?(a=h*h,c):Math.sqrt(a)},c}function Sl(t){var e=st(.1),n,i,r;typeof t!="function"&&(t=st(t==null?0:+t));function s(l){for(var a=0,c=n.length,u;a<c;++a)u=n[a],u.vx+=(r[a]-u.x)*i[a]*l}function o(){if(n){var l,a=n.length;for(i=new Array(a),r=new Array(a),l=0;l<a;++l)i[l]=isNaN(r[l]=+t(n[l],l,n))?0:+e(n[l],l,n)}}return s.initialize=function(l){n=l,o()},s.strength=function(l){return arguments.length?(e=typeof l=="function"?l:st(+l),o(),s):e},s.x=function(l){return arguments.length?(t=typeof l=="function"?l:st(+l),o(),s):t},s}function kl(t){var e=st(.1),n,i,r;typeof t!="function"&&(t=st(t==null?0:+t));function s(l){for(var a=0,c=n.length,u;a<c;++a)u=n[a],u.vy+=(r[a]-u.y)*i[a]*l}function o(){if(n){var l,a=n.length;for(i=new Array(a),r=new Array(a),l=0;l<a;++l)i[l]=isNaN(r[l]=+t(n[l],l,n))?0:+e(n[l],l,n)}}return s.initialize=function(l){n=l,o()},s.strength=function(l){return arguments.length?(e=typeof l=="function"?l:st(+l),o(),s):e},s.y=function(l){return arguments.length?(t=typeof l=="function"?l:st(+l),o(),s):t},s}function Bp(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)}function Gi(t,e){if((n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var n,i=t.slice(0,n);return[i.length>1?i[0]+i.slice(2):i,+t.slice(n+1)]}function Pn(t){return t=Gi(Math.abs(t)),t?t[1]:NaN}function qp(t,e){return function(n,i){for(var r=n.length,s=[],o=0,l=t[0],a=0;r>0&&l>0&&(a+l+1>i&&(l=Math.max(1,i-a)),s.push(n.substring(r-=l,r+l)),!((a+=l+1)>i));)l=t[o=(o+1)%t.length];return s.reverse().join(e)}}function Kp(t){return function(e){return e.replace(/[0-9]/g,function(n){return t[+n]})}}var Wp=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Yi(t){if(!(e=Wp.exec(t)))throw new Error("invalid format: "+t);var e;return new ts({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}Yi.prototype=ts.prototype;function ts(t){this.fill=t.fill===void 0?" ":t.fill+"",this.align=t.align===void 0?">":t.align+"",this.sign=t.sign===void 0?"-":t.sign+"",this.symbol=t.symbol===void 0?"":t.symbol+"",this.zero=!!t.zero,this.width=t.width===void 0?void 0:+t.width,this.comma=!!t.comma,this.precision=t.precision===void 0?void 0:+t.precision,this.trim=!!t.trim,this.type=t.type===void 0?"":t.type+""}ts.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function Gp(t){e:for(var e=t.length,n=1,i=-1,r;n<e;++n)switch(t[n]){case".":i=r=n;break;case"0":i===0&&(i=n),r=n;break;default:if(!+t[n])break e;i>0&&(i=0);break}return i>0?t.slice(0,i)+t.slice(r+1):t}var El;function Yp(t,e){var n=Gi(t,e);if(!n)return t+"";var i=n[0],r=n[1],s=r-(El=Math.max(-8,Math.min(8,Math.floor(r/3)))*3)+1,o=i.length;return s===o?i:s>o?i+new Array(s-o+1).join("0"):s>0?i.slice(0,s)+"."+i.slice(s):"0."+new Array(1-s).join("0")+Gi(t,Math.max(0,e+s-1))[0]}function Cl(t,e){var n=Gi(t,e);if(!n)return t+"";var i=n[0],r=n[1];return r<0?"0."+new Array(-r).join("0")+i:i.length>r+1?i.slice(0,r+1)+"."+i.slice(r+1):i+new Array(r-i.length+2).join("0")}const Il={"%":(t,e)=>(t*100).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:Bp,e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>Cl(t*100,e),r:Cl,s:Yp,X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function Ml(t){return t}var xl=Array.prototype.map,Al=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function Xp(t){var e=t.grouping===void 0||t.thousands===void 0?Ml:qp(xl.call(t.grouping,Number),t.thousands+""),n=t.currency===void 0?"":t.currency[0]+"",i=t.currency===void 0?"":t.currency[1]+"",r=t.decimal===void 0?".":t.decimal+"",s=t.numerals===void 0?Ml:Kp(xl.call(t.numerals,String)),o=t.percent===void 0?"%":t.percent+"",l=t.minus===void 0?"−":t.minus+"",a=t.nan===void 0?"NaN":t.nan+"";function c(d){d=Yi(d);var f=d.fill,h=d.align,m=d.sign,g=d.symbol,p=d.zero,_=d.width,S=d.comma,I=d.precision,b=d.trim,E=d.type;E==="n"?(S=!0,E="g"):Il[E]||(I===void 0&&(I=12),b=!0,E="g"),(p||f==="0"&&h==="=")&&(p=!0,f="0",h="=");var O=g==="$"?n:g==="#"&&/[boxX]/.test(E)?"0"+E.toLowerCase():"",x=g==="$"?i:/[%p]/.test(E)?o:"",k=Il[E],M=/[defgprs%]/.test(E);I=I===void 0?6:/[gprs]/.test(E)?Math.max(1,Math.min(21,I)):Math.max(0,Math.min(20,I));function P(L){var q=O,R=x,C,D,A;if(E==="c")R=k(L)+R,L="";else{L=+L;var V=L<0||1/L<0;if(L=isNaN(L)?a:k(Math.abs(L),I),b&&(L=Gp(L)),V&&+L==0&&m!=="+"&&(V=!1),q=(V?m==="("?m:l:m==="-"||m==="("?"":m)+q,R=(E==="s"?Al[8+El/3]:"")+R+(V&&m==="("?")":""),M){for(C=-1,D=L.length;++C<D;)if(A=L.charCodeAt(C),48>A||A>57){R=(A===46?r+L.slice(C+1):L.slice(C))+R,L=L.slice(0,C);break}}}S&&!p&&(L=e(L,1/0));var B=q.length+L.length+R.length,H=B<_?new Array(_-B+1).join(f):"";switch(S&&p&&(L=e(H+L,H.length?_-R.length:1/0),H=""),h){case"<":L=q+L+R+H;break;case"=":L=q+H+L+R;break;case"^":L=H.slice(0,B=H.length>>1)+q+L+R+H.slice(B);break;default:L=H+q+L+R;break}return s(L)}return P.toString=function(){return d+""},P}function u(d,f){var h=c((d=Yi(d),d.type="f",d)),m=Math.max(-8,Math.min(8,Math.floor(Pn(f)/3)))*3,g=Math.pow(10,-m),p=Al[8+m/3];return function(_){return h(g*_)+p}}return{format:c,formatPrefix:u}}var Xi,Ji,Tl;Jp({thousands:",",grouping:[3],currency:["$",""]});function Jp(t){return Xi=Xp(t),Ji=Xi.format,Tl=Xi.formatPrefix,Xi}function Qp(t){return Math.max(0,-Pn(Math.abs(t)))}function Zp(t,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Pn(e)/3)))*3-Pn(Math.abs(t)))}function eg(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,Pn(e)-Pn(t))+1}function tg(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t);break}return this}function ng(t){return function(){return t}}function ig(t){return+t}var Nl=[0,1];function Ln(t){return t}function ns(t,e){return(e-=t=+t)?function(n){return(n-t)/e}:ng(isNaN(e)?NaN:.5)}function rg(t,e){var n;return t>e&&(n=t,t=e,e=n),function(i){return Math.max(t,Math.min(e,i))}}function sg(t,e,n){var i=t[0],r=t[1],s=e[0],o=e[1];return r<i?(i=ns(r,i),s=n(o,s)):(i=ns(i,r),s=n(s,o)),function(l){return s(i(l))}}function og(t,e,n){var i=Math.min(t.length,e.length)-1,r=new Array(i),s=new Array(i),o=-1;for(t[i]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++o<i;)r[o]=ns(t[o],t[o+1]),s[o]=n(e[o],e[o+1]);return function(l){var a=Af(t,l,1,i)-1;return s[a](r[a](l))}}function lg(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function ag(){var t=Nl,e=Nl,n=Br,i,r,s,o=Ln,l,a,c;function u(){var f=Math.min(t.length,e.length);return o!==Ln&&(o=rg(t[0],t[f-1])),l=f>2?og:sg,a=c=null,d}function d(f){return f==null||isNaN(f=+f)?s:(a||(a=l(t.map(i),e,n)))(i(o(f)))}return d.invert=function(f){return o(r((c||(c=l(e,t.map(i),Ot)))(f)))},d.domain=function(f){return arguments.length?(t=Array.from(f,ig),u()):t.slice()},d.range=function(f){return arguments.length?(e=Array.from(f),u()):e.slice()},d.rangeRound=function(f){return e=Array.from(f),n=Qd,u()},d.clamp=function(f){return arguments.length?(o=f?!0:Ln,u()):o!==Ln},d.interpolate=function(f){return arguments.length?(n=f,u()):n},d.unknown=function(f){return arguments.length?(s=f,d):s},function(f,h){return i=f,r=h,u()}}function cg(){return ag()(Ln,Ln)}function ug(t,e,n,i){var r=Lf(t,e,n),s;switch(i=Yi(i??",f"),i.type){case"s":{var o=Math.max(Math.abs(t),Math.abs(e));return i.precision==null&&!isNaN(s=Zp(r,o))&&(i.precision=s),Tl(i,o)}case"":case"e":case"g":case"p":case"r":{i.precision==null&&!isNaN(s=eg(r,Math.max(Math.abs(t),Math.abs(e))))&&(i.precision=s-(i.type==="e"));break}case"f":case"%":{i.precision==null&&!isNaN(s=Qp(r))&&(i.precision=s-(i.type==="%")*2);break}}return Ji(i)}function fg(t){var e=t.domain;return t.ticks=function(n){var i=e();return Pf(i[0],i[i.length-1],n??10)},t.tickFormat=function(n,i){var r=e();return ug(r[0],r[r.length-1],n??10,i)},t.nice=function(n){n==null&&(n=10);var i=e(),r=0,s=i.length-1,o=i[r],l=i[s],a,c,u=10;for(l<o&&(c=o,o=l,l=c,c=r,r=s,s=c);u-- >0;){if(c=xr(o,l,n),c===a)return i[r]=o,i[s]=l,e(i);if(c>0)o=Math.floor(o/c)*c,l=Math.ceil(l/c)*c;else if(c<0)o=Math.ceil(o*c)/c,l=Math.floor(l*c)/c;else break;a=c}return t},t}function is(){var t=cg();return t.copy=function(){return lg(t,is())},tg.apply(t,arguments),fg(t)}const Qi=t=>()=>t;function hg(t,{sourceEvent:e,target:n,transform:i,dispatch:r}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:i,enumerable:!0,configurable:!0},_:{value:r}})}function Yt(t,e,n){this.k=t,this.x=e,this.y=n}Yt.prototype={constructor:Yt,scale:function(t){return t===1?this:new Yt(this.k*t,this.x,this.y)},translate:function(t,e){return t===0&e===0?this:new Yt(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var rs=new Yt(1,0,0);Yt.prototype;function ss(t){t.stopImmediatePropagation()}function si(t){t.preventDefault(),t.stopImmediatePropagation()}function dg(t){return(!t.ctrlKey||t.type==="wheel")&&!t.button}function mg(){var t=this;return t instanceof SVGElement?(t=t.ownerSVGElement||t,t.hasAttribute("viewBox")?(t=t.viewBox.baseVal,[[t.x,t.y],[t.x+t.width,t.y+t.height]]):[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]):[[0,0],[t.clientWidth,t.clientHeight]]}function Ol(){return this.__zoom||rs}function pg(t){return-t.deltaY*(t.deltaMode===1?.05:t.deltaMode?1:.002)*(t.ctrlKey?10:1)}function gg(){return navigator.maxTouchPoints||"ontouchstart"in this}function _g(t,e,n){var i=t.invertX(e[0][0])-n[0][0],r=t.invertX(e[1][0])-n[1][0],s=t.invertY(e[0][1])-n[0][1],o=t.invertY(e[1][1])-n[1][1];return t.translate(r>i?(i+r)/2:Math.min(0,i)||Math.max(0,r),o>s?(s+o)/2:Math.min(0,s)||Math.max(0,o))}function Pl(){var t=dg,e=mg,n=_g,i=pg,r=gg,s=[0,1/0],o=[[-1/0,-1/0],[1/0,1/0]],l=250,a=om,c=Yn("start","zoom","end"),u,d,f,h=500,m=150,g=0,p=10;function _(C){C.property("__zoom",Ol).on("wheel.zoom",k,{passive:!1}).on("mousedown.zoom",M).on("dblclick.zoom",P).filter(r).on("touchstart.zoom",L).on("touchmove.zoom",q).on("touchend.zoom touchcancel.zoom",R).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}_.transform=function(C,D,A,V){var B=C.selection?C.selection():C;B.property("__zoom",Ol),C!==B?E(C,D,A,V):B.interrupt().each(function(){O(this,arguments).event(V).start().zoom(null,typeof D=="function"?D.apply(this,arguments):D).end()})},_.scaleBy=function(C,D,A,V){_.scaleTo(C,function(){var B=this.__zoom.k,H=typeof D=="function"?D.apply(this,arguments):D;return B*H},A,V)},_.scaleTo=function(C,D,A,V){_.transform(C,function(){var B=e.apply(this,arguments),H=this.__zoom,Y=A==null?b(B):typeof A=="function"?A.apply(this,arguments):A,Z=H.invert(Y),re=typeof D=="function"?D.apply(this,arguments):D;return n(I(S(H,re),Y,Z),B,o)},A,V)},_.translateBy=function(C,D,A,V){_.transform(C,function(){return n(this.__zoom.translate(typeof D=="function"?D.apply(this,arguments):D,typeof A=="function"?A.apply(this,arguments):A),e.apply(this,arguments),o)},null,V)},_.translateTo=function(C,D,A,V,B){_.transform(C,function(){var H=e.apply(this,arguments),Y=this.__zoom,Z=V==null?b(H):typeof V=="function"?V.apply(this,arguments):V;return n(rs.translate(Z[0],Z[1]).scale(Y.k).translate(typeof D=="function"?-D.apply(this,arguments):-D,typeof A=="function"?-A.apply(this,arguments):-A),H,o)},V,B)};function S(C,D){return D=Math.max(s[0],Math.min(s[1],D)),D===C.k?C:new Yt(D,C.x,C.y)}function I(C,D,A){var V=D[0]-A[0]*C.k,B=D[1]-A[1]*C.k;return V===C.x&&B===C.y?C:new Yt(C.k,V,B)}function b(C){return[(+C[0][0]+ +C[1][0])/2,(+C[0][1]+ +C[1][1])/2]}function E(C,D,A,V){C.on("start.zoom",function(){O(this,arguments).event(V).start()}).on("interrupt.zoom end.zoom",function(){O(this,arguments).event(V).end()}).tween("zoom",function(){var B=this,H=arguments,Y=O(B,H).event(V),Z=e.apply(B,H),re=A==null?b(Z):typeof A=="function"?A.apply(B,H):A,fe=Math.max(Z[1][0]-Z[0][0],Z[1][1]-Z[0][1]),te=B.__zoom,ce=typeof D=="function"?D.apply(B,H):D,ie=a(te.invert(re).concat(fe/te.k),ce.invert(re).concat(fe/ce.k));return function(Me){if(Me===1)Me=ce;else{var be=ie(Me),Ve=fe/be[2];Me=new Yt(Ve,re[0]-be[0]*Ve,re[1]-be[1]*Ve)}Y.zoom(null,Me)}})}function O(C,D,A){return!A&&C.__zooming||new x(C,D)}function x(C,D){this.that=C,this.args=D,this.active=0,this.sourceEvent=null,this.extent=e.apply(C,D),this.taps=0}x.prototype={event:function(C){return C&&(this.sourceEvent=C),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(C,D){return this.mouse&&C!=="mouse"&&(this.mouse[1]=D.invert(this.mouse[0])),this.touch0&&C!=="touch"&&(this.touch0[1]=D.invert(this.touch0[0])),this.touch1&&C!=="touch"&&(this.touch1[1]=D.invert(this.touch1[0])),this.that.__zoom=D,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(C){var D=Je(this.that).datum();c.call(C,this.that,new hg(C,{sourceEvent:this.sourceEvent,target:_,type:C,transform:this.that.__zoom,dispatch:c}),D)}};function k(C,...D){if(!t.apply(this,arguments))return;var A=O(this,D).event(C),V=this.__zoom,B=Math.max(s[0],Math.min(s[1],V.k*Math.pow(2,i.apply(this,arguments)))),H=nt(C);if(A.wheel)(A.mouse[0][0]!==H[0]||A.mouse[0][1]!==H[1])&&(A.mouse[1]=V.invert(A.mouse[0]=H)),clearTimeout(A.wheel);else{if(V.k===B)return;A.mouse=[H,V.invert(H)],Wi(this),A.start()}si(C),A.wheel=setTimeout(Y,m),A.zoom("mouse",n(I(S(V,B),A.mouse[0],A.mouse[1]),A.extent,o));function Y(){A.wheel=null,A.end()}}function M(C,...D){if(f||!t.apply(this,arguments))return;var A=C.currentTarget,V=O(this,D,!0).event(C),B=Je(C.view).on("mousemove.zoom",re,!0).on("mouseup.zoom",fe,!0),H=nt(C,A),Y=C.clientX,Z=C.clientY;jo(C.view),ss(C),V.mouse=[H,this.__zoom.invert(H)],Wi(this),V.start();function re(te){if(si(te),!V.moved){var ce=te.clientX-Y,ie=te.clientY-Z;V.moved=ce*ce+ie*ie>g}V.event(te).zoom("mouse",n(I(V.that.__zoom,V.mouse[0]=nt(te,A),V.mouse[1]),V.extent,o))}function fe(te){B.on("mousemove.zoom mouseup.zoom",null),Fo(te.view,V.moved),si(te),V.event(te).end()}}function P(C,...D){if(t.apply(this,arguments)){var A=this.__zoom,V=nt(C.changedTouches?C.changedTouches[0]:C,this),B=A.invert(V),H=A.k*(C.shiftKey?.5:2),Y=n(I(S(A,H),V,B),e.apply(this,D),o);si(C),l>0?Je(this).transition().duration(l).call(E,Y,V,C):Je(this).call(_.transform,Y,V,C)}}function L(C,...D){if(t.apply(this,arguments)){var A=C.touches,V=A.length,B=O(this,D,C.changedTouches.length===V).event(C),H,Y,Z,re;for(ss(C),Y=0;Y<V;++Y)Z=A[Y],re=nt(Z,this),re=[re,this.__zoom.invert(re),Z.identifier],B.touch0?!B.touch1&&B.touch0[2]!==re[2]&&(B.touch1=re,B.taps=0):(B.touch0=re,H=!0,B.taps=1+!!u);u&&(u=clearTimeout(u)),H&&(B.taps<2&&(d=re[0],u=setTimeout(function(){u=null},h)),Wi(this),B.start())}}function q(C,...D){if(this.__zooming){var A=O(this,D).event(C),V=C.changedTouches,B=V.length,H,Y,Z,re;for(si(C),H=0;H<B;++H)Y=V[H],Z=nt(Y,this),A.touch0&&A.touch0[2]===Y.identifier?A.touch0[0]=Z:A.touch1&&A.touch1[2]===Y.identifier&&(A.touch1[0]=Z);if(Y=A.that.__zoom,A.touch1){var fe=A.touch0[0],te=A.touch0[1],ce=A.touch1[0],ie=A.touch1[1],Me=(Me=ce[0]-fe[0])*Me+(Me=ce[1]-fe[1])*Me,be=(be=ie[0]-te[0])*be+(be=ie[1]-te[1])*be;Y=S(Y,Math.sqrt(Me/be)),Z=[(fe[0]+ce[0])/2,(fe[1]+ce[1])/2],re=[(te[0]+ie[0])/2,(te[1]+ie[1])/2]}else if(A.touch0)Z=A.touch0[0],re=A.touch0[1];else return;A.zoom("touch",n(I(Y,Z,re),A.extent,o))}}function R(C,...D){if(this.__zooming){var A=O(this,D).event(C),V=C.changedTouches,B=V.length,H,Y;for(ss(C),f&&clearTimeout(f),f=setTimeout(function(){f=null},h),H=0;H<B;++H)Y=V[H],A.touch0&&A.touch0[2]===Y.identifier?delete A.touch0:A.touch1&&A.touch1[2]===Y.identifier&&delete A.touch1;if(A.touch1&&!A.touch0&&(A.touch0=A.touch1,delete A.touch1),A.touch0)A.touch0[1]=this.__zoom.invert(A.touch0[0]);else if(A.end(),A.taps===2&&(Y=nt(Y,this),Math.hypot(d[0]-Y[0],d[1]-Y[1])<p)){var Z=Je(this).on("dblclick.zoom");Z&&Z.apply(this,arguments)}}}return _.wheelDelta=function(C){return arguments.length?(i=typeof C=="function"?C:Qi(+C),_):i},_.filter=function(C){return arguments.length?(t=typeof C=="function"?C:Qi(!!C),_):t},_.touchable=function(C){return arguments.length?(r=typeof C=="function"?C:Qi(!!C),_):r},_.extent=function(C){return arguments.length?(e=typeof C=="function"?C:Qi([[+C[0][0],+C[0][1]],[+C[1][0],+C[1][1]]]),_):e},_.scaleExtent=function(C){return arguments.length?(s[0]=+C[0],s[1]=+C[1],_):[s[0],s[1]]},_.translateExtent=function(C){return arguments.length?(o[0][0]=+C[0][0],o[1][0]=+C[1][0],o[0][1]=+C[0][1],o[1][1]=+C[1][1],_):[[o[0][0],o[0][1]],[o[1][0],o[1][1]]]},_.constrain=function(C){return arguments.length?(n=C,_):n},_.duration=function(C){return arguments.length?(l=+C,_):l},_.interpolate=function(C){return arguments.length?(a=C,_):a},_.on=function(){var C=c.on.apply(c,arguments);return C===c?_:C},_.clickDistance=function(C){return arguments.length?(g=(C=+C)*C,_):Math.sqrt(g)},_.tapDistance=function(C){return arguments.length?(p=+C,_):p},_}function vg(t,e,n=null,i,r=null){const s=Je(t);s.selectAll("*").remove();const o=s.node(),l=o.getBoundingClientRect();let a=l.width||800,c=l.height||600;const u=a/2,d=c/2,f=s.append("canvas").attr("class","network-canvas").attr("width",a).attr("height",c).style("width",a+"px").style("height",c+"px").style("cursor","default"),h=f.node().getContext("2d",{alpha:!1});let m=rs;const g=new Set,p={current:null};function _(){const L=o.getBoundingClientRect(),q=L.width||800,R=L.height||600;(q!==a||R!==c)&&(a=q,c=R,f.attr("width",a).attr("height",c).style("width",a+"px").style("height",c+"px"),P())}const S=new ResizeObserver(_);S.observe(o);const I=bl(e).force("link",vl(n).id(L=>L.id).distance(L=>L.distance)).force("charge",wl().strength(-250)).force("center",dl(u,d).strength(.7)).force("collide",gl(L=>L.radius+10).strength(.5)).force("x",Sl(u).strength(.025)).force("y",kl(d).strength(.025)).alphaDecay(.05).velocityDecay(.6);let b=null;I.on("tick",()=>{b||(b=requestAnimationFrame(()=>{P(),b=null}))}),I.tick(100);for(let L=0;L<100;L++)I.tick();I.alphaTarget(0);const E=yg({canvas:f,nodes:e,transform:()=>m,hoveredNode:p,onSelectionChange:(L,q)=>{g.clear(),L.forEach(C=>g.add(C));const R=wg(e,L,q);i(R),P()},render:()=>P()}),O=Pl().scaleExtent([.1,10]).filter(L=>!E.isSelectionMode()||L.type==="wheel").on("zoom",({transform:L})=>{m=L,P()});f.call(O);const{dragstarted:x,dragged:k,dragended:M}=bg(f,e,I,()=>m,p,()=>!E.isSelectionMode(),P);E.setupInteractions(f,{start:x,drag:k,end:M});function P(){h.save(),h.fillRect(0,0,a,c),h.translate(m.x,m.y),h.scale(m.k,m.k),h.strokeStyle="#8a8a8a",h.lineWidth=1/m.k,n.forEach(q=>{const R=q.source.x,C=q.source.y,D=q.target.x,A=q.target.y;h.globalAlpha=Math.max(.2,q.strength),h.lineWidth=q.width/m.k,h.beginPath(),h.moveTo(R,C),h.lineTo(D,A),h.stroke()}),h.globalAlpha=1,e.forEach(q=>{const R=g.has(q.id);h.fillStyle=q.color,h.beginPath(),h.arc(q.x,q.y,q.radius,0,2*Math.PI),h.fill(),R&&(h.strokeStyle="#0f2bff",h.lineWidth=3/m.k,h.stroke())});const L=E.getSelectionRect();if(L){h.strokeStyle="#0f2bff",h.fillStyle="rgba(15, 43, 255, 0.2)",h.lineWidth=2/m.k;const q=Math.min(L.x1,L.x2),R=Math.min(L.y1,L.y2),C=Math.abs(L.x2-L.x1),D=Math.abs(L.y2-L.y1);h.fillRect(q,R,C,D),h.strokeRect(q,R,C,D)}h.restore()}return P(),{destroy:()=>{b&&cancelAnimationFrame(b),I.stop(),S.disconnect(),f.remove()},toggleSelectionMode:()=>{const L=E.toggleSelectionMode();return r&&r(L),P(),L}}}function yg(t){const{canvas:e,nodes:n,transform:i,hoveredNode:r,onSelectionChange:s,render:o}=t,l=new Set,a=[];let c=!1,u=null;function d(){return c=!c,e.style("cursor",c?"crosshair":"default"),c}function f(g){if(l.has(g)){l.delete(g);const p=a.indexOf(g);p>-1&&a.splice(p,1)}else l.add(g),a.push(g);s(l,a)}function h(g,p){const _=i(),S=(g-_.x)/_.k,I=(p-_.y)/_.k;for(let b=n.length-1;b>=0;b--){const E=n[b],O=S-E.x,x=I-E.y;if(Math.sqrt(O*O+x*x)<E.radius)return E}return null}function m(g,p){let _=null;g.on("mousedown",function(S){const[I,b]=nt(S),E=h(I,b);if(c){const O=i(),x=(I-O.x)/O.k,k=(b-O.y)/O.k;u={x1:x,y1:k,x2:x,y2:k},o()}else E&&(_=E,p.start(S,E))}),g.on("mousemove",function(S){const[I,b]=nt(S);if(c){if(u){const E=i(),O=(I-E.x)/E.k,x=(b-E.y)/E.k;u.x2=O,u.y2=x,o()}}else if(_)p.drag(S,_,I,b);else{const E=h(I,b);r.current!==E&&(r.current=E,g.style("cursor",E?"pointer":"default"),o())}}),g.on("mouseup",function(S){if(c){if(u){const I=Math.min(u.x1,u.x2),b=Math.min(u.y1,u.y2),E=Math.max(u.x1,u.x2),O=Math.max(u.y1,u.y2);l.clear(),a.length=0;const x=[];n.forEach(k=>{k.x>=I&&k.x<=E&&k.y>=b&&k.y<=O&&x.push({id:k.id,y:k.y})}),x.sort((k,M)=>k.y-M.y),x.forEach(({id:k})=>{l.add(k),a.push(k)}),s(l,a),u=null,o()}}else if(_)p.end(S,_),_=null;else{const[I,b]=nt(S),E=h(I,b);E&&f(E.id)}})}return{toggleSelectionMode:d,isSelectionMode:()=>c,setupInteractions:m,getSelectionRect:()=>u}}function bg(t,e,n,i,r,s,o){let l=null;function a(d,f){s()&&(d.active||n.alphaTarget(.3).restart(),l=f,f.fx=f.x,f.fy=f.y)}function c(d,f,h,m){if(!l||!s())return;const g=i();f.fx=(h-g.x)/g.k,f.fy=(m-g.y)/g.k,o()}function u(d,f){!l||!s()||(d.active||n.alphaTarget(0),f.fx=null,f.fy=null,l=null)}return{dragstarted:a,dragged:c,dragended:u}}function wg(t,e,n){const i=new Map(t.map(r=>[r.id,r]));return n.map(r=>i.get(r)).filter(Boolean)}const Ll=8,Sg=1.5,kg=50,Dl=.5,Eg=800,Cg=600;function Ig(t,e,n=null,i=null,r=null){const s=Eg/2,o=Cg/2,a=Je(t).append("svg").attr("class","network-svg"),c=a.append("g"),u=c.append("g").selectAll("line").data(n).join("line").attr("class","link").attr("stroke-width",m=>m.width||Sg).attr("stroke-opacity",m=>Math.max(.2,m.strength||Dl)),d=c.append("g").selectAll("circle").data(e).join("circle").attr("class","node").attr("r",m=>m.radius||Ll).attr("fill",m=>m.color);d.append("title").text(m=>m.label);const f=bl(e).force("link",vl(n).id(m=>m.id).distance(m=>m.distance||kg)).force("charge",wl().strength(-250)).force("center",dl(s,o).strength(.7)).force("collide",gl(m=>(m.radius||Ll)+10).strength(Dl)).force("x",Sl(s).strength(.025)).force("y",kl(o).strength(.025));let h=null;if(i){h=Mg({svg:a,g:c,nodes:e,onSelectionChange:(_,S)=>{d.classed("selected",b=>_.has(b.id));const I=Ag(e,_,S);i(I)}}),a.call(Pl().scaleExtent([.1,10]).filter(_=>!h.isSelectionMode()||_.type==="wheel").on("zoom",({transform:_})=>c.attr("transform",_)));const{dragstarted:m,dragged:g,dragended:p}=xg(f,u,d);h.setupNodeClick(d),h.setupDrag(d,{start:m,drag:g,end:p})}return{destroy:()=>{f.stop(),a.remove()},toggleSelectionMode:()=>{if(h){const m=h.toggleSelectionMode();return r&&r(m),m}}}}function Mg(t){const{svg:e,g:n,nodes:i,onSelectionChange:r,getNodePosition:s=g=>({x:g.x,y:g.y}),getNodeId:o=g=>g.id}=t,l=new Set,a=[];let c=!1;function u(){return c=!c,e.style("cursor",c?"crosshair":"default"),c}function d(g){if(l.has(g)){l.delete(g);const p=a.indexOf(g);p>-1&&a.splice(p,1)}else l.add(g),a.push(g);r(l,a)}function f(){l.clear(),a.length=0,r(l,a)}let h=null,m=null;return e.on("mousedown",function(g){if(!c)return;g.preventDefault();const[p,_]=nt(g,n.node());h={x:p,y:_},m=n.append("rect").attr("class","selection-rect").attr("x",p).attr("y",_).attr("width",0).attr("height",0)}).on("mousemove",function(g){if(!c||!m)return;const[p,_]=nt(g,n.node()),S=p-h.x,I=_-h.y;m.attr("x",S<0?p:h.x).attr("y",I<0?_:h.y).attr("width",Math.abs(S)).attr("height",Math.abs(I))}).on("mouseup",function(g){if(!c||!m)return;const[p,_]=nt(g,n.node()),S=Math.min(h.x,p),I=Math.min(h.y,_),b=Math.max(h.x,p),E=Math.max(h.y,_);l.clear(),a.length=0;const O=[];i.forEach(x=>{const k=s(x);k.x>=S&&k.x<=b&&k.y>=I&&k.y<=E&&O.push({id:o(x),y:k.y})}),O.sort((x,k)=>x.y-k.y),O.forEach(({id:x})=>{l.add(x),a.push(x)}),r(l,a),m.remove(),m=null,h=null}),{toggleSelectionMode:u,toggleNode:d,clearSelection:f,isSelectionMode:()=>c,getSelectedNodes:()=>l,getSelectionOrder:()=>a,setupNodeClick:g=>{g.on("click",function(p,_){p.stopPropagation(),d(o(_))})},setupDrag:(g,p)=>{g.call(Td().filter(()=>!c).on("start",p.start).on("drag",p.drag).on("end",p.end))}}}function xg(t,e,n){t.on("tick",()=>{e.attr("x1",o=>o.source.x).attr("y1",o=>o.source.y).attr("x2",o=>o.target.x).attr("y2",o=>o.target.y),n.attr("cx",o=>o.x).attr("cy",o=>o.y)});function i(o){o.active||t.alphaTarget(.3).restart(),o.subject.fx=o.subject.x,o.subject.fy=o.subject.y}function r(o){o.subject.fx=o.x,o.subject.fy=o.y}function s(o){o.active||t.alphaTarget(0),o.subject.fx=null,o.subject.fy=null}return{dragstarted:i,dragged:r,dragended:s}}function Ag(t,e,n){const i=new Map(t.map(r=>[r.id,r]));return n.map(r=>i.get(r)).filter(Boolean)}const Tg="modulepreload",Ng=function(t){return"/"+t},Rl={},os=function(e,n,i){return e()};function ls(t){const{type:e,modelName:n,title:i,extractMeta:r=h=>h}=t,s={id:null,type:e,title:i,selected:{}},o=JSON.parse(localStorage.getItem(e))||s,l=we(o),a=we(!1);function c(h,m=!1){a.set(m),localStorage.setItem(e,JSON.stringify(h))}function u(){l.update(h=>{if(e!=="documentSet")return console.error("Document set management is the only type currently supported for saving."),h;const m=Object.fromEntries(Object.entries(h.selected).map(([p,_])=>[p,Object.keys(_)])),g=h.id?`${h.id}/edit`:"new";return fetch(`${window.location.origin}/${n}/${g}`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":en},body:JSON.stringify({title:h.title,selection:h,...m})}).then(p=>p.json()).then(p=>{if(!(p!=null&&p.document_set_id))throw new Error("Failed to save");l.update(_=>(_.id=p.document_set_id,_.title=p.document_set_title,c(_,!0),_))}).catch(p=>console.error("Error:",p)),h})}const d=h=>l.update(()=>{const m=h.selection.id?h.selection:{...h.selection,id:h.id};return c(m),m}),f=()=>l.update(()=>{const h={...s,selected:{}};return c(h),h});return{type:e,subscribe:l.subscribe,add:h=>l.update(m=>(m.selected[h.class]={...m.selected[h.class]||{},[h.id]:r(h)},c(m),m)),addAll:h=>l.update(m=>(h.forEach(g=>{m.selected[g.class]={...m.selected[g.class]||{},[g.id]:r(g)}}),c(m),m)),remove:(h,m)=>l.update(g=>{const{[h]:p,..._}=g.selected[m];return g.selected[m]=_,c(g),g}),removeAll:(h,m)=>l.update(g=>(h.forEach(p=>{var _;return(_=g.selected[m])==null?!0:delete _[p]}),c(g),g)),toggle:h=>l.update(m=>{var g;if((g=m.selected[h.class])!=null&&g[h.id]){const{[h.id]:p,..._}=m.selected[h.class];m.selected[h.class]=_}else m.selected[h.class]={...m.selected[h.class]||{},[h.id]:r(h)};return c(m),m}),toggleSet:h=>{et(l).id===h.id?f():d(h)},empty:()=>l.update(h=>(h.id=null,h.title=i,h.selected={},c(h,!0),h)),updateTitle:h=>l.update(m=>(m.title=h,c(m,!0),m)),save:u,isSaved:a,selection:l,selectionTitle:Ue(l,h=>h.title),isSelected:Ue(l,h=>m=>{var g;return((g=h.selected[m.class])==null?void 0:g[m.id])||!1}),selected:Ue(l,h=>h.selected),nbSelected:Ue(l,h=>Object.values(h.selected).reduce((m,g)=>m+Object.keys(g).length,0)),isSetSelected:Ue(l,h=>m=>h.id===m.id)}}ls({type:"documentSet",modelName:"document-set",title:W==="en"?"Document set":"Set de documents",extractMeta:t=>({title:t.title,url:t.url})});const Og=ls({type:"regionsSet",modelName:"regions-set",title:W==="en"?"Regions set":"Set de régions",extractMeta:t=>t}),Zi=ls({type:"clusterSet",modelName:"cluster-set",title:W==="en"?"Selected regions":"Régions sélectionnées",extractMeta:t=>({imgRef:t.id,clusterId:t.clusterId,title:t.title,xywh:t.xywh,img:t.img})});function Pg(){const t=`${window.location.origin}${window.location.pathname}`,e=we(1),n=we({}),i=we({}),r=we("");wr(e,"p");function s(u){r.update(d=>{const f=d===u?"":u;return navigator.clipboard.writeText(f).then(h=>""),f})}const o=(async()=>{try{const u=await fetch(`${t}canvas`);if(!u.ok)return{};const d=await u.json();let f={};return Object.values(d).forEach(h=>{Object.entries(h).forEach(([m,g])=>{f[m]=g})}),n.set(f),d}catch{return{}}})(),l=Ue(e,u=>(async()=>{const f=await(await fetch(`${t}canvas?p=${u}`)).json();return i.set(f),f})());function a(u){Sr(u,e,"p")}function c(u){n.update(d=>(delete d[u],{...d})),i.update(d=>{for(const f in d)if(d[f][u]){const{[u]:h,...m}=d[f];return d[f]=m,d}return d})}return{currentPage:e,pageRegions:i,allRegions:n,fetchPages:l,fetchAll:o,handlePageUpdate:a,remove:c,clipBoard:r,copyRef:s}}const $l=Pg(),Iy="";function Lg(t){let e;return{c(){e=xt("path"),v(e,"d","M384 336H192c-8.8 0-16-7.2-16-16V64c0-8.8 7.2-16 16-16l140.1 0L400 115.9V320c0 8.8-7.2 16-16 16zM192 384H384c35.3 0 64-28.7 64-64V115.9c0-12.7-5.1-24.9-14.1-33.9L366.1 14.1c-9-9-21.2-14.1-33.9-14.1H192c-35.3 0-64 28.7-64 64V320c0 35.3 28.7 64 64 64zM64 128c-35.3 0-64 28.7-64 64V448c0 35.3 28.7 64 64 64H256c35.3 0 64-28.7 64-64V416H272v32c0 8.8-7.2 16-16 16H64c-8.8 0-16-7.2-16-16V192c0-8.8 7.2-16 16-16H96V128H64z"),v(e,"class","svelte-1829hp2")},m(n,i){j(n,e,i)},d(n){n&&z(e)}}}function Dg(t){let e;return{c(){e=xt("path"),v(e,"d","M208 0H332.1c12.7 0 24.9 5.1 33.9 14.1l67.9 67.9c9 9 14.1 21.2 14.1 33.9V336c0 26.5-21.5 48-48 48H208c-26.5 0-48-21.5-48-48V48c0-26.5 21.5-48 48-48zM48 128h80v64H64V448H256V416h64v48c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V176c0-26.5 21.5-48 48-48z"),v(e,"class","svelte-1829hp2")},m(n,i){j(n,e,i)},d(n){n&&z(e)}}}function Rg(t){let e=W==="en"?"Copy ID":"Copier l'ID",n;return{c(){n=ne(e)},m(i,r){j(i,n,r)},p:X,d(i){i&&z(n)}}}function $g(t){let e=W==="en"?"Copied!":"Copié !",n;return{c(){n=ne(e)},m(i,r){j(i,n,r)},p:X,d(i){i&&z(n)}}}function zl(t){let e,n,i;var r=t[7];function s(o){return{props:{mainImgItem:o[1],compareImgItem:o[14]}}}return r&&(e=_i(r,s(t))),{c(){e&&ae(e.$$.fragment),n=qe()},m(o,l){e&&oe(e,o,l),j(o,n,l),i=!0},p(o,l){const a={};if(l&2&&(a.mainImgItem=o[1]),l&128&&r!==(r=o[7])){if(e){ke();const c=e;K(c.$$.fragment,1,0,()=>{le(c,1)}),Ee()}r?(e=_i(r,s(o)),ae(e.$$.fragment),F(e.$$.fragment,1),oe(e,n.parentNode,n)):e=null}else r&&e.$set(a)},i(o){i||(e&&F(e.$$.fragment,o),i=!0)},o(o){e&&K(e.$$.fragment,o),i=!1},d(o){o&&z(n),e&&le(e,o)}}}function zg(t){let e,n,i,r,s,o,l,a,c,u,d,f,h,m,g,p,_,S,I,b,E,O,x;function k(D,A){return D[8]?Dg:Lg}let M=k(t),P=M(t);function L(D,A){return D[8]?$g:Rg}let q=L(t),R=q(t),C=t[7]&&zl(t);return{c(){e=w("div"),n=w("figure"),i=w("img"),s=U(),o=w("div"),l=w("span"),u=U(),d=w("div"),f=w("button"),h=xt("svg"),P.c(),m=U(),g=w("span"),R.c(),_=U(),C&&C.c(),v(i,"class","region-img svelte-1829hp2"),gt(i.src,r=t[9])||v(i,"src",r),v(i,"alt","Extracted region"),v(l,"class","overlay-desc"),v(o,"class","overlay is-center svelte-1829hp2"),v(n,"class",a="image card region-image "+(t[0]?"is-96x96":"")+" svelte-1829hp2"),v(n,"tabindex","-1"),v(n,"style",c=(t[2]==="full"?"height: 100%":`height: ${t[2]}px; min-width: ${t[2]}px`)+"; "+(t[3]?`border: 5px solid ${t[3]};`:"")),v(h,"xmlns","http://www.w3.org/2000/svg"),v(h,"viewBox","0 0 384 512"),v(h,"class","svelte-1829hp2"),v(g,"class","tooltip svelte-1829hp2"),v(f,"class","button tag svelte-1829hp2"),v(f,"style",p=t[6]?"":"display: none;"),v(d,"class","region-btn ml-1 svelte-1829hp2"),v(e,"class",S="region is-center "+(t[5]&&t[11](t[1])?"checked":"")+" svelte-1829hp2"),v(e,"style",I=t[2]==="full"?"height: 100%":"")},m(D,A){j(D,e,A),y(e,n),y(n,i),y(n,s),y(n,o),y(o,l),l.innerHTML=t[10],y(e,u),y(e,d),y(d,f),y(f,h),P.m(h,null),y(f,m),y(f,g),R.m(g,null),y(d,_),C&&C.m(d,null),E=!0,O||(x=[ge(n,"click",t[19]),ge(n,"keyup",jg),ge(f,"click",t[20])],O=!0)},p(D,[A]){t=D,(!E||A&512&&!gt(i.src,r=t[9]))&&v(i,"src",r),(!E||A&1024)&&(l.innerHTML=t[10]),(!E||A&1&&a!==(a="image card region-image "+(t[0]?"is-96x96":"")+" svelte-1829hp2"))&&v(n,"class",a),(!E||A&12&&c!==(c=(t[2]==="full"?"height: 100%":`height: ${t[2]}px; min-width: ${t[2]}px`)+"; "+(t[3]?`border: 5px solid ${t[3]};`:"")))&&v(n,"style",c),M!==(M=k(t))&&(P.d(1),P=M(t),P&&(P.c(),P.m(h,null))),q===(q=L(t))&&R?R.p(t,A):(R.d(1),R=q(t),R&&(R.c(),R.m(g,null))),(!E||A&64&&p!==(p=t[6]?"":"display: none;"))&&v(f,"style",p),t[7]?C?(C.p(t,A),A&128&&F(C,1)):(C=zl(t),C.c(),F(C,1),C.m(d,null)):C&&(ke(),K(C,1,1,()=>{C=null}),Ee()),(!E||A&2082&&S!==(S="region is-center "+(t[5]&&t[11](t[1])?"checked":"")+" svelte-1829hp2"))&&v(e,"class",S),(!E||A&4&&I!==(I=t[2]==="full"?"height: 100%":""))&&v(e,"style",I)},i(D){E||(F(C),qt(()=>{E&&(b||(b=Zt(e,Mn,{duration:t[15]},!0)),b.run(1))}),E=!0)},o(D){K(C),b||(b=Zt(e,Mn,{duration:t[15]},!1)),b.run(0),E=!1},d(D){D&&z(e),P.d(),R.d(),C&&C.d(),D&&b&&b.end(),O=!1,Ge(x)}}}const jg=()=>null;function Fg(t,e,n){let i,r,s,o,l,{selectionStore:a}=e;a||(a=Og);const{isSelected:c}=a;de(t,c,M=>n(11,l=M));const{clipBoard:u}=$l;de(t,u,M=>n(18,o=M));let{item:d}=e,{descPromise:f=void 0}=e,{isSquare:h=!0}=e,{height:m=h?96:140}=e;m==="full"&&(h=!1);let{borderColor:g=null}=e,{toggleSelection:p=a.toggle}=e;const _=_t("qImgMetadata")||void 0,S=_t("isInModal")||!1,I=S?0:500;let b;S||os(()=>Promise.resolve().then(()=>$0),void 0).then(M=>n(7,b=M.default));let{selectable:E=!S}=e,{copyable:O=!0}=e;const x=()=>E?p(d):null,k=()=>O?$l.copyRef(d.ref):null;return t.$$set=M=>{"selectionStore"in M&&n(16,a=M.selectionStore),"item"in M&&n(1,d=M.item),"descPromise"in M&&n(17,f=M.descPromise),"isSquare"in M&&n(0,h=M.isSquare),"height"in M&&n(2,m=M.height),"borderColor"in M&&n(3,g=M.borderColor),"toggleSelection"in M&&n(4,p=M.toggleSelection),"selectable"in M&&n(5,E=M.selectable),"copyable"in M&&n(6,O=M.copyable)},t.$$.update=()=>{t.$$.dirty&2&&n(10,i=d.title),t.$$.dirty&131072&&f&&f.then(M=>n(10,i=M)),t.$$.dirty&7&&n(9,r=Rt(d.img??d.ref,d.xywh,m==="full"?m:h?`${m},`:`,${m}`)),t.$$.dirty&262146&&n(8,s=d.ref===o)},[h,d,m,g,p,E,O,b,s,r,i,l,c,u,_,I,a,f,o,x,k]}class Dn extends ye{constructor(e){super(),ve(this,e,Fg,zg,pe,{selectionStore:16,item:1,descPromise:17,isSquare:0,height:2,borderColor:3,toggleSelection:4,selectable:5,copyable:6})}}const My="";function jl(t,e,n){const i=t.slice();return i[11]=e[n],i}function Fl(t,e,n){const i=t.slice();return i[14]=e[n],i}function as(t){const e=t.slice(),n=e[2].get(e[11][e[14]].id);return e[17]=n,e}function Vl(t,e,n){const i=t.slice();return i[14]=e[n],i}function Hl(t){let e,n,i,r,s,o,l,a,c,u,d=t[0].regions,f=[];for(let _=0;_<d.length;_+=1)f[_]=Ul(Vl(t,d,_));const h=_=>K(f[_],1,1,()=>{f[_]=null});let m=t[0].rows,g=[];for(let _=0;_<m.length;_+=1)g[_]=Kl(jl(t,m,_));const p=_=>K(g[_],1,1,()=>{g[_]=null});return{c(){e=w("div"),n=w("h3"),n.textContent="Aligned Documents",i=U(),r=w("div"),s=w("table"),o=w("thead"),l=w("tr");for(let _=0;_<f.length;_+=1)f[_].c();a=U(),c=w("tbody");for(let _=0;_<g.length;_+=1)g[_].c();v(n,"class","title is-5"),v(o,"class","region-header svelte-1hxxzoa"),v(s,"class","table is-fullwidth svelte-1hxxzoa"),v(r,"class","table-container svelte-1hxxzoa"),v(e,"class","box mt-4")},m(_,S){j(_,e,S),y(e,n),y(e,i),y(e,r),y(r,s),y(s,o),y(o,l);for(let I=0;I<f.length;I+=1)f[I]&&f[I].m(l,null);y(s,a),y(s,c);for(let I=0;I<g.length;I+=1)g[I]&&g[I].m(c,null);u=!0},p(_,S){if(S&3){d=_[0].regions;let I;for(I=0;I<d.length;I+=1){const b=Vl(_,d,I);f[I]?(f[I].p(b,S),F(f[I],1)):(f[I]=Ul(b),f[I].c(),F(f[I],1),f[I].m(l,null))}for(ke(),I=d.length;I<f.length;I+=1)h(I);Ee()}if(S&77){m=_[0].rows;let I;for(I=0;I<m.length;I+=1){const b=jl(_,m,I);g[I]?(g[I].p(b,S),F(g[I],1)):(g[I]=Kl(b),g[I].c(),F(g[I],1),g[I].m(c,null))}for(ke(),I=m.length;I<g.length;I+=1)p(I);Ee()}},i(_){if(!u){for(let S=0;S<d.length;S+=1)F(f[S]);for(let S=0;S<m.length;S+=1)F(g[S]);u=!0}},o(_){f=f.filter(Boolean);for(let S=0;S<f.length;S+=1)K(f[S]);g=g.filter(Boolean);for(let S=0;S<g.length;S+=1)K(g[S]);u=!1},d(_){_&&z(e),Ye(f,_),Ye(g,_)}}}function Ul(t){let e,n,i,r;return n=new Er({props:{id:t[14],meta:t[1].get(t[14])||{},clickable:!1}}),{c(){e=w("th"),ae(n.$$.fragment),i=U(),v(e,"class","is-vcentered")},m(s,o){j(s,e,o),oe(n,e,null),y(e,i),r=!0},p(s,o){const l={};o&1&&(l.id=s[14]),o&3&&(l.meta=s[1].get(s[14])||{}),n.$set(l)},i(s){r||(F(n.$$.fragment,s),r=!0)},o(s){K(n.$$.fragment,s),r=!1},d(s){s&&z(e),le(n)}}}function Bl(t){let e,n,i,r,s=t[11][t[14]].page+"",o,l;return e=new Dn({props:{item:t[17],selectable:!1,copyable:!1,borderColor:t[6](t[11][t[14]],t[3]),isSquare:!1}}),{c(){ae(e.$$.fragment),n=U(),i=w("div"),r=ne("Page "),o=ne(s),v(i,"class","has-text-grey-dark mt-2")},m(a,c){oe(e,a,c),j(a,n,c),j(a,i,c),y(i,r),y(i,o),l=!0},p(a,c){const u={};c&5&&(u.item=a[17]),c&9&&(u.borderColor=a[6](a[11][a[14]],a[3])),e.$set(u),(!l||c&1)&&s!==(s=a[11][a[14]].page+"")&&_e(o,s)},i(a){l||(F(e.$$.fragment,a),l=!0)},o(a){K(e.$$.fragment,a),l=!1},d(a){le(e,a),a&&z(n),a&&z(i)}}}function ql(t){let e,n,i=t[11][t[14]]&&Bl(as(t));return{c(){e=w("td"),i&&i.c(),v(e,"class","has-text-centered"),De(e,"vertical-align","top")},m(r,s){j(r,e,s),i&&i.m(e,null),n=!0},p(r,s){r[11][r[14]]?i?(i.p(as(r),s),s&1&&F(i,1)):(i=Bl(as(r)),i.c(),F(i,1),i.m(e,null)):i&&(ke(),K(i,1,1,()=>{i=null}),Ee())},i(r){n||(F(i),n=!0)},o(r){K(i),n=!1},d(r){r&&z(e),i&&i.d()}}}function Kl(t){let e,n,i,r=t[0].regions,s=[];for(let l=0;l<r.length;l+=1)s[l]=ql(Fl(t,r,l));const o=l=>K(s[l],1,1,()=>{s[l]=null});return{c(){e=w("tr");for(let l=0;l<s.length;l+=1)s[l].c();n=U()},m(l,a){j(l,e,a);for(let c=0;c<s.length;c+=1)s[c]&&s[c].m(e,null);y(e,n),i=!0},p(l,a){if(a&77){r=l[0].regions;let c;for(c=0;c<r.length;c+=1){const u=Fl(l,r,c);s[c]?(s[c].p(u,a),F(s[c],1)):(s[c]=ql(u),s[c].c(),F(s[c],1),s[c].m(e,n))}for(ke(),c=r.length;c<s.length;c+=1)o(c);Ee()}},i(l){if(!i){for(let a=0;a<r.length;a+=1)F(s[a]);i=!0}},o(l){s=s.filter(Boolean);for(let a=0;a<s.length;a+=1)K(s[a]);i=!1},d(l){l&&z(e),Ye(s,l)}}}function Vg(t){let e,n,i=t[0]&&Hl(t);return{c(){i&&i.c(),e=qe()},m(r,s){i&&i.m(r,s),j(r,e,s),n=!0},p(r,[s]){r[0]?i?(i.p(r,s),s&1&&F(i,1)):(i=Hl(r),i.c(),F(i,1),i.m(e.parentNode,e)):i&&(ke(),K(i,1,1,()=>{i=null}),Ee())},i(r){n||(F(i),n=!0)},o(r){K(i),n=!1},d(r){i&&i.d(r),r&&z(e)}}}function Hg(t){let e=0;for(let o=0;o<t.length;o++)e=t.charCodeAt(o)+((e<<5)-e),e=e&e;const i=e*.618033988749895%1*360,r=65+e%20,s=80+e%10;return`hsl(${Math.floor(i)}, ${r}%, ${s}%)`}function Ug(t,e,n){let i,r,s,{selectedDocuments:o=[]}=e,{documentSetStore:l}=e;const{buildAlignedImageMatrix:a,documentNodes:c,imageNodes:u}=l;de(t,c,m=>n(1,r=m)),de(t,u,m=>n(2,s=m));let d=null;function f(m,g){if(!m)return;const p=m.id;if(g.get(p)!==1)return h.has(p)||h.set(p,Hg(p)),h.get(p)}const h=new Map;return t.$$set=m=>{"selectedDocuments"in m&&n(7,o=m.selectedDocuments),"documentSetStore"in m&&n(8,l=m.documentSetStore)},t.$$.update=()=>{if(t.$$.dirty&134)if(o.length>0&&s&&r){const m=o.map(g=>g.id);n(0,d=a(m))}else n(0,d=null);t.$$.dirty&1&&n(3,i=d?(()=>{const m=new Map;return d.rows.forEach(g=>{Object.values(g).forEach(p=>{m.set(p.id,(m.get(p.id)||0)+1)})}),m})():new Map)},[d,r,s,i,c,u,f,o,l]}class Bg extends ye{constructor(e){super(),ve(this,e,Ug,Vg,pe,{selectedDocuments:7,documentSetStore:8})}}const xy="";function Wl(t,e,n){const i=t.slice();return i[15]=e[n],i}function qg(t){let e;return{c(){e=w("span"),e.innerHTML='<i class="fas fa-crop-alt"></i>',v(e,"class","icon px-4")},m(n,i){j(n,e,i)},d(n){n&&z(e)}}}function Kg(t){let e;return{c(){e=w("span"),e.innerHTML='<i class="fas fa-hand-pointer"></i>',v(e,"class","icon px-4")},m(n,i){j(n,e,i)},d(n){n&&z(e)}}}function Gl(t){let e,n,i,r;const s=[Gg,Wg],o=[];function l(a,c){return a[0]==="img"?0:a[0]==="doc"?1:-1}return~(e=l(t))&&(n=o[e]=s[e](t)),{c(){n&&n.c(),i=qe()},m(a,c){~e&&o[e].m(a,c),j(a,i,c),r=!0},p(a,c){let u=e;e=l(a),e===u?~e&&o[e].p(a,c):(n&&(ke(),K(o[u],1,1,()=>{o[u]=null}),Ee()),~e?(n=o[e],n?n.p(a,c):(n=o[e]=s[e](a),n.c()),F(n,1),n.m(i.parentNode,i)):n=null)},i(a){r||(F(n),r=!0)},o(a){K(n),r=!1},d(a){~e&&o[e].d(a),a&&z(i)}}}function Wg(t){let e,n;return e=new Bg({props:{selectedDocuments:t[5],documentSetStore:t[1]}}),{c(){ae(e.$$.fragment)},m(i,r){oe(e,i,r),n=!0},p(i,r){const s={};r&32&&(s.selectedDocuments=i[5]),r&2&&(s.documentSetStore=i[1]),e.$set(s)},i(i){n||(F(e.$$.fragment,i),n=!0)},o(i){K(e.$$.fragment,i),n=!1},d(i){le(e,i)}}}function Gg(t){let e,n,i=W==="en"?"Selected regions":"Régions sélectionnées",r,s,o=t[5].length+"",l,a,c,u,d=[],f=new Map,h,m=t[5];const g=p=>p[15].id;for(let p=0;p<m.length;p+=1){let _=Wl(t,m,p),S=g(_);f.set(S,d[p]=Yl(S,_))}return{c(){e=w("div"),n=w("h3"),r=ne(i),s=ne(" ("),l=ne(o),a=ne(")"),c=U(),u=w("div");for(let p=0;p<d.length;p+=1)d[p].c();v(n,"class","title is-5"),v(u,"class","selected-nodes grid is-gap-2 mt-5 svelte-1a3kdxu"),v(e,"class","selected-panel box mt-4 svelte-1a3kdxu")},m(p,_){j(p,e,_),y(e,n),y(n,r),y(n,s),y(n,l),y(n,a),y(e,c),y(e,u);for(let S=0;S<d.length;S+=1)d[S]&&d[S].m(u,null);h=!0},p(p,_){(!h||_&32)&&o!==(o=p[5].length+"")&&_e(l,o),_&32&&(m=p[5],ke(),d=_r(d,_,g,1,p,m,f,u,gr,Yl,null,Wl),Ee())},i(p){if(!h){for(let _=0;_<m.length;_+=1)F(d[_]);h=!0}},o(p){for(let _=0;_<d.length;_+=1)K(d[_]);h=!1},d(p){p&&z(e);for(let _=0;_<d.length;_+=1)d[_].d()}}}function Yl(t,e){let n,i,r;return i=new Dn({props:{item:e[15],selectable:!1,copyable:!1}}),{key:t,first:null,c(){n=qe(),ae(i.$$.fragment),this.first=n},m(s,o){j(s,n,o),oe(i,s,o),r=!0},p(s,o){e=s;const l={};o&32&&(l.item=e[15]),i.$set(l)},i(s){r||(F(i.$$.fragment,s),r=!0)},o(s){K(i.$$.fragment,s),r=!1},d(s){s&&z(n),le(i,s)}}}function Yg(t){let e,n,i,r=t[3]?"click":"selection",s,o,l,a,c,u,d,f;function h(_,S){return _[3]?Kg:qg}let m=h(t),g=m(t),p=t[5].length>0&&Gl(t);return{c(){e=w("div"),n=w("button"),g.c(),i=ne(`
        Switch to `),s=ne(r),o=ne(" mode"),l=U(),a=w("div"),c=U(),p&&p.c(),v(n,"class","toggle-button button is-small is-link mb-3"),v(a,"class","visualization-container")},m(_,S){j(_,e,S),y(e,n),g.m(n,null),y(n,i),y(n,s),y(n,o),y(e,l),y(e,a),t[9](a),y(e,c),p&&p.m(e,null),u=!0,d||(f=ge(n,"click",t[7]),d=!0)},p(_,[S]){m!==(m=h(_))&&(g.d(1),g=m(_),g&&(g.c(),g.m(n,i))),(!u||S&8)&&r!==(r=_[3]?"click":"selection")&&_e(s,r),_[5].length>0?p?(p.p(_,S),S&32&&F(p,1)):(p=Gl(_),p.c(),F(p,1),p.m(e,null)):p&&(ke(),K(p,1,1,()=>{p=null}),Ee())},i(_){u||(F(p),u=!0)},o(_){K(p),u=!1},d(_){_&&z(e),g.d(),t[9](null),p&&p.d(),d=!1,f()}}}const Xg=1e3;function Jg(t,e,n){let i,r,s=X,o=()=>(s(),s=di(i,b=>n(8,r=b)),i),l;t.$$.on_destroy.push(()=>s());let{type:a="img"}=e,{documentSetStore:c}=e;const{imageNetwork:u,documentNetwork:d,selectedNodes:f,updateSelectedNodes:h}=c;de(t,f,b=>n(5,l=b));let m,g,p=!1;function _(){m&&(m.destroy(),h([]));function b(O){h(O)}m=(r.nodes.length<Xg?Ig:vg)(g,r.nodes,r.links,b,O=>{n(3,p=O)}),n(3,p=a==="img"),p&&m.toggleSelectionMode()}function S(){m&&n(3,p=m.toggleSelectionMode())}Un(()=>{m==null||m.destroy()});function I(b){kn[b?"unshift":"push"](()=>{g=b,n(2,g)})}return t.$$set=b=>{"type"in b&&n(0,a=b.type),"documentSetStore"in b&&n(1,c=b.documentSetStore)},t.$$.update=()=>{t.$$.dirty&1&&o(n(4,i=a==="img"?u:d)),t.$$.dirty&260&&r&&g&&_()},[a,c,g,p,i,l,f,S,r,I]}class Qg extends ye{constructor(e){super(),ve(this,e,Jg,Yg,pe,{type:0,documentSetStore:1})}}const Ay="";function Xl(t,e,n){const i=t.slice();return i[20]=e[n],i[22]=n,i}function Zg(t){let e,n,i,r,s,o,l,a,c,u,d,f=t[3],h=[];for(let p=0;p<f.length;p+=1)h[p]=Jl(Xl(t,f,p));const m=p=>K(h[p],1,1,()=>{h[p]=null});let g=t[2]&&Ql(t);return{c(){e=w("div"),n=w("h3"),n.textContent="Similarity Matrix",i=U(),r=w("div"),s=w("div"),o=w("div");for(let p=0;p<h.length;p+=1)h[p].c();l=U(),a=w("div"),c=U(),g&&g.c(),u=qe(),v(n,"class","title is-5"),v(o,"class","row-headers svelte-naitnw"),v(a,"class","matrix-container svelte-naitnw"),v(s,"class","matrix-content svelte-naitnw"),v(r,"class","matrix-wrapper svelte-naitnw"),v(e,"class","matrix-panel column svelte-naitnw")},m(p,_){j(p,e,_),y(e,n),y(e,i),y(e,r),y(r,s),y(s,o);for(let S=0;S<h.length;S+=1)h[S]&&h[S].m(o,null);y(s,l),y(s,a),t[13](a),j(p,c,_),g&&g.m(p,_),j(p,u,_),d=!0},p(p,_){if(_&8){f=p[3];let S;for(S=0;S<f.length;S+=1){const I=Xl(p,f,S);h[S]?(h[S].p(I,_),F(h[S],1)):(h[S]=Jl(I),h[S].c(),F(h[S],1),h[S].m(o,null))}for(ke(),S=f.length;S<h.length;S+=1)m(S);Ee()}p[2]?g?g.p(p,_):(g=Ql(p),g.c(),g.m(u.parentNode,u)):g&&(g.d(1),g=null)},i(p){if(!d){for(let _=0;_<f.length;_+=1)F(h[_]);d=!0}},o(p){h=h.filter(Boolean);for(let _=0;_<h.length;_+=1)K(h[_]);d=!1},d(p){p&&z(e),Ye(h,p),t[13](null),p&&z(c),g&&g.d(p),p&&z(u)}}}function e_(t){let e;return{c(){e=w("div"),e.textContent="Aucun document disponible pour afficher la matrice de similarité.",v(e,"class","notification is-info")},m(n,i){j(n,e,i)},p:X,i:X,o:X,d(n){n&&z(e)}}}function Jl(t){let e,n,i,r;return n=new Er({props:{id:t[20].id,meta:t[20],onlyColor:!0,clickable:!1}}),{c(){e=w("div"),ae(n.$$.fragment),i=U(),v(e,"class","row-header svelte-naitnw"),De(e,"height",sn+"px"),De(e,"line-height",sn+"px")},m(s,o){j(s,e,o),oe(n,e,null),y(e,i),r=!0},p(s,o){const l={};o&8&&(l.id=s[20].id),o&8&&(l.meta=s[20]),n.$set(l)},i(s){r||(F(n.$$.fragment,s),r=!0)},o(s){K(n.$$.fragment,s),r=!1},d(s){s&&z(e),le(n)}}}function Ql(t){let e,n,i,r;return{c(){e=w("div"),n=w("h3"),n.textContent="Page-by-page similarity",i=U(),r=w("div"),v(n,"class","title is-5"),v(r,"class","scatter-container svelte-naitnw"),v(e,"class","scatter-panel column svelte-naitnw")},m(s,o){j(s,e,o),y(e,n),y(e,i),y(e,r),t[14](r)},p:X,d(s){s&&z(e),t[14](null)}}}function t_(t){let e,n,i,r;const s=[e_,Zg],o=[];function l(a,c){return a[3].length?1:0}return n=l(t),i=o[n]=s[n](t),{c(){e=w("div"),i.c(),v(e,"class","document-matrix columns svelte-naitnw")},m(a,c){j(a,e,c),o[n].m(e,null),r=!0},p(a,[c]){let u=n;n=l(a),n===u?o[n].p(a,c):(ke(),K(o[u],1,1,()=>{o[u]=null}),Ee(),i=o[n],i?i.p(a,c):(i=o[n]=s[n](a),i.c()),F(i,1),i.m(e,null))},i(a){r||(F(i),r=!0)},o(a){K(i),r=!1},d(a){a&&z(e),o[n].d()}}}const sn=30;function n_(t,e){const n=[];let i=0;e.forEach(({score:r})=>{r>i&&(i=r)});for(let r=0;r<t.length;r++){const s=[];for(let o=0;o<t.length;o++)if(r===o)s.push({score:0,normalized:0,isDiagonal:!0});else{const{r1:l,r2:a}={r1:t[r].id,r2:t[o].id},c=l<a?`${l}-${a}`:`${a}-${l}`,u=e.get(c),d=(u==null?void 0:u.score)||0,f=i>0?d/i*100:0;s.push({score:d,normalized:f,isDiagonal:!1})}n.push(s)}return{docs:t,matrix:n,max:i}}function i_(t,e,n=.05,i=1){const{min:r,_:s,range:o}=e;return o===0?.55:n+Math.pow((t-r)/o,3)*i}function r_(t,e,n){let i,r,s,o,l,a,c,{documentSetStore:u}=e;const{documentNodes:d,docPairStats:f,pairIndex:h,selectedCategories:m}=u;de(t,d,x=>n(12,c=x)),de(t,f,x=>n(11,a=x)),de(t,h,x=>n(16,l=x)),de(t,m,x=>n(15,o=x));let g,p,_=null;function S(x){const{doc1:k,doc2:M}=x,P=k.id<M.id?`${k.id}-${M.id}`:`${M.id}-${k.id}`,L=l.byDocPair.get(P)||[];if(!L.length)return null;const q=new Map;let R=1/0,C=-1/0;return L.forEach(A=>{let V,B,H;A.regions_id_1===k.id?(V=A.page_1,B=A.page_2,H=A.weightedScore||0):(V=A.page_2,B=A.page_1,H=A.weightedScore||0);const Y=`${V}-${B}`;q.has(Y)||q.set(Y,{page1:V,page2:B,scores:[],count:0});const Z=q.get(Y);Z.scores.push(H),Z.count++,H<R&&(R=H),H>C&&(C=H)}),{points:Array.from(q.values()).map(({page1:A,page2:V,scores:B,count:H})=>{const Y=B.reduce((Z,re)=>Z+re,0)/H;return{page1:A,page2:V,score:Y,count:H}}),minScore:R,maxScore:C,doc1:k,doc2:M}}function I(x,k){if(!x||!k.docs.length)return;Je(x).selectAll("*").remove();const M={top:10,right:20,bottom:20,left:10},P=k.docs.length*sn+M.left+M.right,L=k.docs.length*sn+M.top+M.bottom;Je(x).append("svg").attr("width",P).attr("height",L).append("g").attr("transform",`translate(${M.left},${M.top})`).selectAll(".row").data(k.matrix).join("g").attr("class","row").attr("transform",(D,A)=>`translate(0,${A*sn})`).selectAll(".cell").data((D,A)=>D.map((V,B)=>({...V,row:A,col:B}))).join("rect").attr("class","cell").attr("x",D=>D.col*sn).attr("width",sn).attr("height",sn).attr("fill",D=>{if(D.isDiagonal)return"#e0e0e0";const A=jr(233,.951,.52);return A.opacity=D.normalized/100,A}).attr("stroke",D=>_&&_.row===D.row&&_.col===D.col?"#000":"#fff").attr("stroke-width",D=>_&&_.row===D.row&&_.col===D.col?4:1).attr("stroke-opacity",D=>_&&_.row===D.row&&_.col===D.col?1:.3).style("cursor","pointer").on("click",(D,A)=>{n(2,_={row:A.row,col:A.col,doc1:k.docs[A.row],doc2:k.docs[A.col]}),I(x,k)})}function b(x,k){if(!x)return;if(Je(x).selectAll("*").remove(),!k||!k.points.length){Je(x).append("div").style("padding","2rem").style("text-align","center").style("color","#999").text("Aucune paire de pages trouvée entre ces deux documents.");return}const M={top:40,right:20,bottom:50,left:60},P=500-M.left-M.right,L=500-M.top-M.bottom,R=Je(x).append("svg").attr("width",P+M.left+M.right).attr("height",L+M.top+M.bottom).append("g").attr("transform",`translate(${M.left},${M.top})`),C=Math.max(...k.points.map(H=>H.page1),0),D=Math.max(...k.points.map(H=>H.page2),0),A=is().domain([0,C]).range([0,P]),V=is().domain([0,D]).range([L,0]);R.append("g").attr("transform",`translate(0,${L})`).call(Vf(A).ticks(Math.min(C+1,10)).tickFormat(Ji("d"))),R.append("g").call(Hf(V).ticks(Math.min(D+1,10)).tickFormat(Ji("d"))),R.append("foreignObject").attr("x",0).attr("y",L+10).attr("width",P).attr("height",100).append("xhtml:div").style("display","flex").style("align-items","center").style("justify-content","center").style("gap","0.5rem").style("margin-top","20px").html(`<span class="legend-color" style="background-color: ${k.doc1.color}; width: 12px; height: 12px; display: inline-block; border-radius: 50%;"></span>
                <span style="font-size: 12px;">${br(k.doc1.title)||`Doc ${k.doc1.id}`} (page)</span>`),R.append("foreignObject").attr("x",-M.left+5).attr("y",0).attr("width",50).attr("height",P).append("xhtml:div").style("display","flex").style("align-items","center").style("justify-content","center").style("gap","0.5rem").style("transform",`rotate(-90deg) translateX(-${L/2}px)`).style("transform-origin","left top").style("white-space","nowrap").html(`<span class="legend-color" style="background-color: ${k.doc2.color}; width: 12px; height: 12px; display: inline-block; border-radius: 50%;"></span>
                <span style="font-size: 12px;">${br(k.doc2.title)||`Doc ${k.doc2.id}`} (page)</span>`);const B=k.maxScore-k.minScore;R.selectAll(".point").data(k.points).join("rect").attr("class","point").attr("x",H=>A(H.page1)-4).attr("y",H=>V(H.page2)-4).attr("width",8).attr("height",8).attr("fill",jr(233,.951,.52)).attr("opacity",H=>{const Y=o||[];return Y.length===1&&Y[0]===1?1:i_(H.score,{min:k.minScore,max:k.maxScore,range:B})})}function E(x){kn[x?"unshift":"push"](()=>{g=x,n(0,g)})}function O(x){kn[x?"unshift":"push"](()=>{p=x,n(1,p)})}return t.$$set=x=>{"documentSetStore"in x&&n(8,u=x.documentSetStore)},t.$$.update=()=>{t.$$.dirty&4096&&n(3,i=Array.from((c==null?void 0:c.values())||[])),t.$$.dirty&2056&&n(9,r=n_(i,a.scoreCount)),t.$$.dirty&4&&n(10,s=_?S(_):null),t.$$.dirty&1026&&p&&s&&b(p,s),t.$$.dirty&513&&g&&r&&I(g,r)},[g,p,_,i,d,f,h,m,u,r,s,a,c,E,O]}class s_ extends ye{constructor(e){super(),ve(this,e,r_,t_,pe,{documentSetStore:8})}}const Zl="https://vhs.huma-num.fr",o_=()=>new Worker("/static/js/pairWorker.js",{type:"module"});function l_(t){const e=we(null),n=we([1]),i=we(new Set),r=we([]),s=we(0),o=we(null),l=we(!1),a=we([]),c=we(new Map);let u;const d=we({byImage:new Map,byDocPair:new Map,byDoc:new Map}),f=we(new Map),h=we(new Map),m=we({}),g=we({}),p=we({}),_=we({}),S=we({documents:0,pairs:null,images:0,categories:{}}),I=Ue(n,(C,D)=>{u&&u.terminate();const A=414,V=new Promise((B,H)=>{(async()=>{try{const Z=await fetch(`${Zl}/document-set/${A}/pairs?category=${C.join(",")}`);if(!Z.ok)throw new Error(`HTTP ${Z.status}`);const re=await Z.json();u=o_(),u.postMessage({rawPairs:re,selectedCategories:C}),u.onmessage=async fe=>{const{allPairs:te,imageNodes:ce,pairIndex:ie,categories:Me,stats:be}=fe.data;d.set(ie),m.set(be.pairStats),g.set(be.documentStats),p.set(be.imageStats),_.set(be.docPairStats);const Ve=Array.from(be.documentStats.scoreCount.keys());et(i).size===0&&i.set(new Set(Ve));const Re=await Promise.all(Ve.map(Le=>b(Le).then(je=>({id:Le,info:je})))),Oe=new Map;Re.forEach(({id:Le,info:je})=>Oe.set(Le,je)),c.set(Oe);const ot=new Map;Ve.forEach((Le,je)=>{const Ht=Oe.get(Le)||{};ot.set(Le,{id:Le,title:Ht.title||`Region Extraction ${Le}`,color:Ht.color||tu(je),images:[],...Ht})}),ce.forEach(Le=>{const je=ot.get(Le.regionId);je&&(Le.color=je.color,Le.title=`${je.title} | Page ${Le.canvas}`,je.images.push(Le))}),ot.forEach(Le=>Le.images.sort((je,Ht)=>je.canvas-Ht.canvas)),f.set(ce),h.set(ot),S.set({documents:Ve.length,pairs:te.length,images:ce.size,categories:Me}),a.set(te),u.terminate(),u=null,B(te.length)},u.onerror=fe=>{console.error("Worker error",fe);const te=`Error processing pairs: ${fe.message}`;e.set(te),H(new Error(te))}}catch(Z){const re=`Fetch error: ${Z.message}`;e.set(re),H(new Error(re))}})()});D(V)});async function b(C){try{const D=await fetch(`${Zl}/search/regions/?id=${C}`);if(!D.ok)throw new Error(`HTTP ${D.status}`);const{results:A}=await D.json();if(!(A!=null&&A.length))return{title:`Region Extraction ${C}`};const V=A[0],[,...B]=V.title.split(" | "),[H,Y]=(V.ref||"_").split("_");return{title:B.join(" | "),ref:V.ref,witnessId:yr(H),digitizationRef:Y,zeros:V.zeros,img_nb:V.img_nb,url:V.url}}catch(D){return e.set(`Error fetching region #${C}: ${D.message}`),{title:`Region Extraction ${C}`}}}const E=Ue([a,s,o,l,i],([C,D,A,V,B])=>{if(!C)return[];const H=[];for(let Y=0;Y<C.length;Y++){const Z=C[Y];if(Z.weightedScore<D)break;if(!(!B.has(Z.regions_id_1)||!B.has(Z.regions_id_2))){if(A!==null){if(V){if(Z.rank_1>A||Z.rank_2>A)continue}else if(Z.rank_1>A&&Z.rank_2>A)continue}H.push(Z)}}return H}),O=Ue([E,h],([C,D])=>{if(!C.length||D.size===0)return[];const A=new Set;for(const B of C)A.add(B.regions_id_1),A.add(B.regions_id_2);const V=[];return A.forEach(B=>{const H=D.get(B);H&&V.push(H)}),V.sort((B,H)=>H.id-B.id)});function x(C,D,A=10,V=200,B=2,H=25){if(!D)return{strength:.5,distance:100,width:2};const{min:Y,_:Z,range:re}=D,fe=re===0?.5:(C-Y)/re,te=V-fe*(V-A),ce=B+fe*(H-B);return{strength:fe,distance:te,width:ce}}function k(C,D,A=10,V=60){if(!D)return A;const{min:B,_:H,range:Y}=D;return Y===0?(A+V)/2:A+(C-B)/Y*(V-A)}const M=Ue([E],([C])=>{var Z;const D=et(f),A=et(p),V=et(m),B=new Set,H=[];for(const re of C){const{strength:fe,distance:te,width:ce}=x(re.weightedScore,V.scoreRange);H.push({source:re.id_1,target:re.id_2,strength:fe,distance:te,width:ce}),B.has(re.id_1)||B.add(re.id_1),B.has(re.id_2)||B.add(re.id_2)}const Y=[];for(const re of B){const fe=D.get(re);if(fe){const te=(Z=A.scoreCount)==null?void 0:Z.get(re),{count:ce,score:ie}=te;Y.push({...fe,radius:k(ie,A.scoreRange),label:`Region: ${fe.regionId}
Page: ${fe.canvas}
Connections: ${ce}
Total score: ${ie.toFixed(2)}`})}}return{nodes:Y,links:H}}),P=Ue(O,C=>{const D=et(_),A=et(g);if(C.size===0)return{nodes:[],links:[]};const V=Array.from(C.values()).map(H=>{var fe;const Y=(fe=A.scoreCount)==null?void 0:fe.get(H.id),{count:Z,score:re}=Y;return{...H,radius:k(Z,A.countRange),label:`${H.title}
Images: ${Z}
Total score: ${re.toFixed(2)}`}}),B=Array.from(D.scoreCount.entries()).map(([H,Y])=>{const[Z,re]=H.split("-").map(Number),{strength:fe,distance:te,width:ce}=x(Y.score,D.scoreRange);return{source:Z,target:re,strength:fe,distance:te,width:ce}});return{nodes:V,links:B}});function L(C){if(!C.length)return{regions:[],rows:[]};const D=et(h),A=et(d),V=C[0],B=D.get(V);if(!(B!=null&&B.images))return{regions:C,rows:[]};const H=B.images,Y=(te,ce,ie)=>{const{r1:Me,r2:be}={r1:ce,r2:ie},Ve=Me<be?`${Me}-${be}`:`${be}-${Me}`;return(A.byDocPair.get(Ve)||[]).map(Re=>Re.id_1===te&&Re.regions_id_1===ce?{id:Re.id_2,page:Re.page_2}:Re.id_2===te&&Re.regions_id_2===ce?{id:Re.id_1,page:Re.page_1}:null).filter(Boolean)},Z=[];for(const te of H){let ce=[{[V]:{id:te.id,page:te.canvas}}];for(let ie=1;ie<C.length;ie++){const Me=C[ie],be=[];for(const Ve of ce){const Lt=[];for(let Re=0;Re<ie;Re++){const Oe=C[Re];if(Ve[Oe]){const ot=Y(Ve[Oe].id,Oe,Me);Lt.push(...ot)}}if(Lt.length===0)be.push(Ve);else{const Re=new Map;Lt.forEach(Oe=>{Re.has(Oe.id)||Re.set(Oe.id,Oe)});for(const Oe of Re.values()){const ot={...Ve,[Me]:Oe};be.push(ot)}}}ce=be}Z.push(...ce)}const re=[],fe=new Set;for(const te of Z){const ce=C.map(ie=>{var Me;return((Me=te[ie])==null?void 0:Me.id)||""}).join("|");fe.has(ce)||(fe.add(ce),re.push(te))}return{regions:C,rows:re}}function q(C){n.update(D=>D.indexOf(C)>-1?D.filter(V=>V!==C):[...D,C].sort((V,B)=>V-B))}function R(C){i.update(D=>{const A=new Set(D);return A.has(C)?A.delete(C):A.add(C),A})}return{error:e,allPairs:a,visiblePairs:E,pairIndex:d,documentNodes:h,imageNodes:f,fetchPairs:I,imageNetwork:M,documentNetwork:P,selectedCategories:n,pairStats:m,documentStats:g,imageStats:p,docPairStats:_,docSetNumber:S,selectedNodes:r,selectedRegions:i,updateSelectedNodes:C=>r.set(C),toggleCategory:q,toggleRegion:R,buildAlignedImageMatrix:L,threshold:s,setThreshold:C=>s.set(C),topK:o,setTopK:C=>o.set(C),mutualTopK:l,setMutualTopK:C=>l.set(C)}}function ea(t){let e,n,i,r,s,o=(t[0].clusters||0)+"",l;return{c(){e=w("div"),n=w("div"),i=w("p"),i.textContent="Clusters",r=U(),s=w("p"),l=ne(o),v(i,"class","heading"),v(s,"class","title is-5"),v(e,"class","level-item")},m(a,c){j(a,e,c),y(e,n),y(n,i),y(n,r),y(n,s),y(s,l)},p(a,c){c&1&&o!==(o=(a[0].clusters||0)+"")&&_e(l,o)},d(a){a&&z(e)}}}function a_(t){var L,q,R;let e,n,i,r,s,o,l=(t[0].count||0)+"",a,c,u,d,f,h,m,g=(t[0].links||0)+"",p,_,S,I,b,E,O,x,k=(((q=(L=t[0])==null?void 0:L.density)==null?void 0:q.toFixed(3))||0)+"",M,P=((R=t[0])==null?void 0:R.clusters)&&ea(t);return{c(){e=w("div"),n=w("div"),i=w("div"),r=w("p"),r.textContent=`${W==="en"?"Nodes":"Nœuds"}`,s=U(),o=w("p"),a=ne(l),c=U(),u=w("div"),d=w("div"),f=w("p"),f.textContent=`${W==="en"?"Edges":"Liens"}`,h=U(),m=w("p"),p=ne(g),_=U(),P&&P.c(),S=U(),I=w("div"),b=w("div"),E=w("p"),E.textContent=`${W==="en"?"Density":"Densité"}`,O=U(),x=w("p"),M=ne(k),v(r,"class","heading"),v(o,"class","title is-5"),v(n,"class","level-item"),v(f,"class","heading"),v(m,"class","title is-5"),v(u,"class","level-item"),v(E,"class","heading"),v(x,"class","title is-5"),v(I,"class","level-item"),v(e,"class","level has-text-centered")},m(C,D){j(C,e,D),y(e,n),y(n,i),y(i,r),y(i,s),y(i,o),y(o,a),y(e,c),y(e,u),y(u,d),y(d,f),y(d,h),y(d,m),y(m,p),y(e,_),P&&P.m(e,null),y(e,S),y(e,I),y(I,b),y(b,E),y(b,O),y(b,x),y(x,M)},p(C,[D]){var A,V,B;D&1&&l!==(l=(C[0].count||0)+"")&&_e(a,l),D&1&&g!==(g=(C[0].links||0)+"")&&_e(p,g),(A=C[0])!=null&&A.clusters?P?P.p(C,D):(P=ea(C),P.c(),P.m(e,S)):P&&(P.d(1),P=null),D&1&&k!==(k=(((B=(V=C[0])==null?void 0:V.density)==null?void 0:B.toFixed(3))||0)+"")&&_e(M,k)},i:X,o:X,d(C){C&&z(e),P&&P.d()}}}function c_(t,e,n){let i,r,s,o,{activeTab:l="img"}=e,{documentSetStore:a}=e;const{imageStats:c,documentStats:u,docPairStats:d}=a;return de(t,c,f=>n(8,o=f)),de(t,u,f=>n(7,s=f)),de(t,d,f=>n(6,r=f)),t.$$set=f=>{"activeTab"in f&&n(4,l=f.activeTab),"documentSetStore"in f&&n(5,a=f.documentSetStore)},t.$$.update=()=>{t.$$.dirty&464&&n(0,i=l==="img"?o:l==="doc"?s:r)},[i,c,u,d,l,a,r,s,o]}class u_ extends ye{constructor(e){super(),ve(this,e,c_,a_,pe,{activeTab:4,documentSetStore:5})}}function f_(t){let e,n,i;const r=t[1].default,s=kt(r,t,t[0],null);return{c(){e=w("table"),n=w("tbody"),s&&s.c(),v(e,"class","table is-fullwidth")},m(o,l){j(o,e,l),y(e,n),s&&s.m(n,null),i=!0},p(o,[l]){s&&s.p&&(!i||l&1)&&Ct(s,r,o,o[0],i?Et(r,o[0],l,null):It(o[0]),null)},i(o){i||(F(s,o),i=!0)},o(o){K(s,o),i=!1},d(o){o&&z(e),s&&s.d(o)}}}function h_(t,e,n){let{$$slots:i={},$$scope:r}=e;return t.$$set=s=>{"$$scope"in s&&n(0,r=s.$$scope)},[r,i]}class d_ extends ye{constructor(e){super(),ve(this,e,h_,f_,pe,{})}}const m_=t=>({}),ta=t=>({}),p_=t=>({}),na=t=>({}),g_=t=>({}),ia=t=>({});function __(t){let e;const n=t[4]["row-body"],i=kt(n,t,t[3],ta);return{c(){i&&i.c()},m(r,s){i&&i.m(r,s),e=!0},p(r,s){i&&i.p&&(!e||s&8)&&Ct(i,n,r,r[3],e?Et(n,r[3],s,m_):It(r[3]),ta)},i(r){e||(F(i,r),e=!0)},o(r){K(i,r),e=!1},d(r){i&&i.d(r)}}}function v_(t){let e,n,i,r;const s=t[4]["row-body"],o=kt(s,t,t[3],na);return{c(){e=w("div"),n=w("div"),o&&o.c(),v(n,"class","grid is-gap-2"),v(e,"class",i="fixed-grid has-"+t[2]+"-cols")},m(l,a){j(l,e,a),y(e,n),o&&o.m(n,null),r=!0},p(l,a){o&&o.p&&(!r||a&8)&&Ct(o,s,l,l[3],r?Et(s,l[3],a,p_):It(l[3]),na),(!r||a&4&&i!==(i="fixed-grid has-"+l[2]+"-cols"))&&v(e,"class",i)},i(l){r||(F(o,l),r=!0)},o(l){K(o,l),r=!1},d(l){l&&z(e),o&&o.d(l)}}}function y_(t){let e,n,i,r,s,o,l,a,c,u;qt(t[5]);const d=t[4]["row-header"],f=kt(d,t,t[3],ia),h=[v_,__],m=[];function g(p,_){return p[0]?0:1}return o=g(t),l=m[o]=h[o](t),{c(){e=w("tr"),n=w("th"),i=w("div"),f&&f.c(),r=U(),s=w("td"),l.c(),v(i,"class","content-wrapper py-5"),v(n,"class","is-3 center-flex is-narrow"),De(n,"width","15vw"),v(s,"class","p-5 is-fullwidth")},m(p,_){j(p,e,_),y(e,n),y(n,i),f&&f.m(i,null),y(e,r),y(e,s),m[o].m(s,null),a=!0,c||(u=ge(window,"resize",t[5]),c=!0)},p(p,[_]){f&&f.p&&(!a||_&8)&&Ct(f,d,p,p[3],a?Et(d,p[3],_,g_):It(p[3]),ia);let S=o;o=g(p),o===S?m[o].p(p,_):(ke(),K(m[S],1,1,()=>{m[S]=null}),Ee(),l=m[o],l?l.p(p,_):(l=m[o]=h[o](p),l.c()),F(l,1),l.m(s,null))},i(p){a||(F(f,p),F(l),a=!0)},o(p){K(f,p),K(l),a=!1},d(p){p&&z(e),f&&f.d(p),m[o].d(),c=!1,u()}}}function b_(t,e,n){let i,{$$slots:r={},$$scope:s}=e,{useGrid:o=!0}=e,l=0;function a(){n(1,l=window.innerWidth)}return t.$$set=c=>{"useGrid"in c&&n(0,o=c.useGrid),"$$scope"in c&&n(3,s=c.$$scope)},t.$$.update=()=>{t.$$.dirty&2&&n(2,i=Fs(l))},[o,l,i,s,r,a]}class ra extends ye{constructor(e){super(),ve(this,e,b_,y_,pe,{useGrid:0})}}const Ty="",w_=t=>({}),sa=t=>({}),S_=t=>({}),oa=t=>({});function la(t){let e,n,i,r,s,o,l,a,c,u,d,f=t[1]&&aa(t);return a=new Mi({props:{tooltipText:t[2][t[1]][W]}}),{c(){f&&f.c(),e=U(),n=w("div"),i=w("button"),r=xt("svg"),s=xt("path"),l=U(),ae(a.$$.fragment),v(s,"fill","none"),v(s,"stroke","currentColor"),v(s,"stroke-linecap","round"),v(s,"stroke-linejoin","round"),v(s,"stroke-width","1.5"),v(s,"d","M12 3v18m0 0l8.5-8.5M12 21l-8.5-8.5"),v(r,"style",o=`transform: rotate(${t[1]?"180":"0"}deg)`),v(r,"xmlns","http://www.w3.org/2000/svg"),v(r,"width","24"),v(r,"height","24"),v(r,"viewBox","0 0 24 24"),v(r,"class","svelte-jbs1sd"),v(i,"class","button is-link svelte-jbs1sd"),v(n,"class","ctrl-toggle svelte-jbs1sd")},m(h,m){f&&f.m(h,m),j(h,e,m),j(h,n,m),y(n,i),y(i,r),y(r,s),y(i,l),oe(a,i,null),c=!0,u||(d=ge(i,"click",Ut(t[3])),u=!0)},p(h,m){h[1]?f?(f.p(h,m),m&2&&F(f,1)):(f=aa(h),f.c(),F(f,1),f.m(e.parentNode,e)):f&&(ke(),K(f,1,1,()=>{f=null}),Ee()),(!c||m&2&&o!==(o=`transform: rotate(${h[1]?"180":"0"}deg)`))&&v(r,"style",o);const g={};m&2&&(g.tooltipText=h[2][h[1]][W]),a.$set(g)},i(h){c||(F(f),F(a.$$.fragment,h),c=!0)},o(h){K(f),K(a.$$.fragment,h),c=!1},d(h){f&&f.d(h),h&&z(e),h&&z(n),le(a),u=!1,d()}}}function aa(t){let e,n,i;const r=t[5]["toolbar-hidden"],s=kt(r,t,t[4],sa);return{c(){e=w("div"),s&&s.c(),v(e,"class","ctrl-extra")},m(o,l){j(o,e,l),s&&s.m(e,null),i=!0},p(o,l){s&&s.p&&(!i||l&16)&&Ct(s,r,o,o[4],i?Et(r,o[4],l,w_):It(o[4]),sa)},i(o){i||(F(s,o),qt(()=>{i&&(n||(n=Zt(e,Us,{axis:"y"},!0)),n.run(1))}),i=!0)},o(o){K(s,o),n||(n=Zt(e,Us,{axis:"y"},!1)),n.run(0),i=!1},d(o){o&&z(e),s&&s.d(o),o&&n&&n.end()}}}function k_(t){let e,n,i,r,s,o,l,a;const c=t[5]["toolbar-visible"],u=kt(c,t,t[4],oa);let d=t[0]&&la(t);return{c(){e=w("div"),n=w("form"),i=w("div"),r=w("div"),s=w("div"),u&&u.c(),o=U(),d&&d.c(),v(s,"class","ctrl-block svelte-jbs1sd"),v(r,"class","ctrl-block-wrapper svelte-jbs1sd"),v(i,"class","ctrl-base"),v(n,"class","ctrl svelte-jbs1sd"),v(e,"id","toolbar"),v(e,"class",l="ctrl-wrapper is-flex is-justify-content-center is-align-items-center "+(t[1]?"toolbar-expanded":"toolbar-collapsed")+" svelte-jbs1sd")},m(f,h){j(f,e,h),y(e,n),y(n,i),y(i,r),y(r,s),u&&u.m(s,null),y(n,o),d&&d.m(n,null),a=!0},p(f,[h]){u&&u.p&&(!a||h&16)&&Ct(u,c,f,f[4],a?Et(c,f[4],h,S_):It(f[4]),oa),f[0]?d?(d.p(f,h),h&1&&F(d,1)):(d=la(f),d.c(),F(d,1),d.m(n,null)):d&&(ke(),K(d,1,1,()=>{d=null}),Ee()),(!a||h&2&&l!==(l="ctrl-wrapper is-flex is-justify-content-center is-align-items-center "+(f[1]?"toolbar-expanded":"toolbar-collapsed")+" svelte-jbs1sd"))&&v(e,"class",l)},i(f){a||(F(u,f),F(d),a=!0)},o(f){K(u,f),K(d),a=!1},d(f){f&&z(e),u&&u.d(f),d&&d.d()}}}function E_(t,e,n){let i,{$$slots:r={},$$scope:s}=e,{expandable:o=!0}=e;const l={true:{en:"Collapse the toolbar",fr:"Refermer le menu"},false:{en:"Expand the toolbar",fr:"Ouvrir le menu"}},a=()=>n(1,i=!i);return t.$$set=c=>{"expandable"in c&&n(0,o=c.expandable),"$$scope"in c&&n(4,s=c.$$scope)},n(1,i=!1),[o,i,l,a,s,r]}class C_ extends ye{constructor(e){super(),ve(this,e,E_,k_,pe,{expandable:0})}}function ca(t){let e,n,i,r,s,o,l,a,c,u=t[5]>1&&ua(t),d=t[5]<t[3]&&da(t);return{c(){e=w("nav"),n=w("ul"),u&&u.c(),i=U(),r=w("li"),s=w("a"),o=ne(t[5]),l=U(),d&&d.c(),v(s,"class","pagination-link is-current"),v(s,"href",null),v(n,"class","pagination-list ml-0"),v(e,"class","pagination is-centered mb-2"),v(e,"aria-label","pagination")},m(f,h){j(f,e,h),y(e,n),u&&u.m(n,null),y(n,i),y(n,r),y(r,s),y(s,o),y(n,l),d&&d.m(n,null),a||(c=ge(s,"click",Ut(t[9])),a=!0)},p(f,h){f[5]>1?u?u.p(f,h):(u=ua(f),u.c(),u.m(n,i)):u&&(u.d(1),u=null),h&32&&_e(o,f[5]),f[5]<f[3]?d?d.p(f,h):(d=da(f),d.c(),d.m(n,null)):d&&(d.d(1),d=null)},d(f){f&&z(e),u&&u.d(),d&&d.d(),a=!1,c()}}}function ua(t){let e,n,i,r,s,o,l=t[5]-1>1&&fa(t);return{c(){e=w("li"),n=w("a"),n.textContent="1",i=U(),l&&l.c(),r=qe(),v(n,"class","pagination-link"),v(n,"href",null)},m(a,c){j(a,e,c),y(e,n),j(a,i,c),l&&l.m(a,c),j(a,r,c),s||(o=ge(n,"click",Ut(t[7])),s=!0)},p(a,c){a[5]-1>1?l?l.p(a,c):(l=fa(a),l.c(),l.m(r.parentNode,r)):l&&(l.d(1),l=null)},d(a){a&&z(e),a&&z(i),l&&l.d(a),a&&z(r),s=!1,o()}}}function fa(t){let e,n,i,r=t[5]-1+"",s,o,l,a=t[5]-1>2&&ha();return{c(){a&&a.c(),e=U(),n=w("li"),i=w("a"),s=ne(r),v(i,"class","pagination-link"),v(i,"href",null)},m(c,u){a&&a.m(c,u),j(c,e,u),j(c,n,u),y(n,i),y(i,s),o||(l=ge(i,"click",Ut(t[8])),o=!0)},p(c,u){c[5]-1>2?a||(a=ha(),a.c(),a.m(e.parentNode,e)):a&&(a.d(1),a=null),u&32&&r!==(r=c[5]-1+"")&&_e(s,r)},d(c){a&&a.d(c),c&&z(e),c&&z(n),o=!1,l()}}}function ha(t){let e;return{c(){e=w("li"),e.innerHTML='<span class="pagination-ellipsis">…</span>'},m(n,i){j(n,e,i)},d(n){n&&z(e)}}}function da(t){let e,n,i,r,s,o,l=t[5]+1<t[3]&&ma(t);return{c(){l&&l.c(),e=U(),n=w("li"),i=w("a"),r=ne(t[3]),v(i,"class","pagination-link"),v(i,"href",null)},m(a,c){l&&l.m(a,c),j(a,e,c),j(a,n,c),y(n,i),y(i,r),s||(o=ge(i,"click",Ut(t[11])),s=!0)},p(a,c){a[5]+1<a[3]?l?l.p(a,c):(l=ma(a),l.c(),l.m(e.parentNode,e)):l&&(l.d(1),l=null),c&8&&_e(r,a[3])},d(a){l&&l.d(a),a&&z(e),a&&z(n),s=!1,o()}}}function ma(t){let e,n,i=t[5]+1+"",r,s,o,l,a,c=t[5]+2<t[3]&&pa();return{c(){e=w("li"),n=w("a"),r=ne(i),s=U(),c&&c.c(),o=qe(),v(n,"class","pagination-link"),v(n,"href",null)},m(u,d){j(u,e,d),y(e,n),y(n,r),j(u,s,d),c&&c.m(u,d),j(u,o,d),l||(a=ge(n,"click",Ut(t[10])),l=!0)},p(u,d){d&32&&i!==(i=u[5]+1+"")&&_e(r,i),u[5]+2<u[3]?c||(c=pa(),c.c(),c.m(o.parentNode,o)):c&&(c.d(1),c=null)},d(u){u&&z(e),u&&z(s),c&&c.d(u),u&&z(o),l=!1,a()}}}function pa(t){let e;return{c(){e=w("li"),e.innerHTML='<span class="pagination-ellipsis">…</span>'},m(n,i){j(n,e,i)},d(n){n&&z(e)}}}function I_(t){let e,n,i=t[5]*t[2]-t[2]+1+"",r,s,o=Math.min(t[5]*t[2],t[1])+"",l,a,c,u,d=t[4]&&ca(t);return{c(){d&&d.c(),e=U(),n=w("div"),r=ne(i),s=ne(" - "),l=ne(o),a=ne(" / "),c=ne(t[1]),v(n,"class",u="is-size-7 is-center mb-4 "+(t[4]?"":"mt-4"))},m(f,h){d&&d.m(f,h),j(f,e,h),j(f,n,h),y(n,r),y(n,s),y(n,l),y(n,a),y(n,c)},p(f,[h]){f[4]?d?d.p(f,h):(d=ca(f),d.c(),d.m(e.parentNode,e)):d&&(d.d(1),d=null),h&36&&i!==(i=f[5]*f[2]-f[2]+1+"")&&_e(r,i),h&38&&o!==(o=Math.min(f[5]*f[2],f[1])+"")&&_e(l,o),h&2&&_e(c,f[1]),h&16&&u!==(u="is-size-7 is-center mb-4 "+(f[4]?"":"mt-4"))&&v(n,"class",u)},i:X,o:X,d(f){d&&d.d(f),f&&z(e),f&&z(n)}}}function M_(t,e,n){let i,r,s,{store:o}=e;const{currentPage:l}=o;de(t,l,g=>n(5,s=g));let{nbOfItems:a}=e,{pageLength:c=Bc}=e;const u=()=>o.handlePageUpdate(1),d=()=>o.handlePageUpdate(s-1),f=()=>o.handlePageUpdate(s),h=()=>o.handlePageUpdate(s+1),m=()=>o.handlePageUpdate(i);return t.$$set=g=>{"store"in g&&n(0,o=g.store),"nbOfItems"in g&&n(1,a=g.nbOfItems),"pageLength"in g&&n(2,c=g.pageLength)},t.$$.update=()=>{t.$$.dirty&6&&n(3,i=c>0?Math.ceil(a/c):1),t.$$.dirty&14&&n(4,r=i>1||a>c)},[o,a,c,i,r,s,l,u,d,f,h,m]}class ga extends ye{constructor(e){super(),ve(this,e,M_,I_,pe,{store:0,nbOfItems:1,pageLength:2})}}function x_(t){let e,n,i,r,s=W==="en"?"Save selection":"Sauvegarder la sélection",o,l,a;return{c(){e=w("button"),n=w("span"),i=w("i"),r=U(),o=ne(s),v(i,"class","fa-solid fa-floppy-disk"),v(e,"class","button is-link")},m(c,u){j(c,e,u),y(e,n),y(n,i),y(n,r),y(n,o),l||(a=ge(e,"click",t[7]),l=!0)},p:X,d(c){c&&z(e),l=!1,a()}}}function A_(t){let e,n,i,r,s=W==="en"?"Go to treatment":"Accéder au traitement",o,l;return{c(){var a;e=w("a"),n=w("span"),i=w("i"),r=U(),o=ne(s),v(i,"class","fa-solid fa-gear"),v(e,"class","button is-link"),v(e,"href",l="/"+At+"/treatment/add/?document_set="+((a=t[3])==null?void 0:a.id))},m(a,c){j(a,e,c),y(e,n),y(n,i),y(n,r),y(n,o)},p(a,c){var u;c&8&&l!==(l="/"+At+"/treatment/add/?document_set="+((u=a[3])==null?void 0:u.id))&&v(e,"href",l)},d(a){a&&z(e)}}}function _a(t){let e,n,i,r,s,o,l;return{c(){var a,c;e=w("a"),n=w("span"),n.innerHTML='<i class="fa-solid fa-file-export"></i> JSON',r=U(),s=w("a"),o=w("span"),o.innerHTML='<i class="fa-solid fa-file-zipper"></i> ZIP',v(e,"class","button is-link is-dark"),v(e,"href",i="/"+At+"/document-set/"+((a=t[3])==null?void 0:a.id)+"/json"),v(e,"target","_blank"),v(s,"class","button is-link is-dark"),v(s,"href",l="/"+At+"/document-set/"+((c=t[3])==null?void 0:c.id)+"/zip"),v(s,"target","_blank")},m(a,c){j(a,e,c),y(e,n),j(a,r,c),j(a,s,c),y(s,o)},p(a,c){var u,d;c&8&&i!==(i="/"+At+"/document-set/"+((u=a[3])==null?void 0:u.id)+"/json")&&v(e,"href",i),c&8&&l!==(l="/"+At+"/document-set/"+((d=a[3])==null?void 0:d.id)+"/zip")&&v(s,"href",l)},d(a){a&&z(e),a&&z(r),a&&z(s)}}}function T_(t){let e,n,i,r,s,o,l;function a(f,h){return f[2]&&!f[1]?A_:x_}let c=a(t),u=c(t),d=!t[1]&&_a(t);return{c(){e=w("footer"),n=w("div"),i=w("button"),i.textContent=`${W==="en"?"Clear selection":"Vider la sélection"}`,r=U(),u.c(),s=U(),d&&d.c(),v(i,"class","button button-close is-link is-light"),v(n,"class","buttons"),v(e,"class","modal-card-foot is-center")},m(f,h){j(f,e,h),y(e,n),y(n,i),y(n,r),u.m(n,null),y(n,s),d&&d.m(n,null),o||(l=ge(i,"click",t[6]),o=!0)},p(f,[h]){c===(c=a(f))&&u?u.p(f,h):(u.d(1),u=c(f),u&&(u.c(),u.m(n,s))),f[1]?d&&(d.d(1),d=null):d?d.p(f,h):(d=_a(f),d.c(),d.m(n,null))},i:X,o:X,d(f){f&&z(e),u.d(),d&&d.d(),o=!1,l()}}}function N_(t,e,n){let i,r,{selectionStore:s}=e;const{isSaved:o,selection:l}=s;de(t,o,d=>n(2,i=d)),de(t,l,d=>n(3,r=d));let{isRegion:a=s.type!=="documentSet"}=e;const c=()=>s.empty(),u=()=>s.save();return t.$$set=d=>{"selectionStore"in d&&n(0,s=d.selectionStore),"isRegion"in d&&n(1,a=d.isRegion)},[s,a,i,r,o,l,c,u]}class O_ extends ye{constructor(e){super(),ve(this,e,N_,T_,pe,{selectionStore:0,isRegion:1})}}const Ny="";function P_(t){let e,n,i,r,s,o;return{c(){e=w("span"),n=ne(t[5]),i=U(),r=w("span"),r.innerHTML='<i class="fas fa-edit"></i>',v(r,"class","pl-3 smaller has-text-link")},m(l,a){j(l,e,a),y(e,n),y(e,i),y(e,r),s||(o=[ge(e,"click",t[7]),ge(e,"keyup",null)],s=!0)},p(l,a){a&32&&_e(n,l[5])},d(l){l&&z(e),s=!1,Ge(o)}}}function L_(t){let e,n,i;return{c(){e=w("input"),v(e,"class","input selection-title svelte-sgypdx")},m(r,s){j(r,e,s),t[12](e),gi(e,t[4]),n||(i=[ge(e,"input",t[13]),ge(e,"keydown",t[8]),ge(e,"blur",t[9])],n=!0)},p(r,s){s&16&&e.value!==r[4]&&gi(e,r[4])},d(r){r&&z(e),t[12](null),n=!1,Ge(i)}}}function D_(t){let e,n,i,r,s,o,l,a,c,u,d,f,h,m,g,p,_,S,I,b;function E(P,L){return P[2]?L_:P_}let O=E(t),x=O(t);const k=t[11].default,M=kt(k,t,t[10],null);return _=new O_({props:{selectionStore:t[0]}}),{c(){e=w("div"),n=w("div"),i=U(),r=w("div"),s=w("div"),o=w("div"),l=w("i"),a=U(),x.c(),c=ne(`
                (`),u=ne(t[1]),d=ne(")"),f=U(),h=w("button"),m=U(),g=w("section"),M&&M.c(),p=U(),ae(_.$$.fragment),v(n,"class","modal-background"),v(l,"class","fa-solid fa-book-bookmark"),v(o,"class","title is-4 mb-0 media-content"),v(h,"class","delete media-left"),v(h,"aria-label","close"),v(s,"class","modal-card-head media mb-0 is-middle"),v(g,"class","modal-card-body"),v(r,"class","modal-content"),v(e,"id","selection-modal"),v(e,"class","modal fade"),v(e,"tabindex","-1"),v(e,"aria-labelledby","selection-modal-label"),v(e,"aria-hidden","true")},m(P,L){j(P,e,L),y(e,n),y(e,i),y(e,r),y(r,s),y(s,o),y(o,l),y(o,a),x.m(o,null),y(o,c),y(o,u),y(o,d),y(s,f),y(s,h),y(r,m),y(r,g),M&&M.m(g,null),y(r,p),oe(_,r,null),S=!0,I||(b=pi(Vs.call(null,e)),I=!0)},p(P,[L]){O===(O=E(P))&&x?x.p(P,L):(x.d(1),x=O(P),x&&(x.c(),x.m(o,c))),(!S||L&2)&&_e(u,P[1]),M&&M.p&&(!S||L&1024)&&Ct(M,k,P,P[10],S?Et(k,P[10],L,null):It(P[10]),null);const q={};L&1&&(q.selectionStore=P[0]),_.$set(q)},i(P){S||(F(M,P),F(_.$$.fragment,P),S=!0)},o(P){K(M,P),K(_.$$.fragment,P),S=!1},d(P){P&&z(e),x.d(),M&&M.d(P),le(_),I=!1,b()}}}function R_(t,e,n){let i,{$$slots:r={},$$scope:s}=e,{selectionStore:o}=e;const{selectionTitle:l,updateTitle:a,save:c}=o;de(t,l,I=>n(5,i=I));let{selectionLength:u=!1}=e,d=!1,f,h;function m(){n(2,d=!0),n(4,h=i),setTimeout(()=>f&&f.focus(),0)}function g(I){I.key==="Enter"&&p()}function p(){n(2,d=!1),a(h),c()}function _(I){kn[I?"unshift":"push"](()=>{f=I,n(3,f)})}function S(){h=this.value,n(4,h)}return t.$$set=I=>{"selectionStore"in I&&n(0,o=I.selectionStore),"selectionLength"in I&&n(1,u=I.selectionLength),"$$scope"in I&&n(10,s=I.$$scope)},[o,u,d,f,h,i,l,m,g,p,s,r,_,S]}class $_ extends ye{constructor(e){super(),ve(this,e,R_,D_,pe,{selectionStore:0,selectionLength:1})}}const Oy="";function z_(t){let e,n,i,r,s,o=W==="en"?"Selection":"Sélection",l,a,c,u,d,f;return{c(){e=w("div"),n=w("button"),i=w("span"),r=w("i"),s=U(),l=ne(o),a=ne(`
            (`),c=ne(t[0]),u=ne(")"),v(r,"class","fa-solid fa-book-bookmark"),v(i,"id","btn-content"),v(n,"id","set-btn"),v(n,"class","button px-5 py-4 is-link svelte-gmt9z5"),v(n,"data-target","selection-modal"),v(e,"class","set-container svelte-gmt9z5")},m(h,m){j(h,e,m),y(e,n),y(n,i),y(i,r),y(i,s),y(i,l),y(i,a),y(i,c),y(i,u),d||(f=pi(Hs.call(null,n)),d=!0)},p(h,[m]){m&1&&_e(c,h[0])},i:X,o:X,d(h){h&&z(e),d=!1,f()}}}function j_(t,e,n){let{selectionLength:i=0}=e,r=i;return t.$$set=s=>{"selectionLength"in s&&n(0,i=s.selectionLength)},t.$$.update=()=>{if(t.$$.dirty&3&&i!==r){const s=i>r;n(1,r=i);const o=document.getElementById("btn-content");o&&o.animate([{transform:s?"translateY(-7px)":"translateX(-5px)"},{transform:s?"translateY(7px)":"translateX(5px)"},{transform:"translate(0)"}],{duration:300,easing:"cubic-bezier(0.65, 0, 0.35, 1)"})}},[i,r]}class F_ extends ye{constructor(e){super(),ve(this,e,j_,z_,pe,{selectionLength:0})}}const Py="";function va(t,e,n){const i=t.slice();return i[7]=e[n][0],i[8]=e[n][1],i}function V_(t){let e;return{c(){e=w("div"),e.textContent=`${W==="en"?"No regions in selection":"Aucune région sélectionnée"}`},m(n,i){j(n,e,i)},p:X,d(n){n&&z(e)}}}function H_(t){let e,n,i=Object.entries(t[2]),r=[];for(let s=0;s<i.length;s+=1)r[s]=ya(va(t,i,s));return{c(){e=w("div"),n=w("div");for(let s=0;s<r.length;s+=1)r[s].c();v(n,"class","grid is-gap-2"),v(e,"class","fixed-grid has-6-cols")},m(s,o){j(s,e,o),y(e,n);for(let l=0;l<r.length;l+=1)r[l]&&r[l].m(n,null)},p(s,o){if(o&13){i=Object.entries(s[2]);let l;for(l=0;l<i.length;l+=1){const a=va(s,i,l);r[l]?r[l].p(a,o):(r[l]=ya(a),r[l].c(),r[l].m(n,null))}for(;l<r.length;l+=1)r[l].d(1);r.length=i.length}},d(s){s&&z(e),Ye(r,s)}}}function ya(t){let e,n,i,r,s,o,l,a=t[8].title+"",c,u,d,f,h,m;function g(){return t[6](t[7])}return{c(){e=w("div"),n=w("figure"),i=w("img"),s=U(),o=w("div"),l=w("span"),c=ne(a),u=U(),d=w("button"),f=U(),gt(i.src,r=Rt(t[8].img,t[8].xywh,"96,"))||v(i,"src",r),v(i,"alt","Extracted region"),v(l,"class","overlay-desc"),v(o,"class","overlay is-center svelte-g8ij5d"),v(n,"class","image is-64x64 card"),v(d,"class","delete region-btn svelte-g8ij5d"),v(d,"aria-label","remove from selection"),v(e,"class","selection cell svelte-g8ij5d")},m(p,_){j(p,e,_),y(e,n),y(n,i),y(n,s),y(n,o),y(o,l),y(l,c),y(e,u),y(e,d),y(e,f),h||(m=ge(d,"click",g),h=!0)},p(p,_){t=p,_&4&&!gt(i.src,r=Rt(t[8].img,t[8].xywh,"96,"))&&v(i,"src",r),_&4&&a!==(a=t[8].title+"")&&_e(c,a)},d(p){p&&z(e),h=!1,m()}}}function U_(t){let e;function n(s,o){return s[4]?H_:V_}let i=n(t),r=i(t);return{c(){r.c(),e=qe()},m(s,o){r.m(s,o),j(s,e,o)},p(s,o){i===(i=n(s))&&r?r.p(s,o):(r.d(1),r=i(s),r&&(r.c(),r.m(e.parentNode,e)))},d(s){r.d(s),s&&z(e)}}}function B_(t){let e,n,i,r;return e=new F_({props:{selectionLength:t[1]}}),i=new $_({props:{selectionLength:t[1],selectionStore:t[0],$$slots:{default:[U_]},$$scope:{ctx:t}}}),{c(){ae(e.$$.fragment),n=U(),ae(i.$$.fragment)},m(s,o){oe(e,s,o),j(s,n,o),oe(i,s,o),r=!0},p(s,[o]){const l={};o&2&&(l.selectionLength=s[1]),e.$set(l);const a={};o&2&&(a.selectionLength=s[1]),o&1&&(a.selectionStore=s[0]),o&2077&&(a.$$scope={dirty:o,ctx:s}),i.$set(a)},i(s){r||(F(e.$$.fragment,s),F(i.$$.fragment,s),r=!0)},o(s){K(e.$$.fragment,s),K(i.$$.fragment,s),r=!1},d(s){le(e,s),s&&z(n),le(i,s)}}}function q_(t,e,n){let i,r,s,o,{selectionStore:l}=e;const{selected:a}=l;de(t,a,u=>n(3,o=u));const c=u=>l.remove(u,Object.keys(o)[0]);return t.$$set=u=>{"selectionStore"in u&&n(0,l=u.selectionStore)},t.$$.update=()=>{t.$$.dirty&8&&n(2,i=Object.values(o)[0]||{}),t.$$.dirty&4&&n(1,r=Object.keys(i).length),t.$$.dirty&2&&n(4,s=r>0)},[l,r,i,o,s,a,c]}class K_ extends ye{constructor(e){super(),ve(this,e,q_,B_,pe,{selectionStore:0})}}const Ly="";function ba(t,e,n){const i=t.slice();return i[17]=e[n],i}function wa(t,e,n){const i=t.slice();return i[20]=e[n],i}function Sa(t,e,n){const i=t.slice();return i[23]=e[n],i}function ka(t){let e,n,i,r,s,o=t[23].title+"",l,a,c,u=t[23].shortcut+"",d,f,h,m;return{c(){e=w("p"),n=w("button"),i=w("span"),r=w("i"),s=U(),l=ne(o),a=U(),c=w("span"),d=ne(u),f=U(),v(r,"class","fas "+t[23].icon+" svelte-7vjt6f"),v(i,"class","icon is-small"),v(c,"class","shortcut svelte-7vjt6f"),v(n,"class","button pl-5"),v(n,"title",t[23].desc),v(e,"class","control")},m(g,p){j(g,e,p),y(e,n),y(n,i),y(i,r),y(n,s),y(n,l),y(n,a),y(n,c),y(c,d),y(e,f),h||(m=ge(n,"click",Ut(t[23].fct)),h=!0)},p(g,p){t=g},d(g){g&&z(e),h=!1,m()}}}function W_(t){let e,n,i,r,s,o,l,a=Object.values(t[10]),c=[];for(let u=0;u<a.length;u+=1)c[u]=ka(Sa(t,a,u));return{c(){e=w("div"),n=w("div"),i=w("div"),r=w("span"),r.textContent=`${W==="en"?"Process selection":"Agir sur la sélection"}`,s=U(),o=w("div"),l=w("div");for(let u=0;u<c.length;u+=1)c[u].c();v(r,"class","tag is-medium is-link mr-5"),v(i,"class","column is-narrow mr-5"),v(l,"class","field has-addons"),v(o,"class","column"),v(n,"class","columns is-vcentered is-mobile py-4"),v(e,"slot","toolbar-visible")},m(u,d){j(u,e,d),y(e,n),y(n,i),y(i,r),y(n,s),y(n,o),y(o,l);for(let f=0;f<c.length;f+=1)c[f]&&c[f].m(l,null)},p(u,d){if(d&1024){a=Object.values(u[10]);let f;for(f=0;f<a.length;f+=1){const h=Sa(u,a,f);c[f]?c[f].p(h,d):(c[f]=ka(h),c[f].c(),c[f].m(l,null))}for(;f<c.length;f+=1)c[f].d(1);c.length=a.length}},d(u){u&&z(e),Ye(c,u)}}}function G_(t){let e,n=t[9].title+"",i;return{c(){e=w("span"),i=ne(n),v(e,"class","button is-small is-success"),v(e,"title",t[9].desc)},m(r,s){j(r,e,s),y(e,i)},p:X,d(r){r&&z(e)}}}function Y_(t){let e,n=t[8].title+"",i,r,s;function o(){return t[12](t[17])}return{c(){e=w("button"),i=ne(n),v(e,"class","button is-small is-warning"),v(e,"title",t[8].desc)},m(l,a){j(l,e,a),y(e,i),r||(s=ge(e,"click",o),r=!0)},p(l,a){t=l},d(l){l&&z(e),r=!1,s()}}}function X_(t){let e,n,i=t[17].size+"",r,s,o,l,a,c;function u(h,m){return h[17].fullyConnected?G_:Y_}let d=u(t),f=d(t);return{c(){e=w("div"),n=w("span"),r=ne(i),s=ne(" images"),o=U(),l=w("hr"),a=U(),f.c(),c=U(),v(n,"class","cluster-size"),v(e,"class","cluster-info is-center is-fullwidth")},m(h,m){j(h,e,m),y(e,n),y(n,r),y(n,s),y(e,o),y(e,l),y(e,a),f.m(e,null),j(h,c,m)},p(h,m){m&4&&i!==(i=h[17].size+"")&&_e(r,i),d===(d=u(h))&&f?f.p(h,m):(f.d(1),f=d(h),f&&(f.c(),f.m(e,null)))},d(h){h&&z(e),f.d(),h&&z(c)}}}function Ea(t){let e,n;return e=new Dn({props:{item:{...t[3].get(t[20]),clusterId:t[17].id},copyable:!1,selectionStore:Zi}}),{c(){ae(e.$$.fragment)},m(i,r){oe(e,i,r),n=!0},p(i,r){const s={};r&12&&(s.item={...i[3].get(i[20]),clusterId:i[17].id}),e.$set(s)},i(i){n||(F(e.$$.fragment,i),n=!0)},o(i){K(e.$$.fragment,i),n=!1},d(i){le(e,i)}}}function J_(t){let e,n,i=t[17].members,r=[];for(let o=0;o<i.length;o+=1)r[o]=Ea(wa(t,i,o));const s=o=>K(r[o],1,1,()=>{r[o]=null});return{c(){for(let o=0;o<r.length;o+=1)r[o].c();e=U()},m(o,l){for(let a=0;a<r.length;a+=1)r[a]&&r[a].m(o,l);j(o,e,l),n=!0},p(o,l){if(l&12){i=o[17].members;let a;for(a=0;a<i.length;a+=1){const c=wa(o,i,a);r[a]?(r[a].p(c,l),F(r[a],1)):(r[a]=Ea(c),r[a].c(),F(r[a],1),r[a].m(e.parentNode,e))}for(ke(),a=i.length;a<r.length;a+=1)s(a);Ee()}},i(o){if(!n){for(let l=0;l<i.length;l+=1)F(r[l]);n=!0}},o(o){r=r.filter(Boolean);for(let l=0;l<r.length;l+=1)K(r[l]);n=!1},d(o){Ye(r,o),o&&z(e)}}}function Ca(t,e){let n,i,r;return i=new ra({props:{$$slots:{"row-body":[J_],"row-header":[X_]},$$scope:{ctx:e}}}),{key:t,first:null,c(){n=qe(),ae(i.$$.fragment),this.first=n},m(s,o){j(s,n,o),oe(i,s,o),r=!0},p(s,o){e=s;const l={};o&67108876&&(l.$$scope={dirty:o,ctx:e}),i.$set(l)},i(s){r||(F(i.$$.fragment,s),r=!0)},o(s){K(i.$$.fragment,s),r=!1},d(s){s&&z(n),le(i,s)}}}function Q_(t){let e=[],n=new Map,i,r,s=t[2];const o=l=>l[17].id;for(let l=0;l<s.length;l+=1){let a=ba(t,s,l),c=o(a);n.set(c,e[l]=Ca(c,a))}return{c(){for(let l=0;l<e.length;l+=1)e[l].c();i=qe()},m(l,a){for(let c=0;c<e.length;c+=1)e[c]&&e[c].m(l,a);j(l,i,a),r=!0},p(l,a){a&780&&(s=l[2],ke(),e=_r(e,a,o,1,l,s,n,i.parentNode,gr,Ca,i,ba),Ee())},i(l){if(!r){for(let a=0;a<s.length;a+=1)F(e[a]);r=!0}},o(l){for(let a=0;a<e.length;a+=1)K(e[a]);r=!1},d(l){for(let a=0;a<e.length;a+=1)e[a].d(l);l&&z(i)}}}function Z_(t){let e,n,i,r,s,o,l,a,c,u;return e=new C_({props:{expandable:!1,$$slots:{"toolbar-visible":[W_]},$$scope:{ctx:t}}}),i=new ga({props:{store:t[0],nbOfItems:t[1],pageLength:t[7]}}),s=new K_({props:{selectionStore:Zi}}),l=new d_({props:{$$slots:{default:[Q_]},$$scope:{ctx:t}}}),c=new ga({props:{store:t[0],nbOfItems:t[1],pageLength:t[7]}}),{c(){ae(e.$$.fragment),n=U(),ae(i.$$.fragment),r=U(),ae(s.$$.fragment),o=U(),ae(l.$$.fragment),a=U(),ae(c.$$.fragment)},m(d,f){oe(e,d,f),j(d,n,f),oe(i,d,f),j(d,r,f),oe(s,d,f),j(d,o,f),oe(l,d,f),j(d,a,f),oe(c,d,f),u=!0},p(d,[f]){const h={};f&67108864&&(h.$$scope={dirty:f,ctx:d}),e.$set(h);const m={};f&1&&(m.store=d[0]),f&2&&(m.nbOfItems=d[1]),i.$set(m);const g={};f&67108876&&(g.$$scope={dirty:f,ctx:d}),l.$set(g);const p={};f&1&&(p.store=d[0]),f&2&&(p.nbOfItems=d[1]),c.$set(p)},i(d){u||(F(e.$$.fragment,d),F(i.$$.fragment,d),F(s.$$.fragment,d),F(l.$$.fragment,d),F(c.$$.fragment,d),u=!0)},o(d){K(e.$$.fragment,d),K(i.$$.fragment,d),K(s.$$.fragment,d),K(l.$$.fragment,d),K(c.$$.fragment,d),u=!1},d(d){le(e,d),d&&z(n),le(i,d),d&&z(r),le(s,d),d&&z(o),le(l,d),d&&z(a),le(c,d)}}}function e0(t,e,n){let i,r,s,{documentSetStore:o}=e;const{imageNodes:l}=o;de(t,l,b=>n(3,s=b));let{clusterStore:a}=e;const{clusterNb:c,paginatedClusters:u,pageLength:d,validateCluster:f,newCluster:h,removeFromClusters:m}=a;de(t,c,b=>n(1,i=b)),de(t,u,b=>n(2,r=b));const g={create:{title:W==="en"?"New cluster":"Nouveau cluster",desc:W==="en"?"Create a new validated cluster from the selected regions":"Créer un nouveau cluster valide à partir des régions sélectionnées",icon:"fa-object-group",shortcut:"Shift + C",fct:h},remove:{title:W==="en"?"Remove from cluster":"Retirer du cluster",desc:W==="en"?"Remove the selected regions from their cluster":"Retirer les régions sélectionnées de leur cluster",icon:"fa-chain-broken",shortcut:"Shift + D",fct:m},validate:{title:W==="en"?"Validate cluster":"Valider le cluster",desc:W==="en"?"Set as exact match all the pairs of regions in the cluster":"Définir comme correspondance exacte toutes les paires de régions dans le cluster",icon:"fa-check",fct:f},validated:{title:W==="en"?"Validated cluster":"Cluster valide",desc:W==="en"?"All pairs of regions have be categorized as exact matches":"Toutes les paires de régions ont été catégorisées comme des correspondances exactes",icon:"fa-check"}},{validate:p,validated:_,...S}=g,I=b=>p.fct(b);return t.$$set=b=>{"documentSetStore"in b&&n(11,o=b.documentSetStore),"clusterStore"in b&&n(0,a=b.clusterStore)},[a,i,r,s,l,c,u,d,p,_,S,o,I]}class t0 extends ye{constructor(e){super(),ve(this,e,e0,Z_,pe,{documentSetStore:11,clusterStore:0})}}function n0(t,e){const i=we(1),{allPairs:r,imageNodes:s}=t;wr(i,"p");function o(b){Sr(b,i,"p")}function l(b){if(b.length===0)return[];const E=new Map,O=P=>E.has(P)?(E.get(P)!==P&&E.set(P,O(E.get(P))),E.get(P)):(E.set(P,P),P),x=(P,L)=>{const q=O(P),R=O(L);q!==R&&E.set(R,q)},k=new Set;b.forEach(P=>{P.category===1&&(x(P.id_1,P.id_2),k.add(P.id_1),k.add(P.id_2))});const M=new Map;return k.forEach(P=>{const L=O(P);M.has(L)||M.set(L,[]),M.get(L).push(P)}),Array.from(M.values()).map(P=>{const L=P.length,q=L*(L-1)/2,R=new Set(P),C=b.filter(D=>D.category===1&&R.has(D.id_1)&&R.has(D.id_2)).length;return{id:crypto.randomUUID(),members:P,size:L,fullyConnected:C===q}}).filter(P=>P.size>1).sort((P,L)=>L.size-P.size)}const a=Ue(r,b=>b.length?l(b):[]),c=we([]);a.subscribe(b=>{c.set(b)});const u=Ue([c,i],([b,E])=>{const O=(E-1)*10,x=O+10;return b.slice(O,x)}),d=(b,E)=>{const O=et(s).get(b),x=et(s).get(E);return{img_1:b,img_2:E,regions_id_1:O==null?void 0:O.regionId,regions_id_2:x==null?void 0:x.regionId}},f=(b,E)=>(c.update(O=>O.map(x=>{if(!E[x.id])return x;const k=x.members.filter(M=>!b.has(M));return{...x,members:k,size:k.length}}).filter(x=>x.size>0)),!0),h=async b=>{const E=Array.isArray(b)?b:Object.keys(b),O=new Set(E),x={};et(c).forEach(M=>{const P=M.members.filter(L=>O.has(L));P.length>0&&(x[M.id]=P)});const k=Object.entries(x).flatMap(([M,P])=>{const L=et(c).find(R=>R.id===M);if(!L)return[];const q=L.members.filter(R=>!O.has(R));return P.flatMap(R=>q.map(C=>d(R,C)))});if(k.length===0)return f(O,x),!0;try{const M=await zs(()=>fetch(`${window.location.origin}/${At}/uncategorize-pair-batch`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":en},body:JSON.stringify({pairs:k})}));return M.ok?(f(O,x),!0):(console.log(M),await ut(W==="en"?"Batch un-categorization failed":"La dé-catégorisation par lot a échoué",W==="en"?"Error":"Erreur"),!1)}catch(M){return await ut(M,W==="en"?"Error":"Erreur"),!1}},m=async b=>{const E=b.flatMap((O,x)=>b.slice(x+1).map(k=>d(O,k)));try{const O=await zs(()=>fetch(`${window.location.origin}/${At}/exact-match-batch`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":en},body:JSON.stringify({pairs:E})}));return O.ok?!0:(console.log(O),await ut(W==="en"?"Batch validation failed":"La validation par lot a échoué",W==="en"?"Error":"Erreur"),!1)}catch(O){return await ut(O,W==="en"?"Error":"Erreur"),console.error("Error:",O),!1}},g=async b=>{const E=await m(b.members);return E&&c.update(O=>O.map(x=>x.id===b.id?{...x,fullyConnected:!0}:x)),E},p=async b=>{if(b.length<2)return!1;const E=await m(b);return E&&c.update(O=>[{id:crypto.randomUUID(),members:b,size:b.length,fullyConnected:!0},...O].sort((k,M)=>M.size-k.size)),E},_=()=>Object.values(et(e).selected)[0]||{},S=async()=>{if(!await ut(W==="en"?"Do you want to create a cluster out of these images?":"Voulez-vous créer un cluster à partir de ces images ?",W==="en"?"Confirm creation":"Confirmer la création",!0))return;const E=_(),O=Object.keys(E);return O.length<2?(await ut(W==="en"?"Cluster creation requires at least 2 images":"La création d'un nouveau cluster nécessite a minima 2 images",W==="en"?"Impossible creation":"Création impossible"),!1):!await h(O)||!await p(O)?!1:(e.empty(),!0)},I=async()=>{if(!await ut(W==="en"?"Do you want to remove these images from their clusters?":"Voulez-vous supprimer ces images de leurs clusters ?",W==="en"?"Confirm deletion":"Confirmer la suppression",!0))return;const E=_();return await h(Object.keys(E))?(e.empty(),!0):!1};return{imageClusters:a,interfaceClusters:c,clusterNb:Ue(c,b=>b.length),validateCluster:g,removeFromClusters:I,newCluster:S,paginatedClusters:u,handlePageUpdate:o,pageLength:10,currentPage:i}}function Ia(t,e,n){const i=t.slice();return i[23]=e[n],i}function i0(t){let e,n,i;return{c(){e=w("p"),e.textContent=`La matrice de documents visualise les scores de similarité globaux entre tous les documents du
                        corpus.
                        Cliquez sur une cellule pour voir les détails des similarités entre pages.`,n=U(),i=w("ul"),i.innerHTML=`<li>Matrice : Scores normalisés entre documents (0-100).</li>
                        <li>Scatter plot : Similarités détaillées par page.</li>`},m(r,s){j(r,e,s),j(r,n,s),j(r,i,s)},d(r){r&&z(e),r&&z(n),r&&z(i)}}}function r0(t){let e,n,i;return{c(){e=w("p"),e.textContent=`The Documents Network illustrates the connections between different witnesses in the document
                        set.
                        Each node represents a witness, and edges denote relationships based on shared content or other
                        relevant factors.`,n=U(),i=w("ul"),i.innerHTML=`<li>Nodes: Witnesses in the document set.</li>
                        <li>Edges: Relationships based on shared content.</li>`},m(r,s){j(r,e,s),j(r,n,s),j(r,i,s)},d(r){r&&z(e),r&&z(n),r&&z(i)}}}function s0(t){let e,n,i;return{c(){e=w("p"),e.textContent=`The Regions Network visualizes the relationships between image regions across different witnesses
                        in the document set.
                        Each node represents an image region, and edges indicate similarity or connections based on
                        predefined criteria.`,n=U(),i=w("ul"),i.innerHTML=`<li>Nodes: Image regions from various witnesses.</li>
                        <li>Edges: Similarity links between regions.</li>`},m(r,s){j(r,e,s),j(r,n,s),j(r,i,s)},d(r){r&&z(e),r&&z(n),r&&z(i)}}}function o0(t){let e,n,i,r;function s(a,c){return a[21]==="img"?s0:a[21]==="doc"?r0:i0}let o=s(t),l=o(t);return i=new u_({props:{activeTab:t[21],documentSetStore:t[4]}}),{c(){e=w("div"),l.c(),n=U(),ae(i.$$.fragment),v(e,"slot","datavizInfo")},m(a,c){j(a,e,c),l.m(e,null),y(e,n),oe(i,e,null),r=!0},p(a,c){o!==(o=s(a))&&(l.d(1),l=o(a),l&&(l.c(),l.m(e,n)));const u={};c&2097152&&(u.activeTab=a[21]),i.$set(u)},i(a){r||(F(i.$$.fragment,a),r=!0)},o(a){K(i.$$.fragment,a),r=!1},d(a){a&&z(e),l.d(),le(i)}}}function l0(t){let e,n,i;return n=new Ef({props:{docSet:t[0],documentSetStore:t[4],clusterStore:t[8],$$slots:{datavizInfo:[o0]},$$scope:{ctx:t}}}),{c(){e=w("div"),ae(n.$$.fragment),v(e,"slot","sidebar")},m(r,s){j(r,e,s),oe(n,e,null),i=!0},p(r,s){const o={};s&1&&(o.docSet=r[0]),s&69206016&&(o.$$scope={dirty:s,ctx:r}),n.$set(o)},i(r){i||(F(n.$$.fragment,r),i=!0)},o(r){K(n.$$.fragment,r),i=!1},d(r){r&&z(e),le(n)}}}function Ma(t){let e,n,i,r,s,o,l,a=t[23].title+"",c,u;return{c(){e=w("div"),n=w("figure"),i=w("img"),s=U(),o=w("div"),l=w("span"),c=ne(a),u=U(),gt(i.src,r=Rt(t[23].img,t[23].xywh,"96,"))||v(i,"src",r),v(i,"alt","Extracted region"),v(l,"class","overlay-desc"),v(o,"class","overlay is-center"),v(n,"class","image is-64x64 card"),v(e,"class","selection cell")},m(d,f){j(d,e,f),y(e,n),y(n,i),y(n,s),y(n,o),y(o,l),y(l,c),y(e,u)},p(d,f){f&2&&!gt(i.src,r=Rt(d[23].img,d[23].xywh,"96,"))&&v(i,"src",r),f&2&&a!==(a=d[23].title+"")&&_e(c,a)},d(d){d&&z(e)}}}function a0(t){let e,n,i=Object.values(Object.values(t[1])[0]||{}),r=[];for(let s=0;s<i.length;s+=1)r[s]=Ma(Ia(t,i,s));return{c(){e=w("div"),n=w("div");for(let s=0;s<r.length;s+=1)r[s].c();v(n,"class","grid is-gap-2"),v(e,"slot","content"),v(e,"class","fixed-grid has-6-cols")},m(s,o){j(s,e,o),y(e,n);for(let l=0;l<r.length;l+=1)r[l]&&r[l].m(n,null)},p(s,o){if(o&2){i=Object.values(Object.values(s[1])[0]||{});let l;for(l=0;l<i.length;l+=1){const a=Ia(s,i,l);r[l]?r[l].p(a,o):(r[l]=Ma(a),r[l].c(),r[l].m(n,null))}for(;l<r.length;l+=1)r[l].d(1);r.length=i.length}},d(s){s&&z(e),Ye(r,s)}}}function c0(t){let e,n,i,r={ctx:t,current:null,token:null,hasCatch:!1,pending:v0,then:h0,catch:f0,value:22,blocks:[,,,]};return pr(n=t[3],r),{c(){e=qe(),r.block.c()},m(s,o){j(s,e,o),r.block.m(s,r.anchor=o),r.mount=()=>e.parentNode,r.anchor=e,i=!0},p(s,o){t=s,r.ctx=t,o&8&&n!==(n=t[3])&&pr(n,r)||Rs(r,t,o)},i(s){i||(F(r.block),i=!0)},o(s){for(let o=0;o<3;o+=1){const l=r.blocks[o];K(l)}i=!1},d(s){s&&z(e),r.block.d(s),r.token=null,r=null}}}function u0(t){let e,n,i;return{c(){e=w("article"),n=w("div"),i=ne(t[2]),v(n,"class","message-body"),v(e,"class","message is-danger")},m(r,s){j(r,e,s),y(e,n),y(n,i)},p(r,s){s&4&&_e(i,r[2])},i:X,o:X,d(r){r&&z(e)}}}function f0(t){return{c:X,m:X,p:X,i:X,o:X,d:X}}function h0(t){let e,n,i,r;const s=[m0,d0],o=[];function l(a,c){return a[22]===0?0:1}return e=l(t),n=o[e]=s[e](t),{c(){n.c(),i=qe()},m(a,c){o[e].m(a,c),j(a,i,c),r=!0},p(a,c){let u=e;e=l(a),e===u?o[e].p(a,c):(ke(),K(o[u],1,1,()=>{o[u]=null}),Ee(),n=o[e],n?n.p(a,c):(n=o[e]=s[e](a),n.c()),F(n,1),n.m(i.parentNode,i))},i(a){r||(F(n),r=!0)},o(a){K(n),r=!1},d(a){o[e].d(a),a&&z(i)}}}function d0(t){let e,n,i=t[9][t[21]]+"",r,s,o,l,a;const c=[_0,g0,p0],u=[];function d(f,h){return f[21]==="img"||f[21]==="doc"?0:f[21]==="sim"?1:f[21]==="mat"?2:-1}return~(o=d(t))&&(l=u[o]=c[o](t)),{c(){e=w("div"),n=w("h2"),r=ne(i),s=U(),l&&l.c(),v(n,"class","title is-3 has-text-link")},m(f,h){j(f,e,h),y(e,n),y(n,r),y(e,s),~o&&u[o].m(e,null),a=!0},p(f,h){(!a||h&2097152)&&i!==(i=f[9][f[21]]+"")&&_e(r,i);let m=o;o=d(f),o===m?~o&&u[o].p(f,h):(l&&(ke(),K(u[m],1,1,()=>{u[m]=null}),Ee()),~o?(l=u[o],l?l.p(f,h):(l=u[o]=c[o](f),l.c()),F(l,1),l.m(e,null)):l=null)},i(f){a||(F(l),a=!0)},o(f){K(l),a=!1},d(f){f&&z(e),~o&&u[o].d()}}}function m0(t){let e;return{c(){e=w("article"),e.innerHTML=`<div class="message-body">No document pairs found for this configuration.
                            Please adjust your selection criteria in the sidebar to include more documents or
                            categories.</div>`,v(e,"class","message is-warning")},m(n,i){j(n,e,i)},p:X,i:X,o:X,d(n){n&&z(e)}}}function p0(t){let e,n;return e=new s_({props:{documentSetStore:t[4]}}),{c(){ae(e.$$.fragment)},m(i,r){oe(e,i,r),n=!0},p:X,i(i){n||(F(e.$$.fragment,i),n=!0)},o(i){K(e.$$.fragment,i),n=!1},d(i){le(e,i)}}}function g0(t){let e,n;return e=new t0({props:{documentSetStore:t[4],clusterStore:t[8]}}),{c(){ae(e.$$.fragment)},m(i,r){oe(e,i,r),n=!0},p:X,i(i){n||(F(e.$$.fragment,i),n=!0)},o(i){K(e.$$.fragment,i),n=!1},d(i){le(e,i)}}}function _0(t){let e,n;return e=new Qg({props:{documentSetStore:t[4],type:t[21]}}),{c(){ae(e.$$.fragment)},m(i,r){oe(e,i,r),n=!0},p(i,r){const s={};r&2097152&&(s.type=i[21]),e.$set(s)},i(i){n||(F(e.$$.fragment,i),n=!0)},o(i){K(e.$$.fragment,i),n=!1},d(i){le(e,i)}}}function v0(t){let e;return{c(){e=w("progress"),e.textContent="Loading...",v(e,"class","progress is-link"),v(e,"max","100")},m(n,i){j(n,e,i)},p:X,i:X,o:X,d(n){n&&z(e)}}}function y0(t){let e,n,i,r,s,o;n=new cu({props:{$$slots:{content:[a0]},$$scope:{ctx:t}}});const l=[u0,c0],a=[];function c(u,d){return u[2]?0:1}return r=c(t),s=a[r]=l[r](t),{c(){e=w("div"),ae(n.$$.fragment),i=U(),s.c(),v(e,"slot","content")},m(u,d){j(u,e,d),oe(n,e,null),y(e,i),a[r].m(e,null),o=!0},p(u,d){const f={};d&67108866&&(f.$$scope={dirty:d,ctx:u}),n.$set(f);let h=r;r=c(u),r===h?a[r].p(u,d):(ke(),K(a[h],1,1,()=>{a[h]=null}),Ee(),s=a[r],s?s.p(u,d):(s=a[r]=l[r](u),s.c()),F(s,1),s.m(e,null))},i(u){o||(F(n.$$.fragment,u),F(s),o=!0)},o(u){K(n.$$.fragment,u),K(s),o=!1},d(u){u&&z(e),le(n),a[r].d()}}}function b0(t){let e,n;return e=new vu({props:{tabList:t[9],$$slots:{content:[y0,({activeTab:i})=>({21:i}),({activeTab:i})=>i?2097152:0],sidebar:[l0,({activeTab:i})=>({21:i}),({activeTab:i})=>i?2097152:0]},$$scope:{ctx:t}}}),{c(){ae(e.$$.fragment)},m(i,r){oe(e,i,r),n=!0},p(i,[r]){const s={};r&69206031&&(s.$$scope={dirty:r,ctx:i}),e.$set(s)},i(i){n||(F(e.$$.fragment,i),n=!0)},o(i){K(e.$$.fragment,i),n=!1},d(i){le(e,i)}}}function w0(t,e,n){var k;let i,r,s,{docSet:o}=e;const l=l_(o.id),{error:a,fetchPairs:c,selectedRegions:u,selectedCategories:d,threshold:f,topK:h,mutualTopK:m}=l;de(t,a,M=>n(2,r=M)),de(t,c,M=>n(3,s=M));let g,p,_,S,I;Hn(()=>{g=Kn(u,"regions","set"),p=Kn(d,"categories","array"),_=Kn(f,"threshold","number"),S=Kn(h,"topk","number"),I=Kn(m,"mutual","boolean");const M=u.subscribe(g),P=d.subscribe(p),L=f.subscribe(_),q=h.subscribe(S),R=m.subscribe(I);return()=>{M(),P(),L(),q(),R()}});const{selected:b}=Zi;de(t,b,M=>n(1,i=M));const E=n0(l,Zi),O={img:W==="en"?"Image Network":"Réseau d'images",doc:W==="en"?"Document Network":"Réseau de documents",sim:W==="en"?"Copy Clusters":"Groupe de copies",mat:W==="en"?"Document Matrix":"Matrice de documents"},x=((k=o==null?void 0:o.selection)==null?void 0:k.selected)||{Witness:{},Series:{},Work:{}};return wn("selectedDocuments",x),t.$$set=M=>{"docSet"in M&&n(0,o=M.docSet)},[o,i,r,s,l,a,c,b,E,O]}class S0 extends ye{constructor(e){super(),ve(this,e,w0,b0,pe,{docSet:0})}}new S0({target:document.getElementById("document-set"),props:{docSet}});const Dy="";function k0(t){let e,n,i;return n=new Dn({props:{item:t[0],height:"full"}}),{c(){e=w("div"),ae(n.$$.fragment),v(e,"class","img-wrapper svelte-1duc3w1")},m(r,s){j(r,e,s),oe(n,e,null),i=!0},p(r,[s]){const o={};s&1&&(o.item=r[0]),n.$set(o)},i(r){i||(F(n.$$.fragment,r),i=!0)},o(r){K(n.$$.fragment,r),i=!1},d(r){r&&z(e),le(n)}}}function E0(t,e,n){let{mainImgItem:i}=e;return t.$$set=r=>{"mainImgItem"in r&&n(0,i=r.mainImgItem)},[i]}class xa extends ye{constructor(e){super(),ve(this,e,E0,k0,pe,{mainImgItem:0})}}const Ry="";function C0(t){return{c:X,m:X,p:X,d:X}}function I0(t){let e,n=`${t[5][0]}%`,i=`${t[5][1]}%`,r=`${t[5][2]}%`,s=`${t[5][3]}%`;return{c(){e=w("div"),v(e,"class","modal-context-bbox svelte-zgr10j"),v(e,"aria-description",W==="fr"?"Position de la région extraite sur la page":"Position of the extracted region on the page"),De(e,"left",n),De(e,"top",i),De(e,"width",r),De(e,"height",s)},m(o,l){j(o,e,l)},p:X,d(o){o&&z(e)}}}function M0(t){return{c:X,m:X,p:X,d:X}}function x0(t){let e,n,i,r,s,o={ctx:t,current:null,token:null,hasCatch:!1,pending:M0,then:I0,catch:C0,value:5};return pr(t[1],o),{c(){e=w("div"),n=w("div"),i=w("img"),s=U(),o.block.c(),v(i,"class","card modal-context-full-page svelte-zgr10j"),gt(i.src,r=t[0])||v(i,"src",r),v(i,"alt",W==="fr"?"Vue de la page d'où la région est extraite":"View of the page the region is extracted from"),v(n,"class","modal-context-wrapper svelte-zgr10j"),v(e,"class","modal-context-outer pb-4 svelte-zgr10j")},m(l,a){j(l,e,a),y(e,n),y(n,i),y(n,s),o.block.m(n,o.anchor=null),o.mount=()=>n,o.anchor=null},p(l,[a]){t=l,Rs(o,t,a)},i:X,o:X,d(l){l&&z(e),o.block.d(),o.token=null,o=null}}}function A0(t,e,n){let{mainImgItem:i}=e;const r=Rt(i.img,"full","full"),s=Zc(i.img),o=i.xywh.map(Number),l=fetch(s).then(a=>a.json()).then(a=>[o[0]/a.width,o[1]/a.height,o[2]/a.width,o[3]/a.height].map(c=>c*100));return t.$$set=a=>{"mainImgItem"in a&&n(2,i=a.mainImgItem)},[r,l,i]}class T0 extends ye{constructor(e){super(),ve(this,e,A0,x0,pe,{mainImgItem:2})}}const $y="";function Aa(t,e,n){const i=t.slice();return i[13]=e[n].id,i[14]=e[n].label,i}function Ta(t){let e,n,i=t[14]+"",r,s,o,l,a;function c(){return t[9](t[13])}return{c(){e=w("li"),n=w("a"),r=ne(i),s=U(),v(n,"href",""),v(e,"class",o=t[13]===t[2]?"is-active":"")},m(u,d){j(u,e,d),y(e,n),y(n,r),y(e,s),l||(a=ge(n,"click",Ut(c)),l=!0)},p(u,d){t=u,d&4&&o!==(o=t[13]===t[2]?"is-active":"")&&v(e,"class",o)},d(u){u&&z(e),l=!1,a()}}}function N0(t){let e,n,i,r,s,o,l,a,c,u,d,f,h,m,g,p=t[3],_=[];for(let E=0;E<p.length;E+=1)_[E]=Ta(Aa(t,p,E));const S=[t[1][t[2]]||{}];var I=t[0][t[2]]||null;function b(E){let O={};for(let x=0;x<S.length;x+=1)O=Is(O,S[x]);return{props:O}}return I&&(u=_i(I,b())),{c(){e=w("div"),n=w("div"),i=U(),r=w("div"),s=w("div"),o=w("div"),l=w("ul");for(let E=0;E<_.length;E+=1)_[E].c();a=U(),c=w("div"),u&&ae(u.$$.fragment),d=U(),f=w("button"),v(n,"class","modal-background"),v(o,"class","tabs is-centered"),De(o,"height","fit-content"),v(c,"class","ml-4 mr-4 modal-main-wrapper svelte-1uakzh2"),Se(c,"pb-4",t[2]==="main"),v(s,"class","modal-inner svelte-1uakzh2"),v(r,"class","modal-content svelte-1uakzh2"),v(f,"class","modal-close is-large"),v(f,"aria-label","close"),v(e,"id","region-modal-wrapper"),v(e,"class","modal is-active")},m(E,O){j(E,e,O),y(e,n),y(e,i),y(e,r),y(r,s),y(s,o),y(o,l);for(let x=0;x<_.length;x+=1)_[x]&&_[x].m(l,null);y(s,a),y(s,c),u&&oe(u,c,null),y(e,d),y(e,f),h=!0,m||(g=[ge(n,"click",t[6]),ge(n,"keyup",t[5]),ge(f,"click",t[6])],m=!0)},p(E,[O]){if(O&28){p=E[3];let k;for(k=0;k<p.length;k+=1){const M=Aa(E,p,k);_[k]?_[k].p(M,O):(_[k]=Ta(M),_[k].c(),_[k].m(l,null))}for(;k<_.length;k+=1)_[k].d(1);_.length=p.length}const x=O&6?jc(S,[Fc(E[1][E[2]]||{})]):{};if(O&5&&I!==(I=E[0][E[2]]||null)){if(u){ke();const k=u;K(k.$$.fragment,1,0,()=>{le(k,1)}),Ee()}I?(u=_i(I,b()),ae(u.$$.fragment),F(u.$$.fragment,1),oe(u,c,null)):u=null}else I&&u.$set(x);(!h||O&4)&&Se(c,"pb-4",E[2]==="main")},i(E){h||(u&&F(u.$$.fragment,E),h=!0)},o(E){u&&K(u.$$.fragment,E),h=!1},d(E){E&&z(e),Ye(_,E),u&&le(u),m=!1,Ge(g)}}}function O0(t,e,n){let i,{mainImgItem:r}=e,{compareImgItem:s}=e;const o=bi(),l=s?["main","page","similarity","expansion"]:["main","page"],a={expansion:{fr:"Expansion de requête",en:"Query expansion"},similarity:{fr:"Comparaison",en:"Comparison"},page:{fr:"Vue de la page",en:"Page view"},main:{fr:"Vue principale",en:"Main view"}},c=l.map(p=>{var _;return{id:p,label:((_=a[p])==null?void 0:_[W])??"Main view"}}),u={main:xa,page:T0};s&&Promise.all([os(()=>Promise.resolve().then(()=>Ov),void 0).then(p=>p.default),os(()=>Promise.resolve().then(()=>sy),void 0).then(p=>p.default)]).then(([p,_])=>{const S=Object.keys(u);l.filter(I=>!S.includes(I)).map(I=>n(0,u[I]=I==="expansion"?_:I==="similarity"?p:xa,u))});const d={};l.map(p=>n(1,d[p]=p==="similarity"?{compareImgItem:s,mainImgItem:r}:{mainImgItem:r},d));const f=p=>n(2,i=p),h=p=>{p.key==="Escape"&&o("closeModal")},m=()=>o("closeModal");Hn(()=>{document.addEventListener("keyup",h)}),Un(()=>{document.removeEventListener("keydown",h)});const g=p=>f(p);return t.$$set=p=>{"mainImgItem"in p&&n(7,r=p.mainImgItem),"compareImgItem"in p&&n(8,s=p.compareImgItem)},n(2,i=l[0]),[u,d,i,c,f,h,m,r,s,g]}class P0 extends ye{constructor(e){super(),ve(this,e,O0,N0,pe,{mainImgItem:7,compareImgItem:8})}}const zy="";function L0(t){let e,n,i,r,s,o,l,a,c,u,d;return n=new Mi({props:{targetHtmlId:t[0],tooltipText:t[1]}}),{c(){e=w("div"),ae(n.$$.fragment),i=U(),r=w("button"),s=xt("svg"),o=xt("path"),l=xt("path"),a=xt("path"),v(o,"d","M53.6443 14.25C47.7042 5.33 37.7293 0 26.9801 0C16.2206 0 6.24576 5.33 0.305653 14.25L0 14.71L0.305653 15.17C6.24576 24.09 16.2206 29.42 26.9801 29.42C37.7293 29.42 47.7042 24.09 53.6443 15.16L53.95 14.71L53.6443 14.25ZM3.25025 14.71C7.63146 8.69001 14.0606 4.65 21.2641 3.22C20.0619 3.83 18.9411 4.62 17.963 5.59C15.5176 8.02 14.1625 11.25 14.1625 14.67C14.1625 18.11 15.5176 21.34 17.963 23.76C19.0124 24.79 20.1943 25.61 21.4781 26.23C14.1829 24.85 7.6824 20.78 3.25025 14.71ZM27.1125 22.64C22.7008 22.64 19.1041 19.08 19.1041 14.7C19.1041 12.59 19.9396 10.6 21.4475 9.10001C22.9555 7.60001 24.9729 6.77 27.1125 6.77C29.2522 6.77 31.2594 7.60001 32.7775 9.10001C34.2855 10.6 35.121 12.59 35.121 14.7C35.121 16.82 34.2855 18.82 32.7775 20.32C31.2594 21.81 29.242 22.64 27.1125 22.64ZM32.9915 26.14C34.204 25.53 35.3146 24.74 36.3029 23.77C38.7482 21.34 40.0932 18.11 40.0932 14.68C40.0932 9.75 37.281 5.47001 33.1647 3.32001C40.1747 4.81001 46.4102 8.83001 50.6896 14.71C46.3797 20.64 40.0728 24.67 32.9915 26.14Z"),v(o,"fill","black"),v(o,"class","svelte-19wutme"),v(l,"d","M26.9804 25.98C33.3222 25.98 38.4633 20.9343 38.4633 14.71C38.4633 8.48576 33.3222 3.44 26.9804 3.44C20.6386 3.44 15.4976 8.48576 15.4976 14.71C15.4976 20.9343 20.6386 25.98 26.9804 25.98Z"),v(l,"fill","black"),v(l,"class","svelte-19wutme"),v(a,"d","M17.9529 23.85L36.2928 5.85001"),v(a,"stroke","black"),v(a,"stroke-width","3"),v(a,"stroke-miterlimit","10"),v(a,"class","svelte-19wutme"),v(s,"width","54"),v(s,"height","30"),v(s,"viewBox","0 0 54 30"),v(s,"fill","none"),v(s,"xmlns","http://www.w3.org/2000/svg"),v(s,"class","svelte-19wutme"),v(r,"class","button tag svelte-19wutme"),v(r,"title",t[1]),v(e,"id",t[0])},m(f,h){j(f,e,h),oe(n,e,null),y(e,i),y(e,r),y(r,s),y(s,o),y(s,l),y(s,a),c=!0,u||(d=ge(r,"click",t[2]),u=!0)},p:X,i(f){c||(F(n.$$.fragment,f),c=!0)},o(f){K(n.$$.fragment,f),c=!1},d(f){f&&z(e),le(n),u=!1,d()}}}function D0(t,e,n){let i,r,{mainImgItem:s}=e,{compareImgItem:o=void 0}=e;wn("isInModal",!0);const l=`modal-opener-${window.crypto.randomUUID()}`,a=W==="fr"?"Vue détaillée":"Detailed view",c=(f,h)=>(f?(h=new P0({target:document.querySelector("body"),props:{mainImgItem:s,compareImgItem:o}}),h.$on("closeModal",d)):!f&&r!=null&&h.$destroy(),h),u=()=>n(5,i=!i),d=()=>n(5,i=!1);return t.$$set=f=>{"mainImgItem"in f&&n(3,s=f.mainImgItem),"compareImgItem"in f&&n(4,o=f.compareImgItem)},t.$$.update=()=>{t.$$.dirty&96&&n(6,r=c(i,r))},n(5,i=!1),[l,a,u,s,o,i,r]}class R0 extends ye{constructor(e){super(),ve(this,e,D0,L0,pe,{mainImgItem:3,compareImgItem:4})}}const $0=Object.freeze(Object.defineProperty({__proto__:null,default:R0},Symbol.toStringTag,{value:"Module"})),jy="";function z0(t){let e,n,i,r,s,o,l;return{c(){e=w("button"),n=w("span"),n.innerHTML='<span class="switch-control svelte-g5g8im"><span class="switch-spot"></span></span>',i=U(),r=w("span"),s=ne(t[0]),v(n,"class","switch mr-2 svelte-g5g8im"),v(r,"class","label svelte-g5g8im"),v(e,"id",t[3]),v(e,"name",t[3]),v(e,"class","input-checkbox-wrapper is-flex is-align-items-center-is-justify-content-center p-2 pl-3 pr-3 svelte-g5g8im"),v(e,"aria-label",t[0]),Se(e,"is-checked",t[2]),Se(e,"is-clickable",t[1]),Se(e,"button",t[1])},m(a,c){j(a,e,c),y(e,n),y(e,i),y(e,r),y(r,s),o||(l=ge(e,"click",Ut(t[4])),o=!0)},p(a,[c]){c&1&&_e(s,a[0]),c&1&&v(e,"aria-label",a[0]),c&4&&Se(e,"is-checked",a[2]),c&2&&Se(e,"is-clickable",a[1]),c&2&&Se(e,"button",a[1])},i:X,o:X,d(a){a&&z(e),o=!1,l()}}}function j0(t,e,n){let i,{toggleLabel:r}=e,{start:s=!1}=e,{buttonDisplay:o=!1}=e;const l=`input-toggle-${window.crypto.randomUUID()}`,a=bi(),c=_t("resetTrigger")||void 0;c==null||c.subscribe(d);const u=()=>n(2,i=!i);function d(){n(2,i=s)}return t.$$set=f=>{"toggleLabel"in f&&n(0,r=f.toggleLabel),"start"in f&&n(5,s=f.start),"buttonDisplay"in f&&n(1,o=f.buttonDisplay)},t.$$.update=()=>{t.$$.dirty&32&&n(2,i=s),t.$$.dirty&4&&a("updateChecked",i)},[r,o,i,l,u,s]}class F0 extends ye{constructor(e){super(),ve(this,e,j0,z0,pe,{toggleLabel:0,start:5,buttonDisplay:1})}}/*! choices.js v11.1.0 | © 2025 Josh Johnson | https://github.com/jshjohnson/Choices#readme */var cs=function(t,e){return cs=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(n[r]=i[r])},cs(t,e)};function Na(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");cs(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}var ht=function(){return ht=Object.assign||function(e){for(var n,i=1,r=arguments.length;i<r;i++){n=arguments[i];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},ht.apply(this,arguments)};function V0(t,e,n){if(n||arguments.length===2)for(var i=0,r=e.length,s;i<r;i++)(s||!(i in e))&&(s||(s=Array.prototype.slice.call(e,0,i)),s[i]=e[i]);return t.concat(s||Array.prototype.slice.call(e))}typeof SuppressedError=="function"&&SuppressedError;var Fe={ADD_CHOICE:"ADD_CHOICE",REMOVE_CHOICE:"REMOVE_CHOICE",FILTER_CHOICES:"FILTER_CHOICES",ACTIVATE_CHOICES:"ACTIVATE_CHOICES",CLEAR_CHOICES:"CLEAR_CHOICES",ADD_GROUP:"ADD_GROUP",ADD_ITEM:"ADD_ITEM",REMOVE_ITEM:"REMOVE_ITEM",HIGHLIGHT_ITEM:"HIGHLIGHT_ITEM"},dt={showDropdown:"showDropdown",hideDropdown:"hideDropdown",change:"change",choice:"choice",search:"search",addItem:"addItem",removeItem:"removeItem",highlightItem:"highlightItem",highlightChoice:"highlightChoice",unhighlightItem:"unhighlightItem"},Qe={TAB_KEY:9,SHIFT_KEY:16,BACK_KEY:46,DELETE_KEY:8,ENTER_KEY:13,A_KEY:65,ESC_KEY:27,UP_KEY:38,DOWN_KEY:40,PAGE_UP_KEY:33,PAGE_DOWN_KEY:34},H0=["fuseOptions","classNames"],on={Text:"text",SelectOne:"select-one",SelectMultiple:"select-multiple"},Oa=function(t){return{type:Fe.ADD_CHOICE,choice:t}},U0=function(t){return{type:Fe.REMOVE_CHOICE,choice:t}},B0=function(t){return{type:Fe.FILTER_CHOICES,results:t}},q0=function(t){return{type:Fe.ACTIVATE_CHOICES,active:t}},K0=function(t){return{type:Fe.ADD_GROUP,group:t}},Pa=function(t){return{type:Fe.ADD_ITEM,item:t}},La=function(t){return{type:Fe.REMOVE_ITEM,item:t}},er=function(t,e){return{type:Fe.HIGHLIGHT_ITEM,item:t,highlighted:e}},W0=function(t,e){return Math.floor(Math.random()*(e-t)+t)},Da=function(t){return Array.from({length:t},function(){return W0(0,36).toString(36)}).join("")},G0=function(t,e){var n=t.id||t.name&&"".concat(t.name,"-").concat(Da(2))||Da(4);return n=n.replace(/(:|\.|\[|\]|,)/g,""),n="".concat(e,"-").concat(n),n},Y0=function(t,e,n){n===void 0&&(n=1);for(var i="".concat(n>0?"next":"previous","ElementSibling"),r=t[i];r;){if(r.matches(e))return r;r=r[i]}return null},X0=function(t,e,n){n===void 0&&(n=1);var i;return n>0?i=e.scrollTop+e.offsetHeight>=t.offsetTop+t.offsetHeight:i=t.offsetTop>=e.scrollTop,i},tr=function(t){if(typeof t!="string"){if(t==null)return"";if(typeof t=="object"){if("raw"in t)return tr(t.raw);if("trusted"in t)return t.trusted}return t}return t.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/'/g,"&#039;").replace(/"/g,"&quot;")},J0=function(){var t=document.createElement("div");return function(e){t.innerHTML=e.trim();for(var n=t.children[0];t.firstChild;)t.removeChild(t.firstChild);return n}}(),oi=function(t,e){return typeof t=="function"?t(tr(e),e):t},Ra=function(t){return typeof t=="function"?t():t},pn=function(t){if(typeof t=="string")return t;if(typeof t=="object"){if("trusted"in t)return t.trusted;if("raw"in t)return t.raw}return""},$a=function(t){if(typeof t=="string")return t;if(typeof t=="object"){if("escaped"in t)return t.escaped;if("trusted"in t)return t.trusted}return""},us=function(t,e){return t?$a(e):tr(e)},Xt=function(t,e,n){t.innerHTML=us(e,n)},Q0=function(t,e){var n=t.value,i=t.label,r=i===void 0?n:i,s=e.value,o=e.label,l=o===void 0?s:o;return pn(r).localeCompare(pn(l),[],{sensitivity:"base",ignorePunctuation:!0,numeric:!0})},Z0=function(t,e){return t.rank-e.rank},e1=function(t,e,n){n===void 0&&(n=null);var i=new CustomEvent(e,{detail:n,bubbles:!0,cancelable:!0});return t.dispatchEvent(i)},t1=function(t,e){var n=Object.keys(t).sort(),i=Object.keys(e).sort();return n.filter(function(r){return i.indexOf(r)<0})},nr=function(t){return Array.isArray(t)?t:[t]},li=function(t){return t&&Array.isArray(t)?t.map(function(e){return".".concat(e)}).join(""):".".concat(t)},me=function(t,e){var n;(n=t.classList).add.apply(n,nr(e))},jt=function(t,e){var n;(n=t.classList).remove.apply(n,nr(e))},n1=function(t){if(typeof t<"u")try{return JSON.parse(t)}catch{return t}return{}},i1=function(t,e,n){var i=t.itemEl;i&&(jt(i,n),me(i,e))},r1=function(){function t(e){var n=e.element,i=e.type,r=e.classNames;this.element=n,this.classNames=r,this.type=i,this.isActive=!1}return t.prototype.show=function(){return me(this.element,this.classNames.activeState),this.element.setAttribute("aria-expanded","true"),this.isActive=!0,this},t.prototype.hide=function(){return jt(this.element,this.classNames.activeState),this.element.setAttribute("aria-expanded","false"),this.isActive=!1,this},t}(),za=function(){function t(e){var n=e.element,i=e.type,r=e.classNames,s=e.position;this.element=n,this.classNames=r,this.type=i,this.position=s,this.isOpen=!1,this.isFlipped=!1,this.isDisabled=!1,this.isLoading=!1}return t.prototype.shouldFlip=function(e,n){var i=!1;return this.position==="auto"?i=this.element.getBoundingClientRect().top-n>=0&&!window.matchMedia("(min-height: ".concat(e+1,"px)")).matches:this.position==="top"&&(i=!0),i},t.prototype.setActiveDescendant=function(e){this.element.setAttribute("aria-activedescendant",e)},t.prototype.removeActiveDescendant=function(){this.element.removeAttribute("aria-activedescendant")},t.prototype.open=function(e,n){me(this.element,this.classNames.openState),this.element.setAttribute("aria-expanded","true"),this.isOpen=!0,this.shouldFlip(e,n)&&(me(this.element,this.classNames.flippedState),this.isFlipped=!0)},t.prototype.close=function(){jt(this.element,this.classNames.openState),this.element.setAttribute("aria-expanded","false"),this.removeActiveDescendant(),this.isOpen=!1,this.isFlipped&&(jt(this.element,this.classNames.flippedState),this.isFlipped=!1)},t.prototype.addFocusState=function(){me(this.element,this.classNames.focusState)},t.prototype.removeFocusState=function(){jt(this.element,this.classNames.focusState)},t.prototype.enable=function(){jt(this.element,this.classNames.disabledState),this.element.removeAttribute("aria-disabled"),this.type===on.SelectOne&&this.element.setAttribute("tabindex","0"),this.isDisabled=!1},t.prototype.disable=function(){me(this.element,this.classNames.disabledState),this.element.setAttribute("aria-disabled","true"),this.type===on.SelectOne&&this.element.setAttribute("tabindex","-1"),this.isDisabled=!0},t.prototype.wrap=function(e){var n=this.element,i=e.parentNode;i&&(e.nextSibling?i.insertBefore(n,e.nextSibling):i.appendChild(n)),n.appendChild(e)},t.prototype.unwrap=function(e){var n=this.element,i=n.parentNode;i&&(i.insertBefore(e,n),i.removeChild(n))},t.prototype.addLoadingState=function(){me(this.element,this.classNames.loadingState),this.element.setAttribute("aria-busy","true"),this.isLoading=!0},t.prototype.removeLoadingState=function(){jt(this.element,this.classNames.loadingState),this.element.removeAttribute("aria-busy"),this.isLoading=!1},t}(),s1=function(){function t(e){var n=e.element,i=e.type,r=e.classNames,s=e.preventPaste;this.element=n,this.type=i,this.classNames=r,this.preventPaste=s,this.isFocussed=this.element.isEqualNode(document.activeElement),this.isDisabled=n.disabled,this._onPaste=this._onPaste.bind(this),this._onInput=this._onInput.bind(this),this._onFocus=this._onFocus.bind(this),this._onBlur=this._onBlur.bind(this)}return Object.defineProperty(t.prototype,"placeholder",{set:function(e){this.element.placeholder=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){return this.element.value},set:function(e){this.element.value=e},enumerable:!1,configurable:!0}),t.prototype.addEventListeners=function(){var e=this.element;e.addEventListener("paste",this._onPaste),e.addEventListener("input",this._onInput,{passive:!0}),e.addEventListener("focus",this._onFocus,{passive:!0}),e.addEventListener("blur",this._onBlur,{passive:!0})},t.prototype.removeEventListeners=function(){var e=this.element;e.removeEventListener("input",this._onInput),e.removeEventListener("paste",this._onPaste),e.removeEventListener("focus",this._onFocus),e.removeEventListener("blur",this._onBlur)},t.prototype.enable=function(){var e=this.element;e.removeAttribute("disabled"),this.isDisabled=!1},t.prototype.disable=function(){var e=this.element;e.setAttribute("disabled",""),this.isDisabled=!0},t.prototype.focus=function(){this.isFocussed||this.element.focus()},t.prototype.blur=function(){this.isFocussed&&this.element.blur()},t.prototype.clear=function(e){return e===void 0&&(e=!0),this.element.value="",e&&this.setWidth(),this},t.prototype.setWidth=function(){var e=this.element;e.style.minWidth="".concat(e.placeholder.length+1,"ch"),e.style.width="".concat(e.value.length+1,"ch")},t.prototype.setActiveDescendant=function(e){this.element.setAttribute("aria-activedescendant",e)},t.prototype.removeActiveDescendant=function(){this.element.removeAttribute("aria-activedescendant")},t.prototype._onInput=function(){this.type!==on.SelectOne&&this.setWidth()},t.prototype._onPaste=function(e){this.preventPaste&&e.preventDefault()},t.prototype._onFocus=function(){this.isFocussed=!0},t.prototype._onBlur=function(){this.isFocussed=!1},t}(),o1=4,ja=function(){function t(e){var n=e.element;this.element=n,this.scrollPos=this.element.scrollTop,this.height=this.element.offsetHeight}return t.prototype.prepend=function(e){var n=this.element.firstElementChild;n?this.element.insertBefore(e,n):this.element.append(e)},t.prototype.scrollToTop=function(){this.element.scrollTop=0},t.prototype.scrollToChildElement=function(e,n){var i=this;if(e){var r=this.element.offsetHeight,s=this.element.scrollTop+r,o=e.offsetHeight,l=e.offsetTop+o,a=n>0?this.element.scrollTop+l-s:e.offsetTop;requestAnimationFrame(function(){i._animateScroll(a,n)})}},t.prototype._scrollDown=function(e,n,i){var r=(i-e)/n,s=r>1?r:1;this.element.scrollTop=e+s},t.prototype._scrollUp=function(e,n,i){var r=(e-i)/n,s=r>1?r:1;this.element.scrollTop=e-s},t.prototype._animateScroll=function(e,n){var i=this,r=o1,s=this.element.scrollTop,o=!1;n>0?(this._scrollDown(s,r,e),s<e&&(o=!0)):(this._scrollUp(s,r,e),s>e&&(o=!0)),o&&requestAnimationFrame(function(){i._animateScroll(e,n)})},t}(),Fa=function(){function t(e){var n=e.element,i=e.classNames;this.element=n,this.classNames=i,this.isDisabled=!1}return Object.defineProperty(t.prototype,"isActive",{get:function(){return this.element.dataset.choice==="active"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dir",{get:function(){return this.element.dir},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){return this.element.value},set:function(e){this.element.setAttribute("value",e),this.element.value=e},enumerable:!1,configurable:!0}),t.prototype.conceal=function(){var e=this.element;me(e,this.classNames.input),e.hidden=!0,e.tabIndex=-1;var n=e.getAttribute("style");n&&e.setAttribute("data-choice-orig-style",n),e.setAttribute("data-choice","active")},t.prototype.reveal=function(){var e=this.element;jt(e,this.classNames.input),e.hidden=!1,e.removeAttribute("tabindex");var n=e.getAttribute("data-choice-orig-style");n?(e.removeAttribute("data-choice-orig-style"),e.setAttribute("style",n)):e.removeAttribute("style"),e.removeAttribute("data-choice")},t.prototype.enable=function(){this.element.removeAttribute("disabled"),this.element.disabled=!1,this.isDisabled=!1},t.prototype.disable=function(){this.element.setAttribute("disabled",""),this.element.disabled=!0,this.isDisabled=!0},t.prototype.triggerEvent=function(e,n){e1(this.element,e,n||{})},t}(),l1=function(t){Na(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e}(Fa),ai=function(t,e){return e===void 0&&(e=!0),typeof t>"u"?e:!!t},Va=function(t){if(typeof t=="string"&&(t=t.split(" ").filter(function(e){return e.length})),Array.isArray(t)&&t.length)return t},Ft=function(t,e,n){if(n===void 0&&(n=!0),typeof t=="string"){var i=tr(t),r=n||i===t?t:{escaped:i,raw:t},s=Ft({value:t,label:r,selected:!0},!1);return s}var o=t;if("choices"in o){if(!e)throw new TypeError("optGroup is not allowed");var l=o,a=l.choices.map(function(f){return Ft(f,!1)}),c={id:0,label:pn(l.label)||l.value,active:!!a.length,disabled:!!l.disabled,choices:a};return c}var u=o,d={id:0,group:null,score:0,rank:0,value:u.value,label:u.label||u.value,active:ai(u.active),selected:ai(u.selected,!1),disabled:ai(u.disabled,!1),placeholder:ai(u.placeholder,!1),highlighted:!1,labelClass:Va(u.labelClass),labelDescription:u.labelDescription,customProperties:u.customProperties};return d},a1=function(t){return t.tagName==="INPUT"},Ha=function(t){return t.tagName==="SELECT"},c1=function(t){return t.tagName==="OPTION"},u1=function(t){return t.tagName==="OPTGROUP"},f1=function(t){Na(e,t);function e(n){var i=n.element,r=n.classNames,s=n.template,o=n.extractPlaceholder,l=t.call(this,{element:i,classNames:r})||this;return l.template=s,l.extractPlaceholder=o,l}return Object.defineProperty(e.prototype,"placeholderOption",{get:function(){return this.element.querySelector('option[value=""]')||this.element.querySelector("option[placeholder]")},enumerable:!1,configurable:!0}),e.prototype.addOptions=function(n){var i=this,r=document.createDocumentFragment();n.forEach(function(s){var o=s;if(!o.element){var l=i.template(o);r.appendChild(l),o.element=l}}),this.element.appendChild(r)},e.prototype.optionsAsChoices=function(){var n=this,i=[];return this.element.querySelectorAll(":scope > option, :scope > optgroup").forEach(function(r){c1(r)?i.push(n._optionToChoice(r)):u1(r)&&i.push(n._optgroupToChoice(r))}),i},e.prototype._optionToChoice=function(n){return!n.hasAttribute("value")&&n.hasAttribute("placeholder")&&(n.setAttribute("value",""),n.value=""),{id:0,group:null,score:0,rank:0,value:n.value,label:n.label,element:n,active:!0,selected:this.extractPlaceholder?n.selected:n.hasAttribute("selected"),disabled:n.disabled,highlighted:!1,placeholder:this.extractPlaceholder&&(!n.value||n.hasAttribute("placeholder")),labelClass:typeof n.dataset.labelClass<"u"?Va(n.dataset.labelClass):void 0,labelDescription:typeof n.dataset.labelDescription<"u"?n.dataset.labelDescription:void 0,customProperties:n1(n.dataset.customProperties)}},e.prototype._optgroupToChoice=function(n){var i=this,r=n.querySelectorAll("option"),s=Array.from(r).map(function(o){return i._optionToChoice(o)});return{id:0,label:n.label||"",element:n,active:!!s.length,disabled:n.disabled,choices:s}},e}(Fa),h1={containerOuter:["choices"],containerInner:["choices__inner"],input:["choices__input"],inputCloned:["choices__input--cloned"],list:["choices__list"],listItems:["choices__list--multiple"],listSingle:["choices__list--single"],listDropdown:["choices__list--dropdown"],item:["choices__item"],itemSelectable:["choices__item--selectable"],itemDisabled:["choices__item--disabled"],itemChoice:["choices__item--choice"],description:["choices__description"],placeholder:["choices__placeholder"],group:["choices__group"],groupHeading:["choices__heading"],button:["choices__button"],activeState:["is-active"],focusState:["is-focused"],openState:["is-open"],disabledState:["is-disabled"],highlightedState:["is-highlighted"],selectedState:["is-selected"],flippedState:["is-flipped"],loadingState:["is-loading"],notice:["choices__notice"],addChoice:["choices__item--selectable","add-choice"],noResults:["has-no-results"],noChoices:["has-no-choices"]},Ua={items:[],choices:[],silent:!1,renderChoiceLimit:-1,maxItemCount:-1,closeDropdownOnSelect:"auto",singleModeForMultiSelect:!1,addChoices:!1,addItems:!0,addItemFilter:function(t){return!!t&&t!==""},removeItems:!0,removeItemButton:!1,removeItemButtonAlignLeft:!1,editItems:!1,allowHTML:!1,allowHtmlUserInput:!1,duplicateItemsAllowed:!0,delimiter:",",paste:!0,searchEnabled:!0,searchChoices:!0,searchFloor:1,searchResultLimit:4,searchFields:["label","value"],position:"auto",resetScrollPosition:!0,shouldSort:!0,shouldSortItems:!1,sorter:Q0,shadowRoot:null,placeholder:!0,placeholderValue:null,searchPlaceholderValue:null,prependValue:null,appendValue:null,renderSelectedChoices:"auto",loadingText:"Loading...",noResultsText:"No results found",noChoicesText:"No choices to choose from",itemSelectText:"Press to select",uniqueItemText:"Only unique values can be added",customAddItemText:"Only values matching specific conditions can be added",addItemText:function(t){return'Press Enter to add <b>"'.concat(t,'"</b>')},removeItemIconText:function(){return"Remove item"},removeItemLabelText:function(t){return"Remove item: ".concat(t)},maxItemText:function(t){return"Only ".concat(t," values can be added")},valueComparer:function(t,e){return t===e},fuseOptions:{includeScore:!0},labelId:"",callbackOnInit:null,callbackOnCreateTemplates:null,classNames:h1,appendGroupInSearch:!1},Ba=function(t){var e=t.itemEl;e&&(e.remove(),t.itemEl=void 0)};function d1(t,e,n){var i=t,r=!0;switch(e.type){case Fe.ADD_ITEM:{e.item.selected=!0;var s=e.item.element;s&&(s.selected=!0,s.setAttribute("selected","")),i.push(e.item);break}case Fe.REMOVE_ITEM:{e.item.selected=!1;var s=e.item.element;if(s){s.selected=!1,s.removeAttribute("selected");var o=s.parentElement;o&&Ha(o)&&o.type===on.SelectOne&&(o.value="")}Ba(e.item),i=i.filter(function(u){return u.id!==e.item.id});break}case Fe.REMOVE_CHOICE:{Ba(e.choice),i=i.filter(function(c){return c.id!==e.choice.id});break}case Fe.HIGHLIGHT_ITEM:{var l=e.highlighted,a=i.find(function(c){return c.id===e.item.id});a&&a.highlighted!==l&&(a.highlighted=l,n&&i1(a,l?n.classNames.highlightedState:n.classNames.selectedState,l?n.classNames.selectedState:n.classNames.highlightedState));break}default:{r=!1;break}}return{state:i,update:r}}function m1(t,e){var n=t,i=!0;switch(e.type){case Fe.ADD_GROUP:{n.push(e.group);break}case Fe.CLEAR_CHOICES:{n=[];break}default:{i=!1;break}}return{state:n,update:i}}function p1(t,e,n){var i=t,r=!0;switch(e.type){case Fe.ADD_CHOICE:{i.push(e.choice);break}case Fe.REMOVE_CHOICE:{e.choice.choiceEl=void 0,e.choice.group&&(e.choice.group.choices=e.choice.group.choices.filter(function(o){return o.id!==e.choice.id})),i=i.filter(function(o){return o.id!==e.choice.id});break}case Fe.ADD_ITEM:case Fe.REMOVE_ITEM:{e.item.choiceEl=void 0;break}case Fe.FILTER_CHOICES:{var s=[];e.results.forEach(function(o){s[o.item.id]=o}),i.forEach(function(o){var l=s[o.id];l!==void 0?(o.score=l.score,o.rank=l.rank,o.active=!0):(o.score=0,o.rank=0,o.active=!1),n&&n.appendGroupInSearch&&(o.choiceEl=void 0)});break}case Fe.ACTIVATE_CHOICES:{i.forEach(function(o){o.active=e.active,n&&n.appendGroupInSearch&&(o.choiceEl=void 0)});break}case Fe.CLEAR_CHOICES:{i=[];break}default:{r=!1;break}}return{state:i,update:r}}var qa={groups:m1,items:d1,choices:p1},g1=function(){function t(e){this._state=this.defaultState,this._listeners=[],this._txn=0,this._context=e}return Object.defineProperty(t.prototype,"defaultState",{get:function(){return{groups:[],items:[],choices:[]}},enumerable:!1,configurable:!0}),t.prototype.changeSet=function(e){return{groups:e,items:e,choices:e}},t.prototype.reset=function(){this._state=this.defaultState;var e=this.changeSet(!0);this._txn?this._changeSet=e:this._listeners.forEach(function(n){return n(e)})},t.prototype.subscribe=function(e){return this._listeners.push(e),this},t.prototype.dispatch=function(e){var n=this,i=this._state,r=!1,s=this._changeSet||this.changeSet(!1);Object.keys(qa).forEach(function(o){var l=qa[o](i[o],e,n._context);l.update&&(r=!0,s[o]=!0,i[o]=l.state)}),r&&(this._txn?this._changeSet=s:this._listeners.forEach(function(o){return o(s)}))},t.prototype.withTxn=function(e){this._txn++;try{e()}finally{if(this._txn=Math.max(0,this._txn-1),!this._txn){var n=this._changeSet;n&&(this._changeSet=void 0,this._listeners.forEach(function(i){return i(n)}))}}},Object.defineProperty(t.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"items",{get:function(){return this.state.items},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"highlightedActiveItems",{get:function(){return this.items.filter(function(e){return e.active&&e.highlighted})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"choices",{get:function(){return this.state.choices},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"activeChoices",{get:function(){return this.choices.filter(function(e){return e.active})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"searchableChoices",{get:function(){return this.choices.filter(function(e){return!e.disabled&&!e.placeholder})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"groups",{get:function(){return this.state.groups},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"activeGroups",{get:function(){var e=this;return this.state.groups.filter(function(n){var i=n.active&&!n.disabled,r=e.state.choices.some(function(s){return s.active&&!s.disabled});return i&&r},[])},enumerable:!1,configurable:!0}),t.prototype.inTxn=function(){return this._txn>0},t.prototype.getChoiceById=function(e){return this.activeChoices.find(function(n){return n.id===e})},t.prototype.getGroupById=function(e){return this.groups.find(function(n){return n.id===e})},t}(),Ke={noChoices:"no-choices",noResults:"no-results",addChoice:"add-choice",generic:""};function _1(t,e,n){return(e=y1(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Ka(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function Rn(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Ka(Object(n),!0).forEach(function(i){_1(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Ka(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}function v1(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var i=n.call(t,e||"default");if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function y1(t){var e=v1(t,"string");return typeof e=="symbol"?e:e+""}function Jt(t){return Array.isArray?Array.isArray(t):Ya(t)==="[object Array]"}const b1=1/0;function w1(t){if(typeof t=="string")return t;let e=t+"";return e=="0"&&1/t==-b1?"-0":e}function S1(t){return t==null?"":w1(t)}function Vt(t){return typeof t=="string"}function Wa(t){return typeof t=="number"}function k1(t){return t===!0||t===!1||E1(t)&&Ya(t)=="[object Boolean]"}function Ga(t){return typeof t=="object"}function E1(t){return Ga(t)&&t!==null}function yt(t){return t!=null}function fs(t){return!t.trim().length}function Ya(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(t)}const Fy="Extended search is not available",C1="Incorrect 'index' type",I1=t=>`Invalid value for key ${t}`,M1=t=>`Pattern length exceeds max of ${t}.`,x1=t=>`Missing ${t} property in key`,A1=t=>`Property 'weight' in key '${t}' must be a positive integer`,Xa=Object.prototype.hasOwnProperty;class T1{constructor(e){this._keys=[],this._keyMap={};let n=0;e.forEach(i=>{let r=Ja(i);this._keys.push(r),this._keyMap[r.id]=r,n+=r.weight}),this._keys.forEach(i=>{i.weight/=n})}get(e){return this._keyMap[e]}keys(){return this._keys}toJSON(){return JSON.stringify(this._keys)}}function Ja(t){let e=null,n=null,i=null,r=1,s=null;if(Vt(t)||Jt(t))i=t,e=Qa(t),n=hs(t);else{if(!Xa.call(t,"name"))throw new Error(x1("name"));const o=t.name;if(i=o,Xa.call(t,"weight")&&(r=t.weight,r<=0))throw new Error(A1(o));e=Qa(o),n=hs(o),s=t.getFn}return{path:e,id:n,weight:r,src:i,getFn:s}}function Qa(t){return Jt(t)?t:t.split(".")}function hs(t){return Jt(t)?t.join("."):t}function N1(t,e){let n=[],i=!1;const r=(s,o,l)=>{if(yt(s))if(!o[l])n.push(s);else{let a=o[l];const c=s[a];if(!yt(c))return;if(l===o.length-1&&(Vt(c)||Wa(c)||k1(c)))n.push(S1(c));else if(Jt(c)){i=!0;for(let u=0,d=c.length;u<d;u+=1)r(c[u],o,l+1)}else o.length&&r(c,o,l+1)}};return r(t,Vt(e)?e.split("."):e,0),i?n:n[0]}const O1={includeMatches:!1,findAllMatches:!1,minMatchCharLength:1},P1={isCaseSensitive:!1,includeScore:!1,keys:[],shouldSort:!0,sortFn:(t,e)=>t.score===e.score?t.idx<e.idx?-1:1:t.score<e.score?-1:1},L1={location:0,threshold:.6,distance:100},D1={useExtendedSearch:!1,getFn:N1,ignoreLocation:!1,ignoreFieldNorm:!1,fieldNormWeight:1};var he=Rn(Rn(Rn(Rn({},P1),O1),L1),D1);const R1=/[^ ]+/g;function $1(t=1,e=3){const n=new Map,i=Math.pow(10,e);return{get(r){const s=r.match(R1).length;if(n.has(s))return n.get(s);const o=1/Math.pow(s,.5*t),l=parseFloat(Math.round(o*i)/i);return n.set(s,l),l},clear(){n.clear()}}}class ds{constructor({getFn:e=he.getFn,fieldNormWeight:n=he.fieldNormWeight}={}){this.norm=$1(n,3),this.getFn=e,this.isCreated=!1,this.setIndexRecords()}setSources(e=[]){this.docs=e}setIndexRecords(e=[]){this.records=e}setKeys(e=[]){this.keys=e,this._keysMap={},e.forEach((n,i)=>{this._keysMap[n.id]=i})}create(){this.isCreated||!this.docs.length||(this.isCreated=!0,Vt(this.docs[0])?this.docs.forEach((e,n)=>{this._addString(e,n)}):this.docs.forEach((e,n)=>{this._addObject(e,n)}),this.norm.clear())}add(e){const n=this.size();Vt(e)?this._addString(e,n):this._addObject(e,n)}removeAt(e){this.records.splice(e,1);for(let n=e,i=this.size();n<i;n+=1)this.records[n].i-=1}getValueForItemAtKeyId(e,n){return e[this._keysMap[n]]}size(){return this.records.length}_addString(e,n){if(!yt(e)||fs(e))return;let i={v:e,i:n,n:this.norm.get(e)};this.records.push(i)}_addObject(e,n){let i={i:n,$:{}};this.keys.forEach((r,s)=>{let o=r.getFn?r.getFn(e):this.getFn(e,r.path);if(yt(o)){if(Jt(o)){let l=[];const a=[{nestedArrIndex:-1,value:o}];for(;a.length;){const{nestedArrIndex:c,value:u}=a.pop();if(yt(u))if(Vt(u)&&!fs(u)){let d={v:u,i:c,n:this.norm.get(u)};l.push(d)}else Jt(u)&&u.forEach((d,f)=>{a.push({nestedArrIndex:f,value:d})})}i.$[s]=l}else if(Vt(o)&&!fs(o)){let l={v:o,n:this.norm.get(o)};i.$[s]=l}}}),this.records.push(i)}toJSON(){return{keys:this.keys,records:this.records}}}function Za(t,e,{getFn:n=he.getFn,fieldNormWeight:i=he.fieldNormWeight}={}){const r=new ds({getFn:n,fieldNormWeight:i});return r.setKeys(t.map(Ja)),r.setSources(e),r.create(),r}function z1(t,{getFn:e=he.getFn,fieldNormWeight:n=he.fieldNormWeight}={}){const{keys:i,records:r}=t,s=new ds({getFn:e,fieldNormWeight:n});return s.setKeys(i),s.setIndexRecords(r),s}function ir(t,{errors:e=0,currentLocation:n=0,expectedLocation:i=0,distance:r=he.distance,ignoreLocation:s=he.ignoreLocation}={}){const o=e/t.length;if(s)return o;const l=Math.abs(i-n);return r?o+l/r:l?1:o}function j1(t=[],e=he.minMatchCharLength){let n=[],i=-1,r=-1,s=0;for(let o=t.length;s<o;s+=1){let l=t[s];l&&i===-1?i=s:!l&&i!==-1&&(r=s-1,r-i+1>=e&&n.push([i,r]),i=-1)}return t[s-1]&&s-i>=e&&n.push([i,s-1]),n}const gn=32;function F1(t,e,n,{location:i=he.location,distance:r=he.distance,threshold:s=he.threshold,findAllMatches:o=he.findAllMatches,minMatchCharLength:l=he.minMatchCharLength,includeMatches:a=he.includeMatches,ignoreLocation:c=he.ignoreLocation}={}){if(e.length>gn)throw new Error(M1(gn));const u=e.length,d=t.length,f=Math.max(0,Math.min(i,d));let h=s,m=f;const g=l>1||a,p=g?Array(d):[];let _;for(;(_=t.indexOf(e,m))>-1;){let x=ir(e,{currentLocation:_,expectedLocation:f,distance:r,ignoreLocation:c});if(h=Math.min(x,h),m=_+u,g){let k=0;for(;k<u;)p[_+k]=1,k+=1}}m=-1;let S=[],I=1,b=u+d;const E=1<<u-1;for(let x=0;x<u;x+=1){let k=0,M=b;for(;k<M;)ir(e,{errors:x,currentLocation:f+M,expectedLocation:f,distance:r,ignoreLocation:c})<=h?k=M:b=M,M=Math.floor((b-k)/2+k);b=M;let P=Math.max(1,f-M+1),L=o?d:Math.min(f+M,d)+u,q=Array(L+2);q[L+1]=(1<<x)-1;for(let C=L;C>=P;C-=1){let D=C-1,A=n[t.charAt(D)];if(g&&(p[D]=+!!A),q[C]=(q[C+1]<<1|1)&A,x&&(q[C]|=(S[C+1]|S[C])<<1|1|S[C+1]),q[C]&E&&(I=ir(e,{errors:x,currentLocation:D,expectedLocation:f,distance:r,ignoreLocation:c}),I<=h)){if(h=I,m=D,m<=f)break;P=Math.max(1,2*f-m)}}if(ir(e,{errors:x+1,currentLocation:f,expectedLocation:f,distance:r,ignoreLocation:c})>h)break;S=q}const O={isMatch:m>=0,score:Math.max(.001,I)};if(g){const x=j1(p,l);x.length?a&&(O.indices=x):O.isMatch=!1}return O}function V1(t){let e={};for(let n=0,i=t.length;n<i;n+=1){const r=t.charAt(n);e[r]=(e[r]||0)|1<<i-n-1}return e}class ec{constructor(e,{location:n=he.location,threshold:i=he.threshold,distance:r=he.distance,includeMatches:s=he.includeMatches,findAllMatches:o=he.findAllMatches,minMatchCharLength:l=he.minMatchCharLength,isCaseSensitive:a=he.isCaseSensitive,ignoreLocation:c=he.ignoreLocation}={}){if(this.options={location:n,threshold:i,distance:r,includeMatches:s,findAllMatches:o,minMatchCharLength:l,isCaseSensitive:a,ignoreLocation:c},this.pattern=a?e:e.toLowerCase(),this.chunks=[],!this.pattern.length)return;const u=(f,h)=>{this.chunks.push({pattern:f,alphabet:V1(f),startIndex:h})},d=this.pattern.length;if(d>gn){let f=0;const h=d%gn,m=d-h;for(;f<m;)u(this.pattern.substr(f,gn),f),f+=gn;if(h){const g=d-gn;u(this.pattern.substr(g),g)}}else u(this.pattern,0)}searchIn(e){const{isCaseSensitive:n,includeMatches:i}=this.options;if(n||(e=e.toLowerCase()),this.pattern===e){let m={isMatch:!0,score:0};return i&&(m.indices=[[0,e.length-1]]),m}const{location:r,distance:s,threshold:o,findAllMatches:l,minMatchCharLength:a,ignoreLocation:c}=this.options;let u=[],d=0,f=!1;this.chunks.forEach(({pattern:m,alphabet:g,startIndex:p})=>{const{isMatch:_,score:S,indices:I}=F1(e,m,g,{location:r+p,distance:s,threshold:o,findAllMatches:l,minMatchCharLength:a,includeMatches:i,ignoreLocation:c});_&&(f=!0),d+=S,_&&I&&(u=[...u,...I])});let h={isMatch:f,score:f?d/this.chunks.length:1};return f&&i&&(h.indices=u),h}}class ln{constructor(e){this.pattern=e}static isMultiMatch(e){return tc(e,this.multiRegex)}static isSingleMatch(e){return tc(e,this.singleRegex)}search(){}}function tc(t,e){const n=t.match(e);return n?n[1]:null}class H1 extends ln{constructor(e){super(e)}static get type(){return"exact"}static get multiRegex(){return/^="(.*)"$/}static get singleRegex(){return/^=(.*)$/}search(e){const n=e===this.pattern;return{isMatch:n,score:n?0:1,indices:[0,this.pattern.length-1]}}}class U1 extends ln{constructor(e){super(e)}static get type(){return"inverse-exact"}static get multiRegex(){return/^!"(.*)"$/}static get singleRegex(){return/^!(.*)$/}search(e){const i=e.indexOf(this.pattern)===-1;return{isMatch:i,score:i?0:1,indices:[0,e.length-1]}}}class B1 extends ln{constructor(e){super(e)}static get type(){return"prefix-exact"}static get multiRegex(){return/^\^"(.*)"$/}static get singleRegex(){return/^\^(.*)$/}search(e){const n=e.startsWith(this.pattern);return{isMatch:n,score:n?0:1,indices:[0,this.pattern.length-1]}}}class q1 extends ln{constructor(e){super(e)}static get type(){return"inverse-prefix-exact"}static get multiRegex(){return/^!\^"(.*)"$/}static get singleRegex(){return/^!\^(.*)$/}search(e){const n=!e.startsWith(this.pattern);return{isMatch:n,score:n?0:1,indices:[0,e.length-1]}}}class K1 extends ln{constructor(e){super(e)}static get type(){return"suffix-exact"}static get multiRegex(){return/^"(.*)"\$$/}static get singleRegex(){return/^(.*)\$$/}search(e){const n=e.endsWith(this.pattern);return{isMatch:n,score:n?0:1,indices:[e.length-this.pattern.length,e.length-1]}}}class W1 extends ln{constructor(e){super(e)}static get type(){return"inverse-suffix-exact"}static get multiRegex(){return/^!"(.*)"\$$/}static get singleRegex(){return/^!(.*)\$$/}search(e){const n=!e.endsWith(this.pattern);return{isMatch:n,score:n?0:1,indices:[0,e.length-1]}}}class nc extends ln{constructor(e,{location:n=he.location,threshold:i=he.threshold,distance:r=he.distance,includeMatches:s=he.includeMatches,findAllMatches:o=he.findAllMatches,minMatchCharLength:l=he.minMatchCharLength,isCaseSensitive:a=he.isCaseSensitive,ignoreLocation:c=he.ignoreLocation}={}){super(e),this._bitapSearch=new ec(e,{location:n,threshold:i,distance:r,includeMatches:s,findAllMatches:o,minMatchCharLength:l,isCaseSensitive:a,ignoreLocation:c})}static get type(){return"fuzzy"}static get multiRegex(){return/^"(.*)"$/}static get singleRegex(){return/^(.*)$/}search(e){return this._bitapSearch.searchIn(e)}}class ic extends ln{constructor(e){super(e)}static get type(){return"include"}static get multiRegex(){return/^'"(.*)"$/}static get singleRegex(){return/^'(.*)$/}search(e){let n=0,i;const r=[],s=this.pattern.length;for(;(i=e.indexOf(this.pattern,n))>-1;)n=i+s,r.push([i,n-1]);const o=!!r.length;return{isMatch:o,score:o?0:1,indices:r}}}const ms=[H1,ic,B1,q1,W1,K1,U1,nc],rc=ms.length,G1=/ +(?=(?:[^\"]*\"[^\"]*\")*[^\"]*$)/,Y1="|";function X1(t,e={}){return t.split(Y1).map(n=>{let i=n.trim().split(G1).filter(s=>s&&!!s.trim()),r=[];for(let s=0,o=i.length;s<o;s+=1){const l=i[s];let a=!1,c=-1;for(;!a&&++c<rc;){const u=ms[c];let d=u.isMultiMatch(l);d&&(r.push(new u(d,e)),a=!0)}if(!a)for(c=-1;++c<rc;){const u=ms[c];let d=u.isSingleMatch(l);if(d){r.push(new u(d,e));break}}}return r})}const J1=new Set([nc.type,ic.type]);class Q1{constructor(e,{isCaseSensitive:n=he.isCaseSensitive,includeMatches:i=he.includeMatches,minMatchCharLength:r=he.minMatchCharLength,ignoreLocation:s=he.ignoreLocation,findAllMatches:o=he.findAllMatches,location:l=he.location,threshold:a=he.threshold,distance:c=he.distance}={}){this.query=null,this.options={isCaseSensitive:n,includeMatches:i,minMatchCharLength:r,findAllMatches:o,ignoreLocation:s,location:l,threshold:a,distance:c},this.pattern=n?e:e.toLowerCase(),this.query=X1(this.pattern,this.options)}static condition(e,n){return n.useExtendedSearch}searchIn(e){const n=this.query;if(!n)return{isMatch:!1,score:1};const{includeMatches:i,isCaseSensitive:r}=this.options;e=r?e:e.toLowerCase();let s=0,o=[],l=0;for(let a=0,c=n.length;a<c;a+=1){const u=n[a];o.length=0,s=0;for(let d=0,f=u.length;d<f;d+=1){const h=u[d],{isMatch:m,indices:g,score:p}=h.search(e);if(m){if(s+=1,l+=p,i){const _=h.constructor.type;J1.has(_)?o=[...o,...g]:o.push(g)}}else{l=0,s=0,o.length=0;break}}if(s){let d={isMatch:!0,score:l/s};return i&&(d.indices=o),d}}return{isMatch:!1,score:1}}}const ps=[];function Z1(...t){ps.push(...t)}function gs(t,e){for(let n=0,i=ps.length;n<i;n+=1){let r=ps[n];if(r.condition(t,e))return new r(t,e)}return new ec(t,e)}const rr={AND:"$and",OR:"$or"},_s={PATH:"$path",PATTERN:"$val"},vs=t=>!!(t[rr.AND]||t[rr.OR]),ev=t=>!!t[_s.PATH],tv=t=>!Jt(t)&&Ga(t)&&!vs(t),sc=t=>({[rr.AND]:Object.keys(t).map(e=>({[e]:t[e]}))});function oc(t,e,{auto:n=!0}={}){const i=r=>{let s=Object.keys(r);const o=ev(r);if(!o&&s.length>1&&!vs(r))return i(sc(r));if(tv(r)){const a=o?r[_s.PATH]:s[0],c=o?r[_s.PATTERN]:r[a];if(!Vt(c))throw new Error(I1(a));const u={keyId:hs(a),pattern:c};return n&&(u.searcher=gs(c,e)),u}let l={children:[],operator:s[0]};return s.forEach(a=>{const c=r[a];Jt(c)&&c.forEach(u=>{l.children.push(i(u))})}),l};return vs(t)||(t=sc(t)),i(t)}function nv(t,{ignoreFieldNorm:e=he.ignoreFieldNorm}){t.forEach(n=>{let i=1;n.matches.forEach(({key:r,norm:s,score:o})=>{const l=r?r.weight:null;i*=Math.pow(o===0&&l?Number.EPSILON:o,(l||1)*(e?1:s))}),n.score=i})}function iv(t,e){const n=t.matches;e.matches=[],yt(n)&&n.forEach(i=>{if(!yt(i.indices)||!i.indices.length)return;const{indices:r,value:s}=i;let o={indices:r,value:s};i.key&&(o.key=i.key.src),i.idx>-1&&(o.refIndex=i.idx),e.matches.push(o)})}function rv(t,e){e.score=t.score}function sv(t,e,{includeMatches:n=he.includeMatches,includeScore:i=he.includeScore}={}){const r=[];return n&&r.push(iv),i&&r.push(rv),t.map(s=>{const{idx:o}=s,l={item:e[o],refIndex:o};return r.length&&r.forEach(a=>{a(s,l)}),l})}class $n{constructor(e,n={},i){this.options=Rn(Rn({},he),n),this.options.useExtendedSearch,this._keyStore=new T1(this.options.keys),this.setCollection(e,i)}setCollection(e,n){if(this._docs=e,n&&!(n instanceof ds))throw new Error(C1);this._myIndex=n||Za(this.options.keys,this._docs,{getFn:this.options.getFn,fieldNormWeight:this.options.fieldNormWeight})}add(e){yt(e)&&(this._docs.push(e),this._myIndex.add(e))}remove(e=()=>!1){const n=[];for(let i=0,r=this._docs.length;i<r;i+=1){const s=this._docs[i];e(s,i)&&(this.removeAt(i),i-=1,r-=1,n.push(s))}return n}removeAt(e){this._docs.splice(e,1),this._myIndex.removeAt(e)}getIndex(){return this._myIndex}search(e,{limit:n=-1}={}){const{includeMatches:i,includeScore:r,shouldSort:s,sortFn:o,ignoreFieldNorm:l}=this.options;let a=Vt(e)?Vt(this._docs[0])?this._searchStringList(e):this._searchObjectList(e):this._searchLogical(e);return nv(a,{ignoreFieldNorm:l}),s&&a.sort(o),Wa(n)&&n>-1&&(a=a.slice(0,n)),sv(a,this._docs,{includeMatches:i,includeScore:r})}_searchStringList(e){const n=gs(e,this.options),{records:i}=this._myIndex,r=[];return i.forEach(({v:s,i:o,n:l})=>{if(!yt(s))return;const{isMatch:a,score:c,indices:u}=n.searchIn(s);a&&r.push({item:s,idx:o,matches:[{score:c,value:s,norm:l,indices:u}]})}),r}_searchLogical(e){const n=oc(e,this.options),i=(l,a,c)=>{if(!l.children){const{keyId:d,searcher:f}=l,h=this._findMatches({key:this._keyStore.get(d),value:this._myIndex.getValueForItemAtKeyId(a,d),searcher:f});return h&&h.length?[{idx:c,item:a,matches:h}]:[]}const u=[];for(let d=0,f=l.children.length;d<f;d+=1){const h=l.children[d],m=i(h,a,c);if(m.length)u.push(...m);else if(l.operator===rr.AND)return[]}return u},r=this._myIndex.records,s={},o=[];return r.forEach(({$:l,i:a})=>{if(yt(l)){let c=i(n,l,a);c.length&&(s[a]||(s[a]={idx:a,item:l,matches:[]},o.push(s[a])),c.forEach(({matches:u})=>{s[a].matches.push(...u)}))}}),o}_searchObjectList(e){const n=gs(e,this.options),{keys:i,records:r}=this._myIndex,s=[];return r.forEach(({$:o,i:l})=>{if(!yt(o))return;let a=[];i.forEach((c,u)=>{a.push(...this._findMatches({key:c,value:o[u],searcher:n}))}),a.length&&s.push({idx:l,item:o,matches:a})}),s}_findMatches({key:e,value:n,searcher:i}){if(!yt(n))return[];let r=[];if(Jt(n))n.forEach(({v:s,i:o,n:l})=>{if(!yt(s))return;const{isMatch:a,score:c,indices:u}=i.searchIn(s);a&&r.push({score:c,key:e,value:s,idx:o,norm:l,indices:u})});else{const{v:s,n:o}=n,{isMatch:l,score:a,indices:c}=i.searchIn(s);l&&r.push({score:a,key:e,value:s,norm:o,indices:c})}return r}}$n.version="7.0.0",$n.createIndex=Za,$n.parseIndex=z1,$n.config=he,$n.parseQuery=oc,Z1(Q1);var ov=function(){function t(e){this._haystack=[],this._fuseOptions=ht(ht({},e.fuseOptions),{keys:V0([],e.searchFields,!0),includeMatches:!0})}return t.prototype.index=function(e){this._haystack=e,this._fuse&&this._fuse.setCollection(e)},t.prototype.reset=function(){this._haystack=[],this._fuse=void 0},t.prototype.isEmptyIndex=function(){return!this._haystack.length},t.prototype.search=function(e){this._fuse||(this._fuse=new $n(this._haystack,this._fuseOptions));var n=this._fuse.search(e);return n.map(function(i,r){return{item:i.item,score:i.score||0,rank:r+1}})},t}();function lv(t){return new ov(t)}var av=function(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0},ys=function(t,e,n){var i=t.dataset,r=e.customProperties,s=e.labelClass,o=e.labelDescription;s&&(i.labelClass=nr(s).join(" ")),o&&(i.labelDescription=o),n&&r&&(typeof r=="string"?i.customProperties=r:typeof r=="object"&&!av(r)&&(i.customProperties=JSON.stringify(r)))},lc=function(t,e,n){var i=e&&t.querySelector("label[for='".concat(e,"']")),r=i&&i.innerText;r&&n.setAttribute("aria-label",r)},cv={containerOuter:function(t,e,n,i,r,s,o){var l=t.classNames.containerOuter,a=document.createElement("div");return me(a,l),a.dataset.type=s,e&&(a.dir=e),i&&(a.tabIndex=0),n&&(a.setAttribute("role",r?"combobox":"listbox"),r?a.setAttribute("aria-autocomplete","list"):o||lc(this._docRoot,this.passedElement.element.id,a),a.setAttribute("aria-haspopup","true"),a.setAttribute("aria-expanded","false")),o&&a.setAttribute("aria-labelledby",o),a},containerInner:function(t){var e=t.classNames.containerInner,n=document.createElement("div");return me(n,e),n},itemList:function(t,e){var n=t.searchEnabled,i=t.classNames,r=i.list,s=i.listSingle,o=i.listItems,l=document.createElement("div");return me(l,r),me(l,e?s:o),this._isSelectElement&&n&&l.setAttribute("role","listbox"),l},placeholder:function(t,e){var n=t.allowHTML,i=t.classNames.placeholder,r=document.createElement("div");return me(r,i),Xt(r,n,e),r},item:function(t,e,n){var i=t.allowHTML,r=t.removeItemButtonAlignLeft,s=t.removeItemIconText,o=t.removeItemLabelText,l=t.classNames,a=l.item,c=l.button,u=l.highlightedState,d=l.itemSelectable,f=l.placeholder,h=pn(e.value),m=document.createElement("div");if(me(m,a),e.labelClass){var g=document.createElement("span");Xt(g,i,e.label),me(g,e.labelClass),m.appendChild(g)}else Xt(m,i,e.label);if(m.dataset.item="",m.dataset.id=e.id,m.dataset.value=h,ys(m,e,!0),(e.disabled||this.containerOuter.isDisabled)&&m.setAttribute("aria-disabled","true"),this._isSelectElement&&(m.setAttribute("aria-selected","true"),m.setAttribute("role","option")),e.placeholder&&(me(m,f),m.dataset.placeholder=""),me(m,e.highlighted?u:d),n){e.disabled&&jt(m,d),m.dataset.deletable="";var p=document.createElement("button");p.type="button",me(p,c),Xt(p,!0,oi(s,e.value));var _=oi(o,e.value);_&&p.setAttribute("aria-label",_),p.dataset.button="",r?m.insertAdjacentElement("afterbegin",p):m.appendChild(p)}return m},choiceList:function(t,e){var n=t.classNames.list,i=document.createElement("div");return me(i,n),e||i.setAttribute("aria-multiselectable","true"),i.setAttribute("role","listbox"),i},choiceGroup:function(t,e){var n=t.allowHTML,i=t.classNames,r=i.group,s=i.groupHeading,o=i.itemDisabled,l=e.id,a=e.label,c=e.disabled,u=pn(a),d=document.createElement("div");me(d,r),c&&me(d,o),d.setAttribute("role","group"),d.dataset.group="",d.dataset.id=l,d.dataset.value=u,c&&d.setAttribute("aria-disabled","true");var f=document.createElement("div");return me(f,s),Xt(f,n,a||""),d.appendChild(f),d},choice:function(t,e,n,i){var r=t.allowHTML,s=t.classNames,o=s.item,l=s.itemChoice,a=s.itemSelectable,c=s.selectedState,u=s.itemDisabled,d=s.description,f=s.placeholder,h=e.label,m=pn(e.value),g=document.createElement("div");g.id=e.elementId,me(g,o),me(g,l),i&&typeof h=="string"&&(h=us(r,h),h+=" (".concat(i,")"),h={trusted:h});var p=g;if(e.labelClass){var _=document.createElement("span");Xt(_,r,h),me(_,e.labelClass),p=_,g.appendChild(_)}else Xt(g,r,h);if(e.labelDescription){var S="".concat(e.elementId,"-description");p.setAttribute("aria-describedby",S);var I=document.createElement("span");Xt(I,r,e.labelDescription),I.id=S,me(I,d),g.appendChild(I)}return e.selected&&me(g,c),e.placeholder&&me(g,f),g.setAttribute("role",e.group?"treeitem":"option"),g.dataset.choice="",g.dataset.id=e.id,g.dataset.value=m,n&&(g.dataset.selectText=n),e.group&&(g.dataset.groupId="".concat(e.group.id)),ys(g,e,!1),e.disabled?(me(g,u),g.dataset.choiceDisabled="",g.setAttribute("aria-disabled","true")):(me(g,a),g.dataset.choiceSelectable=""),g},input:function(t,e){var n=t.classNames,i=n.input,r=n.inputCloned,s=t.labelId,o=document.createElement("input");return o.type="search",me(o,i),me(o,r),o.autocomplete="off",o.autocapitalize="off",o.spellcheck=!1,o.setAttribute("aria-autocomplete","list"),e?o.setAttribute("aria-label",e):s||lc(this._docRoot,this.passedElement.element.id,o),o},dropdown:function(t){var e=t.classNames,n=e.list,i=e.listDropdown,r=document.createElement("div");return me(r,n),me(r,i),r.setAttribute("aria-expanded","false"),r},notice:function(t,e,n){var i=t.classNames,r=i.item,s=i.itemChoice,o=i.addChoice,l=i.noResults,a=i.noChoices,c=i.notice;n===void 0&&(n=Ke.generic);var u=document.createElement("div");switch(Xt(u,!0,e),me(u,r),me(u,s),me(u,c),n){case Ke.addChoice:me(u,o);break;case Ke.noResults:me(u,l);break;case Ke.noChoices:me(u,a);break}return n===Ke.addChoice&&(u.dataset.choiceSelectable="",u.dataset.choice=""),u},option:function(t){var e=pn(t.label),n=new Option(e,t.value,!1,t.selected);return ys(n,t,!0),n.disabled=t.disabled,t.selected&&n.setAttribute("selected",""),n}},uv="-ms-scroll-limit"in document.documentElement.style&&"-ms-ime-align"in document.documentElement.style,fv={},bs=function(t){if(t)return t.dataset.id?parseInt(t.dataset.id,10):void 0},ci="[data-choice-selectable]",hv=function(){function t(e,n){e===void 0&&(e="[data-choice]"),n===void 0&&(n={});var i=this;this.initialisedOK=void 0,this._hasNonChoicePlaceholder=!1,this._lastAddedChoiceId=0,this._lastAddedGroupId=0;var r=t.defaults;this.config=ht(ht(ht({},r.allOptions),r.options),n),H0.forEach(function(_){i.config[_]=ht(ht(ht({},r.allOptions[_]),r.options[_]),n[_])});var s=this.config;s.silent||this._validateConfig();var o=s.shadowRoot||document.documentElement;this._docRoot=o;var l=typeof e=="string"?o.querySelector(e):e;if(!l||typeof l!="object"||!(a1(l)||Ha(l)))throw TypeError(!l&&typeof e=="string"?"Selector ".concat(e," failed to find an element"):"Expected one of the following types text|select-one|select-multiple");var a=l.type,c=a===on.Text;(c||s.maxItemCount!==1)&&(s.singleModeForMultiSelect=!1),s.singleModeForMultiSelect&&(a=on.SelectMultiple);var u=a===on.SelectOne,d=a===on.SelectMultiple,f=u||d;if(this._elementType=a,this._isTextElement=c,this._isSelectOneElement=u,this._isSelectMultipleElement=d,this._isSelectElement=u||d,this._canAddUserChoices=c&&s.addItems||f&&s.addChoices,typeof s.renderSelectedChoices!="boolean"&&(s.renderSelectedChoices=s.renderSelectedChoices==="always"||u),s.closeDropdownOnSelect==="auto"?s.closeDropdownOnSelect=c||u||s.singleModeForMultiSelect:s.closeDropdownOnSelect=ai(s.closeDropdownOnSelect),s.placeholder&&(s.placeholderValue?this._hasNonChoicePlaceholder=!0:l.dataset.placeholder&&(this._hasNonChoicePlaceholder=!0,s.placeholderValue=l.dataset.placeholder)),n.addItemFilter&&typeof n.addItemFilter!="function"){var h=n.addItemFilter instanceof RegExp?n.addItemFilter:new RegExp(n.addItemFilter);s.addItemFilter=h.test.bind(h)}if(this._isTextElement)this.passedElement=new l1({element:l,classNames:s.classNames});else{var m=l;this.passedElement=new f1({element:m,classNames:s.classNames,template:function(_){return i._templates.option(_)},extractPlaceholder:s.placeholder&&!this._hasNonChoicePlaceholder})}if(this.initialised=!1,this._store=new g1(s),this._currentValue="",s.searchEnabled=!c&&s.searchEnabled||d,this._canSearch=s.searchEnabled,this._isScrollingOnIe=!1,this._highlightPosition=0,this._wasTap=!0,this._placeholderValue=this._generatePlaceholderValue(),this._baseId=G0(l,"choices-"),this._direction=l.dir,!this._direction){var g=window.getComputedStyle(l).direction,p=window.getComputedStyle(document.documentElement).direction;g!==p&&(this._direction=g)}if(this._idNames={itemChoice:"item-choice"},this._templates=r.templates,this._render=this._render.bind(this),this._onFocus=this._onFocus.bind(this),this._onBlur=this._onBlur.bind(this),this._onKeyUp=this._onKeyUp.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onInput=this._onInput.bind(this),this._onClick=this._onClick.bind(this),this._onTouchMove=this._onTouchMove.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._onMouseDown=this._onMouseDown.bind(this),this._onMouseOver=this._onMouseOver.bind(this),this._onFormReset=this._onFormReset.bind(this),this._onSelectKey=this._onSelectKey.bind(this),this._onEnterKey=this._onEnterKey.bind(this),this._onEscapeKey=this._onEscapeKey.bind(this),this._onDirectionKey=this._onDirectionKey.bind(this),this._onDeleteKey=this._onDeleteKey.bind(this),this.passedElement.isActive){s.silent||console.warn("Trying to initialise Choices on element already initialised",{element:e}),this.initialised=!0,this.initialisedOK=!1;return}this.init(),this._initialItems=this._store.items.map(function(_){return _.value})}return Object.defineProperty(t,"defaults",{get:function(){return Object.preventExtensions({get options(){return fv},get allOptions(){return Ua},get templates(){return cv}})},enumerable:!1,configurable:!0}),t.prototype.init=function(){if(!(this.initialised||this.initialisedOK!==void 0)){this._searcher=lv(this.config),this._loadChoices(),this._createTemplates(),this._createElements(),this._createStructure(),this._isTextElement&&!this.config.addItems||this.passedElement.element.hasAttribute("disabled")||this.passedElement.element.closest("fieldset:disabled")?this.disable():(this.enable(),this._addEventListeners()),this._initStore(),this.initialised=!0,this.initialisedOK=!0;var e=this.config.callbackOnInit;typeof e=="function"&&e.call(this)}},t.prototype.destroy=function(){this.initialised&&(this._removeEventListeners(),this.passedElement.reveal(),this.containerOuter.unwrap(this.passedElement.element),this._store._listeners=[],this.clearStore(!1),this._stopSearch(),this._templates=t.defaults.templates,this.initialised=!1,this.initialisedOK=void 0)},t.prototype.enable=function(){return this.passedElement.isDisabled&&this.passedElement.enable(),this.containerOuter.isDisabled&&(this._addEventListeners(),this.input.enable(),this.containerOuter.enable()),this},t.prototype.disable=function(){return this.passedElement.isDisabled||this.passedElement.disable(),this.containerOuter.isDisabled||(this._removeEventListeners(),this.input.disable(),this.containerOuter.disable()),this},t.prototype.highlightItem=function(e,n){if(n===void 0&&(n=!0),!e||!e.id)return this;var i=this._store.items.find(function(r){return r.id===e.id});return!i||i.highlighted?this:(this._store.dispatch(er(i,!0)),n&&this.passedElement.triggerEvent(dt.highlightItem,this._getChoiceForOutput(i)),this)},t.prototype.unhighlightItem=function(e,n){if(n===void 0&&(n=!0),!e||!e.id)return this;var i=this._store.items.find(function(r){return r.id===e.id});return!i||!i.highlighted?this:(this._store.dispatch(er(i,!1)),n&&this.passedElement.triggerEvent(dt.unhighlightItem,this._getChoiceForOutput(i)),this)},t.prototype.highlightAll=function(){var e=this;return this._store.withTxn(function(){e._store.items.forEach(function(n){n.highlighted||(e._store.dispatch(er(n,!0)),e.passedElement.triggerEvent(dt.highlightItem,e._getChoiceForOutput(n)))})}),this},t.prototype.unhighlightAll=function(){var e=this;return this._store.withTxn(function(){e._store.items.forEach(function(n){n.highlighted&&(e._store.dispatch(er(n,!1)),e.passedElement.triggerEvent(dt.highlightItem,e._getChoiceForOutput(n)))})}),this},t.prototype.removeActiveItemsByValue=function(e){var n=this;return this._store.withTxn(function(){n._store.items.filter(function(i){return i.value===e}).forEach(function(i){return n._removeItem(i)})}),this},t.prototype.removeActiveItems=function(e){var n=this;return this._store.withTxn(function(){n._store.items.filter(function(i){var r=i.id;return r!==e}).forEach(function(i){return n._removeItem(i)})}),this},t.prototype.removeHighlightedItems=function(e){var n=this;return e===void 0&&(e=!1),this._store.withTxn(function(){n._store.highlightedActiveItems.forEach(function(i){n._removeItem(i),e&&n._triggerChange(i.value)})}),this},t.prototype.showDropdown=function(e){var n=this;return this.dropdown.isActive?this:(e===void 0&&(e=!this._canSearch),requestAnimationFrame(function(){n.dropdown.show();var i=n.dropdown.element.getBoundingClientRect();n.containerOuter.open(i.bottom,i.height),e||n.input.focus(),n.passedElement.triggerEvent(dt.showDropdown)}),this)},t.prototype.hideDropdown=function(e){var n=this;return this.dropdown.isActive?(requestAnimationFrame(function(){n.dropdown.hide(),n.containerOuter.close(),!e&&n._canSearch&&(n.input.removeActiveDescendant(),n.input.blur()),n.passedElement.triggerEvent(dt.hideDropdown)}),this):this},t.prototype.getValue=function(e){var n=this,i=this._store.items.map(function(r){return e?r.value:n._getChoiceForOutput(r)});return this._isSelectOneElement||this.config.singleModeForMultiSelect?i[0]:i},t.prototype.setValue=function(e){var n=this;return this.initialisedOK?(this._store.withTxn(function(){e.forEach(function(i){i&&n._addChoice(Ft(i,!1))})}),this._searcher.reset(),this):(this._warnChoicesInitFailed("setValue"),this)},t.prototype.setChoiceByValue=function(e){var n=this;return this.initialisedOK?this._isTextElement?this:(this._store.withTxn(function(){var i=Array.isArray(e)?e:[e];i.forEach(function(r){return n._findAndSelectChoiceByValue(r)}),n.unhighlightAll()}),this._searcher.reset(),this):(this._warnChoicesInitFailed("setChoiceByValue"),this)},t.prototype.setChoices=function(e,n,i,r,s,o){var l=this;if(e===void 0&&(e=[]),n===void 0&&(n="value"),i===void 0&&(i="label"),r===void 0&&(r=!1),s===void 0&&(s=!0),o===void 0&&(o=!1),!this.initialisedOK)return this._warnChoicesInitFailed("setChoices"),this;if(!this._isSelectElement)throw new TypeError("setChoices can't be used with INPUT based Choices");if(typeof n!="string"||!n)throw new TypeError("value parameter must be a name of 'value' field in passed objects");if(typeof e=="function"){var a=e(this);if(typeof Promise=="function"&&a instanceof Promise)return new Promise(function(c){return requestAnimationFrame(c)}).then(function(){return l._handleLoadingState(!0)}).then(function(){return a}).then(function(c){return l.setChoices(c,n,i,r,s,o)}).catch(function(c){l.config.silent||console.error(c)}).then(function(){return l._handleLoadingState(!1)}).then(function(){return l});if(!Array.isArray(a))throw new TypeError(".setChoices first argument function must return either array of choices or Promise, got: ".concat(typeof a));return this.setChoices(a,n,i,!1)}if(!Array.isArray(e))throw new TypeError(".setChoices must be called either with array of choices with a function resulting into Promise of array of choices");return this.containerOuter.removeLoadingState(),this._store.withTxn(function(){s&&(l._isSearching=!1),r&&l.clearChoices(!0,o);var c=n==="value",u=i==="label";e.forEach(function(d){if("choices"in d){var f=d;u||(f=ht(ht({},f),{label:f[i]})),l._addGroup(Ft(f,!0))}else{var h=d;(!u||!c)&&(h=ht(ht({},h),{value:h[n],label:h[i]}));var m=Ft(h,!1);l._addChoice(m),m.placeholder&&!l._hasNonChoicePlaceholder&&(l._placeholderValue=$a(m.label))}}),l.unhighlightAll()}),this._searcher.reset(),this},t.prototype.refresh=function(e,n,i){var r=this;return e===void 0&&(e=!1),n===void 0&&(n=!1),i===void 0&&(i=!1),this._isSelectElement?(this._store.withTxn(function(){var s=r.passedElement.optionsAsChoices(),o={};i||r._store.items.forEach(function(a){a.id&&a.active&&a.selected&&(o[a.value]=!0)}),r.clearStore(!1);var l=function(a){i?r._store.dispatch(La(a)):o[a.value]&&(a.selected=!0)};s.forEach(function(a){if("choices"in a){a.choices.forEach(l);return}l(a)}),r._addPredefinedChoices(s,n,e),r._isSearching&&r._searchChoices(r.input.value)}),this):(this.config.silent||console.warn("refresh method can only be used on choices backed by a <select> element"),this)},t.prototype.removeChoice=function(e){var n=this._store.choices.find(function(i){return i.value===e});return n?(this._clearNotice(),this._store.dispatch(U0(n)),this._searcher.reset(),n.selected&&this.passedElement.triggerEvent(dt.removeItem,this._getChoiceForOutput(n)),this):this},t.prototype.clearChoices=function(e,n){var i=this;return e===void 0&&(e=!0),n===void 0&&(n=!1),e&&(n?this.passedElement.element.replaceChildren(""):this.passedElement.element.querySelectorAll(":not([selected])").forEach(function(r){r.remove()})),this.itemList.element.replaceChildren(""),this.choiceList.element.replaceChildren(""),this._clearNotice(),this._store.withTxn(function(){var r=n?[]:i._store.items;i._store.reset(),r.forEach(function(s){i._store.dispatch(Oa(s)),i._store.dispatch(Pa(s))})}),this._searcher.reset(),this},t.prototype.clearStore=function(e){return e===void 0&&(e=!0),this.clearChoices(e,!0),this._stopSearch(),this._lastAddedChoiceId=0,this._lastAddedGroupId=0,this},t.prototype.clearInput=function(){var e=!this._isSelectOneElement;return this.input.clear(e),this._stopSearch(),this},t.prototype._validateConfig=function(){var e=this.config,n=t1(e,Ua);n.length&&console.warn("Unknown config option(s) passed",n.join(", ")),e.allowHTML&&e.allowHtmlUserInput&&(e.addItems&&console.warn("Warning: allowHTML/allowHtmlUserInput/addItems all being true is strongly not recommended and may lead to XSS attacks"),e.addChoices&&console.warn("Warning: allowHTML/allowHtmlUserInput/addChoices all being true is strongly not recommended and may lead to XSS attacks"))},t.prototype._render=function(e){e===void 0&&(e={choices:!0,groups:!0,items:!0}),!this._store.inTxn()&&(this._isSelectElement&&(e.choices||e.groups)&&this._renderChoices(),e.items&&this._renderItems())},t.prototype._renderChoices=function(){var e=this;if(this._canAddItems()){var n=this,i=n.config,r=n._isSearching,s=this._store,o=s.activeGroups,l=s.activeChoices,a=0;if(r&&i.searchResultLimit>0?a=i.searchResultLimit:i.renderChoiceLimit>0&&(a=i.renderChoiceLimit),this._isSelectElement){var c=l.filter(function(m){return!m.element});c.length&&this.passedElement.addOptions(c)}var u=document.createDocumentFragment(),d=function(m){return m.filter(function(g){return!g.placeholder&&(r?!!g.rank:i.renderSelectedChoices||!g.selected)})},f=!1,h=function(m,g,p){r?m.sort(Z0):i.shouldSort&&m.sort(i.sorter);var _=m.length;_=!g&&a&&_>a?a:_,_--,m.every(function(S,I){var b=S.choiceEl||e._templates.choice(i,S,i.itemSelectText,p);return S.choiceEl=b,u.appendChild(b),(r||!S.selected)&&(f=!0),I<_})};l.length&&(i.resetScrollPosition&&requestAnimationFrame(function(){return e.choiceList.scrollToTop()}),!this._hasNonChoicePlaceholder&&!r&&this._isSelectOneElement&&h(l.filter(function(m){return m.placeholder&&!m.group}),!1,void 0),o.length&&!r?(i.shouldSort&&o.sort(i.sorter),h(l.filter(function(m){return!m.placeholder&&!m.group}),!1,void 0),o.forEach(function(m){var g=d(m.choices);if(g.length){if(m.label){var p=m.groupEl||e._templates.choiceGroup(e.config,m);m.groupEl=p,p.remove(),u.appendChild(p)}h(g,!0,i.appendGroupInSearch&&r?m.label:void 0)}})):h(d(l),!1,void 0)),!f&&(r||!u.children.length||!i.renderSelectedChoices)&&(this._notice||(this._notice={text:Ra(r?i.noResultsText:i.noChoicesText),type:r?Ke.noResults:Ke.noChoices}),u.replaceChildren("")),this._renderNotice(u),this.choiceList.element.replaceChildren(u),f&&this._highlightChoice()}},t.prototype._renderItems=function(){var e=this,n=this._store.items||[],i=this.itemList.element,r=this.config,s=document.createDocumentFragment(),o=function(d){return i.querySelector('[data-item][data-id="'.concat(d.id,'"]'))},l=function(d){var f=d.itemEl;f&&f.parentElement||(f=o(d)||e._templates.item(r,d,r.removeItemButton),d.itemEl=f,s.appendChild(f))};n.forEach(l);var a=!!s.childNodes.length;if(this._isSelectOneElement){var c=i.children.length;if(a||c>1){var u=i.querySelector(li(r.classNames.placeholder));u&&u.remove()}else!a&&!c&&this._placeholderValue&&(a=!0,l(Ft({selected:!0,value:"",label:this._placeholderValue,placeholder:!0},!1)))}a&&(i.append(s),r.shouldSortItems&&!this._isSelectOneElement&&(n.sort(r.sorter),n.forEach(function(d){var f=o(d);f&&(f.remove(),s.append(f))}),i.append(s))),this._isTextElement&&(this.passedElement.value=n.map(function(d){var f=d.value;return f}).join(r.delimiter))},t.prototype._displayNotice=function(e,n,i){i===void 0&&(i=!0);var r=this._notice;if(r&&(r.type===n&&r.text===e||r.type===Ke.addChoice&&(n===Ke.noResults||n===Ke.noChoices))){i&&this.showDropdown(!0);return}this._clearNotice(),this._notice=e?{text:e,type:n}:void 0,this._renderNotice(),i&&e&&this.showDropdown(!0)},t.prototype._clearNotice=function(){if(this._notice){var e=this.choiceList.element.querySelector(li(this.config.classNames.notice));e&&e.remove(),this._notice=void 0}},t.prototype._renderNotice=function(e){var n=this._notice;if(n){var i=this._templates.notice(this.config,n.text,n.type);e?e.append(i):this.choiceList.prepend(i)}},t.prototype._getChoiceForOutput=function(e,n){return{id:e.id,highlighted:e.highlighted,labelClass:e.labelClass,labelDescription:e.labelDescription,customProperties:e.customProperties,disabled:e.disabled,active:e.active,label:e.label,placeholder:e.placeholder,value:e.value,groupValue:e.group?e.group.label:void 0,element:e.element,keyCode:n}},t.prototype._triggerChange=function(e){e!=null&&this.passedElement.triggerEvent(dt.change,{value:e})},t.prototype._handleButtonAction=function(e){var n=this,i=this._store.items;if(!(!i.length||!this.config.removeItems||!this.config.removeItemButton)){var r=e&&bs(e.parentElement),s=r&&i.find(function(o){return o.id===r});s&&this._store.withTxn(function(){if(n._removeItem(s),n._triggerChange(s.value),n._isSelectOneElement&&!n._hasNonChoicePlaceholder){var o=(n.config.shouldSort?n._store.choices.reverse():n._store.choices).find(function(l){return l.placeholder});o&&(n._addItem(o),n.unhighlightAll(),o.value&&n._triggerChange(o.value))}})}},t.prototype._handleItemAction=function(e,n){var i=this;n===void 0&&(n=!1);var r=this._store.items;if(!(!r.length||!this.config.removeItems||this._isSelectOneElement)){var s=bs(e);s&&(r.forEach(function(o){o.id===s&&!o.highlighted?i.highlightItem(o):!n&&o.highlighted&&i.unhighlightItem(o)}),this.input.focus())}},t.prototype._handleChoiceAction=function(e){var n=this,i=bs(e),r=i&&this._store.getChoiceById(i);if(!r||r.disabled)return!1;var s=this.dropdown.isActive;if(!r.selected){if(!this._canAddItems())return!0;this._store.withTxn(function(){n._addItem(r,!0,!0),n.clearInput(),n.unhighlightAll()}),this._triggerChange(r.value)}return s&&this.config.closeDropdownOnSelect&&(this.hideDropdown(!0),this.containerOuter.element.focus()),!0},t.prototype._handleBackspace=function(e){var n=this.config;if(!(!n.removeItems||!e.length)){var i=e[e.length-1],r=e.some(function(s){return s.highlighted});n.editItems&&!r&&i?(this.input.value=i.value,this.input.setWidth(),this._removeItem(i),this._triggerChange(i.value)):(r||this.highlightItem(i,!1),this.removeHighlightedItems(!0))}},t.prototype._loadChoices=function(){var e,n=this,i=this.config;if(this._isTextElement){if(this._presetChoices=i.items.map(function(o){return Ft(o,!1)}),this.passedElement.value){var r=this.passedElement.value.split(i.delimiter).map(function(o){return Ft(o,!1,n.config.allowHtmlUserInput)});this._presetChoices=this._presetChoices.concat(r)}this._presetChoices.forEach(function(o){o.selected=!0})}else if(this._isSelectElement){this._presetChoices=i.choices.map(function(o){return Ft(o,!0)});var s=this.passedElement.optionsAsChoices();s&&(e=this._presetChoices).push.apply(e,s)}},t.prototype._handleLoadingState=function(e){e===void 0&&(e=!0);var n=this.itemList.element;e?(this.disable(),this.containerOuter.addLoadingState(),this._isSelectOneElement?n.replaceChildren(this._templates.placeholder(this.config,this.config.loadingText)):this.input.placeholder=this.config.loadingText):(this.enable(),this.containerOuter.removeLoadingState(),this._isSelectOneElement?(n.replaceChildren(""),this._render()):this.input.placeholder=this._placeholderValue||"")},t.prototype._handleSearch=function(e){if(this.input.isFocussed)if(e!==null&&typeof e<"u"&&e.length>=this.config.searchFloor){var n=this.config.searchChoices?this._searchChoices(e):0;n!==null&&this.passedElement.triggerEvent(dt.search,{value:e,resultCount:n})}else this._store.choices.some(function(i){return!i.active})&&this._stopSearch()},t.prototype._canAddItems=function(){var e=this.config,n=e.maxItemCount,i=e.maxItemText;return!e.singleModeForMultiSelect&&n>0&&n<=this._store.items.length?(this.choiceList.element.replaceChildren(""),this._notice=void 0,this._displayNotice(typeof i=="function"?i(n):i,Ke.addChoice),!1):(this._notice&&this._notice.type===Ke.addChoice&&this._clearNotice(),!0)},t.prototype._canCreateItem=function(e){var n=this.config,i=!0,r="";if(i&&typeof n.addItemFilter=="function"&&!n.addItemFilter(e)&&(i=!1,r=oi(n.customAddItemText,e)),i){var s=this._store.choices.find(function(o){return n.valueComparer(o.value,e)});if(s){if(this._isSelectElement)return this._displayNotice("",Ke.addChoice),!1;n.duplicateItemsAllowed||(i=!1,r=oi(n.uniqueItemText,e))}}return i&&(r=oi(n.addItemText,e)),r&&this._displayNotice(r,Ke.addChoice),i},t.prototype._searchChoices=function(e){var n=e.trim().replace(/\s{2,}/," ");if(!n.length||n===this._currentValue)return null;var i=this._searcher;i.isEmptyIndex()&&i.index(this._store.searchableChoices);var r=i.search(n);this._currentValue=n,this._highlightPosition=0,this._isSearching=!0;var s=this._notice,o=s&&s.type;return o!==Ke.addChoice&&(r.length?this._clearNotice():this._displayNotice(Ra(this.config.noResultsText),Ke.noResults)),this._store.dispatch(B0(r)),r.length},t.prototype._stopSearch=function(){this._isSearching&&(this._currentValue="",this._isSearching=!1,this._clearNotice(),this._store.dispatch(q0(!0)),this.passedElement.triggerEvent(dt.search,{value:"",resultCount:0}))},t.prototype._addEventListeners=function(){var e=this._docRoot,n=this.containerOuter.element,i=this.input.element;e.addEventListener("touchend",this._onTouchEnd,!0),n.addEventListener("keydown",this._onKeyDown,!0),n.addEventListener("mousedown",this._onMouseDown,!0),e.addEventListener("click",this._onClick,{passive:!0}),e.addEventListener("touchmove",this._onTouchMove,{passive:!0}),this.dropdown.element.addEventListener("mouseover",this._onMouseOver,{passive:!0}),this._isSelectOneElement&&(n.addEventListener("focus",this._onFocus,{passive:!0}),n.addEventListener("blur",this._onBlur,{passive:!0})),i.addEventListener("keyup",this._onKeyUp,{passive:!0}),i.addEventListener("input",this._onInput,{passive:!0}),i.addEventListener("focus",this._onFocus,{passive:!0}),i.addEventListener("blur",this._onBlur,{passive:!0}),i.form&&i.form.addEventListener("reset",this._onFormReset,{passive:!0}),this.input.addEventListeners()},t.prototype._removeEventListeners=function(){var e=this._docRoot,n=this.containerOuter.element,i=this.input.element;e.removeEventListener("touchend",this._onTouchEnd,!0),n.removeEventListener("keydown",this._onKeyDown,!0),n.removeEventListener("mousedown",this._onMouseDown,!0),e.removeEventListener("click",this._onClick),e.removeEventListener("touchmove",this._onTouchMove),this.dropdown.element.removeEventListener("mouseover",this._onMouseOver),this._isSelectOneElement&&(n.removeEventListener("focus",this._onFocus),n.removeEventListener("blur",this._onBlur)),i.removeEventListener("keyup",this._onKeyUp),i.removeEventListener("input",this._onInput),i.removeEventListener("focus",this._onFocus),i.removeEventListener("blur",this._onBlur),i.form&&i.form.removeEventListener("reset",this._onFormReset),this.input.removeEventListeners()},t.prototype._onKeyDown=function(e){var n=e.keyCode,i=this.dropdown.isActive,r=e.key.length===1||e.key.length===2&&e.key.charCodeAt(0)>=55296||e.key==="Unidentified";switch(!this._isTextElement&&!i&&n!==Qe.ESC_KEY&&n!==Qe.TAB_KEY&&n!==Qe.SHIFT_KEY&&(this.showDropdown(),!this.input.isFocussed&&r&&(this.input.value+=e.key,e.key===" "&&e.preventDefault())),n){case Qe.A_KEY:return this._onSelectKey(e,this.itemList.element.hasChildNodes());case Qe.ENTER_KEY:return this._onEnterKey(e,i);case Qe.ESC_KEY:return this._onEscapeKey(e,i);case Qe.UP_KEY:case Qe.PAGE_UP_KEY:case Qe.DOWN_KEY:case Qe.PAGE_DOWN_KEY:return this._onDirectionKey(e,i);case Qe.DELETE_KEY:case Qe.BACK_KEY:return this._onDeleteKey(e,this._store.items,this.input.isFocussed)}},t.prototype._onKeyUp=function(){this._canSearch=this.config.searchEnabled},t.prototype._onInput=function(){var e=this.input.value;if(!e){this._isTextElement?this.hideDropdown(!0):this._stopSearch();return}this._canAddItems()&&(this._canSearch&&this._handleSearch(e),this._canAddUserChoices&&(this._canCreateItem(e),this._isSelectElement&&(this._highlightPosition=0,this._highlightChoice())))},t.prototype._onSelectKey=function(e,n){if((e.ctrlKey||e.metaKey)&&n){this._canSearch=!1;var i=this.config.removeItems&&!this.input.value&&this.input.element===document.activeElement;i&&this.highlightAll()}},t.prototype._onEnterKey=function(e,n){var i=this,r=this.input.value,s=e.target;if(e.preventDefault(),s&&s.hasAttribute("data-button")){this._handleButtonAction(s);return}if(!n){(this._isSelectElement||this._notice)&&this.showDropdown();return}var o=this.dropdown.element.querySelector(li(this.config.classNames.highlightedState));if(!(o&&this._handleChoiceAction(o))){if(!s||!r){this.hideDropdown(!0);return}if(this._canAddItems()){var l=!1;this._store.withTxn(function(){if(l=i._findAndSelectChoiceByValue(r,!0),!l){if(!i._canAddUserChoices||!i._canCreateItem(r))return;i._addChoice(Ft(r,!1,i.config.allowHtmlUserInput),!0,!0),l=!0}i.clearInput(),i.unhighlightAll()}),l&&(this._triggerChange(r),this.config.closeDropdownOnSelect&&this.hideDropdown(!0))}}},t.prototype._onEscapeKey=function(e,n){n&&(e.stopPropagation(),this.hideDropdown(!0),this._stopSearch(),this.containerOuter.element.focus())},t.prototype._onDirectionKey=function(e,n){var i=e.keyCode;if(n||this._isSelectOneElement){this.showDropdown(),this._canSearch=!1;var r=i===Qe.DOWN_KEY||i===Qe.PAGE_DOWN_KEY?1:-1,s=e.metaKey||i===Qe.PAGE_DOWN_KEY||i===Qe.PAGE_UP_KEY,o=void 0;if(s)r>0?o=this.dropdown.element.querySelector("".concat(ci,":last-of-type")):o=this.dropdown.element.querySelector(ci);else{var l=this.dropdown.element.querySelector(li(this.config.classNames.highlightedState));l?o=Y0(l,ci,r):o=this.dropdown.element.querySelector(ci)}o&&(X0(o,this.choiceList.element,r)||this.choiceList.scrollToChildElement(o,r),this._highlightChoice(o)),e.preventDefault()}},t.prototype._onDeleteKey=function(e,n,i){!this._isSelectOneElement&&!e.target.value&&i&&(this._handleBackspace(n),e.preventDefault())},t.prototype._onTouchMove=function(){this._wasTap&&(this._wasTap=!1)},t.prototype._onTouchEnd=function(e){var n=(e||e.touches[0]).target,i=this._wasTap&&this.containerOuter.element.contains(n);if(i){var r=n===this.containerOuter.element||n===this.containerInner.element;r&&(this._isTextElement?this.input.focus():this._isSelectMultipleElement&&this.showDropdown()),e.stopPropagation()}this._wasTap=!0},t.prototype._onMouseDown=function(e){var n=e.target;if(n instanceof HTMLElement){if(uv&&this.choiceList.element.contains(n)){var i=this.choiceList.element.firstElementChild;this._isScrollingOnIe=this._direction==="ltr"?e.offsetX>=i.offsetWidth:e.offsetX<i.offsetLeft}if(n!==this.input.element){var r=n.closest("[data-button],[data-item],[data-choice]");r instanceof HTMLElement&&("button"in r.dataset?this._handleButtonAction(r):"item"in r.dataset?this._handleItemAction(r,e.shiftKey):"choice"in r.dataset&&this._handleChoiceAction(r)),e.preventDefault()}}},t.prototype._onMouseOver=function(e){var n=e.target;n instanceof HTMLElement&&"choice"in n.dataset&&this._highlightChoice(n)},t.prototype._onClick=function(e){var n=e.target,i=this.containerOuter,r=i.element.contains(n);r?!this.dropdown.isActive&&!i.isDisabled?this._isTextElement?document.activeElement!==this.input.element&&this.input.focus():(this.showDropdown(),i.element.focus()):this._isSelectOneElement&&n!==this.input.element&&!this.dropdown.element.contains(n)&&this.hideDropdown():(i.removeFocusState(),this.hideDropdown(!0),this.unhighlightAll())},t.prototype._onFocus=function(e){var n=e.target,i=this.containerOuter,r=n&&i.element.contains(n);if(r){var s=n===this.input.element;this._isTextElement?s&&i.addFocusState():this._isSelectMultipleElement?s&&(this.showDropdown(!0),i.addFocusState()):(i.addFocusState(),s&&this.showDropdown(!0))}},t.prototype._onBlur=function(e){var n=e.target,i=this.containerOuter,r=n&&i.element.contains(n);r&&!this._isScrollingOnIe?n===this.input.element?(i.removeFocusState(),this.hideDropdown(!0),(this._isTextElement||this._isSelectMultipleElement)&&this.unhighlightAll()):n===this.containerOuter.element&&(i.removeFocusState(),this._canSearch||this.hideDropdown(!0)):(this._isScrollingOnIe=!1,this.input.element.focus())},t.prototype._onFormReset=function(){var e=this;this._store.withTxn(function(){e.clearInput(),e.hideDropdown(),e.refresh(!1,!1,!0),e._initialItems.length&&e.setChoiceByValue(e._initialItems)})},t.prototype._highlightChoice=function(e){e===void 0&&(e=null);var n=Array.from(this.dropdown.element.querySelectorAll(ci));if(n.length){var i=e,r=this.config.classNames.highlightedState,s=Array.from(this.dropdown.element.querySelectorAll(li(r)));s.forEach(function(o){jt(o,r),o.setAttribute("aria-selected","false")}),i?this._highlightPosition=n.indexOf(i):(n.length>this._highlightPosition?i=n[this._highlightPosition]:i=n[n.length-1],i||(i=n[0])),me(i,r),i.setAttribute("aria-selected","true"),this.passedElement.triggerEvent(dt.highlightChoice,{el:i}),this.dropdown.isActive&&(this.input.setActiveDescendant(i.id),this.containerOuter.setActiveDescendant(i.id))}},t.prototype._addItem=function(e,n,i){if(n===void 0&&(n=!0),i===void 0&&(i=!1),!e.id)throw new TypeError("item.id must be set before _addItem is called for a choice/item");(this.config.singleModeForMultiSelect||this._isSelectOneElement)&&this.removeActiveItems(e.id),this._store.dispatch(Pa(e)),n&&(this.passedElement.triggerEvent(dt.addItem,this._getChoiceForOutput(e)),i&&this.passedElement.triggerEvent(dt.choice,this._getChoiceForOutput(e)))},t.prototype._removeItem=function(e){if(e.id){this._store.dispatch(La(e));var n=this._notice;n&&n.type===Ke.noChoices&&this._clearNotice(),this.passedElement.triggerEvent(dt.removeItem,this._getChoiceForOutput(e))}},t.prototype._addChoice=function(e,n,i){if(n===void 0&&(n=!0),i===void 0&&(i=!1),e.id)throw new TypeError("Can not re-add a choice which has already been added");var r=this.config;if(!(!r.duplicateItemsAllowed&&this._store.choices.find(function(l){return r.valueComparer(l.value,e.value)}))){this._lastAddedChoiceId++,e.id=this._lastAddedChoiceId,e.elementId="".concat(this._baseId,"-").concat(this._idNames.itemChoice,"-").concat(e.id);var s=r.prependValue,o=r.appendValue;s&&(e.value=s+e.value),o&&(e.value+=o.toString()),(s||o)&&e.element&&(e.element.value=e.value),this._clearNotice(),this._store.dispatch(Oa(e)),e.selected&&this._addItem(e,n,i)}},t.prototype._addGroup=function(e,n){var i=this;if(n===void 0&&(n=!0),e.id)throw new TypeError("Can not re-add a group which has already been added");this._store.dispatch(K0(e)),e.choices&&(this._lastAddedGroupId++,e.id=this._lastAddedGroupId,e.choices.forEach(function(r){r.group=e,e.disabled&&(r.disabled=!0),i._addChoice(r,n)}))},t.prototype._createTemplates=function(){var e=this,n=this.config.callbackOnCreateTemplates,i={};typeof n=="function"&&(i=n.call(this,J0,us,nr));var r={};Object.keys(this._templates).forEach(function(s){s in i?r[s]=i[s].bind(e):r[s]=e._templates[s].bind(e)}),this._templates=r},t.prototype._createElements=function(){var e=this._templates,n=this,i=n.config,r=n._isSelectOneElement,s=i.position,o=i.classNames,l=this._elementType;this.containerOuter=new za({element:e.containerOuter(i,this._direction,this._isSelectElement,r,i.searchEnabled,l,i.labelId),classNames:o,type:l,position:s}),this.containerInner=new za({element:e.containerInner(i),classNames:o,type:l,position:s}),this.input=new s1({element:e.input(i,this._placeholderValue),classNames:o,type:l,preventPaste:!i.paste}),this.choiceList=new ja({element:e.choiceList(i,r)}),this.itemList=new ja({element:e.itemList(i,r)}),this.dropdown=new r1({element:e.dropdown(i),classNames:o,type:l})},t.prototype._createStructure=function(){var e=this,n=e.containerInner,i=e.containerOuter,r=e.passedElement,s=this.dropdown.element;r.conceal(),n.wrap(r.element),i.wrap(n.element),this._isSelectOneElement?this.input.placeholder=this.config.searchPlaceholderValue||"":(this._placeholderValue&&(this.input.placeholder=this._placeholderValue),this.input.setWidth()),i.element.appendChild(n.element),i.element.appendChild(s),n.element.appendChild(this.itemList.element),s.appendChild(this.choiceList.element),this._isSelectOneElement?this.config.searchEnabled&&s.insertBefore(this.input.element,s.firstChild):n.element.appendChild(this.input.element),this._highlightPosition=0,this._isSearching=!1},t.prototype._initStore=function(){var e=this;this._store.subscribe(this._render).withTxn(function(){e._addPredefinedChoices(e._presetChoices,e._isSelectOneElement&&!e._hasNonChoicePlaceholder,!1)}),(!this._store.choices.length||this._isSelectOneElement&&this._hasNonChoicePlaceholder)&&this._render()},t.prototype._addPredefinedChoices=function(e,n,i){var r=this;if(n===void 0&&(n=!1),i===void 0&&(i=!0),n){var s=e.findIndex(function(o){return o.selected})===-1;s&&e.some(function(o){return o.disabled||"choices"in o?!1:(o.selected=!0,!0)})}e.forEach(function(o){"choices"in o?r._isSelectElement&&r._addGroup(o,i):r._addChoice(o,i)})},t.prototype._findAndSelectChoiceByValue=function(e,n){var i=this;n===void 0&&(n=!1);var r=this._store.choices.find(function(s){return i.config.valueComparer(s.value,e)});return r&&!r.disabled&&!r.selected?(this._addItem(r,!0,n),!0):!1},t.prototype._generatePlaceholderValue=function(){var e=this.config;if(!e.placeholder)return null;if(this._hasNonChoicePlaceholder)return e.placeholderValue;if(this._isSelectElement){var n=this.passedElement.placeholderOption;return n?n.text:null}return null},t.prototype._warnChoicesInitFailed=function(e){if(!this.config.silent)if(this.initialised){if(!this.initialisedOK)throw new TypeError("".concat(e," called for an element which has multiple instances of Choices initialised on it"))}else throw new TypeError("".concat(e," called on a non-initialised instance of Choices"))},t.version="11.1.0",t}();const Vy="",Hy="";function ac(t){let e,n;return{c(){e=w("label"),n=ne(t[2]),v(e,"for",t[4])},m(i,r){j(i,e,r),y(e,n)},p(i,r){r&4&&_e(n,i[2])},d(i){i&&z(e)}}}function dv(t){let e;return{c(){e=w("select"),v(e,"id",t[4]),v(e,"name",t[4]),v(e,"aria-label",t[2]),v(e,"class","m-1")},m(n,i){j(n,e,i)},p(n,i){i&4&&v(e,"aria-label",n[2])},i:X,o:X,d(n){n&&z(e)}}}function mv(t){let e,n,i,r=t[3].length&&cc(t);return{c(){r&&r.c(),e=U(),n=w("select"),v(n,"id",t[4]),v(n,"name",t[4]),v(n,"aria-label",t[2]),v(n,"class","m-1"),n.multiple=!0},m(s,o){r&&r.m(s,o),j(s,e,o),j(s,n,o),i=!0},p(s,o){s[3].length?r?(r.p(s,o),o&8&&F(r,1)):(r=cc(s),r.c(),F(r,1),r.m(e.parentNode,e)):r&&(ke(),K(r,1,1,()=>{r=null}),Ee()),(!i||o&4)&&v(n,"aria-label",s[2])},i(s){i||(F(r),i=!0)},o(s){K(r),i=!1},d(s){r&&r.d(s),s&&z(e),s&&z(n)}}}function cc(t){let e,n,i=t[3].length+"",r,s,o,l;return o=new Mi({props:{targetHtmlId:t[5],tooltipText:`${t[3].length}
                                    ${W==="fr"&&t[3].length>1?"valeurs sélectionnées":W==="fr"&&t[3].length===1?"valeur sélectionnée":W==="en"&&t[3].length>1?"selected values":"selected value"}`}}),{c(){e=w("span"),n=w("span"),r=ne(i),s=U(),ae(o.$$.fragment),v(n,"id",t[5]),v(n,"class","input-dropdown-count tag m-1 svelte-1epfuu8"),v(e,"class","is-relative")},m(a,c){j(a,e,c),y(e,n),y(n,r),y(e,s),oe(o,e,null),l=!0},p(a,c){(!l||c&8)&&i!==(i=a[3].length+"")&&_e(r,i);const u={};c&8&&(u.tooltipText=`${a[3].length}
                                    ${W==="fr"&&a[3].length>1?"valeurs sélectionnées":W==="fr"&&a[3].length===1?"valeur sélectionnée":W==="en"&&a[3].length>1?"selected values":"selected value"}`),o.$set(u)},i(a){l||(F(o.$$.fragment,a),l=!0)},o(a){K(o.$$.fragment,a),l=!1},d(a){a&&z(e),le(o)}}}function pv(t){let e,n,i,r,s,o,l,a=t[2]!==void 0&&ac(t);const c=[mv,dv],u=[];function d(f,h){return f[0]?0:1}return r=d(t),s=u[r]=c[r](t),{c(){e=w("div"),a&&a.c(),n=U(),i=w("div"),s.c(),v(i,"class",o="input-dropdown-select "+(t[0]?"is-multiple":"is-single")+" "+(t[0]&&t[3].length?"is-flex is-justify-content-flex-start is-align-items-center":"")+" "+(t[1]?"light-display":"")+" svelte-1epfuu8"),v(e,"class","input-dropdown-select-wrapper")},m(f,h){j(f,e,h),a&&a.m(e,null),y(e,n),y(e,i),u[r].m(i,null),l=!0},p(f,[h]){f[2]!==void 0?a?a.p(f,h):(a=ac(f),a.c(),a.m(e,n)):a&&(a.d(1),a=null);let m=r;r=d(f),r===m?u[r].p(f,h):(ke(),K(u[m],1,1,()=>{u[m]=null}),Ee(),s=u[r],s?s.p(f,h):(s=u[r]=c[r](f),s.c()),F(s,1),s.m(i,null)),(!l||h&11&&o!==(o="input-dropdown-select "+(f[0]?"is-multiple":"is-single")+" "+(f[0]&&f[3].length?"is-flex is-justify-content-flex-start is-align-items-center":"")+" "+(f[1]?"light-display":"")+" svelte-1epfuu8"))&&v(i,"class",o)},i(f){l||(F(s),l=!0)},o(f){K(s),l=!1},d(f){f&&z(e),a&&a.d(),u[r].d()}}}const gv=250;function _v(t,e,n){let i,r,{choicesItems:s}=e,{start:o=[]}=e,{multiple:l}=e,{searchable:a=!0}=e,{lightDisplay:c=!1}=e,{placeholder:u=W==="fr"?"Sélectionner une valeur":"Select a value"}=e,{title:d=void 0}=e,{selectAll:f=!!l}=e;const h=`input-dropdown-select-${window.crypto.randomUUID()}`,m=`input-dropdown-counter-${window.crypto.randomUUID()}`,g=`select-all-${window.crypto.randomUUID()}`,p=`unselect-all-${window.crypto.randomUUID()}`,_=bi();let S;const I=Si();I.setCompareFn(kr);const b=_t("resetTrigger")||void 0;b==null||b.subscribe(()=>q(S,s,o,f));const E=()=>{n(11,r=!0),setTimeout(()=>n(11,r=!1),gv)},O=(A,V)=>{V||(I.set(A),I.same()||_("updateValues",i))},x=A=>`<span class="iconify" data-icon=${A}/>`,k=(A,V)=>A!=null&&V!=null&&A.length&&V.length?`<span class="dropdown-prefix-wrapper">${V==="iconify"?x(A):A}</span>`:"",M=(A,V)=>V?[{value:g,label:`<b>${W==="fr"?"Tout sélectionner":"Select all"}</b>`},{value:p,label:`<b>${W==="fr"?"Tout retirer":"Remove all"}</b>`},...A]:A,P=(A,V)=>M(A,V).map(B=>(B.id=`dropdown-choice-${window.crypto.randomUUID()}`,B.label=`<span>
                ${k(B.prefix||"",B.prefixType||"")}
                <span class="dropdown-prefix-text">${B.label}</span>
            </span>`,B));function L(A,V,B){return A=structuredClone(A),V=structuredClone(V),A=P(A,B).map(H=>V.includes(H.value)?{...H,selected:!0}:{...H,selected:!1}),n(3,i=V),A}function q(A,V,B,H){A&&(V=L(V,B,H),A.clearStore().setChoices(V))}const R=(A,V,B,H,Y,Z)=>(H=structuredClone(H),B=structuredClone(B),A.detail.value===Y?(E(),B=B.map(re=>[Y,Z].includes(re.value)?{...re,selected:!1}:{...re,selected:!0}),V.removeActiveItems().clearChoices(!0,!0).setValue(B).hideDropdown(),H=[...new Set(B.filter(re=>re.selected===!0).map(re=>re.value))]):A.detail.value===Z?(V.removeActiveItems().hideDropdown(),H=[]):H=l===!0?[...H,A.detail.value]:[A.detail.value],[...new Set(H)]),C=(A,V)=>structuredClone(V).filter(B=>B!==A.detail.value);function D(A,V){const B=document.getElementById(h);S=new hv(B,{items:[],choices:A,addChoices:!1,addItems:!1,removeItems:!0,removeItemButton:!0,searchEnabled:a,allowHTML:!0,shouldSort:!V,sorter:(H,Y)=>H.label.localeCompare(Y.label),placeholderValue:u,classNames:{item:["choices__item","dropdown-item"]},loadingText:W==="fr"?"Chargement...":"Loading...",noResultsText:W==="fr"?"Pas de résultats":"No results found",noChoicesText:W==="fr"?"Pas de choix pour faire la sélection":"No choices to choose from",itemSelectText:W==="fr"?"Cliquer pour sélectionner":"Press to select",uniqueItemText:W==="fr"?"Seules des valeurs uniques peuvent être ajoutées":"Only unique values can be added",customAddItemText:W==="fr"?"Les valeurs ne répondent pas aux conditions attendues":"Only values matching specific conditions can be added",removeItemIconText:W==="fr"?"Retirer l'item":"Remove item",addItemText:H=>W==="fr"?`Cliquer sur Entrer pour ajouter <b>${H}</b>`:`Press Enter to add <b>"${H}"</b>`,removeItemLabelText:H=>W==="fr"?`Retirer l'item: ${H}`:`Remove item: ${H}`,maxItemText:H=>W==="fr"?`Seulement ${H} items peuvent être ajoutées`:`Only ${H} items can be added`}),B.addEventListener("addItem",H=>{n(3,i=R(H,S,A,i,g,p))}),B.addEventListener("removeItem",H=>{n(3,i=C(H,i))})}return Hn(()=>{const A=L(s,o,f);D(A,f)}),Un(()=>{S.destroy(),S=void 0}),t.$$set=A=>{"choicesItems"in A&&n(6,s=A.choicesItems),"start"in A&&n(7,o=A.start),"multiple"in A&&n(0,l=A.multiple),"searchable"in A&&n(8,a=A.searchable),"lightDisplay"in A&&n(1,c=A.lightDisplay),"placeholder"in A&&n(9,u=A.placeholder),"title"in A&&n(2,d=A.title),"selectAll"in A&&n(10,f=A.selectAll)},t.$$.update=()=>{t.$$.dirty&2056&&O(i,r)},n(3,i=[]),n(11,r=!1),[l,c,d,i,h,m,s,o,a,u,f,r]}class vv extends ye{constructor(e){super(),ve(this,e,_v,pv,pe,{choicesItems:6,start:7,multiple:0,searchable:8,lightDisplay:1,placeholder:9,title:2,selectAll:10})}}const Uy="";function yv(t){let e,n,i,r,s,o,l,a,c,u,d,f,h,m,g,p,_,S,I,b,E,O,x,k,M,P,L,q,R,C,D,A,V,B,H,Y,Z,re,fe;return c=new un({props:{minVal:0,maxVal:1,start:t[5],emitOnUpdate:!0,title:W==="fr"?"Opacité":"Opacity"}}),c.$on("updateSlider",t[9]),f=new un({props:{minVal:0,maxVal:360,start:t[6],step:1,emitOnUpdate:!0,title:"Rotation"}}),f.$on("updateSlider",t[10]),g=new un({props:{minVal:0,maxVal:200,step:1,start:t[7],emitOnUpdate:!0,title:W==="fr"?"Redimensionner":"Scale"}}),g.$on("updateSlider",t[11]),S=new un({props:{minVal:-100,maxVal:100,step:1,start:t[8][0],emitOnUpdate:!0,title:W==="fr"?"Translation horizontale":"Horizontal translate"}}),S.$on("updateSlider",t[12]),E=new un({props:{minVal:-100,maxVal:100,step:1,start:t[8][1],emitOnUpdate:!0,title:W==="fr"?"Translation verticale":"Vertical translate"}}),E.$on("updateSlider",t[13]),k=new vv({props:{choicesItems:t[4],start:[],lightDisplay:!0,placeholder:W==="fr"?"Sélectionner":"Select",title:W==="fr"?"Basculer":"Flip"}}),k.$on("updateValues",t[14]),{c(){e=w("div"),n=w("div"),i=w("div"),r=w("div"),s=w("strong"),s.textContent=`${W==="en"?"Query image transformation":"Modification de l'image requête"}`,o=U(),l=w("div"),a=w("div"),ae(c.$$.fragment),u=U(),d=w("div"),ae(f.$$.fragment),h=U(),m=w("div"),ae(g.$$.fragment),p=U(),_=w("div"),ae(S.$$.fragment),I=U(),b=w("div"),ae(E.$$.fragment),O=U(),x=w("div"),ae(k.$$.fragment),M=U(),P=w("div"),L=w("button"),L.textContent=`${W==="fr"?"Réinitialiser":"Reset"}`,q=U(),R=w("div"),C=w("img"),V=U(),B=w("img"),v(r,"class","toolbar-title mt-0 mb-2 svelte-nzei31"),v(a,"class"," svelte-nzei31"),v(d,"class"," svelte-nzei31"),v(m,"class"," svelte-nzei31"),v(_,"class"," svelte-nzei31"),v(b,"class"," svelte-nzei31"),v(x,"class"," svelte-nzei31"),v(L,"class","button is-link"),v(P,"class","mt-2 is-flex is-flex-direction-column is-justify-content-center is-align-items-flex-end svelte-nzei31"),v(l,"class","toolbar-controls is-flex is-flex-direction-column is-align-items-start is-justify-content-center svelte-nzei31"),v(i,"class","toolbar svelte-nzei31"),v(n,"class","toolbar-wrapper is-flex is-flex-direction-column is-justify-content-center is-align-items-center svelte-nzei31"),v(C,"class","compare-img svelte-nzei31"),gt(C.src,D=t[0].queryImage.href)||v(C,"src",D),v(C,"alt",A=t[0].queryImage.title),v(B,"class","main-img svelte-nzei31"),gt(B.src,H=t[0].similarityImage.href)||v(B,"src",H),v(B,"alt",Y=t[0].similarityImage.title),Se(B,"overlay-reset",t[2]),De(B,"opacity",t[1]),De(B,"transform",t[3]),v(R,"class","overlay-wrapper svelte-nzei31"),v(e,"class","similarity-overlay-wrapper svelte-nzei31")},m(te,ce){j(te,e,ce),y(e,n),y(n,i),y(i,r),y(r,s),y(i,o),y(i,l),y(l,a),oe(c,a,null),y(l,u),y(l,d),oe(f,d,null),y(l,h),y(l,m),oe(g,m,null),y(l,p),y(l,_),oe(S,_,null),y(l,I),y(l,b),oe(E,b,null),y(l,O),y(l,x),oe(k,x,null),y(l,M),y(l,P),y(P,L),y(e,q),y(e,R),y(R,C),y(R,V),y(R,B),Z=!0,re||(fe=ge(L,"click",t[15]),re=!0)},p(te,[ce]){(!Z||ce&1&&!gt(C.src,D=te[0].queryImage.href))&&v(C,"src",D),(!Z||ce&1&&A!==(A=te[0].queryImage.title))&&v(C,"alt",A),(!Z||ce&1&&!gt(B.src,H=te[0].similarityImage.href))&&v(B,"src",H),(!Z||ce&1&&Y!==(Y=te[0].similarityImage.title))&&v(B,"alt",Y),(!Z||ce&4)&&Se(B,"overlay-reset",te[2]),ce&2&&De(B,"opacity",te[1]),ce&8&&De(B,"transform",te[3])},i(te){Z||(F(c.$$.fragment,te),F(f.$$.fragment,te),F(g.$$.fragment,te),F(S.$$.fragment,te),F(E.$$.fragment,te),F(k.$$.fragment,te),Z=!0)},o(te){K(c.$$.fragment,te),K(f.$$.fragment,te),K(g.$$.fragment,te),K(S.$$.fragment,te),K(E.$$.fragment,te),K(k.$$.fragment,te),Z=!1},d(te){te&&z(e),le(c),le(f),le(g),le(S),le(E),le(k),re=!1,fe()}}}function bv(t,e,n){let i,{imgData:r}=e;const s=[{value:"h",label:W==="fr"?"Basculer horizontalement":"Flip horizontally"},{value:"v",label:W==="fr"?"Basculer verticalement":"Flip vertically"},{value:"hv",label:W==="fr"?"Basculer horizontalement et verticalement":"Flip horizontally and vertically"}];let o=.5;const l=o;let a=0;const c=a;let u=100;const d=u;let f=[1,1];const h=structuredClone(f);let m=[0,0];const g=structuredClone(m);let p=!1;const _=we(window.crypto.randomUUID());wn("resetTrigger",_);const S=M=>n(1,o=M.detail),I=M=>n(16,a=M.detail),b=M=>n(17,u=M.detail),E=M=>n(19,m=[M.detail,m[1]]),O=M=>n(19,m=[m[0],M.detail]),x=M=>{let P=M.detail[0];n(18,f=P==="hv"?[-1,-1]:P==="h"?[-1,1]:P==="v"?[1,-1]:[1,1])},k=()=>{n(1,o=l),n(16,a=c),n(17,u=d),n(18,f=h),n(19,m=g),_.set(window.crypto.randomUUID()),n(2,p=!0),setTimeout(()=>n(2,p=!1),1e3)};return t.$$set=M=>{"imgData"in M&&n(0,r=M.imgData)},t.$$.update=()=>{t.$$.dirty&983040&&n(3,i=`translate(${m[0]-50}%, ${m[1]}%)
                        rotate(${a}deg)
                        scale(${f.map(M=>M*(u/100)).join()})`)},[r,o,p,i,s,l,c,d,g,S,I,b,E,O,x,k,a,u,f,m]}class wv extends ye{constructor(e){super(),ve(this,e,bv,yv,pe,{imgData:0})}}function Sv(){const t=`${window.location.origin}${window.location.pathname}`,e=25,n=window.location.pathname.match(/\d+/g).join("-"),i={[n]:{}},r=[2,6],s=we(1),o=we({}),l=we(JSON.parse(localStorage.getItem("selectedRegions"))||i);l.subscribe(q=>localStorage.setItem("selectedRegions",JSON.stringify(q)));const a=we(JSON.parse(localStorage.getItem("excludedCategories"))||[]);a.subscribe(q=>localStorage.setItem("excludedCategories",JSON.stringify(q)));const c=we(JSON.parse(localStorage.getItem("similarityScoreCutoff"))||void 0);c.subscribe(q=>{q!=null&&localStorage.setItem("similarityScoreCutoff",JSON.stringify(q))});const u=we(JSON.parse(localStorage.getItem("propagateRecursionDepth"))||r[1]);u.subscribe(q=>localStorage.setItem("propagateRecursionDepth",JSON.stringify(q)));const d=we(JSON.parse(localStorage.getItem("propagateFilterByRegions"))||!1);d.subscribe(q=>localStorage.setItem("propagateFilterByRegions",JSON.stringify(q)));const f=Ue([u,d],([q,R])=>({propagateRecursionDepth:q,propagateFilterByRegions:R})),h=Ue([a,l,c],([q,R,C])=>({excludedCategories:q,regions:R,similarityScoreCutoff:C})),m=Ue([f,h],([q,R])=>({propagate:q,similarity:R})),g=we([]),p=we([]);async function _(){const q=async()=>{const D=await(await fetch(`${t}compared-regions`)).json();o.set(D),l.update(A=>{let V=A[n]||{};if(Object.keys(V).length){let B=Object.keys(V).filter(H=>Object.keys(D).includes(H)).reduce((H,Y)=>(H[Y]=V[Y],H),{});A[n]=B}return A})},R=async()=>{const D=await(await fetch(`${t}query-images`)).json();D.length>0&&(g.set(D),P(x()))};qn.set(!0);try{await Promise.all([q(),R()])}catch(C){console.error("Error:",C),Wc.set(C.message)}finally{qn.set(!1)}}function S(q){localStorage.setItem("selectedRegions",JSON.stringify(q))}function I(q){l.update(R=>{const C={...R};return delete C[n][q],S(C),C})}function b(q){l.update(R=>{const C={...R,[n]:{...R[n]||{},[q.ref]:q}};return S(C),C})}const E=Ue(l,q=>R=>{var C;return(C=q[n])==null?void 0:C.hasOwnProperty(R)});function O(q){const R=et(o),C=Object.keys(R).filter(D=>D.startsWith(q));return C.length!==1?{title:"Error"}:R[C[0]]}const x=()=>wr(s,"sp"),k=Ue([s,g],([q,R])=>(async()=>M(q,R))());function M(q,R){const C=(q-1)*e,D=C+e,A=R.slice(C,D);return p.set(A),A}function P(q){Sr(q,s,"sp")}function L(q){o.update(R=>({...R,[q.ref]:q}))}return{currentPage:s,comparedRegions:o,excludedCategories:a,qImgs:g,pageQImgs:p,selectedRegions:l,propagateRecursionDepth:u,propagateFilterByRegions:d,similarityToolbarParams:m,propagateParams:f,similarityScoreCutoff:c,allowedPropagateDepthRange:r,fetchSimilarity:_,setPageQImgs:k,getRegionsInfo:O,handlePageUpdate:P,unselect:I,select:b,addComparedRegions:L,isSelected:E,pageLength:e}}const Qt=Sv(),{getRegionsInfo:kv}=Qt;async function uc(t,e,n,i,r,s,o=!1,l=!0){const a=()=>l?`<b>${!isNaN(parseFloat(n))&&e===1?`Score: ${n}`:e===2&&W==="en"?"Manual similarity":e===2&&W==="fr"?"Correspondance manuelle":e===3&&W==="en"?"Propagated match":"Correspondance propagée"}</b>`:"",c=u=>`${u}<br>
        Page ${parseInt(i)}<br>
        ${a()}`;return o===!0?fetch(`${r}${s}get_regions_title/${t}`).then(u=>u.json()).then(u=>c(u.title)).catch(u=>(console.error("similarity.utils.getDesc()",u),c(W==="fr"?"Titre inconnu":"Unknown title"))):Promise.resolve(c(kv(t).title))}function fc(t,e,n){const i=t.slice();return i[16]=e[n],i}function hc(t){let e,n,i=t[16]==="queryImage"&&W==="fr"?"Image requête":t[16]==="similarityImage"&&W==="fr"?"Similarité":t[16]==="queryImage"&&W==="en"?"Query image":"Similarity",r,s,o,l,a;return o=new Dn({props:{item:t[0][t[16]],descPromise:t[1][t[16]],height:"full"}}),{c(){e=w("div"),n=w("span"),r=ne(i),s=U(),ae(o.$$.fragment),l=U(),v(e,"class","img-legend-wrapper column is-flex is-flex-direction-column is-justify-content-center is-align-items-center")},m(c,u){j(c,e,u),y(e,n),y(n,r),y(e,s),oe(o,e,null),y(e,l),a=!0},p(c,u){const d={};u&1&&(d.item=c[0][c[16]]),o.$set(d)},i(c){a||(F(o.$$.fragment,c),a=!0)},o(c){K(o.$$.fragment,c),a=!1},d(c){c&&z(e),le(o)}}}function Ev(t){let e,n,i=["queryImage","similarityImage"],r=[];for(let o=0;o<2;o+=1)r[o]=hc(fc(t,i,o));const s=o=>K(r[o],1,1,()=>{r[o]=null});return{c(){e=w("div");for(let o=0;o<2;o+=1)r[o].c();v(e,"class","side-by-side columns")},m(o,l){j(o,e,l);for(let a=0;a<2;a+=1)r[a]&&r[a].m(e,null);n=!0},p(o,[l]){if(l&3){i=["queryImage","similarityImage"];let a;for(a=0;a<2;a+=1){const c=fc(o,i,a);r[a]?(r[a].p(c,l),F(r[a],1)):(r[a]=hc(c),r[a].c(),F(r[a],1),r[a].m(e,null))}for(ke(),a=2;a<2;a+=1)s(a);Ee()}},i(o){if(!n){for(let l=0;l<2;l+=1)F(r[l]);n=!0}},o(o){r=r.filter(Boolean);for(let l=0;l<2;l+=1)K(r[l]);n=!1},d(o){o&&z(e),Ye(r,o)}}}function Cv(t,e,n){let{imgData:i}=e;const r=_t("similarityPair"),s=new URL(window.location.href),o=s.origin,l=s.pathname,[a,c,u,d]=r.qImg.split(".")[0].split("_"),[f,h,m,g]=r.sImg.split(".")[0].split("_"),p=`${a}_${c}`,_=`${f}_${h}`,S={queryImage:uc(p,r.similarityType,r.score,u,o,l,!0,!1),similarityImage:uc(_,r.similarityType,r.score,m,o,l,!0,!0)};return t.$$set=I=>{"imgData"in I&&n(0,i=I.imgData)},[i,S]}class Iv extends ye{constructor(e){super(),ve(this,e,Cv,Ev,pe,{imgData:0})}}const By="";function Mv(t){let e,n;return e=new Iv({props:{imgData:t[2]}}),{c(){ae(e.$$.fragment)},m(i,r){oe(e,i,r),n=!0},p:X,i(i){n||(F(e.$$.fragment,i),n=!0)},o(i){K(e.$$.fragment,i),n=!1},d(i){le(e,i)}}}function xv(t){let e,n;return e=new wv({props:{imgData:t[1]}}),{c(){ae(e.$$.fragment)},m(i,r){oe(e,i,r),n=!0},p:X,i(i){n||(F(e.$$.fragment,i),n=!0)},o(i){K(e.$$.fragment,i),n=!1},d(i){le(e,i)}}}function Av(t){let e,n,i,r,s,o,l,a,c;const u=[xv,Mv],d=[];function f(h,m){return h[0]?0:1}return i=f(t),r=d[i]=u[i](t),a=new F0({props:{start:!1,buttonDisplay:!0,toggleLabel:W==="en"?"Overlay view":"Vue superposée"}}),a.$on("updateChecked",t[3]),{c(){e=w("div"),n=w("div"),r.c(),o=U(),l=w("div"),ae(a.$$.fragment),v(n,"class",s="modal-similarity-images "+(t[0]?"overlay-wrapper":"side-by-side-wrapper")+" svelte-1qvtan5"),v(e,"class","modal-similarity svelte-1qvtan5")},m(h,m){j(h,e,m),y(e,n),d[i].m(n,null),y(e,o),y(e,l),oe(a,l,null),c=!0},p(h,[m]){let g=i;i=f(h),i===g?d[i].p(h,m):(ke(),K(d[g],1,1,()=>{d[g]=null}),Ee(),r=d[i],r?r.p(h,m):(r=d[i]=u[i](h),r.c()),F(r,1),r.m(n,null)),(!c||m&1&&s!==(s="modal-similarity-images "+(h[0]?"overlay-wrapper":"side-by-side-wrapper")+" svelte-1qvtan5"))&&v(n,"class",s)},i(h){c||(F(r),F(a.$$.fragment,h),c=!0)},o(h){K(r),K(a.$$.fragment,h),c=!1},d(h){h&&z(e),d[i].d(),le(a)}}}function Tv(t,e,n){let{mainImgItem:i}=e,{compareImgItem:r}=e;const s={similarityImage:{href:Rt(i.img,i.img.split("_").pop()),title:a(i.title)},queryImage:{href:Rt(r.img,r.img.split("_").pop()),title:a(r.title)}},o={similarityImage:i,queryImage:r};let l=!1;function a(u){return W==="fr"?`Vue principale de la région ${u}`:`Main view of region ${u}`}const c=()=>n(0,l=!l);return t.$$set=u=>{"mainImgItem"in u&&n(4,i=u.mainImgItem),"compareImgItem"in u&&n(5,r=u.compareImgItem)},[l,s,o,c,i,r]}class Nv extends ye{constructor(e){super(),ve(this,e,Tv,Av,pe,{mainImgItem:4,compareImgItem:5})}}const Ov=Object.freeze(Object.defineProperty({__proto__:null,default:Nv},Symbol.toStringTag,{value:"Module"})),dc=(t,e,n,i)=>({id:t,img:t,title:`Canvas ${i} - ${n} - ${W==="en"?"Witness":"Témoin"} #${yr(e)}`,xywh:n.split(",").map(Number),canvas:i,ref:t.replace(".jpg",""),type:Hc});function Pv(t){let e,n,i,r,s,o,l,a,c,u,d;return n=new xn({props:{category:1,isSelected:t[0]===1,toggle:t[4],padding:"pl-3 pr-2"}}),r=new xn({props:{category:2,isSelected:t[0]===2,toggle:t[4]}}),o=new xn({props:{category:3,isSelected:t[0]===3,toggle:t[4]}}),a=new xn({props:{category:4,isSelected:t[0]===4,toggle:t[4]}}),u=new xn({props:{category:5,isSelected:t[0]===5,toggle:t[4],padding:"pl-2 pr-3"}}),{c(){e=w("div"),ae(n.$$.fragment),i=U(),ae(r.$$.fragment),s=U(),ae(o.$$.fragment),l=U(),ae(a.$$.fragment),c=U(),ae(u.$$.fragment),v(e,"class","tags has-addons is-dark is-center")},m(f,h){j(f,e,h),oe(n,e,null),y(e,i),oe(r,e,null),y(e,s),oe(o,e,null),y(e,l),oe(a,e,null),y(e,c),oe(u,e,null),d=!0},p(f,h){const m={};h&1&&(m.isSelected=f[0]===1),n.$set(m);const g={};h&1&&(g.isSelected=f[0]===2),r.$set(g);const p={};h&1&&(p.isSelected=f[0]===3),o.$set(p);const _={};h&1&&(_.isSelected=f[0]===4),a.$set(_);const S={};h&1&&(S.isSelected=f[0]===5),u.$set(S)},i(f){d||(F(n.$$.fragment,f),F(r.$$.fragment,f),F(o.$$.fragment,f),F(a.$$.fragment,f),F(u.$$.fragment,f),d=!0)},o(f){K(n.$$.fragment,f),K(r.$$.fragment,f),K(o.$$.fragment,f),K(a.$$.fragment,f),K(u.$$.fragment,f),d=!1},d(f){f&&z(e),le(n),le(r),le(o),le(a),le(u)}}}function Lv(t){let e,n,i,r;n=new Dn({props:{item:t[3],size:256,selectable:!1,isSquare:!1}});let s=!t[2]&&Pv(t);return{c(){e=w("div"),ae(n.$$.fragment),i=U(),s&&s.c()},m(o,l){j(o,e,l),oe(n,e,null),y(e,i),s&&s.m(e,null),r=!0},p(o,[l]){o[2]||s.p(o,l)},i(o){r||(F(n.$$.fragment,o),F(s),r=!0)},o(o){K(n.$$.fragment,o),K(s),r=!1},d(o){o&&z(e),le(n),s&&s.d()}}}function Dv(t,e,n){let i,r,s;const{comparedRegions:o}=Qt;de(t,o,R=>n(15,s=R));const l=new URL(window.location.href),a=l.origin;l.pathname;let{qImg:c}=e,{sImg:u}=e,{qRegions:d}=e,{sRegions:f}=e,{score:h=0}=e,{category:m=null}=e,{users:g=[]}=e,{isManual:p}=e,{similarityType:_}=e;const S=_t("isInModal")||!1,[I,b,E,O]=u.split(".")[0].split("_"),k=(()=>{let R=dc(u,I,O,E);const C=s[`${I}_${b}_anno${f}`]||{title:R.title};return R.title=`${br(C.title.replace(/^[^|]+/,""))}<br/>Page ${Yc(E)}<br/><b>Score: ${h}</b>`,R})();wn("similarityPair",{qImg:c,sImg:u,qRegions:d,sRegions:f,score:h,category:m,users:g,isManual:p,similarityType:_});function M(R){R=R.slice();let C=R.indexOf(Number(vr));return r&&C===-1?R.push(Number(vr)):!r&&C!==-1&&R.splice(C,1),R}const P=()=>({img_1:c,img_2:u,regions_id_1:d,regions_id_2:f,score:h,category:i,category_x:M(g),similarity_type:_});function L(R){R===5?r=!r:n(0,i=i===R?null:R)}async function q(R){L(R);try{(await fetch(`${a}/${At}/save-category`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":en},body:JSON.stringify(P())})).ok||(console.error("Error: Network response was not ok"),L(R))}catch(C){console.error("Error:",C),L(R)}}return t.$$set=R=>{"qImg"in R&&n(5,c=R.qImg),"sImg"in R&&n(6,u=R.sImg),"qRegions"in R&&n(7,d=R.qRegions),"sRegions"in R&&n(8,f=R.sRegions),"score"in R&&n(9,h=R.score),"category"in R&&n(10,m=R.category),"users"in R&&n(11,g=R.users),"isManual"in R&&n(12,p=R.isManual),"similarityType"in R&&n(13,_=R.similarityType)},t.$$.update=()=>{t.$$.dirty&1024&&n(0,i=m),t.$$.dirty&2048&&(r=g.includes(Number(vr))||!1)},[i,o,S,k,q,c,u,d,f,h,m,g,p,_]}class Rv extends ye{constructor(e){super(),ve(this,e,Dv,Lv,pe,{qImg:5,sImg:6,qRegions:7,sRegions:8,score:9,category:10,users:11,isManual:12,similarityType:13})}}function mc(t,e,n){const i=t.slice();return i[22]=e[n].uuid,i[23]=e[n].data[0],i[24]=e[n].data[1],i[25]=e[n].data[2],i[26]=e[n].data[3],i[27]=e[n].data[4],i[28]=e[n].data[5],i[29]=e[n].data[6],i[30]=e[n].data[7],i[31]=e[n].data[8],i}function $v(t){let e,n=W==="en"?`Error when retrieving similar regions: ${t[2]}`:`Erreur de recupération des régions similaires: ${t[2]}`,i;return{c(){e=w("div"),i=ne(n),v(e,"class","faded is-center")},m(r,s){j(r,e,s),y(e,i)},p(r,s){s[0]&4&&n!==(n=W==="en"?`Error when retrieving similar regions: ${r[2]}`:`Erreur de recupération des régions similaires: ${r[2]}`)&&_e(i,n)},i:X,o:X,d(r){r&&z(e)}}}function zv(t){let e,n,i=t[4].length+"",r,s,o=t[11](t[10],t[4].length)+"",l,a,c,u=[],d=new Map,f,h=t[4];const m=p=>p[22];for(let p=0;p<h.length;p+=1){let _=mc(t,h,p),S=m(_);d.set(S,u[p]=gc(S,_))}let g=null;return h.length||(g=pc(t)),{c(){e=w("div"),n=w("span"),r=ne(i),s=U(),l=ne(o),a=U(),c=w("div");for(let p=0;p<u.length;p+=1)u[p].c();g&&g.c(),v(n,"class","m-2"),v(c,"class","m-2 is-gap-2"),Se(c,"grid",t[4].length>0)},m(p,_){j(p,e,_),y(e,n),y(n,r),y(n,s),y(n,l),y(e,a),y(e,c);for(let S=0;S<u.length;S+=1)u[S]&&u[S].m(c,null);g&&g.m(c,null),f=!0},p(p,_){(!f||_[0]&16)&&i!==(i=p[4].length+"")&&_e(r,i),(!f||_[0]&16)&&o!==(o=p[11](p[10],p[4].length)+"")&&_e(l,o),_[0]&49&&(h=p[4],ke(),u=_r(u,_,m,1,p,h,d,c,gr,gc,null,mc),Ee(),!h.length&&g?g.p(p,_):h.length?g&&(g.d(1),g=null):(g=pc(p),g.c(),g.m(c,null))),(!f||_[0]&16)&&Se(c,"grid",p[4].length>0)},i(p){if(!f){for(let _=0;_<h.length;_+=1)F(u[_]);f=!0}},o(p){for(let _=0;_<u.length;_+=1)K(u[_]);f=!1},d(p){p&&z(e);for(let _=0;_<u.length;_+=1)u[_].d();g&&g.d()}}}function jv(t){let e;return{c(){e=w("div"),e.textContent=`${W==="en"&&!t[10]?"Retrieving similar regions...":W==="fr"&&!t[10]?"Récupération des régions similaires...":W==="en"&&t[10]?"Retrieving propagated regions...":"Récupération de similarités propagées..."}`,v(e,"class","faded is-center")},m(n,i){j(n,e,i)},p:X,i:X,o:X,d(n){n&&z(e)}}}function pc(t){let e;function n(s,o){return s[5]?Vv:Fv}let i=n(t),r=i(t);return{c(){r.c(),e=qe()},m(s,o){r.m(s,o),j(s,e,o)},p(s,o){i===(i=n(s))&&r?r.p(s,o):(r.d(1),r=i(s),r&&(r.c(),r.m(e.parentNode,e)))},d(s){r.d(s),s&&z(e)}}}function Fv(t){let e;return{c(){e=w("div"),e.textContent=`${W==="en"?"No similar regions":"Pas de régions similaires"}
                    `,v(e,"class","faded is-center")},m(n,i){j(n,e,i)},p:X,d(n){n&&z(e)}}}function Vv(t){let e;return{c(){e=w("div"),e.textContent=`${W==="en"?"No document selected. Select one to display results.":"Aucun document sélectionné. Sélectionnez-en un pour afficher les résultats."}
                    `,v(e,"class","faded is-center")},m(n,i){j(n,e,i)},p:X,d(n){n&&z(e)}}}function gc(t,e){let n,i,r;return i=new Rv({props:{qImg:e[0],sImg:e[25],score:e[23],qRegions:e[26],sRegions:e[27],category:e[28],users:e[29],isManual:e[30],similarityType:e[31]}}),{key:t,first:null,c(){n=qe(),ae(i.$$.fragment),this.first=n},m(s,o){j(s,n,o),oe(i,s,o),r=!0},p(s,o){e=s;const l={};o[0]&1&&(l.qImg=e[0]),o[0]&16&&(l.sImg=e[25]),o[0]&16&&(l.score=e[23]),o[0]&16&&(l.qRegions=e[26]),o[0]&16&&(l.sRegions=e[27]),o[0]&16&&(l.category=e[28]),o[0]&16&&(l.users=e[29]),o[0]&16&&(l.isManual=e[30]),o[0]&16&&(l.similarityType=e[31]),i.$set(l)},i(s){r||(F(i.$$.fragment,s),r=!0)},o(s){K(i.$$.fragment,s),r=!1},d(s){s&&z(n),le(i,s)}}}function Hv(t){let e,n,i,r;const s=[jv,zv,$v],o=[];function l(a,c){return a[1]&&a[3]==="loading"?0:a[3]==="loaded"?1:a[3]==="error"?2:-1}return~(e=l(t))&&(n=o[e]=s[e](t)),{c(){n&&n.c(),i=qe()},m(a,c){~e&&o[e].m(a,c),j(a,i,c),r=!0},p(a,c){let u=e;e=l(a),e===u?~e&&o[e].p(a,c):(n&&(ke(),K(o[u],1,1,()=>{o[u]=null}),Ee()),~e?(n=o[e],n?n.p(a,c):(n=o[e]=s[e](a),n.c()),F(n,1),n.m(i.parentNode,i)):n=null)},i(a){r||(F(n),r=!0)},o(a){K(n),r=!1},d(a){~e&&o[e].d(a),a&&z(i)}}}function Uv(t,e,n){let i,r,s,o,l,a,c,u,{qImg:d}=e,{sImgsPromise:f}=e;const{selectedRegions:h,excludedCategories:m,similarityScoreCutoff:g,propagateFilterByRegions:p}=Qt;de(t,h,M=>n(16,u=M)),de(t,m,M=>n(15,c=M)),de(t,g,M=>n(14,a=M)),de(t,p,M=>n(13,l=M));const _=_t("similarityPropagatedContext")||!1,S=window.location.pathname.match(/\d+/g).join("-");let I;const b=(M,P)=>M===null||P===void 0||Number(M)>=P,E=(M,P,L)=>!L.includes(M),O=(M,P,L,q,R,C)=>_?!0:b(M,R)&&E(P,L,q),x=(M,P,L,q)=>M.filter(({uuid:R,data:[C,D,A,V,B,H,Y,Z,re]})=>O(C,H,Y,P,L)),k=(M,P)=>{const L=P>1;return M?W==="fr"?L?"similarités propagées":"similarité propagée":L?"propagated matches":"propagated match":W==="fr"?L?"images similaires":"image similaire":L?"similar images":"similar image"};return t.$$set=M=>{"qImg"in M&&n(0,d=M.qImg),"sImgsPromise"in M&&n(1,f=M.sImgsPromise)},t.$$.update=()=>{t.$$.dirty[0]&65536&&n(5,i=Object.values(u).length===0||u[S]===void 0||!Object.keys(u[S]).length),t.$$.dirty[0]&2&&(M=>{n(3,r="loading"),n(4,o=[]),n(12,s=[])})(),t.$$.dirty[0]&2&&f.then(M=>{n(12,s=M.map(P=>({uuid:window.crypto.randomUUID(),data:P}))),n(3,r="loaded")}).catch(M=>{n(2,I=M),n(3,r="error")}),t.$$.dirty[0]&61440&&n(4,o=x(s,c,a))},n(3,r="loading"),n(12,s=[]),[d,f,I,r,o,i,h,m,g,p,_,k,s,l,a,c,u]}class _c extends ye{constructor(e){super(),ve(this,e,Uv,Hv,pe,{qImg:0,sImgsPromise:1},null,[-1,-1])}}function Bv(t){let e,n;return e=new _c({props:{qImg:t[0],sImgsPromise:t[1]}}),{c(){ae(e.$$.fragment)},m(i,r){oe(e,i,r),n=!0},p(i,[r]){const s={};r&1&&(s.qImg=i[0]),r&2&&(s.sImgsPromise=i[1]),e.$set(s)},i(i){n||(F(e.$$.fragment,i),n=!0)},o(i){K(e.$$.fragment,i),n=!1},d(i){le(e,i)}}}function qv(t,e,n){let i,r,{qImg:s}=e,o;const l=_t("isInModal")||!1,{selectedRegions:a,comparedRegions:c}=Qt;de(t,a,m=>n(4,i=m)),de(t,c,m=>n(5,r=m));const u=`${window.location.origin}${window.location.pathname}`,d=window.location.pathname.match(/\d+/g).join("-"),f=(m,g)=>g?Object.keys(r).map(p=>r[p].id):Object.values(m[d]||{}).map(p=>p.id);async function h(m,g,p){const _=f(g,p);return _.length===0?[]:await(await fetch(`${u}similar-images`,{method:"POST",body:JSON.stringify({regionsIds:_,qImg:m,topk:12}),headers:{"Content-Type":"application/json","X-CSRFToken":en}})).json()}return l?o=h(s,i,l):a.subscribe(m=>{n(1,o=h(s,m,l))}),t.$$set=m=>{"qImg"in m&&n(0,s=m.qImg)},[s,o,a,c]}class Kv extends ye{constructor(e){super(),ve(this,e,qv,Bv,pe,{qImg:0})}}const qy="";function Wv(t){let e,n,i,r;return i=new _c({props:{qImg:t[0],sImgsPromise:t[1]}}),{c(){e=w("div"),n=w("div"),ae(i.$$.fragment),v(n,"class","matches-suggestion svelte-1cb4wg0"),v(e,"class","block matches-suggestion-wrapper svelte-1cb4wg0")},m(s,o){j(s,e,o),y(e,n),oe(i,n,null),r=!0},p(s,[o]){const l={};o&1&&(l.qImg=s[0]),o&2&&(l.sImgsPromise=s[1]),i.$set(l)},i(s){r||(F(i.$$.fragment,s),r=!0)},o(s){K(i.$$.fragment,s),r=!1},d(s){s&&z(e),le(i)}}}function Gv(t,e,n){let i,r,{qImg:s}=e;const{propagateParams:o,selectedRegions:l}=Qt;de(t,o,p=>n(4,i=p)),de(t,l,p=>n(5,r=p));const a=`${window.location.origin}${window.location.pathname}`,c=window.location.pathname.match(/\d+/g).join("-"),u=_t("isInModal")||!1;let d;const f=Si();f.setCompareFn((p,_)=>[p,_].every(S=>S&&S.hasOwnProperty("propagateRecursionDepth")&&S.hasOwnProperty("propagateFilterByRegions"))?p.propagateRecursionDepth===_.propagateRecursionDepth&&p.propagateFilterByRegions===_.propagateFilterByRegions:!1);const h=Si();h.setCompareFn(kr),wn("similarityPropagatedContext",!0);const m=p=>Object.keys(p).includes(c)?Object.values(p[c]).map(_=>_.id):[],g=async(p,_,S)=>fetch(`${a}propagated-matches/${s}`,{method:"POST",body:JSON.stringify({regionsIds:S?[]:_,filterByRegions:S?!1:p.propagateFilterByRegions,recursionDepth:p.propagateRecursionDepth}),headers:{"Content-Type":"application/json","X-CSRFToken":en}}).then(I=>I.json()).catch(I=>(console.error("PropagatedMatches.getPropagatedMatches:",I),[]));return o.subscribe(p=>{f.set(p),f.same()||n(1,d=g(f.get(),m(r),u))}),l.subscribe(p=>{h.set(m(p)),i.propagateFilterByRegions===!0&&!h.same()&&n(1,d=g(i,h.get(),u))}),t.$$set=p=>{"qImg"in p&&n(0,s=p.qImg)},[s,d,o,l]}class Yv extends ye{constructor(e){super(),ve(this,e,Gv,Wv,pe,{qImg:0})}}const Ky="";function Xv(t){let e,n,i,r=parseInt(t[5])+"",s,o,l,a,c,u,d,f,h,m,g,p,_,S,I,b,E,O,x;return{c(){e=w("a"),n=w("i"),i=ne(`
            Page `),s=ne(r),o=U(),l=w("img"),c=U(),u=w("div"),d=w("div"),f=w("input"),h=U(),m=w("button"),m.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M256 80c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 144L48 224c-17.7 0-32 14.3-32 32s14.3 32 32 32l144 0 0 144c0 17.7 14.3 32 32 32s32-14.3 32-32l0-144 144 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-144 0 0-144z"></path></svg>',g=U(),p=w("button"),_=xt("svg"),S=xt("path"),v(n,"class","fa-solid fa-pen-to-square"),v(e,"class","tag px-2 py-1 mb-2 is-rounded is-hoverable"),v(e,"href",eu(t[6],parseInt(t[5]))),v(e,"target","_blank"),gt(l.src,a=Rt(t[0],t[0].split("_").pop(),"250,"))||v(l,"src",a),v(l,"alt","Query region"),v(l,"class","mb-3 card query-image svelte-f4ylwc"),v(f,"class","input is-small tag"),v(f,"type","text"),v(f,"placeholder",W==="en"?"Add new match":"Ajouter une correspondance"),v(m,"class","button is-small tag is-link is-center"),v(d,"class","tags has-addons"),De(d,"flex-wrap","nowrap"),v(S,"fill","white"),v(S,"d","M376.6 84.5c11.3-13.6 9.5-33.8-4.1-45.1s-33.8-9.5-45.1 4.1L192 206 56.6 43.5C45.3 29.9 25.1 28.1 11.5 39.4S-3.9 70.9 7.4 84.5L150.3 256 7.4 427.5c-11.3 13.6-9.5 33.8 4.1 45.1s33.8 9.5 45.1-4.1L192 306 327.4 468.5c11.3 13.6 31.5 15.4 45.1 4.1s15.4-31.5 4.1-45.1L233.7 256 376.6 84.5z"),v(_,"xmlns","http://www.w3.org/2000/svg"),v(_,"viewBox","0 0 384 512"),v(p,"id","no-match"),v(p,"class",I="button is-small tag is-danger is-center m-0 "+(t[3]===1?"visible":"")+" svelte-f4ylwc"),v(p,"title",W==="en"?"No match for this region in this witness":"Aucune correspondance de cette région pour ce témoin"),v(u,"class","new-similarity control pt-2 is-center svelte-f4ylwc")},m(k,M){j(k,e,M),y(e,n),y(e,i),y(e,s),j(k,o,M),j(k,l,M),j(k,c,M),j(k,u,M),y(u,d),y(d,f),gi(f,t[1]),y(d,h),y(d,m),y(u,g),y(u,p),y(p,_),y(_,S),E=!0,O||(x=[ge(f,"input",t[12]),ge(m,"click",t[8]),ge(p,"click",t[9])],O=!0)},p(k,M){(!E||M&1&&!gt(l.src,a=Rt(k[0],k[0].split("_").pop(),"250,")))&&v(l,"src",a),M&2&&f.value!==k[1]&&gi(f,k[1]),(!E||M&8&&I!==(I="button is-small tag is-danger is-center m-0 "+(k[3]===1?"visible":"")+" svelte-f4ylwc"))&&v(p,"class",I)},i(k){E||(qt(()=>{E&&(b||(b=Zt(p,Mn,{duration:500},!0)),b.run(1))}),E=!0)},o(k){b||(b=Zt(p,Mn,{duration:500},!1)),b.run(0),E=!1},d(k){k&&z(e),k&&z(o),k&&z(l),k&&z(c),k&&z(u),k&&b&&b.end(),O=!1,Ge(x)}}}function Jv(t){let e,n,i,r,s,o,l,a;return n=new Kv({props:{qImg:t[0]}}),o=new Yv({props:{qImg:t[0]}}),{c(){e=w("div"),ae(n.$$.fragment),r=U(),s=w("div"),ae(o.$$.fragment),v(e,"class",i=mi(t[7]?"":t[2])+" svelte-f4ylwc"),v(s,"class",l=mi(t[7]?"":t[2])+" svelte-f4ylwc")},m(c,u){j(c,e,u),oe(n,e,null),j(c,r,u),j(c,s,u),oe(o,s,null),a=!0},p(c,u){const d={};u&1&&(d.qImg=c[0]),n.$set(d),(!a||u&4&&i!==(i=mi(c[7]?"":c[2])+" svelte-f4ylwc"))&&v(e,"class",i);const f={};u&1&&(f.qImg=c[0]),o.$set(f),(!a||u&4&&l!==(l=mi(c[7]?"":c[2])+" svelte-f4ylwc"))&&v(s,"class",l)},i(c){a||(F(n.$$.fragment,c),F(o.$$.fragment,c),a=!0)},o(c){K(n.$$.fragment,c),K(o.$$.fragment,c),a=!1},d(c){c&&z(e),le(n),c&&z(r),c&&z(s),le(o)}}}function Qv(t){let e,n;return e=new ra({props:{useGrid:!1,$$slots:{"row-body":[Jv],"row-header":[Xv]},$$scope:{ctx:t}}}),{c(){ae(e.$$.fragment)},m(i,r){oe(e,i,r),n=!0},p(i,[r]){const s={};r&1048591&&(s.$$scope={dirty:r,ctx:i}),e.$set(s)},i(i){n||(F(e.$$.fragment,i),n=!0)},o(i){K(e.$$.fragment,i),n=!1},d(i){le(e,i)}}}function Zv(t){return t=t.replace(".jpg",""),/^wit\d+_[a-zA-Z]{3}\d+_\d+_\d+,\d+,\d+,\d+$/.test(t)}function ey(t,e,n){let i,r,s,o;const{selectedRegions:l}=Qt;de(t,l,O=>n(11,o=O));let{qImg:a}=e,c="";const[u,d,f,h]=a.split(".")[0].split("_"),m=`${window.location.origin}${window.location.pathname}`,g=window.location.pathname.match(/\d+/g).join("-"),p=W==="en"?"Error":"Erreur",_=_t("manifest"),S=_t("isInModal")||!1;wn("qImgMetadata",dc(a,u,h,f));async function I(){if(!c||!Zv(c)){await ut(W==="en"?"Please insert a valid region reference to add a new match":"Veuillez insérer une référence de région valide pour ajouter une nouvelle correspondance","Error");return}try{const O=await fetch(`${m}add-region-pair`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":en},body:JSON.stringify({q_img:a.replace(".jpg",""),s_img:c,similarity_type:2})});O.ok||(console.error("Error: Network response was not ok"),await ut(W==="en"?"Problem with network, match was not added":"Problème de réseau, la correspondance n'a pas été ajoutée",p));const x=await O.json();if(x.hasOwnProperty("error")||!x.hasOwnProperty("s_regions")){await ut(W==="en"?`Request was unsuccessful, match was not added:<br>${x.error}`:`La requête n'a pas abouti, la correspondance n'a pas été ajoutée :<br>${x.error}`,p);return}const k=x.s_regions;Qt.addComparedRegions(k),Qt.select(k)}catch(O){console.error("Error:",O),await ut(W==="en"?`An error has occurred, match was not added:<br>${O}`:`Une erreur s'est produite, la correspondance n'a pas été ajoutée :<br>${O}`,p)}}async function b(){const O=Object.values(o[g])[0];if(await ut(W==="en"?`Do you confirm this region does not have any match in ${O.title}?`:`Confirmez-vous que cette région n'a pas de correspondance dans ${O.title} ?`,W==="en"?"Confirm no match":"Confirmer l'absence de correspondance",!0))try{(await fetch(`${m}no-match`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":en},body:JSON.stringify({q_img:a,s_regions:O.id})})).ok||(console.error("Error: Network response was not ok"),await ut(W==="en"?"Problem with network":"Problème de réseau",p)),Qt.select(O)}catch(k){console.error("Error:",k),await ut(W==="en"?`An error has occurred, request was unsuccessful:<br>${k}`:`Une erreur s'est produite, la requête n'a pas abouti :<br>${k}`,p)}}function E(){c=this.value,n(1,c)}return t.$$set=O=>{"qImg"in O&&n(0,a=O.qImg)},t.$$.update=()=>{t.$$.dirty&2048&&n(3,i=o.hasOwnProperty(g)?Object.values(o[g]).length:0),t.$$.dirty&1024&&n(2,s=`fixed-grid has-${r-1}-cols`)},n(10,r=Fs(window.innerWidth)),[a,c,s,i,l,f,_,S,I,b,r,o,E]}class ty extends ye{constructor(e){super(),ve(this,e,ey,Qv,pe,{qImg:0})}}function ny(t){let e,n,i,r,s,o;return s=new ty({props:{qImg:t[0].img}}),{c(){e=w("div"),n=w("a"),i=w("button"),i.textContent=`${W==="fr"?"Voir toutes les similarités pour ce document":"View all similarities for this document"}`,r=U(),ae(s.$$.fragment),v(i,"class","button is-link is-small"),v(n,"href",t[1]()),v(e,"class","is-flex is-align-items-center is-justify-content-end")},m(l,a){j(l,e,a),y(e,n),y(n,i),j(l,r,a),oe(s,l,a),o=!0},p(l,[a]){const c={};a&1&&(c.qImg=l[0].img),s.$set(c)},i(l){o||(F(s.$$.fragment,l),o=!0)},o(l){K(s.$$.fragment,l),o=!1},d(l){l&&z(e),l&&z(r),le(s,l)}}}function iy(t,e,n){let{mainImgItem:i}=e;function r(){const s=i.img.match(/wit(\d+)/)[1],o=new URL(window.location.origin);return o.pathname=`${new URL(window.location).pathname.split("/")[1]}/witness/${s}/regions/`,o.searchParams.set("tab","similarity"),o.href}return t.$$set=s=>{"mainImgItem"in s&&n(0,i=s.mainImgItem)},[i,r]}class ry extends ye{constructor(e){super(),ve(this,e,iy,ny,pe,{mainImgItem:0})}}const sy=Object.freeze(Object.defineProperty({__proto__:null,default:ry},Symbol.toStringTag,{value:"Module"}))})();
//# sourceMappingURL=documentSet.js.map
