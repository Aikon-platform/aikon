(function(){"use strict";function ie(){}const Ms=t=>t;function As(t,e){for(const n in e)t[n]=e[n];return t}function Kc(t){return!!t&&(typeof t=="object"||typeof t=="function")&&typeof t.then=="function"}function Ts(t){return t()}function Ns(){return Object.create(null)}function yt(t){t.forEach(Ts)}function Pn(t){return typeof t=="function"}function Re(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}let Si;function At(t,e){return Si||(Si=document.createElement("a")),Si.href=e,t===Si.href}function Wc(t){return Object.keys(t).length===0}function ki(t,...e){if(t==null)return ie;const n=t.subscribe(...e);return n.unsubscribe?()=>n.unsubscribe():n}function vt(t){let e;return ki(t,n=>e=n)(),e}function Ce(t,e,n){t.$$.on_destroy.push(ki(e,n))}function Vt(t,e,n,i){if(t){const r=Ps(t,e,n,i);return t[0](r)}}function Ps(t,e,n,i){return t[1]&&i?As(n.ctx.slice(),t[1](i(e))):n.ctx}function Ut(t,e,n,i){if(t[2]&&i){const r=t[2](i(n));if(e.dirty===void 0)return r;if(typeof r=="object"){const s=[],o=Math.max(e.dirty.length,r.length);for(let l=0;l<o;l+=1)s[l]=e.dirty[l]|r[l];return s}return e.dirty|r}return e.dirty}function Bt(t,e,n,i,r,s){if(r){const o=Ps(e,n,i,s);t.p(o,r)}}function qt(t){if(t.ctx.length>32){const e=[],n=t.ctx.length/32;for(let i=0;i<n;i++)e[i]=-1;return e}return-1}function Yc(t){const e={};for(const n in t)e[n]=!0;return e}function Ei(t){return t??""}function ei(t){return t&&Pn(t.destroy)?t.destroy:ie}const Os=typeof window<"u";let Xc=Os?()=>window.performance.now():()=>Date.now(),yr=Os?t=>requestAnimationFrame(t):ie;const On=new Set;function Ls(t){On.forEach(e=>{e.c(t)||(On.delete(e),e.f())}),On.size!==0&&yr(Ls)}function Gc(t){let e;return On.size===0&&yr(Ls),{promise:new Promise(n=>{On.add(e={c:t,f:n})}),abort(){On.delete(e)}}}const Jc=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function v(t,e){t.appendChild(e)}function Ds(t){if(!t)return document;const e=t.getRootNode?t.getRootNode():t.ownerDocument;return e&&e.host?e:t.ownerDocument}function Qc(t){const e=b("style");return Zc(Ds(t),e),e.sheet}function Zc(t,e){return v(t.head||t,e),e.sheet}function z(t,e,n){t.insertBefore(e,n||null)}function R(t){t.parentNode&&t.parentNode.removeChild(t)}function wt(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function b(t){return document.createElement(t)}function Wt(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function re(t){return document.createTextNode(t)}function j(){return re(" ")}function Ct(){return re("")}function Ie(t,e,n,i){return t.addEventListener(e,n,i),()=>t.removeEventListener(e,n,i)}function sn(t){return function(e){return e.preventDefault(),t.call(this,e)}}function y(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function eu(t){return Array.from(t.childNodes)}function Ne(t,e){e=""+e,t.data!==e&&(t.data=e)}function Ci(t,e){t.value=e??""}function We(t,e,n,i){n==null?t.style.removeProperty(e):t.style.setProperty(e,n,i?"important":"")}function pn(t,e,n){for(let i=0;i<t.options.length;i+=1){const r=t.options[i];if(r.__value===e){r.selected=!0;return}}(!n||e!==void 0)&&(t.selectedIndex=-1)}function Ii(t){const e=t.querySelector(":checked");return e&&e.__value}function Ye(t,e,n){t.classList[n?"add":"remove"](e)}function Rs(t,e,{bubbles:n=!1,cancelable:i=!1}={}){const r=document.createEvent("CustomEvent");return r.initCustomEvent(t,n,i,e),r}function xi(t,e){return new t(e)}const Mi=new Map;let Ai=0;function tu(t){let e=5381,n=t.length;for(;n--;)e=(e<<5)-e^t.charCodeAt(n);return e>>>0}function nu(t,e){const n={stylesheet:Qc(e),rules:{}};return Mi.set(t,n),n}function $s(t,e,n,i,r,s,o,l=0){const a=16.666/i;let c=`{
`;for(let g=0;g<=1;g+=a){const _=e+(n-e)*s(g);c+=g*100+`%{${o(_,1-_)}}
`}const u=c+`100% {${o(n,1-n)}}
}`,h=`__svelte_${tu(u)}_${l}`,f=Ds(t),{stylesheet:d,rules:m}=Mi.get(f)||nu(f,t);m[h]||(m[h]=!0,d.insertRule(`@keyframes ${h} ${u}`,d.cssRules.length));const p=t.style.animation||"";return t.style.animation=`${p?`${p}, `:""}${h} ${i}ms linear ${r}ms 1 both`,Ai+=1,h}function iu(t,e){const n=(t.style.animation||"").split(", "),i=n.filter(e?s=>s.indexOf(e)<0:s=>s.indexOf("__svelte")===-1),r=n.length-i.length;r&&(t.style.animation=i.join(", "),Ai-=r,Ai||ru())}function ru(){yr(()=>{Ai||(Mi.forEach(t=>{const{ownerNode:e}=t.stylesheet;e&&R(e)}),Mi.clear())})}let ti;function on(t){ti=t}function Ln(){if(!ti)throw new Error("Function called outside component initialization");return ti}function Dn(t){Ln().$$.on_mount.push(t)}function Rn(t){Ln().$$.on_destroy.push(t)}function Ti(){const t=Ln();return(e,n,{cancelable:i=!1}={})=>{const r=t.$$.callbacks[e];if(r){const s=Rs(e,n,{cancelable:i});return r.slice().forEach(o=>{o.call(t,s)}),!s.defaultPrevented}return!0}}function $n(t,e){return Ln().$$.context.set(t,e),e}function zt(t){return Ln().$$.context.get(t)}const zn=[],gn=[];let jn=[];const zs=[],su=Promise.resolve();let br=!1;function ou(){br||(br=!0,su.then(Sr))}function jt(t){jn.push(t)}const wr=new Set;let Fn=0;function Sr(){if(Fn!==0)return;const t=ti;do{try{for(;Fn<zn.length;){const e=zn[Fn];Fn++,on(e),lu(e.$$)}}catch(e){throw zn.length=0,Fn=0,e}for(on(null),zn.length=0,Fn=0;gn.length;)gn.pop()();for(let e=0;e<jn.length;e+=1){const n=jn[e];wr.has(n)||(wr.add(n),n())}jn.length=0}while(zn.length);for(;zs.length;)zs.pop()();br=!1,wr.clear(),on(t)}function lu(t){if(t.fragment!==null){t.update(),yt(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(jt)}}function au(t){const e=[],n=[];jn.forEach(i=>t.indexOf(i)===-1?e.push(i):n.push(i)),n.forEach(i=>i()),jn=e}let ni;function cu(){return ni||(ni=Promise.resolve(),ni.then(()=>{ni=null})),ni}function kr(t,e,n){t.dispatchEvent(Rs(`${e?"intro":"outro"}${n}`))}const Ni=new Set;let ln;function tt(){ln={r:0,c:[],p:ln}}function nt(){ln.r||yt(ln.c),ln=ln.p}function V(t,e){t&&t.i&&(Ni.delete(t),t.i(e))}function K(t,e,n,i){if(t&&t.o){if(Ni.has(t))return;Ni.add(t),ln.c.push(()=>{Ni.delete(t),i&&(n&&t.d(1),i())}),t.o(e)}else i&&i()}const uu={duration:0};function _n(t,e,n,i){const r={direction:"both"};let s=e(t,n,r),o=i?0:1,l=null,a=null,c=null;function u(){c&&iu(t,c)}function h(d,m){const p=d.b-o;return m*=Math.abs(p),{a:o,b:d.b,d:p,duration:m,start:d.start,end:d.start+m,group:d.group}}function f(d){const{delay:m=0,duration:p=300,easing:g=Ms,tick:_=ie,css:S}=s||uu,C={start:Xc()+m,b:d};d||(C.group=ln,ln.r+=1),l||a?a=C:(S&&(u(),c=$s(t,o,d,p,m,g,S)),d&&_(0,1),l=h(C,p),jt(()=>kr(t,d,"start")),Gc(w=>{if(a&&w>a.start&&(l=h(a,p),a=null,kr(t,l.b,"start"),S&&(u(),c=$s(t,o,l.b,l.duration,0,g,s.css))),l){if(w>=l.end)_(o=l.b,1-o),kr(t,l.b,"end"),a||(l.b?u():--l.group.r||yt(l.group.c)),l=null;else if(w>=l.start){const k=w-l.start;o=l.a+l.d*g(k/l.duration),_(o,1-o)}}return!!(l||a)}))}return{run(d){Pn(s)?cu().then(()=>{s=s(r),f(d)}):f(d)},end(){u(),l=a=null}}}function Er(t,e){const n=e.token={};function i(r,s,o,l){if(e.token!==n)return;e.resolved=l;let a=e.ctx;o!==void 0&&(a=a.slice(),a[o]=l);const c=r&&(e.current=r)(a);let u=!1;e.block&&(e.blocks?e.blocks.forEach((h,f)=>{f!==s&&h&&(tt(),K(h,1,1,()=>{e.blocks[f]===h&&(e.blocks[f]=null)}),nt())}):e.block.d(1),c.c(),V(c,1),c.m(e.mount(),e.anchor),u=!0),e.block=c,e.blocks&&(e.blocks[s]=c),u&&Sr()}if(Kc(t)){const r=Ln();if(t.then(s=>{on(r),i(e.then,1,e.value,s),on(null)},s=>{if(on(r),i(e.catch,2,e.error,s),on(null),!e.hasCatch)throw s}),e.current!==e.pending)return i(e.pending,0),!0}else{if(e.current!==e.then)return i(e.then,1,e.value,t),!0;e.resolved=t}}function js(t,e,n){const i=e.slice(),{resolved:r}=t;t.current===t.then&&(i[t.value]=r),t.current===t.catch&&(i[t.error]=r),t.block.p(i,n)}function fu(t,e){t.d(1),e.delete(t.key)}function Cr(t,e){K(t,1,1,()=>{e.delete(t.key)})}function Pi(t,e,n,i,r,s,o,l,a,c,u,h){let f=t.length,d=s.length,m=f;const p={};for(;m--;)p[t[m].key]=m;const g=[],_=new Map,S=new Map,C=[];for(m=d;m--;){const T=h(r,s,m),E=n(T);let x=o.get(E);x?i&&C.push(()=>x.p(T,e)):(x=c(E,T),x.c()),_.set(E,g[m]=x),E in p&&S.set(E,Math.abs(m-p[E]))}const w=new Set,k=new Set;function N(T){V(T,1),T.m(l,u),o.set(T.key,T),u=T.first,d--}for(;f&&d;){const T=g[d-1],E=t[f-1],x=T.key,O=E.key;T===E?(u=T.first,f--,d--):_.has(O)?!o.has(x)||w.has(x)?N(T):k.has(O)?f--:S.get(x)>S.get(O)?(k.add(x),N(T)):(w.add(O),f--):(a(E,o),f--)}for(;f--;){const T=t[f];_.has(T.key)||a(T,o)}for(;d;)N(g[d-1]);return yt(C),g}function du(t,e){const n={},i={},r={$$scope:1};let s=t.length;for(;s--;){const o=t[s],l=e[s];if(l){for(const a in o)a in l||(i[a]=1);for(const a in l)r[a]||(n[a]=l[a],r[a]=1);t[s]=l}else for(const a in o)r[a]=1}for(const o in i)o in n||(n[o]=void 0);return n}function hu(t){return typeof t=="object"&&t!==null?t:{}}function ve(t){t&&t.c()}function he(t,e,n,i){const{fragment:r,after_update:s}=t.$$;r&&r.m(e,n),i||jt(()=>{const o=t.$$.on_mount.map(Ts).filter(Pn);t.$$.on_destroy?t.$$.on_destroy.push(...o):yt(o),t.$$.on_mount=[]}),s.forEach(jt)}function me(t,e){const n=t.$$;n.fragment!==null&&(au(n.after_update),yt(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function mu(t,e){t.$$.dirty[0]===-1&&(zn.push(t),ou(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function Fe(t,e,n,i,r,s,o,l=[-1]){const a=ti;on(t);const c=t.$$={fragment:null,ctx:[],props:s,update:ie,not_equal:r,bound:Ns(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(a?a.$$.context:[])),callbacks:Ns(),dirty:l,skip_bound:!1,root:e.target||a.$$.root};o&&o(c.root);let u=!1;if(c.ctx=n?n(t,e.props||{},(h,f,...d)=>{const m=d.length?d[0]:f;return c.ctx&&r(c.ctx[h],c.ctx[h]=m)&&(!c.skip_bound&&c.bound[h]&&c.bound[h](m),u&&mu(t,h)),f}):[],c.update(),u=!0,yt(c.before_update),c.fragment=i?i(c.ctx):!1,e.target){if(e.hydrate){const h=eu(e.target);c.fragment&&c.fragment.l(h),h.forEach(R)}else c.fragment&&c.fragment.c();e.intro&&V(t.$$.fragment),he(t,e.target,e.anchor,e.customElement),Sr()}on(a)}class He{$destroy(){me(this,1),this.$destroy=ie}$on(e,n){if(!Pn(n))return ie;const i=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return i.push(n),()=>{const r=i.indexOf(n);r!==-1&&i.splice(r,1)}}$set(e){this.$$set&&!Wc(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const Hn=[];function pu(t,e){return{subscribe:Pe(t,e).subscribe}}function Pe(t,e=ie){let n;const i=new Set;function r(l){if(Re(t,l)&&(t=l,n)){const a=!Hn.length;for(const c of i)c[1](),Hn.push(c,t);if(a){for(let c=0;c<Hn.length;c+=2)Hn[c][0](Hn[c+1]);Hn.length=0}}}function s(l){r(l(t))}function o(l,a=ie){const c=[l,a];return i.add(c),i.size===1&&(n=e(r)||ie),l(t),()=>{i.delete(c),i.size===0&&n&&(n(),n=null)}}return{set:r,update:s,subscribe:o}}function dt(t,e,n){const i=!Array.isArray(t),r=i?[t]:t,s=e.length<2;return pu(n,o=>{let l=!1;const a=[];let c=0,u=ie;const h=()=>{if(c)return;u();const d=e(i?a[0]:a,o);s?o(d):u=Pn(d)?d:ie},f=r.map((d,m)=>ki(d,p=>{a[m]=p,c&=~(1<<m),l&&h()},()=>{c|=1<<m}));return l=!0,h(),function(){yt(f),u(),l=!1}})}const B=APP_LANG,Yt=APP_NAME;WEBAPP_NAME;const Ir=USER_ID,xr=IS_SUPERUSER;ADD_PERMISSION;const vn=CSRF_TOKEN;ADDITIONAL_MODULES;const gu="Region",Fs=APP_URL,_u=SAS_APP_URL;CANTALOUPE_APP_URL,MEDIA_PATH;const vu=PAGE_LEN,Oi={Witness:B==="en"?"Witness":"Témoin",Work:B==="en"?"Work":"Œuvre",Series:B==="en"?"Series":"Série d'imprimés",Regions:B==="en"?"Region Extraction":"Extraction d'illustrations"},ii=Pe(!1),yu=Pe(""),bu=t=>typeof t=="string"||t instanceof String;async function Hs(t){ii.set(!0);try{return await t()}finally{ii.set(!1)}}function Mr(t){return t.match(/\d+/g).toString()}function wu(t){return parseInt(Mr(t),10)}function Su(t,e=100){const n=Math.floor(e*.75);return t.length>e?t.slice(0,n)+"..."+t.slice(-e+n):t}function ku(){return"https://vhs.huma-num.fr"}function Eu(){return _u??"http://localhost:8888"}function Ar(t,e){if(typeof window<"u"){const n=parseInt(new URLSearchParams(window.location.search).get(e));if(!isNaN(n))return t.set(n),n}return t.set(1),1}function Tr(t,e,n){if(e.set(t),typeof window<"u"){const i=new URL(window.location.href);i.searchParams.set(n,t),window.history.pushState({},"",i)}}function Cu(t=null){return t=t.split("_"),t.length<3?void 0:`${t.slice(0,3).join("_").replace(".jpg","")}.jpg`}function Vs(t=null){const e=Cu(t);return e===void 0?void 0:`${ku()}/iiif/2/${e}`}function Kt(t=null,e=null,n="full"){if(e=bu(e)?e.replace(".jpg",""):e,!t)return"https://placehold.co/96x96/png?text=No+image";const i=Vs(t);if(i===void 0)return"https://placehold.co/96x96/png?text=No+image";const r=t.split("_");return e||(e=r[r.length-1].includes(",")?r.pop().replace(".jpg",""):"full"),`${i}/${e}/${n}/0/default.jpg`}function Iu(t=null){return`${Vs(t)}/info.json`}function xu(t=null,e=1){return`${Eu()}/index.html?iiif-content=${t}&canvas=${e}`}function Tt(t,e=null,n=!1){return new Promise(i=>{if(document.getElementById("msg-modal")){n?document.getElementById("modal-footer").hidden=!1:i(void 0),e&&(document.getElementById("modal-title").innerHTML=e),document.getElementById("modal-msg").innerHTML=t,document.getElementById("hidden-msg-btn").click();const s=document.getElementById("cancel-btn"),o=document.getElementById("ok-btn"),l=document.getElementById("modal-bkg"),a=()=>{s.removeEventListener("click",c),l.removeEventListener("click",c),o.removeEventListener("click",u),document.getElementById("modal-footer").hidden=!0},c=()=>{a(),i(!1)},u=()=>{a(),i(!0)};s.addEventListener("click",c),o.addEventListener("click",u)}else n?i(window.confirm(t)):(window.alert(t),i(void 0))})}function Li(){let t,e,n=(i,r)=>i===r;return{set:i=>{e=t,t=i},setCompareFn:i=>n=i,get:()=>t,getNewAndOld:()=>[t,e],same:()=>n(t,e)}}const Nr=(t,e)=>Array.isArray(t)&&Array.isArray(e)&&t.length===e.length&&t.every((n,i)=>n===e[i]||void 0);function Mu(t){const n=[85,70,60],i=[50,65,40],r=t*137.5%360,s=n[t%n.length],o=i[Math.floor(t/n.length)%i.length];return`hsl(${Math.floor(r)}, ${s}%, ${o}%)`}function Us(t=null){return t<600?1:t<800?2:t<1e3?3:t<1200?4:t<1400?5:t>=1400?6:4}function Pr(t){const e=t.querySelectorAll(".modal-background, .modal-close, .modal-card-head .delete, .modal-card-foot .button-close"),n=()=>t.classList.remove("is-active");e.forEach(r=>r.addEventListener("click",n));const i=r=>{r.key==="Escape"&&t.classList.contains("is-active")&&n()};return document.addEventListener("keydown",i),{destroy(){e.forEach(r=>r.removeEventListener("click",n)),document.removeEventListener("keydown",i)}}}function Bs(t){const e=()=>{const n=document.getElementById(t.dataset.target);n==null||n.classList.add("is-active")};return t.addEventListener("click",e),{destroy(){t.removeEventListener("click",e)}}}function Vn(t,e,n="string",i=null){const r={string:o=>{const l=o.get(e);return l!==null?l:null},array:o=>{const l=o.get(e);return l?l.split(",").map(Number).filter(a=>!isNaN(a)):null},set:o=>{const l=o.get(e);return l?new Set(l.split(",").map(Number).filter(a=>!isNaN(a))):null},number:o=>{const l=o.get(e);return l!==null?Number(l):null},boolean:o=>{const l=o.get(e);return l!==null?l==="true":null}},s={string:(o,l)=>l?o.searchParams.set(e,l):o.searchParams.delete(e),array:(o,l)=>{l!=null&&l.length?o.searchParams.set(e,l.join(",")):o.searchParams.delete(e)},set:(o,l)=>{l!=null&&l.size?o.searchParams.set(e,Array.from(l).join(",")):o.searchParams.delete(e)},number:(o,l)=>{l!=null?o.searchParams.set(e,String(l)):o.searchParams.delete(e)},boolean:(o,l)=>l?o.searchParams.set(e,"true"):o.searchParams.delete(e)};if(typeof window<"u"){const o=new URLSearchParams(window.location.search),l=r[n](o);if(l!==null)t.set(l);else if(i!==null){const a=typeof i=="function"?i():i;t.set(a)}return a=>{const c=new URL(window.location);s[n](c,a),window.history.pushState({},"",c)}}return()=>{}}function Au(t){const e=t-1;return e*e*e+1}function Un(t,{delay:e=0,duration:n=400,easing:i=Ms}={}){const r=+getComputedStyle(t).opacity;return{delay:e,duration:n,easing:i,css:s=>`opacity: ${s*r}`}}function qs(t,{delay:e=0,duration:n=400,easing:i=Au,axis:r="y"}={}){const s=getComputedStyle(t),o=+s.opacity,l=r==="y"?"height":"width",a=parseFloat(s[l]),c=r==="y"?["top","bottom"]:["left","right"],u=c.map(_=>`${_[0].toUpperCase()}${_.slice(1)}`),h=parseFloat(s[`padding${u[0]}`]),f=parseFloat(s[`padding${u[1]}`]),d=parseFloat(s[`margin${u[0]}`]),m=parseFloat(s[`margin${u[1]}`]),p=parseFloat(s[`border${u[0]}Width`]),g=parseFloat(s[`border${u[1]}Width`]);return{delay:e,duration:n,easing:i,css:_=>`overflow: hidden;opacity: ${Math.min(_*20,1)*o};${l}: ${_*a}px;padding-${c[0]}: ${_*h}px;padding-${c[1]}: ${_*f}px;margin-${c[0]}: ${_*d}px;margin-${c[1]}: ${_*m}px;border-${c[0]}-width: ${_*p}px;border-${c[1]}-width: ${_*g}px;`}}const Fy="";function Ks(t){let e,n,i;return{c(){e=b("div"),e.innerHTML='<div class="loader svelte-vizlcg"></div>',y(e,"class","bkg-shade svelte-vizlcg")},m(r,s){z(r,e,s),i=!0},i(r){i||(jt(()=>{i&&(n||(n=_n(e,Un,{duration:150},!0)),n.run(1))}),i=!0)},o(r){n||(n=_n(e,Un,{duration:150},!1)),n.run(0),i=!1},d(r){r&&R(e),r&&n&&n.end()}}}function Tu(t){let e,n,i=t[0]&&Ks();return{c(){i&&i.c(),e=Ct()},m(r,s){i&&i.m(r,s),z(r,e,s),n=!0},p(r,[s]){r[0]?i?s&1&&V(i,1):(i=Ks(),i.c(),V(i,1),i.m(e.parentNode,e)):i&&(tt(),K(i,1,1,()=>{i=null}),nt())},i(r){n||(V(i),n=!0)},o(r){K(i),n=!1},d(r){i&&i.d(r),r&&R(e)}}}function Nu(t,e,n){let i;return Ce(t,ii,r=>n(0,i=r)),[i]}class Pu extends He{constructor(e){super(),Fe(this,e,Nu,Tu,Re,{})}}const Ou=t=>({}),Ws=t=>({});function Lu(t){let e,n,i,r,s,o,l,a,c,u,h,f,d,m,p,g,_,S,C,w,k;const N=t[1].content,T=Vt(N,t,t[0],Ws);return{c(){e=b("button"),n=j(),i=b("div"),r=b("div"),s=j(),o=b("div"),l=b("div"),l.innerHTML=`<div class="title is-4 mb-0 media-content"><span id="modal-title" class="mb-0"></span></div>
            <button class="delete media-left" aria-label="close"></button>`,a=j(),c=b("section"),u=b("div"),h=j(),f=b("div"),T&&T.c(),d=j(),m=b("footer"),p=b("div"),g=b("button"),g.textContent=`${B==="en"?"Abort":"Retour"}`,_=j(),S=b("button"),S.textContent="OK",y(e,"id","hidden-msg-btn"),y(e,"data-target","msg-modal"),e.hidden=!0,y(r,"id","modal-bkg"),y(r,"class","modal-background"),y(l,"class","modal-card-head media mb-0"),y(u,"id","modal-msg"),y(f,"class","py-3"),y(c,"id","modal-body"),y(c,"class","modal-card-body"),y(g,"id","cancel-btn"),y(g,"class","button is-link is-light button-close"),y(S,"id","ok-btn"),y(S,"class","button is-link button-close"),y(p,"class","buttons"),y(m,"id","modal-footer"),y(m,"class","modal-card-foot is-center pt-3"),m.hidden=!0,y(o,"class","modal-content"),y(i,"id","msg-modal"),y(i,"class","modal fade"),y(i,"tabindex","-1"),y(i,"aria-labelledby","selection-modal-label"),y(i,"aria-hidden","true")},m(E,x){z(E,e,x),z(E,n,x),z(E,i,x),v(i,r),v(i,s),v(i,o),v(o,l),v(o,a),v(o,c),v(c,u),v(c,h),v(c,f),T&&T.m(f,null),v(o,d),v(o,m),v(m,p),v(p,g),v(p,_),v(p,S),C=!0,w||(k=[ei(Bs.call(null,e)),ei(Pr.call(null,i))],w=!0)},p(E,[x]){T&&T.p&&(!C||x&1)&&Bt(T,N,E,E[0],C?Ut(N,E[0],x,Ou):qt(E[0]),Ws)},i(E){C||(V(T,E),C=!0)},o(E){K(T,E),C=!1},d(E){E&&R(e),E&&R(n),E&&R(i),T&&T.d(E),w=!1,yt(k)}}}function Du(t,e,n){let{$$slots:i={},$$scope:r}=e;return t.$$set=s=>{"$$scope"in s&&n(0,r=s.$$scope)},[r,i]}class Ru extends He{constructor(e){super(),Fe(this,e,Du,Lu,Re,{})}}const Hy="",$u=t=>({activeTab:t&8}),Ys=t=>({activeTab:t[3]});function Xs(t,e,n){const i=t.slice();return i[11]=e[n][0],i[12]=e[n][1],i}const zu=t=>({activeTab:t&8}),Gs=t=>({activeTab:t[3]}),ju=t=>({}),Js=t=>({});function Fu(t){let e,n,i=Object.entries(t[2]),r=[];for(let s=0;s<i.length;s+=1)r[s]=Qs(Xs(t,i,s));return{c(){e=b("div"),n=b("ul");for(let s=0;s<r.length;s+=1)r[s].c();y(e,"class","tabs")},m(s,o){z(s,e,o),v(e,n);for(let l=0;l<r.length;l+=1)r[l]&&r[l].m(n,null)},p(s,o){if(o&28){i=Object.entries(s[2]);let l;for(l=0;l<i.length;l+=1){const a=Xs(s,i,l);r[l]?r[l].p(a,o):(r[l]=Qs(a),r[l].c(),r[l].m(n,null))}for(;l<r.length;l+=1)r[l].d(1);r.length=i.length}},i:ie,o:ie,d(s){s&&R(e),wt(r,s)}}}function Hu(t){let e;const n=t[8].tabs,i=Vt(n,t,t[7],Gs);return{c(){i&&i.c()},m(r,s){i&&i.m(r,s),e=!0},p(r,s){i&&i.p&&(!e||s&136)&&Bt(i,n,r,r[7],e?Ut(n,r[7],s,zu):qt(r[7]),Gs)},i(r){e||(V(i,r),e=!0)},o(r){K(i,r),e=!1},d(r){i&&i.d(r)}}}function Qs(t){let e,n,i=t[12]+"",r,s,o,l;function a(){return t[9](t[11])}return{c(){e=b("li"),n=b("a"),r=re(i),s=j(),y(n,"href",null),Ye(e,"is-active",t[3]===t[11])},m(c,u){z(c,e,u),v(e,n),v(n,r),v(e,s),o||(l=Ie(n,"click",a),o=!0)},p(c,u){t=c,u&4&&i!==(i=t[12]+"")&&Ne(r,i),u&12&&Ye(e,"is-active",t[3]===t[11])},d(c){c&&R(e),o=!1,l()}}}function Vu(t){let e,n,i,r,s,o,l,a,c,u,h,f,d;e=new Pu({});const m=t[8].sidebar,p=Vt(m,t,t[7],Js),g=[Hu,Fu],_=[];function S(k,N){return N&4&&(a=null),k[5].tabs?0:(a==null&&(a=!!Object.keys(k[2]).length),a?1:-1)}~(c=S(t,-1))&&(u=_[c]=g[c](t));const C=t[8].content,w=Vt(C,t,t[7],Ys);return{c(){ve(e.$$.fragment),n=j(),i=b("div"),r=b("aside"),p&&p.c(),s=j(),o=b("main"),l=b("nav"),u&&u.c(),h=j(),f=b("div"),w&&w.c(),y(r,"class","sidebar svelte-jexg"),We(r,"width",t[0]+"%"),We(r,"min-height",t[1]),y(l,"id","tabs"),y(l,"class","tabs-bar svelte-jexg"),y(f,"class","content-area pl-5 svelte-jexg"),y(o,"class","main-content svelte-jexg"),We(o,"width",100-t[0]+"%"),We(o,"min-height",t[1]),y(i,"class","layout svelte-jexg"),We(i,"min-height",t[1])},m(k,N){he(e,k,N),z(k,n,N),z(k,i,N),v(i,r),p&&p.m(r,null),v(i,s),v(i,o),v(o,l),~c&&_[c].m(l,null),v(o,h),v(o,f),w&&w.m(f,null),d=!0},p(k,[N]){p&&p.p&&(!d||N&128)&&Bt(p,m,k,k[7],d?Ut(m,k[7],N,ju):qt(k[7]),Js),(!d||N&1)&&We(r,"width",k[0]+"%");let T=c;c=S(k,N),c===T?~c&&_[c].p(k,N):(u&&(tt(),K(_[T],1,1,()=>{_[T]=null}),nt()),~c?(u=_[c],u?u.p(k,N):(u=_[c]=g[c](k),u.c()),V(u,1),u.m(l,null)):u=null),w&&w.p&&(!d||N&136)&&Bt(w,C,k,k[7],d?Ut(C,k[7],N,$u):qt(k[7]),Ys),(!d||N&1)&&We(o,"width",100-k[0]+"%")},i(k){d||(V(e.$$.fragment,k),V(p,k),V(u),V(w,k),d=!0)},o(k){K(e.$$.fragment,k),K(p,k),K(u),K(w,k),d=!1},d(k){me(e,k),k&&R(n),k&&R(i),p&&p.d(k),~c&&_[c].d(),w&&w.d(k)}}}function Uu(t=null){t||(t=document.getElementById("navbar")),document.documentElement.style.setProperty("--top-offset",`${t.offsetHeight}px`)}function Bu(t,e,n){let i,{$$slots:r={},$$scope:s}=e;const o=Yc(r);let{sidebarWidth:l="25"}=e;const a="90vh";let{tabList:c={}}=e,u=Object.keys(c),{topOffsetElement:h=null}=e;Uu(h);function f(m){if(!u.includes(m)){console.warn(`Tab "${m}" is not available.`);return}n(3,i=m);const p=new URL(window.location);p.searchParams.set("tab",m),window.history.pushState({},"",p)}const d=m=>f(m);return t.$$set=m=>{"sidebarWidth"in m&&n(0,l=m.sidebarWidth),"tabList"in m&&n(2,c=m.tabList),"topOffsetElement"in m&&n(6,h=m.topOffsetElement),"$$scope"in m&&n(7,s=m.$$scope)},n(3,i=new URLSearchParams(window.location.search).get("tab")??u[0]??null),[l,a,c,i,f,o,h,s,r,d]}class qu extends He{constructor(e){super(),Fe(this,e,Bu,Vu,Re,{sidebarWidth:0,layoutHeight:1,tabList:2,topOffsetElement:6})}get layoutHeight(){return this.$$.ctx[1]}}const Di={0:{title:B==="en"?"no categorization":"aucune catégorisation",svg:`<svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 59 59">
        <rect x="1" y="0.62" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>
    </svg>`},1:{title:B==="en"?"overall visual matches":"correspondances visuelles globales",svg:`<svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 68 69">
        <rect x="10" y="10.62" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>
        <rect x="1" y="1" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>
        <rect x="10" y="10.62" width="46" height="45.71" rx="4.11" ry="4.11" fill="currentColor" stroke="none"/>
    </svg>`},2:{title:B==="en"?"visual matches on part of the image":"correspondances visuelles sur une partie de l'image",svg:`<svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 70 71">
        <rect x="12" y="12.43" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>
        <rect x="1" y="0.81" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>
        <path d="M 12 21.43 L 21 12.43" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
        <path d="M 12 30 L 30 12.43" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
        <path d="M 40 56 L 57 38" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
        <path d="M 48.3 56.29 L 57 47" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
        <path d="M 12 39 L 39 12" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
        <path d="M 12 48 L 48 12" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
        <path d="M 13 56 L 57 12" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
        <path d="M 31 56 L 57 29" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
        <path d="M 21 57 L 57 21" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
    </svg>`},3:{title:B==="en"?"semantic and non-visual matches":"correspondances sémantiques et non-visuelle",svg:`<svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 72 73">
        <rect x="14" y="14.43" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3" stroke-dasharray="9 9"/>
        <rect x="1" y="0.81" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>
    </svg>`},4:{title:B==="en"?"regions without match":"régions sans correspondance",svg:`<svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 59 59">
        <rect x="1" y="0.62" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>
        <path d="M 2.67 54.55 L 55 2" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
        <path d="M 54.37 54.05 L 2.72 2.24" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
    </svg>`},5:{title:B==="en"?"user specific category":"correspondances spécifiques à l'utilisateur",svg:`<svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 59 59">
        <rect x="1" y="0.81" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>
        <path d="M 8.69 55.28 C 9.25 44.15 18.08 35.28 28.86 35.28 C 32.5 35.28 36.07 36.3 39.18 38.25 C 44.96 41.85 48.66 48.3 49.02 55.28 Z M 17.85 21.48 C 17.85 15.37 22.79 10.39 28.86 10.39 C 34.92 10.39 39.86 15.37 39.86 21.48 C 39.86 27.59 34.92 32.56 28.86 32.56 C 22.79 32.56 17.85 27.59 17.85 21.48 Z M 40.37 36.34 C 38.43 35.13 36.32 34.25 34.13 33.7 C 38.82 31.64 42.1 26.94 42.1 21.48 C 42.1 14.13 36.16 8.15 28.86 8.15 C 21.55 8.15 15.61 14.13 15.61 21.48 C 15.61 26.95 18.9 31.66 23.6 33.71 C 13.76 36.18 6.41 45.4 6.41 56.4 C 6.41 57.02 6.92 57.52 7.54 57.52 L 50.17 57.52 C 50.79 57.52 51.3 57.02 51.3 56.4 C 51.3 48.23 47.11 40.54 40.37 36.34 Z" fill="currentColor" stroke="none"/>
    </svg>`}};function Ku(t){let e,n=Di[t[2]].svg+"",i,r,s,o;return{c(){e=b("span"),y(e,"class",i="tag py-4 "+t[4]+" "+(t[0]?"is-hoverable":"")),y(e,"title",r=Di[t[2]].title),Ye(e,"is-selected",t[1])},m(l,a){z(l,e,a),e.innerHTML=n,s||(o=[Ie(e,"click",t[5]),Ie(e,"keyup",null)],s=!0)},p(l,[a]){a&4&&n!==(n=Di[l[2]].svg+"")&&(e.innerHTML=n),a&17&&i!==(i="tag py-4 "+l[4]+" "+(l[0]?"is-hoverable":""))&&y(e,"class",i),a&4&&r!==(r=Di[l[2]].title)&&y(e,"title",r),a&19&&Ye(e,"is-selected",l[1])},i:ie,o:ie,d(l){l&&R(e),s=!1,yt(o)}}}function Wu(t,e,n){let{selectable:i=!0}=e,{isSelected:r=!1}=e,{category:s}=e,{toggle:o=()=>{}}=e,{padding:l="px-2"}=e;const a=()=>o(s);return t.$$set=c=>{"selectable"in c&&n(0,i=c.selectable),"isSelected"in c&&n(1,r=c.isSelected),"category"in c&&n(2,s=c.category),"toggle"in c&&n(3,o=c.toggle),"padding"in c&&n(4,l=c.padding)},[i,r,s,o,l,a]}class Bn extends He{constructor(e){super(),Fe(this,e,Wu,Ku,Re,{selectable:0,isSelected:1,category:2,toggle:3,padding:4})}}const eb="";function Zs(t){let e,n,i=t[3].title+"",r,s;return{c(){e=b("span"),n=b("a"),r=re(i),y(n,"href",s=`${Fs}/${Yt}/witness/${t[3].witnessId}/regions/${t[1]}`),y(n,"target","_blank"),y(e,"class","legend-label svelte-w1sf17")},m(o,l){z(o,e,l),v(e,n),v(n,r)},p(o,l){l&8&&i!==(i=o[3].title+"")&&Ne(r,i),l&10&&s!==(s=`${Fs}/${Yt}/witness/${o[3].witnessId}/regions/${o[1]}`)&&y(n,"href",s)},d(o){o&&R(e)}}}function Yu(t){let e,n,i,r,s,o,l,a,c,u=!t[5]&&Zs(t);return{c(){e=b("div"),n=b("span"),i=j(),r=b("span"),l=j(),u&&u.c(),y(n,"class","legend-nb svelte-w1sf17"),y(r,"class","legend-color svelte-w1sf17"),y(r,"aria-label",s=t[3].title),y(r,"title",o=t[3].title),We(r,"background-color",t[0]?t[3].color:"#999"),y(r,"role","button"),y(r,"tabindex","0"),Ye(r,"inactive",!t[0]),Ye(r,"clickable",t[4]),y(e,"class","legend-item svelte-w1sf17"),Ye(e,"inactive",!t[0])},m(h,f){z(h,e,f),v(e,n),v(e,i),v(e,r),v(e,l),u&&u.m(e,null),a||(c=[Ie(r,"click",function(){Pn(t[2])&&t[2].apply(this,arguments)}),Ie(r,"keydown",null)],a=!0)},p(h,[f]){t=h,f&8&&s!==(s=t[3].title)&&y(r,"aria-label",s),f&8&&o!==(o=t[3].title)&&y(r,"title",o),f&9&&We(r,"background-color",t[0]?t[3].color:"#999"),f&1&&Ye(r,"inactive",!t[0]),f&16&&Ye(r,"clickable",t[4]),t[5]?u&&(u.d(1),u=null):u?u.p(t,f):(u=Zs(t),u.c(),u.m(e,null)),f&1&&Ye(e,"inactive",!t[0])},i:ie,o:ie,d(h){h&&R(e),u&&u.d(),a=!1,yt(c)}}}function Xu(t,e,n){let{isActive:i=!0}=e,{id:r}=e,{toggle:s=()=>{}}=e,{meta:o={title:"Region",color:"#999",witnessId:1}}=e,{clickable:l=!0}=e,{onlyColor:a=!1}=e;return t.$$set=c=>{"isActive"in c&&n(0,i=c.isActive),"id"in c&&n(1,r=c.id),"toggle"in c&&n(2,s=c.toggle),"meta"in c&&n(3,o=c.meta),"clickable"in c&&n(4,l=c.clickable),"onlyColor"in c&&n(5,a=c.onlyColor)},[i,r,s,o,l,a]}class eo extends He{constructor(e){super(),Fe(this,e,Xu,Yu,Re,{isActive:0,id:1,toggle:2,meta:3,clickable:4,onlyColor:5})}}const tb="";function to(t,e,n){const i=t.slice();return i[12]=e[n][0],i[13]=e[n][1],i}function Gu(t){let e;return{c(){e=b("span"),e.innerHTML='<i class="fas fa-chevron-down"></i>',y(e,"class","icon is-small")},m(n,i){z(n,e,i)},d(n){n&&R(e)}}}function Ju(t){let e;return{c(){e=b("span"),e.innerHTML='<i class="fas fa-chevron-up"></i>',y(e,"class","icon is-small")},m(n,i){z(n,e,i)},d(n){n&&R(e)}}}function no(t){let e,n;function i(){return t[10](t[12])}return e=new eo({props:{id:t[12],meta:t[13],isActive:t[0].has(parseInt(t[12])),toggle:i,onlyColor:!t[4]}}),{c(){ve(e.$$.fragment)},m(r,s){he(e,r,s),n=!0},p(r,s){t=r;const o={};s&32&&(o.id=t[12]),s&32&&(o.meta=t[13]),s&33&&(o.isActive=t[0].has(parseInt(t[12]))),s&34&&(o.toggle=i),s&16&&(o.onlyColor=!t[4]),e.$set(o)},i(r){n||(V(e.$$.fragment,r),n=!0)},o(r){K(e.$$.fragment,r),n=!1},d(r){me(e,r)}}}function Qu(t){let e,n,i,r,s,o,l,a,c,u,h,f,d,m,p,g,_,S,C,w,k,N,T,E,x,O,L;function F(U,q){return U[4]?Ju:Gu}let D=F(t),I=D(t),H=t[5],P=[];for(let U=0;U<H.length;U+=1)P[U]=no(to(t,H,U));const X=U=>K(P[U],1,1,()=>{P[U]=null});return{c(){e=b("div"),n=b("div"),i=b("div"),r=b("div"),s=b("h3"),s.textContent=`${B==="en"?"Visible documents":"Documents visibles"}`,o=j(),l=b("div"),a=b("div"),c=b("p"),u=b("span"),h=b("select"),f=b("option"),f.textContent="ID",d=b("option"),d.textContent=`${Oi.Witness}`,m=b("option"),m.textContent=`${B==="en"?"Title":"Titre"}`,p=j(),g=b("p"),_=b("button"),_.innerHTML='<span class="icon is-small has-text-link pl-2"><i class="fas fa-check"></i></span>',S=j(),C=b("div"),w=b("button"),I.c(),T=j(),E=b("div");for(let U=0;U<P.length;U+=1)P[U].c();y(s,"class","title mb-0"),y(r,"class","level-item"),y(i,"class","level-left"),f.__value="id",f.value=f.__value,d.__value="witnessId",d.value=d.__value,m.__value="title",m.value=m.__value,t[3]===void 0&&jt(()=>t[7].call(h)),y(u,"class","select is-small"),y(c,"class","control mb-0"),y(c,"title",B==="en"?"Sort documents by":"Trier les documents par"),y(_,"class","button is-small is-shadowless"),y(g,"class","control"),y(g,"title",B==="en"?"Select all documents":"Sélectionner tous les documents"),y(a,"class","level-item field has-addons is-small"),y(w,"class","button is-small is-ghost"),y(w,"aria-label",k=t[4]?"Minify legend":"Expand legend"),y(C,"class","level-item"),y(C,"title",N=t[4]?"Minify legend":"Expand legend"),y(l,"class","level-right"),y(n,"class","level is-mobile mb-3"),y(E,"class","svelte-13ym7ov"),Ye(E,"is-condensed",!t[4]),Ye(E,"is-expanded",t[4])},m(U,q){z(U,e,q),v(e,n),v(n,i),v(i,r),v(r,s),v(n,o),v(n,l),v(l,a),v(a,c),v(c,u),v(u,h),v(h,f),v(h,d),v(h,m),pn(h,t[3],!0),v(a,p),v(a,g),v(g,_),v(l,S),v(l,C),v(C,w),I.m(w,null),v(e,T),v(e,E);for(let J=0;J<P.length;J+=1)P[J]&&P[J].m(E,null);x=!0,O||(L=[Ie(h,"change",t[7]),Ie(_,"click",t[8]),Ie(w,"click",t[9])],O=!0)},p(U,[q]){if(q&8&&pn(h,U[3]),D!==(D=F(U))&&(I.d(1),I=D(U),I&&(I.c(),I.m(w,null))),(!x||q&16&&k!==(k=U[4]?"Minify legend":"Expand legend"))&&y(w,"aria-label",k),(!x||q&16&&N!==(N=U[4]?"Minify legend":"Expand legend"))&&y(C,"title",N),q&51){H=U[5];let J;for(J=0;J<H.length;J+=1){const ue=to(U,H,J);P[J]?(P[J].p(ue,q),V(P[J],1)):(P[J]=no(ue),P[J].c(),V(P[J],1),P[J].m(E,null))}for(tt(),J=H.length;J<P.length;J+=1)X(J);nt()}(!x||q&16)&&Ye(E,"is-condensed",!U[4]),(!x||q&16)&&Ye(E,"is-expanded",U[4])},i(U){if(!x){for(let q=0;q<H.length;q+=1)V(P[q]);x=!0}},o(U){P=P.filter(Boolean);for(let q=0;q<P.length;q+=1)K(P[q]);x=!1},d(U){U&&R(e),I.d(),wt(P,U),O=!1,yt(L)}}}function Zu(t,e,n){let i,{documentNodes:r}=e,{selectedRegions:s}=e,{toggleRegion:o}=e,{selectAllRegions:l}=e,a=!0,c="id";const u={id:(p,g)=>p[0]-g[0],witnessId:(p,g)=>(p[1].witnessId||0)-(g[1].witnessId||0),title:(p,g)=>(p[1].title||"").localeCompare(g[1].title||"")};function h(){c=Ii(this),n(3,c)}const f=()=>l(),d=()=>n(4,a=!a),m=p=>o(parseInt(p));return t.$$set=p=>{"documentNodes"in p&&n(6,r=p.documentNodes),"selectedRegions"in p&&n(0,s=p.selectedRegions),"toggleRegion"in p&&n(1,o=p.toggleRegion),"selectAllRegions"in p&&n(2,l=p.selectAllRegions)},t.$$.update=()=>{t.$$.dirty&72&&n(5,i=Array.from(r||new Map).sort(u[c]))},[s,o,l,c,a,i,r,h,f,d,m]}class ef extends He{constructor(e){super(),Fe(this,e,Zu,Qu,Re,{documentNodes:6,selectedRegions:0,toggleRegion:1,selectAllRegions:2})}}var yn;(function(t){t.Range="range",t.Steps="steps",t.Positions="positions",t.Count="count",t.Values="values"})(yn||(yn={}));var Nt;(function(t){t[t.None=-1]="None",t[t.NoValue=0]="NoValue",t[t.LargeValue=1]="LargeValue",t[t.SmallValue=2]="SmallValue"})(Nt||(Nt={}));function tf(t){return Ri(t)&&typeof t.from=="function"}function Ri(t){return typeof t=="object"&&typeof t.to=="function"}function io(t){t.parentElement.removeChild(t)}function Or(t){return t!=null}function ro(t){t.preventDefault()}function nf(t){return t.filter(function(e){return this[e]?!1:this[e]=!0},{})}function rf(t,e){return Math.round(t/e)*e}function sf(t,e){var n=t.getBoundingClientRect(),i=t.ownerDocument,r=i.documentElement,s=lo(i);return/webkit.*Chrome.*Mobile/i.test(navigator.userAgent)&&(s.x=0),e?n.top+s.y-r.clientTop:n.left+s.x-r.clientLeft}function Xt(t){return typeof t=="number"&&!isNaN(t)&&isFinite(t)}function so(t,e,n){n>0&&(It(t,e),setTimeout(function(){zi(t,e)},n))}function oo(t){return Math.max(Math.min(t,100),0)}function $i(t){return Array.isArray(t)?t:[t]}function of(t){t=String(t);var e=t.split(".");return e.length>1?e[1].length:0}function It(t,e){t.classList&&!/\s/.test(e)?t.classList.add(e):t.className+=" "+e}function zi(t,e){t.classList&&!/\s/.test(e)?t.classList.remove(e):t.className=t.className.replace(new RegExp("(^|\\b)"+e.split(" ").join("|")+"(\\b|$)","gi")," ")}function lf(t,e){return t.classList?t.classList.contains(e):new RegExp("\\b"+e+"\\b").test(t.className)}function lo(t){var e=window.pageXOffset!==void 0,n=(t.compatMode||"")==="CSS1Compat",i=e?window.pageXOffset:n?t.documentElement.scrollLeft:t.body.scrollLeft,r=e?window.pageYOffset:n?t.documentElement.scrollTop:t.body.scrollTop;return{x:i,y:r}}function af(){return window.navigator.pointerEnabled?{start:"pointerdown",move:"pointermove",end:"pointerup"}:window.navigator.msPointerEnabled?{start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:{start:"mousedown touchstart",move:"mousemove touchmove",end:"mouseup touchend"}}function cf(){var t=!1;try{var e=Object.defineProperty({},"passive",{get:function(){t=!0}});window.addEventListener("test",null,e)}catch{}return t}function uf(){return window.CSS&&CSS.supports&&CSS.supports("touch-action","none")}function Lr(t,e){return 100/(e-t)}function Dr(t,e,n){return e*100/(t[n+1]-t[n])}function ff(t,e){return Dr(t,t[0]<0?e+Math.abs(t[0]):e-t[0],0)}function df(t,e){return e*(t[1]-t[0])/100+t[0]}function ri(t,e){for(var n=1;t>=e[n];)n+=1;return n}function hf(t,e,n){if(n>=t.slice(-1)[0])return 100;var i=ri(n,t),r=t[i-1],s=t[i],o=e[i-1],l=e[i];return o+ff([r,s],n)/Lr(o,l)}function mf(t,e,n){if(n>=100)return t.slice(-1)[0];var i=ri(n,e),r=t[i-1],s=t[i],o=e[i-1],l=e[i];return df([r,s],(n-o)*Lr(o,l))}function pf(t,e,n,i){if(i===100)return i;var r=ri(i,t),s=t[r-1],o=t[r];return n?i-s>(o-s)/2?o:s:e[r-1]?t[r-1]+rf(i-t[r-1],e[r-1]):i}var ao=function(){function t(e,n,i){this.xPct=[],this.xVal=[],this.xSteps=[],this.xNumSteps=[],this.xHighestCompleteStep=[],this.xSteps=[i||!1],this.xNumSteps=[!1],this.snap=n;var r,s=[];for(Object.keys(e).forEach(function(o){s.push([$i(e[o]),o])}),s.sort(function(o,l){return o[0][0]-l[0][0]}),r=0;r<s.length;r++)this.handleEntryPoint(s[r][1],s[r][0]);for(this.xNumSteps=this.xSteps.slice(0),r=0;r<this.xNumSteps.length;r++)this.handleStepPoint(r,this.xNumSteps[r])}return t.prototype.getDistance=function(e){for(var n=[],i=0;i<this.xNumSteps.length-1;i++)n[i]=Dr(this.xVal,e,i);return n},t.prototype.getAbsoluteDistance=function(e,n,i){var r=0;if(e<this.xPct[this.xPct.length-1])for(;e>this.xPct[r+1];)r++;else e===this.xPct[this.xPct.length-1]&&(r=this.xPct.length-2);!i&&e===this.xPct[r+1]&&r++,n===null&&(n=[]);var s,o=1,l=n[r],a=0,c=0,u=0,h=0;for(i?s=(e-this.xPct[r])/(this.xPct[r+1]-this.xPct[r]):s=(this.xPct[r+1]-e)/(this.xPct[r+1]-this.xPct[r]);l>0;)a=this.xPct[r+1+h]-this.xPct[r+h],n[r+h]*o+100-s*100>100?(c=a*s,o=(l-100*s)/n[r+h],s=1):(c=n[r+h]*a/100*o,o=0),i?(u=u-c,this.xPct.length+h>=1&&h--):(u=u+c,this.xPct.length-h>=1&&h++),l=n[r+h]*o;return e+u},t.prototype.toStepping=function(e){return e=hf(this.xVal,this.xPct,e),e},t.prototype.fromStepping=function(e){return mf(this.xVal,this.xPct,e)},t.prototype.getStep=function(e){return e=pf(this.xPct,this.xSteps,this.snap,e),e},t.prototype.getDefaultStep=function(e,n,i){var r=ri(e,this.xPct);return(e===100||n&&e===this.xPct[r-1])&&(r=Math.max(r-1,1)),(this.xVal[r]-this.xVal[r-1])/i},t.prototype.getNearbySteps=function(e){var n=ri(e,this.xPct);return{stepBefore:{startValue:this.xVal[n-2],step:this.xNumSteps[n-2],highestStep:this.xHighestCompleteStep[n-2]},thisStep:{startValue:this.xVal[n-1],step:this.xNumSteps[n-1],highestStep:this.xHighestCompleteStep[n-1]},stepAfter:{startValue:this.xVal[n],step:this.xNumSteps[n],highestStep:this.xHighestCompleteStep[n]}}},t.prototype.countStepDecimals=function(){var e=this.xNumSteps.map(of);return Math.max.apply(null,e)},t.prototype.hasNoSize=function(){return this.xVal[0]===this.xVal[this.xVal.length-1]},t.prototype.convert=function(e){return this.getStep(this.toStepping(e))},t.prototype.handleEntryPoint=function(e,n){var i;if(e==="min"?i=0:e==="max"?i=100:i=parseFloat(e),!Xt(i)||!Xt(n[0]))throw new Error("noUiSlider: 'range' value isn't numeric.");this.xPct.push(i),this.xVal.push(n[0]);var r=Number(n[1]);i?this.xSteps.push(isNaN(r)?!1:r):isNaN(r)||(this.xSteps[0]=r),this.xHighestCompleteStep.push(0)},t.prototype.handleStepPoint=function(e,n){if(n){if(this.xVal[e]===this.xVal[e+1]){this.xSteps[e]=this.xHighestCompleteStep[e]=this.xVal[e];return}this.xSteps[e]=Dr([this.xVal[e],this.xVal[e+1]],n,0)/Lr(this.xPct[e],this.xPct[e+1]);var i=(this.xVal[e+1]-this.xVal[e])/this.xNumSteps[e],r=Math.ceil(Number(i.toFixed(3))-1),s=this.xVal[e]+this.xNumSteps[e]*r;this.xHighestCompleteStep[e]=s}},t}(),co={to:function(t){return t===void 0?"":t.toFixed(2)},from:Number},uo={target:"target",base:"base",origin:"origin",handle:"handle",handleLower:"handle-lower",handleUpper:"handle-upper",touchArea:"touch-area",horizontal:"horizontal",vertical:"vertical",background:"background",connect:"connect",connects:"connects",ltr:"ltr",rtl:"rtl",textDirectionLtr:"txt-dir-ltr",textDirectionRtl:"txt-dir-rtl",draggable:"draggable",drag:"state-drag",tap:"state-tap",active:"active",tooltip:"tooltip",pips:"pips",pipsHorizontal:"pips-horizontal",pipsVertical:"pips-vertical",marker:"marker",markerHorizontal:"marker-horizontal",markerVertical:"marker-vertical",markerNormal:"marker-normal",markerLarge:"marker-large",markerSub:"marker-sub",value:"value",valueHorizontal:"value-horizontal",valueVertical:"value-vertical",valueNormal:"value-normal",valueLarge:"value-large",valueSub:"value-sub"},bn={tooltips:".__tooltips",aria:".__aria"};function gf(t,e){if(!Xt(e))throw new Error("noUiSlider: 'step' is not numeric.");t.singleStep=e}function _f(t,e){if(!Xt(e))throw new Error("noUiSlider: 'keyboardPageMultiplier' is not numeric.");t.keyboardPageMultiplier=e}function vf(t,e){if(!Xt(e))throw new Error("noUiSlider: 'keyboardMultiplier' is not numeric.");t.keyboardMultiplier=e}function yf(t,e){if(!Xt(e))throw new Error("noUiSlider: 'keyboardDefaultStep' is not numeric.");t.keyboardDefaultStep=e}function bf(t,e){if(typeof e!="object"||Array.isArray(e))throw new Error("noUiSlider: 'range' is not an object.");if(e.min===void 0||e.max===void 0)throw new Error("noUiSlider: Missing 'min' or 'max' in 'range'.");t.spectrum=new ao(e,t.snap||!1,t.singleStep)}function wf(t,e){if(e=$i(e),!Array.isArray(e)||!e.length)throw new Error("noUiSlider: 'start' option is incorrect.");t.handles=e.length,t.start=e}function Sf(t,e){if(typeof e!="boolean")throw new Error("noUiSlider: 'snap' option must be a boolean.");t.snap=e}function kf(t,e){if(typeof e!="boolean")throw new Error("noUiSlider: 'animate' option must be a boolean.");t.animate=e}function Ef(t,e){if(typeof e!="number")throw new Error("noUiSlider: 'animationDuration' option must be a number.");t.animationDuration=e}function fo(t,e){var n=[!1],i;if(e==="lower"?e=[!0,!1]:e==="upper"&&(e=[!1,!0]),e===!0||e===!1){for(i=1;i<t.handles;i++)n.push(e);n.push(!1)}else{if(!Array.isArray(e)||!e.length||e.length!==t.handles+1)throw new Error("noUiSlider: 'connect' option doesn't match handle count.");n=e}t.connect=n}function Cf(t,e){switch(e){case"horizontal":t.ort=0;break;case"vertical":t.ort=1;break;default:throw new Error("noUiSlider: 'orientation' option is invalid.")}}function ho(t,e){if(!Xt(e))throw new Error("noUiSlider: 'margin' option must be numeric.");e!==0&&(t.margin=t.spectrum.getDistance(e))}function If(t,e){if(!Xt(e))throw new Error("noUiSlider: 'limit' option must be numeric.");if(t.limit=t.spectrum.getDistance(e),!t.limit||t.handles<2)throw new Error("noUiSlider: 'limit' option is only supported on linear sliders with 2 or more handles.")}function xf(t,e){var n;if(!Xt(e)&&!Array.isArray(e))throw new Error("noUiSlider: 'padding' option must be numeric or array of exactly 2 numbers.");if(Array.isArray(e)&&!(e.length===2||Xt(e[0])||Xt(e[1])))throw new Error("noUiSlider: 'padding' option must be numeric or array of exactly 2 numbers.");if(e!==0){for(Array.isArray(e)||(e=[e,e]),t.padding=[t.spectrum.getDistance(e[0]),t.spectrum.getDistance(e[1])],n=0;n<t.spectrum.xNumSteps.length-1;n++)if(t.padding[0][n]<0||t.padding[1][n]<0)throw new Error("noUiSlider: 'padding' option must be a positive number(s).");var i=e[0]+e[1],r=t.spectrum.xVal[0],s=t.spectrum.xVal[t.spectrum.xVal.length-1];if(i/(s-r)>1)throw new Error("noUiSlider: 'padding' option must not exceed 100% of the range.")}}function Mf(t,e){switch(e){case"ltr":t.dir=0;break;case"rtl":t.dir=1;break;default:throw new Error("noUiSlider: 'direction' option was not recognized.")}}function Af(t,e){if(typeof e!="string")throw new Error("noUiSlider: 'behaviour' must be a string containing options.");var n=e.indexOf("tap")>=0,i=e.indexOf("drag")>=0,r=e.indexOf("fixed")>=0,s=e.indexOf("snap")>=0,o=e.indexOf("hover")>=0,l=e.indexOf("unconstrained")>=0,a=e.indexOf("invert-connects")>=0,c=e.indexOf("drag-all")>=0,u=e.indexOf("smooth-steps")>=0;if(r){if(t.handles!==2)throw new Error("noUiSlider: 'fixed' behaviour must be used with 2 handles");ho(t,t.start[1]-t.start[0])}if(a&&t.handles!==2)throw new Error("noUiSlider: 'invert-connects' behaviour must be used with 2 handles");if(l&&(t.margin||t.limit))throw new Error("noUiSlider: 'unconstrained' behaviour cannot be used with margin or limit");t.events={tap:n||s,drag:i,dragAll:c,smoothSteps:u,fixed:r,snap:s,hover:o,unconstrained:l,invertConnects:a}}function Tf(t,e){if(e!==!1)if(e===!0||Ri(e)){t.tooltips=[];for(var n=0;n<t.handles;n++)t.tooltips.push(e)}else{if(e=$i(e),e.length!==t.handles)throw new Error("noUiSlider: must pass a formatter for all handles.");e.forEach(function(i){if(typeof i!="boolean"&&!Ri(i))throw new Error("noUiSlider: 'tooltips' must be passed a formatter or 'false'.")}),t.tooltips=e}}function Nf(t,e){if(e.length!==t.handles)throw new Error("noUiSlider: must pass a attributes for all handles.");t.handleAttributes=e}function Pf(t,e){if(!Ri(e))throw new Error("noUiSlider: 'ariaFormat' requires 'to' method.");t.ariaFormat=e}function Of(t,e){if(!tf(e))throw new Error("noUiSlider: 'format' requires 'to' and 'from' methods.");t.format=e}function Lf(t,e){if(typeof e!="boolean")throw new Error("noUiSlider: 'keyboardSupport' option must be a boolean.");t.keyboardSupport=e}function Df(t,e){t.documentElement=e}function Rf(t,e){if(typeof e!="string"&&e!==!1)throw new Error("noUiSlider: 'cssPrefix' must be a string or `false`.");t.cssPrefix=e}function $f(t,e){if(typeof e!="object")throw new Error("noUiSlider: 'cssClasses' must be an object.");typeof t.cssPrefix=="string"?(t.cssClasses={},Object.keys(e).forEach(function(n){t.cssClasses[n]=t.cssPrefix+e[n]})):t.cssClasses=e}function mo(t){var e={margin:null,limit:null,padding:null,animate:!0,animationDuration:300,ariaFormat:co,format:co},n={step:{r:!1,t:gf},keyboardPageMultiplier:{r:!1,t:_f},keyboardMultiplier:{r:!1,t:vf},keyboardDefaultStep:{r:!1,t:yf},start:{r:!0,t:wf},connect:{r:!0,t:fo},direction:{r:!0,t:Mf},snap:{r:!1,t:Sf},animate:{r:!1,t:kf},animationDuration:{r:!1,t:Ef},range:{r:!0,t:bf},orientation:{r:!1,t:Cf},margin:{r:!1,t:ho},limit:{r:!1,t:If},padding:{r:!1,t:xf},behaviour:{r:!0,t:Af},ariaFormat:{r:!1,t:Pf},format:{r:!1,t:Of},tooltips:{r:!1,t:Tf},keyboardSupport:{r:!0,t:Lf},documentElement:{r:!1,t:Df},cssPrefix:{r:!0,t:Rf},cssClasses:{r:!0,t:$f},handleAttributes:{r:!1,t:Nf}},i={connect:!1,direction:"ltr",behaviour:"tap",orientation:"horizontal",keyboardSupport:!0,cssPrefix:"noUi-",cssClasses:uo,keyboardPageMultiplier:5,keyboardMultiplier:1,keyboardDefaultStep:10};t.format&&!t.ariaFormat&&(t.ariaFormat=t.format),Object.keys(n).forEach(function(a){if(!Or(t[a])&&i[a]===void 0){if(n[a].r)throw new Error("noUiSlider: '"+a+"' is required.");return}n[a].t(e,Or(t[a])?t[a]:i[a])}),e.pips=t.pips;var r=document.createElement("div"),s=r.style.msTransform!==void 0,o=r.style.transform!==void 0;e.transformRule=o?"transform":s?"msTransform":"webkitTransform";var l=[["left","top"],["right","bottom"]];return e.style=l[e.dir][e.ort],e}function zf(t,e,n){var i=af(),r=uf(),s=r&&cf(),o=t,l,a,c,u,h,f,d=e.spectrum,m=[],p=[],g=[],_=0,S={},C=!1,w=t.ownerDocument,k=e.documentElement||w.documentElement,N=w.body,T=w.dir==="rtl"||e.ort===1?0:100;function E(M,A){var $=w.createElement("div");return A&&It($,A),M.appendChild($),$}function x(M,A){var $=E(M,e.cssClasses.origin),G=E($,e.cssClasses.handle);if(E(G,e.cssClasses.touchArea),G.setAttribute("data-handle",String(A)),e.keyboardSupport&&(G.setAttribute("tabindex","0"),G.addEventListener("keydown",function(te){return $e(te,A)})),e.handleAttributes!==void 0){var ne=e.handleAttributes[A];Object.keys(ne).forEach(function(te){G.setAttribute(te,ne[te])})}return G.setAttribute("role","slider"),G.setAttribute("aria-orientation",e.ort?"vertical":"horizontal"),A===0?It(G,e.cssClasses.handleLower):A===e.handles-1&&It(G,e.cssClasses.handleUpper),$.handle=G,$}function O(M,A){return A?E(M,e.cssClasses.connect):!1}function L(M,A){a=E(A,e.cssClasses.connects),c=[],u=[],u.push(O(a,M[0]));for(var $=0;$<e.handles;$++)c.push(x(A,$)),g[$]=$,u.push(O(a,M[$+1]))}function F(M){It(M,e.cssClasses.target),e.dir===0?It(M,e.cssClasses.ltr):It(M,e.cssClasses.rtl),e.ort===0?It(M,e.cssClasses.horizontal):It(M,e.cssClasses.vertical);var A=getComputedStyle(M).direction;return A==="rtl"?It(M,e.cssClasses.textDirectionRtl):It(M,e.cssClasses.textDirectionLtr),E(M,e.cssClasses.base)}function D(M,A){return!e.tooltips||!e.tooltips[A]?!1:E(M.firstChild,e.cssClasses.tooltip)}function I(){return o.hasAttribute("disabled")}function H(M){var A=c[M];return A.hasAttribute("disabled")}function P(M){M!=null?(c[M].setAttribute("disabled",""),c[M].handle.removeAttribute("tabindex")):(o.setAttribute("disabled",""),c.forEach(function(A){A.handle.removeAttribute("tabindex")}))}function X(M){M!=null?(c[M].removeAttribute("disabled"),c[M].handle.setAttribute("tabindex","0")):(o.removeAttribute("disabled"),c.forEach(function(A){A.removeAttribute("disabled"),A.handle.setAttribute("tabindex","0")}))}function U(){f&&(ut("update"+bn.tooltips),f.forEach(function(M){M&&io(M)}),f=null)}function q(){U(),f=c.map(D),gt("update"+bn.tooltips,function(M,A,$){if(!(!f||!e.tooltips)&&f[A]!==!1){var G=M[A];e.tooltips[A]!==!0&&(G=e.tooltips[A].to($[A])),f[A].innerHTML=G}})}function J(){ut("update"+bn.aria),gt("update"+bn.aria,function(M,A,$,G,ne){g.forEach(function(te){var ye=c[te],le=Mt(p,te,0,!0,!0,!0),it=Mt(p,te,100,!0,!0,!0),Se=ne[te],Je=String(e.ariaFormat.to($[te]));le=d.fromStepping(le).toFixed(1),it=d.fromStepping(it).toFixed(1),Se=d.fromStepping(Se).toFixed(1),ye.children[0].setAttribute("aria-valuemin",le),ye.children[0].setAttribute("aria-valuemax",it),ye.children[0].setAttribute("aria-valuenow",Se),ye.children[0].setAttribute("aria-valuetext",Je)})})}function ue(M){if(M.mode===yn.Range||M.mode===yn.Steps)return d.xVal;if(M.mode===yn.Count){if(M.values<2)throw new Error("noUiSlider: 'values' (>= 2) required for mode 'count'.");for(var A=M.values-1,$=100/A,G=[];A--;)G[A]=A*$;return G.push(100),ce(G,M.stepped)}return M.mode===yn.Positions?ce(M.values,M.stepped):M.mode===yn.Values?M.stepped?M.values.map(function(ne){return d.fromStepping(d.getStep(d.toStepping(ne)))}):M.values:[]}function ce(M,A){return M.map(function($){return d.fromStepping(A?d.getStep($):$)})}function we(M){function A(Se,Je){return Number((Se+Je).toFixed(7))}var $=ue(M),G={},ne=d.xVal[0],te=d.xVal[d.xVal.length-1],ye=!1,le=!1,it=0;return $=nf($.slice().sort(function(Se,Je){return Se-Je})),$[0]!==ne&&($.unshift(ne),ye=!0),$[$.length-1]!==te&&($.push(te),le=!0),$.forEach(function(Se,Je){var ae,_e,ke,rt=Se,at=$[Je+1],ft,mn,Nn,Is,Uc,xs,Bc,qc=M.mode===yn.Steps;for(qc&&(ae=d.xNumSteps[Je]),ae||(ae=at-rt),at===void 0&&(at=rt),ae=Math.max(ae,1e-7),_e=rt;_e<=at;_e=A(_e,ae)){for(ft=d.toStepping(_e),mn=ft-it,Uc=mn/(M.density||1),xs=Math.round(Uc),Bc=mn/xs,ke=1;ke<=xs;ke+=1)Nn=it+ke*Bc,G[Nn.toFixed(5)]=[d.fromStepping(Nn),0];Is=$.indexOf(_e)>-1?Nt.LargeValue:qc?Nt.SmallValue:Nt.NoValue,!Je&&ye&&_e!==at&&(Is=0),_e===at&&le||(G[ft.toFixed(5)]=[_e,Is]),it=ft}}),G}function fe(M,A,$){var G,ne,te=w.createElement("div"),ye=(G={},G[Nt.None]="",G[Nt.NoValue]=e.cssClasses.valueNormal,G[Nt.LargeValue]=e.cssClasses.valueLarge,G[Nt.SmallValue]=e.cssClasses.valueSub,G),le=(ne={},ne[Nt.None]="",ne[Nt.NoValue]=e.cssClasses.markerNormal,ne[Nt.LargeValue]=e.cssClasses.markerLarge,ne[Nt.SmallValue]=e.cssClasses.markerSub,ne),it=[e.cssClasses.valueHorizontal,e.cssClasses.valueVertical],Se=[e.cssClasses.markerHorizontal,e.cssClasses.markerVertical];It(te,e.cssClasses.pips),It(te,e.ort===0?e.cssClasses.pipsHorizontal:e.cssClasses.pipsVertical);function Je(_e,ke){var rt=ke===e.cssClasses.value,at=rt?it:Se,ft=rt?ye:le;return ke+" "+at[e.ort]+" "+ft[_e]}function ae(_e,ke,rt){if(rt=A?A(ke,rt):rt,rt!==Nt.None){var at=E(te,!1);at.className=Je(rt,e.cssClasses.marker),at.style[e.style]=_e+"%",rt>Nt.NoValue&&(at=E(te,!1),at.className=Je(rt,e.cssClasses.value),at.setAttribute("data-value",String(ke)),at.style[e.style]=_e+"%",at.innerHTML=String($.to(ke)))}}return Object.keys(M).forEach(function(_e){ae(_e,M[_e][0],M[_e][1])}),te}function Ve(){h&&(io(h),h=null)}function Xe(M){Ve();var A=we(M),$=M.filter,G=M.format||{to:function(ne){return String(Math.round(ne))}};return h=o.appendChild(fe(A,$,G)),h}function pe(){var M=l.getBoundingClientRect(),A="offset"+["Width","Height"][e.ort];return e.ort===0?M.width||l[A]:M.height||l[A]}function W(M,A,$,G){var ne=function(ye){var le=ee(ye,G.pageOffset,G.target||A);if(!le||I()&&!G.doNotReject||lf(o,e.cssClasses.tap)&&!G.doNotReject||M===i.start&&le.buttons!==void 0&&le.buttons>1||G.hover&&le.buttons)return!1;s||le.preventDefault(),le.calcPoint=le.points[e.ort],$(le,G)},te=[];return M.split(" ").forEach(function(ye){A.addEventListener(ye,ne,s?{passive:!0}:!1),te.push([ye,ne])}),te}function ee(M,A,$){var G=M.type.indexOf("touch")===0,ne=M.type.indexOf("mouse")===0,te=M.type.indexOf("pointer")===0,ye=0,le=0;if(M.type.indexOf("MSPointer")===0&&(te=!0),M.type==="mousedown"&&!M.buttons&&!M.touches)return!1;if(G){var it=function(ae){var _e=ae.target;return _e===$||$.contains(_e)||M.composed&&M.composedPath().shift()===$};if(M.type==="touchstart"){var Se=Array.prototype.filter.call(M.touches,it);if(Se.length>1)return!1;ye=Se[0].pageX,le=Se[0].pageY}else{var Je=Array.prototype.find.call(M.changedTouches,it);if(!Je)return!1;ye=Je.pageX,le=Je.pageY}}return A=A||lo(w),(ne||te)&&(ye=M.clientX+A.x,le=M.clientY+A.y),M.pageOffset=A,M.points=[ye,le],M.cursor=ne||te,M}function se(M){var A=M-sf(l,e.ort),$=A*100/pe();return $=oo($),e.dir?100-$:$}function Q(M){var A=100,$=!1;return c.forEach(function(G,ne){if(!H(ne)){var te=p[ne],ye=Math.abs(te-M),le=ye===100&&A===100,it=ye<A,Se=ye<=A&&M>te;(it||Se||le)&&($=ne,A=ye)}}),$}function oe(M,A){M.type==="mouseout"&&M.target.nodeName==="HTML"&&M.relatedTarget===null&&Ge(M,A)}function De(M,A){if(navigator.appVersion.indexOf("MSIE 9")===-1&&M.buttons===0&&A.buttonsProperty!==0)return Ge(M,A);var $=(e.dir?-1:1)*(M.calcPoint-A.startCalcPoint),G=$*100/A.baseSize;pt($>0,G,A.locations,A.handleNumbers,A.connect)}function Ge(M,A){A.handle&&(zi(A.handle,e.cssClasses.active),_-=1),A.listeners.forEach(function($){k.removeEventListener($[0],$[1])}),_===0&&(zi(o,e.cssClasses.drag),de(),M.cursor&&(N.style.cursor="",N.removeEventListener("selectstart",ro))),e.events.smoothSteps&&(A.handleNumbers.forEach(function($){Oe($,p[$],!0,!0,!1,!1)}),A.handleNumbers.forEach(function($){ze("update",$)})),A.handleNumbers.forEach(function($){ze("change",$),ze("set",$),ze("end",$)})}function Ze(M,A){if(!A.handleNumbers.some(H)){var $;if(A.handleNumbers.length===1){var G=c[A.handleNumbers[0]];$=G.children[0],_+=1,It($,e.cssClasses.active)}M.stopPropagation();var ne=[],te=W(i.move,k,De,{target:M.target,handle:$,connect:A.connect,listeners:ne,startCalcPoint:M.calcPoint,baseSize:pe(),pageOffset:M.pageOffset,handleNumbers:A.handleNumbers,buttonsProperty:M.buttons,locations:p.slice()}),ye=W(i.end,k,Ge,{target:M.target,handle:$,listeners:ne,doNotReject:!0,handleNumbers:A.handleNumbers}),le=W("mouseout",k,oe,{target:M.target,handle:$,listeners:ne,doNotReject:!0,handleNumbers:A.handleNumbers});ne.push.apply(ne,te.concat(ye,le)),M.cursor&&(N.style.cursor=getComputedStyle(M.target).cursor,c.length>1&&It(o,e.cssClasses.drag),N.addEventListener("selectstart",ro,!1)),A.handleNumbers.forEach(function(it){ze("start",it)})}}function Ee(M){M.stopPropagation();var A=se(M.calcPoint),$=Q(A);$!==!1&&(e.events.snap||so(o,e.cssClasses.tap,e.animationDuration),Oe($,A,!0,!0),de(),ze("slide",$,!0),ze("update",$,!0),e.events.snap?Ze(M,{handleNumbers:[$]}):(ze("change",$,!0),ze("set",$,!0)))}function xe(M){var A=se(M.calcPoint),$=d.getStep(A),G=d.fromStepping($);Object.keys(S).forEach(function(ne){ne.split(".")[0]==="hover"&&S[ne].forEach(function(te){te.call(kt,G)})})}function $e(M,A){if(I()||H(A))return!1;var $=["Left","Right"],G=["Down","Up"],ne=["PageDown","PageUp"],te=["Home","End"];e.dir&&!e.ort?$.reverse():e.ort&&!e.dir&&(G.reverse(),ne.reverse());var ye=M.key.replace("Arrow",""),le=ye===ne[0],it=ye===ne[1],Se=ye===G[0]||ye===$[0]||le,Je=ye===G[1]||ye===$[1]||it,ae=ye===te[0],_e=ye===te[1];if(!Se&&!Je&&!ae&&!_e)return!0;M.preventDefault();var ke;if(Je||Se){var rt=Se?0:1,at=Ae(A),ft=at[rt];if(ft===null)return!1;ft===!1&&(ft=d.getDefaultStep(p[A],Se,e.keyboardDefaultStep)),it||le?ft*=e.keyboardPageMultiplier:ft*=e.keyboardMultiplier,ft=Math.max(ft,1e-7),ft=(Se?-1:1)*ft,ke=m[A]+ft}else _e?ke=e.spectrum.xVal[e.spectrum.xVal.length-1]:ke=e.spectrum.xVal[0];return Oe(A,d.toStepping(ke),!0,!0),ze("slide",A),ze("update",A),ze("change",A),ze("set",A),!1}function ot(M){M.fixed||c.forEach(function(A,$){W(i.start,A.children[0],Ze,{handleNumbers:[$]})}),M.tap&&W(i.start,l,Ee,{}),M.hover&&W(i.move,l,xe,{hover:!0}),M.drag&&u.forEach(function(A,$){if(!(A===!1||$===0||$===u.length-1)){var G=c[$-1],ne=c[$],te=[A],ye=[G,ne],le=[$-1,$];It(A,e.cssClasses.draggable),M.fixed&&(te.push(G.children[0]),te.push(ne.children[0])),M.dragAll&&(ye=c,le=g),te.forEach(function(it){W(i.start,it,Ze,{handles:ye,handleNumbers:le,connect:A})})}})}function gt(M,A){S[M]=S[M]||[],S[M].push(A),M.split(".")[0]==="update"&&c.forEach(function($,G){ze("update",G)})}function St(M){return M===bn.aria||M===bn.tooltips}function ut(M){var A=M&&M.split(".")[0],$=A?M.substring(A.length):M;Object.keys(S).forEach(function(G){var ne=G.split(".")[0],te=G.substring(ne.length);(!A||A===ne)&&(!$||$===te)&&(!St(te)||$===te)&&delete S[G]})}function ze(M,A,$){Object.keys(S).forEach(function(G){var ne=G.split(".")[0];M===ne&&S[G].forEach(function(te){te.call(kt,m.map(e.format.to),A,m.slice(),$||!1,p.slice(),kt)})})}function Mt(M,A,$,G,ne,te,ye){var le;return c.length>1&&!e.events.unconstrained&&(G&&A>0&&(le=d.getAbsoluteDistance(M[A-1],e.margin,!1),$=Math.max($,le)),ne&&A<c.length-1&&(le=d.getAbsoluteDistance(M[A+1],e.margin,!0),$=Math.min($,le))),c.length>1&&e.limit&&(G&&A>0&&(le=d.getAbsoluteDistance(M[A-1],e.limit,!1),$=Math.min($,le)),ne&&A<c.length-1&&(le=d.getAbsoluteDistance(M[A+1],e.limit,!0),$=Math.max($,le))),e.padding&&(A===0&&(le=d.getAbsoluteDistance(0,e.padding[0],!1),$=Math.max($,le)),A===c.length-1&&(le=d.getAbsoluteDistance(100,e.padding[1],!0),$=Math.min($,le))),ye||($=d.getStep($)),$=oo($),$===M[A]&&!te?!1:$}function Ue(M,A){var $=e.ort;return($?A:M)+", "+($?M:A)}function pt(M,A,$,G,ne){var te=$.slice(),ye=G[0],le=e.events.smoothSteps,it=[!M,M],Se=[M,!M];G=G.slice(),M&&G.reverse(),G.length>1?G.forEach(function(ae,_e){var ke=Mt(te,ae,te[ae]+A,it[_e],Se[_e],!1,le);ke===!1?A=0:(A=ke-te[ae],te[ae]=ke)}):it=Se=[!0];var Je=!1;G.forEach(function(ae,_e){Je=Oe(ae,$[ae]+A,it[_e],Se[_e],!1,le)||Je}),Je&&(G.forEach(function(ae){ze("update",ae),ze("slide",ae)}),ne!=null&&ze("drag",ye))}function Be(M,A){return e.dir?100-M-A:M}function Y(M,A){p[M]=A,m[M]=d.fromStepping(A);var $=Be(A,0)-T,G="translate("+Ue($+"%","0")+")";if(c[M].style[e.transformRule]=G,e.events.invertConnects&&p.length>1){var ne=p.every(function(te,ye,le){return ye===0||te>=le[ye-1]});if(C!==!ne){ge();return}}be(M),be(M+1),C&&(be(M-1),be(M+2))}function de(){g.forEach(function(M){var A=p[M]>50?-1:1,$=3+(c.length+A*M);c[M].style.zIndex=String($)})}function Oe(M,A,$,G,ne,te){return ne||(A=Mt(p,M,A,$,G,!1,te)),A===!1?!1:(Y(M,A),!0)}function be(M){if(u[M]){var A=p.slice();C&&A.sort(function(le,it){return le-it});var $=0,G=100;M!==0&&($=A[M-1]),M!==u.length-1&&(G=A[M]);var ne=G-$,te="translate("+Ue(Be($,ne)+"%","0")+")",ye="scale("+Ue(ne/100,"1")+")";u[M].style[e.transformRule]=te+" "+ye}}function st(M,A){return M===null||M===!1||M===void 0||(typeof M=="number"&&(M=String(M)),M=e.format.from(M),M!==!1&&(M=d.toStepping(M)),M===!1||isNaN(M))?p[A]:M}function qe(M,A,$){var G=$i(M),ne=p[0]===void 0;A=A===void 0?!0:A,e.animate&&!ne&&so(o,e.cssClasses.tap,e.animationDuration),g.forEach(function(le){Oe(le,st(G[le],le),!0,!1,$)});var te=g.length===1?0:1;if(ne&&d.hasNoSize()&&($=!0,p[0]=0,g.length>1)){var ye=100/(g.length-1);g.forEach(function(le){p[le]=le*ye})}for(;te<g.length;++te)g.forEach(function(le){Oe(le,p[le],!0,!0,$)});de(),g.forEach(function(le){ze("update",le),G[le]!==null&&A&&ze("set",le)})}function lt(M){qe(e.start,M)}function Ke(M,A,$,G){if(M=Number(M),!(M>=0&&M<g.length))throw new Error("noUiSlider: invalid handle number, got: "+M);Oe(M,st(A,M),!0,!0,G),ze("update",M),$&&ze("set",M)}function Qe(M){if(M===void 0&&(M=!1),M)return m.length===1?m[0]:m.slice(0);var A=m.map(e.format.to);return A.length===1?A[0]:A}function Te(){for(ut(bn.aria),ut(bn.tooltips),Object.keys(e.cssClasses).forEach(function(M){zi(o,e.cssClasses[M])});o.firstChild;)o.removeChild(o.firstChild);delete o.noUiSlider}function Ae(M){var A=p[M],$=d.getNearbySteps(A),G=m[M],ne=$.thisStep.step,te=null;if(e.snap)return[G-$.stepBefore.startValue||null,$.stepAfter.startValue-G||null];ne!==!1&&G+ne>$.stepAfter.startValue&&(ne=$.stepAfter.startValue-G),G>$.thisStep.startValue?te=$.thisStep.step:$.stepBefore.step===!1?te=!1:te=G-$.stepBefore.highestStep,A===100?ne=null:A===0&&(te=null);var ye=d.countStepDecimals();return ne!==null&&ne!==!1&&(ne=Number(ne.toFixed(ye))),te!==null&&te!==!1&&(te=Number(te.toFixed(ye))),[te,ne]}function ht(){return g.map(Ae)}function et(M,A){var $=Qe(),G=["margin","limit","padding","range","animate","snap","step","format","pips","tooltips","connect"];G.forEach(function(te){M[te]!==void 0&&(n[te]=M[te])});var ne=mo(n);G.forEach(function(te){M[te]!==void 0&&(e[te]=ne[te])}),d=ne.spectrum,e.margin=ne.margin,e.limit=ne.limit,e.padding=ne.padding,e.pips?Xe(e.pips):Ve(),e.tooltips?q():U(),p=[],qe(Or(M.start)?M.start:$,A),M.connect&&Z()}function Z(){for(;a.firstChild;)a.removeChild(a.firstChild);for(var M=0;M<=e.handles;M++)u[M]=O(a,e.connect[M]),be(M);ot({drag:e.events.drag,fixed:!0})}function ge(){C=!C,fo(e,e.connect.map(function(M){return!M})),Z()}function je(){l=F(o),L(e.connect,l),ot(e.events),qe(e.start),e.pips&&Xe(e.pips),e.tooltips&&q(),J()}je();var kt={destroy:Te,steps:ht,on:gt,off:ut,get:Qe,set:qe,setHandle:Ke,reset:lt,disable:P,enable:X,__moveHandles:function(M,A,$){pt(M,A,p,$)},options:n,updateOptions:et,target:o,removePips:Ve,removeTooltips:U,getPositions:function(){return p.slice()},getTooltips:function(){return f},getOrigins:function(){return c},pips:Xe};return kt}function jf(t,e){if(!t||!t.nodeName)throw new Error("noUiSlider: create requires a single element, got: "+t);if(t.noUiSlider)throw new Error("noUiSlider: Slider was already initialized.");var n=mo(e),i=zf(t,n,e);return t.noUiSlider=i,i}const Ff={__spectrum:ao,cssClasses:uo,create:jf},nb="",ib="";function Hf(t){let e,n,i;return{c(){e=b("span"),n=re(t[0]),y(e,"id",t[3]),y(e,"class",i="tooltip "+t[2]+" "+(t[1]?"display":"")+" svelte-1am23me")},m(r,s){z(r,e,s),v(e,n)},p(r,[s]){s&1&&Ne(n,r[0]),s&6&&i!==(i="tooltip "+r[2]+" "+(r[1]?"display":"")+" svelte-1am23me")&&y(e,"class",i)},i:ie,o:ie,d(r){r&&R(e)}}}function Vf(t,e,n){let i,r,s,o,{tooltipText:l}=e,{targetHtmlId:a}=e;const c=`tooltip-generic-${window.crypto.randomUUID()}`,u=()=>n(1,o=!0),h=()=>n(1,o=!1),f=()=>n(1,o=!o);return Dn(()=>{s=a?document.getElementById(a):document.getElementById(c).parentElement,a&&!s&&(console.error(`TooltipGeneric: element with ID ${a} not found, defaulting to the parent element`),s=document.getElementById(c).targetElement),s.addEventListener("mouseover",u),s.addEventListener("mouseout",h),s.addEventListener("click",f)}),Rn(()=>{s.removeEventListener("mouseover",u),s.removeEventListener("mouseout",h),s.removeEventListener("click",f)}),t.$$set=d=>{"tooltipText"in d&&n(0,l=d.tooltipText),"targetHtmlId"in d&&n(4,a=d.targetHtmlId)},t.$$.update=()=>{t.$$.dirty&33&&n(2,i=r(l))},n(5,r=d=>n(2,i=d.length>100?"tooltip-wide":d.length>20?"tooltip-mid":"tooltip-thin")),s=void 0,n(1,o=!1),[l,o,i,c,a,r]}class ji extends He{constructor(e){super(),Fe(this,e,Vf,Hf,Re,{tooltipText:0,targetHtmlId:4})}}const rb="";function Uf(t){let e,n,i,r,s,o,l,a,c,u,h,f,d,m,p,g;return{c(){e=b("div"),n=b("span"),i=re(t[2]),r=re(" ("),s=re(t[3]),o=re(")"),l=j(),a=b("div"),c=b("span"),u=re(t[0]),h=j(),f=b("div"),d=b("div"),m=j(),p=b("span"),g=re(t[1]),y(c,"class","range-marker svelte-216mtn"),y(d,"class","slider"),y(d,"id",t[4]),y(f,"class","slider-wrapper svelte-216mtn"),y(p,"class","range-marker svelte-216mtn"),y(a,"class","slider-outer-wrapper is-flex flex-direction-row svelte-216mtn")},m(_,S){z(_,e,S),v(e,n),v(n,i),v(n,r),v(n,s),v(n,o),v(e,l),v(e,a),v(a,c),v(c,u),v(a,h),v(a,f),v(f,d),v(a,m),v(a,p),v(p,g)},p(_,[S]){S&4&&Ne(i,_[2]),S&8&&Ne(s,_[3]),S&1&&Ne(u,_[0]),S&2&&Ne(g,_[1])},i:ie,o:ie,d(_){_&&R(e)}}}function Bf(t,e,n){let i,{minVal:r}=e,{maxVal:s}=e,{start:o}=e,{step:l=void 0}=e,{roundTo:a=2}=e,{title:c=""}=e,{emitOnUpdate:u=!1}=e;const h=Ti(),f=`slider-${window.crypto.randomUUID()}`,d=Array.isArray(o)&&o.length===2&&o.every(E=>!isNaN(parseFloat(E))),m=[],p=d?[`noUi-handle-${window.crypto.randomUUID()}`,`noUi-handle-${window.crypto.randomUUID()}`]:[`noUi-handle-${window.crypto.randomUUID()}`],g=Li();g.setCompareFn(d?Nr:(E,x)=>S(E)===S(x)),g.set(o);const _=zt("resetTrigger")||void 0;_==null||_.subscribe(k);const S=E=>Number(E.toFixed(a)),C=(E,x)=>{E=Array.isArray(E)?E.map(S):S(E),n(3,i=E),(x==="set"||x==="update"&&u)&&(g.set(E),g.same()||h("updateSlider",g.get()))};function w(E){m.length&&m.map((x,O)=>x.$set({tooltipText:d?E[O]:E}))}function k(){const E=document.getElementById(f);E!=null&&E.noUiSlider&&E.noUiSlider.reset()}function N(){const E=document.getElementById(f);let x;Ff.create(E,{start:o,step:l,connect:d?!0:"lower",range:{min:r,max:s},handleAttributes:p.map(O=>({id:O}))}),E.noUiSlider.on("update",()=>{x=E.noUiSlider.get(!0),C(x,"update")}),E.noUiSlider.on("set",()=>{x=E.noUiSlider.get(!0),C(x,"set")})}function T(){p.map((E,x)=>{m.push(new ji({target:document.getElementById(E),props:d?{tooltipText:i[x]}:{tooltipText:i}}))})}return Dn(()=>{N(),T()}),Rn(()=>{document.getElementById(f)&&(document.getElementById(f).innerHTML="")}),t.$$set=E=>{"minVal"in E&&n(0,r=E.minVal),"maxVal"in E&&n(1,s=E.maxVal),"start"in E&&n(5,o=E.start),"step"in E&&n(6,l=E.step),"roundTo"in E&&n(7,a=E.roundTo),"title"in E&&n(2,c=E.title),"emitOnUpdate"in E&&n(8,u=E.emitOnUpdate)},t.$$.update=()=>{t.$$.dirty&32&&n(3,i=o),t.$$.dirty&8&&w(i)},[r,s,c,i,f,o,l,a,u]}class En extends He{constructor(e){super(),Fe(this,e,Bf,Uf,Re,{minVal:0,maxVal:1,start:5,step:6,roundTo:7,title:2,emitOnUpdate:8})}}const qf=t=>({}),po=t=>({});function go(t,e,n){const i=t.slice();return i[44]=e[n],i}function _o(t,e,n){const i=t.slice();return i[47]=e[n],i}function vo(t,e,n){const i=t.slice();return i[44]=e[n],i}function yo(t,e,n){const i=t.slice();i[52]=e[n];const r=Object.keys(i[28][i[52]]||{});return i[53]=r,i}function bo(t){var et;let e,n,i,r=((et=t[0])==null?void 0:et.title)+"",s,o,l,a,c,u,h,f,d,m=(t[3].pairs||0)+"",p,g,_,S,C,w,k,N=(t[3].images||0)+"",T,E,x,O,L,F,D,I=(t[4]||0)+"",H,P,X,U,q,J,ue,ce,we,fe,Ve,Xe,pe,W,ee,se,Q,oe,De,Ge,Ze,Ee,xe,$e,ot,gt,St,ut,ze,Mt,Ue,pt=["Series","Witness","Work"],Be=[];for(let Z=0;Z<3;Z+=1)Be[Z]=wo(yo(t,pt,Z));q=new ef({props:{documentNodes:t[5],selectedRegions:t[6],toggleRegion:t[18],selectAllRegions:t[17]}});let Y=["all","filtered"],de=[];for(let Z=0;Z<2;Z+=1)de[Z]=So(vo(t,Y,Z));let Oe=t[29],be=[];for(let Z=0;Z<Oe.length;Z+=1)be[Z]=ko(_o(t,Oe,Z));const st=Z=>K(be[Z],1,1,()=>{be[Z]=null});let qe=["threshold","topk"],lt=[];for(let Z=0;Z<2;Z+=1)lt[Z]=Eo(go(t,qe,Z));const Ke=[Yf,Wf],Qe=[];function Te(Z,ge){return Z[7]==="threshold"?0:1}xe=Te(t),$e=Qe[xe]=Ke[xe](t);const Ae=t[35].datavizInfo,ht=Vt(Ae,t,t[34],po);return{c(){e=b("div"),n=b("div"),i=b("h1"),s=re(r),o=j(),l=b("div");for(let Z=0;Z<3;Z+=1)Be[Z].c();a=j(),c=b("div"),u=b("div"),h=b("p"),h.textContent=`${B==="en"?"Pairs":"Paires"}`,f=j(),d=b("p"),p=re(m),g=j(),_=b("div"),S=b("div"),C=b("p"),C.textContent="Images",w=j(),k=b("p"),T=re(N),E=j(),x=b("div"),O=b("div"),L=b("p"),L.textContent="Clusters",F=j(),D=b("p"),H=re(I),P=j(),X=b("hr"),U=j(),ve(q.$$.fragment),J=j(),ue=b("hr"),ce=j(),we=b("div"),fe=b("h3"),fe.textContent=`${B==="en"?"Similarity categories":"Catégories de similarité"}`,Ve=j(),Xe=b("div");for(let Z=0;Z<2;Z+=1)de[Z].c();pe=j(),W=b("div");for(let Z=0;Z<be.length;Z+=1)be[Z].c();ee=j(),se=b("hr"),Q=j(),oe=b("div"),De=b("h3"),De.textContent=`${B==="en"?"Similarity score":"Score de similarité"}`,Ge=j(),Ze=b("div");for(let Z=0;Z<2;Z+=1)lt[Z].c();Ee=j(),$e.c(),ot=j(),gt=b("hr"),St=j(),ut=b("div"),ze=b("h3"),ze.textContent=`${B==="en"?"Visualisation information":"Informations sur la visualisation"}`,Mt=j(),ht&&ht.c(),y(i,"class","title"),y(h,"class","heading"),y(d,"class","title is-5"),y(c,"class","level-item has-text-centered"),y(C,"class","heading"),y(k,"class","title is-5"),y(_,"class","level-item has-text-centered"),y(L,"class","heading"),y(D,"class","title is-5"),y(x,"class","level-item has-text-centered"),y(l,"class","level"),y(n,"class","pb-2"),y(fe,"class","title"),y(Xe,"class","buttons mb-3"),y(W,"class","level"),Ye(W,"is-disabled",t[1]==="all"),y(we,"class","pt-2"),y(De,"class","title"),y(Ze,"class","buttons mb-3"),y(oe,"class","pt-2"),y(ze,"class","title"),y(ut,"class","py-2"),y(e,"class","content is-small mt-4")},m(Z,ge){z(Z,e,ge),v(e,n),v(n,i),v(i,s),v(n,o),v(n,l);for(let je=0;je<3;je+=1)Be[je]&&Be[je].m(l,null);v(l,a),v(l,c),v(c,u),v(u,h),v(u,f),v(u,d),v(d,p),v(l,g),v(l,_),v(_,S),v(S,C),v(S,w),v(S,k),v(k,T),v(l,E),v(l,x),v(x,O),v(O,L),v(O,F),v(O,D),v(D,H),v(e,P),v(e,X),v(e,U),he(q,e,null),v(e,J),v(e,ue),v(e,ce),v(e,we),v(we,fe),v(we,Ve),v(we,Xe);for(let je=0;je<2;je+=1)de[je]&&de[je].m(Xe,null);v(we,pe),v(we,W);for(let je=0;je<be.length;je+=1)be[je]&&be[je].m(W,null);v(e,ee),v(e,se),v(e,Q),v(e,oe),v(oe,De),v(oe,Ge),v(oe,Ze);for(let je=0;je<2;je+=1)lt[je]&&lt[je].m(Ze,null);v(oe,Ee),Qe[xe].m(oe,null),v(e,ot),v(e,gt),v(e,St),v(e,ut),v(ut,ze),v(ut,Mt),ht&&ht.m(ut,null),Ue=!0},p(Z,ge){var M;if((!Ue||ge[0]&1)&&r!==(r=((M=Z[0])==null?void 0:M.title)+"")&&Ne(s,r),ge[0]&268435456){pt=["Series","Witness","Work"];let A;for(A=0;A<3;A+=1){const $=yo(Z,pt,A);Be[A]?Be[A].p($,ge):(Be[A]=wo($),Be[A].c(),Be[A].m(l,a))}for(;A<3;A+=1)Be[A].d(1)}(!Ue||ge[0]&8)&&m!==(m=(Z[3].pairs||0)+"")&&Ne(p,m),(!Ue||ge[0]&8)&&N!==(N=(Z[3].images||0)+"")&&Ne(T,N),(!Ue||ge[0]&16)&&I!==(I=(Z[4]||0)+"")&&Ne(H,I);const je={};if(ge[0]&32&&(je.documentNodes=Z[5]),ge[0]&64&&(je.selectedRegions=Z[6]),q.$set(je),ge[0]&1073741826){Y=["all","filtered"];let A;for(A=0;A<2;A+=1){const $=vo(Z,Y,A);de[A]?de[A].p($,ge):(de[A]=So($),de[A].c(),de[A].m(Xe,null))}for(;A<2;A+=1)de[A].d(1)}if(ge[0]&536903694){Oe=Z[29];let A;for(A=0;A<Oe.length;A+=1){const $=_o(Z,Oe,A);be[A]?(be[A].p($,ge),V(be[A],1)):(be[A]=ko($),be[A].c(),V(be[A],1),be[A].m(W,null))}for(tt(),A=Oe.length;A<be.length;A+=1)st(A);nt()}if((!Ue||ge[0]&2)&&Ye(W,"is-disabled",Z[1]==="all"),ge[0]&128|ge[1]&1){qe=["threshold","topk"];let A;for(A=0;A<2;A+=1){const $=go(Z,qe,A);lt[A]?lt[A].p($,ge):(lt[A]=Eo($),lt[A].c(),lt[A].m(Ze,null))}for(;A<2;A+=1)lt[A].d(1)}let kt=xe;xe=Te(Z),xe===kt?Qe[xe].p(Z,ge):(tt(),K(Qe[kt],1,1,()=>{Qe[kt]=null}),nt(),$e=Qe[xe],$e?$e.p(Z,ge):($e=Qe[xe]=Ke[xe](Z),$e.c()),V($e,1),$e.m(oe,null)),ht&&ht.p&&(!Ue||ge[1]&8)&&Bt(ht,Ae,Z,Z[34],Ue?Ut(Ae,Z[34],ge,qf):qt(Z[34]),po)},i(Z){if(!Ue){V(q.$$.fragment,Z);for(let ge=0;ge<Oe.length;ge+=1)V(be[ge]);V($e),V(ht,Z),Ue=!0}},o(Z){K(q.$$.fragment,Z),be=be.filter(Boolean);for(let ge=0;ge<be.length;ge+=1)K(be[ge]);K($e),K(ht,Z),Ue=!1},d(Z){Z&&R(e),wt(Be,Z),me(q),wt(de,Z),wt(be,Z),wt(lt,Z),Qe[xe].d(),ht&&ht.d(Z)}}}function Kf(t){let e,n,i,r=Oi[t[52]]+"",s,o,l,a=(t[53].length||0)+"",c;return{c(){e=b("div"),n=b("div"),i=b("p"),s=re(r),o=j(),l=b("p"),c=re(a),y(i,"class","heading"),y(l,"class","title is-5"),y(e,"class","level-item has-text-centered")},m(u,h){z(u,e,h),v(e,n),v(n,i),v(i,s),v(n,o),v(n,l),v(l,c)},p:ie,d(u){u&&R(e)}}}function wo(t){let e,n=t[53].length>0&&Kf(t);return{c(){n&&n.c(),e=Ct()},m(i,r){n&&n.m(i,r),z(i,e,r)},p(i,r){i[53].length>0&&n.p(i,r)},d(i){n&&n.d(i),i&&R(e)}}}function So(t){let e,n=t[44]==="all"?B==="en"?"All pairs":"Toutes les paires":B==="en"?"Filter by category":"Filtrer par catégorie",i,r,s,o;function l(){return t[36](t[44])}return{c(){e=b("button"),i=re(n),r=j(),y(e,"class","button is-small is-flex-grow-1"),Ye(e,"is-link",t[1]===t[44]),Ye(e,"is-contrasted",t[1]!==t[44])},m(a,c){z(a,e,c),v(e,i),v(e,r),s||(o=Ie(e,"click",l),s=!0)},p(a,c){t=a,c[0]&2&&Ye(e,"is-link",t[1]===t[44]),c[0]&2&&Ye(e,"is-contrasted",t[1]!==t[44])},d(a){a&&R(e),s=!1,o()}}}function ko(t){let e,n,i,r,s,o=(t[3].categories[t[47]]||0)+"",l,a,c;return i=new Bn({props:{category:t[47],isSelected:t[2].includes(t[47]),toggle:t[37],selectable:t[1]==="filtered"}}),{c(){e=b("div"),n=b("div"),ve(i.$$.fragment),r=j(),s=b("p"),l=re(o),a=j(),y(s,"class","is-size-7 mt-1"),y(e,"class","level-item has-text-centered")},m(u,h){z(u,e,h),v(e,n),he(i,n,null),v(n,r),v(n,s),v(s,l),v(e,a),c=!0},p(u,h){const f={};h[0]&4&&(f.isSelected=u[2].includes(u[47])),h[0]&2&&(f.toggle=u[37]),h[0]&2&&(f.selectable=u[1]==="filtered"),i.$set(f),(!c||h[0]&8)&&o!==(o=(u[3].categories[u[47]]||0)+"")&&Ne(l,o)},i(u){c||(V(i.$$.fragment,u),c=!0)},o(u){K(i.$$.fragment,u),c=!1},d(u){u&&R(e),me(i)}}}function Eo(t){let e,n=t[44]==="threshold"?B==="en"?"Score threshold":"Seuil de score":B==="en"?"Top K pairs":"Top K paires",i,r,s,o;function l(){return t[38](t[44])}return{c(){e=b("button"),i=re(n),r=j(),y(e,"class","button is-small is-flex-grow-1"),Ye(e,"is-link",t[7]===t[44]),Ye(e,"is-contrasted",t[7]!==t[44])},m(a,c){z(a,e,c),v(e,i),v(e,r),s||(o=Ie(e,"click",l),s=!0)},p(a,c){t=a,c[0]&128&&Ye(e,"is-link",t[7]===t[44]),c[0]&128&&Ye(e,"is-contrasted",t[7]!==t[44])},d(a){a&&R(e),s=!1,o()}}}function Wf(t){let e,n,i,r,s,o,l,a,c,u,h,f;return i=new En({props:{minVal:1,maxVal:5,start:t[10]||3,step:1,roundTo:0,title:"K"}}),i.$on("updateSlider",t[40]),{c(){e=b("div"),n=b("div"),ve(i.$$.fragment),r=j(),s=b("div"),o=b("label"),l=b("input"),a=j(),c=b("span"),c.textContent=`${B==="en"?"Mutual top K":"Top K mutuel"}`,y(n,"class","column is-two-thirds pl-4"),l.checked=t[11],y(l,"type","checkbox"),y(l,"class","mr-2"),y(c,"class","is-size-7"),y(o,"class","checkbox mt-3 is-flex is-align-items-center"),y(s,"class","column mt-2"),y(e,"class","columns mt-2")},m(d,m){z(d,e,m),v(e,n),he(i,n,null),v(e,r),v(e,s),v(s,o),v(o,l),v(o,a),v(o,c),u=!0,h||(f=Ie(l,"change",t[41]),h=!0)},p(d,m){const p={};m[0]&1024&&(p.start=d[10]||3),i.$set(p),(!u||m[0]&2048)&&(l.checked=d[11])},i(d){u||(V(i.$$.fragment,d),u=!0)},o(d){K(i.$$.fragment,d),u=!1},d(d){d&&R(e),me(i),h=!1,f()}}}function Yf(t){var i,r;let e,n;return e=new En({props:{minVal:((i=t[8].scoreRange)==null?void 0:i.min)||0,maxVal:((r=t[8].scoreRange)==null?void 0:r.max)||1,start:t[9],step:.01,roundTo:2,title:B==="en"?"Minimum score":"Score minimum"}}),e.$on("updateSlider",t[39]),{c(){ve(e.$$.fragment)},m(s,o){he(e,s,o),n=!0},p(s,o){var a,c;const l={};o[0]&256&&(l.minVal=((a=s[8].scoreRange)==null?void 0:a.min)||0),o[0]&256&&(l.maxVal=((c=s[8].scoreRange)==null?void 0:c.max)||1),o[0]&512&&(l.start=s[9]),e.$set(l)},i(s){n||(V(e.$$.fragment,s),n=!0)},o(s){K(e.$$.fragment,s),n=!1},d(s){me(e,s)}}}function Xf(t){let e,n,i=t[3]&&bo(t);return{c(){e=b("div"),i&&i.c(),y(e,"class","m-4 py-5 px-4")},m(r,s){z(r,e,s),i&&i.m(e,null),n=!0},p(r,s){r[3]?i?(i.p(r,s),s[0]&8&&V(i,1)):(i=bo(r),i.c(),V(i,1),i.m(e,null)):i&&(tt(),K(i,1,1,()=>{i=null}),nt())},i(r){n||(V(i),n=!0)},o(r){K(i),n=!1},d(r){r&&R(e),i&&i.d()}}}function Gf(t,e,n){let i,r,s,o,l,a,c,u,h,f,{$$slots:d={},$$scope:m}=e,{docSet:p=null}=e,{documentSetStore:g}=e,{clusterStore:_}=e;const{docSetNumber:S,documentNodes:C,selectedCategories:w,toggleCategory:k,selectedRegions:N,selectAllRegions:T,toggleRegion:E,threshold:x,setThreshold:O,topK:L,setTopK:F,mutualTopK:D,setMutualTopK:I,scoreMode:H,setScoreMode:P,pairStats:X}=g;Ce(t,S,Q=>n(3,r=Q)),Ce(t,C,Q=>n(5,o=Q)),Ce(t,w,Q=>n(2,i=Q)),Ce(t,N,Q=>n(6,l=Q)),Ce(t,x,Q=>n(9,u=Q)),Ce(t,L,Q=>n(10,h=Q)),Ce(t,D,Q=>n(11,f=Q)),Ce(t,H,Q=>n(7,a=Q)),Ce(t,X,Q=>n(8,c=Q));const{clusterNb:U,handlePageUpdate:q}=_;Ce(t,U,Q=>n(4,s=Q));const J=zt("selectedDocuments"),ue=[0,1,2,3,5];let ce="filtered";function we(Q){n(1,ce=Q),Q==="all"&&i.length!==ue.length&&w.set(ue)}function fe(Q){q(1),P(Q)}const Ve=Q=>we(Q),Xe=Q=>ce==="filtered"?k(Q):null,pe=Q=>fe(Q),W=Q=>O(Q.detail),ee=Q=>F(Q.detail),se=()=>I(!f);return t.$$set=Q=>{"docSet"in Q&&n(0,p=Q.docSet),"documentSetStore"in Q&&n(32,g=Q.documentSetStore),"clusterStore"in Q&&n(33,_=Q.clusterStore),"$$scope"in Q&&n(34,m=Q.$$scope)},[p,ce,i,r,s,o,l,a,c,u,h,f,S,C,w,k,N,T,E,x,O,L,F,D,I,H,X,U,J,ue,we,fe,g,_,m,d,Ve,Xe,pe,W,ee,se]}class Jf extends He{constructor(e){super(),Fe(this,e,Gf,Xf,Re,{docSet:0,documentSetStore:32,clusterStore:33},null,[-1,-1])}}function Fi(t,e){return t==null||e==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function Qf(t,e){return t==null||e==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function Co(t){let e,n,i;t.length!==2?(e=Fi,n=(l,a)=>Fi(t(l),a),i=(l,a)=>t(l)-a):(e=t===Fi||t===Qf?t:Zf,n=t,i=t);function r(l,a,c=0,u=l.length){if(c<u){if(e(a,a)!==0)return u;do{const h=c+u>>>1;n(l[h],a)<0?c=h+1:u=h}while(c<u)}return c}function s(l,a,c=0,u=l.length){if(c<u){if(e(a,a)!==0)return u;do{const h=c+u>>>1;n(l[h],a)<=0?c=h+1:u=h}while(c<u)}return c}function o(l,a,c=0,u=l.length){const h=r(l,a,c,u-1);return h>c&&i(l[h-1],a)>-i(l[h],a)?h-1:h}return{left:r,center:o,right:s}}function Zf(){return 0}function ed(t){return t===null?NaN:+t}const td=Co(Fi).right;Co(ed).center;const nd=td;class Io extends Map{constructor(e,n=sd){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:n}}),e!=null)for(const[i,r]of e)this.set(i,r)}get(e){return super.get(xo(this,e))}has(e){return super.has(xo(this,e))}set(e,n){return super.set(id(this,e),n)}delete(e){return super.delete(rd(this,e))}}function xo({_intern:t,_key:e},n){const i=e(n);return t.has(i)?t.get(i):n}function id({_intern:t,_key:e},n){const i=e(n);return t.has(i)?t.get(i):(t.set(i,n),n)}function rd({_intern:t,_key:e},n){const i=e(n);return t.has(i)&&(n=t.get(i),t.delete(i)),n}function sd(t){return t!==null&&typeof t=="object"?t.valueOf():t}const od=Math.sqrt(50),ld=Math.sqrt(10),ad=Math.sqrt(2);function Hi(t,e,n){const i=(e-t)/Math.max(0,n),r=Math.floor(Math.log10(i)),s=i/Math.pow(10,r),o=s>=od?10:s>=ld?5:s>=ad?2:1;let l,a,c;return r<0?(c=Math.pow(10,-r)/o,l=Math.round(t*c),a=Math.round(e*c),l/c<t&&++l,a/c>e&&--a,c=-c):(c=Math.pow(10,r)*o,l=Math.round(t/c),a=Math.round(e/c),l*c<t&&++l,a*c>e&&--a),a<l&&.5<=n&&n<2?Hi(t,e,n*2):[l,a,c]}function cd(t,e,n){if(e=+e,t=+t,n=+n,!(n>0))return[];if(t===e)return[t];const i=e<t,[r,s,o]=i?Hi(e,t,n):Hi(t,e,n);if(!(s>=r))return[];const l=s-r+1,a=new Array(l);if(i)if(o<0)for(let c=0;c<l;++c)a[c]=(s-c)/-o;else for(let c=0;c<l;++c)a[c]=(s-c)*o;else if(o<0)for(let c=0;c<l;++c)a[c]=(r+c)/-o;else for(let c=0;c<l;++c)a[c]=(r+c)*o;return a}function Rr(t,e,n){return e=+e,t=+t,n=+n,Hi(t,e,n)[2]}function ud(t,e,n){e=+e,t=+t,n=+n;const i=e<t,r=i?Rr(e,t,n):Rr(t,e,n);return(i?-1:1)*(r<0?1/-r:r)}function Vi(t,e,n){t=+t,e=+e,n=(r=arguments.length)<2?(e=t,t=0,1):r<3?1:+n;for(var i=-1,r=Math.max(0,Math.ceil((e-t)/n))|0,s=new Array(r);++i<r;)s[i]=t+i*n;return s}function fd(t){return t}var Ui=1,$r=2,Mo=3,si=4,Ao=1e-6;function dd(t){return"translate("+t+",0)"}function hd(t){return"translate(0,"+t+")"}function md(t){return e=>+t(e)}function pd(t,e){return e=Math.max(0,t.bandwidth()-e*2)/2,t.round()&&(e=Math.round(e)),n=>+t(n)+e}function gd(){return!this.__axis}function To(t,e){var n=[],i=null,r=null,s=6,o=6,l=3,a=typeof window<"u"&&window.devicePixelRatio>1?0:.5,c=t===Ui||t===si?-1:1,u=t===si||t===$r?"x":"y",h=t===Ui||t===Mo?dd:hd;function f(d){var m=i??(e.ticks?e.ticks.apply(e,n):e.domain()),p=r??(e.tickFormat?e.tickFormat.apply(e,n):fd),g=Math.max(s,0)+l,_=e.range(),S=+_[0]+a,C=+_[_.length-1]+a,w=(e.bandwidth?pd:md)(e.copy(),a),k=d.selection?d.selection():d,N=k.selectAll(".domain").data([null]),T=k.selectAll(".tick").data(m,e).order(),E=T.exit(),x=T.enter().append("g").attr("class","tick"),O=T.select("line"),L=T.select("text");N=N.merge(N.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),T=T.merge(x),O=O.merge(x.append("line").attr("stroke","currentColor").attr(u+"2",c*s)),L=L.merge(x.append("text").attr("fill","currentColor").attr(u,c*g).attr("dy",t===Ui?"0em":t===Mo?"0.71em":"0.32em")),d!==k&&(N=N.transition(d),T=T.transition(d),O=O.transition(d),L=L.transition(d),E=E.transition(d).attr("opacity",Ao).attr("transform",function(F){return isFinite(F=w(F))?h(F+a):this.getAttribute("transform")}),x.attr("opacity",Ao).attr("transform",function(F){var D=this.parentNode.__axis;return h((D&&isFinite(D=D(F))?D:w(F))+a)})),E.remove(),N.attr("d",t===si||t===$r?o?"M"+c*o+","+S+"H"+a+"V"+C+"H"+c*o:"M"+a+","+S+"V"+C:o?"M"+S+","+c*o+"V"+a+"H"+C+"V"+c*o:"M"+S+","+a+"H"+C),T.attr("opacity",1).attr("transform",function(F){return h(w(F)+a)}),O.attr(u+"2",c*s),L.attr(u,c*g).text(p),k.filter(gd).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",t===$r?"start":t===si?"end":"middle"),k.each(function(){this.__axis=w})}return f.scale=function(d){return arguments.length?(e=d,f):e},f.ticks=function(){return n=Array.from(arguments),f},f.tickArguments=function(d){return arguments.length?(n=d==null?[]:Array.from(d),f):n.slice()},f.tickValues=function(d){return arguments.length?(i=d==null?null:Array.from(d),f):i&&i.slice()},f.tickFormat=function(d){return arguments.length?(r=d,f):r},f.tickSize=function(d){return arguments.length?(s=o=+d,f):s},f.tickSizeInner=function(d){return arguments.length?(s=+d,f):s},f.tickSizeOuter=function(d){return arguments.length?(o=+d,f):o},f.tickPadding=function(d){return arguments.length?(l=+d,f):l},f.offset=function(d){return arguments.length?(a=+d,f):a},f}function No(t){return To(Ui,t)}function Po(t){return To(si,t)}var _d={value:()=>{}};function oi(){for(var t=0,e=arguments.length,n={},i;t<e;++t){if(!(i=arguments[t]+"")||i in n||/[\s.]/.test(i))throw new Error("illegal type: "+i);n[i]=[]}return new Bi(n)}function Bi(t){this._=t}function vd(t,e){return t.trim().split(/^|\s+/).map(function(n){var i="",r=n.indexOf(".");if(r>=0&&(i=n.slice(r+1),n=n.slice(0,r)),n&&!e.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:i}})}Bi.prototype=oi.prototype={constructor:Bi,on:function(t,e){var n=this._,i=vd(t+"",n),r,s=-1,o=i.length;if(arguments.length<2){for(;++s<o;)if((r=(t=i[s]).type)&&(r=yd(n[r],t.name)))return r;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++s<o;)if(r=(t=i[s]).type)n[r]=Oo(n[r],t.name,e);else if(e==null)for(r in n)n[r]=Oo(n[r],t.name,null);return this},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new Bi(t)},call:function(t,e){if((r=arguments.length-2)>0)for(var n=new Array(r),i=0,r,s;i<r;++i)n[i]=arguments[i+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(s=this._[t],i=0,r=s.length;i<r;++i)s[i].value.apply(e,n)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var i=this._[t],r=0,s=i.length;r<s;++r)i[r].value.apply(e,n)}};function yd(t,e){for(var n=0,i=t.length,r;n<i;++n)if((r=t[n]).name===e)return r.value}function Oo(t,e,n){for(var i=0,r=t.length;i<r;++i)if(t[i].name===e){t[i]=_d,t=t.slice(0,i).concat(t.slice(i+1));break}return n!=null&&t.push({name:e,value:n}),t}var zr="http://www.w3.org/1999/xhtml";const Lo={svg:"http://www.w3.org/2000/svg",xhtml:zr,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function qi(t){var e=t+="",n=e.indexOf(":");return n>=0&&(e=t.slice(0,n))!=="xmlns"&&(t=t.slice(n+1)),Lo.hasOwnProperty(e)?{space:Lo[e],local:t}:t}function bd(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===zr&&e.documentElement.namespaceURI===zr?e.createElement(t):e.createElementNS(n,t)}}function wd(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function Do(t){var e=qi(t);return(e.local?wd:bd)(e)}function Sd(){}function jr(t){return t==null?Sd:function(){return this.querySelector(t)}}function kd(t){typeof t!="function"&&(t=jr(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var s=e[r],o=s.length,l=i[r]=new Array(o),a,c,u=0;u<o;++u)(a=s[u])&&(c=t.call(a,a.__data__,u,s))&&("__data__"in a&&(c.__data__=a.__data__),l[u]=c);return new Ft(i,this._parents)}function Ed(t){return t==null?[]:Array.isArray(t)?t:Array.from(t)}function Cd(){return[]}function Ro(t){return t==null?Cd:function(){return this.querySelectorAll(t)}}function Id(t){return function(){return Ed(t.apply(this,arguments))}}function xd(t){typeof t=="function"?t=Id(t):t=Ro(t);for(var e=this._groups,n=e.length,i=[],r=[],s=0;s<n;++s)for(var o=e[s],l=o.length,a,c=0;c<l;++c)(a=o[c])&&(i.push(t.call(a,a.__data__,c,o)),r.push(a));return new Ft(i,r)}function $o(t){return function(){return this.matches(t)}}function zo(t){return function(e){return e.matches(t)}}var Md=Array.prototype.find;function Ad(t){return function(){return Md.call(this.children,t)}}function Td(){return this.firstElementChild}function Nd(t){return this.select(t==null?Td:Ad(typeof t=="function"?t:zo(t)))}var Pd=Array.prototype.filter;function Od(){return Array.from(this.children)}function Ld(t){return function(){return Pd.call(this.children,t)}}function Dd(t){return this.selectAll(t==null?Od:Ld(typeof t=="function"?t:zo(t)))}function Rd(t){typeof t!="function"&&(t=$o(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var s=e[r],o=s.length,l=i[r]=[],a,c=0;c<o;++c)(a=s[c])&&t.call(a,a.__data__,c,s)&&l.push(a);return new Ft(i,this._parents)}function jo(t){return new Array(t.length)}function $d(){return new Ft(this._enter||this._groups.map(jo),this._parents)}function Ki(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}Ki.prototype={constructor:Ki,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function zd(t){return function(){return t}}function jd(t,e,n,i,r,s){for(var o=0,l,a=e.length,c=s.length;o<c;++o)(l=e[o])?(l.__data__=s[o],i[o]=l):n[o]=new Ki(t,s[o]);for(;o<a;++o)(l=e[o])&&(r[o]=l)}function Fd(t,e,n,i,r,s,o){var l,a,c=new Map,u=e.length,h=s.length,f=new Array(u),d;for(l=0;l<u;++l)(a=e[l])&&(f[l]=d=o.call(a,a.__data__,l,e)+"",c.has(d)?r[l]=a:c.set(d,a));for(l=0;l<h;++l)d=o.call(t,s[l],l,s)+"",(a=c.get(d))?(i[l]=a,a.__data__=s[l],c.delete(d)):n[l]=new Ki(t,s[l]);for(l=0;l<u;++l)(a=e[l])&&c.get(f[l])===a&&(r[l]=a)}function Hd(t){return t.__data__}function Vd(t,e){if(!arguments.length)return Array.from(this,Hd);var n=e?Fd:jd,i=this._parents,r=this._groups;typeof t!="function"&&(t=zd(t));for(var s=r.length,o=new Array(s),l=new Array(s),a=new Array(s),c=0;c<s;++c){var u=i[c],h=r[c],f=h.length,d=Ud(t.call(u,u&&u.__data__,c,i)),m=d.length,p=l[c]=new Array(m),g=o[c]=new Array(m),_=a[c]=new Array(f);n(u,h,p,g,_,d,e);for(var S=0,C=0,w,k;S<m;++S)if(w=p[S]){for(S>=C&&(C=S+1);!(k=g[C])&&++C<m;);w._next=k||null}}return o=new Ft(o,i),o._enter=l,o._exit=a,o}function Ud(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function Bd(){return new Ft(this._exit||this._groups.map(jo),this._parents)}function qd(t,e,n){var i=this.enter(),r=this,s=this.exit();return typeof t=="function"?(i=t(i),i&&(i=i.selection())):i=i.append(t+""),e!=null&&(r=e(r),r&&(r=r.selection())),n==null?s.remove():n(s),i&&r?i.merge(r).order():r}function Kd(t){for(var e=t.selection?t.selection():t,n=this._groups,i=e._groups,r=n.length,s=i.length,o=Math.min(r,s),l=new Array(r),a=0;a<o;++a)for(var c=n[a],u=i[a],h=c.length,f=l[a]=new Array(h),d,m=0;m<h;++m)(d=c[m]||u[m])&&(f[m]=d);for(;a<r;++a)l[a]=n[a];return new Ft(l,this._parents)}function Wd(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var i=t[e],r=i.length-1,s=i[r],o;--r>=0;)(o=i[r])&&(s&&o.compareDocumentPosition(s)^4&&s.parentNode.insertBefore(o,s),s=o);return this}function Yd(t){t||(t=Xd);function e(h,f){return h&&f?t(h.__data__,f.__data__):!h-!f}for(var n=this._groups,i=n.length,r=new Array(i),s=0;s<i;++s){for(var o=n[s],l=o.length,a=r[s]=new Array(l),c,u=0;u<l;++u)(c=o[u])&&(a[u]=c);a.sort(e)}return new Ft(r,this._parents).order()}function Xd(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function Gd(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function Jd(){return Array.from(this)}function Qd(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var i=t[e],r=0,s=i.length;r<s;++r){var o=i[r];if(o)return o}return null}function Zd(){let t=0;for(const e of this)++t;return t}function eh(){return!this.node()}function th(t){for(var e=this._groups,n=0,i=e.length;n<i;++n)for(var r=e[n],s=0,o=r.length,l;s<o;++s)(l=r[s])&&t.call(l,l.__data__,s,r);return this}function nh(t){return function(){this.removeAttribute(t)}}function ih(t){return function(){this.removeAttributeNS(t.space,t.local)}}function rh(t,e){return function(){this.setAttribute(t,e)}}function sh(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function oh(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttribute(t):this.setAttribute(t,n)}}function lh(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function ah(t,e){var n=qi(t);if(arguments.length<2){var i=this.node();return n.local?i.getAttributeNS(n.space,n.local):i.getAttribute(n)}return this.each((e==null?n.local?ih:nh:typeof e=="function"?n.local?lh:oh:n.local?sh:rh)(n,e))}function Fo(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function ch(t){return function(){this.style.removeProperty(t)}}function uh(t,e,n){return function(){this.style.setProperty(t,e,n)}}function fh(t,e,n){return function(){var i=e.apply(this,arguments);i==null?this.style.removeProperty(t):this.style.setProperty(t,i,n)}}function dh(t,e,n){return arguments.length>1?this.each((e==null?ch:typeof e=="function"?fh:uh)(t,e,n??"")):qn(this.node(),t)}function qn(t,e){return t.style.getPropertyValue(e)||Fo(t).getComputedStyle(t,null).getPropertyValue(e)}function hh(t){return function(){delete this[t]}}function mh(t,e){return function(){this[t]=e}}function ph(t,e){return function(){var n=e.apply(this,arguments);n==null?delete this[t]:this[t]=n}}function gh(t,e){return arguments.length>1?this.each((e==null?hh:typeof e=="function"?ph:mh)(t,e)):this.node()[t]}function Ho(t){return t.trim().split(/^|\s+/)}function Fr(t){return t.classList||new Vo(t)}function Vo(t){this._node=t,this._names=Ho(t.getAttribute("class")||"")}Vo.prototype={add:function(t){var e=this._names.indexOf(t);e<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function Uo(t,e){for(var n=Fr(t),i=-1,r=e.length;++i<r;)n.add(e[i])}function Bo(t,e){for(var n=Fr(t),i=-1,r=e.length;++i<r;)n.remove(e[i])}function _h(t){return function(){Uo(this,t)}}function vh(t){return function(){Bo(this,t)}}function yh(t,e){return function(){(e.apply(this,arguments)?Uo:Bo)(this,t)}}function bh(t,e){var n=Ho(t+"");if(arguments.length<2){for(var i=Fr(this.node()),r=-1,s=n.length;++r<s;)if(!i.contains(n[r]))return!1;return!0}return this.each((typeof e=="function"?yh:e?_h:vh)(n,e))}function wh(){this.textContent=""}function Sh(t){return function(){this.textContent=t}}function kh(t){return function(){var e=t.apply(this,arguments);this.textContent=e??""}}function Eh(t){return arguments.length?this.each(t==null?wh:(typeof t=="function"?kh:Sh)(t)):this.node().textContent}function Ch(){this.innerHTML=""}function Ih(t){return function(){this.innerHTML=t}}function xh(t){return function(){var e=t.apply(this,arguments);this.innerHTML=e??""}}function Mh(t){return arguments.length?this.each(t==null?Ch:(typeof t=="function"?xh:Ih)(t)):this.node().innerHTML}function Ah(){this.nextSibling&&this.parentNode.appendChild(this)}function Th(){return this.each(Ah)}function Nh(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Ph(){return this.each(Nh)}function Oh(t){var e=typeof t=="function"?t:Do(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function Lh(){return null}function Dh(t,e){var n=typeof t=="function"?t:Do(t),i=e==null?Lh:typeof e=="function"?e:jr(e);return this.select(function(){return this.insertBefore(n.apply(this,arguments),i.apply(this,arguments)||null)})}function Rh(){var t=this.parentNode;t&&t.removeChild(this)}function $h(){return this.each(Rh)}function zh(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function jh(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function Fh(t){return this.select(t?jh:zh)}function Hh(t){return arguments.length?this.property("__data__",t):this.node().__data__}function Vh(t){return function(e){t.call(this,e,this.__data__)}}function Uh(t){return t.trim().split(/^|\s+/).map(function(e){var n="",i=e.indexOf(".");return i>=0&&(n=e.slice(i+1),e=e.slice(0,i)),{type:e,name:n}})}function Bh(t){return function(){var e=this.__on;if(e){for(var n=0,i=-1,r=e.length,s;n<r;++n)s=e[n],(!t.type||s.type===t.type)&&s.name===t.name?this.removeEventListener(s.type,s.listener,s.options):e[++i]=s;++i?e.length=i:delete this.__on}}}function qh(t,e,n){return function(){var i=this.__on,r,s=Vh(e);if(i){for(var o=0,l=i.length;o<l;++o)if((r=i[o]).type===t.type&&r.name===t.name){this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=s,r.options=n),r.value=e;return}}this.addEventListener(t.type,s,n),r={type:t.type,name:t.name,value:e,listener:s,options:n},i?i.push(r):this.__on=[r]}}function Kh(t,e,n){var i=Uh(t+""),r,s=i.length,o;if(arguments.length<2){var l=this.node().__on;if(l){for(var a=0,c=l.length,u;a<c;++a)for(r=0,u=l[a];r<s;++r)if((o=i[r]).type===u.type&&o.name===u.name)return u.value}return}for(l=e?qh:Bh,r=0;r<s;++r)this.each(l(i[r],e,n));return this}function qo(t,e,n){var i=Fo(t),r=i.CustomEvent;typeof r=="function"?r=new r(e,n):(r=i.document.createEvent("Event"),n?(r.initEvent(e,n.bubbles,n.cancelable),r.detail=n.detail):r.initEvent(e,!1,!1)),t.dispatchEvent(r)}function Wh(t,e){return function(){return qo(this,t,e)}}function Yh(t,e){return function(){return qo(this,t,e.apply(this,arguments))}}function Xh(t,e){return this.each((typeof e=="function"?Yh:Wh)(t,e))}function*Gh(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var i=t[e],r=0,s=i.length,o;r<s;++r)(o=i[r])&&(yield o)}var Ko=[null];function Ft(t,e){this._groups=t,this._parents=e}function li(){return new Ft([[document.documentElement]],Ko)}function Jh(){return this}Ft.prototype=li.prototype={constructor:Ft,select:kd,selectAll:xd,selectChild:Nd,selectChildren:Dd,filter:Rd,data:Vd,enter:$d,exit:Bd,join:qd,merge:Kd,selection:Jh,order:Wd,sort:Yd,call:Gd,nodes:Jd,node:Qd,size:Zd,empty:eh,each:th,attr:ah,style:dh,property:gh,classed:bh,text:Eh,html:Mh,raise:Th,lower:Ph,append:Oh,insert:Dh,remove:$h,clone:Fh,datum:Hh,on:Kh,dispatch:Xh,[Symbol.iterator]:Gh};function mt(t){return typeof t=="string"?new Ft([[document.querySelector(t)]],[document.documentElement]):new Ft([[t]],Ko)}function Qh(t){let e;for(;e=t.sourceEvent;)t=e;return t}function bt(t,e){if(t=Qh(t),e===void 0&&(e=t.currentTarget),e){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var i=n.createSVGPoint();return i.x=t.clientX,i.y=t.clientY,i=i.matrixTransform(e.getScreenCTM().inverse()),[i.x,i.y]}if(e.getBoundingClientRect){var r=e.getBoundingClientRect();return[t.clientX-r.left-e.clientLeft,t.clientY-r.top-e.clientTop]}}return[t.pageX,t.pageY]}const Zh={passive:!1},ai={capture:!0,passive:!1};function Hr(t){t.stopImmediatePropagation()}function Kn(t){t.preventDefault(),t.stopImmediatePropagation()}function Wo(t){var e=t.document.documentElement,n=mt(t).on("dragstart.drag",Kn,ai);"onselectstart"in e?n.on("selectstart.drag",Kn,ai):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function Yo(t,e){var n=t.document.documentElement,i=mt(t).on("dragstart.drag",null);e&&(i.on("click.drag",Kn,ai),setTimeout(function(){i.on("click.drag",null)},0)),"onselectstart"in n?i.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}const Wi=t=>()=>t;function Vr(t,{sourceEvent:e,subject:n,target:i,identifier:r,active:s,x:o,y:l,dx:a,dy:c,dispatch:u}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},subject:{value:n,enumerable:!0,configurable:!0},target:{value:i,enumerable:!0,configurable:!0},identifier:{value:r,enumerable:!0,configurable:!0},active:{value:s,enumerable:!0,configurable:!0},x:{value:o,enumerable:!0,configurable:!0},y:{value:l,enumerable:!0,configurable:!0},dx:{value:a,enumerable:!0,configurable:!0},dy:{value:c,enumerable:!0,configurable:!0},_:{value:u}})}Vr.prototype.on=function(){var t=this._.on.apply(this._,arguments);return t===this._?this:t};function em(t){return!t.ctrlKey&&!t.button}function tm(){return this.parentNode}function nm(t,e){return e??{x:t.x,y:t.y}}function im(){return navigator.maxTouchPoints||"ontouchstart"in this}function rm(){var t=em,e=tm,n=nm,i=im,r={},s=oi("start","drag","end"),o=0,l,a,c,u,h=0;function f(w){w.on("mousedown.drag",d).filter(i).on("touchstart.drag",g).on("touchmove.drag",_,Zh).on("touchend.drag touchcancel.drag",S).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function d(w,k){if(!(u||!t.call(this,w,k))){var N=C(this,e.call(this,w,k),w,k,"mouse");N&&(mt(w.view).on("mousemove.drag",m,ai).on("mouseup.drag",p,ai),Wo(w.view),Hr(w),c=!1,l=w.clientX,a=w.clientY,N("start",w))}}function m(w){if(Kn(w),!c){var k=w.clientX-l,N=w.clientY-a;c=k*k+N*N>h}r.mouse("drag",w)}function p(w){mt(w.view).on("mousemove.drag mouseup.drag",null),Yo(w.view,c),Kn(w),r.mouse("end",w)}function g(w,k){if(t.call(this,w,k)){var N=w.changedTouches,T=e.call(this,w,k),E=N.length,x,O;for(x=0;x<E;++x)(O=C(this,T,w,k,N[x].identifier,N[x]))&&(Hr(w),O("start",w,N[x]))}}function _(w){var k=w.changedTouches,N=k.length,T,E;for(T=0;T<N;++T)(E=r[k[T].identifier])&&(Kn(w),E("drag",w,k[T]))}function S(w){var k=w.changedTouches,N=k.length,T,E;for(u&&clearTimeout(u),u=setTimeout(function(){u=null},500),T=0;T<N;++T)(E=r[k[T].identifier])&&(Hr(w),E("end",w,k[T]))}function C(w,k,N,T,E,x){var O=s.copy(),L=bt(x||N,k),F,D,I;if((I=n.call(w,new Vr("beforestart",{sourceEvent:N,target:f,identifier:E,active:o,x:L[0],y:L[1],dx:0,dy:0,dispatch:O}),T))!=null)return F=I.x-L[0]||0,D=I.y-L[1]||0,function H(P,X,U){var q=L,J;switch(P){case"start":r[E]=H,J=o++;break;case"end":delete r[E],--o;case"drag":L=bt(U||X,k),J=o;break}O.call(P,w,new Vr(P,{sourceEvent:X,subject:I,target:f,identifier:E,active:J,x:L[0]+F,y:L[1]+D,dx:L[0]-q[0],dy:L[1]-q[1],dispatch:O}),T)}}return f.filter=function(w){return arguments.length?(t=typeof w=="function"?w:Wi(!!w),f):t},f.container=function(w){return arguments.length?(e=typeof w=="function"?w:Wi(w),f):e},f.subject=function(w){return arguments.length?(n=typeof w=="function"?w:Wi(w),f):n},f.touchable=function(w){return arguments.length?(i=typeof w=="function"?w:Wi(!!w),f):i},f.on=function(){var w=s.on.apply(s,arguments);return w===s?f:w},f.clickDistance=function(w){return arguments.length?(h=(w=+w)*w,f):Math.sqrt(h)},f}function Ur(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function Xo(t,e){var n=Object.create(t.prototype);for(var i in e)n[i]=e[i];return n}function ci(){}var ui=.7,Yi=1/ui,Wn="\\s*([+-]?\\d+)\\s*",fi="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Zt="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",sm=/^#([0-9a-f]{3,8})$/,om=new RegExp(`^rgb\\(${Wn},${Wn},${Wn}\\)$`),lm=new RegExp(`^rgb\\(${Zt},${Zt},${Zt}\\)$`),am=new RegExp(`^rgba\\(${Wn},${Wn},${Wn},${fi}\\)$`),cm=new RegExp(`^rgba\\(${Zt},${Zt},${Zt},${fi}\\)$`),um=new RegExp(`^hsl\\(${fi},${Zt},${Zt}\\)$`),fm=new RegExp(`^hsla\\(${fi},${Zt},${Zt},${fi}\\)$`),Go={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Ur(ci,Cn,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:Jo,formatHex:Jo,formatHex8:dm,formatHsl:hm,formatRgb:Qo,toString:Qo});function Jo(){return this.rgb().formatHex()}function dm(){return this.rgb().formatHex8()}function hm(){return il(this).formatHsl()}function Qo(){return this.rgb().formatRgb()}function Cn(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=sm.exec(t))?(n=e[1].length,e=parseInt(e[1],16),n===6?Zo(e):n===3?new Dt(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):n===8?Xi(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):n===4?Xi(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=om.exec(t))?new Dt(e[1],e[2],e[3],1):(e=lm.exec(t))?new Dt(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=am.exec(t))?Xi(e[1],e[2],e[3],e[4]):(e=cm.exec(t))?Xi(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=um.exec(t))?nl(e[1],e[2]/100,e[3]/100,1):(e=fm.exec(t))?nl(e[1],e[2]/100,e[3]/100,e[4]):Go.hasOwnProperty(t)?Zo(Go[t]):t==="transparent"?new Dt(NaN,NaN,NaN,0):null}function Zo(t){return new Dt(t>>16&255,t>>8&255,t&255,1)}function Xi(t,e,n,i){return i<=0&&(t=e=n=NaN),new Dt(t,e,n,i)}function mm(t){return t instanceof ci||(t=Cn(t)),t?(t=t.rgb(),new Dt(t.r,t.g,t.b,t.opacity)):new Dt}function Br(t,e,n,i){return arguments.length===1?mm(t):new Dt(t,e,n,i??1)}function Dt(t,e,n,i){this.r=+t,this.g=+e,this.b=+n,this.opacity=+i}Ur(Dt,Br,Xo(ci,{brighter(t){return t=t==null?Yi:Math.pow(Yi,t),new Dt(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?ui:Math.pow(ui,t),new Dt(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new Dt(In(this.r),In(this.g),In(this.b),Gi(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:el,formatHex:el,formatHex8:pm,formatRgb:tl,toString:tl}));function el(){return`#${xn(this.r)}${xn(this.g)}${xn(this.b)}`}function pm(){return`#${xn(this.r)}${xn(this.g)}${xn(this.b)}${xn((isNaN(this.opacity)?1:this.opacity)*255)}`}function tl(){const t=Gi(this.opacity);return`${t===1?"rgb(":"rgba("}${In(this.r)}, ${In(this.g)}, ${In(this.b)}${t===1?")":`, ${t})`}`}function Gi(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function In(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function xn(t){return t=In(t),(t<16?"0":"")+t.toString(16)}function nl(t,e,n,i){return i<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new Gt(t,e,n,i)}function il(t){if(t instanceof Gt)return new Gt(t.h,t.s,t.l,t.opacity);if(t instanceof ci||(t=Cn(t)),!t)return new Gt;if(t instanceof Gt)return t;t=t.rgb();var e=t.r/255,n=t.g/255,i=t.b/255,r=Math.min(e,n,i),s=Math.max(e,n,i),o=NaN,l=s-r,a=(s+r)/2;return l?(e===s?o=(n-i)/l+(n<i)*6:n===s?o=(i-e)/l+2:o=(e-n)/l+4,l/=a<.5?s+r:2-s-r,o*=60):l=a>0&&a<1?0:o,new Gt(o,l,a,t.opacity)}function Ji(t,e,n,i){return arguments.length===1?il(t):new Gt(t,e,n,i??1)}function Gt(t,e,n,i){this.h=+t,this.s=+e,this.l=+n,this.opacity=+i}Ur(Gt,Ji,Xo(ci,{brighter(t){return t=t==null?Yi:Math.pow(Yi,t),new Gt(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?ui:Math.pow(ui,t),new Gt(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,i=n+(n<.5?n:1-n)*e,r=2*n-i;return new Dt(qr(t>=240?t-240:t+120,r,i),qr(t,r,i),qr(t<120?t+240:t-120,r,i),this.opacity)},clamp(){return new Gt(rl(this.h),Qi(this.s),Qi(this.l),Gi(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=Gi(this.opacity);return`${t===1?"hsl(":"hsla("}${rl(this.h)}, ${Qi(this.s)*100}%, ${Qi(this.l)*100}%${t===1?")":`, ${t})`}`}}));function rl(t){return t=(t||0)%360,t<0?t+360:t}function Qi(t){return Math.max(0,Math.min(1,t||0))}function qr(t,e,n){return(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)*255}const Kr=t=>()=>t;function gm(t,e){return function(n){return t+n*e}}function _m(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(i){return Math.pow(t+i*e,n)}}function vm(t){return(t=+t)==1?sl:function(e,n){return n-e?_m(e,n,t):Kr(isNaN(e)?n:e)}}function sl(t,e){var n=e-t;return n?gm(t,n):Kr(isNaN(t)?e:t)}const Zi=function t(e){var n=vm(e);function i(r,s){var o=n((r=Br(r)).r,(s=Br(s)).r),l=n(r.g,s.g),a=n(r.b,s.b),c=sl(r.opacity,s.opacity);return function(u){return r.r=o(u),r.g=l(u),r.b=a(u),r.opacity=c(u),r+""}}return i.gamma=t,i}(1);function ym(t,e){e||(e=[]);var n=t?Math.min(e.length,t.length):0,i=e.slice(),r;return function(s){for(r=0;r<n;++r)i[r]=t[r]*(1-s)+e[r]*s;return i}}function bm(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function wm(t,e){var n=e?e.length:0,i=t?Math.min(n,t.length):0,r=new Array(i),s=new Array(n),o;for(o=0;o<i;++o)r[o]=Xr(t[o],e[o]);for(;o<n;++o)s[o]=e[o];return function(l){for(o=0;o<i;++o)s[o]=r[o](l);return s}}function Sm(t,e){var n=new Date;return t=+t,e=+e,function(i){return n.setTime(t*(1-i)+e*i),n}}function Jt(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}function km(t,e){var n={},i={},r;(t===null||typeof t!="object")&&(t={}),(e===null||typeof e!="object")&&(e={});for(r in e)r in t?n[r]=Xr(t[r],e[r]):i[r]=e[r];return function(s){for(r in n)i[r]=n[r](s);return i}}var Wr=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Yr=new RegExp(Wr.source,"g");function Em(t){return function(){return t}}function Cm(t){return function(e){return t(e)+""}}function ol(t,e){var n=Wr.lastIndex=Yr.lastIndex=0,i,r,s,o=-1,l=[],a=[];for(t=t+"",e=e+"";(i=Wr.exec(t))&&(r=Yr.exec(e));)(s=r.index)>n&&(s=e.slice(n,s),l[o]?l[o]+=s:l[++o]=s),(i=i[0])===(r=r[0])?l[o]?l[o]+=r:l[++o]=r:(l[++o]=null,a.push({i:o,x:Jt(i,r)})),n=Yr.lastIndex;return n<e.length&&(s=e.slice(n),l[o]?l[o]+=s:l[++o]=s),l.length<2?a[0]?Cm(a[0].x):Em(e):(e=a.length,function(c){for(var u=0,h;u<e;++u)l[(h=a[u]).i]=h.x(c);return l.join("")})}function Xr(t,e){var n=typeof e,i;return e==null||n==="boolean"?Kr(e):(n==="number"?Jt:n==="string"?(i=Cn(e))?(e=i,Zi):ol:e instanceof Cn?Zi:e instanceof Date?Sm:bm(e)?ym:Array.isArray(e)?wm:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?km:Jt)(t,e)}function Im(t,e){return t=+t,e=+e,function(n){return Math.round(t*(1-n)+e*n)}}var ll=180/Math.PI,Gr={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function al(t,e,n,i,r,s){var o,l,a;return(o=Math.sqrt(t*t+e*e))&&(t/=o,e/=o),(a=t*n+e*i)&&(n-=t*a,i-=e*a),(l=Math.sqrt(n*n+i*i))&&(n/=l,i/=l,a/=l),t*i<e*n&&(t=-t,e=-e,a=-a,o=-o),{translateX:r,translateY:s,rotate:Math.atan2(e,t)*ll,skewX:Math.atan(a)*ll,scaleX:o,scaleY:l}}var er;function xm(t){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?Gr:al(e.a,e.b,e.c,e.d,e.e,e.f)}function Mm(t){return t==null||(er||(er=document.createElementNS("http://www.w3.org/2000/svg","g")),er.setAttribute("transform",t),!(t=er.transform.baseVal.consolidate()))?Gr:(t=t.matrix,al(t.a,t.b,t.c,t.d,t.e,t.f))}function cl(t,e,n,i){function r(c){return c.length?c.pop()+" ":""}function s(c,u,h,f,d,m){if(c!==h||u!==f){var p=d.push("translate(",null,e,null,n);m.push({i:p-4,x:Jt(c,h)},{i:p-2,x:Jt(u,f)})}else(h||f)&&d.push("translate("+h+e+f+n)}function o(c,u,h,f){c!==u?(c-u>180?u+=360:u-c>180&&(c+=360),f.push({i:h.push(r(h)+"rotate(",null,i)-2,x:Jt(c,u)})):u&&h.push(r(h)+"rotate("+u+i)}function l(c,u,h,f){c!==u?f.push({i:h.push(r(h)+"skewX(",null,i)-2,x:Jt(c,u)}):u&&h.push(r(h)+"skewX("+u+i)}function a(c,u,h,f,d,m){if(c!==h||u!==f){var p=d.push(r(d)+"scale(",null,",",null,")");m.push({i:p-4,x:Jt(c,h)},{i:p-2,x:Jt(u,f)})}else(h!==1||f!==1)&&d.push(r(d)+"scale("+h+","+f+")")}return function(c,u){var h=[],f=[];return c=t(c),u=t(u),s(c.translateX,c.translateY,u.translateX,u.translateY,h,f),o(c.rotate,u.rotate,h,f),l(c.skewX,u.skewX,h,f),a(c.scaleX,c.scaleY,u.scaleX,u.scaleY,h,f),c=u=null,function(d){for(var m=-1,p=f.length,g;++m<p;)h[(g=f[m]).i]=g.x(d);return h.join("")}}}var Am=cl(xm,"px, ","px)","deg)"),Tm=cl(Mm,", ",")",")"),Nm=1e-12;function ul(t){return((t=Math.exp(t))+1/t)/2}function Pm(t){return((t=Math.exp(t))-1/t)/2}function Om(t){return((t=Math.exp(2*t))-1)/(t+1)}const Lm=function t(e,n,i){function r(s,o){var l=s[0],a=s[1],c=s[2],u=o[0],h=o[1],f=o[2],d=u-l,m=h-a,p=d*d+m*m,g,_;if(p<Nm)_=Math.log(f/c)/e,g=function(T){return[l+T*d,a+T*m,c*Math.exp(e*T*_)]};else{var S=Math.sqrt(p),C=(f*f-c*c+i*p)/(2*c*n*S),w=(f*f-c*c-i*p)/(2*f*n*S),k=Math.log(Math.sqrt(C*C+1)-C),N=Math.log(Math.sqrt(w*w+1)-w);_=(N-k)/e,g=function(T){var E=T*_,x=ul(k),O=c/(n*S)*(x*Om(e*E+k)-Pm(k));return[l+O*d,a+O*m,c*x/ul(e*E+k)]}}return g.duration=_*1e3*e/Math.SQRT2,g}return r.rho=function(s){var o=Math.max(.001,+s),l=o*o,a=l*l;return t(o,l,a)},r}(Math.SQRT2,2,4);var Yn=0,di=0,hi=0,fl=1e3,tr,mi,nr=0,Mn=0,ir=0,pi=typeof performance=="object"&&performance.now?performance:Date,dl=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function Jr(){return Mn||(dl(Dm),Mn=pi.now()+ir)}function Dm(){Mn=0}function rr(){this._call=this._time=this._next=null}rr.prototype=Qr.prototype={constructor:rr,restart:function(t,e,n){if(typeof t!="function")throw new TypeError("callback is not a function");n=(n==null?Jr():+n)+(e==null?0:+e),!this._next&&mi!==this&&(mi?mi._next=this:tr=this,mi=this),this._call=t,this._time=n,Zr()},stop:function(){this._call&&(this._call=null,this._time=1/0,Zr())}};function Qr(t,e,n){var i=new rr;return i.restart(t,e,n),i}function Rm(){Jr(),++Yn;for(var t=tr,e;t;)(e=Mn-t._time)>=0&&t._call.call(void 0,e),t=t._next;--Yn}function hl(){Mn=(nr=pi.now())+ir,Yn=di=0;try{Rm()}finally{Yn=0,zm(),Mn=0}}function $m(){var t=pi.now(),e=t-nr;e>fl&&(ir-=e,nr=t)}function zm(){for(var t,e=tr,n,i=1/0;e;)e._call?(i>e._time&&(i=e._time),t=e,e=e._next):(n=e._next,e._next=null,e=t?t._next=n:tr=n);mi=t,Zr(i)}function Zr(t){if(!Yn){di&&(di=clearTimeout(di));var e=t-Mn;e>24?(t<1/0&&(di=setTimeout(hl,t-pi.now()-ir)),hi&&(hi=clearInterval(hi))):(hi||(nr=pi.now(),hi=setInterval($m,fl)),Yn=1,dl(hl))}}function ml(t,e,n){var i=new rr;return e=e==null?0:+e,i.restart(r=>{i.stop(),t(r+e)},e,n),i}var jm=oi("start","end","cancel","interrupt"),Fm=[],pl=0,gl=1,es=2,sr=3,_l=4,ts=5,or=6;function lr(t,e,n,i,r,s){var o=t.__transition;if(!o)t.__transition={};else if(n in o)return;Hm(t,n,{name:e,index:i,group:r,on:jm,tween:Fm,time:s.time,delay:s.delay,duration:s.duration,ease:s.ease,timer:null,state:pl})}function ns(t,e){var n=Qt(t,e);if(n.state>pl)throw new Error("too late; already scheduled");return n}function en(t,e){var n=Qt(t,e);if(n.state>sr)throw new Error("too late; already running");return n}function Qt(t,e){var n=t.__transition;if(!n||!(n=n[e]))throw new Error("transition not found");return n}function Hm(t,e,n){var i=t.__transition,r;i[e]=n,n.timer=Qr(s,0,n.time);function s(c){n.state=gl,n.timer.restart(o,n.delay,n.time),n.delay<=c&&o(c-n.delay)}function o(c){var u,h,f,d;if(n.state!==gl)return a();for(u in i)if(d=i[u],d.name===n.name){if(d.state===sr)return ml(o);d.state===_l?(d.state=or,d.timer.stop(),d.on.call("interrupt",t,t.__data__,d.index,d.group),delete i[u]):+u<e&&(d.state=or,d.timer.stop(),d.on.call("cancel",t,t.__data__,d.index,d.group),delete i[u])}if(ml(function(){n.state===sr&&(n.state=_l,n.timer.restart(l,n.delay,n.time),l(c))}),n.state=es,n.on.call("start",t,t.__data__,n.index,n.group),n.state===es){for(n.state=sr,r=new Array(f=n.tween.length),u=0,h=-1;u<f;++u)(d=n.tween[u].value.call(t,t.__data__,n.index,n.group))&&(r[++h]=d);r.length=h+1}}function l(c){for(var u=c<n.duration?n.ease.call(null,c/n.duration):(n.timer.restart(a),n.state=ts,1),h=-1,f=r.length;++h<f;)r[h].call(t,u);n.state===ts&&(n.on.call("end",t,t.__data__,n.index,n.group),a())}function a(){n.state=or,n.timer.stop(),delete i[e];for(var c in i)return;delete t.__transition}}function ar(t,e){var n=t.__transition,i,r,s=!0,o;if(n){e=e==null?null:e+"";for(o in n){if((i=n[o]).name!==e){s=!1;continue}r=i.state>es&&i.state<ts,i.state=or,i.timer.stop(),i.on.call(r?"interrupt":"cancel",t,t.__data__,i.index,i.group),delete n[o]}s&&delete t.__transition}}function Vm(t){return this.each(function(){ar(this,t)})}function Um(t,e){var n,i;return function(){var r=en(this,t),s=r.tween;if(s!==n){i=n=s;for(var o=0,l=i.length;o<l;++o)if(i[o].name===e){i=i.slice(),i.splice(o,1);break}}r.tween=i}}function Bm(t,e,n){var i,r;if(typeof n!="function")throw new Error;return function(){var s=en(this,t),o=s.tween;if(o!==i){r=(i=o).slice();for(var l={name:e,value:n},a=0,c=r.length;a<c;++a)if(r[a].name===e){r[a]=l;break}a===c&&r.push(l)}s.tween=r}}function qm(t,e){var n=this._id;if(t+="",arguments.length<2){for(var i=Qt(this.node(),n).tween,r=0,s=i.length,o;r<s;++r)if((o=i[r]).name===t)return o.value;return null}return this.each((e==null?Um:Bm)(n,t,e))}function is(t,e,n){var i=t._id;return t.each(function(){var r=en(this,i);(r.value||(r.value={}))[e]=n.apply(this,arguments)}),function(r){return Qt(r,i).value[e]}}function vl(t,e){var n;return(typeof e=="number"?Jt:e instanceof Cn?Zi:(n=Cn(e))?(e=n,Zi):ol)(t,e)}function Km(t){return function(){this.removeAttribute(t)}}function Wm(t){return function(){this.removeAttributeNS(t.space,t.local)}}function Ym(t,e,n){var i,r=n+"",s;return function(){var o=this.getAttribute(t);return o===r?null:o===i?s:s=e(i=o,n)}}function Xm(t,e,n){var i,r=n+"",s;return function(){var o=this.getAttributeNS(t.space,t.local);return o===r?null:o===i?s:s=e(i=o,n)}}function Gm(t,e,n){var i,r,s;return function(){var o,l=n(this),a;return l==null?void this.removeAttribute(t):(o=this.getAttribute(t),a=l+"",o===a?null:o===i&&a===r?s:(r=a,s=e(i=o,l)))}}function Jm(t,e,n){var i,r,s;return function(){var o,l=n(this),a;return l==null?void this.removeAttributeNS(t.space,t.local):(o=this.getAttributeNS(t.space,t.local),a=l+"",o===a?null:o===i&&a===r?s:(r=a,s=e(i=o,l)))}}function Qm(t,e){var n=qi(t),i=n==="transform"?Tm:vl;return this.attrTween(t,typeof e=="function"?(n.local?Jm:Gm)(n,i,is(this,"attr."+t,e)):e==null?(n.local?Wm:Km)(n):(n.local?Xm:Ym)(n,i,e))}function Zm(t,e){return function(n){this.setAttribute(t,e.call(this,n))}}function ep(t,e){return function(n){this.setAttributeNS(t.space,t.local,e.call(this,n))}}function tp(t,e){var n,i;function r(){var s=e.apply(this,arguments);return s!==i&&(n=(i=s)&&ep(t,s)),n}return r._value=e,r}function np(t,e){var n,i;function r(){var s=e.apply(this,arguments);return s!==i&&(n=(i=s)&&Zm(t,s)),n}return r._value=e,r}function ip(t,e){var n="attr."+t;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(e==null)return this.tween(n,null);if(typeof e!="function")throw new Error;var i=qi(t);return this.tween(n,(i.local?tp:np)(i,e))}function rp(t,e){return function(){ns(this,t).delay=+e.apply(this,arguments)}}function sp(t,e){return e=+e,function(){ns(this,t).delay=e}}function op(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?rp:sp)(e,t)):Qt(this.node(),e).delay}function lp(t,e){return function(){en(this,t).duration=+e.apply(this,arguments)}}function ap(t,e){return e=+e,function(){en(this,t).duration=e}}function cp(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?lp:ap)(e,t)):Qt(this.node(),e).duration}function up(t,e){if(typeof e!="function")throw new Error;return function(){en(this,t).ease=e}}function fp(t){var e=this._id;return arguments.length?this.each(up(e,t)):Qt(this.node(),e).ease}function dp(t,e){return function(){var n=e.apply(this,arguments);if(typeof n!="function")throw new Error;en(this,t).ease=n}}function hp(t){if(typeof t!="function")throw new Error;return this.each(dp(this._id,t))}function mp(t){typeof t!="function"&&(t=$o(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var s=e[r],o=s.length,l=i[r]=[],a,c=0;c<o;++c)(a=s[c])&&t.call(a,a.__data__,c,s)&&l.push(a);return new an(i,this._parents,this._name,this._id)}function pp(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,n=t._groups,i=e.length,r=n.length,s=Math.min(i,r),o=new Array(i),l=0;l<s;++l)for(var a=e[l],c=n[l],u=a.length,h=o[l]=new Array(u),f,d=0;d<u;++d)(f=a[d]||c[d])&&(h[d]=f);for(;l<i;++l)o[l]=e[l];return new an(o,this._parents,this._name,this._id)}function gp(t){return(t+"").trim().split(/^|\s+/).every(function(e){var n=e.indexOf(".");return n>=0&&(e=e.slice(0,n)),!e||e==="start"})}function _p(t,e,n){var i,r,s=gp(e)?ns:en;return function(){var o=s(this,t),l=o.on;l!==i&&(r=(i=l).copy()).on(e,n),o.on=r}}function vp(t,e){var n=this._id;return arguments.length<2?Qt(this.node(),n).on.on(t):this.each(_p(n,t,e))}function yp(t){return function(){var e=this.parentNode;for(var n in this.__transition)if(+n!==t)return;e&&e.removeChild(this)}}function bp(){return this.on("end.remove",yp(this._id))}function wp(t){var e=this._name,n=this._id;typeof t!="function"&&(t=jr(t));for(var i=this._groups,r=i.length,s=new Array(r),o=0;o<r;++o)for(var l=i[o],a=l.length,c=s[o]=new Array(a),u,h,f=0;f<a;++f)(u=l[f])&&(h=t.call(u,u.__data__,f,l))&&("__data__"in u&&(h.__data__=u.__data__),c[f]=h,lr(c[f],e,n,f,c,Qt(u,n)));return new an(s,this._parents,e,n)}function Sp(t){var e=this._name,n=this._id;typeof t!="function"&&(t=Ro(t));for(var i=this._groups,r=i.length,s=[],o=[],l=0;l<r;++l)for(var a=i[l],c=a.length,u,h=0;h<c;++h)if(u=a[h]){for(var f=t.call(u,u.__data__,h,a),d,m=Qt(u,n),p=0,g=f.length;p<g;++p)(d=f[p])&&lr(d,e,n,p,f,m);s.push(f),o.push(u)}return new an(s,o,e,n)}var kp=li.prototype.constructor;function Ep(){return new kp(this._groups,this._parents)}function Cp(t,e){var n,i,r;return function(){var s=qn(this,t),o=(this.style.removeProperty(t),qn(this,t));return s===o?null:s===n&&o===i?r:r=e(n=s,i=o)}}function yl(t){return function(){this.style.removeProperty(t)}}function Ip(t,e,n){var i,r=n+"",s;return function(){var o=qn(this,t);return o===r?null:o===i?s:s=e(i=o,n)}}function xp(t,e,n){var i,r,s;return function(){var o=qn(this,t),l=n(this),a=l+"";return l==null&&(a=l=(this.style.removeProperty(t),qn(this,t))),o===a?null:o===i&&a===r?s:(r=a,s=e(i=o,l))}}function Mp(t,e){var n,i,r,s="style."+e,o="end."+s,l;return function(){var a=en(this,t),c=a.on,u=a.value[s]==null?l||(l=yl(e)):void 0;(c!==n||r!==u)&&(i=(n=c).copy()).on(o,r=u),a.on=i}}function Ap(t,e,n){var i=(t+="")=="transform"?Am:vl;return e==null?this.styleTween(t,Cp(t,i)).on("end.style."+t,yl(t)):typeof e=="function"?this.styleTween(t,xp(t,i,is(this,"style."+t,e))).each(Mp(this._id,t)):this.styleTween(t,Ip(t,i,e),n).on("end.style."+t,null)}function Tp(t,e,n){return function(i){this.style.setProperty(t,e.call(this,i),n)}}function Np(t,e,n){var i,r;function s(){var o=e.apply(this,arguments);return o!==r&&(i=(r=o)&&Tp(t,o,n)),i}return s._value=e,s}function Pp(t,e,n){var i="style."+(t+="");if(arguments.length<2)return(i=this.tween(i))&&i._value;if(e==null)return this.tween(i,null);if(typeof e!="function")throw new Error;return this.tween(i,Np(t,e,n??""))}function Op(t){return function(){this.textContent=t}}function Lp(t){return function(){var e=t(this);this.textContent=e??""}}function Dp(t){return this.tween("text",typeof t=="function"?Lp(is(this,"text",t)):Op(t==null?"":t+""))}function Rp(t){return function(e){this.textContent=t.call(this,e)}}function $p(t){var e,n;function i(){var r=t.apply(this,arguments);return r!==n&&(e=(n=r)&&Rp(r)),e}return i._value=t,i}function zp(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(t==null)return this.tween(e,null);if(typeof t!="function")throw new Error;return this.tween(e,$p(t))}function jp(){for(var t=this._name,e=this._id,n=bl(),i=this._groups,r=i.length,s=0;s<r;++s)for(var o=i[s],l=o.length,a,c=0;c<l;++c)if(a=o[c]){var u=Qt(a,e);lr(a,t,n,c,o,{time:u.time+u.delay+u.duration,delay:0,duration:u.duration,ease:u.ease})}return new an(i,this._parents,t,n)}function Fp(){var t,e,n=this,i=n._id,r=n.size();return new Promise(function(s,o){var l={value:o},a={value:function(){--r===0&&s()}};n.each(function(){var c=en(this,i),u=c.on;u!==t&&(e=(t=u).copy(),e._.cancel.push(l),e._.interrupt.push(l),e._.end.push(a)),c.on=e}),r===0&&s()})}var Hp=0;function an(t,e,n,i){this._groups=t,this._parents=e,this._name=n,this._id=i}function bl(){return++Hp}var cn=li.prototype;an.prototype={constructor:an,select:wp,selectAll:Sp,selectChild:cn.selectChild,selectChildren:cn.selectChildren,filter:mp,merge:pp,selection:Ep,transition:jp,call:cn.call,nodes:cn.nodes,node:cn.node,size:cn.size,empty:cn.empty,each:cn.each,on:vp,attr:Qm,attrTween:ip,style:Ap,styleTween:Pp,text:Dp,textTween:zp,remove:bp,tween:qm,delay:op,duration:cp,ease:fp,easeVarying:hp,end:Fp,[Symbol.iterator]:cn[Symbol.iterator]};function Vp(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}var Up={time:null,delay:0,duration:250,ease:Vp};function Bp(t,e){for(var n;!(n=t.__transition)||!(n=n[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return n}function qp(t){var e,n;t instanceof an?(e=t._id,t=t._name):(e=bl(),(n=Up).time=Jr(),t=t==null?null:t+"");for(var i=this._groups,r=i.length,s=0;s<r;++s)for(var o=i[s],l=o.length,a,c=0;c<l;++c)(a=o[c])&&lr(a,t,e,c,o,n||Bp(a,e));return new an(i,this._parents,t,e)}li.prototype.interrupt=Vm,li.prototype.transition=qp;function wl(t,e){var n,i=1;t==null&&(t=0),e==null&&(e=0);function r(){var s,o=n.length,l,a=0,c=0;for(s=0;s<o;++s)l=n[s],a+=l.x,c+=l.y;for(a=(a/o-t)*i,c=(c/o-e)*i,s=0;s<o;++s)l=n[s],l.x-=a,l.y-=c}return r.initialize=function(s){n=s},r.x=function(s){return arguments.length?(t=+s,r):t},r.y=function(s){return arguments.length?(e=+s,r):e},r.strength=function(s){return arguments.length?(i=+s,r):i},r}function Kp(t){const e=+this._x.call(null,t),n=+this._y.call(null,t);return Sl(this.cover(e,n),e,n,t)}function Sl(t,e,n,i){if(isNaN(e)||isNaN(n))return t;var r,s=t._root,o={data:i},l=t._x0,a=t._y0,c=t._x1,u=t._y1,h,f,d,m,p,g,_,S;if(!s)return t._root=o,t;for(;s.length;)if((p=e>=(h=(l+c)/2))?l=h:c=h,(g=n>=(f=(a+u)/2))?a=f:u=f,r=s,!(s=s[_=g<<1|p]))return r[_]=o,t;if(d=+t._x.call(null,s.data),m=+t._y.call(null,s.data),e===d&&n===m)return o.next=s,r?r[_]=o:t._root=o,t;do r=r?r[_]=new Array(4):t._root=new Array(4),(p=e>=(h=(l+c)/2))?l=h:c=h,(g=n>=(f=(a+u)/2))?a=f:u=f;while((_=g<<1|p)===(S=(m>=f)<<1|d>=h));return r[S]=s,r[_]=o,t}function Wp(t){var e,n,i=t.length,r,s,o=new Array(i),l=new Array(i),a=1/0,c=1/0,u=-1/0,h=-1/0;for(n=0;n<i;++n)isNaN(r=+this._x.call(null,e=t[n]))||isNaN(s=+this._y.call(null,e))||(o[n]=r,l[n]=s,r<a&&(a=r),r>u&&(u=r),s<c&&(c=s),s>h&&(h=s));if(a>u||c>h)return this;for(this.cover(a,c).cover(u,h),n=0;n<i;++n)Sl(this,o[n],l[n],t[n]);return this}function Yp(t,e){if(isNaN(t=+t)||isNaN(e=+e))return this;var n=this._x0,i=this._y0,r=this._x1,s=this._y1;if(isNaN(n))r=(n=Math.floor(t))+1,s=(i=Math.floor(e))+1;else{for(var o=r-n||1,l=this._root,a,c;n>t||t>=r||i>e||e>=s;)switch(c=(e<i)<<1|t<n,a=new Array(4),a[c]=l,l=a,o*=2,c){case 0:r=n+o,s=i+o;break;case 1:n=r-o,s=i+o;break;case 2:r=n+o,i=s-o;break;case 3:n=r-o,i=s-o;break}this._root&&this._root.length&&(this._root=l)}return this._x0=n,this._y0=i,this._x1=r,this._y1=s,this}function Xp(){var t=[];return this.visit(function(e){if(!e.length)do t.push(e.data);while(e=e.next)}),t}function Gp(t){return arguments.length?this.cover(+t[0][0],+t[0][1]).cover(+t[1][0],+t[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function Pt(t,e,n,i,r){this.node=t,this.x0=e,this.y0=n,this.x1=i,this.y1=r}function Jp(t,e,n){var i,r=this._x0,s=this._y0,o,l,a,c,u=this._x1,h=this._y1,f=[],d=this._root,m,p;for(d&&f.push(new Pt(d,r,s,u,h)),n==null?n=1/0:(r=t-n,s=e-n,u=t+n,h=e+n,n*=n);m=f.pop();)if(!(!(d=m.node)||(o=m.x0)>u||(l=m.y0)>h||(a=m.x1)<r||(c=m.y1)<s))if(d.length){var g=(o+a)/2,_=(l+c)/2;f.push(new Pt(d[3],g,_,a,c),new Pt(d[2],o,_,g,c),new Pt(d[1],g,l,a,_),new Pt(d[0],o,l,g,_)),(p=(e>=_)<<1|t>=g)&&(m=f[f.length-1],f[f.length-1]=f[f.length-1-p],f[f.length-1-p]=m)}else{var S=t-+this._x.call(null,d.data),C=e-+this._y.call(null,d.data),w=S*S+C*C;if(w<n){var k=Math.sqrt(n=w);r=t-k,s=e-k,u=t+k,h=e+k,i=d.data}}return i}function Qp(t){if(isNaN(u=+this._x.call(null,t))||isNaN(h=+this._y.call(null,t)))return this;var e,n=this._root,i,r,s,o=this._x0,l=this._y0,a=this._x1,c=this._y1,u,h,f,d,m,p,g,_;if(!n)return this;if(n.length)for(;;){if((m=u>=(f=(o+a)/2))?o=f:a=f,(p=h>=(d=(l+c)/2))?l=d:c=d,e=n,!(n=n[g=p<<1|m]))return this;if(!n.length)break;(e[g+1&3]||e[g+2&3]||e[g+3&3])&&(i=e,_=g)}for(;n.data!==t;)if(r=n,!(n=n.next))return this;return(s=n.next)&&delete n.next,r?(s?r.next=s:delete r.next,this):e?(s?e[g]=s:delete e[g],(n=e[0]||e[1]||e[2]||e[3])&&n===(e[3]||e[2]||e[1]||e[0])&&!n.length&&(i?i[_]=n:this._root=n),this):(this._root=s,this)}function Zp(t){for(var e=0,n=t.length;e<n;++e)this.remove(t[e]);return this}function eg(){return this._root}function tg(){var t=0;return this.visit(function(e){if(!e.length)do++t;while(e=e.next)}),t}function ng(t){var e=[],n,i=this._root,r,s,o,l,a;for(i&&e.push(new Pt(i,this._x0,this._y0,this._x1,this._y1));n=e.pop();)if(!t(i=n.node,s=n.x0,o=n.y0,l=n.x1,a=n.y1)&&i.length){var c=(s+l)/2,u=(o+a)/2;(r=i[3])&&e.push(new Pt(r,c,u,l,a)),(r=i[2])&&e.push(new Pt(r,s,u,c,a)),(r=i[1])&&e.push(new Pt(r,c,o,l,u)),(r=i[0])&&e.push(new Pt(r,s,o,c,u))}return this}function ig(t){var e=[],n=[],i;for(this._root&&e.push(new Pt(this._root,this._x0,this._y0,this._x1,this._y1));i=e.pop();){var r=i.node;if(r.length){var s,o=i.x0,l=i.y0,a=i.x1,c=i.y1,u=(o+a)/2,h=(l+c)/2;(s=r[0])&&e.push(new Pt(s,o,l,u,h)),(s=r[1])&&e.push(new Pt(s,u,l,a,h)),(s=r[2])&&e.push(new Pt(s,o,h,u,c)),(s=r[3])&&e.push(new Pt(s,u,h,a,c))}n.push(i)}for(;i=n.pop();)t(i.node,i.x0,i.y0,i.x1,i.y1);return this}function rg(t){return t[0]}function sg(t){return arguments.length?(this._x=t,this):this._x}function og(t){return t[1]}function lg(t){return arguments.length?(this._y=t,this):this._y}function rs(t,e,n){var i=new ss(e??rg,n??og,NaN,NaN,NaN,NaN);return t==null?i:i.addAll(t)}function ss(t,e,n,i,r,s){this._x=t,this._y=e,this._x0=n,this._y0=i,this._x1=r,this._y1=s,this._root=void 0}function kl(t){for(var e={data:t.data},n=e;t=t.next;)n=n.next={data:t.data};return e}var Ot=rs.prototype=ss.prototype;Ot.copy=function(){var t=new ss(this._x,this._y,this._x0,this._y0,this._x1,this._y1),e=this._root,n,i;if(!e)return t;if(!e.length)return t._root=kl(e),t;for(n=[{source:e,target:t._root=new Array(4)}];e=n.pop();)for(var r=0;r<4;++r)(i=e.source[r])&&(i.length?n.push({source:i,target:e.target[r]=new Array(4)}):e.target[r]=kl(i));return t},Ot.add=Kp,Ot.addAll=Wp,Ot.cover=Yp,Ot.data=Xp,Ot.extent=Gp,Ot.find=Jp,Ot.remove=Qp,Ot.removeAll=Zp,Ot.root=eg,Ot.size=tg,Ot.visit=ng,Ot.visitAfter=ig,Ot.x=sg,Ot.y=lg;function Lt(t){return function(){return t}}function wn(t){return(t()-.5)*1e-6}function ag(t){return t.x+t.vx}function cg(t){return t.y+t.vy}function El(t){var e,n,i,r=1,s=1;typeof t!="function"&&(t=Lt(t==null?1:+t));function o(){for(var c,u=e.length,h,f,d,m,p,g,_=0;_<s;++_)for(h=rs(e,ag,cg).visitAfter(l),c=0;c<u;++c)f=e[c],p=n[f.index],g=p*p,d=f.x+f.vx,m=f.y+f.vy,h.visit(S);function S(C,w,k,N,T){var E=C.data,x=C.r,O=p+x;if(E){if(E.index>f.index){var L=d-E.x-E.vx,F=m-E.y-E.vy,D=L*L+F*F;D<O*O&&(L===0&&(L=wn(i),D+=L*L),F===0&&(F=wn(i),D+=F*F),D=(O-(D=Math.sqrt(D)))/D*r,f.vx+=(L*=D)*(O=(x*=x)/(g+x)),f.vy+=(F*=D)*O,E.vx-=L*(O=1-O),E.vy-=F*O)}return}return w>d+O||N<d-O||k>m+O||T<m-O}}function l(c){if(c.data)return c.r=n[c.data.index];for(var u=c.r=0;u<4;++u)c[u]&&c[u].r>c.r&&(c.r=c[u].r)}function a(){if(e){var c,u=e.length,h;for(n=new Array(u),c=0;c<u;++c)h=e[c],n[h.index]=+t(h,c,e)}}return o.initialize=function(c,u){e=c,i=u,a()},o.iterations=function(c){return arguments.length?(s=+c,o):s},o.strength=function(c){return arguments.length?(r=+c,o):r},o.radius=function(c){return arguments.length?(t=typeof c=="function"?c:Lt(+c),a(),o):t},o}function ug(t){return t.index}function Cl(t,e){var n=t.get(e);if(!n)throw new Error("node not found: "+e);return n}function Il(t){var e=ug,n=h,i,r=Lt(30),s,o,l,a,c,u=1;t==null&&(t=[]);function h(g){return 1/Math.min(l[g.source.index],l[g.target.index])}function f(g){for(var _=0,S=t.length;_<u;++_)for(var C=0,w,k,N,T,E,x,O;C<S;++C)w=t[C],k=w.source,N=w.target,T=N.x+N.vx-k.x-k.vx||wn(c),E=N.y+N.vy-k.y-k.vy||wn(c),x=Math.sqrt(T*T+E*E),x=(x-s[C])/x*g*i[C],T*=x,E*=x,N.vx-=T*(O=a[C]),N.vy-=E*O,k.vx+=T*(O=1-O),k.vy+=E*O}function d(){if(o){var g,_=o.length,S=t.length,C=new Map(o.map((k,N)=>[e(k,N,o),k])),w;for(g=0,l=new Array(_);g<S;++g)w=t[g],w.index=g,typeof w.source!="object"&&(w.source=Cl(C,w.source)),typeof w.target!="object"&&(w.target=Cl(C,w.target)),l[w.source.index]=(l[w.source.index]||0)+1,l[w.target.index]=(l[w.target.index]||0)+1;for(g=0,a=new Array(S);g<S;++g)w=t[g],a[g]=l[w.source.index]/(l[w.source.index]+l[w.target.index]);i=new Array(S),m(),s=new Array(S),p()}}function m(){if(o)for(var g=0,_=t.length;g<_;++g)i[g]=+n(t[g],g,t)}function p(){if(o)for(var g=0,_=t.length;g<_;++g)s[g]=+r(t[g],g,t)}return f.initialize=function(g,_){o=g,c=_,d()},f.links=function(g){return arguments.length?(t=g,d(),f):t},f.id=function(g){return arguments.length?(e=g,f):e},f.iterations=function(g){return arguments.length?(u=+g,f):u},f.strength=function(g){return arguments.length?(n=typeof g=="function"?g:Lt(+g),m(),f):n},f.distance=function(g){return arguments.length?(r=typeof g=="function"?g:Lt(+g),p(),f):r},f}const fg=1664525,dg=1013904223,xl=4294967296;function hg(){let t=1;return()=>(t=(fg*t+dg)%xl)/xl}function mg(t){return t.x}function pg(t){return t.y}var gg=10,_g=Math.PI*(3-Math.sqrt(5));function Ml(t){var e,n=1,i=.001,r=1-Math.pow(i,1/300),s=0,o=.6,l=new Map,a=Qr(h),c=oi("tick","end"),u=hg();t==null&&(t=[]);function h(){f(),c.call("tick",e),n<i&&(a.stop(),c.call("end",e))}function f(p){var g,_=t.length,S;p===void 0&&(p=1);for(var C=0;C<p;++C)for(n+=(s-n)*r,l.forEach(function(w){w(n)}),g=0;g<_;++g)S=t[g],S.fx==null?S.x+=S.vx*=o:(S.x=S.fx,S.vx=0),S.fy==null?S.y+=S.vy*=o:(S.y=S.fy,S.vy=0);return e}function d(){for(var p=0,g=t.length,_;p<g;++p){if(_=t[p],_.index=p,_.fx!=null&&(_.x=_.fx),_.fy!=null&&(_.y=_.fy),isNaN(_.x)||isNaN(_.y)){var S=gg*Math.sqrt(.5+p),C=p*_g;_.x=S*Math.cos(C),_.y=S*Math.sin(C)}(isNaN(_.vx)||isNaN(_.vy))&&(_.vx=_.vy=0)}}function m(p){return p.initialize&&p.initialize(t,u),p}return d(),e={tick:f,restart:function(){return a.restart(h),e},stop:function(){return a.stop(),e},nodes:function(p){return arguments.length?(t=p,d(),l.forEach(m),e):t},alpha:function(p){return arguments.length?(n=+p,e):n},alphaMin:function(p){return arguments.length?(i=+p,e):i},alphaDecay:function(p){return arguments.length?(r=+p,e):+r},alphaTarget:function(p){return arguments.length?(s=+p,e):s},velocityDecay:function(p){return arguments.length?(o=1-p,e):1-o},randomSource:function(p){return arguments.length?(u=p,l.forEach(m),e):u},force:function(p,g){return arguments.length>1?(g==null?l.delete(p):l.set(p,m(g)),e):l.get(p)},find:function(p,g,_){var S=0,C=t.length,w,k,N,T,E;for(_==null?_=1/0:_*=_,S=0;S<C;++S)T=t[S],w=p-T.x,k=g-T.y,N=w*w+k*k,N<_&&(E=T,_=N);return E},on:function(p,g){return arguments.length>1?(c.on(p,g),e):c.on(p)}}}function Al(){var t,e,n,i,r=Lt(-30),s,o=1,l=1/0,a=.81;function c(d){var m,p=t.length,g=rs(t,mg,pg).visitAfter(h);for(i=d,m=0;m<p;++m)e=t[m],g.visit(f)}function u(){if(t){var d,m=t.length,p;for(s=new Array(m),d=0;d<m;++d)p=t[d],s[p.index]=+r(p,d,t)}}function h(d){var m=0,p,g,_=0,S,C,w;if(d.length){for(S=C=w=0;w<4;++w)(p=d[w])&&(g=Math.abs(p.value))&&(m+=p.value,_+=g,S+=g*p.x,C+=g*p.y);d.x=S/_,d.y=C/_}else{p=d,p.x=p.data.x,p.y=p.data.y;do m+=s[p.data.index];while(p=p.next)}d.value=m}function f(d,m,p,g){if(!d.value)return!0;var _=d.x-e.x,S=d.y-e.y,C=g-m,w=_*_+S*S;if(C*C/a<w)return w<l&&(_===0&&(_=wn(n),w+=_*_),S===0&&(S=wn(n),w+=S*S),w<o&&(w=Math.sqrt(o*w)),e.vx+=_*d.value*i/w,e.vy+=S*d.value*i/w),!0;if(d.length||w>=l)return;(d.data!==e||d.next)&&(_===0&&(_=wn(n),w+=_*_),S===0&&(S=wn(n),w+=S*S),w<o&&(w=Math.sqrt(o*w)));do d.data!==e&&(C=s[d.data.index]*i/w,e.vx+=_*C,e.vy+=S*C);while(d=d.next)}return c.initialize=function(d,m){t=d,n=m,u()},c.strength=function(d){return arguments.length?(r=typeof d=="function"?d:Lt(+d),u(),c):r},c.distanceMin=function(d){return arguments.length?(o=d*d,c):Math.sqrt(o)},c.distanceMax=function(d){return arguments.length?(l=d*d,c):Math.sqrt(l)},c.theta=function(d){return arguments.length?(a=d*d,c):Math.sqrt(a)},c}function Tl(t){var e=Lt(.1),n,i,r;typeof t!="function"&&(t=Lt(t==null?0:+t));function s(l){for(var a=0,c=n.length,u;a<c;++a)u=n[a],u.vx+=(r[a]-u.x)*i[a]*l}function o(){if(n){var l,a=n.length;for(i=new Array(a),r=new Array(a),l=0;l<a;++l)i[l]=isNaN(r[l]=+t(n[l],l,n))?0:+e(n[l],l,n)}}return s.initialize=function(l){n=l,o()},s.strength=function(l){return arguments.length?(e=typeof l=="function"?l:Lt(+l),o(),s):e},s.x=function(l){return arguments.length?(t=typeof l=="function"?l:Lt(+l),o(),s):t},s}function Nl(t){var e=Lt(.1),n,i,r;typeof t!="function"&&(t=Lt(t==null?0:+t));function s(l){for(var a=0,c=n.length,u;a<c;++a)u=n[a],u.vy+=(r[a]-u.y)*i[a]*l}function o(){if(n){var l,a=n.length;for(i=new Array(a),r=new Array(a),l=0;l<a;++l)i[l]=isNaN(r[l]=+t(n[l],l,n))?0:+e(n[l],l,n)}}return s.initialize=function(l){n=l,o()},s.strength=function(l){return arguments.length?(e=typeof l=="function"?l:Lt(+l),o(),s):e},s.y=function(l){return arguments.length?(t=typeof l=="function"?l:Lt(+l),o(),s):t},s}function vg(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)}function cr(t,e){if((n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var n,i=t.slice(0,n);return[i.length>1?i[0]+i.slice(2):i,+t.slice(n+1)]}function Xn(t){return t=cr(Math.abs(t)),t?t[1]:NaN}function yg(t,e){return function(n,i){for(var r=n.length,s=[],o=0,l=t[0],a=0;r>0&&l>0&&(a+l+1>i&&(l=Math.max(1,i-a)),s.push(n.substring(r-=l,r+l)),!((a+=l+1)>i));)l=t[o=(o+1)%t.length];return s.reverse().join(e)}}function bg(t){return function(e){return e.replace(/[0-9]/g,function(n){return t[+n]})}}var wg=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function ur(t){if(!(e=wg.exec(t)))throw new Error("invalid format: "+t);var e;return new os({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}ur.prototype=os.prototype;function os(t){this.fill=t.fill===void 0?" ":t.fill+"",this.align=t.align===void 0?">":t.align+"",this.sign=t.sign===void 0?"-":t.sign+"",this.symbol=t.symbol===void 0?"":t.symbol+"",this.zero=!!t.zero,this.width=t.width===void 0?void 0:+t.width,this.comma=!!t.comma,this.precision=t.precision===void 0?void 0:+t.precision,this.trim=!!t.trim,this.type=t.type===void 0?"":t.type+""}os.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function Sg(t){e:for(var e=t.length,n=1,i=-1,r;n<e;++n)switch(t[n]){case".":i=r=n;break;case"0":i===0&&(i=n),r=n;break;default:if(!+t[n])break e;i>0&&(i=0);break}return i>0?t.slice(0,i)+t.slice(r+1):t}var Pl;function kg(t,e){var n=cr(t,e);if(!n)return t+"";var i=n[0],r=n[1],s=r-(Pl=Math.max(-8,Math.min(8,Math.floor(r/3)))*3)+1,o=i.length;return s===o?i:s>o?i+new Array(s-o+1).join("0"):s>0?i.slice(0,s)+"."+i.slice(s):"0."+new Array(1-s).join("0")+cr(t,Math.max(0,e+s-1))[0]}function Ol(t,e){var n=cr(t,e);if(!n)return t+"";var i=n[0],r=n[1];return r<0?"0."+new Array(-r).join("0")+i:i.length>r+1?i.slice(0,r+1)+"."+i.slice(r+1):i+new Array(r-i.length+2).join("0")}const Ll={"%":(t,e)=>(t*100).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:vg,e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>Ol(t*100,e),r:Ol,s:kg,X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function Dl(t){return t}var Rl=Array.prototype.map,$l=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function Eg(t){var e=t.grouping===void 0||t.thousands===void 0?Dl:yg(Rl.call(t.grouping,Number),t.thousands+""),n=t.currency===void 0?"":t.currency[0]+"",i=t.currency===void 0?"":t.currency[1]+"",r=t.decimal===void 0?".":t.decimal+"",s=t.numerals===void 0?Dl:bg(Rl.call(t.numerals,String)),o=t.percent===void 0?"%":t.percent+"",l=t.minus===void 0?"−":t.minus+"",a=t.nan===void 0?"NaN":t.nan+"";function c(h){h=ur(h);var f=h.fill,d=h.align,m=h.sign,p=h.symbol,g=h.zero,_=h.width,S=h.comma,C=h.precision,w=h.trim,k=h.type;k==="n"?(S=!0,k="g"):Ll[k]||(C===void 0&&(C=12),w=!0,k="g"),(g||f==="0"&&d==="=")&&(g=!0,f="0",d="=");var N=p==="$"?n:p==="#"&&/[boxX]/.test(k)?"0"+k.toLowerCase():"",T=p==="$"?i:/[%p]/.test(k)?o:"",E=Ll[k],x=/[defgprs%]/.test(k);C=C===void 0?6:/[gprs]/.test(k)?Math.max(1,Math.min(21,C)):Math.max(0,Math.min(20,C));function O(L){var F=N,D=T,I,H,P;if(k==="c")D=E(L)+D,L="";else{L=+L;var X=L<0||1/L<0;if(L=isNaN(L)?a:E(Math.abs(L),C),w&&(L=Sg(L)),X&&+L==0&&m!=="+"&&(X=!1),F=(X?m==="("?m:l:m==="-"||m==="("?"":m)+F,D=(k==="s"?$l[8+Pl/3]:"")+D+(X&&m==="("?")":""),x){for(I=-1,H=L.length;++I<H;)if(P=L.charCodeAt(I),48>P||P>57){D=(P===46?r+L.slice(I+1):L.slice(I))+D,L=L.slice(0,I);break}}}S&&!g&&(L=e(L,1/0));var U=F.length+L.length+D.length,q=U<_?new Array(_-U+1).join(f):"";switch(S&&g&&(L=e(q+L,q.length?_-D.length:1/0),q=""),d){case"<":L=F+L+D+q;break;case"=":L=F+q+L+D;break;case"^":L=q.slice(0,U=q.length>>1)+F+L+D+q.slice(U);break;default:L=q+F+L+D;break}return s(L)}return O.toString=function(){return h+""},O}function u(h,f){var d=c((h=ur(h),h.type="f",h)),m=Math.max(-8,Math.min(8,Math.floor(Xn(f)/3)))*3,p=Math.pow(10,-m),g=$l[8+m/3];return function(_){return d(p*_)+g}}return{format:c,formatPrefix:u}}var fr,zl,jl;Cg({thousands:",",grouping:[3],currency:["$",""]});function Cg(t){return fr=Eg(t),zl=fr.format,jl=fr.formatPrefix,fr}function Ig(t){return Math.max(0,-Xn(Math.abs(t)))}function xg(t,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Xn(e)/3)))*3-Xn(Math.abs(t)))}function Mg(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,Xn(e)-Xn(t))+1}function ls(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t);break}return this}const Fl=Symbol("implicit");function Hl(){var t=new Io,e=[],n=[],i=Fl;function r(s){let o=t.get(s);if(o===void 0){if(i!==Fl)return i;t.set(s,o=e.push(s)-1)}return n[o%n.length]}return r.domain=function(s){if(!arguments.length)return e.slice();e=[],t=new Io;for(const o of s)t.has(o)||t.set(o,e.push(o)-1);return r},r.range=function(s){return arguments.length?(n=Array.from(s),r):n.slice()},r.unknown=function(s){return arguments.length?(i=s,r):i},r.copy=function(){return Hl(e,n).unknown(i)},ls.apply(r,arguments),r}function Vl(){var t=Hl().unknown(void 0),e=t.domain,n=t.range,i=0,r=1,s,o,l=!1,a=0,c=0,u=.5;delete t.unknown;function h(){var f=e().length,d=r<i,m=d?r:i,p=d?i:r;s=(p-m)/Math.max(1,f-a+c*2),l&&(s=Math.floor(s)),m+=(p-m-s*(f-a))*u,o=s*(1-a),l&&(m=Math.round(m),o=Math.round(o));var g=Vi(f).map(function(_){return m+s*_});return n(d?g.reverse():g)}return t.domain=function(f){return arguments.length?(e(f),h()):e()},t.range=function(f){return arguments.length?([i,r]=f,i=+i,r=+r,h()):[i,r]},t.rangeRound=function(f){return[i,r]=f,i=+i,r=+r,l=!0,h()},t.bandwidth=function(){return o},t.step=function(){return s},t.round=function(f){return arguments.length?(l=!!f,h()):l},t.padding=function(f){return arguments.length?(a=Math.min(1,c=+f),h()):a},t.paddingInner=function(f){return arguments.length?(a=Math.min(1,f),h()):a},t.paddingOuter=function(f){return arguments.length?(c=+f,h()):c},t.align=function(f){return arguments.length?(u=Math.max(0,Math.min(1,f)),h()):u},t.copy=function(){return Vl(e(),[i,r]).round(l).paddingInner(a).paddingOuter(c).align(u)},ls.apply(h(),arguments)}function Ag(t){return function(){return t}}function Tg(t){return+t}var Ul=[0,1];function Gn(t){return t}function as(t,e){return(e-=t=+t)?function(n){return(n-t)/e}:Ag(isNaN(e)?NaN:.5)}function Ng(t,e){var n;return t>e&&(n=t,t=e,e=n),function(i){return Math.max(t,Math.min(e,i))}}function Pg(t,e,n){var i=t[0],r=t[1],s=e[0],o=e[1];return r<i?(i=as(r,i),s=n(o,s)):(i=as(i,r),s=n(s,o)),function(l){return s(i(l))}}function Og(t,e,n){var i=Math.min(t.length,e.length)-1,r=new Array(i),s=new Array(i),o=-1;for(t[i]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++o<i;)r[o]=as(t[o],t[o+1]),s[o]=n(e[o],e[o+1]);return function(l){var a=nd(t,l,1,i)-1;return s[a](r[a](l))}}function Lg(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function Dg(){var t=Ul,e=Ul,n=Xr,i,r,s,o=Gn,l,a,c;function u(){var f=Math.min(t.length,e.length);return o!==Gn&&(o=Ng(t[0],t[f-1])),l=f>2?Og:Pg,a=c=null,h}function h(f){return f==null||isNaN(f=+f)?s:(a||(a=l(t.map(i),e,n)))(i(o(f)))}return h.invert=function(f){return o(r((c||(c=l(e,t.map(i),Jt)))(f)))},h.domain=function(f){return arguments.length?(t=Array.from(f,Tg),u()):t.slice()},h.range=function(f){return arguments.length?(e=Array.from(f),u()):e.slice()},h.rangeRound=function(f){return e=Array.from(f),n=Im,u()},h.clamp=function(f){return arguments.length?(o=f?!0:Gn,u()):o!==Gn},h.interpolate=function(f){return arguments.length?(n=f,u()):n},h.unknown=function(f){return arguments.length?(s=f,h):s},function(f,d){return i=f,r=d,u()}}function Rg(){return Dg()(Gn,Gn)}function $g(t,e,n,i){var r=ud(t,e,n),s;switch(i=ur(i??",f"),i.type){case"s":{var o=Math.max(Math.abs(t),Math.abs(e));return i.precision==null&&!isNaN(s=xg(r,o))&&(i.precision=s),jl(i,o)}case"":case"e":case"g":case"p":case"r":{i.precision==null&&!isNaN(s=Mg(r,Math.max(Math.abs(t),Math.abs(e))))&&(i.precision=s-(i.type==="e"));break}case"f":case"%":{i.precision==null&&!isNaN(s=Ig(r))&&(i.precision=s-(i.type==="%")*2);break}}return zl(i)}function zg(t){var e=t.domain;return t.ticks=function(n){var i=e();return cd(i[0],i[i.length-1],n??10)},t.tickFormat=function(n,i){var r=e();return $g(r[0],r[r.length-1],n??10,i)},t.nice=function(n){n==null&&(n=10);var i=e(),r=0,s=i.length-1,o=i[r],l=i[s],a,c,u=10;for(l<o&&(c=o,o=l,l=c,c=r,r=s,s=c);u-- >0;){if(c=Rr(o,l,n),c===a)return i[r]=o,i[s]=l,e(i);if(c>0)o=Math.floor(o/c)*c,l=Math.ceil(l/c)*c;else if(c<0)o=Math.ceil(o*c)/c,l=Math.floor(l*c)/c;else break;a=c}return t},t}function gi(){var t=Rg();return t.copy=function(){return Lg(t,gi())},ls.apply(t,arguments),zg(t)}const dr=t=>()=>t;function jg(t,{sourceEvent:e,target:n,transform:i,dispatch:r}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:i,enumerable:!0,configurable:!0},_:{value:r}})}function un(t,e,n){this.k=t,this.x=e,this.y=n}un.prototype={constructor:un,scale:function(t){return t===1?this:new un(this.k*t,this.x,this.y)},translate:function(t,e){return t===0&e===0?this:new un(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var cs=new un(1,0,0);un.prototype;function us(t){t.stopImmediatePropagation()}function _i(t){t.preventDefault(),t.stopImmediatePropagation()}function Fg(t){return(!t.ctrlKey||t.type==="wheel")&&!t.button}function Hg(){var t=this;return t instanceof SVGElement?(t=t.ownerSVGElement||t,t.hasAttribute("viewBox")?(t=t.viewBox.baseVal,[[t.x,t.y],[t.x+t.width,t.y+t.height]]):[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]):[[0,0],[t.clientWidth,t.clientHeight]]}function Bl(){return this.__zoom||cs}function Vg(t){return-t.deltaY*(t.deltaMode===1?.05:t.deltaMode?1:.002)*(t.ctrlKey?10:1)}function Ug(){return navigator.maxTouchPoints||"ontouchstart"in this}function Bg(t,e,n){var i=t.invertX(e[0][0])-n[0][0],r=t.invertX(e[1][0])-n[1][0],s=t.invertY(e[0][1])-n[0][1],o=t.invertY(e[1][1])-n[1][1];return t.translate(r>i?(i+r)/2:Math.min(0,i)||Math.max(0,r),o>s?(s+o)/2:Math.min(0,s)||Math.max(0,o))}function ql(){var t=Fg,e=Hg,n=Bg,i=Vg,r=Ug,s=[0,1/0],o=[[-1/0,-1/0],[1/0,1/0]],l=250,a=Lm,c=oi("start","zoom","end"),u,h,f,d=500,m=150,p=0,g=10;function _(I){I.property("__zoom",Bl).on("wheel.zoom",E,{passive:!1}).on("mousedown.zoom",x).on("dblclick.zoom",O).filter(r).on("touchstart.zoom",L).on("touchmove.zoom",F).on("touchend.zoom touchcancel.zoom",D).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}_.transform=function(I,H,P,X){var U=I.selection?I.selection():I;U.property("__zoom",Bl),I!==U?k(I,H,P,X):U.interrupt().each(function(){N(this,arguments).event(X).start().zoom(null,typeof H=="function"?H.apply(this,arguments):H).end()})},_.scaleBy=function(I,H,P,X){_.scaleTo(I,function(){var U=this.__zoom.k,q=typeof H=="function"?H.apply(this,arguments):H;return U*q},P,X)},_.scaleTo=function(I,H,P,X){_.transform(I,function(){var U=e.apply(this,arguments),q=this.__zoom,J=P==null?w(U):typeof P=="function"?P.apply(this,arguments):P,ue=q.invert(J),ce=typeof H=="function"?H.apply(this,arguments):H;return n(C(S(q,ce),J,ue),U,o)},P,X)},_.translateBy=function(I,H,P,X){_.transform(I,function(){return n(this.__zoom.translate(typeof H=="function"?H.apply(this,arguments):H,typeof P=="function"?P.apply(this,arguments):P),e.apply(this,arguments),o)},null,X)},_.translateTo=function(I,H,P,X,U){_.transform(I,function(){var q=e.apply(this,arguments),J=this.__zoom,ue=X==null?w(q):typeof X=="function"?X.apply(this,arguments):X;return n(cs.translate(ue[0],ue[1]).scale(J.k).translate(typeof H=="function"?-H.apply(this,arguments):-H,typeof P=="function"?-P.apply(this,arguments):-P),q,o)},X,U)};function S(I,H){return H=Math.max(s[0],Math.min(s[1],H)),H===I.k?I:new un(H,I.x,I.y)}function C(I,H,P){var X=H[0]-P[0]*I.k,U=H[1]-P[1]*I.k;return X===I.x&&U===I.y?I:new un(I.k,X,U)}function w(I){return[(+I[0][0]+ +I[1][0])/2,(+I[0][1]+ +I[1][1])/2]}function k(I,H,P,X){I.on("start.zoom",function(){N(this,arguments).event(X).start()}).on("interrupt.zoom end.zoom",function(){N(this,arguments).event(X).end()}).tween("zoom",function(){var U=this,q=arguments,J=N(U,q).event(X),ue=e.apply(U,q),ce=P==null?w(ue):typeof P=="function"?P.apply(U,q):P,we=Math.max(ue[1][0]-ue[0][0],ue[1][1]-ue[0][1]),fe=U.__zoom,Ve=typeof H=="function"?H.apply(U,q):H,Xe=a(fe.invert(ce).concat(we/fe.k),Ve.invert(ce).concat(we/Ve.k));return function(pe){if(pe===1)pe=Ve;else{var W=Xe(pe),ee=we/W[2];pe=new un(ee,ce[0]-W[0]*ee,ce[1]-W[1]*ee)}J.zoom(null,pe)}})}function N(I,H,P){return!P&&I.__zooming||new T(I,H)}function T(I,H){this.that=I,this.args=H,this.active=0,this.sourceEvent=null,this.extent=e.apply(I,H),this.taps=0}T.prototype={event:function(I){return I&&(this.sourceEvent=I),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(I,H){return this.mouse&&I!=="mouse"&&(this.mouse[1]=H.invert(this.mouse[0])),this.touch0&&I!=="touch"&&(this.touch0[1]=H.invert(this.touch0[0])),this.touch1&&I!=="touch"&&(this.touch1[1]=H.invert(this.touch1[0])),this.that.__zoom=H,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(I){var H=mt(this.that).datum();c.call(I,this.that,new jg(I,{sourceEvent:this.sourceEvent,target:_,type:I,transform:this.that.__zoom,dispatch:c}),H)}};function E(I,...H){if(!t.apply(this,arguments))return;var P=N(this,H).event(I),X=this.__zoom,U=Math.max(s[0],Math.min(s[1],X.k*Math.pow(2,i.apply(this,arguments)))),q=bt(I);if(P.wheel)(P.mouse[0][0]!==q[0]||P.mouse[0][1]!==q[1])&&(P.mouse[1]=X.invert(P.mouse[0]=q)),clearTimeout(P.wheel);else{if(X.k===U)return;P.mouse=[q,X.invert(q)],ar(this),P.start()}_i(I),P.wheel=setTimeout(J,m),P.zoom("mouse",n(C(S(X,U),P.mouse[0],P.mouse[1]),P.extent,o));function J(){P.wheel=null,P.end()}}function x(I,...H){if(f||!t.apply(this,arguments))return;var P=I.currentTarget,X=N(this,H,!0).event(I),U=mt(I.view).on("mousemove.zoom",ce,!0).on("mouseup.zoom",we,!0),q=bt(I,P),J=I.clientX,ue=I.clientY;Wo(I.view),us(I),X.mouse=[q,this.__zoom.invert(q)],ar(this),X.start();function ce(fe){if(_i(fe),!X.moved){var Ve=fe.clientX-J,Xe=fe.clientY-ue;X.moved=Ve*Ve+Xe*Xe>p}X.event(fe).zoom("mouse",n(C(X.that.__zoom,X.mouse[0]=bt(fe,P),X.mouse[1]),X.extent,o))}function we(fe){U.on("mousemove.zoom mouseup.zoom",null),Yo(fe.view,X.moved),_i(fe),X.event(fe).end()}}function O(I,...H){if(t.apply(this,arguments)){var P=this.__zoom,X=bt(I.changedTouches?I.changedTouches[0]:I,this),U=P.invert(X),q=P.k*(I.shiftKey?.5:2),J=n(C(S(P,q),X,U),e.apply(this,H),o);_i(I),l>0?mt(this).transition().duration(l).call(k,J,X,I):mt(this).call(_.transform,J,X,I)}}function L(I,...H){if(t.apply(this,arguments)){var P=I.touches,X=P.length,U=N(this,H,I.changedTouches.length===X).event(I),q,J,ue,ce;for(us(I),J=0;J<X;++J)ue=P[J],ce=bt(ue,this),ce=[ce,this.__zoom.invert(ce),ue.identifier],U.touch0?!U.touch1&&U.touch0[2]!==ce[2]&&(U.touch1=ce,U.taps=0):(U.touch0=ce,q=!0,U.taps=1+!!u);u&&(u=clearTimeout(u)),q&&(U.taps<2&&(h=ce[0],u=setTimeout(function(){u=null},d)),ar(this),U.start())}}function F(I,...H){if(this.__zooming){var P=N(this,H).event(I),X=I.changedTouches,U=X.length,q,J,ue,ce;for(_i(I),q=0;q<U;++q)J=X[q],ue=bt(J,this),P.touch0&&P.touch0[2]===J.identifier?P.touch0[0]=ue:P.touch1&&P.touch1[2]===J.identifier&&(P.touch1[0]=ue);if(J=P.that.__zoom,P.touch1){var we=P.touch0[0],fe=P.touch0[1],Ve=P.touch1[0],Xe=P.touch1[1],pe=(pe=Ve[0]-we[0])*pe+(pe=Ve[1]-we[1])*pe,W=(W=Xe[0]-fe[0])*W+(W=Xe[1]-fe[1])*W;J=S(J,Math.sqrt(pe/W)),ue=[(we[0]+Ve[0])/2,(we[1]+Ve[1])/2],ce=[(fe[0]+Xe[0])/2,(fe[1]+Xe[1])/2]}else if(P.touch0)ue=P.touch0[0],ce=P.touch0[1];else return;P.zoom("touch",n(C(J,ue,ce),P.extent,o))}}function D(I,...H){if(this.__zooming){var P=N(this,H).event(I),X=I.changedTouches,U=X.length,q,J;for(us(I),f&&clearTimeout(f),f=setTimeout(function(){f=null},d),q=0;q<U;++q)J=X[q],P.touch0&&P.touch0[2]===J.identifier?delete P.touch0:P.touch1&&P.touch1[2]===J.identifier&&delete P.touch1;if(P.touch1&&!P.touch0&&(P.touch0=P.touch1,delete P.touch1),P.touch0)P.touch0[1]=this.__zoom.invert(P.touch0[0]);else if(P.end(),P.taps===2&&(J=bt(J,this),Math.hypot(h[0]-J[0],h[1]-J[1])<g)){var ue=mt(this).on("dblclick.zoom");ue&&ue.apply(this,arguments)}}}return _.wheelDelta=function(I){return arguments.length?(i=typeof I=="function"?I:dr(+I),_):i},_.filter=function(I){return arguments.length?(t=typeof I=="function"?I:dr(!!I),_):t},_.touchable=function(I){return arguments.length?(r=typeof I=="function"?I:dr(!!I),_):r},_.extent=function(I){return arguments.length?(e=typeof I=="function"?I:dr([[+I[0][0],+I[0][1]],[+I[1][0],+I[1][1]]]),_):e},_.scaleExtent=function(I){return arguments.length?(s[0]=+I[0],s[1]=+I[1],_):[s[0],s[1]]},_.translateExtent=function(I){return arguments.length?(o[0][0]=+I[0][0],o[1][0]=+I[1][0],o[0][1]=+I[0][1],o[1][1]=+I[1][1],_):[[o[0][0],o[0][1]],[o[1][0],o[1][1]]]},_.constrain=function(I){return arguments.length?(n=I,_):n},_.duration=function(I){return arguments.length?(l=+I,_):l},_.interpolate=function(I){return arguments.length?(a=I,_):a},_.on=function(){var I=c.on.apply(c,arguments);return I===c?_:I},_.clickDistance=function(I){return arguments.length?(p=(I=+I)*I,_):Math.sqrt(p)},_.tapDistance=function(I){return arguments.length?(g=+I,_):g},_}function qg(t,e,n=null,i,r=null){const s=mt(t);s.selectAll("*").remove();const o=s.node(),l=o.getBoundingClientRect();let a=l.width||800,c=l.height||600;const u=a/2,h=c/2,f=s.append("canvas").attr("class","network-canvas").attr("width",a).attr("height",c).style("width",a+"px").style("height",c+"px").style("cursor","default"),d=f.node().getContext("2d",{alpha:!1});let m=cs;const p=new Set,g={current:null};function _(){const L=o.getBoundingClientRect(),F=L.width||800,D=L.height||600;(F!==a||D!==c)&&(a=F,c=D,f.attr("width",a).attr("height",c).style("width",a+"px").style("height",c+"px"),O())}const S=new ResizeObserver(_);S.observe(o);const C=Ml(e).force("link",Il(n).id(L=>L.id).distance(L=>L.distance)).force("charge",Al().strength(-250)).force("center",wl(u,h).strength(.7)).force("collide",El(L=>L.radius+10).strength(.5)).force("x",Tl(u).strength(.025)).force("y",Nl(h).strength(.025)).alphaDecay(.05).velocityDecay(.6);let w=null;C.on("tick",()=>{w||(w=requestAnimationFrame(()=>{O(),w=null}))}),C.tick(100);for(let L=0;L<100;L++)C.tick();C.alphaTarget(0);const k=Kg({canvas:f,nodes:e,transform:()=>m,hoveredNode:g,onSelectionChange:(L,F)=>{p.clear(),L.forEach(I=>p.add(I));const D=Yg(e,L,F);i(D),O()},render:()=>O()}),N=ql().scaleExtent([.1,10]).filter(L=>!k.isSelectionMode()||L.type==="wheel").on("zoom",({transform:L})=>{m=L,O()});f.call(N);const{dragstarted:T,dragged:E,dragended:x}=Wg(f,e,C,()=>m,g,()=>!k.isSelectionMode(),O);k.setupInteractions(f,{start:T,drag:E,end:x});function O(){d.save(),d.fillRect(0,0,a,c),d.translate(m.x,m.y),d.scale(m.k,m.k),d.strokeStyle="#8a8a8a",d.lineWidth=1/m.k,n.forEach(F=>{const D=F.source.x,I=F.source.y,H=F.target.x,P=F.target.y;d.globalAlpha=Math.max(.2,F.strength),d.lineWidth=F.width/m.k,d.beginPath(),d.moveTo(D,I),d.lineTo(H,P),d.stroke()}),d.globalAlpha=1,e.forEach(F=>{const D=p.has(F.id);d.fillStyle=F.color,d.beginPath(),d.arc(F.x,F.y,F.radius,0,2*Math.PI),d.fill(),D&&(d.strokeStyle="#0f2bff",d.lineWidth=3/m.k,d.stroke())});const L=k.getSelectionRect();if(L){d.strokeStyle="#0f2bff",d.fillStyle="rgba(15, 43, 255, 0.2)",d.lineWidth=2/m.k;const F=Math.min(L.x1,L.x2),D=Math.min(L.y1,L.y2),I=Math.abs(L.x2-L.x1),H=Math.abs(L.y2-L.y1);d.fillRect(F,D,I,H),d.strokeRect(F,D,I,H)}d.restore()}return O(),{destroy:()=>{w&&cancelAnimationFrame(w),C.stop(),S.disconnect(),f.remove()},toggleSelectionMode:()=>{const L=k.toggleSelectionMode();return r&&r(L),O(),L}}}function Kg(t){const{canvas:e,nodes:n,transform:i,hoveredNode:r,onSelectionChange:s,render:o}=t,l=new Set,a=[];let c=!1,u=null;function h(){return c=!c,e.style("cursor",c?"crosshair":"default"),c}function f(p){if(l.has(p)){l.delete(p);const g=a.indexOf(p);g>-1&&a.splice(g,1)}else l.add(p),a.push(p);s(l,a)}function d(p,g){const _=i(),S=(p-_.x)/_.k,C=(g-_.y)/_.k;for(let w=n.length-1;w>=0;w--){const k=n[w],N=S-k.x,T=C-k.y;if(Math.sqrt(N*N+T*T)<k.radius)return k}return null}function m(p,g){let _=null;p.on("mousedown",function(S){const[C,w]=bt(S),k=d(C,w);if(c){const N=i(),T=(C-N.x)/N.k,E=(w-N.y)/N.k;u={x1:T,y1:E,x2:T,y2:E},o()}else k&&(_=k,g.start(S,k))}),p.on("mousemove",function(S){const[C,w]=bt(S);if(c){if(u){const k=i(),N=(C-k.x)/k.k,T=(w-k.y)/k.k;u.x2=N,u.y2=T,o()}}else if(_)g.drag(S,_,C,w);else{const k=d(C,w);r.current!==k&&(r.current=k,p.style("cursor",k?"pointer":"default"),o())}}),p.on("mouseup",function(S){if(c){if(u){const C=Math.min(u.x1,u.x2),w=Math.min(u.y1,u.y2),k=Math.max(u.x1,u.x2),N=Math.max(u.y1,u.y2);l.clear(),a.length=0;const T=[];n.forEach(E=>{E.x>=C&&E.x<=k&&E.y>=w&&E.y<=N&&T.push({id:E.id,y:E.y})}),T.sort((E,x)=>E.y-x.y),T.forEach(({id:E})=>{l.add(E),a.push(E)}),s(l,a),u=null,o()}}else if(_)g.end(S,_),_=null;else{const[C,w]=bt(S),k=d(C,w);k&&f(k.id)}})}return{toggleSelectionMode:h,isSelectionMode:()=>c,setupInteractions:m,getSelectionRect:()=>u}}function Wg(t,e,n,i,r,s,o){let l=null;function a(h,f){s()&&(h.active||n.alphaTarget(.3).restart(),l=f,f.fx=f.x,f.fy=f.y)}function c(h,f,d,m){if(!l||!s())return;const p=i();f.fx=(d-p.x)/p.k,f.fy=(m-p.y)/p.k,o()}function u(h,f){!l||!s()||(h.active||n.alphaTarget(0),f.fx=null,f.fy=null,l=null)}return{dragstarted:a,dragged:c,dragended:u}}function Yg(t,e,n){const i=new Map(t.map(r=>[r.id,r]));return n.map(r=>i.get(r)).filter(Boolean)}const Kl=8,Xg=1.5,Gg=50,Wl=.5,Jg=800,Qg=600;function Zg(t,e,n=null,i=null,r=null){const s=Jg/2,o=Qg/2,a=mt(t).append("svg").attr("class","network-svg"),c=a.append("g"),u=c.append("g").selectAll("line").data(n).join("line").attr("class","link").attr("stroke-width",m=>m.width||Xg).attr("stroke-opacity",m=>Math.max(.2,m.strength||Wl)),h=c.append("g").selectAll("circle").data(e).join("circle").attr("class","node").attr("r",m=>m.radius||Kl).attr("fill",m=>m.color);h.append("title").text(m=>m.label);const f=Ml(e).force("link",Il(n).id(m=>m.id).distance(m=>m.distance||Gg)).force("charge",Al().strength(-250)).force("center",wl(s,o).strength(.7)).force("collide",El(m=>(m.radius||Kl)+10).strength(Wl)).force("x",Tl(s).strength(.025)).force("y",Nl(o).strength(.025));let d=null;if(i){d=e_({svg:a,g:c,nodes:e,onSelectionChange:(_,S)=>{h.classed("selected",w=>_.has(w.id));const C=n_(e,_,S);i(C)}}),a.call(ql().scaleExtent([.1,10]).filter(_=>!d.isSelectionMode()||_.type==="wheel").on("zoom",({transform:_})=>c.attr("transform",_)));const{dragstarted:m,dragged:p,dragended:g}=t_(f,u,h);d.setupNodeClick(h),d.setupDrag(h,{start:m,drag:p,end:g})}return{destroy:()=>{f.stop(),a.remove()},toggleSelectionMode:()=>{if(d){const m=d.toggleSelectionMode();return r&&r(m),m}}}}function e_(t){const{svg:e,g:n,nodes:i,onSelectionChange:r,getNodePosition:s=p=>({x:p.x,y:p.y}),getNodeId:o=p=>p.id}=t,l=new Set,a=[];let c=!1;function u(){return c=!c,e.style("cursor",c?"crosshair":"default"),c}function h(p){if(l.has(p)){l.delete(p);const g=a.indexOf(p);g>-1&&a.splice(g,1)}else l.add(p),a.push(p);r(l,a)}function f(){l.clear(),a.length=0,r(l,a)}let d=null,m=null;return e.on("mousedown",function(p){if(!c)return;p.preventDefault();const[g,_]=bt(p,n.node());d={x:g,y:_},m=n.append("rect").attr("class","selection-rect").attr("x",g).attr("y",_).attr("width",0).attr("height",0)}).on("mousemove",function(p){if(!c||!m)return;const[g,_]=bt(p,n.node()),S=g-d.x,C=_-d.y;m.attr("x",S<0?g:d.x).attr("y",C<0?_:d.y).attr("width",Math.abs(S)).attr("height",Math.abs(C))}).on("mouseup",function(p){if(!c||!m)return;const[g,_]=bt(p,n.node()),S=Math.min(d.x,g),C=Math.min(d.y,_),w=Math.max(d.x,g),k=Math.max(d.y,_);l.clear(),a.length=0;const N=[];i.forEach(T=>{const E=s(T);E.x>=S&&E.x<=w&&E.y>=C&&E.y<=k&&N.push({id:o(T),y:E.y})}),N.sort((T,E)=>T.y-E.y),N.forEach(({id:T})=>{l.add(T),a.push(T)}),r(l,a),m.remove(),m=null,d=null}),{toggleSelectionMode:u,toggleNode:h,clearSelection:f,isSelectionMode:()=>c,getSelectedNodes:()=>l,getSelectionOrder:()=>a,setupNodeClick:p=>{p.on("click",function(g,_){g.stopPropagation(),h(o(_))})},setupDrag:(p,g)=>{p.call(rm().filter(()=>!c).on("start",g.start).on("drag",g.drag).on("end",g.end))}}}function t_(t,e,n){t.on("tick",()=>{e.attr("x1",o=>o.source.x).attr("y1",o=>o.source.y).attr("x2",o=>o.target.x).attr("y2",o=>o.target.y),n.attr("cx",o=>o.x).attr("cy",o=>o.y)});function i(o){o.active||t.alphaTarget(.3).restart(),o.subject.fx=o.subject.x,o.subject.fy=o.subject.y}function r(o){o.subject.fx=o.x,o.subject.fy=o.y}function s(o){o.active||t.alphaTarget(0),o.subject.fx=null,o.subject.fy=null}return{dragstarted:i,dragged:r,dragended:s}}function n_(t,e,n){const i=new Map(t.map(r=>[r.id,r]));return n.map(r=>i.get(r)).filter(Boolean)}const i_="modulepreload",r_=function(t){return"/"+t},Yl={},fs=function(e,n,i){return e()};function ds(t){const{type:e,modelName:n,title:i,extractMeta:r=d=>d}=t,s={id:null,type:e,title:i,selected:{}},o=JSON.parse(localStorage.getItem(e))||s,l=Pe(o),a=Pe(!1);function c(d,m=!1){a.set(m),localStorage.setItem(e,JSON.stringify(d))}function u(){l.update(d=>{if(e!=="documentSet")return console.error("Document set management is the only type currently supported for saving."),d;const m=Object.fromEntries(Object.entries(d.selected).map(([g,_])=>[g,Object.keys(_)])),p=d.id?`${d.id}/edit`:"new";return fetch(`${window.location.origin}/${n}/${p}`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":vn},body:JSON.stringify({title:d.title,selection:d,...m})}).then(g=>g.json()).then(g=>{if(!(g!=null&&g.document_set_id))throw new Error("Failed to save");l.update(_=>(_.id=g.document_set_id,_.title=g.document_set_title,c(_,!0),_))}).catch(g=>console.error("Error:",g)),d})}const h=d=>l.update(()=>{const m=d.selection.id?d.selection:{...d.selection,id:d.id};return c(m),m}),f=()=>l.update(()=>{const d={...s,selected:{}};return c(d),d});return{type:e,subscribe:l.subscribe,add:d=>l.update(m=>(m.selected[d.class]={...m.selected[d.class]||{},[d.id]:r(d)},c(m),m)),addAll:d=>l.update(m=>(d.forEach(p=>{m.selected[p.class]={...m.selected[p.class]||{},[p.id]:r(p)}}),c(m),m)),remove:(d,m)=>l.update(p=>{const{[d]:g,..._}=p.selected[m];return p.selected[m]=_,c(p),p}),removeAll:(d,m)=>l.update(p=>(d.forEach(g=>{var _;return(_=p.selected[m])==null?!0:delete _[g]}),c(p),p)),toggle:d=>l.update(m=>{var p;if((p=m.selected[d.class])!=null&&p[d.id]){const{[d.id]:g,..._}=m.selected[d.class];m.selected[d.class]=_}else m.selected[d.class]={...m.selected[d.class]||{},[d.id]:r(d)};return c(m),m}),toggleSet:d=>{vt(l).id===d.id?f():h(d)},empty:()=>l.update(d=>(d.id=null,d.title=i,d.selected={},c(d,!0),d)),updateTitle:d=>l.update(m=>(m.title=d,c(m,!0),m)),save:u,isSaved:a,selection:l,selectionTitle:dt(l,d=>d.title),isSelected:dt(l,d=>m=>{var p;return((p=d.selected[m.class])==null?void 0:p[m.id])||!1}),selected:dt(l,d=>d.selected),nbSelected:dt(l,d=>Object.values(d.selected).reduce((m,p)=>m+Object.keys(p).length,0)),isSetSelected:dt(l,d=>m=>d.id===m.id)}}ds({type:"documentSet",modelName:"document-set",title:B==="en"?"Document set":"Set de documents",extractMeta:t=>({title:t.title,url:t.url})});const s_=ds({type:"regionsSet",modelName:"regions-set",title:B==="en"?"Regions set":"Set de régions",extractMeta:t=>t});function o_(t){const[e,...n]=t.split("_");return n.join("_")}const hr=ds({type:"clusterSet",modelName:"cluster-set",title:B==="en"?"Selected regions":"Régions sélectionnées",extractMeta:t=>({imgRef:t.id,clusterId:t.clusterId,title:t.title,xywh:t.xywh,img:o_(t.id)})});function l_(){const t=`${window.location.origin}${window.location.pathname}`,e=Pe(1),n=Pe({}),i=Pe({}),r=Pe("");Ar(e,"p");function s(u){r.update(h=>{const f=h===u?"":u;return navigator.clipboard.writeText(f).then(d=>""),f})}const o=(async()=>{try{const u=await fetch(`${t}canvas`);if(!u.ok)return{};const h=await u.json();let f={};return Object.values(h).forEach(d=>{Object.entries(d).forEach(([m,p])=>{f[m]=p})}),n.set(f),h}catch{return{}}})(),l=dt(e,u=>(async()=>{const f=await(await fetch(`${t}canvas?p=${u}`)).json();return i.set(f),f})());function a(u){Tr(u,e,"p")}function c(u){n.update(h=>(delete h[u],{...h})),i.update(h=>{for(const f in h)if(h[f][u]){const{[u]:d,...m}=h[f];return h[f]=m,h}return h})}return{currentPage:e,pageRegions:i,allRegions:n,fetchPages:l,fetchAll:o,handlePageUpdate:a,remove:c,clipBoard:r,copyRef:s}}const Xl=l_(),ob="";function a_(t){let e;return{c(){e=Wt("path"),y(e,"d","M384 336H192c-8.8 0-16-7.2-16-16V64c0-8.8 7.2-16 16-16l140.1 0L400 115.9V320c0 8.8-7.2 16-16 16zM192 384H384c35.3 0 64-28.7 64-64V115.9c0-12.7-5.1-24.9-14.1-33.9L366.1 14.1c-9-9-21.2-14.1-33.9-14.1H192c-35.3 0-64 28.7-64 64V320c0 35.3 28.7 64 64 64zM64 128c-35.3 0-64 28.7-64 64V448c0 35.3 28.7 64 64 64H256c35.3 0 64-28.7 64-64V416H272v32c0 8.8-7.2 16-16 16H64c-8.8 0-16-7.2-16-16V192c0-8.8 7.2-16 16-16H96V128H64z"),y(e,"class","svelte-1829hp2")},m(n,i){z(n,e,i)},d(n){n&&R(e)}}}function c_(t){let e;return{c(){e=Wt("path"),y(e,"d","M208 0H332.1c12.7 0 24.9 5.1 33.9 14.1l67.9 67.9c9 9 14.1 21.2 14.1 33.9V336c0 26.5-21.5 48-48 48H208c-26.5 0-48-21.5-48-48V48c0-26.5 21.5-48 48-48zM48 128h80v64H64V448H256V416h64v48c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V176c0-26.5 21.5-48 48-48z"),y(e,"class","svelte-1829hp2")},m(n,i){z(n,e,i)},d(n){n&&R(e)}}}function u_(t){let e=B==="en"?"Copy ID":"Copier l'ID",n;return{c(){n=re(e)},m(i,r){z(i,n,r)},p:ie,d(i){i&&R(n)}}}function f_(t){let e=B==="en"?"Copied!":"Copié !",n;return{c(){n=re(e)},m(i,r){z(i,n,r)},p:ie,d(i){i&&R(n)}}}function Gl(t){let e,n,i;var r=t[7];function s(o){return{props:{mainImgItem:o[1],compareImgItem:o[14]}}}return r&&(e=xi(r,s(t))),{c(){e&&ve(e.$$.fragment),n=Ct()},m(o,l){e&&he(e,o,l),z(o,n,l),i=!0},p(o,l){const a={};if(l&2&&(a.mainImgItem=o[1]),l&128&&r!==(r=o[7])){if(e){tt();const c=e;K(c.$$.fragment,1,0,()=>{me(c,1)}),nt()}r?(e=xi(r,s(o)),ve(e.$$.fragment),V(e.$$.fragment,1),he(e,n.parentNode,n)):e=null}else r&&e.$set(a)},i(o){i||(e&&V(e.$$.fragment,o),i=!0)},o(o){e&&K(e.$$.fragment,o),i=!1},d(o){o&&R(n),e&&me(e,o)}}}function d_(t){let e,n,i,r,s,o,l,a,c,u,h,f,d,m,p,g,_,S,C,w,k,N,T;function E(H,P){return H[8]?c_:a_}let x=E(t),O=x(t);function L(H,P){return H[8]?f_:u_}let F=L(t),D=F(t),I=t[7]&&Gl(t);return{c(){e=b("div"),n=b("figure"),i=b("img"),s=j(),o=b("div"),l=b("span"),u=j(),h=b("div"),f=b("button"),d=Wt("svg"),O.c(),m=j(),p=b("span"),D.c(),_=j(),I&&I.c(),y(i,"class","region-img svelte-1829hp2"),At(i.src,r=t[9])||y(i,"src",r),y(i,"alt","Extracted region"),y(l,"class","overlay-desc"),y(o,"class","overlay is-center svelte-1829hp2"),y(n,"class",a="image card region-image "+(t[0]?"is-96x96":"")+" svelte-1829hp2"),y(n,"tabindex","-1"),y(n,"style",c=(t[2]==="full"?"height: 100%":`height: ${t[2]}px; min-width: ${t[2]}px`)+"; "+(t[3]?`border: 5px solid ${t[3]};`:"")),y(d,"xmlns","http://www.w3.org/2000/svg"),y(d,"viewBox","0 0 384 512"),y(d,"class","svelte-1829hp2"),y(p,"class","tooltip svelte-1829hp2"),y(f,"class","button tag svelte-1829hp2"),y(f,"style",g=t[6]?"":"display: none;"),y(h,"class","region-btn ml-1 svelte-1829hp2"),y(e,"class",S="region is-center "+(t[5]&&t[11](t[1])?"checked":"")+" svelte-1829hp2"),y(e,"style",C=t[2]==="full"?"height: 100%":"")},m(H,P){z(H,e,P),v(e,n),v(n,i),v(n,s),v(n,o),v(o,l),l.innerHTML=t[10],v(e,u),v(e,h),v(h,f),v(f,d),O.m(d,null),v(f,m),v(f,p),D.m(p,null),v(h,_),I&&I.m(h,null),k=!0,N||(T=[Ie(n,"click",t[19]),Ie(n,"keyup",h_),Ie(f,"click",t[20])],N=!0)},p(H,[P]){t=H,(!k||P&512&&!At(i.src,r=t[9]))&&y(i,"src",r),(!k||P&1024)&&(l.innerHTML=t[10]),(!k||P&1&&a!==(a="image card region-image "+(t[0]?"is-96x96":"")+" svelte-1829hp2"))&&y(n,"class",a),(!k||P&12&&c!==(c=(t[2]==="full"?"height: 100%":`height: ${t[2]}px; min-width: ${t[2]}px`)+"; "+(t[3]?`border: 5px solid ${t[3]};`:"")))&&y(n,"style",c),x!==(x=E(t))&&(O.d(1),O=x(t),O&&(O.c(),O.m(d,null))),F===(F=L(t))&&D?D.p(t,P):(D.d(1),D=F(t),D&&(D.c(),D.m(p,null))),(!k||P&64&&g!==(g=t[6]?"":"display: none;"))&&y(f,"style",g),t[7]?I?(I.p(t,P),P&128&&V(I,1)):(I=Gl(t),I.c(),V(I,1),I.m(h,null)):I&&(tt(),K(I,1,1,()=>{I=null}),nt()),(!k||P&2082&&S!==(S="region is-center "+(t[5]&&t[11](t[1])?"checked":"")+" svelte-1829hp2"))&&y(e,"class",S),(!k||P&4&&C!==(C=t[2]==="full"?"height: 100%":""))&&y(e,"style",C)},i(H){k||(V(I),jt(()=>{k&&(w||(w=_n(e,Un,{duration:t[15]},!0)),w.run(1))}),k=!0)},o(H){K(I),w||(w=_n(e,Un,{duration:t[15]},!1)),w.run(0),k=!1},d(H){H&&R(e),O.d(),D.d(),I&&I.d(),H&&w&&w.end(),N=!1,yt(T)}}}const h_=()=>null;function m_(t,e,n){let i,r,s,o,l,{selectionStore:a}=e;a||(a=s_);const{isSelected:c}=a;Ce(t,c,x=>n(11,l=x));const{clipBoard:u}=Xl;Ce(t,u,x=>n(18,o=x));let{item:h}=e,{descPromise:f=void 0}=e,{isSquare:d=!0}=e,{height:m=d?96:140}=e;m==="full"&&(d=!1);let{borderColor:p=null}=e,{toggleSelection:g=a.toggle}=e;const _=zt("qImgMetadata")||void 0,S=zt("isInModal")||!1,C=S?0:500;let w;S||fs(()=>Promise.resolve().then(()=>_1),void 0).then(x=>n(7,w=x.default));let{selectable:k=!S}=e,{copyable:N=!0}=e;const T=()=>k?g(h):null,E=()=>N?Xl.copyRef(h.ref):null;return t.$$set=x=>{"selectionStore"in x&&n(16,a=x.selectionStore),"item"in x&&n(1,h=x.item),"descPromise"in x&&n(17,f=x.descPromise),"isSquare"in x&&n(0,d=x.isSquare),"height"in x&&n(2,m=x.height),"borderColor"in x&&n(3,p=x.borderColor),"toggleSelection"in x&&n(4,g=x.toggleSelection),"selectable"in x&&n(5,k=x.selectable),"copyable"in x&&n(6,N=x.copyable)},t.$$.update=()=>{t.$$.dirty&2&&n(10,i=h.title),t.$$.dirty&131072&&f&&f.then(x=>n(10,i=x)),t.$$.dirty&7&&n(9,r=Kt(h.img??h.ref,h.xywh,m==="full"?m:d?`${m},`:`,${m}`)),t.$$.dirty&262146&&n(8,s=h.ref===o)},[d,h,m,p,g,k,N,w,s,r,i,l,c,u,_,C,a,f,o,T,E]}class Jn extends He{constructor(e){super(),Fe(this,e,m_,d_,Re,{selectionStore:16,item:1,descPromise:17,isSquare:0,height:2,borderColor:3,toggleSelection:4,selectable:5,copyable:6})}}const lb="";function Jl(t,e,n){const i=t.slice();return i[11]=e[n],i}function Ql(t,e,n){const i=t.slice();return i[14]=e[n],i}function hs(t){const e=t.slice(),n=e[2].get(e[11][e[14]].id);return e[17]=n,e}function Zl(t,e,n){const i=t.slice();return i[14]=e[n],i}function ea(t){let e,n,i,r,s,o,l,a,c,u,h=t[0].regions,f=[];for(let _=0;_<h.length;_+=1)f[_]=ta(Zl(t,h,_));const d=_=>K(f[_],1,1,()=>{f[_]=null});let m=t[0].rows,p=[];for(let _=0;_<m.length;_+=1)p[_]=ra(Jl(t,m,_));const g=_=>K(p[_],1,1,()=>{p[_]=null});return{c(){e=b("div"),n=b("h3"),n.textContent="Aligned Documents",i=j(),r=b("div"),s=b("table"),o=b("thead"),l=b("tr");for(let _=0;_<f.length;_+=1)f[_].c();a=j(),c=b("tbody");for(let _=0;_<p.length;_+=1)p[_].c();y(n,"class","title is-5"),y(o,"class","region-header svelte-1hxxzoa"),y(s,"class","table is-fullwidth svelte-1hxxzoa"),y(r,"class","table-container svelte-1hxxzoa"),y(e,"class","box mt-4")},m(_,S){z(_,e,S),v(e,n),v(e,i),v(e,r),v(r,s),v(s,o),v(o,l);for(let C=0;C<f.length;C+=1)f[C]&&f[C].m(l,null);v(s,a),v(s,c);for(let C=0;C<p.length;C+=1)p[C]&&p[C].m(c,null);u=!0},p(_,S){if(S&3){h=_[0].regions;let C;for(C=0;C<h.length;C+=1){const w=Zl(_,h,C);f[C]?(f[C].p(w,S),V(f[C],1)):(f[C]=ta(w),f[C].c(),V(f[C],1),f[C].m(l,null))}for(tt(),C=h.length;C<f.length;C+=1)d(C);nt()}if(S&77){m=_[0].rows;let C;for(C=0;C<m.length;C+=1){const w=Jl(_,m,C);p[C]?(p[C].p(w,S),V(p[C],1)):(p[C]=ra(w),p[C].c(),V(p[C],1),p[C].m(c,null))}for(tt(),C=m.length;C<p.length;C+=1)g(C);nt()}},i(_){if(!u){for(let S=0;S<h.length;S+=1)V(f[S]);for(let S=0;S<m.length;S+=1)V(p[S]);u=!0}},o(_){f=f.filter(Boolean);for(let S=0;S<f.length;S+=1)K(f[S]);p=p.filter(Boolean);for(let S=0;S<p.length;S+=1)K(p[S]);u=!1},d(_){_&&R(e),wt(f,_),wt(p,_)}}}function ta(t){let e,n,i,r;return n=new eo({props:{id:t[14],meta:t[1].get(t[14])||{},clickable:!1}}),{c(){e=b("th"),ve(n.$$.fragment),i=j(),y(e,"class","is-vcentered")},m(s,o){z(s,e,o),he(n,e,null),v(e,i),r=!0},p(s,o){const l={};o&1&&(l.id=s[14]),o&3&&(l.meta=s[1].get(s[14])||{}),n.$set(l)},i(s){r||(V(n.$$.fragment,s),r=!0)},o(s){K(n.$$.fragment,s),r=!1},d(s){s&&R(e),me(n)}}}function na(t){let e,n,i,r,s=t[11][t[14]].page+"",o,l;return e=new Jn({props:{item:t[17],selectable:!1,copyable:!1,borderColor:t[6](t[11][t[14]],t[3]),isSquare:!1}}),{c(){ve(e.$$.fragment),n=j(),i=b("div"),r=re("Page "),o=re(s),y(i,"class","has-text-grey-dark mt-2")},m(a,c){he(e,a,c),z(a,n,c),z(a,i,c),v(i,r),v(i,o),l=!0},p(a,c){const u={};c&5&&(u.item=a[17]),c&9&&(u.borderColor=a[6](a[11][a[14]],a[3])),e.$set(u),(!l||c&1)&&s!==(s=a[11][a[14]].page+"")&&Ne(o,s)},i(a){l||(V(e.$$.fragment,a),l=!0)},o(a){K(e.$$.fragment,a),l=!1},d(a){me(e,a),a&&R(n),a&&R(i)}}}function ia(t){let e,n,i=t[11][t[14]]&&na(hs(t));return{c(){e=b("td"),i&&i.c(),y(e,"class","has-text-centered"),We(e,"vertical-align","top")},m(r,s){z(r,e,s),i&&i.m(e,null),n=!0},p(r,s){r[11][r[14]]?i?(i.p(hs(r),s),s&1&&V(i,1)):(i=na(hs(r)),i.c(),V(i,1),i.m(e,null)):i&&(tt(),K(i,1,1,()=>{i=null}),nt())},i(r){n||(V(i),n=!0)},o(r){K(i),n=!1},d(r){r&&R(e),i&&i.d()}}}function ra(t){let e,n,i,r=t[0].regions,s=[];for(let l=0;l<r.length;l+=1)s[l]=ia(Ql(t,r,l));const o=l=>K(s[l],1,1,()=>{s[l]=null});return{c(){e=b("tr");for(let l=0;l<s.length;l+=1)s[l].c();n=j()},m(l,a){z(l,e,a);for(let c=0;c<s.length;c+=1)s[c]&&s[c].m(e,null);v(e,n),i=!0},p(l,a){if(a&77){r=l[0].regions;let c;for(c=0;c<r.length;c+=1){const u=Ql(l,r,c);s[c]?(s[c].p(u,a),V(s[c],1)):(s[c]=ia(u),s[c].c(),V(s[c],1),s[c].m(e,n))}for(tt(),c=r.length;c<s.length;c+=1)o(c);nt()}},i(l){if(!i){for(let a=0;a<r.length;a+=1)V(s[a]);i=!0}},o(l){s=s.filter(Boolean);for(let a=0;a<s.length;a+=1)K(s[a]);i=!1},d(l){l&&R(e),wt(s,l)}}}function p_(t){let e,n,i=t[0]&&ea(t);return{c(){i&&i.c(),e=Ct()},m(r,s){i&&i.m(r,s),z(r,e,s),n=!0},p(r,[s]){r[0]?i?(i.p(r,s),s&1&&V(i,1)):(i=ea(r),i.c(),V(i,1),i.m(e.parentNode,e)):i&&(tt(),K(i,1,1,()=>{i=null}),nt())},i(r){n||(V(i),n=!0)},o(r){K(i),n=!1},d(r){i&&i.d(r),r&&R(e)}}}function g_(t){let e=0;for(let o=0;o<t.length;o++)e=t.charCodeAt(o)+((e<<5)-e),e=e&e;const i=e*.618033988749895%1*360,r=65+e%20,s=80+e%10;return`hsl(${Math.floor(i)}, ${r}%, ${s}%)`}function __(t,e,n){let i,r,s,{selectedDocuments:o=[]}=e,{documentSetStore:l}=e;const{buildAlignedImageMatrix:a,documentNodes:c,imageNodes:u}=l;Ce(t,c,m=>n(1,r=m)),Ce(t,u,m=>n(2,s=m));let h=null;function f(m,p){if(!m)return;const g=m.id;if(p.get(g)!==1)return d.has(g)||d.set(g,g_(g)),d.get(g)}const d=new Map;return t.$$set=m=>{"selectedDocuments"in m&&n(7,o=m.selectedDocuments),"documentSetStore"in m&&n(8,l=m.documentSetStore)},t.$$.update=()=>{if(t.$$.dirty&134)if(o.length>0&&s&&r){const m=o.map(p=>p.id);n(0,h=a(m))}else n(0,h=null);t.$$.dirty&1&&n(3,i=h?(()=>{const m=new Map;return h.rows.forEach(p=>{Object.values(p).forEach(g=>{m.set(g.id,(m.get(g.id)||0)+1)})}),m})():new Map)},[h,r,s,i,c,u,f,o,l]}class v_ extends He{constructor(e){super(),Fe(this,e,__,p_,Re,{selectedDocuments:7,documentSetStore:8})}}const ab="";function sa(t,e,n){const i=t.slice();return i[15]=e[n],i}function y_(t){let e;return{c(){e=b("span"),e.innerHTML='<i class="fas fa-crop-alt"></i>',y(e,"class","icon px-4")},m(n,i){z(n,e,i)},d(n){n&&R(e)}}}function b_(t){let e;return{c(){e=b("span"),e.innerHTML='<i class="fas fa-hand-pointer"></i>',y(e,"class","icon px-4")},m(n,i){z(n,e,i)},d(n){n&&R(e)}}}function oa(t){let e,n,i,r;const s=[S_,w_],o=[];function l(a,c){return a[0]==="img"?0:a[0]==="doc"?1:-1}return~(e=l(t))&&(n=o[e]=s[e](t)),{c(){n&&n.c(),i=Ct()},m(a,c){~e&&o[e].m(a,c),z(a,i,c),r=!0},p(a,c){let u=e;e=l(a),e===u?~e&&o[e].p(a,c):(n&&(tt(),K(o[u],1,1,()=>{o[u]=null}),nt()),~e?(n=o[e],n?n.p(a,c):(n=o[e]=s[e](a),n.c()),V(n,1),n.m(i.parentNode,i)):n=null)},i(a){r||(V(n),r=!0)},o(a){K(n),r=!1},d(a){~e&&o[e].d(a),a&&R(i)}}}function w_(t){let e,n;return e=new v_({props:{selectedDocuments:t[5],documentSetStore:t[1]}}),{c(){ve(e.$$.fragment)},m(i,r){he(e,i,r),n=!0},p(i,r){const s={};r&32&&(s.selectedDocuments=i[5]),r&2&&(s.documentSetStore=i[1]),e.$set(s)},i(i){n||(V(e.$$.fragment,i),n=!0)},o(i){K(e.$$.fragment,i),n=!1},d(i){me(e,i)}}}function S_(t){let e,n,i=B==="en"?"Selected regions":"Régions sélectionnées",r,s,o=t[5].length+"",l,a,c,u,h=[],f=new Map,d,m=t[5];const p=g=>g[15].id;for(let g=0;g<m.length;g+=1){let _=sa(t,m,g),S=p(_);f.set(S,h[g]=la(S,_))}return{c(){e=b("div"),n=b("h3"),r=re(i),s=re(" ("),l=re(o),a=re(")"),c=j(),u=b("div");for(let g=0;g<h.length;g+=1)h[g].c();y(n,"class","title is-5"),y(u,"class","selected-nodes grid is-gap-2 mt-5 svelte-1a3kdxu"),y(e,"class","selected-panel box mt-4 svelte-1a3kdxu")},m(g,_){z(g,e,_),v(e,n),v(n,r),v(n,s),v(n,l),v(n,a),v(e,c),v(e,u);for(let S=0;S<h.length;S+=1)h[S]&&h[S].m(u,null);d=!0},p(g,_){(!d||_&32)&&o!==(o=g[5].length+"")&&Ne(l,o),_&32&&(m=g[5],tt(),h=Pi(h,_,p,1,g,m,f,u,Cr,la,null,sa),nt())},i(g){if(!d){for(let _=0;_<m.length;_+=1)V(h[_]);d=!0}},o(g){for(let _=0;_<h.length;_+=1)K(h[_]);d=!1},d(g){g&&R(e);for(let _=0;_<h.length;_+=1)h[_].d()}}}function la(t,e){let n,i,r;return i=new Jn({props:{item:e[15],selectable:!1,copyable:!1}}),{key:t,first:null,c(){n=Ct(),ve(i.$$.fragment),this.first=n},m(s,o){z(s,n,o),he(i,s,o),r=!0},p(s,o){e=s;const l={};o&32&&(l.item=e[15]),i.$set(l)},i(s){r||(V(i.$$.fragment,s),r=!0)},o(s){K(i.$$.fragment,s),r=!1},d(s){s&&R(n),me(i,s)}}}function k_(t){let e,n,i,r=t[3]?"click":"selection",s,o,l,a,c,u,h,f;function d(_,S){return _[3]?b_:y_}let m=d(t),p=m(t),g=t[5].length>0&&oa(t);return{c(){e=b("div"),n=b("button"),p.c(),i=re(`
        Switch to `),s=re(r),o=re(" mode"),l=j(),a=b("div"),c=j(),g&&g.c(),y(n,"class","toggle-button button is-small is-link mb-3"),y(a,"class","visualization-container")},m(_,S){z(_,e,S),v(e,n),p.m(n,null),v(n,i),v(n,s),v(n,o),v(e,l),v(e,a),t[9](a),v(e,c),g&&g.m(e,null),u=!0,h||(f=Ie(n,"click",t[7]),h=!0)},p(_,[S]){m!==(m=d(_))&&(p.d(1),p=m(_),p&&(p.c(),p.m(n,i))),(!u||S&8)&&r!==(r=_[3]?"click":"selection")&&Ne(s,r),_[5].length>0?g?(g.p(_,S),S&32&&V(g,1)):(g=oa(_),g.c(),V(g,1),g.m(e,null)):g&&(tt(),K(g,1,1,()=>{g=null}),nt())},i(_){u||(V(g),u=!0)},o(_){K(g),u=!1},d(_){_&&R(e),p.d(),t[9](null),g&&g.d(),h=!1,f()}}}const E_=1e3;function C_(t,e,n){let i,r,s=ie,o=()=>(s(),s=ki(i,w=>n(8,r=w)),i),l;t.$$.on_destroy.push(()=>s());let{type:a="img"}=e,{documentSetStore:c}=e;const{imageNetwork:u,documentNetwork:h,selectedNodes:f,updateSelectedNodes:d}=c;Ce(t,f,w=>n(5,l=w));let m,p,g=!1;function _(){m&&(m.destroy(),d([]));function w(N){d(N)}m=(r.nodes.length<E_?Zg:qg)(p,r.nodes,r.links,w,N=>{n(3,g=N)}),n(3,g=a==="img"),g&&m.toggleSelectionMode()}function S(){m&&n(3,g=m.toggleSelectionMode())}Rn(()=>{m==null||m.destroy()});function C(w){gn[w?"unshift":"push"](()=>{p=w,n(2,p)})}return t.$$set=w=>{"type"in w&&n(0,a=w.type),"documentSetStore"in w&&n(1,c=w.documentSetStore)},t.$$.update=()=>{t.$$.dirty&1&&o(n(4,i=a==="img"?u:h)),t.$$.dirty&260&&r&&p&&_()},[a,c,p,g,i,l,f,S,r,C]}class I_ extends He{constructor(e){super(),Fe(this,e,C_,k_,Re,{type:0,documentSetStore:1})}}const cb="",{Map:x_}=Jc;function aa(t,e,n){const i=t.slice();return i[61]=e[n],i}function ca(t,e,n){const i=t.slice();return i[61]=e[n],i}function ua(t,e,n){const i=t.slice();return i[66]=e[n],i}function fa(t,e,n){const i=t.slice();return i[69]=e[n],i}function M_(t){let e,n,i,r,s,o,l,a,c,u,h,f,d,m,p,g=t[22]("normalize")+"",_,S,C,w,k,N,T,E,x,O,L,F,D,I,H,P,X,U,q,J,ue=["col","row"],ce=[];for(let pe=0;pe<2;pe+=1)ce[pe]=ha(ua(t,ue,pe));let we=t[2]&&ma(t);function fe(pe,W){return pe[2]?N_:T_}let Ve=fe(t),Xe=Ve(t);return{c(){e=b("div"),n=b("div"),i=b("div"),r=b("h4"),r.textContent=`${t[22]("title")}`,s=j(),o=b("div"),l=b("div"),a=b("div"),c=b("select"),u=b("option"),u.textContent=`${t[22]("byName")}`,h=b("option"),h.textContent=`${t[22]("byScore")}`,f=j(),d=b("label"),m=b("input"),p=j(),_=re(g),S=j(),C=b("div"),w=b("div"),k=b("div"),N=j();for(let pe=0;pe<2;pe+=1)ce[pe].c();T=j(),E=b("div"),x=j(),O=b("div"),L=j(),F=b("div"),D=b("div"),I=b("div"),H=b("h4"),H.textContent=`${t[22]("pageByPage")}`,P=j(),we&&we.c(),X=j(),U=b("div"),Xe.c(),y(r,"class","title is-6 mb-0"),u.__value="name",u.value=u.__value,h.__value="score",h.value=h.__value,t[3]===void 0&&jt(()=>t[36].call(c)),y(a,"class","select is-small"),y(l,"class","control"),y(m,"type","checkbox"),m.checked=t[8],y(d,"title",t[22]("normalization")),y(d,"class","checkbox is-size-7"),y(o,"class","is-flex is-align-items-center"),We(o,"gap","0.5rem"),y(i,"class","is-flex is-justify-content-space-between is-align-items-center mb-3"),We(i,"flex-wrap","wrap"),We(i,"gap","0.5rem"),y(k,"class","matrix-corner svelte-24wn30"),y(E,"class","matrix-canvas svelte-24wn30"),y(w,"class","matrix-grid svelte-24wn30"),We(w,"--cell-size",ba+"px"),y(C,"class","scroll-area svelte-24wn30"),y(n,"class","box panel-box svelte-24wn30"),y(e,"class","split-panel svelte-24wn30"),We(e,"width",t[13]+"px"),y(O,"class","split-divider svelte-24wn30"),y(O,"role","separator"),y(O,"tabindex","0"),y(H,"class","title is-6 mb-0"),y(I,"class","is-flex is-justify-content-space-between is-align-items-center mb-3"),y(U,"class","scroll-area svelte-24wn30"),y(D,"class","box panel-box svelte-24wn30"),y(F,"class","split-panel svelte-24wn30"),We(F,"width",t[12]+"px")},m(pe,W){z(pe,e,W),v(e,n),v(n,i),v(i,r),v(i,s),v(i,o),v(o,l),v(l,a),v(a,c),v(c,u),v(c,h),pn(c,t[3],!0),v(o,f),v(o,d),v(d,m),v(d,p),v(d,_),v(n,S),v(n,C),v(C,w),v(w,k),v(w,N);for(let ee=0;ee<2;ee+=1)ce[ee]&&ce[ee].m(w,null);v(w,T),v(w,E),t[38](E),z(pe,x,W),z(pe,O,W),z(pe,L,W),z(pe,F,W),v(F,D),v(D,I),v(I,H),v(I,P),we&&we.m(I,null),v(D,X),v(D,U),Xe.m(U,null),q||(J=[Ie(c,"change",t[36]),Ie(m,"change",t[37]),Ie(O,"mousedown",t[23]),Ie(O,"touchstart",t[23])],q=!0)},p(pe,W){if(W[0]&8&&pn(c,pe[3]),W[0]&256&&(m.checked=pe[8]),W[0]&32){ue=["col","row"];let ee;for(ee=0;ee<2;ee+=1){const se=ua(pe,ue,ee);ce[ee]?ce[ee].p(se,W):(ce[ee]=ha(se),ce[ee].c(),ce[ee].m(w,T))}for(;ee<2;ee+=1)ce[ee].d(1)}W[0]&8192&&We(e,"width",pe[13]+"px"),pe[2]?we?we.p(pe,W):(we=ma(pe),we.c(),we.m(I,null)):we&&(we.d(1),we=null),Ve===(Ve=fe(pe))&&Xe?Xe.p(pe,W):(Xe.d(1),Xe=Ve(pe),Xe&&(Xe.c(),Xe.m(U,null))),W[0]&4096&&We(F,"width",pe[12]+"px")},d(pe){pe&&R(e),wt(ce,pe),t[38](null),pe&&R(x),pe&&R(O),pe&&R(L),pe&&R(F),we&&we.d(),Xe.d(),q=!1,yt(J)}}}function A_(t){let e;return{c(){e=b("div"),e.textContent=`${t[22]("noDocuments")}`,y(e,"class","notification is-info"),We(e,"width","100%")},m(n,i){z(n,e,i)},p:ie,d(n){n&&R(e)}}}function da(t,e){let n,i,r;return{key:t,first:null,c(){n=b("div"),i=b("span"),y(i,"class","color-dot svelte-24wn30"),We(i,"background-color",e[69].color),y(i,"title",r=e[69].title+" "+Oi.Witness+" #"+e[69].witnessId),y(n,"class","header-cell svelte-24wn30"),this.first=n},m(s,o){z(s,n,o),v(n,i)},p(s,o){e=s,o[0]&32&&We(i,"background-color",e[69].color),o[0]&32&&r!==(r=e[69].title+" "+Oi.Witness+" #"+e[69].witnessId)&&y(i,"title",r)},d(s){s&&R(n)}}}function ha(t){let e,n=[],i=new x_,r=t[5].docs;const s=o=>o[69].id;for(let o=0;o<r.length;o+=1){let l=fa(t,r,o),a=s(l);i.set(a,n[o]=da(a,l))}return{c(){e=b("div");for(let o=0;o<n.length;o+=1)n[o].c();y(e,"class",t[66]+"-headers svelte-24wn30")},m(o,l){z(o,e,l);for(let a=0;a<n.length;a+=1)n[a]&&n[a].m(e,null)},p(o,l){l[0]&32&&(r=o[5].docs,n=Pi(n,l,s,1,o,r,i,e,fu,da,null,fa))},d(o){o&&R(e);for(let l=0;l<n.length;l+=1)n[l].d()}}}function ma(t){let e,n,i,r,s,o,l,a;return{c(){e=b("div"),n=b("div"),i=b("div"),r=b("select"),s=b("option"),s.textContent=`${t[22]("byPage")}`,o=b("option"),o.textContent=`${t[22]("byImage")}`,s.__value="page",s.value=s.__value,o.__value="image",o.value=o.__value,t[4]===void 0&&jt(()=>t[39].call(r)),y(i,"class","select is-small"),y(n,"class","control"),y(e,"class","field mb-0")},m(c,u){z(c,e,u),v(e,n),v(n,i),v(i,r),v(r,s),v(r,o),pn(r,t[4],!0),l||(a=Ie(r,"change",t[39]),l=!0)},p(c,u){u[0]&16&&pn(r,c[4])},d(c){c&&R(e),l=!1,a()}}}function T_(t){let e;return{c(){e=b("p"),e.textContent=`${t[22]("selectCell")}`,y(e,"class","has-text-grey is-size-7")},m(n,i){z(n,e,i)},p:ie,d(n){n&&R(e)}}}function N_(t){let e;return{c(){e=b("div"),y(e,"class","scatter-container svelte-24wn30")},m(n,i){z(n,e,i),t[40](e)},p:ie,d(n){n&&R(e),t[40](null)}}}function pa(t){let e,n,i,r,s,o,l,a=t[11].items,c=[];for(let d=0;d<a.length;d+=1)c[d]=ga(ca(t,a,d));let u=t[11].score!==void 0&&_a(t),h=t[11].items,f=[];for(let d=0;d<h.length;d+=1)f[d]=va(aa(t,h,d));return{c(){e=b("table"),n=b("thead"),i=b("tr");for(let d=0;d<c.length;d+=1)c[d].c();r=j(),s=b("tbody"),u&&u.c(),o=j(),l=b("tr");for(let d=0;d<f.length;d+=1)f[d].c();y(e,"class","table is-fullwidth p-3 has-text-centered")},m(d,m){z(d,e,m),v(e,n),v(n,i);for(let p=0;p<c.length;p+=1)c[p]&&c[p].m(i,null);v(e,r),v(e,s),u&&u.m(s,null),v(s,o),v(s,l);for(let p=0;p<f.length;p+=1)f[p]&&f[p].m(l,null)},p(d,m){if(m[0]&2048){a=d[11].items;let p;for(p=0;p<a.length;p+=1){const g=ca(d,a,p);c[p]?c[p].p(g,m):(c[p]=ga(g),c[p].c(),c[p].m(i,null))}for(;p<c.length;p+=1)c[p].d(1);c.length=a.length}if(d[11].score!==void 0?u?u.p(d,m):(u=_a(d),u.c(),u.m(s,o)):u&&(u.d(1),u=null),m[0]&4196352){h=d[11].items;let p;for(p=0;p<h.length;p+=1){const g=aa(d,h,p);f[p]?f[p].p(g,m):(f[p]=va(g),f[p].c(),f[p].m(l,null))}for(;p<f.length;p+=1)f[p].d(1);f.length=h.length}},d(d){d&&R(e),wt(c,d),u&&u.d(),wt(f,d)}}}function ga(t){let e,n,i,r,s,o=t[61].doc.title+"",l,a;return{c(){e=b("th"),n=b("span"),i=re("●"),r=j(),s=b("strong"),l=re(o),a=j(),We(n,"color",t[61].doc.color),y(e,"class","doc-title svelte-24wn30")},m(c,u){z(c,e,u),v(e,n),v(n,i),v(e,r),v(e,s),v(s,l),v(e,a)},p(c,u){u[0]&2048&&We(n,"color",c[61].doc.color),u[0]&2048&&o!==(o=c[61].doc.title+"")&&Ne(l,o)},d(c){c&&R(e)}}}function _a(t){let e,n,i,r=t[22]("score")+"",s,o,l,a=t[11].score.toFixed(2)+"",c;return{c(){e=b("tr"),n=b("td"),i=b("span"),s=re(r),o=j(),l=b("b"),c=re(a),y(i,"class","tag is-small"),y(n,"colspan","2"),y(n,"class","has-text-centered")},m(u,h){z(u,e,h),v(e,n),v(n,i),v(i,s),v(i,o),v(i,l),v(l,c)},p(u,h){h[0]&2048&&a!==(a=u[11].score.toFixed(2)+"")&&Ne(c,a)},d(u){u&&R(e)}}}function va(t){let e,n,i=t[22]("page")+"",r,s,o=t[61].label+"",l,a,c,u,h,f,d;return{c(){e=b("td"),n=b("p"),r=re(i),s=j(),l=re(o),a=j(),c=b("figure"),u=b("img"),d=j(),y(n,"class","is-size-7 has-text-grey mb-3"),At(u.src,h=t[61].imgUrl)||y(u,"src",h),y(u,"alt",f="Page "+t[61].label),We(u,"border-radius","5px"),y(c,"class","image")},m(m,p){z(m,e,p),v(e,n),v(n,r),v(n,s),v(n,l),v(e,a),v(e,c),v(c,u),v(e,d)},p(m,p){p[0]&2048&&o!==(o=m[61].label+"")&&Ne(l,o),p[0]&2048&&!At(u.src,h=m[61].imgUrl)&&y(u,"src",h),p[0]&2048&&f!==(f="Page "+m[61].label)&&y(u,"alt",f)},d(m){m&&R(e)}}}function P_(t){let e,n,i,r,s,o,l,a,c,u,h,f,d,m,p,g,_,S,C,w;function k(x,O){return x[6].length?M_:A_}let N=k(t),T=N(t),E=t[11]&&pa(t);return{c(){e=b("div"),n=b("label"),n.textContent=`${t[22]("filtering")}`,i=j(),r=b("div"),s=b("div"),o=b("select"),l=b("option"),l.textContent=`${t[22]("allPairs")}`,a=b("option"),a.textContent=`${t[22]("filteredPairs")}`,c=j(),u=b("div"),T.c(),h=j(),f=b("div"),d=b("div"),m=j(),p=b("div"),g=b("div"),E&&E.c(),_=j(),S=b("button"),y(n,"class","label is-small"),y(n,"for","matrix-mode"),l.__value="all",l.value=l.__value,a.__value="filtered",a.value=a.__value,y(o,"id","matrix-mode"),t[7]===void 0&&jt(()=>t[35].call(o)),y(s,"class","select is-small is-fullwidth"),y(r,"class","control"),y(e,"class","field mb-4"),y(u,"class","split-container svelte-24wn30"),y(d,"class","modal-background"),y(g,"class","box p-5"),y(p,"class","modal-content"),We(p,"width","auto"),We(p,"max-width","70vw"),y(S,"class","modal-close is-large"),y(S,"aria-label","close"),y(f,"id","matrix-page-modal"),y(f,"class","modal")},m(x,O){z(x,e,O),v(e,n),v(e,i),v(e,r),v(r,s),v(s,o),v(o,l),v(o,a),pn(o,t[7],!0),z(x,c,O),z(x,u,O),T.m(u,null),t[41](u),z(x,h,O),z(x,f,O),v(f,d),v(f,m),v(f,p),v(p,g),E&&E.m(g,null),v(f,_),v(f,S),t[42](f),C||(w=[Ie(o,"change",t[35]),ei(Pr.call(null,f))],C=!0)},p(x,O){O[0]&128&&pn(o,x[7]),N===(N=k(x))&&T?T.p(x,O):(T.d(1),T=N(x),T&&(T.c(),T.m(u,null))),x[11]?E?E.p(x,O):(E=pa(x),E.c(),E.m(g,null)):E&&(E.d(1),E=null)},i:ie,o:ie,d(x){x&&R(e),x&&R(c),x&&R(u),T.d(),t[41](null),x&&R(h),x&&R(f),E&&E.d(),t[42](null),C=!1,yt(w)}}}const ya=300,ba=30,ct=5;function O_(t,e,n){const i=new Map;let r=1/0,s=-1/0;for(const l of n){const[a,c,u]=l.regions_id_1===t.id?[l.page_1,l.page_2,l.weightedScore||0]:[l.page_2,l.page_1,l.weightedScore||0],h=`${a}-${c}`;i.has(h)||i.set(h,{page1:a,page2:c,scores:[]}),i.get(h).scores.push(u),u<r&&(r=u),u>s&&(s=u)}return{mode:"page",points:Array.from(i.values()).map(({page1:l,page2:a,scores:c})=>({page1:l,page2:a,score:c.reduce((u,h)=>u+h,0)/c.length,count:c.length})),minScore:r,maxScore:s,doc1:t,doc2:e}}function wa(t){return[...t].sort((e,n)=>{var s,o;if(e.canvas!==n.canvas)return e.canvas-n.canvas;const i=parseInt(((s=e.xywh)==null?void 0:s[1])||0),r=parseInt(((o=n.xywh)==null?void 0:o[1])||0);return i-r})}function L_(t,e,n){const i=wa(t.images||[]),r=wa(e.images||[]);if(!i.length||!r.length)return null;const s=new Map(i.map((u,h)=>[u.id,h])),o=new Map(r.map((u,h)=>[u.id,h])),l=new Map;let a=1/0,c=-1/0;return n.forEach(u=>{const[h,f,d]=u.regions_id_1===t.id?[u.id_1,u.id_2,u.weightedScore||0]:[u.id_2,u.id_1,u.weightedScore||0],m=s.get(h),p=o.get(f);if(m!==void 0&&p!==void 0){const g=`${m}-${p}`;l.set(g,{idx1:m,idx2:p,imgId1:h,imgId2:f,score:d}),d<a&&(a=d),d>c&&(c=d)}}),{mode:"image",images1:i,images2:r,pairScores:l,minScore:a,maxScore:c,doc1:t,doc2:e}}function Sa(t){const e=[];let n=null,i=0;return t.forEach((r,s)=>{r.canvas!==n&&(n!==null&&e.push({start:i,end:s,page:n,count:s-i}),n=r.canvas,i=s)}),n!==null&&e.push({start:i,end:t.length,page:n,count:t.length-i}),e}function D_(t,e,n){let i,r,s,o,l,a,c,u,h,f,d,m,p,g,{documentSetStore:_}=e;const{documentNodes:S,pairIndex:C,activeDocPairStats:w,activeDocStats:k,pageCountMap:N,visiblePairIds:T,matrixMode:E,normalizeByPages:x}=_;Ce(t,S,Y=>n(34,g=Y)),Ce(t,C,Y=>n(45,c=Y)),Ce(t,w,Y=>n(33,p=Y)),Ce(t,k,Y=>n(32,m=Y)),Ce(t,N,Y=>n(31,f=Y)),Ce(t,T,Y=>n(30,u=Y)),Ce(t,E,Y=>n(7,h=Y)),Ce(t,x,Y=>n(8,d=Y));const O={title:{en:"Document Matrix",fr:"Matrice de documents"},order:{en:"Order",fr:"Ordre"},byName:{en:"By title",fr:"Par titre"},byScore:{en:"By score",fr:"Par score"},noDocuments:{en:"No documents available",fr:"Aucun document disponible"},pageByPage:{en:"Page-by-page similarity",fr:"Similarité page par page"},page:{en:"page",fr:"page"},score:{en:"Score",fr:"Score"},noPairs:{en:"No pairs",fr:"Aucune paire"},selectCell:{en:"Click a cell to view page-by-page similarity",fr:"Cliquez sur une cellule pour voir la similarité page par page"},byPage:{en:"By page",fr:"Par page"},byImage:{en:"By image",fr:"Par image"},image:{en:"image",fr:"image"},normalize:{en:"Normalize",fr:"Normaliser"},normalization:{en:"Normalization by document page counts",fr:"Normalisation par le nombre de pages des documents"},allPairs:{en:"All pairs in the document set",fr:"Toutes les paires du corpus"},filteredPairs:{en:"Filtered pairs",fr:"Paires après filtrage"},filtering:{en:"Source of image pairs for the visualizations",fr:"Source des paires d’images pour les visualisations"}},L=Y=>{var de,Oe;return((de=O[Y])==null?void 0:de[B])||((Oe=O[Y])==null?void 0:Oe.en)||Y};let F,D,I,H,P=null,X="name",U=.5,q=!1,J=0,ue,ce=null,we=null,fe="page";function Ve(Y,de,Oe,be,st,qe){var ht;if(!Y.length)return{docs:[],matrix:[],maxScore:0};Y.forEach((et,Z)=>{var ge;et.index=Z,et.count=((ge=Oe==null?void 0:Oe.get(et.id))==null?void 0:ge.count)||0});const Ke={name:Vi(Y.length).sort((et,Z)=>Y[et].title.localeCompare(Y[Z].title)),score:Vi(Y.length).sort((et,Z)=>Y[Z].count-Y[et].count)}[be].map(et=>Y[et]),Qe=Ke.length,Te=[];let Ae=0;for(let et=0;et<Qe;et++){const Z=[];for(let ge=0;ge<Qe;ge++)if(et!==ge){const je=Ke[et].id<Ke[ge].id?`${Ke[et].id}-${Ke[ge].id}`:`${Ke[ge].id}-${Ke[et].id}`;let kt=((ht=de==null?void 0:de.get(je))==null?void 0:ht.score)||0;if(st&&kt>0){const M=qe.get(Ke[et].id)||1,A=qe.get(Ke[ge].id)||1;kt/=Math.sqrt(M*A)}kt>Ae&&(Ae=kt),Z.push({x:ge,y:et,z:kt,doc1:Ke[et],doc2:Ke[ge]})}else Z.push({x:ge,y:et,z:0,diagonal:!0});Te.push(Z)}return{docs:Ke,matrix:Te,maxScore:Ae}}function Xe(Y,de,Oe,be){const{doc1:st,doc2:qe}=Y,lt=st.id<qe.id?`${st.id}-${qe.id}`:`${qe.id}-${st.id}`;let Ke=c.byDocPair.get(lt)||[];return Oe&&be.size>0&&(Ke=Ke.filter(Qe=>be.has(`${Qe.id_1}-${Qe.id_2}`))),Ke.length?de==="image"?L_(st,qe,Ke):O_(st,qe,Ke):null}function pe(){if(!D||!r.docs.length)return;const{docs:Y,matrix:de,maxScore:Oe}=r,be=Y.length*ba;mt(D).selectAll("*").remove();const st=mt(D).append("svg").attr("width",be).attr("height",be),qe=Vl().range([0,be]).domain(Vi(Y.length)).padding(.02),lt=mt("body").selectAll(".matrix-tooltip").data([0]).join("div").attr("class","matrix-tooltip").style("position","fixed").style("background","var(--bulma-scheme-main)").style("border","1px solid var(--bulma-border)").style("border-radius","4px").style("padding","8px").style("pointer-events","none").style("opacity",0).style("font-size","12px").style("box-shadow","0 2px 4px rgba(0,0,0,0.15)").style("z-index","9999").style("color","var(--bulma-text)");st.selectAll(".row").data(de).join("g").attr("class","row").attr("transform",(Qe,Te)=>`translate(0,${qe(Te)})`).each(function(Qe){mt(this).selectAll(".cell").data(Qe.filter(Te=>!Te.diagonal)).join("rect").attr("class","cell").attr("x",Te=>qe(Te.x)).attr("width",qe.bandwidth()).attr("height",qe.bandwidth()).attr("fill",Te=>{if(Te.z===0)return"var(--bulma-text)";const Ae=Ji(233,.951,.52);return Ae.opacity=Oe>0?.2+.8*(Te.z/Oe):.2,Ae}).attr("stroke",Te=>W(Te)?"var(--bulma-text)":"var(--bulma-scheme-main)").attr("stroke-width",Te=>W(Te)?2:.5).style("cursor","pointer").on("mouseover",function(Te,Ae){W(Ae)||mt(this).attr("stroke","var(--bulma-text)").attr("stroke-width",2),lt.style("opacity",1)}).on("mousemove",function(Te,Ae){const ht=`<span style="color:${Ae.doc1.color}">●</span> ${Ae.doc1.title}<br/>↔<br/><span style="color:${Ae.doc2.color}">●</span> ${Ae.doc2.title}`,et=Ae.z===0?`${ht}<br/><br/><em>${L("noPairs")}</em>`:`${ht}<br/><br/>${L("score")}: ${Ae.z.toFixed(2)}`;lt.html(et).style("left",Te.clientX+15+"px").style("top",Te.clientY+15+"px")}).on("mouseleave",function(Te,Ae){W(Ae)||mt(this).attr("stroke","var(--bulma-scheme-main)").attr("stroke-width",.5),lt.style("opacity",0)}).on("click",(Te,Ae)=>{n(2,P={row:Ae.y,col:Ae.x,doc1:Ae.doc1,doc2:Ae.doc2}),ee()})}),st.selectAll(".row").selectAll(".cell-diagonal").data(Qe=>Qe.filter(Te=>Te.diagonal)).join("rect").attr("class","cell-diagonal").attr("x",Qe=>qe(Qe.x)).attr("width",qe.bandwidth()).attr("height",qe.bandwidth()).attr("fill","var(--contrasted)")}function W(Y){return P&&P.doc1.id===Y.doc1.id&&P.doc2.id===Y.doc2.id}function ee(){D&&mt(D).selectAll(".cell").attr("stroke",Y=>W(Y)?"var(--bulma-text)":"var(--bulma-scheme-main)").attr("stroke-width",Y=>W(Y)?2:.5)}function se(){!I||!s||(mt(I).selectAll("*").remove(),s.mode==="image"?oe():Q())}function Q(){const{points:Y,minScore:de,maxScore:Oe,doc1:be,doc2:st}=s;if(!Y.length)return;const qe={top:65,right:40,bottom:20,left:80},lt=10,Ke=Math.max(...Y.map(ae=>ae.page1)),Qe=Math.max(...Y.map(ae=>ae.page2)),Te=Ke*ct,Ae=Qe*ct,ht=new Map(Y.map(ae=>[`${ae.page1}-${ae.page2}`,ae])),et=Te+qe.left+qe.right,Z=Ae+qe.top+qe.bottom,je=mt(I).append("svg").attr("width",et).attr("height",Z).append("g").attr("transform",`translate(${qe.left},${qe.top})`),kt=gi().domain([0,Ke]).range([0,Te]),M=gi().domain([0,Qe]).range([0,Ae]),A=mt("body").selectAll(".scatter-tooltip").data([0]).join("div").attr("class","scatter-tooltip").style("position","fixed").style("background","var(--bulma-scheme-main)").style("border","1px solid var(--bulma-border)").style("border-radius","4px").style("padding","6px 10px").style("pointer-events","none").style("opacity",0).style("font-size","11px").style("box-shadow","0 2px 4px rgba(0,0,0,0.15)").style("z-index","9999").style("color","var(--bulma-text)"),$=new Array(Ke).fill(0),G=new Array(Qe).fill(0);Y.forEach(ae=>{$[ae.page1-1]++,G[ae.page2-1]++});const ne=Math.max(...$),te=Math.max(...G),ye=je.append("g").attr("transform",`translate(0,${-22-lt})`);$.forEach((ae,_e)=>{ae!==0&&ye.append("rect").attr("x",_e*ct).attr("width",ct).attr("height",lt).attr("fill",be.color).attr("opacity",.15+.85*(ae/ne)).style("cursor","default").on("mouseover",()=>A.style("opacity",1)).on("mousemove",ke=>{A.html(`<strong>${ae}</strong> image${ae>1?"s":""}<br/>${L("page")} ${_e+1}`).style("left",ke.clientX+10+"px").style("top",ke.clientY-30+"px")}).on("mouseleave",()=>A.style("opacity",0))});const le=je.append("g").attr("transform","translate(-55,0)");G.forEach((ae,_e)=>{ae!==0&&le.append("rect").attr("x",0).attr("y",_e*ct).attr("width",lt).attr("height",ct).attr("fill",st.color).attr("opacity",.15+.85*(ae/te)).style("cursor","default").on("mouseover",()=>A.style("opacity",1)).on("mousemove",ke=>{A.html(`<strong>${ae}</strong> image${ae>1?"s":""}<br/>${L("page")} ${_e+1}`).style("left",ke.clientX+10+"px").style("top",ke.clientY-30+"px")}).on("mouseleave",()=>A.style("opacity",0))}),je.append("g").call(No(kt).ticks(Math.min(Ke,10))),je.append("g").call(Po(M).ticks(Math.min(Qe,10)));const it=(ae,_e)=>{const ke=Math.floor(_e/6);return ae.length>ke?ae.slice(0,ke-1)+"…":ae},Se=je.append("g").attr("transform",`translate(${Te/2},-50)`);Se.append("circle").attr("r",4).attr("cx",-Te/2+4).attr("fill",be.color),Se.append("text").attr("x",-Te/2+14).attr("text-anchor","start").attr("dominant-baseline","middle").attr("font-size","11px").attr("fill","var(--bulma-text)").text(it(`${be.title} (${L("page")})`,Te-20));const Je=je.append("g").attr("transform",`translate(-68,${Ae/2}) rotate(-90)`);Je.append("circle").attr("r",4).attr("cx",-Ae/2+4).attr("fill",st.color),Je.append("text").attr("x",-Ae/2+14).attr("text-anchor","start").attr("dominant-baseline","middle").attr("font-size","11px").attr("fill","var(--bulma-text)").text(it(`${st.title} (${L("page")})`,Ae-20)),je.append("rect").attr("class","hover-overlay").attr("width",Te).attr("height",Ae).attr("fill","transparent").style("cursor","pointer").on("mousemove",ae=>{const[_e,ke]=bt(ae,je.node()),rt=Math.floor(_e/ct)+1,at=Math.floor(ke/ct)+1;if(rt<1||rt>Ke||at<1||at>Qe){A.style("opacity",0);return}const ft=ht.get(`${rt}-${at}`),mn=`<span style="color:${be.color}">●</span> ${L("page")} ${rt}<br/><span style="color:${st.color}">●</span> ${L("page")} ${at}`,Nn=ft?`${mn}<br/>${L("score")}: ${ft.score.toFixed(2)}`:mn;A.style("opacity",1).html(Nn).style("left",ae.clientX+10+"px").style("top",ae.clientY-40+"px")}).on("mouseleave",()=>A.style("opacity",0)).on("click",ae=>{const[_e,ke]=bt(ae,je.node()),rt=Math.floor(_e/ct)+1,at=Math.floor(ke/ct)+1;if(rt>=1&&rt<=Ke&&at>=1&&at<=Qe){const ft=ht.get(`${rt}-${at}`);De(rt,at,be,st,ft==null?void 0:ft.score)}}),je.selectAll(".cell").data(Y).join("rect").attr("class","cell").attr("x",ae=>(ae.page1-1)*ct).attr("y",ae=>(ae.page2-1)*ct).attr("width",ct).attr("height",ct).attr("fill",Ji(233,.951,.52)).attr("opacity",ae=>Oe>de?.2+.8*(ae.score-de)/(Oe-de):.5).attr("pointer-events","none"),n(1,I.style.width=et+"px",I),n(1,I.style.height=Z+"px",I)}function oe(){const{images1:Y,images2:de,pairScores:Oe,minScore:be,maxScore:st,doc1:qe,doc2:lt}=s;if(!Y.length||!de.length)return;const Ke={top:65,right:40,bottom:20,left:80},Qe=10,Te=Y.length*ct,Ae=de.length*ct,ht=Te+Ke.left+Ke.right,et=Ae+Ke.top+Ke.bottom,ge=mt(I).append("svg").attr("width",ht).attr("height",et).append("g").attr("transform",`translate(${Ke.left},${Ke.top})`),je=gi().domain([0,Y.length]).range([0,Te]),kt=gi().domain([0,de.length]).range([0,Ae]),M=mt("body").selectAll(".scatter-tooltip").data([0]).join("div").attr("class","scatter-tooltip").style("position","fixed").style("background","var(--bulma-scheme-main)").style("border","1px solid var(--bulma-border)").style("border-radius","4px").style("padding","6px 10px").style("pointer-events","none").style("opacity",0).style("font-size","11px").style("box-shadow","0 2px 4px rgba(0,0,0,0.15)").style("z-index","9999").style("color","var(--bulma-text)"),A=Sa(Y),$=Sa(de),G=ge.append("g").attr("transform",`translate(0,${-22-Qe})`);A.forEach(({start:Se,end:Je,page:ae,count:_e})=>{G.append("rect").attr("x",Se*ct).attr("width",(Je-Se)*ct).attr("height",Qe).attr("fill",qe.color).attr("opacity",.5).style("cursor","default").on("mouseover",()=>M.style("opacity",1)).on("mousemove",ke=>{M.html(`${L("page")} ${ae}<br/><strong>${_e}</strong> image${_e>1?"s":""}`).style("left",ke.clientX+10+"px").style("top",ke.clientY-30+"px")}).on("mouseleave",()=>M.style("opacity",0))});const ne=ge.append("g").attr("transform","translate(-55,0)");$.forEach(({start:Se,end:Je,page:ae,count:_e})=>{ne.append("rect").attr("x",0).attr("y",Se*ct).attr("width",Qe).attr("height",(Je-Se)*ct).attr("fill",lt.color).attr("opacity",.5).style("cursor","default").on("mouseover",()=>M.style("opacity",1)).on("mousemove",ke=>{M.html(`${L("page")} ${ae}<br/><strong>${_e}</strong> image${_e>1?"s":""}`).style("left",ke.clientX+10+"px").style("top",ke.clientY-30+"px")}).on("mouseleave",()=>M.style("opacity",0))}),ge.append("g").call(No(je).ticks(Math.min(Y.length,10))),ge.append("g").call(Po(kt).ticks(Math.min(de.length,10)));const te=(Se,Je)=>{const ae=Math.floor(Je/6);return Se.length>ae?Se.slice(0,ae-1)+"…":Se},ye=ge.append("g").attr("transform",`translate(${Te/2},-50)`);ye.append("circle").attr("r",4).attr("cx",-Te/2+4).attr("fill",qe.color),ye.append("text").attr("x",-Te/2+14).attr("text-anchor","start").attr("dominant-baseline","middle").attr("font-size","11px").attr("fill","var(--bulma-text)").text(te(`${qe.title} (${L("image")})`,Te-20));const le=ge.append("g").attr("transform",`translate(-68,${Ae/2}) rotate(-90)`);le.append("circle").attr("r",4).attr("cx",-Ae/2+4).attr("fill",lt.color),le.append("text").attr("x",-Ae/2+14).attr("text-anchor","start").attr("dominant-baseline","middle").attr("font-size","11px").attr("fill","var(--bulma-text)").text(te(`${lt.title} (${L("image")})`,Ae-20)),ge.append("rect").attr("class","hover-overlay").attr("width",Te).attr("height",Ae).attr("fill","transparent").style("cursor","pointer").on("mousemove",Se=>{const[Je,ae]=bt(Se,ge.node()),_e=Math.floor(Je/ct),ke=Math.floor(ae/ct);if(_e<0||_e>=Y.length||ke<0||ke>=de.length){M.style("opacity",0);return}const rt=Y[_e],at=de[ke],ft=Oe.get(`${_e}-${ke}`),mn=`<span style="color:${qe.color}">●</span> ${L("page")} ${rt.canvas}, ${L("image")} ${_e+1}<br/><span style="color:${lt.color}">●</span> ${L("page")} ${at.canvas}, ${L("image")} ${ke+1}`,Nn=ft?`${mn}<br/>${L("score")}: ${ft.score.toFixed(2)}`:mn;M.style("opacity",1).html(Nn).style("left",Se.clientX+10+"px").style("top",Se.clientY-40+"px")}).on("mouseleave",()=>M.style("opacity",0)).on("click",Se=>{const[Je,ae]=bt(Se,ge.node()),_e=Math.floor(Je/ct),ke=Math.floor(ae/ct);if(_e>=0&&_e<Y.length&&ke>=0&&ke<de.length){const rt=Oe.get(`${_e}-${ke}`);Ge(Y[_e],de[ke],qe,lt,rt==null?void 0:rt.score)}});const it=Array.from(Oe.values());ge.selectAll(".cell").data(it).join("rect").attr("class","cell").attr("x",Se=>Se.idx1*ct).attr("y",Se=>Se.idx2*ct).attr("width",ct).attr("height",ct).attr("fill",Ji(233,.951,.52)).attr("opacity",Se=>st>be?.2+.8*(Se.score-be)/(st-be):.5).attr("pointer-events","none"),n(1,I.style.width=ht+"px",I),n(1,I.style.height=et+"px",I)}function De(Y,de,Oe,be,st){n(27,ce={page1:Y,page2:de,doc1:Oe,doc2:be,score:st}),n(28,we=null),H==null||H.classList.add("is-active")}function Ge(Y,de,Oe,be,st){n(28,we={img1:Y,img2:de,doc1:Oe,doc2:be,score:st}),n(27,ce=null),H==null||H.classList.add("is-active")}function Ze(Y){q=!0,Y.preventDefault()}function Ee(Y){var be,st;if(!q||!F)return;const de=F.getBoundingClientRect(),Oe=(Y.clientX||((st=(be=Y.touches)==null?void 0:be[0])==null?void 0:st.clientX))-de.left;n(25,U=Math.max(.2,Math.min(.8,Oe/de.width)))}function xe(){q=!1}function $e(Y,de){const Oe="full";return Kt(`wit${Y.witnessId}_${Y.digitizationRef}_${String(de).padStart(Y.zeros,"0")}`,"full",Oe)}function ot(Y){var de;return Kt(Y.ref,(de=Y.xywh)==null?void 0:de.join(","),"full")}Dn(()=>{F&&(n(26,J=F.offsetWidth),ue=new ResizeObserver(Y=>{n(26,J=Y[0].contentRect.width)}),ue.observe(F)),window.addEventListener("mousemove",Ee),window.addEventListener("mouseup",xe),window.addEventListener("touchmove",Ee),window.addEventListener("touchend",xe)}),Rn(()=>{ue==null||ue.disconnect(),window.removeEventListener("mousemove",Ee),window.removeEventListener("mouseup",xe),window.removeEventListener("touchmove",Ee),window.removeEventListener("touchend",xe)});function gt(){h=Ii(this),E.set(h)}function St(){X=Ii(this),n(3,X)}const ut=Y=>x.set(Y.target.checked);function ze(Y){gn[Y?"unshift":"push"](()=>{D=Y,n(0,D)})}function Mt(){fe=Ii(this),n(4,fe)}function Ue(Y){gn[Y?"unshift":"push"](()=>{I=Y,n(1,I)})}function pt(Y){gn[Y?"unshift":"push"](()=>{F=Y,n(9,F)})}function Be(Y){gn[Y?"unshift":"push"](()=>{H=Y,n(10,H)})}return t.$$set=Y=>{"documentSetStore"in Y&&n(24,_=Y.documentSetStore)},t.$$.update=()=>{t.$$.dirty[1]&8&&n(6,i=Array.from((g==null?void 0:g.values())||[])),t.$$.dirty[0]&328|t.$$.dirty[1]&7&&n(5,r=Ve(i,p.scoreCount,m.scoreCount,X,d,f)),t.$$.dirty[0]&1073741972&&n(29,s=P?Xe(P,fe,h==="filtered",u):null),t.$$.dirty[0]&100663296&&n(13,o=Math.max(ya,J*U-4)),t.$$.dirty[0]&100663296&&n(12,l=Math.max(ya,J*(1-U)-4)),t.$$.dirty[0]&402653184&&n(11,a=ce?{items:[1,2].map(Y=>({doc:ce[`doc${Y}`],label:ce[`page${Y}`],imgUrl:$e(ce[`doc${Y}`],ce[`page${Y}`])})),score:ce.score}:we?{items:[["img1","doc1"],["img2","doc2"]].map(([Y,de])=>({doc:we[de],label:we[Y].canvas,imgUrl:ot(we[Y])})),score:we.score}:null),t.$$.dirty[0]&33&&D&&r.docs.length&&pe(),t.$$.dirty[0]&536870914&&I&&s&&se()},[D,I,P,X,fe,r,i,h,d,F,H,a,l,o,S,C,w,k,N,T,E,x,L,Ze,_,U,J,ce,we,s,u,f,m,p,g,gt,St,ut,ze,Mt,Ue,pt,Be]}class R_ extends He{constructor(e){super(),Fe(this,e,D_,P_,Re,{documentSetStore:24},null,[-1,-1,-1])}}const $_=1e4;async function z_(t,e,n={}){const{onProgress:i,onError:r,signal:s}=n,o=await fetch(t,{signal:s});if(!o.ok){const d=await o.json().catch(()=>({error:o.statusText}));throw new Error(d.error||`HTTP ${o.status}`)}const l=o.body.getReader(),a=new TextDecoder;let c="",u=[],h=0,f=!1;try{for(;;){const{done:d,value:m}=await l.read();if(d){if(c.trim()){const g=ka(c);g&&u.push(g)}return u.length>0?(h+=u.length,e.postMessage({type:"batch",pairs:u,isLast:!0})):e.postMessage({type:"done"}),i==null||i(h,!0),h}c+=a.decode(m,{stream:!0});const p=c.split(`
`);c=p.pop()||"";for(const g of p){if(!g)continue;const _=ka(g);_&&(u.push(_),u.length>=$_&&(f||(e.postMessage({type:"init"}),f=!0),h+=u.length,e.postMessage({type:"batch",pairs:u,isLast:!1}),u=[],i==null||i(h,!1)))}}}catch(d){throw d.name==="AbortError"?(e.postMessage({type:"abort"}),d):(r==null||r(d),d)}}function ka(t){try{return JSON.parse(t)}catch{return console.warn("Parse error:",t.slice(0,50)),null}}const Ea="https://vhs.huma-num.fr",j_=()=>new Worker("/static/js/pairWorker.js",{type:"module"});function F_(t){const e=Pe(null),n=Pe(!1),i=Pe({loaded:0,done:!1}),r=Pe([]),s=Pe(new Set),o=Pe([]),l=Pe(0),a=Pe(3),c=Pe(!1),u=Pe("threshold"),h=Pe([]),f=Pe(new Map);let d,m=null;const p=Pe({byImage:new Map,byDocPair:new Map,byDoc:new Map}),g=Pe(new Map),_=Pe(new Map),S=Pe({}),C=Pe({}),w=Pe({}),k=Pe({}),N=Pe({documents:0,pairs:null,images:0,categories:{}}),T=dt(r,(W,ee)=>{if(W.length===0){ee(Promise.resolve(0));return}d&&d.terminate()&&(d=null),m&&m.abort(),m=new AbortController;const se=413,Q=new Promise((oe,De)=>{n.set(!0),i.set({loaded:0,done:!1}),e.set(null),(async()=>{try{d=j_(),d.onmessage=async Ee=>{const{type:xe}=Ee.data;if(xe==="progress"){i.set({loaded:Ee.data.count,done:!1});return}if(xe!=="complete")return;const{allPairs:$e,imageNodes:ot,pairIndex:gt,categories:St,stats:ut}=Ee.data;p.set(gt),S.set(ut.pairStats),q(),C.set(ut.documentStats),w.set(ut.imageStats),k.set(ut.docPairStats);const ze=Array.from(ut.documentStats.scoreCount.keys());vt(s).size===0&&s.set(new Set(ze));const Mt=await Promise.all(ze.map(Be=>E(Be).then(Y=>({id:Be,info:Y})))),Ue=new Map;Mt.forEach(({id:Be,info:Y})=>Ue.set(Be,Y)),f.set(Ue);const pt=new Map;ze.forEach((Be,Y)=>{const de=Ue.get(Be)||{};pt.set(Be,{id:Be,title:de.title||`Region Extraction ${Be}`,color:de.color||Mu(Y),images:[],...de})}),ot.forEach(Be=>{const Y=pt.get(Be.regionId);Y&&(Be.color=Y.color,Be.title=`${Y.title} | Page ${Be.canvas}`,Y.images.push(Be))}),pt.forEach(Be=>Be.images.sort((Y,de)=>Y.canvas-de.canvas)),g.set(ot),_.set(pt),N.set({documents:ze.length,pairs:$e.length,images:ot.size,categories:St}),h.set($e),n.set(!1),i.set({loaded:$e.length,done:!0}),d.terminate(),d=null,oe($e.length)},d.onerror=Ee=>{console.error("Worker error",Ee),e.set(`Worker error: ${Ee.message}`),n.set(!1),De(Ee)};const Ze=`${Ea}/document-set/${se}/pairs/stream?category=${W.join(",")}`;await z_(Ze,d,{signal:m.signal,onProgress:(Ee,xe)=>{i.set({loaded:Ee,done:xe})},onError:Ee=>{e.set(`Stream error: ${Ee.message}`)}})}catch(Ze){if(Ze.name==="AbortError"){console.log("Request aborted");return}e.set(`Fetch error: ${Ze.message}`),n.set(!1),De(Ze)}})()});ee(Q)});async function E(W){try{const ee=await fetch(`${Ea}/search/regions/?id=${W}`);if(!ee.ok)throw new Error(`HTTP ${ee.status}`);const{results:se}=await ee.json();if(!(se!=null&&se.length))return{title:`Region Extraction ${W}`};const Q=se[0],[,...oe]=Q.title.split(" | "),[De,Ge]=(Q.ref||"_").split("_");return{title:oe.join(" | "),ref:Q.ref,witnessId:Mr(De),digitizationRef:Ge,zeros:Q.zeros,img_nb:Q.img_nb,url:Q.url}}catch(ee){return e.set(`Error fetching region #${W}: ${ee.message}`),{title:`Region Extraction ${W}`}}}const x=dt([h,l,a,c,s],([W,ee,se,Q,oe])=>{if(!W)return[];const De=[],Ge=vt(u);for(let Ze=0;Ze<W.length;Ze++){const Ee=W[Ze];if(Ge==="threshold"&&Ee.weightedScore<ee)break;if(!(!oe.has(Ee.regions_id_1)||!oe.has(Ee.regions_id_2))){if(Ge==="topk"&&se!==null){const xe=Ee.rank_1??1/0,$e=Ee.rank_2??1/0;if(Q){if(xe>se||$e>se)continue}else if(xe>se&&$e>se)continue}De.push(Ee)}}return De}),O=dt([x,_],([W,ee])=>{if(!W.length||ee.size===0)return[];const se=new Set;for(const oe of W)se.add(oe.regions_id_1),se.add(oe.regions_id_2);const Q=[];return se.forEach(oe=>{const De=ee.get(oe);De&&Q.push(De)}),Q.sort((oe,De)=>De.id-oe.id)});function L(W,ee,se=10,Q=200,oe=2,De=25){if(!ee)return{strength:.5,distance:100,width:2};const{min:Ge,_:Ze,range:Ee}=ee,xe=Ee===0?.5:(W-Ge)/Ee,$e=Q-xe*(Q-se),ot=oe+xe*(De-oe);return{strength:xe,distance:$e,width:ot}}function F(W,ee,se=10,Q=60){if(!ee)return se;const{min:oe,_:De,range:Ge}=ee;return Ge===0?(se+Q)/2:se+(W-oe)/Ge*(Q-se)}const D=dt([x],([W])=>{var Ze;const ee=vt(g),se=vt(w),Q=vt(S),oe=new Set,De=[];for(const Ee of W){const{strength:xe,distance:$e,width:ot}=L(Ee.weightedScore,Q.scoreRange);De.push({source:Ee.id_1,target:Ee.id_2,strength:xe,distance:$e,width:ot}),oe.has(Ee.id_1)||oe.add(Ee.id_1),oe.has(Ee.id_2)||oe.add(Ee.id_2)}const Ge=[];for(const Ee of oe){const xe=ee.get(Ee);if(xe){const $e=(Ze=se.scoreCount)==null?void 0:Ze.get(Ee),{count:ot,score:gt}=$e;Ge.push({...xe,radius:F(gt,se.scoreRange),label:`Region: ${xe.regionId}
Page: ${xe.canvas}
Connections: ${ot}
Total score: ${gt.toFixed(2)}`})}}return{nodes:Ge,links:De}}),I=dt(O,W=>{const ee=vt(k),se=vt(C);if(W.size===0)return{nodes:[],links:[]};const Q=Array.from(W.values()).map(De=>{var xe;const Ge=(xe=se.scoreCount)==null?void 0:xe.get(De.id),{count:Ze,score:Ee}=Ge;return{...De,radius:F(Ze,se.countRange),label:`${De.title}
Images: ${Ze}
Total score: ${Ee.toFixed(2)}`}}),oe=Array.from(ee.scoreCount.entries()).map(([De,Ge])=>{const[Ze,Ee]=De.split("-").map(Number),{strength:xe,distance:$e,width:ot}=L(Ge.score,ee.scoreRange);return{source:Ze,target:Ee,strength:xe,distance:$e,width:ot}});return{nodes:Q,links:oe}});function H(W){if(!W.length)return{regions:[],rows:[]};const ee=vt(_),se=vt(p),Q=W[0],oe=ee.get(Q);if(!(oe!=null&&oe.images))return{regions:W,rows:[]};const De=oe.images,Ge=($e,ot,gt)=>{const{r1:St,r2:ut}={r1:ot,r2:gt},ze=St<ut?`${St}-${ut}`:`${ut}-${St}`;return(se.byDocPair.get(ze)||[]).map(Ue=>Ue.id_1===$e&&Ue.regions_id_1===ot?{id:Ue.id_2,page:Ue.page_2}:Ue.id_2===$e&&Ue.regions_id_2===ot?{id:Ue.id_1,page:Ue.page_1}:null).filter(Boolean)},Ze=[];for(const $e of De){let ot=[{[Q]:{id:$e.id,page:$e.canvas}}];for(let gt=1;gt<W.length;gt++){const St=W[gt],ut=[];for(const ze of ot){const Mt=[];for(let Ue=0;Ue<gt;Ue++){const pt=W[Ue];if(ze[pt]){const Be=Ge(ze[pt].id,pt,St);Mt.push(...Be)}}if(Mt.length===0)ut.push(ze);else{const Ue=new Map;Mt.forEach(pt=>{Ue.has(pt.id)||Ue.set(pt.id,pt)});for(const pt of Ue.values()){const Be={...ze,[St]:pt};ut.push(Be)}}}ot=ut}Ze.push(...ot)}const Ee=[],xe=new Set;for(const $e of Ze){const ot=W.map(gt=>{var St;return((St=$e[gt])==null?void 0:St.id)||""}).join("|");xe.has(ot)||(xe.add(ot),Ee.push($e))}return{regions:W,rows:Ee}}function P(W){r.update(ee=>ee.indexOf(W)>-1?ee.filter(Q=>Q!==W):[...ee,W].sort((Q,oe)=>Q-oe))}function X(W){s.update(ee=>{const se=new Set(ee);return se.has(W)?se.delete(W):se.add(W),se})}function U(){const W=Array.from(vt(_).keys());s.set(new Set(W))}function q(){if(!vt(r).includes(0))return;const{min:W,max:ee}=vt(S).scoreRange||{};W==null||ee==null||vt(l)===W&&l.set((W+ee)/2)}const J=Pe("filtered"),ue=Pe(!1),ce=dt(x,W=>{const ee=new Set;for(const se of W)ee.add(`${se.id_1}-${se.id_2}`);return ee}),we=dt(x,W=>{const ee=new Map;if(!(W!=null&&W.length))return{scoreCount:ee,scoreRange:{min:0,max:0,range:0}};let se=1/0,Q=-1/0;for(const oe of W){const De=oe.regions_id_1<oe.regions_id_2?`${oe.regions_id_1}-${oe.regions_id_2}`:`${oe.regions_id_2}-${oe.regions_id_1}`,Ge=ee.get(De)||{score:0,count:0};Ge.score+=oe.weightedScore||0,Ge.count++,ee.set(De,Ge)}for(const{score:oe}of ee.values())oe<se&&(se=oe),oe>Q&&(Q=oe);return se===1/0&&(se=Q=0),{scoreCount:ee,scoreRange:{min:se,max:Q,range:Q-se}}}),fe=dt(x,W=>{const ee=new Map;if(!(W!=null&&W.length))return{scoreCount:ee,countRange:{min:0,max:0,range:0}};for(const oe of W)for(const De of[oe.regions_id_1,oe.regions_id_2]){const Ge=ee.get(De)||{score:0,count:0};Ge.score+=oe.weightedScore||0,Ge.count++,ee.set(De,Ge)}let se=1/0,Q=-1/0;for(const{count:oe}of ee.values())oe<se&&(se=oe),oe>Q&&(Q=oe);return se===1/0&&(se=Q=0),{scoreCount:ee,countRange:{min:se,max:Q,range:Q-se}}}),Ve=dt([J,k,we],([W,ee,se])=>W==="filtered"?se:ee),Xe=dt([J,C,fe],([W,ee,se])=>W==="filtered"?se:ee),pe=dt(_,W=>{var se;const ee=new Map;for(const[Q,oe]of W)ee.set(Q,Math.max(1,((se=oe.images)==null?void 0:se.length)||oe.img_nb||1));return ee});return{error:e,loadingProgress:i,cancelLoading:()=>{m&&(m.abort(),n.set(!1))},allPairs:h,visiblePairs:x,pairIndex:p,documentNodes:_,imageNodes:g,fetchPairs:T,imageNetwork:D,documentNetwork:I,selectedCategories:r,pairStats:S,documentStats:C,imageStats:w,docPairStats:k,docSetNumber:N,selectedNodes:o,selectedRegions:s,updateSelectedNodes:W=>o.set(W),toggleCategory:P,toggleRegion:X,selectAllRegions:U,buildAlignedImageMatrix:H,threshold:l,setThreshold:W=>l.set(W),topK:a,setTopK:W=>a.set(W),mutualTopK:c,setMutualTopK:W=>c.set(W),scoreMode:u,setScoreMode:W=>u.set(W),matrixMode:J,setMatrixMode:W=>J.set(W),normalizeByPages:ue,setNormalizeByPages:W=>ue.set(W),activeDocPairStats:Ve,activeDocStats:Xe,pageCountMap:pe,visiblePairIds:ce}}function Ca(t){let e,n,i,r,s,o=(t[0].clusters||0)+"",l;return{c(){e=b("div"),n=b("div"),i=b("p"),i.textContent="Clusters",r=j(),s=b("p"),l=re(o),y(i,"class","heading"),y(s,"class","title is-5"),y(e,"class","level-item")},m(a,c){z(a,e,c),v(e,n),v(n,i),v(n,r),v(n,s),v(s,l)},p(a,c){c&1&&o!==(o=(a[0].clusters||0)+"")&&Ne(l,o)},d(a){a&&R(e)}}}function H_(t){var L,F,D;let e,n,i,r,s,o,l=(t[0].count||0)+"",a,c,u,h,f,d,m,p=(t[0].links||0)+"",g,_,S,C,w,k,N,T,E=(((F=(L=t[0])==null?void 0:L.density)==null?void 0:F.toFixed(3))||0)+"",x,O=((D=t[0])==null?void 0:D.clusters)&&Ca(t);return{c(){e=b("div"),n=b("div"),i=b("div"),r=b("p"),r.textContent=`${B==="en"?"Nodes":"Nœuds"}`,s=j(),o=b("p"),a=re(l),c=j(),u=b("div"),h=b("div"),f=b("p"),f.textContent=`${B==="en"?"Edges":"Liens"}`,d=j(),m=b("p"),g=re(p),_=j(),O&&O.c(),S=j(),C=b("div"),w=b("div"),k=b("p"),k.textContent=`${B==="en"?"Density":"Densité"}`,N=j(),T=b("p"),x=re(E),y(r,"class","heading"),y(o,"class","title is-5"),y(n,"class","level-item"),y(f,"class","heading"),y(m,"class","title is-5"),y(u,"class","level-item"),y(k,"class","heading"),y(T,"class","title is-5"),y(C,"class","level-item"),y(e,"class","level has-text-centered")},m(I,H){z(I,e,H),v(e,n),v(n,i),v(i,r),v(i,s),v(i,o),v(o,a),v(e,c),v(e,u),v(u,h),v(h,f),v(h,d),v(h,m),v(m,g),v(e,_),O&&O.m(e,null),v(e,S),v(e,C),v(C,w),v(w,k),v(w,N),v(w,T),v(T,x)},p(I,[H]){var P,X,U;H&1&&l!==(l=(I[0].count||0)+"")&&Ne(a,l),H&1&&p!==(p=(I[0].links||0)+"")&&Ne(g,p),(P=I[0])!=null&&P.clusters?O?O.p(I,H):(O=Ca(I),O.c(),O.m(e,S)):O&&(O.d(1),O=null),H&1&&E!==(E=(((U=(X=I[0])==null?void 0:X.density)==null?void 0:U.toFixed(3))||0)+"")&&Ne(x,E)},i:ie,o:ie,d(I){I&&R(e),O&&O.d()}}}function V_(t,e,n){let i,r,s,o,{activeTab:l="img"}=e,{documentSetStore:a}=e;const{imageStats:c,documentStats:u,docPairStats:h}=a;return Ce(t,c,f=>n(8,o=f)),Ce(t,u,f=>n(7,s=f)),Ce(t,h,f=>n(6,r=f)),t.$$set=f=>{"activeTab"in f&&n(4,l=f.activeTab),"documentSetStore"in f&&n(5,a=f.documentSetStore)},t.$$.update=()=>{t.$$.dirty&464&&n(0,i=l==="img"?o:l==="doc"?s:r)},[i,c,u,h,l,a,r,s,o]}class U_ extends He{constructor(e){super(),Fe(this,e,V_,H_,Re,{activeTab:4,documentSetStore:5})}}function B_(t){let e,n,i;const r=t[1].default,s=Vt(r,t,t[0],null);return{c(){e=b("table"),n=b("tbody"),s&&s.c(),y(e,"class","table is-fullwidth")},m(o,l){z(o,e,l),v(e,n),s&&s.m(n,null),i=!0},p(o,[l]){s&&s.p&&(!i||l&1)&&Bt(s,r,o,o[0],i?Ut(r,o[0],l,null):qt(o[0]),null)},i(o){i||(V(s,o),i=!0)},o(o){K(s,o),i=!1},d(o){o&&R(e),s&&s.d(o)}}}function q_(t,e,n){let{$$slots:i={},$$scope:r}=e;return t.$$set=s=>{"$$scope"in s&&n(0,r=s.$$scope)},[r,i]}class K_ extends He{constructor(e){super(),Fe(this,e,q_,B_,Re,{})}}const W_=t=>({}),Ia=t=>({}),Y_=t=>({}),xa=t=>({}),X_=t=>({}),Ma=t=>({});function G_(t){let e;const n=t[4]["row-body"],i=Vt(n,t,t[3],Ia);return{c(){i&&i.c()},m(r,s){i&&i.m(r,s),e=!0},p(r,s){i&&i.p&&(!e||s&8)&&Bt(i,n,r,r[3],e?Ut(n,r[3],s,W_):qt(r[3]),Ia)},i(r){e||(V(i,r),e=!0)},o(r){K(i,r),e=!1},d(r){i&&i.d(r)}}}function J_(t){let e,n,i,r;const s=t[4]["row-body"],o=Vt(s,t,t[3],xa);return{c(){e=b("div"),n=b("div"),o&&o.c(),y(n,"class","grid is-gap-2"),y(e,"class",i="fixed-grid has-"+t[2]+"-cols")},m(l,a){z(l,e,a),v(e,n),o&&o.m(n,null),r=!0},p(l,a){o&&o.p&&(!r||a&8)&&Bt(o,s,l,l[3],r?Ut(s,l[3],a,Y_):qt(l[3]),xa),(!r||a&4&&i!==(i="fixed-grid has-"+l[2]+"-cols"))&&y(e,"class",i)},i(l){r||(V(o,l),r=!0)},o(l){K(o,l),r=!1},d(l){l&&R(e),o&&o.d(l)}}}function Q_(t){let e,n,i,r,s,o,l,a,c,u;jt(t[5]);const h=t[4]["row-header"],f=Vt(h,t,t[3],Ma),d=[J_,G_],m=[];function p(g,_){return g[0]?0:1}return o=p(t),l=m[o]=d[o](t),{c(){e=b("tr"),n=b("th"),i=b("div"),f&&f.c(),r=j(),s=b("td"),l.c(),y(i,"class","content-wrapper py-5"),y(n,"class","is-3 center-flex is-narrow"),We(n,"width","15vw"),y(s,"class","p-5 is-fullwidth")},m(g,_){z(g,e,_),v(e,n),v(n,i),f&&f.m(i,null),v(e,r),v(e,s),m[o].m(s,null),a=!0,c||(u=Ie(window,"resize",t[5]),c=!0)},p(g,[_]){f&&f.p&&(!a||_&8)&&Bt(f,h,g,g[3],a?Ut(h,g[3],_,X_):qt(g[3]),Ma);let S=o;o=p(g),o===S?m[o].p(g,_):(tt(),K(m[S],1,1,()=>{m[S]=null}),nt(),l=m[o],l?l.p(g,_):(l=m[o]=d[o](g),l.c()),V(l,1),l.m(s,null))},i(g){a||(V(f,g),V(l),a=!0)},o(g){K(f,g),K(l),a=!1},d(g){g&&R(e),f&&f.d(g),m[o].d(),c=!1,u()}}}function Z_(t,e,n){let i,{$$slots:r={},$$scope:s}=e,{useGrid:o=!0}=e,l=0;function a(){n(1,l=window.innerWidth)}return t.$$set=c=>{"useGrid"in c&&n(0,o=c.useGrid),"$$scope"in c&&n(3,s=c.$$scope)},t.$$.update=()=>{t.$$.dirty&2&&n(2,i=Us(l))},[o,l,i,s,r,a]}class Aa extends He{constructor(e){super(),Fe(this,e,Z_,Q_,Re,{useGrid:0})}}const ub="",e0=t=>({}),Ta=t=>({}),t0=t=>({}),Na=t=>({});function Pa(t){let e,n,i,r,s,o,l,a,c,u,h,f=t[1]&&Oa(t);return a=new ji({props:{tooltipText:t[2][t[1]][B]}}),{c(){f&&f.c(),e=j(),n=b("div"),i=b("button"),r=Wt("svg"),s=Wt("path"),l=j(),ve(a.$$.fragment),y(s,"fill","none"),y(s,"stroke","currentColor"),y(s,"stroke-linecap","round"),y(s,"stroke-linejoin","round"),y(s,"stroke-width","1.5"),y(s,"d","M12 3v18m0 0l8.5-8.5M12 21l-8.5-8.5"),y(r,"style",o=`transform: rotate(${t[1]?"180":"0"}deg)`),y(r,"xmlns","http://www.w3.org/2000/svg"),y(r,"width","24"),y(r,"height","24"),y(r,"viewBox","0 0 24 24"),y(r,"class","svelte-jbs1sd"),y(i,"class","button is-link svelte-jbs1sd"),y(n,"class","ctrl-toggle svelte-jbs1sd")},m(d,m){f&&f.m(d,m),z(d,e,m),z(d,n,m),v(n,i),v(i,r),v(r,s),v(i,l),he(a,i,null),c=!0,u||(h=Ie(i,"click",sn(t[3])),u=!0)},p(d,m){d[1]?f?(f.p(d,m),m&2&&V(f,1)):(f=Oa(d),f.c(),V(f,1),f.m(e.parentNode,e)):f&&(tt(),K(f,1,1,()=>{f=null}),nt()),(!c||m&2&&o!==(o=`transform: rotate(${d[1]?"180":"0"}deg)`))&&y(r,"style",o);const p={};m&2&&(p.tooltipText=d[2][d[1]][B]),a.$set(p)},i(d){c||(V(f),V(a.$$.fragment,d),c=!0)},o(d){K(f),K(a.$$.fragment,d),c=!1},d(d){f&&f.d(d),d&&R(e),d&&R(n),me(a),u=!1,h()}}}function Oa(t){let e,n,i;const r=t[5]["toolbar-hidden"],s=Vt(r,t,t[4],Ta);return{c(){e=b("div"),s&&s.c(),y(e,"class","ctrl-extra")},m(o,l){z(o,e,l),s&&s.m(e,null),i=!0},p(o,l){s&&s.p&&(!i||l&16)&&Bt(s,r,o,o[4],i?Ut(r,o[4],l,e0):qt(o[4]),Ta)},i(o){i||(V(s,o),jt(()=>{i&&(n||(n=_n(e,qs,{axis:"y"},!0)),n.run(1))}),i=!0)},o(o){K(s,o),n||(n=_n(e,qs,{axis:"y"},!1)),n.run(0),i=!1},d(o){o&&R(e),s&&s.d(o),o&&n&&n.end()}}}function n0(t){let e,n,i,r,s,o,l,a;const c=t[5]["toolbar-visible"],u=Vt(c,t,t[4],Na);let h=t[0]&&Pa(t);return{c(){e=b("div"),n=b("form"),i=b("div"),r=b("div"),s=b("div"),u&&u.c(),o=j(),h&&h.c(),y(s,"class","ctrl-block svelte-jbs1sd"),y(r,"class","ctrl-block-wrapper svelte-jbs1sd"),y(i,"class","ctrl-base"),y(n,"class","ctrl svelte-jbs1sd"),y(e,"id","toolbar"),y(e,"class",l="ctrl-wrapper is-flex is-justify-content-center is-align-items-center "+(t[1]?"toolbar-expanded":"toolbar-collapsed")+" svelte-jbs1sd")},m(f,d){z(f,e,d),v(e,n),v(n,i),v(i,r),v(r,s),u&&u.m(s,null),v(n,o),h&&h.m(n,null),a=!0},p(f,[d]){u&&u.p&&(!a||d&16)&&Bt(u,c,f,f[4],a?Ut(c,f[4],d,t0):qt(f[4]),Na),f[0]?h?(h.p(f,d),d&1&&V(h,1)):(h=Pa(f),h.c(),V(h,1),h.m(n,null)):h&&(tt(),K(h,1,1,()=>{h=null}),nt()),(!a||d&2&&l!==(l="ctrl-wrapper is-flex is-justify-content-center is-align-items-center "+(f[1]?"toolbar-expanded":"toolbar-collapsed")+" svelte-jbs1sd"))&&y(e,"class",l)},i(f){a||(V(u,f),V(h),a=!0)},o(f){K(u,f),K(h),a=!1},d(f){f&&R(e),u&&u.d(f),h&&h.d()}}}function i0(t,e,n){let i,{$$slots:r={},$$scope:s}=e,{expandable:o=!0}=e;const l={true:{en:"Collapse the toolbar",fr:"Refermer le menu"},false:{en:"Expand the toolbar",fr:"Ouvrir le menu"}},a=()=>n(1,i=!i);return t.$$set=c=>{"expandable"in c&&n(0,o=c.expandable),"$$scope"in c&&n(4,s=c.$$scope)},n(1,i=!1),[o,i,l,a,s,r]}class r0 extends He{constructor(e){super(),Fe(this,e,i0,n0,Re,{expandable:0})}}function La(t){let e,n,i,r,s,o,l,a,c,u=t[5]>1&&Da(t),h=t[5]<t[3]&&za(t);return{c(){e=b("nav"),n=b("ul"),u&&u.c(),i=j(),r=b("li"),s=b("a"),o=re(t[5]),l=j(),h&&h.c(),y(s,"class","pagination-link is-current"),y(s,"href",null),y(n,"class","pagination-list ml-0"),y(e,"class","pagination is-centered mb-2"),y(e,"aria-label","pagination")},m(f,d){z(f,e,d),v(e,n),u&&u.m(n,null),v(n,i),v(n,r),v(r,s),v(s,o),v(n,l),h&&h.m(n,null),a||(c=Ie(s,"click",sn(t[9])),a=!0)},p(f,d){f[5]>1?u?u.p(f,d):(u=Da(f),u.c(),u.m(n,i)):u&&(u.d(1),u=null),d&32&&Ne(o,f[5]),f[5]<f[3]?h?h.p(f,d):(h=za(f),h.c(),h.m(n,null)):h&&(h.d(1),h=null)},d(f){f&&R(e),u&&u.d(),h&&h.d(),a=!1,c()}}}function Da(t){let e,n,i,r,s,o,l=t[5]-1>1&&Ra(t);return{c(){e=b("li"),n=b("a"),n.textContent="1",i=j(),l&&l.c(),r=Ct(),y(n,"class","pagination-link"),y(n,"href",null)},m(a,c){z(a,e,c),v(e,n),z(a,i,c),l&&l.m(a,c),z(a,r,c),s||(o=Ie(n,"click",sn(t[7])),s=!0)},p(a,c){a[5]-1>1?l?l.p(a,c):(l=Ra(a),l.c(),l.m(r.parentNode,r)):l&&(l.d(1),l=null)},d(a){a&&R(e),a&&R(i),l&&l.d(a),a&&R(r),s=!1,o()}}}function Ra(t){let e,n,i,r=t[5]-1+"",s,o,l,a=t[5]-1>2&&$a();return{c(){a&&a.c(),e=j(),n=b("li"),i=b("a"),s=re(r),y(i,"class","pagination-link"),y(i,"href",null)},m(c,u){a&&a.m(c,u),z(c,e,u),z(c,n,u),v(n,i),v(i,s),o||(l=Ie(i,"click",sn(t[8])),o=!0)},p(c,u){c[5]-1>2?a||(a=$a(),a.c(),a.m(e.parentNode,e)):a&&(a.d(1),a=null),u&32&&r!==(r=c[5]-1+"")&&Ne(s,r)},d(c){a&&a.d(c),c&&R(e),c&&R(n),o=!1,l()}}}function $a(t){let e;return{c(){e=b("li"),e.innerHTML='<span class="pagination-ellipsis">…</span>'},m(n,i){z(n,e,i)},d(n){n&&R(e)}}}function za(t){let e,n,i,r,s,o,l=t[5]+1<t[3]&&ja(t);return{c(){l&&l.c(),e=j(),n=b("li"),i=b("a"),r=re(t[3]),y(i,"class","pagination-link"),y(i,"href",null)},m(a,c){l&&l.m(a,c),z(a,e,c),z(a,n,c),v(n,i),v(i,r),s||(o=Ie(i,"click",sn(t[11])),s=!0)},p(a,c){a[5]+1<a[3]?l?l.p(a,c):(l=ja(a),l.c(),l.m(e.parentNode,e)):l&&(l.d(1),l=null),c&8&&Ne(r,a[3])},d(a){l&&l.d(a),a&&R(e),a&&R(n),s=!1,o()}}}function ja(t){let e,n,i=t[5]+1+"",r,s,o,l,a,c=t[5]+2<t[3]&&Fa();return{c(){e=b("li"),n=b("a"),r=re(i),s=j(),c&&c.c(),o=Ct(),y(n,"class","pagination-link"),y(n,"href",null)},m(u,h){z(u,e,h),v(e,n),v(n,r),z(u,s,h),c&&c.m(u,h),z(u,o,h),l||(a=Ie(n,"click",sn(t[10])),l=!0)},p(u,h){h&32&&i!==(i=u[5]+1+"")&&Ne(r,i),u[5]+2<u[3]?c||(c=Fa(),c.c(),c.m(o.parentNode,o)):c&&(c.d(1),c=null)},d(u){u&&R(e),u&&R(s),c&&c.d(u),u&&R(o),l=!1,a()}}}function Fa(t){let e;return{c(){e=b("li"),e.innerHTML='<span class="pagination-ellipsis">…</span>'},m(n,i){z(n,e,i)},d(n){n&&R(e)}}}function s0(t){let e,n,i=t[5]*t[2]-t[2]+1+"",r,s,o=Math.min(t[5]*t[2],t[1])+"",l,a,c,u,h=t[4]&&La(t);return{c(){h&&h.c(),e=j(),n=b("div"),r=re(i),s=re(" - "),l=re(o),a=re(" / "),c=re(t[1]),y(n,"class",u="is-size-7 is-center mb-4 "+(t[4]?"":"mt-4"))},m(f,d){h&&h.m(f,d),z(f,e,d),z(f,n,d),v(n,r),v(n,s),v(n,l),v(n,a),v(n,c)},p(f,[d]){f[4]?h?h.p(f,d):(h=La(f),h.c(),h.m(e.parentNode,e)):h&&(h.d(1),h=null),d&36&&i!==(i=f[5]*f[2]-f[2]+1+"")&&Ne(r,i),d&38&&o!==(o=Math.min(f[5]*f[2],f[1])+"")&&Ne(l,o),d&2&&Ne(c,f[1]),d&16&&u!==(u="is-size-7 is-center mb-4 "+(f[4]?"":"mt-4"))&&y(n,"class",u)},i:ie,o:ie,d(f){h&&h.d(f),f&&R(e),f&&R(n)}}}function o0(t,e,n){let i,r,s,{store:o}=e;const{currentPage:l}=o;Ce(t,l,p=>n(5,s=p));let{nbOfItems:a}=e,{pageLength:c=vu}=e;const u=()=>o.handlePageUpdate(1),h=()=>o.handlePageUpdate(s-1),f=()=>o.handlePageUpdate(s),d=()=>o.handlePageUpdate(s+1),m=()=>o.handlePageUpdate(i);return t.$$set=p=>{"store"in p&&n(0,o=p.store),"nbOfItems"in p&&n(1,a=p.nbOfItems),"pageLength"in p&&n(2,c=p.pageLength)},t.$$.update=()=>{t.$$.dirty&6&&n(3,i=c>0?Math.ceil(a/c):1),t.$$.dirty&14&&n(4,r=i>1||a>c)},[o,a,c,i,r,s,l,u,h,f,d,m]}class Ha extends He{constructor(e){super(),Fe(this,e,o0,s0,Re,{store:0,nbOfItems:1,pageLength:2})}}function l0(t){let e,n,i,r,s=B==="en"?"Save selection":"Sauvegarder la sélection",o,l,a;return{c(){e=b("button"),n=b("span"),i=b("i"),r=j(),o=re(s),y(i,"class","fa-solid fa-floppy-disk"),y(e,"class","button is-link")},m(c,u){z(c,e,u),v(e,n),v(n,i),v(n,r),v(n,o),l||(a=Ie(e,"click",t[7]),l=!0)},p:ie,d(c){c&&R(e),l=!1,a()}}}function a0(t){let e,n,i,r,s=B==="en"?"Go to treatment":"Accéder au traitement",o,l;return{c(){var a;e=b("a"),n=b("span"),i=b("i"),r=j(),o=re(s),y(i,"class","fa-solid fa-gear"),y(e,"class","button is-link"),y(e,"href",l="/"+Yt+"/treatment/add/?document_set="+((a=t[3])==null?void 0:a.id))},m(a,c){z(a,e,c),v(e,n),v(n,i),v(n,r),v(n,o)},p(a,c){var u;c&8&&l!==(l="/"+Yt+"/treatment/add/?document_set="+((u=a[3])==null?void 0:u.id))&&y(e,"href",l)},d(a){a&&R(e)}}}function Va(t){let e,n,i,r,s,o,l;return{c(){var a,c;e=b("a"),n=b("span"),n.innerHTML='<i class="fa-solid fa-file-export"></i> JSON',r=j(),s=b("a"),o=b("span"),o.innerHTML='<i class="fa-solid fa-file-zipper"></i> ZIP',y(e,"class","button is-link is-dark"),y(e,"href",i="/"+Yt+"/document-set/"+((a=t[3])==null?void 0:a.id)+"/json"),y(e,"target","_blank"),y(s,"class","button is-link is-dark"),y(s,"href",l="/"+Yt+"/document-set/"+((c=t[3])==null?void 0:c.id)+"/zip"),y(s,"target","_blank")},m(a,c){z(a,e,c),v(e,n),z(a,r,c),z(a,s,c),v(s,o)},p(a,c){var u,h;c&8&&i!==(i="/"+Yt+"/document-set/"+((u=a[3])==null?void 0:u.id)+"/json")&&y(e,"href",i),c&8&&l!==(l="/"+Yt+"/document-set/"+((h=a[3])==null?void 0:h.id)+"/zip")&&y(s,"href",l)},d(a){a&&R(e),a&&R(r),a&&R(s)}}}function c0(t){let e,n,i,r,s,o,l;function a(f,d){return f[2]&&!f[1]?a0:l0}let c=a(t),u=c(t),h=!t[1]&&Va(t);return{c(){e=b("footer"),n=b("div"),i=b("button"),i.textContent=`${B==="en"?"Clear selection":"Vider la sélection"}`,r=j(),u.c(),s=j(),h&&h.c(),y(i,"class","button button-close is-link is-light"),y(n,"class","buttons"),y(e,"class","modal-card-foot is-center")},m(f,d){z(f,e,d),v(e,n),v(n,i),v(n,r),u.m(n,null),v(n,s),h&&h.m(n,null),o||(l=Ie(i,"click",t[6]),o=!0)},p(f,[d]){c===(c=a(f))&&u?u.p(f,d):(u.d(1),u=c(f),u&&(u.c(),u.m(n,s))),f[1]?h&&(h.d(1),h=null):h?h.p(f,d):(h=Va(f),h.c(),h.m(n,null))},i:ie,o:ie,d(f){f&&R(e),u.d(),h&&h.d(),o=!1,l()}}}function u0(t,e,n){let i,r,{selectionStore:s}=e;const{isSaved:o,selection:l}=s;Ce(t,o,h=>n(2,i=h)),Ce(t,l,h=>n(3,r=h));let{isRegion:a=s.type!=="documentSet"}=e;const c=()=>s.empty(),u=()=>s.save();return t.$$set=h=>{"selectionStore"in h&&n(0,s=h.selectionStore),"isRegion"in h&&n(1,a=h.isRegion)},[s,a,i,r,o,l,c,u]}class f0 extends He{constructor(e){super(),Fe(this,e,u0,c0,Re,{selectionStore:0,isRegion:1})}}const fb="";function d0(t){let e,n,i,r,s,o;return{c(){e=b("span"),n=re(t[5]),i=j(),r=b("span"),r.innerHTML='<i class="fas fa-edit"></i>',y(r,"class","pl-3 smaller has-text-link")},m(l,a){z(l,e,a),v(e,n),v(e,i),v(e,r),s||(o=[Ie(e,"click",t[7]),Ie(e,"keyup",null)],s=!0)},p(l,a){a&32&&Ne(n,l[5])},d(l){l&&R(e),s=!1,yt(o)}}}function h0(t){let e,n,i;return{c(){e=b("input"),y(e,"class","input selection-title svelte-sgypdx")},m(r,s){z(r,e,s),t[12](e),Ci(e,t[4]),n||(i=[Ie(e,"input",t[13]),Ie(e,"keydown",t[8]),Ie(e,"blur",t[9])],n=!0)},p(r,s){s&16&&e.value!==r[4]&&Ci(e,r[4])},d(r){r&&R(e),t[12](null),n=!1,yt(i)}}}function m0(t){let e,n,i,r,s,o,l,a,c,u,h,f,d,m,p,g,_,S,C,w;function k(O,L){return O[2]?h0:d0}let N=k(t),T=N(t);const E=t[11].default,x=Vt(E,t,t[10],null);return _=new f0({props:{selectionStore:t[0]}}),{c(){e=b("div"),n=b("div"),i=j(),r=b("div"),s=b("div"),o=b("div"),l=b("i"),a=j(),T.c(),c=re(`
                (`),u=re(t[1]),h=re(")"),f=j(),d=b("button"),m=j(),p=b("section"),x&&x.c(),g=j(),ve(_.$$.fragment),y(n,"class","modal-background"),y(l,"class","fa-solid fa-book-bookmark"),y(o,"class","title is-4 mb-0 media-content"),y(d,"class","delete media-left"),y(d,"aria-label","close"),y(s,"class","modal-card-head media mb-0 is-middle"),y(p,"class","modal-card-body"),y(r,"class","modal-content"),y(e,"id","selection-modal"),y(e,"class","modal fade"),y(e,"tabindex","-1"),y(e,"aria-labelledby","selection-modal-label"),y(e,"aria-hidden","true")},m(O,L){z(O,e,L),v(e,n),v(e,i),v(e,r),v(r,s),v(s,o),v(o,l),v(o,a),T.m(o,null),v(o,c),v(o,u),v(o,h),v(s,f),v(s,d),v(r,m),v(r,p),x&&x.m(p,null),v(r,g),he(_,r,null),S=!0,C||(w=ei(Pr.call(null,e)),C=!0)},p(O,[L]){N===(N=k(O))&&T?T.p(O,L):(T.d(1),T=N(O),T&&(T.c(),T.m(o,c))),(!S||L&2)&&Ne(u,O[1]),x&&x.p&&(!S||L&1024)&&Bt(x,E,O,O[10],S?Ut(E,O[10],L,null):qt(O[10]),null);const F={};L&1&&(F.selectionStore=O[0]),_.$set(F)},i(O){S||(V(x,O),V(_.$$.fragment,O),S=!0)},o(O){K(x,O),K(_.$$.fragment,O),S=!1},d(O){O&&R(e),T.d(),x&&x.d(O),me(_),C=!1,w()}}}function p0(t,e,n){let i,{$$slots:r={},$$scope:s}=e,{selectionStore:o}=e;const{selectionTitle:l,updateTitle:a,save:c}=o;Ce(t,l,C=>n(5,i=C));let{selectionLength:u=!1}=e,h=!1,f,d;function m(){n(2,h=!0),n(4,d=i),setTimeout(()=>f&&f.focus(),0)}function p(C){C.key==="Enter"&&g()}function g(){n(2,h=!1),a(d),c()}function _(C){gn[C?"unshift":"push"](()=>{f=C,n(3,f)})}function S(){d=this.value,n(4,d)}return t.$$set=C=>{"selectionStore"in C&&n(0,o=C.selectionStore),"selectionLength"in C&&n(1,u=C.selectionLength),"$$scope"in C&&n(10,s=C.$$scope)},[o,u,h,f,d,i,l,m,p,g,s,r,_,S]}class g0 extends He{constructor(e){super(),Fe(this,e,p0,m0,Re,{selectionStore:0,selectionLength:1})}}const db="";function _0(t){let e,n,i,r,s,o=B==="en"?"Selection":"Sélection",l,a,c,u,h,f;return{c(){e=b("div"),n=b("button"),i=b("span"),r=b("i"),s=j(),l=re(o),a=re(`
            (`),c=re(t[0]),u=re(")"),y(r,"class","fa-solid fa-book-bookmark"),y(i,"id","btn-content"),y(n,"id","set-btn"),y(n,"class","button px-5 py-4 is-link svelte-gmt9z5"),y(n,"data-target","selection-modal"),y(e,"class","set-container svelte-gmt9z5")},m(d,m){z(d,e,m),v(e,n),v(n,i),v(i,r),v(i,s),v(i,l),v(i,a),v(i,c),v(i,u),h||(f=ei(Bs.call(null,n)),h=!0)},p(d,[m]){m&1&&Ne(c,d[0])},i:ie,o:ie,d(d){d&&R(e),h=!1,f()}}}function v0(t,e,n){let{selectionLength:i=0}=e,r=i;return t.$$set=s=>{"selectionLength"in s&&n(0,i=s.selectionLength)},t.$$.update=()=>{if(t.$$.dirty&3&&i!==r){const s=i>r;n(1,r=i);const o=document.getElementById("btn-content");o&&o.animate([{transform:s?"translateY(-7px)":"translateX(-5px)"},{transform:s?"translateY(7px)":"translateX(5px)"},{transform:"translate(0)"}],{duration:300,easing:"cubic-bezier(0.65, 0, 0.35, 1)"})}},[i,r]}class y0 extends He{constructor(e){super(),Fe(this,e,v0,_0,Re,{selectionLength:0})}}const hb="";function Ua(t,e,n){const i=t.slice();return i[7]=e[n][0],i[8]=e[n][1],i}function b0(t){let e;return{c(){e=b("div"),e.textContent=`${B==="en"?"No regions in selection":"Aucune région sélectionnée"}`},m(n,i){z(n,e,i)},p:ie,d(n){n&&R(e)}}}function w0(t){let e,n,i=Object.entries(t[2]),r=[];for(let s=0;s<i.length;s+=1)r[s]=Ba(Ua(t,i,s));return{c(){e=b("div"),n=b("div");for(let s=0;s<r.length;s+=1)r[s].c();y(n,"class","grid is-gap-2"),y(e,"class","fixed-grid has-6-cols")},m(s,o){z(s,e,o),v(e,n);for(let l=0;l<r.length;l+=1)r[l]&&r[l].m(n,null)},p(s,o){if(o&13){i=Object.entries(s[2]);let l;for(l=0;l<i.length;l+=1){const a=Ua(s,i,l);r[l]?r[l].p(a,o):(r[l]=Ba(a),r[l].c(),r[l].m(n,null))}for(;l<r.length;l+=1)r[l].d(1);r.length=i.length}},d(s){s&&R(e),wt(r,s)}}}function Ba(t){let e,n,i,r,s,o,l,a=t[8].title+"",c,u,h,f,d,m;function p(){return t[6](t[7])}return{c(){e=b("div"),n=b("figure"),i=b("img"),s=j(),o=b("div"),l=b("span"),c=re(a),u=j(),h=b("button"),f=j(),At(i.src,r=Kt(t[8].img,t[8].xywh,"96,"))||y(i,"src",r),y(i,"alt","Extracted region"),y(l,"class","overlay-desc"),y(o,"class","overlay is-center svelte-g8ij5d"),y(n,"class","image is-64x64 card"),y(h,"class","delete region-btn svelte-g8ij5d"),y(h,"aria-label","remove from selection"),y(e,"class","selection cell svelte-g8ij5d")},m(g,_){z(g,e,_),v(e,n),v(n,i),v(n,s),v(n,o),v(o,l),v(l,c),v(e,u),v(e,h),v(e,f),d||(m=Ie(h,"click",p),d=!0)},p(g,_){t=g,_&4&&!At(i.src,r=Kt(t[8].img,t[8].xywh,"96,"))&&y(i,"src",r),_&4&&a!==(a=t[8].title+"")&&Ne(c,a)},d(g){g&&R(e),d=!1,m()}}}function S0(t){let e;function n(s,o){return s[4]?w0:b0}let i=n(t),r=i(t);return{c(){r.c(),e=Ct()},m(s,o){r.m(s,o),z(s,e,o)},p(s,o){i===(i=n(s))&&r?r.p(s,o):(r.d(1),r=i(s),r&&(r.c(),r.m(e.parentNode,e)))},d(s){r.d(s),s&&R(e)}}}function k0(t){let e,n,i,r;return e=new y0({props:{selectionLength:t[1]}}),i=new g0({props:{selectionLength:t[1],selectionStore:t[0],$$slots:{default:[S0]},$$scope:{ctx:t}}}),{c(){ve(e.$$.fragment),n=j(),ve(i.$$.fragment)},m(s,o){he(e,s,o),z(s,n,o),he(i,s,o),r=!0},p(s,[o]){const l={};o&2&&(l.selectionLength=s[1]),e.$set(l);const a={};o&2&&(a.selectionLength=s[1]),o&1&&(a.selectionStore=s[0]),o&2077&&(a.$$scope={dirty:o,ctx:s}),i.$set(a)},i(s){r||(V(e.$$.fragment,s),V(i.$$.fragment,s),r=!0)},o(s){K(e.$$.fragment,s),K(i.$$.fragment,s),r=!1},d(s){me(e,s),s&&R(n),me(i,s)}}}function E0(t,e,n){let i,r,s,o,{selectionStore:l}=e;const{selected:a}=l;Ce(t,a,u=>n(3,o=u));const c=u=>l.remove(u,Object.keys(o)[0]);return t.$$set=u=>{"selectionStore"in u&&n(0,l=u.selectionStore)},t.$$.update=()=>{t.$$.dirty&8&&n(2,i=Object.values(o)[0]||{}),t.$$.dirty&4&&n(1,r=Object.keys(i).length),t.$$.dirty&2&&n(4,s=r>0)},[l,r,i,o,s,a,c]}class C0 extends He{constructor(e){super(),Fe(this,e,E0,k0,Re,{selectionStore:0})}}const mb="";function qa(t,e,n){const i=t.slice();return i[17]=e[n],i}function Ka(t,e,n){const i=t.slice();return i[20]=e[n],i}function Wa(t,e,n){const i=t.slice();return i[23]=e[n],i}function I0(t){let e,n;return e=new r0({props:{expandable:!1,$$slots:{"toolbar-visible":[x0]},$$scope:{ctx:t}}}),{c(){ve(e.$$.fragment)},m(i,r){he(e,i,r),n=!0},p(i,r){const s={};r&67108864&&(s.$$scope={dirty:r,ctx:i}),e.$set(s)},i(i){n||(V(e.$$.fragment,i),n=!0)},o(i){K(e.$$.fragment,i),n=!1},d(i){me(e,i)}}}function Ya(t){let e,n,i,r,s,o=t[23].title+"",l,a,c,u=t[23].shortcut+"",h,f,d,m;return{c(){e=b("p"),n=b("button"),i=b("span"),r=b("i"),s=j(),l=re(o),a=j(),c=b("span"),h=re(u),f=j(),y(r,"class","fas "+t[23].icon+" svelte-7vjt6f"),y(i,"class","icon is-small"),y(c,"class","shortcut svelte-7vjt6f"),y(n,"class","button pl-5"),y(n,"title",t[23].desc),y(e,"class","control")},m(p,g){z(p,e,g),v(e,n),v(n,i),v(i,r),v(n,s),v(n,l),v(n,a),v(n,c),v(c,h),v(e,f),d||(m=Ie(n,"click",sn(t[23].fct)),d=!0)},p(p,g){t=p},d(p){p&&R(e),d=!1,m()}}}function x0(t){let e,n,i,r,s,o,l,a=Object.values(t[10]),c=[];for(let u=0;u<a.length;u+=1)c[u]=Ya(Wa(t,a,u));return{c(){e=b("div"),n=b("div"),i=b("div"),r=b("span"),r.textContent=`${B==="en"?"Process selection":"Agir sur la sélection"}`,s=j(),o=b("div"),l=b("div");for(let u=0;u<c.length;u+=1)c[u].c();y(r,"class","tag is-medium is-link mr-5"),y(i,"class","column is-narrow mr-5"),y(l,"class","field has-addons"),y(o,"class","column"),y(n,"class","columns is-vcentered is-mobile py-4"),y(e,"slot","toolbar-visible")},m(u,h){z(u,e,h),v(e,n),v(n,i),v(i,r),v(n,s),v(n,o),v(o,l);for(let f=0;f<c.length;f+=1)c[f]&&c[f].m(l,null)},p(u,h){if(h&1024){a=Object.values(u[10]);let f;for(f=0;f<a.length;f+=1){const d=Wa(u,a,f);c[f]?c[f].p(d,h):(c[f]=Ya(d),c[f].c(),c[f].m(l,null))}for(;f<c.length;f+=1)c[f].d(1);c.length=a.length}},d(u){u&&R(e),wt(c,u)}}}function M0(t){let e,n=t[9].title+"",i;return{c(){e=b("span"),i=re(n),y(e,"class","button is-small is-success"),y(e,"title",t[9].desc)},m(r,s){z(r,e,s),v(e,i)},p:ie,d(r){r&&R(e)}}}function A0(t){let e,n=t[8].title+"",i,r,s;function o(){return t[12](t[17])}return{c(){e=b("button"),i=re(n),y(e,"class","button is-small is-warning"),y(e,"title",t[8].desc)},m(l,a){z(l,e,a),v(e,i),r||(s=Ie(e,"click",o),r=!0)},p(l,a){t=l},d(l){l&&R(e),r=!1,s()}}}function T0(t){let e,n,i=t[17].size+"",r,s,o,l,a,c;function u(d,m){return d[17].fullyConnected?M0:A0}let h=u(t),f=h(t);return{c(){e=b("div"),n=b("span"),r=re(i),s=re(" images"),o=j(),l=b("hr"),a=j(),f.c(),c=j(),y(n,"class","cluster-size"),y(e,"class","cluster-info is-center is-fullwidth")},m(d,m){z(d,e,m),v(e,n),v(n,r),v(n,s),v(e,o),v(e,l),v(e,a),f.m(e,null),z(d,c,m)},p(d,m){m&4&&i!==(i=d[17].size+"")&&Ne(r,i),h===(h=u(d))&&f?f.p(d,m):(f.d(1),f=h(d),f&&(f.c(),f.m(e,null)))},d(d){d&&R(e),f.d(),d&&R(c)}}}function Xa(t){let e,n;return e=new Jn({props:{item:{...t[3].get(t[20]),clusterId:t[17].id},copyable:!1,selectionStore:hr}}),{c(){ve(e.$$.fragment)},m(i,r){he(e,i,r),n=!0},p(i,r){const s={};r&12&&(s.item={...i[3].get(i[20]),clusterId:i[17].id}),e.$set(s)},i(i){n||(V(e.$$.fragment,i),n=!0)},o(i){K(e.$$.fragment,i),n=!1},d(i){me(e,i)}}}function N0(t){let e,n,i=t[17].members,r=[];for(let o=0;o<i.length;o+=1)r[o]=Xa(Ka(t,i,o));const s=o=>K(r[o],1,1,()=>{r[o]=null});return{c(){for(let o=0;o<r.length;o+=1)r[o].c();e=j()},m(o,l){for(let a=0;a<r.length;a+=1)r[a]&&r[a].m(o,l);z(o,e,l),n=!0},p(o,l){if(l&12){i=o[17].members;let a;for(a=0;a<i.length;a+=1){const c=Ka(o,i,a);r[a]?(r[a].p(c,l),V(r[a],1)):(r[a]=Xa(c),r[a].c(),V(r[a],1),r[a].m(e.parentNode,e))}for(tt(),a=i.length;a<r.length;a+=1)s(a);nt()}},i(o){if(!n){for(let l=0;l<i.length;l+=1)V(r[l]);n=!0}},o(o){r=r.filter(Boolean);for(let l=0;l<r.length;l+=1)K(r[l]);n=!1},d(o){wt(r,o),o&&R(e)}}}function Ga(t,e){let n,i,r;return i=new Aa({props:{$$slots:{"row-body":[N0],"row-header":[T0]},$$scope:{ctx:e}}}),{key:t,first:null,c(){n=Ct(),ve(i.$$.fragment),this.first=n},m(s,o){z(s,n,o),he(i,s,o),r=!0},p(s,o){e=s;const l={};o&67108876&&(l.$$scope={dirty:o,ctx:e}),i.$set(l)},i(s){r||(V(i.$$.fragment,s),r=!0)},o(s){K(i.$$.fragment,s),r=!1},d(s){s&&R(n),me(i,s)}}}function P0(t){let e=[],n=new Map,i,r,s=t[2];const o=l=>l[17].id;for(let l=0;l<s.length;l+=1){let a=qa(t,s,l),c=o(a);n.set(c,e[l]=Ga(c,a))}return{c(){for(let l=0;l<e.length;l+=1)e[l].c();i=Ct()},m(l,a){for(let c=0;c<e.length;c+=1)e[c]&&e[c].m(l,a);z(l,i,a),r=!0},p(l,a){a&780&&(s=l[2],tt(),e=Pi(e,a,o,1,l,s,n,i.parentNode,Cr,Ga,i,qa),nt())},i(l){if(!r){for(let a=0;a<s.length;a+=1)V(e[a]);r=!0}},o(l){for(let a=0;a<e.length;a+=1)K(e[a]);r=!1},d(l){for(let a=0;a<e.length;a+=1)e[a].d(l);l&&R(i)}}}function O0(t){let e,n,i,r,s,o,l,a,c,u=xr&&I0(t);return n=new Ha({props:{store:t[0],nbOfItems:t[1],pageLength:t[7]}}),r=new C0({props:{selectionStore:hr}}),o=new K_({props:{$$slots:{default:[P0]},$$scope:{ctx:t}}}),a=new Ha({props:{store:t[0],nbOfItems:t[1],pageLength:t[7]}}),{c(){u&&u.c(),e=j(),ve(n.$$.fragment),i=j(),ve(r.$$.fragment),s=j(),ve(o.$$.fragment),l=j(),ve(a.$$.fragment)},m(h,f){u&&u.m(h,f),z(h,e,f),he(n,h,f),z(h,i,f),he(r,h,f),z(h,s,f),he(o,h,f),z(h,l,f),he(a,h,f),c=!0},p(h,[f]){xr&&u.p(h,f);const d={};f&1&&(d.store=h[0]),f&2&&(d.nbOfItems=h[1]),n.$set(d);const m={};f&67108876&&(m.$$scope={dirty:f,ctx:h}),o.$set(m);const p={};f&1&&(p.store=h[0]),f&2&&(p.nbOfItems=h[1]),a.$set(p)},i(h){c||(V(u),V(n.$$.fragment,h),V(r.$$.fragment,h),V(o.$$.fragment,h),V(a.$$.fragment,h),c=!0)},o(h){K(u),K(n.$$.fragment,h),K(r.$$.fragment,h),K(o.$$.fragment,h),K(a.$$.fragment,h),c=!1},d(h){u&&u.d(h),h&&R(e),me(n,h),h&&R(i),me(r,h),h&&R(s),me(o,h),h&&R(l),me(a,h)}}}function L0(t,e,n){let i,r,s,{documentSetStore:o}=e;const{imageNodes:l}=o;Ce(t,l,w=>n(3,s=w));let{clusterStore:a}=e;const{clusterNb:c,paginatedClusters:u,pageLength:h,validateCluster:f,newCluster:d,removeFromClusters:m}=a;Ce(t,c,w=>n(1,i=w)),Ce(t,u,w=>n(2,r=w));const p={create:{title:B==="en"?"New cluster":"Nouveau cluster",desc:B==="en"?"Create a new validated cluster from the selected regions":"Créer un nouveau cluster valide à partir des régions sélectionnées",icon:"fa-object-group",shortcut:"Shift + C",fct:d},remove:{title:B==="en"?"Remove from cluster":"Retirer du cluster",desc:B==="en"?"Remove the selected regions from their cluster":"Retirer les régions sélectionnées de leur cluster",icon:"fa-chain-broken",shortcut:"Shift + D",fct:m},validate:{title:B==="en"?"Validate cluster":"Valider le cluster",desc:B==="en"?"Set as exact match all the pairs of regions in the cluster":"Définir comme correspondance exacte toutes les paires de régions dans le cluster",icon:"fa-check",fct:f},validated:{title:B==="en"?"Validated cluster":"Cluster valide",desc:B==="en"?"All pairs of regions have be categorized as exact matches":"Toutes les paires de régions ont été catégorisées comme des correspondances exactes",icon:"fa-check"}},{validate:g,validated:_,...S}=p,C=w=>g.fct(w);return t.$$set=w=>{"documentSetStore"in w&&n(11,o=w.documentSetStore),"clusterStore"in w&&n(0,a=w.clusterStore)},[a,i,r,s,l,c,u,h,g,_,S,o,C]}class D0 extends He{constructor(e){super(),Fe(this,e,L0,O0,Re,{documentSetStore:11,clusterStore:0})}}function R0(t,e){const i=Pe(1),{visiblePairs:r,imageNodes:s}=t;Ar(i,"p");function o(w){Tr(w,i,"p")}function l(w){if(w.length===0)return[];const k=new Map,N=O=>k.has(O)?(k.get(O)!==O&&k.set(O,N(k.get(O))),k.get(O)):(k.set(O,O),O),T=(O,L)=>{const F=N(O),D=N(L);F!==D&&k.set(D,F)},E=new Set;w.forEach(O=>{T(O.id_1,O.id_2),E.add(O.id_1),E.add(O.id_2)});const x=new Map;return E.forEach(O=>{const L=N(O);x.has(L)||x.set(L,[]),x.get(L).push(O)}),Array.from(x.values()).map(O=>{const L=O.length,F=L*(L-1)/2,D=new Set(O),I=w.filter(H=>D.has(H.id_1)&&D.has(H.id_2)).length;return{id:crypto.randomUUID(),members:O,size:L,fullyConnected:I===F}}).filter(O=>O.size>1).sort((O,L)=>L.size-O.size)}const a=dt(r,w=>w.length?l(w):[]),c=Pe([]);a.subscribe(w=>{c.set(w)});const u=dt([c,i],([w,k])=>{const N=(k-1)*10,T=N+10;return w.slice(N,T)}),h=(w,k)=>{const N=vt(s).get(w),T=vt(s).get(k);return{img_1:w,img_2:k,regions_id_1:N==null?void 0:N.regionId,regions_id_2:T==null?void 0:T.regionId}},f=(w,k)=>(c.update(N=>N.map(T=>{if(!k[T.id])return T;const E=T.members.filter(x=>!w.has(x));return{...T,members:E,size:E.length}}).filter(T=>T.size>0)),!0),d=async w=>{const k=Array.isArray(w)?w:Object.keys(w),N=new Set(k),T={};vt(c).forEach(x=>{const O=x.members.filter(L=>N.has(L));O.length>0&&(T[x.id]=O)});const E=Object.entries(T).flatMap(([x,O])=>{const L=vt(c).find(D=>D.id===x);if(!L)return[];const F=L.members.filter(D=>!N.has(D));return O.flatMap(D=>F.map(I=>h(D,I)))});if(E.length===0)return f(N,T),!0;try{const x=await Hs(()=>fetch(`${window.location.origin}/${Yt}/uncategorize-pair-batch`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":vn},body:JSON.stringify({pairs:E})}));return x.ok?(f(N,T),!0):(console.log(x),await Tt(B==="en"?"Batch un-categorization failed":"La dé-catégorisation par lot a échoué",B==="en"?"Error":"Erreur"),!1)}catch(x){return await Tt(x,B==="en"?"Error":"Erreur"),!1}},m=async w=>{const k=w.flatMap((N,T)=>w.slice(T+1).map(E=>h(N,E)));try{const N=await Hs(()=>fetch(`${window.location.origin}/${Yt}/exact-match-batch`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":vn},body:JSON.stringify({pairs:k})}));return N.ok?!0:(console.log(N),await Tt(B==="en"?"Batch validation failed":"La validation par lot a échoué",B==="en"?"Error":"Erreur"),!1)}catch(N){return await Tt(N,B==="en"?"Error":"Erreur"),console.error("Error:",N),!1}},p=async w=>{if(!xr)return await Tt(B==="en"?"You do not have permission to validate clusters":"Vous n'avez pas la permission, de valider les clusters.",B==="en"?"Permission Denied":"Permission refusée"),!1;const k=await m(w.members);return k&&c.update(N=>N.map(T=>T.id===w.id?{...T,fullyConnected:!0}:T)),k},g=async w=>{if(w.length<2)return!1;const k=await m(w);return k&&c.update(N=>[{id:crypto.randomUUID(),members:w,size:w.length,fullyConnected:!0},...N].sort((E,x)=>x.size-E.size)),k},_=()=>Object.values(vt(e).selected)[0]||{},S=async()=>{if(!await Tt(B==="en"?"Do you want to create a cluster out of these images?":"Voulez-vous créer un cluster à partir de ces images ?",B==="en"?"Confirm creation":"Confirmer la création",!0))return;const k=_(),N=Object.keys(k);return N.length<2?(await Tt(B==="en"?"Cluster creation requires at least 2 images":"La création d'un nouveau cluster nécessite a minima 2 images",B==="en"?"Impossible creation":"Création impossible"),!1):!await d(N)||!await g(N)?!1:(e.empty(),!0)},C=async()=>{if(!await Tt(B==="en"?"Do you want to remove these images from their clusters?":"Voulez-vous supprimer ces images de leurs clusters ?",B==="en"?"Confirm deletion":"Confirmer la suppression",!0))return;const k=_();return await d(Object.keys(k))?(e.empty(),!0):!1};return{imageClusters:a,interfaceClusters:c,clusterNb:dt(c,w=>w.length),validateCluster:p,removeFromClusters:C,newCluster:S,paginatedClusters:u,handlePageUpdate:o,pageLength:10,currentPage:i}}function Ja(t,e,n){const i=t.slice();return i[25]=e[n],i}function $0(t){let e,n,i;return{c(){e=b("p"),e.textContent=`La matrice de documents visualise les scores de similarité globaux entre tous les documents du
                        corpus.
                        Cliquez sur une cellule pour voir les détails des similarités entre pages.`,n=j(),i=b("ul"),i.innerHTML=`<li>Matrice : Scores normalisés entre documents (0-100).</li>
                        <li>Scatter plot : Similarités détaillées par page.</li>`},m(r,s){z(r,e,s),z(r,n,s),z(r,i,s)},d(r){r&&R(e),r&&R(n),r&&R(i)}}}function z0(t){let e,n,i;return{c(){e=b("p"),e.textContent=`The Documents Network illustrates the connections between different witnesses in the document
                        set.
                        Each node represents a witness, and edges denote relationships based on shared content or other
                        relevant factors.`,n=j(),i=b("ul"),i.innerHTML=`<li>Nodes: Witnesses in the document set.</li>
                        <li>Edges: Relationships based on shared content.</li>`},m(r,s){z(r,e,s),z(r,n,s),z(r,i,s)},d(r){r&&R(e),r&&R(n),r&&R(i)}}}function j0(t){let e,n,i;return{c(){e=b("p"),e.textContent=`The Regions Network visualizes the relationships between image regions across different witnesses
                        in the document set.
                        Each node represents an image region, and edges indicate similarity or connections based on
                        predefined criteria.`,n=j(),i=b("ul"),i.innerHTML=`<li>Nodes: Image regions from various witnesses.</li>
                        <li>Edges: Similarity links between regions.</li>`},m(r,s){z(r,e,s),z(r,n,s),z(r,i,s)},d(r){r&&R(e),r&&R(n),r&&R(i)}}}function F0(t){let e,n,i,r;function s(a,c){return a[23]==="img"?j0:a[23]==="doc"?z0:$0}let o=s(t),l=o(t);return i=new U_({props:{activeTab:t[23],documentSetStore:t[4]}}),{c(){e=b("div"),l.c(),n=j(),ve(i.$$.fragment),y(e,"slot","datavizInfo")},m(a,c){z(a,e,c),l.m(e,null),v(e,n),he(i,e,null),r=!0},p(a,c){o!==(o=s(a))&&(l.d(1),l=o(a),l&&(l.c(),l.m(e,n)));const u={};c&8388608&&(u.activeTab=a[23]),i.$set(u)},i(a){r||(V(i.$$.fragment,a),r=!0)},o(a){K(i.$$.fragment,a),r=!1},d(a){a&&R(e),l.d(),me(i)}}}function H0(t){let e,n,i;return n=new Jf({props:{docSet:t[0],documentSetStore:t[4],clusterStore:t[8],$$slots:{datavizInfo:[F0]},$$scope:{ctx:t}}}),{c(){e=b("div"),ve(n.$$.fragment),y(e,"slot","sidebar")},m(r,s){z(r,e,s),he(n,e,null),i=!0},p(r,s){const o={};s&1&&(o.docSet=r[0]),s&276824064&&(o.$$scope={dirty:s,ctx:r}),n.$set(o)},i(r){i||(V(n.$$.fragment,r),i=!0)},o(r){K(n.$$.fragment,r),i=!1},d(r){r&&R(e),me(n)}}}function Qa(t){let e,n,i,r,s,o,l,a=t[25].title+"",c,u;return{c(){e=b("div"),n=b("figure"),i=b("img"),s=j(),o=b("div"),l=b("span"),c=re(a),u=j(),At(i.src,r=Kt(t[25].img,t[25].xywh,"96,"))||y(i,"src",r),y(i,"alt","Extracted region"),y(l,"class","overlay-desc"),y(o,"class","overlay is-center"),y(n,"class","image is-64x64 card"),y(e,"class","selection cell")},m(h,f){z(h,e,f),v(e,n),v(n,i),v(n,s),v(n,o),v(o,l),v(l,c),v(e,u)},p(h,f){f&2&&!At(i.src,r=Kt(h[25].img,h[25].xywh,"96,"))&&y(i,"src",r),f&2&&a!==(a=h[25].title+"")&&Ne(c,a)},d(h){h&&R(e)}}}function V0(t){let e,n,i=Object.values(Object.values(t[1])[0]||{}),r=[];for(let s=0;s<i.length;s+=1)r[s]=Qa(Ja(t,i,s));return{c(){e=b("div"),n=b("div");for(let s=0;s<r.length;s+=1)r[s].c();y(n,"class","grid is-gap-2"),y(e,"slot","content"),y(e,"class","fixed-grid has-6-cols")},m(s,o){z(s,e,o),v(e,n);for(let l=0;l<r.length;l+=1)r[l]&&r[l].m(n,null)},p(s,o){if(o&2){i=Object.values(Object.values(s[1])[0]||{});let l;for(l=0;l<i.length;l+=1){const a=Ja(s,i,l);r[l]?r[l].p(a,o):(r[l]=Qa(a),r[l].c(),r[l].m(n,null))}for(;l<r.length;l+=1)r[l].d(1);r.length=i.length}},d(s){s&&R(e),wt(r,s)}}}function U0(t){let e,n,i,r={ctx:t,current:null,token:null,hasCatch:!1,pending:Q0,then:K0,catch:q0,value:24,blocks:[,,,]};return Er(n=t[3],r),{c(){e=Ct(),r.block.c()},m(s,o){z(s,e,o),r.block.m(s,r.anchor=o),r.mount=()=>e.parentNode,r.anchor=e,i=!0},p(s,o){t=s,r.ctx=t,o&8&&n!==(n=t[3])&&Er(n,r)||js(r,t,o)},i(s){i||(V(r.block),i=!0)},o(s){for(let o=0;o<3;o+=1){const l=r.blocks[o];K(l)}i=!1},d(s){s&&R(e),r.block.d(s),r.token=null,r=null}}}function B0(t){let e,n,i;return{c(){e=b("article"),n=b("div"),i=re(t[2]),y(n,"class","message-body"),y(e,"class","message is-danger")},m(r,s){z(r,e,s),v(e,n),v(n,i)},p(r,s){s&4&&Ne(i,r[2])},i:ie,o:ie,d(r){r&&R(e)}}}function q0(t){return{c:ie,m:ie,p:ie,i:ie,o:ie,d:ie}}function K0(t){let e,n,i,r;const s=[Y0,W0],o=[];function l(a,c){return a[24]===0?0:1}return e=l(t),n=o[e]=s[e](t),{c(){n.c(),i=Ct()},m(a,c){o[e].m(a,c),z(a,i,c),r=!0},p(a,c){let u=e;e=l(a),e===u?o[e].p(a,c):(tt(),K(o[u],1,1,()=>{o[u]=null}),nt(),n=o[e],n?n.p(a,c):(n=o[e]=s[e](a),n.c()),V(n,1),n.m(i.parentNode,i))},i(a){r||(V(n),r=!0)},o(a){K(n),r=!1},d(a){o[e].d(a),a&&R(i)}}}function W0(t){let e,n,i=t[9][t[23]]+"",r,s,o,l,a;const c=[J0,G0,X0],u=[];function h(f,d){return f[23]==="img"||f[23]==="doc"?0:f[23]==="sim"?1:f[23]==="mat"?2:-1}return~(o=h(t))&&(l=u[o]=c[o](t)),{c(){e=b("div"),n=b("h2"),r=re(i),s=j(),l&&l.c(),y(n,"class","title is-3 has-text-link")},m(f,d){z(f,e,d),v(e,n),v(n,r),v(e,s),~o&&u[o].m(e,null),a=!0},p(f,d){(!a||d&8388608)&&i!==(i=f[9][f[23]]+"")&&Ne(r,i);let m=o;o=h(f),o===m?~o&&u[o].p(f,d):(l&&(tt(),K(u[m],1,1,()=>{u[m]=null}),nt()),~o?(l=u[o],l?l.p(f,d):(l=u[o]=c[o](f),l.c()),V(l,1),l.m(e,null)):l=null)},i(f){a||(V(l),a=!0)},o(f){K(l),a=!1},d(f){f&&R(e),~o&&u[o].d()}}}function Y0(t){let e;return{c(){e=b("article"),e.innerHTML=`<div class="message-body">No document pairs found for this configuration.
                            Please adjust your selection criteria in the sidebar to include more documents or
                            categories.</div>`,y(e,"class","message is-warning")},m(n,i){z(n,e,i)},p:ie,i:ie,o:ie,d(n){n&&R(e)}}}function X0(t){let e,n;return e=new R_({props:{documentSetStore:t[4]}}),{c(){ve(e.$$.fragment)},m(i,r){he(e,i,r),n=!0},p:ie,i(i){n||(V(e.$$.fragment,i),n=!0)},o(i){K(e.$$.fragment,i),n=!1},d(i){me(e,i)}}}function G0(t){let e,n;return e=new D0({props:{documentSetStore:t[4],clusterStore:t[8]}}),{c(){ve(e.$$.fragment)},m(i,r){he(e,i,r),n=!0},p:ie,i(i){n||(V(e.$$.fragment,i),n=!0)},o(i){K(e.$$.fragment,i),n=!1},d(i){me(e,i)}}}function J0(t){let e,n;return e=new I_({props:{documentSetStore:t[4],type:t[23]}}),{c(){ve(e.$$.fragment)},m(i,r){he(e,i,r),n=!0},p(i,r){const s={};r&8388608&&(s.type=i[23]),e.$set(s)},i(i){n||(V(e.$$.fragment,i),n=!0)},o(i){K(e.$$.fragment,i),n=!1},d(i){me(e,i)}}}function Q0(t){let e;return{c(){e=b("progress"),e.textContent="Loading...",y(e,"class","progress is-link"),y(e,"max","100")},m(n,i){z(n,e,i)},p:ie,i:ie,o:ie,d(n){n&&R(e)}}}function Z0(t){let e,n,i,r,s,o;n=new Ru({props:{$$slots:{content:[V0]},$$scope:{ctx:t}}});const l=[B0,U0],a=[];function c(u,h){return u[2]?0:1}return r=c(t),s=a[r]=l[r](t),{c(){e=b("div"),ve(n.$$.fragment),i=j(),s.c(),y(e,"slot","content")},m(u,h){z(u,e,h),he(n,e,null),v(e,i),a[r].m(e,null),o=!0},p(u,h){const f={};h&268435458&&(f.$$scope={dirty:h,ctx:u}),n.$set(f);let d=r;r=c(u),r===d?a[r].p(u,h):(tt(),K(a[d],1,1,()=>{a[d]=null}),nt(),s=a[r],s?s.p(u,h):(s=a[r]=l[r](u),s.c()),V(s,1),s.m(e,null))},i(u){o||(V(n.$$.fragment,u),V(s),o=!0)},o(u){K(n.$$.fragment,u),K(s),o=!1},d(u){u&&R(e),me(n),a[r].d()}}}function e1(t){let e,n;return e=new qu({props:{tabList:t[9],$$slots:{content:[Z0,({activeTab:i})=>({23:i}),({activeTab:i})=>i?8388608:0],sidebar:[H0,({activeTab:i})=>({23:i}),({activeTab:i})=>i?8388608:0]},$$scope:{ctx:t}}}),{c(){ve(e.$$.fragment)},m(i,r){he(e,i,r),n=!0},p(i,[r]){const s={};r&276824079&&(s.$$scope={dirty:r,ctx:i}),e.$set(s)},i(i){n||(V(e.$$.fragment,i),n=!0)},o(i){K(e.$$.fragment,i),n=!1},d(i){me(e,i)}}}function t1(t,e,n){var O;let i,r,s,{docSet:o}=e;const l=F_(o.id),{error:a,fetchPairs:c,selectedRegions:u,selectedCategories:h,threshold:f,topK:d,mutualTopK:m,scoreMode:p}=l;Ce(t,a,L=>n(2,r=L)),Ce(t,c,L=>n(3,s=L));let g,_,S,C,w,k;Dn(()=>{g=Vn(u,"regions","set"),_=Vn(h,"categories","array",[1]),S=Vn(f,"threshold","number"),C=Vn(d,"topk","number"),w=Vn(m,"mutual","boolean"),k=Vn(p,"mode","string");const L=u.subscribe(g),F=h.subscribe(_),D=f.subscribe(S),I=d.subscribe(C),H=m.subscribe(w),P=p.subscribe(k);return()=>{L(),F(),D(),I(),H(),P()}});const{selected:N}=hr;Ce(t,N,L=>n(1,i=L));const T=R0(l,hr),E={sim:B==="en"?"Copy Clusters":"Groupe de copies",mat:B==="en"?"Document Matrix":"Matrice de documents",img:B==="en"?"Image Network":"Réseau d'images",doc:B==="en"?"Document Network":"Réseau de documents"},x=((O=o==null?void 0:o.selection)==null?void 0:O.selected)||{Witness:{},Series:{},Work:{}};return $n("selectedDocuments",x),t.$$set=L=>{"docSet"in L&&n(0,o=L.docSet)},[o,i,r,s,l,a,c,N,T,E]}class n1 extends He{constructor(e){super(),Fe(this,e,t1,e1,Re,{docSet:0})}}new n1({target:document.getElementById("document-set"),props:{docSet}});const pb="";function i1(t){let e,n,i;return n=new Jn({props:{item:t[0],height:"full"}}),{c(){e=b("div"),ve(n.$$.fragment),y(e,"class","img-wrapper svelte-1duc3w1")},m(r,s){z(r,e,s),he(n,e,null),i=!0},p(r,[s]){const o={};s&1&&(o.item=r[0]),n.$set(o)},i(r){i||(V(n.$$.fragment,r),i=!0)},o(r){K(n.$$.fragment,r),i=!1},d(r){r&&R(e),me(n)}}}function r1(t,e,n){let{mainImgItem:i}=e;return t.$$set=r=>{"mainImgItem"in r&&n(0,i=r.mainImgItem)},[i]}class Za extends He{constructor(e){super(),Fe(this,e,r1,i1,Re,{mainImgItem:0})}}const gb="";function s1(t){return{c:ie,m:ie,p:ie,d:ie}}function o1(t){let e,n=`${t[5][0]}%`,i=`${t[5][1]}%`,r=`${t[5][2]}%`,s=`${t[5][3]}%`;return{c(){e=b("div"),y(e,"class","modal-context-bbox svelte-zgr10j"),y(e,"aria-description",B==="fr"?"Position de la région extraite sur la page":"Position of the extracted region on the page"),We(e,"left",n),We(e,"top",i),We(e,"width",r),We(e,"height",s)},m(o,l){z(o,e,l)},p:ie,d(o){o&&R(e)}}}function l1(t){return{c:ie,m:ie,p:ie,d:ie}}function a1(t){let e,n,i,r,s,o={ctx:t,current:null,token:null,hasCatch:!1,pending:l1,then:o1,catch:s1,value:5};return Er(t[1],o),{c(){e=b("div"),n=b("div"),i=b("img"),s=j(),o.block.c(),y(i,"class","card modal-context-full-page svelte-zgr10j"),At(i.src,r=t[0])||y(i,"src",r),y(i,"alt",B==="fr"?"Vue de la page d'où la région est extraite":"View of the page the region is extracted from"),y(n,"class","modal-context-wrapper svelte-zgr10j"),y(e,"class","modal-context-outer pb-4 svelte-zgr10j")},m(l,a){z(l,e,a),v(e,n),v(n,i),v(n,s),o.block.m(n,o.anchor=null),o.mount=()=>n,o.anchor=null},p(l,[a]){t=l,js(o,t,a)},i:ie,o:ie,d(l){l&&R(e),o.block.d(),o.token=null,o=null}}}function c1(t,e,n){let{mainImgItem:i}=e;const r=Kt(i.img,"full","full"),s=Iu(i.img),o=i.xywh.map(Number),l=fetch(s).then(a=>a.json()).then(a=>[o[0]/a.width,o[1]/a.height,o[2]/a.width,o[3]/a.height].map(c=>c*100));return t.$$set=a=>{"mainImgItem"in a&&n(2,i=a.mainImgItem)},[r,l,i]}class u1 extends He{constructor(e){super(),Fe(this,e,c1,a1,Re,{mainImgItem:2})}}const _b="";function ec(t,e,n){const i=t.slice();return i[13]=e[n].id,i[14]=e[n].label,i}function tc(t){let e,n,i=t[14]+"",r,s,o,l,a;function c(){return t[9](t[13])}return{c(){e=b("li"),n=b("a"),r=re(i),s=j(),y(n,"href",""),y(e,"class",o=t[13]===t[2]?"is-active":"")},m(u,h){z(u,e,h),v(e,n),v(n,r),v(e,s),l||(a=Ie(n,"click",sn(c)),l=!0)},p(u,h){t=u,h&4&&o!==(o=t[13]===t[2]?"is-active":"")&&y(e,"class",o)},d(u){u&&R(e),l=!1,a()}}}function f1(t){let e,n,i,r,s,o,l,a,c,u,h,f,d,m,p,g=t[3],_=[];for(let k=0;k<g.length;k+=1)_[k]=tc(ec(t,g,k));const S=[t[1][t[2]]||{}];var C=t[0][t[2]]||null;function w(k){let N={};for(let T=0;T<S.length;T+=1)N=As(N,S[T]);return{props:N}}return C&&(u=xi(C,w())),{c(){e=b("div"),n=b("div"),i=j(),r=b("div"),s=b("div"),o=b("div"),l=b("ul");for(let k=0;k<_.length;k+=1)_[k].c();a=j(),c=b("div"),u&&ve(u.$$.fragment),h=j(),f=b("button"),y(n,"class","modal-background"),y(o,"class","tabs is-centered"),We(o,"height","fit-content"),y(c,"class","ml-4 mr-4 modal-main-wrapper svelte-1uakzh2"),Ye(c,"pb-4",t[2]==="main"),y(s,"class","modal-inner svelte-1uakzh2"),y(r,"class","modal-content svelte-1uakzh2"),y(f,"class","modal-close is-large"),y(f,"aria-label","close"),y(e,"id","region-modal-wrapper"),y(e,"class","modal is-active")},m(k,N){z(k,e,N),v(e,n),v(e,i),v(e,r),v(r,s),v(s,o),v(o,l);for(let T=0;T<_.length;T+=1)_[T]&&_[T].m(l,null);v(s,a),v(s,c),u&&he(u,c,null),v(e,h),v(e,f),d=!0,m||(p=[Ie(n,"click",t[6]),Ie(n,"keyup",t[5]),Ie(f,"click",t[6])],m=!0)},p(k,[N]){if(N&28){g=k[3];let E;for(E=0;E<g.length;E+=1){const x=ec(k,g,E);_[E]?_[E].p(x,N):(_[E]=tc(x),_[E].c(),_[E].m(l,null))}for(;E<_.length;E+=1)_[E].d(1);_.length=g.length}const T=N&6?du(S,[hu(k[1][k[2]]||{})]):{};if(N&5&&C!==(C=k[0][k[2]]||null)){if(u){tt();const E=u;K(E.$$.fragment,1,0,()=>{me(E,1)}),nt()}C?(u=xi(C,w()),ve(u.$$.fragment),V(u.$$.fragment,1),he(u,c,null)):u=null}else C&&u.$set(T);(!d||N&4)&&Ye(c,"pb-4",k[2]==="main")},i(k){d||(u&&V(u.$$.fragment,k),d=!0)},o(k){u&&K(u.$$.fragment,k),d=!1},d(k){k&&R(e),wt(_,k),u&&me(u),m=!1,yt(p)}}}function d1(t,e,n){let i,{mainImgItem:r}=e,{compareImgItem:s}=e;const o=Ti(),l=s?["main","page","similarity","expansion"]:["main","page"],a={expansion:{fr:"Expansion de requête",en:"Query expansion"},similarity:{fr:"Comparaison",en:"Comparison"},page:{fr:"Vue de la page",en:"Page view"},main:{fr:"Vue principale",en:"Main view"}},c=l.map(g=>{var _;return{id:g,label:((_=a[g])==null?void 0:_[B])??"Main view"}}),u={main:Za,page:u1};s&&Promise.all([fs(()=>Promise.resolve().then(()=>dy),void 0).then(g=>g.default),fs(()=>Promise.resolve().then(()=>jy),void 0).then(g=>g.default)]).then(([g,_])=>{const S=Object.keys(u);l.filter(C=>!S.includes(C)).map(C=>n(0,u[C]=C==="expansion"?_:C==="similarity"?g:Za,u))});const h={};l.map(g=>n(1,h[g]=g==="similarity"?{compareImgItem:s,mainImgItem:r}:{mainImgItem:r},h));const f=g=>n(2,i=g),d=g=>{g.key==="Escape"&&o("closeModal")},m=()=>o("closeModal");Dn(()=>{document.addEventListener("keyup",d)}),Rn(()=>{document.removeEventListener("keydown",d)});const p=g=>f(g);return t.$$set=g=>{"mainImgItem"in g&&n(7,r=g.mainImgItem),"compareImgItem"in g&&n(8,s=g.compareImgItem)},n(2,i=l[0]),[u,h,i,c,f,d,m,r,s,p]}class h1 extends He{constructor(e){super(),Fe(this,e,d1,f1,Re,{mainImgItem:7,compareImgItem:8})}}const vb="";function m1(t){let e,n,i,r,s,o,l,a,c,u,h;return n=new ji({props:{targetHtmlId:t[0],tooltipText:t[1]}}),{c(){e=b("div"),ve(n.$$.fragment),i=j(),r=b("button"),s=Wt("svg"),o=Wt("path"),l=Wt("path"),a=Wt("path"),y(o,"d","M53.6443 14.25C47.7042 5.33 37.7293 0 26.9801 0C16.2206 0 6.24576 5.33 0.305653 14.25L0 14.71L0.305653 15.17C6.24576 24.09 16.2206 29.42 26.9801 29.42C37.7293 29.42 47.7042 24.09 53.6443 15.16L53.95 14.71L53.6443 14.25ZM3.25025 14.71C7.63146 8.69001 14.0606 4.65 21.2641 3.22C20.0619 3.83 18.9411 4.62 17.963 5.59C15.5176 8.02 14.1625 11.25 14.1625 14.67C14.1625 18.11 15.5176 21.34 17.963 23.76C19.0124 24.79 20.1943 25.61 21.4781 26.23C14.1829 24.85 7.6824 20.78 3.25025 14.71ZM27.1125 22.64C22.7008 22.64 19.1041 19.08 19.1041 14.7C19.1041 12.59 19.9396 10.6 21.4475 9.10001C22.9555 7.60001 24.9729 6.77 27.1125 6.77C29.2522 6.77 31.2594 7.60001 32.7775 9.10001C34.2855 10.6 35.121 12.59 35.121 14.7C35.121 16.82 34.2855 18.82 32.7775 20.32C31.2594 21.81 29.242 22.64 27.1125 22.64ZM32.9915 26.14C34.204 25.53 35.3146 24.74 36.3029 23.77C38.7482 21.34 40.0932 18.11 40.0932 14.68C40.0932 9.75 37.281 5.47001 33.1647 3.32001C40.1747 4.81001 46.4102 8.83001 50.6896 14.71C46.3797 20.64 40.0728 24.67 32.9915 26.14Z"),y(o,"fill","black"),y(o,"class","svelte-19wutme"),y(l,"d","M26.9804 25.98C33.3222 25.98 38.4633 20.9343 38.4633 14.71C38.4633 8.48576 33.3222 3.44 26.9804 3.44C20.6386 3.44 15.4976 8.48576 15.4976 14.71C15.4976 20.9343 20.6386 25.98 26.9804 25.98Z"),y(l,"fill","black"),y(l,"class","svelte-19wutme"),y(a,"d","M17.9529 23.85L36.2928 5.85001"),y(a,"stroke","black"),y(a,"stroke-width","3"),y(a,"stroke-miterlimit","10"),y(a,"class","svelte-19wutme"),y(s,"width","54"),y(s,"height","30"),y(s,"viewBox","0 0 54 30"),y(s,"fill","none"),y(s,"xmlns","http://www.w3.org/2000/svg"),y(s,"class","svelte-19wutme"),y(r,"class","button tag svelte-19wutme"),y(r,"title",t[1]),y(e,"id",t[0])},m(f,d){z(f,e,d),he(n,e,null),v(e,i),v(e,r),v(r,s),v(s,o),v(s,l),v(s,a),c=!0,u||(h=Ie(r,"click",t[2]),u=!0)},p:ie,i(f){c||(V(n.$$.fragment,f),c=!0)},o(f){K(n.$$.fragment,f),c=!1},d(f){f&&R(e),me(n),u=!1,h()}}}function p1(t,e,n){let i,r,{mainImgItem:s}=e,{compareImgItem:o=void 0}=e;$n("isInModal",!0);const l=`modal-opener-${window.crypto.randomUUID()}`,a=B==="fr"?"Vue détaillée":"Detailed view",c=(f,d)=>(f?(d=new h1({target:document.querySelector("body"),props:{mainImgItem:s,compareImgItem:o}}),d.$on("closeModal",h)):!f&&r!=null&&d.$destroy(),d),u=()=>n(5,i=!i),h=()=>n(5,i=!1);return t.$$set=f=>{"mainImgItem"in f&&n(3,s=f.mainImgItem),"compareImgItem"in f&&n(4,o=f.compareImgItem)},t.$$.update=()=>{t.$$.dirty&96&&n(6,r=c(i,r))},n(5,i=!1),[l,a,u,s,o,i,r]}class g1 extends He{constructor(e){super(),Fe(this,e,p1,m1,Re,{mainImgItem:3,compareImgItem:4})}}const _1=Object.freeze(Object.defineProperty({__proto__:null,default:g1},Symbol.toStringTag,{value:"Module"})),yb="";function v1(t){let e,n,i,r,s,o,l;return{c(){e=b("button"),n=b("span"),n.innerHTML='<span class="switch-control svelte-g5g8im"><span class="switch-spot"></span></span>',i=j(),r=b("span"),s=re(t[0]),y(n,"class","switch mr-2 svelte-g5g8im"),y(r,"class","label svelte-g5g8im"),y(e,"id",t[3]),y(e,"name",t[3]),y(e,"class","input-checkbox-wrapper is-flex is-align-items-center-is-justify-content-center p-2 pl-3 pr-3 svelte-g5g8im"),y(e,"aria-label",t[0]),Ye(e,"is-checked",t[2]),Ye(e,"is-clickable",t[1]),Ye(e,"button",t[1])},m(a,c){z(a,e,c),v(e,n),v(e,i),v(e,r),v(r,s),o||(l=Ie(e,"click",sn(t[4])),o=!0)},p(a,[c]){c&1&&Ne(s,a[0]),c&1&&y(e,"aria-label",a[0]),c&4&&Ye(e,"is-checked",a[2]),c&2&&Ye(e,"is-clickable",a[1]),c&2&&Ye(e,"button",a[1])},i:ie,o:ie,d(a){a&&R(e),o=!1,l()}}}function y1(t,e,n){let i,{toggleLabel:r}=e,{start:s=!1}=e,{buttonDisplay:o=!1}=e;const l=`input-toggle-${window.crypto.randomUUID()}`,a=Ti(),c=zt("resetTrigger")||void 0;c==null||c.subscribe(h);const u=()=>n(2,i=!i);function h(){n(2,i=s)}return t.$$set=f=>{"toggleLabel"in f&&n(0,r=f.toggleLabel),"start"in f&&n(5,s=f.start),"buttonDisplay"in f&&n(1,o=f.buttonDisplay)},t.$$.update=()=>{t.$$.dirty&32&&n(2,i=s),t.$$.dirty&4&&a("updateChecked",i)},[r,o,i,l,u,s]}class b1 extends He{constructor(e){super(),Fe(this,e,y1,v1,Re,{toggleLabel:0,start:5,buttonDisplay:1})}}/*! choices.js v11.1.0 | © 2025 Josh Johnson | https://github.com/jshjohnson/Choices#readme */var ms=function(t,e){return ms=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(n[r]=i[r])},ms(t,e)};function nc(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");ms(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}var Rt=function(){return Rt=Object.assign||function(e){for(var n,i=1,r=arguments.length;i<r;i++){n=arguments[i];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},Rt.apply(this,arguments)};function w1(t,e,n){if(n||arguments.length===2)for(var i=0,r=e.length,s;i<r;i++)(s||!(i in e))&&(s||(s=Array.prototype.slice.call(e,0,i)),s[i]=e[i]);return t.concat(s||Array.prototype.slice.call(e))}typeof SuppressedError=="function"&&SuppressedError;var _t={ADD_CHOICE:"ADD_CHOICE",REMOVE_CHOICE:"REMOVE_CHOICE",FILTER_CHOICES:"FILTER_CHOICES",ACTIVATE_CHOICES:"ACTIVATE_CHOICES",CLEAR_CHOICES:"CLEAR_CHOICES",ADD_GROUP:"ADD_GROUP",ADD_ITEM:"ADD_ITEM",REMOVE_ITEM:"REMOVE_ITEM",HIGHLIGHT_ITEM:"HIGHLIGHT_ITEM"},$t={showDropdown:"showDropdown",hideDropdown:"hideDropdown",change:"change",choice:"choice",search:"search",addItem:"addItem",removeItem:"removeItem",highlightItem:"highlightItem",highlightChoice:"highlightChoice",unhighlightItem:"unhighlightItem"},xt={TAB_KEY:9,SHIFT_KEY:16,BACK_KEY:46,DELETE_KEY:8,ENTER_KEY:13,A_KEY:65,ESC_KEY:27,UP_KEY:38,DOWN_KEY:40,PAGE_UP_KEY:33,PAGE_DOWN_KEY:34},S1=["fuseOptions","classNames"],Sn={Text:"text",SelectOne:"select-one",SelectMultiple:"select-multiple"},ic=function(t){return{type:_t.ADD_CHOICE,choice:t}},k1=function(t){return{type:_t.REMOVE_CHOICE,choice:t}},E1=function(t){return{type:_t.FILTER_CHOICES,results:t}},C1=function(t){return{type:_t.ACTIVATE_CHOICES,active:t}},I1=function(t){return{type:_t.ADD_GROUP,group:t}},rc=function(t){return{type:_t.ADD_ITEM,item:t}},sc=function(t){return{type:_t.REMOVE_ITEM,item:t}},mr=function(t,e){return{type:_t.HIGHLIGHT_ITEM,item:t,highlighted:e}},x1=function(t,e){return Math.floor(Math.random()*(e-t)+t)},oc=function(t){return Array.from({length:t},function(){return x1(0,36).toString(36)}).join("")},M1=function(t,e){var n=t.id||t.name&&"".concat(t.name,"-").concat(oc(2))||oc(4);return n=n.replace(/(:|\.|\[|\]|,)/g,""),n="".concat(e,"-").concat(n),n},A1=function(t,e,n){n===void 0&&(n=1);for(var i="".concat(n>0?"next":"previous","ElementSibling"),r=t[i];r;){if(r.matches(e))return r;r=r[i]}return null},T1=function(t,e,n){n===void 0&&(n=1);var i;return n>0?i=e.scrollTop+e.offsetHeight>=t.offsetTop+t.offsetHeight:i=t.offsetTop>=e.scrollTop,i},pr=function(t){if(typeof t!="string"){if(t==null)return"";if(typeof t=="object"){if("raw"in t)return pr(t.raw);if("trusted"in t)return t.trusted}return t}return t.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/'/g,"&#039;").replace(/"/g,"&quot;")},N1=function(){var t=document.createElement("div");return function(e){t.innerHTML=e.trim();for(var n=t.children[0];t.firstChild;)t.removeChild(t.firstChild);return n}}(),vi=function(t,e){return typeof t=="function"?t(pr(e),e):t},lc=function(t){return typeof t=="function"?t():t},An=function(t){if(typeof t=="string")return t;if(typeof t=="object"){if("trusted"in t)return t.trusted;if("raw"in t)return t.raw}return""},ac=function(t){if(typeof t=="string")return t;if(typeof t=="object"){if("escaped"in t)return t.escaped;if("trusted"in t)return t.trusted}return""},ps=function(t,e){return t?ac(e):pr(e)},fn=function(t,e,n){t.innerHTML=ps(e,n)},P1=function(t,e){var n=t.value,i=t.label,r=i===void 0?n:i,s=e.value,o=e.label,l=o===void 0?s:o;return An(r).localeCompare(An(l),[],{sensitivity:"base",ignorePunctuation:!0,numeric:!0})},O1=function(t,e){return t.rank-e.rank},L1=function(t,e,n){n===void 0&&(n=null);var i=new CustomEvent(e,{detail:n,bubbles:!0,cancelable:!0});return t.dispatchEvent(i)},D1=function(t,e){var n=Object.keys(t).sort(),i=Object.keys(e).sort();return n.filter(function(r){return i.indexOf(r)<0})},gr=function(t){return Array.isArray(t)?t:[t]},yi=function(t){return t&&Array.isArray(t)?t.map(function(e){return".".concat(e)}).join(""):".".concat(t)},Le=function(t,e){var n;(n=t.classList).add.apply(n,gr(e))},tn=function(t,e){var n;(n=t.classList).remove.apply(n,gr(e))},R1=function(t){if(typeof t<"u")try{return JSON.parse(t)}catch{return t}return{}},$1=function(t,e,n){var i=t.itemEl;i&&(tn(i,n),Le(i,e))},z1=function(){function t(e){var n=e.element,i=e.type,r=e.classNames;this.element=n,this.classNames=r,this.type=i,this.isActive=!1}return t.prototype.show=function(){return Le(this.element,this.classNames.activeState),this.element.setAttribute("aria-expanded","true"),this.isActive=!0,this},t.prototype.hide=function(){return tn(this.element,this.classNames.activeState),this.element.setAttribute("aria-expanded","false"),this.isActive=!1,this},t}(),cc=function(){function t(e){var n=e.element,i=e.type,r=e.classNames,s=e.position;this.element=n,this.classNames=r,this.type=i,this.position=s,this.isOpen=!1,this.isFlipped=!1,this.isDisabled=!1,this.isLoading=!1}return t.prototype.shouldFlip=function(e,n){var i=!1;return this.position==="auto"?i=this.element.getBoundingClientRect().top-n>=0&&!window.matchMedia("(min-height: ".concat(e+1,"px)")).matches:this.position==="top"&&(i=!0),i},t.prototype.setActiveDescendant=function(e){this.element.setAttribute("aria-activedescendant",e)},t.prototype.removeActiveDescendant=function(){this.element.removeAttribute("aria-activedescendant")},t.prototype.open=function(e,n){Le(this.element,this.classNames.openState),this.element.setAttribute("aria-expanded","true"),this.isOpen=!0,this.shouldFlip(e,n)&&(Le(this.element,this.classNames.flippedState),this.isFlipped=!0)},t.prototype.close=function(){tn(this.element,this.classNames.openState),this.element.setAttribute("aria-expanded","false"),this.removeActiveDescendant(),this.isOpen=!1,this.isFlipped&&(tn(this.element,this.classNames.flippedState),this.isFlipped=!1)},t.prototype.addFocusState=function(){Le(this.element,this.classNames.focusState)},t.prototype.removeFocusState=function(){tn(this.element,this.classNames.focusState)},t.prototype.enable=function(){tn(this.element,this.classNames.disabledState),this.element.removeAttribute("aria-disabled"),this.type===Sn.SelectOne&&this.element.setAttribute("tabindex","0"),this.isDisabled=!1},t.prototype.disable=function(){Le(this.element,this.classNames.disabledState),this.element.setAttribute("aria-disabled","true"),this.type===Sn.SelectOne&&this.element.setAttribute("tabindex","-1"),this.isDisabled=!0},t.prototype.wrap=function(e){var n=this.element,i=e.parentNode;i&&(e.nextSibling?i.insertBefore(n,e.nextSibling):i.appendChild(n)),n.appendChild(e)},t.prototype.unwrap=function(e){var n=this.element,i=n.parentNode;i&&(i.insertBefore(e,n),i.removeChild(n))},t.prototype.addLoadingState=function(){Le(this.element,this.classNames.loadingState),this.element.setAttribute("aria-busy","true"),this.isLoading=!0},t.prototype.removeLoadingState=function(){tn(this.element,this.classNames.loadingState),this.element.removeAttribute("aria-busy"),this.isLoading=!1},t}(),j1=function(){function t(e){var n=e.element,i=e.type,r=e.classNames,s=e.preventPaste;this.element=n,this.type=i,this.classNames=r,this.preventPaste=s,this.isFocussed=this.element.isEqualNode(document.activeElement),this.isDisabled=n.disabled,this._onPaste=this._onPaste.bind(this),this._onInput=this._onInput.bind(this),this._onFocus=this._onFocus.bind(this),this._onBlur=this._onBlur.bind(this)}return Object.defineProperty(t.prototype,"placeholder",{set:function(e){this.element.placeholder=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){return this.element.value},set:function(e){this.element.value=e},enumerable:!1,configurable:!0}),t.prototype.addEventListeners=function(){var e=this.element;e.addEventListener("paste",this._onPaste),e.addEventListener("input",this._onInput,{passive:!0}),e.addEventListener("focus",this._onFocus,{passive:!0}),e.addEventListener("blur",this._onBlur,{passive:!0})},t.prototype.removeEventListeners=function(){var e=this.element;e.removeEventListener("input",this._onInput),e.removeEventListener("paste",this._onPaste),e.removeEventListener("focus",this._onFocus),e.removeEventListener("blur",this._onBlur)},t.prototype.enable=function(){var e=this.element;e.removeAttribute("disabled"),this.isDisabled=!1},t.prototype.disable=function(){var e=this.element;e.setAttribute("disabled",""),this.isDisabled=!0},t.prototype.focus=function(){this.isFocussed||this.element.focus()},t.prototype.blur=function(){this.isFocussed&&this.element.blur()},t.prototype.clear=function(e){return e===void 0&&(e=!0),this.element.value="",e&&this.setWidth(),this},t.prototype.setWidth=function(){var e=this.element;e.style.minWidth="".concat(e.placeholder.length+1,"ch"),e.style.width="".concat(e.value.length+1,"ch")},t.prototype.setActiveDescendant=function(e){this.element.setAttribute("aria-activedescendant",e)},t.prototype.removeActiveDescendant=function(){this.element.removeAttribute("aria-activedescendant")},t.prototype._onInput=function(){this.type!==Sn.SelectOne&&this.setWidth()},t.prototype._onPaste=function(e){this.preventPaste&&e.preventDefault()},t.prototype._onFocus=function(){this.isFocussed=!0},t.prototype._onBlur=function(){this.isFocussed=!1},t}(),F1=4,uc=function(){function t(e){var n=e.element;this.element=n,this.scrollPos=this.element.scrollTop,this.height=this.element.offsetHeight}return t.prototype.prepend=function(e){var n=this.element.firstElementChild;n?this.element.insertBefore(e,n):this.element.append(e)},t.prototype.scrollToTop=function(){this.element.scrollTop=0},t.prototype.scrollToChildElement=function(e,n){var i=this;if(e){var r=this.element.offsetHeight,s=this.element.scrollTop+r,o=e.offsetHeight,l=e.offsetTop+o,a=n>0?this.element.scrollTop+l-s:e.offsetTop;requestAnimationFrame(function(){i._animateScroll(a,n)})}},t.prototype._scrollDown=function(e,n,i){var r=(i-e)/n,s=r>1?r:1;this.element.scrollTop=e+s},t.prototype._scrollUp=function(e,n,i){var r=(e-i)/n,s=r>1?r:1;this.element.scrollTop=e-s},t.prototype._animateScroll=function(e,n){var i=this,r=F1,s=this.element.scrollTop,o=!1;n>0?(this._scrollDown(s,r,e),s<e&&(o=!0)):(this._scrollUp(s,r,e),s>e&&(o=!0)),o&&requestAnimationFrame(function(){i._animateScroll(e,n)})},t}(),fc=function(){function t(e){var n=e.element,i=e.classNames;this.element=n,this.classNames=i,this.isDisabled=!1}return Object.defineProperty(t.prototype,"isActive",{get:function(){return this.element.dataset.choice==="active"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dir",{get:function(){return this.element.dir},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){return this.element.value},set:function(e){this.element.setAttribute("value",e),this.element.value=e},enumerable:!1,configurable:!0}),t.prototype.conceal=function(){var e=this.element;Le(e,this.classNames.input),e.hidden=!0,e.tabIndex=-1;var n=e.getAttribute("style");n&&e.setAttribute("data-choice-orig-style",n),e.setAttribute("data-choice","active")},t.prototype.reveal=function(){var e=this.element;tn(e,this.classNames.input),e.hidden=!1,e.removeAttribute("tabindex");var n=e.getAttribute("data-choice-orig-style");n?(e.removeAttribute("data-choice-orig-style"),e.setAttribute("style",n)):e.removeAttribute("style"),e.removeAttribute("data-choice")},t.prototype.enable=function(){this.element.removeAttribute("disabled"),this.element.disabled=!1,this.isDisabled=!1},t.prototype.disable=function(){this.element.setAttribute("disabled",""),this.element.disabled=!0,this.isDisabled=!0},t.prototype.triggerEvent=function(e,n){L1(this.element,e,n||{})},t}(),H1=function(t){nc(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e}(fc),bi=function(t,e){return e===void 0&&(e=!0),typeof t>"u"?e:!!t},dc=function(t){if(typeof t=="string"&&(t=t.split(" ").filter(function(e){return e.length})),Array.isArray(t)&&t.length)return t},nn=function(t,e,n){if(n===void 0&&(n=!0),typeof t=="string"){var i=pr(t),r=n||i===t?t:{escaped:i,raw:t},s=nn({value:t,label:r,selected:!0},!1);return s}var o=t;if("choices"in o){if(!e)throw new TypeError("optGroup is not allowed");var l=o,a=l.choices.map(function(f){return nn(f,!1)}),c={id:0,label:An(l.label)||l.value,active:!!a.length,disabled:!!l.disabled,choices:a};return c}var u=o,h={id:0,group:null,score:0,rank:0,value:u.value,label:u.label||u.value,active:bi(u.active),selected:bi(u.selected,!1),disabled:bi(u.disabled,!1),placeholder:bi(u.placeholder,!1),highlighted:!1,labelClass:dc(u.labelClass),labelDescription:u.labelDescription,customProperties:u.customProperties};return h},V1=function(t){return t.tagName==="INPUT"},hc=function(t){return t.tagName==="SELECT"},U1=function(t){return t.tagName==="OPTION"},B1=function(t){return t.tagName==="OPTGROUP"},q1=function(t){nc(e,t);function e(n){var i=n.element,r=n.classNames,s=n.template,o=n.extractPlaceholder,l=t.call(this,{element:i,classNames:r})||this;return l.template=s,l.extractPlaceholder=o,l}return Object.defineProperty(e.prototype,"placeholderOption",{get:function(){return this.element.querySelector('option[value=""]')||this.element.querySelector("option[placeholder]")},enumerable:!1,configurable:!0}),e.prototype.addOptions=function(n){var i=this,r=document.createDocumentFragment();n.forEach(function(s){var o=s;if(!o.element){var l=i.template(o);r.appendChild(l),o.element=l}}),this.element.appendChild(r)},e.prototype.optionsAsChoices=function(){var n=this,i=[];return this.element.querySelectorAll(":scope > option, :scope > optgroup").forEach(function(r){U1(r)?i.push(n._optionToChoice(r)):B1(r)&&i.push(n._optgroupToChoice(r))}),i},e.prototype._optionToChoice=function(n){return!n.hasAttribute("value")&&n.hasAttribute("placeholder")&&(n.setAttribute("value",""),n.value=""),{id:0,group:null,score:0,rank:0,value:n.value,label:n.label,element:n,active:!0,selected:this.extractPlaceholder?n.selected:n.hasAttribute("selected"),disabled:n.disabled,highlighted:!1,placeholder:this.extractPlaceholder&&(!n.value||n.hasAttribute("placeholder")),labelClass:typeof n.dataset.labelClass<"u"?dc(n.dataset.labelClass):void 0,labelDescription:typeof n.dataset.labelDescription<"u"?n.dataset.labelDescription:void 0,customProperties:R1(n.dataset.customProperties)}},e.prototype._optgroupToChoice=function(n){var i=this,r=n.querySelectorAll("option"),s=Array.from(r).map(function(o){return i._optionToChoice(o)});return{id:0,label:n.label||"",element:n,active:!!s.length,disabled:n.disabled,choices:s}},e}(fc),K1={containerOuter:["choices"],containerInner:["choices__inner"],input:["choices__input"],inputCloned:["choices__input--cloned"],list:["choices__list"],listItems:["choices__list--multiple"],listSingle:["choices__list--single"],listDropdown:["choices__list--dropdown"],item:["choices__item"],itemSelectable:["choices__item--selectable"],itemDisabled:["choices__item--disabled"],itemChoice:["choices__item--choice"],description:["choices__description"],placeholder:["choices__placeholder"],group:["choices__group"],groupHeading:["choices__heading"],button:["choices__button"],activeState:["is-active"],focusState:["is-focused"],openState:["is-open"],disabledState:["is-disabled"],highlightedState:["is-highlighted"],selectedState:["is-selected"],flippedState:["is-flipped"],loadingState:["is-loading"],notice:["choices__notice"],addChoice:["choices__item--selectable","add-choice"],noResults:["has-no-results"],noChoices:["has-no-choices"]},mc={items:[],choices:[],silent:!1,renderChoiceLimit:-1,maxItemCount:-1,closeDropdownOnSelect:"auto",singleModeForMultiSelect:!1,addChoices:!1,addItems:!0,addItemFilter:function(t){return!!t&&t!==""},removeItems:!0,removeItemButton:!1,removeItemButtonAlignLeft:!1,editItems:!1,allowHTML:!1,allowHtmlUserInput:!1,duplicateItemsAllowed:!0,delimiter:",",paste:!0,searchEnabled:!0,searchChoices:!0,searchFloor:1,searchResultLimit:4,searchFields:["label","value"],position:"auto",resetScrollPosition:!0,shouldSort:!0,shouldSortItems:!1,sorter:P1,shadowRoot:null,placeholder:!0,placeholderValue:null,searchPlaceholderValue:null,prependValue:null,appendValue:null,renderSelectedChoices:"auto",loadingText:"Loading...",noResultsText:"No results found",noChoicesText:"No choices to choose from",itemSelectText:"Press to select",uniqueItemText:"Only unique values can be added",customAddItemText:"Only values matching specific conditions can be added",addItemText:function(t){return'Press Enter to add <b>"'.concat(t,'"</b>')},removeItemIconText:function(){return"Remove item"},removeItemLabelText:function(t){return"Remove item: ".concat(t)},maxItemText:function(t){return"Only ".concat(t," values can be added")},valueComparer:function(t,e){return t===e},fuseOptions:{includeScore:!0},labelId:"",callbackOnInit:null,callbackOnCreateTemplates:null,classNames:K1,appendGroupInSearch:!1},pc=function(t){var e=t.itemEl;e&&(e.remove(),t.itemEl=void 0)};function W1(t,e,n){var i=t,r=!0;switch(e.type){case _t.ADD_ITEM:{e.item.selected=!0;var s=e.item.element;s&&(s.selected=!0,s.setAttribute("selected","")),i.push(e.item);break}case _t.REMOVE_ITEM:{e.item.selected=!1;var s=e.item.element;if(s){s.selected=!1,s.removeAttribute("selected");var o=s.parentElement;o&&hc(o)&&o.type===Sn.SelectOne&&(o.value="")}pc(e.item),i=i.filter(function(u){return u.id!==e.item.id});break}case _t.REMOVE_CHOICE:{pc(e.choice),i=i.filter(function(c){return c.id!==e.choice.id});break}case _t.HIGHLIGHT_ITEM:{var l=e.highlighted,a=i.find(function(c){return c.id===e.item.id});a&&a.highlighted!==l&&(a.highlighted=l,n&&$1(a,l?n.classNames.highlightedState:n.classNames.selectedState,l?n.classNames.selectedState:n.classNames.highlightedState));break}default:{r=!1;break}}return{state:i,update:r}}function Y1(t,e){var n=t,i=!0;switch(e.type){case _t.ADD_GROUP:{n.push(e.group);break}case _t.CLEAR_CHOICES:{n=[];break}default:{i=!1;break}}return{state:n,update:i}}function X1(t,e,n){var i=t,r=!0;switch(e.type){case _t.ADD_CHOICE:{i.push(e.choice);break}case _t.REMOVE_CHOICE:{e.choice.choiceEl=void 0,e.choice.group&&(e.choice.group.choices=e.choice.group.choices.filter(function(o){return o.id!==e.choice.id})),i=i.filter(function(o){return o.id!==e.choice.id});break}case _t.ADD_ITEM:case _t.REMOVE_ITEM:{e.item.choiceEl=void 0;break}case _t.FILTER_CHOICES:{var s=[];e.results.forEach(function(o){s[o.item.id]=o}),i.forEach(function(o){var l=s[o.id];l!==void 0?(o.score=l.score,o.rank=l.rank,o.active=!0):(o.score=0,o.rank=0,o.active=!1),n&&n.appendGroupInSearch&&(o.choiceEl=void 0)});break}case _t.ACTIVATE_CHOICES:{i.forEach(function(o){o.active=e.active,n&&n.appendGroupInSearch&&(o.choiceEl=void 0)});break}case _t.CLEAR_CHOICES:{i=[];break}default:{r=!1;break}}return{state:i,update:r}}var gc={groups:Y1,items:W1,choices:X1},G1=function(){function t(e){this._state=this.defaultState,this._listeners=[],this._txn=0,this._context=e}return Object.defineProperty(t.prototype,"defaultState",{get:function(){return{groups:[],items:[],choices:[]}},enumerable:!1,configurable:!0}),t.prototype.changeSet=function(e){return{groups:e,items:e,choices:e}},t.prototype.reset=function(){this._state=this.defaultState;var e=this.changeSet(!0);this._txn?this._changeSet=e:this._listeners.forEach(function(n){return n(e)})},t.prototype.subscribe=function(e){return this._listeners.push(e),this},t.prototype.dispatch=function(e){var n=this,i=this._state,r=!1,s=this._changeSet||this.changeSet(!1);Object.keys(gc).forEach(function(o){var l=gc[o](i[o],e,n._context);l.update&&(r=!0,s[o]=!0,i[o]=l.state)}),r&&(this._txn?this._changeSet=s:this._listeners.forEach(function(o){return o(s)}))},t.prototype.withTxn=function(e){this._txn++;try{e()}finally{if(this._txn=Math.max(0,this._txn-1),!this._txn){var n=this._changeSet;n&&(this._changeSet=void 0,this._listeners.forEach(function(i){return i(n)}))}}},Object.defineProperty(t.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"items",{get:function(){return this.state.items},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"highlightedActiveItems",{get:function(){return this.items.filter(function(e){return e.active&&e.highlighted})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"choices",{get:function(){return this.state.choices},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"activeChoices",{get:function(){return this.choices.filter(function(e){return e.active})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"searchableChoices",{get:function(){return this.choices.filter(function(e){return!e.disabled&&!e.placeholder})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"groups",{get:function(){return this.state.groups},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"activeGroups",{get:function(){var e=this;return this.state.groups.filter(function(n){var i=n.active&&!n.disabled,r=e.state.choices.some(function(s){return s.active&&!s.disabled});return i&&r},[])},enumerable:!1,configurable:!0}),t.prototype.inTxn=function(){return this._txn>0},t.prototype.getChoiceById=function(e){return this.activeChoices.find(function(n){return n.id===e})},t.prototype.getGroupById=function(e){return this.groups.find(function(n){return n.id===e})},t}(),Et={noChoices:"no-choices",noResults:"no-results",addChoice:"add-choice",generic:""};function J1(t,e,n){return(e=Z1(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function _c(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function Qn(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?_c(Object(n),!0).forEach(function(i){J1(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):_c(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}function Q1(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var i=n.call(t,e||"default");if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function Z1(t){var e=Q1(t,"string");return typeof e=="symbol"?e:e+""}function dn(t){return Array.isArray?Array.isArray(t):bc(t)==="[object Array]"}const ev=1/0;function tv(t){if(typeof t=="string")return t;let e=t+"";return e=="0"&&1/t==-ev?"-0":e}function nv(t){return t==null?"":tv(t)}function rn(t){return typeof t=="string"}function vc(t){return typeof t=="number"}function iv(t){return t===!0||t===!1||rv(t)&&bc(t)=="[object Boolean]"}function yc(t){return typeof t=="object"}function rv(t){return yc(t)&&t!==null}function Ht(t){return t!=null}function gs(t){return!t.trim().length}function bc(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(t)}const bb="Extended search is not available",sv="Incorrect 'index' type",ov=t=>`Invalid value for key ${t}`,lv=t=>`Pattern length exceeds max of ${t}.`,av=t=>`Missing ${t} property in key`,cv=t=>`Property 'weight' in key '${t}' must be a positive integer`,wc=Object.prototype.hasOwnProperty;class uv{constructor(e){this._keys=[],this._keyMap={};let n=0;e.forEach(i=>{let r=Sc(i);this._keys.push(r),this._keyMap[r.id]=r,n+=r.weight}),this._keys.forEach(i=>{i.weight/=n})}get(e){return this._keyMap[e]}keys(){return this._keys}toJSON(){return JSON.stringify(this._keys)}}function Sc(t){let e=null,n=null,i=null,r=1,s=null;if(rn(t)||dn(t))i=t,e=kc(t),n=_s(t);else{if(!wc.call(t,"name"))throw new Error(av("name"));const o=t.name;if(i=o,wc.call(t,"weight")&&(r=t.weight,r<=0))throw new Error(cv(o));e=kc(o),n=_s(o),s=t.getFn}return{path:e,id:n,weight:r,src:i,getFn:s}}function kc(t){return dn(t)?t:t.split(".")}function _s(t){return dn(t)?t.join("."):t}function fv(t,e){let n=[],i=!1;const r=(s,o,l)=>{if(Ht(s))if(!o[l])n.push(s);else{let a=o[l];const c=s[a];if(!Ht(c))return;if(l===o.length-1&&(rn(c)||vc(c)||iv(c)))n.push(nv(c));else if(dn(c)){i=!0;for(let u=0,h=c.length;u<h;u+=1)r(c[u],o,l+1)}else o.length&&r(c,o,l+1)}};return r(t,rn(e)?e.split("."):e,0),i?n:n[0]}const dv={includeMatches:!1,findAllMatches:!1,minMatchCharLength:1},hv={isCaseSensitive:!1,includeScore:!1,keys:[],shouldSort:!0,sortFn:(t,e)=>t.score===e.score?t.idx<e.idx?-1:1:t.score<e.score?-1:1},mv={location:0,threshold:.6,distance:100},pv={useExtendedSearch:!1,getFn:fv,ignoreLocation:!1,ignoreFieldNorm:!1,fieldNormWeight:1};var Me=Qn(Qn(Qn(Qn({},hv),dv),mv),pv);const gv=/[^ ]+/g;function _v(t=1,e=3){const n=new Map,i=Math.pow(10,e);return{get(r){const s=r.match(gv).length;if(n.has(s))return n.get(s);const o=1/Math.pow(s,.5*t),l=parseFloat(Math.round(o*i)/i);return n.set(s,l),l},clear(){n.clear()}}}class vs{constructor({getFn:e=Me.getFn,fieldNormWeight:n=Me.fieldNormWeight}={}){this.norm=_v(n,3),this.getFn=e,this.isCreated=!1,this.setIndexRecords()}setSources(e=[]){this.docs=e}setIndexRecords(e=[]){this.records=e}setKeys(e=[]){this.keys=e,this._keysMap={},e.forEach((n,i)=>{this._keysMap[n.id]=i})}create(){this.isCreated||!this.docs.length||(this.isCreated=!0,rn(this.docs[0])?this.docs.forEach((e,n)=>{this._addString(e,n)}):this.docs.forEach((e,n)=>{this._addObject(e,n)}),this.norm.clear())}add(e){const n=this.size();rn(e)?this._addString(e,n):this._addObject(e,n)}removeAt(e){this.records.splice(e,1);for(let n=e,i=this.size();n<i;n+=1)this.records[n].i-=1}getValueForItemAtKeyId(e,n){return e[this._keysMap[n]]}size(){return this.records.length}_addString(e,n){if(!Ht(e)||gs(e))return;let i={v:e,i:n,n:this.norm.get(e)};this.records.push(i)}_addObject(e,n){let i={i:n,$:{}};this.keys.forEach((r,s)=>{let o=r.getFn?r.getFn(e):this.getFn(e,r.path);if(Ht(o)){if(dn(o)){let l=[];const a=[{nestedArrIndex:-1,value:o}];for(;a.length;){const{nestedArrIndex:c,value:u}=a.pop();if(Ht(u))if(rn(u)&&!gs(u)){let h={v:u,i:c,n:this.norm.get(u)};l.push(h)}else dn(u)&&u.forEach((h,f)=>{a.push({nestedArrIndex:f,value:h})})}i.$[s]=l}else if(rn(o)&&!gs(o)){let l={v:o,n:this.norm.get(o)};i.$[s]=l}}}),this.records.push(i)}toJSON(){return{keys:this.keys,records:this.records}}}function Ec(t,e,{getFn:n=Me.getFn,fieldNormWeight:i=Me.fieldNormWeight}={}){const r=new vs({getFn:n,fieldNormWeight:i});return r.setKeys(t.map(Sc)),r.setSources(e),r.create(),r}function vv(t,{getFn:e=Me.getFn,fieldNormWeight:n=Me.fieldNormWeight}={}){const{keys:i,records:r}=t,s=new vs({getFn:e,fieldNormWeight:n});return s.setKeys(i),s.setIndexRecords(r),s}function _r(t,{errors:e=0,currentLocation:n=0,expectedLocation:i=0,distance:r=Me.distance,ignoreLocation:s=Me.ignoreLocation}={}){const o=e/t.length;if(s)return o;const l=Math.abs(i-n);return r?o+l/r:l?1:o}function yv(t=[],e=Me.minMatchCharLength){let n=[],i=-1,r=-1,s=0;for(let o=t.length;s<o;s+=1){let l=t[s];l&&i===-1?i=s:!l&&i!==-1&&(r=s-1,r-i+1>=e&&n.push([i,r]),i=-1)}return t[s-1]&&s-i>=e&&n.push([i,s-1]),n}const Tn=32;function bv(t,e,n,{location:i=Me.location,distance:r=Me.distance,threshold:s=Me.threshold,findAllMatches:o=Me.findAllMatches,minMatchCharLength:l=Me.minMatchCharLength,includeMatches:a=Me.includeMatches,ignoreLocation:c=Me.ignoreLocation}={}){if(e.length>Tn)throw new Error(lv(Tn));const u=e.length,h=t.length,f=Math.max(0,Math.min(i,h));let d=s,m=f;const p=l>1||a,g=p?Array(h):[];let _;for(;(_=t.indexOf(e,m))>-1;){let T=_r(e,{currentLocation:_,expectedLocation:f,distance:r,ignoreLocation:c});if(d=Math.min(T,d),m=_+u,p){let E=0;for(;E<u;)g[_+E]=1,E+=1}}m=-1;let S=[],C=1,w=u+h;const k=1<<u-1;for(let T=0;T<u;T+=1){let E=0,x=w;for(;E<x;)_r(e,{errors:T,currentLocation:f+x,expectedLocation:f,distance:r,ignoreLocation:c})<=d?E=x:w=x,x=Math.floor((w-E)/2+E);w=x;let O=Math.max(1,f-x+1),L=o?h:Math.min(f+x,h)+u,F=Array(L+2);F[L+1]=(1<<T)-1;for(let I=L;I>=O;I-=1){let H=I-1,P=n[t.charAt(H)];if(p&&(g[H]=+!!P),F[I]=(F[I+1]<<1|1)&P,T&&(F[I]|=(S[I+1]|S[I])<<1|1|S[I+1]),F[I]&k&&(C=_r(e,{errors:T,currentLocation:H,expectedLocation:f,distance:r,ignoreLocation:c}),C<=d)){if(d=C,m=H,m<=f)break;O=Math.max(1,2*f-m)}}if(_r(e,{errors:T+1,currentLocation:f,expectedLocation:f,distance:r,ignoreLocation:c})>d)break;S=F}const N={isMatch:m>=0,score:Math.max(.001,C)};if(p){const T=yv(g,l);T.length?a&&(N.indices=T):N.isMatch=!1}return N}function wv(t){let e={};for(let n=0,i=t.length;n<i;n+=1){const r=t.charAt(n);e[r]=(e[r]||0)|1<<i-n-1}return e}class Cc{constructor(e,{location:n=Me.location,threshold:i=Me.threshold,distance:r=Me.distance,includeMatches:s=Me.includeMatches,findAllMatches:o=Me.findAllMatches,minMatchCharLength:l=Me.minMatchCharLength,isCaseSensitive:a=Me.isCaseSensitive,ignoreLocation:c=Me.ignoreLocation}={}){if(this.options={location:n,threshold:i,distance:r,includeMatches:s,findAllMatches:o,minMatchCharLength:l,isCaseSensitive:a,ignoreLocation:c},this.pattern=a?e:e.toLowerCase(),this.chunks=[],!this.pattern.length)return;const u=(f,d)=>{this.chunks.push({pattern:f,alphabet:wv(f),startIndex:d})},h=this.pattern.length;if(h>Tn){let f=0;const d=h%Tn,m=h-d;for(;f<m;)u(this.pattern.substr(f,Tn),f),f+=Tn;if(d){const p=h-Tn;u(this.pattern.substr(p),p)}}else u(this.pattern,0)}searchIn(e){const{isCaseSensitive:n,includeMatches:i}=this.options;if(n||(e=e.toLowerCase()),this.pattern===e){let m={isMatch:!0,score:0};return i&&(m.indices=[[0,e.length-1]]),m}const{location:r,distance:s,threshold:o,findAllMatches:l,minMatchCharLength:a,ignoreLocation:c}=this.options;let u=[],h=0,f=!1;this.chunks.forEach(({pattern:m,alphabet:p,startIndex:g})=>{const{isMatch:_,score:S,indices:C}=bv(e,m,p,{location:r+g,distance:s,threshold:o,findAllMatches:l,minMatchCharLength:a,includeMatches:i,ignoreLocation:c});_&&(f=!0),h+=S,_&&C&&(u=[...u,...C])});let d={isMatch:f,score:f?h/this.chunks.length:1};return f&&i&&(d.indices=u),d}}class kn{constructor(e){this.pattern=e}static isMultiMatch(e){return Ic(e,this.multiRegex)}static isSingleMatch(e){return Ic(e,this.singleRegex)}search(){}}function Ic(t,e){const n=t.match(e);return n?n[1]:null}class Sv extends kn{constructor(e){super(e)}static get type(){return"exact"}static get multiRegex(){return/^="(.*)"$/}static get singleRegex(){return/^=(.*)$/}search(e){const n=e===this.pattern;return{isMatch:n,score:n?0:1,indices:[0,this.pattern.length-1]}}}class kv extends kn{constructor(e){super(e)}static get type(){return"inverse-exact"}static get multiRegex(){return/^!"(.*)"$/}static get singleRegex(){return/^!(.*)$/}search(e){const i=e.indexOf(this.pattern)===-1;return{isMatch:i,score:i?0:1,indices:[0,e.length-1]}}}class Ev extends kn{constructor(e){super(e)}static get type(){return"prefix-exact"}static get multiRegex(){return/^\^"(.*)"$/}static get singleRegex(){return/^\^(.*)$/}search(e){const n=e.startsWith(this.pattern);return{isMatch:n,score:n?0:1,indices:[0,this.pattern.length-1]}}}class Cv extends kn{constructor(e){super(e)}static get type(){return"inverse-prefix-exact"}static get multiRegex(){return/^!\^"(.*)"$/}static get singleRegex(){return/^!\^(.*)$/}search(e){const n=!e.startsWith(this.pattern);return{isMatch:n,score:n?0:1,indices:[0,e.length-1]}}}class Iv extends kn{constructor(e){super(e)}static get type(){return"suffix-exact"}static get multiRegex(){return/^"(.*)"\$$/}static get singleRegex(){return/^(.*)\$$/}search(e){const n=e.endsWith(this.pattern);return{isMatch:n,score:n?0:1,indices:[e.length-this.pattern.length,e.length-1]}}}class xv extends kn{constructor(e){super(e)}static get type(){return"inverse-suffix-exact"}static get multiRegex(){return/^!"(.*)"\$$/}static get singleRegex(){return/^!(.*)\$$/}search(e){const n=!e.endsWith(this.pattern);return{isMatch:n,score:n?0:1,indices:[0,e.length-1]}}}class xc extends kn{constructor(e,{location:n=Me.location,threshold:i=Me.threshold,distance:r=Me.distance,includeMatches:s=Me.includeMatches,findAllMatches:o=Me.findAllMatches,minMatchCharLength:l=Me.minMatchCharLength,isCaseSensitive:a=Me.isCaseSensitive,ignoreLocation:c=Me.ignoreLocation}={}){super(e),this._bitapSearch=new Cc(e,{location:n,threshold:i,distance:r,includeMatches:s,findAllMatches:o,minMatchCharLength:l,isCaseSensitive:a,ignoreLocation:c})}static get type(){return"fuzzy"}static get multiRegex(){return/^"(.*)"$/}static get singleRegex(){return/^(.*)$/}search(e){return this._bitapSearch.searchIn(e)}}class Mc extends kn{constructor(e){super(e)}static get type(){return"include"}static get multiRegex(){return/^'"(.*)"$/}static get singleRegex(){return/^'(.*)$/}search(e){let n=0,i;const r=[],s=this.pattern.length;for(;(i=e.indexOf(this.pattern,n))>-1;)n=i+s,r.push([i,n-1]);const o=!!r.length;return{isMatch:o,score:o?0:1,indices:r}}}const ys=[Sv,Mc,Ev,Cv,xv,Iv,kv,xc],Ac=ys.length,Mv=/ +(?=(?:[^\"]*\"[^\"]*\")*[^\"]*$)/,Av="|";function Tv(t,e={}){return t.split(Av).map(n=>{let i=n.trim().split(Mv).filter(s=>s&&!!s.trim()),r=[];for(let s=0,o=i.length;s<o;s+=1){const l=i[s];let a=!1,c=-1;for(;!a&&++c<Ac;){const u=ys[c];let h=u.isMultiMatch(l);h&&(r.push(new u(h,e)),a=!0)}if(!a)for(c=-1;++c<Ac;){const u=ys[c];let h=u.isSingleMatch(l);if(h){r.push(new u(h,e));break}}}return r})}const Nv=new Set([xc.type,Mc.type]);class Pv{constructor(e,{isCaseSensitive:n=Me.isCaseSensitive,includeMatches:i=Me.includeMatches,minMatchCharLength:r=Me.minMatchCharLength,ignoreLocation:s=Me.ignoreLocation,findAllMatches:o=Me.findAllMatches,location:l=Me.location,threshold:a=Me.threshold,distance:c=Me.distance}={}){this.query=null,this.options={isCaseSensitive:n,includeMatches:i,minMatchCharLength:r,findAllMatches:o,ignoreLocation:s,location:l,threshold:a,distance:c},this.pattern=n?e:e.toLowerCase(),this.query=Tv(this.pattern,this.options)}static condition(e,n){return n.useExtendedSearch}searchIn(e){const n=this.query;if(!n)return{isMatch:!1,score:1};const{includeMatches:i,isCaseSensitive:r}=this.options;e=r?e:e.toLowerCase();let s=0,o=[],l=0;for(let a=0,c=n.length;a<c;a+=1){const u=n[a];o.length=0,s=0;for(let h=0,f=u.length;h<f;h+=1){const d=u[h],{isMatch:m,indices:p,score:g}=d.search(e);if(m){if(s+=1,l+=g,i){const _=d.constructor.type;Nv.has(_)?o=[...o,...p]:o.push(p)}}else{l=0,s=0,o.length=0;break}}if(s){let h={isMatch:!0,score:l/s};return i&&(h.indices=o),h}}return{isMatch:!1,score:1}}}const bs=[];function Ov(...t){bs.push(...t)}function ws(t,e){for(let n=0,i=bs.length;n<i;n+=1){let r=bs[n];if(r.condition(t,e))return new r(t,e)}return new Cc(t,e)}const vr={AND:"$and",OR:"$or"},Ss={PATH:"$path",PATTERN:"$val"},ks=t=>!!(t[vr.AND]||t[vr.OR]),Lv=t=>!!t[Ss.PATH],Dv=t=>!dn(t)&&yc(t)&&!ks(t),Tc=t=>({[vr.AND]:Object.keys(t).map(e=>({[e]:t[e]}))});function Nc(t,e,{auto:n=!0}={}){const i=r=>{let s=Object.keys(r);const o=Lv(r);if(!o&&s.length>1&&!ks(r))return i(Tc(r));if(Dv(r)){const a=o?r[Ss.PATH]:s[0],c=o?r[Ss.PATTERN]:r[a];if(!rn(c))throw new Error(ov(a));const u={keyId:_s(a),pattern:c};return n&&(u.searcher=ws(c,e)),u}let l={children:[],operator:s[0]};return s.forEach(a=>{const c=r[a];dn(c)&&c.forEach(u=>{l.children.push(i(u))})}),l};return ks(t)||(t=Tc(t)),i(t)}function Rv(t,{ignoreFieldNorm:e=Me.ignoreFieldNorm}){t.forEach(n=>{let i=1;n.matches.forEach(({key:r,norm:s,score:o})=>{const l=r?r.weight:null;i*=Math.pow(o===0&&l?Number.EPSILON:o,(l||1)*(e?1:s))}),n.score=i})}function $v(t,e){const n=t.matches;e.matches=[],Ht(n)&&n.forEach(i=>{if(!Ht(i.indices)||!i.indices.length)return;const{indices:r,value:s}=i;let o={indices:r,value:s};i.key&&(o.key=i.key.src),i.idx>-1&&(o.refIndex=i.idx),e.matches.push(o)})}function zv(t,e){e.score=t.score}function jv(t,e,{includeMatches:n=Me.includeMatches,includeScore:i=Me.includeScore}={}){const r=[];return n&&r.push($v),i&&r.push(zv),t.map(s=>{const{idx:o}=s,l={item:e[o],refIndex:o};return r.length&&r.forEach(a=>{a(s,l)}),l})}class Zn{constructor(e,n={},i){this.options=Qn(Qn({},Me),n),this.options.useExtendedSearch,this._keyStore=new uv(this.options.keys),this.setCollection(e,i)}setCollection(e,n){if(this._docs=e,n&&!(n instanceof vs))throw new Error(sv);this._myIndex=n||Ec(this.options.keys,this._docs,{getFn:this.options.getFn,fieldNormWeight:this.options.fieldNormWeight})}add(e){Ht(e)&&(this._docs.push(e),this._myIndex.add(e))}remove(e=()=>!1){const n=[];for(let i=0,r=this._docs.length;i<r;i+=1){const s=this._docs[i];e(s,i)&&(this.removeAt(i),i-=1,r-=1,n.push(s))}return n}removeAt(e){this._docs.splice(e,1),this._myIndex.removeAt(e)}getIndex(){return this._myIndex}search(e,{limit:n=-1}={}){const{includeMatches:i,includeScore:r,shouldSort:s,sortFn:o,ignoreFieldNorm:l}=this.options;let a=rn(e)?rn(this._docs[0])?this._searchStringList(e):this._searchObjectList(e):this._searchLogical(e);return Rv(a,{ignoreFieldNorm:l}),s&&a.sort(o),vc(n)&&n>-1&&(a=a.slice(0,n)),jv(a,this._docs,{includeMatches:i,includeScore:r})}_searchStringList(e){const n=ws(e,this.options),{records:i}=this._myIndex,r=[];return i.forEach(({v:s,i:o,n:l})=>{if(!Ht(s))return;const{isMatch:a,score:c,indices:u}=n.searchIn(s);a&&r.push({item:s,idx:o,matches:[{score:c,value:s,norm:l,indices:u}]})}),r}_searchLogical(e){const n=Nc(e,this.options),i=(l,a,c)=>{if(!l.children){const{keyId:h,searcher:f}=l,d=this._findMatches({key:this._keyStore.get(h),value:this._myIndex.getValueForItemAtKeyId(a,h),searcher:f});return d&&d.length?[{idx:c,item:a,matches:d}]:[]}const u=[];for(let h=0,f=l.children.length;h<f;h+=1){const d=l.children[h],m=i(d,a,c);if(m.length)u.push(...m);else if(l.operator===vr.AND)return[]}return u},r=this._myIndex.records,s={},o=[];return r.forEach(({$:l,i:a})=>{if(Ht(l)){let c=i(n,l,a);c.length&&(s[a]||(s[a]={idx:a,item:l,matches:[]},o.push(s[a])),c.forEach(({matches:u})=>{s[a].matches.push(...u)}))}}),o}_searchObjectList(e){const n=ws(e,this.options),{keys:i,records:r}=this._myIndex,s=[];return r.forEach(({$:o,i:l})=>{if(!Ht(o))return;let a=[];i.forEach((c,u)=>{a.push(...this._findMatches({key:c,value:o[u],searcher:n}))}),a.length&&s.push({idx:l,item:o,matches:a})}),s}_findMatches({key:e,value:n,searcher:i}){if(!Ht(n))return[];let r=[];if(dn(n))n.forEach(({v:s,i:o,n:l})=>{if(!Ht(s))return;const{isMatch:a,score:c,indices:u}=i.searchIn(s);a&&r.push({score:c,key:e,value:s,idx:o,norm:l,indices:u})});else{const{v:s,n:o}=n,{isMatch:l,score:a,indices:c}=i.searchIn(s);l&&r.push({score:a,key:e,value:s,norm:o,indices:c})}return r}}Zn.version="7.0.0",Zn.createIndex=Ec,Zn.parseIndex=vv,Zn.config=Me,Zn.parseQuery=Nc,Ov(Pv);var Fv=function(){function t(e){this._haystack=[],this._fuseOptions=Rt(Rt({},e.fuseOptions),{keys:w1([],e.searchFields,!0),includeMatches:!0})}return t.prototype.index=function(e){this._haystack=e,this._fuse&&this._fuse.setCollection(e)},t.prototype.reset=function(){this._haystack=[],this._fuse=void 0},t.prototype.isEmptyIndex=function(){return!this._haystack.length},t.prototype.search=function(e){this._fuse||(this._fuse=new Zn(this._haystack,this._fuseOptions));var n=this._fuse.search(e);return n.map(function(i,r){return{item:i.item,score:i.score||0,rank:r+1}})},t}();function Hv(t){return new Fv(t)}var Vv=function(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0},Es=function(t,e,n){var i=t.dataset,r=e.customProperties,s=e.labelClass,o=e.labelDescription;s&&(i.labelClass=gr(s).join(" ")),o&&(i.labelDescription=o),n&&r&&(typeof r=="string"?i.customProperties=r:typeof r=="object"&&!Vv(r)&&(i.customProperties=JSON.stringify(r)))},Pc=function(t,e,n){var i=e&&t.querySelector("label[for='".concat(e,"']")),r=i&&i.innerText;r&&n.setAttribute("aria-label",r)},Uv={containerOuter:function(t,e,n,i,r,s,o){var l=t.classNames.containerOuter,a=document.createElement("div");return Le(a,l),a.dataset.type=s,e&&(a.dir=e),i&&(a.tabIndex=0),n&&(a.setAttribute("role",r?"combobox":"listbox"),r?a.setAttribute("aria-autocomplete","list"):o||Pc(this._docRoot,this.passedElement.element.id,a),a.setAttribute("aria-haspopup","true"),a.setAttribute("aria-expanded","false")),o&&a.setAttribute("aria-labelledby",o),a},containerInner:function(t){var e=t.classNames.containerInner,n=document.createElement("div");return Le(n,e),n},itemList:function(t,e){var n=t.searchEnabled,i=t.classNames,r=i.list,s=i.listSingle,o=i.listItems,l=document.createElement("div");return Le(l,r),Le(l,e?s:o),this._isSelectElement&&n&&l.setAttribute("role","listbox"),l},placeholder:function(t,e){var n=t.allowHTML,i=t.classNames.placeholder,r=document.createElement("div");return Le(r,i),fn(r,n,e),r},item:function(t,e,n){var i=t.allowHTML,r=t.removeItemButtonAlignLeft,s=t.removeItemIconText,o=t.removeItemLabelText,l=t.classNames,a=l.item,c=l.button,u=l.highlightedState,h=l.itemSelectable,f=l.placeholder,d=An(e.value),m=document.createElement("div");if(Le(m,a),e.labelClass){var p=document.createElement("span");fn(p,i,e.label),Le(p,e.labelClass),m.appendChild(p)}else fn(m,i,e.label);if(m.dataset.item="",m.dataset.id=e.id,m.dataset.value=d,Es(m,e,!0),(e.disabled||this.containerOuter.isDisabled)&&m.setAttribute("aria-disabled","true"),this._isSelectElement&&(m.setAttribute("aria-selected","true"),m.setAttribute("role","option")),e.placeholder&&(Le(m,f),m.dataset.placeholder=""),Le(m,e.highlighted?u:h),n){e.disabled&&tn(m,h),m.dataset.deletable="";var g=document.createElement("button");g.type="button",Le(g,c),fn(g,!0,vi(s,e.value));var _=vi(o,e.value);_&&g.setAttribute("aria-label",_),g.dataset.button="",r?m.insertAdjacentElement("afterbegin",g):m.appendChild(g)}return m},choiceList:function(t,e){var n=t.classNames.list,i=document.createElement("div");return Le(i,n),e||i.setAttribute("aria-multiselectable","true"),i.setAttribute("role","listbox"),i},choiceGroup:function(t,e){var n=t.allowHTML,i=t.classNames,r=i.group,s=i.groupHeading,o=i.itemDisabled,l=e.id,a=e.label,c=e.disabled,u=An(a),h=document.createElement("div");Le(h,r),c&&Le(h,o),h.setAttribute("role","group"),h.dataset.group="",h.dataset.id=l,h.dataset.value=u,c&&h.setAttribute("aria-disabled","true");var f=document.createElement("div");return Le(f,s),fn(f,n,a||""),h.appendChild(f),h},choice:function(t,e,n,i){var r=t.allowHTML,s=t.classNames,o=s.item,l=s.itemChoice,a=s.itemSelectable,c=s.selectedState,u=s.itemDisabled,h=s.description,f=s.placeholder,d=e.label,m=An(e.value),p=document.createElement("div");p.id=e.elementId,Le(p,o),Le(p,l),i&&typeof d=="string"&&(d=ps(r,d),d+=" (".concat(i,")"),d={trusted:d});var g=p;if(e.labelClass){var _=document.createElement("span");fn(_,r,d),Le(_,e.labelClass),g=_,p.appendChild(_)}else fn(p,r,d);if(e.labelDescription){var S="".concat(e.elementId,"-description");g.setAttribute("aria-describedby",S);var C=document.createElement("span");fn(C,r,e.labelDescription),C.id=S,Le(C,h),p.appendChild(C)}return e.selected&&Le(p,c),e.placeholder&&Le(p,f),p.setAttribute("role",e.group?"treeitem":"option"),p.dataset.choice="",p.dataset.id=e.id,p.dataset.value=m,n&&(p.dataset.selectText=n),e.group&&(p.dataset.groupId="".concat(e.group.id)),Es(p,e,!1),e.disabled?(Le(p,u),p.dataset.choiceDisabled="",p.setAttribute("aria-disabled","true")):(Le(p,a),p.dataset.choiceSelectable=""),p},input:function(t,e){var n=t.classNames,i=n.input,r=n.inputCloned,s=t.labelId,o=document.createElement("input");return o.type="search",Le(o,i),Le(o,r),o.autocomplete="off",o.autocapitalize="off",o.spellcheck=!1,o.setAttribute("aria-autocomplete","list"),e?o.setAttribute("aria-label",e):s||Pc(this._docRoot,this.passedElement.element.id,o),o},dropdown:function(t){var e=t.classNames,n=e.list,i=e.listDropdown,r=document.createElement("div");return Le(r,n),Le(r,i),r.setAttribute("aria-expanded","false"),r},notice:function(t,e,n){var i=t.classNames,r=i.item,s=i.itemChoice,o=i.addChoice,l=i.noResults,a=i.noChoices,c=i.notice;n===void 0&&(n=Et.generic);var u=document.createElement("div");switch(fn(u,!0,e),Le(u,r),Le(u,s),Le(u,c),n){case Et.addChoice:Le(u,o);break;case Et.noResults:Le(u,l);break;case Et.noChoices:Le(u,a);break}return n===Et.addChoice&&(u.dataset.choiceSelectable="",u.dataset.choice=""),u},option:function(t){var e=An(t.label),n=new Option(e,t.value,!1,t.selected);return Es(n,t,!0),n.disabled=t.disabled,t.selected&&n.setAttribute("selected",""),n}},Bv="-ms-scroll-limit"in document.documentElement.style&&"-ms-ime-align"in document.documentElement.style,qv={},Cs=function(t){if(t)return t.dataset.id?parseInt(t.dataset.id,10):void 0},wi="[data-choice-selectable]",Kv=function(){function t(e,n){e===void 0&&(e="[data-choice]"),n===void 0&&(n={});var i=this;this.initialisedOK=void 0,this._hasNonChoicePlaceholder=!1,this._lastAddedChoiceId=0,this._lastAddedGroupId=0;var r=t.defaults;this.config=Rt(Rt(Rt({},r.allOptions),r.options),n),S1.forEach(function(_){i.config[_]=Rt(Rt(Rt({},r.allOptions[_]),r.options[_]),n[_])});var s=this.config;s.silent||this._validateConfig();var o=s.shadowRoot||document.documentElement;this._docRoot=o;var l=typeof e=="string"?o.querySelector(e):e;if(!l||typeof l!="object"||!(V1(l)||hc(l)))throw TypeError(!l&&typeof e=="string"?"Selector ".concat(e," failed to find an element"):"Expected one of the following types text|select-one|select-multiple");var a=l.type,c=a===Sn.Text;(c||s.maxItemCount!==1)&&(s.singleModeForMultiSelect=!1),s.singleModeForMultiSelect&&(a=Sn.SelectMultiple);var u=a===Sn.SelectOne,h=a===Sn.SelectMultiple,f=u||h;if(this._elementType=a,this._isTextElement=c,this._isSelectOneElement=u,this._isSelectMultipleElement=h,this._isSelectElement=u||h,this._canAddUserChoices=c&&s.addItems||f&&s.addChoices,typeof s.renderSelectedChoices!="boolean"&&(s.renderSelectedChoices=s.renderSelectedChoices==="always"||u),s.closeDropdownOnSelect==="auto"?s.closeDropdownOnSelect=c||u||s.singleModeForMultiSelect:s.closeDropdownOnSelect=bi(s.closeDropdownOnSelect),s.placeholder&&(s.placeholderValue?this._hasNonChoicePlaceholder=!0:l.dataset.placeholder&&(this._hasNonChoicePlaceholder=!0,s.placeholderValue=l.dataset.placeholder)),n.addItemFilter&&typeof n.addItemFilter!="function"){var d=n.addItemFilter instanceof RegExp?n.addItemFilter:new RegExp(n.addItemFilter);s.addItemFilter=d.test.bind(d)}if(this._isTextElement)this.passedElement=new H1({element:l,classNames:s.classNames});else{var m=l;this.passedElement=new q1({element:m,classNames:s.classNames,template:function(_){return i._templates.option(_)},extractPlaceholder:s.placeholder&&!this._hasNonChoicePlaceholder})}if(this.initialised=!1,this._store=new G1(s),this._currentValue="",s.searchEnabled=!c&&s.searchEnabled||h,this._canSearch=s.searchEnabled,this._isScrollingOnIe=!1,this._highlightPosition=0,this._wasTap=!0,this._placeholderValue=this._generatePlaceholderValue(),this._baseId=M1(l,"choices-"),this._direction=l.dir,!this._direction){var p=window.getComputedStyle(l).direction,g=window.getComputedStyle(document.documentElement).direction;p!==g&&(this._direction=p)}if(this._idNames={itemChoice:"item-choice"},this._templates=r.templates,this._render=this._render.bind(this),this._onFocus=this._onFocus.bind(this),this._onBlur=this._onBlur.bind(this),this._onKeyUp=this._onKeyUp.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onInput=this._onInput.bind(this),this._onClick=this._onClick.bind(this),this._onTouchMove=this._onTouchMove.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._onMouseDown=this._onMouseDown.bind(this),this._onMouseOver=this._onMouseOver.bind(this),this._onFormReset=this._onFormReset.bind(this),this._onSelectKey=this._onSelectKey.bind(this),this._onEnterKey=this._onEnterKey.bind(this),this._onEscapeKey=this._onEscapeKey.bind(this),this._onDirectionKey=this._onDirectionKey.bind(this),this._onDeleteKey=this._onDeleteKey.bind(this),this.passedElement.isActive){s.silent||console.warn("Trying to initialise Choices on element already initialised",{element:e}),this.initialised=!0,this.initialisedOK=!1;return}this.init(),this._initialItems=this._store.items.map(function(_){return _.value})}return Object.defineProperty(t,"defaults",{get:function(){return Object.preventExtensions({get options(){return qv},get allOptions(){return mc},get templates(){return Uv}})},enumerable:!1,configurable:!0}),t.prototype.init=function(){if(!(this.initialised||this.initialisedOK!==void 0)){this._searcher=Hv(this.config),this._loadChoices(),this._createTemplates(),this._createElements(),this._createStructure(),this._isTextElement&&!this.config.addItems||this.passedElement.element.hasAttribute("disabled")||this.passedElement.element.closest("fieldset:disabled")?this.disable():(this.enable(),this._addEventListeners()),this._initStore(),this.initialised=!0,this.initialisedOK=!0;var e=this.config.callbackOnInit;typeof e=="function"&&e.call(this)}},t.prototype.destroy=function(){this.initialised&&(this._removeEventListeners(),this.passedElement.reveal(),this.containerOuter.unwrap(this.passedElement.element),this._store._listeners=[],this.clearStore(!1),this._stopSearch(),this._templates=t.defaults.templates,this.initialised=!1,this.initialisedOK=void 0)},t.prototype.enable=function(){return this.passedElement.isDisabled&&this.passedElement.enable(),this.containerOuter.isDisabled&&(this._addEventListeners(),this.input.enable(),this.containerOuter.enable()),this},t.prototype.disable=function(){return this.passedElement.isDisabled||this.passedElement.disable(),this.containerOuter.isDisabled||(this._removeEventListeners(),this.input.disable(),this.containerOuter.disable()),this},t.prototype.highlightItem=function(e,n){if(n===void 0&&(n=!0),!e||!e.id)return this;var i=this._store.items.find(function(r){return r.id===e.id});return!i||i.highlighted?this:(this._store.dispatch(mr(i,!0)),n&&this.passedElement.triggerEvent($t.highlightItem,this._getChoiceForOutput(i)),this)},t.prototype.unhighlightItem=function(e,n){if(n===void 0&&(n=!0),!e||!e.id)return this;var i=this._store.items.find(function(r){return r.id===e.id});return!i||!i.highlighted?this:(this._store.dispatch(mr(i,!1)),n&&this.passedElement.triggerEvent($t.unhighlightItem,this._getChoiceForOutput(i)),this)},t.prototype.highlightAll=function(){var e=this;return this._store.withTxn(function(){e._store.items.forEach(function(n){n.highlighted||(e._store.dispatch(mr(n,!0)),e.passedElement.triggerEvent($t.highlightItem,e._getChoiceForOutput(n)))})}),this},t.prototype.unhighlightAll=function(){var e=this;return this._store.withTxn(function(){e._store.items.forEach(function(n){n.highlighted&&(e._store.dispatch(mr(n,!1)),e.passedElement.triggerEvent($t.highlightItem,e._getChoiceForOutput(n)))})}),this},t.prototype.removeActiveItemsByValue=function(e){var n=this;return this._store.withTxn(function(){n._store.items.filter(function(i){return i.value===e}).forEach(function(i){return n._removeItem(i)})}),this},t.prototype.removeActiveItems=function(e){var n=this;return this._store.withTxn(function(){n._store.items.filter(function(i){var r=i.id;return r!==e}).forEach(function(i){return n._removeItem(i)})}),this},t.prototype.removeHighlightedItems=function(e){var n=this;return e===void 0&&(e=!1),this._store.withTxn(function(){n._store.highlightedActiveItems.forEach(function(i){n._removeItem(i),e&&n._triggerChange(i.value)})}),this},t.prototype.showDropdown=function(e){var n=this;return this.dropdown.isActive?this:(e===void 0&&(e=!this._canSearch),requestAnimationFrame(function(){n.dropdown.show();var i=n.dropdown.element.getBoundingClientRect();n.containerOuter.open(i.bottom,i.height),e||n.input.focus(),n.passedElement.triggerEvent($t.showDropdown)}),this)},t.prototype.hideDropdown=function(e){var n=this;return this.dropdown.isActive?(requestAnimationFrame(function(){n.dropdown.hide(),n.containerOuter.close(),!e&&n._canSearch&&(n.input.removeActiveDescendant(),n.input.blur()),n.passedElement.triggerEvent($t.hideDropdown)}),this):this},t.prototype.getValue=function(e){var n=this,i=this._store.items.map(function(r){return e?r.value:n._getChoiceForOutput(r)});return this._isSelectOneElement||this.config.singleModeForMultiSelect?i[0]:i},t.prototype.setValue=function(e){var n=this;return this.initialisedOK?(this._store.withTxn(function(){e.forEach(function(i){i&&n._addChoice(nn(i,!1))})}),this._searcher.reset(),this):(this._warnChoicesInitFailed("setValue"),this)},t.prototype.setChoiceByValue=function(e){var n=this;return this.initialisedOK?this._isTextElement?this:(this._store.withTxn(function(){var i=Array.isArray(e)?e:[e];i.forEach(function(r){return n._findAndSelectChoiceByValue(r)}),n.unhighlightAll()}),this._searcher.reset(),this):(this._warnChoicesInitFailed("setChoiceByValue"),this)},t.prototype.setChoices=function(e,n,i,r,s,o){var l=this;if(e===void 0&&(e=[]),n===void 0&&(n="value"),i===void 0&&(i="label"),r===void 0&&(r=!1),s===void 0&&(s=!0),o===void 0&&(o=!1),!this.initialisedOK)return this._warnChoicesInitFailed("setChoices"),this;if(!this._isSelectElement)throw new TypeError("setChoices can't be used with INPUT based Choices");if(typeof n!="string"||!n)throw new TypeError("value parameter must be a name of 'value' field in passed objects");if(typeof e=="function"){var a=e(this);if(typeof Promise=="function"&&a instanceof Promise)return new Promise(function(c){return requestAnimationFrame(c)}).then(function(){return l._handleLoadingState(!0)}).then(function(){return a}).then(function(c){return l.setChoices(c,n,i,r,s,o)}).catch(function(c){l.config.silent||console.error(c)}).then(function(){return l._handleLoadingState(!1)}).then(function(){return l});if(!Array.isArray(a))throw new TypeError(".setChoices first argument function must return either array of choices or Promise, got: ".concat(typeof a));return this.setChoices(a,n,i,!1)}if(!Array.isArray(e))throw new TypeError(".setChoices must be called either with array of choices with a function resulting into Promise of array of choices");return this.containerOuter.removeLoadingState(),this._store.withTxn(function(){s&&(l._isSearching=!1),r&&l.clearChoices(!0,o);var c=n==="value",u=i==="label";e.forEach(function(h){if("choices"in h){var f=h;u||(f=Rt(Rt({},f),{label:f[i]})),l._addGroup(nn(f,!0))}else{var d=h;(!u||!c)&&(d=Rt(Rt({},d),{value:d[n],label:d[i]}));var m=nn(d,!1);l._addChoice(m),m.placeholder&&!l._hasNonChoicePlaceholder&&(l._placeholderValue=ac(m.label))}}),l.unhighlightAll()}),this._searcher.reset(),this},t.prototype.refresh=function(e,n,i){var r=this;return e===void 0&&(e=!1),n===void 0&&(n=!1),i===void 0&&(i=!1),this._isSelectElement?(this._store.withTxn(function(){var s=r.passedElement.optionsAsChoices(),o={};i||r._store.items.forEach(function(a){a.id&&a.active&&a.selected&&(o[a.value]=!0)}),r.clearStore(!1);var l=function(a){i?r._store.dispatch(sc(a)):o[a.value]&&(a.selected=!0)};s.forEach(function(a){if("choices"in a){a.choices.forEach(l);return}l(a)}),r._addPredefinedChoices(s,n,e),r._isSearching&&r._searchChoices(r.input.value)}),this):(this.config.silent||console.warn("refresh method can only be used on choices backed by a <select> element"),this)},t.prototype.removeChoice=function(e){var n=this._store.choices.find(function(i){return i.value===e});return n?(this._clearNotice(),this._store.dispatch(k1(n)),this._searcher.reset(),n.selected&&this.passedElement.triggerEvent($t.removeItem,this._getChoiceForOutput(n)),this):this},t.prototype.clearChoices=function(e,n){var i=this;return e===void 0&&(e=!0),n===void 0&&(n=!1),e&&(n?this.passedElement.element.replaceChildren(""):this.passedElement.element.querySelectorAll(":not([selected])").forEach(function(r){r.remove()})),this.itemList.element.replaceChildren(""),this.choiceList.element.replaceChildren(""),this._clearNotice(),this._store.withTxn(function(){var r=n?[]:i._store.items;i._store.reset(),r.forEach(function(s){i._store.dispatch(ic(s)),i._store.dispatch(rc(s))})}),this._searcher.reset(),this},t.prototype.clearStore=function(e){return e===void 0&&(e=!0),this.clearChoices(e,!0),this._stopSearch(),this._lastAddedChoiceId=0,this._lastAddedGroupId=0,this},t.prototype.clearInput=function(){var e=!this._isSelectOneElement;return this.input.clear(e),this._stopSearch(),this},t.prototype._validateConfig=function(){var e=this.config,n=D1(e,mc);n.length&&console.warn("Unknown config option(s) passed",n.join(", ")),e.allowHTML&&e.allowHtmlUserInput&&(e.addItems&&console.warn("Warning: allowHTML/allowHtmlUserInput/addItems all being true is strongly not recommended and may lead to XSS attacks"),e.addChoices&&console.warn("Warning: allowHTML/allowHtmlUserInput/addChoices all being true is strongly not recommended and may lead to XSS attacks"))},t.prototype._render=function(e){e===void 0&&(e={choices:!0,groups:!0,items:!0}),!this._store.inTxn()&&(this._isSelectElement&&(e.choices||e.groups)&&this._renderChoices(),e.items&&this._renderItems())},t.prototype._renderChoices=function(){var e=this;if(this._canAddItems()){var n=this,i=n.config,r=n._isSearching,s=this._store,o=s.activeGroups,l=s.activeChoices,a=0;if(r&&i.searchResultLimit>0?a=i.searchResultLimit:i.renderChoiceLimit>0&&(a=i.renderChoiceLimit),this._isSelectElement){var c=l.filter(function(m){return!m.element});c.length&&this.passedElement.addOptions(c)}var u=document.createDocumentFragment(),h=function(m){return m.filter(function(p){return!p.placeholder&&(r?!!p.rank:i.renderSelectedChoices||!p.selected)})},f=!1,d=function(m,p,g){r?m.sort(O1):i.shouldSort&&m.sort(i.sorter);var _=m.length;_=!p&&a&&_>a?a:_,_--,m.every(function(S,C){var w=S.choiceEl||e._templates.choice(i,S,i.itemSelectText,g);return S.choiceEl=w,u.appendChild(w),(r||!S.selected)&&(f=!0),C<_})};l.length&&(i.resetScrollPosition&&requestAnimationFrame(function(){return e.choiceList.scrollToTop()}),!this._hasNonChoicePlaceholder&&!r&&this._isSelectOneElement&&d(l.filter(function(m){return m.placeholder&&!m.group}),!1,void 0),o.length&&!r?(i.shouldSort&&o.sort(i.sorter),d(l.filter(function(m){return!m.placeholder&&!m.group}),!1,void 0),o.forEach(function(m){var p=h(m.choices);if(p.length){if(m.label){var g=m.groupEl||e._templates.choiceGroup(e.config,m);m.groupEl=g,g.remove(),u.appendChild(g)}d(p,!0,i.appendGroupInSearch&&r?m.label:void 0)}})):d(h(l),!1,void 0)),!f&&(r||!u.children.length||!i.renderSelectedChoices)&&(this._notice||(this._notice={text:lc(r?i.noResultsText:i.noChoicesText),type:r?Et.noResults:Et.noChoices}),u.replaceChildren("")),this._renderNotice(u),this.choiceList.element.replaceChildren(u),f&&this._highlightChoice()}},t.prototype._renderItems=function(){var e=this,n=this._store.items||[],i=this.itemList.element,r=this.config,s=document.createDocumentFragment(),o=function(h){return i.querySelector('[data-item][data-id="'.concat(h.id,'"]'))},l=function(h){var f=h.itemEl;f&&f.parentElement||(f=o(h)||e._templates.item(r,h,r.removeItemButton),h.itemEl=f,s.appendChild(f))};n.forEach(l);var a=!!s.childNodes.length;if(this._isSelectOneElement){var c=i.children.length;if(a||c>1){var u=i.querySelector(yi(r.classNames.placeholder));u&&u.remove()}else!a&&!c&&this._placeholderValue&&(a=!0,l(nn({selected:!0,value:"",label:this._placeholderValue,placeholder:!0},!1)))}a&&(i.append(s),r.shouldSortItems&&!this._isSelectOneElement&&(n.sort(r.sorter),n.forEach(function(h){var f=o(h);f&&(f.remove(),s.append(f))}),i.append(s))),this._isTextElement&&(this.passedElement.value=n.map(function(h){var f=h.value;return f}).join(r.delimiter))},t.prototype._displayNotice=function(e,n,i){i===void 0&&(i=!0);var r=this._notice;if(r&&(r.type===n&&r.text===e||r.type===Et.addChoice&&(n===Et.noResults||n===Et.noChoices))){i&&this.showDropdown(!0);return}this._clearNotice(),this._notice=e?{text:e,type:n}:void 0,this._renderNotice(),i&&e&&this.showDropdown(!0)},t.prototype._clearNotice=function(){if(this._notice){var e=this.choiceList.element.querySelector(yi(this.config.classNames.notice));e&&e.remove(),this._notice=void 0}},t.prototype._renderNotice=function(e){var n=this._notice;if(n){var i=this._templates.notice(this.config,n.text,n.type);e?e.append(i):this.choiceList.prepend(i)}},t.prototype._getChoiceForOutput=function(e,n){return{id:e.id,highlighted:e.highlighted,labelClass:e.labelClass,labelDescription:e.labelDescription,customProperties:e.customProperties,disabled:e.disabled,active:e.active,label:e.label,placeholder:e.placeholder,value:e.value,groupValue:e.group?e.group.label:void 0,element:e.element,keyCode:n}},t.prototype._triggerChange=function(e){e!=null&&this.passedElement.triggerEvent($t.change,{value:e})},t.prototype._handleButtonAction=function(e){var n=this,i=this._store.items;if(!(!i.length||!this.config.removeItems||!this.config.removeItemButton)){var r=e&&Cs(e.parentElement),s=r&&i.find(function(o){return o.id===r});s&&this._store.withTxn(function(){if(n._removeItem(s),n._triggerChange(s.value),n._isSelectOneElement&&!n._hasNonChoicePlaceholder){var o=(n.config.shouldSort?n._store.choices.reverse():n._store.choices).find(function(l){return l.placeholder});o&&(n._addItem(o),n.unhighlightAll(),o.value&&n._triggerChange(o.value))}})}},t.prototype._handleItemAction=function(e,n){var i=this;n===void 0&&(n=!1);var r=this._store.items;if(!(!r.length||!this.config.removeItems||this._isSelectOneElement)){var s=Cs(e);s&&(r.forEach(function(o){o.id===s&&!o.highlighted?i.highlightItem(o):!n&&o.highlighted&&i.unhighlightItem(o)}),this.input.focus())}},t.prototype._handleChoiceAction=function(e){var n=this,i=Cs(e),r=i&&this._store.getChoiceById(i);if(!r||r.disabled)return!1;var s=this.dropdown.isActive;if(!r.selected){if(!this._canAddItems())return!0;this._store.withTxn(function(){n._addItem(r,!0,!0),n.clearInput(),n.unhighlightAll()}),this._triggerChange(r.value)}return s&&this.config.closeDropdownOnSelect&&(this.hideDropdown(!0),this.containerOuter.element.focus()),!0},t.prototype._handleBackspace=function(e){var n=this.config;if(!(!n.removeItems||!e.length)){var i=e[e.length-1],r=e.some(function(s){return s.highlighted});n.editItems&&!r&&i?(this.input.value=i.value,this.input.setWidth(),this._removeItem(i),this._triggerChange(i.value)):(r||this.highlightItem(i,!1),this.removeHighlightedItems(!0))}},t.prototype._loadChoices=function(){var e,n=this,i=this.config;if(this._isTextElement){if(this._presetChoices=i.items.map(function(o){return nn(o,!1)}),this.passedElement.value){var r=this.passedElement.value.split(i.delimiter).map(function(o){return nn(o,!1,n.config.allowHtmlUserInput)});this._presetChoices=this._presetChoices.concat(r)}this._presetChoices.forEach(function(o){o.selected=!0})}else if(this._isSelectElement){this._presetChoices=i.choices.map(function(o){return nn(o,!0)});var s=this.passedElement.optionsAsChoices();s&&(e=this._presetChoices).push.apply(e,s)}},t.prototype._handleLoadingState=function(e){e===void 0&&(e=!0);var n=this.itemList.element;e?(this.disable(),this.containerOuter.addLoadingState(),this._isSelectOneElement?n.replaceChildren(this._templates.placeholder(this.config,this.config.loadingText)):this.input.placeholder=this.config.loadingText):(this.enable(),this.containerOuter.removeLoadingState(),this._isSelectOneElement?(n.replaceChildren(""),this._render()):this.input.placeholder=this._placeholderValue||"")},t.prototype._handleSearch=function(e){if(this.input.isFocussed)if(e!==null&&typeof e<"u"&&e.length>=this.config.searchFloor){var n=this.config.searchChoices?this._searchChoices(e):0;n!==null&&this.passedElement.triggerEvent($t.search,{value:e,resultCount:n})}else this._store.choices.some(function(i){return!i.active})&&this._stopSearch()},t.prototype._canAddItems=function(){var e=this.config,n=e.maxItemCount,i=e.maxItemText;return!e.singleModeForMultiSelect&&n>0&&n<=this._store.items.length?(this.choiceList.element.replaceChildren(""),this._notice=void 0,this._displayNotice(typeof i=="function"?i(n):i,Et.addChoice),!1):(this._notice&&this._notice.type===Et.addChoice&&this._clearNotice(),!0)},t.prototype._canCreateItem=function(e){var n=this.config,i=!0,r="";if(i&&typeof n.addItemFilter=="function"&&!n.addItemFilter(e)&&(i=!1,r=vi(n.customAddItemText,e)),i){var s=this._store.choices.find(function(o){return n.valueComparer(o.value,e)});if(s){if(this._isSelectElement)return this._displayNotice("",Et.addChoice),!1;n.duplicateItemsAllowed||(i=!1,r=vi(n.uniqueItemText,e))}}return i&&(r=vi(n.addItemText,e)),r&&this._displayNotice(r,Et.addChoice),i},t.prototype._searchChoices=function(e){var n=e.trim().replace(/\s{2,}/," ");if(!n.length||n===this._currentValue)return null;var i=this._searcher;i.isEmptyIndex()&&i.index(this._store.searchableChoices);var r=i.search(n);this._currentValue=n,this._highlightPosition=0,this._isSearching=!0;var s=this._notice,o=s&&s.type;return o!==Et.addChoice&&(r.length?this._clearNotice():this._displayNotice(lc(this.config.noResultsText),Et.noResults)),this._store.dispatch(E1(r)),r.length},t.prototype._stopSearch=function(){this._isSearching&&(this._currentValue="",this._isSearching=!1,this._clearNotice(),this._store.dispatch(C1(!0)),this.passedElement.triggerEvent($t.search,{value:"",resultCount:0}))},t.prototype._addEventListeners=function(){var e=this._docRoot,n=this.containerOuter.element,i=this.input.element;e.addEventListener("touchend",this._onTouchEnd,!0),n.addEventListener("keydown",this._onKeyDown,!0),n.addEventListener("mousedown",this._onMouseDown,!0),e.addEventListener("click",this._onClick,{passive:!0}),e.addEventListener("touchmove",this._onTouchMove,{passive:!0}),this.dropdown.element.addEventListener("mouseover",this._onMouseOver,{passive:!0}),this._isSelectOneElement&&(n.addEventListener("focus",this._onFocus,{passive:!0}),n.addEventListener("blur",this._onBlur,{passive:!0})),i.addEventListener("keyup",this._onKeyUp,{passive:!0}),i.addEventListener("input",this._onInput,{passive:!0}),i.addEventListener("focus",this._onFocus,{passive:!0}),i.addEventListener("blur",this._onBlur,{passive:!0}),i.form&&i.form.addEventListener("reset",this._onFormReset,{passive:!0}),this.input.addEventListeners()},t.prototype._removeEventListeners=function(){var e=this._docRoot,n=this.containerOuter.element,i=this.input.element;e.removeEventListener("touchend",this._onTouchEnd,!0),n.removeEventListener("keydown",this._onKeyDown,!0),n.removeEventListener("mousedown",this._onMouseDown,!0),e.removeEventListener("click",this._onClick),e.removeEventListener("touchmove",this._onTouchMove),this.dropdown.element.removeEventListener("mouseover",this._onMouseOver),this._isSelectOneElement&&(n.removeEventListener("focus",this._onFocus),n.removeEventListener("blur",this._onBlur)),i.removeEventListener("keyup",this._onKeyUp),i.removeEventListener("input",this._onInput),i.removeEventListener("focus",this._onFocus),i.removeEventListener("blur",this._onBlur),i.form&&i.form.removeEventListener("reset",this._onFormReset),this.input.removeEventListeners()},t.prototype._onKeyDown=function(e){var n=e.keyCode,i=this.dropdown.isActive,r=e.key.length===1||e.key.length===2&&e.key.charCodeAt(0)>=55296||e.key==="Unidentified";switch(!this._isTextElement&&!i&&n!==xt.ESC_KEY&&n!==xt.TAB_KEY&&n!==xt.SHIFT_KEY&&(this.showDropdown(),!this.input.isFocussed&&r&&(this.input.value+=e.key,e.key===" "&&e.preventDefault())),n){case xt.A_KEY:return this._onSelectKey(e,this.itemList.element.hasChildNodes());case xt.ENTER_KEY:return this._onEnterKey(e,i);case xt.ESC_KEY:return this._onEscapeKey(e,i);case xt.UP_KEY:case xt.PAGE_UP_KEY:case xt.DOWN_KEY:case xt.PAGE_DOWN_KEY:return this._onDirectionKey(e,i);case xt.DELETE_KEY:case xt.BACK_KEY:return this._onDeleteKey(e,this._store.items,this.input.isFocussed)}},t.prototype._onKeyUp=function(){this._canSearch=this.config.searchEnabled},t.prototype._onInput=function(){var e=this.input.value;if(!e){this._isTextElement?this.hideDropdown(!0):this._stopSearch();return}this._canAddItems()&&(this._canSearch&&this._handleSearch(e),this._canAddUserChoices&&(this._canCreateItem(e),this._isSelectElement&&(this._highlightPosition=0,this._highlightChoice())))},t.prototype._onSelectKey=function(e,n){if((e.ctrlKey||e.metaKey)&&n){this._canSearch=!1;var i=this.config.removeItems&&!this.input.value&&this.input.element===document.activeElement;i&&this.highlightAll()}},t.prototype._onEnterKey=function(e,n){var i=this,r=this.input.value,s=e.target;if(e.preventDefault(),s&&s.hasAttribute("data-button")){this._handleButtonAction(s);return}if(!n){(this._isSelectElement||this._notice)&&this.showDropdown();return}var o=this.dropdown.element.querySelector(yi(this.config.classNames.highlightedState));if(!(o&&this._handleChoiceAction(o))){if(!s||!r){this.hideDropdown(!0);return}if(this._canAddItems()){var l=!1;this._store.withTxn(function(){if(l=i._findAndSelectChoiceByValue(r,!0),!l){if(!i._canAddUserChoices||!i._canCreateItem(r))return;i._addChoice(nn(r,!1,i.config.allowHtmlUserInput),!0,!0),l=!0}i.clearInput(),i.unhighlightAll()}),l&&(this._triggerChange(r),this.config.closeDropdownOnSelect&&this.hideDropdown(!0))}}},t.prototype._onEscapeKey=function(e,n){n&&(e.stopPropagation(),this.hideDropdown(!0),this._stopSearch(),this.containerOuter.element.focus())},t.prototype._onDirectionKey=function(e,n){var i=e.keyCode;if(n||this._isSelectOneElement){this.showDropdown(),this._canSearch=!1;var r=i===xt.DOWN_KEY||i===xt.PAGE_DOWN_KEY?1:-1,s=e.metaKey||i===xt.PAGE_DOWN_KEY||i===xt.PAGE_UP_KEY,o=void 0;if(s)r>0?o=this.dropdown.element.querySelector("".concat(wi,":last-of-type")):o=this.dropdown.element.querySelector(wi);else{var l=this.dropdown.element.querySelector(yi(this.config.classNames.highlightedState));l?o=A1(l,wi,r):o=this.dropdown.element.querySelector(wi)}o&&(T1(o,this.choiceList.element,r)||this.choiceList.scrollToChildElement(o,r),this._highlightChoice(o)),e.preventDefault()}},t.prototype._onDeleteKey=function(e,n,i){!this._isSelectOneElement&&!e.target.value&&i&&(this._handleBackspace(n),e.preventDefault())},t.prototype._onTouchMove=function(){this._wasTap&&(this._wasTap=!1)},t.prototype._onTouchEnd=function(e){var n=(e||e.touches[0]).target,i=this._wasTap&&this.containerOuter.element.contains(n);if(i){var r=n===this.containerOuter.element||n===this.containerInner.element;r&&(this._isTextElement?this.input.focus():this._isSelectMultipleElement&&this.showDropdown()),e.stopPropagation()}this._wasTap=!0},t.prototype._onMouseDown=function(e){var n=e.target;if(n instanceof HTMLElement){if(Bv&&this.choiceList.element.contains(n)){var i=this.choiceList.element.firstElementChild;this._isScrollingOnIe=this._direction==="ltr"?e.offsetX>=i.offsetWidth:e.offsetX<i.offsetLeft}if(n!==this.input.element){var r=n.closest("[data-button],[data-item],[data-choice]");r instanceof HTMLElement&&("button"in r.dataset?this._handleButtonAction(r):"item"in r.dataset?this._handleItemAction(r,e.shiftKey):"choice"in r.dataset&&this._handleChoiceAction(r)),e.preventDefault()}}},t.prototype._onMouseOver=function(e){var n=e.target;n instanceof HTMLElement&&"choice"in n.dataset&&this._highlightChoice(n)},t.prototype._onClick=function(e){var n=e.target,i=this.containerOuter,r=i.element.contains(n);r?!this.dropdown.isActive&&!i.isDisabled?this._isTextElement?document.activeElement!==this.input.element&&this.input.focus():(this.showDropdown(),i.element.focus()):this._isSelectOneElement&&n!==this.input.element&&!this.dropdown.element.contains(n)&&this.hideDropdown():(i.removeFocusState(),this.hideDropdown(!0),this.unhighlightAll())},t.prototype._onFocus=function(e){var n=e.target,i=this.containerOuter,r=n&&i.element.contains(n);if(r){var s=n===this.input.element;this._isTextElement?s&&i.addFocusState():this._isSelectMultipleElement?s&&(this.showDropdown(!0),i.addFocusState()):(i.addFocusState(),s&&this.showDropdown(!0))}},t.prototype._onBlur=function(e){var n=e.target,i=this.containerOuter,r=n&&i.element.contains(n);r&&!this._isScrollingOnIe?n===this.input.element?(i.removeFocusState(),this.hideDropdown(!0),(this._isTextElement||this._isSelectMultipleElement)&&this.unhighlightAll()):n===this.containerOuter.element&&(i.removeFocusState(),this._canSearch||this.hideDropdown(!0)):(this._isScrollingOnIe=!1,this.input.element.focus())},t.prototype._onFormReset=function(){var e=this;this._store.withTxn(function(){e.clearInput(),e.hideDropdown(),e.refresh(!1,!1,!0),e._initialItems.length&&e.setChoiceByValue(e._initialItems)})},t.prototype._highlightChoice=function(e){e===void 0&&(e=null);var n=Array.from(this.dropdown.element.querySelectorAll(wi));if(n.length){var i=e,r=this.config.classNames.highlightedState,s=Array.from(this.dropdown.element.querySelectorAll(yi(r)));s.forEach(function(o){tn(o,r),o.setAttribute("aria-selected","false")}),i?this._highlightPosition=n.indexOf(i):(n.length>this._highlightPosition?i=n[this._highlightPosition]:i=n[n.length-1],i||(i=n[0])),Le(i,r),i.setAttribute("aria-selected","true"),this.passedElement.triggerEvent($t.highlightChoice,{el:i}),this.dropdown.isActive&&(this.input.setActiveDescendant(i.id),this.containerOuter.setActiveDescendant(i.id))}},t.prototype._addItem=function(e,n,i){if(n===void 0&&(n=!0),i===void 0&&(i=!1),!e.id)throw new TypeError("item.id must be set before _addItem is called for a choice/item");(this.config.singleModeForMultiSelect||this._isSelectOneElement)&&this.removeActiveItems(e.id),this._store.dispatch(rc(e)),n&&(this.passedElement.triggerEvent($t.addItem,this._getChoiceForOutput(e)),i&&this.passedElement.triggerEvent($t.choice,this._getChoiceForOutput(e)))},t.prototype._removeItem=function(e){if(e.id){this._store.dispatch(sc(e));var n=this._notice;n&&n.type===Et.noChoices&&this._clearNotice(),this.passedElement.triggerEvent($t.removeItem,this._getChoiceForOutput(e))}},t.prototype._addChoice=function(e,n,i){if(n===void 0&&(n=!0),i===void 0&&(i=!1),e.id)throw new TypeError("Can not re-add a choice which has already been added");var r=this.config;if(!(!r.duplicateItemsAllowed&&this._store.choices.find(function(l){return r.valueComparer(l.value,e.value)}))){this._lastAddedChoiceId++,e.id=this._lastAddedChoiceId,e.elementId="".concat(this._baseId,"-").concat(this._idNames.itemChoice,"-").concat(e.id);var s=r.prependValue,o=r.appendValue;s&&(e.value=s+e.value),o&&(e.value+=o.toString()),(s||o)&&e.element&&(e.element.value=e.value),this._clearNotice(),this._store.dispatch(ic(e)),e.selected&&this._addItem(e,n,i)}},t.prototype._addGroup=function(e,n){var i=this;if(n===void 0&&(n=!0),e.id)throw new TypeError("Can not re-add a group which has already been added");this._store.dispatch(I1(e)),e.choices&&(this._lastAddedGroupId++,e.id=this._lastAddedGroupId,e.choices.forEach(function(r){r.group=e,e.disabled&&(r.disabled=!0),i._addChoice(r,n)}))},t.prototype._createTemplates=function(){var e=this,n=this.config.callbackOnCreateTemplates,i={};typeof n=="function"&&(i=n.call(this,N1,ps,gr));var r={};Object.keys(this._templates).forEach(function(s){s in i?r[s]=i[s].bind(e):r[s]=e._templates[s].bind(e)}),this._templates=r},t.prototype._createElements=function(){var e=this._templates,n=this,i=n.config,r=n._isSelectOneElement,s=i.position,o=i.classNames,l=this._elementType;this.containerOuter=new cc({element:e.containerOuter(i,this._direction,this._isSelectElement,r,i.searchEnabled,l,i.labelId),classNames:o,type:l,position:s}),this.containerInner=new cc({element:e.containerInner(i),classNames:o,type:l,position:s}),this.input=new j1({element:e.input(i,this._placeholderValue),classNames:o,type:l,preventPaste:!i.paste}),this.choiceList=new uc({element:e.choiceList(i,r)}),this.itemList=new uc({element:e.itemList(i,r)}),this.dropdown=new z1({element:e.dropdown(i),classNames:o,type:l})},t.prototype._createStructure=function(){var e=this,n=e.containerInner,i=e.containerOuter,r=e.passedElement,s=this.dropdown.element;r.conceal(),n.wrap(r.element),i.wrap(n.element),this._isSelectOneElement?this.input.placeholder=this.config.searchPlaceholderValue||"":(this._placeholderValue&&(this.input.placeholder=this._placeholderValue),this.input.setWidth()),i.element.appendChild(n.element),i.element.appendChild(s),n.element.appendChild(this.itemList.element),s.appendChild(this.choiceList.element),this._isSelectOneElement?this.config.searchEnabled&&s.insertBefore(this.input.element,s.firstChild):n.element.appendChild(this.input.element),this._highlightPosition=0,this._isSearching=!1},t.prototype._initStore=function(){var e=this;this._store.subscribe(this._render).withTxn(function(){e._addPredefinedChoices(e._presetChoices,e._isSelectOneElement&&!e._hasNonChoicePlaceholder,!1)}),(!this._store.choices.length||this._isSelectOneElement&&this._hasNonChoicePlaceholder)&&this._render()},t.prototype._addPredefinedChoices=function(e,n,i){var r=this;if(n===void 0&&(n=!1),i===void 0&&(i=!0),n){var s=e.findIndex(function(o){return o.selected})===-1;s&&e.some(function(o){return o.disabled||"choices"in o?!1:(o.selected=!0,!0)})}e.forEach(function(o){"choices"in o?r._isSelectElement&&r._addGroup(o,i):r._addChoice(o,i)})},t.prototype._findAndSelectChoiceByValue=function(e,n){var i=this;n===void 0&&(n=!1);var r=this._store.choices.find(function(s){return i.config.valueComparer(s.value,e)});return r&&!r.disabled&&!r.selected?(this._addItem(r,!0,n),!0):!1},t.prototype._generatePlaceholderValue=function(){var e=this.config;if(!e.placeholder)return null;if(this._hasNonChoicePlaceholder)return e.placeholderValue;if(this._isSelectElement){var n=this.passedElement.placeholderOption;return n?n.text:null}return null},t.prototype._warnChoicesInitFailed=function(e){if(!this.config.silent)if(this.initialised){if(!this.initialisedOK)throw new TypeError("".concat(e," called for an element which has multiple instances of Choices initialised on it"))}else throw new TypeError("".concat(e," called on a non-initialised instance of Choices"))},t.version="11.1.0",t}();const wb="",Sb="";function Oc(t){let e,n;return{c(){e=b("label"),n=re(t[2]),y(e,"for",t[4])},m(i,r){z(i,e,r),v(e,n)},p(i,r){r&4&&Ne(n,i[2])},d(i){i&&R(e)}}}function Wv(t){let e;return{c(){e=b("select"),y(e,"id",t[4]),y(e,"name",t[4]),y(e,"aria-label",t[2]),y(e,"class","m-1")},m(n,i){z(n,e,i)},p(n,i){i&4&&y(e,"aria-label",n[2])},i:ie,o:ie,d(n){n&&R(e)}}}function Yv(t){let e,n,i,r=t[3].length&&Lc(t);return{c(){r&&r.c(),e=j(),n=b("select"),y(n,"id",t[4]),y(n,"name",t[4]),y(n,"aria-label",t[2]),y(n,"class","m-1"),n.multiple=!0},m(s,o){r&&r.m(s,o),z(s,e,o),z(s,n,o),i=!0},p(s,o){s[3].length?r?(r.p(s,o),o&8&&V(r,1)):(r=Lc(s),r.c(),V(r,1),r.m(e.parentNode,e)):r&&(tt(),K(r,1,1,()=>{r=null}),nt()),(!i||o&4)&&y(n,"aria-label",s[2])},i(s){i||(V(r),i=!0)},o(s){K(r),i=!1},d(s){r&&r.d(s),s&&R(e),s&&R(n)}}}function Lc(t){let e,n,i=t[3].length+"",r,s,o,l;return o=new ji({props:{targetHtmlId:t[5],tooltipText:`${t[3].length}
                                    ${B==="fr"&&t[3].length>1?"valeurs sélectionnées":B==="fr"&&t[3].length===1?"valeur sélectionnée":B==="en"&&t[3].length>1?"selected values":"selected value"}`}}),{c(){e=b("span"),n=b("span"),r=re(i),s=j(),ve(o.$$.fragment),y(n,"id",t[5]),y(n,"class","input-dropdown-count tag m-1 svelte-1epfuu8"),y(e,"class","is-relative")},m(a,c){z(a,e,c),v(e,n),v(n,r),v(e,s),he(o,e,null),l=!0},p(a,c){(!l||c&8)&&i!==(i=a[3].length+"")&&Ne(r,i);const u={};c&8&&(u.tooltipText=`${a[3].length}
                                    ${B==="fr"&&a[3].length>1?"valeurs sélectionnées":B==="fr"&&a[3].length===1?"valeur sélectionnée":B==="en"&&a[3].length>1?"selected values":"selected value"}`),o.$set(u)},i(a){l||(V(o.$$.fragment,a),l=!0)},o(a){K(o.$$.fragment,a),l=!1},d(a){a&&R(e),me(o)}}}function Xv(t){let e,n,i,r,s,o,l,a=t[2]!==void 0&&Oc(t);const c=[Yv,Wv],u=[];function h(f,d){return f[0]?0:1}return r=h(t),s=u[r]=c[r](t),{c(){e=b("div"),a&&a.c(),n=j(),i=b("div"),s.c(),y(i,"class",o="input-dropdown-select "+(t[0]?"is-multiple":"is-single")+" "+(t[0]&&t[3].length?"is-flex is-justify-content-flex-start is-align-items-center":"")+" "+(t[1]?"light-display":"")+" svelte-1epfuu8"),y(e,"class","input-dropdown-select-wrapper")},m(f,d){z(f,e,d),a&&a.m(e,null),v(e,n),v(e,i),u[r].m(i,null),l=!0},p(f,[d]){f[2]!==void 0?a?a.p(f,d):(a=Oc(f),a.c(),a.m(e,n)):a&&(a.d(1),a=null);let m=r;r=h(f),r===m?u[r].p(f,d):(tt(),K(u[m],1,1,()=>{u[m]=null}),nt(),s=u[r],s?s.p(f,d):(s=u[r]=c[r](f),s.c()),V(s,1),s.m(i,null)),(!l||d&11&&o!==(o="input-dropdown-select "+(f[0]?"is-multiple":"is-single")+" "+(f[0]&&f[3].length?"is-flex is-justify-content-flex-start is-align-items-center":"")+" "+(f[1]?"light-display":"")+" svelte-1epfuu8"))&&y(i,"class",o)},i(f){l||(V(s),l=!0)},o(f){K(s),l=!1},d(f){f&&R(e),a&&a.d(),u[r].d()}}}const Gv=250;function Jv(t,e,n){let i,r,{choicesItems:s}=e,{start:o=[]}=e,{multiple:l}=e,{searchable:a=!0}=e,{lightDisplay:c=!1}=e,{placeholder:u=B==="fr"?"Sélectionner une valeur":"Select a value"}=e,{title:h=void 0}=e,{selectAll:f=!!l}=e;const d=`input-dropdown-select-${window.crypto.randomUUID()}`,m=`input-dropdown-counter-${window.crypto.randomUUID()}`,p=`select-all-${window.crypto.randomUUID()}`,g=`unselect-all-${window.crypto.randomUUID()}`,_=Ti();let S;const C=Li();C.setCompareFn(Nr);const w=zt("resetTrigger")||void 0;w==null||w.subscribe(()=>F(S,s,o,f));const k=()=>{n(11,r=!0),setTimeout(()=>n(11,r=!1),Gv)},N=(P,X)=>{X||(C.set(P),C.same()||_("updateValues",i))},T=P=>`<span class="iconify" data-icon=${P}/>`,E=(P,X)=>P!=null&&X!=null&&P.length&&X.length?`<span class="dropdown-prefix-wrapper">${X==="iconify"?T(P):P}</span>`:"",x=(P,X)=>X?[{value:p,label:`<b>${B==="fr"?"Tout sélectionner":"Select all"}</b>`},{value:g,label:`<b>${B==="fr"?"Tout retirer":"Remove all"}</b>`},...P]:P,O=(P,X)=>x(P,X).map(U=>(U.id=`dropdown-choice-${window.crypto.randomUUID()}`,U.label=`<span>
                ${E(U.prefix||"",U.prefixType||"")}
                <span class="dropdown-prefix-text">${U.label}</span>
            </span>`,U));function L(P,X,U){return P=structuredClone(P),X=structuredClone(X),P=O(P,U).map(q=>X.includes(q.value)?{...q,selected:!0}:{...q,selected:!1}),n(3,i=X),P}function F(P,X,U,q){P&&(X=L(X,U,q),P.clearStore().setChoices(X))}const D=(P,X,U,q,J,ue)=>(q=structuredClone(q),U=structuredClone(U),P.detail.value===J?(k(),U=U.map(ce=>[J,ue].includes(ce.value)?{...ce,selected:!1}:{...ce,selected:!0}),X.removeActiveItems().clearChoices(!0,!0).setValue(U).hideDropdown(),q=[...new Set(U.filter(ce=>ce.selected===!0).map(ce=>ce.value))]):P.detail.value===ue?(X.removeActiveItems().hideDropdown(),q=[]):q=l===!0?[...q,P.detail.value]:[P.detail.value],[...new Set(q)]),I=(P,X)=>structuredClone(X).filter(U=>U!==P.detail.value);function H(P,X){const U=document.getElementById(d);S=new Kv(U,{items:[],choices:P,addChoices:!1,addItems:!1,removeItems:!0,removeItemButton:!0,searchEnabled:a,allowHTML:!0,shouldSort:!X,sorter:(q,J)=>q.label.localeCompare(J.label),placeholderValue:u,classNames:{item:["choices__item","dropdown-item"]},loadingText:B==="fr"?"Chargement...":"Loading...",noResultsText:B==="fr"?"Pas de résultats":"No results found",noChoicesText:B==="fr"?"Pas de choix pour faire la sélection":"No choices to choose from",itemSelectText:B==="fr"?"Cliquer pour sélectionner":"Press to select",uniqueItemText:B==="fr"?"Seules des valeurs uniques peuvent être ajoutées":"Only unique values can be added",customAddItemText:B==="fr"?"Les valeurs ne répondent pas aux conditions attendues":"Only values matching specific conditions can be added",removeItemIconText:B==="fr"?"Retirer l'item":"Remove item",addItemText:q=>B==="fr"?`Cliquer sur Entrer pour ajouter <b>${q}</b>`:`Press Enter to add <b>"${q}"</b>`,removeItemLabelText:q=>B==="fr"?`Retirer l'item: ${q}`:`Remove item: ${q}`,maxItemText:q=>B==="fr"?`Seulement ${q} items peuvent être ajoutées`:`Only ${q} items can be added`}),U.addEventListener("addItem",q=>{n(3,i=D(q,S,P,i,p,g))}),U.addEventListener("removeItem",q=>{n(3,i=I(q,i))})}return Dn(()=>{const P=L(s,o,f);H(P,f)}),Rn(()=>{S.destroy(),S=void 0}),t.$$set=P=>{"choicesItems"in P&&n(6,s=P.choicesItems),"start"in P&&n(7,o=P.start),"multiple"in P&&n(0,l=P.multiple),"searchable"in P&&n(8,a=P.searchable),"lightDisplay"in P&&n(1,c=P.lightDisplay),"placeholder"in P&&n(9,u=P.placeholder),"title"in P&&n(2,h=P.title),"selectAll"in P&&n(10,f=P.selectAll)},t.$$.update=()=>{t.$$.dirty&2056&&N(i,r)},n(3,i=[]),n(11,r=!1),[l,c,h,i,d,m,s,o,a,u,f,r]}class Qv extends He{constructor(e){super(),Fe(this,e,Jv,Xv,Re,{choicesItems:6,start:7,multiple:0,searchable:8,lightDisplay:1,placeholder:9,title:2,selectAll:10})}}const kb="";function Zv(t){let e,n,i,r,s,o,l,a,c,u,h,f,d,m,p,g,_,S,C,w,k,N,T,E,x,O,L,F,D,I,H,P,X,U,q,J,ue,ce,we;return c=new En({props:{minVal:0,maxVal:1,start:t[5],emitOnUpdate:!0,title:B==="fr"?"Opacité":"Opacity"}}),c.$on("updateSlider",t[9]),f=new En({props:{minVal:0,maxVal:360,start:t[6],step:1,emitOnUpdate:!0,title:"Rotation"}}),f.$on("updateSlider",t[10]),p=new En({props:{minVal:0,maxVal:200,step:1,start:t[7],emitOnUpdate:!0,title:B==="fr"?"Redimensionner":"Scale"}}),p.$on("updateSlider",t[11]),S=new En({props:{minVal:-100,maxVal:100,step:1,start:t[8][0],emitOnUpdate:!0,title:B==="fr"?"Translation horizontale":"Horizontal translate"}}),S.$on("updateSlider",t[12]),k=new En({props:{minVal:-100,maxVal:100,step:1,start:t[8][1],emitOnUpdate:!0,title:B==="fr"?"Translation verticale":"Vertical translate"}}),k.$on("updateSlider",t[13]),E=new Qv({props:{choicesItems:t[4],start:[],lightDisplay:!0,placeholder:B==="fr"?"Sélectionner":"Select",title:B==="fr"?"Basculer":"Flip"}}),E.$on("updateValues",t[14]),{c(){e=b("div"),n=b("div"),i=b("div"),r=b("div"),s=b("strong"),s.textContent=`${B==="en"?"Query image transformation":"Modification de l'image requête"}`,o=j(),l=b("div"),a=b("div"),ve(c.$$.fragment),u=j(),h=b("div"),ve(f.$$.fragment),d=j(),m=b("div"),ve(p.$$.fragment),g=j(),_=b("div"),ve(S.$$.fragment),C=j(),w=b("div"),ve(k.$$.fragment),N=j(),T=b("div"),ve(E.$$.fragment),x=j(),O=b("div"),L=b("button"),L.textContent=`${B==="fr"?"Réinitialiser":"Reset"}`,F=j(),D=b("div"),I=b("img"),X=j(),U=b("img"),y(r,"class","toolbar-title mt-0 mb-2 svelte-nzei31"),y(a,"class"," svelte-nzei31"),y(h,"class"," svelte-nzei31"),y(m,"class"," svelte-nzei31"),y(_,"class"," svelte-nzei31"),y(w,"class"," svelte-nzei31"),y(T,"class"," svelte-nzei31"),y(L,"class","button is-link"),y(O,"class","mt-2 is-flex is-flex-direction-column is-justify-content-center is-align-items-flex-end svelte-nzei31"),y(l,"class","toolbar-controls is-flex is-flex-direction-column is-align-items-start is-justify-content-center svelte-nzei31"),y(i,"class","toolbar svelte-nzei31"),y(n,"class","toolbar-wrapper is-flex is-flex-direction-column is-justify-content-center is-align-items-center svelte-nzei31"),y(I,"class","compare-img svelte-nzei31"),At(I.src,H=t[0].queryImage.href)||y(I,"src",H),y(I,"alt",P=t[0].queryImage.title),y(U,"class","main-img svelte-nzei31"),At(U.src,q=t[0].similarityImage.href)||y(U,"src",q),y(U,"alt",J=t[0].similarityImage.title),Ye(U,"overlay-reset",t[2]),We(U,"opacity",t[1]),We(U,"transform",t[3]),y(D,"class","overlay-wrapper svelte-nzei31"),y(e,"class","similarity-overlay-wrapper svelte-nzei31")},m(fe,Ve){z(fe,e,Ve),v(e,n),v(n,i),v(i,r),v(r,s),v(i,o),v(i,l),v(l,a),he(c,a,null),v(l,u),v(l,h),he(f,h,null),v(l,d),v(l,m),he(p,m,null),v(l,g),v(l,_),he(S,_,null),v(l,C),v(l,w),he(k,w,null),v(l,N),v(l,T),he(E,T,null),v(l,x),v(l,O),v(O,L),v(e,F),v(e,D),v(D,I),v(D,X),v(D,U),ue=!0,ce||(we=Ie(L,"click",t[15]),ce=!0)},p(fe,[Ve]){(!ue||Ve&1&&!At(I.src,H=fe[0].queryImage.href))&&y(I,"src",H),(!ue||Ve&1&&P!==(P=fe[0].queryImage.title))&&y(I,"alt",P),(!ue||Ve&1&&!At(U.src,q=fe[0].similarityImage.href))&&y(U,"src",q),(!ue||Ve&1&&J!==(J=fe[0].similarityImage.title))&&y(U,"alt",J),(!ue||Ve&4)&&Ye(U,"overlay-reset",fe[2]),Ve&2&&We(U,"opacity",fe[1]),Ve&8&&We(U,"transform",fe[3])},i(fe){ue||(V(c.$$.fragment,fe),V(f.$$.fragment,fe),V(p.$$.fragment,fe),V(S.$$.fragment,fe),V(k.$$.fragment,fe),V(E.$$.fragment,fe),ue=!0)},o(fe){K(c.$$.fragment,fe),K(f.$$.fragment,fe),K(p.$$.fragment,fe),K(S.$$.fragment,fe),K(k.$$.fragment,fe),K(E.$$.fragment,fe),ue=!1},d(fe){fe&&R(e),me(c),me(f),me(p),me(S),me(k),me(E),ce=!1,we()}}}function ey(t,e,n){let i,{imgData:r}=e;const s=[{value:"h",label:B==="fr"?"Basculer horizontalement":"Flip horizontally"},{value:"v",label:B==="fr"?"Basculer verticalement":"Flip vertically"},{value:"hv",label:B==="fr"?"Basculer horizontalement et verticalement":"Flip horizontally and vertically"}];let o=.5;const l=o;let a=0;const c=a;let u=100;const h=u;let f=[1,1];const d=structuredClone(f);let m=[0,0];const p=structuredClone(m);let g=!1;const _=Pe(window.crypto.randomUUID());$n("resetTrigger",_);const S=x=>n(1,o=x.detail),C=x=>n(16,a=x.detail),w=x=>n(17,u=x.detail),k=x=>n(19,m=[x.detail,m[1]]),N=x=>n(19,m=[m[0],x.detail]),T=x=>{let O=x.detail[0];n(18,f=O==="hv"?[-1,-1]:O==="h"?[-1,1]:O==="v"?[1,-1]:[1,1])},E=()=>{n(1,o=l),n(16,a=c),n(17,u=h),n(18,f=d),n(19,m=p),_.set(window.crypto.randomUUID()),n(2,g=!0),setTimeout(()=>n(2,g=!1),1e3)};return t.$$set=x=>{"imgData"in x&&n(0,r=x.imgData)},t.$$.update=()=>{t.$$.dirty&983040&&n(3,i=`translate(${m[0]-50}%, ${m[1]}%)
                        rotate(${a}deg)
                        scale(${f.map(x=>x*(u/100)).join()})`)},[r,o,g,i,s,l,c,h,p,S,C,w,k,N,T,E,a,u,f,m]}class ty extends He{constructor(e){super(),Fe(this,e,ey,Zv,Re,{imgData:0})}}function ny(){const t=`${window.location.origin}${window.location.pathname}`,e=25,n=window.location.pathname.match(/\d+/g).join("-"),i={[n]:{}},r=[2,6],s=Pe(1),o=Pe({}),l=Pe(JSON.parse(localStorage.getItem("selectedRegions"))||i);l.subscribe(F=>localStorage.setItem("selectedRegions",JSON.stringify(F)));const a=Pe(JSON.parse(localStorage.getItem("excludedCategories"))||[]);a.subscribe(F=>localStorage.setItem("excludedCategories",JSON.stringify(F)));const c=Pe(JSON.parse(localStorage.getItem("similarityScoreCutoff"))||void 0);c.subscribe(F=>{F!=null&&localStorage.setItem("similarityScoreCutoff",JSON.stringify(F))});const u=Pe(JSON.parse(localStorage.getItem("propagateRecursionDepth"))||r[1]);u.subscribe(F=>localStorage.setItem("propagateRecursionDepth",JSON.stringify(F)));const h=Pe(JSON.parse(localStorage.getItem("propagateFilterByRegions"))||!1);h.subscribe(F=>localStorage.setItem("propagateFilterByRegions",JSON.stringify(F)));const f=dt([u,h],([F,D])=>({propagateRecursionDepth:F,propagateFilterByRegions:D})),d=dt([a,l,c],([F,D,I])=>({excludedCategories:F,regions:D,similarityScoreCutoff:I})),m=dt([f,d],([F,D])=>({propagate:F,similarity:D})),p=Pe([]),g=Pe([]);async function _(){const F=async()=>{const H=await(await fetch(`${t}compared-regions`)).json();o.set(H),l.update(P=>{let X=P[n]||{};if(Object.keys(X).length){let U=Object.keys(X).filter(q=>Object.keys(H).includes(q)).reduce((q,J)=>(q[J]=X[J],q),{});P[n]=U}return P})},D=async()=>{const H=await(await fetch(`${t}query-images`)).json();H.length>0&&(p.set(H),O(T()))};ii.set(!0);try{await Promise.all([F(),D()])}catch(I){console.error("Error:",I),yu.set(I.message)}finally{ii.set(!1)}}function S(F){localStorage.setItem("selectedRegions",JSON.stringify(F))}function C(F){l.update(D=>{const I={...D};return delete I[n][F],S(I),I})}function w(F){l.update(D=>{const I={...D,[n]:{...D[n]||{},[F.ref]:F}};return S(I),I})}const k=dt(l,F=>D=>{var I;return(I=F[n])==null?void 0:I.hasOwnProperty(D)});function N(F){const D=vt(o),I=Object.keys(D).filter(H=>H.startsWith(F));return I.length!==1?{title:"Error"}:D[I[0]]}const T=()=>Ar(s,"sp"),E=dt([s,p],([F,D])=>(async()=>x(F,D))());function x(F,D){const I=(F-1)*e,H=I+e,P=D.slice(I,H);return g.set(P),P}function O(F){Tr(F,s,"sp")}function L(F){o.update(D=>({...D,[F.ref]:F}))}return{currentPage:s,comparedRegions:o,excludedCategories:a,qImgs:p,pageQImgs:g,selectedRegions:l,propagateRecursionDepth:u,propagateFilterByRegions:h,similarityToolbarParams:m,propagateParams:f,similarityScoreCutoff:c,allowedPropagateDepthRange:r,fetchSimilarity:_,setPageQImgs:E,getRegionsInfo:N,handlePageUpdate:O,unselect:C,select:w,addComparedRegions:L,isSelected:k,pageLength:e}}const hn=ny(),{getRegionsInfo:iy}=hn;async function Dc(t,e,n,i,r,s,o=!1,l=!0){const a=()=>l?`<b>${!isNaN(parseFloat(n))&&e===1?`Score: ${n}`:e===2&&B==="en"?"Manual similarity":e===2&&B==="fr"?"Correspondance manuelle":e===3&&B==="en"?"Propagated match":"Correspondance propagée"}</b>`:"",c=u=>`${u}<br>
        Page ${parseInt(i)}<br>
        ${a()}`;return o===!0?fetch(`${r}${s}get_regions_title/${t}`).then(u=>u.json()).then(u=>c(u.title)).catch(u=>(console.error("similarity.utils.getDesc()",u),c(B==="fr"?"Titre inconnu":"Unknown title"))):Promise.resolve(c(iy(t).title))}function Rc(t,e,n){const i=t.slice();return i[16]=e[n],i}function $c(t){let e,n,i=t[16]==="queryImage"&&B==="fr"?"Image requête":t[16]==="similarityImage"&&B==="fr"?"Similarité":t[16]==="queryImage"&&B==="en"?"Query image":"Similarity",r,s,o,l,a;return o=new Jn({props:{item:t[0][t[16]],descPromise:t[1][t[16]],height:"full"}}),{c(){e=b("div"),n=b("span"),r=re(i),s=j(),ve(o.$$.fragment),l=j(),y(e,"class","img-legend-wrapper column is-flex is-flex-direction-column is-justify-content-center is-align-items-center")},m(c,u){z(c,e,u),v(e,n),v(n,r),v(e,s),he(o,e,null),v(e,l),a=!0},p(c,u){const h={};u&1&&(h.item=c[0][c[16]]),o.$set(h)},i(c){a||(V(o.$$.fragment,c),a=!0)},o(c){K(o.$$.fragment,c),a=!1},d(c){c&&R(e),me(o)}}}function ry(t){let e,n,i=["queryImage","similarityImage"],r=[];for(let o=0;o<2;o+=1)r[o]=$c(Rc(t,i,o));const s=o=>K(r[o],1,1,()=>{r[o]=null});return{c(){e=b("div");for(let o=0;o<2;o+=1)r[o].c();y(e,"class","side-by-side columns")},m(o,l){z(o,e,l);for(let a=0;a<2;a+=1)r[a]&&r[a].m(e,null);n=!0},p(o,[l]){if(l&3){i=["queryImage","similarityImage"];let a;for(a=0;a<2;a+=1){const c=Rc(o,i,a);r[a]?(r[a].p(c,l),V(r[a],1)):(r[a]=$c(c),r[a].c(),V(r[a],1),r[a].m(e,null))}for(tt(),a=2;a<2;a+=1)s(a);nt()}},i(o){if(!n){for(let l=0;l<2;l+=1)V(r[l]);n=!0}},o(o){r=r.filter(Boolean);for(let l=0;l<2;l+=1)K(r[l]);n=!1},d(o){o&&R(e),wt(r,o)}}}function sy(t,e,n){let{imgData:i}=e;const r=zt("similarityPair"),s=new URL(window.location.href),o=s.origin,l=s.pathname,[a,c,u,h]=r.qImg.split(".")[0].split("_"),[f,d,m,p]=r.sImg.split(".")[0].split("_"),g=`${a}_${c}`,_=`${f}_${d}`,S={queryImage:Dc(g,r.similarityType,r.score,u,o,l,!0,!1),similarityImage:Dc(_,r.similarityType,r.score,m,o,l,!0,!0)};return t.$$set=C=>{"imgData"in C&&n(0,i=C.imgData)},[i,S]}class oy extends He{constructor(e){super(),Fe(this,e,sy,ry,Re,{imgData:0})}}const Eb="";function ly(t){let e,n;return e=new oy({props:{imgData:t[2]}}),{c(){ve(e.$$.fragment)},m(i,r){he(e,i,r),n=!0},p:ie,i(i){n||(V(e.$$.fragment,i),n=!0)},o(i){K(e.$$.fragment,i),n=!1},d(i){me(e,i)}}}function ay(t){let e,n;return e=new ty({props:{imgData:t[1]}}),{c(){ve(e.$$.fragment)},m(i,r){he(e,i,r),n=!0},p:ie,i(i){n||(V(e.$$.fragment,i),n=!0)},o(i){K(e.$$.fragment,i),n=!1},d(i){me(e,i)}}}function cy(t){let e,n,i,r,s,o,l,a,c;const u=[ay,ly],h=[];function f(d,m){return d[0]?0:1}return i=f(t),r=h[i]=u[i](t),a=new b1({props:{start:!1,buttonDisplay:!0,toggleLabel:B==="en"?"Overlay view":"Vue superposée"}}),a.$on("updateChecked",t[3]),{c(){e=b("div"),n=b("div"),r.c(),o=j(),l=b("div"),ve(a.$$.fragment),y(n,"class",s="modal-similarity-images "+(t[0]?"overlay-wrapper":"side-by-side-wrapper")+" svelte-1qvtan5"),y(e,"class","modal-similarity svelte-1qvtan5")},m(d,m){z(d,e,m),v(e,n),h[i].m(n,null),v(e,o),v(e,l),he(a,l,null),c=!0},p(d,[m]){let p=i;i=f(d),i===p?h[i].p(d,m):(tt(),K(h[p],1,1,()=>{h[p]=null}),nt(),r=h[i],r?r.p(d,m):(r=h[i]=u[i](d),r.c()),V(r,1),r.m(n,null)),(!c||m&1&&s!==(s="modal-similarity-images "+(d[0]?"overlay-wrapper":"side-by-side-wrapper")+" svelte-1qvtan5"))&&y(n,"class",s)},i(d){c||(V(r),V(a.$$.fragment,d),c=!0)},o(d){K(r),K(a.$$.fragment,d),c=!1},d(d){d&&R(e),h[i].d(),me(a)}}}function uy(t,e,n){let{mainImgItem:i}=e,{compareImgItem:r}=e;const s={similarityImage:{href:Kt(i.img,i.img.split("_").pop()),title:a(i.title)},queryImage:{href:Kt(r.img,r.img.split("_").pop()),title:a(r.title)}},o={similarityImage:i,queryImage:r};let l=!1;function a(u){return B==="fr"?`Vue principale de la région ${u}`:`Main view of region ${u}`}const c=()=>n(0,l=!l);return t.$$set=u=>{"mainImgItem"in u&&n(4,i=u.mainImgItem),"compareImgItem"in u&&n(5,r=u.compareImgItem)},[l,s,o,c,i,r]}class fy extends He{constructor(e){super(),Fe(this,e,uy,cy,Re,{mainImgItem:4,compareImgItem:5})}}const dy=Object.freeze(Object.defineProperty({__proto__:null,default:fy},Symbol.toStringTag,{value:"Module"})),zc=(t,e,n,i)=>({id:t,img:t,title:`Canvas ${i} - ${n} - ${B==="en"?"Witness":"Témoin"} #${Mr(e)}`,xywh:n.split(",").map(Number),canvas:i,ref:t.replace(".jpg",""),type:gu});function hy(t){let e,n,i,r,s,o,l,a,c,u,h;return n=new Bn({props:{category:1,isSelected:t[0]===1,toggle:t[4],padding:"pl-3 pr-2"}}),r=new Bn({props:{category:2,isSelected:t[0]===2,toggle:t[4]}}),o=new Bn({props:{category:3,isSelected:t[0]===3,toggle:t[4]}}),a=new Bn({props:{category:4,isSelected:t[0]===4,toggle:t[4]}}),u=new Bn({props:{category:5,isSelected:t[0]===5,toggle:t[4],padding:"pl-2 pr-3"}}),{c(){e=b("div"),ve(n.$$.fragment),i=j(),ve(r.$$.fragment),s=j(),ve(o.$$.fragment),l=j(),ve(a.$$.fragment),c=j(),ve(u.$$.fragment),y(e,"class","tags has-addons is-dark is-center")},m(f,d){z(f,e,d),he(n,e,null),v(e,i),he(r,e,null),v(e,s),he(o,e,null),v(e,l),he(a,e,null),v(e,c),he(u,e,null),h=!0},p(f,d){const m={};d&1&&(m.isSelected=f[0]===1),n.$set(m);const p={};d&1&&(p.isSelected=f[0]===2),r.$set(p);const g={};d&1&&(g.isSelected=f[0]===3),o.$set(g);const _={};d&1&&(_.isSelected=f[0]===4),a.$set(_);const S={};d&1&&(S.isSelected=f[0]===5),u.$set(S)},i(f){h||(V(n.$$.fragment,f),V(r.$$.fragment,f),V(o.$$.fragment,f),V(a.$$.fragment,f),V(u.$$.fragment,f),h=!0)},o(f){K(n.$$.fragment,f),K(r.$$.fragment,f),K(o.$$.fragment,f),K(a.$$.fragment,f),K(u.$$.fragment,f),h=!1},d(f){f&&R(e),me(n),me(r),me(o),me(a),me(u)}}}function my(t){let e,n,i,r;n=new Jn({props:{item:t[3],size:256,selectable:!1,isSquare:!1}});let s=!t[2]&&hy(t);return{c(){e=b("div"),ve(n.$$.fragment),i=j(),s&&s.c()},m(o,l){z(o,e,l),he(n,e,null),v(e,i),s&&s.m(e,null),r=!0},p(o,[l]){o[2]||s.p(o,l)},i(o){r||(V(n.$$.fragment,o),V(s),r=!0)},o(o){K(n.$$.fragment,o),K(s),r=!1},d(o){o&&R(e),me(n),s&&s.d()}}}function py(t,e,n){let i,r,s;const{comparedRegions:o}=hn;Ce(t,o,D=>n(15,s=D));const l=new URL(window.location.href),a=l.origin;l.pathname;let{qImg:c}=e,{sImg:u}=e,{qRegions:h}=e,{sRegions:f}=e,{score:d=0}=e,{category:m=null}=e,{users:p=[]}=e,{isManual:g}=e,{similarityType:_}=e;const S=zt("isInModal")||!1,[C,w,k,N]=u.split(".")[0].split("_"),E=(()=>{let D=zc(u,C,N,k);const I=s[`${C}_${w}_anno${f}`]||{title:D.title};return D.title=`${Su(I.title.replace(/^[^|]+/,""))}<br/>Page ${wu(k)}<br/><b>Score: ${d}</b>`,D})();$n("similarityPair",{qImg:c,sImg:u,qRegions:h,sRegions:f,score:d,category:m,users:p,isManual:g,similarityType:_});function x(D){D=D.slice();let I=D.indexOf(Number(Ir));return r&&I===-1?D.push(Number(Ir)):!r&&I!==-1&&D.splice(I,1),D}const O=()=>({img_1:c,img_2:u,regions_id_1:h,regions_id_2:f,score:d,category:i,category_x:x(p),similarity_type:_});function L(D){D===5?r=!r:n(0,i=i===D?null:D)}async function F(D){L(D);try{(await fetch(`${a}/${Yt}/save-category`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":vn},body:JSON.stringify(O())})).ok||(console.error("Error: Network response was not ok"),L(D))}catch(I){console.error("Error:",I),L(D)}}return t.$$set=D=>{"qImg"in D&&n(5,c=D.qImg),"sImg"in D&&n(6,u=D.sImg),"qRegions"in D&&n(7,h=D.qRegions),"sRegions"in D&&n(8,f=D.sRegions),"score"in D&&n(9,d=D.score),"category"in D&&n(10,m=D.category),"users"in D&&n(11,p=D.users),"isManual"in D&&n(12,g=D.isManual),"similarityType"in D&&n(13,_=D.similarityType)},t.$$.update=()=>{t.$$.dirty&1024&&n(0,i=m),t.$$.dirty&2048&&(r=p.includes(Number(Ir))||!1)},[i,o,S,E,F,c,u,h,f,d,m,p,g,_]}class gy extends He{constructor(e){super(),Fe(this,e,py,my,Re,{qImg:5,sImg:6,qRegions:7,sRegions:8,score:9,category:10,users:11,isManual:12,similarityType:13})}}function jc(t,e,n){const i=t.slice();return i[22]=e[n].uuid,i[23]=e[n].data[0],i[24]=e[n].data[1],i[25]=e[n].data[2],i[26]=e[n].data[3],i[27]=e[n].data[4],i[28]=e[n].data[5],i[29]=e[n].data[6],i[30]=e[n].data[7],i[31]=e[n].data[8],i}function _y(t){let e,n=B==="en"?`Error when retrieving similar regions: ${t[2]}`:`Erreur de recupération des régions similaires: ${t[2]}`,i;return{c(){e=b("div"),i=re(n),y(e,"class","faded is-center")},m(r,s){z(r,e,s),v(e,i)},p(r,s){s[0]&4&&n!==(n=B==="en"?`Error when retrieving similar regions: ${r[2]}`:`Erreur de recupération des régions similaires: ${r[2]}`)&&Ne(i,n)},i:ie,o:ie,d(r){r&&R(e)}}}function vy(t){let e,n,i=t[4].length+"",r,s,o=t[11](t[10],t[4].length)+"",l,a,c,u=[],h=new Map,f,d=t[4];const m=g=>g[22];for(let g=0;g<d.length;g+=1){let _=jc(t,d,g),S=m(_);h.set(S,u[g]=Hc(S,_))}let p=null;return d.length||(p=Fc(t)),{c(){e=b("div"),n=b("span"),r=re(i),s=j(),l=re(o),a=j(),c=b("div");for(let g=0;g<u.length;g+=1)u[g].c();p&&p.c(),y(n,"class","m-2"),y(c,"class","m-2 is-gap-2"),Ye(c,"grid",t[4].length>0)},m(g,_){z(g,e,_),v(e,n),v(n,r),v(n,s),v(n,l),v(e,a),v(e,c);for(let S=0;S<u.length;S+=1)u[S]&&u[S].m(c,null);p&&p.m(c,null),f=!0},p(g,_){(!f||_[0]&16)&&i!==(i=g[4].length+"")&&Ne(r,i),(!f||_[0]&16)&&o!==(o=g[11](g[10],g[4].length)+"")&&Ne(l,o),_[0]&49&&(d=g[4],tt(),u=Pi(u,_,m,1,g,d,h,c,Cr,Hc,null,jc),nt(),!d.length&&p?p.p(g,_):d.length?p&&(p.d(1),p=null):(p=Fc(g),p.c(),p.m(c,null))),(!f||_[0]&16)&&Ye(c,"grid",g[4].length>0)},i(g){if(!f){for(let _=0;_<d.length;_+=1)V(u[_]);f=!0}},o(g){for(let _=0;_<u.length;_+=1)K(u[_]);f=!1},d(g){g&&R(e);for(let _=0;_<u.length;_+=1)u[_].d();p&&p.d()}}}function yy(t){let e;return{c(){e=b("div"),e.textContent=`${B==="en"&&!t[10]?"Retrieving similar regions...":B==="fr"&&!t[10]?"Récupération des régions similaires...":B==="en"&&t[10]?"Retrieving propagated regions...":"Récupération de similarités propagées..."}`,y(e,"class","faded is-center")},m(n,i){z(n,e,i)},p:ie,i:ie,o:ie,d(n){n&&R(e)}}}function Fc(t){let e;function n(s,o){return s[5]?wy:by}let i=n(t),r=i(t);return{c(){r.c(),e=Ct()},m(s,o){r.m(s,o),z(s,e,o)},p(s,o){i===(i=n(s))&&r?r.p(s,o):(r.d(1),r=i(s),r&&(r.c(),r.m(e.parentNode,e)))},d(s){r.d(s),s&&R(e)}}}function by(t){let e;return{c(){e=b("div"),e.textContent=`${B==="en"?"No similar regions":"Pas de régions similaires"}
                    `,y(e,"class","faded is-center")},m(n,i){z(n,e,i)},p:ie,d(n){n&&R(e)}}}function wy(t){let e;return{c(){e=b("div"),e.textContent=`${B==="en"?"No document selected. Select one to display results.":"Aucun document sélectionné. Sélectionnez-en un pour afficher les résultats."}
                    `,y(e,"class","faded is-center")},m(n,i){z(n,e,i)},p:ie,d(n){n&&R(e)}}}function Hc(t,e){let n,i,r;return i=new gy({props:{qImg:e[0],sImg:e[25],score:e[23],qRegions:e[26],sRegions:e[27],category:e[28],users:e[29],isManual:e[30],similarityType:e[31]}}),{key:t,first:null,c(){n=Ct(),ve(i.$$.fragment),this.first=n},m(s,o){z(s,n,o),he(i,s,o),r=!0},p(s,o){e=s;const l={};o[0]&1&&(l.qImg=e[0]),o[0]&16&&(l.sImg=e[25]),o[0]&16&&(l.score=e[23]),o[0]&16&&(l.qRegions=e[26]),o[0]&16&&(l.sRegions=e[27]),o[0]&16&&(l.category=e[28]),o[0]&16&&(l.users=e[29]),o[0]&16&&(l.isManual=e[30]),o[0]&16&&(l.similarityType=e[31]),i.$set(l)},i(s){r||(V(i.$$.fragment,s),r=!0)},o(s){K(i.$$.fragment,s),r=!1},d(s){s&&R(n),me(i,s)}}}function Sy(t){let e,n,i,r;const s=[yy,vy,_y],o=[];function l(a,c){return a[1]&&a[3]==="loading"?0:a[3]==="loaded"?1:a[3]==="error"?2:-1}return~(e=l(t))&&(n=o[e]=s[e](t)),{c(){n&&n.c(),i=Ct()},m(a,c){~e&&o[e].m(a,c),z(a,i,c),r=!0},p(a,c){let u=e;e=l(a),e===u?~e&&o[e].p(a,c):(n&&(tt(),K(o[u],1,1,()=>{o[u]=null}),nt()),~e?(n=o[e],n?n.p(a,c):(n=o[e]=s[e](a),n.c()),V(n,1),n.m(i.parentNode,i)):n=null)},i(a){r||(V(n),r=!0)},o(a){K(n),r=!1},d(a){~e&&o[e].d(a),a&&R(i)}}}function ky(t,e,n){let i,r,s,o,l,a,c,u,{qImg:h}=e,{sImgsPromise:f}=e;const{selectedRegions:d,excludedCategories:m,similarityScoreCutoff:p,propagateFilterByRegions:g}=hn;Ce(t,d,x=>n(16,u=x)),Ce(t,m,x=>n(15,c=x)),Ce(t,p,x=>n(14,a=x)),Ce(t,g,x=>n(13,l=x));const _=zt("similarityPropagatedContext")||!1,S=window.location.pathname.match(/\d+/g).join("-");let C;const w=(x,O)=>x===null||O===void 0||Number(x)>=O,k=(x,O,L)=>!L.includes(x),N=(x,O,L,F,D,I)=>_?!0:w(x,D)&&k(O,L,F),T=(x,O,L,F)=>x.filter(({uuid:D,data:[I,H,P,X,U,q,J,ue,ce]})=>N(I,q,J,O,L)),E=(x,O)=>{const L=O>1;return x?B==="fr"?L?"similarités propagées":"similarité propagée":L?"propagated matches":"propagated match":B==="fr"?L?"images similaires":"image similaire":L?"similar images":"similar image"};return t.$$set=x=>{"qImg"in x&&n(0,h=x.qImg),"sImgsPromise"in x&&n(1,f=x.sImgsPromise)},t.$$.update=()=>{t.$$.dirty[0]&65536&&n(5,i=Object.values(u).length===0||u[S]===void 0||!Object.keys(u[S]).length),t.$$.dirty[0]&2&&(x=>{n(3,r="loading"),n(4,o=[]),n(12,s=[])})(),t.$$.dirty[0]&2&&f.then(x=>{n(12,s=x.map(O=>({uuid:window.crypto.randomUUID(),data:O}))),n(3,r="loaded")}).catch(x=>{n(2,C=x),n(3,r="error")}),t.$$.dirty[0]&61440&&n(4,o=T(s,c,a))},n(3,r="loading"),n(12,s=[]),[h,f,C,r,o,i,d,m,p,g,_,E,s,l,a,c,u]}class Vc extends He{constructor(e){super(),Fe(this,e,ky,Sy,Re,{qImg:0,sImgsPromise:1},null,[-1,-1])}}function Ey(t){let e,n;return e=new Vc({props:{qImg:t[0],sImgsPromise:t[1]}}),{c(){ve(e.$$.fragment)},m(i,r){he(e,i,r),n=!0},p(i,[r]){const s={};r&1&&(s.qImg=i[0]),r&2&&(s.sImgsPromise=i[1]),e.$set(s)},i(i){n||(V(e.$$.fragment,i),n=!0)},o(i){K(e.$$.fragment,i),n=!1},d(i){me(e,i)}}}function Cy(t,e,n){let i,r,{qImg:s}=e,o;const l=zt("isInModal")||!1,{selectedRegions:a,comparedRegions:c}=hn;Ce(t,a,m=>n(4,i=m)),Ce(t,c,m=>n(5,r=m));const u=`${window.location.origin}${window.location.pathname}`,h=window.location.pathname.match(/\d+/g).join("-"),f=(m,p)=>p?Object.keys(r).map(g=>r[g].id):Object.values(m[h]||{}).map(g=>g.id);async function d(m,p,g){const _=f(p,g);return _.length===0?[]:await(await fetch(`${u}similar-images`,{method:"POST",body:JSON.stringify({regionsIds:_,qImg:m,topk:12}),headers:{"Content-Type":"application/json","X-CSRFToken":vn}})).json()}return l?o=d(s,i,l):a.subscribe(m=>{n(1,o=d(s,m,l))}),t.$$set=m=>{"qImg"in m&&n(0,s=m.qImg)},[s,o,a,c]}class Iy extends He{constructor(e){super(),Fe(this,e,Cy,Ey,Re,{qImg:0})}}const Cb="";function xy(t){let e,n,i,r;return i=new Vc({props:{qImg:t[0],sImgsPromise:t[1]}}),{c(){e=b("div"),n=b("div"),ve(i.$$.fragment),y(n,"class","matches-suggestion svelte-1cb4wg0"),y(e,"class","block matches-suggestion-wrapper svelte-1cb4wg0")},m(s,o){z(s,e,o),v(e,n),he(i,n,null),r=!0},p(s,[o]){const l={};o&1&&(l.qImg=s[0]),o&2&&(l.sImgsPromise=s[1]),i.$set(l)},i(s){r||(V(i.$$.fragment,s),r=!0)},o(s){K(i.$$.fragment,s),r=!1},d(s){s&&R(e),me(i)}}}function My(t,e,n){let i,r,{qImg:s}=e;const{propagateParams:o,selectedRegions:l}=hn;Ce(t,o,g=>n(4,i=g)),Ce(t,l,g=>n(5,r=g));const a=`${window.location.origin}${window.location.pathname}`,c=window.location.pathname.match(/\d+/g).join("-"),u=zt("isInModal")||!1;let h;const f=Li();f.setCompareFn((g,_)=>[g,_].every(S=>S&&S.hasOwnProperty("propagateRecursionDepth")&&S.hasOwnProperty("propagateFilterByRegions"))?g.propagateRecursionDepth===_.propagateRecursionDepth&&g.propagateFilterByRegions===_.propagateFilterByRegions:!1);const d=Li();d.setCompareFn(Nr),$n("similarityPropagatedContext",!0);const m=g=>Object.keys(g).includes(c)?Object.values(g[c]).map(_=>_.id):[],p=async(g,_,S)=>fetch(`${a}propagated-matches/${s}`,{method:"POST",body:JSON.stringify({regionsIds:S?[]:_,filterByRegions:S?!1:g.propagateFilterByRegions,recursionDepth:g.propagateRecursionDepth}),headers:{"Content-Type":"application/json","X-CSRFToken":vn}}).then(C=>C.json()).catch(C=>(console.error("PropagatedMatches.getPropagatedMatches:",C),[]));return o.subscribe(g=>{f.set(g),f.same()||n(1,h=p(f.get(),m(r),u))}),l.subscribe(g=>{d.set(m(g)),i.propagateFilterByRegions===!0&&!d.same()&&n(1,h=p(i,d.get(),u))}),t.$$set=g=>{"qImg"in g&&n(0,s=g.qImg)},[s,h,o,l]}class Ay extends He{constructor(e){super(),Fe(this,e,My,xy,Re,{qImg:0})}}const Ib="";function Ty(t){let e,n,i,r=parseInt(t[5])+"",s,o,l,a,c,u,h,f,d,m,p,g,_,S,C,w,k,N,T;return{c(){e=b("a"),n=b("i"),i=re(`
            Page `),s=re(r),o=j(),l=b("img"),c=j(),u=b("div"),h=b("div"),f=b("input"),d=j(),m=b("button"),m.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M256 80c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 144L48 224c-17.7 0-32 14.3-32 32s14.3 32 32 32l144 0 0 144c0 17.7 14.3 32 32 32s32-14.3 32-32l0-144 144 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-144 0 0-144z"></path></svg>',p=j(),g=b("button"),_=Wt("svg"),S=Wt("path"),y(n,"class","fa-solid fa-pen-to-square"),y(e,"class","tag px-2 py-1 mb-2 is-rounded is-hoverable"),y(e,"href",xu(t[6],parseInt(t[5]))),y(e,"target","_blank"),At(l.src,a=Kt(t[0],t[0].split("_").pop(),"250,"))||y(l,"src",a),y(l,"alt","Query region"),y(l,"class","mb-3 card query-image svelte-f4ylwc"),y(f,"class","input is-small tag"),y(f,"type","text"),y(f,"placeholder",B==="en"?"Add new match":"Ajouter une correspondance"),y(m,"class","button is-small tag is-link is-center"),y(h,"class","tags has-addons"),We(h,"flex-wrap","nowrap"),y(S,"fill","white"),y(S,"d","M376.6 84.5c11.3-13.6 9.5-33.8-4.1-45.1s-33.8-9.5-45.1 4.1L192 206 56.6 43.5C45.3 29.9 25.1 28.1 11.5 39.4S-3.9 70.9 7.4 84.5L150.3 256 7.4 427.5c-11.3 13.6-9.5 33.8 4.1 45.1s33.8 9.5 45.1-4.1L192 306 327.4 468.5c11.3 13.6 31.5 15.4 45.1 4.1s15.4-31.5 4.1-45.1L233.7 256 376.6 84.5z"),y(_,"xmlns","http://www.w3.org/2000/svg"),y(_,"viewBox","0 0 384 512"),y(g,"id","no-match"),y(g,"class",C="button is-small tag is-danger is-center m-0 "+(t[3]===1?"visible":"")+" svelte-f4ylwc"),y(g,"title",B==="en"?"No match for this region in this witness":"Aucune correspondance de cette région pour ce témoin"),y(u,"class","new-similarity control pt-2 is-center svelte-f4ylwc")},m(E,x){z(E,e,x),v(e,n),v(e,i),v(e,s),z(E,o,x),z(E,l,x),z(E,c,x),z(E,u,x),v(u,h),v(h,f),Ci(f,t[1]),v(h,d),v(h,m),v(u,p),v(u,g),v(g,_),v(_,S),k=!0,N||(T=[Ie(f,"input",t[12]),Ie(m,"click",t[8]),Ie(g,"click",t[9])],N=!0)},p(E,x){(!k||x&1&&!At(l.src,a=Kt(E[0],E[0].split("_").pop(),"250,")))&&y(l,"src",a),x&2&&f.value!==E[1]&&Ci(f,E[1]),(!k||x&8&&C!==(C="button is-small tag is-danger is-center m-0 "+(E[3]===1?"visible":"")+" svelte-f4ylwc"))&&y(g,"class",C)},i(E){k||(jt(()=>{k&&(w||(w=_n(g,Un,{duration:500},!0)),w.run(1))}),k=!0)},o(E){w||(w=_n(g,Un,{duration:500},!1)),w.run(0),k=!1},d(E){E&&R(e),E&&R(o),E&&R(l),E&&R(c),E&&R(u),E&&w&&w.end(),N=!1,yt(T)}}}function Ny(t){let e,n,i,r,s,o,l,a;return n=new Iy({props:{qImg:t[0]}}),o=new Ay({props:{qImg:t[0]}}),{c(){e=b("div"),ve(n.$$.fragment),r=j(),s=b("div"),ve(o.$$.fragment),y(e,"class",i=Ei(t[7]?"":t[2])+" svelte-f4ylwc"),y(s,"class",l=Ei(t[7]?"":t[2])+" svelte-f4ylwc")},m(c,u){z(c,e,u),he(n,e,null),z(c,r,u),z(c,s,u),he(o,s,null),a=!0},p(c,u){const h={};u&1&&(h.qImg=c[0]),n.$set(h),(!a||u&4&&i!==(i=Ei(c[7]?"":c[2])+" svelte-f4ylwc"))&&y(e,"class",i);const f={};u&1&&(f.qImg=c[0]),o.$set(f),(!a||u&4&&l!==(l=Ei(c[7]?"":c[2])+" svelte-f4ylwc"))&&y(s,"class",l)},i(c){a||(V(n.$$.fragment,c),V(o.$$.fragment,c),a=!0)},o(c){K(n.$$.fragment,c),K(o.$$.fragment,c),a=!1},d(c){c&&R(e),me(n),c&&R(r),c&&R(s),me(o)}}}function Py(t){let e,n;return e=new Aa({props:{useGrid:!1,$$slots:{"row-body":[Ny],"row-header":[Ty]},$$scope:{ctx:t}}}),{c(){ve(e.$$.fragment)},m(i,r){he(e,i,r),n=!0},p(i,[r]){const s={};r&1048591&&(s.$$scope={dirty:r,ctx:i}),e.$set(s)},i(i){n||(V(e.$$.fragment,i),n=!0)},o(i){K(e.$$.fragment,i),n=!1},d(i){me(e,i)}}}function Oy(t){return t=t.replace(".jpg",""),/^wit\d+_[a-zA-Z]{3}\d+_\d+_\d+,\d+,\d+,\d+$/.test(t)}function Ly(t,e,n){let i,r,s,o;const{selectedRegions:l}=hn;Ce(t,l,N=>n(11,o=N));let{qImg:a}=e,c="";const[u,h,f,d]=a.split(".")[0].split("_"),m=`${window.location.origin}${window.location.pathname}`,p=window.location.pathname.match(/\d+/g).join("-"),g=B==="en"?"Error":"Erreur",_=zt("manifest"),S=zt("isInModal")||!1;$n("qImgMetadata",zc(a,u,d,f));async function C(){if(!c||!Oy(c)){await Tt(B==="en"?"Please insert a valid region reference to add a new match":"Veuillez insérer une référence de région valide pour ajouter une nouvelle correspondance","Error");return}try{const N=await fetch(`${m}add-region-pair`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":vn},body:JSON.stringify({q_img:a.replace(".jpg",""),s_img:c,similarity_type:2})});N.ok||(console.error("Error: Network response was not ok"),await Tt(B==="en"?"Problem with network, match was not added":"Problème de réseau, la correspondance n'a pas été ajoutée",g));const T=await N.json();if(T.hasOwnProperty("error")||!T.hasOwnProperty("s_regions")){await Tt(B==="en"?`Request was unsuccessful, match was not added:<br>${T.error}`:`La requête n'a pas abouti, la correspondance n'a pas été ajoutée :<br>${T.error}`,g);return}const E=T.s_regions;hn.addComparedRegions(E),hn.select(E)}catch(N){console.error("Error:",N),await Tt(B==="en"?`An error has occurred, match was not added:<br>${N}`:`Une erreur s'est produite, la correspondance n'a pas été ajoutée :<br>${N}`,g)}}async function w(){const N=Object.values(o[p])[0];if(await Tt(B==="en"?`Do you confirm this region does not have any match in ${N.title}?`:`Confirmez-vous que cette région n'a pas de correspondance dans ${N.title} ?`,B==="en"?"Confirm no match":"Confirmer l'absence de correspondance",!0))try{(await fetch(`${m}no-match`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":vn},body:JSON.stringify({q_img:a,s_regions:N.id})})).ok||(console.error("Error: Network response was not ok"),await Tt(B==="en"?"Problem with network":"Problème de réseau",g)),hn.select(N)}catch(E){console.error("Error:",E),await Tt(B==="en"?`An error has occurred, request was unsuccessful:<br>${E}`:`Une erreur s'est produite, la requête n'a pas abouti :<br>${E}`,g)}}function k(){c=this.value,n(1,c)}return t.$$set=N=>{"qImg"in N&&n(0,a=N.qImg)},t.$$.update=()=>{t.$$.dirty&2048&&n(3,i=o.hasOwnProperty(p)?Object.values(o[p]).length:0),t.$$.dirty&1024&&n(2,s=`fixed-grid has-${r-1}-cols`)},n(10,r=Us(window.innerWidth)),[a,c,s,i,l,f,_,S,C,w,r,o,k]}class Dy extends He{constructor(e){super(),Fe(this,e,Ly,Py,Re,{qImg:0})}}function Ry(t){let e,n,i,r,s,o;return s=new Dy({props:{qImg:t[0].img}}),{c(){e=b("div"),n=b("a"),i=b("button"),i.textContent=`${B==="fr"?"Voir toutes les similarités pour ce document":"View all similarities for this document"}`,r=j(),ve(s.$$.fragment),y(i,"class","button is-link is-small"),y(n,"href",t[1]()),y(e,"class","is-flex is-align-items-center is-justify-content-end")},m(l,a){z(l,e,a),v(e,n),v(n,i),z(l,r,a),he(s,l,a),o=!0},p(l,[a]){const c={};a&1&&(c.qImg=l[0].img),s.$set(c)},i(l){o||(V(s.$$.fragment,l),o=!0)},o(l){K(s.$$.fragment,l),o=!1},d(l){l&&R(e),l&&R(r),me(s,l)}}}function $y(t,e,n){let{mainImgItem:i}=e;function r(){const s=i.img.match(/wit(\d+)/)[1],o=new URL(window.location.origin);return o.pathname=`${new URL(window.location).pathname.split("/")[1]}/witness/${s}/regions/`,o.searchParams.set("tab","similarity"),o.href}return t.$$set=s=>{"mainImgItem"in s&&n(0,i=s.mainImgItem)},[i,r]}class zy extends He{constructor(e){super(),Fe(this,e,$y,Ry,Re,{mainImgItem:0})}}const jy=Object.freeze(Object.defineProperty({__proto__:null,default:zy},Symbol.toStringTag,{value:"Module"}))})();
//# sourceMappingURL=documentSet.js.map
