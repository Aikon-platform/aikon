(function(){"use strict";function X(){}const ds=t=>t;function ms(t,e){for(const n in e)t[n]=e[n];return t}function hc(t){return!!t&&(typeof t=="object"||typeof t=="function")&&typeof t.then=="function"}function ps(t){return t()}function gs(){return Object.create(null)}function Ye(t){t.forEach(ps)}function fn(t){return typeof t=="function"}function me(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}let ii;function pt(t,e){return ii||(ii=document.createElement("a")),ii.href=e,t===ii.href}function dc(t){return Object.keys(t).length===0}function ri(t,...e){if(t==null)return X;const n=t.subscribe(...e);return n.unsubscribe?()=>n.unsubscribe():n}function tt(t){let e;return ri(t,n=>e=n)(),e}function ge(t,e,n){t.$$.on_destroy.push(ri(e,n))}function bt(t,e,n,i){if(t){const r=_s(t,e,n,i);return t[0](r)}}function _s(t,e,n,i){return t[1]&&i?ms(n.ctx.slice(),t[1](i(e))):n.ctx}function wt(t,e,n,i){if(t[2]&&i){const r=t[2](i(n));if(e.dirty===void 0)return r;if(typeof r=="object"){const s=[],o=Math.max(e.dirty.length,r.length);for(let l=0;l<o;l+=1)s[l]=e.dirty[l]|r[l];return s}return e.dirty|r}return e.dirty}function St(t,e,n,i,r,s){if(r){const o=_s(e,n,i,s);t.p(o,r)}}function kt(t){if(t.ctx.length>32){const e=[],n=t.ctx.length/32;for(let i=0;i<n;i++)e[i]=-1;return e}return-1}function mc(t){const e={};for(const n in t)e[n]=!0;return e}function si(t){return t??""}function oi(t){return t&&fn(t.destroy)?t.destroy:X}const vs=typeof window<"u";let pc=vs?()=>window.performance.now():()=>Date.now(),Qi=vs?t=>requestAnimationFrame(t):X;const hn=new Set;function ys(t){hn.forEach(e=>{e.c(t)||(hn.delete(e),e.f())}),hn.size!==0&&Qi(ys)}function gc(t){let e;return hn.size===0&&Qi(ys),{promise:new Promise(n=>{hn.add(e={c:t,f:n})}),abort(){hn.delete(e)}}}function y(t,e){t.appendChild(e)}function bs(t){if(!t)return document;const e=t.getRootNode?t.getRootNode():t.ownerDocument;return e&&e.host?e:t.ownerDocument}function _c(t){const e=S("style");return vc(bs(t),e),e.sheet}function vc(t,e){return y(t.head||t,e),e.sheet}function z(t,e,n){t.insertBefore(e,n||null)}function $(t){t.parentNode&&t.parentNode.removeChild(t)}function nt(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function S(t){return document.createElement(t)}function Et(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function te(t){return document.createTextNode(t)}function B(){return te(" ")}function Ke(){return te("")}function be(t,e,n,i){return t.addEventListener(e,n,i),()=>t.removeEventListener(e,n,i)}function jt(t){return function(e){return e.preventDefault(),t.call(this,e)}}function v(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function yc(t){return Array.from(t.childNodes)}function pe(t,e){e=""+e,t.data!==e&&(t.data=e)}function li(t,e){t.value=e??""}function De(t,e,n,i){n==null?t.style.removeProperty(e):t.style.setProperty(e,n,i?"important":"")}function Ce(t,e,n){t.classList[n?"add":"remove"](e)}function ws(t,e,{bubbles:n=!1,cancelable:i=!1}={}){const r=document.createEvent("CustomEvent");return r.initCustomEvent(t,n,i,e),r}function ai(t,e){return new t(e)}const ci=new Map;let ui=0;function bc(t){let e=5381,n=t.length;for(;n--;)e=(e<<5)-e^t.charCodeAt(n);return e>>>0}function wc(t,e){const n={stylesheet:_c(e),rules:{}};return ci.set(t,n),n}function Ss(t,e,n,i,r,s,o,l=0){const a=16.666/i;let c=`{
`;for(let p=0;p<=1;p+=a){const _=e+(n-e)*s(p);c+=p*100+`%{${o(_,1-_)}}
`}const u=c+`100% {${o(n,1-n)}}
}`,d=`__svelte_${bc(u)}_${l}`,f=bs(t),{stylesheet:h,rules:m}=ci.get(f)||wc(f,t);m[d]||(m[d]=!0,h.insertRule(`@keyframes ${d} ${u}`,h.cssRules.length));const g=t.style.animation||"";return t.style.animation=`${g?`${g}, `:""}${d} ${i}ms linear ${r}ms 1 both`,ui+=1,d}function Sc(t,e){const n=(t.style.animation||"").split(", "),i=n.filter(e?s=>s.indexOf(e)<0:s=>s.indexOf("__svelte")===-1),r=n.length-i.length;r&&(t.style.animation=i.join(", "),ui-=r,ui||kc())}function kc(){Qi(()=>{ui||(ci.forEach(t=>{const{ownerNode:e}=t.stylesheet;e&&$(e)}),ci.clear())})}let Pn;function Ft(t){Pn=t}function dn(){if(!Pn)throw new Error("Function called outside component initialization");return Pn}function Ln(t){dn().$$.on_mount.push(t)}function Dn(t){dn().$$.on_destroy.push(t)}function fi(){const t=dn();return(e,n,{cancelable:i=!1}={})=>{const r=t.$$.callbacks[e];if(r){const s=ws(e,n,{cancelable:i});return r.slice().forEach(o=>{o.call(t,s)}),!s.defaultPrevented}return!0}}function mn(t,e){return dn().$$.context.set(t,e),e}function gt(t){return dn().$$.context.get(t)}const pn=[],gn=[];let _n=[];const ks=[],Ec=Promise.resolve();let Zi=!1;function Cc(){Zi||(Zi=!0,Ec.then(tr))}function Vt(t){_n.push(t)}const er=new Set;let vn=0;function tr(){if(vn!==0)return;const t=Pn;do{try{for(;vn<pn.length;){const e=pn[vn];vn++,Ft(e),Ic(e.$$)}}catch(e){throw pn.length=0,vn=0,e}for(Ft(null),pn.length=0,vn=0;gn.length;)gn.pop()();for(let e=0;e<_n.length;e+=1){const n=_n[e];er.has(n)||(er.add(n),n())}_n.length=0}while(pn.length);for(;ks.length;)ks.pop()();Zi=!1,er.clear(),Ft(t)}function Ic(t){if(t.fragment!==null){t.update(),Ye(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(Vt)}}function Mc(t){const e=[],n=[];_n.forEach(i=>t.indexOf(i)===-1?e.push(i):n.push(i)),n.forEach(i=>i()),_n=e}let Rn;function xc(){return Rn||(Rn=Promise.resolve(),Rn.then(()=>{Rn=null})),Rn}function nr(t,e,n){t.dispatchEvent(ws(`${e?"intro":"outro"}${n}`))}const hi=new Set;let Ht;function Se(){Ht={r:0,c:[],p:Ht}}function ke(){Ht.r||Ye(Ht.c),Ht=Ht.p}function V(t,e){t&&t.i&&(hi.delete(t),t.i(e))}function K(t,e,n,i){if(t&&t.o){if(hi.has(t))return;hi.add(t),Ht.c.push(()=>{hi.delete(t),i&&(n&&t.d(1),i())}),t.o(e)}else i&&i()}const Ac={duration:0};function Yt(t,e,n,i){const r={direction:"both"};let s=e(t,n,r),o=i?0:1,l=null,a=null,c=null;function u(){c&&Sc(t,c)}function d(h,m){const g=h.b-o;return m*=Math.abs(g),{a:o,b:h.b,d:g,duration:m,start:h.start,end:h.start+m,group:h.group}}function f(h){const{delay:m=0,duration:g=300,easing:p=ds,tick:_=X,css:w}=s||Ac,I={start:pc()+m,b:h};h||(I.group=Ht,Ht.r+=1),l||a?a=I:(w&&(u(),c=Ss(t,o,h,g,m,p,w)),h&&_(0,1),l=d(I,g),Vt(()=>nr(t,h,"start")),gc(b=>{if(a&&b>a.start&&(l=d(a,g),a=null,nr(t,l.b,"start"),w&&(u(),c=Ss(t,o,l.b,l.duration,0,p,s.css))),l){if(b>=l.end)_(o=l.b,1-o),nr(t,l.b,"end"),a||(l.b?u():--l.group.r||Ye(l.group.c)),l=null;else if(b>=l.start){const E=b-l.start;o=l.a+l.d*p(E/l.duration),_(o,1-o)}}return!!(l||a)}))}return{run(h){fn(s)?xc().then(()=>{s=s(r),f(h)}):f(h)},end(){u(),l=a=null}}}function ir(t,e){const n=e.token={};function i(r,s,o,l){if(e.token!==n)return;e.resolved=l;let a=e.ctx;o!==void 0&&(a=a.slice(),a[o]=l);const c=r&&(e.current=r)(a);let u=!1;e.block&&(e.blocks?e.blocks.forEach((d,f)=>{f!==s&&d&&(Se(),K(d,1,1,()=>{e.blocks[f]===d&&(e.blocks[f]=null)}),ke())}):e.block.d(1),c.c(),V(c,1),c.m(e.mount(),e.anchor),u=!0),e.block=c,e.blocks&&(e.blocks[s]=c),u&&tr()}if(hc(t)){const r=dn();if(t.then(s=>{Ft(r),i(e.then,1,e.value,s),Ft(null)},s=>{if(Ft(r),i(e.catch,2,e.error,s),Ft(null),!e.hasCatch)throw s}),e.current!==e.pending)return i(e.pending,0),!0}else{if(e.current!==e.then)return i(e.then,1,e.value,t),!0;e.resolved=t}}function Es(t,e,n){const i=e.slice(),{resolved:r}=t;t.current===t.then&&(i[t.value]=r),t.current===t.catch&&(i[t.error]=r),t.block.p(i,n)}function rr(t,e){K(t,1,1,()=>{e.delete(t.key)})}function sr(t,e,n,i,r,s,o,l,a,c,u,d){let f=t.length,h=s.length,m=f;const g={};for(;m--;)g[t[m].key]=m;const p=[],_=new Map,w=new Map,I=[];for(m=h;m--;){const M=d(r,s,m),k=n(M);let x=o.get(k);x?i&&I.push(()=>x.p(M,e)):(x=c(k,M),x.c()),_.set(k,p[m]=x),k in g&&w.set(k,Math.abs(m-g[k]))}const b=new Set,E=new Set;function T(M){V(M,1),M.m(l,u),o.set(M.key,M),u=M.first,h--}for(;f&&h;){const M=p[h-1],k=t[f-1],x=M.key,O=k.key;M===k?(u=M.first,f--,h--):_.has(O)?!o.has(x)||b.has(x)?T(M):E.has(O)?f--:w.get(x)>w.get(O)?(E.add(x),T(M)):(b.add(O),f--):(a(k,o),f--)}for(;f--;){const M=t[f];_.has(M.key)||a(M,o)}for(;h;)T(p[h-1]);return Ye(I),p}function Nc(t,e){const n={},i={},r={$$scope:1};let s=t.length;for(;s--;){const o=t[s],l=e[s];if(l){for(const a in o)a in l||(i[a]=1);for(const a in l)r[a]||(n[a]=l[a],r[a]=1);t[s]=l}else for(const a in o)r[a]=1}for(const o in i)o in n||(n[o]=void 0);return n}function Tc(t){return typeof t=="object"&&t!==null?t:{}}function le(t){t&&t.c()}function se(t,e,n,i){const{fragment:r,after_update:s}=t.$$;r&&r.m(e,n),i||Vt(()=>{const o=t.$$.on_mount.map(ps).filter(fn);t.$$.on_destroy?t.$$.on_destroy.push(...o):Ye(o),t.$$.on_mount=[]}),s.forEach(Vt)}function oe(t,e){const n=t.$$;n.fragment!==null&&(Mc(n.after_update),Ye(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function Oc(t,e){t.$$.dirty[0]===-1&&(pn.push(t),Cc(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function _e(t,e,n,i,r,s,o,l=[-1]){const a=Pn;Ft(t);const c=t.$$={fragment:null,ctx:[],props:s,update:X,not_equal:r,bound:gs(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(a?a.$$.context:[])),callbacks:gs(),dirty:l,skip_bound:!1,root:e.target||a.$$.root};o&&o(c.root);let u=!1;if(c.ctx=n?n(t,e.props||{},(d,f,...h)=>{const m=h.length?h[0]:f;return c.ctx&&r(c.ctx[d],c.ctx[d]=m)&&(!c.skip_bound&&c.bound[d]&&c.bound[d](m),u&&Oc(t,d)),f}):[],c.update(),u=!0,Ye(c.before_update),c.fragment=i?i(c.ctx):!1,e.target){if(e.hydrate){const d=yc(e.target);c.fragment&&c.fragment.l(d),d.forEach($)}else c.fragment&&c.fragment.c();e.intro&&V(t.$$.fragment),se(t,e.target,e.anchor,e.customElement),tr()}Ft(a)}class ve{$destroy(){oe(this,1),this.$destroy=X}$on(e,n){if(!fn(n))return X;const i=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return i.push(n),()=>{const r=i.indexOf(n);r!==-1&&i.splice(r,1)}}$set(e){this.$$set&&!dc(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const W=APP_LANG,Ct=APP_NAME;WEBAPP_NAME;const or=USER_ID;IS_SUPERUSER,ADD_PERMISSION;const Xt=CSRF_TOKEN;ADDITIONAL_MODULES;const Pc="Region",Cs=APP_URL,Lc=SAS_APP_URL;CANTALOUPE_APP_URL,MEDIA_PATH;const Dc=PAGE_LEN,Rc={Witness:W==="en"?"Witness":"Témoin",Work:W==="en"?"Work":"Œuvre",Series:W==="en"?"Series":"Série d'imprimés",Regions:W==="en"?"Region Extraction":"Extraction d'illustrations"},yn=[];function $c(t,e){return{subscribe:we(t,e).subscribe}}function we(t,e=X){let n;const i=new Set;function r(l){if(me(t,l)&&(t=l,n)){const a=!yn.length;for(const c of i)c[1](),yn.push(c,t);if(a){for(let c=0;c<yn.length;c+=2)yn[c][0](yn[c+1]);yn.length=0}}}function s(l){r(l(t))}function o(l,a=X){const c=[l,a];return i.add(c),i.size===1&&(n=e(r)||X),l(t),()=>{i.delete(c),i.size===0&&n&&(n(),n=null)}}return{set:r,update:s,subscribe:o}}function Be(t,e,n){const i=!Array.isArray(t),r=i?[t]:t,s=e.length<2;return $c(n,o=>{let l=!1;const a=[];let c=0,u=X;const d=()=>{if(c)return;u();const h=e(i?a[0]:a,o);s?o(h):u=fn(h)?h:X},f=r.map((h,m)=>ri(h,g=>{a[m]=g,c&=~(1<<m),l&&d()},()=>{c|=1<<m}));return l=!0,d(),function(){Ye(f),u(),l=!1}})}const $n=we(!1),zc=we(""),jc=t=>typeof t=="string"||t instanceof String;async function Is(t){$n.set(!0);try{return await t()}finally{$n.set(!1)}}function lr(t){return t.match(/\d+/g).toString()}function Fc(t){return parseInt(lr(t),10)}function ar(t,e=100){const n=Math.floor(e*.75);return t.length>e?t.slice(0,n)+"..."+t.slice(-e+n):t}function Vc(){return"https://vhs.huma-num.fr"}function Hc(){return Lc??"http://localhost:8888"}function cr(t,e){if(typeof window<"u"){const n=parseInt(new URLSearchParams(window.location.search).get(e));if(!isNaN(n))return t.set(n),n}return t.set(1),1}function ur(t,e,n){if(e.set(t),typeof window<"u"){const i=new URL(window.location.href);i.searchParams.set(n,t),window.history.pushState({},"",i)}}function Uc(t=null){return t=t.split("_"),t.length<3?void 0:`${t.slice(0,3).join("_").replace(".jpg","")}.jpg`}function Ms(t=null){const e=Uc(t);return e===void 0?void 0:`${Vc()}/iiif/2/${e}`}function Pt(t=null,e=null,n="full"){if(e=jc(e)?e.replace(".jpg",""):e,!t)return"https://placehold.co/96x96/png?text=No+image";const i=Ms(t);if(i===void 0)return"https://placehold.co/96x96/png?text=No+image";const r=t.split("_");return e||(e=r[r.length-1].includes(",")?r.pop().replace(".jpg",""):"full"),`${i}/${e}/${n}/0/default.jpg`}function Bc(t=null){return`${Ms(t)}/info.json`}function qc(t=null,e=1){return`${Hc()}/index.html?iiif-content=${t}&canvas=${e}`}function ct(t,e=null,n=!1){return new Promise(i=>{if(document.getElementById("msg-modal")){n?document.getElementById("modal-footer").hidden=!1:i(void 0),e&&(document.getElementById("modal-title").innerHTML=e),document.getElementById("modal-msg").innerHTML=t,document.getElementById("hidden-msg-btn").click();const s=document.getElementById("cancel-btn"),o=document.getElementById("ok-btn"),l=document.getElementById("modal-bkg"),a=()=>{s.removeEventListener("click",c),l.removeEventListener("click",c),o.removeEventListener("click",u),document.getElementById("modal-footer").hidden=!0},c=()=>{a(),i(!1)},u=()=>{a(),i(!0)};s.addEventListener("click",c),o.addEventListener("click",u)}else n?i(window.confirm(t)):(window.alert(t),i(void 0))})}function di(){let t,e,n=(i,r)=>i===r;return{set:i=>{e=t,t=i},setCompareFn:i=>n=i,get:()=>t,getNewAndOld:()=>[t,e],same:()=>n(t,e)}}const fr=(t,e)=>Array.isArray(t)&&Array.isArray(e)&&t.length===e.length&&t.every((n,i)=>n===e[i]||void 0);function Kc(t){const n=[85,70,60],i=[50,65,40],r=t*137.5%360,s=n[t%n.length],o=i[Math.floor(t/n.length)%i.length];return`hsl(${Math.floor(r)}, ${s}%, ${o}%)`}function xs(t=null){return t<600?1:t<800?2:t<1e3?3:t<1200?4:t<1400?5:t>=1400?6:4}function As(t){const e=t.querySelectorAll(".modal-background, .modal-close, .modal-card-head .delete, .modal-card-foot .button-close"),n=()=>t.classList.remove("is-active");e.forEach(r=>r.addEventListener("click",n));const i=r=>{r.key==="Escape"&&t.classList.contains("is-active")&&n()};return document.addEventListener("keydown",i),{destroy(){e.forEach(r=>r.removeEventListener("click",n)),document.removeEventListener("keydown",i)}}}function Ns(t){const e=()=>{const n=document.getElementById(t.dataset.target);n==null||n.classList.add("is-active")};return t.addEventListener("click",e),{destroy(){t.removeEventListener("click",e)}}}function Ts(t,e,n="string"){const i={string:s=>s.get(e)||"",array:s=>{const o=s.get(e);return o?o.split(",").map(Number).filter(l=>!isNaN(l)):null},set:s=>{const o=s.get(e);return o?new Set(o.split(",").map(Number).filter(l=>!isNaN(l))):null},number:s=>Number(s.get(e))||0,boolean:s=>s.get(e)==="true"},r={string:(s,o)=>o?s.searchParams.set(e,o):s.searchParams.delete(e),array:(s,o)=>{o.length?s.searchParams.set(e,o.join(",")):s.searchParams.delete(e)},set:(s,o)=>{o.size?s.searchParams.set(e,Array.from(o).join(",")):s.searchParams.delete(e)},number:(s,o)=>s.searchParams.set(e,String(o)),boolean:(s,o)=>o?s.searchParams.set(e,"true"):s.searchParams.delete(e)};if(typeof window<"u"){const s=new URLSearchParams(window.location.search),o=i[n](s);return o!==null&&t.set(o),l=>{const a=new URL(window.location);r[n](a,l),window.history.pushState({},"",a)}}return()=>{}}function Wc(t){const e=t-1;return e*e*e+1}function bn(t,{delay:e=0,duration:n=400,easing:i=ds}={}){const r=+getComputedStyle(t).opacity;return{delay:e,duration:n,easing:i,css:s=>`opacity: ${s*r}`}}function Os(t,{delay:e=0,duration:n=400,easing:i=Wc,axis:r="y"}={}){const s=getComputedStyle(t),o=+s.opacity,l=r==="y"?"height":"width",a=parseFloat(s[l]),c=r==="y"?["top","bottom"]:["left","right"],u=c.map(_=>`${_[0].toUpperCase()}${_.slice(1)}`),d=parseFloat(s[`padding${u[0]}`]),f=parseFloat(s[`padding${u[1]}`]),h=parseFloat(s[`margin${u[0]}`]),m=parseFloat(s[`margin${u[1]}`]),g=parseFloat(s[`border${u[0]}Width`]),p=parseFloat(s[`border${u[1]}Width`]);return{delay:e,duration:n,easing:i,css:_=>`overflow: hidden;opacity: ${Math.min(_*20,1)*o};${l}: ${_*a}px;padding-${c[0]}: ${_*d}px;padding-${c[1]}: ${_*f}px;margin-${c[0]}: ${_*h}px;margin-${c[1]}: ${_*m}px;border-${c[0]}-width: ${_*g}px;border-${c[1]}-width: ${_*p}px;`}}const ny="";function Ps(t){let e,n,i;return{c(){e=S("div"),e.innerHTML='<div class="loader svelte-vizlcg"></div>',v(e,"class","bkg-shade svelte-vizlcg")},m(r,s){z(r,e,s),i=!0},i(r){i||(Vt(()=>{i&&(n||(n=Yt(e,bn,{duration:150},!0)),n.run(1))}),i=!0)},o(r){n||(n=Yt(e,bn,{duration:150},!1)),n.run(0),i=!1},d(r){r&&$(e),r&&n&&n.end()}}}function Gc(t){let e,n,i=t[0]&&Ps();return{c(){i&&i.c(),e=Ke()},m(r,s){i&&i.m(r,s),z(r,e,s),n=!0},p(r,[s]){r[0]?i?s&1&&V(i,1):(i=Ps(),i.c(),V(i,1),i.m(e.parentNode,e)):i&&(Se(),K(i,1,1,()=>{i=null}),ke())},i(r){n||(V(i),n=!0)},o(r){K(i),n=!1},d(r){i&&i.d(r),r&&$(e)}}}function Yc(t,e,n){let i;return ge(t,$n,r=>n(0,i=r)),[i]}class Xc extends ve{constructor(e){super(),_e(this,e,Yc,Gc,me,{})}}const Jc=t=>({}),Ls=t=>({});function Qc(t){let e,n,i,r,s,o,l,a,c,u,d,f,h,m,g,p,_,w,I,b,E;const T=t[1].content,M=bt(T,t,t[0],Ls);return{c(){e=S("button"),n=B(),i=S("div"),r=S("div"),s=B(),o=S("div"),l=S("div"),l.innerHTML=`<div class="title is-4 mb-0 media-content"><span id="modal-title" class="mb-0"></span></div>
            <button class="delete media-left" aria-label="close"></button>`,a=B(),c=S("section"),u=S("div"),d=B(),f=S("div"),M&&M.c(),h=B(),m=S("footer"),g=S("div"),p=S("button"),p.textContent=`${W==="en"?"Abort":"Retour"}`,_=B(),w=S("button"),w.textContent="OK",v(e,"id","hidden-msg-btn"),v(e,"data-target","msg-modal"),e.hidden=!0,v(r,"id","modal-bkg"),v(r,"class","modal-background"),v(l,"class","modal-card-head media mb-0"),v(u,"id","modal-msg"),v(f,"class","py-3"),v(c,"id","modal-body"),v(c,"class","modal-card-body"),v(p,"id","cancel-btn"),v(p,"class","button is-link is-light button-close"),v(w,"id","ok-btn"),v(w,"class","button is-link button-close"),v(g,"class","buttons"),v(m,"id","modal-footer"),v(m,"class","modal-card-foot is-center pt-3"),m.hidden=!0,v(o,"class","modal-content"),v(i,"id","msg-modal"),v(i,"class","modal fade"),v(i,"tabindex","-1"),v(i,"aria-labelledby","selection-modal-label"),v(i,"aria-hidden","true")},m(k,x){z(k,e,x),z(k,n,x),z(k,i,x),y(i,r),y(i,s),y(i,o),y(o,l),y(o,a),y(o,c),y(c,u),y(c,d),y(c,f),M&&M.m(f,null),y(o,h),y(o,m),y(m,g),y(g,p),y(g,_),y(g,w),I=!0,b||(E=[oi(Ns.call(null,e)),oi(As.call(null,i))],b=!0)},p(k,[x]){M&&M.p&&(!I||x&1)&&St(M,T,k,k[0],I?wt(T,k[0],x,Jc):kt(k[0]),Ls)},i(k){I||(V(M,k),I=!0)},o(k){K(M,k),I=!1},d(k){k&&$(e),k&&$(n),k&&$(i),M&&M.d(k),b=!1,Ye(E)}}}function Zc(t,e,n){let{$$slots:i={},$$scope:r}=e;return t.$$set=s=>{"$$scope"in s&&n(0,r=s.$$scope)},[r,i]}class eu extends ve{constructor(e){super(),_e(this,e,Zc,Qc,me,{})}}const iy="",tu=t=>({activeTab:t&8}),Ds=t=>({activeTab:t[3]});function Rs(t,e,n){const i=t.slice();return i[11]=e[n][0],i[12]=e[n][1],i}const nu=t=>({activeTab:t&8}),$s=t=>({activeTab:t[3]}),iu=t=>({}),zs=t=>({});function ru(t){let e,n,i=Object.entries(t[2]),r=[];for(let s=0;s<i.length;s+=1)r[s]=js(Rs(t,i,s));return{c(){e=S("div"),n=S("ul");for(let s=0;s<r.length;s+=1)r[s].c();v(e,"class","tabs")},m(s,o){z(s,e,o),y(e,n);for(let l=0;l<r.length;l+=1)r[l]&&r[l].m(n,null)},p(s,o){if(o&28){i=Object.entries(s[2]);let l;for(l=0;l<i.length;l+=1){const a=Rs(s,i,l);r[l]?r[l].p(a,o):(r[l]=js(a),r[l].c(),r[l].m(n,null))}for(;l<r.length;l+=1)r[l].d(1);r.length=i.length}},i:X,o:X,d(s){s&&$(e),nt(r,s)}}}function su(t){let e;const n=t[8].tabs,i=bt(n,t,t[7],$s);return{c(){i&&i.c()},m(r,s){i&&i.m(r,s),e=!0},p(r,s){i&&i.p&&(!e||s&136)&&St(i,n,r,r[7],e?wt(n,r[7],s,nu):kt(r[7]),$s)},i(r){e||(V(i,r),e=!0)},o(r){K(i,r),e=!1},d(r){i&&i.d(r)}}}function js(t){let e,n,i=t[12]+"",r,s,o,l;function a(){return t[9](t[11])}return{c(){e=S("li"),n=S("a"),r=te(i),s=B(),v(n,"href",null),Ce(e,"is-active",t[3]===t[11])},m(c,u){z(c,e,u),y(e,n),y(n,r),y(e,s),o||(l=be(n,"click",a),o=!0)},p(c,u){t=c,u&4&&i!==(i=t[12]+"")&&pe(r,i),u&12&&Ce(e,"is-active",t[3]===t[11])},d(c){c&&$(e),o=!1,l()}}}function ou(t){let e,n,i,r,s,o,l,a,c,u,d,f,h;e=new Xc({});const m=t[8].sidebar,g=bt(m,t,t[7],zs),p=[su,ru],_=[];function w(E,T){return T&4&&(a=null),E[5].tabs?0:(a==null&&(a=!!Object.keys(E[2]).length),a?1:-1)}~(c=w(t,-1))&&(u=_[c]=p[c](t));const I=t[8].content,b=bt(I,t,t[7],Ds);return{c(){le(e.$$.fragment),n=B(),i=S("div"),r=S("aside"),g&&g.c(),s=B(),o=S("main"),l=S("nav"),u&&u.c(),d=B(),f=S("div"),b&&b.c(),v(r,"class","sidebar svelte-jexg"),De(r,"width",t[0]+"%"),De(r,"min-height",t[1]),v(l,"id","tabs"),v(l,"class","tabs-bar svelte-jexg"),v(f,"class","content-area pl-5 svelte-jexg"),v(o,"class","main-content svelte-jexg"),De(o,"width",100-t[0]+"%"),De(o,"min-height",t[1]),v(i,"class","layout svelte-jexg"),De(i,"min-height",t[1])},m(E,T){se(e,E,T),z(E,n,T),z(E,i,T),y(i,r),g&&g.m(r,null),y(i,s),y(i,o),y(o,l),~c&&_[c].m(l,null),y(o,d),y(o,f),b&&b.m(f,null),h=!0},p(E,[T]){g&&g.p&&(!h||T&128)&&St(g,m,E,E[7],h?wt(m,E[7],T,iu):kt(E[7]),zs),(!h||T&1)&&De(r,"width",E[0]+"%");let M=c;c=w(E,T),c===M?~c&&_[c].p(E,T):(u&&(Se(),K(_[M],1,1,()=>{_[M]=null}),ke()),~c?(u=_[c],u?u.p(E,T):(u=_[c]=p[c](E),u.c()),V(u,1),u.m(l,null)):u=null),b&&b.p&&(!h||T&136)&&St(b,I,E,E[7],h?wt(I,E[7],T,tu):kt(E[7]),Ds),(!h||T&1)&&De(o,"width",100-E[0]+"%")},i(E){h||(V(e.$$.fragment,E),V(g,E),V(u),V(b,E),h=!0)},o(E){K(e.$$.fragment,E),K(g,E),K(u),K(b,E),h=!1},d(E){oe(e,E),E&&$(n),E&&$(i),g&&g.d(E),~c&&_[c].d(),b&&b.d(E)}}}function lu(t=null){t||(t=document.getElementById("navbar")),document.documentElement.style.setProperty("--top-offset",`${t.offsetHeight}px`)}function au(t,e,n){let i,{$$slots:r={},$$scope:s}=e;const o=mc(r);let{sidebarWidth:l="25"}=e;const a="90vh";let{tabList:c={}}=e,u=Object.keys(c),{topOffsetElement:d=null}=e;lu(d);function f(m){if(!u.includes(m)){console.warn(`Tab "${m}" is not available.`);return}n(3,i=m);const g=new URL(window.location);g.searchParams.set("tab",m),window.history.pushState({},"",g)}const h=m=>f(m);return t.$$set=m=>{"sidebarWidth"in m&&n(0,l=m.sidebarWidth),"tabList"in m&&n(2,c=m.tabList),"topOffsetElement"in m&&n(6,d=m.topOffsetElement),"$$scope"in m&&n(7,s=m.$$scope)},n(3,i=new URLSearchParams(window.location.search).get("tab")??u[0]??null),[l,a,c,i,f,o,d,s,r,h]}class cu extends ve{constructor(e){super(),_e(this,e,au,ou,me,{sidebarWidth:0,layoutHeight:1,tabList:2,topOffsetElement:6})}get layoutHeight(){return this.$$.ctx[1]}}const mi={0:{title:W==="en"?"no categorization":"aucune catégorisation",svg:`<svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 59 59">
        <rect x="1" y="0.62" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>
    </svg>`},1:{title:W==="en"?"overall visual matches":"correspondances visuelles globales",svg:`<svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 68 69">
        <rect x="10" y="10.62" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>
        <rect x="1" y="1" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>
        <rect x="10" y="10.62" width="46" height="45.71" rx="4.11" ry="4.11" fill="currentColor" stroke="none"/>
    </svg>`},2:{title:W==="en"?"visual matches on part of the image":"correspondances visuelles sur une partie de l'image",svg:`<svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 70 71">
        <rect x="12" y="12.43" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>
        <rect x="1" y="0.81" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>
        <path d="M 12 21.43 L 21 12.43" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
        <path d="M 12 30 L 30 12.43" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
        <path d="M 40 56 L 57 38" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
        <path d="M 48.3 56.29 L 57 47" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
        <path d="M 12 39 L 39 12" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
        <path d="M 12 48 L 48 12" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
        <path d="M 13 56 L 57 12" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
        <path d="M 31 56 L 57 29" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
        <path d="M 21 57 L 57 21" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
    </svg>`},3:{title:W==="en"?"semantic and non-visual matches":"correspondances sémantiques et non-visuelle",svg:`<svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 72 73">
        <rect x="14" y="14.43" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3" stroke-dasharray="9 9"/>
        <rect x="1" y="0.81" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>
    </svg>`},4:{title:W==="en"?"regions without match":"régions sans correspondance",svg:`<svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 59 59">
        <rect x="1" y="0.62" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>
        <path d="M 2.67 54.55 L 55 2" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
        <path d="M 54.37 54.05 L 2.72 2.24" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
    </svg>`},5:{title:W==="en"?"user specific category":"correspondances spécifiques à l'utilisateur",svg:`<svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 59 59">
        <rect x="1" y="0.81" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>
        <path d="M 8.69 55.28 C 9.25 44.15 18.08 35.28 28.86 35.28 C 32.5 35.28 36.07 36.3 39.18 38.25 C 44.96 41.85 48.66 48.3 49.02 55.28 Z M 17.85 21.48 C 17.85 15.37 22.79 10.39 28.86 10.39 C 34.92 10.39 39.86 15.37 39.86 21.48 C 39.86 27.59 34.92 32.56 28.86 32.56 C 22.79 32.56 17.85 27.59 17.85 21.48 Z M 40.37 36.34 C 38.43 35.13 36.32 34.25 34.13 33.7 C 38.82 31.64 42.1 26.94 42.1 21.48 C 42.1 14.13 36.16 8.15 28.86 8.15 C 21.55 8.15 15.61 14.13 15.61 21.48 C 15.61 26.95 18.9 31.66 23.6 33.71 C 13.76 36.18 6.41 45.4 6.41 56.4 C 6.41 57.02 6.92 57.52 7.54 57.52 L 50.17 57.52 C 50.79 57.52 51.3 57.02 51.3 56.4 C 51.3 48.23 47.11 40.54 40.37 36.34 Z" fill="currentColor" stroke="none"/>
    </svg>`}};function uu(t){let e,n=mi[t[2]].svg+"",i,r,s,o;return{c(){e=S("span"),v(e,"class",i="tag py-4 "+t[4]+" "+(t[0]?"is-hoverable":"")),v(e,"title",r=mi[t[2]].title),Ce(e,"is-selected",t[1])},m(l,a){z(l,e,a),e.innerHTML=n,s||(o=[be(e,"click",t[5]),be(e,"keyup",null)],s=!0)},p(l,[a]){a&4&&n!==(n=mi[l[2]].svg+"")&&(e.innerHTML=n),a&17&&i!==(i="tag py-4 "+l[4]+" "+(l[0]?"is-hoverable":""))&&v(e,"class",i),a&4&&r!==(r=mi[l[2]].title)&&v(e,"title",r),a&19&&Ce(e,"is-selected",l[1])},i:X,o:X,d(l){l&&$(e),s=!1,Ye(o)}}}function fu(t,e,n){let{selectable:i=!0}=e,{isSelected:r=!1}=e,{category:s}=e,{toggle:o=()=>{}}=e,{padding:l="px-2"}=e;const a=()=>o(s);return t.$$set=c=>{"selectable"in c&&n(0,i=c.selectable),"isSelected"in c&&n(1,r=c.isSelected),"category"in c&&n(2,s=c.category),"toggle"in c&&n(3,o=c.toggle),"padding"in c&&n(4,l=c.padding)},[i,r,s,o,l,a]}class wn extends ve{constructor(e){super(),_e(this,e,fu,uu,me,{selectable:0,isSelected:1,category:2,toggle:3,padding:4})}}const gy="";function Fs(t){let e,n,i=t[3].title+"",r,s;return{c(){e=S("span"),n=S("a"),r=te(i),v(n,"href",s=`${Cs}/${Ct}/witness/${t[3].witnessId}/regions/${t[1]}`),v(n,"target","_blank"),v(e,"class","legend-label svelte-w1sf17")},m(o,l){z(o,e,l),y(e,n),y(n,r)},p(o,l){l&8&&i!==(i=o[3].title+"")&&pe(r,i),l&10&&s!==(s=`${Cs}/${Ct}/witness/${o[3].witnessId}/regions/${o[1]}`)&&v(n,"href",s)},d(o){o&&$(e)}}}function hu(t){let e,n,i,r,s,o,l,a,c,u=!t[5]&&Fs(t);return{c(){e=S("div"),n=S("span"),i=B(),r=S("span"),l=B(),u&&u.c(),v(n,"class","legend-nb svelte-w1sf17"),v(r,"class","legend-color svelte-w1sf17"),v(r,"aria-label",s=t[3].title),v(r,"title",o=t[3].title),De(r,"background-color",t[0]?t[3].color:"#999"),v(r,"role","button"),v(r,"tabindex","0"),Ce(r,"inactive",!t[0]),Ce(r,"clickable",t[4]),v(e,"class","legend-item svelte-w1sf17"),Ce(e,"inactive",!t[0])},m(d,f){z(d,e,f),y(e,n),y(e,i),y(e,r),y(e,l),u&&u.m(e,null),a||(c=[be(r,"click",function(){fn(t[2])&&t[2].apply(this,arguments)}),be(r,"keydown",null)],a=!0)},p(d,[f]){t=d,f&8&&s!==(s=t[3].title)&&v(r,"aria-label",s),f&8&&o!==(o=t[3].title)&&v(r,"title",o),f&9&&De(r,"background-color",t[0]?t[3].color:"#999"),f&1&&Ce(r,"inactive",!t[0]),f&16&&Ce(r,"clickable",t[4]),t[5]?u&&(u.d(1),u=null):u?u.p(t,f):(u=Fs(t),u.c(),u.m(e,null)),f&1&&Ce(e,"inactive",!t[0])},i:X,o:X,d(d){d&&$(e),u&&u.d(),a=!1,Ye(c)}}}function du(t,e,n){let{isActive:i=!0}=e,{id:r}=e,{toggle:s=()=>{}}=e,{meta:o={title:"Region",color:"#999",witnessId:1}}=e,{clickable:l=!0}=e,{onlyColor:a=!1}=e;return t.$$set=c=>{"isActive"in c&&n(0,i=c.isActive),"id"in c&&n(1,r=c.id),"toggle"in c&&n(2,s=c.toggle),"meta"in c&&n(3,o=c.meta),"clickable"in c&&n(4,l=c.clickable),"onlyColor"in c&&n(5,a=c.onlyColor)},[i,r,s,o,l,a]}class hr extends ve{constructor(e){super(),_e(this,e,du,hu,me,{isActive:0,id:1,toggle:2,meta:3,clickable:4,onlyColor:5})}}const _y="";function Vs(t,e,n){const i=t.slice();return i[6]=e[n][0],i[7]=e[n][1],i}function mu(t){let e;return{c(){e=S("span"),e.innerHTML='<i class="fas fa-chevron-down"></i>',v(e,"class","icon is-small")},m(n,i){z(n,e,i)},d(n){n&&$(e)}}}function pu(t){let e;return{c(){e=S("span"),e.innerHTML='<i class="fas fa-chevron-up"></i>',v(e,"class","icon is-small")},m(n,i){z(n,e,i)},d(n){n&&$(e)}}}function Hs(t){let e,n;function i(){return t[5](t[6])}return e=new hr({props:{id:t[6],meta:t[7],isActive:t[1].has(parseInt(t[6])),toggle:i,onlyColor:!t[3]}}),{c(){le(e.$$.fragment)},m(r,s){se(e,r,s),n=!0},p(r,s){t=r;const o={};s&1&&(o.id=t[6]),s&1&&(o.meta=t[7]),s&3&&(o.isActive=t[1].has(parseInt(t[6]))),s&5&&(o.toggle=i),s&8&&(o.onlyColor=!t[3]),e.$set(o)},i(r){n||(V(e.$$.fragment,r),n=!0)},o(r){K(e.$$.fragment,r),n=!1},d(r){oe(e,r)}}}function gu(t){let e,n,i,r,s,o,l,a,c,u,d,f,h,m,g,p;function _(M,k){return M[3]?pu:mu}let w=_(t),I=w(t),b=Array.from(t[0]||new Map),E=[];for(let M=0;M<b.length;M+=1)E[M]=Hs(Vs(t,b,M));const T=M=>K(E[M],1,1,()=>{E[M]=null});return{c(){e=S("div"),n=S("div"),i=S("div"),r=S("div"),s=S("h3"),s.textContent=`${W==="en"?"Visible documents":"Documents visibles"}`,o=B(),l=S("div"),a=S("div"),c=S("button"),I.c(),f=B(),h=S("div");for(let M=0;M<E.length;M+=1)E[M].c();v(s,"class","title mb-0"),v(r,"class","level-item"),v(i,"class","level-left"),v(c,"class","button is-small is-ghost"),v(c,"aria-label",u=t[3]?"Minify legend":"Expand legend"),v(a,"class","level-item"),v(a,"title",d=t[3]?"Minify legend":"Expand legend"),v(l,"class","level-right"),v(n,"class","level is-mobile mb-3"),v(h,"class","svelte-13ym7ov"),Ce(h,"is-condensed",!t[3]),Ce(h,"is-expanded",t[3])},m(M,k){z(M,e,k),y(e,n),y(n,i),y(i,r),y(r,s),y(n,o),y(n,l),y(l,a),y(a,c),I.m(c,null),y(e,f),y(e,h);for(let x=0;x<E.length;x+=1)E[x]&&E[x].m(h,null);m=!0,g||(p=be(c,"click",t[4]),g=!0)},p(M,[k]){if(w!==(w=_(M))&&(I.d(1),I=w(M),I&&(I.c(),I.m(c,null))),(!m||k&8&&u!==(u=M[3]?"Minify legend":"Expand legend"))&&v(c,"aria-label",u),(!m||k&8&&d!==(d=M[3]?"Minify legend":"Expand legend"))&&v(a,"title",d),k&15){b=Array.from(M[0]||new Map);let x;for(x=0;x<b.length;x+=1){const O=Vs(M,b,x);E[x]?(E[x].p(O,k),V(E[x],1)):(E[x]=Hs(O),E[x].c(),V(E[x],1),E[x].m(h,null))}for(Se(),x=b.length;x<E.length;x+=1)T(x);ke()}(!m||k&8)&&Ce(h,"is-condensed",!M[3]),(!m||k&8)&&Ce(h,"is-expanded",M[3])},i(M){if(!m){for(let k=0;k<b.length;k+=1)V(E[k]);m=!0}},o(M){E=E.filter(Boolean);for(let k=0;k<E.length;k+=1)K(E[k]);m=!1},d(M){M&&$(e),I.d(),nt(E,M),g=!1,p()}}}function _u(t,e,n){let{documentNodes:i}=e,{selectedRegions:r}=e,{toggleRegion:s}=e,o=!0;const l=()=>n(3,o=!o),a=c=>s(parseInt(c));return t.$$set=c=>{"documentNodes"in c&&n(0,i=c.documentNodes),"selectedRegions"in c&&n(1,r=c.selectedRegions),"toggleRegion"in c&&n(2,s=c.toggleRegion)},[i,r,s,o,l,a]}class vu extends ve{constructor(e){super(),_e(this,e,_u,gu,me,{documentNodes:0,selectedRegions:1,toggleRegion:2})}}const yu=t=>({}),Us=t=>({});function Bs(t,e,n){const i=t.slice();return i[23]=e[n],i}function qs(t,e,n){const i=t.slice();return i[26]=e[n],i}function Ks(t,e,n){const i=t.slice();i[29]=e[n];const r=Object.keys(i[13][i[29]]||{});return i[30]=r,i}function Ws(t){var Tn;let e,n,i,r=((Tn=t[0])==null?void 0:Tn.title)+"",s,o,l,a,c,u,d,f,h,m=(t[3].pairs||0)+"",g,p,_,w,I,b,E,T=(t[3].images||0)+"",M,k,x,O,D,q,R,C=(t[4]||0)+"",L,A,H,U,F,Y,Z,ne,fe,ee,ce,Ee,Me,ye,Ve,Nt,Re,je,at,Pe,xe,Tt=["Series","Witness","Work"],yt=[];for(let re=0;re<3;re+=1)yt[re]=Gs(Ks(t,Tt,re));F=new vu({props:{documentNodes:t[5],selectedRegions:t[6],toggleRegion:t[11]}});let ni=["all","filtered"],dt=[];for(let re=0;re<2;re+=1)dt[re]=Ys(qs(t,ni,re));let Ot=t[14],Le=[];for(let re=0;re<Ot.length;re+=1)Le[re]=Xs(Bs(t,Ot,re));const un=re=>K(Le[re],1,1,()=>{Le[re]=null}),Oe=t[20].datavizInfo,Ze=bt(Oe,t,t[19],Us);return{c(){e=S("div"),n=S("div"),i=S("h1"),s=te(r),o=B(),l=S("div");for(let re=0;re<3;re+=1)yt[re].c();a=B(),c=S("div"),u=S("div"),d=S("p"),d.textContent=`${W==="en"?"Pairs":"Paires"}`,f=B(),h=S("p"),g=te(m),p=B(),_=S("div"),w=S("div"),I=S("p"),I.textContent="Images",b=B(),E=S("p"),M=te(T),k=B(),x=S("div"),O=S("div"),D=S("p"),D.textContent="Clusters",q=B(),R=S("p"),L=te(C),A=B(),H=S("hr"),U=B(),le(F.$$.fragment),Y=B(),Z=S("hr"),ne=B(),fe=S("div"),ee=S("h3"),ee.textContent=`${W==="en"?"Similarity categories":"Catégories de similarité"}`,ce=B(),Ee=S("div");for(let re=0;re<2;re+=1)dt[re].c();Me=B(),ye=S("div");for(let re=0;re<Le.length;re+=1)Le[re].c();Ve=B(),Nt=S("hr"),Re=B(),je=S("div"),at=S("h3"),at.textContent=`${W==="en"?"Visualisation information":"Informations sur la visualisation"}`,Pe=B(),Ze&&Ze.c(),v(i,"class","title"),v(d,"class","heading"),v(h,"class","title is-5"),v(c,"class","level-item has-text-centered"),v(I,"class","heading"),v(E,"class","title is-5"),v(_,"class","level-item has-text-centered"),v(D,"class","heading"),v(R,"class","title is-5"),v(x,"class","level-item has-text-centered"),v(l,"class","level"),v(n,"class","pb-2"),v(ee,"class","title"),v(Ee,"class","buttons mb-3"),v(ye,"class","level"),Ce(ye,"is-disabled",t[1]==="all"),v(fe,"class","pt-2"),v(at,"class","title"),v(je,"class","py-2"),v(e,"class","content is-small mt-4")},m(re,Ae){z(re,e,Ae),y(e,n),y(n,i),y(i,s),y(n,o),y(n,l);for(let He=0;He<3;He+=1)yt[He]&&yt[He].m(l,null);y(l,a),y(l,c),y(c,u),y(u,d),y(u,f),y(u,h),y(h,g),y(l,p),y(l,_),y(_,w),y(w,I),y(w,b),y(w,E),y(E,M),y(l,k),y(l,x),y(x,O),y(O,D),y(O,q),y(O,R),y(R,L),y(e,A),y(e,H),y(e,U),se(F,e,null),y(e,Y),y(e,Z),y(e,ne),y(e,fe),y(fe,ee),y(fe,ce),y(fe,Ee);for(let He=0;He<2;He+=1)dt[He]&&dt[He].m(Ee,null);y(fe,Me),y(fe,ye);for(let He=0;He<Le.length;He+=1)Le[He]&&Le[He].m(ye,null);y(e,Ve),y(e,Nt),y(e,Re),y(e,je),y(je,at),y(je,Pe),Ze&&Ze.m(je,null),xe=!0},p(re,Ae){var On;if((!xe||Ae[0]&1)&&r!==(r=((On=re[0])==null?void 0:On.title)+"")&&pe(s,r),Ae[0]&8192){Tt=["Series","Witness","Work"];let ue;for(ue=0;ue<3;ue+=1){const mt=Ks(re,Tt,ue);yt[ue]?yt[ue].p(mt,Ae):(yt[ue]=Gs(mt),yt[ue].c(),yt[ue].m(l,a))}for(;ue<3;ue+=1)yt[ue].d(1)}(!xe||Ae[0]&8)&&m!==(m=(re[3].pairs||0)+"")&&pe(g,m),(!xe||Ae[0]&8)&&T!==(T=(re[3].images||0)+"")&&pe(M,T),(!xe||Ae[0]&16)&&C!==(C=(re[4]||0)+"")&&pe(L,C);const He={};if(Ae[0]&32&&(He.documentNodes=re[5]),Ae[0]&64&&(He.selectedRegions=re[6]),F.$set(He),Ae[0]&65538){ni=["all","filtered"];let ue;for(ue=0;ue<2;ue+=1){const mt=qs(re,ni,ue);dt[ue]?dt[ue].p(mt,Ae):(dt[ue]=Ys(mt),dt[ue].c(),dt[ue].m(Ee,null))}for(;ue<2;ue+=1)dt[ue].d(1)}if(Ae[0]&49166){Ot=re[14];let ue;for(ue=0;ue<Ot.length;ue+=1){const mt=Bs(re,Ot,ue);Le[ue]?(Le[ue].p(mt,Ae),V(Le[ue],1)):(Le[ue]=Xs(mt),Le[ue].c(),V(Le[ue],1),Le[ue].m(ye,null))}for(Se(),ue=Ot.length;ue<Le.length;ue+=1)un(ue);ke()}(!xe||Ae[0]&2)&&Ce(ye,"is-disabled",re[1]==="all"),Ze&&Ze.p&&(!xe||Ae[0]&524288)&&St(Ze,Oe,re,re[19],xe?wt(Oe,re[19],Ae,yu):kt(re[19]),Us)},i(re){if(!xe){V(F.$$.fragment,re);for(let Ae=0;Ae<Ot.length;Ae+=1)V(Le[Ae]);V(Ze,re),xe=!0}},o(re){K(F.$$.fragment,re),Le=Le.filter(Boolean);for(let Ae=0;Ae<Le.length;Ae+=1)K(Le[Ae]);K(Ze,re),xe=!1},d(re){re&&$(e),nt(yt,re),oe(F),nt(dt,re),nt(Le,re),Ze&&Ze.d(re)}}}function bu(t){let e,n,i,r=Rc[t[29]]+"",s,o,l,a=(t[30].length||0)+"",c;return{c(){e=S("div"),n=S("div"),i=S("p"),s=te(r),o=B(),l=S("p"),c=te(a),v(i,"class","heading"),v(l,"class","title is-5"),v(e,"class","level-item has-text-centered")},m(u,d){z(u,e,d),y(e,n),y(n,i),y(i,s),y(n,o),y(n,l),y(l,c)},p:X,d(u){u&&$(e)}}}function Gs(t){let e,n=t[30].length>0&&bu(t);return{c(){n&&n.c(),e=Ke()},m(i,r){n&&n.m(i,r),z(i,e,r)},p(i,r){i[30].length>0&&n.p(i,r)},d(i){n&&n.d(i),i&&$(e)}}}function Ys(t){let e,n=t[26]==="all"?W==="en"?"All pairs":"Toutes les paires":W==="en"?"Filter by category":"Filtrer par catégorie",i,r,s,o;function l(){return t[21](t[26])}return{c(){e=S("button"),i=te(n),r=B(),v(e,"class","button is-small is-flex-grow-1"),Ce(e,"is-link",t[1]===t[26]),Ce(e,"is-contrasted",t[1]!==t[26])},m(a,c){z(a,e,c),y(e,i),y(e,r),s||(o=be(e,"click",l),s=!0)},p(a,c){t=a,c[0]&2&&Ce(e,"is-link",t[1]===t[26]),c[0]&2&&Ce(e,"is-contrasted",t[1]!==t[26])},d(a){a&&$(e),s=!1,o()}}}function Xs(t){let e,n,i,r,s,o=(t[3].categories[t[23]]||0)+"",l,a,c;return i=new wn({props:{category:t[23],isSelected:t[2].includes(t[23]),toggle:t[15],selectable:t[1]==="filtered"}}),{c(){e=S("div"),n=S("div"),le(i.$$.fragment),r=B(),s=S("p"),l=te(o),a=B(),v(s,"class","is-size-7 mt-1"),v(e,"class","level-item has-text-centered")},m(u,d){z(u,e,d),y(e,n),se(i,n,null),y(n,r),y(n,s),y(s,l),y(e,a),c=!0},p(u,d){const f={};d[0]&4&&(f.isSelected=u[2].includes(u[23])),d[0]&2&&(f.selectable=u[1]==="filtered"),i.$set(f),(!c||d[0]&8)&&o!==(o=(u[3].categories[u[23]]||0)+"")&&pe(l,o)},i(u){c||(V(i.$$.fragment,u),c=!0)},o(u){K(i.$$.fragment,u),c=!1},d(u){u&&$(e),oe(i)}}}function wu(t){let e,n,i=t[3]&&Ws(t);return{c(){e=S("div"),i&&i.c(),v(e,"class","m-4 py-5 px-4")},m(r,s){z(r,e,s),i&&i.m(e,null),n=!0},p(r,s){r[3]?i?(i.p(r,s),s[0]&8&&V(i,1)):(i=Ws(r),i.c(),V(i,1),i.m(e,null)):i&&(Se(),K(i,1,1,()=>{i=null}),ke())},i(r){n||(V(i),n=!0)},o(r){K(i),n=!1},d(r){r&&$(e),i&&i.d()}}}function Su(t,e,n){let i,r,s,o,l,{$$slots:a={},$$scope:c}=e,{docSet:u=null}=e,{documentSetStore:d}=e,{clusterStore:f}=e;const{docSetNumber:h,documentNodes:m,selectedCategories:g,toggleCategory:p,selectedRegions:_,toggleRegion:w}=d;ge(t,h,O=>n(3,r=O)),ge(t,m,O=>n(5,o=O)),ge(t,g,O=>n(2,i=O)),ge(t,_,O=>n(6,l=O));const{clusterNb:I}=f;ge(t,I,O=>n(4,s=O));const b=gt("selectedDocuments"),E=[0,1,2,3,5];let T="all";function M(O){T==="filtered"&&p(O)}function k(O){n(1,T=O),O==="all"&&i.length!==E.length&&g.set(E)}const x=O=>k(O);return t.$$set=O=>{"docSet"in O&&n(0,u=O.docSet),"documentSetStore"in O&&n(17,d=O.documentSetStore),"clusterStore"in O&&n(18,f=O.clusterStore),"$$scope"in O&&n(19,c=O.$$scope)},t.$$.update=()=>{t.$$.dirty[0]&6&&T==="all"&&i.length!==E.length&&g.set(E)},[u,T,i,r,s,o,l,h,m,g,_,w,I,b,E,M,k,d,f,c,a,x]}class ku extends ve{constructor(e){super(),_e(this,e,Su,wu,me,{docSet:0,documentSetStore:17,clusterStore:18},null,[-1,-1])}}function pi(t,e){return t==null||e==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function Eu(t,e){return t==null||e==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function Js(t){let e,n,i;t.length!==2?(e=pi,n=(l,a)=>pi(t(l),a),i=(l,a)=>t(l)-a):(e=t===pi||t===Eu?t:Cu,n=t,i=t);function r(l,a,c=0,u=l.length){if(c<u){if(e(a,a)!==0)return u;do{const d=c+u>>>1;n(l[d],a)<0?c=d+1:u=d}while(c<u)}return c}function s(l,a,c=0,u=l.length){if(c<u){if(e(a,a)!==0)return u;do{const d=c+u>>>1;n(l[d],a)<=0?c=d+1:u=d}while(c<u)}return c}function o(l,a,c=0,u=l.length){const d=r(l,a,c,u-1);return d>c&&i(l[d-1],a)>-i(l[d],a)?d-1:d}return{left:r,center:o,right:s}}function Cu(){return 0}function Iu(t){return t===null?NaN:+t}const Mu=Js(pi).right;Js(Iu).center;const xu=Mu,Au=Math.sqrt(50),Nu=Math.sqrt(10),Tu=Math.sqrt(2);function gi(t,e,n){const i=(e-t)/Math.max(0,n),r=Math.floor(Math.log10(i)),s=i/Math.pow(10,r),o=s>=Au?10:s>=Nu?5:s>=Tu?2:1;let l,a,c;return r<0?(c=Math.pow(10,-r)/o,l=Math.round(t*c),a=Math.round(e*c),l/c<t&&++l,a/c>e&&--a,c=-c):(c=Math.pow(10,r)*o,l=Math.round(t/c),a=Math.round(e/c),l*c<t&&++l,a*c>e&&--a),a<l&&.5<=n&&n<2?gi(t,e,n*2):[l,a,c]}function Ou(t,e,n){if(e=+e,t=+t,n=+n,!(n>0))return[];if(t===e)return[t];const i=e<t,[r,s,o]=i?gi(e,t,n):gi(t,e,n);if(!(s>=r))return[];const l=s-r+1,a=new Array(l);if(i)if(o<0)for(let c=0;c<l;++c)a[c]=(s-c)/-o;else for(let c=0;c<l;++c)a[c]=(s-c)*o;else if(o<0)for(let c=0;c<l;++c)a[c]=(r+c)/-o;else for(let c=0;c<l;++c)a[c]=(r+c)*o;return a}function dr(t,e,n){return e=+e,t=+t,n=+n,gi(t,e,n)[2]}function Pu(t,e,n){e=+e,t=+t,n=+n;const i=e<t,r=i?dr(e,t,n):dr(t,e,n);return(i?-1:1)*(r<0?1/-r:r)}function Lu(t){return t}var mr=1,pr=2,gr=3,zn=4,Qs=1e-6;function Du(t){return"translate("+t+",0)"}function Ru(t){return"translate(0,"+t+")"}function $u(t){return e=>+t(e)}function zu(t,e){return e=Math.max(0,t.bandwidth()-e*2)/2,t.round()&&(e=Math.round(e)),n=>+t(n)+e}function ju(){return!this.__axis}function Zs(t,e){var n=[],i=null,r=null,s=6,o=6,l=3,a=typeof window<"u"&&window.devicePixelRatio>1?0:.5,c=t===mr||t===zn?-1:1,u=t===zn||t===pr?"x":"y",d=t===mr||t===gr?Du:Ru;function f(h){var m=i??(e.ticks?e.ticks.apply(e,n):e.domain()),g=r??(e.tickFormat?e.tickFormat.apply(e,n):Lu),p=Math.max(s,0)+l,_=e.range(),w=+_[0]+a,I=+_[_.length-1]+a,b=(e.bandwidth?zu:$u)(e.copy(),a),E=h.selection?h.selection():h,T=E.selectAll(".domain").data([null]),M=E.selectAll(".tick").data(m,e).order(),k=M.exit(),x=M.enter().append("g").attr("class","tick"),O=M.select("line"),D=M.select("text");T=T.merge(T.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),M=M.merge(x),O=O.merge(x.append("line").attr("stroke","currentColor").attr(u+"2",c*s)),D=D.merge(x.append("text").attr("fill","currentColor").attr(u,c*p).attr("dy",t===mr?"0em":t===gr?"0.71em":"0.32em")),h!==E&&(T=T.transition(h),M=M.transition(h),O=O.transition(h),D=D.transition(h),k=k.transition(h).attr("opacity",Qs).attr("transform",function(q){return isFinite(q=b(q))?d(q+a):this.getAttribute("transform")}),x.attr("opacity",Qs).attr("transform",function(q){var R=this.parentNode.__axis;return d((R&&isFinite(R=R(q))?R:b(q))+a)})),k.remove(),T.attr("d",t===zn||t===pr?o?"M"+c*o+","+w+"H"+a+"V"+I+"H"+c*o:"M"+a+","+w+"V"+I:o?"M"+w+","+c*o+"V"+a+"H"+I+"V"+c*o:"M"+w+","+a+"H"+I),M.attr("opacity",1).attr("transform",function(q){return d(b(q)+a)}),O.attr(u+"2",c*s),D.attr(u,c*p).text(g),E.filter(ju).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",t===pr?"start":t===zn?"end":"middle"),E.each(function(){this.__axis=b})}return f.scale=function(h){return arguments.length?(e=h,f):e},f.ticks=function(){return n=Array.from(arguments),f},f.tickArguments=function(h){return arguments.length?(n=h==null?[]:Array.from(h),f):n.slice()},f.tickValues=function(h){return arguments.length?(i=h==null?null:Array.from(h),f):i&&i.slice()},f.tickFormat=function(h){return arguments.length?(r=h,f):r},f.tickSize=function(h){return arguments.length?(s=o=+h,f):s},f.tickSizeInner=function(h){return arguments.length?(s=+h,f):s},f.tickSizeOuter=function(h){return arguments.length?(o=+h,f):o},f.tickPadding=function(h){return arguments.length?(l=+h,f):l},f.offset=function(h){return arguments.length?(a=+h,f):a},f}function Fu(t){return Zs(gr,t)}function Vu(t){return Zs(zn,t)}var Hu={value:()=>{}};function jn(){for(var t=0,e=arguments.length,n={},i;t<e;++t){if(!(i=arguments[t]+"")||i in n||/[\s.]/.test(i))throw new Error("illegal type: "+i);n[i]=[]}return new _i(n)}function _i(t){this._=t}function Uu(t,e){return t.trim().split(/^|\s+/).map(function(n){var i="",r=n.indexOf(".");if(r>=0&&(i=n.slice(r+1),n=n.slice(0,r)),n&&!e.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:i}})}_i.prototype=jn.prototype={constructor:_i,on:function(t,e){var n=this._,i=Uu(t+"",n),r,s=-1,o=i.length;if(arguments.length<2){for(;++s<o;)if((r=(t=i[s]).type)&&(r=Bu(n[r],t.name)))return r;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++s<o;)if(r=(t=i[s]).type)n[r]=eo(n[r],t.name,e);else if(e==null)for(r in n)n[r]=eo(n[r],t.name,null);return this},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new _i(t)},call:function(t,e){if((r=arguments.length-2)>0)for(var n=new Array(r),i=0,r,s;i<r;++i)n[i]=arguments[i+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(s=this._[t],i=0,r=s.length;i<r;++i)s[i].value.apply(e,n)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var i=this._[t],r=0,s=i.length;r<s;++r)i[r].value.apply(e,n)}};function Bu(t,e){for(var n=0,i=t.length,r;n<i;++n)if((r=t[n]).name===e)return r.value}function eo(t,e,n){for(var i=0,r=t.length;i<r;++i)if(t[i].name===e){t[i]=Hu,t=t.slice(0,i).concat(t.slice(i+1));break}return n!=null&&t.push({name:e,value:n}),t}var _r="http://www.w3.org/1999/xhtml";const to={svg:"http://www.w3.org/2000/svg",xhtml:_r,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function vi(t){var e=t+="",n=e.indexOf(":");return n>=0&&(e=t.slice(0,n))!=="xmlns"&&(t=t.slice(n+1)),to.hasOwnProperty(e)?{space:to[e],local:t}:t}function qu(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===_r&&e.documentElement.namespaceURI===_r?e.createElement(t):e.createElementNS(n,t)}}function Ku(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function no(t){var e=vi(t);return(e.local?Ku:qu)(e)}function Wu(){}function vr(t){return t==null?Wu:function(){return this.querySelector(t)}}function Gu(t){typeof t!="function"&&(t=vr(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var s=e[r],o=s.length,l=i[r]=new Array(o),a,c,u=0;u<o;++u)(a=s[u])&&(c=t.call(a,a.__data__,u,s))&&("__data__"in a&&(c.__data__=a.__data__),l[u]=c);return new _t(i,this._parents)}function Yu(t){return t==null?[]:Array.isArray(t)?t:Array.from(t)}function Xu(){return[]}function io(t){return t==null?Xu:function(){return this.querySelectorAll(t)}}function Ju(t){return function(){return Yu(t.apply(this,arguments))}}function Qu(t){typeof t=="function"?t=Ju(t):t=io(t);for(var e=this._groups,n=e.length,i=[],r=[],s=0;s<n;++s)for(var o=e[s],l=o.length,a,c=0;c<l;++c)(a=o[c])&&(i.push(t.call(a,a.__data__,c,o)),r.push(a));return new _t(i,r)}function ro(t){return function(){return this.matches(t)}}function so(t){return function(e){return e.matches(t)}}var Zu=Array.prototype.find;function ef(t){return function(){return Zu.call(this.children,t)}}function tf(){return this.firstElementChild}function nf(t){return this.select(t==null?tf:ef(typeof t=="function"?t:so(t)))}var rf=Array.prototype.filter;function sf(){return Array.from(this.children)}function of(t){return function(){return rf.call(this.children,t)}}function lf(t){return this.selectAll(t==null?sf:of(typeof t=="function"?t:so(t)))}function af(t){typeof t!="function"&&(t=ro(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var s=e[r],o=s.length,l=i[r]=[],a,c=0;c<o;++c)(a=s[c])&&t.call(a,a.__data__,c,s)&&l.push(a);return new _t(i,this._parents)}function oo(t){return new Array(t.length)}function cf(){return new _t(this._enter||this._groups.map(oo),this._parents)}function yi(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}yi.prototype={constructor:yi,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function uf(t){return function(){return t}}function ff(t,e,n,i,r,s){for(var o=0,l,a=e.length,c=s.length;o<c;++o)(l=e[o])?(l.__data__=s[o],i[o]=l):n[o]=new yi(t,s[o]);for(;o<a;++o)(l=e[o])&&(r[o]=l)}function hf(t,e,n,i,r,s,o){var l,a,c=new Map,u=e.length,d=s.length,f=new Array(u),h;for(l=0;l<u;++l)(a=e[l])&&(f[l]=h=o.call(a,a.__data__,l,e)+"",c.has(h)?r[l]=a:c.set(h,a));for(l=0;l<d;++l)h=o.call(t,s[l],l,s)+"",(a=c.get(h))?(i[l]=a,a.__data__=s[l],c.delete(h)):n[l]=new yi(t,s[l]);for(l=0;l<u;++l)(a=e[l])&&c.get(f[l])===a&&(r[l]=a)}function df(t){return t.__data__}function mf(t,e){if(!arguments.length)return Array.from(this,df);var n=e?hf:ff,i=this._parents,r=this._groups;typeof t!="function"&&(t=uf(t));for(var s=r.length,o=new Array(s),l=new Array(s),a=new Array(s),c=0;c<s;++c){var u=i[c],d=r[c],f=d.length,h=pf(t.call(u,u&&u.__data__,c,i)),m=h.length,g=l[c]=new Array(m),p=o[c]=new Array(m),_=a[c]=new Array(f);n(u,d,g,p,_,h,e);for(var w=0,I=0,b,E;w<m;++w)if(b=g[w]){for(w>=I&&(I=w+1);!(E=p[I])&&++I<m;);b._next=E||null}}return o=new _t(o,i),o._enter=l,o._exit=a,o}function pf(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function gf(){return new _t(this._exit||this._groups.map(oo),this._parents)}function _f(t,e,n){var i=this.enter(),r=this,s=this.exit();return typeof t=="function"?(i=t(i),i&&(i=i.selection())):i=i.append(t+""),e!=null&&(r=e(r),r&&(r=r.selection())),n==null?s.remove():n(s),i&&r?i.merge(r).order():r}function vf(t){for(var e=t.selection?t.selection():t,n=this._groups,i=e._groups,r=n.length,s=i.length,o=Math.min(r,s),l=new Array(r),a=0;a<o;++a)for(var c=n[a],u=i[a],d=c.length,f=l[a]=new Array(d),h,m=0;m<d;++m)(h=c[m]||u[m])&&(f[m]=h);for(;a<r;++a)l[a]=n[a];return new _t(l,this._parents)}function yf(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var i=t[e],r=i.length-1,s=i[r],o;--r>=0;)(o=i[r])&&(s&&o.compareDocumentPosition(s)^4&&s.parentNode.insertBefore(o,s),s=o);return this}function bf(t){t||(t=wf);function e(d,f){return d&&f?t(d.__data__,f.__data__):!d-!f}for(var n=this._groups,i=n.length,r=new Array(i),s=0;s<i;++s){for(var o=n[s],l=o.length,a=r[s]=new Array(l),c,u=0;u<l;++u)(c=o[u])&&(a[u]=c);a.sort(e)}return new _t(r,this._parents).order()}function wf(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function Sf(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function kf(){return Array.from(this)}function Ef(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var i=t[e],r=0,s=i.length;r<s;++r){var o=i[r];if(o)return o}return null}function Cf(){let t=0;for(const e of this)++t;return t}function If(){return!this.node()}function Mf(t){for(var e=this._groups,n=0,i=e.length;n<i;++n)for(var r=e[n],s=0,o=r.length,l;s<o;++s)(l=r[s])&&t.call(l,l.__data__,s,r);return this}function xf(t){return function(){this.removeAttribute(t)}}function Af(t){return function(){this.removeAttributeNS(t.space,t.local)}}function Nf(t,e){return function(){this.setAttribute(t,e)}}function Tf(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function Of(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttribute(t):this.setAttribute(t,n)}}function Pf(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function Lf(t,e){var n=vi(t);if(arguments.length<2){var i=this.node();return n.local?i.getAttributeNS(n.space,n.local):i.getAttribute(n)}return this.each((e==null?n.local?Af:xf:typeof e=="function"?n.local?Pf:Of:n.local?Tf:Nf)(n,e))}function lo(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function Df(t){return function(){this.style.removeProperty(t)}}function Rf(t,e,n){return function(){this.style.setProperty(t,e,n)}}function $f(t,e,n){return function(){var i=e.apply(this,arguments);i==null?this.style.removeProperty(t):this.style.setProperty(t,i,n)}}function zf(t,e,n){return arguments.length>1?this.each((e==null?Df:typeof e=="function"?$f:Rf)(t,e,n??"")):Sn(this.node(),t)}function Sn(t,e){return t.style.getPropertyValue(e)||lo(t).getComputedStyle(t,null).getPropertyValue(e)}function jf(t){return function(){delete this[t]}}function Ff(t,e){return function(){this[t]=e}}function Vf(t,e){return function(){var n=e.apply(this,arguments);n==null?delete this[t]:this[t]=n}}function Hf(t,e){return arguments.length>1?this.each((e==null?jf:typeof e=="function"?Vf:Ff)(t,e)):this.node()[t]}function ao(t){return t.trim().split(/^|\s+/)}function yr(t){return t.classList||new co(t)}function co(t){this._node=t,this._names=ao(t.getAttribute("class")||"")}co.prototype={add:function(t){var e=this._names.indexOf(t);e<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function uo(t,e){for(var n=yr(t),i=-1,r=e.length;++i<r;)n.add(e[i])}function fo(t,e){for(var n=yr(t),i=-1,r=e.length;++i<r;)n.remove(e[i])}function Uf(t){return function(){uo(this,t)}}function Bf(t){return function(){fo(this,t)}}function qf(t,e){return function(){(e.apply(this,arguments)?uo:fo)(this,t)}}function Kf(t,e){var n=ao(t+"");if(arguments.length<2){for(var i=yr(this.node()),r=-1,s=n.length;++r<s;)if(!i.contains(n[r]))return!1;return!0}return this.each((typeof e=="function"?qf:e?Uf:Bf)(n,e))}function Wf(){this.textContent=""}function Gf(t){return function(){this.textContent=t}}function Yf(t){return function(){var e=t.apply(this,arguments);this.textContent=e??""}}function Xf(t){return arguments.length?this.each(t==null?Wf:(typeof t=="function"?Yf:Gf)(t)):this.node().textContent}function Jf(){this.innerHTML=""}function Qf(t){return function(){this.innerHTML=t}}function Zf(t){return function(){var e=t.apply(this,arguments);this.innerHTML=e??""}}function eh(t){return arguments.length?this.each(t==null?Jf:(typeof t=="function"?Zf:Qf)(t)):this.node().innerHTML}function th(){this.nextSibling&&this.parentNode.appendChild(this)}function nh(){return this.each(th)}function ih(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function rh(){return this.each(ih)}function sh(t){var e=typeof t=="function"?t:no(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function oh(){return null}function lh(t,e){var n=typeof t=="function"?t:no(t),i=e==null?oh:typeof e=="function"?e:vr(e);return this.select(function(){return this.insertBefore(n.apply(this,arguments),i.apply(this,arguments)||null)})}function ah(){var t=this.parentNode;t&&t.removeChild(this)}function ch(){return this.each(ah)}function uh(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function fh(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function hh(t){return this.select(t?fh:uh)}function dh(t){return arguments.length?this.property("__data__",t):this.node().__data__}function mh(t){return function(e){t.call(this,e,this.__data__)}}function ph(t){return t.trim().split(/^|\s+/).map(function(e){var n="",i=e.indexOf(".");return i>=0&&(n=e.slice(i+1),e=e.slice(0,i)),{type:e,name:n}})}function gh(t){return function(){var e=this.__on;if(e){for(var n=0,i=-1,r=e.length,s;n<r;++n)s=e[n],(!t.type||s.type===t.type)&&s.name===t.name?this.removeEventListener(s.type,s.listener,s.options):e[++i]=s;++i?e.length=i:delete this.__on}}}function _h(t,e,n){return function(){var i=this.__on,r,s=mh(e);if(i){for(var o=0,l=i.length;o<l;++o)if((r=i[o]).type===t.type&&r.name===t.name){this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=s,r.options=n),r.value=e;return}}this.addEventListener(t.type,s,n),r={type:t.type,name:t.name,value:e,listener:s,options:n},i?i.push(r):this.__on=[r]}}function vh(t,e,n){var i=ph(t+""),r,s=i.length,o;if(arguments.length<2){var l=this.node().__on;if(l){for(var a=0,c=l.length,u;a<c;++a)for(r=0,u=l[a];r<s;++r)if((o=i[r]).type===u.type&&o.name===u.name)return u.value}return}for(l=e?_h:gh,r=0;r<s;++r)this.each(l(i[r],e,n));return this}function ho(t,e,n){var i=lo(t),r=i.CustomEvent;typeof r=="function"?r=new r(e,n):(r=i.document.createEvent("Event"),n?(r.initEvent(e,n.bubbles,n.cancelable),r.detail=n.detail):r.initEvent(e,!1,!1)),t.dispatchEvent(r)}function yh(t,e){return function(){return ho(this,t,e)}}function bh(t,e){return function(){return ho(this,t,e.apply(this,arguments))}}function wh(t,e){return this.each((typeof e=="function"?bh:yh)(t,e))}function*Sh(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var i=t[e],r=0,s=i.length,o;r<s;++r)(o=i[r])&&(yield o)}var mo=[null];function _t(t,e){this._groups=t,this._parents=e}function Fn(){return new _t([[document.documentElement]],mo)}function kh(){return this}_t.prototype=Fn.prototype={constructor:_t,select:Gu,selectAll:Qu,selectChild:nf,selectChildren:lf,filter:af,data:mf,enter:cf,exit:gf,join:_f,merge:vf,selection:kh,order:yf,sort:bf,call:Sf,nodes:kf,node:Ef,size:Cf,empty:If,each:Mf,attr:Lf,style:zf,property:Hf,classed:Kf,text:Xf,html:eh,raise:nh,lower:rh,append:sh,insert:lh,remove:ch,clone:hh,datum:dh,on:vh,dispatch:wh,[Symbol.iterator]:Sh};function Xe(t){return typeof t=="string"?new _t([[document.querySelector(t)]],[document.documentElement]):new _t([[t]],mo)}function Eh(t){let e;for(;e=t.sourceEvent;)t=e;return t}function it(t,e){if(t=Eh(t),e===void 0&&(e=t.currentTarget),e){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var i=n.createSVGPoint();return i.x=t.clientX,i.y=t.clientY,i=i.matrixTransform(e.getScreenCTM().inverse()),[i.x,i.y]}if(e.getBoundingClientRect){var r=e.getBoundingClientRect();return[t.clientX-r.left-e.clientLeft,t.clientY-r.top-e.clientTop]}}return[t.pageX,t.pageY]}const Ch={passive:!1},Vn={capture:!0,passive:!1};function br(t){t.stopImmediatePropagation()}function kn(t){t.preventDefault(),t.stopImmediatePropagation()}function po(t){var e=t.document.documentElement,n=Xe(t).on("dragstart.drag",kn,Vn);"onselectstart"in e?n.on("selectstart.drag",kn,Vn):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function go(t,e){var n=t.document.documentElement,i=Xe(t).on("dragstart.drag",null);e&&(i.on("click.drag",kn,Vn),setTimeout(function(){i.on("click.drag",null)},0)),"onselectstart"in n?i.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}const bi=t=>()=>t;function wr(t,{sourceEvent:e,subject:n,target:i,identifier:r,active:s,x:o,y:l,dx:a,dy:c,dispatch:u}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},subject:{value:n,enumerable:!0,configurable:!0},target:{value:i,enumerable:!0,configurable:!0},identifier:{value:r,enumerable:!0,configurable:!0},active:{value:s,enumerable:!0,configurable:!0},x:{value:o,enumerable:!0,configurable:!0},y:{value:l,enumerable:!0,configurable:!0},dx:{value:a,enumerable:!0,configurable:!0},dy:{value:c,enumerable:!0,configurable:!0},_:{value:u}})}wr.prototype.on=function(){var t=this._.on.apply(this._,arguments);return t===this._?this:t};function Ih(t){return!t.ctrlKey&&!t.button}function Mh(){return this.parentNode}function xh(t,e){return e??{x:t.x,y:t.y}}function Ah(){return navigator.maxTouchPoints||"ontouchstart"in this}function Nh(){var t=Ih,e=Mh,n=xh,i=Ah,r={},s=jn("start","drag","end"),o=0,l,a,c,u,d=0;function f(b){b.on("mousedown.drag",h).filter(i).on("touchstart.drag",p).on("touchmove.drag",_,Ch).on("touchend.drag touchcancel.drag",w).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function h(b,E){if(!(u||!t.call(this,b,E))){var T=I(this,e.call(this,b,E),b,E,"mouse");T&&(Xe(b.view).on("mousemove.drag",m,Vn).on("mouseup.drag",g,Vn),po(b.view),br(b),c=!1,l=b.clientX,a=b.clientY,T("start",b))}}function m(b){if(kn(b),!c){var E=b.clientX-l,T=b.clientY-a;c=E*E+T*T>d}r.mouse("drag",b)}function g(b){Xe(b.view).on("mousemove.drag mouseup.drag",null),go(b.view,c),kn(b),r.mouse("end",b)}function p(b,E){if(t.call(this,b,E)){var T=b.changedTouches,M=e.call(this,b,E),k=T.length,x,O;for(x=0;x<k;++x)(O=I(this,M,b,E,T[x].identifier,T[x]))&&(br(b),O("start",b,T[x]))}}function _(b){var E=b.changedTouches,T=E.length,M,k;for(M=0;M<T;++M)(k=r[E[M].identifier])&&(kn(b),k("drag",b,E[M]))}function w(b){var E=b.changedTouches,T=E.length,M,k;for(u&&clearTimeout(u),u=setTimeout(function(){u=null},500),M=0;M<T;++M)(k=r[E[M].identifier])&&(br(b),k("end",b,E[M]))}function I(b,E,T,M,k,x){var O=s.copy(),D=it(x||T,E),q,R,C;if((C=n.call(b,new wr("beforestart",{sourceEvent:T,target:f,identifier:k,active:o,x:D[0],y:D[1],dx:0,dy:0,dispatch:O}),M))!=null)return q=C.x-D[0]||0,R=C.y-D[1]||0,function L(A,H,U){var F=D,Y;switch(A){case"start":r[k]=L,Y=o++;break;case"end":delete r[k],--o;case"drag":D=it(U||H,E),Y=o;break}O.call(A,b,new wr(A,{sourceEvent:H,subject:C,target:f,identifier:k,active:Y,x:D[0]+q,y:D[1]+R,dx:D[0]-F[0],dy:D[1]-F[1],dispatch:O}),M)}}return f.filter=function(b){return arguments.length?(t=typeof b=="function"?b:bi(!!b),f):t},f.container=function(b){return arguments.length?(e=typeof b=="function"?b:bi(b),f):e},f.subject=function(b){return arguments.length?(n=typeof b=="function"?b:bi(b),f):n},f.touchable=function(b){return arguments.length?(i=typeof b=="function"?b:bi(!!b),f):i},f.on=function(){var b=s.on.apply(s,arguments);return b===s?f:b},f.clickDistance=function(b){return arguments.length?(d=(b=+b)*b,f):Math.sqrt(d)},f}function Sr(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function _o(t,e){var n=Object.create(t.prototype);for(var i in e)n[i]=e[i];return n}function Hn(){}var Un=.7,wi=1/Un,En="\\s*([+-]?\\d+)\\s*",Bn="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Lt="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Th=/^#([0-9a-f]{3,8})$/,Oh=new RegExp(`^rgb\\(${En},${En},${En}\\)$`),Ph=new RegExp(`^rgb\\(${Lt},${Lt},${Lt}\\)$`),Lh=new RegExp(`^rgba\\(${En},${En},${En},${Bn}\\)$`),Dh=new RegExp(`^rgba\\(${Lt},${Lt},${Lt},${Bn}\\)$`),Rh=new RegExp(`^hsl\\(${Bn},${Lt},${Lt}\\)$`),$h=new RegExp(`^hsla\\(${Bn},${Lt},${Lt},${Bn}\\)$`),vo={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Sr(Hn,rn,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:yo,formatHex:yo,formatHex8:zh,formatHsl:jh,formatRgb:bo,toString:bo});function yo(){return this.rgb().formatHex()}function zh(){return this.rgb().formatHex8()}function jh(){return Co(this).formatHsl()}function bo(){return this.rgb().formatRgb()}function rn(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=Th.exec(t))?(n=e[1].length,e=parseInt(e[1],16),n===6?wo(e):n===3?new ut(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):n===8?Si(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):n===4?Si(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=Oh.exec(t))?new ut(e[1],e[2],e[3],1):(e=Ph.exec(t))?new ut(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=Lh.exec(t))?Si(e[1],e[2],e[3],e[4]):(e=Dh.exec(t))?Si(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=Rh.exec(t))?Eo(e[1],e[2]/100,e[3]/100,1):(e=$h.exec(t))?Eo(e[1],e[2]/100,e[3]/100,e[4]):vo.hasOwnProperty(t)?wo(vo[t]):t==="transparent"?new ut(NaN,NaN,NaN,0):null}function wo(t){return new ut(t>>16&255,t>>8&255,t&255,1)}function Si(t,e,n,i){return i<=0&&(t=e=n=NaN),new ut(t,e,n,i)}function Fh(t){return t instanceof Hn||(t=rn(t)),t?(t=t.rgb(),new ut(t.r,t.g,t.b,t.opacity)):new ut}function kr(t,e,n,i){return arguments.length===1?Fh(t):new ut(t,e,n,i??1)}function ut(t,e,n,i){this.r=+t,this.g=+e,this.b=+n,this.opacity=+i}Sr(ut,kr,_o(Hn,{brighter(t){return t=t==null?wi:Math.pow(wi,t),new ut(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?Un:Math.pow(Un,t),new ut(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new ut(sn(this.r),sn(this.g),sn(this.b),ki(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:So,formatHex:So,formatHex8:Vh,formatRgb:ko,toString:ko}));function So(){return`#${on(this.r)}${on(this.g)}${on(this.b)}`}function Vh(){return`#${on(this.r)}${on(this.g)}${on(this.b)}${on((isNaN(this.opacity)?1:this.opacity)*255)}`}function ko(){const t=ki(this.opacity);return`${t===1?"rgb(":"rgba("}${sn(this.r)}, ${sn(this.g)}, ${sn(this.b)}${t===1?")":`, ${t})`}`}function ki(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function sn(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function on(t){return t=sn(t),(t<16?"0":"")+t.toString(16)}function Eo(t,e,n,i){return i<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new It(t,e,n,i)}function Co(t){if(t instanceof It)return new It(t.h,t.s,t.l,t.opacity);if(t instanceof Hn||(t=rn(t)),!t)return new It;if(t instanceof It)return t;t=t.rgb();var e=t.r/255,n=t.g/255,i=t.b/255,r=Math.min(e,n,i),s=Math.max(e,n,i),o=NaN,l=s-r,a=(s+r)/2;return l?(e===s?o=(n-i)/l+(n<i)*6:n===s?o=(i-e)/l+2:o=(e-n)/l+4,l/=a<.5?s+r:2-s-r,o*=60):l=a>0&&a<1?0:o,new It(o,l,a,t.opacity)}function Er(t,e,n,i){return arguments.length===1?Co(t):new It(t,e,n,i??1)}function It(t,e,n,i){this.h=+t,this.s=+e,this.l=+n,this.opacity=+i}Sr(It,Er,_o(Hn,{brighter(t){return t=t==null?wi:Math.pow(wi,t),new It(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?Un:Math.pow(Un,t),new It(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,i=n+(n<.5?n:1-n)*e,r=2*n-i;return new ut(Cr(t>=240?t-240:t+120,r,i),Cr(t,r,i),Cr(t<120?t+240:t-120,r,i),this.opacity)},clamp(){return new It(Io(this.h),Ei(this.s),Ei(this.l),ki(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=ki(this.opacity);return`${t===1?"hsl(":"hsla("}${Io(this.h)}, ${Ei(this.s)*100}%, ${Ei(this.l)*100}%${t===1?")":`, ${t})`}`}}));function Io(t){return t=(t||0)%360,t<0?t+360:t}function Ei(t){return Math.max(0,Math.min(1,t||0))}function Cr(t,e,n){return(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)*255}const Ir=t=>()=>t;function Hh(t,e){return function(n){return t+n*e}}function Uh(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(i){return Math.pow(t+i*e,n)}}function Bh(t){return(t=+t)==1?Mo:function(e,n){return n-e?Uh(e,n,t):Ir(isNaN(e)?n:e)}}function Mo(t,e){var n=e-t;return n?Hh(t,n):Ir(isNaN(t)?e:t)}const Ci=function t(e){var n=Bh(e);function i(r,s){var o=n((r=kr(r)).r,(s=kr(s)).r),l=n(r.g,s.g),a=n(r.b,s.b),c=Mo(r.opacity,s.opacity);return function(u){return r.r=o(u),r.g=l(u),r.b=a(u),r.opacity=c(u),r+""}}return i.gamma=t,i}(1);function qh(t,e){e||(e=[]);var n=t?Math.min(e.length,t.length):0,i=e.slice(),r;return function(s){for(r=0;r<n;++r)i[r]=t[r]*(1-s)+e[r]*s;return i}}function Kh(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function Wh(t,e){var n=e?e.length:0,i=t?Math.min(n,t.length):0,r=new Array(i),s=new Array(n),o;for(o=0;o<i;++o)r[o]=Ar(t[o],e[o]);for(;o<n;++o)s[o]=e[o];return function(l){for(o=0;o<i;++o)s[o]=r[o](l);return s}}function Gh(t,e){var n=new Date;return t=+t,e=+e,function(i){return n.setTime(t*(1-i)+e*i),n}}function Mt(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}function Yh(t,e){var n={},i={},r;(t===null||typeof t!="object")&&(t={}),(e===null||typeof e!="object")&&(e={});for(r in e)r in t?n[r]=Ar(t[r],e[r]):i[r]=e[r];return function(s){for(r in n)i[r]=n[r](s);return i}}var Mr=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,xr=new RegExp(Mr.source,"g");function Xh(t){return function(){return t}}function Jh(t){return function(e){return t(e)+""}}function xo(t,e){var n=Mr.lastIndex=xr.lastIndex=0,i,r,s,o=-1,l=[],a=[];for(t=t+"",e=e+"";(i=Mr.exec(t))&&(r=xr.exec(e));)(s=r.index)>n&&(s=e.slice(n,s),l[o]?l[o]+=s:l[++o]=s),(i=i[0])===(r=r[0])?l[o]?l[o]+=r:l[++o]=r:(l[++o]=null,a.push({i:o,x:Mt(i,r)})),n=xr.lastIndex;return n<e.length&&(s=e.slice(n),l[o]?l[o]+=s:l[++o]=s),l.length<2?a[0]?Jh(a[0].x):Xh(e):(e=a.length,function(c){for(var u=0,d;u<e;++u)l[(d=a[u]).i]=d.x(c);return l.join("")})}function Ar(t,e){var n=typeof e,i;return e==null||n==="boolean"?Ir(e):(n==="number"?Mt:n==="string"?(i=rn(e))?(e=i,Ci):xo:e instanceof rn?Ci:e instanceof Date?Gh:Kh(e)?qh:Array.isArray(e)?Wh:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?Yh:Mt)(t,e)}function Qh(t,e){return t=+t,e=+e,function(n){return Math.round(t*(1-n)+e*n)}}var Ao=180/Math.PI,Nr={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function No(t,e,n,i,r,s){var o,l,a;return(o=Math.sqrt(t*t+e*e))&&(t/=o,e/=o),(a=t*n+e*i)&&(n-=t*a,i-=e*a),(l=Math.sqrt(n*n+i*i))&&(n/=l,i/=l,a/=l),t*i<e*n&&(t=-t,e=-e,a=-a,o=-o),{translateX:r,translateY:s,rotate:Math.atan2(e,t)*Ao,skewX:Math.atan(a)*Ao,scaleX:o,scaleY:l}}var Ii;function Zh(t){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?Nr:No(e.a,e.b,e.c,e.d,e.e,e.f)}function ed(t){return t==null||(Ii||(Ii=document.createElementNS("http://www.w3.org/2000/svg","g")),Ii.setAttribute("transform",t),!(t=Ii.transform.baseVal.consolidate()))?Nr:(t=t.matrix,No(t.a,t.b,t.c,t.d,t.e,t.f))}function To(t,e,n,i){function r(c){return c.length?c.pop()+" ":""}function s(c,u,d,f,h,m){if(c!==d||u!==f){var g=h.push("translate(",null,e,null,n);m.push({i:g-4,x:Mt(c,d)},{i:g-2,x:Mt(u,f)})}else(d||f)&&h.push("translate("+d+e+f+n)}function o(c,u,d,f){c!==u?(c-u>180?u+=360:u-c>180&&(c+=360),f.push({i:d.push(r(d)+"rotate(",null,i)-2,x:Mt(c,u)})):u&&d.push(r(d)+"rotate("+u+i)}function l(c,u,d,f){c!==u?f.push({i:d.push(r(d)+"skewX(",null,i)-2,x:Mt(c,u)}):u&&d.push(r(d)+"skewX("+u+i)}function a(c,u,d,f,h,m){if(c!==d||u!==f){var g=h.push(r(h)+"scale(",null,",",null,")");m.push({i:g-4,x:Mt(c,d)},{i:g-2,x:Mt(u,f)})}else(d!==1||f!==1)&&h.push(r(h)+"scale("+d+","+f+")")}return function(c,u){var d=[],f=[];return c=t(c),u=t(u),s(c.translateX,c.translateY,u.translateX,u.translateY,d,f),o(c.rotate,u.rotate,d,f),l(c.skewX,u.skewX,d,f),a(c.scaleX,c.scaleY,u.scaleX,u.scaleY,d,f),c=u=null,function(h){for(var m=-1,g=f.length,p;++m<g;)d[(p=f[m]).i]=p.x(h);return d.join("")}}}var td=To(Zh,"px, ","px)","deg)"),nd=To(ed,", ",")",")"),id=1e-12;function Oo(t){return((t=Math.exp(t))+1/t)/2}function rd(t){return((t=Math.exp(t))-1/t)/2}function sd(t){return((t=Math.exp(2*t))-1)/(t+1)}const od=function t(e,n,i){function r(s,o){var l=s[0],a=s[1],c=s[2],u=o[0],d=o[1],f=o[2],h=u-l,m=d-a,g=h*h+m*m,p,_;if(g<id)_=Math.log(f/c)/e,p=function(M){return[l+M*h,a+M*m,c*Math.exp(e*M*_)]};else{var w=Math.sqrt(g),I=(f*f-c*c+i*g)/(2*c*n*w),b=(f*f-c*c-i*g)/(2*f*n*w),E=Math.log(Math.sqrt(I*I+1)-I),T=Math.log(Math.sqrt(b*b+1)-b);_=(T-E)/e,p=function(M){var k=M*_,x=Oo(E),O=c/(n*w)*(x*sd(e*k+E)-rd(E));return[l+O*h,a+O*m,c*x/Oo(e*k+E)]}}return p.duration=_*1e3*e/Math.SQRT2,p}return r.rho=function(s){var o=Math.max(.001,+s),l=o*o,a=l*l;return t(o,l,a)},r}(Math.SQRT2,2,4);var Cn=0,qn=0,Kn=0,Po=1e3,Mi,Wn,xi=0,ln=0,Ai=0,Gn=typeof performance=="object"&&performance.now?performance:Date,Lo=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function Tr(){return ln||(Lo(ld),ln=Gn.now()+Ai)}function ld(){ln=0}function Ni(){this._call=this._time=this._next=null}Ni.prototype=Or.prototype={constructor:Ni,restart:function(t,e,n){if(typeof t!="function")throw new TypeError("callback is not a function");n=(n==null?Tr():+n)+(e==null?0:+e),!this._next&&Wn!==this&&(Wn?Wn._next=this:Mi=this,Wn=this),this._call=t,this._time=n,Pr()},stop:function(){this._call&&(this._call=null,this._time=1/0,Pr())}};function Or(t,e,n){var i=new Ni;return i.restart(t,e,n),i}function ad(){Tr(),++Cn;for(var t=Mi,e;t;)(e=ln-t._time)>=0&&t._call.call(void 0,e),t=t._next;--Cn}function Do(){ln=(xi=Gn.now())+Ai,Cn=qn=0;try{ad()}finally{Cn=0,ud(),ln=0}}function cd(){var t=Gn.now(),e=t-xi;e>Po&&(Ai-=e,xi=t)}function ud(){for(var t,e=Mi,n,i=1/0;e;)e._call?(i>e._time&&(i=e._time),t=e,e=e._next):(n=e._next,e._next=null,e=t?t._next=n:Mi=n);Wn=t,Pr(i)}function Pr(t){if(!Cn){qn&&(qn=clearTimeout(qn));var e=t-ln;e>24?(t<1/0&&(qn=setTimeout(Do,t-Gn.now()-Ai)),Kn&&(Kn=clearInterval(Kn))):(Kn||(xi=Gn.now(),Kn=setInterval(cd,Po)),Cn=1,Lo(Do))}}function Ro(t,e,n){var i=new Ni;return e=e==null?0:+e,i.restart(r=>{i.stop(),t(r+e)},e,n),i}var fd=jn("start","end","cancel","interrupt"),hd=[],$o=0,zo=1,Lr=2,Ti=3,jo=4,Dr=5,Oi=6;function Pi(t,e,n,i,r,s){var o=t.__transition;if(!o)t.__transition={};else if(n in o)return;dd(t,n,{name:e,index:i,group:r,on:fd,tween:hd,time:s.time,delay:s.delay,duration:s.duration,ease:s.ease,timer:null,state:$o})}function Rr(t,e){var n=xt(t,e);if(n.state>$o)throw new Error("too late; already scheduled");return n}function Dt(t,e){var n=xt(t,e);if(n.state>Ti)throw new Error("too late; already running");return n}function xt(t,e){var n=t.__transition;if(!n||!(n=n[e]))throw new Error("transition not found");return n}function dd(t,e,n){var i=t.__transition,r;i[e]=n,n.timer=Or(s,0,n.time);function s(c){n.state=zo,n.timer.restart(o,n.delay,n.time),n.delay<=c&&o(c-n.delay)}function o(c){var u,d,f,h;if(n.state!==zo)return a();for(u in i)if(h=i[u],h.name===n.name){if(h.state===Ti)return Ro(o);h.state===jo?(h.state=Oi,h.timer.stop(),h.on.call("interrupt",t,t.__data__,h.index,h.group),delete i[u]):+u<e&&(h.state=Oi,h.timer.stop(),h.on.call("cancel",t,t.__data__,h.index,h.group),delete i[u])}if(Ro(function(){n.state===Ti&&(n.state=jo,n.timer.restart(l,n.delay,n.time),l(c))}),n.state=Lr,n.on.call("start",t,t.__data__,n.index,n.group),n.state===Lr){for(n.state=Ti,r=new Array(f=n.tween.length),u=0,d=-1;u<f;++u)(h=n.tween[u].value.call(t,t.__data__,n.index,n.group))&&(r[++d]=h);r.length=d+1}}function l(c){for(var u=c<n.duration?n.ease.call(null,c/n.duration):(n.timer.restart(a),n.state=Dr,1),d=-1,f=r.length;++d<f;)r[d].call(t,u);n.state===Dr&&(n.on.call("end",t,t.__data__,n.index,n.group),a())}function a(){n.state=Oi,n.timer.stop(),delete i[e];for(var c in i)return;delete t.__transition}}function Li(t,e){var n=t.__transition,i,r,s=!0,o;if(n){e=e==null?null:e+"";for(o in n){if((i=n[o]).name!==e){s=!1;continue}r=i.state>Lr&&i.state<Dr,i.state=Oi,i.timer.stop(),i.on.call(r?"interrupt":"cancel",t,t.__data__,i.index,i.group),delete n[o]}s&&delete t.__transition}}function md(t){return this.each(function(){Li(this,t)})}function pd(t,e){var n,i;return function(){var r=Dt(this,t),s=r.tween;if(s!==n){i=n=s;for(var o=0,l=i.length;o<l;++o)if(i[o].name===e){i=i.slice(),i.splice(o,1);break}}r.tween=i}}function gd(t,e,n){var i,r;if(typeof n!="function")throw new Error;return function(){var s=Dt(this,t),o=s.tween;if(o!==i){r=(i=o).slice();for(var l={name:e,value:n},a=0,c=r.length;a<c;++a)if(r[a].name===e){r[a]=l;break}a===c&&r.push(l)}s.tween=r}}function _d(t,e){var n=this._id;if(t+="",arguments.length<2){for(var i=xt(this.node(),n).tween,r=0,s=i.length,o;r<s;++r)if((o=i[r]).name===t)return o.value;return null}return this.each((e==null?pd:gd)(n,t,e))}function $r(t,e,n){var i=t._id;return t.each(function(){var r=Dt(this,i);(r.value||(r.value={}))[e]=n.apply(this,arguments)}),function(r){return xt(r,i).value[e]}}function Fo(t,e){var n;return(typeof e=="number"?Mt:e instanceof rn?Ci:(n=rn(e))?(e=n,Ci):xo)(t,e)}function vd(t){return function(){this.removeAttribute(t)}}function yd(t){return function(){this.removeAttributeNS(t.space,t.local)}}function bd(t,e,n){var i,r=n+"",s;return function(){var o=this.getAttribute(t);return o===r?null:o===i?s:s=e(i=o,n)}}function wd(t,e,n){var i,r=n+"",s;return function(){var o=this.getAttributeNS(t.space,t.local);return o===r?null:o===i?s:s=e(i=o,n)}}function Sd(t,e,n){var i,r,s;return function(){var o,l=n(this),a;return l==null?void this.removeAttribute(t):(o=this.getAttribute(t),a=l+"",o===a?null:o===i&&a===r?s:(r=a,s=e(i=o,l)))}}function kd(t,e,n){var i,r,s;return function(){var o,l=n(this),a;return l==null?void this.removeAttributeNS(t.space,t.local):(o=this.getAttributeNS(t.space,t.local),a=l+"",o===a?null:o===i&&a===r?s:(r=a,s=e(i=o,l)))}}function Ed(t,e){var n=vi(t),i=n==="transform"?nd:Fo;return this.attrTween(t,typeof e=="function"?(n.local?kd:Sd)(n,i,$r(this,"attr."+t,e)):e==null?(n.local?yd:vd)(n):(n.local?wd:bd)(n,i,e))}function Cd(t,e){return function(n){this.setAttribute(t,e.call(this,n))}}function Id(t,e){return function(n){this.setAttributeNS(t.space,t.local,e.call(this,n))}}function Md(t,e){var n,i;function r(){var s=e.apply(this,arguments);return s!==i&&(n=(i=s)&&Id(t,s)),n}return r._value=e,r}function xd(t,e){var n,i;function r(){var s=e.apply(this,arguments);return s!==i&&(n=(i=s)&&Cd(t,s)),n}return r._value=e,r}function Ad(t,e){var n="attr."+t;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(e==null)return this.tween(n,null);if(typeof e!="function")throw new Error;var i=vi(t);return this.tween(n,(i.local?Md:xd)(i,e))}function Nd(t,e){return function(){Rr(this,t).delay=+e.apply(this,arguments)}}function Td(t,e){return e=+e,function(){Rr(this,t).delay=e}}function Od(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?Nd:Td)(e,t)):xt(this.node(),e).delay}function Pd(t,e){return function(){Dt(this,t).duration=+e.apply(this,arguments)}}function Ld(t,e){return e=+e,function(){Dt(this,t).duration=e}}function Dd(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?Pd:Ld)(e,t)):xt(this.node(),e).duration}function Rd(t,e){if(typeof e!="function")throw new Error;return function(){Dt(this,t).ease=e}}function $d(t){var e=this._id;return arguments.length?this.each(Rd(e,t)):xt(this.node(),e).ease}function zd(t,e){return function(){var n=e.apply(this,arguments);if(typeof n!="function")throw new Error;Dt(this,t).ease=n}}function jd(t){if(typeof t!="function")throw new Error;return this.each(zd(this._id,t))}function Fd(t){typeof t!="function"&&(t=ro(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var s=e[r],o=s.length,l=i[r]=[],a,c=0;c<o;++c)(a=s[c])&&t.call(a,a.__data__,c,s)&&l.push(a);return new Ut(i,this._parents,this._name,this._id)}function Vd(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,n=t._groups,i=e.length,r=n.length,s=Math.min(i,r),o=new Array(i),l=0;l<s;++l)for(var a=e[l],c=n[l],u=a.length,d=o[l]=new Array(u),f,h=0;h<u;++h)(f=a[h]||c[h])&&(d[h]=f);for(;l<i;++l)o[l]=e[l];return new Ut(o,this._parents,this._name,this._id)}function Hd(t){return(t+"").trim().split(/^|\s+/).every(function(e){var n=e.indexOf(".");return n>=0&&(e=e.slice(0,n)),!e||e==="start"})}function Ud(t,e,n){var i,r,s=Hd(e)?Rr:Dt;return function(){var o=s(this,t),l=o.on;l!==i&&(r=(i=l).copy()).on(e,n),o.on=r}}function Bd(t,e){var n=this._id;return arguments.length<2?xt(this.node(),n).on.on(t):this.each(Ud(n,t,e))}function qd(t){return function(){var e=this.parentNode;for(var n in this.__transition)if(+n!==t)return;e&&e.removeChild(this)}}function Kd(){return this.on("end.remove",qd(this._id))}function Wd(t){var e=this._name,n=this._id;typeof t!="function"&&(t=vr(t));for(var i=this._groups,r=i.length,s=new Array(r),o=0;o<r;++o)for(var l=i[o],a=l.length,c=s[o]=new Array(a),u,d,f=0;f<a;++f)(u=l[f])&&(d=t.call(u,u.__data__,f,l))&&("__data__"in u&&(d.__data__=u.__data__),c[f]=d,Pi(c[f],e,n,f,c,xt(u,n)));return new Ut(s,this._parents,e,n)}function Gd(t){var e=this._name,n=this._id;typeof t!="function"&&(t=io(t));for(var i=this._groups,r=i.length,s=[],o=[],l=0;l<r;++l)for(var a=i[l],c=a.length,u,d=0;d<c;++d)if(u=a[d]){for(var f=t.call(u,u.__data__,d,a),h,m=xt(u,n),g=0,p=f.length;g<p;++g)(h=f[g])&&Pi(h,e,n,g,f,m);s.push(f),o.push(u)}return new Ut(s,o,e,n)}var Yd=Fn.prototype.constructor;function Xd(){return new Yd(this._groups,this._parents)}function Jd(t,e){var n,i,r;return function(){var s=Sn(this,t),o=(this.style.removeProperty(t),Sn(this,t));return s===o?null:s===n&&o===i?r:r=e(n=s,i=o)}}function Vo(t){return function(){this.style.removeProperty(t)}}function Qd(t,e,n){var i,r=n+"",s;return function(){var o=Sn(this,t);return o===r?null:o===i?s:s=e(i=o,n)}}function Zd(t,e,n){var i,r,s;return function(){var o=Sn(this,t),l=n(this),a=l+"";return l==null&&(a=l=(this.style.removeProperty(t),Sn(this,t))),o===a?null:o===i&&a===r?s:(r=a,s=e(i=o,l))}}function em(t,e){var n,i,r,s="style."+e,o="end."+s,l;return function(){var a=Dt(this,t),c=a.on,u=a.value[s]==null?l||(l=Vo(e)):void 0;(c!==n||r!==u)&&(i=(n=c).copy()).on(o,r=u),a.on=i}}function tm(t,e,n){var i=(t+="")=="transform"?td:Fo;return e==null?this.styleTween(t,Jd(t,i)).on("end.style."+t,Vo(t)):typeof e=="function"?this.styleTween(t,Zd(t,i,$r(this,"style."+t,e))).each(em(this._id,t)):this.styleTween(t,Qd(t,i,e),n).on("end.style."+t,null)}function nm(t,e,n){return function(i){this.style.setProperty(t,e.call(this,i),n)}}function im(t,e,n){var i,r;function s(){var o=e.apply(this,arguments);return o!==r&&(i=(r=o)&&nm(t,o,n)),i}return s._value=e,s}function rm(t,e,n){var i="style."+(t+="");if(arguments.length<2)return(i=this.tween(i))&&i._value;if(e==null)return this.tween(i,null);if(typeof e!="function")throw new Error;return this.tween(i,im(t,e,n??""))}function sm(t){return function(){this.textContent=t}}function om(t){return function(){var e=t(this);this.textContent=e??""}}function lm(t){return this.tween("text",typeof t=="function"?om($r(this,"text",t)):sm(t==null?"":t+""))}function am(t){return function(e){this.textContent=t.call(this,e)}}function cm(t){var e,n;function i(){var r=t.apply(this,arguments);return r!==n&&(e=(n=r)&&am(r)),e}return i._value=t,i}function um(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(t==null)return this.tween(e,null);if(typeof t!="function")throw new Error;return this.tween(e,cm(t))}function fm(){for(var t=this._name,e=this._id,n=Ho(),i=this._groups,r=i.length,s=0;s<r;++s)for(var o=i[s],l=o.length,a,c=0;c<l;++c)if(a=o[c]){var u=xt(a,e);Pi(a,t,n,c,o,{time:u.time+u.delay+u.duration,delay:0,duration:u.duration,ease:u.ease})}return new Ut(i,this._parents,t,n)}function hm(){var t,e,n=this,i=n._id,r=n.size();return new Promise(function(s,o){var l={value:o},a={value:function(){--r===0&&s()}};n.each(function(){var c=Dt(this,i),u=c.on;u!==t&&(e=(t=u).copy(),e._.cancel.push(l),e._.interrupt.push(l),e._.end.push(a)),c.on=e}),r===0&&s()})}var dm=0;function Ut(t,e,n,i){this._groups=t,this._parents=e,this._name=n,this._id=i}function Ho(){return++dm}var Bt=Fn.prototype;Ut.prototype={constructor:Ut,select:Wd,selectAll:Gd,selectChild:Bt.selectChild,selectChildren:Bt.selectChildren,filter:Fd,merge:Vd,selection:Xd,transition:fm,call:Bt.call,nodes:Bt.nodes,node:Bt.node,size:Bt.size,empty:Bt.empty,each:Bt.each,on:Bd,attr:Ed,attrTween:Ad,style:tm,styleTween:rm,text:lm,textTween:um,remove:Kd,tween:_d,delay:Od,duration:Dd,ease:$d,easeVarying:jd,end:hm,[Symbol.iterator]:Bt[Symbol.iterator]};function mm(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}var pm={time:null,delay:0,duration:250,ease:mm};function gm(t,e){for(var n;!(n=t.__transition)||!(n=n[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return n}function _m(t){var e,n;t instanceof Ut?(e=t._id,t=t._name):(e=Ho(),(n=pm).time=Tr(),t=t==null?null:t+"");for(var i=this._groups,r=i.length,s=0;s<r;++s)for(var o=i[s],l=o.length,a,c=0;c<l;++c)(a=o[c])&&Pi(a,t,e,c,o,n||gm(a,e));return new Ut(i,this._parents,t,e)}Fn.prototype.interrupt=md,Fn.prototype.transition=_m;function Uo(t,e){var n,i=1;t==null&&(t=0),e==null&&(e=0);function r(){var s,o=n.length,l,a=0,c=0;for(s=0;s<o;++s)l=n[s],a+=l.x,c+=l.y;for(a=(a/o-t)*i,c=(c/o-e)*i,s=0;s<o;++s)l=n[s],l.x-=a,l.y-=c}return r.initialize=function(s){n=s},r.x=function(s){return arguments.length?(t=+s,r):t},r.y=function(s){return arguments.length?(e=+s,r):e},r.strength=function(s){return arguments.length?(i=+s,r):i},r}function vm(t){const e=+this._x.call(null,t),n=+this._y.call(null,t);return Bo(this.cover(e,n),e,n,t)}function Bo(t,e,n,i){if(isNaN(e)||isNaN(n))return t;var r,s=t._root,o={data:i},l=t._x0,a=t._y0,c=t._x1,u=t._y1,d,f,h,m,g,p,_,w;if(!s)return t._root=o,t;for(;s.length;)if((g=e>=(d=(l+c)/2))?l=d:c=d,(p=n>=(f=(a+u)/2))?a=f:u=f,r=s,!(s=s[_=p<<1|g]))return r[_]=o,t;if(h=+t._x.call(null,s.data),m=+t._y.call(null,s.data),e===h&&n===m)return o.next=s,r?r[_]=o:t._root=o,t;do r=r?r[_]=new Array(4):t._root=new Array(4),(g=e>=(d=(l+c)/2))?l=d:c=d,(p=n>=(f=(a+u)/2))?a=f:u=f;while((_=p<<1|g)===(w=(m>=f)<<1|h>=d));return r[w]=s,r[_]=o,t}function ym(t){var e,n,i=t.length,r,s,o=new Array(i),l=new Array(i),a=1/0,c=1/0,u=-1/0,d=-1/0;for(n=0;n<i;++n)isNaN(r=+this._x.call(null,e=t[n]))||isNaN(s=+this._y.call(null,e))||(o[n]=r,l[n]=s,r<a&&(a=r),r>u&&(u=r),s<c&&(c=s),s>d&&(d=s));if(a>u||c>d)return this;for(this.cover(a,c).cover(u,d),n=0;n<i;++n)Bo(this,o[n],l[n],t[n]);return this}function bm(t,e){if(isNaN(t=+t)||isNaN(e=+e))return this;var n=this._x0,i=this._y0,r=this._x1,s=this._y1;if(isNaN(n))r=(n=Math.floor(t))+1,s=(i=Math.floor(e))+1;else{for(var o=r-n||1,l=this._root,a,c;n>t||t>=r||i>e||e>=s;)switch(c=(e<i)<<1|t<n,a=new Array(4),a[c]=l,l=a,o*=2,c){case 0:r=n+o,s=i+o;break;case 1:n=r-o,s=i+o;break;case 2:r=n+o,i=s-o;break;case 3:n=r-o,i=s-o;break}this._root&&this._root.length&&(this._root=l)}return this._x0=n,this._y0=i,this._x1=r,this._y1=s,this}function wm(){var t=[];return this.visit(function(e){if(!e.length)do t.push(e.data);while(e=e.next)}),t}function Sm(t){return arguments.length?this.cover(+t[0][0],+t[0][1]).cover(+t[1][0],+t[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function rt(t,e,n,i,r){this.node=t,this.x0=e,this.y0=n,this.x1=i,this.y1=r}function km(t,e,n){var i,r=this._x0,s=this._y0,o,l,a,c,u=this._x1,d=this._y1,f=[],h=this._root,m,g;for(h&&f.push(new rt(h,r,s,u,d)),n==null?n=1/0:(r=t-n,s=e-n,u=t+n,d=e+n,n*=n);m=f.pop();)if(!(!(h=m.node)||(o=m.x0)>u||(l=m.y0)>d||(a=m.x1)<r||(c=m.y1)<s))if(h.length){var p=(o+a)/2,_=(l+c)/2;f.push(new rt(h[3],p,_,a,c),new rt(h[2],o,_,p,c),new rt(h[1],p,l,a,_),new rt(h[0],o,l,p,_)),(g=(e>=_)<<1|t>=p)&&(m=f[f.length-1],f[f.length-1]=f[f.length-1-g],f[f.length-1-g]=m)}else{var w=t-+this._x.call(null,h.data),I=e-+this._y.call(null,h.data),b=w*w+I*I;if(b<n){var E=Math.sqrt(n=b);r=t-E,s=e-E,u=t+E,d=e+E,i=h.data}}return i}function Em(t){if(isNaN(u=+this._x.call(null,t))||isNaN(d=+this._y.call(null,t)))return this;var e,n=this._root,i,r,s,o=this._x0,l=this._y0,a=this._x1,c=this._y1,u,d,f,h,m,g,p,_;if(!n)return this;if(n.length)for(;;){if((m=u>=(f=(o+a)/2))?o=f:a=f,(g=d>=(h=(l+c)/2))?l=h:c=h,e=n,!(n=n[p=g<<1|m]))return this;if(!n.length)break;(e[p+1&3]||e[p+2&3]||e[p+3&3])&&(i=e,_=p)}for(;n.data!==t;)if(r=n,!(n=n.next))return this;return(s=n.next)&&delete n.next,r?(s?r.next=s:delete r.next,this):e?(s?e[p]=s:delete e[p],(n=e[0]||e[1]||e[2]||e[3])&&n===(e[3]||e[2]||e[1]||e[0])&&!n.length&&(i?i[_]=n:this._root=n),this):(this._root=s,this)}function Cm(t){for(var e=0,n=t.length;e<n;++e)this.remove(t[e]);return this}function Im(){return this._root}function Mm(){var t=0;return this.visit(function(e){if(!e.length)do++t;while(e=e.next)}),t}function xm(t){var e=[],n,i=this._root,r,s,o,l,a;for(i&&e.push(new rt(i,this._x0,this._y0,this._x1,this._y1));n=e.pop();)if(!t(i=n.node,s=n.x0,o=n.y0,l=n.x1,a=n.y1)&&i.length){var c=(s+l)/2,u=(o+a)/2;(r=i[3])&&e.push(new rt(r,c,u,l,a)),(r=i[2])&&e.push(new rt(r,s,u,c,a)),(r=i[1])&&e.push(new rt(r,c,o,l,u)),(r=i[0])&&e.push(new rt(r,s,o,c,u))}return this}function Am(t){var e=[],n=[],i;for(this._root&&e.push(new rt(this._root,this._x0,this._y0,this._x1,this._y1));i=e.pop();){var r=i.node;if(r.length){var s,o=i.x0,l=i.y0,a=i.x1,c=i.y1,u=(o+a)/2,d=(l+c)/2;(s=r[0])&&e.push(new rt(s,o,l,u,d)),(s=r[1])&&e.push(new rt(s,u,l,a,d)),(s=r[2])&&e.push(new rt(s,o,d,u,c)),(s=r[3])&&e.push(new rt(s,u,d,a,c))}n.push(i)}for(;i=n.pop();)t(i.node,i.x0,i.y0,i.x1,i.y1);return this}function Nm(t){return t[0]}function Tm(t){return arguments.length?(this._x=t,this):this._x}function Om(t){return t[1]}function Pm(t){return arguments.length?(this._y=t,this):this._y}function zr(t,e,n){var i=new jr(e??Nm,n??Om,NaN,NaN,NaN,NaN);return t==null?i:i.addAll(t)}function jr(t,e,n,i,r,s){this._x=t,this._y=e,this._x0=n,this._y0=i,this._x1=r,this._y1=s,this._root=void 0}function qo(t){for(var e={data:t.data},n=e;t=t.next;)n=n.next={data:t.data};return e}var st=zr.prototype=jr.prototype;st.copy=function(){var t=new jr(this._x,this._y,this._x0,this._y0,this._x1,this._y1),e=this._root,n,i;if(!e)return t;if(!e.length)return t._root=qo(e),t;for(n=[{source:e,target:t._root=new Array(4)}];e=n.pop();)for(var r=0;r<4;++r)(i=e.source[r])&&(i.length?n.push({source:i,target:e.target[r]=new Array(4)}):e.target[r]=qo(i));return t},st.add=vm,st.addAll=ym,st.cover=bm,st.data=wm,st.extent=Sm,st.find=km,st.remove=Em,st.removeAll=Cm,st.root=Im,st.size=Mm,st.visit=xm,st.visitAfter=Am,st.x=Tm,st.y=Pm;function ot(t){return function(){return t}}function Jt(t){return(t()-.5)*1e-6}function Lm(t){return t.x+t.vx}function Dm(t){return t.y+t.vy}function Ko(t){var e,n,i,r=1,s=1;typeof t!="function"&&(t=ot(t==null?1:+t));function o(){for(var c,u=e.length,d,f,h,m,g,p,_=0;_<s;++_)for(d=zr(e,Lm,Dm).visitAfter(l),c=0;c<u;++c)f=e[c],g=n[f.index],p=g*g,h=f.x+f.vx,m=f.y+f.vy,d.visit(w);function w(I,b,E,T,M){var k=I.data,x=I.r,O=g+x;if(k){if(k.index>f.index){var D=h-k.x-k.vx,q=m-k.y-k.vy,R=D*D+q*q;R<O*O&&(D===0&&(D=Jt(i),R+=D*D),q===0&&(q=Jt(i),R+=q*q),R=(O-(R=Math.sqrt(R)))/R*r,f.vx+=(D*=R)*(O=(x*=x)/(p+x)),f.vy+=(q*=R)*O,k.vx-=D*(O=1-O),k.vy-=q*O)}return}return b>h+O||T<h-O||E>m+O||M<m-O}}function l(c){if(c.data)return c.r=n[c.data.index];for(var u=c.r=0;u<4;++u)c[u]&&c[u].r>c.r&&(c.r=c[u].r)}function a(){if(e){var c,u=e.length,d;for(n=new Array(u),c=0;c<u;++c)d=e[c],n[d.index]=+t(d,c,e)}}return o.initialize=function(c,u){e=c,i=u,a()},o.iterations=function(c){return arguments.length?(s=+c,o):s},o.strength=function(c){return arguments.length?(r=+c,o):r},o.radius=function(c){return arguments.length?(t=typeof c=="function"?c:ot(+c),a(),o):t},o}function Rm(t){return t.index}function Wo(t,e){var n=t.get(e);if(!n)throw new Error("node not found: "+e);return n}function Go(t){var e=Rm,n=d,i,r=ot(30),s,o,l,a,c,u=1;t==null&&(t=[]);function d(p){return 1/Math.min(l[p.source.index],l[p.target.index])}function f(p){for(var _=0,w=t.length;_<u;++_)for(var I=0,b,E,T,M,k,x,O;I<w;++I)b=t[I],E=b.source,T=b.target,M=T.x+T.vx-E.x-E.vx||Jt(c),k=T.y+T.vy-E.y-E.vy||Jt(c),x=Math.sqrt(M*M+k*k),x=(x-s[I])/x*p*i[I],M*=x,k*=x,T.vx-=M*(O=a[I]),T.vy-=k*O,E.vx+=M*(O=1-O),E.vy+=k*O}function h(){if(o){var p,_=o.length,w=t.length,I=new Map(o.map((E,T)=>[e(E,T,o),E])),b;for(p=0,l=new Array(_);p<w;++p)b=t[p],b.index=p,typeof b.source!="object"&&(b.source=Wo(I,b.source)),typeof b.target!="object"&&(b.target=Wo(I,b.target)),l[b.source.index]=(l[b.source.index]||0)+1,l[b.target.index]=(l[b.target.index]||0)+1;for(p=0,a=new Array(w);p<w;++p)b=t[p],a[p]=l[b.source.index]/(l[b.source.index]+l[b.target.index]);i=new Array(w),m(),s=new Array(w),g()}}function m(){if(o)for(var p=0,_=t.length;p<_;++p)i[p]=+n(t[p],p,t)}function g(){if(o)for(var p=0,_=t.length;p<_;++p)s[p]=+r(t[p],p,t)}return f.initialize=function(p,_){o=p,c=_,h()},f.links=function(p){return arguments.length?(t=p,h(),f):t},f.id=function(p){return arguments.length?(e=p,f):e},f.iterations=function(p){return arguments.length?(u=+p,f):u},f.strength=function(p){return arguments.length?(n=typeof p=="function"?p:ot(+p),m(),f):n},f.distance=function(p){return arguments.length?(r=typeof p=="function"?p:ot(+p),g(),f):r},f}const $m=1664525,zm=1013904223,Yo=4294967296;function jm(){let t=1;return()=>(t=($m*t+zm)%Yo)/Yo}function Fm(t){return t.x}function Vm(t){return t.y}var Hm=10,Um=Math.PI*(3-Math.sqrt(5));function Xo(t){var e,n=1,i=.001,r=1-Math.pow(i,1/300),s=0,o=.6,l=new Map,a=Or(d),c=jn("tick","end"),u=jm();t==null&&(t=[]);function d(){f(),c.call("tick",e),n<i&&(a.stop(),c.call("end",e))}function f(g){var p,_=t.length,w;g===void 0&&(g=1);for(var I=0;I<g;++I)for(n+=(s-n)*r,l.forEach(function(b){b(n)}),p=0;p<_;++p)w=t[p],w.fx==null?w.x+=w.vx*=o:(w.x=w.fx,w.vx=0),w.fy==null?w.y+=w.vy*=o:(w.y=w.fy,w.vy=0);return e}function h(){for(var g=0,p=t.length,_;g<p;++g){if(_=t[g],_.index=g,_.fx!=null&&(_.x=_.fx),_.fy!=null&&(_.y=_.fy),isNaN(_.x)||isNaN(_.y)){var w=Hm*Math.sqrt(.5+g),I=g*Um;_.x=w*Math.cos(I),_.y=w*Math.sin(I)}(isNaN(_.vx)||isNaN(_.vy))&&(_.vx=_.vy=0)}}function m(g){return g.initialize&&g.initialize(t,u),g}return h(),e={tick:f,restart:function(){return a.restart(d),e},stop:function(){return a.stop(),e},nodes:function(g){return arguments.length?(t=g,h(),l.forEach(m),e):t},alpha:function(g){return arguments.length?(n=+g,e):n},alphaMin:function(g){return arguments.length?(i=+g,e):i},alphaDecay:function(g){return arguments.length?(r=+g,e):+r},alphaTarget:function(g){return arguments.length?(s=+g,e):s},velocityDecay:function(g){return arguments.length?(o=1-g,e):1-o},randomSource:function(g){return arguments.length?(u=g,l.forEach(m),e):u},force:function(g,p){return arguments.length>1?(p==null?l.delete(g):l.set(g,m(p)),e):l.get(g)},find:function(g,p,_){var w=0,I=t.length,b,E,T,M,k;for(_==null?_=1/0:_*=_,w=0;w<I;++w)M=t[w],b=g-M.x,E=p-M.y,T=b*b+E*E,T<_&&(k=M,_=T);return k},on:function(g,p){return arguments.length>1?(c.on(g,p),e):c.on(g)}}}function Jo(){var t,e,n,i,r=ot(-30),s,o=1,l=1/0,a=.81;function c(h){var m,g=t.length,p=zr(t,Fm,Vm).visitAfter(d);for(i=h,m=0;m<g;++m)e=t[m],p.visit(f)}function u(){if(t){var h,m=t.length,g;for(s=new Array(m),h=0;h<m;++h)g=t[h],s[g.index]=+r(g,h,t)}}function d(h){var m=0,g,p,_=0,w,I,b;if(h.length){for(w=I=b=0;b<4;++b)(g=h[b])&&(p=Math.abs(g.value))&&(m+=g.value,_+=p,w+=p*g.x,I+=p*g.y);h.x=w/_,h.y=I/_}else{g=h,g.x=g.data.x,g.y=g.data.y;do m+=s[g.data.index];while(g=g.next)}h.value=m}function f(h,m,g,p){if(!h.value)return!0;var _=h.x-e.x,w=h.y-e.y,I=p-m,b=_*_+w*w;if(I*I/a<b)return b<l&&(_===0&&(_=Jt(n),b+=_*_),w===0&&(w=Jt(n),b+=w*w),b<o&&(b=Math.sqrt(o*b)),e.vx+=_*h.value*i/b,e.vy+=w*h.value*i/b),!0;if(h.length||b>=l)return;(h.data!==e||h.next)&&(_===0&&(_=Jt(n),b+=_*_),w===0&&(w=Jt(n),b+=w*w),b<o&&(b=Math.sqrt(o*b)));do h.data!==e&&(I=s[h.data.index]*i/b,e.vx+=_*I,e.vy+=w*I);while(h=h.next)}return c.initialize=function(h,m){t=h,n=m,u()},c.strength=function(h){return arguments.length?(r=typeof h=="function"?h:ot(+h),u(),c):r},c.distanceMin=function(h){return arguments.length?(o=h*h,c):Math.sqrt(o)},c.distanceMax=function(h){return arguments.length?(l=h*h,c):Math.sqrt(l)},c.theta=function(h){return arguments.length?(a=h*h,c):Math.sqrt(a)},c}function Qo(t){var e=ot(.1),n,i,r;typeof t!="function"&&(t=ot(t==null?0:+t));function s(l){for(var a=0,c=n.length,u;a<c;++a)u=n[a],u.vx+=(r[a]-u.x)*i[a]*l}function o(){if(n){var l,a=n.length;for(i=new Array(a),r=new Array(a),l=0;l<a;++l)i[l]=isNaN(r[l]=+t(n[l],l,n))?0:+e(n[l],l,n)}}return s.initialize=function(l){n=l,o()},s.strength=function(l){return arguments.length?(e=typeof l=="function"?l:ot(+l),o(),s):e},s.x=function(l){return arguments.length?(t=typeof l=="function"?l:ot(+l),o(),s):t},s}function Zo(t){var e=ot(.1),n,i,r;typeof t!="function"&&(t=ot(t==null?0:+t));function s(l){for(var a=0,c=n.length,u;a<c;++a)u=n[a],u.vy+=(r[a]-u.y)*i[a]*l}function o(){if(n){var l,a=n.length;for(i=new Array(a),r=new Array(a),l=0;l<a;++l)i[l]=isNaN(r[l]=+t(n[l],l,n))?0:+e(n[l],l,n)}}return s.initialize=function(l){n=l,o()},s.strength=function(l){return arguments.length?(e=typeof l=="function"?l:ot(+l),o(),s):e},s.y=function(l){return arguments.length?(t=typeof l=="function"?l:ot(+l),o(),s):t},s}function Bm(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)}function Di(t,e){if((n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var n,i=t.slice(0,n);return[i.length>1?i[0]+i.slice(2):i,+t.slice(n+1)]}function In(t){return t=Di(Math.abs(t)),t?t[1]:NaN}function qm(t,e){return function(n,i){for(var r=n.length,s=[],o=0,l=t[0],a=0;r>0&&l>0&&(a+l+1>i&&(l=Math.max(1,i-a)),s.push(n.substring(r-=l,r+l)),!((a+=l+1)>i));)l=t[o=(o+1)%t.length];return s.reverse().join(e)}}function Km(t){return function(e){return e.replace(/[0-9]/g,function(n){return t[+n]})}}var Wm=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Ri(t){if(!(e=Wm.exec(t)))throw new Error("invalid format: "+t);var e;return new Fr({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}Ri.prototype=Fr.prototype;function Fr(t){this.fill=t.fill===void 0?" ":t.fill+"",this.align=t.align===void 0?">":t.align+"",this.sign=t.sign===void 0?"-":t.sign+"",this.symbol=t.symbol===void 0?"":t.symbol+"",this.zero=!!t.zero,this.width=t.width===void 0?void 0:+t.width,this.comma=!!t.comma,this.precision=t.precision===void 0?void 0:+t.precision,this.trim=!!t.trim,this.type=t.type===void 0?"":t.type+""}Fr.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function Gm(t){e:for(var e=t.length,n=1,i=-1,r;n<e;++n)switch(t[n]){case".":i=r=n;break;case"0":i===0&&(i=n),r=n;break;default:if(!+t[n])break e;i>0&&(i=0);break}return i>0?t.slice(0,i)+t.slice(r+1):t}var el;function Ym(t,e){var n=Di(t,e);if(!n)return t+"";var i=n[0],r=n[1],s=r-(el=Math.max(-8,Math.min(8,Math.floor(r/3)))*3)+1,o=i.length;return s===o?i:s>o?i+new Array(s-o+1).join("0"):s>0?i.slice(0,s)+"."+i.slice(s):"0."+new Array(1-s).join("0")+Di(t,Math.max(0,e+s-1))[0]}function tl(t,e){var n=Di(t,e);if(!n)return t+"";var i=n[0],r=n[1];return r<0?"0."+new Array(-r).join("0")+i:i.length>r+1?i.slice(0,r+1)+"."+i.slice(r+1):i+new Array(r-i.length+2).join("0")}const nl={"%":(t,e)=>(t*100).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:Bm,e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>tl(t*100,e),r:tl,s:Ym,X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function il(t){return t}var rl=Array.prototype.map,sl=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function Xm(t){var e=t.grouping===void 0||t.thousands===void 0?il:qm(rl.call(t.grouping,Number),t.thousands+""),n=t.currency===void 0?"":t.currency[0]+"",i=t.currency===void 0?"":t.currency[1]+"",r=t.decimal===void 0?".":t.decimal+"",s=t.numerals===void 0?il:Km(rl.call(t.numerals,String)),o=t.percent===void 0?"%":t.percent+"",l=t.minus===void 0?"−":t.minus+"",a=t.nan===void 0?"NaN":t.nan+"";function c(d){d=Ri(d);var f=d.fill,h=d.align,m=d.sign,g=d.symbol,p=d.zero,_=d.width,w=d.comma,I=d.precision,b=d.trim,E=d.type;E==="n"?(w=!0,E="g"):nl[E]||(I===void 0&&(I=12),b=!0,E="g"),(p||f==="0"&&h==="=")&&(p=!0,f="0",h="=");var T=g==="$"?n:g==="#"&&/[boxX]/.test(E)?"0"+E.toLowerCase():"",M=g==="$"?i:/[%p]/.test(E)?o:"",k=nl[E],x=/[defgprs%]/.test(E);I=I===void 0?6:/[gprs]/.test(E)?Math.max(1,Math.min(21,I)):Math.max(0,Math.min(20,I));function O(D){var q=T,R=M,C,L,A;if(E==="c")R=k(D)+R,D="";else{D=+D;var H=D<0||1/D<0;if(D=isNaN(D)?a:k(Math.abs(D),I),b&&(D=Gm(D)),H&&+D==0&&m!=="+"&&(H=!1),q=(H?m==="("?m:l:m==="-"||m==="("?"":m)+q,R=(E==="s"?sl[8+el/3]:"")+R+(H&&m==="("?")":""),x){for(C=-1,L=D.length;++C<L;)if(A=D.charCodeAt(C),48>A||A>57){R=(A===46?r+D.slice(C+1):D.slice(C))+R,D=D.slice(0,C);break}}}w&&!p&&(D=e(D,1/0));var U=q.length+D.length+R.length,F=U<_?new Array(_-U+1).join(f):"";switch(w&&p&&(D=e(F+D,F.length?_-R.length:1/0),F=""),h){case"<":D=q+D+R+F;break;case"=":D=q+F+D+R;break;case"^":D=F.slice(0,U=F.length>>1)+q+D+R+F.slice(U);break;default:D=F+q+D+R;break}return s(D)}return O.toString=function(){return d+""},O}function u(d,f){var h=c((d=Ri(d),d.type="f",d)),m=Math.max(-8,Math.min(8,Math.floor(In(f)/3)))*3,g=Math.pow(10,-m),p=sl[8+m/3];return function(_){return h(g*_)+p}}return{format:c,formatPrefix:u}}var $i,zi,ol;Jm({thousands:",",grouping:[3],currency:["$",""]});function Jm(t){return $i=Xm(t),zi=$i.format,ol=$i.formatPrefix,$i}function Qm(t){return Math.max(0,-In(Math.abs(t)))}function Zm(t,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(In(e)/3)))*3-In(Math.abs(t)))}function ep(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,In(e)-In(t))+1}function tp(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t);break}return this}function np(t){return function(){return t}}function ip(t){return+t}var ll=[0,1];function Mn(t){return t}function Vr(t,e){return(e-=t=+t)?function(n){return(n-t)/e}:np(isNaN(e)?NaN:.5)}function rp(t,e){var n;return t>e&&(n=t,t=e,e=n),function(i){return Math.max(t,Math.min(e,i))}}function sp(t,e,n){var i=t[0],r=t[1],s=e[0],o=e[1];return r<i?(i=Vr(r,i),s=n(o,s)):(i=Vr(i,r),s=n(s,o)),function(l){return s(i(l))}}function op(t,e,n){var i=Math.min(t.length,e.length)-1,r=new Array(i),s=new Array(i),o=-1;for(t[i]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++o<i;)r[o]=Vr(t[o],t[o+1]),s[o]=n(e[o],e[o+1]);return function(l){var a=xu(t,l,1,i)-1;return s[a](r[a](l))}}function lp(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function ap(){var t=ll,e=ll,n=Ar,i,r,s,o=Mn,l,a,c;function u(){var f=Math.min(t.length,e.length);return o!==Mn&&(o=rp(t[0],t[f-1])),l=f>2?op:sp,a=c=null,d}function d(f){return f==null||isNaN(f=+f)?s:(a||(a=l(t.map(i),e,n)))(i(o(f)))}return d.invert=function(f){return o(r((c||(c=l(e,t.map(i),Mt)))(f)))},d.domain=function(f){return arguments.length?(t=Array.from(f,ip),u()):t.slice()},d.range=function(f){return arguments.length?(e=Array.from(f),u()):e.slice()},d.rangeRound=function(f){return e=Array.from(f),n=Qh,u()},d.clamp=function(f){return arguments.length?(o=f?!0:Mn,u()):o!==Mn},d.interpolate=function(f){return arguments.length?(n=f,u()):n},d.unknown=function(f){return arguments.length?(s=f,d):s},function(f,h){return i=f,r=h,u()}}function cp(){return ap()(Mn,Mn)}function up(t,e,n,i){var r=Pu(t,e,n),s;switch(i=Ri(i??",f"),i.type){case"s":{var o=Math.max(Math.abs(t),Math.abs(e));return i.precision==null&&!isNaN(s=Zm(r,o))&&(i.precision=s),ol(i,o)}case"":case"e":case"g":case"p":case"r":{i.precision==null&&!isNaN(s=ep(r,Math.max(Math.abs(t),Math.abs(e))))&&(i.precision=s-(i.type==="e"));break}case"f":case"%":{i.precision==null&&!isNaN(s=Qm(r))&&(i.precision=s-(i.type==="%")*2);break}}return zi(i)}function fp(t){var e=t.domain;return t.ticks=function(n){var i=e();return Ou(i[0],i[i.length-1],n??10)},t.tickFormat=function(n,i){var r=e();return up(r[0],r[r.length-1],n??10,i)},t.nice=function(n){n==null&&(n=10);var i=e(),r=0,s=i.length-1,o=i[r],l=i[s],a,c,u=10;for(l<o&&(c=o,o=l,l=c,c=r,r=s,s=c);u-- >0;){if(c=dr(o,l,n),c===a)return i[r]=o,i[s]=l,e(i);if(c>0)o=Math.floor(o/c)*c,l=Math.ceil(l/c)*c;else if(c<0)o=Math.ceil(o*c)/c,l=Math.floor(l*c)/c;else break;a=c}return t},t}function Hr(){var t=cp();return t.copy=function(){return lp(t,Hr())},tp.apply(t,arguments),fp(t)}const ji=t=>()=>t;function hp(t,{sourceEvent:e,target:n,transform:i,dispatch:r}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:i,enumerable:!0,configurable:!0},_:{value:r}})}function qt(t,e,n){this.k=t,this.x=e,this.y=n}qt.prototype={constructor:qt,scale:function(t){return t===1?this:new qt(this.k*t,this.x,this.y)},translate:function(t,e){return t===0&e===0?this:new qt(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var Ur=new qt(1,0,0);qt.prototype;function Br(t){t.stopImmediatePropagation()}function Yn(t){t.preventDefault(),t.stopImmediatePropagation()}function dp(t){return(!t.ctrlKey||t.type==="wheel")&&!t.button}function mp(){var t=this;return t instanceof SVGElement?(t=t.ownerSVGElement||t,t.hasAttribute("viewBox")?(t=t.viewBox.baseVal,[[t.x,t.y],[t.x+t.width,t.y+t.height]]):[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]):[[0,0],[t.clientWidth,t.clientHeight]]}function al(){return this.__zoom||Ur}function pp(t){return-t.deltaY*(t.deltaMode===1?.05:t.deltaMode?1:.002)*(t.ctrlKey?10:1)}function gp(){return navigator.maxTouchPoints||"ontouchstart"in this}function _p(t,e,n){var i=t.invertX(e[0][0])-n[0][0],r=t.invertX(e[1][0])-n[1][0],s=t.invertY(e[0][1])-n[0][1],o=t.invertY(e[1][1])-n[1][1];return t.translate(r>i?(i+r)/2:Math.min(0,i)||Math.max(0,r),o>s?(s+o)/2:Math.min(0,s)||Math.max(0,o))}function cl(){var t=dp,e=mp,n=_p,i=pp,r=gp,s=[0,1/0],o=[[-1/0,-1/0],[1/0,1/0]],l=250,a=od,c=jn("start","zoom","end"),u,d,f,h=500,m=150,g=0,p=10;function _(C){C.property("__zoom",al).on("wheel.zoom",k,{passive:!1}).on("mousedown.zoom",x).on("dblclick.zoom",O).filter(r).on("touchstart.zoom",D).on("touchmove.zoom",q).on("touchend.zoom touchcancel.zoom",R).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}_.transform=function(C,L,A,H){var U=C.selection?C.selection():C;U.property("__zoom",al),C!==U?E(C,L,A,H):U.interrupt().each(function(){T(this,arguments).event(H).start().zoom(null,typeof L=="function"?L.apply(this,arguments):L).end()})},_.scaleBy=function(C,L,A,H){_.scaleTo(C,function(){var U=this.__zoom.k,F=typeof L=="function"?L.apply(this,arguments):L;return U*F},A,H)},_.scaleTo=function(C,L,A,H){_.transform(C,function(){var U=e.apply(this,arguments),F=this.__zoom,Y=A==null?b(U):typeof A=="function"?A.apply(this,arguments):A,Z=F.invert(Y),ne=typeof L=="function"?L.apply(this,arguments):L;return n(I(w(F,ne),Y,Z),U,o)},A,H)},_.translateBy=function(C,L,A,H){_.transform(C,function(){return n(this.__zoom.translate(typeof L=="function"?L.apply(this,arguments):L,typeof A=="function"?A.apply(this,arguments):A),e.apply(this,arguments),o)},null,H)},_.translateTo=function(C,L,A,H,U){_.transform(C,function(){var F=e.apply(this,arguments),Y=this.__zoom,Z=H==null?b(F):typeof H=="function"?H.apply(this,arguments):H;return n(Ur.translate(Z[0],Z[1]).scale(Y.k).translate(typeof L=="function"?-L.apply(this,arguments):-L,typeof A=="function"?-A.apply(this,arguments):-A),F,o)},H,U)};function w(C,L){return L=Math.max(s[0],Math.min(s[1],L)),L===C.k?C:new qt(L,C.x,C.y)}function I(C,L,A){var H=L[0]-A[0]*C.k,U=L[1]-A[1]*C.k;return H===C.x&&U===C.y?C:new qt(C.k,H,U)}function b(C){return[(+C[0][0]+ +C[1][0])/2,(+C[0][1]+ +C[1][1])/2]}function E(C,L,A,H){C.on("start.zoom",function(){T(this,arguments).event(H).start()}).on("interrupt.zoom end.zoom",function(){T(this,arguments).event(H).end()}).tween("zoom",function(){var U=this,F=arguments,Y=T(U,F).event(H),Z=e.apply(U,F),ne=A==null?b(Z):typeof A=="function"?A.apply(U,F):A,fe=Math.max(Z[1][0]-Z[0][0],Z[1][1]-Z[0][1]),ee=U.__zoom,ce=typeof L=="function"?L.apply(U,F):L,Ee=a(ee.invert(ne).concat(fe/ee.k),ce.invert(ne).concat(fe/ce.k));return function(Me){if(Me===1)Me=ce;else{var ye=Ee(Me),Ve=fe/ye[2];Me=new qt(Ve,ne[0]-ye[0]*Ve,ne[1]-ye[1]*Ve)}Y.zoom(null,Me)}})}function T(C,L,A){return!A&&C.__zooming||new M(C,L)}function M(C,L){this.that=C,this.args=L,this.active=0,this.sourceEvent=null,this.extent=e.apply(C,L),this.taps=0}M.prototype={event:function(C){return C&&(this.sourceEvent=C),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(C,L){return this.mouse&&C!=="mouse"&&(this.mouse[1]=L.invert(this.mouse[0])),this.touch0&&C!=="touch"&&(this.touch0[1]=L.invert(this.touch0[0])),this.touch1&&C!=="touch"&&(this.touch1[1]=L.invert(this.touch1[0])),this.that.__zoom=L,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(C){var L=Xe(this.that).datum();c.call(C,this.that,new hp(C,{sourceEvent:this.sourceEvent,target:_,type:C,transform:this.that.__zoom,dispatch:c}),L)}};function k(C,...L){if(!t.apply(this,arguments))return;var A=T(this,L).event(C),H=this.__zoom,U=Math.max(s[0],Math.min(s[1],H.k*Math.pow(2,i.apply(this,arguments)))),F=it(C);if(A.wheel)(A.mouse[0][0]!==F[0]||A.mouse[0][1]!==F[1])&&(A.mouse[1]=H.invert(A.mouse[0]=F)),clearTimeout(A.wheel);else{if(H.k===U)return;A.mouse=[F,H.invert(F)],Li(this),A.start()}Yn(C),A.wheel=setTimeout(Y,m),A.zoom("mouse",n(I(w(H,U),A.mouse[0],A.mouse[1]),A.extent,o));function Y(){A.wheel=null,A.end()}}function x(C,...L){if(f||!t.apply(this,arguments))return;var A=C.currentTarget,H=T(this,L,!0).event(C),U=Xe(C.view).on("mousemove.zoom",ne,!0).on("mouseup.zoom",fe,!0),F=it(C,A),Y=C.clientX,Z=C.clientY;po(C.view),Br(C),H.mouse=[F,this.__zoom.invert(F)],Li(this),H.start();function ne(ee){if(Yn(ee),!H.moved){var ce=ee.clientX-Y,Ee=ee.clientY-Z;H.moved=ce*ce+Ee*Ee>g}H.event(ee).zoom("mouse",n(I(H.that.__zoom,H.mouse[0]=it(ee,A),H.mouse[1]),H.extent,o))}function fe(ee){U.on("mousemove.zoom mouseup.zoom",null),go(ee.view,H.moved),Yn(ee),H.event(ee).end()}}function O(C,...L){if(t.apply(this,arguments)){var A=this.__zoom,H=it(C.changedTouches?C.changedTouches[0]:C,this),U=A.invert(H),F=A.k*(C.shiftKey?.5:2),Y=n(I(w(A,F),H,U),e.apply(this,L),o);Yn(C),l>0?Xe(this).transition().duration(l).call(E,Y,H,C):Xe(this).call(_.transform,Y,H,C)}}function D(C,...L){if(t.apply(this,arguments)){var A=C.touches,H=A.length,U=T(this,L,C.changedTouches.length===H).event(C),F,Y,Z,ne;for(Br(C),Y=0;Y<H;++Y)Z=A[Y],ne=it(Z,this),ne=[ne,this.__zoom.invert(ne),Z.identifier],U.touch0?!U.touch1&&U.touch0[2]!==ne[2]&&(U.touch1=ne,U.taps=0):(U.touch0=ne,F=!0,U.taps=1+!!u);u&&(u=clearTimeout(u)),F&&(U.taps<2&&(d=ne[0],u=setTimeout(function(){u=null},h)),Li(this),U.start())}}function q(C,...L){if(this.__zooming){var A=T(this,L).event(C),H=C.changedTouches,U=H.length,F,Y,Z,ne;for(Yn(C),F=0;F<U;++F)Y=H[F],Z=it(Y,this),A.touch0&&A.touch0[2]===Y.identifier?A.touch0[0]=Z:A.touch1&&A.touch1[2]===Y.identifier&&(A.touch1[0]=Z);if(Y=A.that.__zoom,A.touch1){var fe=A.touch0[0],ee=A.touch0[1],ce=A.touch1[0],Ee=A.touch1[1],Me=(Me=ce[0]-fe[0])*Me+(Me=ce[1]-fe[1])*Me,ye=(ye=Ee[0]-ee[0])*ye+(ye=Ee[1]-ee[1])*ye;Y=w(Y,Math.sqrt(Me/ye)),Z=[(fe[0]+ce[0])/2,(fe[1]+ce[1])/2],ne=[(ee[0]+Ee[0])/2,(ee[1]+Ee[1])/2]}else if(A.touch0)Z=A.touch0[0],ne=A.touch0[1];else return;A.zoom("touch",n(I(Y,Z,ne),A.extent,o))}}function R(C,...L){if(this.__zooming){var A=T(this,L).event(C),H=C.changedTouches,U=H.length,F,Y;for(Br(C),f&&clearTimeout(f),f=setTimeout(function(){f=null},h),F=0;F<U;++F)Y=H[F],A.touch0&&A.touch0[2]===Y.identifier?delete A.touch0:A.touch1&&A.touch1[2]===Y.identifier&&delete A.touch1;if(A.touch1&&!A.touch0&&(A.touch0=A.touch1,delete A.touch1),A.touch0)A.touch0[1]=this.__zoom.invert(A.touch0[0]);else if(A.end(),A.taps===2&&(Y=it(Y,this),Math.hypot(d[0]-Y[0],d[1]-Y[1])<p)){var Z=Xe(this).on("dblclick.zoom");Z&&Z.apply(this,arguments)}}}return _.wheelDelta=function(C){return arguments.length?(i=typeof C=="function"?C:ji(+C),_):i},_.filter=function(C){return arguments.length?(t=typeof C=="function"?C:ji(!!C),_):t},_.touchable=function(C){return arguments.length?(r=typeof C=="function"?C:ji(!!C),_):r},_.extent=function(C){return arguments.length?(e=typeof C=="function"?C:ji([[+C[0][0],+C[0][1]],[+C[1][0],+C[1][1]]]),_):e},_.scaleExtent=function(C){return arguments.length?(s[0]=+C[0],s[1]=+C[1],_):[s[0],s[1]]},_.translateExtent=function(C){return arguments.length?(o[0][0]=+C[0][0],o[1][0]=+C[1][0],o[0][1]=+C[0][1],o[1][1]=+C[1][1],_):[[o[0][0],o[0][1]],[o[1][0],o[1][1]]]},_.constrain=function(C){return arguments.length?(n=C,_):n},_.duration=function(C){return arguments.length?(l=+C,_):l},_.interpolate=function(C){return arguments.length?(a=C,_):a},_.on=function(){var C=c.on.apply(c,arguments);return C===c?_:C},_.clickDistance=function(C){return arguments.length?(g=(C=+C)*C,_):Math.sqrt(g)},_.tapDistance=function(C){return arguments.length?(p=+C,_):p},_}function vp(t,e,n=null,i,r=null){const s=Xe(t);s.selectAll("*").remove();const o=s.node(),l=o.getBoundingClientRect();let a=l.width||800,c=l.height||600;const u=a/2,d=c/2,f=s.append("canvas").attr("class","network-canvas").attr("width",a).attr("height",c).style("width",a+"px").style("height",c+"px").style("cursor","default"),h=f.node().getContext("2d",{alpha:!1});let m=Ur;const g=new Set,p={current:null};function _(){const D=o.getBoundingClientRect(),q=D.width||800,R=D.height||600;(q!==a||R!==c)&&(a=q,c=R,f.attr("width",a).attr("height",c).style("width",a+"px").style("height",c+"px"),O())}const w=new ResizeObserver(_);w.observe(o);const I=Xo(e).force("link",Go(n).id(D=>D.id).distance(D=>D.distance)).force("charge",Jo().strength(-250)).force("center",Uo(u,d).strength(.7)).force("collide",Ko(D=>D.radius+10).strength(.5)).force("x",Qo(u).strength(.025)).force("y",Zo(d).strength(.025)).alphaDecay(.05).velocityDecay(.6);let b=null;I.on("tick",()=>{b||(b=requestAnimationFrame(()=>{O(),b=null}))}),I.tick(100);for(let D=0;D<100;D++)I.tick();I.alphaTarget(0);const E=yp({canvas:f,nodes:e,transform:()=>m,hoveredNode:p,onSelectionChange:(D,q)=>{g.clear(),D.forEach(C=>g.add(C));const R=wp(e,D,q);i(R),O()},render:()=>O()}),T=cl().scaleExtent([.1,10]).filter(D=>!E.isSelectionMode()||D.type==="wheel").on("zoom",({transform:D})=>{m=D,O()});f.call(T);const{dragstarted:M,dragged:k,dragended:x}=bp(f,e,I,()=>m,p,()=>!E.isSelectionMode(),O);E.setupInteractions(f,{start:M,drag:k,end:x});function O(){h.save(),h.fillRect(0,0,a,c),h.translate(m.x,m.y),h.scale(m.k,m.k),h.strokeStyle="#8a8a8a",h.lineWidth=1/m.k,n.forEach(q=>{const R=q.source.x,C=q.source.y,L=q.target.x,A=q.target.y;h.globalAlpha=Math.max(.2,q.strength),h.lineWidth=q.width/m.k,h.beginPath(),h.moveTo(R,C),h.lineTo(L,A),h.stroke()}),h.globalAlpha=1,e.forEach(q=>{const R=g.has(q.id);h.fillStyle=q.color,h.beginPath(),h.arc(q.x,q.y,q.radius,0,2*Math.PI),h.fill(),R&&(h.strokeStyle="#0f2bff",h.lineWidth=3/m.k,h.stroke())});const D=E.getSelectionRect();if(D){h.strokeStyle="#0f2bff",h.fillStyle="rgba(15, 43, 255, 0.2)",h.lineWidth=2/m.k;const q=Math.min(D.x1,D.x2),R=Math.min(D.y1,D.y2),C=Math.abs(D.x2-D.x1),L=Math.abs(D.y2-D.y1);h.fillRect(q,R,C,L),h.strokeRect(q,R,C,L)}h.restore()}return O(),{destroy:()=>{b&&cancelAnimationFrame(b),I.stop(),w.disconnect(),f.remove()},toggleSelectionMode:()=>{const D=E.toggleSelectionMode();return r&&r(D),O(),D}}}function yp(t){const{canvas:e,nodes:n,transform:i,hoveredNode:r,onSelectionChange:s,render:o}=t,l=new Set,a=[];let c=!1,u=null;function d(){return c=!c,e.style("cursor",c?"crosshair":"default"),c}function f(g){if(l.has(g)){l.delete(g);const p=a.indexOf(g);p>-1&&a.splice(p,1)}else l.add(g),a.push(g);s(l,a)}function h(g,p){const _=i(),w=(g-_.x)/_.k,I=(p-_.y)/_.k;for(let b=n.length-1;b>=0;b--){const E=n[b],T=w-E.x,M=I-E.y;if(Math.sqrt(T*T+M*M)<E.radius)return E}return null}function m(g,p){let _=null;g.on("mousedown",function(w){const[I,b]=it(w),E=h(I,b);if(c){const T=i(),M=(I-T.x)/T.k,k=(b-T.y)/T.k;u={x1:M,y1:k,x2:M,y2:k},o()}else E&&(_=E,p.start(w,E))}),g.on("mousemove",function(w){const[I,b]=it(w);if(c){if(u){const E=i(),T=(I-E.x)/E.k,M=(b-E.y)/E.k;u.x2=T,u.y2=M,o()}}else if(_)p.drag(w,_,I,b);else{const E=h(I,b);r.current!==E&&(r.current=E,g.style("cursor",E?"pointer":"default"),o())}}),g.on("mouseup",function(w){if(c){if(u){const I=Math.min(u.x1,u.x2),b=Math.min(u.y1,u.y2),E=Math.max(u.x1,u.x2),T=Math.max(u.y1,u.y2);l.clear(),a.length=0;const M=[];n.forEach(k=>{k.x>=I&&k.x<=E&&k.y>=b&&k.y<=T&&M.push({id:k.id,y:k.y})}),M.sort((k,x)=>k.y-x.y),M.forEach(({id:k})=>{l.add(k),a.push(k)}),s(l,a),u=null,o()}}else if(_)p.end(w,_),_=null;else{const[I,b]=it(w),E=h(I,b);E&&f(E.id)}})}return{toggleSelectionMode:d,isSelectionMode:()=>c,setupInteractions:m,getSelectionRect:()=>u}}function bp(t,e,n,i,r,s,o){let l=null;function a(d,f){s()&&(d.active||n.alphaTarget(.3).restart(),l=f,f.fx=f.x,f.fy=f.y)}function c(d,f,h,m){if(!l||!s())return;const g=i();f.fx=(h-g.x)/g.k,f.fy=(m-g.y)/g.k,o()}function u(d,f){!l||!s()||(d.active||n.alphaTarget(0),f.fx=null,f.fy=null,l=null)}return{dragstarted:a,dragged:c,dragended:u}}function wp(t,e,n){const i=new Map(t.map(r=>[r.id,r]));return n.map(r=>i.get(r)).filter(Boolean)}const ul=8,Sp=1.5,kp=50,fl=.5,Ep=800,Cp=600;function Ip(t,e,n=null,i=null,r=null){const s=Ep/2,o=Cp/2,a=Xe(t).append("svg").attr("class","network-svg"),c=a.append("g"),u=c.append("g").selectAll("line").data(n).join("line").attr("class","link").attr("stroke-width",m=>m.width||Sp).attr("stroke-opacity",m=>Math.max(.2,m.strength||fl)),d=c.append("g").selectAll("circle").data(e).join("circle").attr("class","node").attr("r",m=>m.radius||ul).attr("fill",m=>m.color);d.append("title").text(m=>m.label);const f=Xo(e).force("link",Go(n).id(m=>m.id).distance(m=>m.distance||kp)).force("charge",Jo().strength(-250)).force("center",Uo(s,o).strength(.7)).force("collide",Ko(m=>(m.radius||ul)+10).strength(fl)).force("x",Qo(s).strength(.025)).force("y",Zo(o).strength(.025));let h=null;if(i){h=Mp({svg:a,g:c,nodes:e,onSelectionChange:(_,w)=>{d.classed("selected",b=>_.has(b.id));const I=Ap(e,_,w);i(I)}}),a.call(cl().scaleExtent([.1,10]).filter(_=>!h.isSelectionMode()||_.type==="wheel").on("zoom",({transform:_})=>c.attr("transform",_)));const{dragstarted:m,dragged:g,dragended:p}=xp(f,u,d);h.setupNodeClick(d),h.setupDrag(d,{start:m,drag:g,end:p})}return{destroy:()=>{f.stop(),a.remove()},toggleSelectionMode:()=>{if(h){const m=h.toggleSelectionMode();return r&&r(m),m}}}}function Mp(t){const{svg:e,g:n,nodes:i,onSelectionChange:r,getNodePosition:s=g=>({x:g.x,y:g.y}),getNodeId:o=g=>g.id}=t,l=new Set,a=[];let c=!1;function u(){return c=!c,e.style("cursor",c?"crosshair":"default"),c}function d(g){if(l.has(g)){l.delete(g);const p=a.indexOf(g);p>-1&&a.splice(p,1)}else l.add(g),a.push(g);r(l,a)}function f(){l.clear(),a.length=0,r(l,a)}let h=null,m=null;return e.on("mousedown",function(g){if(!c)return;g.preventDefault();const[p,_]=it(g,n.node());h={x:p,y:_},m=n.append("rect").attr("class","selection-rect").attr("x",p).attr("y",_).attr("width",0).attr("height",0)}).on("mousemove",function(g){if(!c||!m)return;const[p,_]=it(g,n.node()),w=p-h.x,I=_-h.y;m.attr("x",w<0?p:h.x).attr("y",I<0?_:h.y).attr("width",Math.abs(w)).attr("height",Math.abs(I))}).on("mouseup",function(g){if(!c||!m)return;const[p,_]=it(g,n.node()),w=Math.min(h.x,p),I=Math.min(h.y,_),b=Math.max(h.x,p),E=Math.max(h.y,_);l.clear(),a.length=0;const T=[];i.forEach(M=>{const k=s(M);k.x>=w&&k.x<=b&&k.y>=I&&k.y<=E&&T.push({id:o(M),y:k.y})}),T.sort((M,k)=>M.y-k.y),T.forEach(({id:M})=>{l.add(M),a.push(M)}),r(l,a),m.remove(),m=null,h=null}),{toggleSelectionMode:u,toggleNode:d,clearSelection:f,isSelectionMode:()=>c,getSelectedNodes:()=>l,getSelectionOrder:()=>a,setupNodeClick:g=>{g.on("click",function(p,_){p.stopPropagation(),d(o(_))})},setupDrag:(g,p)=>{g.call(Nh().filter(()=>!c).on("start",p.start).on("drag",p.drag).on("end",p.end))}}}function xp(t,e,n){t.on("tick",()=>{e.attr("x1",o=>o.source.x).attr("y1",o=>o.source.y).attr("x2",o=>o.target.x).attr("y2",o=>o.target.y),n.attr("cx",o=>o.x).attr("cy",o=>o.y)});function i(o){o.active||t.alphaTarget(.3).restart(),o.subject.fx=o.subject.x,o.subject.fy=o.subject.y}function r(o){o.subject.fx=o.x,o.subject.fy=o.y}function s(o){o.active||t.alphaTarget(0),o.subject.fx=null,o.subject.fy=null}return{dragstarted:i,dragged:r,dragended:s}}function Ap(t,e,n){const i=new Map(t.map(r=>[r.id,r]));return n.map(r=>i.get(r)).filter(Boolean)}const Np="modulepreload",Tp=function(t){return"/"+t},hl={},qr=function(e,n,i){return e()};function Kr(t){const{type:e,modelName:n,title:i,extractMeta:r=h=>h}=t,s={id:null,type:e,title:i,selected:{}},o=JSON.parse(localStorage.getItem(e))||s,l=we(o),a=we(!1);function c(h,m=!1){a.set(m),localStorage.setItem(e,JSON.stringify(h))}function u(){l.update(h=>{if(e!=="documentSet")return console.error("Document set management is the only type currently supported for saving."),h;const m=Object.fromEntries(Object.entries(h.selected).map(([p,_])=>[p,Object.keys(_)])),g=h.id?`${h.id}/edit`:"new";return fetch(`${window.location.origin}/${n}/${g}`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":Xt},body:JSON.stringify({title:h.title,selection:h,...m})}).then(p=>p.json()).then(p=>{if(!(p!=null&&p.document_set_id))throw new Error("Failed to save");l.update(_=>(_.id=p.document_set_id,_.title=p.document_set_title,c(_,!0),_))}).catch(p=>console.error("Error:",p)),h})}const d=h=>l.update(()=>{const m=h.selection.id?h.selection:{...h.selection,id:h.id};return c(m),m}),f=()=>l.update(()=>{const h={...s,selected:{}};return c(h),h});return{type:e,subscribe:l.subscribe,add:h=>l.update(m=>(m.selected[h.class]={...m.selected[h.class]||{},[h.id]:r(h)},c(m),m)),addAll:h=>l.update(m=>(h.forEach(g=>{m.selected[g.class]={...m.selected[g.class]||{},[g.id]:r(g)}}),c(m),m)),remove:(h,m)=>l.update(g=>{const{[h]:p,..._}=g.selected[m];return g.selected[m]=_,c(g),g}),removeAll:(h,m)=>l.update(g=>(h.forEach(p=>{var _;return(_=g.selected[m])==null?!0:delete _[p]}),c(g),g)),toggle:h=>l.update(m=>{var g;if((g=m.selected[h.class])!=null&&g[h.id]){const{[h.id]:p,..._}=m.selected[h.class];m.selected[h.class]=_}else m.selected[h.class]={...m.selected[h.class]||{},[h.id]:r(h)};return c(m),m}),toggleSet:h=>{tt(l).id===h.id?f():d(h)},empty:()=>l.update(h=>(h.id=null,h.title=i,h.selected={},c(h,!0),h)),updateTitle:h=>l.update(m=>(m.title=h,c(m,!0),m)),save:u,isSaved:a,selection:l,selectionTitle:Be(l,h=>h.title),isSelected:Be(l,h=>m=>{var g;return((g=h.selected[m.class])==null?void 0:g[m.id])||!1}),selected:Be(l,h=>h.selected),nbSelected:Be(l,h=>Object.values(h.selected).reduce((m,g)=>m+Object.keys(g).length,0)),isSetSelected:Be(l,h=>m=>h.id===m.id)}}Kr({type:"documentSet",modelName:"document-set",title:W==="en"?"Document set":"Set de documents",extractMeta:t=>({title:t.title,url:t.url})});const Op=Kr({type:"regionsSet",modelName:"regions-set",title:W==="en"?"Regions set":"Set de régions",extractMeta:t=>t}),Fi=Kr({type:"clusterSet",modelName:"cluster-set",title:W==="en"?"Selected regions":"Régions sélectionnées",extractMeta:t=>({imgRef:t.id,clusterId:t.clusterId,title:t.title,xywh:t.xywh,img:t.img})});function Pp(){const t=`${window.location.origin}${window.location.pathname}`,e=we(1),n=we({}),i=we({}),r=we("");cr(e,"p");function s(u){r.update(d=>{const f=d===u?"":u;return navigator.clipboard.writeText(f).then(h=>""),f})}const o=(async()=>{try{const u=await fetch(`${t}canvas`);if(!u.ok)return{};const d=await u.json();let f={};return Object.values(d).forEach(h=>{Object.entries(h).forEach(([m,g])=>{f[m]=g})}),n.set(f),d}catch{return{}}})(),l=Be(e,u=>(async()=>{const f=await(await fetch(`${t}canvas?p=${u}`)).json();return i.set(f),f})());function a(u){ur(u,e,"p")}function c(u){n.update(d=>(delete d[u],{...d})),i.update(d=>{for(const f in d)if(d[f][u]){const{[u]:h,...m}=d[f];return d[f]=m,d}return d})}return{currentPage:e,pageRegions:i,allRegions:n,fetchPages:l,fetchAll:o,handlePageUpdate:a,remove:c,clipBoard:r,copyRef:s}}const dl=Pp(),yy="";function Lp(t){let e;return{c(){e=Et("path"),v(e,"d","M384 336H192c-8.8 0-16-7.2-16-16V64c0-8.8 7.2-16 16-16l140.1 0L400 115.9V320c0 8.8-7.2 16-16 16zM192 384H384c35.3 0 64-28.7 64-64V115.9c0-12.7-5.1-24.9-14.1-33.9L366.1 14.1c-9-9-21.2-14.1-33.9-14.1H192c-35.3 0-64 28.7-64 64V320c0 35.3 28.7 64 64 64zM64 128c-35.3 0-64 28.7-64 64V448c0 35.3 28.7 64 64 64H256c35.3 0 64-28.7 64-64V416H272v32c0 8.8-7.2 16-16 16H64c-8.8 0-16-7.2-16-16V192c0-8.8 7.2-16 16-16H96V128H64z"),v(e,"class","svelte-1829hp2")},m(n,i){z(n,e,i)},d(n){n&&$(e)}}}function Dp(t){let e;return{c(){e=Et("path"),v(e,"d","M208 0H332.1c12.7 0 24.9 5.1 33.9 14.1l67.9 67.9c9 9 14.1 21.2 14.1 33.9V336c0 26.5-21.5 48-48 48H208c-26.5 0-48-21.5-48-48V48c0-26.5 21.5-48 48-48zM48 128h80v64H64V448H256V416h64v48c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V176c0-26.5 21.5-48 48-48z"),v(e,"class","svelte-1829hp2")},m(n,i){z(n,e,i)},d(n){n&&$(e)}}}function Rp(t){let e=W==="en"?"Copy ID":"Copier l'ID",n;return{c(){n=te(e)},m(i,r){z(i,n,r)},p:X,d(i){i&&$(n)}}}function $p(t){let e=W==="en"?"Copied!":"Copié !",n;return{c(){n=te(e)},m(i,r){z(i,n,r)},p:X,d(i){i&&$(n)}}}function ml(t){let e,n,i;var r=t[7];function s(o){return{props:{mainImgItem:o[1],compareImgItem:o[14]}}}return r&&(e=ai(r,s(t))),{c(){e&&le(e.$$.fragment),n=Ke()},m(o,l){e&&se(e,o,l),z(o,n,l),i=!0},p(o,l){const a={};if(l&2&&(a.mainImgItem=o[1]),l&128&&r!==(r=o[7])){if(e){Se();const c=e;K(c.$$.fragment,1,0,()=>{oe(c,1)}),ke()}r?(e=ai(r,s(o)),le(e.$$.fragment),V(e.$$.fragment,1),se(e,n.parentNode,n)):e=null}else r&&e.$set(a)},i(o){i||(e&&V(e.$$.fragment,o),i=!0)},o(o){e&&K(e.$$.fragment,o),i=!1},d(o){o&&$(n),e&&oe(e,o)}}}function zp(t){let e,n,i,r,s,o,l,a,c,u,d,f,h,m,g,p,_,w,I,b,E,T,M;function k(L,A){return L[8]?Dp:Lp}let x=k(t),O=x(t);function D(L,A){return L[8]?$p:Rp}let q=D(t),R=q(t),C=t[7]&&ml(t);return{c(){e=S("div"),n=S("figure"),i=S("img"),s=B(),o=S("div"),l=S("span"),u=B(),d=S("div"),f=S("button"),h=Et("svg"),O.c(),m=B(),g=S("span"),R.c(),_=B(),C&&C.c(),v(i,"class","region-img svelte-1829hp2"),pt(i.src,r=t[9])||v(i,"src",r),v(i,"alt","Extracted region"),v(l,"class","overlay-desc"),v(o,"class","overlay is-center svelte-1829hp2"),v(n,"class",a="image card region-image "+(t[0]?"is-96x96":"")+" svelte-1829hp2"),v(n,"tabindex","-1"),v(n,"style",c=(t[2]==="full"?"height: 100%":`height: ${t[2]}px; min-width: ${t[2]}px`)+"; "+(t[3]?`border: 5px solid ${t[3]};`:"")),v(h,"xmlns","http://www.w3.org/2000/svg"),v(h,"viewBox","0 0 384 512"),v(h,"class","svelte-1829hp2"),v(g,"class","tooltip svelte-1829hp2"),v(f,"class","button tag svelte-1829hp2"),v(f,"style",p=t[6]?"":"display: none;"),v(d,"class","region-btn ml-1 svelte-1829hp2"),v(e,"class",w="region is-center "+(t[5]&&t[11](t[1])?"checked":"")+" svelte-1829hp2"),v(e,"style",I=t[2]==="full"?"height: 100%":"")},m(L,A){z(L,e,A),y(e,n),y(n,i),y(n,s),y(n,o),y(o,l),l.innerHTML=t[10],y(e,u),y(e,d),y(d,f),y(f,h),O.m(h,null),y(f,m),y(f,g),R.m(g,null),y(d,_),C&&C.m(d,null),E=!0,T||(M=[be(n,"click",t[19]),be(n,"keyup",jp),be(f,"click",t[20])],T=!0)},p(L,[A]){t=L,(!E||A&512&&!pt(i.src,r=t[9]))&&v(i,"src",r),(!E||A&1024)&&(l.innerHTML=t[10]),(!E||A&1&&a!==(a="image card region-image "+(t[0]?"is-96x96":"")+" svelte-1829hp2"))&&v(n,"class",a),(!E||A&12&&c!==(c=(t[2]==="full"?"height: 100%":`height: ${t[2]}px; min-width: ${t[2]}px`)+"; "+(t[3]?`border: 5px solid ${t[3]};`:"")))&&v(n,"style",c),x!==(x=k(t))&&(O.d(1),O=x(t),O&&(O.c(),O.m(h,null))),q===(q=D(t))&&R?R.p(t,A):(R.d(1),R=q(t),R&&(R.c(),R.m(g,null))),(!E||A&64&&p!==(p=t[6]?"":"display: none;"))&&v(f,"style",p),t[7]?C?(C.p(t,A),A&128&&V(C,1)):(C=ml(t),C.c(),V(C,1),C.m(d,null)):C&&(Se(),K(C,1,1,()=>{C=null}),ke()),(!E||A&2082&&w!==(w="region is-center "+(t[5]&&t[11](t[1])?"checked":"")+" svelte-1829hp2"))&&v(e,"class",w),(!E||A&4&&I!==(I=t[2]==="full"?"height: 100%":""))&&v(e,"style",I)},i(L){E||(V(C),Vt(()=>{E&&(b||(b=Yt(e,bn,{duration:t[15]},!0)),b.run(1))}),E=!0)},o(L){K(C),b||(b=Yt(e,bn,{duration:t[15]},!1)),b.run(0),E=!1},d(L){L&&$(e),O.d(),R.d(),C&&C.d(),L&&b&&b.end(),T=!1,Ye(M)}}}const jp=()=>null;function Fp(t,e,n){let i,r,s,o,l,{selectionStore:a}=e;a||(a=Op);const{isSelected:c}=a;ge(t,c,x=>n(11,l=x));const{clipBoard:u}=dl;ge(t,u,x=>n(18,o=x));let{item:d}=e,{descPromise:f=void 0}=e,{isSquare:h=!0}=e,{height:m=h?96:140}=e;m==="full"&&(h=!1);let{borderColor:g=null}=e,{toggleSelection:p=a.toggle}=e;const _=gt("qImgMetadata")||void 0,w=gt("isInModal")||!1,I=w?0:500;let b;w||qr(()=>Promise.resolve().then(()=>j_),void 0).then(x=>n(7,b=x.default));let{selectable:E=!w}=e,{copyable:T=!0}=e;const M=()=>E?p(d):null,k=()=>T?dl.copyRef(d.ref):null;return t.$$set=x=>{"selectionStore"in x&&n(16,a=x.selectionStore),"item"in x&&n(1,d=x.item),"descPromise"in x&&n(17,f=x.descPromise),"isSquare"in x&&n(0,h=x.isSquare),"height"in x&&n(2,m=x.height),"borderColor"in x&&n(3,g=x.borderColor),"toggleSelection"in x&&n(4,p=x.toggleSelection),"selectable"in x&&n(5,E=x.selectable),"copyable"in x&&n(6,T=x.copyable)},t.$$.update=()=>{t.$$.dirty&2&&n(10,i=d.title),t.$$.dirty&131072&&f&&f.then(x=>n(10,i=x)),t.$$.dirty&7&&n(9,r=Pt(d.img??d.ref,d.xywh,m==="full"?m:h?`${m},`:`,${m}`)),t.$$.dirty&262146&&n(8,s=d.ref===o)},[h,d,m,g,p,E,T,b,s,r,i,l,c,u,_,I,a,f,o,M,k]}class xn extends ve{constructor(e){super(),_e(this,e,Fp,zp,me,{selectionStore:16,item:1,descPromise:17,isSquare:0,height:2,borderColor:3,toggleSelection:4,selectable:5,copyable:6})}}const by="";function pl(t,e,n){const i=t.slice();return i[11]=e[n],i}function gl(t,e,n){const i=t.slice();return i[14]=e[n],i}function Wr(t){const e=t.slice(),n=e[2].get(e[11][e[14]].id);return e[17]=n,e}function _l(t,e,n){const i=t.slice();return i[14]=e[n],i}function vl(t){let e,n,i,r,s,o,l,a,c,u,d=t[0].regions,f=[];for(let _=0;_<d.length;_+=1)f[_]=yl(_l(t,d,_));const h=_=>K(f[_],1,1,()=>{f[_]=null});let m=t[0].rows,g=[];for(let _=0;_<m.length;_+=1)g[_]=Sl(pl(t,m,_));const p=_=>K(g[_],1,1,()=>{g[_]=null});return{c(){e=S("div"),n=S("h3"),n.textContent="Aligned Documents",i=B(),r=S("div"),s=S("table"),o=S("thead"),l=S("tr");for(let _=0;_<f.length;_+=1)f[_].c();a=B(),c=S("tbody");for(let _=0;_<g.length;_+=1)g[_].c();v(n,"class","title is-5"),v(o,"class","region-header svelte-1hxxzoa"),v(s,"class","table is-fullwidth svelte-1hxxzoa"),v(r,"class","table-container svelte-1hxxzoa"),v(e,"class","box mt-4")},m(_,w){z(_,e,w),y(e,n),y(e,i),y(e,r),y(r,s),y(s,o),y(o,l);for(let I=0;I<f.length;I+=1)f[I]&&f[I].m(l,null);y(s,a),y(s,c);for(let I=0;I<g.length;I+=1)g[I]&&g[I].m(c,null);u=!0},p(_,w){if(w&3){d=_[0].regions;let I;for(I=0;I<d.length;I+=1){const b=_l(_,d,I);f[I]?(f[I].p(b,w),V(f[I],1)):(f[I]=yl(b),f[I].c(),V(f[I],1),f[I].m(l,null))}for(Se(),I=d.length;I<f.length;I+=1)h(I);ke()}if(w&77){m=_[0].rows;let I;for(I=0;I<m.length;I+=1){const b=pl(_,m,I);g[I]?(g[I].p(b,w),V(g[I],1)):(g[I]=Sl(b),g[I].c(),V(g[I],1),g[I].m(c,null))}for(Se(),I=m.length;I<g.length;I+=1)p(I);ke()}},i(_){if(!u){for(let w=0;w<d.length;w+=1)V(f[w]);for(let w=0;w<m.length;w+=1)V(g[w]);u=!0}},o(_){f=f.filter(Boolean);for(let w=0;w<f.length;w+=1)K(f[w]);g=g.filter(Boolean);for(let w=0;w<g.length;w+=1)K(g[w]);u=!1},d(_){_&&$(e),nt(f,_),nt(g,_)}}}function yl(t){let e,n,i,r;return n=new hr({props:{id:t[14],meta:t[1].get(t[14])||{},clickable:!1}}),{c(){e=S("th"),le(n.$$.fragment),i=B(),v(e,"class","is-vcentered")},m(s,o){z(s,e,o),se(n,e,null),y(e,i),r=!0},p(s,o){const l={};o&1&&(l.id=s[14]),o&3&&(l.meta=s[1].get(s[14])||{}),n.$set(l)},i(s){r||(V(n.$$.fragment,s),r=!0)},o(s){K(n.$$.fragment,s),r=!1},d(s){s&&$(e),oe(n)}}}function bl(t){let e,n,i,r,s=t[11][t[14]].page+"",o,l;return e=new xn({props:{item:t[17],selectable:!1,copyable:!1,borderColor:t[6](t[11][t[14]],t[3]),isSquare:!1}}),{c(){le(e.$$.fragment),n=B(),i=S("div"),r=te("Page "),o=te(s),v(i,"class","has-text-grey-dark mt-2")},m(a,c){se(e,a,c),z(a,n,c),z(a,i,c),y(i,r),y(i,o),l=!0},p(a,c){const u={};c&5&&(u.item=a[17]),c&9&&(u.borderColor=a[6](a[11][a[14]],a[3])),e.$set(u),(!l||c&1)&&s!==(s=a[11][a[14]].page+"")&&pe(o,s)},i(a){l||(V(e.$$.fragment,a),l=!0)},o(a){K(e.$$.fragment,a),l=!1},d(a){oe(e,a),a&&$(n),a&&$(i)}}}function wl(t){let e,n,i=t[11][t[14]]&&bl(Wr(t));return{c(){e=S("td"),i&&i.c(),v(e,"class","has-text-centered"),De(e,"vertical-align","top")},m(r,s){z(r,e,s),i&&i.m(e,null),n=!0},p(r,s){r[11][r[14]]?i?(i.p(Wr(r),s),s&1&&V(i,1)):(i=bl(Wr(r)),i.c(),V(i,1),i.m(e,null)):i&&(Se(),K(i,1,1,()=>{i=null}),ke())},i(r){n||(V(i),n=!0)},o(r){K(i),n=!1},d(r){r&&$(e),i&&i.d()}}}function Sl(t){let e,n,i,r=t[0].regions,s=[];for(let l=0;l<r.length;l+=1)s[l]=wl(gl(t,r,l));const o=l=>K(s[l],1,1,()=>{s[l]=null});return{c(){e=S("tr");for(let l=0;l<s.length;l+=1)s[l].c();n=B()},m(l,a){z(l,e,a);for(let c=0;c<s.length;c+=1)s[c]&&s[c].m(e,null);y(e,n),i=!0},p(l,a){if(a&77){r=l[0].regions;let c;for(c=0;c<r.length;c+=1){const u=gl(l,r,c);s[c]?(s[c].p(u,a),V(s[c],1)):(s[c]=wl(u),s[c].c(),V(s[c],1),s[c].m(e,n))}for(Se(),c=r.length;c<s.length;c+=1)o(c);ke()}},i(l){if(!i){for(let a=0;a<r.length;a+=1)V(s[a]);i=!0}},o(l){s=s.filter(Boolean);for(let a=0;a<s.length;a+=1)K(s[a]);i=!1},d(l){l&&$(e),nt(s,l)}}}function Vp(t){let e,n,i=t[0]&&vl(t);return{c(){i&&i.c(),e=Ke()},m(r,s){i&&i.m(r,s),z(r,e,s),n=!0},p(r,[s]){r[0]?i?(i.p(r,s),s&1&&V(i,1)):(i=vl(r),i.c(),V(i,1),i.m(e.parentNode,e)):i&&(Se(),K(i,1,1,()=>{i=null}),ke())},i(r){n||(V(i),n=!0)},o(r){K(i),n=!1},d(r){i&&i.d(r),r&&$(e)}}}function Hp(t){let e=0;for(let o=0;o<t.length;o++)e=t.charCodeAt(o)+((e<<5)-e),e=e&e;const i=e*.618033988749895%1*360,r=65+e%20,s=80+e%10;return`hsl(${Math.floor(i)}, ${r}%, ${s}%)`}function Up(t,e,n){let i,r,s,{selectedDocuments:o=[]}=e,{documentSetStore:l}=e;const{buildAlignedImageMatrix:a,documentNodes:c,imageNodes:u}=l;ge(t,c,m=>n(1,r=m)),ge(t,u,m=>n(2,s=m));let d=null;function f(m,g){if(!m)return;const p=m.id;if(g.get(p)!==1)return h.has(p)||h.set(p,Hp(p)),h.get(p)}const h=new Map;return t.$$set=m=>{"selectedDocuments"in m&&n(7,o=m.selectedDocuments),"documentSetStore"in m&&n(8,l=m.documentSetStore)},t.$$.update=()=>{if(t.$$.dirty&134)if(o.length>0&&s&&r){const m=o.map(g=>g.id);n(0,d=a(m))}else n(0,d=null);t.$$.dirty&1&&n(3,i=d?(()=>{const m=new Map;return d.rows.forEach(g=>{Object.values(g).forEach(p=>{m.set(p.id,(m.get(p.id)||0)+1)})}),m})():new Map)},[d,r,s,i,c,u,f,o,l]}class Bp extends ve{constructor(e){super(),_e(this,e,Up,Vp,me,{selectedDocuments:7,documentSetStore:8})}}const wy="";function kl(t,e,n){const i=t.slice();return i[15]=e[n],i}function qp(t){let e;return{c(){e=S("span"),e.innerHTML='<i class="fas fa-crop-alt"></i>',v(e,"class","icon px-4")},m(n,i){z(n,e,i)},d(n){n&&$(e)}}}function Kp(t){let e;return{c(){e=S("span"),e.innerHTML='<i class="fas fa-hand-pointer"></i>',v(e,"class","icon px-4")},m(n,i){z(n,e,i)},d(n){n&&$(e)}}}function El(t){let e,n,i,r;const s=[Gp,Wp],o=[];function l(a,c){return a[0]==="img"?0:a[0]==="doc"?1:-1}return~(e=l(t))&&(n=o[e]=s[e](t)),{c(){n&&n.c(),i=Ke()},m(a,c){~e&&o[e].m(a,c),z(a,i,c),r=!0},p(a,c){let u=e;e=l(a),e===u?~e&&o[e].p(a,c):(n&&(Se(),K(o[u],1,1,()=>{o[u]=null}),ke()),~e?(n=o[e],n?n.p(a,c):(n=o[e]=s[e](a),n.c()),V(n,1),n.m(i.parentNode,i)):n=null)},i(a){r||(V(n),r=!0)},o(a){K(n),r=!1},d(a){~e&&o[e].d(a),a&&$(i)}}}function Wp(t){let e,n;return e=new Bp({props:{selectedDocuments:t[5],documentSetStore:t[1]}}),{c(){le(e.$$.fragment)},m(i,r){se(e,i,r),n=!0},p(i,r){const s={};r&32&&(s.selectedDocuments=i[5]),r&2&&(s.documentSetStore=i[1]),e.$set(s)},i(i){n||(V(e.$$.fragment,i),n=!0)},o(i){K(e.$$.fragment,i),n=!1},d(i){oe(e,i)}}}function Gp(t){let e,n,i=W==="en"?"Selected regions":"Régions sélectionnées",r,s,o=t[5].length+"",l,a,c,u,d=[],f=new Map,h,m=t[5];const g=p=>p[15].id;for(let p=0;p<m.length;p+=1){let _=kl(t,m,p),w=g(_);f.set(w,d[p]=Cl(w,_))}return{c(){e=S("div"),n=S("h3"),r=te(i),s=te(" ("),l=te(o),a=te(")"),c=B(),u=S("div");for(let p=0;p<d.length;p+=1)d[p].c();v(n,"class","title is-5"),v(u,"class","selected-nodes grid is-gap-2 mt-5 svelte-1a3kdxu"),v(e,"class","selected-panel box mt-4 svelte-1a3kdxu")},m(p,_){z(p,e,_),y(e,n),y(n,r),y(n,s),y(n,l),y(n,a),y(e,c),y(e,u);for(let w=0;w<d.length;w+=1)d[w]&&d[w].m(u,null);h=!0},p(p,_){(!h||_&32)&&o!==(o=p[5].length+"")&&pe(l,o),_&32&&(m=p[5],Se(),d=sr(d,_,g,1,p,m,f,u,rr,Cl,null,kl),ke())},i(p){if(!h){for(let _=0;_<m.length;_+=1)V(d[_]);h=!0}},o(p){for(let _=0;_<d.length;_+=1)K(d[_]);h=!1},d(p){p&&$(e);for(let _=0;_<d.length;_+=1)d[_].d()}}}function Cl(t,e){let n,i,r;return i=new xn({props:{item:e[15],selectable:!1,copyable:!1}}),{key:t,first:null,c(){n=Ke(),le(i.$$.fragment),this.first=n},m(s,o){z(s,n,o),se(i,s,o),r=!0},p(s,o){e=s;const l={};o&32&&(l.item=e[15]),i.$set(l)},i(s){r||(V(i.$$.fragment,s),r=!0)},o(s){K(i.$$.fragment,s),r=!1},d(s){s&&$(n),oe(i,s)}}}function Yp(t){let e,n,i,r=t[3]?"click":"selection",s,o,l,a,c,u,d,f;function h(_,w){return _[3]?Kp:qp}let m=h(t),g=m(t),p=t[5].length>0&&El(t);return{c(){e=S("div"),n=S("button"),g.c(),i=te(`
        Switch to `),s=te(r),o=te(" mode"),l=B(),a=S("div"),c=B(),p&&p.c(),v(n,"class","toggle-button button is-small is-link mb-3"),v(a,"class","visualization-container")},m(_,w){z(_,e,w),y(e,n),g.m(n,null),y(n,i),y(n,s),y(n,o),y(e,l),y(e,a),t[9](a),y(e,c),p&&p.m(e,null),u=!0,d||(f=be(n,"click",t[7]),d=!0)},p(_,[w]){m!==(m=h(_))&&(g.d(1),g=m(_),g&&(g.c(),g.m(n,i))),(!u||w&8)&&r!==(r=_[3]?"click":"selection")&&pe(s,r),_[5].length>0?p?(p.p(_,w),w&32&&V(p,1)):(p=El(_),p.c(),V(p,1),p.m(e,null)):p&&(Se(),K(p,1,1,()=>{p=null}),ke())},i(_){u||(V(p),u=!0)},o(_){K(p),u=!1},d(_){_&&$(e),g.d(),t[9](null),p&&p.d(),d=!1,f()}}}const Xp=1e3;function Jp(t,e,n){let i,r,s=X,o=()=>(s(),s=ri(i,b=>n(8,r=b)),i),l;t.$$.on_destroy.push(()=>s());let{type:a="img"}=e,{documentSetStore:c}=e;const{imageNetwork:u,documentNetwork:d,selectedNodes:f,updateSelectedNodes:h}=c;ge(t,f,b=>n(5,l=b));let m,g,p=!1;function _(){m&&(m.destroy(),h([]));function b(T){h(T)}m=(r.nodes.length<Xp?Ip:vp)(g,r.nodes,r.links,b,T=>{n(3,p=T)}),n(3,p=a==="img"),p&&m.toggleSelectionMode()}function w(){m&&n(3,p=m.toggleSelectionMode())}Dn(()=>{m==null||m.destroy()});function I(b){gn[b?"unshift":"push"](()=>{g=b,n(2,g)})}return t.$$set=b=>{"type"in b&&n(0,a=b.type),"documentSetStore"in b&&n(1,c=b.documentSetStore)},t.$$.update=()=>{t.$$.dirty&1&&o(n(4,i=a==="img"?u:d)),t.$$.dirty&260&&r&&g&&_()},[a,c,g,p,i,l,f,w,r,I]}class Qp extends ve{constructor(e){super(),_e(this,e,Jp,Yp,me,{type:0,documentSetStore:1})}}const Sy="";function Il(t,e,n){const i=t.slice();return i[20]=e[n],i[22]=n,i}function Zp(t){let e,n,i,r,s,o,l,a,c,u,d,f=t[3],h=[];for(let p=0;p<f.length;p+=1)h[p]=Ml(Il(t,f,p));const m=p=>K(h[p],1,1,()=>{h[p]=null});let g=t[2]&&xl(t);return{c(){e=S("div"),n=S("h3"),n.textContent="Similarity Matrix",i=B(),r=S("div"),s=S("div"),o=S("div");for(let p=0;p<h.length;p+=1)h[p].c();l=B(),a=S("div"),c=B(),g&&g.c(),u=Ke(),v(n,"class","title is-5"),v(o,"class","row-headers svelte-naitnw"),v(a,"class","matrix-container svelte-naitnw"),v(s,"class","matrix-content svelte-naitnw"),v(r,"class","matrix-wrapper svelte-naitnw"),v(e,"class","matrix-panel column svelte-naitnw")},m(p,_){z(p,e,_),y(e,n),y(e,i),y(e,r),y(r,s),y(s,o);for(let w=0;w<h.length;w+=1)h[w]&&h[w].m(o,null);y(s,l),y(s,a),t[13](a),z(p,c,_),g&&g.m(p,_),z(p,u,_),d=!0},p(p,_){if(_&8){f=p[3];let w;for(w=0;w<f.length;w+=1){const I=Il(p,f,w);h[w]?(h[w].p(I,_),V(h[w],1)):(h[w]=Ml(I),h[w].c(),V(h[w],1),h[w].m(o,null))}for(Se(),w=f.length;w<h.length;w+=1)m(w);ke()}p[2]?g?g.p(p,_):(g=xl(p),g.c(),g.m(u.parentNode,u)):g&&(g.d(1),g=null)},i(p){if(!d){for(let _=0;_<f.length;_+=1)V(h[_]);d=!0}},o(p){h=h.filter(Boolean);for(let _=0;_<h.length;_+=1)K(h[_]);d=!1},d(p){p&&$(e),nt(h,p),t[13](null),p&&$(c),g&&g.d(p),p&&$(u)}}}function eg(t){let e;return{c(){e=S("div"),e.textContent="Aucun document disponible pour afficher la matrice de similarité.",v(e,"class","notification is-info")},m(n,i){z(n,e,i)},p:X,i:X,o:X,d(n){n&&$(e)}}}function Ml(t){let e,n,i,r;return n=new hr({props:{id:t[20].id,meta:t[20],onlyColor:!0,clickable:!1}}),{c(){e=S("div"),le(n.$$.fragment),i=B(),v(e,"class","row-header svelte-naitnw"),De(e,"height",Qt+"px"),De(e,"line-height",Qt+"px")},m(s,o){z(s,e,o),se(n,e,null),y(e,i),r=!0},p(s,o){const l={};o&8&&(l.id=s[20].id),o&8&&(l.meta=s[20]),n.$set(l)},i(s){r||(V(n.$$.fragment,s),r=!0)},o(s){K(n.$$.fragment,s),r=!1},d(s){s&&$(e),oe(n)}}}function xl(t){let e,n,i,r;return{c(){e=S("div"),n=S("h3"),n.textContent="Page-by-page similarity",i=B(),r=S("div"),v(n,"class","title is-5"),v(r,"class","scatter-container svelte-naitnw"),v(e,"class","scatter-panel column svelte-naitnw")},m(s,o){z(s,e,o),y(e,n),y(e,i),y(e,r),t[14](r)},p:X,d(s){s&&$(e),t[14](null)}}}function tg(t){let e,n,i,r;const s=[eg,Zp],o=[];function l(a,c){return a[3].length?1:0}return n=l(t),i=o[n]=s[n](t),{c(){e=S("div"),i.c(),v(e,"class","document-matrix columns svelte-naitnw")},m(a,c){z(a,e,c),o[n].m(e,null),r=!0},p(a,[c]){let u=n;n=l(a),n===u?o[n].p(a,c):(Se(),K(o[u],1,1,()=>{o[u]=null}),ke(),i=o[n],i?i.p(a,c):(i=o[n]=s[n](a),i.c()),V(i,1),i.m(e,null))},i(a){r||(V(i),r=!0)},o(a){K(i),r=!1},d(a){a&&$(e),o[n].d()}}}const Qt=30;function ng(t,e){const n=[];let i=0;e.forEach(({score:r})=>{r>i&&(i=r)});for(let r=0;r<t.length;r++){const s=[];for(let o=0;o<t.length;o++)if(r===o)s.push({score:0,normalized:0,isDiagonal:!0});else{const{r1:l,r2:a}={r1:t[r].id,r2:t[o].id},c=l<a?`${l}-${a}`:`${a}-${l}`,u=e.get(c),d=(u==null?void 0:u.score)||0,f=i>0?d/i*100:0;s.push({score:d,normalized:f,isDiagonal:!1})}n.push(s)}return{docs:t,matrix:n,max:i}}function ig(t,e,n=.05,i=1){const{min:r,_:s,range:o}=e;return o===0?.55:n+Math.pow((t-r)/o,3)*i}function rg(t,e,n){let i,r,s,o,l,a,c,{documentSetStore:u}=e;const{documentNodes:d,docPairStats:f,pairIndex:h,selectedCategories:m}=u;ge(t,d,M=>n(12,c=M)),ge(t,f,M=>n(11,a=M)),ge(t,h,M=>n(16,l=M)),ge(t,m,M=>n(15,o=M));let g,p,_=null;function w(M){const{doc1:k,doc2:x}=M,O=k.id<x.id?`${k.id}-${x.id}`:`${x.id}-${k.id}`,D=l.byDocPair.get(O)||[];if(!D.length)return null;const q=new Map;let R=1/0,C=-1/0;return D.forEach(A=>{let H,U,F;A.regions_id_1===k.id?(H=A.page_1,U=A.page_2,F=A.weightedScore||0):(H=A.page_2,U=A.page_1,F=A.weightedScore||0);const Y=`${H}-${U}`;q.has(Y)||q.set(Y,{page1:H,page2:U,scores:[],count:0});const Z=q.get(Y);Z.scores.push(F),Z.count++,F<R&&(R=F),F>C&&(C=F)}),{points:Array.from(q.values()).map(({page1:A,page2:H,scores:U,count:F})=>{const Y=U.reduce((Z,ne)=>Z+ne,0)/F;return{page1:A,page2:H,score:Y,count:F}}),minScore:R,maxScore:C,doc1:k,doc2:x}}function I(M,k){if(!M||!k.docs.length)return;Xe(M).selectAll("*").remove();const x={top:10,right:20,bottom:20,left:10},O=k.docs.length*Qt+x.left+x.right,D=k.docs.length*Qt+x.top+x.bottom;Xe(M).append("svg").attr("width",O).attr("height",D).append("g").attr("transform",`translate(${x.left},${x.top})`).selectAll(".row").data(k.matrix).join("g").attr("class","row").attr("transform",(L,A)=>`translate(0,${A*Qt})`).selectAll(".cell").data((L,A)=>L.map((H,U)=>({...H,row:A,col:U}))).join("rect").attr("class","cell").attr("x",L=>L.col*Qt).attr("width",Qt).attr("height",Qt).attr("fill",L=>{if(L.isDiagonal)return"#e0e0e0";const A=Er(233,.951,.52);return A.opacity=L.normalized/100,A}).attr("stroke",L=>_&&_.row===L.row&&_.col===L.col?"#000":"#fff").attr("stroke-width",L=>_&&_.row===L.row&&_.col===L.col?4:1).attr("stroke-opacity",L=>_&&_.row===L.row&&_.col===L.col?1:.3).style("cursor","pointer").on("click",(L,A)=>{n(2,_={row:A.row,col:A.col,doc1:k.docs[A.row],doc2:k.docs[A.col]}),I(M,k)})}function b(M,k){if(!M)return;if(Xe(M).selectAll("*").remove(),!k||!k.points.length){Xe(M).append("div").style("padding","2rem").style("text-align","center").style("color","#999").text("Aucune paire de pages trouvée entre ces deux documents.");return}const x={top:40,right:20,bottom:50,left:60},O=500-x.left-x.right,D=500-x.top-x.bottom,R=Xe(M).append("svg").attr("width",O+x.left+x.right).attr("height",D+x.top+x.bottom).append("g").attr("transform",`translate(${x.left},${x.top})`),C=Math.max(...k.points.map(F=>F.page1),0),L=Math.max(...k.points.map(F=>F.page2),0),A=Hr().domain([0,C]).range([0,O]),H=Hr().domain([0,L]).range([D,0]);R.append("g").attr("transform",`translate(0,${D})`).call(Fu(A).ticks(Math.min(C+1,10)).tickFormat(zi("d"))),R.append("g").call(Vu(H).ticks(Math.min(L+1,10)).tickFormat(zi("d"))),R.append("foreignObject").attr("x",0).attr("y",D+10).attr("width",O).attr("height",100).append("xhtml:div").style("display","flex").style("align-items","center").style("justify-content","center").style("gap","0.5rem").style("margin-top","20px").html(`<span class="legend-color" style="background-color: ${k.doc1.color}; width: 12px; height: 12px; display: inline-block; border-radius: 50%;"></span>
                <span style="font-size: 12px;">${ar(k.doc1.title)||`Doc ${k.doc1.id}`} (page)</span>`),R.append("foreignObject").attr("x",-x.left+5).attr("y",0).attr("width",50).attr("height",O).append("xhtml:div").style("display","flex").style("align-items","center").style("justify-content","center").style("gap","0.5rem").style("transform",`rotate(-90deg) translateX(-${D/2}px)`).style("transform-origin","left top").style("white-space","nowrap").html(`<span class="legend-color" style="background-color: ${k.doc2.color}; width: 12px; height: 12px; display: inline-block; border-radius: 50%;"></span>
                <span style="font-size: 12px;">${ar(k.doc2.title)||`Doc ${k.doc2.id}`} (page)</span>`);const U=k.maxScore-k.minScore;R.selectAll(".point").data(k.points).join("rect").attr("class","point").attr("x",F=>A(F.page1)-4).attr("y",F=>H(F.page2)-4).attr("width",8).attr("height",8).attr("fill",Er(233,.951,.52)).attr("opacity",F=>{const Y=o||[];return Y.length===1&&Y[0]===1?1:ig(F.score,{min:k.minScore,max:k.maxScore,range:U})})}function E(M){gn[M?"unshift":"push"](()=>{g=M,n(0,g)})}function T(M){gn[M?"unshift":"push"](()=>{p=M,n(1,p)})}return t.$$set=M=>{"documentSetStore"in M&&n(8,u=M.documentSetStore)},t.$$.update=()=>{t.$$.dirty&4096&&n(3,i=Array.from((c==null?void 0:c.values())||[])),t.$$.dirty&2056&&n(9,r=ng(i,a.scoreCount)),t.$$.dirty&4&&n(10,s=_?w(_):null),t.$$.dirty&1026&&p&&s&&b(p,s),t.$$.dirty&513&&g&&r&&I(g,r)},[g,p,_,i,d,f,h,m,u,r,s,a,c,E,T]}class sg extends ve{constructor(e){super(),_e(this,e,rg,tg,me,{documentSetStore:8})}}const Al="https://vhs.huma-num.fr",og=()=>new Worker("/static/js/pairWorker.js",{type:"module"});function lg(t){const e=we(null),n=we([1]),i=we(new Set),r=we([]),s=we(.5),o=we(null),l=we(!1),a=we([]),c=we(new Map);let u;const d=we({byImage:new Map,byDocPair:new Map,byDoc:new Map}),f=we(new Map),h=we(new Map),m=we({}),g=we({}),p=we({}),_=we({}),w=we({documents:0,pairs:null,images:0,categories:{}}),I=Be(n,(C,L)=>{u&&u.terminate();const A=414,H=new Promise((U,F)=>{(async()=>{try{const Z=await fetch(`${Al}/document-set/${A}/pairs?category=${C.join(",")}`);if(!Z.ok)throw new Error(`HTTP ${Z.status}`);const ne=await Z.json();u=og(),u.postMessage({rawPairs:ne,selectedCategories:C}),u.onmessage=async fe=>{const{allPairs:ee,imageNodes:ce,pairIndex:Ee,categories:Me,stats:ye}=fe.data;d.set(Ee),m.set(ye.pairStats),g.set(ye.documentStats),p.set(ye.imageStats),_.set(ye.docPairStats);const Ve=Array.from(ye.documentStats.scoreCount.keys());tt(i).size===0&&i.set(new Set(Ve));const Re=await Promise.all(Ve.map(Pe=>b(Pe).then(xe=>({id:Pe,info:xe})))),je=new Map;Re.forEach(({id:Pe,info:xe})=>je.set(Pe,xe)),c.set(je);const at=new Map;Ve.forEach((Pe,xe)=>{const Tt=je.get(Pe)||{};at.set(Pe,{id:Pe,title:Tt.title||`Region Extraction ${Pe}`,color:Tt.color||Kc(xe),images:[],...Tt})}),ce.forEach(Pe=>{const xe=at.get(Pe.regionId);xe&&(Pe.color=xe.color,Pe.title=`${xe.title} | Page ${Pe.canvas}`,xe.images.push(Pe))}),at.forEach(Pe=>Pe.images.sort((xe,Tt)=>xe.canvas-Tt.canvas)),f.set(ce),h.set(at),w.set({documents:Ve.length,pairs:ee.length,images:ce.size,categories:Me}),a.set(ee),u.terminate(),u=null,U(ee.length)},u.onerror=fe=>{console.error("Worker error",fe);const ee=`Error processing pairs: ${fe.message}`;e.set(ee),F(new Error(ee))}}catch(Z){const ne=`Fetch error: ${Z.message}`;e.set(ne),F(new Error(ne))}})()});L(H)});async function b(C){try{const L=await fetch(`${Al}/search/regions/?id=${C}`);if(!L.ok)throw new Error(`HTTP ${L.status}`);const{results:A}=await L.json();if(!(A!=null&&A.length))return{title:`Region Extraction ${C}`};const H=A[0],[,...U]=H.title.split(" | "),[F,Y]=(H.ref||"_").split("_");return{title:U.join(" | "),ref:H.ref,witnessId:lr(F),digitizationRef:Y,zeros:H.zeros,img_nb:H.img_nb,url:H.url}}catch(L){return e.set(`Error fetching region #${C}: ${L.message}`),{title:`Region Extraction ${C}`}}}const E=Be([a,s,o,l,i],([C,L,A,H,U])=>{if(!C)return[];const F=[];for(let Y=0;Y<C.length;Y++){const Z=C[Y];if(Z.weightedScore<L)break;if(!(!U.has(Z.regions_id_1)||!U.has(Z.regions_id_2))){if(A!==null){if(H){if(Z.rank_1>A||Z.rank_2>A)continue}else if(Z.rank_1>A&&Z.rank_2>A)continue}F.push(Z)}}return F}),T=Be([E,h],([C,L])=>{if(!C.length||L.size===0)return[];const A=new Set;for(const U of C)A.add(U.regions_id_1),A.add(U.regions_id_2);const H=[];return A.forEach(U=>{const F=L.get(U);F&&H.push(F)}),H.sort((U,F)=>F.id-U.id)});function M(C,L,A=10,H=200,U=2,F=25){if(!L)return{strength:.5,distance:100,width:2};const{min:Y,_:Z,range:ne}=L,fe=ne===0?.5:(C-Y)/ne,ee=H-fe*(H-A),ce=U+fe*(F-U);return{strength:fe,distance:ee,width:ce}}function k(C,L,A=10,H=60){if(!L)return A;const{min:U,_:F,range:Y}=L;return Y===0?(A+H)/2:A+(C-U)/Y*(H-A)}const x=Be([E],([C])=>{var Z;const L=tt(f),A=tt(p),H=tt(m),U=new Set,F=[];for(const ne of C){const{strength:fe,distance:ee,width:ce}=M(ne.weightedScore,H.scoreRange);F.push({source:ne.id_1,target:ne.id_2,strength:fe,distance:ee,width:ce}),U.has(ne.id_1)||U.add(ne.id_1),U.has(ne.id_2)||U.add(ne.id_2)}const Y=[];for(const ne of U){const fe=L.get(ne);if(fe){const ee=(Z=A.scoreCount)==null?void 0:Z.get(ne),{count:ce,score:Ee}=ee;Y.push({...fe,radius:k(Ee,A.scoreRange),label:`Region: ${fe.regionId}
Page: ${fe.canvas}
Connections: ${ce}
Total score: ${Ee.toFixed(2)}`})}}return{nodes:Y,links:F}}),O=Be(T,C=>{const L=tt(_),A=tt(g);if(C.size===0)return{nodes:[],links:[]};const H=Array.from(C.values()).map(F=>{var fe;const Y=(fe=A.scoreCount)==null?void 0:fe.get(F.id),{count:Z,score:ne}=Y;return{...F,radius:k(Z,A.countRange),label:`${F.title}
Images: ${Z}
Total score: ${ne.toFixed(2)}`}}),U=Array.from(L.scoreCount.entries()).map(([F,Y])=>{const[Z,ne]=F.split("-").map(Number),{strength:fe,distance:ee,width:ce}=M(Y.score,L.scoreRange);return{source:Z,target:ne,strength:fe,distance:ee,width:ce}});return{nodes:H,links:U}});function D(C){if(!C.length)return{regions:[],rows:[]};const L=tt(h),A=tt(d),H=C[0],U=L.get(H);if(!(U!=null&&U.images))return{regions:C,rows:[]};const F=U.images,Y=(ee,ce,Ee)=>{const{r1:Me,r2:ye}={r1:ce,r2:Ee},Ve=Me<ye?`${Me}-${ye}`:`${ye}-${Me}`;return(A.byDocPair.get(Ve)||[]).map(Re=>Re.id_1===ee&&Re.regions_id_1===ce?{id:Re.id_2,page:Re.page_2}:Re.id_2===ee&&Re.regions_id_2===ce?{id:Re.id_1,page:Re.page_1}:null).filter(Boolean)},Z=[];for(const ee of F){let ce=[{[H]:{id:ee.id,page:ee.canvas}}];for(let Ee=1;Ee<C.length;Ee++){const Me=C[Ee],ye=[];for(const Ve of ce){const Nt=[];for(let Re=0;Re<Ee;Re++){const je=C[Re];if(Ve[je]){const at=Y(Ve[je].id,je,Me);Nt.push(...at)}}if(Nt.length===0)ye.push(Ve);else{const Re=new Map;Nt.forEach(je=>{Re.has(je.id)||Re.set(je.id,je)});for(const je of Re.values()){const at={...Ve,[Me]:je};ye.push(at)}}}ce=ye}Z.push(...ce)}const ne=[],fe=new Set;for(const ee of Z){const ce=C.map(Ee=>{var Me;return((Me=ee[Ee])==null?void 0:Me.id)||""}).join("|");fe.has(ce)||(fe.add(ce),ne.push(ee))}return{regions:C,rows:ne}}function q(C){n.update(L=>L.indexOf(C)>-1?L.filter(H=>H!==C):[...L,C].sort((H,U)=>H-U))}function R(C){i.update(L=>{const A=new Set(L);return A.has(C)?A.delete(C):A.add(C),A})}return{error:e,allPairs:a,visiblePairs:E,pairIndex:d,documentNodes:h,imageNodes:f,fetchPairs:I,imageNetwork:x,documentNetwork:O,selectedCategories:n,pairStats:m,documentStats:g,imageStats:p,docPairStats:_,docSetNumber:w,selectedNodes:r,selectedRegions:i,updateSelectedNodes:C=>r.set(C),toggleCategory:q,toggleRegion:R,buildAlignedImageMatrix:D,threshold:s,setThreshold:C=>s.set(C),topK:o,setTopK:C=>o.set(C),mutualTopK:l,setMutualTopK:C=>l.set(C)}}function Nl(t){let e,n,i,r,s,o=(t[0].clusters||0)+"",l;return{c(){e=S("div"),n=S("div"),i=S("p"),i.textContent="Clusters",r=B(),s=S("p"),l=te(o),v(i,"class","heading"),v(s,"class","title is-5"),v(e,"class","level-item")},m(a,c){z(a,e,c),y(e,n),y(n,i),y(n,r),y(n,s),y(s,l)},p(a,c){c&1&&o!==(o=(a[0].clusters||0)+"")&&pe(l,o)},d(a){a&&$(e)}}}function ag(t){var D,q,R;let e,n,i,r,s,o,l=(t[0].count||0)+"",a,c,u,d,f,h,m,g=(t[0].links||0)+"",p,_,w,I,b,E,T,M,k=(((q=(D=t[0])==null?void 0:D.density)==null?void 0:q.toFixed(3))||0)+"",x,O=((R=t[0])==null?void 0:R.clusters)&&Nl(t);return{c(){e=S("div"),n=S("div"),i=S("div"),r=S("p"),r.textContent=`${W==="en"?"Nodes":"Nœuds"}`,s=B(),o=S("p"),a=te(l),c=B(),u=S("div"),d=S("div"),f=S("p"),f.textContent=`${W==="en"?"Edges":"Liens"}`,h=B(),m=S("p"),p=te(g),_=B(),O&&O.c(),w=B(),I=S("div"),b=S("div"),E=S("p"),E.textContent=`${W==="en"?"Density":"Densité"}`,T=B(),M=S("p"),x=te(k),v(r,"class","heading"),v(o,"class","title is-5"),v(n,"class","level-item"),v(f,"class","heading"),v(m,"class","title is-5"),v(u,"class","level-item"),v(E,"class","heading"),v(M,"class","title is-5"),v(I,"class","level-item"),v(e,"class","level has-text-centered")},m(C,L){z(C,e,L),y(e,n),y(n,i),y(i,r),y(i,s),y(i,o),y(o,a),y(e,c),y(e,u),y(u,d),y(d,f),y(d,h),y(d,m),y(m,p),y(e,_),O&&O.m(e,null),y(e,w),y(e,I),y(I,b),y(b,E),y(b,T),y(b,M),y(M,x)},p(C,[L]){var A,H,U;L&1&&l!==(l=(C[0].count||0)+"")&&pe(a,l),L&1&&g!==(g=(C[0].links||0)+"")&&pe(p,g),(A=C[0])!=null&&A.clusters?O?O.p(C,L):(O=Nl(C),O.c(),O.m(e,w)):O&&(O.d(1),O=null),L&1&&k!==(k=(((U=(H=C[0])==null?void 0:H.density)==null?void 0:U.toFixed(3))||0)+"")&&pe(x,k)},i:X,o:X,d(C){C&&$(e),O&&O.d()}}}function cg(t,e,n){let i,r,s,o,{activeTab:l="img"}=e,{documentSetStore:a}=e;const{imageStats:c,documentStats:u,docPairStats:d}=a;return ge(t,c,f=>n(8,o=f)),ge(t,u,f=>n(7,s=f)),ge(t,d,f=>n(6,r=f)),t.$$set=f=>{"activeTab"in f&&n(4,l=f.activeTab),"documentSetStore"in f&&n(5,a=f.documentSetStore)},t.$$.update=()=>{t.$$.dirty&464&&n(0,i=l==="img"?o:l==="doc"?s:r)},[i,c,u,d,l,a,r,s,o]}class ug extends ve{constructor(e){super(),_e(this,e,cg,ag,me,{activeTab:4,documentSetStore:5})}}function fg(t){let e,n,i;const r=t[1].default,s=bt(r,t,t[0],null);return{c(){e=S("table"),n=S("tbody"),s&&s.c(),v(e,"class","table is-fullwidth")},m(o,l){z(o,e,l),y(e,n),s&&s.m(n,null),i=!0},p(o,[l]){s&&s.p&&(!i||l&1)&&St(s,r,o,o[0],i?wt(r,o[0],l,null):kt(o[0]),null)},i(o){i||(V(s,o),i=!0)},o(o){K(s,o),i=!1},d(o){o&&$(e),s&&s.d(o)}}}function hg(t,e,n){let{$$slots:i={},$$scope:r}=e;return t.$$set=s=>{"$$scope"in s&&n(0,r=s.$$scope)},[r,i]}class dg extends ve{constructor(e){super(),_e(this,e,hg,fg,me,{})}}const mg=t=>({}),Tl=t=>({}),pg=t=>({}),Ol=t=>({}),gg=t=>({}),Pl=t=>({});function _g(t){let e;const n=t[4]["row-body"],i=bt(n,t,t[3],Tl);return{c(){i&&i.c()},m(r,s){i&&i.m(r,s),e=!0},p(r,s){i&&i.p&&(!e||s&8)&&St(i,n,r,r[3],e?wt(n,r[3],s,mg):kt(r[3]),Tl)},i(r){e||(V(i,r),e=!0)},o(r){K(i,r),e=!1},d(r){i&&i.d(r)}}}function vg(t){let e,n,i,r;const s=t[4]["row-body"],o=bt(s,t,t[3],Ol);return{c(){e=S("div"),n=S("div"),o&&o.c(),v(n,"class","grid is-gap-2"),v(e,"class",i="fixed-grid has-"+t[2]+"-cols")},m(l,a){z(l,e,a),y(e,n),o&&o.m(n,null),r=!0},p(l,a){o&&o.p&&(!r||a&8)&&St(o,s,l,l[3],r?wt(s,l[3],a,pg):kt(l[3]),Ol),(!r||a&4&&i!==(i="fixed-grid has-"+l[2]+"-cols"))&&v(e,"class",i)},i(l){r||(V(o,l),r=!0)},o(l){K(o,l),r=!1},d(l){l&&$(e),o&&o.d(l)}}}function yg(t){let e,n,i,r,s,o,l,a,c,u;Vt(t[5]);const d=t[4]["row-header"],f=bt(d,t,t[3],Pl),h=[vg,_g],m=[];function g(p,_){return p[0]?0:1}return o=g(t),l=m[o]=h[o](t),{c(){e=S("tr"),n=S("th"),i=S("div"),f&&f.c(),r=B(),s=S("td"),l.c(),v(i,"class","content-wrapper py-5"),v(n,"class","is-3 center-flex is-narrow"),De(n,"width","15vw"),v(s,"class","p-5 is-fullwidth")},m(p,_){z(p,e,_),y(e,n),y(n,i),f&&f.m(i,null),y(e,r),y(e,s),m[o].m(s,null),a=!0,c||(u=be(window,"resize",t[5]),c=!0)},p(p,[_]){f&&f.p&&(!a||_&8)&&St(f,d,p,p[3],a?wt(d,p[3],_,gg):kt(p[3]),Pl);let w=o;o=g(p),o===w?m[o].p(p,_):(Se(),K(m[w],1,1,()=>{m[w]=null}),ke(),l=m[o],l?l.p(p,_):(l=m[o]=h[o](p),l.c()),V(l,1),l.m(s,null))},i(p){a||(V(f,p),V(l),a=!0)},o(p){K(f,p),K(l),a=!1},d(p){p&&$(e),f&&f.d(p),m[o].d(),c=!1,u()}}}function bg(t,e,n){let i,{$$slots:r={},$$scope:s}=e,{useGrid:o=!0}=e,l=0;function a(){n(1,l=window.innerWidth)}return t.$$set=c=>{"useGrid"in c&&n(0,o=c.useGrid),"$$scope"in c&&n(3,s=c.$$scope)},t.$$.update=()=>{t.$$.dirty&2&&n(2,i=xs(l))},[o,l,i,s,r,a]}class Ll extends ve{constructor(e){super(),_e(this,e,bg,yg,me,{useGrid:0})}}const ky="";function wg(t){let e,n,i;return{c(){e=S("span"),n=te(t[0]),v(e,"id",t[3]),v(e,"class",i="tooltip "+t[2]+" "+(t[1]?"display":"")+" svelte-1am23me")},m(r,s){z(r,e,s),y(e,n)},p(r,[s]){s&1&&pe(n,r[0]),s&6&&i!==(i="tooltip "+r[2]+" "+(r[1]?"display":"")+" svelte-1am23me")&&v(e,"class",i)},i:X,o:X,d(r){r&&$(e)}}}function Sg(t,e,n){let i,r,s,o,{tooltipText:l}=e,{targetHtmlId:a}=e;const c=`tooltip-generic-${window.crypto.randomUUID()}`,u=()=>n(1,o=!0),d=()=>n(1,o=!1),f=()=>n(1,o=!o);return Ln(()=>{s=a?document.getElementById(a):document.getElementById(c).parentElement,a&&!s&&(console.error(`TooltipGeneric: element with ID ${a} not found, defaulting to the parent element`),s=document.getElementById(c).targetElement),s.addEventListener("mouseover",u),s.addEventListener("mouseout",d),s.addEventListener("click",f)}),Dn(()=>{s.removeEventListener("mouseover",u),s.removeEventListener("mouseout",d),s.removeEventListener("click",f)}),t.$$set=h=>{"tooltipText"in h&&n(0,l=h.tooltipText),"targetHtmlId"in h&&n(4,a=h.targetHtmlId)},t.$$.update=()=>{t.$$.dirty&33&&n(2,i=r(l))},n(5,r=h=>n(2,i=h.length>100?"tooltip-wide":h.length>20?"tooltip-mid":"tooltip-thin")),s=void 0,n(1,o=!1),[l,o,i,c,a,r]}class Vi extends ve{constructor(e){super(),_e(this,e,Sg,wg,me,{tooltipText:0,targetHtmlId:4})}}const Ey="",kg=t=>({}),Dl=t=>({}),Eg=t=>({}),Rl=t=>({});function $l(t){let e,n,i,r,s,o,l,a,c,u,d,f=t[1]&&zl(t);return a=new Vi({props:{tooltipText:t[2][t[1]][W]}}),{c(){f&&f.c(),e=B(),n=S("div"),i=S("button"),r=Et("svg"),s=Et("path"),l=B(),le(a.$$.fragment),v(s,"fill","none"),v(s,"stroke","currentColor"),v(s,"stroke-linecap","round"),v(s,"stroke-linejoin","round"),v(s,"stroke-width","1.5"),v(s,"d","M12 3v18m0 0l8.5-8.5M12 21l-8.5-8.5"),v(r,"style",o=`transform: rotate(${t[1]?"180":"0"}deg)`),v(r,"xmlns","http://www.w3.org/2000/svg"),v(r,"width","24"),v(r,"height","24"),v(r,"viewBox","0 0 24 24"),v(r,"class","svelte-jbs1sd"),v(i,"class","button is-link svelte-jbs1sd"),v(n,"class","ctrl-toggle svelte-jbs1sd")},m(h,m){f&&f.m(h,m),z(h,e,m),z(h,n,m),y(n,i),y(i,r),y(r,s),y(i,l),se(a,i,null),c=!0,u||(d=be(i,"click",jt(t[3])),u=!0)},p(h,m){h[1]?f?(f.p(h,m),m&2&&V(f,1)):(f=zl(h),f.c(),V(f,1),f.m(e.parentNode,e)):f&&(Se(),K(f,1,1,()=>{f=null}),ke()),(!c||m&2&&o!==(o=`transform: rotate(${h[1]?"180":"0"}deg)`))&&v(r,"style",o);const g={};m&2&&(g.tooltipText=h[2][h[1]][W]),a.$set(g)},i(h){c||(V(f),V(a.$$.fragment,h),c=!0)},o(h){K(f),K(a.$$.fragment,h),c=!1},d(h){f&&f.d(h),h&&$(e),h&&$(n),oe(a),u=!1,d()}}}function zl(t){let e,n,i;const r=t[5]["toolbar-hidden"],s=bt(r,t,t[4],Dl);return{c(){e=S("div"),s&&s.c(),v(e,"class","ctrl-extra")},m(o,l){z(o,e,l),s&&s.m(e,null),i=!0},p(o,l){s&&s.p&&(!i||l&16)&&St(s,r,o,o[4],i?wt(r,o[4],l,kg):kt(o[4]),Dl)},i(o){i||(V(s,o),Vt(()=>{i&&(n||(n=Yt(e,Os,{axis:"y"},!0)),n.run(1))}),i=!0)},o(o){K(s,o),n||(n=Yt(e,Os,{axis:"y"},!1)),n.run(0),i=!1},d(o){o&&$(e),s&&s.d(o),o&&n&&n.end()}}}function Cg(t){let e,n,i,r,s,o,l,a;const c=t[5]["toolbar-visible"],u=bt(c,t,t[4],Rl);let d=t[0]&&$l(t);return{c(){e=S("div"),n=S("form"),i=S("div"),r=S("div"),s=S("div"),u&&u.c(),o=B(),d&&d.c(),v(s,"class","ctrl-block svelte-jbs1sd"),v(r,"class","ctrl-block-wrapper svelte-jbs1sd"),v(i,"class","ctrl-base"),v(n,"class","ctrl svelte-jbs1sd"),v(e,"id","toolbar"),v(e,"class",l="ctrl-wrapper is-flex is-justify-content-center is-align-items-center "+(t[1]?"toolbar-expanded":"toolbar-collapsed")+" svelte-jbs1sd")},m(f,h){z(f,e,h),y(e,n),y(n,i),y(i,r),y(r,s),u&&u.m(s,null),y(n,o),d&&d.m(n,null),a=!0},p(f,[h]){u&&u.p&&(!a||h&16)&&St(u,c,f,f[4],a?wt(c,f[4],h,Eg):kt(f[4]),Rl),f[0]?d?(d.p(f,h),h&1&&V(d,1)):(d=$l(f),d.c(),V(d,1),d.m(n,null)):d&&(Se(),K(d,1,1,()=>{d=null}),ke()),(!a||h&2&&l!==(l="ctrl-wrapper is-flex is-justify-content-center is-align-items-center "+(f[1]?"toolbar-expanded":"toolbar-collapsed")+" svelte-jbs1sd"))&&v(e,"class",l)},i(f){a||(V(u,f),V(d),a=!0)},o(f){K(u,f),K(d),a=!1},d(f){f&&$(e),u&&u.d(f),d&&d.d()}}}function Ig(t,e,n){let i,{$$slots:r={},$$scope:s}=e,{expandable:o=!0}=e;const l={true:{en:"Collapse the toolbar",fr:"Refermer le menu"},false:{en:"Expand the toolbar",fr:"Ouvrir le menu"}},a=()=>n(1,i=!i);return t.$$set=c=>{"expandable"in c&&n(0,o=c.expandable),"$$scope"in c&&n(4,s=c.$$scope)},n(1,i=!1),[o,i,l,a,s,r]}class Mg extends ve{constructor(e){super(),_e(this,e,Ig,Cg,me,{expandable:0})}}function jl(t){let e,n,i,r,s,o,l,a,c,u=t[5]>1&&Fl(t),d=t[5]<t[3]&&Ul(t);return{c(){e=S("nav"),n=S("ul"),u&&u.c(),i=B(),r=S("li"),s=S("a"),o=te(t[5]),l=B(),d&&d.c(),v(s,"class","pagination-link is-current"),v(s,"href",null),v(n,"class","pagination-list ml-0"),v(e,"class","pagination is-centered mb-2"),v(e,"aria-label","pagination")},m(f,h){z(f,e,h),y(e,n),u&&u.m(n,null),y(n,i),y(n,r),y(r,s),y(s,o),y(n,l),d&&d.m(n,null),a||(c=be(s,"click",jt(t[9])),a=!0)},p(f,h){f[5]>1?u?u.p(f,h):(u=Fl(f),u.c(),u.m(n,i)):u&&(u.d(1),u=null),h&32&&pe(o,f[5]),f[5]<f[3]?d?d.p(f,h):(d=Ul(f),d.c(),d.m(n,null)):d&&(d.d(1),d=null)},d(f){f&&$(e),u&&u.d(),d&&d.d(),a=!1,c()}}}function Fl(t){let e,n,i,r,s,o,l=t[5]-1>1&&Vl(t);return{c(){e=S("li"),n=S("a"),n.textContent="1",i=B(),l&&l.c(),r=Ke(),v(n,"class","pagination-link"),v(n,"href",null)},m(a,c){z(a,e,c),y(e,n),z(a,i,c),l&&l.m(a,c),z(a,r,c),s||(o=be(n,"click",jt(t[7])),s=!0)},p(a,c){a[5]-1>1?l?l.p(a,c):(l=Vl(a),l.c(),l.m(r.parentNode,r)):l&&(l.d(1),l=null)},d(a){a&&$(e),a&&$(i),l&&l.d(a),a&&$(r),s=!1,o()}}}function Vl(t){let e,n,i,r=t[5]-1+"",s,o,l,a=t[5]-1>2&&Hl();return{c(){a&&a.c(),e=B(),n=S("li"),i=S("a"),s=te(r),v(i,"class","pagination-link"),v(i,"href",null)},m(c,u){a&&a.m(c,u),z(c,e,u),z(c,n,u),y(n,i),y(i,s),o||(l=be(i,"click",jt(t[8])),o=!0)},p(c,u){c[5]-1>2?a||(a=Hl(),a.c(),a.m(e.parentNode,e)):a&&(a.d(1),a=null),u&32&&r!==(r=c[5]-1+"")&&pe(s,r)},d(c){a&&a.d(c),c&&$(e),c&&$(n),o=!1,l()}}}function Hl(t){let e;return{c(){e=S("li"),e.innerHTML='<span class="pagination-ellipsis">…</span>'},m(n,i){z(n,e,i)},d(n){n&&$(e)}}}function Ul(t){let e,n,i,r,s,o,l=t[5]+1<t[3]&&Bl(t);return{c(){l&&l.c(),e=B(),n=S("li"),i=S("a"),r=te(t[3]),v(i,"class","pagination-link"),v(i,"href",null)},m(a,c){l&&l.m(a,c),z(a,e,c),z(a,n,c),y(n,i),y(i,r),s||(o=be(i,"click",jt(t[11])),s=!0)},p(a,c){a[5]+1<a[3]?l?l.p(a,c):(l=Bl(a),l.c(),l.m(e.parentNode,e)):l&&(l.d(1),l=null),c&8&&pe(r,a[3])},d(a){l&&l.d(a),a&&$(e),a&&$(n),s=!1,o()}}}function Bl(t){let e,n,i=t[5]+1+"",r,s,o,l,a,c=t[5]+2<t[3]&&ql();return{c(){e=S("li"),n=S("a"),r=te(i),s=B(),c&&c.c(),o=Ke(),v(n,"class","pagination-link"),v(n,"href",null)},m(u,d){z(u,e,d),y(e,n),y(n,r),z(u,s,d),c&&c.m(u,d),z(u,o,d),l||(a=be(n,"click",jt(t[10])),l=!0)},p(u,d){d&32&&i!==(i=u[5]+1+"")&&pe(r,i),u[5]+2<u[3]?c||(c=ql(),c.c(),c.m(o.parentNode,o)):c&&(c.d(1),c=null)},d(u){u&&$(e),u&&$(s),c&&c.d(u),u&&$(o),l=!1,a()}}}function ql(t){let e;return{c(){e=S("li"),e.innerHTML='<span class="pagination-ellipsis">…</span>'},m(n,i){z(n,e,i)},d(n){n&&$(e)}}}function xg(t){let e,n,i=t[5]*t[2]-t[2]+1+"",r,s,o=Math.min(t[5]*t[2],t[1])+"",l,a,c,u,d=t[4]&&jl(t);return{c(){d&&d.c(),e=B(),n=S("div"),r=te(i),s=te(" - "),l=te(o),a=te(" / "),c=te(t[1]),v(n,"class",u="is-size-7 is-center mb-4 "+(t[4]?"":"mt-4"))},m(f,h){d&&d.m(f,h),z(f,e,h),z(f,n,h),y(n,r),y(n,s),y(n,l),y(n,a),y(n,c)},p(f,[h]){f[4]?d?d.p(f,h):(d=jl(f),d.c(),d.m(e.parentNode,e)):d&&(d.d(1),d=null),h&36&&i!==(i=f[5]*f[2]-f[2]+1+"")&&pe(r,i),h&38&&o!==(o=Math.min(f[5]*f[2],f[1])+"")&&pe(l,o),h&2&&pe(c,f[1]),h&16&&u!==(u="is-size-7 is-center mb-4 "+(f[4]?"":"mt-4"))&&v(n,"class",u)},i:X,o:X,d(f){d&&d.d(f),f&&$(e),f&&$(n)}}}function Ag(t,e,n){let i,r,s,{store:o}=e;const{currentPage:l}=o;ge(t,l,g=>n(5,s=g));let{nbOfItems:a}=e,{pageLength:c=Dc}=e;const u=()=>o.handlePageUpdate(1),d=()=>o.handlePageUpdate(s-1),f=()=>o.handlePageUpdate(s),h=()=>o.handlePageUpdate(s+1),m=()=>o.handlePageUpdate(i);return t.$$set=g=>{"store"in g&&n(0,o=g.store),"nbOfItems"in g&&n(1,a=g.nbOfItems),"pageLength"in g&&n(2,c=g.pageLength)},t.$$.update=()=>{t.$$.dirty&6&&n(3,i=c>0?Math.ceil(a/c):1),t.$$.dirty&14&&n(4,r=i>1||a>c)},[o,a,c,i,r,s,l,u,d,f,h,m]}class Kl extends ve{constructor(e){super(),_e(this,e,Ag,xg,me,{store:0,nbOfItems:1,pageLength:2})}}function Ng(t){let e,n,i,r,s=W==="en"?"Save selection":"Sauvegarder la sélection",o,l,a;return{c(){e=S("button"),n=S("span"),i=S("i"),r=B(),o=te(s),v(i,"class","fa-solid fa-floppy-disk"),v(e,"class","button is-link")},m(c,u){z(c,e,u),y(e,n),y(n,i),y(n,r),y(n,o),l||(a=be(e,"click",t[7]),l=!0)},p:X,d(c){c&&$(e),l=!1,a()}}}function Tg(t){let e,n,i,r,s=W==="en"?"Go to treatment":"Accéder au traitement",o,l;return{c(){var a;e=S("a"),n=S("span"),i=S("i"),r=B(),o=te(s),v(i,"class","fa-solid fa-gear"),v(e,"class","button is-link"),v(e,"href",l="/"+Ct+"/treatment/add/?document_set="+((a=t[3])==null?void 0:a.id))},m(a,c){z(a,e,c),y(e,n),y(n,i),y(n,r),y(n,o)},p(a,c){var u;c&8&&l!==(l="/"+Ct+"/treatment/add/?document_set="+((u=a[3])==null?void 0:u.id))&&v(e,"href",l)},d(a){a&&$(e)}}}function Wl(t){let e,n,i,r,s,o,l;return{c(){var a,c;e=S("a"),n=S("span"),n.innerHTML='<i class="fa-solid fa-file-export"></i> JSON',r=B(),s=S("a"),o=S("span"),o.innerHTML='<i class="fa-solid fa-file-zipper"></i> ZIP',v(e,"class","button is-link is-dark"),v(e,"href",i="/"+Ct+"/document-set/"+((a=t[3])==null?void 0:a.id)+"/json"),v(e,"target","_blank"),v(s,"class","button is-link is-dark"),v(s,"href",l="/"+Ct+"/document-set/"+((c=t[3])==null?void 0:c.id)+"/zip"),v(s,"target","_blank")},m(a,c){z(a,e,c),y(e,n),z(a,r,c),z(a,s,c),y(s,o)},p(a,c){var u,d;c&8&&i!==(i="/"+Ct+"/document-set/"+((u=a[3])==null?void 0:u.id)+"/json")&&v(e,"href",i),c&8&&l!==(l="/"+Ct+"/document-set/"+((d=a[3])==null?void 0:d.id)+"/zip")&&v(s,"href",l)},d(a){a&&$(e),a&&$(r),a&&$(s)}}}function Og(t){let e,n,i,r,s,o,l;function a(f,h){return f[2]&&!f[1]?Tg:Ng}let c=a(t),u=c(t),d=!t[1]&&Wl(t);return{c(){e=S("footer"),n=S("div"),i=S("button"),i.textContent=`${W==="en"?"Clear selection":"Vider la sélection"}`,r=B(),u.c(),s=B(),d&&d.c(),v(i,"class","button button-close is-link is-light"),v(n,"class","buttons"),v(e,"class","modal-card-foot is-center")},m(f,h){z(f,e,h),y(e,n),y(n,i),y(n,r),u.m(n,null),y(n,s),d&&d.m(n,null),o||(l=be(i,"click",t[6]),o=!0)},p(f,[h]){c===(c=a(f))&&u?u.p(f,h):(u.d(1),u=c(f),u&&(u.c(),u.m(n,s))),f[1]?d&&(d.d(1),d=null):d?d.p(f,h):(d=Wl(f),d.c(),d.m(n,null))},i:X,o:X,d(f){f&&$(e),u.d(),d&&d.d(),o=!1,l()}}}function Pg(t,e,n){let i,r,{selectionStore:s}=e;const{isSaved:o,selection:l}=s;ge(t,o,d=>n(2,i=d)),ge(t,l,d=>n(3,r=d));let{isRegion:a=s.type!=="documentSet"}=e;const c=()=>s.empty(),u=()=>s.save();return t.$$set=d=>{"selectionStore"in d&&n(0,s=d.selectionStore),"isRegion"in d&&n(1,a=d.isRegion)},[s,a,i,r,o,l,c,u]}class Lg extends ve{constructor(e){super(),_e(this,e,Pg,Og,me,{selectionStore:0,isRegion:1})}}const Cy="";function Dg(t){let e,n,i,r,s,o;return{c(){e=S("span"),n=te(t[5]),i=B(),r=S("span"),r.innerHTML='<i class="fas fa-edit"></i>',v(r,"class","pl-3 smaller has-text-link")},m(l,a){z(l,e,a),y(e,n),y(e,i),y(e,r),s||(o=[be(e,"click",t[7]),be(e,"keyup",null)],s=!0)},p(l,a){a&32&&pe(n,l[5])},d(l){l&&$(e),s=!1,Ye(o)}}}function Rg(t){let e,n,i;return{c(){e=S("input"),v(e,"class","input selection-title svelte-sgypdx")},m(r,s){z(r,e,s),t[12](e),li(e,t[4]),n||(i=[be(e,"input",t[13]),be(e,"keydown",t[8]),be(e,"blur",t[9])],n=!0)},p(r,s){s&16&&e.value!==r[4]&&li(e,r[4])},d(r){r&&$(e),t[12](null),n=!1,Ye(i)}}}function $g(t){let e,n,i,r,s,o,l,a,c,u,d,f,h,m,g,p,_,w,I,b;function E(O,D){return O[2]?Rg:Dg}let T=E(t),M=T(t);const k=t[11].default,x=bt(k,t,t[10],null);return _=new Lg({props:{selectionStore:t[0]}}),{c(){e=S("div"),n=S("div"),i=B(),r=S("div"),s=S("div"),o=S("div"),l=S("i"),a=B(),M.c(),c=te(`
                (`),u=te(t[1]),d=te(")"),f=B(),h=S("button"),m=B(),g=S("section"),x&&x.c(),p=B(),le(_.$$.fragment),v(n,"class","modal-background"),v(l,"class","fa-solid fa-book-bookmark"),v(o,"class","title is-4 mb-0 media-content"),v(h,"class","delete media-left"),v(h,"aria-label","close"),v(s,"class","modal-card-head media mb-0 is-middle"),v(g,"class","modal-card-body"),v(r,"class","modal-content"),v(e,"id","selection-modal"),v(e,"class","modal fade"),v(e,"tabindex","-1"),v(e,"aria-labelledby","selection-modal-label"),v(e,"aria-hidden","true")},m(O,D){z(O,e,D),y(e,n),y(e,i),y(e,r),y(r,s),y(s,o),y(o,l),y(o,a),M.m(o,null),y(o,c),y(o,u),y(o,d),y(s,f),y(s,h),y(r,m),y(r,g),x&&x.m(g,null),y(r,p),se(_,r,null),w=!0,I||(b=oi(As.call(null,e)),I=!0)},p(O,[D]){T===(T=E(O))&&M?M.p(O,D):(M.d(1),M=T(O),M&&(M.c(),M.m(o,c))),(!w||D&2)&&pe(u,O[1]),x&&x.p&&(!w||D&1024)&&St(x,k,O,O[10],w?wt(k,O[10],D,null):kt(O[10]),null);const q={};D&1&&(q.selectionStore=O[0]),_.$set(q)},i(O){w||(V(x,O),V(_.$$.fragment,O),w=!0)},o(O){K(x,O),K(_.$$.fragment,O),w=!1},d(O){O&&$(e),M.d(),x&&x.d(O),oe(_),I=!1,b()}}}function zg(t,e,n){let i,{$$slots:r={},$$scope:s}=e,{selectionStore:o}=e;const{selectionTitle:l,updateTitle:a,save:c}=o;ge(t,l,I=>n(5,i=I));let{selectionLength:u=!1}=e,d=!1,f,h;function m(){n(2,d=!0),n(4,h=i),setTimeout(()=>f&&f.focus(),0)}function g(I){I.key==="Enter"&&p()}function p(){n(2,d=!1),a(h),c()}function _(I){gn[I?"unshift":"push"](()=>{f=I,n(3,f)})}function w(){h=this.value,n(4,h)}return t.$$set=I=>{"selectionStore"in I&&n(0,o=I.selectionStore),"selectionLength"in I&&n(1,u=I.selectionLength),"$$scope"in I&&n(10,s=I.$$scope)},[o,u,d,f,h,i,l,m,g,p,s,r,_,w]}class jg extends ve{constructor(e){super(),_e(this,e,zg,$g,me,{selectionStore:0,selectionLength:1})}}const Iy="";function Fg(t){let e,n,i,r,s,o=W==="en"?"Selection":"Sélection",l,a,c,u,d,f;return{c(){e=S("div"),n=S("button"),i=S("span"),r=S("i"),s=B(),l=te(o),a=te(`
            (`),c=te(t[0]),u=te(")"),v(r,"class","fa-solid fa-book-bookmark"),v(i,"id","btn-content"),v(n,"id","set-btn"),v(n,"class","button px-5 py-4 is-link svelte-gmt9z5"),v(n,"data-target","selection-modal"),v(e,"class","set-container svelte-gmt9z5")},m(h,m){z(h,e,m),y(e,n),y(n,i),y(i,r),y(i,s),y(i,l),y(i,a),y(i,c),y(i,u),d||(f=oi(Ns.call(null,n)),d=!0)},p(h,[m]){m&1&&pe(c,h[0])},i:X,o:X,d(h){h&&$(e),d=!1,f()}}}function Vg(t,e,n){let{selectionLength:i=0}=e,r=i;return t.$$set=s=>{"selectionLength"in s&&n(0,i=s.selectionLength)},t.$$.update=()=>{if(t.$$.dirty&3&&i!==r){const s=i>r;n(1,r=i);const o=document.getElementById("btn-content");o&&o.animate([{transform:s?"translateY(-7px)":"translateX(-5px)"},{transform:s?"translateY(7px)":"translateX(5px)"},{transform:"translate(0)"}],{duration:300,easing:"cubic-bezier(0.65, 0, 0.35, 1)"})}},[i,r]}class Hg extends ve{constructor(e){super(),_e(this,e,Vg,Fg,me,{selectionLength:0})}}const My="";function Gl(t,e,n){const i=t.slice();return i[7]=e[n][0],i[8]=e[n][1],i}function Ug(t){let e;return{c(){e=S("div"),e.textContent=`${W==="en"?"No regions in selection":"Aucune région sélectionnée"}`},m(n,i){z(n,e,i)},p:X,d(n){n&&$(e)}}}function Bg(t){let e,n,i=Object.entries(t[2]),r=[];for(let s=0;s<i.length;s+=1)r[s]=Yl(Gl(t,i,s));return{c(){e=S("div"),n=S("div");for(let s=0;s<r.length;s+=1)r[s].c();v(n,"class","grid is-gap-2"),v(e,"class","fixed-grid has-6-cols")},m(s,o){z(s,e,o),y(e,n);for(let l=0;l<r.length;l+=1)r[l]&&r[l].m(n,null)},p(s,o){if(o&13){i=Object.entries(s[2]);let l;for(l=0;l<i.length;l+=1){const a=Gl(s,i,l);r[l]?r[l].p(a,o):(r[l]=Yl(a),r[l].c(),r[l].m(n,null))}for(;l<r.length;l+=1)r[l].d(1);r.length=i.length}},d(s){s&&$(e),nt(r,s)}}}function Yl(t){let e,n,i,r,s,o,l,a=t[8].title+"",c,u,d,f,h,m;function g(){return t[6](t[7])}return{c(){e=S("div"),n=S("figure"),i=S("img"),s=B(),o=S("div"),l=S("span"),c=te(a),u=B(),d=S("button"),f=B(),pt(i.src,r=Pt(t[8].img,t[8].xywh,"96,"))||v(i,"src",r),v(i,"alt","Extracted region"),v(l,"class","overlay-desc"),v(o,"class","overlay is-center svelte-g8ij5d"),v(n,"class","image is-64x64 card"),v(d,"class","delete region-btn svelte-g8ij5d"),v(d,"aria-label","remove from selection"),v(e,"class","selection cell svelte-g8ij5d")},m(p,_){z(p,e,_),y(e,n),y(n,i),y(n,s),y(n,o),y(o,l),y(l,c),y(e,u),y(e,d),y(e,f),h||(m=be(d,"click",g),h=!0)},p(p,_){t=p,_&4&&!pt(i.src,r=Pt(t[8].img,t[8].xywh,"96,"))&&v(i,"src",r),_&4&&a!==(a=t[8].title+"")&&pe(c,a)},d(p){p&&$(e),h=!1,m()}}}function qg(t){let e;function n(s,o){return s[4]?Bg:Ug}let i=n(t),r=i(t);return{c(){r.c(),e=Ke()},m(s,o){r.m(s,o),z(s,e,o)},p(s,o){i===(i=n(s))&&r?r.p(s,o):(r.d(1),r=i(s),r&&(r.c(),r.m(e.parentNode,e)))},d(s){r.d(s),s&&$(e)}}}function Kg(t){let e,n,i,r;return e=new Hg({props:{selectionLength:t[1]}}),i=new jg({props:{selectionLength:t[1],selectionStore:t[0],$$slots:{default:[qg]},$$scope:{ctx:t}}}),{c(){le(e.$$.fragment),n=B(),le(i.$$.fragment)},m(s,o){se(e,s,o),z(s,n,o),se(i,s,o),r=!0},p(s,[o]){const l={};o&2&&(l.selectionLength=s[1]),e.$set(l);const a={};o&2&&(a.selectionLength=s[1]),o&1&&(a.selectionStore=s[0]),o&2077&&(a.$$scope={dirty:o,ctx:s}),i.$set(a)},i(s){r||(V(e.$$.fragment,s),V(i.$$.fragment,s),r=!0)},o(s){K(e.$$.fragment,s),K(i.$$.fragment,s),r=!1},d(s){oe(e,s),s&&$(n),oe(i,s)}}}function Wg(t,e,n){let i,r,s,o,{selectionStore:l}=e;const{selected:a}=l;ge(t,a,u=>n(3,o=u));const c=u=>l.remove(u,Object.keys(o)[0]);return t.$$set=u=>{"selectionStore"in u&&n(0,l=u.selectionStore)},t.$$.update=()=>{t.$$.dirty&8&&n(2,i=Object.values(o)[0]||{}),t.$$.dirty&4&&n(1,r=Object.keys(i).length),t.$$.dirty&2&&n(4,s=r>0)},[l,r,i,o,s,a,c]}class Gg extends ve{constructor(e){super(),_e(this,e,Wg,Kg,me,{selectionStore:0})}}const xy="";function Xl(t,e,n){const i=t.slice();return i[17]=e[n],i}function Jl(t,e,n){const i=t.slice();return i[20]=e[n],i}function Ql(t,e,n){const i=t.slice();return i[23]=e[n],i}function Zl(t){let e,n,i,r,s,o=t[23].title+"",l,a,c,u=t[23].shortcut+"",d,f,h,m;return{c(){e=S("p"),n=S("button"),i=S("span"),r=S("i"),s=B(),l=te(o),a=B(),c=S("span"),d=te(u),f=B(),v(r,"class","fas "+t[23].icon+" svelte-7vjt6f"),v(i,"class","icon is-small"),v(c,"class","shortcut svelte-7vjt6f"),v(n,"class","button pl-5"),v(n,"title",t[23].desc),v(e,"class","control")},m(g,p){z(g,e,p),y(e,n),y(n,i),y(i,r),y(n,s),y(n,l),y(n,a),y(n,c),y(c,d),y(e,f),h||(m=be(n,"click",jt(t[23].fct)),h=!0)},p(g,p){t=g},d(g){g&&$(e),h=!1,m()}}}function Yg(t){let e,n,i,r,s,o,l,a=Object.values(t[10]),c=[];for(let u=0;u<a.length;u+=1)c[u]=Zl(Ql(t,a,u));return{c(){e=S("div"),n=S("div"),i=S("div"),r=S("span"),r.textContent=`${W==="en"?"Process selection":"Agir sur la sélection"}`,s=B(),o=S("div"),l=S("div");for(let u=0;u<c.length;u+=1)c[u].c();v(r,"class","tag is-medium is-link mr-5"),v(i,"class","column is-narrow mr-5"),v(l,"class","field has-addons"),v(o,"class","column"),v(n,"class","columns is-vcentered is-mobile py-4"),v(e,"slot","toolbar-visible")},m(u,d){z(u,e,d),y(e,n),y(n,i),y(i,r),y(n,s),y(n,o),y(o,l);for(let f=0;f<c.length;f+=1)c[f]&&c[f].m(l,null)},p(u,d){if(d&1024){a=Object.values(u[10]);let f;for(f=0;f<a.length;f+=1){const h=Ql(u,a,f);c[f]?c[f].p(h,d):(c[f]=Zl(h),c[f].c(),c[f].m(l,null))}for(;f<c.length;f+=1)c[f].d(1);c.length=a.length}},d(u){u&&$(e),nt(c,u)}}}function Xg(t){let e,n=t[9].title+"",i;return{c(){e=S("span"),i=te(n),v(e,"class","button is-small is-success"),v(e,"title",t[9].desc)},m(r,s){z(r,e,s),y(e,i)},p:X,d(r){r&&$(e)}}}function Jg(t){let e,n=t[8].title+"",i,r,s;function o(){return t[12](t[17])}return{c(){e=S("button"),i=te(n),v(e,"class","button is-small is-warning"),v(e,"title",t[8].desc)},m(l,a){z(l,e,a),y(e,i),r||(s=be(e,"click",o),r=!0)},p(l,a){t=l},d(l){l&&$(e),r=!1,s()}}}function Qg(t){let e,n,i=t[17].size+"",r,s,o,l,a,c;function u(h,m){return h[17].fullyConnected?Xg:Jg}let d=u(t),f=d(t);return{c(){e=S("div"),n=S("span"),r=te(i),s=te(" images"),o=B(),l=S("hr"),a=B(),f.c(),c=B(),v(n,"class","cluster-size"),v(e,"class","cluster-info is-center is-fullwidth")},m(h,m){z(h,e,m),y(e,n),y(n,r),y(n,s),y(e,o),y(e,l),y(e,a),f.m(e,null),z(h,c,m)},p(h,m){m&4&&i!==(i=h[17].size+"")&&pe(r,i),d===(d=u(h))&&f?f.p(h,m):(f.d(1),f=d(h),f&&(f.c(),f.m(e,null)))},d(h){h&&$(e),f.d(),h&&$(c)}}}function ea(t){let e,n;return e=new xn({props:{item:{...t[3].get(t[20]),clusterId:t[17].id},copyable:!1,selectionStore:Fi}}),{c(){le(e.$$.fragment)},m(i,r){se(e,i,r),n=!0},p(i,r){const s={};r&12&&(s.item={...i[3].get(i[20]),clusterId:i[17].id}),e.$set(s)},i(i){n||(V(e.$$.fragment,i),n=!0)},o(i){K(e.$$.fragment,i),n=!1},d(i){oe(e,i)}}}function Zg(t){let e,n,i=t[17].members,r=[];for(let o=0;o<i.length;o+=1)r[o]=ea(Jl(t,i,o));const s=o=>K(r[o],1,1,()=>{r[o]=null});return{c(){for(let o=0;o<r.length;o+=1)r[o].c();e=B()},m(o,l){for(let a=0;a<r.length;a+=1)r[a]&&r[a].m(o,l);z(o,e,l),n=!0},p(o,l){if(l&12){i=o[17].members;let a;for(a=0;a<i.length;a+=1){const c=Jl(o,i,a);r[a]?(r[a].p(c,l),V(r[a],1)):(r[a]=ea(c),r[a].c(),V(r[a],1),r[a].m(e.parentNode,e))}for(Se(),a=i.length;a<r.length;a+=1)s(a);ke()}},i(o){if(!n){for(let l=0;l<i.length;l+=1)V(r[l]);n=!0}},o(o){r=r.filter(Boolean);for(let l=0;l<r.length;l+=1)K(r[l]);n=!1},d(o){nt(r,o),o&&$(e)}}}function ta(t,e){let n,i,r;return i=new Ll({props:{$$slots:{"row-body":[Zg],"row-header":[Qg]},$$scope:{ctx:e}}}),{key:t,first:null,c(){n=Ke(),le(i.$$.fragment),this.first=n},m(s,o){z(s,n,o),se(i,s,o),r=!0},p(s,o){e=s;const l={};o&67108876&&(l.$$scope={dirty:o,ctx:e}),i.$set(l)},i(s){r||(V(i.$$.fragment,s),r=!0)},o(s){K(i.$$.fragment,s),r=!1},d(s){s&&$(n),oe(i,s)}}}function e_(t){let e=[],n=new Map,i,r,s=t[2];const o=l=>l[17].id;for(let l=0;l<s.length;l+=1){let a=Xl(t,s,l),c=o(a);n.set(c,e[l]=ta(c,a))}return{c(){for(let l=0;l<e.length;l+=1)e[l].c();i=Ke()},m(l,a){for(let c=0;c<e.length;c+=1)e[c]&&e[c].m(l,a);z(l,i,a),r=!0},p(l,a){a&780&&(s=l[2],Se(),e=sr(e,a,o,1,l,s,n,i.parentNode,rr,ta,i,Xl),ke())},i(l){if(!r){for(let a=0;a<s.length;a+=1)V(e[a]);r=!0}},o(l){for(let a=0;a<e.length;a+=1)K(e[a]);r=!1},d(l){for(let a=0;a<e.length;a+=1)e[a].d(l);l&&$(i)}}}function t_(t){let e,n,i,r,s,o,l,a,c,u;return e=new Mg({props:{expandable:!1,$$slots:{"toolbar-visible":[Yg]},$$scope:{ctx:t}}}),i=new Kl({props:{store:t[0],nbOfItems:t[1],pageLength:t[7]}}),s=new Gg({props:{selectionStore:Fi}}),l=new dg({props:{$$slots:{default:[e_]},$$scope:{ctx:t}}}),c=new Kl({props:{store:t[0],nbOfItems:t[1],pageLength:t[7]}}),{c(){le(e.$$.fragment),n=B(),le(i.$$.fragment),r=B(),le(s.$$.fragment),o=B(),le(l.$$.fragment),a=B(),le(c.$$.fragment)},m(d,f){se(e,d,f),z(d,n,f),se(i,d,f),z(d,r,f),se(s,d,f),z(d,o,f),se(l,d,f),z(d,a,f),se(c,d,f),u=!0},p(d,[f]){const h={};f&67108864&&(h.$$scope={dirty:f,ctx:d}),e.$set(h);const m={};f&1&&(m.store=d[0]),f&2&&(m.nbOfItems=d[1]),i.$set(m);const g={};f&67108876&&(g.$$scope={dirty:f,ctx:d}),l.$set(g);const p={};f&1&&(p.store=d[0]),f&2&&(p.nbOfItems=d[1]),c.$set(p)},i(d){u||(V(e.$$.fragment,d),V(i.$$.fragment,d),V(s.$$.fragment,d),V(l.$$.fragment,d),V(c.$$.fragment,d),u=!0)},o(d){K(e.$$.fragment,d),K(i.$$.fragment,d),K(s.$$.fragment,d),K(l.$$.fragment,d),K(c.$$.fragment,d),u=!1},d(d){oe(e,d),d&&$(n),oe(i,d),d&&$(r),oe(s,d),d&&$(o),oe(l,d),d&&$(a),oe(c,d)}}}function n_(t,e,n){let i,r,s,{documentSetStore:o}=e;const{imageNodes:l}=o;ge(t,l,b=>n(3,s=b));let{clusterStore:a}=e;const{clusterNb:c,paginatedClusters:u,pageLength:d,validateCluster:f,newCluster:h,removeFromClusters:m}=a;ge(t,c,b=>n(1,i=b)),ge(t,u,b=>n(2,r=b));const g={create:{title:W==="en"?"New cluster":"Nouveau cluster",desc:W==="en"?"Create a new validated cluster from the selected regions":"Créer un nouveau cluster valide à partir des régions sélectionnées",icon:"fa-object-group",shortcut:"Shift + C",fct:h},remove:{title:W==="en"?"Remove from cluster":"Retirer du cluster",desc:W==="en"?"Remove the selected regions from their cluster":"Retirer les régions sélectionnées de leur cluster",icon:"fa-chain-broken",shortcut:"Shift + D",fct:m},validate:{title:W==="en"?"Validate cluster":"Valider le cluster",desc:W==="en"?"Set as exact match all the pairs of regions in the cluster":"Définir comme correspondance exacte toutes les paires de régions dans le cluster",icon:"fa-check",fct:f},validated:{title:W==="en"?"Validated cluster":"Cluster valide",desc:W==="en"?"All pairs of regions have be categorized as exact matches":"Toutes les paires de régions ont été catégorisées comme des correspondances exactes",icon:"fa-check"}},{validate:p,validated:_,...w}=g,I=b=>p.fct(b);return t.$$set=b=>{"documentSetStore"in b&&n(11,o=b.documentSetStore),"clusterStore"in b&&n(0,a=b.clusterStore)},[a,i,r,s,l,c,u,d,p,_,w,o,I]}class i_ extends ve{constructor(e){super(),_e(this,e,n_,t_,me,{documentSetStore:11,clusterStore:0})}}function r_(t,e){const i=we(1),{allPairs:r,imageNodes:s}=t;cr(i,"p");function o(b){ur(b,i,"p")}function l(b){if(b.length===0)return[];const E=new Map,T=O=>E.has(O)?(E.get(O)!==O&&E.set(O,T(E.get(O))),E.get(O)):(E.set(O,O),O),M=(O,D)=>{const q=T(O),R=T(D);q!==R&&E.set(R,q)},k=new Set;b.forEach(O=>{O.category===1&&(M(O.id_1,O.id_2),k.add(O.id_1),k.add(O.id_2))});const x=new Map;return k.forEach(O=>{const D=T(O);x.has(D)||x.set(D,[]),x.get(D).push(O)}),Array.from(x.values()).map(O=>{const D=O.length,q=D*(D-1)/2,R=new Set(O),C=b.filter(L=>L.category===1&&R.has(L.id_1)&&R.has(L.id_2)).length;return{id:crypto.randomUUID(),members:O,size:D,fullyConnected:C===q}}).filter(O=>O.size>1).sort((O,D)=>D.size-O.size)}const a=Be(r,b=>b.length?l(b):[]),c=we([]);a.subscribe(b=>{c.set(b)});const u=Be([c,i],([b,E])=>{const T=(E-1)*10,M=T+10;return b.slice(T,M)}),d=(b,E)=>{const T=tt(s).get(b),M=tt(s).get(E);return{img_1:b,img_2:E,regions_id_1:T==null?void 0:T.regionId,regions_id_2:M==null?void 0:M.regionId}},f=(b,E)=>(c.update(T=>T.map(M=>{if(!E[M.id])return M;const k=M.members.filter(x=>!b.has(x));return{...M,members:k,size:k.length}}).filter(M=>M.size>0)),!0),h=async b=>{const E=Array.isArray(b)?b:Object.keys(b),T=new Set(E),M={};tt(c).forEach(x=>{const O=x.members.filter(D=>T.has(D));O.length>0&&(M[x.id]=O)});const k=Object.entries(M).flatMap(([x,O])=>{const D=tt(c).find(R=>R.id===x);if(!D)return[];const q=D.members.filter(R=>!T.has(R));return O.flatMap(R=>q.map(C=>d(R,C)))});if(k.length===0)return f(T,M),!0;try{const x=await Is(()=>fetch(`${window.location.origin}/${Ct}/uncategorize-pair-batch`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":Xt},body:JSON.stringify({pairs:k})}));return x.ok?(f(T,M),!0):(console.log(x),await ct(W==="en"?"Batch un-categorization failed":"La dé-catégorisation par lot a échoué",W==="en"?"Error":"Erreur"),!1)}catch(x){return await ct(x,W==="en"?"Error":"Erreur"),!1}},m=async b=>{const E=b.flatMap((T,M)=>b.slice(M+1).map(k=>d(T,k)));try{const T=await Is(()=>fetch(`${window.location.origin}/${Ct}/exact-match-batch`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":Xt},body:JSON.stringify({pairs:E})}));return T.ok?!0:(console.log(T),await ct(W==="en"?"Batch validation failed":"La validation par lot a échoué",W==="en"?"Error":"Erreur"),!1)}catch(T){return await ct(T,W==="en"?"Error":"Erreur"),console.error("Error:",T),!1}},g=async b=>{const E=await m(b.members);return E&&c.update(T=>T.map(M=>M.id===b.id?{...M,fullyConnected:!0}:M)),E},p=async b=>{if(b.length<2)return!1;const E=await m(b);return E&&c.update(T=>[{id:crypto.randomUUID(),members:b,size:b.length,fullyConnected:!0},...T].sort((k,x)=>x.size-k.size)),E},_=()=>Object.values(tt(e).selected)[0]||{},w=async()=>{if(!await ct(W==="en"?"Do you want to create a cluster out of these images?":"Voulez-vous créer un cluster à partir de ces images ?",W==="en"?"Confirm creation":"Confirmer la création",!0))return;const E=_(),T=Object.keys(E);return T.length<2?(await ct(W==="en"?"Cluster creation requires at least 2 images":"La création d'un nouveau cluster nécessite a minima 2 images",W==="en"?"Impossible creation":"Création impossible"),!1):!await h(T)||!await p(T)?!1:(e.empty(),!0)},I=async()=>{if(!await ct(W==="en"?"Do you want to remove these images from their clusters?":"Voulez-vous supprimer ces images de leurs clusters ?",W==="en"?"Confirm deletion":"Confirmer la suppression",!0))return;const E=_();return await h(Object.keys(E))?(e.empty(),!0):!1};return{imageClusters:a,interfaceClusters:c,clusterNb:Be(c,b=>b.length),validateCluster:g,removeFromClusters:I,newCluster:w,paginatedClusters:u,handlePageUpdate:o,pageLength:10,currentPage:i}}function na(t,e,n){const i=t.slice();return i[17]=e[n],i}function s_(t){let e,n,i;return{c(){e=S("p"),e.textContent=`La matrice de documents visualise les scores de similarité globaux entre tous les documents du
                        corpus.
                        Cliquez sur une cellule pour voir les détails des similarités entre pages.`,n=B(),i=S("ul"),i.innerHTML=`<li>Matrice : Scores normalisés entre documents (0-100).</li>
                        <li>Scatter plot : Similarités détaillées par page.</li>`},m(r,s){z(r,e,s),z(r,n,s),z(r,i,s)},d(r){r&&$(e),r&&$(n),r&&$(i)}}}function o_(t){let e,n,i;return{c(){e=S("p"),e.textContent=`The Documents Network illustrates the connections between different witnesses in the document
                        set.
                        Each node represents a witness, and edges denote relationships based on shared content or other
                        relevant factors.`,n=B(),i=S("ul"),i.innerHTML=`<li>Nodes: Witnesses in the document set.</li>
                        <li>Edges: Relationships based on shared content.</li>`},m(r,s){z(r,e,s),z(r,n,s),z(r,i,s)},d(r){r&&$(e),r&&$(n),r&&$(i)}}}function l_(t){let e,n,i;return{c(){e=S("p"),e.textContent=`The Regions Network visualizes the relationships between image regions across different witnesses
                        in the document set.
                        Each node represents an image region, and edges indicate similarity or connections based on
                        predefined criteria.`,n=B(),i=S("ul"),i.innerHTML=`<li>Nodes: Image regions from various witnesses.</li>
                        <li>Edges: Similarity links between regions.</li>`},m(r,s){z(r,e,s),z(r,n,s),z(r,i,s)},d(r){r&&$(e),r&&$(n),r&&$(i)}}}function a_(t){let e,n,i,r;function s(a,c){return a[15]==="img"?l_:a[15]==="doc"?o_:s_}let o=s(t),l=o(t);return i=new ug({props:{activeTab:t[15],documentSetStore:t[4]}}),{c(){e=S("div"),l.c(),n=B(),le(i.$$.fragment),v(e,"slot","datavizInfo")},m(a,c){z(a,e,c),l.m(e,null),y(e,n),se(i,e,null),r=!0},p(a,c){o!==(o=s(a))&&(l.d(1),l=o(a),l&&(l.c(),l.m(e,n)));const u={};c&32768&&(u.activeTab=a[15]),i.$set(u)},i(a){r||(V(i.$$.fragment,a),r=!0)},o(a){K(i.$$.fragment,a),r=!1},d(a){a&&$(e),l.d(),oe(i)}}}function c_(t){let e,n,i;return n=new ku({props:{docSet:t[0],documentSetStore:t[4],clusterStore:t[8],$$slots:{datavizInfo:[a_]},$$scope:{ctx:t}}}),{c(){e=S("div"),le(n.$$.fragment),v(e,"slot","sidebar")},m(r,s){z(r,e,s),se(n,e,null),i=!0},p(r,s){const o={};s&1&&(o.docSet=r[0]),s&1081344&&(o.$$scope={dirty:s,ctx:r}),n.$set(o)},i(r){i||(V(n.$$.fragment,r),i=!0)},o(r){K(n.$$.fragment,r),i=!1},d(r){r&&$(e),oe(n)}}}function ia(t){let e,n,i,r,s,o,l,a=t[17].title+"",c,u;return{c(){e=S("div"),n=S("figure"),i=S("img"),s=B(),o=S("div"),l=S("span"),c=te(a),u=B(),pt(i.src,r=Pt(t[17].img,t[17].xywh,"96,"))||v(i,"src",r),v(i,"alt","Extracted region"),v(l,"class","overlay-desc"),v(o,"class","overlay is-center"),v(n,"class","image is-64x64 card"),v(e,"class","selection cell")},m(d,f){z(d,e,f),y(e,n),y(n,i),y(n,s),y(n,o),y(o,l),y(l,c),y(e,u)},p(d,f){f&2&&!pt(i.src,r=Pt(d[17].img,d[17].xywh,"96,"))&&v(i,"src",r),f&2&&a!==(a=d[17].title+"")&&pe(c,a)},d(d){d&&$(e)}}}function u_(t){let e,n,i=Object.values(Object.values(t[1])[0]||{}),r=[];for(let s=0;s<i.length;s+=1)r[s]=ia(na(t,i,s));return{c(){e=S("div"),n=S("div");for(let s=0;s<r.length;s+=1)r[s].c();v(n,"class","grid is-gap-2"),v(e,"slot","content"),v(e,"class","fixed-grid has-6-cols")},m(s,o){z(s,e,o),y(e,n);for(let l=0;l<r.length;l+=1)r[l]&&r[l].m(n,null)},p(s,o){if(o&2){i=Object.values(Object.values(s[1])[0]||{});let l;for(l=0;l<i.length;l+=1){const a=na(s,i,l);r[l]?r[l].p(a,o):(r[l]=ia(a),r[l].c(),r[l].m(n,null))}for(;l<r.length;l+=1)r[l].d(1);r.length=i.length}},d(s){s&&$(e),nt(r,s)}}}function f_(t){let e,n,i,r={ctx:t,current:null,token:null,hasCatch:!1,pending:b_,then:m_,catch:d_,value:16,blocks:[,,,]};return ir(n=t[3],r),{c(){e=Ke(),r.block.c()},m(s,o){z(s,e,o),r.block.m(s,r.anchor=o),r.mount=()=>e.parentNode,r.anchor=e,i=!0},p(s,o){t=s,r.ctx=t,o&8&&n!==(n=t[3])&&ir(n,r)||Es(r,t,o)},i(s){i||(V(r.block),i=!0)},o(s){for(let o=0;o<3;o+=1){const l=r.blocks[o];K(l)}i=!1},d(s){s&&$(e),r.block.d(s),r.token=null,r=null}}}function h_(t){let e,n,i;return{c(){e=S("article"),n=S("div"),i=te(t[2]),v(n,"class","message-body"),v(e,"class","message is-danger")},m(r,s){z(r,e,s),y(e,n),y(n,i)},p(r,s){s&4&&pe(i,r[2])},i:X,o:X,d(r){r&&$(e)}}}function d_(t){return{c:X,m:X,p:X,i:X,o:X,d:X}}function m_(t){let e,n,i,r;const s=[g_,p_],o=[];function l(a,c){return a[16]===0?0:1}return e=l(t),n=o[e]=s[e](t),{c(){n.c(),i=Ke()},m(a,c){o[e].m(a,c),z(a,i,c),r=!0},p(a,c){let u=e;e=l(a),e===u?o[e].p(a,c):(Se(),K(o[u],1,1,()=>{o[u]=null}),ke(),n=o[e],n?n.p(a,c):(n=o[e]=s[e](a),n.c()),V(n,1),n.m(i.parentNode,i))},i(a){r||(V(n),r=!0)},o(a){K(n),r=!1},d(a){o[e].d(a),a&&$(i)}}}function p_(t){let e,n,i=t[9][t[15]]+"",r,s,o,l,a;const c=[y_,v_,__],u=[];function d(f,h){return f[15]==="img"||f[15]==="doc"?0:f[15]==="sim"?1:f[15]==="mat"?2:-1}return~(o=d(t))&&(l=u[o]=c[o](t)),{c(){e=S("div"),n=S("h2"),r=te(i),s=B(),l&&l.c(),v(n,"class","title is-3 has-text-link")},m(f,h){z(f,e,h),y(e,n),y(n,r),y(e,s),~o&&u[o].m(e,null),a=!0},p(f,h){(!a||h&32768)&&i!==(i=f[9][f[15]]+"")&&pe(r,i);let m=o;o=d(f),o===m?~o&&u[o].p(f,h):(l&&(Se(),K(u[m],1,1,()=>{u[m]=null}),ke()),~o?(l=u[o],l?l.p(f,h):(l=u[o]=c[o](f),l.c()),V(l,1),l.m(e,null)):l=null)},i(f){a||(V(l),a=!0)},o(f){K(l),a=!1},d(f){f&&$(e),~o&&u[o].d()}}}function g_(t){let e;return{c(){e=S("article"),e.innerHTML=`<div class="message-body">No document pairs found for this configuration.
                            Please adjust your selection criteria in the sidebar to include more documents or
                            categories.</div>`,v(e,"class","message is-warning")},m(n,i){z(n,e,i)},p:X,i:X,o:X,d(n){n&&$(e)}}}function __(t){let e,n;return e=new sg({props:{documentSetStore:t[4]}}),{c(){le(e.$$.fragment)},m(i,r){se(e,i,r),n=!0},p:X,i(i){n||(V(e.$$.fragment,i),n=!0)},o(i){K(e.$$.fragment,i),n=!1},d(i){oe(e,i)}}}function v_(t){let e,n;return e=new i_({props:{documentSetStore:t[4],clusterStore:t[8]}}),{c(){le(e.$$.fragment)},m(i,r){se(e,i,r),n=!0},p:X,i(i){n||(V(e.$$.fragment,i),n=!0)},o(i){K(e.$$.fragment,i),n=!1},d(i){oe(e,i)}}}function y_(t){let e,n;return e=new Qp({props:{documentSetStore:t[4],type:t[15]}}),{c(){le(e.$$.fragment)},m(i,r){se(e,i,r),n=!0},p(i,r){const s={};r&32768&&(s.type=i[15]),e.$set(s)},i(i){n||(V(e.$$.fragment,i),n=!0)},o(i){K(e.$$.fragment,i),n=!1},d(i){oe(e,i)}}}function b_(t){let e;return{c(){e=S("progress"),e.textContent="Loading...",v(e,"class","progress is-link"),v(e,"max","100")},m(n,i){z(n,e,i)},p:X,i:X,o:X,d(n){n&&$(e)}}}function w_(t){let e,n,i,r,s,o;n=new eu({props:{$$slots:{content:[u_]},$$scope:{ctx:t}}});const l=[h_,f_],a=[];function c(u,d){return u[2]?0:1}return r=c(t),s=a[r]=l[r](t),{c(){e=S("div"),le(n.$$.fragment),i=B(),s.c(),v(e,"slot","content")},m(u,d){z(u,e,d),se(n,e,null),y(e,i),a[r].m(e,null),o=!0},p(u,d){const f={};d&1048578&&(f.$$scope={dirty:d,ctx:u}),n.$set(f);let h=r;r=c(u),r===h?a[r].p(u,d):(Se(),K(a[h],1,1,()=>{a[h]=null}),ke(),s=a[r],s?s.p(u,d):(s=a[r]=l[r](u),s.c()),V(s,1),s.m(e,null))},i(u){o||(V(n.$$.fragment,u),V(s),o=!0)},o(u){K(n.$$.fragment,u),K(s),o=!1},d(u){u&&$(e),oe(n),a[r].d()}}}function S_(t){let e,n;return e=new cu({props:{tabList:t[9],$$slots:{content:[w_,({activeTab:i})=>({15:i}),({activeTab:i})=>i?32768:0],sidebar:[c_,({activeTab:i})=>({15:i}),({activeTab:i})=>i?32768:0]},$$scope:{ctx:t}}}),{c(){le(e.$$.fragment)},m(i,r){se(e,i,r),n=!0},p(i,[r]){const s={};r&1081359&&(s.$$scope={dirty:r,ctx:i}),e.$set(s)},i(i){n||(V(e.$$.fragment,i),n=!0)},o(i){K(e.$$.fragment,i),n=!1},d(i){oe(e,i)}}}function k_(t,e,n){var w;let i,r,s,{docSet:o}=e;const l=lg(o.id),{error:a,fetchPairs:c,selectedRegions:u,selectedCategories:d}=l;ge(t,a,I=>n(2,r=I)),ge(t,c,I=>n(3,s=I));let f,h;Ln(()=>{f=Ts(u,"regions","set"),h=Ts(d,"categories","array");const I=u.subscribe(f),b=d.subscribe(h);return()=>{I(),b()}});const{selected:m}=Fi;ge(t,m,I=>n(1,i=I));const g=r_(l,Fi),p={img:W==="en"?"Image Network":"Réseau d'images",doc:W==="en"?"Document Network":"Réseau de documents",sim:W==="en"?"Copy Clusters":"Groupe de copies",mat:W==="en"?"Document Matrix":"Matrice de documents"},_=((w=o==null?void 0:o.selection)==null?void 0:w.selected)||{Witness:{},Series:{},Work:{}};return mn("selectedDocuments",_),t.$$set=I=>{"docSet"in I&&n(0,o=I.docSet)},[o,i,r,s,l,a,c,m,g,p]}class E_ extends ve{constructor(e){super(),_e(this,e,k_,S_,me,{docSet:0})}}new E_({target:document.getElementById("document-set"),props:{docSet}});const Ay="";function C_(t){let e,n,i;return n=new xn({props:{item:t[0],height:"full"}}),{c(){e=S("div"),le(n.$$.fragment),v(e,"class","img-wrapper svelte-1duc3w1")},m(r,s){z(r,e,s),se(n,e,null),i=!0},p(r,[s]){const o={};s&1&&(o.item=r[0]),n.$set(o)},i(r){i||(V(n.$$.fragment,r),i=!0)},o(r){K(n.$$.fragment,r),i=!1},d(r){r&&$(e),oe(n)}}}function I_(t,e,n){let{mainImgItem:i}=e;return t.$$set=r=>{"mainImgItem"in r&&n(0,i=r.mainImgItem)},[i]}class ra extends ve{constructor(e){super(),_e(this,e,I_,C_,me,{mainImgItem:0})}}const Ny="";function M_(t){return{c:X,m:X,p:X,d:X}}function x_(t){let e,n=`${t[5][0]}%`,i=`${t[5][1]}%`,r=`${t[5][2]}%`,s=`${t[5][3]}%`;return{c(){e=S("div"),v(e,"class","modal-context-bbox svelte-zgr10j"),v(e,"aria-description",W==="fr"?"Position de la région extraite sur la page":"Position of the extracted region on the page"),De(e,"left",n),De(e,"top",i),De(e,"width",r),De(e,"height",s)},m(o,l){z(o,e,l)},p:X,d(o){o&&$(e)}}}function A_(t){return{c:X,m:X,p:X,d:X}}function N_(t){let e,n,i,r,s,o={ctx:t,current:null,token:null,hasCatch:!1,pending:A_,then:x_,catch:M_,value:5};return ir(t[1],o),{c(){e=S("div"),n=S("div"),i=S("img"),s=B(),o.block.c(),v(i,"class","card modal-context-full-page svelte-zgr10j"),pt(i.src,r=t[0])||v(i,"src",r),v(i,"alt",W==="fr"?"Vue de la page d'où la région est extraite":"View of the page the region is extracted from"),v(n,"class","modal-context-wrapper svelte-zgr10j"),v(e,"class","modal-context-outer pb-4 svelte-zgr10j")},m(l,a){z(l,e,a),y(e,n),y(n,i),y(n,s),o.block.m(n,o.anchor=null),o.mount=()=>n,o.anchor=null},p(l,[a]){t=l,Es(o,t,a)},i:X,o:X,d(l){l&&$(e),o.block.d(),o.token=null,o=null}}}function T_(t,e,n){let{mainImgItem:i}=e;const r=Pt(i.img,"full","full"),s=Bc(i.img),o=i.xywh.map(Number),l=fetch(s).then(a=>a.json()).then(a=>[o[0]/a.width,o[1]/a.height,o[2]/a.width,o[3]/a.height].map(c=>c*100));return t.$$set=a=>{"mainImgItem"in a&&n(2,i=a.mainImgItem)},[r,l,i]}class O_ extends ve{constructor(e){super(),_e(this,e,T_,N_,me,{mainImgItem:2})}}const Ty="";function sa(t,e,n){const i=t.slice();return i[13]=e[n].id,i[14]=e[n].label,i}function oa(t){let e,n,i=t[14]+"",r,s,o,l,a;function c(){return t[9](t[13])}return{c(){e=S("li"),n=S("a"),r=te(i),s=B(),v(n,"href",""),v(e,"class",o=t[13]===t[2]?"is-active":"")},m(u,d){z(u,e,d),y(e,n),y(n,r),y(e,s),l||(a=be(n,"click",jt(c)),l=!0)},p(u,d){t=u,d&4&&o!==(o=t[13]===t[2]?"is-active":"")&&v(e,"class",o)},d(u){u&&$(e),l=!1,a()}}}function P_(t){let e,n,i,r,s,o,l,a,c,u,d,f,h,m,g,p=t[3],_=[];for(let E=0;E<p.length;E+=1)_[E]=oa(sa(t,p,E));const w=[t[1][t[2]]||{}];var I=t[0][t[2]]||null;function b(E){let T={};for(let M=0;M<w.length;M+=1)T=ms(T,w[M]);return{props:T}}return I&&(u=ai(I,b())),{c(){e=S("div"),n=S("div"),i=B(),r=S("div"),s=S("div"),o=S("div"),l=S("ul");for(let E=0;E<_.length;E+=1)_[E].c();a=B(),c=S("div"),u&&le(u.$$.fragment),d=B(),f=S("button"),v(n,"class","modal-background"),v(o,"class","tabs is-centered"),De(o,"height","fit-content"),v(c,"class","ml-4 mr-4 modal-main-wrapper svelte-1uakzh2"),Ce(c,"pb-4",t[2]==="main"),v(s,"class","modal-inner svelte-1uakzh2"),v(r,"class","modal-content svelte-1uakzh2"),v(f,"class","modal-close is-large"),v(f,"aria-label","close"),v(e,"id","region-modal-wrapper"),v(e,"class","modal is-active")},m(E,T){z(E,e,T),y(e,n),y(e,i),y(e,r),y(r,s),y(s,o),y(o,l);for(let M=0;M<_.length;M+=1)_[M]&&_[M].m(l,null);y(s,a),y(s,c),u&&se(u,c,null),y(e,d),y(e,f),h=!0,m||(g=[be(n,"click",t[6]),be(n,"keyup",t[5]),be(f,"click",t[6])],m=!0)},p(E,[T]){if(T&28){p=E[3];let k;for(k=0;k<p.length;k+=1){const x=sa(E,p,k);_[k]?_[k].p(x,T):(_[k]=oa(x),_[k].c(),_[k].m(l,null))}for(;k<_.length;k+=1)_[k].d(1);_.length=p.length}const M=T&6?Nc(w,[Tc(E[1][E[2]]||{})]):{};if(T&5&&I!==(I=E[0][E[2]]||null)){if(u){Se();const k=u;K(k.$$.fragment,1,0,()=>{oe(k,1)}),ke()}I?(u=ai(I,b()),le(u.$$.fragment),V(u.$$.fragment,1),se(u,c,null)):u=null}else I&&u.$set(M);(!h||T&4)&&Ce(c,"pb-4",E[2]==="main")},i(E){h||(u&&V(u.$$.fragment,E),h=!0)},o(E){u&&K(u.$$.fragment,E),h=!1},d(E){E&&$(e),nt(_,E),u&&oe(u),m=!1,Ye(g)}}}function L_(t,e,n){let i,{mainImgItem:r}=e,{compareImgItem:s}=e;const o=fi(),l=s?["main","page","similarity","expansion"]:["main","page"],a={expansion:{fr:"Expansion de requête",en:"Query expansion"},similarity:{fr:"Comparaison",en:"Comparison"},page:{fr:"Vue de la page",en:"Page view"},main:{fr:"Vue principale",en:"Main view"}},c=l.map(p=>{var _;return{id:p,label:((_=a[p])==null?void 0:_[W])??"Main view"}}),u={main:ra,page:O_};s&&Promise.all([qr(()=>Promise.resolve().then(()=>wv),void 0).then(p=>p.default),qr(()=>Promise.resolve().then(()=>Gv),void 0).then(p=>p.default)]).then(([p,_])=>{const w=Object.keys(u);l.filter(I=>!w.includes(I)).map(I=>n(0,u[I]=I==="expansion"?_:I==="similarity"?p:ra,u))});const d={};l.map(p=>n(1,d[p]=p==="similarity"?{compareImgItem:s,mainImgItem:r}:{mainImgItem:r},d));const f=p=>n(2,i=p),h=p=>{p.key==="Escape"&&o("closeModal")},m=()=>o("closeModal");Ln(()=>{document.addEventListener("keyup",h)}),Dn(()=>{document.removeEventListener("keydown",h)});const g=p=>f(p);return t.$$set=p=>{"mainImgItem"in p&&n(7,r=p.mainImgItem),"compareImgItem"in p&&n(8,s=p.compareImgItem)},n(2,i=l[0]),[u,d,i,c,f,h,m,r,s,g]}class D_ extends ve{constructor(e){super(),_e(this,e,L_,P_,me,{mainImgItem:7,compareImgItem:8})}}const Oy="";function R_(t){let e,n,i,r,s,o,l,a,c,u,d;return n=new Vi({props:{targetHtmlId:t[0],tooltipText:t[1]}}),{c(){e=S("div"),le(n.$$.fragment),i=B(),r=S("button"),s=Et("svg"),o=Et("path"),l=Et("path"),a=Et("path"),v(o,"d","M53.6443 14.25C47.7042 5.33 37.7293 0 26.9801 0C16.2206 0 6.24576 5.33 0.305653 14.25L0 14.71L0.305653 15.17C6.24576 24.09 16.2206 29.42 26.9801 29.42C37.7293 29.42 47.7042 24.09 53.6443 15.16L53.95 14.71L53.6443 14.25ZM3.25025 14.71C7.63146 8.69001 14.0606 4.65 21.2641 3.22C20.0619 3.83 18.9411 4.62 17.963 5.59C15.5176 8.02 14.1625 11.25 14.1625 14.67C14.1625 18.11 15.5176 21.34 17.963 23.76C19.0124 24.79 20.1943 25.61 21.4781 26.23C14.1829 24.85 7.6824 20.78 3.25025 14.71ZM27.1125 22.64C22.7008 22.64 19.1041 19.08 19.1041 14.7C19.1041 12.59 19.9396 10.6 21.4475 9.10001C22.9555 7.60001 24.9729 6.77 27.1125 6.77C29.2522 6.77 31.2594 7.60001 32.7775 9.10001C34.2855 10.6 35.121 12.59 35.121 14.7C35.121 16.82 34.2855 18.82 32.7775 20.32C31.2594 21.81 29.242 22.64 27.1125 22.64ZM32.9915 26.14C34.204 25.53 35.3146 24.74 36.3029 23.77C38.7482 21.34 40.0932 18.11 40.0932 14.68C40.0932 9.75 37.281 5.47001 33.1647 3.32001C40.1747 4.81001 46.4102 8.83001 50.6896 14.71C46.3797 20.64 40.0728 24.67 32.9915 26.14Z"),v(o,"fill","black"),v(o,"class","svelte-19wutme"),v(l,"d","M26.9804 25.98C33.3222 25.98 38.4633 20.9343 38.4633 14.71C38.4633 8.48576 33.3222 3.44 26.9804 3.44C20.6386 3.44 15.4976 8.48576 15.4976 14.71C15.4976 20.9343 20.6386 25.98 26.9804 25.98Z"),v(l,"fill","black"),v(l,"class","svelte-19wutme"),v(a,"d","M17.9529 23.85L36.2928 5.85001"),v(a,"stroke","black"),v(a,"stroke-width","3"),v(a,"stroke-miterlimit","10"),v(a,"class","svelte-19wutme"),v(s,"width","54"),v(s,"height","30"),v(s,"viewBox","0 0 54 30"),v(s,"fill","none"),v(s,"xmlns","http://www.w3.org/2000/svg"),v(s,"class","svelte-19wutme"),v(r,"class","button tag svelte-19wutme"),v(r,"title",t[1]),v(e,"id",t[0])},m(f,h){z(f,e,h),se(n,e,null),y(e,i),y(e,r),y(r,s),y(s,o),y(s,l),y(s,a),c=!0,u||(d=be(r,"click",t[2]),u=!0)},p:X,i(f){c||(V(n.$$.fragment,f),c=!0)},o(f){K(n.$$.fragment,f),c=!1},d(f){f&&$(e),oe(n),u=!1,d()}}}function $_(t,e,n){let i,r,{mainImgItem:s}=e,{compareImgItem:o=void 0}=e;mn("isInModal",!0);const l=`modal-opener-${window.crypto.randomUUID()}`,a=W==="fr"?"Vue détaillée":"Detailed view",c=(f,h)=>(f?(h=new D_({target:document.querySelector("body"),props:{mainImgItem:s,compareImgItem:o}}),h.$on("closeModal",d)):!f&&r!=null&&h.$destroy(),h),u=()=>n(5,i=!i),d=()=>n(5,i=!1);return t.$$set=f=>{"mainImgItem"in f&&n(3,s=f.mainImgItem),"compareImgItem"in f&&n(4,o=f.compareImgItem)},t.$$.update=()=>{t.$$.dirty&96&&n(6,r=c(i,r))},n(5,i=!1),[l,a,u,s,o,i,r]}class z_ extends ve{constructor(e){super(),_e(this,e,$_,R_,me,{mainImgItem:3,compareImgItem:4})}}const j_=Object.freeze(Object.defineProperty({__proto__:null,default:z_},Symbol.toStringTag,{value:"Module"})),Py="";function F_(t){let e,n,i,r,s,o,l;return{c(){e=S("button"),n=S("span"),n.innerHTML='<span class="switch-control svelte-g5g8im"><span class="switch-spot"></span></span>',i=B(),r=S("span"),s=te(t[0]),v(n,"class","switch mr-2 svelte-g5g8im"),v(r,"class","label svelte-g5g8im"),v(e,"id",t[3]),v(e,"name",t[3]),v(e,"class","input-checkbox-wrapper is-flex is-align-items-center-is-justify-content-center p-2 pl-3 pr-3 svelte-g5g8im"),v(e,"aria-label",t[0]),Ce(e,"is-checked",t[2]),Ce(e,"is-clickable",t[1]),Ce(e,"button",t[1])},m(a,c){z(a,e,c),y(e,n),y(e,i),y(e,r),y(r,s),o||(l=be(e,"click",jt(t[4])),o=!0)},p(a,[c]){c&1&&pe(s,a[0]),c&1&&v(e,"aria-label",a[0]),c&4&&Ce(e,"is-checked",a[2]),c&2&&Ce(e,"is-clickable",a[1]),c&2&&Ce(e,"button",a[1])},i:X,o:X,d(a){a&&$(e),o=!1,l()}}}function V_(t,e,n){let i,{toggleLabel:r}=e,{start:s=!1}=e,{buttonDisplay:o=!1}=e;const l=`input-toggle-${window.crypto.randomUUID()}`,a=fi(),c=gt("resetTrigger")||void 0;c==null||c.subscribe(d);const u=()=>n(2,i=!i);function d(){n(2,i=s)}return t.$$set=f=>{"toggleLabel"in f&&n(0,r=f.toggleLabel),"start"in f&&n(5,s=f.start),"buttonDisplay"in f&&n(1,o=f.buttonDisplay)},t.$$.update=()=>{t.$$.dirty&32&&n(2,i=s),t.$$.dirty&4&&a("updateChecked",i)},[r,o,i,l,u,s]}class H_ extends ve{constructor(e){super(),_e(this,e,V_,F_,me,{toggleLabel:0,start:5,buttonDisplay:1})}}/*! choices.js v11.1.0 | © 2025 Josh Johnson | https://github.com/jshjohnson/Choices#readme */var Gr=function(t,e){return Gr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(n[r]=i[r])},Gr(t,e)};function la(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");Gr(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}var ft=function(){return ft=Object.assign||function(e){for(var n,i=1,r=arguments.length;i<r;i++){n=arguments[i];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},ft.apply(this,arguments)};function U_(t,e,n){if(n||arguments.length===2)for(var i=0,r=e.length,s;i<r;i++)(s||!(i in e))&&(s||(s=Array.prototype.slice.call(e,0,i)),s[i]=e[i]);return t.concat(s||Array.prototype.slice.call(e))}typeof SuppressedError=="function"&&SuppressedError;var Fe={ADD_CHOICE:"ADD_CHOICE",REMOVE_CHOICE:"REMOVE_CHOICE",FILTER_CHOICES:"FILTER_CHOICES",ACTIVATE_CHOICES:"ACTIVATE_CHOICES",CLEAR_CHOICES:"CLEAR_CHOICES",ADD_GROUP:"ADD_GROUP",ADD_ITEM:"ADD_ITEM",REMOVE_ITEM:"REMOVE_ITEM",HIGHLIGHT_ITEM:"HIGHLIGHT_ITEM"},ht={showDropdown:"showDropdown",hideDropdown:"hideDropdown",change:"change",choice:"choice",search:"search",addItem:"addItem",removeItem:"removeItem",highlightItem:"highlightItem",highlightChoice:"highlightChoice",unhighlightItem:"unhighlightItem"},Je={TAB_KEY:9,SHIFT_KEY:16,BACK_KEY:46,DELETE_KEY:8,ENTER_KEY:13,A_KEY:65,ESC_KEY:27,UP_KEY:38,DOWN_KEY:40,PAGE_UP_KEY:33,PAGE_DOWN_KEY:34},B_=["fuseOptions","classNames"],Zt={Text:"text",SelectOne:"select-one",SelectMultiple:"select-multiple"},aa=function(t){return{type:Fe.ADD_CHOICE,choice:t}},q_=function(t){return{type:Fe.REMOVE_CHOICE,choice:t}},K_=function(t){return{type:Fe.FILTER_CHOICES,results:t}},W_=function(t){return{type:Fe.ACTIVATE_CHOICES,active:t}},G_=function(t){return{type:Fe.ADD_GROUP,group:t}},ca=function(t){return{type:Fe.ADD_ITEM,item:t}},ua=function(t){return{type:Fe.REMOVE_ITEM,item:t}},Hi=function(t,e){return{type:Fe.HIGHLIGHT_ITEM,item:t,highlighted:e}},Y_=function(t,e){return Math.floor(Math.random()*(e-t)+t)},fa=function(t){return Array.from({length:t},function(){return Y_(0,36).toString(36)}).join("")},X_=function(t,e){var n=t.id||t.name&&"".concat(t.name,"-").concat(fa(2))||fa(4);return n=n.replace(/(:|\.|\[|\]|,)/g,""),n="".concat(e,"-").concat(n),n},J_=function(t,e,n){n===void 0&&(n=1);for(var i="".concat(n>0?"next":"previous","ElementSibling"),r=t[i];r;){if(r.matches(e))return r;r=r[i]}return null},Q_=function(t,e,n){n===void 0&&(n=1);var i;return n>0?i=e.scrollTop+e.offsetHeight>=t.offsetTop+t.offsetHeight:i=t.offsetTop>=e.scrollTop,i},Ui=function(t){if(typeof t!="string"){if(t==null)return"";if(typeof t=="object"){if("raw"in t)return Ui(t.raw);if("trusted"in t)return t.trusted}return t}return t.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/'/g,"&#039;").replace(/"/g,"&quot;")},Z_=function(){var t=document.createElement("div");return function(e){t.innerHTML=e.trim();for(var n=t.children[0];t.firstChild;)t.removeChild(t.firstChild);return n}}(),Xn=function(t,e){return typeof t=="function"?t(Ui(e),e):t},ha=function(t){return typeof t=="function"?t():t},an=function(t){if(typeof t=="string")return t;if(typeof t=="object"){if("trusted"in t)return t.trusted;if("raw"in t)return t.raw}return""},da=function(t){if(typeof t=="string")return t;if(typeof t=="object"){if("escaped"in t)return t.escaped;if("trusted"in t)return t.trusted}return""},Yr=function(t,e){return t?da(e):Ui(e)},Kt=function(t,e,n){t.innerHTML=Yr(e,n)},e0=function(t,e){var n=t.value,i=t.label,r=i===void 0?n:i,s=e.value,o=e.label,l=o===void 0?s:o;return an(r).localeCompare(an(l),[],{sensitivity:"base",ignorePunctuation:!0,numeric:!0})},t0=function(t,e){return t.rank-e.rank},n0=function(t,e,n){n===void 0&&(n=null);var i=new CustomEvent(e,{detail:n,bubbles:!0,cancelable:!0});return t.dispatchEvent(i)},i0=function(t,e){var n=Object.keys(t).sort(),i=Object.keys(e).sort();return n.filter(function(r){return i.indexOf(r)<0})},Bi=function(t){return Array.isArray(t)?t:[t]},Jn=function(t){return t&&Array.isArray(t)?t.map(function(e){return".".concat(e)}).join(""):".".concat(t)},de=function(t,e){var n;(n=t.classList).add.apply(n,Bi(e))},Rt=function(t,e){var n;(n=t.classList).remove.apply(n,Bi(e))},r0=function(t){if(typeof t<"u")try{return JSON.parse(t)}catch{return t}return{}},s0=function(t,e,n){var i=t.itemEl;i&&(Rt(i,n),de(i,e))},o0=function(){function t(e){var n=e.element,i=e.type,r=e.classNames;this.element=n,this.classNames=r,this.type=i,this.isActive=!1}return t.prototype.show=function(){return de(this.element,this.classNames.activeState),this.element.setAttribute("aria-expanded","true"),this.isActive=!0,this},t.prototype.hide=function(){return Rt(this.element,this.classNames.activeState),this.element.setAttribute("aria-expanded","false"),this.isActive=!1,this},t}(),ma=function(){function t(e){var n=e.element,i=e.type,r=e.classNames,s=e.position;this.element=n,this.classNames=r,this.type=i,this.position=s,this.isOpen=!1,this.isFlipped=!1,this.isDisabled=!1,this.isLoading=!1}return t.prototype.shouldFlip=function(e,n){var i=!1;return this.position==="auto"?i=this.element.getBoundingClientRect().top-n>=0&&!window.matchMedia("(min-height: ".concat(e+1,"px)")).matches:this.position==="top"&&(i=!0),i},t.prototype.setActiveDescendant=function(e){this.element.setAttribute("aria-activedescendant",e)},t.prototype.removeActiveDescendant=function(){this.element.removeAttribute("aria-activedescendant")},t.prototype.open=function(e,n){de(this.element,this.classNames.openState),this.element.setAttribute("aria-expanded","true"),this.isOpen=!0,this.shouldFlip(e,n)&&(de(this.element,this.classNames.flippedState),this.isFlipped=!0)},t.prototype.close=function(){Rt(this.element,this.classNames.openState),this.element.setAttribute("aria-expanded","false"),this.removeActiveDescendant(),this.isOpen=!1,this.isFlipped&&(Rt(this.element,this.classNames.flippedState),this.isFlipped=!1)},t.prototype.addFocusState=function(){de(this.element,this.classNames.focusState)},t.prototype.removeFocusState=function(){Rt(this.element,this.classNames.focusState)},t.prototype.enable=function(){Rt(this.element,this.classNames.disabledState),this.element.removeAttribute("aria-disabled"),this.type===Zt.SelectOne&&this.element.setAttribute("tabindex","0"),this.isDisabled=!1},t.prototype.disable=function(){de(this.element,this.classNames.disabledState),this.element.setAttribute("aria-disabled","true"),this.type===Zt.SelectOne&&this.element.setAttribute("tabindex","-1"),this.isDisabled=!0},t.prototype.wrap=function(e){var n=this.element,i=e.parentNode;i&&(e.nextSibling?i.insertBefore(n,e.nextSibling):i.appendChild(n)),n.appendChild(e)},t.prototype.unwrap=function(e){var n=this.element,i=n.parentNode;i&&(i.insertBefore(e,n),i.removeChild(n))},t.prototype.addLoadingState=function(){de(this.element,this.classNames.loadingState),this.element.setAttribute("aria-busy","true"),this.isLoading=!0},t.prototype.removeLoadingState=function(){Rt(this.element,this.classNames.loadingState),this.element.removeAttribute("aria-busy"),this.isLoading=!1},t}(),l0=function(){function t(e){var n=e.element,i=e.type,r=e.classNames,s=e.preventPaste;this.element=n,this.type=i,this.classNames=r,this.preventPaste=s,this.isFocussed=this.element.isEqualNode(document.activeElement),this.isDisabled=n.disabled,this._onPaste=this._onPaste.bind(this),this._onInput=this._onInput.bind(this),this._onFocus=this._onFocus.bind(this),this._onBlur=this._onBlur.bind(this)}return Object.defineProperty(t.prototype,"placeholder",{set:function(e){this.element.placeholder=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){return this.element.value},set:function(e){this.element.value=e},enumerable:!1,configurable:!0}),t.prototype.addEventListeners=function(){var e=this.element;e.addEventListener("paste",this._onPaste),e.addEventListener("input",this._onInput,{passive:!0}),e.addEventListener("focus",this._onFocus,{passive:!0}),e.addEventListener("blur",this._onBlur,{passive:!0})},t.prototype.removeEventListeners=function(){var e=this.element;e.removeEventListener("input",this._onInput),e.removeEventListener("paste",this._onPaste),e.removeEventListener("focus",this._onFocus),e.removeEventListener("blur",this._onBlur)},t.prototype.enable=function(){var e=this.element;e.removeAttribute("disabled"),this.isDisabled=!1},t.prototype.disable=function(){var e=this.element;e.setAttribute("disabled",""),this.isDisabled=!0},t.prototype.focus=function(){this.isFocussed||this.element.focus()},t.prototype.blur=function(){this.isFocussed&&this.element.blur()},t.prototype.clear=function(e){return e===void 0&&(e=!0),this.element.value="",e&&this.setWidth(),this},t.prototype.setWidth=function(){var e=this.element;e.style.minWidth="".concat(e.placeholder.length+1,"ch"),e.style.width="".concat(e.value.length+1,"ch")},t.prototype.setActiveDescendant=function(e){this.element.setAttribute("aria-activedescendant",e)},t.prototype.removeActiveDescendant=function(){this.element.removeAttribute("aria-activedescendant")},t.prototype._onInput=function(){this.type!==Zt.SelectOne&&this.setWidth()},t.prototype._onPaste=function(e){this.preventPaste&&e.preventDefault()},t.prototype._onFocus=function(){this.isFocussed=!0},t.prototype._onBlur=function(){this.isFocussed=!1},t}(),a0=4,pa=function(){function t(e){var n=e.element;this.element=n,this.scrollPos=this.element.scrollTop,this.height=this.element.offsetHeight}return t.prototype.prepend=function(e){var n=this.element.firstElementChild;n?this.element.insertBefore(e,n):this.element.append(e)},t.prototype.scrollToTop=function(){this.element.scrollTop=0},t.prototype.scrollToChildElement=function(e,n){var i=this;if(e){var r=this.element.offsetHeight,s=this.element.scrollTop+r,o=e.offsetHeight,l=e.offsetTop+o,a=n>0?this.element.scrollTop+l-s:e.offsetTop;requestAnimationFrame(function(){i._animateScroll(a,n)})}},t.prototype._scrollDown=function(e,n,i){var r=(i-e)/n,s=r>1?r:1;this.element.scrollTop=e+s},t.prototype._scrollUp=function(e,n,i){var r=(e-i)/n,s=r>1?r:1;this.element.scrollTop=e-s},t.prototype._animateScroll=function(e,n){var i=this,r=a0,s=this.element.scrollTop,o=!1;n>0?(this._scrollDown(s,r,e),s<e&&(o=!0)):(this._scrollUp(s,r,e),s>e&&(o=!0)),o&&requestAnimationFrame(function(){i._animateScroll(e,n)})},t}(),ga=function(){function t(e){var n=e.element,i=e.classNames;this.element=n,this.classNames=i,this.isDisabled=!1}return Object.defineProperty(t.prototype,"isActive",{get:function(){return this.element.dataset.choice==="active"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dir",{get:function(){return this.element.dir},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){return this.element.value},set:function(e){this.element.setAttribute("value",e),this.element.value=e},enumerable:!1,configurable:!0}),t.prototype.conceal=function(){var e=this.element;de(e,this.classNames.input),e.hidden=!0,e.tabIndex=-1;var n=e.getAttribute("style");n&&e.setAttribute("data-choice-orig-style",n),e.setAttribute("data-choice","active")},t.prototype.reveal=function(){var e=this.element;Rt(e,this.classNames.input),e.hidden=!1,e.removeAttribute("tabindex");var n=e.getAttribute("data-choice-orig-style");n?(e.removeAttribute("data-choice-orig-style"),e.setAttribute("style",n)):e.removeAttribute("style"),e.removeAttribute("data-choice")},t.prototype.enable=function(){this.element.removeAttribute("disabled"),this.element.disabled=!1,this.isDisabled=!1},t.prototype.disable=function(){this.element.setAttribute("disabled",""),this.element.disabled=!0,this.isDisabled=!0},t.prototype.triggerEvent=function(e,n){n0(this.element,e,n||{})},t}(),c0=function(t){la(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e}(ga),Qn=function(t,e){return e===void 0&&(e=!0),typeof t>"u"?e:!!t},_a=function(t){if(typeof t=="string"&&(t=t.split(" ").filter(function(e){return e.length})),Array.isArray(t)&&t.length)return t},$t=function(t,e,n){if(n===void 0&&(n=!0),typeof t=="string"){var i=Ui(t),r=n||i===t?t:{escaped:i,raw:t},s=$t({value:t,label:r,selected:!0},!1);return s}var o=t;if("choices"in o){if(!e)throw new TypeError("optGroup is not allowed");var l=o,a=l.choices.map(function(f){return $t(f,!1)}),c={id:0,label:an(l.label)||l.value,active:!!a.length,disabled:!!l.disabled,choices:a};return c}var u=o,d={id:0,group:null,score:0,rank:0,value:u.value,label:u.label||u.value,active:Qn(u.active),selected:Qn(u.selected,!1),disabled:Qn(u.disabled,!1),placeholder:Qn(u.placeholder,!1),highlighted:!1,labelClass:_a(u.labelClass),labelDescription:u.labelDescription,customProperties:u.customProperties};return d},u0=function(t){return t.tagName==="INPUT"},va=function(t){return t.tagName==="SELECT"},f0=function(t){return t.tagName==="OPTION"},h0=function(t){return t.tagName==="OPTGROUP"},d0=function(t){la(e,t);function e(n){var i=n.element,r=n.classNames,s=n.template,o=n.extractPlaceholder,l=t.call(this,{element:i,classNames:r})||this;return l.template=s,l.extractPlaceholder=o,l}return Object.defineProperty(e.prototype,"placeholderOption",{get:function(){return this.element.querySelector('option[value=""]')||this.element.querySelector("option[placeholder]")},enumerable:!1,configurable:!0}),e.prototype.addOptions=function(n){var i=this,r=document.createDocumentFragment();n.forEach(function(s){var o=s;if(!o.element){var l=i.template(o);r.appendChild(l),o.element=l}}),this.element.appendChild(r)},e.prototype.optionsAsChoices=function(){var n=this,i=[];return this.element.querySelectorAll(":scope > option, :scope > optgroup").forEach(function(r){f0(r)?i.push(n._optionToChoice(r)):h0(r)&&i.push(n._optgroupToChoice(r))}),i},e.prototype._optionToChoice=function(n){return!n.hasAttribute("value")&&n.hasAttribute("placeholder")&&(n.setAttribute("value",""),n.value=""),{id:0,group:null,score:0,rank:0,value:n.value,label:n.label,element:n,active:!0,selected:this.extractPlaceholder?n.selected:n.hasAttribute("selected"),disabled:n.disabled,highlighted:!1,placeholder:this.extractPlaceholder&&(!n.value||n.hasAttribute("placeholder")),labelClass:typeof n.dataset.labelClass<"u"?_a(n.dataset.labelClass):void 0,labelDescription:typeof n.dataset.labelDescription<"u"?n.dataset.labelDescription:void 0,customProperties:r0(n.dataset.customProperties)}},e.prototype._optgroupToChoice=function(n){var i=this,r=n.querySelectorAll("option"),s=Array.from(r).map(function(o){return i._optionToChoice(o)});return{id:0,label:n.label||"",element:n,active:!!s.length,disabled:n.disabled,choices:s}},e}(ga),m0={containerOuter:["choices"],containerInner:["choices__inner"],input:["choices__input"],inputCloned:["choices__input--cloned"],list:["choices__list"],listItems:["choices__list--multiple"],listSingle:["choices__list--single"],listDropdown:["choices__list--dropdown"],item:["choices__item"],itemSelectable:["choices__item--selectable"],itemDisabled:["choices__item--disabled"],itemChoice:["choices__item--choice"],description:["choices__description"],placeholder:["choices__placeholder"],group:["choices__group"],groupHeading:["choices__heading"],button:["choices__button"],activeState:["is-active"],focusState:["is-focused"],openState:["is-open"],disabledState:["is-disabled"],highlightedState:["is-highlighted"],selectedState:["is-selected"],flippedState:["is-flipped"],loadingState:["is-loading"],notice:["choices__notice"],addChoice:["choices__item--selectable","add-choice"],noResults:["has-no-results"],noChoices:["has-no-choices"]},ya={items:[],choices:[],silent:!1,renderChoiceLimit:-1,maxItemCount:-1,closeDropdownOnSelect:"auto",singleModeForMultiSelect:!1,addChoices:!1,addItems:!0,addItemFilter:function(t){return!!t&&t!==""},removeItems:!0,removeItemButton:!1,removeItemButtonAlignLeft:!1,editItems:!1,allowHTML:!1,allowHtmlUserInput:!1,duplicateItemsAllowed:!0,delimiter:",",paste:!0,searchEnabled:!0,searchChoices:!0,searchFloor:1,searchResultLimit:4,searchFields:["label","value"],position:"auto",resetScrollPosition:!0,shouldSort:!0,shouldSortItems:!1,sorter:e0,shadowRoot:null,placeholder:!0,placeholderValue:null,searchPlaceholderValue:null,prependValue:null,appendValue:null,renderSelectedChoices:"auto",loadingText:"Loading...",noResultsText:"No results found",noChoicesText:"No choices to choose from",itemSelectText:"Press to select",uniqueItemText:"Only unique values can be added",customAddItemText:"Only values matching specific conditions can be added",addItemText:function(t){return'Press Enter to add <b>"'.concat(t,'"</b>')},removeItemIconText:function(){return"Remove item"},removeItemLabelText:function(t){return"Remove item: ".concat(t)},maxItemText:function(t){return"Only ".concat(t," values can be added")},valueComparer:function(t,e){return t===e},fuseOptions:{includeScore:!0},labelId:"",callbackOnInit:null,callbackOnCreateTemplates:null,classNames:m0,appendGroupInSearch:!1},ba=function(t){var e=t.itemEl;e&&(e.remove(),t.itemEl=void 0)};function p0(t,e,n){var i=t,r=!0;switch(e.type){case Fe.ADD_ITEM:{e.item.selected=!0;var s=e.item.element;s&&(s.selected=!0,s.setAttribute("selected","")),i.push(e.item);break}case Fe.REMOVE_ITEM:{e.item.selected=!1;var s=e.item.element;if(s){s.selected=!1,s.removeAttribute("selected");var o=s.parentElement;o&&va(o)&&o.type===Zt.SelectOne&&(o.value="")}ba(e.item),i=i.filter(function(u){return u.id!==e.item.id});break}case Fe.REMOVE_CHOICE:{ba(e.choice),i=i.filter(function(c){return c.id!==e.choice.id});break}case Fe.HIGHLIGHT_ITEM:{var l=e.highlighted,a=i.find(function(c){return c.id===e.item.id});a&&a.highlighted!==l&&(a.highlighted=l,n&&s0(a,l?n.classNames.highlightedState:n.classNames.selectedState,l?n.classNames.selectedState:n.classNames.highlightedState));break}default:{r=!1;break}}return{state:i,update:r}}function g0(t,e){var n=t,i=!0;switch(e.type){case Fe.ADD_GROUP:{n.push(e.group);break}case Fe.CLEAR_CHOICES:{n=[];break}default:{i=!1;break}}return{state:n,update:i}}function _0(t,e,n){var i=t,r=!0;switch(e.type){case Fe.ADD_CHOICE:{i.push(e.choice);break}case Fe.REMOVE_CHOICE:{e.choice.choiceEl=void 0,e.choice.group&&(e.choice.group.choices=e.choice.group.choices.filter(function(o){return o.id!==e.choice.id})),i=i.filter(function(o){return o.id!==e.choice.id});break}case Fe.ADD_ITEM:case Fe.REMOVE_ITEM:{e.item.choiceEl=void 0;break}case Fe.FILTER_CHOICES:{var s=[];e.results.forEach(function(o){s[o.item.id]=o}),i.forEach(function(o){var l=s[o.id];l!==void 0?(o.score=l.score,o.rank=l.rank,o.active=!0):(o.score=0,o.rank=0,o.active=!1),n&&n.appendGroupInSearch&&(o.choiceEl=void 0)});break}case Fe.ACTIVATE_CHOICES:{i.forEach(function(o){o.active=e.active,n&&n.appendGroupInSearch&&(o.choiceEl=void 0)});break}case Fe.CLEAR_CHOICES:{i=[];break}default:{r=!1;break}}return{state:i,update:r}}var wa={groups:g0,items:p0,choices:_0},v0=function(){function t(e){this._state=this.defaultState,this._listeners=[],this._txn=0,this._context=e}return Object.defineProperty(t.prototype,"defaultState",{get:function(){return{groups:[],items:[],choices:[]}},enumerable:!1,configurable:!0}),t.prototype.changeSet=function(e){return{groups:e,items:e,choices:e}},t.prototype.reset=function(){this._state=this.defaultState;var e=this.changeSet(!0);this._txn?this._changeSet=e:this._listeners.forEach(function(n){return n(e)})},t.prototype.subscribe=function(e){return this._listeners.push(e),this},t.prototype.dispatch=function(e){var n=this,i=this._state,r=!1,s=this._changeSet||this.changeSet(!1);Object.keys(wa).forEach(function(o){var l=wa[o](i[o],e,n._context);l.update&&(r=!0,s[o]=!0,i[o]=l.state)}),r&&(this._txn?this._changeSet=s:this._listeners.forEach(function(o){return o(s)}))},t.prototype.withTxn=function(e){this._txn++;try{e()}finally{if(this._txn=Math.max(0,this._txn-1),!this._txn){var n=this._changeSet;n&&(this._changeSet=void 0,this._listeners.forEach(function(i){return i(n)}))}}},Object.defineProperty(t.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"items",{get:function(){return this.state.items},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"highlightedActiveItems",{get:function(){return this.items.filter(function(e){return e.active&&e.highlighted})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"choices",{get:function(){return this.state.choices},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"activeChoices",{get:function(){return this.choices.filter(function(e){return e.active})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"searchableChoices",{get:function(){return this.choices.filter(function(e){return!e.disabled&&!e.placeholder})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"groups",{get:function(){return this.state.groups},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"activeGroups",{get:function(){var e=this;return this.state.groups.filter(function(n){var i=n.active&&!n.disabled,r=e.state.choices.some(function(s){return s.active&&!s.disabled});return i&&r},[])},enumerable:!1,configurable:!0}),t.prototype.inTxn=function(){return this._txn>0},t.prototype.getChoiceById=function(e){return this.activeChoices.find(function(n){return n.id===e})},t.prototype.getGroupById=function(e){return this.groups.find(function(n){return n.id===e})},t}(),We={noChoices:"no-choices",noResults:"no-results",addChoice:"add-choice",generic:""};function y0(t,e,n){return(e=w0(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Sa(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function An(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Sa(Object(n),!0).forEach(function(i){y0(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Sa(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}function b0(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var i=n.call(t,e||"default");if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function w0(t){var e=b0(t,"string");return typeof e=="symbol"?e:e+""}function Wt(t){return Array.isArray?Array.isArray(t):Ca(t)==="[object Array]"}const S0=1/0;function k0(t){if(typeof t=="string")return t;let e=t+"";return e=="0"&&1/t==-S0?"-0":e}function E0(t){return t==null?"":k0(t)}function zt(t){return typeof t=="string"}function ka(t){return typeof t=="number"}function C0(t){return t===!0||t===!1||I0(t)&&Ca(t)=="[object Boolean]"}function Ea(t){return typeof t=="object"}function I0(t){return Ea(t)&&t!==null}function vt(t){return t!=null}function Xr(t){return!t.trim().length}function Ca(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(t)}const Ly="Extended search is not available",M0="Incorrect 'index' type",x0=t=>`Invalid value for key ${t}`,A0=t=>`Pattern length exceeds max of ${t}.`,N0=t=>`Missing ${t} property in key`,T0=t=>`Property 'weight' in key '${t}' must be a positive integer`,Ia=Object.prototype.hasOwnProperty;class O0{constructor(e){this._keys=[],this._keyMap={};let n=0;e.forEach(i=>{let r=Ma(i);this._keys.push(r),this._keyMap[r.id]=r,n+=r.weight}),this._keys.forEach(i=>{i.weight/=n})}get(e){return this._keyMap[e]}keys(){return this._keys}toJSON(){return JSON.stringify(this._keys)}}function Ma(t){let e=null,n=null,i=null,r=1,s=null;if(zt(t)||Wt(t))i=t,e=xa(t),n=Jr(t);else{if(!Ia.call(t,"name"))throw new Error(N0("name"));const o=t.name;if(i=o,Ia.call(t,"weight")&&(r=t.weight,r<=0))throw new Error(T0(o));e=xa(o),n=Jr(o),s=t.getFn}return{path:e,id:n,weight:r,src:i,getFn:s}}function xa(t){return Wt(t)?t:t.split(".")}function Jr(t){return Wt(t)?t.join("."):t}function P0(t,e){let n=[],i=!1;const r=(s,o,l)=>{if(vt(s))if(!o[l])n.push(s);else{let a=o[l];const c=s[a];if(!vt(c))return;if(l===o.length-1&&(zt(c)||ka(c)||C0(c)))n.push(E0(c));else if(Wt(c)){i=!0;for(let u=0,d=c.length;u<d;u+=1)r(c[u],o,l+1)}else o.length&&r(c,o,l+1)}};return r(t,zt(e)?e.split("."):e,0),i?n:n[0]}const L0={includeMatches:!1,findAllMatches:!1,minMatchCharLength:1},D0={isCaseSensitive:!1,includeScore:!1,keys:[],shouldSort:!0,sortFn:(t,e)=>t.score===e.score?t.idx<e.idx?-1:1:t.score<e.score?-1:1},R0={location:0,threshold:.6,distance:100},$0={useExtendedSearch:!1,getFn:P0,ignoreLocation:!1,ignoreFieldNorm:!1,fieldNormWeight:1};var he=An(An(An(An({},D0),L0),R0),$0);const z0=/[^ ]+/g;function j0(t=1,e=3){const n=new Map,i=Math.pow(10,e);return{get(r){const s=r.match(z0).length;if(n.has(s))return n.get(s);const o=1/Math.pow(s,.5*t),l=parseFloat(Math.round(o*i)/i);return n.set(s,l),l},clear(){n.clear()}}}class Qr{constructor({getFn:e=he.getFn,fieldNormWeight:n=he.fieldNormWeight}={}){this.norm=j0(n,3),this.getFn=e,this.isCreated=!1,this.setIndexRecords()}setSources(e=[]){this.docs=e}setIndexRecords(e=[]){this.records=e}setKeys(e=[]){this.keys=e,this._keysMap={},e.forEach((n,i)=>{this._keysMap[n.id]=i})}create(){this.isCreated||!this.docs.length||(this.isCreated=!0,zt(this.docs[0])?this.docs.forEach((e,n)=>{this._addString(e,n)}):this.docs.forEach((e,n)=>{this._addObject(e,n)}),this.norm.clear())}add(e){const n=this.size();zt(e)?this._addString(e,n):this._addObject(e,n)}removeAt(e){this.records.splice(e,1);for(let n=e,i=this.size();n<i;n+=1)this.records[n].i-=1}getValueForItemAtKeyId(e,n){return e[this._keysMap[n]]}size(){return this.records.length}_addString(e,n){if(!vt(e)||Xr(e))return;let i={v:e,i:n,n:this.norm.get(e)};this.records.push(i)}_addObject(e,n){let i={i:n,$:{}};this.keys.forEach((r,s)=>{let o=r.getFn?r.getFn(e):this.getFn(e,r.path);if(vt(o)){if(Wt(o)){let l=[];const a=[{nestedArrIndex:-1,value:o}];for(;a.length;){const{nestedArrIndex:c,value:u}=a.pop();if(vt(u))if(zt(u)&&!Xr(u)){let d={v:u,i:c,n:this.norm.get(u)};l.push(d)}else Wt(u)&&u.forEach((d,f)=>{a.push({nestedArrIndex:f,value:d})})}i.$[s]=l}else if(zt(o)&&!Xr(o)){let l={v:o,n:this.norm.get(o)};i.$[s]=l}}}),this.records.push(i)}toJSON(){return{keys:this.keys,records:this.records}}}function Aa(t,e,{getFn:n=he.getFn,fieldNormWeight:i=he.fieldNormWeight}={}){const r=new Qr({getFn:n,fieldNormWeight:i});return r.setKeys(t.map(Ma)),r.setSources(e),r.create(),r}function F0(t,{getFn:e=he.getFn,fieldNormWeight:n=he.fieldNormWeight}={}){const{keys:i,records:r}=t,s=new Qr({getFn:e,fieldNormWeight:n});return s.setKeys(i),s.setIndexRecords(r),s}function qi(t,{errors:e=0,currentLocation:n=0,expectedLocation:i=0,distance:r=he.distance,ignoreLocation:s=he.ignoreLocation}={}){const o=e/t.length;if(s)return o;const l=Math.abs(i-n);return r?o+l/r:l?1:o}function V0(t=[],e=he.minMatchCharLength){let n=[],i=-1,r=-1,s=0;for(let o=t.length;s<o;s+=1){let l=t[s];l&&i===-1?i=s:!l&&i!==-1&&(r=s-1,r-i+1>=e&&n.push([i,r]),i=-1)}return t[s-1]&&s-i>=e&&n.push([i,s-1]),n}const cn=32;function H0(t,e,n,{location:i=he.location,distance:r=he.distance,threshold:s=he.threshold,findAllMatches:o=he.findAllMatches,minMatchCharLength:l=he.minMatchCharLength,includeMatches:a=he.includeMatches,ignoreLocation:c=he.ignoreLocation}={}){if(e.length>cn)throw new Error(A0(cn));const u=e.length,d=t.length,f=Math.max(0,Math.min(i,d));let h=s,m=f;const g=l>1||a,p=g?Array(d):[];let _;for(;(_=t.indexOf(e,m))>-1;){let M=qi(e,{currentLocation:_,expectedLocation:f,distance:r,ignoreLocation:c});if(h=Math.min(M,h),m=_+u,g){let k=0;for(;k<u;)p[_+k]=1,k+=1}}m=-1;let w=[],I=1,b=u+d;const E=1<<u-1;for(let M=0;M<u;M+=1){let k=0,x=b;for(;k<x;)qi(e,{errors:M,currentLocation:f+x,expectedLocation:f,distance:r,ignoreLocation:c})<=h?k=x:b=x,x=Math.floor((b-k)/2+k);b=x;let O=Math.max(1,f-x+1),D=o?d:Math.min(f+x,d)+u,q=Array(D+2);q[D+1]=(1<<M)-1;for(let C=D;C>=O;C-=1){let L=C-1,A=n[t.charAt(L)];if(g&&(p[L]=+!!A),q[C]=(q[C+1]<<1|1)&A,M&&(q[C]|=(w[C+1]|w[C])<<1|1|w[C+1]),q[C]&E&&(I=qi(e,{errors:M,currentLocation:L,expectedLocation:f,distance:r,ignoreLocation:c}),I<=h)){if(h=I,m=L,m<=f)break;O=Math.max(1,2*f-m)}}if(qi(e,{errors:M+1,currentLocation:f,expectedLocation:f,distance:r,ignoreLocation:c})>h)break;w=q}const T={isMatch:m>=0,score:Math.max(.001,I)};if(g){const M=V0(p,l);M.length?a&&(T.indices=M):T.isMatch=!1}return T}function U0(t){let e={};for(let n=0,i=t.length;n<i;n+=1){const r=t.charAt(n);e[r]=(e[r]||0)|1<<i-n-1}return e}class Na{constructor(e,{location:n=he.location,threshold:i=he.threshold,distance:r=he.distance,includeMatches:s=he.includeMatches,findAllMatches:o=he.findAllMatches,minMatchCharLength:l=he.minMatchCharLength,isCaseSensitive:a=he.isCaseSensitive,ignoreLocation:c=he.ignoreLocation}={}){if(this.options={location:n,threshold:i,distance:r,includeMatches:s,findAllMatches:o,minMatchCharLength:l,isCaseSensitive:a,ignoreLocation:c},this.pattern=a?e:e.toLowerCase(),this.chunks=[],!this.pattern.length)return;const u=(f,h)=>{this.chunks.push({pattern:f,alphabet:U0(f),startIndex:h})},d=this.pattern.length;if(d>cn){let f=0;const h=d%cn,m=d-h;for(;f<m;)u(this.pattern.substr(f,cn),f),f+=cn;if(h){const g=d-cn;u(this.pattern.substr(g),g)}}else u(this.pattern,0)}searchIn(e){const{isCaseSensitive:n,includeMatches:i}=this.options;if(n||(e=e.toLowerCase()),this.pattern===e){let m={isMatch:!0,score:0};return i&&(m.indices=[[0,e.length-1]]),m}const{location:r,distance:s,threshold:o,findAllMatches:l,minMatchCharLength:a,ignoreLocation:c}=this.options;let u=[],d=0,f=!1;this.chunks.forEach(({pattern:m,alphabet:g,startIndex:p})=>{const{isMatch:_,score:w,indices:I}=H0(e,m,g,{location:r+p,distance:s,threshold:o,findAllMatches:l,minMatchCharLength:a,includeMatches:i,ignoreLocation:c});_&&(f=!0),d+=w,_&&I&&(u=[...u,...I])});let h={isMatch:f,score:f?d/this.chunks.length:1};return f&&i&&(h.indices=u),h}}class en{constructor(e){this.pattern=e}static isMultiMatch(e){return Ta(e,this.multiRegex)}static isSingleMatch(e){return Ta(e,this.singleRegex)}search(){}}function Ta(t,e){const n=t.match(e);return n?n[1]:null}class B0 extends en{constructor(e){super(e)}static get type(){return"exact"}static get multiRegex(){return/^="(.*)"$/}static get singleRegex(){return/^=(.*)$/}search(e){const n=e===this.pattern;return{isMatch:n,score:n?0:1,indices:[0,this.pattern.length-1]}}}class q0 extends en{constructor(e){super(e)}static get type(){return"inverse-exact"}static get multiRegex(){return/^!"(.*)"$/}static get singleRegex(){return/^!(.*)$/}search(e){const i=e.indexOf(this.pattern)===-1;return{isMatch:i,score:i?0:1,indices:[0,e.length-1]}}}class K0 extends en{constructor(e){super(e)}static get type(){return"prefix-exact"}static get multiRegex(){return/^\^"(.*)"$/}static get singleRegex(){return/^\^(.*)$/}search(e){const n=e.startsWith(this.pattern);return{isMatch:n,score:n?0:1,indices:[0,this.pattern.length-1]}}}class W0 extends en{constructor(e){super(e)}static get type(){return"inverse-prefix-exact"}static get multiRegex(){return/^!\^"(.*)"$/}static get singleRegex(){return/^!\^(.*)$/}search(e){const n=!e.startsWith(this.pattern);return{isMatch:n,score:n?0:1,indices:[0,e.length-1]}}}class G0 extends en{constructor(e){super(e)}static get type(){return"suffix-exact"}static get multiRegex(){return/^"(.*)"\$$/}static get singleRegex(){return/^(.*)\$$/}search(e){const n=e.endsWith(this.pattern);return{isMatch:n,score:n?0:1,indices:[e.length-this.pattern.length,e.length-1]}}}class Y0 extends en{constructor(e){super(e)}static get type(){return"inverse-suffix-exact"}static get multiRegex(){return/^!"(.*)"\$$/}static get singleRegex(){return/^!(.*)\$$/}search(e){const n=!e.endsWith(this.pattern);return{isMatch:n,score:n?0:1,indices:[0,e.length-1]}}}class Oa extends en{constructor(e,{location:n=he.location,threshold:i=he.threshold,distance:r=he.distance,includeMatches:s=he.includeMatches,findAllMatches:o=he.findAllMatches,minMatchCharLength:l=he.minMatchCharLength,isCaseSensitive:a=he.isCaseSensitive,ignoreLocation:c=he.ignoreLocation}={}){super(e),this._bitapSearch=new Na(e,{location:n,threshold:i,distance:r,includeMatches:s,findAllMatches:o,minMatchCharLength:l,isCaseSensitive:a,ignoreLocation:c})}static get type(){return"fuzzy"}static get multiRegex(){return/^"(.*)"$/}static get singleRegex(){return/^(.*)$/}search(e){return this._bitapSearch.searchIn(e)}}class Pa extends en{constructor(e){super(e)}static get type(){return"include"}static get multiRegex(){return/^'"(.*)"$/}static get singleRegex(){return/^'(.*)$/}search(e){let n=0,i;const r=[],s=this.pattern.length;for(;(i=e.indexOf(this.pattern,n))>-1;)n=i+s,r.push([i,n-1]);const o=!!r.length;return{isMatch:o,score:o?0:1,indices:r}}}const Zr=[B0,Pa,K0,W0,Y0,G0,q0,Oa],La=Zr.length,X0=/ +(?=(?:[^\"]*\"[^\"]*\")*[^\"]*$)/,J0="|";function Q0(t,e={}){return t.split(J0).map(n=>{let i=n.trim().split(X0).filter(s=>s&&!!s.trim()),r=[];for(let s=0,o=i.length;s<o;s+=1){const l=i[s];let a=!1,c=-1;for(;!a&&++c<La;){const u=Zr[c];let d=u.isMultiMatch(l);d&&(r.push(new u(d,e)),a=!0)}if(!a)for(c=-1;++c<La;){const u=Zr[c];let d=u.isSingleMatch(l);if(d){r.push(new u(d,e));break}}}return r})}const Z0=new Set([Oa.type,Pa.type]);class e1{constructor(e,{isCaseSensitive:n=he.isCaseSensitive,includeMatches:i=he.includeMatches,minMatchCharLength:r=he.minMatchCharLength,ignoreLocation:s=he.ignoreLocation,findAllMatches:o=he.findAllMatches,location:l=he.location,threshold:a=he.threshold,distance:c=he.distance}={}){this.query=null,this.options={isCaseSensitive:n,includeMatches:i,minMatchCharLength:r,findAllMatches:o,ignoreLocation:s,location:l,threshold:a,distance:c},this.pattern=n?e:e.toLowerCase(),this.query=Q0(this.pattern,this.options)}static condition(e,n){return n.useExtendedSearch}searchIn(e){const n=this.query;if(!n)return{isMatch:!1,score:1};const{includeMatches:i,isCaseSensitive:r}=this.options;e=r?e:e.toLowerCase();let s=0,o=[],l=0;for(let a=0,c=n.length;a<c;a+=1){const u=n[a];o.length=0,s=0;for(let d=0,f=u.length;d<f;d+=1){const h=u[d],{isMatch:m,indices:g,score:p}=h.search(e);if(m){if(s+=1,l+=p,i){const _=h.constructor.type;Z0.has(_)?o=[...o,...g]:o.push(g)}}else{l=0,s=0,o.length=0;break}}if(s){let d={isMatch:!0,score:l/s};return i&&(d.indices=o),d}}return{isMatch:!1,score:1}}}const es=[];function t1(...t){es.push(...t)}function ts(t,e){for(let n=0,i=es.length;n<i;n+=1){let r=es[n];if(r.condition(t,e))return new r(t,e)}return new Na(t,e)}const Ki={AND:"$and",OR:"$or"},ns={PATH:"$path",PATTERN:"$val"},is=t=>!!(t[Ki.AND]||t[Ki.OR]),n1=t=>!!t[ns.PATH],i1=t=>!Wt(t)&&Ea(t)&&!is(t),Da=t=>({[Ki.AND]:Object.keys(t).map(e=>({[e]:t[e]}))});function Ra(t,e,{auto:n=!0}={}){const i=r=>{let s=Object.keys(r);const o=n1(r);if(!o&&s.length>1&&!is(r))return i(Da(r));if(i1(r)){const a=o?r[ns.PATH]:s[0],c=o?r[ns.PATTERN]:r[a];if(!zt(c))throw new Error(x0(a));const u={keyId:Jr(a),pattern:c};return n&&(u.searcher=ts(c,e)),u}let l={children:[],operator:s[0]};return s.forEach(a=>{const c=r[a];Wt(c)&&c.forEach(u=>{l.children.push(i(u))})}),l};return is(t)||(t=Da(t)),i(t)}function r1(t,{ignoreFieldNorm:e=he.ignoreFieldNorm}){t.forEach(n=>{let i=1;n.matches.forEach(({key:r,norm:s,score:o})=>{const l=r?r.weight:null;i*=Math.pow(o===0&&l?Number.EPSILON:o,(l||1)*(e?1:s))}),n.score=i})}function s1(t,e){const n=t.matches;e.matches=[],vt(n)&&n.forEach(i=>{if(!vt(i.indices)||!i.indices.length)return;const{indices:r,value:s}=i;let o={indices:r,value:s};i.key&&(o.key=i.key.src),i.idx>-1&&(o.refIndex=i.idx),e.matches.push(o)})}function o1(t,e){e.score=t.score}function l1(t,e,{includeMatches:n=he.includeMatches,includeScore:i=he.includeScore}={}){const r=[];return n&&r.push(s1),i&&r.push(o1),t.map(s=>{const{idx:o}=s,l={item:e[o],refIndex:o};return r.length&&r.forEach(a=>{a(s,l)}),l})}class Nn{constructor(e,n={},i){this.options=An(An({},he),n),this.options.useExtendedSearch,this._keyStore=new O0(this.options.keys),this.setCollection(e,i)}setCollection(e,n){if(this._docs=e,n&&!(n instanceof Qr))throw new Error(M0);this._myIndex=n||Aa(this.options.keys,this._docs,{getFn:this.options.getFn,fieldNormWeight:this.options.fieldNormWeight})}add(e){vt(e)&&(this._docs.push(e),this._myIndex.add(e))}remove(e=()=>!1){const n=[];for(let i=0,r=this._docs.length;i<r;i+=1){const s=this._docs[i];e(s,i)&&(this.removeAt(i),i-=1,r-=1,n.push(s))}return n}removeAt(e){this._docs.splice(e,1),this._myIndex.removeAt(e)}getIndex(){return this._myIndex}search(e,{limit:n=-1}={}){const{includeMatches:i,includeScore:r,shouldSort:s,sortFn:o,ignoreFieldNorm:l}=this.options;let a=zt(e)?zt(this._docs[0])?this._searchStringList(e):this._searchObjectList(e):this._searchLogical(e);return r1(a,{ignoreFieldNorm:l}),s&&a.sort(o),ka(n)&&n>-1&&(a=a.slice(0,n)),l1(a,this._docs,{includeMatches:i,includeScore:r})}_searchStringList(e){const n=ts(e,this.options),{records:i}=this._myIndex,r=[];return i.forEach(({v:s,i:o,n:l})=>{if(!vt(s))return;const{isMatch:a,score:c,indices:u}=n.searchIn(s);a&&r.push({item:s,idx:o,matches:[{score:c,value:s,norm:l,indices:u}]})}),r}_searchLogical(e){const n=Ra(e,this.options),i=(l,a,c)=>{if(!l.children){const{keyId:d,searcher:f}=l,h=this._findMatches({key:this._keyStore.get(d),value:this._myIndex.getValueForItemAtKeyId(a,d),searcher:f});return h&&h.length?[{idx:c,item:a,matches:h}]:[]}const u=[];for(let d=0,f=l.children.length;d<f;d+=1){const h=l.children[d],m=i(h,a,c);if(m.length)u.push(...m);else if(l.operator===Ki.AND)return[]}return u},r=this._myIndex.records,s={},o=[];return r.forEach(({$:l,i:a})=>{if(vt(l)){let c=i(n,l,a);c.length&&(s[a]||(s[a]={idx:a,item:l,matches:[]},o.push(s[a])),c.forEach(({matches:u})=>{s[a].matches.push(...u)}))}}),o}_searchObjectList(e){const n=ts(e,this.options),{keys:i,records:r}=this._myIndex,s=[];return r.forEach(({$:o,i:l})=>{if(!vt(o))return;let a=[];i.forEach((c,u)=>{a.push(...this._findMatches({key:c,value:o[u],searcher:n}))}),a.length&&s.push({idx:l,item:o,matches:a})}),s}_findMatches({key:e,value:n,searcher:i}){if(!vt(n))return[];let r=[];if(Wt(n))n.forEach(({v:s,i:o,n:l})=>{if(!vt(s))return;const{isMatch:a,score:c,indices:u}=i.searchIn(s);a&&r.push({score:c,key:e,value:s,idx:o,norm:l,indices:u})});else{const{v:s,n:o}=n,{isMatch:l,score:a,indices:c}=i.searchIn(s);l&&r.push({score:a,key:e,value:s,norm:o,indices:c})}return r}}Nn.version="7.0.0",Nn.createIndex=Aa,Nn.parseIndex=F0,Nn.config=he,Nn.parseQuery=Ra,t1(e1);var a1=function(){function t(e){this._haystack=[],this._fuseOptions=ft(ft({},e.fuseOptions),{keys:U_([],e.searchFields,!0),includeMatches:!0})}return t.prototype.index=function(e){this._haystack=e,this._fuse&&this._fuse.setCollection(e)},t.prototype.reset=function(){this._haystack=[],this._fuse=void 0},t.prototype.isEmptyIndex=function(){return!this._haystack.length},t.prototype.search=function(e){this._fuse||(this._fuse=new Nn(this._haystack,this._fuseOptions));var n=this._fuse.search(e);return n.map(function(i,r){return{item:i.item,score:i.score||0,rank:r+1}})},t}();function c1(t){return new a1(t)}var u1=function(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0},rs=function(t,e,n){var i=t.dataset,r=e.customProperties,s=e.labelClass,o=e.labelDescription;s&&(i.labelClass=Bi(s).join(" ")),o&&(i.labelDescription=o),n&&r&&(typeof r=="string"?i.customProperties=r:typeof r=="object"&&!u1(r)&&(i.customProperties=JSON.stringify(r)))},$a=function(t,e,n){var i=e&&t.querySelector("label[for='".concat(e,"']")),r=i&&i.innerText;r&&n.setAttribute("aria-label",r)},f1={containerOuter:function(t,e,n,i,r,s,o){var l=t.classNames.containerOuter,a=document.createElement("div");return de(a,l),a.dataset.type=s,e&&(a.dir=e),i&&(a.tabIndex=0),n&&(a.setAttribute("role",r?"combobox":"listbox"),r?a.setAttribute("aria-autocomplete","list"):o||$a(this._docRoot,this.passedElement.element.id,a),a.setAttribute("aria-haspopup","true"),a.setAttribute("aria-expanded","false")),o&&a.setAttribute("aria-labelledby",o),a},containerInner:function(t){var e=t.classNames.containerInner,n=document.createElement("div");return de(n,e),n},itemList:function(t,e){var n=t.searchEnabled,i=t.classNames,r=i.list,s=i.listSingle,o=i.listItems,l=document.createElement("div");return de(l,r),de(l,e?s:o),this._isSelectElement&&n&&l.setAttribute("role","listbox"),l},placeholder:function(t,e){var n=t.allowHTML,i=t.classNames.placeholder,r=document.createElement("div");return de(r,i),Kt(r,n,e),r},item:function(t,e,n){var i=t.allowHTML,r=t.removeItemButtonAlignLeft,s=t.removeItemIconText,o=t.removeItemLabelText,l=t.classNames,a=l.item,c=l.button,u=l.highlightedState,d=l.itemSelectable,f=l.placeholder,h=an(e.value),m=document.createElement("div");if(de(m,a),e.labelClass){var g=document.createElement("span");Kt(g,i,e.label),de(g,e.labelClass),m.appendChild(g)}else Kt(m,i,e.label);if(m.dataset.item="",m.dataset.id=e.id,m.dataset.value=h,rs(m,e,!0),(e.disabled||this.containerOuter.isDisabled)&&m.setAttribute("aria-disabled","true"),this._isSelectElement&&(m.setAttribute("aria-selected","true"),m.setAttribute("role","option")),e.placeholder&&(de(m,f),m.dataset.placeholder=""),de(m,e.highlighted?u:d),n){e.disabled&&Rt(m,d),m.dataset.deletable="";var p=document.createElement("button");p.type="button",de(p,c),Kt(p,!0,Xn(s,e.value));var _=Xn(o,e.value);_&&p.setAttribute("aria-label",_),p.dataset.button="",r?m.insertAdjacentElement("afterbegin",p):m.appendChild(p)}return m},choiceList:function(t,e){var n=t.classNames.list,i=document.createElement("div");return de(i,n),e||i.setAttribute("aria-multiselectable","true"),i.setAttribute("role","listbox"),i},choiceGroup:function(t,e){var n=t.allowHTML,i=t.classNames,r=i.group,s=i.groupHeading,o=i.itemDisabled,l=e.id,a=e.label,c=e.disabled,u=an(a),d=document.createElement("div");de(d,r),c&&de(d,o),d.setAttribute("role","group"),d.dataset.group="",d.dataset.id=l,d.dataset.value=u,c&&d.setAttribute("aria-disabled","true");var f=document.createElement("div");return de(f,s),Kt(f,n,a||""),d.appendChild(f),d},choice:function(t,e,n,i){var r=t.allowHTML,s=t.classNames,o=s.item,l=s.itemChoice,a=s.itemSelectable,c=s.selectedState,u=s.itemDisabled,d=s.description,f=s.placeholder,h=e.label,m=an(e.value),g=document.createElement("div");g.id=e.elementId,de(g,o),de(g,l),i&&typeof h=="string"&&(h=Yr(r,h),h+=" (".concat(i,")"),h={trusted:h});var p=g;if(e.labelClass){var _=document.createElement("span");Kt(_,r,h),de(_,e.labelClass),p=_,g.appendChild(_)}else Kt(g,r,h);if(e.labelDescription){var w="".concat(e.elementId,"-description");p.setAttribute("aria-describedby",w);var I=document.createElement("span");Kt(I,r,e.labelDescription),I.id=w,de(I,d),g.appendChild(I)}return e.selected&&de(g,c),e.placeholder&&de(g,f),g.setAttribute("role",e.group?"treeitem":"option"),g.dataset.choice="",g.dataset.id=e.id,g.dataset.value=m,n&&(g.dataset.selectText=n),e.group&&(g.dataset.groupId="".concat(e.group.id)),rs(g,e,!1),e.disabled?(de(g,u),g.dataset.choiceDisabled="",g.setAttribute("aria-disabled","true")):(de(g,a),g.dataset.choiceSelectable=""),g},input:function(t,e){var n=t.classNames,i=n.input,r=n.inputCloned,s=t.labelId,o=document.createElement("input");return o.type="search",de(o,i),de(o,r),o.autocomplete="off",o.autocapitalize="off",o.spellcheck=!1,o.setAttribute("aria-autocomplete","list"),e?o.setAttribute("aria-label",e):s||$a(this._docRoot,this.passedElement.element.id,o),o},dropdown:function(t){var e=t.classNames,n=e.list,i=e.listDropdown,r=document.createElement("div");return de(r,n),de(r,i),r.setAttribute("aria-expanded","false"),r},notice:function(t,e,n){var i=t.classNames,r=i.item,s=i.itemChoice,o=i.addChoice,l=i.noResults,a=i.noChoices,c=i.notice;n===void 0&&(n=We.generic);var u=document.createElement("div");switch(Kt(u,!0,e),de(u,r),de(u,s),de(u,c),n){case We.addChoice:de(u,o);break;case We.noResults:de(u,l);break;case We.noChoices:de(u,a);break}return n===We.addChoice&&(u.dataset.choiceSelectable="",u.dataset.choice=""),u},option:function(t){var e=an(t.label),n=new Option(e,t.value,!1,t.selected);return rs(n,t,!0),n.disabled=t.disabled,t.selected&&n.setAttribute("selected",""),n}},h1="-ms-scroll-limit"in document.documentElement.style&&"-ms-ime-align"in document.documentElement.style,d1={},ss=function(t){if(t)return t.dataset.id?parseInt(t.dataset.id,10):void 0},Zn="[data-choice-selectable]",m1=function(){function t(e,n){e===void 0&&(e="[data-choice]"),n===void 0&&(n={});var i=this;this.initialisedOK=void 0,this._hasNonChoicePlaceholder=!1,this._lastAddedChoiceId=0,this._lastAddedGroupId=0;var r=t.defaults;this.config=ft(ft(ft({},r.allOptions),r.options),n),B_.forEach(function(_){i.config[_]=ft(ft(ft({},r.allOptions[_]),r.options[_]),n[_])});var s=this.config;s.silent||this._validateConfig();var o=s.shadowRoot||document.documentElement;this._docRoot=o;var l=typeof e=="string"?o.querySelector(e):e;if(!l||typeof l!="object"||!(u0(l)||va(l)))throw TypeError(!l&&typeof e=="string"?"Selector ".concat(e," failed to find an element"):"Expected one of the following types text|select-one|select-multiple");var a=l.type,c=a===Zt.Text;(c||s.maxItemCount!==1)&&(s.singleModeForMultiSelect=!1),s.singleModeForMultiSelect&&(a=Zt.SelectMultiple);var u=a===Zt.SelectOne,d=a===Zt.SelectMultiple,f=u||d;if(this._elementType=a,this._isTextElement=c,this._isSelectOneElement=u,this._isSelectMultipleElement=d,this._isSelectElement=u||d,this._canAddUserChoices=c&&s.addItems||f&&s.addChoices,typeof s.renderSelectedChoices!="boolean"&&(s.renderSelectedChoices=s.renderSelectedChoices==="always"||u),s.closeDropdownOnSelect==="auto"?s.closeDropdownOnSelect=c||u||s.singleModeForMultiSelect:s.closeDropdownOnSelect=Qn(s.closeDropdownOnSelect),s.placeholder&&(s.placeholderValue?this._hasNonChoicePlaceholder=!0:l.dataset.placeholder&&(this._hasNonChoicePlaceholder=!0,s.placeholderValue=l.dataset.placeholder)),n.addItemFilter&&typeof n.addItemFilter!="function"){var h=n.addItemFilter instanceof RegExp?n.addItemFilter:new RegExp(n.addItemFilter);s.addItemFilter=h.test.bind(h)}if(this._isTextElement)this.passedElement=new c0({element:l,classNames:s.classNames});else{var m=l;this.passedElement=new d0({element:m,classNames:s.classNames,template:function(_){return i._templates.option(_)},extractPlaceholder:s.placeholder&&!this._hasNonChoicePlaceholder})}if(this.initialised=!1,this._store=new v0(s),this._currentValue="",s.searchEnabled=!c&&s.searchEnabled||d,this._canSearch=s.searchEnabled,this._isScrollingOnIe=!1,this._highlightPosition=0,this._wasTap=!0,this._placeholderValue=this._generatePlaceholderValue(),this._baseId=X_(l,"choices-"),this._direction=l.dir,!this._direction){var g=window.getComputedStyle(l).direction,p=window.getComputedStyle(document.documentElement).direction;g!==p&&(this._direction=g)}if(this._idNames={itemChoice:"item-choice"},this._templates=r.templates,this._render=this._render.bind(this),this._onFocus=this._onFocus.bind(this),this._onBlur=this._onBlur.bind(this),this._onKeyUp=this._onKeyUp.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onInput=this._onInput.bind(this),this._onClick=this._onClick.bind(this),this._onTouchMove=this._onTouchMove.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._onMouseDown=this._onMouseDown.bind(this),this._onMouseOver=this._onMouseOver.bind(this),this._onFormReset=this._onFormReset.bind(this),this._onSelectKey=this._onSelectKey.bind(this),this._onEnterKey=this._onEnterKey.bind(this),this._onEscapeKey=this._onEscapeKey.bind(this),this._onDirectionKey=this._onDirectionKey.bind(this),this._onDeleteKey=this._onDeleteKey.bind(this),this.passedElement.isActive){s.silent||console.warn("Trying to initialise Choices on element already initialised",{element:e}),this.initialised=!0,this.initialisedOK=!1;return}this.init(),this._initialItems=this._store.items.map(function(_){return _.value})}return Object.defineProperty(t,"defaults",{get:function(){return Object.preventExtensions({get options(){return d1},get allOptions(){return ya},get templates(){return f1}})},enumerable:!1,configurable:!0}),t.prototype.init=function(){if(!(this.initialised||this.initialisedOK!==void 0)){this._searcher=c1(this.config),this._loadChoices(),this._createTemplates(),this._createElements(),this._createStructure(),this._isTextElement&&!this.config.addItems||this.passedElement.element.hasAttribute("disabled")||this.passedElement.element.closest("fieldset:disabled")?this.disable():(this.enable(),this._addEventListeners()),this._initStore(),this.initialised=!0,this.initialisedOK=!0;var e=this.config.callbackOnInit;typeof e=="function"&&e.call(this)}},t.prototype.destroy=function(){this.initialised&&(this._removeEventListeners(),this.passedElement.reveal(),this.containerOuter.unwrap(this.passedElement.element),this._store._listeners=[],this.clearStore(!1),this._stopSearch(),this._templates=t.defaults.templates,this.initialised=!1,this.initialisedOK=void 0)},t.prototype.enable=function(){return this.passedElement.isDisabled&&this.passedElement.enable(),this.containerOuter.isDisabled&&(this._addEventListeners(),this.input.enable(),this.containerOuter.enable()),this},t.prototype.disable=function(){return this.passedElement.isDisabled||this.passedElement.disable(),this.containerOuter.isDisabled||(this._removeEventListeners(),this.input.disable(),this.containerOuter.disable()),this},t.prototype.highlightItem=function(e,n){if(n===void 0&&(n=!0),!e||!e.id)return this;var i=this._store.items.find(function(r){return r.id===e.id});return!i||i.highlighted?this:(this._store.dispatch(Hi(i,!0)),n&&this.passedElement.triggerEvent(ht.highlightItem,this._getChoiceForOutput(i)),this)},t.prototype.unhighlightItem=function(e,n){if(n===void 0&&(n=!0),!e||!e.id)return this;var i=this._store.items.find(function(r){return r.id===e.id});return!i||!i.highlighted?this:(this._store.dispatch(Hi(i,!1)),n&&this.passedElement.triggerEvent(ht.unhighlightItem,this._getChoiceForOutput(i)),this)},t.prototype.highlightAll=function(){var e=this;return this._store.withTxn(function(){e._store.items.forEach(function(n){n.highlighted||(e._store.dispatch(Hi(n,!0)),e.passedElement.triggerEvent(ht.highlightItem,e._getChoiceForOutput(n)))})}),this},t.prototype.unhighlightAll=function(){var e=this;return this._store.withTxn(function(){e._store.items.forEach(function(n){n.highlighted&&(e._store.dispatch(Hi(n,!1)),e.passedElement.triggerEvent(ht.highlightItem,e._getChoiceForOutput(n)))})}),this},t.prototype.removeActiveItemsByValue=function(e){var n=this;return this._store.withTxn(function(){n._store.items.filter(function(i){return i.value===e}).forEach(function(i){return n._removeItem(i)})}),this},t.prototype.removeActiveItems=function(e){var n=this;return this._store.withTxn(function(){n._store.items.filter(function(i){var r=i.id;return r!==e}).forEach(function(i){return n._removeItem(i)})}),this},t.prototype.removeHighlightedItems=function(e){var n=this;return e===void 0&&(e=!1),this._store.withTxn(function(){n._store.highlightedActiveItems.forEach(function(i){n._removeItem(i),e&&n._triggerChange(i.value)})}),this},t.prototype.showDropdown=function(e){var n=this;return this.dropdown.isActive?this:(e===void 0&&(e=!this._canSearch),requestAnimationFrame(function(){n.dropdown.show();var i=n.dropdown.element.getBoundingClientRect();n.containerOuter.open(i.bottom,i.height),e||n.input.focus(),n.passedElement.triggerEvent(ht.showDropdown)}),this)},t.prototype.hideDropdown=function(e){var n=this;return this.dropdown.isActive?(requestAnimationFrame(function(){n.dropdown.hide(),n.containerOuter.close(),!e&&n._canSearch&&(n.input.removeActiveDescendant(),n.input.blur()),n.passedElement.triggerEvent(ht.hideDropdown)}),this):this},t.prototype.getValue=function(e){var n=this,i=this._store.items.map(function(r){return e?r.value:n._getChoiceForOutput(r)});return this._isSelectOneElement||this.config.singleModeForMultiSelect?i[0]:i},t.prototype.setValue=function(e){var n=this;return this.initialisedOK?(this._store.withTxn(function(){e.forEach(function(i){i&&n._addChoice($t(i,!1))})}),this._searcher.reset(),this):(this._warnChoicesInitFailed("setValue"),this)},t.prototype.setChoiceByValue=function(e){var n=this;return this.initialisedOK?this._isTextElement?this:(this._store.withTxn(function(){var i=Array.isArray(e)?e:[e];i.forEach(function(r){return n._findAndSelectChoiceByValue(r)}),n.unhighlightAll()}),this._searcher.reset(),this):(this._warnChoicesInitFailed("setChoiceByValue"),this)},t.prototype.setChoices=function(e,n,i,r,s,o){var l=this;if(e===void 0&&(e=[]),n===void 0&&(n="value"),i===void 0&&(i="label"),r===void 0&&(r=!1),s===void 0&&(s=!0),o===void 0&&(o=!1),!this.initialisedOK)return this._warnChoicesInitFailed("setChoices"),this;if(!this._isSelectElement)throw new TypeError("setChoices can't be used with INPUT based Choices");if(typeof n!="string"||!n)throw new TypeError("value parameter must be a name of 'value' field in passed objects");if(typeof e=="function"){var a=e(this);if(typeof Promise=="function"&&a instanceof Promise)return new Promise(function(c){return requestAnimationFrame(c)}).then(function(){return l._handleLoadingState(!0)}).then(function(){return a}).then(function(c){return l.setChoices(c,n,i,r,s,o)}).catch(function(c){l.config.silent||console.error(c)}).then(function(){return l._handleLoadingState(!1)}).then(function(){return l});if(!Array.isArray(a))throw new TypeError(".setChoices first argument function must return either array of choices or Promise, got: ".concat(typeof a));return this.setChoices(a,n,i,!1)}if(!Array.isArray(e))throw new TypeError(".setChoices must be called either with array of choices with a function resulting into Promise of array of choices");return this.containerOuter.removeLoadingState(),this._store.withTxn(function(){s&&(l._isSearching=!1),r&&l.clearChoices(!0,o);var c=n==="value",u=i==="label";e.forEach(function(d){if("choices"in d){var f=d;u||(f=ft(ft({},f),{label:f[i]})),l._addGroup($t(f,!0))}else{var h=d;(!u||!c)&&(h=ft(ft({},h),{value:h[n],label:h[i]}));var m=$t(h,!1);l._addChoice(m),m.placeholder&&!l._hasNonChoicePlaceholder&&(l._placeholderValue=da(m.label))}}),l.unhighlightAll()}),this._searcher.reset(),this},t.prototype.refresh=function(e,n,i){var r=this;return e===void 0&&(e=!1),n===void 0&&(n=!1),i===void 0&&(i=!1),this._isSelectElement?(this._store.withTxn(function(){var s=r.passedElement.optionsAsChoices(),o={};i||r._store.items.forEach(function(a){a.id&&a.active&&a.selected&&(o[a.value]=!0)}),r.clearStore(!1);var l=function(a){i?r._store.dispatch(ua(a)):o[a.value]&&(a.selected=!0)};s.forEach(function(a){if("choices"in a){a.choices.forEach(l);return}l(a)}),r._addPredefinedChoices(s,n,e),r._isSearching&&r._searchChoices(r.input.value)}),this):(this.config.silent||console.warn("refresh method can only be used on choices backed by a <select> element"),this)},t.prototype.removeChoice=function(e){var n=this._store.choices.find(function(i){return i.value===e});return n?(this._clearNotice(),this._store.dispatch(q_(n)),this._searcher.reset(),n.selected&&this.passedElement.triggerEvent(ht.removeItem,this._getChoiceForOutput(n)),this):this},t.prototype.clearChoices=function(e,n){var i=this;return e===void 0&&(e=!0),n===void 0&&(n=!1),e&&(n?this.passedElement.element.replaceChildren(""):this.passedElement.element.querySelectorAll(":not([selected])").forEach(function(r){r.remove()})),this.itemList.element.replaceChildren(""),this.choiceList.element.replaceChildren(""),this._clearNotice(),this._store.withTxn(function(){var r=n?[]:i._store.items;i._store.reset(),r.forEach(function(s){i._store.dispatch(aa(s)),i._store.dispatch(ca(s))})}),this._searcher.reset(),this},t.prototype.clearStore=function(e){return e===void 0&&(e=!0),this.clearChoices(e,!0),this._stopSearch(),this._lastAddedChoiceId=0,this._lastAddedGroupId=0,this},t.prototype.clearInput=function(){var e=!this._isSelectOneElement;return this.input.clear(e),this._stopSearch(),this},t.prototype._validateConfig=function(){var e=this.config,n=i0(e,ya);n.length&&console.warn("Unknown config option(s) passed",n.join(", ")),e.allowHTML&&e.allowHtmlUserInput&&(e.addItems&&console.warn("Warning: allowHTML/allowHtmlUserInput/addItems all being true is strongly not recommended and may lead to XSS attacks"),e.addChoices&&console.warn("Warning: allowHTML/allowHtmlUserInput/addChoices all being true is strongly not recommended and may lead to XSS attacks"))},t.prototype._render=function(e){e===void 0&&(e={choices:!0,groups:!0,items:!0}),!this._store.inTxn()&&(this._isSelectElement&&(e.choices||e.groups)&&this._renderChoices(),e.items&&this._renderItems())},t.prototype._renderChoices=function(){var e=this;if(this._canAddItems()){var n=this,i=n.config,r=n._isSearching,s=this._store,o=s.activeGroups,l=s.activeChoices,a=0;if(r&&i.searchResultLimit>0?a=i.searchResultLimit:i.renderChoiceLimit>0&&(a=i.renderChoiceLimit),this._isSelectElement){var c=l.filter(function(m){return!m.element});c.length&&this.passedElement.addOptions(c)}var u=document.createDocumentFragment(),d=function(m){return m.filter(function(g){return!g.placeholder&&(r?!!g.rank:i.renderSelectedChoices||!g.selected)})},f=!1,h=function(m,g,p){r?m.sort(t0):i.shouldSort&&m.sort(i.sorter);var _=m.length;_=!g&&a&&_>a?a:_,_--,m.every(function(w,I){var b=w.choiceEl||e._templates.choice(i,w,i.itemSelectText,p);return w.choiceEl=b,u.appendChild(b),(r||!w.selected)&&(f=!0),I<_})};l.length&&(i.resetScrollPosition&&requestAnimationFrame(function(){return e.choiceList.scrollToTop()}),!this._hasNonChoicePlaceholder&&!r&&this._isSelectOneElement&&h(l.filter(function(m){return m.placeholder&&!m.group}),!1,void 0),o.length&&!r?(i.shouldSort&&o.sort(i.sorter),h(l.filter(function(m){return!m.placeholder&&!m.group}),!1,void 0),o.forEach(function(m){var g=d(m.choices);if(g.length){if(m.label){var p=m.groupEl||e._templates.choiceGroup(e.config,m);m.groupEl=p,p.remove(),u.appendChild(p)}h(g,!0,i.appendGroupInSearch&&r?m.label:void 0)}})):h(d(l),!1,void 0)),!f&&(r||!u.children.length||!i.renderSelectedChoices)&&(this._notice||(this._notice={text:ha(r?i.noResultsText:i.noChoicesText),type:r?We.noResults:We.noChoices}),u.replaceChildren("")),this._renderNotice(u),this.choiceList.element.replaceChildren(u),f&&this._highlightChoice()}},t.prototype._renderItems=function(){var e=this,n=this._store.items||[],i=this.itemList.element,r=this.config,s=document.createDocumentFragment(),o=function(d){return i.querySelector('[data-item][data-id="'.concat(d.id,'"]'))},l=function(d){var f=d.itemEl;f&&f.parentElement||(f=o(d)||e._templates.item(r,d,r.removeItemButton),d.itemEl=f,s.appendChild(f))};n.forEach(l);var a=!!s.childNodes.length;if(this._isSelectOneElement){var c=i.children.length;if(a||c>1){var u=i.querySelector(Jn(r.classNames.placeholder));u&&u.remove()}else!a&&!c&&this._placeholderValue&&(a=!0,l($t({selected:!0,value:"",label:this._placeholderValue,placeholder:!0},!1)))}a&&(i.append(s),r.shouldSortItems&&!this._isSelectOneElement&&(n.sort(r.sorter),n.forEach(function(d){var f=o(d);f&&(f.remove(),s.append(f))}),i.append(s))),this._isTextElement&&(this.passedElement.value=n.map(function(d){var f=d.value;return f}).join(r.delimiter))},t.prototype._displayNotice=function(e,n,i){i===void 0&&(i=!0);var r=this._notice;if(r&&(r.type===n&&r.text===e||r.type===We.addChoice&&(n===We.noResults||n===We.noChoices))){i&&this.showDropdown(!0);return}this._clearNotice(),this._notice=e?{text:e,type:n}:void 0,this._renderNotice(),i&&e&&this.showDropdown(!0)},t.prototype._clearNotice=function(){if(this._notice){var e=this.choiceList.element.querySelector(Jn(this.config.classNames.notice));e&&e.remove(),this._notice=void 0}},t.prototype._renderNotice=function(e){var n=this._notice;if(n){var i=this._templates.notice(this.config,n.text,n.type);e?e.append(i):this.choiceList.prepend(i)}},t.prototype._getChoiceForOutput=function(e,n){return{id:e.id,highlighted:e.highlighted,labelClass:e.labelClass,labelDescription:e.labelDescription,customProperties:e.customProperties,disabled:e.disabled,active:e.active,label:e.label,placeholder:e.placeholder,value:e.value,groupValue:e.group?e.group.label:void 0,element:e.element,keyCode:n}},t.prototype._triggerChange=function(e){e!=null&&this.passedElement.triggerEvent(ht.change,{value:e})},t.prototype._handleButtonAction=function(e){var n=this,i=this._store.items;if(!(!i.length||!this.config.removeItems||!this.config.removeItemButton)){var r=e&&ss(e.parentElement),s=r&&i.find(function(o){return o.id===r});s&&this._store.withTxn(function(){if(n._removeItem(s),n._triggerChange(s.value),n._isSelectOneElement&&!n._hasNonChoicePlaceholder){var o=(n.config.shouldSort?n._store.choices.reverse():n._store.choices).find(function(l){return l.placeholder});o&&(n._addItem(o),n.unhighlightAll(),o.value&&n._triggerChange(o.value))}})}},t.prototype._handleItemAction=function(e,n){var i=this;n===void 0&&(n=!1);var r=this._store.items;if(!(!r.length||!this.config.removeItems||this._isSelectOneElement)){var s=ss(e);s&&(r.forEach(function(o){o.id===s&&!o.highlighted?i.highlightItem(o):!n&&o.highlighted&&i.unhighlightItem(o)}),this.input.focus())}},t.prototype._handleChoiceAction=function(e){var n=this,i=ss(e),r=i&&this._store.getChoiceById(i);if(!r||r.disabled)return!1;var s=this.dropdown.isActive;if(!r.selected){if(!this._canAddItems())return!0;this._store.withTxn(function(){n._addItem(r,!0,!0),n.clearInput(),n.unhighlightAll()}),this._triggerChange(r.value)}return s&&this.config.closeDropdownOnSelect&&(this.hideDropdown(!0),this.containerOuter.element.focus()),!0},t.prototype._handleBackspace=function(e){var n=this.config;if(!(!n.removeItems||!e.length)){var i=e[e.length-1],r=e.some(function(s){return s.highlighted});n.editItems&&!r&&i?(this.input.value=i.value,this.input.setWidth(),this._removeItem(i),this._triggerChange(i.value)):(r||this.highlightItem(i,!1),this.removeHighlightedItems(!0))}},t.prototype._loadChoices=function(){var e,n=this,i=this.config;if(this._isTextElement){if(this._presetChoices=i.items.map(function(o){return $t(o,!1)}),this.passedElement.value){var r=this.passedElement.value.split(i.delimiter).map(function(o){return $t(o,!1,n.config.allowHtmlUserInput)});this._presetChoices=this._presetChoices.concat(r)}this._presetChoices.forEach(function(o){o.selected=!0})}else if(this._isSelectElement){this._presetChoices=i.choices.map(function(o){return $t(o,!0)});var s=this.passedElement.optionsAsChoices();s&&(e=this._presetChoices).push.apply(e,s)}},t.prototype._handleLoadingState=function(e){e===void 0&&(e=!0);var n=this.itemList.element;e?(this.disable(),this.containerOuter.addLoadingState(),this._isSelectOneElement?n.replaceChildren(this._templates.placeholder(this.config,this.config.loadingText)):this.input.placeholder=this.config.loadingText):(this.enable(),this.containerOuter.removeLoadingState(),this._isSelectOneElement?(n.replaceChildren(""),this._render()):this.input.placeholder=this._placeholderValue||"")},t.prototype._handleSearch=function(e){if(this.input.isFocussed)if(e!==null&&typeof e<"u"&&e.length>=this.config.searchFloor){var n=this.config.searchChoices?this._searchChoices(e):0;n!==null&&this.passedElement.triggerEvent(ht.search,{value:e,resultCount:n})}else this._store.choices.some(function(i){return!i.active})&&this._stopSearch()},t.prototype._canAddItems=function(){var e=this.config,n=e.maxItemCount,i=e.maxItemText;return!e.singleModeForMultiSelect&&n>0&&n<=this._store.items.length?(this.choiceList.element.replaceChildren(""),this._notice=void 0,this._displayNotice(typeof i=="function"?i(n):i,We.addChoice),!1):(this._notice&&this._notice.type===We.addChoice&&this._clearNotice(),!0)},t.prototype._canCreateItem=function(e){var n=this.config,i=!0,r="";if(i&&typeof n.addItemFilter=="function"&&!n.addItemFilter(e)&&(i=!1,r=Xn(n.customAddItemText,e)),i){var s=this._store.choices.find(function(o){return n.valueComparer(o.value,e)});if(s){if(this._isSelectElement)return this._displayNotice("",We.addChoice),!1;n.duplicateItemsAllowed||(i=!1,r=Xn(n.uniqueItemText,e))}}return i&&(r=Xn(n.addItemText,e)),r&&this._displayNotice(r,We.addChoice),i},t.prototype._searchChoices=function(e){var n=e.trim().replace(/\s{2,}/," ");if(!n.length||n===this._currentValue)return null;var i=this._searcher;i.isEmptyIndex()&&i.index(this._store.searchableChoices);var r=i.search(n);this._currentValue=n,this._highlightPosition=0,this._isSearching=!0;var s=this._notice,o=s&&s.type;return o!==We.addChoice&&(r.length?this._clearNotice():this._displayNotice(ha(this.config.noResultsText),We.noResults)),this._store.dispatch(K_(r)),r.length},t.prototype._stopSearch=function(){this._isSearching&&(this._currentValue="",this._isSearching=!1,this._clearNotice(),this._store.dispatch(W_(!0)),this.passedElement.triggerEvent(ht.search,{value:"",resultCount:0}))},t.prototype._addEventListeners=function(){var e=this._docRoot,n=this.containerOuter.element,i=this.input.element;e.addEventListener("touchend",this._onTouchEnd,!0),n.addEventListener("keydown",this._onKeyDown,!0),n.addEventListener("mousedown",this._onMouseDown,!0),e.addEventListener("click",this._onClick,{passive:!0}),e.addEventListener("touchmove",this._onTouchMove,{passive:!0}),this.dropdown.element.addEventListener("mouseover",this._onMouseOver,{passive:!0}),this._isSelectOneElement&&(n.addEventListener("focus",this._onFocus,{passive:!0}),n.addEventListener("blur",this._onBlur,{passive:!0})),i.addEventListener("keyup",this._onKeyUp,{passive:!0}),i.addEventListener("input",this._onInput,{passive:!0}),i.addEventListener("focus",this._onFocus,{passive:!0}),i.addEventListener("blur",this._onBlur,{passive:!0}),i.form&&i.form.addEventListener("reset",this._onFormReset,{passive:!0}),this.input.addEventListeners()},t.prototype._removeEventListeners=function(){var e=this._docRoot,n=this.containerOuter.element,i=this.input.element;e.removeEventListener("touchend",this._onTouchEnd,!0),n.removeEventListener("keydown",this._onKeyDown,!0),n.removeEventListener("mousedown",this._onMouseDown,!0),e.removeEventListener("click",this._onClick),e.removeEventListener("touchmove",this._onTouchMove),this.dropdown.element.removeEventListener("mouseover",this._onMouseOver),this._isSelectOneElement&&(n.removeEventListener("focus",this._onFocus),n.removeEventListener("blur",this._onBlur)),i.removeEventListener("keyup",this._onKeyUp),i.removeEventListener("input",this._onInput),i.removeEventListener("focus",this._onFocus),i.removeEventListener("blur",this._onBlur),i.form&&i.form.removeEventListener("reset",this._onFormReset),this.input.removeEventListeners()},t.prototype._onKeyDown=function(e){var n=e.keyCode,i=this.dropdown.isActive,r=e.key.length===1||e.key.length===2&&e.key.charCodeAt(0)>=55296||e.key==="Unidentified";switch(!this._isTextElement&&!i&&n!==Je.ESC_KEY&&n!==Je.TAB_KEY&&n!==Je.SHIFT_KEY&&(this.showDropdown(),!this.input.isFocussed&&r&&(this.input.value+=e.key,e.key===" "&&e.preventDefault())),n){case Je.A_KEY:return this._onSelectKey(e,this.itemList.element.hasChildNodes());case Je.ENTER_KEY:return this._onEnterKey(e,i);case Je.ESC_KEY:return this._onEscapeKey(e,i);case Je.UP_KEY:case Je.PAGE_UP_KEY:case Je.DOWN_KEY:case Je.PAGE_DOWN_KEY:return this._onDirectionKey(e,i);case Je.DELETE_KEY:case Je.BACK_KEY:return this._onDeleteKey(e,this._store.items,this.input.isFocussed)}},t.prototype._onKeyUp=function(){this._canSearch=this.config.searchEnabled},t.prototype._onInput=function(){var e=this.input.value;if(!e){this._isTextElement?this.hideDropdown(!0):this._stopSearch();return}this._canAddItems()&&(this._canSearch&&this._handleSearch(e),this._canAddUserChoices&&(this._canCreateItem(e),this._isSelectElement&&(this._highlightPosition=0,this._highlightChoice())))},t.prototype._onSelectKey=function(e,n){if((e.ctrlKey||e.metaKey)&&n){this._canSearch=!1;var i=this.config.removeItems&&!this.input.value&&this.input.element===document.activeElement;i&&this.highlightAll()}},t.prototype._onEnterKey=function(e,n){var i=this,r=this.input.value,s=e.target;if(e.preventDefault(),s&&s.hasAttribute("data-button")){this._handleButtonAction(s);return}if(!n){(this._isSelectElement||this._notice)&&this.showDropdown();return}var o=this.dropdown.element.querySelector(Jn(this.config.classNames.highlightedState));if(!(o&&this._handleChoiceAction(o))){if(!s||!r){this.hideDropdown(!0);return}if(this._canAddItems()){var l=!1;this._store.withTxn(function(){if(l=i._findAndSelectChoiceByValue(r,!0),!l){if(!i._canAddUserChoices||!i._canCreateItem(r))return;i._addChoice($t(r,!1,i.config.allowHtmlUserInput),!0,!0),l=!0}i.clearInput(),i.unhighlightAll()}),l&&(this._triggerChange(r),this.config.closeDropdownOnSelect&&this.hideDropdown(!0))}}},t.prototype._onEscapeKey=function(e,n){n&&(e.stopPropagation(),this.hideDropdown(!0),this._stopSearch(),this.containerOuter.element.focus())},t.prototype._onDirectionKey=function(e,n){var i=e.keyCode;if(n||this._isSelectOneElement){this.showDropdown(),this._canSearch=!1;var r=i===Je.DOWN_KEY||i===Je.PAGE_DOWN_KEY?1:-1,s=e.metaKey||i===Je.PAGE_DOWN_KEY||i===Je.PAGE_UP_KEY,o=void 0;if(s)r>0?o=this.dropdown.element.querySelector("".concat(Zn,":last-of-type")):o=this.dropdown.element.querySelector(Zn);else{var l=this.dropdown.element.querySelector(Jn(this.config.classNames.highlightedState));l?o=J_(l,Zn,r):o=this.dropdown.element.querySelector(Zn)}o&&(Q_(o,this.choiceList.element,r)||this.choiceList.scrollToChildElement(o,r),this._highlightChoice(o)),e.preventDefault()}},t.prototype._onDeleteKey=function(e,n,i){!this._isSelectOneElement&&!e.target.value&&i&&(this._handleBackspace(n),e.preventDefault())},t.prototype._onTouchMove=function(){this._wasTap&&(this._wasTap=!1)},t.prototype._onTouchEnd=function(e){var n=(e||e.touches[0]).target,i=this._wasTap&&this.containerOuter.element.contains(n);if(i){var r=n===this.containerOuter.element||n===this.containerInner.element;r&&(this._isTextElement?this.input.focus():this._isSelectMultipleElement&&this.showDropdown()),e.stopPropagation()}this._wasTap=!0},t.prototype._onMouseDown=function(e){var n=e.target;if(n instanceof HTMLElement){if(h1&&this.choiceList.element.contains(n)){var i=this.choiceList.element.firstElementChild;this._isScrollingOnIe=this._direction==="ltr"?e.offsetX>=i.offsetWidth:e.offsetX<i.offsetLeft}if(n!==this.input.element){var r=n.closest("[data-button],[data-item],[data-choice]");r instanceof HTMLElement&&("button"in r.dataset?this._handleButtonAction(r):"item"in r.dataset?this._handleItemAction(r,e.shiftKey):"choice"in r.dataset&&this._handleChoiceAction(r)),e.preventDefault()}}},t.prototype._onMouseOver=function(e){var n=e.target;n instanceof HTMLElement&&"choice"in n.dataset&&this._highlightChoice(n)},t.prototype._onClick=function(e){var n=e.target,i=this.containerOuter,r=i.element.contains(n);r?!this.dropdown.isActive&&!i.isDisabled?this._isTextElement?document.activeElement!==this.input.element&&this.input.focus():(this.showDropdown(),i.element.focus()):this._isSelectOneElement&&n!==this.input.element&&!this.dropdown.element.contains(n)&&this.hideDropdown():(i.removeFocusState(),this.hideDropdown(!0),this.unhighlightAll())},t.prototype._onFocus=function(e){var n=e.target,i=this.containerOuter,r=n&&i.element.contains(n);if(r){var s=n===this.input.element;this._isTextElement?s&&i.addFocusState():this._isSelectMultipleElement?s&&(this.showDropdown(!0),i.addFocusState()):(i.addFocusState(),s&&this.showDropdown(!0))}},t.prototype._onBlur=function(e){var n=e.target,i=this.containerOuter,r=n&&i.element.contains(n);r&&!this._isScrollingOnIe?n===this.input.element?(i.removeFocusState(),this.hideDropdown(!0),(this._isTextElement||this._isSelectMultipleElement)&&this.unhighlightAll()):n===this.containerOuter.element&&(i.removeFocusState(),this._canSearch||this.hideDropdown(!0)):(this._isScrollingOnIe=!1,this.input.element.focus())},t.prototype._onFormReset=function(){var e=this;this._store.withTxn(function(){e.clearInput(),e.hideDropdown(),e.refresh(!1,!1,!0),e._initialItems.length&&e.setChoiceByValue(e._initialItems)})},t.prototype._highlightChoice=function(e){e===void 0&&(e=null);var n=Array.from(this.dropdown.element.querySelectorAll(Zn));if(n.length){var i=e,r=this.config.classNames.highlightedState,s=Array.from(this.dropdown.element.querySelectorAll(Jn(r)));s.forEach(function(o){Rt(o,r),o.setAttribute("aria-selected","false")}),i?this._highlightPosition=n.indexOf(i):(n.length>this._highlightPosition?i=n[this._highlightPosition]:i=n[n.length-1],i||(i=n[0])),de(i,r),i.setAttribute("aria-selected","true"),this.passedElement.triggerEvent(ht.highlightChoice,{el:i}),this.dropdown.isActive&&(this.input.setActiveDescendant(i.id),this.containerOuter.setActiveDescendant(i.id))}},t.prototype._addItem=function(e,n,i){if(n===void 0&&(n=!0),i===void 0&&(i=!1),!e.id)throw new TypeError("item.id must be set before _addItem is called for a choice/item");(this.config.singleModeForMultiSelect||this._isSelectOneElement)&&this.removeActiveItems(e.id),this._store.dispatch(ca(e)),n&&(this.passedElement.triggerEvent(ht.addItem,this._getChoiceForOutput(e)),i&&this.passedElement.triggerEvent(ht.choice,this._getChoiceForOutput(e)))},t.prototype._removeItem=function(e){if(e.id){this._store.dispatch(ua(e));var n=this._notice;n&&n.type===We.noChoices&&this._clearNotice(),this.passedElement.triggerEvent(ht.removeItem,this._getChoiceForOutput(e))}},t.prototype._addChoice=function(e,n,i){if(n===void 0&&(n=!0),i===void 0&&(i=!1),e.id)throw new TypeError("Can not re-add a choice which has already been added");var r=this.config;if(!(!r.duplicateItemsAllowed&&this._store.choices.find(function(l){return r.valueComparer(l.value,e.value)}))){this._lastAddedChoiceId++,e.id=this._lastAddedChoiceId,e.elementId="".concat(this._baseId,"-").concat(this._idNames.itemChoice,"-").concat(e.id);var s=r.prependValue,o=r.appendValue;s&&(e.value=s+e.value),o&&(e.value+=o.toString()),(s||o)&&e.element&&(e.element.value=e.value),this._clearNotice(),this._store.dispatch(aa(e)),e.selected&&this._addItem(e,n,i)}},t.prototype._addGroup=function(e,n){var i=this;if(n===void 0&&(n=!0),e.id)throw new TypeError("Can not re-add a group which has already been added");this._store.dispatch(G_(e)),e.choices&&(this._lastAddedGroupId++,e.id=this._lastAddedGroupId,e.choices.forEach(function(r){r.group=e,e.disabled&&(r.disabled=!0),i._addChoice(r,n)}))},t.prototype._createTemplates=function(){var e=this,n=this.config.callbackOnCreateTemplates,i={};typeof n=="function"&&(i=n.call(this,Z_,Yr,Bi));var r={};Object.keys(this._templates).forEach(function(s){s in i?r[s]=i[s].bind(e):r[s]=e._templates[s].bind(e)}),this._templates=r},t.prototype._createElements=function(){var e=this._templates,n=this,i=n.config,r=n._isSelectOneElement,s=i.position,o=i.classNames,l=this._elementType;this.containerOuter=new ma({element:e.containerOuter(i,this._direction,this._isSelectElement,r,i.searchEnabled,l,i.labelId),classNames:o,type:l,position:s}),this.containerInner=new ma({element:e.containerInner(i),classNames:o,type:l,position:s}),this.input=new l0({element:e.input(i,this._placeholderValue),classNames:o,type:l,preventPaste:!i.paste}),this.choiceList=new pa({element:e.choiceList(i,r)}),this.itemList=new pa({element:e.itemList(i,r)}),this.dropdown=new o0({element:e.dropdown(i),classNames:o,type:l})},t.prototype._createStructure=function(){var e=this,n=e.containerInner,i=e.containerOuter,r=e.passedElement,s=this.dropdown.element;r.conceal(),n.wrap(r.element),i.wrap(n.element),this._isSelectOneElement?this.input.placeholder=this.config.searchPlaceholderValue||"":(this._placeholderValue&&(this.input.placeholder=this._placeholderValue),this.input.setWidth()),i.element.appendChild(n.element),i.element.appendChild(s),n.element.appendChild(this.itemList.element),s.appendChild(this.choiceList.element),this._isSelectOneElement?this.config.searchEnabled&&s.insertBefore(this.input.element,s.firstChild):n.element.appendChild(this.input.element),this._highlightPosition=0,this._isSearching=!1},t.prototype._initStore=function(){var e=this;this._store.subscribe(this._render).withTxn(function(){e._addPredefinedChoices(e._presetChoices,e._isSelectOneElement&&!e._hasNonChoicePlaceholder,!1)}),(!this._store.choices.length||this._isSelectOneElement&&this._hasNonChoicePlaceholder)&&this._render()},t.prototype._addPredefinedChoices=function(e,n,i){var r=this;if(n===void 0&&(n=!1),i===void 0&&(i=!0),n){var s=e.findIndex(function(o){return o.selected})===-1;s&&e.some(function(o){return o.disabled||"choices"in o?!1:(o.selected=!0,!0)})}e.forEach(function(o){"choices"in o?r._isSelectElement&&r._addGroup(o,i):r._addChoice(o,i)})},t.prototype._findAndSelectChoiceByValue=function(e,n){var i=this;n===void 0&&(n=!1);var r=this._store.choices.find(function(s){return i.config.valueComparer(s.value,e)});return r&&!r.disabled&&!r.selected?(this._addItem(r,!0,n),!0):!1},t.prototype._generatePlaceholderValue=function(){var e=this.config;if(!e.placeholder)return null;if(this._hasNonChoicePlaceholder)return e.placeholderValue;if(this._isSelectElement){var n=this.passedElement.placeholderOption;return n?n.text:null}return null},t.prototype._warnChoicesInitFailed=function(e){if(!this.config.silent)if(this.initialised){if(!this.initialisedOK)throw new TypeError("".concat(e," called for an element which has multiple instances of Choices initialised on it"))}else throw new TypeError("".concat(e," called on a non-initialised instance of Choices"))},t.version="11.1.0",t}();const Dy="",Ry="";function za(t){let e,n;return{c(){e=S("label"),n=te(t[2]),v(e,"for",t[4])},m(i,r){z(i,e,r),y(e,n)},p(i,r){r&4&&pe(n,i[2])},d(i){i&&$(e)}}}function p1(t){let e;return{c(){e=S("select"),v(e,"id",t[4]),v(e,"name",t[4]),v(e,"aria-label",t[2]),v(e,"class","m-1")},m(n,i){z(n,e,i)},p(n,i){i&4&&v(e,"aria-label",n[2])},i:X,o:X,d(n){n&&$(e)}}}function g1(t){let e,n,i,r=t[3].length&&ja(t);return{c(){r&&r.c(),e=B(),n=S("select"),v(n,"id",t[4]),v(n,"name",t[4]),v(n,"aria-label",t[2]),v(n,"class","m-1"),n.multiple=!0},m(s,o){r&&r.m(s,o),z(s,e,o),z(s,n,o),i=!0},p(s,o){s[3].length?r?(r.p(s,o),o&8&&V(r,1)):(r=ja(s),r.c(),V(r,1),r.m(e.parentNode,e)):r&&(Se(),K(r,1,1,()=>{r=null}),ke()),(!i||o&4)&&v(n,"aria-label",s[2])},i(s){i||(V(r),i=!0)},o(s){K(r),i=!1},d(s){r&&r.d(s),s&&$(e),s&&$(n)}}}function ja(t){let e,n,i=t[3].length+"",r,s,o,l;return o=new Vi({props:{targetHtmlId:t[5],tooltipText:`${t[3].length}
                                    ${W==="fr"&&t[3].length>1?"valeurs sélectionnées":W==="fr"&&t[3].length===1?"valeur sélectionnée":W==="en"&&t[3].length>1?"selected values":"selected value"}`}}),{c(){e=S("span"),n=S("span"),r=te(i),s=B(),le(o.$$.fragment),v(n,"id",t[5]),v(n,"class","input-dropdown-count tag m-1 svelte-1epfuu8"),v(e,"class","is-relative")},m(a,c){z(a,e,c),y(e,n),y(n,r),y(e,s),se(o,e,null),l=!0},p(a,c){(!l||c&8)&&i!==(i=a[3].length+"")&&pe(r,i);const u={};c&8&&(u.tooltipText=`${a[3].length}
                                    ${W==="fr"&&a[3].length>1?"valeurs sélectionnées":W==="fr"&&a[3].length===1?"valeur sélectionnée":W==="en"&&a[3].length>1?"selected values":"selected value"}`),o.$set(u)},i(a){l||(V(o.$$.fragment,a),l=!0)},o(a){K(o.$$.fragment,a),l=!1},d(a){a&&$(e),oe(o)}}}function _1(t){let e,n,i,r,s,o,l,a=t[2]!==void 0&&za(t);const c=[g1,p1],u=[];function d(f,h){return f[0]?0:1}return r=d(t),s=u[r]=c[r](t),{c(){e=S("div"),a&&a.c(),n=B(),i=S("div"),s.c(),v(i,"class",o="input-dropdown-select "+(t[0]?"is-multiple":"is-single")+" "+(t[0]&&t[3].length?"is-flex is-justify-content-flex-start is-align-items-center":"")+" "+(t[1]?"light-display":"")+" svelte-1epfuu8"),v(e,"class","input-dropdown-select-wrapper")},m(f,h){z(f,e,h),a&&a.m(e,null),y(e,n),y(e,i),u[r].m(i,null),l=!0},p(f,[h]){f[2]!==void 0?a?a.p(f,h):(a=za(f),a.c(),a.m(e,n)):a&&(a.d(1),a=null);let m=r;r=d(f),r===m?u[r].p(f,h):(Se(),K(u[m],1,1,()=>{u[m]=null}),ke(),s=u[r],s?s.p(f,h):(s=u[r]=c[r](f),s.c()),V(s,1),s.m(i,null)),(!l||h&11&&o!==(o="input-dropdown-select "+(f[0]?"is-multiple":"is-single")+" "+(f[0]&&f[3].length?"is-flex is-justify-content-flex-start is-align-items-center":"")+" "+(f[1]?"light-display":"")+" svelte-1epfuu8"))&&v(i,"class",o)},i(f){l||(V(s),l=!0)},o(f){K(s),l=!1},d(f){f&&$(e),a&&a.d(),u[r].d()}}}const v1=250;function y1(t,e,n){let i,r,{choicesItems:s}=e,{start:o=[]}=e,{multiple:l}=e,{searchable:a=!0}=e,{lightDisplay:c=!1}=e,{placeholder:u=W==="fr"?"Sélectionner une valeur":"Select a value"}=e,{title:d=void 0}=e,{selectAll:f=!!l}=e;const h=`input-dropdown-select-${window.crypto.randomUUID()}`,m=`input-dropdown-counter-${window.crypto.randomUUID()}`,g=`select-all-${window.crypto.randomUUID()}`,p=`unselect-all-${window.crypto.randomUUID()}`,_=fi();let w;const I=di();I.setCompareFn(fr);const b=gt("resetTrigger")||void 0;b==null||b.subscribe(()=>q(w,s,o,f));const E=()=>{n(11,r=!0),setTimeout(()=>n(11,r=!1),v1)},T=(A,H)=>{H||(I.set(A),I.same()||_("updateValues",i))},M=A=>`<span class="iconify" data-icon=${A}/>`,k=(A,H)=>A!=null&&H!=null&&A.length&&H.length?`<span class="dropdown-prefix-wrapper">${H==="iconify"?M(A):A}</span>`:"",x=(A,H)=>H?[{value:g,label:`<b>${W==="fr"?"Tout sélectionner":"Select all"}</b>`},{value:p,label:`<b>${W==="fr"?"Tout retirer":"Remove all"}</b>`},...A]:A,O=(A,H)=>x(A,H).map(U=>(U.id=`dropdown-choice-${window.crypto.randomUUID()}`,U.label=`<span>
                ${k(U.prefix||"",U.prefixType||"")}
                <span class="dropdown-prefix-text">${U.label}</span>
            </span>`,U));function D(A,H,U){return A=structuredClone(A),H=structuredClone(H),A=O(A,U).map(F=>H.includes(F.value)?{...F,selected:!0}:{...F,selected:!1}),n(3,i=H),A}function q(A,H,U,F){A&&(H=D(H,U,F),A.clearStore().setChoices(H))}const R=(A,H,U,F,Y,Z)=>(F=structuredClone(F),U=structuredClone(U),A.detail.value===Y?(E(),U=U.map(ne=>[Y,Z].includes(ne.value)?{...ne,selected:!1}:{...ne,selected:!0}),H.removeActiveItems().clearChoices(!0,!0).setValue(U).hideDropdown(),F=[...new Set(U.filter(ne=>ne.selected===!0).map(ne=>ne.value))]):A.detail.value===Z?(H.removeActiveItems().hideDropdown(),F=[]):F=l===!0?[...F,A.detail.value]:[A.detail.value],[...new Set(F)]),C=(A,H)=>structuredClone(H).filter(U=>U!==A.detail.value);function L(A,H){const U=document.getElementById(h);w=new m1(U,{items:[],choices:A,addChoices:!1,addItems:!1,removeItems:!0,removeItemButton:!0,searchEnabled:a,allowHTML:!0,shouldSort:!H,sorter:(F,Y)=>F.label.localeCompare(Y.label),placeholderValue:u,classNames:{item:["choices__item","dropdown-item"]},loadingText:W==="fr"?"Chargement...":"Loading...",noResultsText:W==="fr"?"Pas de résultats":"No results found",noChoicesText:W==="fr"?"Pas de choix pour faire la sélection":"No choices to choose from",itemSelectText:W==="fr"?"Cliquer pour sélectionner":"Press to select",uniqueItemText:W==="fr"?"Seules des valeurs uniques peuvent être ajoutées":"Only unique values can be added",customAddItemText:W==="fr"?"Les valeurs ne répondent pas aux conditions attendues":"Only values matching specific conditions can be added",removeItemIconText:W==="fr"?"Retirer l'item":"Remove item",addItemText:F=>W==="fr"?`Cliquer sur Entrer pour ajouter <b>${F}</b>`:`Press Enter to add <b>"${F}"</b>`,removeItemLabelText:F=>W==="fr"?`Retirer l'item: ${F}`:`Remove item: ${F}`,maxItemText:F=>W==="fr"?`Seulement ${F} items peuvent être ajoutées`:`Only ${F} items can be added`}),U.addEventListener("addItem",F=>{n(3,i=R(F,w,A,i,g,p))}),U.addEventListener("removeItem",F=>{n(3,i=C(F,i))})}return Ln(()=>{const A=D(s,o,f);L(A,f)}),Dn(()=>{w.destroy(),w=void 0}),t.$$set=A=>{"choicesItems"in A&&n(6,s=A.choicesItems),"start"in A&&n(7,o=A.start),"multiple"in A&&n(0,l=A.multiple),"searchable"in A&&n(8,a=A.searchable),"lightDisplay"in A&&n(1,c=A.lightDisplay),"placeholder"in A&&n(9,u=A.placeholder),"title"in A&&n(2,d=A.title),"selectAll"in A&&n(10,f=A.selectAll)},t.$$.update=()=>{t.$$.dirty&2056&&T(i,r)},n(3,i=[]),n(11,r=!1),[l,c,d,i,h,m,s,o,a,u,f,r]}class b1 extends ve{constructor(e){super(),_e(this,e,y1,_1,me,{choicesItems:6,start:7,multiple:0,searchable:8,lightDisplay:1,placeholder:9,title:2,selectAll:10})}}var tn;(function(t){t.Range="range",t.Steps="steps",t.Positions="positions",t.Count="count",t.Values="values"})(tn||(tn={}));var lt;(function(t){t[t.None=-1]="None",t[t.NoValue=0]="NoValue",t[t.LargeValue=1]="LargeValue",t[t.SmallValue=2]="SmallValue"})(lt||(lt={}));function w1(t){return Wi(t)&&typeof t.from=="function"}function Wi(t){return typeof t=="object"&&typeof t.to=="function"}function Fa(t){t.parentElement.removeChild(t)}function os(t){return t!=null}function Va(t){t.preventDefault()}function S1(t){return t.filter(function(e){return this[e]?!1:this[e]=!0},{})}function k1(t,e){return Math.round(t/e)*e}function E1(t,e){var n=t.getBoundingClientRect(),i=t.ownerDocument,r=i.documentElement,s=Ba(i);return/webkit.*Chrome.*Mobile/i.test(navigator.userAgent)&&(s.x=0),e?n.top+s.y-r.clientTop:n.left+s.x-r.clientLeft}function At(t){return typeof t=="number"&&!isNaN(t)&&isFinite(t)}function Ha(t,e,n){n>0&&(Qe(t,e),setTimeout(function(){Yi(t,e)},n))}function Ua(t){return Math.max(Math.min(t,100),0)}function Gi(t){return Array.isArray(t)?t:[t]}function C1(t){t=String(t);var e=t.split(".");return e.length>1?e[1].length:0}function Qe(t,e){t.classList&&!/\s/.test(e)?t.classList.add(e):t.className+=" "+e}function Yi(t,e){t.classList&&!/\s/.test(e)?t.classList.remove(e):t.className=t.className.replace(new RegExp("(^|\\b)"+e.split(" ").join("|")+"(\\b|$)","gi")," ")}function I1(t,e){return t.classList?t.classList.contains(e):new RegExp("\\b"+e+"\\b").test(t.className)}function Ba(t){var e=window.pageXOffset!==void 0,n=(t.compatMode||"")==="CSS1Compat",i=e?window.pageXOffset:n?t.documentElement.scrollLeft:t.body.scrollLeft,r=e?window.pageYOffset:n?t.documentElement.scrollTop:t.body.scrollTop;return{x:i,y:r}}function M1(){return window.navigator.pointerEnabled?{start:"pointerdown",move:"pointermove",end:"pointerup"}:window.navigator.msPointerEnabled?{start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:{start:"mousedown touchstart",move:"mousemove touchmove",end:"mouseup touchend"}}function x1(){var t=!1;try{var e=Object.defineProperty({},"passive",{get:function(){t=!0}});window.addEventListener("test",null,e)}catch{}return t}function A1(){return window.CSS&&CSS.supports&&CSS.supports("touch-action","none")}function ls(t,e){return 100/(e-t)}function as(t,e,n){return e*100/(t[n+1]-t[n])}function N1(t,e){return as(t,t[0]<0?e+Math.abs(t[0]):e-t[0],0)}function T1(t,e){return e*(t[1]-t[0])/100+t[0]}function ei(t,e){for(var n=1;t>=e[n];)n+=1;return n}function O1(t,e,n){if(n>=t.slice(-1)[0])return 100;var i=ei(n,t),r=t[i-1],s=t[i],o=e[i-1],l=e[i];return o+N1([r,s],n)/ls(o,l)}function P1(t,e,n){if(n>=100)return t.slice(-1)[0];var i=ei(n,e),r=t[i-1],s=t[i],o=e[i-1],l=e[i];return T1([r,s],(n-o)*ls(o,l))}function L1(t,e,n,i){if(i===100)return i;var r=ei(i,t),s=t[r-1],o=t[r];return n?i-s>(o-s)/2?o:s:e[r-1]?t[r-1]+k1(i-t[r-1],e[r-1]):i}var qa=function(){function t(e,n,i){this.xPct=[],this.xVal=[],this.xSteps=[],this.xNumSteps=[],this.xHighestCompleteStep=[],this.xSteps=[i||!1],this.xNumSteps=[!1],this.snap=n;var r,s=[];for(Object.keys(e).forEach(function(o){s.push([Gi(e[o]),o])}),s.sort(function(o,l){return o[0][0]-l[0][0]}),r=0;r<s.length;r++)this.handleEntryPoint(s[r][1],s[r][0]);for(this.xNumSteps=this.xSteps.slice(0),r=0;r<this.xNumSteps.length;r++)this.handleStepPoint(r,this.xNumSteps[r])}return t.prototype.getDistance=function(e){for(var n=[],i=0;i<this.xNumSteps.length-1;i++)n[i]=as(this.xVal,e,i);return n},t.prototype.getAbsoluteDistance=function(e,n,i){var r=0;if(e<this.xPct[this.xPct.length-1])for(;e>this.xPct[r+1];)r++;else e===this.xPct[this.xPct.length-1]&&(r=this.xPct.length-2);!i&&e===this.xPct[r+1]&&r++,n===null&&(n=[]);var s,o=1,l=n[r],a=0,c=0,u=0,d=0;for(i?s=(e-this.xPct[r])/(this.xPct[r+1]-this.xPct[r]):s=(this.xPct[r+1]-e)/(this.xPct[r+1]-this.xPct[r]);l>0;)a=this.xPct[r+1+d]-this.xPct[r+d],n[r+d]*o+100-s*100>100?(c=a*s,o=(l-100*s)/n[r+d],s=1):(c=n[r+d]*a/100*o,o=0),i?(u=u-c,this.xPct.length+d>=1&&d--):(u=u+c,this.xPct.length-d>=1&&d++),l=n[r+d]*o;return e+u},t.prototype.toStepping=function(e){return e=O1(this.xVal,this.xPct,e),e},t.prototype.fromStepping=function(e){return P1(this.xVal,this.xPct,e)},t.prototype.getStep=function(e){return e=L1(this.xPct,this.xSteps,this.snap,e),e},t.prototype.getDefaultStep=function(e,n,i){var r=ei(e,this.xPct);return(e===100||n&&e===this.xPct[r-1])&&(r=Math.max(r-1,1)),(this.xVal[r]-this.xVal[r-1])/i},t.prototype.getNearbySteps=function(e){var n=ei(e,this.xPct);return{stepBefore:{startValue:this.xVal[n-2],step:this.xNumSteps[n-2],highestStep:this.xHighestCompleteStep[n-2]},thisStep:{startValue:this.xVal[n-1],step:this.xNumSteps[n-1],highestStep:this.xHighestCompleteStep[n-1]},stepAfter:{startValue:this.xVal[n],step:this.xNumSteps[n],highestStep:this.xHighestCompleteStep[n]}}},t.prototype.countStepDecimals=function(){var e=this.xNumSteps.map(C1);return Math.max.apply(null,e)},t.prototype.hasNoSize=function(){return this.xVal[0]===this.xVal[this.xVal.length-1]},t.prototype.convert=function(e){return this.getStep(this.toStepping(e))},t.prototype.handleEntryPoint=function(e,n){var i;if(e==="min"?i=0:e==="max"?i=100:i=parseFloat(e),!At(i)||!At(n[0]))throw new Error("noUiSlider: 'range' value isn't numeric.");this.xPct.push(i),this.xVal.push(n[0]);var r=Number(n[1]);i?this.xSteps.push(isNaN(r)?!1:r):isNaN(r)||(this.xSteps[0]=r),this.xHighestCompleteStep.push(0)},t.prototype.handleStepPoint=function(e,n){if(n){if(this.xVal[e]===this.xVal[e+1]){this.xSteps[e]=this.xHighestCompleteStep[e]=this.xVal[e];return}this.xSteps[e]=as([this.xVal[e],this.xVal[e+1]],n,0)/ls(this.xPct[e],this.xPct[e+1]);var i=(this.xVal[e+1]-this.xVal[e])/this.xNumSteps[e],r=Math.ceil(Number(i.toFixed(3))-1),s=this.xVal[e]+this.xNumSteps[e]*r;this.xHighestCompleteStep[e]=s}},t}(),Ka={to:function(t){return t===void 0?"":t.toFixed(2)},from:Number},Wa={target:"target",base:"base",origin:"origin",handle:"handle",handleLower:"handle-lower",handleUpper:"handle-upper",touchArea:"touch-area",horizontal:"horizontal",vertical:"vertical",background:"background",connect:"connect",connects:"connects",ltr:"ltr",rtl:"rtl",textDirectionLtr:"txt-dir-ltr",textDirectionRtl:"txt-dir-rtl",draggable:"draggable",drag:"state-drag",tap:"state-tap",active:"active",tooltip:"tooltip",pips:"pips",pipsHorizontal:"pips-horizontal",pipsVertical:"pips-vertical",marker:"marker",markerHorizontal:"marker-horizontal",markerVertical:"marker-vertical",markerNormal:"marker-normal",markerLarge:"marker-large",markerSub:"marker-sub",value:"value",valueHorizontal:"value-horizontal",valueVertical:"value-vertical",valueNormal:"value-normal",valueLarge:"value-large",valueSub:"value-sub"},nn={tooltips:".__tooltips",aria:".__aria"};function D1(t,e){if(!At(e))throw new Error("noUiSlider: 'step' is not numeric.");t.singleStep=e}function R1(t,e){if(!At(e))throw new Error("noUiSlider: 'keyboardPageMultiplier' is not numeric.");t.keyboardPageMultiplier=e}function $1(t,e){if(!At(e))throw new Error("noUiSlider: 'keyboardMultiplier' is not numeric.");t.keyboardMultiplier=e}function z1(t,e){if(!At(e))throw new Error("noUiSlider: 'keyboardDefaultStep' is not numeric.");t.keyboardDefaultStep=e}function j1(t,e){if(typeof e!="object"||Array.isArray(e))throw new Error("noUiSlider: 'range' is not an object.");if(e.min===void 0||e.max===void 0)throw new Error("noUiSlider: Missing 'min' or 'max' in 'range'.");t.spectrum=new qa(e,t.snap||!1,t.singleStep)}function F1(t,e){if(e=Gi(e),!Array.isArray(e)||!e.length)throw new Error("noUiSlider: 'start' option is incorrect.");t.handles=e.length,t.start=e}function V1(t,e){if(typeof e!="boolean")throw new Error("noUiSlider: 'snap' option must be a boolean.");t.snap=e}function H1(t,e){if(typeof e!="boolean")throw new Error("noUiSlider: 'animate' option must be a boolean.");t.animate=e}function U1(t,e){if(typeof e!="number")throw new Error("noUiSlider: 'animationDuration' option must be a number.");t.animationDuration=e}function Ga(t,e){var n=[!1],i;if(e==="lower"?e=[!0,!1]:e==="upper"&&(e=[!1,!0]),e===!0||e===!1){for(i=1;i<t.handles;i++)n.push(e);n.push(!1)}else{if(!Array.isArray(e)||!e.length||e.length!==t.handles+1)throw new Error("noUiSlider: 'connect' option doesn't match handle count.");n=e}t.connect=n}function B1(t,e){switch(e){case"horizontal":t.ort=0;break;case"vertical":t.ort=1;break;default:throw new Error("noUiSlider: 'orientation' option is invalid.")}}function Ya(t,e){if(!At(e))throw new Error("noUiSlider: 'margin' option must be numeric.");e!==0&&(t.margin=t.spectrum.getDistance(e))}function q1(t,e){if(!At(e))throw new Error("noUiSlider: 'limit' option must be numeric.");if(t.limit=t.spectrum.getDistance(e),!t.limit||t.handles<2)throw new Error("noUiSlider: 'limit' option is only supported on linear sliders with 2 or more handles.")}function K1(t,e){var n;if(!At(e)&&!Array.isArray(e))throw new Error("noUiSlider: 'padding' option must be numeric or array of exactly 2 numbers.");if(Array.isArray(e)&&!(e.length===2||At(e[0])||At(e[1])))throw new Error("noUiSlider: 'padding' option must be numeric or array of exactly 2 numbers.");if(e!==0){for(Array.isArray(e)||(e=[e,e]),t.padding=[t.spectrum.getDistance(e[0]),t.spectrum.getDistance(e[1])],n=0;n<t.spectrum.xNumSteps.length-1;n++)if(t.padding[0][n]<0||t.padding[1][n]<0)throw new Error("noUiSlider: 'padding' option must be a positive number(s).");var i=e[0]+e[1],r=t.spectrum.xVal[0],s=t.spectrum.xVal[t.spectrum.xVal.length-1];if(i/(s-r)>1)throw new Error("noUiSlider: 'padding' option must not exceed 100% of the range.")}}function W1(t,e){switch(e){case"ltr":t.dir=0;break;case"rtl":t.dir=1;break;default:throw new Error("noUiSlider: 'direction' option was not recognized.")}}function G1(t,e){if(typeof e!="string")throw new Error("noUiSlider: 'behaviour' must be a string containing options.");var n=e.indexOf("tap")>=0,i=e.indexOf("drag")>=0,r=e.indexOf("fixed")>=0,s=e.indexOf("snap")>=0,o=e.indexOf("hover")>=0,l=e.indexOf("unconstrained")>=0,a=e.indexOf("invert-connects")>=0,c=e.indexOf("drag-all")>=0,u=e.indexOf("smooth-steps")>=0;if(r){if(t.handles!==2)throw new Error("noUiSlider: 'fixed' behaviour must be used with 2 handles");Ya(t,t.start[1]-t.start[0])}if(a&&t.handles!==2)throw new Error("noUiSlider: 'invert-connects' behaviour must be used with 2 handles");if(l&&(t.margin||t.limit))throw new Error("noUiSlider: 'unconstrained' behaviour cannot be used with margin or limit");t.events={tap:n||s,drag:i,dragAll:c,smoothSteps:u,fixed:r,snap:s,hover:o,unconstrained:l,invertConnects:a}}function Y1(t,e){if(e!==!1)if(e===!0||Wi(e)){t.tooltips=[];for(var n=0;n<t.handles;n++)t.tooltips.push(e)}else{if(e=Gi(e),e.length!==t.handles)throw new Error("noUiSlider: must pass a formatter for all handles.");e.forEach(function(i){if(typeof i!="boolean"&&!Wi(i))throw new Error("noUiSlider: 'tooltips' must be passed a formatter or 'false'.")}),t.tooltips=e}}function X1(t,e){if(e.length!==t.handles)throw new Error("noUiSlider: must pass a attributes for all handles.");t.handleAttributes=e}function J1(t,e){if(!Wi(e))throw new Error("noUiSlider: 'ariaFormat' requires 'to' method.");t.ariaFormat=e}function Q1(t,e){if(!w1(e))throw new Error("noUiSlider: 'format' requires 'to' and 'from' methods.");t.format=e}function Z1(t,e){if(typeof e!="boolean")throw new Error("noUiSlider: 'keyboardSupport' option must be a boolean.");t.keyboardSupport=e}function ev(t,e){t.documentElement=e}function tv(t,e){if(typeof e!="string"&&e!==!1)throw new Error("noUiSlider: 'cssPrefix' must be a string or `false`.");t.cssPrefix=e}function nv(t,e){if(typeof e!="object")throw new Error("noUiSlider: 'cssClasses' must be an object.");typeof t.cssPrefix=="string"?(t.cssClasses={},Object.keys(e).forEach(function(n){t.cssClasses[n]=t.cssPrefix+e[n]})):t.cssClasses=e}function Xa(t){var e={margin:null,limit:null,padding:null,animate:!0,animationDuration:300,ariaFormat:Ka,format:Ka},n={step:{r:!1,t:D1},keyboardPageMultiplier:{r:!1,t:R1},keyboardMultiplier:{r:!1,t:$1},keyboardDefaultStep:{r:!1,t:z1},start:{r:!0,t:F1},connect:{r:!0,t:Ga},direction:{r:!0,t:W1},snap:{r:!1,t:V1},animate:{r:!1,t:H1},animationDuration:{r:!1,t:U1},range:{r:!0,t:j1},orientation:{r:!1,t:B1},margin:{r:!1,t:Ya},limit:{r:!1,t:q1},padding:{r:!1,t:K1},behaviour:{r:!0,t:G1},ariaFormat:{r:!1,t:J1},format:{r:!1,t:Q1},tooltips:{r:!1,t:Y1},keyboardSupport:{r:!0,t:Z1},documentElement:{r:!1,t:ev},cssPrefix:{r:!0,t:tv},cssClasses:{r:!0,t:nv},handleAttributes:{r:!1,t:X1}},i={connect:!1,direction:"ltr",behaviour:"tap",orientation:"horizontal",keyboardSupport:!0,cssPrefix:"noUi-",cssClasses:Wa,keyboardPageMultiplier:5,keyboardMultiplier:1,keyboardDefaultStep:10};t.format&&!t.ariaFormat&&(t.ariaFormat=t.format),Object.keys(n).forEach(function(a){if(!os(t[a])&&i[a]===void 0){if(n[a].r)throw new Error("noUiSlider: '"+a+"' is required.");return}n[a].t(e,os(t[a])?t[a]:i[a])}),e.pips=t.pips;var r=document.createElement("div"),s=r.style.msTransform!==void 0,o=r.style.transform!==void 0;e.transformRule=o?"transform":s?"msTransform":"webkitTransform";var l=[["left","top"],["right","bottom"]];return e.style=l[e.dir][e.ort],e}function iv(t,e,n){var i=M1(),r=A1(),s=r&&x1(),o=t,l,a,c,u,d,f,h=e.spectrum,m=[],g=[],p=[],_=0,w={},I=!1,b=t.ownerDocument,E=e.documentElement||b.documentElement,T=b.body,M=b.dir==="rtl"||e.ort===1?0:100;function k(N,P){var j=b.createElement("div");return P&&Qe(j,P),N.appendChild(j),j}function x(N,P){var j=k(N,e.cssClasses.origin),G=k(j,e.cssClasses.handle);if(k(G,e.cssClasses.touchArea),G.setAttribute("data-handle",String(P)),e.keyboardSupport&&(G.setAttribute("tabindex","0"),G.addEventListener("keydown",function(Q){return ni(Q,P)})),e.handleAttributes!==void 0){var J=e.handleAttributes[P];Object.keys(J).forEach(function(Q){G.setAttribute(Q,J[Q])})}return G.setAttribute("role","slider"),G.setAttribute("aria-orientation",e.ort?"vertical":"horizontal"),P===0?Qe(G,e.cssClasses.handleLower):P===e.handles-1&&Qe(G,e.cssClasses.handleUpper),j.handle=G,j}function O(N,P){return P?k(N,e.cssClasses.connect):!1}function D(N,P){a=k(P,e.cssClasses.connects),c=[],u=[],u.push(O(a,N[0]));for(var j=0;j<e.handles;j++)c.push(x(P,j)),p[j]=j,u.push(O(a,N[j+1]))}function q(N){Qe(N,e.cssClasses.target),e.dir===0?Qe(N,e.cssClasses.ltr):Qe(N,e.cssClasses.rtl),e.ort===0?Qe(N,e.cssClasses.horizontal):Qe(N,e.cssClasses.vertical);var P=getComputedStyle(N).direction;return P==="rtl"?Qe(N,e.cssClasses.textDirectionRtl):Qe(N,e.cssClasses.textDirectionLtr),k(N,e.cssClasses.base)}function R(N,P){return!e.tooltips||!e.tooltips[P]?!1:k(N.firstChild,e.cssClasses.tooltip)}function C(){return o.hasAttribute("disabled")}function L(N){var P=c[N];return P.hasAttribute("disabled")}function A(N){N!=null?(c[N].setAttribute("disabled",""),c[N].handle.removeAttribute("tabindex")):(o.setAttribute("disabled",""),c.forEach(function(P){P.handle.removeAttribute("tabindex")}))}function H(N){N!=null?(c[N].removeAttribute("disabled"),c[N].handle.setAttribute("tabindex","0")):(o.removeAttribute("disabled"),c.forEach(function(P){P.removeAttribute("disabled"),P.handle.setAttribute("tabindex","0")}))}function U(){f&&(un("update"+nn.tooltips),f.forEach(function(N){N&&Fa(N)}),f=null)}function F(){U(),f=c.map(R),Ot("update"+nn.tooltips,function(N,P,j){if(!(!f||!e.tooltips)&&f[P]!==!1){var G=N[P];e.tooltips[P]!==!0&&(G=e.tooltips[P].to(j[P])),f[P].innerHTML=G}})}function Y(){un("update"+nn.aria),Ot("update"+nn.aria,function(N,P,j,G,J){p.forEach(function(Q){var ae=c[Q],ie=Ze(g,Q,0,!0,!0,!0),Ne=Ze(g,Q,100,!0,!0,!0),Te=J[Q],$e=String(e.ariaFormat.to(j[Q]));ie=h.fromStepping(ie).toFixed(1),Ne=h.fromStepping(Ne).toFixed(1),Te=h.fromStepping(Te).toFixed(1),ae.children[0].setAttribute("aria-valuemin",ie),ae.children[0].setAttribute("aria-valuemax",Ne),ae.children[0].setAttribute("aria-valuenow",Te),ae.children[0].setAttribute("aria-valuetext",$e)})})}function Z(N){if(N.mode===tn.Range||N.mode===tn.Steps)return h.xVal;if(N.mode===tn.Count){if(N.values<2)throw new Error("noUiSlider: 'values' (>= 2) required for mode 'count'.");for(var P=N.values-1,j=100/P,G=[];P--;)G[P]=P*j;return G.push(100),ne(G,N.stepped)}return N.mode===tn.Positions?ne(N.values,N.stepped):N.mode===tn.Values?N.stepped?N.values.map(function(J){return h.fromStepping(h.getStep(h.toStepping(J)))}):N.values:[]}function ne(N,P){return N.map(function(j){return h.fromStepping(P?h.getStep(j):j)})}function fe(N){function P(Te,$e){return Number((Te+$e).toFixed(7))}var j=Z(N),G={},J=h.xVal[0],Q=h.xVal[h.xVal.length-1],ae=!1,ie=!1,Ne=0;return j=S1(j.slice().sort(function(Te,$e){return Te-$e})),j[0]!==J&&(j.unshift(J),ae=!0),j[j.length-1]!==Q&&(j.push(Q),ie=!0),j.forEach(function(Te,$e){var ze,Ie,Ue,et=Te,qe=j[$e+1],Ge,cs,us,fs,cc,hs,uc,fc=N.mode===tn.Steps;for(fc&&(ze=h.xNumSteps[$e]),ze||(ze=qe-et),qe===void 0&&(qe=et),ze=Math.max(ze,1e-7),Ie=et;Ie<=qe;Ie=P(Ie,ze)){for(Ge=h.toStepping(Ie),cs=Ge-Ne,cc=cs/(N.density||1),hs=Math.round(cc),uc=cs/hs,Ue=1;Ue<=hs;Ue+=1)us=Ne+Ue*uc,G[us.toFixed(5)]=[h.fromStepping(us),0];fs=j.indexOf(Ie)>-1?lt.LargeValue:fc?lt.SmallValue:lt.NoValue,!$e&&ae&&Ie!==qe&&(fs=0),Ie===qe&&ie||(G[Ge.toFixed(5)]=[Ie,fs]),Ne=Ge}}),G}function ee(N,P,j){var G,J,Q=b.createElement("div"),ae=(G={},G[lt.None]="",G[lt.NoValue]=e.cssClasses.valueNormal,G[lt.LargeValue]=e.cssClasses.valueLarge,G[lt.SmallValue]=e.cssClasses.valueSub,G),ie=(J={},J[lt.None]="",J[lt.NoValue]=e.cssClasses.markerNormal,J[lt.LargeValue]=e.cssClasses.markerLarge,J[lt.SmallValue]=e.cssClasses.markerSub,J),Ne=[e.cssClasses.valueHorizontal,e.cssClasses.valueVertical],Te=[e.cssClasses.markerHorizontal,e.cssClasses.markerVertical];Qe(Q,e.cssClasses.pips),Qe(Q,e.ort===0?e.cssClasses.pipsHorizontal:e.cssClasses.pipsVertical);function $e(Ie,Ue){var et=Ue===e.cssClasses.value,qe=et?Ne:Te,Ge=et?ae:ie;return Ue+" "+qe[e.ort]+" "+Ge[Ie]}function ze(Ie,Ue,et){if(et=P?P(Ue,et):et,et!==lt.None){var qe=k(Q,!1);qe.className=$e(et,e.cssClasses.marker),qe.style[e.style]=Ie+"%",et>lt.NoValue&&(qe=k(Q,!1),qe.className=$e(et,e.cssClasses.value),qe.setAttribute("data-value",String(Ue)),qe.style[e.style]=Ie+"%",qe.innerHTML=String(j.to(Ue)))}}return Object.keys(N).forEach(function(Ie){ze(Ie,N[Ie][0],N[Ie][1])}),Q}function ce(){d&&(Fa(d),d=null)}function Ee(N){ce();var P=fe(N),j=N.filter,G=N.format||{to:function(J){return String(Math.round(J))}};return d=o.appendChild(ee(P,j,G)),d}function Me(){var N=l.getBoundingClientRect(),P="offset"+["Width","Height"][e.ort];return e.ort===0?N.width||l[P]:N.height||l[P]}function ye(N,P,j,G){var J=function(ae){var ie=Ve(ae,G.pageOffset,G.target||P);if(!ie||C()&&!G.doNotReject||I1(o,e.cssClasses.tap)&&!G.doNotReject||N===i.start&&ie.buttons!==void 0&&ie.buttons>1||G.hover&&ie.buttons)return!1;s||ie.preventDefault(),ie.calcPoint=ie.points[e.ort],j(ie,G)},Q=[];return N.split(" ").forEach(function(ae){P.addEventListener(ae,J,s?{passive:!0}:!1),Q.push([ae,J])}),Q}function Ve(N,P,j){var G=N.type.indexOf("touch")===0,J=N.type.indexOf("mouse")===0,Q=N.type.indexOf("pointer")===0,ae=0,ie=0;if(N.type.indexOf("MSPointer")===0&&(Q=!0),N.type==="mousedown"&&!N.buttons&&!N.touches)return!1;if(G){var Ne=function(ze){var Ie=ze.target;return Ie===j||j.contains(Ie)||N.composed&&N.composedPath().shift()===j};if(N.type==="touchstart"){var Te=Array.prototype.filter.call(N.touches,Ne);if(Te.length>1)return!1;ae=Te[0].pageX,ie=Te[0].pageY}else{var $e=Array.prototype.find.call(N.changedTouches,Ne);if(!$e)return!1;ae=$e.pageX,ie=$e.pageY}}return P=P||Ba(b),(J||Q)&&(ae=N.clientX+P.x,ie=N.clientY+P.y),N.pageOffset=P,N.points=[ae,ie],N.cursor=J||Q,N}function Nt(N){var P=N-E1(l,e.ort),j=P*100/Me();return j=Ua(j),e.dir?100-j:j}function Re(N){var P=100,j=!1;return c.forEach(function(G,J){if(!L(J)){var Q=g[J],ae=Math.abs(Q-N),ie=ae===100&&P===100,Ne=ae<P,Te=ae<=P&&N>Q;(Ne||Te||ie)&&(j=J,P=ae)}}),j}function je(N,P){N.type==="mouseout"&&N.target.nodeName==="HTML"&&N.relatedTarget===null&&Pe(N,P)}function at(N,P){if(navigator.appVersion.indexOf("MSIE 9")===-1&&N.buttons===0&&P.buttonsProperty!==0)return Pe(N,P);var j=(e.dir?-1:1)*(N.calcPoint-P.startCalcPoint),G=j*100/P.baseSize;re(j>0,G,P.locations,P.handleNumbers,P.connect)}function Pe(N,P){P.handle&&(Yi(P.handle,e.cssClasses.active),_-=1),P.listeners.forEach(function(j){E.removeEventListener(j[0],j[1])}),_===0&&(Yi(o,e.cssClasses.drag),On(),N.cursor&&(T.style.cursor="",T.removeEventListener("selectstart",Va))),e.events.smoothSteps&&(P.handleNumbers.forEach(function(j){ue(j,g[j],!0,!0,!1,!1)}),P.handleNumbers.forEach(function(j){Oe("update",j)})),P.handleNumbers.forEach(function(j){Oe("change",j),Oe("set",j),Oe("end",j)})}function xe(N,P){if(!P.handleNumbers.some(L)){var j;if(P.handleNumbers.length===1){var G=c[P.handleNumbers[0]];j=G.children[0],_+=1,Qe(j,e.cssClasses.active)}N.stopPropagation();var J=[],Q=ye(i.move,E,at,{target:N.target,handle:j,connect:P.connect,listeners:J,startCalcPoint:N.calcPoint,baseSize:Me(),pageOffset:N.pageOffset,handleNumbers:P.handleNumbers,buttonsProperty:N.buttons,locations:g.slice()}),ae=ye(i.end,E,Pe,{target:N.target,handle:j,listeners:J,doNotReject:!0,handleNumbers:P.handleNumbers}),ie=ye("mouseout",E,je,{target:N.target,handle:j,listeners:J,doNotReject:!0,handleNumbers:P.handleNumbers});J.push.apply(J,Q.concat(ae,ie)),N.cursor&&(T.style.cursor=getComputedStyle(N.target).cursor,c.length>1&&Qe(o,e.cssClasses.drag),T.addEventListener("selectstart",Va,!1)),P.handleNumbers.forEach(function(Ne){Oe("start",Ne)})}}function Tt(N){N.stopPropagation();var P=Nt(N.calcPoint),j=Re(P);j!==!1&&(e.events.snap||Ha(o,e.cssClasses.tap,e.animationDuration),ue(j,P,!0,!0),On(),Oe("slide",j,!0),Oe("update",j,!0),e.events.snap?xe(N,{handleNumbers:[j]}):(Oe("change",j,!0),Oe("set",j,!0)))}function yt(N){var P=Nt(N.calcPoint),j=h.getStep(P),G=h.fromStepping(j);Object.keys(w).forEach(function(J){J.split(".")[0]==="hover"&&w[J].forEach(function(Q){Q.call(Ji,G)})})}function ni(N,P){if(C()||L(P))return!1;var j=["Left","Right"],G=["Down","Up"],J=["PageDown","PageUp"],Q=["Home","End"];e.dir&&!e.ort?j.reverse():e.ort&&!e.dir&&(G.reverse(),J.reverse());var ae=N.key.replace("Arrow",""),ie=ae===J[0],Ne=ae===J[1],Te=ae===G[0]||ae===j[0]||ie,$e=ae===G[1]||ae===j[1]||Ne,ze=ae===Q[0],Ie=ae===Q[1];if(!Te&&!$e&&!ze&&!Ie)return!0;N.preventDefault();var Ue;if($e||Te){var et=Te?0:1,qe=lc(P),Ge=qe[et];if(Ge===null)return!1;Ge===!1&&(Ge=h.getDefaultStep(g[P],Te,e.keyboardDefaultStep)),Ne||ie?Ge*=e.keyboardPageMultiplier:Ge*=e.keyboardMultiplier,Ge=Math.max(Ge,1e-7),Ge=(Te?-1:1)*Ge,Ue=m[P]+Ge}else Ie?Ue=e.spectrum.xVal[e.spectrum.xVal.length-1]:Ue=e.spectrum.xVal[0];return ue(P,h.toStepping(Ue),!0,!0),Oe("slide",P),Oe("update",P),Oe("change",P),Oe("set",P),!1}function dt(N){N.fixed||c.forEach(function(P,j){ye(i.start,P.children[0],xe,{handleNumbers:[j]})}),N.tap&&ye(i.start,l,Tt,{}),N.hover&&ye(i.move,l,yt,{hover:!0}),N.drag&&u.forEach(function(P,j){if(!(P===!1||j===0||j===u.length-1)){var G=c[j-1],J=c[j],Q=[P],ae=[G,J],ie=[j-1,j];Qe(P,e.cssClasses.draggable),N.fixed&&(Q.push(G.children[0]),Q.push(J.children[0])),N.dragAll&&(ae=c,ie=p),Q.forEach(function(Ne){ye(i.start,Ne,xe,{handles:ae,handleNumbers:ie,connect:P})})}})}function Ot(N,P){w[N]=w[N]||[],w[N].push(P),N.split(".")[0]==="update"&&c.forEach(function(j,G){Oe("update",G)})}function Le(N){return N===nn.aria||N===nn.tooltips}function un(N){var P=N&&N.split(".")[0],j=P?N.substring(P.length):N;Object.keys(w).forEach(function(G){var J=G.split(".")[0],Q=G.substring(J.length);(!P||P===J)&&(!j||j===Q)&&(!Le(Q)||j===Q)&&delete w[G]})}function Oe(N,P,j){Object.keys(w).forEach(function(G){var J=G.split(".")[0];N===J&&w[G].forEach(function(Q){Q.call(Ji,m.map(e.format.to),P,m.slice(),j||!1,g.slice(),Ji)})})}function Ze(N,P,j,G,J,Q,ae){var ie;return c.length>1&&!e.events.unconstrained&&(G&&P>0&&(ie=h.getAbsoluteDistance(N[P-1],e.margin,!1),j=Math.max(j,ie)),J&&P<c.length-1&&(ie=h.getAbsoluteDistance(N[P+1],e.margin,!0),j=Math.min(j,ie))),c.length>1&&e.limit&&(G&&P>0&&(ie=h.getAbsoluteDistance(N[P-1],e.limit,!1),j=Math.min(j,ie)),J&&P<c.length-1&&(ie=h.getAbsoluteDistance(N[P+1],e.limit,!0),j=Math.max(j,ie))),e.padding&&(P===0&&(ie=h.getAbsoluteDistance(0,e.padding[0],!1),j=Math.max(j,ie)),P===c.length-1&&(ie=h.getAbsoluteDistance(100,e.padding[1],!0),j=Math.min(j,ie))),ae||(j=h.getStep(j)),j=Ua(j),j===N[P]&&!Q?!1:j}function Tn(N,P){var j=e.ort;return(j?P:N)+", "+(j?N:P)}function re(N,P,j,G,J){var Q=j.slice(),ae=G[0],ie=e.events.smoothSteps,Ne=[!N,N],Te=[N,!N];G=G.slice(),N&&G.reverse(),G.length>1?G.forEach(function(ze,Ie){var Ue=Ze(Q,ze,Q[ze]+P,Ne[Ie],Te[Ie],!1,ie);Ue===!1?P=0:(P=Ue-Q[ze],Q[ze]=Ue)}):Ne=Te=[!0];var $e=!1;G.forEach(function(ze,Ie){$e=ue(ze,j[ze]+P,Ne[Ie],Te[Ie],!1,ie)||$e}),$e&&(G.forEach(function(ze){Oe("update",ze),Oe("slide",ze)}),J!=null&&Oe("drag",ae))}function Ae(N,P){return e.dir?100-N-P:N}function He(N,P){g[N]=P,m[N]=h.fromStepping(P);var j=Ae(P,0)-M,G="translate("+Tn(j+"%","0")+")";if(c[N].style[e.transformRule]=G,e.events.invertConnects&&g.length>1){var J=g.every(function(Q,ae,ie){return ae===0||Q>=ie[ae-1]});if(I!==!J){ey();return}}mt(N),mt(N+1),I&&(mt(N-1),mt(N+2))}function On(){p.forEach(function(N){var P=g[N]>50?-1:1,j=3+(c.length+P*N);c[N].style.zIndex=String(j)})}function ue(N,P,j,G,J,Q){return J||(P=Ze(g,N,P,j,G,!1,Q)),P===!1?!1:(He(N,P),!0)}function mt(N){if(u[N]){var P=g.slice();I&&P.sort(function(ie,Ne){return ie-Ne});var j=0,G=100;N!==0&&(j=P[N-1]),N!==u.length-1&&(G=P[N]);var J=G-j,Q="translate("+Tn(Ae(j,J)+"%","0")+")",ae="scale("+Tn(J/100,"1")+")";u[N].style[e.transformRule]=Q+" "+ae}}function sc(N,P){return N===null||N===!1||N===void 0||(typeof N=="number"&&(N=String(N)),N=e.format.from(N),N!==!1&&(N=h.toStepping(N)),N===!1||isNaN(N))?g[P]:N}function Xi(N,P,j){var G=Gi(N),J=g[0]===void 0;P=P===void 0?!0:P,e.animate&&!J&&Ha(o,e.cssClasses.tap,e.animationDuration),p.forEach(function(ie){ue(ie,sc(G[ie],ie),!0,!1,j)});var Q=p.length===1?0:1;if(J&&h.hasNoSize()&&(j=!0,g[0]=0,p.length>1)){var ae=100/(p.length-1);p.forEach(function(ie){g[ie]=ie*ae})}for(;Q<p.length;++Q)p.forEach(function(ie){ue(ie,g[ie],!0,!0,j)});On(),p.forEach(function(ie){Oe("update",ie),G[ie]!==null&&P&&Oe("set",ie)})}function Yv(N){Xi(e.start,N)}function Xv(N,P,j,G){if(N=Number(N),!(N>=0&&N<p.length))throw new Error("noUiSlider: invalid handle number, got: "+N);ue(N,sc(P,N),!0,!0,G),Oe("update",N),j&&Oe("set",N)}function oc(N){if(N===void 0&&(N=!1),N)return m.length===1?m[0]:m.slice(0);var P=m.map(e.format.to);return P.length===1?P[0]:P}function Jv(){for(un(nn.aria),un(nn.tooltips),Object.keys(e.cssClasses).forEach(function(N){Yi(o,e.cssClasses[N])});o.firstChild;)o.removeChild(o.firstChild);delete o.noUiSlider}function lc(N){var P=g[N],j=h.getNearbySteps(P),G=m[N],J=j.thisStep.step,Q=null;if(e.snap)return[G-j.stepBefore.startValue||null,j.stepAfter.startValue-G||null];J!==!1&&G+J>j.stepAfter.startValue&&(J=j.stepAfter.startValue-G),G>j.thisStep.startValue?Q=j.thisStep.step:j.stepBefore.step===!1?Q=!1:Q=G-j.stepBefore.highestStep,P===100?J=null:P===0&&(Q=null);var ae=h.countStepDecimals();return J!==null&&J!==!1&&(J=Number(J.toFixed(ae))),Q!==null&&Q!==!1&&(Q=Number(Q.toFixed(ae))),[Q,J]}function Qv(){return p.map(lc)}function Zv(N,P){var j=oc(),G=["margin","limit","padding","range","animate","snap","step","format","pips","tooltips","connect"];G.forEach(function(Q){N[Q]!==void 0&&(n[Q]=N[Q])});var J=Xa(n);G.forEach(function(Q){N[Q]!==void 0&&(e[Q]=J[Q])}),h=J.spectrum,e.margin=J.margin,e.limit=J.limit,e.padding=J.padding,e.pips?Ee(e.pips):ce(),e.tooltips?F():U(),g=[],Xi(os(N.start)?N.start:j,P),N.connect&&ac()}function ac(){for(;a.firstChild;)a.removeChild(a.firstChild);for(var N=0;N<=e.handles;N++)u[N]=O(a,e.connect[N]),mt(N);dt({drag:e.events.drag,fixed:!0})}function ey(){I=!I,Ga(e,e.connect.map(function(N){return!N})),ac()}function ty(){l=q(o),D(e.connect,l),dt(e.events),Xi(e.start),e.pips&&Ee(e.pips),e.tooltips&&F(),Y()}ty();var Ji={destroy:Jv,steps:Qv,on:Ot,off:un,get:oc,set:Xi,setHandle:Xv,reset:Yv,disable:A,enable:H,__moveHandles:function(N,P,j){re(N,P,g,j)},options:n,updateOptions:Zv,target:o,removePips:ce,removeTooltips:U,getPositions:function(){return g.slice()},getTooltips:function(){return f},getOrigins:function(){return c},pips:Ee};return Ji}function rv(t,e){if(!t||!t.nodeName)throw new Error("noUiSlider: create requires a single element, got: "+t);if(t.noUiSlider)throw new Error("noUiSlider: Slider was already initialized.");var n=Xa(e),i=iv(t,n,e);return t.noUiSlider=i,i}const sv={__spectrum:qa,cssClasses:Wa,create:rv},$y="",zy="";function ov(t){let e,n,i,r,s,o,l,a,c,u,d,f,h,m,g,p;return{c(){e=S("div"),n=S("span"),i=te(t[2]),r=te(" ("),s=te(t[3]),o=te(")"),l=B(),a=S("div"),c=S("span"),u=te(t[0]),d=B(),f=S("div"),h=S("div"),m=B(),g=S("span"),p=te(t[1]),v(c,"class","range-marker svelte-216mtn"),v(h,"class","slider"),v(h,"id",t[4]),v(f,"class","slider-wrapper svelte-216mtn"),v(g,"class","range-marker svelte-216mtn"),v(a,"class","slider-outer-wrapper is-flex flex-direction-row svelte-216mtn")},m(_,w){z(_,e,w),y(e,n),y(n,i),y(n,r),y(n,s),y(n,o),y(e,l),y(e,a),y(a,c),y(c,u),y(a,d),y(a,f),y(f,h),y(a,m),y(a,g),y(g,p)},p(_,[w]){w&4&&pe(i,_[2]),w&8&&pe(s,_[3]),w&1&&pe(u,_[0]),w&2&&pe(p,_[1])},i:X,o:X,d(_){_&&$(e)}}}function lv(t,e,n){let i,{minVal:r}=e,{maxVal:s}=e,{start:o}=e,{step:l=void 0}=e,{roundTo:a=2}=e,{title:c=""}=e,{emitOnUpdate:u=!1}=e;const d=fi(),f=`slider-${window.crypto.randomUUID()}`,h=Array.isArray(o)&&o.length===2&&o.every(k=>!isNaN(parseFloat(k))),m=[],g=h?[`noUi-handle-${window.crypto.randomUUID()}`,`noUi-handle-${window.crypto.randomUUID()}`]:[`noUi-handle-${window.crypto.randomUUID()}`],p=di();p.setCompareFn(h?fr:(k,x)=>w(k)===w(x)),p.set(o);const _=gt("resetTrigger")||void 0;_==null||_.subscribe(E);const w=k=>Number(k.toFixed(a)),I=(k,x)=>{k=Array.isArray(k)?k.map(w):w(k),n(3,i=k),(x==="set"||x==="update"&&u)&&(p.set(k),p.same()||d("updateSlider",p.get()))};function b(k){m.length&&m.map((x,O)=>x.$set({tooltipText:h?k[O]:k}))}function E(){const k=document.getElementById(f);k!=null&&k.noUiSlider&&k.noUiSlider.reset()}function T(){const k=document.getElementById(f);let x;sv.create(k,{start:o,step:l,connect:h?!0:"lower",range:{min:r,max:s},handleAttributes:g.map(O=>({id:O}))}),k.noUiSlider.on("update",()=>{x=k.noUiSlider.get(!0),I(x,"update")}),k.noUiSlider.on("set",()=>{x=k.noUiSlider.get(!0),I(x,"set")})}function M(){g.map((k,x)=>{m.push(new Vi({target:document.getElementById(k),props:h?{tooltipText:i[x]}:{tooltipText:i}}))})}return Ln(()=>{T(),M()}),Dn(()=>{document.getElementById(f)&&(document.getElementById(f).innerHTML="")}),t.$$set=k=>{"minVal"in k&&n(0,r=k.minVal),"maxVal"in k&&n(1,s=k.maxVal),"start"in k&&n(5,o=k.start),"step"in k&&n(6,l=k.step),"roundTo"in k&&n(7,a=k.roundTo),"title"in k&&n(2,c=k.title),"emitOnUpdate"in k&&n(8,u=k.emitOnUpdate)},t.$$.update=()=>{t.$$.dirty&32&&n(3,i=o),t.$$.dirty&8&&b(i)},[r,s,c,i,f,o,l,a,u]}class ti extends ve{constructor(e){super(),_e(this,e,lv,ov,me,{minVal:0,maxVal:1,start:5,step:6,roundTo:7,title:2,emitOnUpdate:8})}}const jy="";function av(t){let e,n,i,r,s,o,l,a,c,u,d,f,h,m,g,p,_,w,I,b,E,T,M,k,x,O,D,q,R,C,L,A,H,U,F,Y,Z,ne,fe;return c=new ti({props:{minVal:0,maxVal:1,start:t[5],emitOnUpdate:!0,title:W==="fr"?"Opacité":"Opacity"}}),c.$on("updateSlider",t[9]),f=new ti({props:{minVal:0,maxVal:360,start:t[6],step:1,emitOnUpdate:!0,title:"Rotation"}}),f.$on("updateSlider",t[10]),g=new ti({props:{minVal:0,maxVal:200,step:1,start:t[7],emitOnUpdate:!0,title:W==="fr"?"Redimensionner":"Scale"}}),g.$on("updateSlider",t[11]),w=new ti({props:{minVal:-100,maxVal:100,step:1,start:t[8][0],emitOnUpdate:!0,title:W==="fr"?"Translation horizontale":"Horizontal translate"}}),w.$on("updateSlider",t[12]),E=new ti({props:{minVal:-100,maxVal:100,step:1,start:t[8][1],emitOnUpdate:!0,title:W==="fr"?"Translation verticale":"Vertical translate"}}),E.$on("updateSlider",t[13]),k=new b1({props:{choicesItems:t[4],start:[],lightDisplay:!0,placeholder:W==="fr"?"Sélectionner":"Select",title:W==="fr"?"Basculer":"Flip"}}),k.$on("updateValues",t[14]),{c(){e=S("div"),n=S("div"),i=S("div"),r=S("div"),s=S("strong"),s.textContent=`${W==="en"?"Query image transformation":"Modification de l'image requête"}`,o=B(),l=S("div"),a=S("div"),le(c.$$.fragment),u=B(),d=S("div"),le(f.$$.fragment),h=B(),m=S("div"),le(g.$$.fragment),p=B(),_=S("div"),le(w.$$.fragment),I=B(),b=S("div"),le(E.$$.fragment),T=B(),M=S("div"),le(k.$$.fragment),x=B(),O=S("div"),D=S("button"),D.textContent=`${W==="fr"?"Réinitialiser":"Reset"}`,q=B(),R=S("div"),C=S("img"),H=B(),U=S("img"),v(r,"class","toolbar-title mt-0 mb-2 svelte-nzei31"),v(a,"class"," svelte-nzei31"),v(d,"class"," svelte-nzei31"),v(m,"class"," svelte-nzei31"),v(_,"class"," svelte-nzei31"),v(b,"class"," svelte-nzei31"),v(M,"class"," svelte-nzei31"),v(D,"class","button is-link"),v(O,"class","mt-2 is-flex is-flex-direction-column is-justify-content-center is-align-items-flex-end svelte-nzei31"),v(l,"class","toolbar-controls is-flex is-flex-direction-column is-align-items-start is-justify-content-center svelte-nzei31"),v(i,"class","toolbar svelte-nzei31"),v(n,"class","toolbar-wrapper is-flex is-flex-direction-column is-justify-content-center is-align-items-center svelte-nzei31"),v(C,"class","compare-img svelte-nzei31"),pt(C.src,L=t[0].queryImage.href)||v(C,"src",L),v(C,"alt",A=t[0].queryImage.title),v(U,"class","main-img svelte-nzei31"),pt(U.src,F=t[0].similarityImage.href)||v(U,"src",F),v(U,"alt",Y=t[0].similarityImage.title),Ce(U,"overlay-reset",t[2]),De(U,"opacity",t[1]),De(U,"transform",t[3]),v(R,"class","overlay-wrapper svelte-nzei31"),v(e,"class","similarity-overlay-wrapper svelte-nzei31")},m(ee,ce){z(ee,e,ce),y(e,n),y(n,i),y(i,r),y(r,s),y(i,o),y(i,l),y(l,a),se(c,a,null),y(l,u),y(l,d),se(f,d,null),y(l,h),y(l,m),se(g,m,null),y(l,p),y(l,_),se(w,_,null),y(l,I),y(l,b),se(E,b,null),y(l,T),y(l,M),se(k,M,null),y(l,x),y(l,O),y(O,D),y(e,q),y(e,R),y(R,C),y(R,H),y(R,U),Z=!0,ne||(fe=be(D,"click",t[15]),ne=!0)},p(ee,[ce]){(!Z||ce&1&&!pt(C.src,L=ee[0].queryImage.href))&&v(C,"src",L),(!Z||ce&1&&A!==(A=ee[0].queryImage.title))&&v(C,"alt",A),(!Z||ce&1&&!pt(U.src,F=ee[0].similarityImage.href))&&v(U,"src",F),(!Z||ce&1&&Y!==(Y=ee[0].similarityImage.title))&&v(U,"alt",Y),(!Z||ce&4)&&Ce(U,"overlay-reset",ee[2]),ce&2&&De(U,"opacity",ee[1]),ce&8&&De(U,"transform",ee[3])},i(ee){Z||(V(c.$$.fragment,ee),V(f.$$.fragment,ee),V(g.$$.fragment,ee),V(w.$$.fragment,ee),V(E.$$.fragment,ee),V(k.$$.fragment,ee),Z=!0)},o(ee){K(c.$$.fragment,ee),K(f.$$.fragment,ee),K(g.$$.fragment,ee),K(w.$$.fragment,ee),K(E.$$.fragment,ee),K(k.$$.fragment,ee),Z=!1},d(ee){ee&&$(e),oe(c),oe(f),oe(g),oe(w),oe(E),oe(k),ne=!1,fe()}}}function cv(t,e,n){let i,{imgData:r}=e;const s=[{value:"h",label:W==="fr"?"Basculer horizontalement":"Flip horizontally"},{value:"v",label:W==="fr"?"Basculer verticalement":"Flip vertically"},{value:"hv",label:W==="fr"?"Basculer horizontalement et verticalement":"Flip horizontally and vertically"}];let o=.5;const l=o;let a=0;const c=a;let u=100;const d=u;let f=[1,1];const h=structuredClone(f);let m=[0,0];const g=structuredClone(m);let p=!1;const _=we(window.crypto.randomUUID());mn("resetTrigger",_);const w=x=>n(1,o=x.detail),I=x=>n(16,a=x.detail),b=x=>n(17,u=x.detail),E=x=>n(19,m=[x.detail,m[1]]),T=x=>n(19,m=[m[0],x.detail]),M=x=>{let O=x.detail[0];n(18,f=O==="hv"?[-1,-1]:O==="h"?[-1,1]:O==="v"?[1,-1]:[1,1])},k=()=>{n(1,o=l),n(16,a=c),n(17,u=d),n(18,f=h),n(19,m=g),_.set(window.crypto.randomUUID()),n(2,p=!0),setTimeout(()=>n(2,p=!1),1e3)};return t.$$set=x=>{"imgData"in x&&n(0,r=x.imgData)},t.$$.update=()=>{t.$$.dirty&983040&&n(3,i=`translate(${m[0]-50}%, ${m[1]}%)
                        rotate(${a}deg)
                        scale(${f.map(x=>x*(u/100)).join()})`)},[r,o,p,i,s,l,c,d,g,w,I,b,E,T,M,k,a,u,f,m]}class uv extends ve{constructor(e){super(),_e(this,e,cv,av,me,{imgData:0})}}function fv(){const t=`${window.location.origin}${window.location.pathname}`,e=25,n=window.location.pathname.match(/\d+/g).join("-"),i={[n]:{}},r=[2,6],s=we(1),o=we({}),l=we(JSON.parse(localStorage.getItem("selectedRegions"))||i);l.subscribe(q=>localStorage.setItem("selectedRegions",JSON.stringify(q)));const a=we(JSON.parse(localStorage.getItem("excludedCategories"))||[]);a.subscribe(q=>localStorage.setItem("excludedCategories",JSON.stringify(q)));const c=we(JSON.parse(localStorage.getItem("similarityScoreCutoff"))||void 0);c.subscribe(q=>{q!=null&&localStorage.setItem("similarityScoreCutoff",JSON.stringify(q))});const u=we(JSON.parse(localStorage.getItem("propagateRecursionDepth"))||r[1]);u.subscribe(q=>localStorage.setItem("propagateRecursionDepth",JSON.stringify(q)));const d=we(JSON.parse(localStorage.getItem("propagateFilterByRegions"))||!1);d.subscribe(q=>localStorage.setItem("propagateFilterByRegions",JSON.stringify(q)));const f=Be([u,d],([q,R])=>({propagateRecursionDepth:q,propagateFilterByRegions:R})),h=Be([a,l,c],([q,R,C])=>({excludedCategories:q,regions:R,similarityScoreCutoff:C})),m=Be([f,h],([q,R])=>({propagate:q,similarity:R})),g=we([]),p=we([]);async function _(){const q=async()=>{const L=await(await fetch(`${t}compared-regions`)).json();o.set(L),l.update(A=>{let H=A[n]||{};if(Object.keys(H).length){let U=Object.keys(H).filter(F=>Object.keys(L).includes(F)).reduce((F,Y)=>(F[Y]=H[Y],F),{});A[n]=U}return A})},R=async()=>{const L=await(await fetch(`${t}query-images`)).json();L.length>0&&(g.set(L),O(M()))};$n.set(!0);try{await Promise.all([q(),R()])}catch(C){console.error("Error:",C),zc.set(C.message)}finally{$n.set(!1)}}function w(q){localStorage.setItem("selectedRegions",JSON.stringify(q))}function I(q){l.update(R=>{const C={...R};return delete C[n][q],w(C),C})}function b(q){l.update(R=>{const C={...R,[n]:{...R[n]||{},[q.ref]:q}};return w(C),C})}const E=Be(l,q=>R=>{var C;return(C=q[n])==null?void 0:C.hasOwnProperty(R)});function T(q){const R=tt(o),C=Object.keys(R).filter(L=>L.startsWith(q));return C.length!==1?{title:"Error"}:R[C[0]]}const M=()=>cr(s,"sp"),k=Be([s,g],([q,R])=>(async()=>x(q,R))());function x(q,R){const C=(q-1)*e,L=C+e,A=R.slice(C,L);return p.set(A),A}function O(q){ur(q,s,"sp")}function D(q){o.update(R=>({...R,[q.ref]:q}))}return{currentPage:s,comparedRegions:o,excludedCategories:a,qImgs:g,pageQImgs:p,selectedRegions:l,propagateRecursionDepth:u,propagateFilterByRegions:d,similarityToolbarParams:m,propagateParams:f,similarityScoreCutoff:c,allowedPropagateDepthRange:r,fetchSimilarity:_,setPageQImgs:k,getRegionsInfo:T,handlePageUpdate:O,unselect:I,select:b,addComparedRegions:D,isSelected:E,pageLength:e}}const Gt=fv(),{getRegionsInfo:hv}=Gt;async function Ja(t,e,n,i,r,s,o=!1,l=!0){const a=()=>l?`<b>${!isNaN(parseFloat(n))&&e===1?`Score: ${n}`:e===2&&W==="en"?"Manual similarity":e===2&&W==="fr"?"Correspondance manuelle":e===3&&W==="en"?"Propagated match":"Correspondance propagée"}</b>`:"",c=u=>`${u}<br>
        Page ${parseInt(i)}<br>
        ${a()}`;return o===!0?fetch(`${r}${s}get_regions_title/${t}`).then(u=>u.json()).then(u=>c(u.title)).catch(u=>(console.error("similarity.utils.getDesc()",u),c(W==="fr"?"Titre inconnu":"Unknown title"))):Promise.resolve(c(hv(t).title))}function Qa(t,e,n){const i=t.slice();return i[16]=e[n],i}function Za(t){let e,n,i=t[16]==="queryImage"&&W==="fr"?"Image requête":t[16]==="similarityImage"&&W==="fr"?"Similarité":t[16]==="queryImage"&&W==="en"?"Query image":"Similarity",r,s,o,l,a;return o=new xn({props:{item:t[0][t[16]],descPromise:t[1][t[16]],height:"full"}}),{c(){e=S("div"),n=S("span"),r=te(i),s=B(),le(o.$$.fragment),l=B(),v(e,"class","img-legend-wrapper column is-flex is-flex-direction-column is-justify-content-center is-align-items-center")},m(c,u){z(c,e,u),y(e,n),y(n,r),y(e,s),se(o,e,null),y(e,l),a=!0},p(c,u){const d={};u&1&&(d.item=c[0][c[16]]),o.$set(d)},i(c){a||(V(o.$$.fragment,c),a=!0)},o(c){K(o.$$.fragment,c),a=!1},d(c){c&&$(e),oe(o)}}}function dv(t){let e,n,i=["queryImage","similarityImage"],r=[];for(let o=0;o<2;o+=1)r[o]=Za(Qa(t,i,o));const s=o=>K(r[o],1,1,()=>{r[o]=null});return{c(){e=S("div");for(let o=0;o<2;o+=1)r[o].c();v(e,"class","side-by-side columns")},m(o,l){z(o,e,l);for(let a=0;a<2;a+=1)r[a]&&r[a].m(e,null);n=!0},p(o,[l]){if(l&3){i=["queryImage","similarityImage"];let a;for(a=0;a<2;a+=1){const c=Qa(o,i,a);r[a]?(r[a].p(c,l),V(r[a],1)):(r[a]=Za(c),r[a].c(),V(r[a],1),r[a].m(e,null))}for(Se(),a=2;a<2;a+=1)s(a);ke()}},i(o){if(!n){for(let l=0;l<2;l+=1)V(r[l]);n=!0}},o(o){r=r.filter(Boolean);for(let l=0;l<2;l+=1)K(r[l]);n=!1},d(o){o&&$(e),nt(r,o)}}}function mv(t,e,n){let{imgData:i}=e;const r=gt("similarityPair"),s=new URL(window.location.href),o=s.origin,l=s.pathname,[a,c,u,d]=r.qImg.split(".")[0].split("_"),[f,h,m,g]=r.sImg.split(".")[0].split("_"),p=`${a}_${c}`,_=`${f}_${h}`,w={queryImage:Ja(p,r.similarityType,r.score,u,o,l,!0,!1),similarityImage:Ja(_,r.similarityType,r.score,m,o,l,!0,!0)};return t.$$set=I=>{"imgData"in I&&n(0,i=I.imgData)},[i,w]}class pv extends ve{constructor(e){super(),_e(this,e,mv,dv,me,{imgData:0})}}const Fy="";function gv(t){let e,n;return e=new pv({props:{imgData:t[2]}}),{c(){le(e.$$.fragment)},m(i,r){se(e,i,r),n=!0},p:X,i(i){n||(V(e.$$.fragment,i),n=!0)},o(i){K(e.$$.fragment,i),n=!1},d(i){oe(e,i)}}}function _v(t){let e,n;return e=new uv({props:{imgData:t[1]}}),{c(){le(e.$$.fragment)},m(i,r){se(e,i,r),n=!0},p:X,i(i){n||(V(e.$$.fragment,i),n=!0)},o(i){K(e.$$.fragment,i),n=!1},d(i){oe(e,i)}}}function vv(t){let e,n,i,r,s,o,l,a,c;const u=[_v,gv],d=[];function f(h,m){return h[0]?0:1}return i=f(t),r=d[i]=u[i](t),a=new H_({props:{start:!1,buttonDisplay:!0,toggleLabel:W==="en"?"Overlay view":"Vue superposée"}}),a.$on("updateChecked",t[3]),{c(){e=S("div"),n=S("div"),r.c(),o=B(),l=S("div"),le(a.$$.fragment),v(n,"class",s="modal-similarity-images "+(t[0]?"overlay-wrapper":"side-by-side-wrapper")+" svelte-1qvtan5"),v(e,"class","modal-similarity svelte-1qvtan5")},m(h,m){z(h,e,m),y(e,n),d[i].m(n,null),y(e,o),y(e,l),se(a,l,null),c=!0},p(h,[m]){let g=i;i=f(h),i===g?d[i].p(h,m):(Se(),K(d[g],1,1,()=>{d[g]=null}),ke(),r=d[i],r?r.p(h,m):(r=d[i]=u[i](h),r.c()),V(r,1),r.m(n,null)),(!c||m&1&&s!==(s="modal-similarity-images "+(h[0]?"overlay-wrapper":"side-by-side-wrapper")+" svelte-1qvtan5"))&&v(n,"class",s)},i(h){c||(V(r),V(a.$$.fragment,h),c=!0)},o(h){K(r),K(a.$$.fragment,h),c=!1},d(h){h&&$(e),d[i].d(),oe(a)}}}function yv(t,e,n){let{mainImgItem:i}=e,{compareImgItem:r}=e;const s={similarityImage:{href:Pt(i.img,i.img.split("_").pop()),title:a(i.title)},queryImage:{href:Pt(r.img,r.img.split("_").pop()),title:a(r.title)}},o={similarityImage:i,queryImage:r};let l=!1;function a(u){return W==="fr"?`Vue principale de la région ${u}`:`Main view of region ${u}`}const c=()=>n(0,l=!l);return t.$$set=u=>{"mainImgItem"in u&&n(4,i=u.mainImgItem),"compareImgItem"in u&&n(5,r=u.compareImgItem)},[l,s,o,c,i,r]}class bv extends ve{constructor(e){super(),_e(this,e,yv,vv,me,{mainImgItem:4,compareImgItem:5})}}const wv=Object.freeze(Object.defineProperty({__proto__:null,default:bv},Symbol.toStringTag,{value:"Module"})),ec=(t,e,n,i)=>({id:t,img:t,title:`Canvas ${i} - ${n} - ${W==="en"?"Witness":"Témoin"} #${lr(e)}`,xywh:n.split(",").map(Number),canvas:i,ref:t.replace(".jpg",""),type:Pc});function Sv(t){let e,n,i,r,s,o,l,a,c,u,d;return n=new wn({props:{category:1,isSelected:t[0]===1,toggle:t[4],padding:"pl-3 pr-2"}}),r=new wn({props:{category:2,isSelected:t[0]===2,toggle:t[4]}}),o=new wn({props:{category:3,isSelected:t[0]===3,toggle:t[4]}}),a=new wn({props:{category:4,isSelected:t[0]===4,toggle:t[4]}}),u=new wn({props:{category:5,isSelected:t[0]===5,toggle:t[4],padding:"pl-2 pr-3"}}),{c(){e=S("div"),le(n.$$.fragment),i=B(),le(r.$$.fragment),s=B(),le(o.$$.fragment),l=B(),le(a.$$.fragment),c=B(),le(u.$$.fragment),v(e,"class","tags has-addons is-dark is-center")},m(f,h){z(f,e,h),se(n,e,null),y(e,i),se(r,e,null),y(e,s),se(o,e,null),y(e,l),se(a,e,null),y(e,c),se(u,e,null),d=!0},p(f,h){const m={};h&1&&(m.isSelected=f[0]===1),n.$set(m);const g={};h&1&&(g.isSelected=f[0]===2),r.$set(g);const p={};h&1&&(p.isSelected=f[0]===3),o.$set(p);const _={};h&1&&(_.isSelected=f[0]===4),a.$set(_);const w={};h&1&&(w.isSelected=f[0]===5),u.$set(w)},i(f){d||(V(n.$$.fragment,f),V(r.$$.fragment,f),V(o.$$.fragment,f),V(a.$$.fragment,f),V(u.$$.fragment,f),d=!0)},o(f){K(n.$$.fragment,f),K(r.$$.fragment,f),K(o.$$.fragment,f),K(a.$$.fragment,f),K(u.$$.fragment,f),d=!1},d(f){f&&$(e),oe(n),oe(r),oe(o),oe(a),oe(u)}}}function kv(t){let e,n,i,r;n=new xn({props:{item:t[3],size:256,selectable:!1,isSquare:!1}});let s=!t[2]&&Sv(t);return{c(){e=S("div"),le(n.$$.fragment),i=B(),s&&s.c()},m(o,l){z(o,e,l),se(n,e,null),y(e,i),s&&s.m(e,null),r=!0},p(o,[l]){o[2]||s.p(o,l)},i(o){r||(V(n.$$.fragment,o),V(s),r=!0)},o(o){K(n.$$.fragment,o),K(s),r=!1},d(o){o&&$(e),oe(n),s&&s.d()}}}function Ev(t,e,n){let i,r,s;const{comparedRegions:o}=Gt;ge(t,o,R=>n(15,s=R));const l=new URL(window.location.href),a=l.origin;l.pathname;let{qImg:c}=e,{sImg:u}=e,{qRegions:d}=e,{sRegions:f}=e,{score:h=0}=e,{category:m=null}=e,{users:g=[]}=e,{isManual:p}=e,{similarityType:_}=e;const w=gt("isInModal")||!1,[I,b,E,T]=u.split(".")[0].split("_"),k=(()=>{let R=ec(u,I,T,E);const C=s[`${I}_${b}_anno${f}`]||{title:R.title};return R.title=`${ar(C.title.replace(/^[^|]+/,""))}<br/>Page ${Fc(E)}<br/><b>Score: ${h}</b>`,R})();mn("similarityPair",{qImg:c,sImg:u,qRegions:d,sRegions:f,score:h,category:m,users:g,isManual:p,similarityType:_});function x(R){R=R.slice();let C=R.indexOf(Number(or));return r&&C===-1?R.push(Number(or)):!r&&C!==-1&&R.splice(C,1),R}const O=()=>({img_1:c,img_2:u,regions_id_1:d,regions_id_2:f,score:h,category:i,category_x:x(g),similarity_type:_});function D(R){R===5?r=!r:n(0,i=i===R?null:R)}async function q(R){D(R);try{(await fetch(`${a}/${Ct}/save-category`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":Xt},body:JSON.stringify(O())})).ok||(console.error("Error: Network response was not ok"),D(R))}catch(C){console.error("Error:",C),D(R)}}return t.$$set=R=>{"qImg"in R&&n(5,c=R.qImg),"sImg"in R&&n(6,u=R.sImg),"qRegions"in R&&n(7,d=R.qRegions),"sRegions"in R&&n(8,f=R.sRegions),"score"in R&&n(9,h=R.score),"category"in R&&n(10,m=R.category),"users"in R&&n(11,g=R.users),"isManual"in R&&n(12,p=R.isManual),"similarityType"in R&&n(13,_=R.similarityType)},t.$$.update=()=>{t.$$.dirty&1024&&n(0,i=m),t.$$.dirty&2048&&(r=g.includes(Number(or))||!1)},[i,o,w,k,q,c,u,d,f,h,m,g,p,_]}class Cv extends ve{constructor(e){super(),_e(this,e,Ev,kv,me,{qImg:5,sImg:6,qRegions:7,sRegions:8,score:9,category:10,users:11,isManual:12,similarityType:13})}}function tc(t,e,n){const i=t.slice();return i[22]=e[n].uuid,i[23]=e[n].data[0],i[24]=e[n].data[1],i[25]=e[n].data[2],i[26]=e[n].data[3],i[27]=e[n].data[4],i[28]=e[n].data[5],i[29]=e[n].data[6],i[30]=e[n].data[7],i[31]=e[n].data[8],i}function Iv(t){let e,n=W==="en"?`Error when retrieving similar regions: ${t[2]}`:`Erreur de recupération des régions similaires: ${t[2]}`,i;return{c(){e=S("div"),i=te(n),v(e,"class","faded is-center")},m(r,s){z(r,e,s),y(e,i)},p(r,s){s[0]&4&&n!==(n=W==="en"?`Error when retrieving similar regions: ${r[2]}`:`Erreur de recupération des régions similaires: ${r[2]}`)&&pe(i,n)},i:X,o:X,d(r){r&&$(e)}}}function Mv(t){let e,n,i=t[4].length+"",r,s,o=t[11](t[10],t[4].length)+"",l,a,c,u=[],d=new Map,f,h=t[4];const m=p=>p[22];for(let p=0;p<h.length;p+=1){let _=tc(t,h,p),w=m(_);d.set(w,u[p]=ic(w,_))}let g=null;return h.length||(g=nc(t)),{c(){e=S("div"),n=S("span"),r=te(i),s=B(),l=te(o),a=B(),c=S("div");for(let p=0;p<u.length;p+=1)u[p].c();g&&g.c(),v(n,"class","m-2"),v(c,"class","m-2 is-gap-2"),Ce(c,"grid",t[4].length>0)},m(p,_){z(p,e,_),y(e,n),y(n,r),y(n,s),y(n,l),y(e,a),y(e,c);for(let w=0;w<u.length;w+=1)u[w]&&u[w].m(c,null);g&&g.m(c,null),f=!0},p(p,_){(!f||_[0]&16)&&i!==(i=p[4].length+"")&&pe(r,i),(!f||_[0]&16)&&o!==(o=p[11](p[10],p[4].length)+"")&&pe(l,o),_[0]&49&&(h=p[4],Se(),u=sr(u,_,m,1,p,h,d,c,rr,ic,null,tc),ke(),!h.length&&g?g.p(p,_):h.length?g&&(g.d(1),g=null):(g=nc(p),g.c(),g.m(c,null))),(!f||_[0]&16)&&Ce(c,"grid",p[4].length>0)},i(p){if(!f){for(let _=0;_<h.length;_+=1)V(u[_]);f=!0}},o(p){for(let _=0;_<u.length;_+=1)K(u[_]);f=!1},d(p){p&&$(e);for(let _=0;_<u.length;_+=1)u[_].d();g&&g.d()}}}function xv(t){let e;return{c(){e=S("div"),e.textContent=`${W==="en"&&!t[10]?"Retrieving similar regions...":W==="fr"&&!t[10]?"Récupération des régions similaires...":W==="en"&&t[10]?"Retrieving propagated regions...":"Récupération de similarités propagées..."}`,v(e,"class","faded is-center")},m(n,i){z(n,e,i)},p:X,i:X,o:X,d(n){n&&$(e)}}}function nc(t){let e;function n(s,o){return s[5]?Nv:Av}let i=n(t),r=i(t);return{c(){r.c(),e=Ke()},m(s,o){r.m(s,o),z(s,e,o)},p(s,o){i===(i=n(s))&&r?r.p(s,o):(r.d(1),r=i(s),r&&(r.c(),r.m(e.parentNode,e)))},d(s){r.d(s),s&&$(e)}}}function Av(t){let e;return{c(){e=S("div"),e.textContent=`${W==="en"?"No similar regions":"Pas de régions similaires"}
                    `,v(e,"class","faded is-center")},m(n,i){z(n,e,i)},p:X,d(n){n&&$(e)}}}function Nv(t){let e;return{c(){e=S("div"),e.textContent=`${W==="en"?"No document selected. Select one to display results.":"Aucun document sélectionné. Sélectionnez-en un pour afficher les résultats."}
                    `,v(e,"class","faded is-center")},m(n,i){z(n,e,i)},p:X,d(n){n&&$(e)}}}function ic(t,e){let n,i,r;return i=new Cv({props:{qImg:e[0],sImg:e[25],score:e[23],qRegions:e[26],sRegions:e[27],category:e[28],users:e[29],isManual:e[30],similarityType:e[31]}}),{key:t,first:null,c(){n=Ke(),le(i.$$.fragment),this.first=n},m(s,o){z(s,n,o),se(i,s,o),r=!0},p(s,o){e=s;const l={};o[0]&1&&(l.qImg=e[0]),o[0]&16&&(l.sImg=e[25]),o[0]&16&&(l.score=e[23]),o[0]&16&&(l.qRegions=e[26]),o[0]&16&&(l.sRegions=e[27]),o[0]&16&&(l.category=e[28]),o[0]&16&&(l.users=e[29]),o[0]&16&&(l.isManual=e[30]),o[0]&16&&(l.similarityType=e[31]),i.$set(l)},i(s){r||(V(i.$$.fragment,s),r=!0)},o(s){K(i.$$.fragment,s),r=!1},d(s){s&&$(n),oe(i,s)}}}function Tv(t){let e,n,i,r;const s=[xv,Mv,Iv],o=[];function l(a,c){return a[1]&&a[3]==="loading"?0:a[3]==="loaded"?1:a[3]==="error"?2:-1}return~(e=l(t))&&(n=o[e]=s[e](t)),{c(){n&&n.c(),i=Ke()},m(a,c){~e&&o[e].m(a,c),z(a,i,c),r=!0},p(a,c){let u=e;e=l(a),e===u?~e&&o[e].p(a,c):(n&&(Se(),K(o[u],1,1,()=>{o[u]=null}),ke()),~e?(n=o[e],n?n.p(a,c):(n=o[e]=s[e](a),n.c()),V(n,1),n.m(i.parentNode,i)):n=null)},i(a){r||(V(n),r=!0)},o(a){K(n),r=!1},d(a){~e&&o[e].d(a),a&&$(i)}}}function Ov(t,e,n){let i,r,s,o,l,a,c,u,{qImg:d}=e,{sImgsPromise:f}=e;const{selectedRegions:h,excludedCategories:m,similarityScoreCutoff:g,propagateFilterByRegions:p}=Gt;ge(t,h,x=>n(16,u=x)),ge(t,m,x=>n(15,c=x)),ge(t,g,x=>n(14,a=x)),ge(t,p,x=>n(13,l=x));const _=gt("similarityPropagatedContext")||!1,w=window.location.pathname.match(/\d+/g).join("-");let I;const b=(x,O)=>x===null||O===void 0||Number(x)>=O,E=(x,O,D)=>!D.includes(x),T=(x,O,D,q,R,C)=>_?!0:b(x,R)&&E(O,D,q),M=(x,O,D,q)=>x.filter(({uuid:R,data:[C,L,A,H,U,F,Y,Z,ne]})=>T(C,F,Y,O,D)),k=(x,O)=>{const D=O>1;return x?W==="fr"?D?"similarités propagées":"similarité propagée":D?"propagated matches":"propagated match":W==="fr"?D?"images similaires":"image similaire":D?"similar images":"similar image"};return t.$$set=x=>{"qImg"in x&&n(0,d=x.qImg),"sImgsPromise"in x&&n(1,f=x.sImgsPromise)},t.$$.update=()=>{t.$$.dirty[0]&65536&&n(5,i=Object.values(u).length===0||u[w]===void 0||!Object.keys(u[w]).length),t.$$.dirty[0]&2&&(x=>{n(3,r="loading"),n(4,o=[]),n(12,s=[])})(),t.$$.dirty[0]&2&&f.then(x=>{n(12,s=x.map(O=>({uuid:window.crypto.randomUUID(),data:O}))),n(3,r="loaded")}).catch(x=>{n(2,I=x),n(3,r="error")}),t.$$.dirty[0]&61440&&n(4,o=M(s,c,a))},n(3,r="loading"),n(12,s=[]),[d,f,I,r,o,i,h,m,g,p,_,k,s,l,a,c,u]}class rc extends ve{constructor(e){super(),_e(this,e,Ov,Tv,me,{qImg:0,sImgsPromise:1},null,[-1,-1])}}function Pv(t){let e,n;return e=new rc({props:{qImg:t[0],sImgsPromise:t[1]}}),{c(){le(e.$$.fragment)},m(i,r){se(e,i,r),n=!0},p(i,[r]){const s={};r&1&&(s.qImg=i[0]),r&2&&(s.sImgsPromise=i[1]),e.$set(s)},i(i){n||(V(e.$$.fragment,i),n=!0)},o(i){K(e.$$.fragment,i),n=!1},d(i){oe(e,i)}}}function Lv(t,e,n){let i,r,{qImg:s}=e,o;const l=gt("isInModal")||!1,{selectedRegions:a,comparedRegions:c}=Gt;ge(t,a,m=>n(4,i=m)),ge(t,c,m=>n(5,r=m));const u=`${window.location.origin}${window.location.pathname}`,d=window.location.pathname.match(/\d+/g).join("-"),f=(m,g)=>g?Object.keys(r).map(p=>r[p].id):Object.values(m[d]||{}).map(p=>p.id);async function h(m,g,p){const _=f(g,p);return _.length===0?[]:await(await fetch(`${u}similar-images`,{method:"POST",body:JSON.stringify({regionsIds:_,qImg:m,topk:12}),headers:{"Content-Type":"application/json","X-CSRFToken":Xt}})).json()}return l?o=h(s,i,l):a.subscribe(m=>{n(1,o=h(s,m,l))}),t.$$set=m=>{"qImg"in m&&n(0,s=m.qImg)},[s,o,a,c]}class Dv extends ve{constructor(e){super(),_e(this,e,Lv,Pv,me,{qImg:0})}}const Vy="";function Rv(t){let e,n,i,r;return i=new rc({props:{qImg:t[0],sImgsPromise:t[1]}}),{c(){e=S("div"),n=S("div"),le(i.$$.fragment),v(n,"class","matches-suggestion svelte-1cb4wg0"),v(e,"class","block matches-suggestion-wrapper svelte-1cb4wg0")},m(s,o){z(s,e,o),y(e,n),se(i,n,null),r=!0},p(s,[o]){const l={};o&1&&(l.qImg=s[0]),o&2&&(l.sImgsPromise=s[1]),i.$set(l)},i(s){r||(V(i.$$.fragment,s),r=!0)},o(s){K(i.$$.fragment,s),r=!1},d(s){s&&$(e),oe(i)}}}function $v(t,e,n){let i,r,{qImg:s}=e;const{propagateParams:o,selectedRegions:l}=Gt;ge(t,o,p=>n(4,i=p)),ge(t,l,p=>n(5,r=p));const a=`${window.location.origin}${window.location.pathname}`,c=window.location.pathname.match(/\d+/g).join("-"),u=gt("isInModal")||!1;let d;const f=di();f.setCompareFn((p,_)=>[p,_].every(w=>w&&w.hasOwnProperty("propagateRecursionDepth")&&w.hasOwnProperty("propagateFilterByRegions"))?p.propagateRecursionDepth===_.propagateRecursionDepth&&p.propagateFilterByRegions===_.propagateFilterByRegions:!1);const h=di();h.setCompareFn(fr),mn("similarityPropagatedContext",!0);const m=p=>Object.keys(p).includes(c)?Object.values(p[c]).map(_=>_.id):[],g=async(p,_,w)=>fetch(`${a}propagated-matches/${s}`,{method:"POST",body:JSON.stringify({regionsIds:w?[]:_,filterByRegions:w?!1:p.propagateFilterByRegions,recursionDepth:p.propagateRecursionDepth}),headers:{"Content-Type":"application/json","X-CSRFToken":Xt}}).then(I=>I.json()).catch(I=>(console.error("PropagatedMatches.getPropagatedMatches:",I),[]));return o.subscribe(p=>{f.set(p),f.same()||n(1,d=g(f.get(),m(r),u))}),l.subscribe(p=>{h.set(m(p)),i.propagateFilterByRegions===!0&&!h.same()&&n(1,d=g(i,h.get(),u))}),t.$$set=p=>{"qImg"in p&&n(0,s=p.qImg)},[s,d,o,l]}class zv extends ve{constructor(e){super(),_e(this,e,$v,Rv,me,{qImg:0})}}const Hy="";function jv(t){let e,n,i,r=parseInt(t[5])+"",s,o,l,a,c,u,d,f,h,m,g,p,_,w,I,b,E,T,M;return{c(){e=S("a"),n=S("i"),i=te(`
            Page `),s=te(r),o=B(),l=S("img"),c=B(),u=S("div"),d=S("div"),f=S("input"),h=B(),m=S("button"),m.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M256 80c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 144L48 224c-17.7 0-32 14.3-32 32s14.3 32 32 32l144 0 0 144c0 17.7 14.3 32 32 32s32-14.3 32-32l0-144 144 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-144 0 0-144z"></path></svg>',g=B(),p=S("button"),_=Et("svg"),w=Et("path"),v(n,"class","fa-solid fa-pen-to-square"),v(e,"class","tag px-2 py-1 mb-2 is-rounded is-hoverable"),v(e,"href",qc(t[6],parseInt(t[5]))),v(e,"target","_blank"),pt(l.src,a=Pt(t[0],t[0].split("_").pop(),"250,"))||v(l,"src",a),v(l,"alt","Query region"),v(l,"class","mb-3 card query-image svelte-f4ylwc"),v(f,"class","input is-small tag"),v(f,"type","text"),v(f,"placeholder",W==="en"?"Add new match":"Ajouter une correspondance"),v(m,"class","button is-small tag is-link is-center"),v(d,"class","tags has-addons"),De(d,"flex-wrap","nowrap"),v(w,"fill","white"),v(w,"d","M376.6 84.5c11.3-13.6 9.5-33.8-4.1-45.1s-33.8-9.5-45.1 4.1L192 206 56.6 43.5C45.3 29.9 25.1 28.1 11.5 39.4S-3.9 70.9 7.4 84.5L150.3 256 7.4 427.5c-11.3 13.6-9.5 33.8 4.1 45.1s33.8 9.5 45.1-4.1L192 306 327.4 468.5c11.3 13.6 31.5 15.4 45.1 4.1s15.4-31.5 4.1-45.1L233.7 256 376.6 84.5z"),v(_,"xmlns","http://www.w3.org/2000/svg"),v(_,"viewBox","0 0 384 512"),v(p,"id","no-match"),v(p,"class",I="button is-small tag is-danger is-center m-0 "+(t[3]===1?"visible":"")+" svelte-f4ylwc"),v(p,"title",W==="en"?"No match for this region in this witness":"Aucune correspondance de cette région pour ce témoin"),v(u,"class","new-similarity control pt-2 is-center svelte-f4ylwc")},m(k,x){z(k,e,x),y(e,n),y(e,i),y(e,s),z(k,o,x),z(k,l,x),z(k,c,x),z(k,u,x),y(u,d),y(d,f),li(f,t[1]),y(d,h),y(d,m),y(u,g),y(u,p),y(p,_),y(_,w),E=!0,T||(M=[be(f,"input",t[12]),be(m,"click",t[8]),be(p,"click",t[9])],T=!0)},p(k,x){(!E||x&1&&!pt(l.src,a=Pt(k[0],k[0].split("_").pop(),"250,")))&&v(l,"src",a),x&2&&f.value!==k[1]&&li(f,k[1]),(!E||x&8&&I!==(I="button is-small tag is-danger is-center m-0 "+(k[3]===1?"visible":"")+" svelte-f4ylwc"))&&v(p,"class",I)},i(k){E||(Vt(()=>{E&&(b||(b=Yt(p,bn,{duration:500},!0)),b.run(1))}),E=!0)},o(k){b||(b=Yt(p,bn,{duration:500},!1)),b.run(0),E=!1},d(k){k&&$(e),k&&$(o),k&&$(l),k&&$(c),k&&$(u),k&&b&&b.end(),T=!1,Ye(M)}}}function Fv(t){let e,n,i,r,s,o,l,a;return n=new Dv({props:{qImg:t[0]}}),o=new zv({props:{qImg:t[0]}}),{c(){e=S("div"),le(n.$$.fragment),r=B(),s=S("div"),le(o.$$.fragment),v(e,"class",i=si(t[7]?"":t[2])+" svelte-f4ylwc"),v(s,"class",l=si(t[7]?"":t[2])+" svelte-f4ylwc")},m(c,u){z(c,e,u),se(n,e,null),z(c,r,u),z(c,s,u),se(o,s,null),a=!0},p(c,u){const d={};u&1&&(d.qImg=c[0]),n.$set(d),(!a||u&4&&i!==(i=si(c[7]?"":c[2])+" svelte-f4ylwc"))&&v(e,"class",i);const f={};u&1&&(f.qImg=c[0]),o.$set(f),(!a||u&4&&l!==(l=si(c[7]?"":c[2])+" svelte-f4ylwc"))&&v(s,"class",l)},i(c){a||(V(n.$$.fragment,c),V(o.$$.fragment,c),a=!0)},o(c){K(n.$$.fragment,c),K(o.$$.fragment,c),a=!1},d(c){c&&$(e),oe(n),c&&$(r),c&&$(s),oe(o)}}}function Vv(t){let e,n;return e=new Ll({props:{useGrid:!1,$$slots:{"row-body":[Fv],"row-header":[jv]},$$scope:{ctx:t}}}),{c(){le(e.$$.fragment)},m(i,r){se(e,i,r),n=!0},p(i,[r]){const s={};r&1048591&&(s.$$scope={dirty:r,ctx:i}),e.$set(s)},i(i){n||(V(e.$$.fragment,i),n=!0)},o(i){K(e.$$.fragment,i),n=!1},d(i){oe(e,i)}}}function Hv(t){return t=t.replace(".jpg",""),/^wit\d+_[a-zA-Z]{3}\d+_\d+_\d+,\d+,\d+,\d+$/.test(t)}function Uv(t,e,n){let i,r,s,o;const{selectedRegions:l}=Gt;ge(t,l,T=>n(11,o=T));let{qImg:a}=e,c="";const[u,d,f,h]=a.split(".")[0].split("_"),m=`${window.location.origin}${window.location.pathname}`,g=window.location.pathname.match(/\d+/g).join("-"),p=W==="en"?"Error":"Erreur",_=gt("manifest"),w=gt("isInModal")||!1;mn("qImgMetadata",ec(a,u,h,f));async function I(){if(!c||!Hv(c)){await ct(W==="en"?"Please insert a valid region reference to add a new match":"Veuillez insérer une référence de région valide pour ajouter une nouvelle correspondance","Error");return}try{const T=await fetch(`${m}add-region-pair`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":Xt},body:JSON.stringify({q_img:a.replace(".jpg",""),s_img:c,similarity_type:2})});T.ok||(console.error("Error: Network response was not ok"),await ct(W==="en"?"Problem with network, match was not added":"Problème de réseau, la correspondance n'a pas été ajoutée",p));const M=await T.json();if(M.hasOwnProperty("error")||!M.hasOwnProperty("s_regions")){await ct(W==="en"?`Request was unsuccessful, match was not added:<br>${M.error}`:`La requête n'a pas abouti, la correspondance n'a pas été ajoutée :<br>${M.error}`,p);return}const k=M.s_regions;Gt.addComparedRegions(k),Gt.select(k)}catch(T){console.error("Error:",T),await ct(W==="en"?`An error has occurred, match was not added:<br>${T}`:`Une erreur s'est produite, la correspondance n'a pas été ajoutée :<br>${T}`,p)}}async function b(){const T=Object.values(o[g])[0];if(await ct(W==="en"?`Do you confirm this region does not have any match in ${T.title}?`:`Confirmez-vous que cette région n'a pas de correspondance dans ${T.title} ?`,W==="en"?"Confirm no match":"Confirmer l'absence de correspondance",!0))try{(await fetch(`${m}no-match`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":Xt},body:JSON.stringify({q_img:a,s_regions:T.id})})).ok||(console.error("Error: Network response was not ok"),await ct(W==="en"?"Problem with network":"Problème de réseau",p)),Gt.select(T)}catch(k){console.error("Error:",k),await ct(W==="en"?`An error has occurred, request was unsuccessful:<br>${k}`:`Une erreur s'est produite, la requête n'a pas abouti :<br>${k}`,p)}}function E(){c=this.value,n(1,c)}return t.$$set=T=>{"qImg"in T&&n(0,a=T.qImg)},t.$$.update=()=>{t.$$.dirty&2048&&n(3,i=o.hasOwnProperty(g)?Object.values(o[g]).length:0),t.$$.dirty&1024&&n(2,s=`fixed-grid has-${r-1}-cols`)},n(10,r=xs(window.innerWidth)),[a,c,s,i,l,f,_,w,I,b,r,o,E]}class Bv extends ve{constructor(e){super(),_e(this,e,Uv,Vv,me,{qImg:0})}}function qv(t){let e,n,i,r,s,o;return s=new Bv({props:{qImg:t[0].img}}),{c(){e=S("div"),n=S("a"),i=S("button"),i.textContent=`${W==="fr"?"Voir toutes les similarités pour ce document":"View all similarities for this document"}`,r=B(),le(s.$$.fragment),v(i,"class","button is-link is-small"),v(n,"href",t[1]()),v(e,"class","is-flex is-align-items-center is-justify-content-end")},m(l,a){z(l,e,a),y(e,n),y(n,i),z(l,r,a),se(s,l,a),o=!0},p(l,[a]){const c={};a&1&&(c.qImg=l[0].img),s.$set(c)},i(l){o||(V(s.$$.fragment,l),o=!0)},o(l){K(s.$$.fragment,l),o=!1},d(l){l&&$(e),l&&$(r),oe(s,l)}}}function Kv(t,e,n){let{mainImgItem:i}=e;function r(){const s=i.img.match(/wit(\d+)/)[1],o=new URL(window.location.origin);return o.pathname=`${new URL(window.location).pathname.split("/")[1]}/witness/${s}/regions/`,o.searchParams.set("tab","similarity"),o.href}return t.$$set=s=>{"mainImgItem"in s&&n(0,i=s.mainImgItem)},[i,r]}class Wv extends ve{constructor(e){super(),_e(this,e,Kv,qv,me,{mainImgItem:0})}}const Gv=Object.freeze(Object.defineProperty({__proto__:null,default:Wv},Symbol.toStringTag,{value:"Module"}))})();
//# sourceMappingURL=documentSet.js.map
