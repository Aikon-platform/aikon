import{S as ee,i as te,s as ie,M as X,l as _,N as pe,e as p,j as S,c as z,a as u,k as G,w as se,q as J,b as K,n as c,m as D,x as de,t as b,d as O,f as Z,g as k,O as ve,L as ye,P as _e,A as ue,B as fe,C as $e,Q as Ie,R as he,H as we,U as be,r as ne,o as ge}from"./region-list.js";function Oe(r){let e,a,i,t,d,n,s,l,o,m,y,I,v,g,h,M,C,q,j,B,R,A,L,U,$,P,Q,ae,N,V,H,W,re,w,Y,E,T,x,le;return o=new X({props:{minVal:0,maxVal:1,start:r[5],emitOnUpdate:!0,title:_==="fr"?"Opacité":"Opacity"}}),o.$on("updateSlider",r[9]),I=new X({props:{minVal:0,maxVal:360,start:r[6],step:1,emitOnUpdate:!0,title:"Rotation"}}),I.$on("updateSlider",r[10]),h=new X({props:{minVal:0,maxVal:200,step:1,start:r[7],emitOnUpdate:!0,title:_==="fr"?"Redimensionner":"Scale"}}),h.$on("updateSlider",r[11]),q=new X({props:{minVal:-100,maxVal:100,step:1,start:r[8][0],emitOnUpdate:!0,title:_==="fr"?"Translation horizontale":"Horizontal translate"}}),q.$on("updateSlider",r[12]),R=new X({props:{minVal:-100,maxVal:100,step:1,start:r[8][1],emitOnUpdate:!0,title:_==="fr"?"Translation verticale":"Vertical translate"}}),R.$on("updateSlider",r[13]),U=new pe({props:{choicesItems:r[4],start:[],lightDisplay:!0,placeholder:_==="fr"?"Sélectionner":"Select",title:_==="fr"?"Basculer":"Flip"}}),U.$on("updateValues",r[14]),{c(){e=p("div"),a=p("div"),i=p("div"),t=p("div"),d=p("strong"),d.textContent=`${_==="en"?"Query image transformation":"Modification de l'image requête"}`,n=S(),s=p("div"),l=p("div"),z(o.$$.fragment),m=S(),y=p("div"),z(I.$$.fragment),v=S(),g=p("div"),z(h.$$.fragment),M=S(),C=p("div"),z(q.$$.fragment),j=S(),B=p("div"),z(R.$$.fragment),A=S(),L=p("div"),z(U.$$.fragment),$=S(),P=p("div"),Q=p("button"),Q.textContent=`${_==="fr"?"Réinitialiser":"Reset"}`,ae=S(),N=p("div"),V=p("img"),re=S(),w=p("img"),u(t,"class","toolbar-title mt-0 mb-2 svelte-nzei31"),u(l,"class"," svelte-nzei31"),u(y,"class"," svelte-nzei31"),u(g,"class"," svelte-nzei31"),u(C,"class"," svelte-nzei31"),u(B,"class"," svelte-nzei31"),u(L,"class"," svelte-nzei31"),u(Q,"class","button is-link"),u(P,"class","mt-2 is-flex is-flex-direction-column is-justify-content-center is-align-items-flex-end svelte-nzei31"),u(s,"class","toolbar-controls is-flex is-flex-direction-column is-align-items-start is-justify-content-center svelte-nzei31"),u(i,"class","toolbar svelte-nzei31"),u(a,"class","toolbar-wrapper is-flex is-flex-direction-column is-justify-content-center is-align-items-center svelte-nzei31"),u(V,"class","compare-img svelte-nzei31"),G(V.src,H=r[0].queryImage.href)||u(V,"src",H),u(V,"alt",W=r[0].queryImage.title),u(w,"class","main-img svelte-nzei31"),G(w.src,Y=r[0].similarityImage.href)||u(w,"src",Y),u(w,"alt",E=r[0].similarityImage.title),se(w,"overlay-reset",r[2]),J(w,"opacity",r[1]),J(w,"transform",r[3]),u(N,"class","overlay-wrapper svelte-nzei31"),u(e,"class","similarity-overlay-wrapper svelte-nzei31")},m(f,F){K(f,e,F),c(e,a),c(a,i),c(i,t),c(t,d),c(i,n),c(i,s),c(s,l),D(o,l,null),c(s,m),c(s,y),D(I,y,null),c(s,v),c(s,g),D(h,g,null),c(s,M),c(s,C),D(q,C,null),c(s,j),c(s,B),D(R,B,null),c(s,A),c(s,L),D(U,L,null),c(s,$),c(s,P),c(P,Q),c(e,ae),c(e,N),c(N,V),c(N,re),c(N,w),T=!0,x||(le=de(Q,"click",r[15]),x=!0)},p(f,[F]){(!T||F&1&&!G(V.src,H=f[0].queryImage.href))&&u(V,"src",H),(!T||F&1&&W!==(W=f[0].queryImage.title))&&u(V,"alt",W),(!T||F&1&&!G(w.src,Y=f[0].similarityImage.href))&&u(w,"src",Y),(!T||F&1&&E!==(E=f[0].similarityImage.title))&&u(w,"alt",E),(!T||F&4)&&se(w,"overlay-reset",f[2]),F&2&&J(w,"opacity",f[1]),F&8&&J(w,"transform",f[3])},i(f){T||(b(o.$$.fragment,f),b(I.$$.fragment,f),b(h.$$.fragment,f),b(q.$$.fragment,f),b(R.$$.fragment,f),b(U.$$.fragment,f),T=!0)},o(f){O(o.$$.fragment,f),O(I.$$.fragment,f),O(h.$$.fragment,f),O(q.$$.fragment,f),O(R.$$.fragment,f),O(U.$$.fragment,f),T=!1},d(f){f&&Z(e),k(o),k(I),k(h),k(q),k(R),k(U),x=!1,le()}}}function Se(r,e,a){let i,{imgData:t}=e;const d=[{value:"h",label:_==="fr"?"Basculer horizontalement":"Flip horizontally"},{value:"v",label:_==="fr"?"Basculer verticalement":"Flip vertically"},{value:"hv",label:_==="fr"?"Basculer horizontalement et verticalement":"Flip horizontally and vertically"}];let n=.5;const s=n;let l=0;const o=l;let m=100;const y=m;let I=[1,1];const v=structuredClone(I);let g=[0,0];const h=structuredClone(g);let M=!1;const C=ve(window.crypto.randomUUID());ye("resetTrigger",C);const q=$=>a(1,n=$.detail),j=$=>a(16,l=$.detail),B=$=>a(17,m=$.detail),R=$=>a(19,g=[$.detail,g[1]]),A=$=>a(19,g=[g[0],$.detail]),L=$=>{let P=$.detail[0];a(18,I=P==="hv"?[-1,-1]:P==="h"?[-1,1]:P==="v"?[1,-1]:[1,1])},U=()=>{a(1,n=s),a(16,l=o),a(17,m=y),a(18,I=v),a(19,g=h),C.set(window.crypto.randomUUID()),a(2,M=!0),setTimeout(()=>a(2,M=!1),1e3)};return r.$$set=$=>{"imgData"in $&&a(0,t=$.imgData)},r.$$.update=()=>{r.$$.dirty&983040&&a(3,i=`translate(${g[0]-50}%, ${g[1]}%)
                        rotate(${l}deg)
                        scale(${I.map($=>$*(m/100)).join()})`)},[t,n,M,i,d,s,o,y,h,q,j,B,R,A,L,U,l,m,I,g]}class qe extends ee{constructor(e){super(),te(this,e,Se,Oe,ie,{imgData:0})}}const{getRegionsInfo:ze}=_e;async function oe(r,e,a,i,t,d,n=!1,s=!0){const l=()=>s?`<b>${!isNaN(parseFloat(a))&&e===1?`Score: ${a}`:e===2&&_==="en"?"Manual similarity":e===2&&_==="fr"?"Correspondance manuelle":e===3&&_==="en"?"Propagated match":"Correspondance propagée"}</b>`:"",o=m=>`${m}<br>
        Page ${parseInt(i)}<br>
        ${l()}`;return n===!0?fetch(`${t}${d}get_regions_title/${r}`).then(m=>m.json()).then(m=>o(m.title)).catch(m=>(console.error("similarity.utils.getDesc()",m),o(_==="fr"?"Titre inconnu":"Unknown title"))):Promise.resolve(o(ze(r).title))}function me(r,e,a){const i=r.slice();return i[16]=e[a],i}function ce(r){let e,a,i=r[16]==="queryImage"&&_==="fr"?"Image requête":r[16]==="similarityImage"&&_==="fr"?"Similarité":r[16]==="queryImage"&&_==="en"?"Query image":"Similarity",t,d,n,s,l;return n=new he({props:{item:r[0][r[16]],descPromise:r[1][r[16]],height:"full"}}),{c(){e=p("div"),a=p("span"),t=we(i),d=S(),z(n.$$.fragment),s=S(),u(e,"class","img-legend-wrapper column is-flex is-flex-direction-column is-justify-content-center is-align-items-center")},m(o,m){K(o,e,m),c(e,a),c(a,t),c(e,d),D(n,e,null),c(e,s),l=!0},p(o,m){const y={};m&1&&(y.item=o[0][o[16]]),n.$set(y)},i(o){l||(b(n.$$.fragment,o),l=!0)},o(o){O(n.$$.fragment,o),l=!1},d(o){o&&Z(e),k(n)}}}function De(r){let e,a,i=["queryImage","similarityImage"],t=[];for(let n=0;n<2;n+=1)t[n]=ce(me(r,i,n));const d=n=>O(t[n],1,1,()=>{t[n]=null});return{c(){e=p("div");for(let n=0;n<2;n+=1)t[n].c();u(e,"class","side-by-side columns")},m(n,s){K(n,e,s);for(let l=0;l<2;l+=1)t[l]&&t[l].m(e,null);a=!0},p(n,[s]){if(s&3){i=["queryImage","similarityImage"];let l;for(l=0;l<2;l+=1){const o=me(n,i,l);t[l]?(t[l].p(o,s),b(t[l],1)):(t[l]=ce(o),t[l].c(),b(t[l],1),t[l].m(e,null))}for(ue(),l=2;l<2;l+=1)d(l);fe()}},i(n){if(!a){for(let s=0;s<2;s+=1)b(t[s]);a=!0}},o(n){t=t.filter(Boolean);for(let s=0;s<2;s+=1)O(t[s]);a=!1},d(n){n&&Z(e),$e(t,n)}}}function ke(r,e,a){let{imgData:i}=e;const t=Ie("similarityPair"),d=new URL(window.location.href),n=d.origin,s=d.pathname,[l,o,m,y]=t.qImg.split(".")[0].split("_"),[I,v,g,h]=t.sImg.split(".")[0].split("_"),M=`${l}_${o}`,C=`${I}_${v}`,q={queryImage:oe(M,t.similarityType,t.score,m,n,s,!0,!1),similarityImage:oe(C,t.similarityType,t.score,g,n,s,!0,!0)};return r.$$set=j=>{"imgData"in j&&a(0,i=j.imgData)},[i,q]}class Ce extends ee{constructor(e){super(),te(this,e,ke,De,ie,{imgData:0})}}function Re(r){let e,a;return e=new Ce({props:{imgData:r[2]}}),{c(){z(e.$$.fragment)},m(i,t){D(e,i,t),a=!0},p:ge,i(i){a||(b(e.$$.fragment,i),a=!0)},o(i){O(e.$$.fragment,i),a=!1},d(i){k(e,i)}}}function Ue(r){let e,a;return e=new qe({props:{imgData:r[1]}}),{c(){z(e.$$.fragment)},m(i,t){D(e,i,t),a=!0},p:ge,i(i){a||(b(e.$$.fragment,i),a=!0)},o(i){O(e.$$.fragment,i),a=!1},d(i){k(e,i)}}}function Ve(r){let e,a,i,t,d,n,s,l,o;const m=[Ue,Re],y=[];function I(v,g){return v[0]?0:1}return i=I(r),t=y[i]=m[i](r),l=new be({props:{start:!1,buttonDisplay:!0,toggleLabel:_==="en"?"Overlay view":"Vue superposée"}}),l.$on("updateChecked",r[3]),{c(){e=p("div"),a=p("div"),t.c(),n=S(),s=p("div"),z(l.$$.fragment),u(a,"class",d="modal-similarity-images "+(r[0]?"overlay-wrapper":"side-by-side-wrapper")+" svelte-1qvtan5"),u(e,"class","modal-similarity svelte-1qvtan5")},m(v,g){K(v,e,g),c(e,a),y[i].m(a,null),c(e,n),c(e,s),D(l,s,null),o=!0},p(v,[g]){let h=i;i=I(v),i===h?y[i].p(v,g):(ue(),O(y[h],1,1,()=>{y[h]=null}),fe(),t=y[i],t?t.p(v,g):(t=y[i]=m[i](v),t.c()),b(t,1),t.m(a,null)),(!o||g&1&&d!==(d="modal-similarity-images "+(v[0]?"overlay-wrapper":"side-by-side-wrapper")+" svelte-1qvtan5"))&&u(a,"class",d)},i(v){o||(b(t),b(l.$$.fragment,v),o=!0)},o(v){O(t),O(l.$$.fragment,v),o=!1},d(v){v&&Z(e),y[i].d(),k(l)}}}function Te(r,e,a){let{mainImgItem:i}=e,{compareImgItem:t}=e;const d={similarityImage:{href:ne(i.img,i.img.split("_").pop()),title:l(i.title)},queryImage:{href:ne(t.img,t.img.split("_").pop()),title:l(t.title)}},n={similarityImage:i,queryImage:t};let s=!1;function l(m){return _==="fr"?`Vue principale de la région ${m}`:`Main view of region ${m}`}const o=()=>a(0,s=!s);return r.$$set=m=>{"mainImgItem"in m&&a(4,i=m.mainImgItem),"compareImgItem"in m&&a(5,t=m.compareImgItem)},[s,d,n,o,i,t]}class Me extends ee{constructor(e){super(),te(this,e,Te,Ve,ie,{mainImgItem:4,compareImgItem:5})}}export{Me as default};
//# sourceMappingURL=ModalSimilarity-8366d678.js.map
