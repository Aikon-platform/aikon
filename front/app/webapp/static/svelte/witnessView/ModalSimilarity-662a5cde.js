import{S as te,i as ie,s as le,N as A,l as I,O as de,e as d,j as S,c as k,a as u,k as K,w as ne,q as Z,b as Q,n as c,m as z,x as ve,t as w,d as O,f as W,g as D,P as ye,M as _e,Q as $e,A as fe,B as ge,C as Ie,U as he,R as be,I as pe,o as x,W as we,r as oe}from"./witness.js";function Oe(r){let t,l,i,e,v,o,s,a,m,n,g,_,y,p,h,M,C,q,j,B,R,H,L,U,$,P,X,re,N,V,Y,E,ae,b,G,J,T,ee,se;return m=new A({props:{minVal:0,maxVal:1,start:r[5],emitOnUpdate:!0,title:I==="fr"?"Opacité":"Opacity"}}),m.$on("updateSlider",r[9]),_=new A({props:{minVal:0,maxVal:360,start:r[6],step:1,emitOnUpdate:!0,title:"Rotation"}}),_.$on("updateSlider",r[10]),h=new A({props:{minVal:0,maxVal:200,step:1,start:r[7],emitOnUpdate:!0,title:I==="fr"?"Redimensionner":"Scale"}}),h.$on("updateSlider",r[11]),q=new A({props:{minVal:-100,maxVal:100,step:1,start:r[8][0],emitOnUpdate:!0,title:I==="fr"?"Translation horizontale":"Horizontal translate"}}),q.$on("updateSlider",r[12]),R=new A({props:{minVal:-100,maxVal:100,step:1,start:r[8][1],emitOnUpdate:!0,title:I==="fr"?"Translation verticale":"Vertical translate"}}),R.$on("updateSlider",r[13]),U=new de({props:{choicesItems:r[4],start:[],lightDisplay:!0,placeholder:I==="fr"?"Sélectionner":"Select",title:I==="fr"?"Basculer":"Flip"}}),U.$on("updateValues",r[14]),{c(){t=d("div"),l=d("div"),i=d("div"),e=d("div"),v=d("strong"),v.textContent=`${I==="en"?"Query image transformation":"Modification de l'image requête"}`,o=S(),s=d("div"),a=d("div"),k(m.$$.fragment),n=S(),g=d("div"),k(_.$$.fragment),y=S(),p=d("div"),k(h.$$.fragment),M=S(),C=d("div"),k(q.$$.fragment),j=S(),B=d("div"),k(R.$$.fragment),H=S(),L=d("div"),k(U.$$.fragment),$=S(),P=d("div"),X=d("button"),X.textContent=`${I==="fr"?"Réinitialiser":"Reset"}`,re=S(),N=d("div"),V=d("img"),ae=S(),b=d("img"),u(e,"class","toolbar-title mt-0 mb-2 svelte-nzei31"),u(a,"class"," svelte-nzei31"),u(g,"class"," svelte-nzei31"),u(p,"class"," svelte-nzei31"),u(C,"class"," svelte-nzei31"),u(B,"class"," svelte-nzei31"),u(L,"class"," svelte-nzei31"),u(X,"class","button is-link"),u(P,"class","mt-2 is-flex is-flex-direction-column is-justify-content-center is-align-items-flex-end svelte-nzei31"),u(s,"class","toolbar-controls is-flex is-flex-direction-column is-align-items-start is-justify-content-center svelte-nzei31"),u(i,"class","toolbar svelte-nzei31"),u(l,"class","toolbar-wrapper is-flex is-flex-direction-column is-justify-content-center is-align-items-center svelte-nzei31"),u(V,"class","compare-img svelte-nzei31"),K(V.src,Y=r[0].queryImage.href)||u(V,"src",Y),u(V,"alt",E=r[0].queryImage.title),u(b,"class","main-img svelte-nzei31"),K(b.src,G=r[0].similarityImage.href)||u(b,"src",G),u(b,"alt",J=r[0].similarityImage.title),ne(b,"overlay-reset",r[2]),Z(b,"opacity",r[1]),Z(b,"transform",r[3]),u(N,"class","overlay-wrapper svelte-nzei31"),u(t,"class","similarity-overlay-wrapper svelte-nzei31")},m(f,F){Q(f,t,F),c(t,l),c(l,i),c(i,e),c(e,v),c(i,o),c(i,s),c(s,a),z(m,a,null),c(s,n),c(s,g),z(_,g,null),c(s,y),c(s,p),z(h,p,null),c(s,M),c(s,C),z(q,C,null),c(s,j),c(s,B),z(R,B,null),c(s,H),c(s,L),z(U,L,null),c(s,$),c(s,P),c(P,X),c(t,re),c(t,N),c(N,V),c(N,ae),c(N,b),T=!0,ee||(se=ve(X,"click",r[15]),ee=!0)},p(f,[F]){(!T||F&1&&!K(V.src,Y=f[0].queryImage.href))&&u(V,"src",Y),(!T||F&1&&E!==(E=f[0].queryImage.title))&&u(V,"alt",E),(!T||F&1&&!K(b.src,G=f[0].similarityImage.href))&&u(b,"src",G),(!T||F&1&&J!==(J=f[0].similarityImage.title))&&u(b,"alt",J),(!T||F&4)&&ne(b,"overlay-reset",f[2]),F&2&&Z(b,"opacity",f[1]),F&8&&Z(b,"transform",f[3])},i(f){T||(w(m.$$.fragment,f),w(_.$$.fragment,f),w(h.$$.fragment,f),w(q.$$.fragment,f),w(R.$$.fragment,f),w(U.$$.fragment,f),T=!0)},o(f){O(m.$$.fragment,f),O(_.$$.fragment,f),O(h.$$.fragment,f),O(q.$$.fragment,f),O(R.$$.fragment,f),O(U.$$.fragment,f),T=!1},d(f){f&&W(t),D(m),D(_),D(h),D(q),D(R),D(U),ee=!1,se()}}}function Se(r,t,l){let i,{imgData:e}=t;const v=[{value:"h",label:I==="fr"?"Basculer horizontalement":"Flip horizontally"},{value:"v",label:I==="fr"?"Basculer verticalement":"Flip vertically"},{value:"hv",label:I==="fr"?"Basculer horizontalement et verticalement":"Flip horizontally and vertically"}];let o=.5;const s=o;let a=0;const m=a;let n=100;const g=n;let _=[1,1];const y=structuredClone(_);let p=[0,0];const h=structuredClone(p);let M=!1;const C=ye(window.crypto.randomUUID());_e("resetTrigger",C);const q=$=>l(1,o=$.detail),j=$=>l(16,a=$.detail),B=$=>l(17,n=$.detail),R=$=>l(19,p=[$.detail,p[1]]),H=$=>l(19,p=[p[0],$.detail]),L=$=>{let P=$.detail[0];l(18,_=P==="hv"?[-1,-1]:P==="h"?[-1,1]:P==="v"?[1,-1]:[1,1])},U=()=>{l(1,o=s),l(16,a=m),l(17,n=g),l(18,_=y),l(19,p=h),C.set(window.crypto.randomUUID()),l(2,M=!0),setTimeout(()=>l(2,M=!1),1e3)};return r.$$set=$=>{"imgData"in $&&l(0,e=$.imgData)},r.$$.update=()=>{r.$$.dirty&983040&&l(3,i=`translate(${p[0]-50}%, ${p[1]}%)
                        rotate(${a}deg)
                        scale(${_.map($=>$*(n/100)).join()})`)},[e,o,M,i,v,s,m,g,h,q,j,B,R,H,L,U,a,n,_,p]}class qe extends te{constructor(t){super(),ie(this,t,Se,Oe,le,{imgData:0})}}const{getRegionsInfo:ke}=$e;async function me(r,t,l,i,e,v,o=!1,s=!0){const a=()=>s?`<b>${!isNaN(parseFloat(l))&&t===1?`Score: ${l}`:t===2&&I==="en"?"Manual similarity":t===2&&I==="fr"?"Correspondance manuelle":t===3&&I==="en"?"Propagated match":"Correspondance propagée"}</b>`:"",m=n=>`${n}<br>
        Page ${parseInt(i)}<br>
        ${a()}`;return o===!0?fetch(`${e}${v}get_regions_title/${r}`).then(n=>n.json()).then(n=>m(n.title)).catch(n=>(console.error("similarity.utils.getDesc()",n),m(I==="fr"?"Titre inconnu":"Unknown title"))):Promise.resolve(m(ke(r).title))}function ce(r,t,l){const i=r.slice();return i[16]=t[l],i}function ze(r){let t=I==="en"?"Similarity":"Similarité",l;return{c(){l=pe(t)},m(i,e){Q(i,l,e)},p:x,d(i){i&&W(l)}}}function De(r){let t=I==="en"?"Query image":"Image requête",l;return{c(){l=pe(t)},m(i,e){Q(i,l,e)},p:x,d(i){i&&W(l)}}}function ue(r){let t,l,i,e,v,o;function s(n,g){if(n[16]==="queryImage")return De;if(n[16]==="similarityImage")return ze}let a=s(r),m=a&&a(r);return e=new be({props:{item:r[0][r[16]],descPromise:r[1][r[16]],height:"full"}}),{c(){t=d("div"),l=d("span"),m&&m.c(),i=S(),k(e.$$.fragment),v=S(),u(t,"class","img-legend-wrapper column is-flex is-flex-direction-column is-justify-content-center is-align-items-center")},m(n,g){Q(n,t,g),c(t,l),m&&m.m(l,null),c(t,i),z(e,t,null),c(t,v),o=!0},p(n,g){m&&m.p(n,g);const _={};g&1&&(_.item=n[0][n[16]]),e.$set(_)},i(n){o||(w(e.$$.fragment,n),o=!0)},o(n){O(e.$$.fragment,n),o=!1},d(n){n&&W(t),m&&m.d(),D(e)}}}function Ce(r){let t,l,i=["queryImage","similarityImage"],e=[];for(let o=0;o<2;o+=1)e[o]=ue(ce(r,i,o));const v=o=>O(e[o],1,1,()=>{e[o]=null});return{c(){t=d("div");for(let o=0;o<2;o+=1)e[o].c();u(t,"class","side-by-side columns")},m(o,s){Q(o,t,s);for(let a=0;a<2;a+=1)e[a]&&e[a].m(t,null);l=!0},p(o,[s]){if(s&3){i=["queryImage","similarityImage"];let a;for(a=0;a<2;a+=1){const m=ce(o,i,a);e[a]?(e[a].p(m,s),w(e[a],1)):(e[a]=ue(m),e[a].c(),w(e[a],1),e[a].m(t,null))}for(fe(),a=2;a<2;a+=1)v(a);ge()}},i(o){if(!l){for(let s=0;s<2;s+=1)w(e[s]);l=!0}},o(o){e=e.filter(Boolean);for(let s=0;s<2;s+=1)O(e[s]);l=!1},d(o){o&&W(t),Ie(e,o)}}}function Re(r,t,l){let{imgData:i}=t;const e=he("similarityPair"),v=new URL(window.location.href),o=v.origin,s=v.pathname,[a,m,n,g]=e.qImg.split(".")[0].split("_"),[_,y,p,h]=e.sImg.split(".")[0].split("_"),M=`${a}_${m}`,C=`${_}_${y}`,q={queryImage:me(M,e.similarityType,e.score,n,o,s,!0,!1),similarityImage:me(C,e.similarityType,e.score,p,o,s,!0,!0)};return r.$$set=j=>{"imgData"in j&&l(0,i=j.imgData)},[i,q]}class Ue extends te{constructor(t){super(),ie(this,t,Re,Ce,le,{imgData:0})}}function Ve(r){let t,l;return t=new Ue({props:{imgData:r[2]}}),{c(){k(t.$$.fragment)},m(i,e){z(t,i,e),l=!0},p:x,i(i){l||(w(t.$$.fragment,i),l=!0)},o(i){O(t.$$.fragment,i),l=!1},d(i){D(t,i)}}}function Te(r){let t,l;return t=new qe({props:{imgData:r[1]}}),{c(){k(t.$$.fragment)},m(i,e){z(t,i,e),l=!0},p:x,i(i){l||(w(t.$$.fragment,i),l=!0)},o(i){O(t.$$.fragment,i),l=!1},d(i){D(t,i)}}}function Fe(r){let t,l,i,e,v,o,s,a,m;const n=[Te,Ve],g=[];function _(y,p){return y[0]?0:1}return i=_(r),e=g[i]=n[i](r),a=new we({props:{start:!1,buttonDisplay:!0,toggleLabel:I==="en"?"Overlay view":"Vue superposée"}}),a.$on("updateChecked",r[3]),{c(){t=d("div"),l=d("div"),e.c(),o=S(),s=d("div"),k(a.$$.fragment),u(l,"class",v="modal-similarity-images "+(r[0]?"overlay-wrapper":"side-by-side-wrapper")+" svelte-1qvtan5"),u(t,"class","modal-similarity svelte-1qvtan5")},m(y,p){Q(y,t,p),c(t,l),g[i].m(l,null),c(t,o),c(t,s),z(a,s,null),m=!0},p(y,[p]){let h=i;i=_(y),i===h?g[i].p(y,p):(fe(),O(g[h],1,1,()=>{g[h]=null}),ge(),e=g[i],e?e.p(y,p):(e=g[i]=n[i](y),e.c()),w(e,1),e.m(l,null)),(!m||p&1&&v!==(v="modal-similarity-images "+(y[0]?"overlay-wrapper":"side-by-side-wrapper")+" svelte-1qvtan5"))&&u(l,"class",v)},i(y){m||(w(e),w(a.$$.fragment,y),m=!0)},o(y){O(e),O(a.$$.fragment,y),m=!1},d(y){y&&W(t),g[i].d(),D(a)}}}function Me(r,t,l){let{mainImgItem:i}=t,{compareImgItem:e}=t;const v={similarityImage:{href:oe(i.img,i.img.split("_").pop()),title:a(i.title)},queryImage:{href:oe(e.img,e.img.split("_").pop()),title:a(e.title)}},o={similarityImage:i,queryImage:e};let s=!1;function a(n){return I==="fr"?`Vue principale de la région ${n}`:`Main view of region ${n}`}const m=()=>l(0,s=!s);return r.$$set=n=>{"mainImgItem"in n&&l(4,i=n.mainImgItem),"compareImgItem"in n&&l(5,e=n.compareImgItem)},[s,v,o,m,i,e]}class je extends te{constructor(t){super(),ie(this,t,Me,Fe,le,{mainImgItem:4,compareImgItem:5})}}export{je as default};
//# sourceMappingURL=ModalSimilarity-662a5cde.js.map
