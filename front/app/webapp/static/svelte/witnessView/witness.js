function j(){}const Rs=n=>n;function Xl(n,e){for(const t in e)n[t]=e[t];return n}function Ql(n){return!!n&&(typeof n=="object"||typeof n=="function")&&typeof n.then=="function"}function Ds(n){return n()}function Ni(){return Object.create(null)}function Ce(n){n.forEach(Ds)}function an(n){return typeof n=="function"}function le(n,e){return n!=n?e==e:n!==e||n&&typeof n=="object"||typeof n=="function"}let vn;function Re(n,e){return vn||(vn=document.createElement("a")),vn.href=e,n===vn.href}function Zl(n){return Object.keys(n).length===0}function di(n,...e){if(n==null)return j;const t=n.subscribe(...e);return t.unsubscribe?()=>t.unsubscribe():t}function hi(n){let e;return di(n,t=>e=t)(),e}function ue(n,e,t){n.$$.on_destroy.push(di(e,t))}function qe(n,e,t,i){if(n){const r=Ns(n,e,t,i);return n[0](r)}}function Ns(n,e,t,i){return n[1]&&i?Xl(t.ctx.slice(),n[1](i(e))):t.ctx}function Be(n,e,t,i){if(n[2]&&i){const r=n[2](i(t));if(e.dirty===void 0)return r;if(typeof r=="object"){const s=[],l=Math.max(e.dirty.length,r.length);for(let o=0;o<l;o+=1)s[o]=e.dirty[o]|r[o];return s}return e.dirty|r}return e.dirty}function ze(n,e,t,i,r,s){if(r){const l=Ns(e,t,i,s);n.p(l,r)}}function Ke(n){if(n.ctx.length>32){const e=[],t=n.ctx.length/32;for(let i=0;i<t;i++)e[i]=-1;return e}return-1}function eo(n){const e={};for(const t in n)e[t]=!0;return e}function bn(n){return n??""}function In(n){return n&&an(n.destroy)?n.destroy:j}const js=typeof window<"u";let to=js?()=>window.performance.now():()=>Date.now(),mi=js?n=>requestAnimationFrame(n):j;const $t=new Set;function Vs(n){$t.forEach(e=>{e.c(n)||($t.delete(e),e.f())}),$t.size!==0&&mi(Vs)}function no(n){let e;return $t.size===0&&mi(Vs),{promise:new Promise(t=>{$t.add(e={c:n,f:t})}),abort(){$t.delete(e)}}}function _(n,e){n.appendChild(e)}function Us(n){if(!n)return document;const e=n.getRootNode?n.getRootNode():n.ownerDocument;return e&&e.host?e:n.ownerDocument}function io(n){const e=b("style");return ro(Us(n),e),e.sheet}function ro(n,e){return _(n.head||n,e),e.sheet}function E(n,e,t){n.insertBefore(e,t||null)}function S(n){n.parentNode&&n.parentNode.removeChild(n)}function it(n,e){for(let t=0;t<n.length;t+=1)n[t]&&n[t].d(e)}function b(n){return document.createElement(n)}function He(n){return document.createElementNS("http://www.w3.org/2000/svg",n)}function G(n){return document.createTextNode(n)}function N(){return G(" ")}function me(){return G("")}function ne(n,e,t,i){return n.addEventListener(e,t,i),()=>n.removeEventListener(e,t,i)}function yt(n){return function(e){return e.preventDefault(),n.call(this,e)}}function Fs(n){return function(e){return e.stopPropagation(),n.call(this,e)}}function p(n,e,t){t==null?n.removeAttribute(e):n.getAttribute(e)!==t&&n.setAttribute(e,t)}function so(n){return Array.from(n.childNodes)}function de(n,e){e=""+e,n.data!==e&&(n.data=e)}function Dt(n,e){n.value=e??""}function ge(n,e,t,i){t==null?n.style.removeProperty(e):n.style.setProperty(e,t,i?"important":"")}function ji(n,e,t){for(let i=0;i<n.options.length;i+=1){const r=n.options[i];if(r.__value===e){r.selected=!0;return}}(!t||e!==void 0)&&(n.selectedIndex=-1)}function lo(n){const e=n.querySelector(":checked");return e&&e.__value}function ke(n,e,t){n.classList[t?"add":"remove"](e)}function Hs(n,e,{bubbles:t=!1,cancelable:i=!1}={}){const r=document.createEvent("CustomEvent");return r.initCustomEvent(n,t,i,e),r}class oo{constructor(e=!1){this.is_svg=!1,this.is_svg=e,this.e=this.n=null}c(e){this.h(e)}m(e,t,i=null){this.e||(this.is_svg?this.e=He(t.nodeName):this.e=b(t.nodeType===11?"TEMPLATE":t.nodeName),this.t=t.tagName!=="TEMPLATE"?t:t.content,this.c(e)),this.i(i)}h(e){this.e.innerHTML=e,this.n=Array.from(this.e.nodeName==="TEMPLATE"?this.e.content.childNodes:this.e.childNodes)}i(e){for(let t=0;t<this.n.length;t+=1)E(this.t,this.n[t],e)}p(e){this.d(),this.h(e),this.i(this.a)}d(){this.n.forEach(S)}}const On=new Map;let An=0;function ao(n){let e=5381,t=n.length;for(;t--;)e=(e<<5)-e^n.charCodeAt(t);return e>>>0}function co(n,e){const t={stylesheet:io(e),rules:{}};return On.set(n,t),t}function Vi(n,e,t,i,r,s,l,o=0){const a=16.666/i;let c=`{
`;for(let v=0;v<=1;v+=a){const w=e+(t-e)*s(v);c+=v*100+`%{${l(w,1-w)}}
`}const u=c+`100% {${l(t,1-t)}}
}`,d=`__svelte_${ao(u)}_${o}`,f=Us(n),{stylesheet:h,rules:m}=On.get(f)||co(f,n);m[d]||(m[d]=!0,h.insertRule(`@keyframes ${d} ${u}`,h.cssRules.length));const g=n.style.animation||"";return n.style.animation=`${g?`${g}, `:""}${d} ${i}ms linear ${r}ms 1 both`,An+=1,d}function uo(n,e){const t=(n.style.animation||"").split(", "),i=t.filter(e?s=>s.indexOf(e)<0:s=>s.indexOf("__svelte")===-1),r=t.length-i.length;r&&(n.style.animation=i.join(", "),An-=r,An||fo())}function fo(){mi(()=>{An||(On.forEach(n=>{const{ownerNode:e}=n.stylesheet;e&&S(e)}),On.clear())})}let sn;function ut(n){sn=n}function Bt(){if(!sn)throw new Error("Function called outside component initialization");return sn}function mt(n){Bt().$$.on_mount.push(n)}function cn(n){Bt().$$.on_destroy.push(n)}function zt(){const n=Bt();return(e,t,{cancelable:i=!1}={})=>{const r=n.$$.callbacks[e];if(r){const s=Hs(e,t,{cancelable:i});return r.slice().forEach(l=>{l.call(n,s)}),!s.defaultPrevented}return!0}}function ct(n,e){return Bt().$$.context.set(n,e),e}function De(n){return Bt().$$.context.get(n)}function Tn(n,e){const t=n.$$.callbacks[e.type];t&&t.slice().forEach(i=>i.call(this,e))}const Lt=[],dt=[];let Rt=[];const ei=[],ho=Promise.resolve();let ti=!1;function mo(){ti||(ti=!0,ho.then(pi))}function et(n){Rt.push(n)}function Nt(n){ei.push(n)}const xn=new Set;let Tt=0;function pi(){if(Tt!==0)return;const n=sn;do{try{for(;Tt<Lt.length;){const e=Lt[Tt];Tt++,ut(e),po(e.$$)}}catch(e){throw Lt.length=0,Tt=0,e}for(ut(null),Lt.length=0,Tt=0;dt.length;)dt.pop()();for(let e=0;e<Rt.length;e+=1){const t=Rt[e];xn.has(t)||(xn.add(t),t())}Rt.length=0}while(Lt.length);for(;ei.length;)ei.pop()();ti=!1,xn.clear(),ut(n)}function po(n){if(n.fragment!==null){n.update(),Ce(n.before_update);const e=n.dirty;n.dirty=[-1],n.fragment&&n.fragment.p(n.ctx,e),n.after_update.forEach(et)}}function go(n){const e=[],t=[];Rt.forEach(i=>n.indexOf(i)===-1?e.push(i):t.push(i)),t.forEach(i=>i()),Rt=e}let Qt;function _o(){return Qt||(Qt=Promise.resolve(),Qt.then(()=>{Qt=null})),Qt}function Jn(n,e,t){n.dispatchEvent(Hs(`${e?"intro":"outro"}${t}`))}const Sn=new Set;let ft;function be(){ft={r:0,c:[],p:ft}}function we(){ft.r||Ce(ft.c),ft=ft.p}function P(n,e){n&&n.i&&(Sn.delete(n),n.i(e))}function M(n,e,t,i){if(n&&n.o){if(Sn.has(n))return;Sn.add(n),ft.c.push(()=>{Sn.delete(n),i&&(t&&n.d(1),i())}),n.o(e)}else i&&i()}const vo={duration:0};function ot(n,e,t,i){const r={direction:"both"};let s=e(n,t,r),l=i?0:1,o=null,a=null,c=null;function u(){c&&uo(n,c)}function d(h,m){const g=h.b-l;return m*=Math.abs(g),{a:l,b:h.b,d:g,duration:m,start:h.start,end:h.start+m,group:h.group}}function f(h){const{delay:m=0,duration:g=300,easing:v=Rs,tick:w=j,css:I}=s||vo,R={start:to()+m,b:h};h||(R.group=ft,ft.r+=1),o||a?a=R:(I&&(u(),c=Vi(n,l,h,g,m,v,I)),h&&w(0,1),o=d(R,g),et(()=>Jn(n,h,"start")),no(C=>{if(a&&C>a.start&&(o=d(a,g),a=null,Jn(n,o.b,"start"),I&&(u(),c=Vi(n,l,o.b,o.duration,0,v,s.css))),o){if(C>=o.end)w(l=o.b,1-l),Jn(n,o.b,"end"),a||(o.b?u():--o.group.r||Ce(o.group.c)),o=null;else if(C>=o.start){const O=C-o.start;l=o.a+o.d*v(O/o.duration),w(l,1-l)}}return!!(o||a)}))}return{run(h){an(s)?_o().then(()=>{s=s(r),f(h)}):f(h)},end(){u(),o=a=null}}}function tt(n,e){const t=e.token={};function i(r,s,l,o){if(e.token!==t)return;e.resolved=o;let a=e.ctx;l!==void 0&&(a=a.slice(),a[l]=o);const c=r&&(e.current=r)(a);let u=!1;e.block&&(e.blocks?e.blocks.forEach((d,f)=>{f!==s&&d&&(be(),M(d,1,1,()=>{e.blocks[f]===d&&(e.blocks[f]=null)}),we())}):e.block.d(1),c.c(),P(c,1),c.m(e.mount(),e.anchor),u=!0),e.block=c,e.blocks&&(e.blocks[s]=c),u&&pi()}if(Ql(n)){const r=Bt();if(n.then(s=>{ut(r),i(e.then,1,e.value,s),ut(null)},s=>{if(ut(r),i(e.catch,2,e.error,s),ut(null),!e.hasCatch)throw s}),e.current!==e.pending)return i(e.pending,0),!0}else{if(e.current!==e.then)return i(e.then,1,e.value,n),!0;e.resolved=n}}function At(n,e,t){const i=e.slice(),{resolved:r}=n;n.current===n.then&&(i[n.value]=r),n.current===n.catch&&(i[n.error]=r),n.block.p(i,t)}function bo(n,e){n.d(1),e.delete(n.key)}function Rn(n,e){M(n,1,1,()=>{e.delete(n.key)})}function un(n,e,t,i,r,s,l,o,a,c,u,d){let f=n.length,h=s.length,m=f;const g={};for(;m--;)g[n[m].key]=m;const v=[],w=new Map,I=new Map,R=[];for(m=h;m--;){const A=d(r,s,m),y=t(A);let D=l.get(y);D?i&&R.push(()=>D.p(A,e)):(D=c(y,A),D.c()),w.set(y,v[m]=D),y in g&&I.set(y,Math.abs(m-g[y]))}const C=new Set,O=new Set;function L(A){P(A,1),A.m(o,u),l.set(A.key,A),u=A.first,h--}for(;f&&h;){const A=v[h-1],y=n[f-1],D=A.key,Z=y.key;A===y?(u=A.first,f--,h--):w.has(Z)?!l.has(D)||C.has(D)?L(A):O.has(Z)?f--:I.get(D)>I.get(Z)?(O.add(D),L(A)):(C.add(Z),f--):(a(y,l),f--)}for(;f--;){const A=n[f];w.has(A.key)||a(A,l)}for(;h;)L(v[h-1]);return Ce(R),v}function jt(n,e,t){const i=n.$$.props[e];i!==void 0&&(n.$$.bound[i]=t,t(n.$$.ctx[i]))}function W(n){n&&n.c()}function z(n,e,t,i){const{fragment:r,after_update:s}=n.$$;r&&r.m(e,t),i||et(()=>{const l=n.$$.on_mount.map(Ds).filter(an);n.$$.on_destroy?n.$$.on_destroy.push(...l):Ce(l),n.$$.on_mount=[]}),s.forEach(et)}function K(n,e){const t=n.$$;t.fragment!==null&&(go(t.after_update),Ce(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function wo(n,e){n.$$.dirty[0]===-1&&(Lt.push(n),mo(),n.$$.dirty.fill(0)),n.$$.dirty[e/31|0]|=1<<e%31}function ae(n,e,t,i,r,s,l,o=[-1]){const a=sn;ut(n);const c=n.$$={fragment:null,ctx:[],props:s,update:j,not_equal:r,bound:Ni(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(a?a.$$.context:[])),callbacks:Ni(),dirty:o,skip_bound:!1,root:e.target||a.$$.root};l&&l(c.root);let u=!1;if(c.ctx=t?t(n,e.props||{},(d,f,...h)=>{const m=h.length?h[0]:f;return c.ctx&&r(c.ctx[d],c.ctx[d]=m)&&(!c.skip_bound&&c.bound[d]&&c.bound[d](m),u&&wo(n,d)),f}):[],c.update(),u=!0,Ce(c.before_update),c.fragment=i?i(c.ctx):!1,e.target){if(e.hydrate){const d=so(e.target);c.fragment&&c.fragment.l(d),d.forEach(S)}else c.fragment&&c.fragment.c();e.intro&&P(n.$$.fragment),z(n,e.target,e.anchor,e.customElement),pi()}ut(a)}class ce{$destroy(){K(this,1),this.$destroy=j}$on(e,t){if(!an(t))return j;const i=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return i.push(t),()=>{const r=i.indexOf(t);r!==-1&&i.splice(r,1)}}$set(e){this.$$set&&!Zl(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}function yo(n){const e=n-1;return e*e*e+1}function bt(n,{delay:e=0,duration:t=400,easing:i=Rs}={}){const r=+getComputedStyle(n).opacity;return{delay:e,duration:t,easing:i,css:s=>`opacity: ${s*r}`}}function Ui(n,{delay:e=0,duration:t=400,easing:i=yo,axis:r="y"}={}){const s=getComputedStyle(n),l=+s.opacity,o=r==="y"?"height":"width",a=parseFloat(s[o]),c=r==="y"?["top","bottom"]:["left","right"],u=c.map(w=>`${w[0].toUpperCase()}${w.slice(1)}`),d=parseFloat(s[`padding${u[0]}`]),f=parseFloat(s[`padding${u[1]}`]),h=parseFloat(s[`margin${u[0]}`]),m=parseFloat(s[`margin${u[1]}`]),g=parseFloat(s[`border${u[0]}Width`]),v=parseFloat(s[`border${u[1]}Width`]);return{delay:e,duration:t,easing:i,css:w=>`overflow: hidden;opacity: ${Math.min(w*20,1)*l};${o}: ${w*a}px;padding-${c[0]}: ${w*d}px;padding-${c[1]}: ${w*f}px;margin-${c[0]}: ${w*h}px;margin-${c[1]}: ${w*m}px;border-${c[0]}-width: ${w*g}px;border-${c[1]}-width: ${w*v}px;`}}const Pt=[];function ko(n,e){return{subscribe:Oe(n,e).subscribe}}function Oe(n,e=j){let t;const i=new Set;function r(o){if(le(n,o)&&(n=o,t)){const a=!Pt.length;for(const c of i)c[1](),Pt.push(c,n);if(a){for(let c=0;c<Pt.length;c+=2)Pt[c][0](Pt[c+1]);Pt.length=0}}}function s(o){r(o(n))}function l(o,a=j){const c=[o,a];return i.add(c),i.size===1&&(t=e(r)||j),o(n),()=>{i.delete(c),i.size===0&&t&&(t(),t=null)}}return{set:r,update:s,subscribe:l}}function xe(n,e,t){const i=!Array.isArray(n),r=i?[n]:n,s=e.length<2;return ko(t,l=>{let o=!1;const a=[];let c=0,u=j;const d=()=>{if(c)return;u();const h=e(i?a[0]:a,l);s?l(h):u=an(h)?h:j},f=r.map((h,m)=>di(h,g=>{a[m]=g,c&=~(1<<m),o&&d()},()=>{c|=1<<m}));return o=!0,d(),function(){Ce(f),u(),o=!1}})}const U=APP_LANG,Ue=APP_NAME;WEBAPP_NAME;const En=USER_ID,So=IS_SUPERUSER,Xe=CSRF_TOKEN,Vt=ADDITIONAL_MODULES,ln="Region";APP_URL;const Eo=SAS_APP_URL,Co=CANTALOUPE_APP_URL,Io=MEDIA_PATH,Oo=PAGE_LEN,Ot=Oe(!1),qs=Oe(""),Ao=n=>typeof n=="string"||n instanceof String;async function Ut(n){Ot.set(!0);try{return await n()}finally{Ot.set(!1)}}function Bs(n){return n.match(/\d+/g).toString()}function To(n){return parseInt(Bs(n),10)}function zs(n,e=100){const t=Math.floor(e*.75);return n.length>e?n.slice(0,t)+"..."+n.slice(-e+t):n}function Po(){return Co??"http://localhost:8182"}function Lo(){return Eo??"http://localhost:8888"}function gi(n,e){if(typeof window<"u"){const t=parseInt(new URLSearchParams(window.location.search).get(e));if(!isNaN(t))return n.set(t),t}return n.set(1),1}function _i(n,e,t){if(e.set(n),typeof window<"u"){const i=new URL(window.location.href);i.searchParams.set(t,n),window.history.pushState({},"",i)}}function Mo(n=null){if(n)return n=n.split("_"),n.length<3?void 0:`${n.slice(0,3).join("_").replace(".jpg","")}.jpg`}function Ks(n=null){const e=Mo(n);return e===void 0?void 0:`${Po()}/iiif/2/${e}`}function nt(n=null,e=null,t="full"){if(e=Ao(e)?e.replace(".jpg",""):e,!n)return"https://placehold.co/96x96/png?text=No+image";if(!n.startsWith("wit")){const[s,...l]=n.split("_wit");n=`wit${l}`}const i=Ks(n);if(i===void 0)return"https://placehold.co/96x96/png?text=No+image";const r=n.split("_");return e||(e=r[r.length-1].includes(",")?r.pop().replace(".jpg",""):"full"),`${i}/${e}/${t}/0/default.jpg`}function $o(n=null){return`${Ks(n)}/info.json`}function Ft(n=null,e=1){return`${Lo()}/index.html?iiif-content=${n}&canvas=${e}`}function $e(n,e=null,t=!1){return new Promise(i=>{if(document.getElementById("msg-modal")){t?document.getElementById("modal-footer").hidden=!1:i(void 0),e&&(document.getElementById("modal-title").innerHTML=e),document.getElementById("modal-msg").innerHTML=n,document.getElementById("hidden-msg-btn").click();const s=document.getElementById("cancel-btn"),l=document.getElementById("ok-btn"),o=document.getElementById("modal-bkg"),a=()=>{s.removeEventListener("click",c),o.removeEventListener("click",c),l.removeEventListener("click",u),document.getElementById("modal-footer").hidden=!0},c=()=>{a(),i(!1)},u=()=>{a(),i(!0)};s.addEventListener("click",c),l.addEventListener("click",u)}else t?i(window.confirm(n)):(window.alert(n),i(void 0))})}function Ws(n,e){const t=window.URL.createObjectURL(n),i=document.createElement("a");i.href=t,i.download=`${e}`,document.body.appendChild(i),i.click(),window.URL.revokeObjectURL(t),document.body.removeChild(i)}function Pn(){let n,e,t=(i,r)=>i===r;return{set:i=>{e=n,n=i},setCompareFn:i=>t=i,get:()=>n,getNewAndOld:()=>[n,e],same:()=>t(n,e)}}const vi=(n,e)=>Array.isArray(n)&&Array.isArray(e)&&n.length===e.length&&n.every((t,i)=>t===e[i]||void 0);function Gs(n=null){return n<600?1:n<800?2:n<1e3?3:n<1200?4:n<1400?5:n>=1400?6:4}function Ys(n){const e=n.querySelectorAll(".modal-background, .modal-close, .modal-card-head .delete, .modal-card-foot .button-close"),t=()=>n.classList.remove("is-active");e.forEach(r=>r.addEventListener("click",t));const i=r=>{r.key==="Escape"&&n.classList.contains("is-active")&&t()};return document.addEventListener("keydown",i),{destroy(){e.forEach(r=>r.removeEventListener("click",t)),document.removeEventListener("keydown",i)}}}function xs(n){const e=()=>{const t=document.getElementById(n.dataset.target);t==null||t.classList.add("is-active")};return n.addEventListener("click",e),{destroy(){n.removeEventListener("click",e)}}}function bi(n){const{type:e,modelName:t,title:i,extractMeta:r=h=>h}=n,s={id:null,type:e,title:i,is_public:!1,selected:{}},l=JSON.parse(localStorage.getItem(e))||s,o=Oe(l),a=Oe(!1);function c(h,m=!1){a.set(m),localStorage.setItem(e,JSON.stringify(h))}function u(){o.update(h=>{if(e!=="documentSet")return console.error("Document set management is the only type currently supported for saving."),h;const m=Object.fromEntries(Object.entries(h.selected).map(([v,w])=>[v,Object.keys(w)])),g=h.id?`${h.id}/edit`:"new";return fetch(`${window.location.origin}/${t}/${g}`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":Xe},body:JSON.stringify({title:h.title,is_public:h.is_public,selection:h,...m})}).then(v=>v.json()).then(v=>{if(!(v!=null&&v.document_set_id))throw new Error("Failed to save");o.update(w=>(w.id=v.document_set_id,w.title=v.document_set_title,w.is_public=v.is_public,c(w,!0),w))}).catch(v=>console.error("Error:",v)),h})}const d=h=>o.update(()=>{const m=h.selection.id?h.selection:{...h.selection,id:h.id};return c(m),m}),f=()=>o.update(()=>{const h={...s,selected:{}};return c(h),h});return{type:e,subscribe:o.subscribe,add:h=>o.update(m=>(m.selected[h.class]={...m.selected[h.class]||{},[h.id]:r(h)},c(m),m)),addAll:h=>o.update(m=>(h.forEach(g=>{m.selected[g.class]={...m.selected[g.class]||{},[g.id]:r(g)}}),c(m),m)),remove:(h,m)=>o.update(g=>{const{[h]:v,...w}=g.selected[m];return g.selected[m]=w,c(g),g}),removeAll:(h,m)=>o.update(g=>(h.forEach(v=>{var w;return(w=g.selected[m])==null?!0:delete w[v]}),c(g),g)),toggle:h=>o.update(m=>{var g;if((g=m.selected[h.class])!=null&&g[h.id]){const{[h.id]:v,...w}=m.selected[h.class];m.selected[h.class]=w}else m.selected[h.class]={...m.selected[h.class]||{},[h.id]:r(h)};return c(m),m}),toggleSet:h=>{hi(o).id===h.id?f():d(h)},empty:()=>o.update(h=>(h.id=null,h.title=i,h.selected={},c(h,!0),h)),updateTitle:h=>o.update(m=>(m.title=h,c(m,!0),m)),updatePublic:h=>o.update(m=>(m.is_public=h,c(m,!0),m)),save:u,isSaved:a,selection:o,selectionTitle:xe(o,h=>h.title),isSelected:xe(o,h=>m=>{var g;return((g=h.selected[m.class])==null?void 0:g[m.id])||!1}),selected:xe(o,h=>h.selected),nbSelected:xe(o,h=>Object.entries(h.selected).reduce((m,[g,v])=>g==="User"?m:m+Object.keys(v).length,0)),isSetSelected:xe(o,h=>m=>h.id===m.id)}}const Ro=bi({type:"documentSet",modelName:"document-set",title:U==="en"?"Document set":"Set de documents",extractMeta:n=>({title:n.title,url:n.url})}),_t=bi({type:"regionsSet",modelName:"regions-set",title:U==="en"?"Regions set":"Set de régions",extractMeta:n=>n});function Do(n){if(!n.startsWith("wit"))return n;const[e,...t]=n.split("_wit");return`wit${t}`}bi({type:"clusterSet",modelName:"cluster-set",title:U==="en"?"Selected regions":"Régions sélectionnées",extractMeta:n=>({imgRef:n.id,clusterId:n.clusterId,title:n.title,xywh:n.xywh,img:Do(n.id)})});function No(){const n=`${window.location.origin}${window.location.pathname}`,e=Oe(1),t=Oe({}),i=Oe({}),r=Oe("");gi(e,"p");function s(u){r.update(d=>{const f=d===u?"":u;return navigator.clipboard.writeText(f).then(h=>""),f})}const l=(async()=>{try{const u=await fetch(`${n}canvas`);if(!u.ok)return{};const d=await u.json();let f={};return Object.values(d).forEach(h=>{Object.entries(h).forEach(([m,g])=>{f[m]=g})}),t.set(f),d}catch{return{}}})(),o=xe(e,u=>(async()=>{const f=await(await fetch(`${n}canvas?p=${u}`)).json();return i.set(f),f})());function a(u){_i(u,e,"p")}function c(u){t.update(d=>(delete d[u],{...d})),i.update(d=>{for(const f in d)if(d[f][u]){const{[u]:h,...m}=d[f];return d[f]=m,d}return d})}return{currentPage:e,pageRegions:i,allRegions:t,fetchPages:o,fetchAll:l,handlePageUpdate:a,remove:c,clipBoard:r,copyRef:s}}const wt=No();function Fi(n){let e,t,i;return{c(){e=b("div"),e.innerHTML='<div class="loader svelte-vizlcg"></div>',p(e,"class","bkg-shade svelte-vizlcg")},m(r,s){E(r,e,s),i=!0},i(r){i||(et(()=>{i&&(t||(t=ot(e,bt,{duration:150},!0)),t.run(1))}),i=!0)},o(r){t||(t=ot(e,bt,{duration:150},!1)),t.run(0),i=!1},d(r){r&&S(e),r&&t&&t.end()}}}function jo(n){let e,t,i=n[0]&&Fi();return{c(){i&&i.c(),e=me()},m(r,s){i&&i.m(r,s),E(r,e,s),t=!0},p(r,[s]){r[0]?i?s&1&&P(i,1):(i=Fi(),i.c(),P(i,1),i.m(e.parentNode,e)):i&&(be(),M(i,1,1,()=>{i=null}),we())},i(r){t||(P(i),t=!0)},o(r){M(i),t=!1},d(r){i&&i.d(r),r&&S(e)}}}function Vo(n,e,t){let i;return ue(n,Ot,r=>t(0,i=r)),[i]}class Js extends ce{constructor(e){super(),ae(this,e,Vo,jo,le,{})}}const Uo=n=>({}),Hi=n=>({});function Fo(n){let e,t,i,r,s,l,o,a,c,u,d,f,h,m,g,v,w,I,R,C,O;const L=n[1].content,A=qe(L,n,n[0],Hi);return{c(){e=b("button"),t=N(),i=b("div"),r=b("div"),s=N(),l=b("div"),o=b("div"),o.innerHTML=`<div class="title is-4 mb-0 media-content"><span id="modal-title" class="mb-0"></span></div>
            <button class="delete media-left" aria-label="close"></button>`,a=N(),c=b("section"),u=b("div"),d=N(),f=b("div"),A&&A.c(),h=N(),m=b("footer"),g=b("div"),v=b("button"),v.textContent=`${U==="en"?"Abort":"Retour"}`,w=N(),I=b("button"),I.textContent="OK",p(e,"id","hidden-msg-btn"),p(e,"data-target","msg-modal"),e.hidden=!0,p(r,"id","modal-bkg"),p(r,"class","modal-background"),p(o,"class","modal-card-head media mb-0"),p(u,"id","modal-msg"),p(f,"class","py-3"),p(c,"id","modal-body"),p(c,"class","modal-card-body"),p(v,"id","cancel-btn"),p(v,"class","button is-link is-light button-close"),p(I,"id","ok-btn"),p(I,"class","button is-link button-close"),p(g,"class","buttons"),p(m,"id","modal-footer"),p(m,"class","modal-card-foot is-center pt-3"),m.hidden=!0,p(l,"class","modal-content"),p(i,"id","msg-modal"),p(i,"class","modal fade"),p(i,"tabindex","-1"),p(i,"aria-labelledby","selection-modal-label"),p(i,"aria-hidden","true")},m(y,D){E(y,e,D),E(y,t,D),E(y,i,D),_(i,r),_(i,s),_(i,l),_(l,o),_(l,a),_(l,c),_(c,u),_(c,d),_(c,f),A&&A.m(f,null),_(l,h),_(l,m),_(m,g),_(g,v),_(g,w),_(g,I),R=!0,C||(O=[In(xs.call(null,e)),In(Ys.call(null,i))],C=!0)},p(y,[D]){A&&A.p&&(!R||D&1)&&ze(A,L,y,y[0],R?Be(L,y[0],D,Uo):Ke(y[0]),Hi)},i(y){R||(P(A,y),R=!0)},o(y){M(A,y),R=!1},d(y){y&&S(e),y&&S(t),y&&S(i),A&&A.d(y),C=!1,Ce(O)}}}function Ho(n,e,t){let{$$slots:i={},$$scope:r}=e;return n.$$set=s=>{"$$scope"in s&&t(0,r=s.$$scope)},[r,i]}class qo extends ce{constructor(e){super(),ae(this,e,Ho,Fo,le,{})}}const Bo=n=>({activeTab:n&8}),qi=n=>({activeTab:n[3]});function Bi(n,e,t){const i=n.slice();return i[11]=e[t][0],i[12]=e[t][1],i}const zo=n=>({activeTab:n&8}),zi=n=>({activeTab:n[3]}),Ko=n=>({}),Ki=n=>({});function Wo(n){let e,t,i=Object.entries(n[2]),r=[];for(let s=0;s<i.length;s+=1)r[s]=Wi(Bi(n,i,s));return{c(){e=b("div"),t=b("ul");for(let s=0;s<r.length;s+=1)r[s].c();p(e,"class","tabs")},m(s,l){E(s,e,l),_(e,t);for(let o=0;o<r.length;o+=1)r[o]&&r[o].m(t,null)},p(s,l){if(l&28){i=Object.entries(s[2]);let o;for(o=0;o<i.length;o+=1){const a=Bi(s,i,o);r[o]?r[o].p(a,l):(r[o]=Wi(a),r[o].c(),r[o].m(t,null))}for(;o<r.length;o+=1)r[o].d(1);r.length=i.length}},i:j,o:j,d(s){s&&S(e),it(r,s)}}}function Go(n){let e;const t=n[8].tabs,i=qe(t,n,n[7],zi);return{c(){i&&i.c()},m(r,s){i&&i.m(r,s),e=!0},p(r,s){i&&i.p&&(!e||s&136)&&ze(i,t,r,r[7],e?Be(t,r[7],s,zo):Ke(r[7]),zi)},i(r){e||(P(i,r),e=!0)},o(r){M(i,r),e=!1},d(r){i&&i.d(r)}}}function Wi(n){let e,t,i=n[12]+"",r,s,l,o;function a(){return n[9](n[11])}return{c(){e=b("li"),t=b("a"),r=G(i),s=N(),p(t,"href",null),ke(e,"is-active",n[3]===n[11])},m(c,u){E(c,e,u),_(e,t),_(t,r),_(e,s),l||(o=ne(t,"click",a),l=!0)},p(c,u){n=c,u&4&&i!==(i=n[12]+"")&&de(r,i),u&12&&ke(e,"is-active",n[3]===n[11])},d(c){c&&S(e),l=!1,o()}}}function Yo(n){let e,t,i,r,s,l,o,a,c,u,d,f,h;e=new Js({});const m=n[8].sidebar,g=qe(m,n,n[7],Ki),v=[Go,Wo],w=[];function I(O,L){return L&4&&(a=null),O[5].tabs?0:(a==null&&(a=!!Object.keys(O[2]).length),a?1:-1)}~(c=I(n,-1))&&(u=w[c]=v[c](n));const R=n[8].content,C=qe(R,n,n[7],qi);return{c(){W(e.$$.fragment),t=N(),i=b("div"),r=b("aside"),g&&g.c(),s=N(),l=b("main"),o=b("nav"),u&&u.c(),d=N(),f=b("div"),C&&C.c(),p(r,"class","sidebar svelte-jr84gp"),ge(r,"width",n[0]+"%"),ge(r,"min-height",n[1]),p(o,"id","tabs"),p(o,"class","tabs-bar"),p(f,"class","content-area pl-5 svelte-jr84gp"),p(l,"class","main-content svelte-jr84gp"),ge(l,"width",100-n[0]+"%"),ge(l,"min-height",n[1]),p(i,"class","layout svelte-jr84gp"),ge(i,"min-height",n[1])},m(O,L){z(e,O,L),E(O,t,L),E(O,i,L),_(i,r),g&&g.m(r,null),_(i,s),_(i,l),_(l,o),~c&&w[c].m(o,null),_(l,d),_(l,f),C&&C.m(f,null),h=!0},p(O,[L]){g&&g.p&&(!h||L&128)&&ze(g,m,O,O[7],h?Be(m,O[7],L,Ko):Ke(O[7]),Ki),(!h||L&1)&&ge(r,"width",O[0]+"%");let A=c;c=I(O,L),c===A?~c&&w[c].p(O,L):(u&&(be(),M(w[A],1,1,()=>{w[A]=null}),we()),~c?(u=w[c],u?u.p(O,L):(u=w[c]=v[c](O),u.c()),P(u,1),u.m(o,null)):u=null),C&&C.p&&(!h||L&136)&&ze(C,R,O,O[7],h?Be(R,O[7],L,Bo):Ke(O[7]),qi),(!h||L&1)&&ge(l,"width",100-O[0]+"%")},i(O){h||(P(e.$$.fragment,O),P(g,O),P(u),P(C,O),h=!0)},o(O){M(e.$$.fragment,O),M(g,O),M(u),M(C,O),h=!1},d(O){K(e,O),O&&S(t),O&&S(i),g&&g.d(O),~c&&w[c].d(),C&&C.d(O)}}}function xo(n=null){n||(n=document.getElementById("navbar")),document.documentElement.style.setProperty("--top-offset",`${n.offsetHeight}px`)}function Jo(n,e,t){let i,{$$slots:r={},$$scope:s}=e;const l=eo(r);let{sidebarWidth:o="25"}=e;const a="90vh";let{tabList:c={}}=e,u=Object.keys(c),{topOffsetElement:d=null}=e;xo(d);function f(m){if(!u.includes(m)){console.warn(`Tab "${m}" is not available.`);return}t(3,i=m);const g=new URL(window.location);g.searchParams.set("tab",m),window.history.pushState({},"",g)}const h=m=>f(m);return n.$$set=m=>{"sidebarWidth"in m&&t(0,o=m.sidebarWidth),"tabList"in m&&t(2,c=m.tabList),"topOffsetElement"in m&&t(6,d=m.topOffsetElement),"$$scope"in m&&t(7,s=m.$$scope)},t(3,i=new URLSearchParams(window.location.search).get("tab")??u[0]??null),[o,a,c,i,f,l,d,s,r,h]}class Xo extends ce{constructor(e){super(),ae(this,e,Jo,Yo,le,{sidebarWidth:0,layoutHeight:1,tabList:2,topOffsetElement:6})}get layoutHeight(){return this.$$.ctx[1]}}function Gi(n,e,t){const i=n.slice();return i[8]=e[t],i[10]=t,i}function Yi(n,e,t){const i=n.slice();return i[11]=e[t][0],i[12]=e[t][1],i}function xi(n,e,t){const i=n.slice();return i[11]=e[t][0],i[12]=e[t][1],i}function Ji(n){let e,t;return{c(){e=b("a"),t=b("span"),p(t,"class","iconify"),p(t,"data-icon","entypo:edit"),p(e,"href",n[2]),p(e,"class","edit-btn button is-small is-rounded is-link px-3 ml-2 mt-1"),p(e,"title","Edit")},m(i,r){E(i,e,r),_(e,t)},p(i,r){r&4&&p(e,"href",i[2])},d(i){i&&S(e)}}}function Xi(n){let e,t=n[12].label+"",i,r,s,l,o=n[12].value+"",a;return{c(){e=b("span"),i=G(t),r=N(),s=b("span"),l=b("span"),a=G(o),p(e,"class","witness-key svelte-1yrx5r8"),p(s,"class","witness-value svelte-1yrx5r8")},m(c,u){E(c,e,u),_(e,i),E(c,r,u),E(c,s,u),_(s,l),_(l,a)},p(c,u){u&2&&t!==(t=c[12].label+"")&&de(i,t),u&2&&o!==(o=c[12].value+"")&&de(a,o)},d(c){c&&S(e),c&&S(r),c&&S(s)}}}function Qi(n){let e,t,i,r=n[1].metadata_full.contents,s=[];for(let l=0;l<r.length;l+=1)s[l]=nr(Gi(n,r,l));return{c(){e=b("h3"),e.textContent="Contents",t=N();for(let l=0;l<s.length;l+=1)s[l].c();i=me(),p(e,"class","title is-5 mb-3")},m(l,o){E(l,e,o),E(l,t,o);for(let a=0;a<s.length;a+=1)s[a]&&s[a].m(l,o);E(l,i,o)},p(l,o){if(o&26){r=l[1].metadata_full.contents;let a;for(a=0;a<r.length;a+=1){const c=Gi(l,r,a);s[a]?s[a].p(c,o):(s[a]=nr(c),s[a].c(),s[a].m(i.parentNode,i))}for(;a<s.length;a+=1)s[a].d(1);s.length=r.length}},d(l){l&&S(e),l&&S(t),it(s,l),l&&S(i)}}}function Zi(n){let e;return{c(){e=b("i"),p(e,"class","fa-solid fa-chevron-down")},m(t,i){E(t,e,i)},d(t){t&&S(e)}}}function er(n){let e,t=Object.entries(n[8].content),i=[];for(let r=0;r<t.length;r+=1)i[r]=tr(Yi(n,t,r));return{c(){e=b("div");for(let r=0;r<i.length;r+=1)i[r].c();p(e,"class","mt-2 pl-3")},m(r,s){E(r,e,s);for(let l=0;l<i.length;l+=1)i[l]&&i[l].m(e,null)},p(r,s){if(s&2){t=Object.entries(r[8].content);let l;for(l=0;l<t.length;l+=1){const o=Yi(r,t,l);i[l]?i[l].p(o,s):(i[l]=tr(o),i[l].c(),i[l].m(e,null))}for(;l<i.length;l+=1)i[l].d(1);i.length=t.length}},d(r){r&&S(e),it(i,r)}}}function tr(n){let e,t,i=n[11]+"",r,s,l,o=n[12]+"",a;return{c(){e=b("div"),t=b("b"),r=G(i),s=G(":"),l=N(),a=G(o),p(e,"class","witness-value svelte-1yrx5r8")},m(c,u){E(c,e,u),_(e,t),_(t,r),_(t,s),_(e,l),_(e,a)},p(c,u){u&2&&i!==(i=c[11]+"")&&de(r,i),u&2&&o!==(o=c[12]+"")&&de(a,o)},d(c){c&&S(e)}}}function nr(n){let e,t,i=n[8].title+"",r,s,l=Object.entries(n[8].content).length,o,a=n[3].has(n[10]),c,u,d,f=l&&Zi();function h(){return n[5](n[10])}function m(){return n[6](n[10])}let g=a&&er(n);return{c(){e=b("div"),t=b("div"),r=G(i),s=N(),f&&f.c(),o=N(),g&&g.c(),c=N(),p(t,"class","is-flex is-justify-content-space-between witness-key svelte-1yrx5r8"),p(e,"class","mb-3")},m(v,w){E(v,e,w),_(e,t),_(t,r),_(t,s),f&&f.m(t,null),_(e,o),g&&g.m(e,null),_(e,c),u||(d=[ne(t,"click",h),ne(t,"keypress",m)],u=!0)},p(v,w){n=v,w&2&&i!==(i=n[8].title+"")&&de(r,i),w&2&&(l=Object.entries(n[8].content).length),l?f||(f=Zi(),f.c(),f.m(t,null)):f&&(f.d(1),f=null),w&8&&(a=n[3].has(n[10])),a?g?g.p(n,w):(g=er(n),g.c(),g.m(e,c)):g&&(g.d(1),g=null)},d(v){v&&S(e),f&&f.d(),g&&g.d(),u=!1,Ce(d)}}}function Qo(n){var h;let e,t,i,r,s,l,o,a,c=n[1].can_edit&&Ji(n),u=Object.entries(n[1].metadata_full.wit),d=[];for(let m=0;m<u.length;m+=1)d[m]=Xi(xi(n,u,m));let f=((h=n[1].metadata_full.contents)==null?void 0:h.length)&&Qi(n);return{c(){e=b("div"),t=b("div"),i=b("div"),r=b("h1"),s=G(n[0]),l=N(),c&&c.c(),o=N();for(let m=0;m<d.length;m+=1)d[m].c();a=N(),f&&f.c(),p(r,"class","title"),p(i,"class","pb-2"),p(t,"class","content is-small mt-4"),p(e,"class","m-4 py-5 px-4")},m(m,g){E(m,e,g),_(e,t),_(t,i),_(i,r),_(r,s),_(r,l),c&&c.m(r,null),_(i,o);for(let v=0;v<d.length;v+=1)d[v]&&d[v].m(i,null);_(i,a),f&&f.m(i,null)},p(m,[g]){var v;if(g&1&&de(s,m[0]),m[1].can_edit?c?c.p(m,g):(c=Ji(m),c.c(),c.m(r,null)):c&&(c.d(1),c=null),g&2){u=Object.entries(m[1].metadata_full.wit);let w;for(w=0;w<u.length;w+=1){const I=xi(m,u,w);d[w]?d[w].p(I,g):(d[w]=Xi(I),d[w].c(),d[w].m(i,a))}for(;w<d.length;w+=1)d[w].d(1);d.length=u.length}(v=m[1].metadata_full.contents)!=null&&v.length?f?f.p(m,g):(f=Qi(m),f.c(),f.m(i,null)):f&&(f.d(1),f=null)},i:j,o:j,d(m){m&&S(e),c&&c.d(),it(d,m),f&&f.d()}}}function Zo(n,e,t){let{viewTitle:i=""}=e,{witness:r={}}=e,{editUrl:s=""}=e,l={},o=new Set;mt(async()=>{const d=`${window.location.origin}/${Ue}/witness/select`;try{l=await(await fetch(d)).json()}catch(f){return console.error("Error:",f),!1}});function a(d){o.has(d)?o.delete(d):o.add(d),t(3,o=new Set(o))}const c=d=>a(d),u=d=>a(d);return n.$$set=d=>{"viewTitle"in d&&t(0,i=d.viewTitle),"witness"in d&&t(1,r=d.witness),"editUrl"in d&&t(2,s=d.editUrl)},[i,r,s,o,a,c,u]}class ea extends ce{constructor(e){super(),ae(this,e,Zo,Qo,le,{viewTitle:0,witness:1,editUrl:2})}}function ta(n){let e,t,i,r,s,l=U==="en"?"Selection":"Sélection",o,a,c,u,d,f;return{c(){e=b("div"),t=b("button"),i=b("span"),r=b("i"),s=N(),o=G(l),a=G(`
            (`),c=G(n[0]),u=G(")"),p(r,"class","fa-solid fa-book-bookmark"),p(i,"id","btn-content"),p(t,"id","set-btn"),p(t,"class","button px-5 py-4 is-link svelte-gmt9z5"),p(t,"data-target","selection-modal"),p(e,"class","set-container svelte-gmt9z5")},m(h,m){E(h,e,m),_(e,t),_(t,i),_(i,r),_(i,s),_(i,o),_(i,a),_(i,c),_(i,u),d||(f=In(xs.call(null,t)),d=!0)},p(h,[m]){m&1&&de(c,h[0])},i:j,o:j,d(h){h&&S(e),d=!1,f()}}}function na(n,e,t){let{selectionLength:i=0}=e,r=i;return n.$$set=s=>{"selectionLength"in s&&t(0,i=s.selectionLength)},n.$$.update=()=>{if(n.$$.dirty&3&&i!==r){const s=i>r;t(1,r=i);const l=document.getElementById("btn-content");l&&l.animate([{transform:s?"translateY(-7px)":"translateX(-5px)"},{transform:s?"translateY(7px)":"translateX(5px)"},{transform:"translate(0)"}],{duration:300,easing:"cubic-bezier(0.65, 0, 0.35, 1)"})}},[i,r]}class ia extends ce{constructor(e){super(),ae(this,e,na,ta,le,{selectionLength:0})}}function ra(n){let e,t,i;return{c(){e=b("button"),e.textContent=`${U==="en"?"Automatic region extraction":"Extraction automatique des régions"}`,p(e,"class","button is-link is-light")},m(r,s){E(r,e,s),t||(i=ne(e,"click",n[1]),t=!0)},p:j,d(r){r&&S(e),t=!1,i()}}}function sa(n){let e,t,i,r=Vt.includes("regions"),s,l,o=r&&ra(n);return{c(){e=b("div"),t=b("button"),t.textContent=`${U==="en"?"Manually annotate":"Annoter manuellement"}`,i=N(),o&&o.c(),p(t,"class","button is-link"),p(e,"class","is-center buttons is-centered pt-5")},m(a,c){E(a,e,c),_(e,t),_(e,i),o&&o.m(e,null),s||(l=ne(t,"click",n[0]),s=!0)},p(a,[c]){r&&o.p(a,c)},i:j,o:j,d(a){a&&S(e),o&&o.d(),s=!1,l()}}}function la(n,e,t){const i=De("witness");let{currentRegionId:r}=e,{baseUrl:s}=e;async function l(){const a=`${window.location.origin}/${Ue}`;let c=`${a}/witness/${i.id}/regions/add`;if(i.regions.length===1||r){const f=r||i.regions[0];c=`${a}/witness/${i.id}/regions/${f}/add`}const u=await Ut(()=>fetch(c,{method:"POST",headers:{"X-CSRFToken":Xe}}));if(!u.ok)throw await $e(`Failed to create regions: '${u.statusText}'`,"Error"),new Error(`Failed to create regions: '${u.statusText}'`);let d;try{d=await u.json()}catch(f){throw await $e(`Failed to parse JSON response: '${f}'`,"Error"),new Error(`Failed to parse JSON response: '${f}'`)}d.hasOwnProperty("mirador_url")&&window.open(d.mirador_url),d.hasOwnProperty("regions_id")&&(window.location.href=`${s.split("regions/")[0]}regions/${d.regions_id}`)}async function o(){const a=`${window.location.origin}/${Ue}/witness/${i.id}/regions/extract`,c=await Ut(()=>fetch(a,{method:"POST",headers:{"X-CSRFToken":Xe}}));let u;if(c.ok)try{u=await c.json(),console.log(u)}catch(d){throw await $e(`Failed to parse JSON response: '${d}'`,"Error"),new Error(`Failed to parse JSON response: '${d}'`)}finally{const d=u.doc_set_id;if(!d)throw await $e("Failed to launch regions extraction: 'No document set id'","Error"),new Error("Failed to launch regions extraction: 'No document set id'");window.location.href=`${window.location.origin}/${Ue}/treatment/add/?document_set=${d}&task_type=regions`}else throw await $e(`Failed to launch regions extraction: '${u.message}'`,"Error"),new Error(`Failed to launch regions extraction: '${u.message}'`)}return n.$$set=a=>{"currentRegionId"in a&&t(2,r=a.currentRegionId),"baseUrl"in a&&t(3,s=a.baseUrl)},[l,o,r,s]}class Xs extends ce{constructor(e){super(),ae(this,e,la,sa,le,{currentRegionId:2,baseUrl:3})}}function ir(n,e,t){const i=n.slice();return i[7]=e[t],i}function oa(n){let e,t=n[3].regions,i=[];for(let r=0;r<t.length;r+=1)i[r]=rr(ir(n,t,r));return{c(){for(let r=0;r<i.length;r+=1)i[r].c();e=me()},m(r,s){for(let l=0;l<i.length;l+=1)i[l]&&i[l].m(r,s);E(r,e,s)},p(r,s){if(s&9){t=r[3].regions;let l;for(l=0;l<t.length;l+=1){const o=ir(r,t,l);i[l]?i[l].p(o,s):(i[l]=rr(o),i[l].c(),i[l].m(e.parentNode,e))}for(;l<i.length;l+=1)i[l].d(1);i.length=t.length}},d(r){it(i,r),r&&S(e)}}}function aa(n){let e,t;function i(l,o){if(o&4&&(e=null),e==null&&(e=!!["all","page"].includes(l[2])),e)return ua;if(l[2]==="similarity")return ca}let r=i(n,-1),s=r&&r(n);return{c(){s&&s.c(),t=me()},m(l,o){s&&s.m(l,o),E(l,t,o)},p(l,o){r===(r=i(l,o))&&s?s.p(l,o):(s&&s.d(1),s=r&&r(l),s&&(s.c(),s.m(t.parentNode,t)))},d(l){s&&s.d(l),l&&S(t)}}}function rr(n){let e,t,i=n[7]+"",r,s;return{c(){e=b("a"),t=G("Regions extraction #"),r=G(i),p(e,"href",s=""+(n[0]+n[7])),p(e,"class","tag is-dark mr-3 is-rounded")},m(l,o){E(l,e,o),_(e,t),_(e,r)},p(l,o){o&1&&s!==(s=""+(l[0]+l[7]))&&p(e,"href",s)},d(l){l&&S(e)}}}function ca(n){let e,t,i;return{c(){e=b("button"),e.textContent=`${U==="en"?"Delete all regions similarity":"Supprimer toutes les similarités du document"}`,p(e,"class","tag is-danger")},m(r,s){E(r,e,s),t||(i=ne(e,"click",n[6]),t=!0)},p:j,d(r){r&&S(e),t=!1,i()}}}function ua(n){let e,t,i,r,s,l;return{c(){e=b("a"),t=G("All regions"),i=N(),r=b("button"),r.textContent=`${U==="en"?"Delete regions extraction record":"Supprimer l'extraction de régions"}`,p(e,"href",n[4]),p(e,"class","tag is-dark mr-3 is-rounded"),p(r,"class","tag is-danger")},m(o,a){E(o,e,a),_(e,t),E(o,i,a),E(o,r,a),s||(l=ne(r,"click",n[5]),s=!0)},p:j,d(o){o&&S(e),o&&S(i),o&&S(r),s=!1,l()}}}function fa(n){let e,t;function i(l,o){if(o&4&&(t=null),l[1])return aa;if(t==null&&(t=!!["all","page","similarity"].includes(l[2])),t)return oa}let r=i(n,-1),s=r&&r(n);return{c(){e=b("div"),s&&s.c()},m(l,o){E(l,e,o),s&&s.m(e,null)},p(l,[o]){r===(r=i(l,o))&&s?s.p(l,o):(s&&s.d(1),s=r&&r(l),s&&(s.c(),s.m(e,null)))},i:j,o:j,d(l){l&&S(e),s&&s.d()}}}function da(n,e,t){const i=De("witness");let{baseUrl:r=`${window.location.origin}${window.location.pathname}`}=e,{currentRegionId:s}=e,{activeTab:l}=e;const o=r.replace(/\/\d+\/?$/,"");async function a(){if(!await $e(U==="en"?"Are you sure you want to delete this record?":"Voulez-vous vraiment supprimer cet enregistrement ?",U==="en"?"Confirm deletion":"Confirmer la suppression",!0))return;if(typeof s!="number")throw new Error("Invalid region ID");const d=`${window.location.origin}/${Ue}/regions/${s}/delete`;try{const f=await Ut(()=>fetch(d,{method:"DELETE",headers:{"X-CSRFToken":Xe}}));if(f.status!==204)throw new Error(`Failed to delete regions: '${f.statusText}'`);window.location.href=`${r.split("regions/")[0]}regions/`}catch(f){console.error(f)}}async function c(){if(!await $e(U==="en"?"Are you sure you want to delete all similarity scores for this document?":"Voulez-vous vraiment supprimer l'intégralité des scores de similarité pour ce document ?",U==="en"?"Confirm deletion":"Confirmer la suppression",!0))return;if(typeof s!="number")throw new Error("Invalid region ID");const d=`${window.location.origin}/${Ue}/similarity/reset/${s}`;try{const f=await Ut(()=>fetch(d,{method:"DELETE",headers:{"X-CSRFToken":Xe}}));if(f.status===204||f.status===200)window.location.href=`${r.split("regions/")[0]}regions/`;else throw new Error(`Failed to delete similarity: '${f.statusText}'`)}catch(f){console.error(f),await $e(f.message,"Error")}}return n.$$set=u=>{"baseUrl"in u&&t(0,r=u.baseUrl),"currentRegionId"in u&&t(1,s=u.currentRegionId),"activeTab"in u&&t(2,l=u.activeTab)},[r,s,l,i,o,a,c]}class ha extends ce{constructor(e){super(),ae(this,e,da,fa,le,{baseUrl:0,currentRegionId:1,activeTab:2})}}function ma(n){let e;return{c(){e=He("path"),p(e,"d","M471.6 21.7c-21.9-21.9-57.3-21.9-79.2 0L362.3 51.7l97.9 97.9 30.1-30.1c21.9-21.9 21.9-57.3 0-79.2L471.6 21.7zm-299.2 220c-6.1 6.1-10.8 13.6-13.5 21.9l-29.6 88.8c-2.9 8.6-.6 18.1 5.8 24.6s15.9 8.7 24.6 5.8l88.8-29.6c8.2-2.7 15.7-7.4 21.9-13.5L437.7 172.3 339.7 74.3 172.4 241.7zM96 64C43 64 0 107 0 160V416c0 53 43 96 96 96H352c53 0 96-43 96-96V320c0-17.7-14.3-32-32-32s-32 14.3-32 32v96c0 17.7-14.3 32-32 32H96c-17.7 0-32-14.3-32-32V160c0-17.7 14.3-32 32-32h96c17.7 0 32-14.3 32-32s-14.3-32-32-32H96z"),p(e,"class","svelte-h0t5l9")},m(t,i){E(t,e,i)},d(t){t&&S(e)}}}function pa(n){let e;return{c(){e=He("path"),p(e,"d","M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"),p(e,"class","svelte-h0t5l9")},m(t,i){E(t,e,i)},d(t){t&&S(e)}}}function ga(n){let e=U==="en"?"Edit":"Modifier",t;return{c(){t=G(e)},m(i,r){E(i,t,r)},p:j,d(i){i&&S(t)}}}function _a(n){let e=U==="en"?"Validate":"Valider",t;return{c(){t=G(e)},m(i,r){E(i,t,r)},p:j,d(i){i&&S(t)}}}function sr(n){let e,t,i,r=U==="en"?"Reload":"Recharger",s,l,o,a,c,u=U==="en"?"Go to editor":"Aller à l'éditeur",d,f,h,m,g,v=U==="en"?"Delete selected regions":"Supprimer les régions sélectionnées",w,I,R;return{c(){e=b("button"),t=b("i"),i=N(),s=G(r),l=N(),o=b("a"),a=b("i"),c=N(),d=G(u),f=N(),h=b("button"),m=b("i"),g=N(),w=G(v),p(t,"class","fa-solid fa-rotate-right"),p(e,"class","tag is-link is-light is-rounded mr-3"),p(a,"class","fa-solid fa-edit"),p(o,"class","tag is-link is-rounded mr-3"),p(o,"href",Ft(n[4])),p(o,"target","_blank"),p(m,"class","fa-solid fa-trash"),p(h,"class","tag is-danger is-rounded")},m(C,O){E(C,e,O),_(e,t),_(e,i),_(e,s),E(C,l,O),E(C,o,O),_(o,a),_(o,c),_(o,d),E(C,f,O),E(C,h,O),_(h,m),_(h,g),_(h,w),I||(R=[ne(e,"click",n[14]),ne(h,"click",n[6])],I=!0)},p:j,d(C){C&&S(e),C&&S(l),C&&S(o),C&&S(f),C&&S(h),I=!1,Ce(R)}}}function va(n){let e,t,i,r,s,l,o,a,c,u,d,f,h,m,g=U==="en"?"Download":"Télécharger",v,w,I,R,C;function O(V,te){return V[0]?pa:ma}let L=O(n),A=L(n);function y(V,te){return V[0]?_a:ga}let D=y(n),Z=D(n),se=n[0]&&sr(n);return{c(){e=b("div"),t=b("button"),i=He("svg"),A.c(),r=N(),Z.c(),l=N(),o=b("button"),a=b("i"),c=N(),u=b("span"),u.textContent=`${U==="en"?"Select all":"Tout sélectionner"}`,d=N(),f=b("button"),h=b("i"),m=N(),v=G(g),w=N(),I=b("div"),se&&se.c(),p(i,"xmlns","http://www.w3.org/2000/svg"),p(i,"viewBox","0 0 384 512"),p(i,"class","pr-3 svelte-h0t5l9"),p(t,"class",s="button "+(n[0]?"is-success":"is-link")+" mr-3"),p(a,"class","fa-solid fa-square-check"),p(u,"id","all-selection"),p(o,"class","button is-link is-light mr-3"),p(h,"class","fa-solid fa-download"),p(f,"class","button is-link is-light"),p(e,"class","is-right mb-3"),p(I,"class","edit-action is-right svelte-h0t5l9")},m(V,te){E(V,e,te),_(e,t),_(t,i),A.m(i,null),_(t,r),Z.m(t,null),_(e,l),_(e,o),_(o,a),_(o,c),_(o,u),_(e,d),_(e,f),_(f,h),_(f,m),_(f,v),E(V,w,te),E(V,I,te),se&&se.m(I,null),R||(C=[ne(t,"click",n[13]),ne(o,"click",n[7]),ne(f,"click",n[8])],R=!0)},p(V,[te]){L!==(L=O(V))&&(A.d(1),A=L(V),A&&(A.c(),A.m(i,null))),D===(D=y(V))&&Z?Z.p(V,te):(Z.d(1),Z=D(V),Z&&(Z.c(),Z.m(t,null))),te&1&&s!==(s="button "+(V[0]?"is-success":"is-link")+" mr-3")&&p(t,"class",s),V[0]?se?se.p(V,te):(se=sr(V),se.c(),se.m(I,null)):se&&(se.d(1),se=null)},i:j,o:j,d(V){V&&S(e),A.d(),Z.d(),V&&S(w),V&&S(I),se&&se.d(),R=!1,Ce(C)}}}async function ba(n){const e=n.id_full,t=`${SAS_APP_URL}/annotation/destroy?uri=${e}`,i=await fetch(t,{method:"DELETE"});if(i.status!==204)throw new Error(`Failed to delete ${t} due to ${i.status}: '${i.statusText}'`)}function wa(n,e,t){let i,r,s,l,o,a,c;const{selected:u,nbSelected:d}=_t;ue(n,u,O=>t(11,a=O)),ue(n,d,O=>t(12,c=O));const{allRegions:f}=wt;ue(n,f,O=>t(10,o=O));const h=De("manifest"),m=De("isValidated");function g(){t(0,r=!r)}async function v(){if(await $e(U==="en"?"Are you sure you want to delete these regions?":"Voulez-vous vraiment supprimer ces régions ?",U==="en"?"Confirm deletion":"Confirmer la suppression",!0))for(const[L,A]of Object.entries(s))try{if(!o.hasOwnProperty(L))continue;await ba(A),wt.remove(L),_t.remove(L,ln)}catch(y){await $e(`Failed to delete region ${L}: ${y.message}`,"Error")}}function w(){l?_t.removeAll(Object.keys(o),ln):_t.addAll(Object.values(o))}async function I(){const O=Object.values(s).map(y=>y.ref),A=await(await Ut(()=>fetch(`${window.location.origin}/${Ue}/regions/export`,{method:"POST",headers:{"X-CSRFToken":Xe},body:JSON.stringify({regionsRef:O})}))).blob();Ws(A,"regions.zip")}const R=()=>g(),C=()=>location.reload();return n.$$.update=()=>{n.$$.dirty&4096&&t(9,i=c),n.$$.dirty&2048&&(s=Object.values(a)[0]||{}),n.$$.dirty&1536&&(l=i>=Object.keys(o).length)},t(0,r=!m),[r,u,d,f,h,g,v,w,I,i,o,a,c,R,C]}class ya extends ce{constructor(e){super(),ae(this,e,wa,va,le,{})}}function ka(){const n=`${window.location.origin}${window.location.pathname}`,e=25,t=window.location.pathname.match(/\d+/g).join("-"),i={[t]:{}},r=[2,6],s=Oe(1),l=Oe({}),o=Oe(JSON.parse(localStorage.getItem("selectedRegions"))||i);o.subscribe(V=>localStorage.setItem("selectedRegions",JSON.stringify(V)));const a=Oe(JSON.parse(localStorage.getItem("excludedCategories"))||[]);a.subscribe(V=>localStorage.setItem("excludedCategories",JSON.stringify(V)));const c=Oe(JSON.parse(localStorage.getItem("similarityScoreCutoff"))||void 0);c.subscribe(V=>{V!=null&&localStorage.setItem("similarityScoreCutoff",JSON.stringify(V))});const u=Oe(JSON.parse(localStorage.getItem("propagateRecursionDepth"))||r[1]);u.subscribe(V=>localStorage.setItem("propagateRecursionDepth",JSON.stringify(V)));const d=Oe(JSON.parse(localStorage.getItem("propagateFilterByRegions"))||!1);d.subscribe(V=>localStorage.setItem("propagateFilterByRegions",JSON.stringify(V)));const f=xe([u,d],([V,te])=>({propagateRecursionDepth:V,propagateFilterByRegions:te})),h=xe([a,o,c],([V,te,X])=>({excludedCategories:V,regions:te,similarityScoreCutoff:X})),m=xe([f,h],([V,te])=>({propagate:V,similarity:te})),g=Oe([]),v=Oe([]);async function w(){const V=async()=>{const H=await(await fetch(`${n}compared-regions`)).json();l.set(H),o.update(q=>{let re=q[t]||{};if(Object.keys(re).length){let F=Object.keys(re).filter(Y=>Object.keys(H).includes(Y)).reduce((Y,ee)=>(Y[ee]=re[ee],Y),{});q[t]=F}return q})},te=async()=>{const H=await(await fetch(`${n}query-images`)).json();H.length>0&&(g.set(H),Z(A()))};Ot.set(!0);try{await Promise.all([V(),te()])}catch(X){console.error("Error:",X),qs.set(X.message)}finally{Ot.set(!1)}}function I(V){localStorage.setItem("selectedRegions",JSON.stringify(V))}function R(V){o.update(te=>{const X={...te};return delete X[t][V],I(X),X})}function C(V){o.update(te=>{const X={...te,[t]:{...te[t]||{},[V.ref]:V}};return I(X),X})}const O=xe(o,V=>te=>{var X;return(X=V[t])==null?void 0:X.hasOwnProperty(te)});function L(V){const te=hi(l),X=Object.keys(te).filter(H=>H.startsWith(V));return X.length!==1?{title:"Error"}:te[X[0]]}const A=()=>gi(s,"sp"),y=xe([s,g],([V,te])=>(async()=>D(V,te))());function D(V,te){const X=(V-1)*e,H=X+e,q=te.slice(X,H);return v.set(q),q}function Z(V){_i(V,s,"sp")}function se(V){l.update(te=>({...te,[V.ref]:V}))}return{currentPage:s,comparedRegions:l,excludedCategories:a,qImgs:g,pageQImgs:v,selectedRegions:o,propagateRecursionDepth:u,propagateFilterByRegions:d,similarityToolbarParams:m,propagateParams:f,similarityScoreCutoff:c,allowedPropagateDepthRange:r,fetchSimilarity:w,setPageQImgs:y,getRegionsInfo:L,handlePageUpdate:Z,unselect:R,select:C,addComparedRegions:se,isSelected:O,pageLength:e}}const Je=ka();function Sa(n){let e,t,i;const r=n[1].default,s=qe(r,n,n[0],null);return{c(){e=b("table"),t=b("tbody"),s&&s.c(),p(e,"class","table is-fullwidth")},m(l,o){E(l,e,o),_(e,t),s&&s.m(t,null),i=!0},p(l,[o]){s&&s.p&&(!i||o&1)&&ze(s,r,l,l[0],i?Be(r,l[0],o,null):Ke(l[0]),null)},i(l){i||(P(s,l),i=!0)},o(l){M(s,l),i=!1},d(l){l&&S(e),s&&s.d(l)}}}function Ea(n,e,t){let{$$slots:i={},$$scope:r}=e;return n.$$set=s=>{"$$scope"in s&&t(0,r=s.$$scope)},[r,i]}class Dn extends ce{constructor(e){super(),ae(this,e,Ea,Sa,le,{})}}function lr(n){let e,t,i,r,s,l,o,a,c,u=n[5]>1&&or(n),d=n[5]<n[3]&&ur(n);return{c(){e=b("nav"),t=b("ul"),u&&u.c(),i=N(),r=b("li"),s=b("a"),l=G(n[5]),o=N(),d&&d.c(),p(s,"class","pagination-link is-current"),p(s,"href",null),p(t,"class","pagination-list ml-0"),p(e,"class","pagination is-centered mb-2"),p(e,"aria-label","pagination")},m(f,h){E(f,e,h),_(e,t),u&&u.m(t,null),_(t,i),_(t,r),_(r,s),_(s,l),_(t,o),d&&d.m(t,null),a||(c=ne(s,"click",yt(n[9])),a=!0)},p(f,h){f[5]>1?u?u.p(f,h):(u=or(f),u.c(),u.m(t,i)):u&&(u.d(1),u=null),h&32&&de(l,f[5]),f[5]<f[3]?d?d.p(f,h):(d=ur(f),d.c(),d.m(t,null)):d&&(d.d(1),d=null)},d(f){f&&S(e),u&&u.d(),d&&d.d(),a=!1,c()}}}function or(n){let e,t,i,r,s,l,o=n[5]-1>1&&ar(n);return{c(){e=b("li"),t=b("a"),t.textContent="1",i=N(),o&&o.c(),r=me(),p(t,"class","pagination-link"),p(t,"href",null)},m(a,c){E(a,e,c),_(e,t),E(a,i,c),o&&o.m(a,c),E(a,r,c),s||(l=ne(t,"click",yt(n[7])),s=!0)},p(a,c){a[5]-1>1?o?o.p(a,c):(o=ar(a),o.c(),o.m(r.parentNode,r)):o&&(o.d(1),o=null)},d(a){a&&S(e),a&&S(i),o&&o.d(a),a&&S(r),s=!1,l()}}}function ar(n){let e,t,i,r=n[5]-1+"",s,l,o,a=n[5]-1>2&&cr();return{c(){a&&a.c(),e=N(),t=b("li"),i=b("a"),s=G(r),p(i,"class","pagination-link"),p(i,"href",null)},m(c,u){a&&a.m(c,u),E(c,e,u),E(c,t,u),_(t,i),_(i,s),l||(o=ne(i,"click",yt(n[8])),l=!0)},p(c,u){c[5]-1>2?a||(a=cr(),a.c(),a.m(e.parentNode,e)):a&&(a.d(1),a=null),u&32&&r!==(r=c[5]-1+"")&&de(s,r)},d(c){a&&a.d(c),c&&S(e),c&&S(t),l=!1,o()}}}function cr(n){let e;return{c(){e=b("li"),e.innerHTML='<span class="pagination-ellipsis">…</span>'},m(t,i){E(t,e,i)},d(t){t&&S(e)}}}function ur(n){let e,t,i,r,s,l,o=n[5]+1<n[3]&&fr(n);return{c(){o&&o.c(),e=N(),t=b("li"),i=b("a"),r=G(n[3]),p(i,"class","pagination-link"),p(i,"href",null)},m(a,c){o&&o.m(a,c),E(a,e,c),E(a,t,c),_(t,i),_(i,r),s||(l=ne(i,"click",yt(n[11])),s=!0)},p(a,c){a[5]+1<a[3]?o?o.p(a,c):(o=fr(a),o.c(),o.m(e.parentNode,e)):o&&(o.d(1),o=null),c&8&&de(r,a[3])},d(a){o&&o.d(a),a&&S(e),a&&S(t),s=!1,l()}}}function fr(n){let e,t,i=n[5]+1+"",r,s,l,o,a,c=n[5]+2<n[3]&&dr();return{c(){e=b("li"),t=b("a"),r=G(i),s=N(),c&&c.c(),l=me(),p(t,"class","pagination-link"),p(t,"href",null)},m(u,d){E(u,e,d),_(e,t),_(t,r),E(u,s,d),c&&c.m(u,d),E(u,l,d),o||(a=ne(t,"click",yt(n[10])),o=!0)},p(u,d){d&32&&i!==(i=u[5]+1+"")&&de(r,i),u[5]+2<u[3]?c||(c=dr(),c.c(),c.m(l.parentNode,l)):c&&(c.d(1),c=null)},d(u){u&&S(e),u&&S(s),c&&c.d(u),u&&S(l),o=!1,a()}}}function dr(n){let e;return{c(){e=b("li"),e.innerHTML='<span class="pagination-ellipsis">…</span>'},m(t,i){E(t,e,i)},d(t){t&&S(e)}}}function Ca(n){let e,t,i=n[5]*n[2]-n[2]+1+"",r,s,l=Math.min(n[5]*n[2],n[1])+"",o,a,c,u,d=n[4]&&lr(n);return{c(){d&&d.c(),e=N(),t=b("div"),r=G(i),s=G(" - "),o=G(l),a=G(" / "),c=G(n[1]),p(t,"class",u="is-size-7 is-center mb-4 "+(n[4]?"":"mt-4"))},m(f,h){d&&d.m(f,h),E(f,e,h),E(f,t,h),_(t,r),_(t,s),_(t,o),_(t,a),_(t,c)},p(f,[h]){f[4]?d?d.p(f,h):(d=lr(f),d.c(),d.m(e.parentNode,e)):d&&(d.d(1),d=null),h&36&&i!==(i=f[5]*f[2]-f[2]+1+"")&&de(r,i),h&38&&l!==(l=Math.min(f[5]*f[2],f[1])+"")&&de(o,l),h&2&&de(c,f[1]),h&16&&u!==(u="is-size-7 is-center mb-4 "+(f[4]?"":"mt-4"))&&p(t,"class",u)},i:j,o:j,d(f){d&&d.d(f),f&&S(e),f&&S(t)}}}function Ia(n,e,t){let i,r,s,{store:l}=e;const{currentPage:o}=l;ue(n,o,g=>t(5,s=g));let{nbOfItems:a}=e,{pageLength:c=Oo}=e;const u=()=>l.handlePageUpdate(1),d=()=>l.handlePageUpdate(s-1),f=()=>l.handlePageUpdate(s),h=()=>l.handlePageUpdate(s+1),m=()=>l.handlePageUpdate(i);return n.$$set=g=>{"store"in g&&t(0,l=g.store),"nbOfItems"in g&&t(1,a=g.nbOfItems),"pageLength"in g&&t(2,c=g.pageLength)},n.$$.update=()=>{n.$$.dirty&6&&t(3,i=c>0?Math.ceil(a/c):1),n.$$.dirty&14&&t(4,r=i>1||a>c)},[l,a,c,i,r,s,o,u,d,f,h,m]}class Ht extends ce{constructor(e){super(),ae(this,e,Ia,Ca,le,{store:0,nbOfItems:1,pageLength:2})}}const wi=(n,e,t,i)=>({id:n,img:n,title:`Canvas ${i} - ${t} - ${U==="en"?"Witness":"Témoin"} #${Bs(e)}`,xywh:t.split(",").map(Number),canvas:i,ref:n.replace(".jpg",""),type:ln}),Oa=`<svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 59 59">
        <rect x="1" y="0.62" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>
    </svg>`,Qs=`<svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 68 69">
        <rect x="10" y="10.62" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>
        <rect x="1" y="1" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>
        <rect x="10" y="10.62" width="46" height="45.71" rx="4.11" ry="4.11" fill="currentColor" stroke="none"/>
    </svg>`,Zs=`<svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 70 71">
        <rect x="12" y="12.43" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>
        <rect x="1" y="0.81" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>
        <path d="M 12 21.43 L 21 12.43" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
        <path d="M 12 30 L 30 12.43" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
        <path d="M 40 56 L 57 38" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
        <path d="M 48.3 56.29 L 57 47" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
        <path d="M 12 39 L 39 12" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
        <path d="M 12 48 L 48 12" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
        <path d="M 13 56 L 57 12" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
        <path d="M 31 56 L 57 29" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
        <path d="M 21 57 L 57 21" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
    </svg>`,el=`<svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 72 73">
        <rect x="14" y="14.43" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3" stroke-dasharray="9 9"/>
        <rect x="1" y="0.81" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>
    </svg>`,tl=`<svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 59 59">
        <rect x="1" y="0.62" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>
        <path d="M 2.67 54.55 L 55 2" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
        <path d="M 54.37 54.05 L 2.72 2.24" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>
    </svg>`,nl=`<svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 59 59">
        <rect x="1" y="0.81" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>
        <path d="M 8.69 55.28 C 9.25 44.15 18.08 35.28 28.86 35.28 C 32.5 35.28 36.07 36.3 39.18 38.25 C 44.96 41.85 48.66 48.3 49.02 55.28 Z M 17.85 21.48 C 17.85 15.37 22.79 10.39 28.86 10.39 C 34.92 10.39 39.86 15.37 39.86 21.48 C 39.86 27.59 34.92 32.56 28.86 32.56 C 22.79 32.56 17.85 27.59 17.85 21.48 Z M 40.37 36.34 C 38.43 35.13 36.32 34.25 34.13 33.7 C 38.82 31.64 42.1 26.94 42.1 21.48 C 42.1 14.13 36.16 8.15 28.86 8.15 C 21.55 8.15 15.61 14.13 15.61 21.48 C 15.61 26.95 18.9 31.66 23.6 33.71 C 13.76 36.18 6.41 45.4 6.41 56.4 C 6.41 57.02 6.92 57.52 7.54 57.52 L 50.17 57.52 C 50.79 57.52 51.3 57.02 51.3 56.4 C 51.3 48.23 47.11 40.54 40.37 36.34 Z" fill="currentColor" stroke="none"/>
    </svg>`,Aa=U==="en"?"no categorization":"aucune catégorisation",il=U==="en"?"overall visual matches":"correspondances visuelles globales",rl=U==="en"?"visual matches on part of the image":"correspondances visuelles sur une partie de l'image",sl=U==="en"?"semantic and non-visual matches":"correspondances sémantiques et non-visuelle",ll=U==="en"?"regions without match":"régions sans correspondance",ol=U==="en"?"user specific category":"correspondances spécifiques à l'utilisateur",wn={0:{title:Aa,svg:Oa},1:{title:il,svg:Qs},2:{title:rl,svg:Zs},3:{title:sl,svg:el},4:{title:ll,svg:tl},5:{title:ol,svg:nl}};function Ta(n){let e,t=wn[n[2]].svg+"",i,r,s,l;return{c(){e=b("span"),p(e,"class",i="tag py-4 "+n[4]+" "+(n[0]?"is-hoverable":"")),p(e,"title",r=wn[n[2]].title),ke(e,"is-selected",n[1])},m(o,a){E(o,e,a),e.innerHTML=t,s||(l=[ne(e,"click",n[5]),ne(e,"keyup",null)],s=!0)},p(o,[a]){a&4&&t!==(t=wn[o[2]].svg+"")&&(e.innerHTML=t),a&17&&i!==(i="tag py-4 "+o[4]+" "+(o[0]?"is-hoverable":""))&&p(e,"class",i),a&4&&r!==(r=wn[o[2]].title)&&p(e,"title",r),a&19&&ke(e,"is-selected",o[1])},i:j,o:j,d(o){o&&S(e),s=!1,Ce(l)}}}function Pa(n,e,t){let{selectable:i=!0}=e,{isSelected:r=!1}=e,{category:s}=e,{toggle:l=()=>{}}=e,{padding:o="px-2"}=e;const a=()=>l(s);return n.$$set=c=>{"selectable"in c&&t(0,i=c.selectable),"isSelected"in c&&t(1,r=c.isSelected),"category"in c&&t(2,s=c.category),"toggle"in c&&t(3,l=c.toggle),"padding"in c&&t(4,o=c.padding)},[i,r,s,l,o,a]}class Zt extends ce{constructor(e){super(),ae(this,e,Pa,Ta,le,{selectable:0,isSelected:1,category:2,toggle:3,padding:4})}}class ni{constructor(e){this.id=e.id,this.img=e.img??e.ref,this.title=e.title,this.xywh=Array.isArray(e.xywh)?e.xywh.map(Number):e.xywh,this.canvas=e.canvas,this.ref=e.ref,this.type=e.type??ln}url(e=null,t=null){return nt(this.img,e??this.xywh??"full",t??"full")}}function La(n){let e,t,i;return{c(){e=b("span"),t=G(n[0]),p(e,"id",n[3]),p(e,"class",i="tooltip "+n[2]+" "+(n[1]?"display":"")+" svelte-1vbe6c4")},m(r,s){E(r,e,s),_(e,t)},p(r,[s]){s&1&&de(t,r[0]),s&6&&i!==(i="tooltip "+r[2]+" "+(r[1]?"display":"")+" svelte-1vbe6c4")&&p(e,"class",i)},i:j,o:j,d(r){r&&S(e)}}}function Ma(n,e,t){let i,r,s,l,{tooltipText:o}=e,{targetHtmlId:a}=e;const c=`tooltip-generic-${window.crypto.randomUUID()}`,u=()=>t(1,l=!0),d=()=>t(1,l=!1),f=()=>t(1,l=!l);return mt(()=>{s=a?document.getElementById(a):document.getElementById(c).parentElement,a&&!s&&(console.error(`TooltipGeneric: element with ID ${a} not found, defaulting to the parent element`),s=document.getElementById(c).targetElement),s.addEventListener("mouseover",u),s.addEventListener("mouseout",d),s.addEventListener("click",f)}),cn(()=>{s.removeEventListener("mouseover",u),s.removeEventListener("mouseout",d),s.removeEventListener("click",f)}),n.$$set=h=>{"tooltipText"in h&&t(0,o=h.tooltipText),"targetHtmlId"in h&&t(4,a=h.targetHtmlId)},n.$$.update=()=>{n.$$.dirty&33&&t(2,i=r(o))},t(5,r=h=>t(2,i=h.length>100?"tooltip-wide":h.length>20?"tooltip-mid":"tooltip-thin")),s=void 0,t(1,l=!1),[o,l,i,c,a,r]}class fn extends ce{constructor(e){super(),ae(this,e,Ma,La,le,{tooltipText:0,targetHtmlId:4})}}function $a(n){let e,t,i,r,s,l,o,a,c,u,d;return a=new fn({props:{targetHtmlId:n[1],tooltipText:n[2]}}),{c(){e=b("div"),t=b("button"),i=He("svg"),r=He("path"),s=He("path"),l=He("path"),o=N(),W(a.$$.fragment),p(r,"d","M53.6443 14.25C47.7042 5.33 37.7293 0 26.9801 0C16.2206 0 6.24576 5.33 0.305653 14.25L0 14.71L0.305653 15.17C6.24576 24.09 16.2206 29.42 26.9801 29.42C37.7293 29.42 47.7042 24.09 53.6443 15.16L53.95 14.71L53.6443 14.25ZM3.25025 14.71C7.63146 8.69001 14.0606 4.65 21.2641 3.22C20.0619 3.83 18.9411 4.62 17.963 5.59C15.5176 8.02 14.1625 11.25 14.1625 14.67C14.1625 18.11 15.5176 21.34 17.963 23.76C19.0124 24.79 20.1943 25.61 21.4781 26.23C14.1829 24.85 7.6824 20.78 3.25025 14.71ZM27.1125 22.64C22.7008 22.64 19.1041 19.08 19.1041 14.7C19.1041 12.59 19.9396 10.6 21.4475 9.10001C22.9555 7.60001 24.9729 6.77 27.1125 6.77C29.2522 6.77 31.2594 7.60001 32.7775 9.10001C34.2855 10.6 35.121 12.59 35.121 14.7C35.121 16.82 34.2855 18.82 32.7775 20.32C31.2594 21.81 29.242 22.64 27.1125 22.64ZM32.9915 26.14C34.204 25.53 35.3146 24.74 36.3029 23.77C38.7482 21.34 40.0932 18.11 40.0932 14.68C40.0932 9.75 37.281 5.47001 33.1647 3.32001C40.1747 4.81001 46.4102 8.83001 50.6896 14.71C46.3797 20.64 40.0728 24.67 32.9915 26.14Z"),p(r,"class","svelte-109pj58"),p(s,"d","M26.9804 25.98C33.3222 25.98 38.4633 20.9343 38.4633 14.71C38.4633 8.48576 33.3222 3.44 26.9804 3.44C20.6386 3.44 15.4976 8.48576 15.4976 14.71C15.4976 20.9343 20.6386 25.98 26.9804 25.98Z"),p(s,"class","svelte-109pj58"),p(l,"d","M17.9529 23.85L36.2928 5.85001"),p(l,"stroke-width","3"),p(l,"stroke-miterlimit","10"),p(l,"class","svelte-109pj58"),p(i,"width","54"),p(i,"height","30"),p(i,"viewBox","0 0 54 30"),p(i,"fill","none"),p(i,"xmlns","http://www.w3.org/2000/svg"),p(i,"class","svelte-109pj58"),p(t,"class","button tag svelte-109pj58"),p(t,"title",n[2]),p(e,"id",n[1])},m(f,h){E(f,e,h),_(e,t),_(t,i),_(i,r),_(i,s),_(i,l),_(t,o),z(a,t,null),c=!0,u||(d=ne(t,"click",Fs(n[3])),u=!0)},p:j,i(f){c||(P(a.$$.fragment,f),c=!0)},o(f){M(a.$$.fragment,f),c=!1},d(f){f&&S(e),K(a),u=!1,d()}}}function Ra(n){const e=zt(),t=`modal-opener-${window.crypto.randomUUID()}`;return[e,t,U==="fr"?"Vue détaillée":"Detailed view",()=>e("open")]}class al extends ce{constructor(e){super(),ae(this,e,Ra,$a,le,{})}}const Da=n=>({}),hr=n=>({});function mr(n){let e,t,i,r,s,l;function o(h,m){return h[11]?ja:Na}let a=o(n),c=a(n);function u(h,m){return h[11]?Ua:Va}let d=u(n),f=d(n);return{c(){e=b("button"),t=He("svg"),c.c(),i=N(),r=b("span"),f.c(),p(t,"xmlns","http://www.w3.org/2000/svg"),p(t,"viewBox","0 0 384 512"),p(t,"class","svelte-qw3irp"),p(r,"class","tooltip"),p(e,"class","button tag")},m(h,m){E(h,e,m),_(e,t),c.m(t,null),_(e,i),_(e,r),f.m(r,null),s||(l=ne(e,"click",Fs(n[20])),s=!0)},p(h,m){a!==(a=o(h))&&(c.d(1),c=a(h),c&&(c.c(),c.m(t,null))),d===(d=u(h))&&f?f.p(h,m):(f.d(1),f=d(h),f&&(f.c(),f.m(r,null)))},d(h){h&&S(e),c.d(),f.d(),s=!1,l()}}}function Na(n){let e;return{c(){e=He("path"),p(e,"d","M384 336H192c-8.8 0-16-7.2-16-16V64c0-8.8 7.2-16 16-16l140.1 0L400 115.9V320c0 8.8-7.2 16-16 16zM192 384H384c35.3 0 64-28.7 64-64V115.9c0-12.7-5.1-24.9-14.1-33.9L366.1 14.1c-9-9-21.2-14.1-33.9-14.1H192c-35.3 0-64 28.7-64 64V320c0 35.3 28.7 64 64 64zM64 128c-35.3 0-64 28.7-64 64V448c0 35.3 28.7 64 64 64H256c35.3 0 64-28.7 64-64V416H272v32c0 8.8-7.2 16-16 16H64c-8.8 0-16-7.2-16-16V192c0-8.8 7.2-16 16-16H96V128H64z"),p(e,"class","svelte-qw3irp")},m(t,i){E(t,e,i)},d(t){t&&S(e)}}}function ja(n){let e;return{c(){e=He("path"),p(e,"d","M208 0H332.1c12.7 0 24.9 5.1 33.9 14.1l67.9 67.9c9 9 14.1 21.2 14.1 33.9V336c0 26.5-21.5 48-48 48H208c-26.5 0-48-21.5-48-48V48c0-26.5 21.5-48 48-48zM48 128h80v64H64V448H256V416h64v48c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V176c0-26.5 21.5-48 48-48z"),p(e,"class","svelte-qw3irp")},m(t,i){E(t,e,i)},d(t){t&&S(e)}}}function Va(n){let e=U==="en"?"Copy ID":"Copier l'ID",t;return{c(){t=G(e)},m(i,r){E(i,t,r)},p:j,d(i){i&&S(t)}}}function Ua(n){let e=U==="en"?"Copied!":"Copié !",t;return{c(){t=G(e)},m(i,r){E(i,t,r)},p:j,d(i){i&&S(t)}}}function pr(n){let e,t;return e=new al({}),e.$on("open",n[13]),{c(){W(e.$$.fragment)},m(i,r){z(e,i,r),t=!0},p:j,i(i){t||(P(e.$$.fragment,i),t=!0)},o(i){M(e.$$.fragment,i),t=!1},d(i){K(e,i)}}}function Fa(n){let e,t,i,r,s,l,o,a=n[9].title+"",c,u,d,f,h,m,g,v,w,I,R,C=n[5]&&mr(n),O=!n[6]&&pr(n);const L=n[18].actions,A=qe(L,n,n[17],hr);return{c(){e=b("div"),t=b("figure"),i=b("img"),s=N(),l=b("div"),o=b("span"),d=N(),f=b("div"),C&&C.c(),h=N(),O&&O.c(),m=N(),A&&A.c(),p(i,"class","region-img svelte-qw3irp"),Re(i.src,r=n[10])||p(i,"src",r),p(i,"alt","Extracted region"),p(o,"class","overlay-desc"),p(l,"class","overlay is-center svelte-qw3irp"),p(t,"class",c="image card region-image "+(n[0]?"is-96x96":"")+" svelte-qw3irp"),p(t,"tabindex","-1"),p(t,"style",u=(n[8]==="full"?"height: 100%":`height: ${n[8]}px; min-width: ${n[8]}px`)+"; "+(n[4]?`border: 5px solid ${n[4]};`:"")),p(f,"class","region-btn ml-1"),p(e,"class","region is-center svelte-qw3irp"),p(e,"style",g=n[8]==="full"?"height: 100%":""),ke(e,"checked",n[3])},m(y,D){E(y,e,D),_(e,t),_(t,i),_(t,s),_(t,l),_(l,o),o.innerHTML=a,_(e,d),_(e,f),C&&C.m(f,null),_(f,h),O&&O.m(f,null),_(f,m),A&&A.m(f,null),w=!0,I||(R=[ne(t,"click",n[19]),ne(t,"keyup",null)],I=!0)},p(y,[D]){(!w||D&1024&&!Re(i.src,r=y[10]))&&p(i,"src",r),(!w||D&512)&&a!==(a=y[9].title+"")&&(o.innerHTML=a),(!w||D&1&&c!==(c="image card region-image "+(y[0]?"is-96x96":"")+" svelte-qw3irp"))&&p(t,"class",c),(!w||D&272&&u!==(u=(y[8]==="full"?"height: 100%":`height: ${y[8]}px; min-width: ${y[8]}px`)+"; "+(y[4]?`border: 5px solid ${y[4]};`:"")))&&p(t,"style",u),y[5]?C?C.p(y,D):(C=mr(y),C.c(),C.m(f,h)):C&&(C.d(1),C=null),y[6]?O&&(be(),M(O,1,1,()=>{O=null}),we()):O?(O.p(y,D),D&64&&P(O,1)):(O=pr(y),O.c(),P(O,1),O.m(f,m)),A&&A.p&&(!w||D&131072)&&ze(A,L,y,y[17],w?Be(L,y[17],D,Da):Ke(y[17]),hr),(!w||D&256&&g!==(g=y[8]==="full"?"height: 100%":""))&&p(e,"style",g),(!w||D&8)&&ke(e,"checked",y[3])},i(y){w||(P(O),P(A,y),et(()=>{w&&(v||(v=ot(e,bt,{duration:10},!0)),v.run(1))}),w=!0)},o(y){M(O),M(A,y),v||(v=ot(e,bt,{duration:10},!1)),v.run(0),w=!1},d(y){y&&S(e),C&&C.d(),O&&O.d(),A&&A.d(y),y&&v&&v.end(),I=!1,Ce(R)}}}function Ha(n,e,t){let i,r,s,l,{$$slots:o={},$$scope:a}=e;const{clipBoard:c}=wt;ue(n,c,D=>t(16,l=D));let{selectionStore:u}=e;u||(u=_t);let{toggleSelection:d=u.toggle}=e,{item:f}=e,{index:h=null}=e,{selected:m=!1}=e,{borderColor:g=null}=e,{copyable:v=!1}=e,{isInModal:w=!1}=e,{selectable:I=!w}=e,{isSquare:R=!1}=e,{height:C=R?96:140}=e;C==="full"&&(R=!1);const O=zt(),L=()=>w?null:O("openModal",{index:h}),A=()=>I?d(i):L(),y=()=>wt.copyRef(f.ref);return n.$$set=D=>{"selectionStore"in D&&t(14,u=D.selectionStore),"toggleSelection"in D&&t(1,d=D.toggleSelection),"item"in D&&t(2,f=D.item),"index"in D&&t(15,h=D.index),"selected"in D&&t(3,m=D.selected),"borderColor"in D&&t(4,g=D.borderColor),"copyable"in D&&t(5,v=D.copyable),"isInModal"in D&&t(6,w=D.isInModal),"selectable"in D&&t(7,I=D.selectable),"isSquare"in D&&t(0,R=D.isSquare),"height"in D&&t(8,C=D.height),"$$scope"in D&&t(17,a=D.$$scope)},n.$$.update=()=>{n.$$.dirty&4&&t(9,i=new ni(f)),n.$$.dirty&66048&&t(11,r=i.ref===l),n.$$.dirty&769&&t(10,s=i.url(null,C==="full"?"full":R?`${C},`:`,${C}`))},[R,d,f,m,g,v,w,I,C,i,s,r,c,L,u,h,l,a,o,A,y]}class qt extends ce{constructor(e){super(),ae(this,e,Ha,Fa,le,{selectionStore:14,toggleSelection:1,item:2,index:15,selected:3,borderColor:4,copyable:5,isInModal:6,selectable:7,isSquare:0,height:8})}}function qa(n){let e,t,i,r,s,l,o,a,c,u,d;return t=new Zt({props:{category:1,isSelected:n[1]===1,toggle:n[5],padding:"pl-3 pr-2"}}),r=new Zt({props:{category:2,isSelected:n[1]===2,toggle:n[5]}}),l=new Zt({props:{category:3,isSelected:n[1]===3,toggle:n[5]}}),a=new Zt({props:{category:4,isSelected:n[1]===4,toggle:n[5]}}),u=new Zt({props:{category:5,isSelected:n[1]===5,toggle:n[5],padding:"pl-2 pr-3"}}),{c(){e=b("div"),W(t.$$.fragment),i=N(),W(r.$$.fragment),s=N(),W(l.$$.fragment),o=N(),W(a.$$.fragment),c=N(),W(u.$$.fragment),p(e,"class","tags has-addons is-dark is-center")},m(f,h){E(f,e,h),z(t,e,null),_(e,i),z(r,e,null),_(e,s),z(l,e,null),_(e,o),z(a,e,null),_(e,c),z(u,e,null),d=!0},p(f,h){const m={};h&2&&(m.isSelected=f[1]===1),t.$set(m);const g={};h&2&&(g.isSelected=f[1]===2),r.$set(g);const v={};h&2&&(v.isSelected=f[1]===3),l.$set(v);const w={};h&2&&(w.isSelected=f[1]===4),a.$set(w);const I={};h&2&&(I.isSelected=f[1]===5),u.$set(I)},i(f){d||(P(t.$$.fragment,f),P(r.$$.fragment,f),P(l.$$.fragment,f),P(a.$$.fragment,f),P(u.$$.fragment,f),d=!0)},o(f){M(t.$$.fragment,f),M(r.$$.fragment,f),M(l.$$.fragment,f),M(a.$$.fragment,f),M(u.$$.fragment,f),d=!1},d(f){f&&S(e),K(t),K(r),K(l),K(a),K(u)}}}function Ba(n){let e,t,i,r;t=new qt({props:{item:n[4],height:140,selectable:!1,isSquare:!1,isInModal:n[3],index:n[0]}}),t.$on("openModal",n[15]);let s=!n[3]&&qa(n);return{c(){e=b("div"),W(t.$$.fragment),i=N(),s&&s.c()},m(l,o){E(l,e,o),z(t,e,null),_(e,i),s&&s.m(e,null),r=!0},p(l,[o]){const a={};o&1&&(a.index=l[0]),t.$set(a),l[3]||s.p(l,o)},i(l){r||(P(t.$$.fragment,l),P(s),r=!0)},o(l){M(t.$$.fragment,l),M(s),r=!1},d(l){l&&S(e),K(t),s&&s.d()}}}function za(n,e,t){let i,r,s;const{comparedRegions:l}=Je;ue(n,l,H=>t(17,s=H));const a=new URL(window.location.href).origin;let{qImg:c}=e,{sImg:u}=e,{qRegions:d}=e,{sRegions:f}=e,{score:h=0}=e,{category:m=null}=e,{users:g=[]}=e,{isManual:v}=e,{similarityType:w}=e,{index:I=0}=e;const R=De("isInModal")||!1,[C,O,L,A]=u.split(".")[0].split("_"),D=(()=>{let H=wi(u,C,A,L);const q=s[`${C}_${O}_anno${f}`]||{title:H.title};return H.title=`${zs(q.title.replace(/^[^|]+/,""))}<br/>Page ${To(L)}<br/><b>Score: ${h}</b>`,H})();ct("similarityPair",{qImg:c,sImg:u,qRegions:d,sRegions:f,score:h,category:m,users:g,isManual:v,similarityType:w});function Z(H){H=H.slice();let q=H.indexOf(Number(En));return r&&q===-1?H.push(Number(En)):!r&&q!==-1&&H.splice(q,1),H}const se=()=>({img_1:c,img_2:u,regions_id_1:d,regions_id_2:f,score:h,category:i,category_x:Z(g),similarity_type:w});function V(H){H===5?r=!r:t(1,i=i===H?null:H)}async function te(H){V(H);try{(await fetch(`${a}/${Ue}/save-category`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":Xe},body:JSON.stringify(se())})).ok||(console.error("Error: Network response was not ok"),V(H))}catch(q){console.error("Error:",q),V(H)}}function X(H){Tn.call(this,n,H)}return n.$$set=H=>{"qImg"in H&&t(6,c=H.qImg),"sImg"in H&&t(7,u=H.sImg),"qRegions"in H&&t(8,d=H.qRegions),"sRegions"in H&&t(9,f=H.sRegions),"score"in H&&t(10,h=H.score),"category"in H&&t(11,m=H.category),"users"in H&&t(12,g=H.users),"isManual"in H&&t(13,v=H.isManual),"similarityType"in H&&t(14,w=H.similarityType),"index"in H&&t(0,I=H.index)},n.$$.update=()=>{n.$$.dirty&2048&&t(1,i=m),n.$$.dirty&4096&&(r=g.includes(Number(En))||!1)},[I,i,l,R,D,te,c,u,d,f,h,m,g,v,w,X]}class Ka extends ce{constructor(e){super(),ae(this,e,za,Ba,le,{qImg:6,sImg:7,qRegions:8,sRegions:9,score:10,category:11,users:12,isManual:13,similarityType:14,index:0})}}const Wa=n=>({item:n&4,index:n&1}),gr=n=>({item:n[2],index:n[0],close:n[4]});function _r(n){let e,t,i,r,s,l,o,a,c,u,d,f,h=n[3]&&vr(n);const m=n[8].default,g=qe(m,n,n[7],gr);let v=n[3]&&br(n);return{c(){e=b("div"),t=b("div"),i=N(),r=b("div"),h&&h.c(),s=N(),l=b("div"),g&&g.c(),o=N(),v&&v.c(),a=N(),c=b("button"),p(t,"class","modal-background"),p(l,"class","modal-inner svelte-1da92kq"),p(r,"class","modal-content svelte-1da92kq"),p(c,"class","modal-close is-large"),p(c,"aria-label","close"),p(e,"class","modal is-active")},m(w,I){E(w,e,I),_(e,t),_(e,i),_(e,r),h&&h.m(r,null),_(r,s),_(r,l),g&&g.m(l,null),_(r,o),v&&v.m(r,null),_(e,a),_(e,c),u=!0,d||(f=[ne(t,"click",n[4]),ne(t,"keyup",n[9]),ne(c,"click",n[4])],d=!0)},p(w,I){w[3]?h?h.p(w,I):(h=vr(w),h.c(),h.m(r,s)):h&&(h.d(1),h=null),g&&g.p&&(!u||I&133)&&ze(g,m,w,w[7],u?Be(m,w[7],I,Wa):Ke(w[7]),gr),w[3]?v?v.p(w,I):(v=br(w),v.c(),v.m(r,null)):v&&(v.d(1),v=null)},i(w){u||(P(g,w),u=!0)},o(w){M(g,w),u=!1},d(w){w&&S(e),h&&h.d(),g&&g.d(w),v&&v.d(),d=!1,Ce(f)}}}function vr(n){let e,t,i;return{c(){e=b("button"),e.innerHTML='<span class="icon"><i class="fas fa-chevron-left"></i></span>',p(e,"class","nav-btn svelte-1da92kq")},m(r,s){E(r,e,s),t||(i=ne(e,"click",n[10]),t=!0)},p:j,d(r){r&&S(e),t=!1,i()}}}function br(n){let e,t,i;return{c(){e=b("button"),e.innerHTML='<span class="icon"><i class="fas fa-chevron-right"></i></span>',p(e,"class","nav-btn svelte-1da92kq")},m(r,s){E(r,e,s),t||(i=ne(e,"click",n[11]),t=!0)},p:j,d(r){r&&S(e),t=!1,i()}}}function Ga(n){let e,t,i=n[1]&&_r(n);return{c(){i&&i.c(),e=me()},m(r,s){i&&i.m(r,s),E(r,e,s),t=!0},p(r,[s]){r[1]?i?(i.p(r,s),s&2&&P(i,1)):(i=_r(r),i.c(),P(i,1),i.m(e.parentNode,e)):i&&(be(),M(i,1,1,()=>{i=null}),we())},i(r){t||(P(i),t=!0)},o(r){M(i),t=!1},d(r){i&&i.d(r),r&&S(e)}}}function Ya(n,e,t){let i,r,{$$slots:s={},$$scope:l}=e,{open:o=!1}=e,{items:a=[]}=e,{currentIndex:c=0}=e;const u=zt(),d=()=>{t(1,o=!1),u("close")},f=w=>{i&&(t(0,c=(c+w+a.length)%a.length),u("navigate",{index:c,item:r}))},h=w=>{o&&(w.key==="Escape"?d():w.key==="ArrowLeft"?f(-1):w.key==="ArrowRight"&&f(1))};mt(()=>document.addEventListener("keydown",h)),cn(()=>document.removeEventListener("keydown",h));function m(w){Tn.call(this,n,w)}const g=()=>f(-1),v=()=>f(1);return n.$$set=w=>{"open"in w&&t(1,o=w.open),"items"in w&&t(6,a=w.items),"currentIndex"in w&&t(0,c=w.currentIndex),"$$scope"in w&&t(7,l=w.$$scope)},n.$$.update=()=>{n.$$.dirty&64&&t(3,i=a.length>1),n.$$.dirty&65&&t(2,r=a[c]??null)},[c,o,r,i,d,f,a,l,s,m,g,v]}class yi extends ce{constructor(e){super(),ae(this,e,Ya,Ga,le,{open:1,items:6,currentIndex:0})}}function wr(n){n[5]=n[9][0],n[6]=n[9][1],n[7]=n[9][2],n[8]=n[9][3]}function xa(n){return{c:j,m:j,p:j,d:j}}function Ja(n){wr(n);let e,t=`${n[5]}%`,i=`${n[6]}%`,r=`${n[7]}%`,s=`${n[8]}%`;return{c(){e=b("div"),p(e,"class","modal-context-bbox svelte-zgr10j"),ge(e,"left",t),ge(e,"top",i),ge(e,"width",r),ge(e,"height",s)},m(l,o){E(l,e,o)},p(l,o){wr(l),o&1&&t!==(t=`${l[5]}%`)&&ge(e,"left",t),o&1&&i!==(i=`${l[6]}%`)&&ge(e,"top",i),o&1&&r!==(r=`${l[7]}%`)&&ge(e,"width",r),o&1&&s!==(s=`${l[8]}%`)&&ge(e,"height",s)},d(l){l&&S(e)}}}function Xa(n){return{c:j,m:j,p:j,d:j}}function Qa(n){let e,t,i,r,s,l,o={ctx:n,current:null,token:null,hasCatch:!1,pending:Xa,then:Ja,catch:xa,value:9};return tt(l=n[0],o),{c(){e=b("div"),t=b("div"),i=b("img"),s=N(),o.block.c(),p(i,"class","card modal-context-full-page svelte-zgr10j"),Re(i.src,r=n[1])||p(i,"src",r),p(i,"alt",U==="fr"?"Vue de la page d'où la région est extraite":"View of the page the region is extracted from"),p(t,"class","modal-context-wrapper svelte-zgr10j"),p(e,"class","modal-context-outer pb-4 svelte-zgr10j")},m(a,c){E(a,e,c),_(e,t),_(t,i),_(t,s),o.block.m(t,o.anchor=null),o.mount=()=>t,o.anchor=null},p(a,[c]){n=a,c&2&&!Re(i.src,r=n[1])&&p(i,"src",r),o.ctx=n,c&1&&l!==(l=n[0])&&tt(l,o)||At(o,n,c)},i:j,o:j,d(a){a&&S(e),o.block.d(),o.token=null,o=null}}}function Za(n,e,t){let i,r,s,l,{item:o}=e;return n.$$set=a=>{"item"in a&&t(2,o=a.item)},n.$$.update=()=>{n.$$.dirty&4&&t(1,i=nt(o.img??o.ref,"full","full")),n.$$.dirty&4&&t(4,r=$o(o.img??o.ref)),n.$$.dirty&4&&t(3,s=o.xywh.map(Number)),n.$$.dirty&24&&t(0,l=fetch(r).then(a=>a.json()).then(({width:a,height:c})=>[s[0]/a*100,s[1]/c*100,s[2]/a*100,s[3]/c*100]))},[l,i,o,s,r]}class cl extends ce{constructor(e){super(),ae(this,e,Za,Qa,le,{item:2})}}function ec(n){let e,t,i,r,s,l,o;return{c(){e=b("button"),t=b("span"),t.innerHTML='<span class="switch-control svelte-g5g8im"><span class="switch-spot"></span></span>',i=N(),r=b("span"),s=G(n[0]),p(t,"class","switch mr-2 svelte-g5g8im"),p(r,"class","label svelte-g5g8im"),p(e,"id",n[3]),p(e,"name",n[3]),p(e,"class","input-checkbox-wrapper is-flex is-align-items-center-is-justify-content-center p-2 pl-3 pr-3 svelte-g5g8im"),p(e,"aria-label",n[0]),ke(e,"is-checked",n[2]),ke(e,"is-clickable",n[1]),ke(e,"button",n[1])},m(a,c){E(a,e,c),_(e,t),_(e,i),_(e,r),_(r,s),l||(o=ne(e,"click",yt(n[4])),l=!0)},p(a,[c]){c&1&&de(s,a[0]),c&1&&p(e,"aria-label",a[0]),c&4&&ke(e,"is-checked",a[2]),c&2&&ke(e,"is-clickable",a[1]),c&2&&ke(e,"button",a[1])},i:j,o:j,d(a){a&&S(e),l=!1,o()}}}function tc(n,e,t){let i,{toggleLabel:r}=e,{start:s=!1}=e,{buttonDisplay:l=!1}=e;const o=`input-toggle-${window.crypto.randomUUID()}`,a=zt(),c=De("resetTrigger")||void 0;c==null||c.subscribe(d);const u=()=>t(2,i=!i);function d(){t(2,i=s)}return n.$$set=f=>{"toggleLabel"in f&&t(0,r=f.toggleLabel),"start"in f&&t(5,s=f.start),"buttonDisplay"in f&&t(1,l=f.buttonDisplay)},n.$$.update=()=>{n.$$.dirty&32&&t(2,i=s),n.$$.dirty&4&&a("updateChecked",i)},[r,l,i,o,u,s]}class ul extends ce{constructor(e){super(),ae(this,e,tc,ec,le,{toggleLabel:0,start:5,buttonDisplay:1})}}var gt;(function(n){n.Range="range",n.Steps="steps",n.Positions="positions",n.Count="count",n.Values="values"})(gt||(gt={}));var Fe;(function(n){n[n.None=-1]="None",n[n.NoValue=0]="NoValue",n[n.LargeValue=1]="LargeValue",n[n.SmallValue=2]="SmallValue"})(Fe||(Fe={}));function nc(n){return Ln(n)&&typeof n.from=="function"}function Ln(n){return typeof n=="object"&&typeof n.to=="function"}function yr(n){n.parentElement.removeChild(n)}function ii(n){return n!=null}function kr(n){n.preventDefault()}function ic(n){return n.filter(function(e){return this[e]?!1:this[e]=!0},{})}function rc(n,e){return Math.round(n/e)*e}function sc(n,e){var t=n.getBoundingClientRect(),i=n.ownerDocument,r=i.documentElement,s=fl(i);return/webkit.*Chrome.*Mobile/i.test(navigator.userAgent)&&(s.x=0),e?t.top+s.y-r.clientTop:t.left+s.x-r.clientLeft}function Ze(n){return typeof n=="number"&&!isNaN(n)&&isFinite(n)}function Sr(n,e,t){t>0&&(Ve(n,e),setTimeout(function(){Cn(n,e)},t))}function Er(n){return Math.max(Math.min(n,100),0)}function Nn(n){return Array.isArray(n)?n:[n]}function lc(n){n=String(n);var e=n.split(".");return e.length>1?e[1].length:0}function Ve(n,e){n.classList&&!/\s/.test(e)?n.classList.add(e):n.className+=" "+e}function Cn(n,e){n.classList&&!/\s/.test(e)?n.classList.remove(e):n.className=n.className.replace(new RegExp("(^|\\b)"+e.split(" ").join("|")+"(\\b|$)","gi")," ")}function oc(n,e){return n.classList?n.classList.contains(e):new RegExp("\\b"+e+"\\b").test(n.className)}function fl(n){var e=window.pageXOffset!==void 0,t=(n.compatMode||"")==="CSS1Compat",i=e?window.pageXOffset:t?n.documentElement.scrollLeft:n.body.scrollLeft,r=e?window.pageYOffset:t?n.documentElement.scrollTop:n.body.scrollTop;return{x:i,y:r}}function ac(){return window.navigator.pointerEnabled?{start:"pointerdown",move:"pointermove",end:"pointerup"}:window.navigator.msPointerEnabled?{start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:{start:"mousedown touchstart",move:"mousemove touchmove",end:"mouseup touchend"}}function cc(){var n=!1;try{var e=Object.defineProperty({},"passive",{get:function(){n=!0}});window.addEventListener("test",null,e)}catch{}return n}function uc(){return window.CSS&&CSS.supports&&CSS.supports("touch-action","none")}function ki(n,e){return 100/(e-n)}function ri(n,e,t){return e*100/(n[t+1]-n[t])}function fc(n,e){return ri(n,n[0]<0?e+Math.abs(n[0]):e-n[0],0)}function dc(n,e){return e*(n[1]-n[0])/100+n[0]}function on(n,e){for(var t=1;n>=e[t];)t+=1;return t}function hc(n,e,t){if(t>=n.slice(-1)[0])return 100;var i=on(t,n),r=n[i-1],s=n[i],l=e[i-1],o=e[i];return l+fc([r,s],t)/ki(l,o)}function mc(n,e,t){if(t>=100)return n.slice(-1)[0];var i=on(t,e),r=n[i-1],s=n[i],l=e[i-1],o=e[i];return dc([r,s],(t-l)*ki(l,o))}function pc(n,e,t,i){if(i===100)return i;var r=on(i,n),s=n[r-1],l=n[r];return t?i-s>(l-s)/2?l:s:e[r-1]?n[r-1]+rc(i-n[r-1],e[r-1]):i}var dl=function(){function n(e,t,i){this.xPct=[],this.xVal=[],this.xSteps=[],this.xNumSteps=[],this.xHighestCompleteStep=[],this.xSteps=[i||!1],this.xNumSteps=[!1],this.snap=t;var r,s=[];for(Object.keys(e).forEach(function(l){s.push([Nn(e[l]),l])}),s.sort(function(l,o){return l[0][0]-o[0][0]}),r=0;r<s.length;r++)this.handleEntryPoint(s[r][1],s[r][0]);for(this.xNumSteps=this.xSteps.slice(0),r=0;r<this.xNumSteps.length;r++)this.handleStepPoint(r,this.xNumSteps[r])}return n.prototype.getDistance=function(e){for(var t=[],i=0;i<this.xNumSteps.length-1;i++)t[i]=ri(this.xVal,e,i);return t},n.prototype.getAbsoluteDistance=function(e,t,i){var r=0;if(e<this.xPct[this.xPct.length-1])for(;e>this.xPct[r+1];)r++;else e===this.xPct[this.xPct.length-1]&&(r=this.xPct.length-2);!i&&e===this.xPct[r+1]&&r++,t===null&&(t=[]);var s,l=1,o=t[r],a=0,c=0,u=0,d=0;for(i?s=(e-this.xPct[r])/(this.xPct[r+1]-this.xPct[r]):s=(this.xPct[r+1]-e)/(this.xPct[r+1]-this.xPct[r]);o>0;)a=this.xPct[r+1+d]-this.xPct[r+d],t[r+d]*l+100-s*100>100?(c=a*s,l=(o-100*s)/t[r+d],s=1):(c=t[r+d]*a/100*l,l=0),i?(u=u-c,this.xPct.length+d>=1&&d--):(u=u+c,this.xPct.length-d>=1&&d++),o=t[r+d]*l;return e+u},n.prototype.toStepping=function(e){return e=hc(this.xVal,this.xPct,e),e},n.prototype.fromStepping=function(e){return mc(this.xVal,this.xPct,e)},n.prototype.getStep=function(e){return e=pc(this.xPct,this.xSteps,this.snap,e),e},n.prototype.getDefaultStep=function(e,t,i){var r=on(e,this.xPct);return(e===100||t&&e===this.xPct[r-1])&&(r=Math.max(r-1,1)),(this.xVal[r]-this.xVal[r-1])/i},n.prototype.getNearbySteps=function(e){var t=on(e,this.xPct);return{stepBefore:{startValue:this.xVal[t-2],step:this.xNumSteps[t-2],highestStep:this.xHighestCompleteStep[t-2]},thisStep:{startValue:this.xVal[t-1],step:this.xNumSteps[t-1],highestStep:this.xHighestCompleteStep[t-1]},stepAfter:{startValue:this.xVal[t],step:this.xNumSteps[t],highestStep:this.xHighestCompleteStep[t]}}},n.prototype.countStepDecimals=function(){var e=this.xNumSteps.map(lc);return Math.max.apply(null,e)},n.prototype.hasNoSize=function(){return this.xVal[0]===this.xVal[this.xVal.length-1]},n.prototype.convert=function(e){return this.getStep(this.toStepping(e))},n.prototype.handleEntryPoint=function(e,t){var i;if(e==="min"?i=0:e==="max"?i=100:i=parseFloat(e),!Ze(i)||!Ze(t[0]))throw new Error("noUiSlider: 'range' value isn't numeric.");this.xPct.push(i),this.xVal.push(t[0]);var r=Number(t[1]);i?this.xSteps.push(isNaN(r)?!1:r):isNaN(r)||(this.xSteps[0]=r),this.xHighestCompleteStep.push(0)},n.prototype.handleStepPoint=function(e,t){if(t){if(this.xVal[e]===this.xVal[e+1]){this.xSteps[e]=this.xHighestCompleteStep[e]=this.xVal[e];return}this.xSteps[e]=ri([this.xVal[e],this.xVal[e+1]],t,0)/ki(this.xPct[e],this.xPct[e+1]);var i=(this.xVal[e+1]-this.xVal[e])/this.xNumSteps[e],r=Math.ceil(Number(i.toFixed(3))-1),s=this.xVal[e]+this.xNumSteps[e]*r;this.xHighestCompleteStep[e]=s}},n}(),Cr={to:function(n){return n===void 0?"":n.toFixed(2)},from:Number},hl={target:"target",base:"base",origin:"origin",handle:"handle",handleLower:"handle-lower",handleUpper:"handle-upper",touchArea:"touch-area",horizontal:"horizontal",vertical:"vertical",background:"background",connect:"connect",connects:"connects",ltr:"ltr",rtl:"rtl",textDirectionLtr:"txt-dir-ltr",textDirectionRtl:"txt-dir-rtl",draggable:"draggable",drag:"state-drag",tap:"state-tap",active:"active",tooltip:"tooltip",pips:"pips",pipsHorizontal:"pips-horizontal",pipsVertical:"pips-vertical",marker:"marker",markerHorizontal:"marker-horizontal",markerVertical:"marker-vertical",markerNormal:"marker-normal",markerLarge:"marker-large",markerSub:"marker-sub",value:"value",valueHorizontal:"value-horizontal",valueVertical:"value-vertical",valueNormal:"value-normal",valueLarge:"value-large",valueSub:"value-sub"},pt={tooltips:".__tooltips",aria:".__aria"};function gc(n,e){if(!Ze(e))throw new Error("noUiSlider: 'step' is not numeric.");n.singleStep=e}function _c(n,e){if(!Ze(e))throw new Error("noUiSlider: 'keyboardPageMultiplier' is not numeric.");n.keyboardPageMultiplier=e}function vc(n,e){if(!Ze(e))throw new Error("noUiSlider: 'keyboardMultiplier' is not numeric.");n.keyboardMultiplier=e}function bc(n,e){if(!Ze(e))throw new Error("noUiSlider: 'keyboardDefaultStep' is not numeric.");n.keyboardDefaultStep=e}function wc(n,e){if(typeof e!="object"||Array.isArray(e))throw new Error("noUiSlider: 'range' is not an object.");if(e.min===void 0||e.max===void 0)throw new Error("noUiSlider: Missing 'min' or 'max' in 'range'.");n.spectrum=new dl(e,n.snap||!1,n.singleStep)}function yc(n,e){if(e=Nn(e),!Array.isArray(e)||!e.length)throw new Error("noUiSlider: 'start' option is incorrect.");n.handles=e.length,n.start=e}function kc(n,e){if(typeof e!="boolean")throw new Error("noUiSlider: 'snap' option must be a boolean.");n.snap=e}function Sc(n,e){if(typeof e!="boolean")throw new Error("noUiSlider: 'animate' option must be a boolean.");n.animate=e}function Ec(n,e){if(typeof e!="number")throw new Error("noUiSlider: 'animationDuration' option must be a number.");n.animationDuration=e}function ml(n,e){var t=[!1],i;if(e==="lower"?e=[!0,!1]:e==="upper"&&(e=[!1,!0]),e===!0||e===!1){for(i=1;i<n.handles;i++)t.push(e);t.push(!1)}else{if(!Array.isArray(e)||!e.length||e.length!==n.handles+1)throw new Error("noUiSlider: 'connect' option doesn't match handle count.");t=e}n.connect=t}function Cc(n,e){switch(e){case"horizontal":n.ort=0;break;case"vertical":n.ort=1;break;default:throw new Error("noUiSlider: 'orientation' option is invalid.")}}function pl(n,e){if(!Ze(e))throw new Error("noUiSlider: 'margin' option must be numeric.");e!==0&&(n.margin=n.spectrum.getDistance(e))}function Ic(n,e){if(!Ze(e))throw new Error("noUiSlider: 'limit' option must be numeric.");if(n.limit=n.spectrum.getDistance(e),!n.limit||n.handles<2)throw new Error("noUiSlider: 'limit' option is only supported on linear sliders with 2 or more handles.")}function Oc(n,e){var t;if(!Ze(e)&&!Array.isArray(e))throw new Error("noUiSlider: 'padding' option must be numeric or array of exactly 2 numbers.");if(Array.isArray(e)&&!(e.length===2||Ze(e[0])||Ze(e[1])))throw new Error("noUiSlider: 'padding' option must be numeric or array of exactly 2 numbers.");if(e!==0){for(Array.isArray(e)||(e=[e,e]),n.padding=[n.spectrum.getDistance(e[0]),n.spectrum.getDistance(e[1])],t=0;t<n.spectrum.xNumSteps.length-1;t++)if(n.padding[0][t]<0||n.padding[1][t]<0)throw new Error("noUiSlider: 'padding' option must be a positive number(s).");var i=e[0]+e[1],r=n.spectrum.xVal[0],s=n.spectrum.xVal[n.spectrum.xVal.length-1];if(i/(s-r)>1)throw new Error("noUiSlider: 'padding' option must not exceed 100% of the range.")}}function Ac(n,e){switch(e){case"ltr":n.dir=0;break;case"rtl":n.dir=1;break;default:throw new Error("noUiSlider: 'direction' option was not recognized.")}}function Tc(n,e){if(typeof e!="string")throw new Error("noUiSlider: 'behaviour' must be a string containing options.");var t=e.indexOf("tap")>=0,i=e.indexOf("drag")>=0,r=e.indexOf("fixed")>=0,s=e.indexOf("snap")>=0,l=e.indexOf("hover")>=0,o=e.indexOf("unconstrained")>=0,a=e.indexOf("invert-connects")>=0,c=e.indexOf("drag-all")>=0,u=e.indexOf("smooth-steps")>=0;if(r){if(n.handles!==2)throw new Error("noUiSlider: 'fixed' behaviour must be used with 2 handles");pl(n,n.start[1]-n.start[0])}if(a&&n.handles!==2)throw new Error("noUiSlider: 'invert-connects' behaviour must be used with 2 handles");if(o&&(n.margin||n.limit))throw new Error("noUiSlider: 'unconstrained' behaviour cannot be used with margin or limit");n.events={tap:t||s,drag:i,dragAll:c,smoothSteps:u,fixed:r,snap:s,hover:l,unconstrained:o,invertConnects:a}}function Pc(n,e){if(e!==!1)if(e===!0||Ln(e)){n.tooltips=[];for(var t=0;t<n.handles;t++)n.tooltips.push(e)}else{if(e=Nn(e),e.length!==n.handles)throw new Error("noUiSlider: must pass a formatter for all handles.");e.forEach(function(i){if(typeof i!="boolean"&&!Ln(i))throw new Error("noUiSlider: 'tooltips' must be passed a formatter or 'false'.")}),n.tooltips=e}}function Lc(n,e){if(e.length!==n.handles)throw new Error("noUiSlider: must pass a attributes for all handles.");n.handleAttributes=e}function Mc(n,e){if(!Ln(e))throw new Error("noUiSlider: 'ariaFormat' requires 'to' method.");n.ariaFormat=e}function $c(n,e){if(!nc(e))throw new Error("noUiSlider: 'format' requires 'to' and 'from' methods.");n.format=e}function Rc(n,e){if(typeof e!="boolean")throw new Error("noUiSlider: 'keyboardSupport' option must be a boolean.");n.keyboardSupport=e}function Dc(n,e){n.documentElement=e}function Nc(n,e){if(typeof e!="string"&&e!==!1)throw new Error("noUiSlider: 'cssPrefix' must be a string or `false`.");n.cssPrefix=e}function jc(n,e){if(typeof e!="object")throw new Error("noUiSlider: 'cssClasses' must be an object.");typeof n.cssPrefix=="string"?(n.cssClasses={},Object.keys(e).forEach(function(t){n.cssClasses[t]=n.cssPrefix+e[t]})):n.cssClasses=e}function gl(n){var e={margin:null,limit:null,padding:null,animate:!0,animationDuration:300,ariaFormat:Cr,format:Cr},t={step:{r:!1,t:gc},keyboardPageMultiplier:{r:!1,t:_c},keyboardMultiplier:{r:!1,t:vc},keyboardDefaultStep:{r:!1,t:bc},start:{r:!0,t:yc},connect:{r:!0,t:ml},direction:{r:!0,t:Ac},snap:{r:!1,t:kc},animate:{r:!1,t:Sc},animationDuration:{r:!1,t:Ec},range:{r:!0,t:wc},orientation:{r:!1,t:Cc},margin:{r:!1,t:pl},limit:{r:!1,t:Ic},padding:{r:!1,t:Oc},behaviour:{r:!0,t:Tc},ariaFormat:{r:!1,t:Mc},format:{r:!1,t:$c},tooltips:{r:!1,t:Pc},keyboardSupport:{r:!0,t:Rc},documentElement:{r:!1,t:Dc},cssPrefix:{r:!0,t:Nc},cssClasses:{r:!0,t:jc},handleAttributes:{r:!1,t:Lc}},i={connect:!1,direction:"ltr",behaviour:"tap",orientation:"horizontal",keyboardSupport:!0,cssPrefix:"noUi-",cssClasses:hl,keyboardPageMultiplier:5,keyboardMultiplier:1,keyboardDefaultStep:10};n.format&&!n.ariaFormat&&(n.ariaFormat=n.format),Object.keys(t).forEach(function(a){if(!ii(n[a])&&i[a]===void 0){if(t[a].r)throw new Error("noUiSlider: '"+a+"' is required.");return}t[a].t(e,ii(n[a])?n[a]:i[a])}),e.pips=n.pips;var r=document.createElement("div"),s=r.style.msTransform!==void 0,l=r.style.transform!==void 0;e.transformRule=l?"transform":s?"msTransform":"webkitTransform";var o=[["left","top"],["right","bottom"]];return e.style=o[e.dir][e.ort],e}function Vc(n,e,t){var i=ac(),r=uc(),s=r&&cc(),l=n,o,a,c,u,d,f,h=e.spectrum,m=[],g=[],v=[],w=0,I={},R=!1,C=n.ownerDocument,O=e.documentElement||C.documentElement,L=C.body,A=C.dir==="rtl"||e.ort===1?0:100;function y(k,T){var $=C.createElement("div");return T&&Ve($,T),k.appendChild($),$}function D(k,T){var $=y(k,e.cssClasses.origin),B=y($,e.cssClasses.handle);if(y(B,e.cssClasses.touchArea),B.setAttribute("data-handle",String(T)),e.keyboardSupport&&(B.setAttribute("tabindex","0"),B.addEventListener("keydown",function(J){return Hl(J,T)})),e.handleAttributes!==void 0){var x=e.handleAttributes[T];Object.keys(x).forEach(function(J){B.setAttribute(J,x[J])})}return B.setAttribute("role","slider"),B.setAttribute("aria-orientation",e.ort?"vertical":"horizontal"),T===0?Ve(B,e.cssClasses.handleLower):T===e.handles-1&&Ve(B,e.cssClasses.handleUpper),$.handle=B,$}function Z(k,T){return T?y(k,e.cssClasses.connect):!1}function se(k,T){a=y(T,e.cssClasses.connects),c=[],u=[],u.push(Z(a,k[0]));for(var $=0;$<e.handles;$++)c.push(D(T,$)),v[$]=$,u.push(Z(a,k[$+1]))}function V(k){Ve(k,e.cssClasses.target),e.dir===0?Ve(k,e.cssClasses.ltr):Ve(k,e.cssClasses.rtl),e.ort===0?Ve(k,e.cssClasses.horizontal):Ve(k,e.cssClasses.vertical);var T=getComputedStyle(k).direction;return T==="rtl"?Ve(k,e.cssClasses.textDirectionRtl):Ve(k,e.cssClasses.textDirectionLtr),y(k,e.cssClasses.base)}function te(k,T){return!e.tooltips||!e.tooltips[T]?!1:y(k.firstChild,e.cssClasses.tooltip)}function X(){return l.hasAttribute("disabled")}function H(k){var T=c[k];return T.hasAttribute("disabled")}function q(k){k!=null?(c[k].setAttribute("disabled",""),c[k].handle.removeAttribute("tabindex")):(l.setAttribute("disabled",""),c.forEach(function(T){T.handle.removeAttribute("tabindex")}))}function re(k){k!=null?(c[k].removeAttribute("disabled"),c[k].handle.setAttribute("tabindex","0")):(l.removeAttribute("disabled"),c.forEach(function(T){T.removeAttribute("disabled"),T.handle.setAttribute("tabindex","0")}))}function F(){f&&(Jt("update"+pt.tooltips),f.forEach(function(k){k&&yr(k)}),f=null)}function Y(){F(),f=c.map(te),qn("update"+pt.tooltips,function(k,T,$){if(!(!f||!e.tooltips)&&f[T]!==!1){var B=k[T];e.tooltips[T]!==!0&&(B=e.tooltips[T].to($[T])),f[T].innerHTML=B}})}function ee(){Jt("update"+pt.aria),qn("update"+pt.aria,function(k,T,$,B,x){v.forEach(function(J){var ie=c[J],Q=pn(g,J,0,!0,!0,!0),_e=pn(g,J,100,!0,!0,!0),ve=x[J],Se=String(e.ariaFormat.to($[J]));Q=h.fromStepping(Q).toFixed(1),_e=h.fromStepping(_e).toFixed(1),ve=h.fromStepping(ve).toFixed(1),ie.children[0].setAttribute("aria-valuemin",Q),ie.children[0].setAttribute("aria-valuemax",_e),ie.children[0].setAttribute("aria-valuenow",ve),ie.children[0].setAttribute("aria-valuetext",Se)})})}function pe(k){if(k.mode===gt.Range||k.mode===gt.Steps)return h.xVal;if(k.mode===gt.Count){if(k.values<2)throw new Error("noUiSlider: 'values' (>= 2) required for mode 'count'.");for(var T=k.values-1,$=100/T,B=[];T--;)B[T]=T*$;return B.push(100),ye(B,k.stepped)}return k.mode===gt.Positions?ye(k.values,k.stepped):k.mode===gt.Values?k.stepped?k.values.map(function(x){return h.fromStepping(h.getStep(h.toStepping(x)))}):k.values:[]}function ye(k,T){return k.map(function($){return h.fromStepping(T?h.getStep($):$)})}function Wt(k){function T(ve,Se){return Number((ve+Se).toFixed(7))}var $=pe(k),B={},x=h.xVal[0],J=h.xVal[h.xVal.length-1],ie=!1,Q=!1,_e=0;return $=ic($.slice().sort(function(ve,Se){return ve-Se})),$[0]!==x&&($.unshift(x),ie=!0),$[$.length-1]!==J&&($.push(J),Q=!0),$.forEach(function(ve,Se){var Ee,he,Te,Ne=ve,Pe=$[Se+1],Le,Kn,Wn,Gn,$i,Yn,Ri,Di=k.mode===gt.Steps;for(Di&&(Ee=h.xNumSteps[Se]),Ee||(Ee=Pe-Ne),Pe===void 0&&(Pe=Ne),Ee=Math.max(Ee,1e-7),he=Ne;he<=Pe;he=T(he,Ee)){for(Le=h.toStepping(he),Kn=Le-_e,$i=Kn/(k.density||1),Yn=Math.round($i),Ri=Kn/Yn,Te=1;Te<=Yn;Te+=1)Wn=_e+Te*Ri,B[Wn.toFixed(5)]=[h.fromStepping(Wn),0];Gn=$.indexOf(he)>-1?Fe.LargeValue:Di?Fe.SmallValue:Fe.NoValue,!Se&&ie&&he!==Pe&&(Gn=0),he===Pe&&Q||(B[Le.toFixed(5)]=[he,Gn]),_e=Le}}),B}function Un(k,T,$){var B,x,J=C.createElement("div"),ie=(B={},B[Fe.None]="",B[Fe.NoValue]=e.cssClasses.valueNormal,B[Fe.LargeValue]=e.cssClasses.valueLarge,B[Fe.SmallValue]=e.cssClasses.valueSub,B),Q=(x={},x[Fe.None]="",x[Fe.NoValue]=e.cssClasses.markerNormal,x[Fe.LargeValue]=e.cssClasses.markerLarge,x[Fe.SmallValue]=e.cssClasses.markerSub,x),_e=[e.cssClasses.valueHorizontal,e.cssClasses.valueVertical],ve=[e.cssClasses.markerHorizontal,e.cssClasses.markerVertical];Ve(J,e.cssClasses.pips),Ve(J,e.ort===0?e.cssClasses.pipsHorizontal:e.cssClasses.pipsVertical);function Se(he,Te){var Ne=Te===e.cssClasses.value,Pe=Ne?_e:ve,Le=Ne?ie:Q;return Te+" "+Pe[e.ort]+" "+Le[he]}function Ee(he,Te,Ne){if(Ne=T?T(Te,Ne):Ne,Ne!==Fe.None){var Pe=y(J,!1);Pe.className=Se(Ne,e.cssClasses.marker),Pe.style[e.style]=he+"%",Ne>Fe.NoValue&&(Pe=y(J,!1),Pe.className=Se(Ne,e.cssClasses.value),Pe.setAttribute("data-value",String(Te)),Pe.style[e.style]=he+"%",Pe.innerHTML=String($.to(Te)))}}return Object.keys(k).forEach(function(he){Ee(he,k[he][0],k[he][1])}),J}function Gt(){d&&(yr(d),d=null)}function Yt(k){Gt();var T=Wt(k),$=k.filter,B=k.format||{to:function(x){return String(Math.round(x))}};return d=l.appendChild(Un(T,$,B)),d}function dn(){var k=o.getBoundingClientRect(),T="offset"+["Width","Height"][e.ort];return e.ort===0?k.width||o[T]:k.height||o[T]}function Qe(k,T,$,B){var x=function(ie){var Q=hn(ie,B.pageOffset,B.target||T);if(!Q||X()&&!B.doNotReject||oc(l,e.cssClasses.tap)&&!B.doNotReject||k===i.start&&Q.buttons!==void 0&&Q.buttons>1||B.hover&&Q.buttons)return!1;s||Q.preventDefault(),Q.calcPoint=Q.points[e.ort],$(Q,B)},J=[];return k.split(" ").forEach(function(ie){T.addEventListener(ie,x,s?{passive:!0}:!1),J.push([ie,x])}),J}function hn(k,T,$){var B=k.type.indexOf("touch")===0,x=k.type.indexOf("mouse")===0,J=k.type.indexOf("pointer")===0,ie=0,Q=0;if(k.type.indexOf("MSPointer")===0&&(J=!0),k.type==="mousedown"&&!k.buttons&&!k.touches)return!1;if(B){var _e=function(Ee){var he=Ee.target;return he===$||$.contains(he)||k.composed&&k.composedPath().shift()===$};if(k.type==="touchstart"){var ve=Array.prototype.filter.call(k.touches,_e);if(ve.length>1)return!1;ie=ve[0].pageX,Q=ve[0].pageY}else{var Se=Array.prototype.find.call(k.changedTouches,_e);if(!Se)return!1;ie=Se.pageX,Q=Se.pageY}}return T=T||fl(C),(x||J)&&(ie=k.clientX+T.x,Q=k.clientY+T.y),k.pageOffset=T,k.points=[ie,Q],k.cursor=x||J,k}function xt(k){var T=k-sc(o,e.ort),$=T*100/dn();return $=Er($),e.dir?100-$:$}function mn(k){var T=100,$=!1;return c.forEach(function(B,x){if(!H(x)){var J=g[x],ie=Math.abs(J-k),Q=ie===100&&T===100,_e=ie<T,ve=ie<=T&&k>J;(_e||ve||Q)&&($=x,T=ie)}}),$}function jl(k,T){k.type==="mouseout"&&k.target.nodeName==="HTML"&&k.relatedTarget===null&&Fn(k,T)}function Vl(k,T){if(navigator.appVersion.indexOf("MSIE 9")===-1&&k.buttons===0&&T.buttonsProperty!==0)return Fn(k,T);var $=(e.dir?-1:1)*(k.calcPoint-T.startCalcPoint),B=$*100/T.baseSize;Oi($>0,B,T.locations,T.handleNumbers,T.connect)}function Fn(k,T){T.handle&&(Cn(T.handle,e.cssClasses.active),w-=1),T.listeners.forEach(function($){O.removeEventListener($[0],$[1])}),w===0&&(Cn(l,e.cssClasses.drag),zn(),k.cursor&&(L.style.cursor="",L.removeEventListener("selectstart",kr))),e.events.smoothSteps&&(T.handleNumbers.forEach(function($){St($,g[$],!0,!0,!1,!1)}),T.handleNumbers.forEach(function($){Ie("update",$)})),T.handleNumbers.forEach(function($){Ie("change",$),Ie("set",$),Ie("end",$)})}function Hn(k,T){if(!T.handleNumbers.some(H)){var $;if(T.handleNumbers.length===1){var B=c[T.handleNumbers[0]];$=B.children[0],w+=1,Ve($,e.cssClasses.active)}k.stopPropagation();var x=[],J=Qe(i.move,O,Vl,{target:k.target,handle:$,connect:T.connect,listeners:x,startCalcPoint:k.calcPoint,baseSize:dn(),pageOffset:k.pageOffset,handleNumbers:T.handleNumbers,buttonsProperty:k.buttons,locations:g.slice()}),ie=Qe(i.end,O,Fn,{target:k.target,handle:$,listeners:x,doNotReject:!0,handleNumbers:T.handleNumbers}),Q=Qe("mouseout",O,jl,{target:k.target,handle:$,listeners:x,doNotReject:!0,handleNumbers:T.handleNumbers});x.push.apply(x,J.concat(ie,Q)),k.cursor&&(L.style.cursor=getComputedStyle(k.target).cursor,c.length>1&&Ve(l,e.cssClasses.drag),L.addEventListener("selectstart",kr,!1)),T.handleNumbers.forEach(function(_e){Ie("start",_e)})}}function Ul(k){k.stopPropagation();var T=xt(k.calcPoint),$=mn(T);$!==!1&&(e.events.snap||Sr(l,e.cssClasses.tap,e.animationDuration),St($,T,!0,!0),zn(),Ie("slide",$,!0),Ie("update",$,!0),e.events.snap?Hn(k,{handleNumbers:[$]}):(Ie("change",$,!0),Ie("set",$,!0)))}function Fl(k){var T=xt(k.calcPoint),$=h.getStep(T),B=h.fromStepping($);Object.keys(I).forEach(function(x){x.split(".")[0]==="hover"&&I[x].forEach(function(J){J.call(_n,B)})})}function Hl(k,T){if(X()||H(T))return!1;var $=["Left","Right"],B=["Down","Up"],x=["PageDown","PageUp"],J=["Home","End"];e.dir&&!e.ort?$.reverse():e.ort&&!e.dir&&(B.reverse(),x.reverse());var ie=k.key.replace("Arrow",""),Q=ie===x[0],_e=ie===x[1],ve=ie===B[0]||ie===$[0]||Q,Se=ie===B[1]||ie===$[1]||_e,Ee=ie===J[0],he=ie===J[1];if(!ve&&!Se&&!Ee&&!he)return!0;k.preventDefault();var Te;if(Se||ve){var Ne=ve?0:1,Pe=Li(T),Le=Pe[Ne];if(Le===null)return!1;Le===!1&&(Le=h.getDefaultStep(g[T],ve,e.keyboardDefaultStep)),_e||Q?Le*=e.keyboardPageMultiplier:Le*=e.keyboardMultiplier,Le=Math.max(Le,1e-7),Le=(ve?-1:1)*Le,Te=m[T]+Le}else he?Te=e.spectrum.xVal[e.spectrum.xVal.length-1]:Te=e.spectrum.xVal[0];return St(T,h.toStepping(Te),!0,!0),Ie("slide",T),Ie("update",T),Ie("change",T),Ie("set",T),!1}function Ii(k){k.fixed||c.forEach(function(T,$){Qe(i.start,T.children[0],Hn,{handleNumbers:[$]})}),k.tap&&Qe(i.start,o,Ul,{}),k.hover&&Qe(i.move,o,Fl,{hover:!0}),k.drag&&u.forEach(function(T,$){if(!(T===!1||$===0||$===u.length-1)){var B=c[$-1],x=c[$],J=[T],ie=[B,x],Q=[$-1,$];Ve(T,e.cssClasses.draggable),k.fixed&&(J.push(B.children[0]),J.push(x.children[0])),k.dragAll&&(ie=c,Q=v),J.forEach(function(_e){Qe(i.start,_e,Hn,{handles:ie,handleNumbers:Q,connect:T})})}})}function qn(k,T){I[k]=I[k]||[],I[k].push(T),k.split(".")[0]==="update"&&c.forEach(function($,B){Ie("update",B)})}function ql(k){return k===pt.aria||k===pt.tooltips}function Jt(k){var T=k&&k.split(".")[0],$=T?k.substring(T.length):k;Object.keys(I).forEach(function(B){var x=B.split(".")[0],J=B.substring(x.length);(!T||T===x)&&(!$||$===J)&&(!ql(J)||$===J)&&delete I[B]})}function Ie(k,T,$){Object.keys(I).forEach(function(B){var x=B.split(".")[0];k===x&&I[B].forEach(function(J){J.call(_n,m.map(e.format.to),T,m.slice(),$||!1,g.slice(),_n)})})}function pn(k,T,$,B,x,J,ie){var Q;return c.length>1&&!e.events.unconstrained&&(B&&T>0&&(Q=h.getAbsoluteDistance(k[T-1],e.margin,!1),$=Math.max($,Q)),x&&T<c.length-1&&(Q=h.getAbsoluteDistance(k[T+1],e.margin,!0),$=Math.min($,Q))),c.length>1&&e.limit&&(B&&T>0&&(Q=h.getAbsoluteDistance(k[T-1],e.limit,!1),$=Math.min($,Q)),x&&T<c.length-1&&(Q=h.getAbsoluteDistance(k[T+1],e.limit,!0),$=Math.max($,Q))),e.padding&&(T===0&&(Q=h.getAbsoluteDistance(0,e.padding[0],!1),$=Math.max($,Q)),T===c.length-1&&(Q=h.getAbsoluteDistance(100,e.padding[1],!0),$=Math.min($,Q))),ie||($=h.getStep($)),$=Er($),$===k[T]&&!J?!1:$}function Bn(k,T){var $=e.ort;return($?T:k)+", "+($?k:T)}function Oi(k,T,$,B,x){var J=$.slice(),ie=B[0],Q=e.events.smoothSteps,_e=[!k,k],ve=[k,!k];B=B.slice(),k&&B.reverse(),B.length>1?B.forEach(function(Ee,he){var Te=pn(J,Ee,J[Ee]+T,_e[he],ve[he],!1,Q);Te===!1?T=0:(T=Te-J[Ee],J[Ee]=Te)}):_e=ve=[!0];var Se=!1;B.forEach(function(Ee,he){Se=St(Ee,$[Ee]+T,_e[he],ve[he],!1,Q)||Se}),Se&&(B.forEach(function(Ee){Ie("update",Ee),Ie("slide",Ee)}),x!=null&&Ie("drag",ie))}function Ai(k,T){return e.dir?100-k-T:k}function Bl(k,T){g[k]=T,m[k]=h.fromStepping(T);var $=Ai(T,0)-A,B="translate("+Bn($+"%","0")+")";if(c[k].style[e.transformRule]=B,e.events.invertConnects&&g.length>1){var x=g.every(function(J,ie,Q){return ie===0||J>=Q[ie-1]});if(R!==!x){xl();return}}Xt(k),Xt(k+1),R&&(Xt(k-1),Xt(k+2))}function zn(){v.forEach(function(k){var T=g[k]>50?-1:1,$=3+(c.length+T*k);c[k].style.zIndex=String($)})}function St(k,T,$,B,x,J){return x||(T=pn(g,k,T,$,B,!1,J)),T===!1?!1:(Bl(k,T),!0)}function Xt(k){if(u[k]){var T=g.slice();R&&T.sort(function(Q,_e){return Q-_e});var $=0,B=100;k!==0&&($=T[k-1]),k!==u.length-1&&(B=T[k]);var x=B-$,J="translate("+Bn(Ai($,x)+"%","0")+")",ie="scale("+Bn(x/100,"1")+")";u[k].style[e.transformRule]=J+" "+ie}}function Ti(k,T){return k===null||k===!1||k===void 0||(typeof k=="number"&&(k=String(k)),k=e.format.from(k),k!==!1&&(k=h.toStepping(k)),k===!1||isNaN(k))?g[T]:k}function gn(k,T,$){var B=Nn(k),x=g[0]===void 0;T=T===void 0?!0:T,e.animate&&!x&&Sr(l,e.cssClasses.tap,e.animationDuration),v.forEach(function(Q){St(Q,Ti(B[Q],Q),!0,!1,$)});var J=v.length===1?0:1;if(x&&h.hasNoSize()&&($=!0,g[0]=0,v.length>1)){var ie=100/(v.length-1);v.forEach(function(Q){g[Q]=Q*ie})}for(;J<v.length;++J)v.forEach(function(Q){St(Q,g[Q],!0,!0,$)});zn(),v.forEach(function(Q){Ie("update",Q),B[Q]!==null&&T&&Ie("set",Q)})}function zl(k){gn(e.start,k)}function Kl(k,T,$,B){if(k=Number(k),!(k>=0&&k<v.length))throw new Error("noUiSlider: invalid handle number, got: "+k);St(k,Ti(T,k),!0,!0,B),Ie("update",k),$&&Ie("set",k)}function Pi(k){if(k===void 0&&(k=!1),k)return m.length===1?m[0]:m.slice(0);var T=m.map(e.format.to);return T.length===1?T[0]:T}function Wl(){for(Jt(pt.aria),Jt(pt.tooltips),Object.keys(e.cssClasses).forEach(function(k){Cn(l,e.cssClasses[k])});l.firstChild;)l.removeChild(l.firstChild);delete l.noUiSlider}function Li(k){var T=g[k],$=h.getNearbySteps(T),B=m[k],x=$.thisStep.step,J=null;if(e.snap)return[B-$.stepBefore.startValue||null,$.stepAfter.startValue-B||null];x!==!1&&B+x>$.stepAfter.startValue&&(x=$.stepAfter.startValue-B),B>$.thisStep.startValue?J=$.thisStep.step:$.stepBefore.step===!1?J=!1:J=B-$.stepBefore.highestStep,T===100?x=null:T===0&&(J=null);var ie=h.countStepDecimals();return x!==null&&x!==!1&&(x=Number(x.toFixed(ie))),J!==null&&J!==!1&&(J=Number(J.toFixed(ie))),[J,x]}function Gl(){return v.map(Li)}function Yl(k,T){var $=Pi(),B=["margin","limit","padding","range","animate","snap","step","format","pips","tooltips","connect"];B.forEach(function(J){k[J]!==void 0&&(t[J]=k[J])});var x=gl(t);B.forEach(function(J){k[J]!==void 0&&(e[J]=x[J])}),h=x.spectrum,e.margin=x.margin,e.limit=x.limit,e.padding=x.padding,e.pips?Yt(e.pips):Gt(),e.tooltips?Y():F(),g=[],gn(ii(k.start)?k.start:$,T),k.connect&&Mi()}function Mi(){for(;a.firstChild;)a.removeChild(a.firstChild);for(var k=0;k<=e.handles;k++)u[k]=Z(a,e.connect[k]),Xt(k);Ii({drag:e.events.drag,fixed:!0})}function xl(){R=!R,ml(e,e.connect.map(function(k){return!k})),Mi()}function Jl(){o=V(l),se(e.connect,o),Ii(e.events),gn(e.start),e.pips&&Yt(e.pips),e.tooltips&&Y(),ee()}Jl();var _n={destroy:Wl,steps:Gl,on:qn,off:Jt,get:Pi,set:gn,setHandle:Kl,reset:zl,disable:q,enable:re,__moveHandles:function(k,T,$){Oi(k,T,g,$)},options:t,updateOptions:Yl,target:l,removePips:Gt,removeTooltips:F,getPositions:function(){return g.slice()},getTooltips:function(){return f},getOrigins:function(){return c},pips:Yt};return _n}function Uc(n,e){if(!n||!n.nodeName)throw new Error("noUiSlider: create requires a single element, got: "+n);if(n.noUiSlider)throw new Error("noUiSlider: Slider was already initialized.");var t=gl(e),i=Vc(n,t,e);return n.noUiSlider=i,i}const Fc={__spectrum:dl,cssClasses:hl,create:Uc};function Hc(n){let e,t,i,r,s,l,o,a,c,u,d,f,h,m,g,v;return{c(){e=b("div"),t=b("span"),i=G(n[2]),r=G(" ("),s=G(n[3]),l=G(")"),o=N(),a=b("div"),c=b("span"),u=G(n[0]),d=N(),f=b("div"),h=b("div"),m=N(),g=b("span"),v=G(n[1]),p(c,"class","range-marker svelte-216mtn"),p(h,"class","slider"),p(h,"id",n[4]),p(f,"class","slider-wrapper svelte-216mtn"),p(g,"class","range-marker svelte-216mtn"),p(a,"class","slider-outer-wrapper is-flex flex-direction-row svelte-216mtn")},m(w,I){E(w,e,I),_(e,t),_(t,i),_(t,r),_(t,s),_(t,l),_(e,o),_(e,a),_(a,c),_(c,u),_(a,d),_(a,f),_(f,h),_(a,m),_(a,g),_(g,v)},p(w,[I]){I&4&&de(i,w[2]),I&8&&de(s,w[3]),I&1&&de(u,w[0]),I&2&&de(v,w[1])},i:j,o:j,d(w){w&&S(e)}}}function qc(n,e,t){let i,{minVal:r}=e,{maxVal:s}=e,{start:l}=e,{step:o=void 0}=e,{roundTo:a=2}=e,{title:c=""}=e,{emitOnUpdate:u=!1}=e;const d=zt(),f=`slider-${window.crypto.randomUUID()}`,h=Array.isArray(l)&&l.length===2&&l.every(y=>!isNaN(parseFloat(y))),m=[],g=h?[`noUi-handle-${window.crypto.randomUUID()}`,`noUi-handle-${window.crypto.randomUUID()}`]:[`noUi-handle-${window.crypto.randomUUID()}`],v=Pn();v.setCompareFn(h?vi:(y,D)=>I(y)===I(D)),v.set(l);const w=De("resetTrigger")||void 0;w==null||w.subscribe(O);const I=y=>Number(y.toFixed(a)),R=(y,D)=>{y=Array.isArray(y)?y.map(I):I(y),t(3,i=y),(D==="set"||D==="update"&&u)&&(v.set(y),v.same()||d("updateSlider",v.get()))};function C(y){m.length&&m.map((D,Z)=>D.$set({tooltipText:h?y[Z]:y}))}function O(){const y=document.getElementById(f);y!=null&&y.noUiSlider&&y.noUiSlider.reset()}function L(){const y=document.getElementById(f);let D;Fc.create(y,{start:l,step:o,connect:h?!0:"lower",range:{min:r,max:s},handleAttributes:g.map(Z=>({id:Z}))}),y.noUiSlider.on("update",()=>{D=y.noUiSlider.get(!0),R(D,"update")}),y.noUiSlider.on("set",()=>{D=y.noUiSlider.get(!0),R(D,"set")})}function A(){g.map((y,D)=>{m.push(new fn({target:document.getElementById(y),props:h?{tooltipText:i[D]}:{tooltipText:i}}))})}return mt(()=>{L(),A()}),cn(()=>{document.getElementById(f)&&(document.getElementById(f).innerHTML="")}),n.$$set=y=>{"minVal"in y&&t(0,r=y.minVal),"maxVal"in y&&t(1,s=y.maxVal),"start"in y&&t(5,l=y.start),"step"in y&&t(6,o=y.step),"roundTo"in y&&t(7,a=y.roundTo),"title"in y&&t(2,c=y.title),"emitOnUpdate"in y&&t(8,u=y.emitOnUpdate)},n.$$.update=()=>{n.$$.dirty&32&&t(3,i=l),n.$$.dirty&8&&C(i)},[r,s,c,i,f,l,o,a,u]}class Et extends ce{constructor(e){super(),ae(this,e,qc,Hc,le,{minVal:0,maxVal:1,start:5,step:6,roundTo:7,title:2,emitOnUpdate:8})}}/*! choices.js v11.1.0 | © 2025 Josh Johnson | https://github.com/jshjohnson/Choices#readme */var si=function(n,e){return si=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])},si(n,e)};function _l(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");si(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var Ge=function(){return Ge=Object.assign||function(e){for(var t,i=1,r=arguments.length;i<r;i++){t=arguments[i];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e},Ge.apply(this,arguments)};function Bc(n,e,t){if(t||arguments.length===2)for(var i=0,r=e.length,s;i<r;i++)(s||!(i in e))&&(s||(s=Array.prototype.slice.call(e,0,i)),s[i]=e[i]);return n.concat(s||Array.prototype.slice.call(e))}var Ae={ADD_CHOICE:"ADD_CHOICE",REMOVE_CHOICE:"REMOVE_CHOICE",FILTER_CHOICES:"FILTER_CHOICES",ACTIVATE_CHOICES:"ACTIVATE_CHOICES",CLEAR_CHOICES:"CLEAR_CHOICES",ADD_GROUP:"ADD_GROUP",ADD_ITEM:"ADD_ITEM",REMOVE_ITEM:"REMOVE_ITEM",HIGHLIGHT_ITEM:"HIGHLIGHT_ITEM"},We={showDropdown:"showDropdown",hideDropdown:"hideDropdown",change:"change",choice:"choice",search:"search",addItem:"addItem",removeItem:"removeItem",highlightItem:"highlightItem",highlightChoice:"highlightChoice",unhighlightItem:"unhighlightItem"},je={TAB_KEY:9,SHIFT_KEY:16,BACK_KEY:46,DELETE_KEY:8,ENTER_KEY:13,A_KEY:65,ESC_KEY:27,UP_KEY:38,DOWN_KEY:40,PAGE_UP_KEY:33,PAGE_DOWN_KEY:34},zc=["fuseOptions","classNames"],vt={Text:"text",SelectOne:"select-one",SelectMultiple:"select-multiple"},Ir=function(n){return{type:Ae.ADD_CHOICE,choice:n}},Kc=function(n){return{type:Ae.REMOVE_CHOICE,choice:n}},Wc=function(n){return{type:Ae.FILTER_CHOICES,results:n}},Gc=function(n){return{type:Ae.ACTIVATE_CHOICES,active:n}},Yc=function(n){return{type:Ae.ADD_GROUP,group:n}},Or=function(n){return{type:Ae.ADD_ITEM,item:n}},Ar=function(n){return{type:Ae.REMOVE_ITEM,item:n}},yn=function(n,e){return{type:Ae.HIGHLIGHT_ITEM,item:n,highlighted:e}},xc=function(n,e){return Math.floor(Math.random()*(e-n)+n)},Tr=function(n){return Array.from({length:n},function(){return xc(0,36).toString(36)}).join("")},Jc=function(n,e){var t=n.id||n.name&&"".concat(n.name,"-").concat(Tr(2))||Tr(4);return t=t.replace(/(:|\.|\[|\]|,)/g,""),t="".concat(e,"-").concat(t),t},Xc=function(n,e,t){t===void 0&&(t=1);for(var i="".concat(t>0?"next":"previous","ElementSibling"),r=n[i];r;){if(r.matches(e))return r;r=r[i]}return null},Qc=function(n,e,t){t===void 0&&(t=1);var i;return t>0?i=e.scrollTop+e.offsetHeight>=n.offsetTop+n.offsetHeight:i=n.offsetTop>=e.scrollTop,i},jn=function(n){if(typeof n!="string"){if(n==null)return"";if(typeof n=="object"){if("raw"in n)return jn(n.raw);if("trusted"in n)return n.trusted}return n}return n.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/'/g,"&#039;").replace(/"/g,"&quot;")},Zc=function(){var n=document.createElement("div");return function(e){n.innerHTML=e.trim();for(var t=n.children[0];n.firstChild;)n.removeChild(n.firstChild);return t}}(),rn=function(n,e){return typeof n=="function"?n(jn(e),e):n},Pr=function(n){return typeof n=="function"?n():n},It=function(n){if(typeof n=="string")return n;if(typeof n=="object"){if("trusted"in n)return n.trusted;if("raw"in n)return n.raw}return""},vl=function(n){if(typeof n=="string")return n;if(typeof n=="object"){if("escaped"in n)return n.escaped;if("trusted"in n)return n.trusted}return""},Si=function(n,e){return n?vl(e):jn(e)},at=function(n,e,t){n.innerHTML=Si(e,t)},eu=function(n,e){var t=n.value,i=n.label,r=i===void 0?t:i,s=e.value,l=e.label,o=l===void 0?s:l;return It(r).localeCompare(It(o),[],{sensitivity:"base",ignorePunctuation:!0,numeric:!0})},tu=function(n,e){return n.rank-e.rank},nu=function(n,e,t){t===void 0&&(t=null);var i=new CustomEvent(e,{detail:t,bubbles:!0,cancelable:!0});return n.dispatchEvent(i)},iu=function(n,e){var t=Object.keys(n).sort(),i=Object.keys(e).sort();return t.filter(function(r){return i.indexOf(r)<0})},Vn=function(n){return Array.isArray(n)?n:[n]},en=function(n){return n&&Array.isArray(n)?n.map(function(e){return".".concat(e)}).join(""):".".concat(n)},fe=function(n,e){var t;(t=n.classList).add.apply(t,Vn(e))},st=function(n,e){var t;(t=n.classList).remove.apply(t,Vn(e))},ru=function(n){if(typeof n<"u")try{return JSON.parse(n)}catch{return n}return{}},su=function(n,e,t){var i=n.itemEl;i&&(st(i,t),fe(i,e))},lu=function(){function n(e){var t=e.element,i=e.type,r=e.classNames;this.element=t,this.classNames=r,this.type=i,this.isActive=!1}return n.prototype.show=function(){return fe(this.element,this.classNames.activeState),this.element.setAttribute("aria-expanded","true"),this.isActive=!0,this},n.prototype.hide=function(){return st(this.element,this.classNames.activeState),this.element.setAttribute("aria-expanded","false"),this.isActive=!1,this},n}(),Lr=function(){function n(e){var t=e.element,i=e.type,r=e.classNames,s=e.position;this.element=t,this.classNames=r,this.type=i,this.position=s,this.isOpen=!1,this.isFlipped=!1,this.isDisabled=!1,this.isLoading=!1}return n.prototype.shouldFlip=function(e,t){var i=!1;return this.position==="auto"?i=this.element.getBoundingClientRect().top-t>=0&&!window.matchMedia("(min-height: ".concat(e+1,"px)")).matches:this.position==="top"&&(i=!0),i},n.prototype.setActiveDescendant=function(e){this.element.setAttribute("aria-activedescendant",e)},n.prototype.removeActiveDescendant=function(){this.element.removeAttribute("aria-activedescendant")},n.prototype.open=function(e,t){fe(this.element,this.classNames.openState),this.element.setAttribute("aria-expanded","true"),this.isOpen=!0,this.shouldFlip(e,t)&&(fe(this.element,this.classNames.flippedState),this.isFlipped=!0)},n.prototype.close=function(){st(this.element,this.classNames.openState),this.element.setAttribute("aria-expanded","false"),this.removeActiveDescendant(),this.isOpen=!1,this.isFlipped&&(st(this.element,this.classNames.flippedState),this.isFlipped=!1)},n.prototype.addFocusState=function(){fe(this.element,this.classNames.focusState)},n.prototype.removeFocusState=function(){st(this.element,this.classNames.focusState)},n.prototype.enable=function(){st(this.element,this.classNames.disabledState),this.element.removeAttribute("aria-disabled"),this.type===vt.SelectOne&&this.element.setAttribute("tabindex","0"),this.isDisabled=!1},n.prototype.disable=function(){fe(this.element,this.classNames.disabledState),this.element.setAttribute("aria-disabled","true"),this.type===vt.SelectOne&&this.element.setAttribute("tabindex","-1"),this.isDisabled=!0},n.prototype.wrap=function(e){var t=this.element,i=e.parentNode;i&&(e.nextSibling?i.insertBefore(t,e.nextSibling):i.appendChild(t)),t.appendChild(e)},n.prototype.unwrap=function(e){var t=this.element,i=t.parentNode;i&&(i.insertBefore(e,t),i.removeChild(t))},n.prototype.addLoadingState=function(){fe(this.element,this.classNames.loadingState),this.element.setAttribute("aria-busy","true"),this.isLoading=!0},n.prototype.removeLoadingState=function(){st(this.element,this.classNames.loadingState),this.element.removeAttribute("aria-busy"),this.isLoading=!1},n}(),ou=function(){function n(e){var t=e.element,i=e.type,r=e.classNames,s=e.preventPaste;this.element=t,this.type=i,this.classNames=r,this.preventPaste=s,this.isFocussed=this.element.isEqualNode(document.activeElement),this.isDisabled=t.disabled,this._onPaste=this._onPaste.bind(this),this._onInput=this._onInput.bind(this),this._onFocus=this._onFocus.bind(this),this._onBlur=this._onBlur.bind(this)}return Object.defineProperty(n.prototype,"placeholder",{set:function(e){this.element.placeholder=e},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"value",{get:function(){return this.element.value},set:function(e){this.element.value=e},enumerable:!1,configurable:!0}),n.prototype.addEventListeners=function(){var e=this.element;e.addEventListener("paste",this._onPaste),e.addEventListener("input",this._onInput,{passive:!0}),e.addEventListener("focus",this._onFocus,{passive:!0}),e.addEventListener("blur",this._onBlur,{passive:!0})},n.prototype.removeEventListeners=function(){var e=this.element;e.removeEventListener("input",this._onInput),e.removeEventListener("paste",this._onPaste),e.removeEventListener("focus",this._onFocus),e.removeEventListener("blur",this._onBlur)},n.prototype.enable=function(){var e=this.element;e.removeAttribute("disabled"),this.isDisabled=!1},n.prototype.disable=function(){var e=this.element;e.setAttribute("disabled",""),this.isDisabled=!0},n.prototype.focus=function(){this.isFocussed||this.element.focus()},n.prototype.blur=function(){this.isFocussed&&this.element.blur()},n.prototype.clear=function(e){return e===void 0&&(e=!0),this.element.value="",e&&this.setWidth(),this},n.prototype.setWidth=function(){var e=this.element;e.style.minWidth="".concat(e.placeholder.length+1,"ch"),e.style.width="".concat(e.value.length+1,"ch")},n.prototype.setActiveDescendant=function(e){this.element.setAttribute("aria-activedescendant",e)},n.prototype.removeActiveDescendant=function(){this.element.removeAttribute("aria-activedescendant")},n.prototype._onInput=function(){this.type!==vt.SelectOne&&this.setWidth()},n.prototype._onPaste=function(e){this.preventPaste&&e.preventDefault()},n.prototype._onFocus=function(){this.isFocussed=!0},n.prototype._onBlur=function(){this.isFocussed=!1},n}(),au=4,Mr=function(){function n(e){var t=e.element;this.element=t,this.scrollPos=this.element.scrollTop,this.height=this.element.offsetHeight}return n.prototype.prepend=function(e){var t=this.element.firstElementChild;t?this.element.insertBefore(e,t):this.element.append(e)},n.prototype.scrollToTop=function(){this.element.scrollTop=0},n.prototype.scrollToChildElement=function(e,t){var i=this;if(e){var r=this.element.offsetHeight,s=this.element.scrollTop+r,l=e.offsetHeight,o=e.offsetTop+l,a=t>0?this.element.scrollTop+o-s:e.offsetTop;requestAnimationFrame(function(){i._animateScroll(a,t)})}},n.prototype._scrollDown=function(e,t,i){var r=(i-e)/t,s=r>1?r:1;this.element.scrollTop=e+s},n.prototype._scrollUp=function(e,t,i){var r=(e-i)/t,s=r>1?r:1;this.element.scrollTop=e-s},n.prototype._animateScroll=function(e,t){var i=this,r=au,s=this.element.scrollTop,l=!1;t>0?(this._scrollDown(s,r,e),s<e&&(l=!0)):(this._scrollUp(s,r,e),s>e&&(l=!0)),l&&requestAnimationFrame(function(){i._animateScroll(e,t)})},n}(),bl=function(){function n(e){var t=e.element,i=e.classNames;this.element=t,this.classNames=i,this.isDisabled=!1}return Object.defineProperty(n.prototype,"isActive",{get:function(){return this.element.dataset.choice==="active"},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"dir",{get:function(){return this.element.dir},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"value",{get:function(){return this.element.value},set:function(e){this.element.setAttribute("value",e),this.element.value=e},enumerable:!1,configurable:!0}),n.prototype.conceal=function(){var e=this.element;fe(e,this.classNames.input),e.hidden=!0,e.tabIndex=-1;var t=e.getAttribute("style");t&&e.setAttribute("data-choice-orig-style",t),e.setAttribute("data-choice","active")},n.prototype.reveal=function(){var e=this.element;st(e,this.classNames.input),e.hidden=!1,e.removeAttribute("tabindex");var t=e.getAttribute("data-choice-orig-style");t?(e.removeAttribute("data-choice-orig-style"),e.setAttribute("style",t)):e.removeAttribute("style"),e.removeAttribute("data-choice")},n.prototype.enable=function(){this.element.removeAttribute("disabled"),this.element.disabled=!1,this.isDisabled=!1},n.prototype.disable=function(){this.element.setAttribute("disabled",""),this.element.disabled=!0,this.isDisabled=!0},n.prototype.triggerEvent=function(e,t){nu(this.element,e,t||{})},n}(),cu=function(n){_l(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e}(bl),nn=function(n,e){return e===void 0&&(e=!0),typeof n>"u"?e:!!n},wl=function(n){if(typeof n=="string"&&(n=n.split(" ").filter(function(e){return e.length})),Array.isArray(n)&&n.length)return n},rt=function(n,e,t){if(t===void 0&&(t=!0),typeof n=="string"){var i=jn(n),r=t||i===n?n:{escaped:i,raw:n},s=rt({value:n,label:r,selected:!0},!1);return s}var l=n;if("choices"in l){if(!e)throw new TypeError("optGroup is not allowed");var o=l,a=o.choices.map(function(f){return rt(f,!1)}),c={id:0,label:It(o.label)||o.value,active:!!a.length,disabled:!!o.disabled,choices:a};return c}var u=l,d={id:0,group:null,score:0,rank:0,value:u.value,label:u.label||u.value,active:nn(u.active),selected:nn(u.selected,!1),disabled:nn(u.disabled,!1),placeholder:nn(u.placeholder,!1),highlighted:!1,labelClass:wl(u.labelClass),labelDescription:u.labelDescription,customProperties:u.customProperties};return d},uu=function(n){return n.tagName==="INPUT"},yl=function(n){return n.tagName==="SELECT"},fu=function(n){return n.tagName==="OPTION"},du=function(n){return n.tagName==="OPTGROUP"},hu=function(n){_l(e,n);function e(t){var i=t.element,r=t.classNames,s=t.template,l=t.extractPlaceholder,o=n.call(this,{element:i,classNames:r})||this;return o.template=s,o.extractPlaceholder=l,o}return Object.defineProperty(e.prototype,"placeholderOption",{get:function(){return this.element.querySelector('option[value=""]')||this.element.querySelector("option[placeholder]")},enumerable:!1,configurable:!0}),e.prototype.addOptions=function(t){var i=this,r=document.createDocumentFragment();t.forEach(function(s){var l=s;if(!l.element){var o=i.template(l);r.appendChild(o),l.element=o}}),this.element.appendChild(r)},e.prototype.optionsAsChoices=function(){var t=this,i=[];return this.element.querySelectorAll(":scope > option, :scope > optgroup").forEach(function(r){fu(r)?i.push(t._optionToChoice(r)):du(r)&&i.push(t._optgroupToChoice(r))}),i},e.prototype._optionToChoice=function(t){return!t.hasAttribute("value")&&t.hasAttribute("placeholder")&&(t.setAttribute("value",""),t.value=""),{id:0,group:null,score:0,rank:0,value:t.value,label:t.label,element:t,active:!0,selected:this.extractPlaceholder?t.selected:t.hasAttribute("selected"),disabled:t.disabled,highlighted:!1,placeholder:this.extractPlaceholder&&(!t.value||t.hasAttribute("placeholder")),labelClass:typeof t.dataset.labelClass<"u"?wl(t.dataset.labelClass):void 0,labelDescription:typeof t.dataset.labelDescription<"u"?t.dataset.labelDescription:void 0,customProperties:ru(t.dataset.customProperties)}},e.prototype._optgroupToChoice=function(t){var i=this,r=t.querySelectorAll("option"),s=Array.from(r).map(function(l){return i._optionToChoice(l)});return{id:0,label:t.label||"",element:t,active:!!s.length,disabled:t.disabled,choices:s}},e}(bl),mu={containerOuter:["choices"],containerInner:["choices__inner"],input:["choices__input"],inputCloned:["choices__input--cloned"],list:["choices__list"],listItems:["choices__list--multiple"],listSingle:["choices__list--single"],listDropdown:["choices__list--dropdown"],item:["choices__item"],itemSelectable:["choices__item--selectable"],itemDisabled:["choices__item--disabled"],itemChoice:["choices__item--choice"],description:["choices__description"],placeholder:["choices__placeholder"],group:["choices__group"],groupHeading:["choices__heading"],button:["choices__button"],activeState:["is-active"],focusState:["is-focused"],openState:["is-open"],disabledState:["is-disabled"],highlightedState:["is-highlighted"],selectedState:["is-selected"],flippedState:["is-flipped"],loadingState:["is-loading"],notice:["choices__notice"],addChoice:["choices__item--selectable","add-choice"],noResults:["has-no-results"],noChoices:["has-no-choices"]},$r={items:[],choices:[],silent:!1,renderChoiceLimit:-1,maxItemCount:-1,closeDropdownOnSelect:"auto",singleModeForMultiSelect:!1,addChoices:!1,addItems:!0,addItemFilter:function(n){return!!n&&n!==""},removeItems:!0,removeItemButton:!1,removeItemButtonAlignLeft:!1,editItems:!1,allowHTML:!1,allowHtmlUserInput:!1,duplicateItemsAllowed:!0,delimiter:",",paste:!0,searchEnabled:!0,searchChoices:!0,searchFloor:1,searchResultLimit:4,searchFields:["label","value"],position:"auto",resetScrollPosition:!0,shouldSort:!0,shouldSortItems:!1,sorter:eu,shadowRoot:null,placeholder:!0,placeholderValue:null,searchPlaceholderValue:null,prependValue:null,appendValue:null,renderSelectedChoices:"auto",loadingText:"Loading...",noResultsText:"No results found",noChoicesText:"No choices to choose from",itemSelectText:"Press to select",uniqueItemText:"Only unique values can be added",customAddItemText:"Only values matching specific conditions can be added",addItemText:function(n){return'Press Enter to add <b>"'.concat(n,'"</b>')},removeItemIconText:function(){return"Remove item"},removeItemLabelText:function(n){return"Remove item: ".concat(n)},maxItemText:function(n){return"Only ".concat(n," values can be added")},valueComparer:function(n,e){return n===e},fuseOptions:{includeScore:!0},labelId:"",callbackOnInit:null,callbackOnCreateTemplates:null,classNames:mu,appendGroupInSearch:!1},Rr=function(n){var e=n.itemEl;e&&(e.remove(),n.itemEl=void 0)};function pu(n,e,t){var i=n,r=!0;switch(e.type){case Ae.ADD_ITEM:{e.item.selected=!0;var s=e.item.element;s&&(s.selected=!0,s.setAttribute("selected","")),i.push(e.item);break}case Ae.REMOVE_ITEM:{e.item.selected=!1;var s=e.item.element;if(s){s.selected=!1,s.removeAttribute("selected");var l=s.parentElement;l&&yl(l)&&l.type===vt.SelectOne&&(l.value="")}Rr(e.item),i=i.filter(function(u){return u.id!==e.item.id});break}case Ae.REMOVE_CHOICE:{Rr(e.choice),i=i.filter(function(c){return c.id!==e.choice.id});break}case Ae.HIGHLIGHT_ITEM:{var o=e.highlighted,a=i.find(function(c){return c.id===e.item.id});a&&a.highlighted!==o&&(a.highlighted=o,t&&su(a,o?t.classNames.highlightedState:t.classNames.selectedState,o?t.classNames.selectedState:t.classNames.highlightedState));break}default:{r=!1;break}}return{state:i,update:r}}function gu(n,e){var t=n,i=!0;switch(e.type){case Ae.ADD_GROUP:{t.push(e.group);break}case Ae.CLEAR_CHOICES:{t=[];break}default:{i=!1;break}}return{state:t,update:i}}function _u(n,e,t){var i=n,r=!0;switch(e.type){case Ae.ADD_CHOICE:{i.push(e.choice);break}case Ae.REMOVE_CHOICE:{e.choice.choiceEl=void 0,e.choice.group&&(e.choice.group.choices=e.choice.group.choices.filter(function(l){return l.id!==e.choice.id})),i=i.filter(function(l){return l.id!==e.choice.id});break}case Ae.ADD_ITEM:case Ae.REMOVE_ITEM:{e.item.choiceEl=void 0;break}case Ae.FILTER_CHOICES:{var s=[];e.results.forEach(function(l){s[l.item.id]=l}),i.forEach(function(l){var o=s[l.id];o!==void 0?(l.score=o.score,l.rank=o.rank,l.active=!0):(l.score=0,l.rank=0,l.active=!1),t&&t.appendGroupInSearch&&(l.choiceEl=void 0)});break}case Ae.ACTIVATE_CHOICES:{i.forEach(function(l){l.active=e.active,t&&t.appendGroupInSearch&&(l.choiceEl=void 0)});break}case Ae.CLEAR_CHOICES:{i=[];break}default:{r=!1;break}}return{state:i,update:r}}var Dr={groups:gu,items:pu,choices:_u},vu=function(){function n(e){this._state=this.defaultState,this._listeners=[],this._txn=0,this._context=e}return Object.defineProperty(n.prototype,"defaultState",{get:function(){return{groups:[],items:[],choices:[]}},enumerable:!1,configurable:!0}),n.prototype.changeSet=function(e){return{groups:e,items:e,choices:e}},n.prototype.reset=function(){this._state=this.defaultState;var e=this.changeSet(!0);this._txn?this._changeSet=e:this._listeners.forEach(function(t){return t(e)})},n.prototype.subscribe=function(e){return this._listeners.push(e),this},n.prototype.dispatch=function(e){var t=this,i=this._state,r=!1,s=this._changeSet||this.changeSet(!1);Object.keys(Dr).forEach(function(l){var o=Dr[l](i[l],e,t._context);o.update&&(r=!0,s[l]=!0,i[l]=o.state)}),r&&(this._txn?this._changeSet=s:this._listeners.forEach(function(l){return l(s)}))},n.prototype.withTxn=function(e){this._txn++;try{e()}finally{if(this._txn=Math.max(0,this._txn-1),!this._txn){var t=this._changeSet;t&&(this._changeSet=void 0,this._listeners.forEach(function(i){return i(t)}))}}},Object.defineProperty(n.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"items",{get:function(){return this.state.items},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"highlightedActiveItems",{get:function(){return this.items.filter(function(e){return e.active&&e.highlighted})},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"choices",{get:function(){return this.state.choices},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"activeChoices",{get:function(){return this.choices.filter(function(e){return e.active})},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"searchableChoices",{get:function(){return this.choices.filter(function(e){return!e.disabled&&!e.placeholder})},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"groups",{get:function(){return this.state.groups},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"activeGroups",{get:function(){var e=this;return this.state.groups.filter(function(t){var i=t.active&&!t.disabled,r=e.state.choices.some(function(s){return s.active&&!s.disabled});return i&&r},[])},enumerable:!1,configurable:!0}),n.prototype.inTxn=function(){return this._txn>0},n.prototype.getChoiceById=function(e){return this.activeChoices.find(function(t){return t.id===e})},n.prototype.getGroupById=function(e){return this.groups.find(function(t){return t.id===e})},n}(),Me={noChoices:"no-choices",noResults:"no-results",addChoice:"add-choice",generic:""};function bu(n,e,t){return(e=yu(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function Nr(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(n,r).enumerable})),t.push.apply(t,i)}return t}function Mt(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Nr(Object(t),!0).forEach(function(i){bu(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Nr(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}function wu(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var i=t.call(n,e||"default");if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function yu(n){var e=wu(n,"string");return typeof e=="symbol"?e:e+""}function ht(n){return Array.isArray?Array.isArray(n):El(n)==="[object Array]"}const ku=1/0;function Su(n){if(typeof n=="string")return n;let e=n+"";return e=="0"&&1/n==-ku?"-0":e}function Eu(n){return n==null?"":Su(n)}function lt(n){return typeof n=="string"}function kl(n){return typeof n=="number"}function Cu(n){return n===!0||n===!1||Iu(n)&&El(n)=="[object Boolean]"}function Sl(n){return typeof n=="object"}function Iu(n){return Sl(n)&&n!==null}function Ye(n){return n!=null}function Xn(n){return!n.trim().length}function El(n){return n==null?n===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(n)}const Ou="Incorrect 'index' type",Au=n=>`Invalid value for key ${n}`,Tu=n=>`Pattern length exceeds max of ${n}.`,Pu=n=>`Missing ${n} property in key`,Lu=n=>`Property 'weight' in key '${n}' must be a positive integer`,jr=Object.prototype.hasOwnProperty;class Mu{constructor(e){this._keys=[],this._keyMap={};let t=0;e.forEach(i=>{let r=Cl(i);this._keys.push(r),this._keyMap[r.id]=r,t+=r.weight}),this._keys.forEach(i=>{i.weight/=t})}get(e){return this._keyMap[e]}keys(){return this._keys}toJSON(){return JSON.stringify(this._keys)}}function Cl(n){let e=null,t=null,i=null,r=1,s=null;if(lt(n)||ht(n))i=n,e=Vr(n),t=li(n);else{if(!jr.call(n,"name"))throw new Error(Pu("name"));const l=n.name;if(i=l,jr.call(n,"weight")&&(r=n.weight,r<=0))throw new Error(Lu(l));e=Vr(l),t=li(l),s=n.getFn}return{path:e,id:t,weight:r,src:i,getFn:s}}function Vr(n){return ht(n)?n:n.split(".")}function li(n){return ht(n)?n.join("."):n}function $u(n,e){let t=[],i=!1;const r=(s,l,o)=>{if(Ye(s))if(!l[o])t.push(s);else{let a=l[o];const c=s[a];if(!Ye(c))return;if(o===l.length-1&&(lt(c)||kl(c)||Cu(c)))t.push(Eu(c));else if(ht(c)){i=!0;for(let u=0,d=c.length;u<d;u+=1)r(c[u],l,o+1)}else l.length&&r(c,l,o+1)}};return r(n,lt(e)?e.split("."):e,0),i?t:t[0]}const Ru={includeMatches:!1,findAllMatches:!1,minMatchCharLength:1},Du={isCaseSensitive:!1,includeScore:!1,keys:[],shouldSort:!0,sortFn:(n,e)=>n.score===e.score?n.idx<e.idx?-1:1:n.score<e.score?-1:1},Nu={location:0,threshold:.6,distance:100},ju={useExtendedSearch:!1,getFn:$u,ignoreLocation:!1,ignoreFieldNorm:!1,fieldNormWeight:1};var oe=Mt(Mt(Mt(Mt({},Du),Ru),Nu),ju);const Vu=/[^ ]+/g;function Uu(n=1,e=3){const t=new Map,i=Math.pow(10,e);return{get(r){const s=r.match(Vu).length;if(t.has(s))return t.get(s);const l=1/Math.pow(s,.5*n),o=parseFloat(Math.round(l*i)/i);return t.set(s,o),o},clear(){t.clear()}}}class Ei{constructor({getFn:e=oe.getFn,fieldNormWeight:t=oe.fieldNormWeight}={}){this.norm=Uu(t,3),this.getFn=e,this.isCreated=!1,this.setIndexRecords()}setSources(e=[]){this.docs=e}setIndexRecords(e=[]){this.records=e}setKeys(e=[]){this.keys=e,this._keysMap={},e.forEach((t,i)=>{this._keysMap[t.id]=i})}create(){this.isCreated||!this.docs.length||(this.isCreated=!0,lt(this.docs[0])?this.docs.forEach((e,t)=>{this._addString(e,t)}):this.docs.forEach((e,t)=>{this._addObject(e,t)}),this.norm.clear())}add(e){const t=this.size();lt(e)?this._addString(e,t):this._addObject(e,t)}removeAt(e){this.records.splice(e,1);for(let t=e,i=this.size();t<i;t+=1)this.records[t].i-=1}getValueForItemAtKeyId(e,t){return e[this._keysMap[t]]}size(){return this.records.length}_addString(e,t){if(!Ye(e)||Xn(e))return;let i={v:e,i:t,n:this.norm.get(e)};this.records.push(i)}_addObject(e,t){let i={i:t,$:{}};this.keys.forEach((r,s)=>{let l=r.getFn?r.getFn(e):this.getFn(e,r.path);if(Ye(l)){if(ht(l)){let o=[];const a=[{nestedArrIndex:-1,value:l}];for(;a.length;){const{nestedArrIndex:c,value:u}=a.pop();if(Ye(u))if(lt(u)&&!Xn(u)){let d={v:u,i:c,n:this.norm.get(u)};o.push(d)}else ht(u)&&u.forEach((d,f)=>{a.push({nestedArrIndex:f,value:d})})}i.$[s]=o}else if(lt(l)&&!Xn(l)){let o={v:l,n:this.norm.get(l)};i.$[s]=o}}}),this.records.push(i)}toJSON(){return{keys:this.keys,records:this.records}}}function Il(n,e,{getFn:t=oe.getFn,fieldNormWeight:i=oe.fieldNormWeight}={}){const r=new Ei({getFn:t,fieldNormWeight:i});return r.setKeys(n.map(Cl)),r.setSources(e),r.create(),r}function Fu(n,{getFn:e=oe.getFn,fieldNormWeight:t=oe.fieldNormWeight}={}){const{keys:i,records:r}=n,s=new Ei({getFn:e,fieldNormWeight:t});return s.setKeys(i),s.setIndexRecords(r),s}function kn(n,{errors:e=0,currentLocation:t=0,expectedLocation:i=0,distance:r=oe.distance,ignoreLocation:s=oe.ignoreLocation}={}){const l=e/n.length;if(s)return l;const o=Math.abs(i-t);return r?l+o/r:o?1:l}function Hu(n=[],e=oe.minMatchCharLength){let t=[],i=-1,r=-1,s=0;for(let l=n.length;s<l;s+=1){let o=n[s];o&&i===-1?i=s:!o&&i!==-1&&(r=s-1,r-i+1>=e&&t.push([i,r]),i=-1)}return n[s-1]&&s-i>=e&&t.push([i,s-1]),t}const Ct=32;function qu(n,e,t,{location:i=oe.location,distance:r=oe.distance,threshold:s=oe.threshold,findAllMatches:l=oe.findAllMatches,minMatchCharLength:o=oe.minMatchCharLength,includeMatches:a=oe.includeMatches,ignoreLocation:c=oe.ignoreLocation}={}){if(e.length>Ct)throw new Error(Tu(Ct));const u=e.length,d=n.length,f=Math.max(0,Math.min(i,d));let h=s,m=f;const g=o>1||a,v=g?Array(d):[];let w;for(;(w=n.indexOf(e,m))>-1;){let A=kn(e,{currentLocation:w,expectedLocation:f,distance:r,ignoreLocation:c});if(h=Math.min(A,h),m=w+u,g){let y=0;for(;y<u;)v[w+y]=1,y+=1}}m=-1;let I=[],R=1,C=u+d;const O=1<<u-1;for(let A=0;A<u;A+=1){let y=0,D=C;for(;y<D;)kn(e,{errors:A,currentLocation:f+D,expectedLocation:f,distance:r,ignoreLocation:c})<=h?y=D:C=D,D=Math.floor((C-y)/2+y);C=D;let Z=Math.max(1,f-D+1),se=l?d:Math.min(f+D,d)+u,V=Array(se+2);V[se+1]=(1<<A)-1;for(let X=se;X>=Z;X-=1){let H=X-1,q=t[n.charAt(H)];if(g&&(v[H]=+!!q),V[X]=(V[X+1]<<1|1)&q,A&&(V[X]|=(I[X+1]|I[X])<<1|1|I[X+1]),V[X]&O&&(R=kn(e,{errors:A,currentLocation:H,expectedLocation:f,distance:r,ignoreLocation:c}),R<=h)){if(h=R,m=H,m<=f)break;Z=Math.max(1,2*f-m)}}if(kn(e,{errors:A+1,currentLocation:f,expectedLocation:f,distance:r,ignoreLocation:c})>h)break;I=V}const L={isMatch:m>=0,score:Math.max(.001,R)};if(g){const A=Hu(v,o);A.length?a&&(L.indices=A):L.isMatch=!1}return L}function Bu(n){let e={};for(let t=0,i=n.length;t<i;t+=1){const r=n.charAt(t);e[r]=(e[r]||0)|1<<i-t-1}return e}class Ol{constructor(e,{location:t=oe.location,threshold:i=oe.threshold,distance:r=oe.distance,includeMatches:s=oe.includeMatches,findAllMatches:l=oe.findAllMatches,minMatchCharLength:o=oe.minMatchCharLength,isCaseSensitive:a=oe.isCaseSensitive,ignoreLocation:c=oe.ignoreLocation}={}){if(this.options={location:t,threshold:i,distance:r,includeMatches:s,findAllMatches:l,minMatchCharLength:o,isCaseSensitive:a,ignoreLocation:c},this.pattern=a?e:e.toLowerCase(),this.chunks=[],!this.pattern.length)return;const u=(f,h)=>{this.chunks.push({pattern:f,alphabet:Bu(f),startIndex:h})},d=this.pattern.length;if(d>Ct){let f=0;const h=d%Ct,m=d-h;for(;f<m;)u(this.pattern.substr(f,Ct),f),f+=Ct;if(h){const g=d-Ct;u(this.pattern.substr(g),g)}}else u(this.pattern,0)}searchIn(e){const{isCaseSensitive:t,includeMatches:i}=this.options;if(t||(e=e.toLowerCase()),this.pattern===e){let m={isMatch:!0,score:0};return i&&(m.indices=[[0,e.length-1]]),m}const{location:r,distance:s,threshold:l,findAllMatches:o,minMatchCharLength:a,ignoreLocation:c}=this.options;let u=[],d=0,f=!1;this.chunks.forEach(({pattern:m,alphabet:g,startIndex:v})=>{const{isMatch:w,score:I,indices:R}=qu(e,m,g,{location:r+v,distance:s,threshold:l,findAllMatches:o,minMatchCharLength:a,includeMatches:i,ignoreLocation:c});w&&(f=!0),d+=I,w&&R&&(u=[...u,...R])});let h={isMatch:f,score:f?d/this.chunks.length:1};return f&&i&&(h.indices=u),h}}class kt{constructor(e){this.pattern=e}static isMultiMatch(e){return Ur(e,this.multiRegex)}static isSingleMatch(e){return Ur(e,this.singleRegex)}search(){}}function Ur(n,e){const t=n.match(e);return t?t[1]:null}class zu extends kt{constructor(e){super(e)}static get type(){return"exact"}static get multiRegex(){return/^="(.*)"$/}static get singleRegex(){return/^=(.*)$/}search(e){const t=e===this.pattern;return{isMatch:t,score:t?0:1,indices:[0,this.pattern.length-1]}}}class Ku extends kt{constructor(e){super(e)}static get type(){return"inverse-exact"}static get multiRegex(){return/^!"(.*)"$/}static get singleRegex(){return/^!(.*)$/}search(e){const i=e.indexOf(this.pattern)===-1;return{isMatch:i,score:i?0:1,indices:[0,e.length-1]}}}class Wu extends kt{constructor(e){super(e)}static get type(){return"prefix-exact"}static get multiRegex(){return/^\^"(.*)"$/}static get singleRegex(){return/^\^(.*)$/}search(e){const t=e.startsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[0,this.pattern.length-1]}}}class Gu extends kt{constructor(e){super(e)}static get type(){return"inverse-prefix-exact"}static get multiRegex(){return/^!\^"(.*)"$/}static get singleRegex(){return/^!\^(.*)$/}search(e){const t=!e.startsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[0,e.length-1]}}}class Yu extends kt{constructor(e){super(e)}static get type(){return"suffix-exact"}static get multiRegex(){return/^"(.*)"\$$/}static get singleRegex(){return/^(.*)\$$/}search(e){const t=e.endsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[e.length-this.pattern.length,e.length-1]}}}class xu extends kt{constructor(e){super(e)}static get type(){return"inverse-suffix-exact"}static get multiRegex(){return/^!"(.*)"\$$/}static get singleRegex(){return/^!(.*)\$$/}search(e){const t=!e.endsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[0,e.length-1]}}}class Al extends kt{constructor(e,{location:t=oe.location,threshold:i=oe.threshold,distance:r=oe.distance,includeMatches:s=oe.includeMatches,findAllMatches:l=oe.findAllMatches,minMatchCharLength:o=oe.minMatchCharLength,isCaseSensitive:a=oe.isCaseSensitive,ignoreLocation:c=oe.ignoreLocation}={}){super(e),this._bitapSearch=new Ol(e,{location:t,threshold:i,distance:r,includeMatches:s,findAllMatches:l,minMatchCharLength:o,isCaseSensitive:a,ignoreLocation:c})}static get type(){return"fuzzy"}static get multiRegex(){return/^"(.*)"$/}static get singleRegex(){return/^(.*)$/}search(e){return this._bitapSearch.searchIn(e)}}class Tl extends kt{constructor(e){super(e)}static get type(){return"include"}static get multiRegex(){return/^'"(.*)"$/}static get singleRegex(){return/^'(.*)$/}search(e){let t=0,i;const r=[],s=this.pattern.length;for(;(i=e.indexOf(this.pattern,t))>-1;)t=i+s,r.push([i,t-1]);const l=!!r.length;return{isMatch:l,score:l?0:1,indices:r}}}const oi=[zu,Tl,Wu,Gu,xu,Yu,Ku,Al],Fr=oi.length,Ju=/ +(?=(?:[^\"]*\"[^\"]*\")*[^\"]*$)/,Xu="|";function Qu(n,e={}){return n.split(Xu).map(t=>{let i=t.trim().split(Ju).filter(s=>s&&!!s.trim()),r=[];for(let s=0,l=i.length;s<l;s+=1){const o=i[s];let a=!1,c=-1;for(;!a&&++c<Fr;){const u=oi[c];let d=u.isMultiMatch(o);d&&(r.push(new u(d,e)),a=!0)}if(!a)for(c=-1;++c<Fr;){const u=oi[c];let d=u.isSingleMatch(o);if(d){r.push(new u(d,e));break}}}return r})}const Zu=new Set([Al.type,Tl.type]);class ef{constructor(e,{isCaseSensitive:t=oe.isCaseSensitive,includeMatches:i=oe.includeMatches,minMatchCharLength:r=oe.minMatchCharLength,ignoreLocation:s=oe.ignoreLocation,findAllMatches:l=oe.findAllMatches,location:o=oe.location,threshold:a=oe.threshold,distance:c=oe.distance}={}){this.query=null,this.options={isCaseSensitive:t,includeMatches:i,minMatchCharLength:r,findAllMatches:l,ignoreLocation:s,location:o,threshold:a,distance:c},this.pattern=t?e:e.toLowerCase(),this.query=Qu(this.pattern,this.options)}static condition(e,t){return t.useExtendedSearch}searchIn(e){const t=this.query;if(!t)return{isMatch:!1,score:1};const{includeMatches:i,isCaseSensitive:r}=this.options;e=r?e:e.toLowerCase();let s=0,l=[],o=0;for(let a=0,c=t.length;a<c;a+=1){const u=t[a];l.length=0,s=0;for(let d=0,f=u.length;d<f;d+=1){const h=u[d],{isMatch:m,indices:g,score:v}=h.search(e);if(m){if(s+=1,o+=v,i){const w=h.constructor.type;Zu.has(w)?l=[...l,...g]:l.push(g)}}else{o=0,s=0,l.length=0;break}}if(s){let d={isMatch:!0,score:o/s};return i&&(d.indices=l),d}}return{isMatch:!1,score:1}}}const ai=[];function tf(...n){ai.push(...n)}function ci(n,e){for(let t=0,i=ai.length;t<i;t+=1){let r=ai[t];if(r.condition(n,e))return new r(n,e)}return new Ol(n,e)}const Mn={AND:"$and",OR:"$or"},ui={PATH:"$path",PATTERN:"$val"},fi=n=>!!(n[Mn.AND]||n[Mn.OR]),nf=n=>!!n[ui.PATH],rf=n=>!ht(n)&&Sl(n)&&!fi(n),Hr=n=>({[Mn.AND]:Object.keys(n).map(e=>({[e]:n[e]}))});function Pl(n,e,{auto:t=!0}={}){const i=r=>{let s=Object.keys(r);const l=nf(r);if(!l&&s.length>1&&!fi(r))return i(Hr(r));if(rf(r)){const a=l?r[ui.PATH]:s[0],c=l?r[ui.PATTERN]:r[a];if(!lt(c))throw new Error(Au(a));const u={keyId:li(a),pattern:c};return t&&(u.searcher=ci(c,e)),u}let o={children:[],operator:s[0]};return s.forEach(a=>{const c=r[a];ht(c)&&c.forEach(u=>{o.children.push(i(u))})}),o};return fi(n)||(n=Hr(n)),i(n)}function sf(n,{ignoreFieldNorm:e=oe.ignoreFieldNorm}){n.forEach(t=>{let i=1;t.matches.forEach(({key:r,norm:s,score:l})=>{const o=r?r.weight:null;i*=Math.pow(l===0&&o?Number.EPSILON:l,(o||1)*(e?1:s))}),t.score=i})}function lf(n,e){const t=n.matches;e.matches=[],Ye(t)&&t.forEach(i=>{if(!Ye(i.indices)||!i.indices.length)return;const{indices:r,value:s}=i;let l={indices:r,value:s};i.key&&(l.key=i.key.src),i.idx>-1&&(l.refIndex=i.idx),e.matches.push(l)})}function of(n,e){e.score=n.score}function af(n,e,{includeMatches:t=oe.includeMatches,includeScore:i=oe.includeScore}={}){const r=[];return t&&r.push(lf),i&&r.push(of),n.map(s=>{const{idx:l}=s,o={item:e[l],refIndex:l};return r.length&&r.forEach(a=>{a(s,o)}),o})}class Kt{constructor(e,t={},i){this.options=Mt(Mt({},oe),t),this.options.useExtendedSearch,this._keyStore=new Mu(this.options.keys),this.setCollection(e,i)}setCollection(e,t){if(this._docs=e,t&&!(t instanceof Ei))throw new Error(Ou);this._myIndex=t||Il(this.options.keys,this._docs,{getFn:this.options.getFn,fieldNormWeight:this.options.fieldNormWeight})}add(e){Ye(e)&&(this._docs.push(e),this._myIndex.add(e))}remove(e=()=>!1){const t=[];for(let i=0,r=this._docs.length;i<r;i+=1){const s=this._docs[i];e(s,i)&&(this.removeAt(i),i-=1,r-=1,t.push(s))}return t}removeAt(e){this._docs.splice(e,1),this._myIndex.removeAt(e)}getIndex(){return this._myIndex}search(e,{limit:t=-1}={}){const{includeMatches:i,includeScore:r,shouldSort:s,sortFn:l,ignoreFieldNorm:o}=this.options;let a=lt(e)?lt(this._docs[0])?this._searchStringList(e):this._searchObjectList(e):this._searchLogical(e);return sf(a,{ignoreFieldNorm:o}),s&&a.sort(l),kl(t)&&t>-1&&(a=a.slice(0,t)),af(a,this._docs,{includeMatches:i,includeScore:r})}_searchStringList(e){const t=ci(e,this.options),{records:i}=this._myIndex,r=[];return i.forEach(({v:s,i:l,n:o})=>{if(!Ye(s))return;const{isMatch:a,score:c,indices:u}=t.searchIn(s);a&&r.push({item:s,idx:l,matches:[{score:c,value:s,norm:o,indices:u}]})}),r}_searchLogical(e){const t=Pl(e,this.options),i=(o,a,c)=>{if(!o.children){const{keyId:d,searcher:f}=o,h=this._findMatches({key:this._keyStore.get(d),value:this._myIndex.getValueForItemAtKeyId(a,d),searcher:f});return h&&h.length?[{idx:c,item:a,matches:h}]:[]}const u=[];for(let d=0,f=o.children.length;d<f;d+=1){const h=o.children[d],m=i(h,a,c);if(m.length)u.push(...m);else if(o.operator===Mn.AND)return[]}return u},r=this._myIndex.records,s={},l=[];return r.forEach(({$:o,i:a})=>{if(Ye(o)){let c=i(t,o,a);c.length&&(s[a]||(s[a]={idx:a,item:o,matches:[]},l.push(s[a])),c.forEach(({matches:u})=>{s[a].matches.push(...u)}))}}),l}_searchObjectList(e){const t=ci(e,this.options),{keys:i,records:r}=this._myIndex,s=[];return r.forEach(({$:l,i:o})=>{if(!Ye(l))return;let a=[];i.forEach((c,u)=>{a.push(...this._findMatches({key:c,value:l[u],searcher:t}))}),a.length&&s.push({idx:o,item:l,matches:a})}),s}_findMatches({key:e,value:t,searcher:i}){if(!Ye(t))return[];let r=[];if(ht(t))t.forEach(({v:s,i:l,n:o})=>{if(!Ye(s))return;const{isMatch:a,score:c,indices:u}=i.searchIn(s);a&&r.push({score:c,key:e,value:s,idx:l,norm:o,indices:u})});else{const{v:s,n:l}=t,{isMatch:o,score:a,indices:c}=i.searchIn(s);o&&r.push({score:a,key:e,value:s,norm:l,indices:c})}return r}}Kt.version="7.0.0";Kt.createIndex=Il;Kt.parseIndex=Fu;Kt.config=oe;Kt.parseQuery=Pl;tf(ef);var cf=function(){function n(e){this._haystack=[],this._fuseOptions=Ge(Ge({},e.fuseOptions),{keys:Bc([],e.searchFields,!0),includeMatches:!0})}return n.prototype.index=function(e){this._haystack=e,this._fuse&&this._fuse.setCollection(e)},n.prototype.reset=function(){this._haystack=[],this._fuse=void 0},n.prototype.isEmptyIndex=function(){return!this._haystack.length},n.prototype.search=function(e){this._fuse||(this._fuse=new Kt(this._haystack,this._fuseOptions));var t=this._fuse.search(e);return t.map(function(i,r){return{item:i.item,score:i.score||0,rank:r+1}})},n}();function uf(n){return new cf(n)}var ff=function(n){for(var e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0},Qn=function(n,e,t){var i=n.dataset,r=e.customProperties,s=e.labelClass,l=e.labelDescription;s&&(i.labelClass=Vn(s).join(" ")),l&&(i.labelDescription=l),t&&r&&(typeof r=="string"?i.customProperties=r:typeof r=="object"&&!ff(r)&&(i.customProperties=JSON.stringify(r)))},qr=function(n,e,t){var i=e&&n.querySelector("label[for='".concat(e,"']")),r=i&&i.innerText;r&&t.setAttribute("aria-label",r)},df={containerOuter:function(n,e,t,i,r,s,l){var o=n.classNames.containerOuter,a=document.createElement("div");return fe(a,o),a.dataset.type=s,e&&(a.dir=e),i&&(a.tabIndex=0),t&&(a.setAttribute("role",r?"combobox":"listbox"),r?a.setAttribute("aria-autocomplete","list"):l||qr(this._docRoot,this.passedElement.element.id,a),a.setAttribute("aria-haspopup","true"),a.setAttribute("aria-expanded","false")),l&&a.setAttribute("aria-labelledby",l),a},containerInner:function(n){var e=n.classNames.containerInner,t=document.createElement("div");return fe(t,e),t},itemList:function(n,e){var t=n.searchEnabled,i=n.classNames,r=i.list,s=i.listSingle,l=i.listItems,o=document.createElement("div");return fe(o,r),fe(o,e?s:l),this._isSelectElement&&t&&o.setAttribute("role","listbox"),o},placeholder:function(n,e){var t=n.allowHTML,i=n.classNames.placeholder,r=document.createElement("div");return fe(r,i),at(r,t,e),r},item:function(n,e,t){var i=n.allowHTML,r=n.removeItemButtonAlignLeft,s=n.removeItemIconText,l=n.removeItemLabelText,o=n.classNames,a=o.item,c=o.button,u=o.highlightedState,d=o.itemSelectable,f=o.placeholder,h=It(e.value),m=document.createElement("div");if(fe(m,a),e.labelClass){var g=document.createElement("span");at(g,i,e.label),fe(g,e.labelClass),m.appendChild(g)}else at(m,i,e.label);if(m.dataset.item="",m.dataset.id=e.id,m.dataset.value=h,Qn(m,e,!0),(e.disabled||this.containerOuter.isDisabled)&&m.setAttribute("aria-disabled","true"),this._isSelectElement&&(m.setAttribute("aria-selected","true"),m.setAttribute("role","option")),e.placeholder&&(fe(m,f),m.dataset.placeholder=""),fe(m,e.highlighted?u:d),t){e.disabled&&st(m,d),m.dataset.deletable="";var v=document.createElement("button");v.type="button",fe(v,c),at(v,!0,rn(s,e.value));var w=rn(l,e.value);w&&v.setAttribute("aria-label",w),v.dataset.button="",r?m.insertAdjacentElement("afterbegin",v):m.appendChild(v)}return m},choiceList:function(n,e){var t=n.classNames.list,i=document.createElement("div");return fe(i,t),e||i.setAttribute("aria-multiselectable","true"),i.setAttribute("role","listbox"),i},choiceGroup:function(n,e){var t=n.allowHTML,i=n.classNames,r=i.group,s=i.groupHeading,l=i.itemDisabled,o=e.id,a=e.label,c=e.disabled,u=It(a),d=document.createElement("div");fe(d,r),c&&fe(d,l),d.setAttribute("role","group"),d.dataset.group="",d.dataset.id=o,d.dataset.value=u,c&&d.setAttribute("aria-disabled","true");var f=document.createElement("div");return fe(f,s),at(f,t,a||""),d.appendChild(f),d},choice:function(n,e,t,i){var r=n.allowHTML,s=n.classNames,l=s.item,o=s.itemChoice,a=s.itemSelectable,c=s.selectedState,u=s.itemDisabled,d=s.description,f=s.placeholder,h=e.label,m=It(e.value),g=document.createElement("div");g.id=e.elementId,fe(g,l),fe(g,o),i&&typeof h=="string"&&(h=Si(r,h),h+=" (".concat(i,")"),h={trusted:h});var v=g;if(e.labelClass){var w=document.createElement("span");at(w,r,h),fe(w,e.labelClass),v=w,g.appendChild(w)}else at(g,r,h);if(e.labelDescription){var I="".concat(e.elementId,"-description");v.setAttribute("aria-describedby",I);var R=document.createElement("span");at(R,r,e.labelDescription),R.id=I,fe(R,d),g.appendChild(R)}return e.selected&&fe(g,c),e.placeholder&&fe(g,f),g.setAttribute("role",e.group?"treeitem":"option"),g.dataset.choice="",g.dataset.id=e.id,g.dataset.value=m,t&&(g.dataset.selectText=t),e.group&&(g.dataset.groupId="".concat(e.group.id)),Qn(g,e,!1),e.disabled?(fe(g,u),g.dataset.choiceDisabled="",g.setAttribute("aria-disabled","true")):(fe(g,a),g.dataset.choiceSelectable=""),g},input:function(n,e){var t=n.classNames,i=t.input,r=t.inputCloned,s=n.labelId,l=document.createElement("input");return l.type="search",fe(l,i),fe(l,r),l.autocomplete="off",l.autocapitalize="off",l.spellcheck=!1,l.setAttribute("aria-autocomplete","list"),e?l.setAttribute("aria-label",e):s||qr(this._docRoot,this.passedElement.element.id,l),l},dropdown:function(n){var e=n.classNames,t=e.list,i=e.listDropdown,r=document.createElement("div");return fe(r,t),fe(r,i),r.setAttribute("aria-expanded","false"),r},notice:function(n,e,t){var i=n.classNames,r=i.item,s=i.itemChoice,l=i.addChoice,o=i.noResults,a=i.noChoices,c=i.notice;t===void 0&&(t=Me.generic);var u=document.createElement("div");switch(at(u,!0,e),fe(u,r),fe(u,s),fe(u,c),t){case Me.addChoice:fe(u,l);break;case Me.noResults:fe(u,o);break;case Me.noChoices:fe(u,a);break}return t===Me.addChoice&&(u.dataset.choiceSelectable="",u.dataset.choice=""),u},option:function(n){var e=It(n.label),t=new Option(e,n.value,!1,n.selected);return Qn(t,n,!0),t.disabled=n.disabled,n.selected&&t.setAttribute("selected",""),t}},hf="-ms-scroll-limit"in document.documentElement.style&&"-ms-ime-align"in document.documentElement.style,mf={},Zn=function(n){if(n)return n.dataset.id?parseInt(n.dataset.id,10):void 0},tn="[data-choice-selectable]",pf=function(){function n(e,t){e===void 0&&(e="[data-choice]"),t===void 0&&(t={});var i=this;this.initialisedOK=void 0,this._hasNonChoicePlaceholder=!1,this._lastAddedChoiceId=0,this._lastAddedGroupId=0;var r=n.defaults;this.config=Ge(Ge(Ge({},r.allOptions),r.options),t),zc.forEach(function(w){i.config[w]=Ge(Ge(Ge({},r.allOptions[w]),r.options[w]),t[w])});var s=this.config;s.silent||this._validateConfig();var l=s.shadowRoot||document.documentElement;this._docRoot=l;var o=typeof e=="string"?l.querySelector(e):e;if(!o||typeof o!="object"||!(uu(o)||yl(o)))throw TypeError(!o&&typeof e=="string"?"Selector ".concat(e," failed to find an element"):"Expected one of the following types text|select-one|select-multiple");var a=o.type,c=a===vt.Text;(c||s.maxItemCount!==1)&&(s.singleModeForMultiSelect=!1),s.singleModeForMultiSelect&&(a=vt.SelectMultiple);var u=a===vt.SelectOne,d=a===vt.SelectMultiple,f=u||d;if(this._elementType=a,this._isTextElement=c,this._isSelectOneElement=u,this._isSelectMultipleElement=d,this._isSelectElement=u||d,this._canAddUserChoices=c&&s.addItems||f&&s.addChoices,typeof s.renderSelectedChoices!="boolean"&&(s.renderSelectedChoices=s.renderSelectedChoices==="always"||u),s.closeDropdownOnSelect==="auto"?s.closeDropdownOnSelect=c||u||s.singleModeForMultiSelect:s.closeDropdownOnSelect=nn(s.closeDropdownOnSelect),s.placeholder&&(s.placeholderValue?this._hasNonChoicePlaceholder=!0:o.dataset.placeholder&&(this._hasNonChoicePlaceholder=!0,s.placeholderValue=o.dataset.placeholder)),t.addItemFilter&&typeof t.addItemFilter!="function"){var h=t.addItemFilter instanceof RegExp?t.addItemFilter:new RegExp(t.addItemFilter);s.addItemFilter=h.test.bind(h)}if(this._isTextElement)this.passedElement=new cu({element:o,classNames:s.classNames});else{var m=o;this.passedElement=new hu({element:m,classNames:s.classNames,template:function(w){return i._templates.option(w)},extractPlaceholder:s.placeholder&&!this._hasNonChoicePlaceholder})}if(this.initialised=!1,this._store=new vu(s),this._currentValue="",s.searchEnabled=!c&&s.searchEnabled||d,this._canSearch=s.searchEnabled,this._isScrollingOnIe=!1,this._highlightPosition=0,this._wasTap=!0,this._placeholderValue=this._generatePlaceholderValue(),this._baseId=Jc(o,"choices-"),this._direction=o.dir,!this._direction){var g=window.getComputedStyle(o).direction,v=window.getComputedStyle(document.documentElement).direction;g!==v&&(this._direction=g)}if(this._idNames={itemChoice:"item-choice"},this._templates=r.templates,this._render=this._render.bind(this),this._onFocus=this._onFocus.bind(this),this._onBlur=this._onBlur.bind(this),this._onKeyUp=this._onKeyUp.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onInput=this._onInput.bind(this),this._onClick=this._onClick.bind(this),this._onTouchMove=this._onTouchMove.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._onMouseDown=this._onMouseDown.bind(this),this._onMouseOver=this._onMouseOver.bind(this),this._onFormReset=this._onFormReset.bind(this),this._onSelectKey=this._onSelectKey.bind(this),this._onEnterKey=this._onEnterKey.bind(this),this._onEscapeKey=this._onEscapeKey.bind(this),this._onDirectionKey=this._onDirectionKey.bind(this),this._onDeleteKey=this._onDeleteKey.bind(this),this.passedElement.isActive){s.silent||console.warn("Trying to initialise Choices on element already initialised",{element:e}),this.initialised=!0,this.initialisedOK=!1;return}this.init(),this._initialItems=this._store.items.map(function(w){return w.value})}return Object.defineProperty(n,"defaults",{get:function(){return Object.preventExtensions({get options(){return mf},get allOptions(){return $r},get templates(){return df}})},enumerable:!1,configurable:!0}),n.prototype.init=function(){if(!(this.initialised||this.initialisedOK!==void 0)){this._searcher=uf(this.config),this._loadChoices(),this._createTemplates(),this._createElements(),this._createStructure(),this._isTextElement&&!this.config.addItems||this.passedElement.element.hasAttribute("disabled")||this.passedElement.element.closest("fieldset:disabled")?this.disable():(this.enable(),this._addEventListeners()),this._initStore(),this.initialised=!0,this.initialisedOK=!0;var e=this.config.callbackOnInit;typeof e=="function"&&e.call(this)}},n.prototype.destroy=function(){this.initialised&&(this._removeEventListeners(),this.passedElement.reveal(),this.containerOuter.unwrap(this.passedElement.element),this._store._listeners=[],this.clearStore(!1),this._stopSearch(),this._templates=n.defaults.templates,this.initialised=!1,this.initialisedOK=void 0)},n.prototype.enable=function(){return this.passedElement.isDisabled&&this.passedElement.enable(),this.containerOuter.isDisabled&&(this._addEventListeners(),this.input.enable(),this.containerOuter.enable()),this},n.prototype.disable=function(){return this.passedElement.isDisabled||this.passedElement.disable(),this.containerOuter.isDisabled||(this._removeEventListeners(),this.input.disable(),this.containerOuter.disable()),this},n.prototype.highlightItem=function(e,t){if(t===void 0&&(t=!0),!e||!e.id)return this;var i=this._store.items.find(function(r){return r.id===e.id});return!i||i.highlighted?this:(this._store.dispatch(yn(i,!0)),t&&this.passedElement.triggerEvent(We.highlightItem,this._getChoiceForOutput(i)),this)},n.prototype.unhighlightItem=function(e,t){if(t===void 0&&(t=!0),!e||!e.id)return this;var i=this._store.items.find(function(r){return r.id===e.id});return!i||!i.highlighted?this:(this._store.dispatch(yn(i,!1)),t&&this.passedElement.triggerEvent(We.unhighlightItem,this._getChoiceForOutput(i)),this)},n.prototype.highlightAll=function(){var e=this;return this._store.withTxn(function(){e._store.items.forEach(function(t){t.highlighted||(e._store.dispatch(yn(t,!0)),e.passedElement.triggerEvent(We.highlightItem,e._getChoiceForOutput(t)))})}),this},n.prototype.unhighlightAll=function(){var e=this;return this._store.withTxn(function(){e._store.items.forEach(function(t){t.highlighted&&(e._store.dispatch(yn(t,!1)),e.passedElement.triggerEvent(We.highlightItem,e._getChoiceForOutput(t)))})}),this},n.prototype.removeActiveItemsByValue=function(e){var t=this;return this._store.withTxn(function(){t._store.items.filter(function(i){return i.value===e}).forEach(function(i){return t._removeItem(i)})}),this},n.prototype.removeActiveItems=function(e){var t=this;return this._store.withTxn(function(){t._store.items.filter(function(i){var r=i.id;return r!==e}).forEach(function(i){return t._removeItem(i)})}),this},n.prototype.removeHighlightedItems=function(e){var t=this;return e===void 0&&(e=!1),this._store.withTxn(function(){t._store.highlightedActiveItems.forEach(function(i){t._removeItem(i),e&&t._triggerChange(i.value)})}),this},n.prototype.showDropdown=function(e){var t=this;return this.dropdown.isActive?this:(e===void 0&&(e=!this._canSearch),requestAnimationFrame(function(){t.dropdown.show();var i=t.dropdown.element.getBoundingClientRect();t.containerOuter.open(i.bottom,i.height),e||t.input.focus(),t.passedElement.triggerEvent(We.showDropdown)}),this)},n.prototype.hideDropdown=function(e){var t=this;return this.dropdown.isActive?(requestAnimationFrame(function(){t.dropdown.hide(),t.containerOuter.close(),!e&&t._canSearch&&(t.input.removeActiveDescendant(),t.input.blur()),t.passedElement.triggerEvent(We.hideDropdown)}),this):this},n.prototype.getValue=function(e){var t=this,i=this._store.items.map(function(r){return e?r.value:t._getChoiceForOutput(r)});return this._isSelectOneElement||this.config.singleModeForMultiSelect?i[0]:i},n.prototype.setValue=function(e){var t=this;return this.initialisedOK?(this._store.withTxn(function(){e.forEach(function(i){i&&t._addChoice(rt(i,!1))})}),this._searcher.reset(),this):(this._warnChoicesInitFailed("setValue"),this)},n.prototype.setChoiceByValue=function(e){var t=this;return this.initialisedOK?this._isTextElement?this:(this._store.withTxn(function(){var i=Array.isArray(e)?e:[e];i.forEach(function(r){return t._findAndSelectChoiceByValue(r)}),t.unhighlightAll()}),this._searcher.reset(),this):(this._warnChoicesInitFailed("setChoiceByValue"),this)},n.prototype.setChoices=function(e,t,i,r,s,l){var o=this;if(e===void 0&&(e=[]),t===void 0&&(t="value"),i===void 0&&(i="label"),r===void 0&&(r=!1),s===void 0&&(s=!0),l===void 0&&(l=!1),!this.initialisedOK)return this._warnChoicesInitFailed("setChoices"),this;if(!this._isSelectElement)throw new TypeError("setChoices can't be used with INPUT based Choices");if(typeof t!="string"||!t)throw new TypeError("value parameter must be a name of 'value' field in passed objects");if(typeof e=="function"){var a=e(this);if(typeof Promise=="function"&&a instanceof Promise)return new Promise(function(c){return requestAnimationFrame(c)}).then(function(){return o._handleLoadingState(!0)}).then(function(){return a}).then(function(c){return o.setChoices(c,t,i,r,s,l)}).catch(function(c){o.config.silent||console.error(c)}).then(function(){return o._handleLoadingState(!1)}).then(function(){return o});if(!Array.isArray(a))throw new TypeError(".setChoices first argument function must return either array of choices or Promise, got: ".concat(typeof a));return this.setChoices(a,t,i,!1)}if(!Array.isArray(e))throw new TypeError(".setChoices must be called either with array of choices with a function resulting into Promise of array of choices");return this.containerOuter.removeLoadingState(),this._store.withTxn(function(){s&&(o._isSearching=!1),r&&o.clearChoices(!0,l);var c=t==="value",u=i==="label";e.forEach(function(d){if("choices"in d){var f=d;u||(f=Ge(Ge({},f),{label:f[i]})),o._addGroup(rt(f,!0))}else{var h=d;(!u||!c)&&(h=Ge(Ge({},h),{value:h[t],label:h[i]}));var m=rt(h,!1);o._addChoice(m),m.placeholder&&!o._hasNonChoicePlaceholder&&(o._placeholderValue=vl(m.label))}}),o.unhighlightAll()}),this._searcher.reset(),this},n.prototype.refresh=function(e,t,i){var r=this;return e===void 0&&(e=!1),t===void 0&&(t=!1),i===void 0&&(i=!1),this._isSelectElement?(this._store.withTxn(function(){var s=r.passedElement.optionsAsChoices(),l={};i||r._store.items.forEach(function(a){a.id&&a.active&&a.selected&&(l[a.value]=!0)}),r.clearStore(!1);var o=function(a){i?r._store.dispatch(Ar(a)):l[a.value]&&(a.selected=!0)};s.forEach(function(a){if("choices"in a){a.choices.forEach(o);return}o(a)}),r._addPredefinedChoices(s,t,e),r._isSearching&&r._searchChoices(r.input.value)}),this):(this.config.silent||console.warn("refresh method can only be used on choices backed by a <select> element"),this)},n.prototype.removeChoice=function(e){var t=this._store.choices.find(function(i){return i.value===e});return t?(this._clearNotice(),this._store.dispatch(Kc(t)),this._searcher.reset(),t.selected&&this.passedElement.triggerEvent(We.removeItem,this._getChoiceForOutput(t)),this):this},n.prototype.clearChoices=function(e,t){var i=this;return e===void 0&&(e=!0),t===void 0&&(t=!1),e&&(t?this.passedElement.element.replaceChildren(""):this.passedElement.element.querySelectorAll(":not([selected])").forEach(function(r){r.remove()})),this.itemList.element.replaceChildren(""),this.choiceList.element.replaceChildren(""),this._clearNotice(),this._store.withTxn(function(){var r=t?[]:i._store.items;i._store.reset(),r.forEach(function(s){i._store.dispatch(Ir(s)),i._store.dispatch(Or(s))})}),this._searcher.reset(),this},n.prototype.clearStore=function(e){return e===void 0&&(e=!0),this.clearChoices(e,!0),this._stopSearch(),this._lastAddedChoiceId=0,this._lastAddedGroupId=0,this},n.prototype.clearInput=function(){var e=!this._isSelectOneElement;return this.input.clear(e),this._stopSearch(),this},n.prototype._validateConfig=function(){var e=this.config,t=iu(e,$r);t.length&&console.warn("Unknown config option(s) passed",t.join(", ")),e.allowHTML&&e.allowHtmlUserInput&&(e.addItems&&console.warn("Warning: allowHTML/allowHtmlUserInput/addItems all being true is strongly not recommended and may lead to XSS attacks"),e.addChoices&&console.warn("Warning: allowHTML/allowHtmlUserInput/addChoices all being true is strongly not recommended and may lead to XSS attacks"))},n.prototype._render=function(e){e===void 0&&(e={choices:!0,groups:!0,items:!0}),!this._store.inTxn()&&(this._isSelectElement&&(e.choices||e.groups)&&this._renderChoices(),e.items&&this._renderItems())},n.prototype._renderChoices=function(){var e=this;if(this._canAddItems()){var t=this,i=t.config,r=t._isSearching,s=this._store,l=s.activeGroups,o=s.activeChoices,a=0;if(r&&i.searchResultLimit>0?a=i.searchResultLimit:i.renderChoiceLimit>0&&(a=i.renderChoiceLimit),this._isSelectElement){var c=o.filter(function(m){return!m.element});c.length&&this.passedElement.addOptions(c)}var u=document.createDocumentFragment(),d=function(m){return m.filter(function(g){return!g.placeholder&&(r?!!g.rank:i.renderSelectedChoices||!g.selected)})},f=!1,h=function(m,g,v){r?m.sort(tu):i.shouldSort&&m.sort(i.sorter);var w=m.length;w=!g&&a&&w>a?a:w,w--,m.every(function(I,R){var C=I.choiceEl||e._templates.choice(i,I,i.itemSelectText,v);return I.choiceEl=C,u.appendChild(C),(r||!I.selected)&&(f=!0),R<w})};o.length&&(i.resetScrollPosition&&requestAnimationFrame(function(){return e.choiceList.scrollToTop()}),!this._hasNonChoicePlaceholder&&!r&&this._isSelectOneElement&&h(o.filter(function(m){return m.placeholder&&!m.group}),!1,void 0),l.length&&!r?(i.shouldSort&&l.sort(i.sorter),h(o.filter(function(m){return!m.placeholder&&!m.group}),!1,void 0),l.forEach(function(m){var g=d(m.choices);if(g.length){if(m.label){var v=m.groupEl||e._templates.choiceGroup(e.config,m);m.groupEl=v,v.remove(),u.appendChild(v)}h(g,!0,i.appendGroupInSearch&&r?m.label:void 0)}})):h(d(o),!1,void 0)),!f&&(r||!u.children.length||!i.renderSelectedChoices)&&(this._notice||(this._notice={text:Pr(r?i.noResultsText:i.noChoicesText),type:r?Me.noResults:Me.noChoices}),u.replaceChildren("")),this._renderNotice(u),this.choiceList.element.replaceChildren(u),f&&this._highlightChoice()}},n.prototype._renderItems=function(){var e=this,t=this._store.items||[],i=this.itemList.element,r=this.config,s=document.createDocumentFragment(),l=function(d){return i.querySelector('[data-item][data-id="'.concat(d.id,'"]'))},o=function(d){var f=d.itemEl;f&&f.parentElement||(f=l(d)||e._templates.item(r,d,r.removeItemButton),d.itemEl=f,s.appendChild(f))};t.forEach(o);var a=!!s.childNodes.length;if(this._isSelectOneElement){var c=i.children.length;if(a||c>1){var u=i.querySelector(en(r.classNames.placeholder));u&&u.remove()}else!a&&!c&&this._placeholderValue&&(a=!0,o(rt({selected:!0,value:"",label:this._placeholderValue,placeholder:!0},!1)))}a&&(i.append(s),r.shouldSortItems&&!this._isSelectOneElement&&(t.sort(r.sorter),t.forEach(function(d){var f=l(d);f&&(f.remove(),s.append(f))}),i.append(s))),this._isTextElement&&(this.passedElement.value=t.map(function(d){var f=d.value;return f}).join(r.delimiter))},n.prototype._displayNotice=function(e,t,i){i===void 0&&(i=!0);var r=this._notice;if(r&&(r.type===t&&r.text===e||r.type===Me.addChoice&&(t===Me.noResults||t===Me.noChoices))){i&&this.showDropdown(!0);return}this._clearNotice(),this._notice=e?{text:e,type:t}:void 0,this._renderNotice(),i&&e&&this.showDropdown(!0)},n.prototype._clearNotice=function(){if(this._notice){var e=this.choiceList.element.querySelector(en(this.config.classNames.notice));e&&e.remove(),this._notice=void 0}},n.prototype._renderNotice=function(e){var t=this._notice;if(t){var i=this._templates.notice(this.config,t.text,t.type);e?e.append(i):this.choiceList.prepend(i)}},n.prototype._getChoiceForOutput=function(e,t){return{id:e.id,highlighted:e.highlighted,labelClass:e.labelClass,labelDescription:e.labelDescription,customProperties:e.customProperties,disabled:e.disabled,active:e.active,label:e.label,placeholder:e.placeholder,value:e.value,groupValue:e.group?e.group.label:void 0,element:e.element,keyCode:t}},n.prototype._triggerChange=function(e){e!=null&&this.passedElement.triggerEvent(We.change,{value:e})},n.prototype._handleButtonAction=function(e){var t=this,i=this._store.items;if(!(!i.length||!this.config.removeItems||!this.config.removeItemButton)){var r=e&&Zn(e.parentElement),s=r&&i.find(function(l){return l.id===r});s&&this._store.withTxn(function(){if(t._removeItem(s),t._triggerChange(s.value),t._isSelectOneElement&&!t._hasNonChoicePlaceholder){var l=(t.config.shouldSort?t._store.choices.reverse():t._store.choices).find(function(o){return o.placeholder});l&&(t._addItem(l),t.unhighlightAll(),l.value&&t._triggerChange(l.value))}})}},n.prototype._handleItemAction=function(e,t){var i=this;t===void 0&&(t=!1);var r=this._store.items;if(!(!r.length||!this.config.removeItems||this._isSelectOneElement)){var s=Zn(e);s&&(r.forEach(function(l){l.id===s&&!l.highlighted?i.highlightItem(l):!t&&l.highlighted&&i.unhighlightItem(l)}),this.input.focus())}},n.prototype._handleChoiceAction=function(e){var t=this,i=Zn(e),r=i&&this._store.getChoiceById(i);if(!r||r.disabled)return!1;var s=this.dropdown.isActive;if(!r.selected){if(!this._canAddItems())return!0;this._store.withTxn(function(){t._addItem(r,!0,!0),t.clearInput(),t.unhighlightAll()}),this._triggerChange(r.value)}return s&&this.config.closeDropdownOnSelect&&(this.hideDropdown(!0),this.containerOuter.element.focus()),!0},n.prototype._handleBackspace=function(e){var t=this.config;if(!(!t.removeItems||!e.length)){var i=e[e.length-1],r=e.some(function(s){return s.highlighted});t.editItems&&!r&&i?(this.input.value=i.value,this.input.setWidth(),this._removeItem(i),this._triggerChange(i.value)):(r||this.highlightItem(i,!1),this.removeHighlightedItems(!0))}},n.prototype._loadChoices=function(){var e,t=this,i=this.config;if(this._isTextElement){if(this._presetChoices=i.items.map(function(l){return rt(l,!1)}),this.passedElement.value){var r=this.passedElement.value.split(i.delimiter).map(function(l){return rt(l,!1,t.config.allowHtmlUserInput)});this._presetChoices=this._presetChoices.concat(r)}this._presetChoices.forEach(function(l){l.selected=!0})}else if(this._isSelectElement){this._presetChoices=i.choices.map(function(l){return rt(l,!0)});var s=this.passedElement.optionsAsChoices();s&&(e=this._presetChoices).push.apply(e,s)}},n.prototype._handleLoadingState=function(e){e===void 0&&(e=!0);var t=this.itemList.element;e?(this.disable(),this.containerOuter.addLoadingState(),this._isSelectOneElement?t.replaceChildren(this._templates.placeholder(this.config,this.config.loadingText)):this.input.placeholder=this.config.loadingText):(this.enable(),this.containerOuter.removeLoadingState(),this._isSelectOneElement?(t.replaceChildren(""),this._render()):this.input.placeholder=this._placeholderValue||"")},n.prototype._handleSearch=function(e){if(this.input.isFocussed)if(e!==null&&typeof e<"u"&&e.length>=this.config.searchFloor){var t=this.config.searchChoices?this._searchChoices(e):0;t!==null&&this.passedElement.triggerEvent(We.search,{value:e,resultCount:t})}else this._store.choices.some(function(i){return!i.active})&&this._stopSearch()},n.prototype._canAddItems=function(){var e=this.config,t=e.maxItemCount,i=e.maxItemText;return!e.singleModeForMultiSelect&&t>0&&t<=this._store.items.length?(this.choiceList.element.replaceChildren(""),this._notice=void 0,this._displayNotice(typeof i=="function"?i(t):i,Me.addChoice),!1):(this._notice&&this._notice.type===Me.addChoice&&this._clearNotice(),!0)},n.prototype._canCreateItem=function(e){var t=this.config,i=!0,r="";if(i&&typeof t.addItemFilter=="function"&&!t.addItemFilter(e)&&(i=!1,r=rn(t.customAddItemText,e)),i){var s=this._store.choices.find(function(l){return t.valueComparer(l.value,e)});if(s){if(this._isSelectElement)return this._displayNotice("",Me.addChoice),!1;t.duplicateItemsAllowed||(i=!1,r=rn(t.uniqueItemText,e))}}return i&&(r=rn(t.addItemText,e)),r&&this._displayNotice(r,Me.addChoice),i},n.prototype._searchChoices=function(e){var t=e.trim().replace(/\s{2,}/," ");if(!t.length||t===this._currentValue)return null;var i=this._searcher;i.isEmptyIndex()&&i.index(this._store.searchableChoices);var r=i.search(t);this._currentValue=t,this._highlightPosition=0,this._isSearching=!0;var s=this._notice,l=s&&s.type;return l!==Me.addChoice&&(r.length?this._clearNotice():this._displayNotice(Pr(this.config.noResultsText),Me.noResults)),this._store.dispatch(Wc(r)),r.length},n.prototype._stopSearch=function(){this._isSearching&&(this._currentValue="",this._isSearching=!1,this._clearNotice(),this._store.dispatch(Gc(!0)),this.passedElement.triggerEvent(We.search,{value:"",resultCount:0}))},n.prototype._addEventListeners=function(){var e=this._docRoot,t=this.containerOuter.element,i=this.input.element;e.addEventListener("touchend",this._onTouchEnd,!0),t.addEventListener("keydown",this._onKeyDown,!0),t.addEventListener("mousedown",this._onMouseDown,!0),e.addEventListener("click",this._onClick,{passive:!0}),e.addEventListener("touchmove",this._onTouchMove,{passive:!0}),this.dropdown.element.addEventListener("mouseover",this._onMouseOver,{passive:!0}),this._isSelectOneElement&&(t.addEventListener("focus",this._onFocus,{passive:!0}),t.addEventListener("blur",this._onBlur,{passive:!0})),i.addEventListener("keyup",this._onKeyUp,{passive:!0}),i.addEventListener("input",this._onInput,{passive:!0}),i.addEventListener("focus",this._onFocus,{passive:!0}),i.addEventListener("blur",this._onBlur,{passive:!0}),i.form&&i.form.addEventListener("reset",this._onFormReset,{passive:!0}),this.input.addEventListeners()},n.prototype._removeEventListeners=function(){var e=this._docRoot,t=this.containerOuter.element,i=this.input.element;e.removeEventListener("touchend",this._onTouchEnd,!0),t.removeEventListener("keydown",this._onKeyDown,!0),t.removeEventListener("mousedown",this._onMouseDown,!0),e.removeEventListener("click",this._onClick),e.removeEventListener("touchmove",this._onTouchMove),this.dropdown.element.removeEventListener("mouseover",this._onMouseOver),this._isSelectOneElement&&(t.removeEventListener("focus",this._onFocus),t.removeEventListener("blur",this._onBlur)),i.removeEventListener("keyup",this._onKeyUp),i.removeEventListener("input",this._onInput),i.removeEventListener("focus",this._onFocus),i.removeEventListener("blur",this._onBlur),i.form&&i.form.removeEventListener("reset",this._onFormReset),this.input.removeEventListeners()},n.prototype._onKeyDown=function(e){var t=e.keyCode,i=this.dropdown.isActive,r=e.key.length===1||e.key.length===2&&e.key.charCodeAt(0)>=55296||e.key==="Unidentified";switch(!this._isTextElement&&!i&&t!==je.ESC_KEY&&t!==je.TAB_KEY&&t!==je.SHIFT_KEY&&(this.showDropdown(),!this.input.isFocussed&&r&&(this.input.value+=e.key,e.key===" "&&e.preventDefault())),t){case je.A_KEY:return this._onSelectKey(e,this.itemList.element.hasChildNodes());case je.ENTER_KEY:return this._onEnterKey(e,i);case je.ESC_KEY:return this._onEscapeKey(e,i);case je.UP_KEY:case je.PAGE_UP_KEY:case je.DOWN_KEY:case je.PAGE_DOWN_KEY:return this._onDirectionKey(e,i);case je.DELETE_KEY:case je.BACK_KEY:return this._onDeleteKey(e,this._store.items,this.input.isFocussed)}},n.prototype._onKeyUp=function(){this._canSearch=this.config.searchEnabled},n.prototype._onInput=function(){var e=this.input.value;if(!e){this._isTextElement?this.hideDropdown(!0):this._stopSearch();return}this._canAddItems()&&(this._canSearch&&this._handleSearch(e),this._canAddUserChoices&&(this._canCreateItem(e),this._isSelectElement&&(this._highlightPosition=0,this._highlightChoice())))},n.prototype._onSelectKey=function(e,t){if((e.ctrlKey||e.metaKey)&&t){this._canSearch=!1;var i=this.config.removeItems&&!this.input.value&&this.input.element===document.activeElement;i&&this.highlightAll()}},n.prototype._onEnterKey=function(e,t){var i=this,r=this.input.value,s=e.target;if(e.preventDefault(),s&&s.hasAttribute("data-button")){this._handleButtonAction(s);return}if(!t){(this._isSelectElement||this._notice)&&this.showDropdown();return}var l=this.dropdown.element.querySelector(en(this.config.classNames.highlightedState));if(!(l&&this._handleChoiceAction(l))){if(!s||!r){this.hideDropdown(!0);return}if(this._canAddItems()){var o=!1;this._store.withTxn(function(){if(o=i._findAndSelectChoiceByValue(r,!0),!o){if(!i._canAddUserChoices||!i._canCreateItem(r))return;i._addChoice(rt(r,!1,i.config.allowHtmlUserInput),!0,!0),o=!0}i.clearInput(),i.unhighlightAll()}),o&&(this._triggerChange(r),this.config.closeDropdownOnSelect&&this.hideDropdown(!0))}}},n.prototype._onEscapeKey=function(e,t){t&&(e.stopPropagation(),this.hideDropdown(!0),this._stopSearch(),this.containerOuter.element.focus())},n.prototype._onDirectionKey=function(e,t){var i=e.keyCode;if(t||this._isSelectOneElement){this.showDropdown(),this._canSearch=!1;var r=i===je.DOWN_KEY||i===je.PAGE_DOWN_KEY?1:-1,s=e.metaKey||i===je.PAGE_DOWN_KEY||i===je.PAGE_UP_KEY,l=void 0;if(s)r>0?l=this.dropdown.element.querySelector("".concat(tn,":last-of-type")):l=this.dropdown.element.querySelector(tn);else{var o=this.dropdown.element.querySelector(en(this.config.classNames.highlightedState));o?l=Xc(o,tn,r):l=this.dropdown.element.querySelector(tn)}l&&(Qc(l,this.choiceList.element,r)||this.choiceList.scrollToChildElement(l,r),this._highlightChoice(l)),e.preventDefault()}},n.prototype._onDeleteKey=function(e,t,i){!this._isSelectOneElement&&!e.target.value&&i&&(this._handleBackspace(t),e.preventDefault())},n.prototype._onTouchMove=function(){this._wasTap&&(this._wasTap=!1)},n.prototype._onTouchEnd=function(e){var t=(e||e.touches[0]).target,i=this._wasTap&&this.containerOuter.element.contains(t);if(i){var r=t===this.containerOuter.element||t===this.containerInner.element;r&&(this._isTextElement?this.input.focus():this._isSelectMultipleElement&&this.showDropdown()),e.stopPropagation()}this._wasTap=!0},n.prototype._onMouseDown=function(e){var t=e.target;if(t instanceof HTMLElement){if(hf&&this.choiceList.element.contains(t)){var i=this.choiceList.element.firstElementChild;this._isScrollingOnIe=this._direction==="ltr"?e.offsetX>=i.offsetWidth:e.offsetX<i.offsetLeft}if(t!==this.input.element){var r=t.closest("[data-button],[data-item],[data-choice]");r instanceof HTMLElement&&("button"in r.dataset?this._handleButtonAction(r):"item"in r.dataset?this._handleItemAction(r,e.shiftKey):"choice"in r.dataset&&this._handleChoiceAction(r)),e.preventDefault()}}},n.prototype._onMouseOver=function(e){var t=e.target;t instanceof HTMLElement&&"choice"in t.dataset&&this._highlightChoice(t)},n.prototype._onClick=function(e){var t=e.target,i=this.containerOuter,r=i.element.contains(t);r?!this.dropdown.isActive&&!i.isDisabled?this._isTextElement?document.activeElement!==this.input.element&&this.input.focus():(this.showDropdown(),i.element.focus()):this._isSelectOneElement&&t!==this.input.element&&!this.dropdown.element.contains(t)&&this.hideDropdown():(i.removeFocusState(),this.hideDropdown(!0),this.unhighlightAll())},n.prototype._onFocus=function(e){var t=e.target,i=this.containerOuter,r=t&&i.element.contains(t);if(r){var s=t===this.input.element;this._isTextElement?s&&i.addFocusState():this._isSelectMultipleElement?s&&(this.showDropdown(!0),i.addFocusState()):(i.addFocusState(),s&&this.showDropdown(!0))}},n.prototype._onBlur=function(e){var t=e.target,i=this.containerOuter,r=t&&i.element.contains(t);r&&!this._isScrollingOnIe?t===this.input.element?(i.removeFocusState(),this.hideDropdown(!0),(this._isTextElement||this._isSelectMultipleElement)&&this.unhighlightAll()):t===this.containerOuter.element&&(i.removeFocusState(),this._canSearch||this.hideDropdown(!0)):(this._isScrollingOnIe=!1,this.input.element.focus())},n.prototype._onFormReset=function(){var e=this;this._store.withTxn(function(){e.clearInput(),e.hideDropdown(),e.refresh(!1,!1,!0),e._initialItems.length&&e.setChoiceByValue(e._initialItems)})},n.prototype._highlightChoice=function(e){e===void 0&&(e=null);var t=Array.from(this.dropdown.element.querySelectorAll(tn));if(t.length){var i=e,r=this.config.classNames.highlightedState,s=Array.from(this.dropdown.element.querySelectorAll(en(r)));s.forEach(function(l){st(l,r),l.setAttribute("aria-selected","false")}),i?this._highlightPosition=t.indexOf(i):(t.length>this._highlightPosition?i=t[this._highlightPosition]:i=t[t.length-1],i||(i=t[0])),fe(i,r),i.setAttribute("aria-selected","true"),this.passedElement.triggerEvent(We.highlightChoice,{el:i}),this.dropdown.isActive&&(this.input.setActiveDescendant(i.id),this.containerOuter.setActiveDescendant(i.id))}},n.prototype._addItem=function(e,t,i){if(t===void 0&&(t=!0),i===void 0&&(i=!1),!e.id)throw new TypeError("item.id must be set before _addItem is called for a choice/item");(this.config.singleModeForMultiSelect||this._isSelectOneElement)&&this.removeActiveItems(e.id),this._store.dispatch(Or(e)),t&&(this.passedElement.triggerEvent(We.addItem,this._getChoiceForOutput(e)),i&&this.passedElement.triggerEvent(We.choice,this._getChoiceForOutput(e)))},n.prototype._removeItem=function(e){if(e.id){this._store.dispatch(Ar(e));var t=this._notice;t&&t.type===Me.noChoices&&this._clearNotice(),this.passedElement.triggerEvent(We.removeItem,this._getChoiceForOutput(e))}},n.prototype._addChoice=function(e,t,i){if(t===void 0&&(t=!0),i===void 0&&(i=!1),e.id)throw new TypeError("Can not re-add a choice which has already been added");var r=this.config;if(!(!r.duplicateItemsAllowed&&this._store.choices.find(function(o){return r.valueComparer(o.value,e.value)}))){this._lastAddedChoiceId++,e.id=this._lastAddedChoiceId,e.elementId="".concat(this._baseId,"-").concat(this._idNames.itemChoice,"-").concat(e.id);var s=r.prependValue,l=r.appendValue;s&&(e.value=s+e.value),l&&(e.value+=l.toString()),(s||l)&&e.element&&(e.element.value=e.value),this._clearNotice(),this._store.dispatch(Ir(e)),e.selected&&this._addItem(e,t,i)}},n.prototype._addGroup=function(e,t){var i=this;if(t===void 0&&(t=!0),e.id)throw new TypeError("Can not re-add a group which has already been added");this._store.dispatch(Yc(e)),e.choices&&(this._lastAddedGroupId++,e.id=this._lastAddedGroupId,e.choices.forEach(function(r){r.group=e,e.disabled&&(r.disabled=!0),i._addChoice(r,t)}))},n.prototype._createTemplates=function(){var e=this,t=this.config.callbackOnCreateTemplates,i={};typeof t=="function"&&(i=t.call(this,Zc,Si,Vn));var r={};Object.keys(this._templates).forEach(function(s){s in i?r[s]=i[s].bind(e):r[s]=e._templates[s].bind(e)}),this._templates=r},n.prototype._createElements=function(){var e=this._templates,t=this,i=t.config,r=t._isSelectOneElement,s=i.position,l=i.classNames,o=this._elementType;this.containerOuter=new Lr({element:e.containerOuter(i,this._direction,this._isSelectElement,r,i.searchEnabled,o,i.labelId),classNames:l,type:o,position:s}),this.containerInner=new Lr({element:e.containerInner(i),classNames:l,type:o,position:s}),this.input=new ou({element:e.input(i,this._placeholderValue),classNames:l,type:o,preventPaste:!i.paste}),this.choiceList=new Mr({element:e.choiceList(i,r)}),this.itemList=new Mr({element:e.itemList(i,r)}),this.dropdown=new lu({element:e.dropdown(i),classNames:l,type:o})},n.prototype._createStructure=function(){var e=this,t=e.containerInner,i=e.containerOuter,r=e.passedElement,s=this.dropdown.element;r.conceal(),t.wrap(r.element),i.wrap(t.element),this._isSelectOneElement?this.input.placeholder=this.config.searchPlaceholderValue||"":(this._placeholderValue&&(this.input.placeholder=this._placeholderValue),this.input.setWidth()),i.element.appendChild(t.element),i.element.appendChild(s),t.element.appendChild(this.itemList.element),s.appendChild(this.choiceList.element),this._isSelectOneElement?this.config.searchEnabled&&s.insertBefore(this.input.element,s.firstChild):t.element.appendChild(this.input.element),this._highlightPosition=0,this._isSearching=!1},n.prototype._initStore=function(){var e=this;this._store.subscribe(this._render).withTxn(function(){e._addPredefinedChoices(e._presetChoices,e._isSelectOneElement&&!e._hasNonChoicePlaceholder,!1)}),(!this._store.choices.length||this._isSelectOneElement&&this._hasNonChoicePlaceholder)&&this._render()},n.prototype._addPredefinedChoices=function(e,t,i){var r=this;if(t===void 0&&(t=!1),i===void 0&&(i=!0),t){var s=e.findIndex(function(l){return l.selected})===-1;s&&e.some(function(l){return l.disabled||"choices"in l?!1:(l.selected=!0,!0)})}e.forEach(function(l){"choices"in l?r._isSelectElement&&r._addGroup(l,i):r._addChoice(l,i)})},n.prototype._findAndSelectChoiceByValue=function(e,t){var i=this;t===void 0&&(t=!1);var r=this._store.choices.find(function(s){return i.config.valueComparer(s.value,e)});return r&&!r.disabled&&!r.selected?(this._addItem(r,!0,t),!0):!1},n.prototype._generatePlaceholderValue=function(){var e=this.config;if(!e.placeholder)return null;if(this._hasNonChoicePlaceholder)return e.placeholderValue;if(this._isSelectElement){var t=this.passedElement.placeholderOption;return t?t.text:null}return null},n.prototype._warnChoicesInitFailed=function(e){if(!this.config.silent)if(this.initialised){if(!this.initialisedOK)throw new TypeError("".concat(e," called for an element which has multiple instances of Choices initialised on it"))}else throw new TypeError("".concat(e," called on a non-initialised instance of Choices"))},n.version="11.1.0",n}();function Br(n){let e,t;return{c(){e=b("label"),t=G(n[2]),p(e,"for",n[4])},m(i,r){E(i,e,r),_(e,t)},p(i,r){r&4&&de(t,i[2])},d(i){i&&S(e)}}}function gf(n){let e;return{c(){e=b("select"),p(e,"id",n[4]),p(e,"name",n[4]),p(e,"aria-label",n[2]),p(e,"class","m-1")},m(t,i){E(t,e,i)},p(t,i){i&4&&p(e,"aria-label",t[2])},i:j,o:j,d(t){t&&S(e)}}}function _f(n){let e,t,i,r=n[3].length&&zr(n);return{c(){r&&r.c(),e=N(),t=b("select"),p(t,"id",n[4]),p(t,"name",n[4]),p(t,"aria-label",n[2]),p(t,"class","m-1"),t.multiple=!0},m(s,l){r&&r.m(s,l),E(s,e,l),E(s,t,l),i=!0},p(s,l){s[3].length?r?(r.p(s,l),l&8&&P(r,1)):(r=zr(s),r.c(),P(r,1),r.m(e.parentNode,e)):r&&(be(),M(r,1,1,()=>{r=null}),we()),(!i||l&4)&&p(t,"aria-label",s[2])},i(s){i||(P(r),i=!0)},o(s){M(r),i=!1},d(s){r&&r.d(s),s&&S(e),s&&S(t)}}}function zr(n){let e,t,i=n[3].length+"",r,s,l,o;return l=new fn({props:{targetHtmlId:n[5],tooltipText:`${n[3].length}
                                    ${U==="fr"&&n[3].length>1?"valeurs sélectionnées":U==="fr"&&n[3].length===1?"valeur sélectionnée":U==="en"&&n[3].length>1?"selected values":"selected value"}`}}),{c(){e=b("span"),t=b("span"),r=G(i),s=N(),W(l.$$.fragment),p(t,"id",n[5]),p(t,"class","input-dropdown-count tag m-1 svelte-1epfuu8"),p(e,"class","is-relative")},m(a,c){E(a,e,c),_(e,t),_(t,r),_(e,s),z(l,e,null),o=!0},p(a,c){(!o||c&8)&&i!==(i=a[3].length+"")&&de(r,i);const u={};c&8&&(u.tooltipText=`${a[3].length}
                                    ${U==="fr"&&a[3].length>1?"valeurs sélectionnées":U==="fr"&&a[3].length===1?"valeur sélectionnée":U==="en"&&a[3].length>1?"selected values":"selected value"}`),l.$set(u)},i(a){o||(P(l.$$.fragment,a),o=!0)},o(a){M(l.$$.fragment,a),o=!1},d(a){a&&S(e),K(l)}}}function vf(n){let e,t,i,r,s,l,o,a=n[2]!==void 0&&Br(n);const c=[_f,gf],u=[];function d(f,h){return f[0]?0:1}return r=d(n),s=u[r]=c[r](n),{c(){e=b("div"),a&&a.c(),t=N(),i=b("div"),s.c(),p(i,"class",l="input-dropdown-select "+(n[0]?"is-multiple":"is-single")+" "+(n[0]&&n[3].length?"is-flex is-justify-content-flex-start is-align-items-center":"")+" "+(n[1]?"light-display":"")+" svelte-1epfuu8"),p(e,"class","input-dropdown-select-wrapper")},m(f,h){E(f,e,h),a&&a.m(e,null),_(e,t),_(e,i),u[r].m(i,null),o=!0},p(f,[h]){f[2]!==void 0?a?a.p(f,h):(a=Br(f),a.c(),a.m(e,t)):a&&(a.d(1),a=null);let m=r;r=d(f),r===m?u[r].p(f,h):(be(),M(u[m],1,1,()=>{u[m]=null}),we(),s=u[r],s?s.p(f,h):(s=u[r]=c[r](f),s.c()),P(s,1),s.m(i,null)),(!o||h&11&&l!==(l="input-dropdown-select "+(f[0]?"is-multiple":"is-single")+" "+(f[0]&&f[3].length?"is-flex is-justify-content-flex-start is-align-items-center":"")+" "+(f[1]?"light-display":"")+" svelte-1epfuu8"))&&p(i,"class",l)},i(f){o||(P(s),o=!0)},o(f){M(s),o=!1},d(f){f&&S(e),a&&a.d(),u[r].d()}}}const bf=250;function wf(n,e,t){let i,r,{choicesItems:s}=e,{start:l=[]}=e,{multiple:o}=e,{searchable:a=!0}=e,{lightDisplay:c=!1}=e,{placeholder:u=U==="fr"?"Sélectionner une valeur":"Select a value"}=e,{title:d=void 0}=e,{selectAll:f=!!o}=e;const h=`input-dropdown-select-${window.crypto.randomUUID()}`,m=`input-dropdown-counter-${window.crypto.randomUUID()}`,g=`select-all-${window.crypto.randomUUID()}`,v=`unselect-all-${window.crypto.randomUUID()}`,w=zt();let I;const R=Pn();R.setCompareFn(vi);const C=De("resetTrigger")||void 0;C==null||C.subscribe(()=>V(I,s,l,f));const O=()=>{t(11,r=!0),setTimeout(()=>t(11,r=!1),bf)},L=(q,re)=>{re||(R.set(q),R.same()||w("updateValues",i))},A=q=>`<span class="iconify" data-icon=${q}/>`,y=(q,re)=>q!=null&&re!=null&&q.length&&re.length?`<span class="dropdown-prefix-wrapper">${re==="iconify"?A(q):q}</span>`:"",D=(q,re)=>re?[{value:g,label:`<b>${U==="fr"?"Tout sélectionner":"Select all"}</b>`},{value:v,label:`<b>${U==="fr"?"Tout retirer":"Remove all"}</b>`},...q]:q,Z=(q,re)=>D(q,re).map(F=>(F.id=`dropdown-choice-${window.crypto.randomUUID()}`,F.label=`<span>
                ${y(F.prefix||"",F.prefixType||"")}
                <span class="dropdown-prefix-text">${F.label}</span>
            </span>`,F));function se(q,re,F){return q=structuredClone(q),re=structuredClone(re),q=Z(q,F).map(Y=>re.includes(Y.value)?{...Y,selected:!0}:{...Y,selected:!1}),t(3,i=re),q}function V(q,re,F,Y){q&&(re=se(re,F,Y),q.clearStore().setChoices(re))}const te=(q,re,F,Y,ee,pe)=>(Y=structuredClone(Y),F=structuredClone(F),q.detail.value===ee?(O(),F=F.map(ye=>[ee,pe].includes(ye.value)?{...ye,selected:!1}:{...ye,selected:!0}),re.removeActiveItems().clearChoices(!0,!0).setValue(F).hideDropdown(),Y=[...new Set(F.filter(ye=>ye.selected===!0).map(ye=>ye.value))]):q.detail.value===pe?(re.removeActiveItems().hideDropdown(),Y=[]):Y=o===!0?[...Y,q.detail.value]:[q.detail.value],[...new Set(Y)]),X=(q,re)=>structuredClone(re).filter(F=>F!==q.detail.value);function H(q,re){const F=document.getElementById(h);I=new pf(F,{items:[],choices:q,addChoices:!1,addItems:!1,removeItems:!0,removeItemButton:!0,searchEnabled:a,allowHTML:!0,shouldSort:!re,sorter:(Y,ee)=>Y.label.localeCompare(ee.label),placeholderValue:u,classNames:{item:["choices__item","dropdown-item"]},loadingText:U==="fr"?"Chargement...":"Loading...",noResultsText:U==="fr"?"Pas de résultats":"No results found",noChoicesText:U==="fr"?"Pas de choix pour faire la sélection":"No choices to choose from",itemSelectText:U==="fr"?"Cliquer pour sélectionner":"Press to select",uniqueItemText:U==="fr"?"Seules des valeurs uniques peuvent être ajoutées":"Only unique values can be added",customAddItemText:U==="fr"?"Les valeurs ne répondent pas aux conditions attendues":"Only values matching specific conditions can be added",removeItemIconText:U==="fr"?"Retirer l'item":"Remove item",addItemText:Y=>U==="fr"?`Cliquer sur Entrer pour ajouter <b>${Y}</b>`:`Press Enter to add <b>"${Y}"</b>`,removeItemLabelText:Y=>U==="fr"?`Retirer l'item: ${Y}`:`Remove item: ${Y}`,maxItemText:Y=>U==="fr"?`Seulement ${Y} items peuvent être ajoutées`:`Only ${Y} items can be added`}),F.addEventListener("addItem",Y=>{t(3,i=te(Y,I,q,i,g,v))}),F.addEventListener("removeItem",Y=>{t(3,i=X(Y,i))})}return mt(()=>{const q=se(s,l,f);H(q,f)}),cn(()=>{I.destroy(),I=void 0}),n.$$set=q=>{"choicesItems"in q&&t(6,s=q.choicesItems),"start"in q&&t(7,l=q.start),"multiple"in q&&t(0,o=q.multiple),"searchable"in q&&t(8,a=q.searchable),"lightDisplay"in q&&t(1,c=q.lightDisplay),"placeholder"in q&&t(9,u=q.placeholder),"title"in q&&t(2,d=q.title),"selectAll"in q&&t(10,f=q.selectAll)},n.$$.update=()=>{n.$$.dirty&2056&&L(i,r)},t(3,i=[]),t(11,r=!1),[o,c,d,i,h,m,s,l,a,u,f,r]}class Ci extends ce{constructor(e){super(),ae(this,e,wf,vf,le,{choicesItems:6,start:7,multiple:0,searchable:8,lightDisplay:1,placeholder:9,title:2,selectAll:10})}}function yf(n){let e,t,i,r,s,l,o,a,c,u,d,f,h,m,g,v,w,I,R,C,O,L,A,y,D,Z,se,V,te,X,H,q,re;return a=new Et({props:{minVal:0,maxVal:1,start:.5,emitOnUpdate:!0,title:U==="fr"?"Opacité":"Opacity"}}),a.$on("updateSlider",n[14]),u=new Et({props:{minVal:0,maxVal:360,start:0,step:1,emitOnUpdate:!0,title:"Rotation"}}),u.$on("updateSlider",n[15]),f=new Et({props:{minVal:0,maxVal:200,start:100,step:1,emitOnUpdate:!0,title:U==="fr"?"Redimensionner":"Scale"}}),f.$on("updateSlider",n[16]),m=new Et({props:{minVal:-100,maxVal:100,start:0,step:1,emitOnUpdate:!0,title:U==="fr"?"Translation horizontale":"Horizontal translate"}}),m.$on("updateSlider",n[17]),v=new Et({props:{minVal:-100,maxVal:100,start:0,step:1,emitOnUpdate:!0,title:U==="fr"?"Translation verticale":"Vertical translate"}}),v.$on("updateSlider",n[18]),I=new Ci({props:{choicesItems:n[10],start:[],lightDisplay:!0,placeholder:U==="fr"?"Sélectionner":"Select",title:U==="fr"?"Basculer":"Flip"}}),I.$on("updateValues",n[11]),{c(){e=b("div"),t=b("div"),i=b("div"),r=b("div"),s=b("strong"),s.textContent=`${U==="en"?"Query image transformation":"Modification de l'image requête"}`,l=N(),o=b("div"),W(a.$$.fragment),c=N(),W(u.$$.fragment),d=N(),W(f.$$.fragment),h=N(),W(m.$$.fragment),g=N(),W(v.$$.fragment),w=N(),W(I.$$.fragment),R=N(),C=b("div"),O=b("button"),O.textContent=`${U==="fr"?"Réinitialiser":"Reset"}`,L=N(),A=b("div"),y=b("img"),se=N(),V=b("img"),p(r,"class","toolbar-title mt-0 mb-2 svelte-t3h37q"),p(O,"class","button is-link"),p(C,"class","mt-2 is-flex is-flex-direction-column is-justify-content-center is-align-items-flex-end"),p(o,"class","toolbar-controls is-flex is-flex-direction-column is-align-items-start is-justify-content-center svelte-t3h37q"),p(i,"class","toolbar svelte-t3h37q"),p(t,"class","toolbar-wrapper is-flex is-flex-direction-column is-justify-content-center is-align-items-center svelte-t3h37q"),p(y,"class","compare-img svelte-t3h37q"),Re(y.src,D=n[9])||p(y,"src",D),p(y,"alt",Z=n[0].title),p(V,"class","main-img svelte-t3h37q"),Re(V.src,te=n[8])||p(V,"src",te),p(V,"alt",X=n[1].title),ke(V,"overlay-reset",n[6]),ge(V,"opacity",n[5]),ge(V,"transform",n[7]),p(A,"class","overlay-wrapper svelte-t3h37q"),p(e,"class","similarity-overlay-wrapper svelte-t3h37q")},m(F,Y){E(F,e,Y),_(e,t),_(t,i),_(i,r),_(r,s),_(i,l),_(i,o),z(a,o,null),_(o,c),z(u,o,null),_(o,d),z(f,o,null),_(o,h),z(m,o,null),_(o,g),z(v,o,null),_(o,w),z(I,o,null),_(o,R),_(o,C),_(C,O),_(e,L),_(e,A),_(A,y),_(A,se),_(A,V),H=!0,q||(re=ne(O,"click",n[12]),q=!0)},p(F,[Y]){(!H||Y&512&&!Re(y.src,D=F[9]))&&p(y,"src",D),(!H||Y&1&&Z!==(Z=F[0].title))&&p(y,"alt",Z),(!H||Y&256&&!Re(V.src,te=F[8]))&&p(V,"src",te),(!H||Y&2&&X!==(X=F[1].title))&&p(V,"alt",X),(!H||Y&64)&&ke(V,"overlay-reset",F[6]),Y&32&&ge(V,"opacity",F[5]),Y&128&&ge(V,"transform",F[7])},i(F){H||(P(a.$$.fragment,F),P(u.$$.fragment,F),P(f.$$.fragment,F),P(m.$$.fragment,F),P(v.$$.fragment,F),P(I.$$.fragment,F),H=!0)},o(F){M(a.$$.fragment,F),M(u.$$.fragment,F),M(f.$$.fragment,F),M(m.$$.fragment,F),M(v.$$.fragment,F),M(I.$$.fragment,F),H=!1},d(F){F&&S(e),K(a),K(u),K(f),K(m),K(v),K(I),q=!1,re()}}}function kf(n,e,t){let i,r,s,{queryItem:l}=e,{similarItem:o}=e;const a=[{value:"h",label:U==="fr"?"Basculer horizontalement":"Flip horizontally"},{value:"v",label:U==="fr"?"Basculer verticalement":"Flip vertically"},{value:"hv",label:U==="fr"?"Basculer H+V":"Flip H+V"}];let c=.5,u=0,d=100,f=[1,1],h=[0,0],m=!1;const g=L=>{const A=L.detail[0];t(13,f=A==="hv"?[-1,-1]:A==="h"?[-1,1]:A==="v"?[1,-1]:[1,1])},v=()=>{t(5,c=.5),t(2,u=0),t(3,d=100),t(13,f=[1,1]),t(4,h=[0,0]),t(6,m=!0),setTimeout(()=>t(6,m=!1),300)},w=L=>t(5,c=L.detail),I=L=>t(2,u=L.detail),R=L=>t(3,d=L.detail),C=L=>t(4,h=[L.detail,h[1]]),O=L=>t(4,h=[h[0],L.detail]);return n.$$set=L=>{"queryItem"in L&&t(0,l=L.queryItem),"similarItem"in L&&t(1,o=L.similarItem)},n.$$.update=()=>{var L,A;n.$$.dirty&1&&t(9,i=nt(l.img,((L=l.xywh)==null?void 0:L.join(","))||"full","full")),n.$$.dirty&2&&t(8,r=nt(o.img,((A=o.xywh)==null?void 0:A.join(","))||"full","full")),n.$$.dirty&8220&&t(7,s=`translate(${h[0]-50}%, ${h[1]}%)
                        rotate(${u}deg)
                        scale(${f.map(y=>y*(d/100)).join()})`)},[l,o,u,d,h,c,m,s,r,i,a,g,v,f,w,I,R,C,O]}class Sf extends ce{constructor(e){super(),ae(this,e,kf,yf,le,{queryItem:0,similarItem:1})}}function Ef(n){let e,t,i,r,s,l,o,a,c,u,d;return s=new qt({props:{item:n[0],height:"full",isInModal:!0}}),u=new qt({props:{item:n[1],height:"full",isInModal:!0}}),{c(){e=b("div"),t=b("div"),i=b("span"),i.textContent=`${U==="en"?"Query image":"Image requête"}`,r=N(),W(s.$$.fragment),l=N(),o=b("div"),a=b("span"),a.textContent=`${U==="en"?"Similarity":"Similarité"}`,c=N(),W(u.$$.fragment),p(t,"class","column is-flex is-flex-direction-column is-justify-content-center is-align-items-center"),p(o,"class","column is-flex is-flex-direction-column is-justify-content-center is-align-items-center"),p(e,"class","side-by-side columns svelte-1wmtj1c")},m(f,h){E(f,e,h),_(e,t),_(t,i),_(t,r),z(s,t,null),_(e,l),_(e,o),_(o,a),_(o,c),z(u,o,null),d=!0},p(f,h){const m={};h&1&&(m.item=f[0]),s.$set(m);const g={};h&2&&(g.item=f[1]),u.$set(g)},i(f){d||(P(s.$$.fragment,f),P(u.$$.fragment,f),d=!0)},o(f){M(s.$$.fragment,f),M(u.$$.fragment,f),d=!1},d(f){f&&S(e),K(s),K(u)}}}function Cf(n){let e,t;return e=new Sf({props:{queryItem:n[0],similarItem:n[1]}}),{c(){W(e.$$.fragment)},m(i,r){z(e,i,r),t=!0},p(i,r){const s={};r&1&&(s.queryItem=i[0]),r&2&&(s.similarItem=i[1]),e.$set(s)},i(i){t||(P(e.$$.fragment,i),t=!0)},o(i){M(e.$$.fragment,i),t=!1},d(i){K(e,i)}}}function If(n){let e,t,i,r,s,l,o,a;const c=[Cf,Ef],u=[];function d(f,h){return f[2]?0:1}return i=d(n),r=u[i]=c[i](n),o=new ul({props:{start:!1,buttonDisplay:!0,toggleLabel:U==="en"?"Overlay view":"Vue superposée"}}),o.$on("updateChecked",n[3]),{c(){e=b("div"),t=b("div"),r.c(),s=N(),l=b("div"),W(o.$$.fragment),p(t,"class","modal-similarity-images svelte-1wmtj1c"),ke(t,"overlay-wrapper",n[2]),ke(t,"side-by-side-wrapper",!n[2]),p(e,"class","modal-similarity svelte-1wmtj1c")},m(f,h){E(f,e,h),_(e,t),u[i].m(t,null),_(e,s),_(e,l),z(o,l,null),a=!0},p(f,[h]){let m=i;i=d(f),i===m?u[i].p(f,h):(be(),M(u[m],1,1,()=>{u[m]=null}),we(),r=u[i],r?r.p(f,h):(r=u[i]=c[i](f),r.c()),P(r,1),r.m(t,null)),(!a||h&4)&&ke(t,"overlay-wrapper",f[2]),(!a||h&4)&&ke(t,"side-by-side-wrapper",!f[2])},i(f){a||(P(r),P(o.$$.fragment,f),a=!0)},o(f){M(r),M(o.$$.fragment,f),a=!1},d(f){f&&S(e),u[i].d(),K(o)}}}function Of(n,e,t){let{queryItem:i}=e,{similarItem:r}=e,s=!1;const l=()=>t(2,s=!s);return n.$$set=o=>{"queryItem"in o&&t(0,i=o.queryItem),"similarItem"in o&&t(1,r=o.similarItem)},[i,r,s,l]}class Af extends ce{constructor(e){super(),ae(this,e,Of,If,le,{queryItem:0,similarItem:1})}}function Tf(n){let e,t,i,r,s,l;return s=new Rl({props:{qImg:n[0].img}}),{c(){e=b("div"),t=b("a"),i=b("button"),i.textContent=`${U==="fr"?"Voir toutes les similarités pour ce document":"View all similarities for this document"}`,r=N(),W(s.$$.fragment),p(i,"class","button is-link is-small"),p(t,"href",n[1]()),p(e,"class","is-flex is-align-items-center is-justify-content-end")},m(o,a){E(o,e,a),_(e,t),_(t,i),E(o,r,a),z(s,o,a),l=!0},p(o,[a]){const c={};a&1&&(c.qImg=o[0].img),s.$set(c)},i(o){l||(P(s.$$.fragment,o),l=!0)},o(o){M(s.$$.fragment,o),l=!1},d(o){o&&S(e),o&&S(r),K(s,o)}}}function Pf(n,e,t){let{mainImgItem:i}=e;function r(){const s=i.img.match(/wit(\d+)/)[1],l=new URL(window.location.origin);return l.pathname=`${new URL(window.location).pathname.split("/")[1]}/witness/${s}/regions/`,l.searchParams.set("tab","similarity"),l.href}return n.$$set=s=>{"mainImgItem"in s&&t(0,i=s.mainImgItem)},[i,r]}class Lf extends ce{constructor(e){super(),ae(this,e,Pf,Tf,le,{mainImgItem:0})}}const Mf=n=>({activeTab:n&1}),Kr=n=>({activeTab:n[0]});function Wr(n,e,t){const i=n.slice();return i[5]=e[t].id,i[6]=e[t].label,i}function Gr(n){let e,t,i,r=n[1],s=[];for(let l=0;l<r.length;l+=1)s[l]=Yr(Wr(n,r,l));return{c(){e=b("nav"),t=b("div"),i=b("ul");for(let l=0;l<s.length;l+=1)s[l].c();p(i,"class","svelte-d8a4vd"),p(t,"class","tabs svelte-d8a4vd"),p(e,"class","tabs-bar")},m(l,o){E(l,e,o),_(e,t),_(t,i);for(let a=0;a<s.length;a+=1)s[a]&&s[a].m(i,null)},p(l,o){if(o&3){r=l[1];let a;for(a=0;a<r.length;a+=1){const c=Wr(l,r,a);s[a]?s[a].p(c,o):(s[a]=Yr(c),s[a].c(),s[a].m(i,null))}for(;a<s.length;a+=1)s[a].d(1);s.length=r.length}},d(l){l&&S(e),it(s,l)}}}function Yr(n){let e,t,i=n[6]+"",r,s,l,o;function a(){return n[4](n[5])}return{c(){e=b("li"),t=b("a"),r=G(i),s=N(),p(t,"href",null),ke(e,"is-active",n[0]===n[5])},m(c,u){E(c,e,u),_(e,t),_(t,r),_(e,s),l||(o=ne(t,"click",yt(a)),l=!0)},p(c,u){n=c,u&2&&i!==(i=n[6]+"")&&de(r,i),u&3&&ke(e,"is-active",n[0]===n[5])},d(c){c&&S(e),l=!1,o()}}}function $f(n){let e,t,i,r=n[1].length>1&&Gr(n);const s=n[3].default,l=qe(s,n,n[2],Kr);return{c(){r&&r.c(),e=N(),t=b("div"),l&&l.c(),p(t,"class","tab-content svelte-d8a4vd")},m(o,a){r&&r.m(o,a),E(o,e,a),E(o,t,a),l&&l.m(t,null),i=!0},p(o,[a]){o[1].length>1?r?r.p(o,a):(r=Gr(o),r.c(),r.m(e.parentNode,e)):r&&(r.d(1),r=null),l&&l.p&&(!i||a&5)&&ze(l,s,o,o[2],i?Be(s,o[2],a,Mf):Ke(o[2]),Kr)},i(o){i||(P(l,o),i=!0)},o(o){M(l,o),i=!1},d(o){r&&r.d(o),o&&S(e),o&&S(t),l&&l.d(o)}}}function Rf(n,e,t){var a;let{$$slots:i={},$$scope:r}=e,{tabs:s=[]}=e,{activeTab:l=((a=s[0])==null?void 0:a.id)??""}=e;const o=c=>t(0,l=c);return n.$$set=c=>{"tabs"in c&&t(1,s=c.tabs),"activeTab"in c&&t(0,l=c.activeTab),"$$scope"in c&&t(2,r=c.$$scope)},[l,s,r,i,o]}class Ll extends ce{constructor(e){super(),ae(this,e,Rf,$f,le,{tabs:1,activeTab:0})}}function xr(n,e,t){const i=n.slice();return i[33]=e[t].uuid,i[34]=e[t].data[0],i[35]=e[t].data[1],i[36]=e[t].data[2],i[37]=e[t].data[3],i[38]=e[t].data[4],i[39]=e[t].data[5],i[40]=e[t].data[6],i[41]=e[t].data[7],i[42]=e[t].data[8],i[44]=t,i}function Df(n){let e,t=U==="en"?`Error when retrieving similar regions: ${n[4]}`:`Erreur de recupération des régions similaires: ${n[4]}`,i;return{c(){e=b("div"),i=G(t),p(e,"class","faded is-center")},m(r,s){E(r,e,s),_(e,i)},p(r,s){s[0]&16&&t!==(t=U==="en"?`Error when retrieving similar regions: ${r[4]}`:`Erreur de recupération des régions similaires: ${r[4]}`)&&de(i,t)},i:j,o:j,d(r){r&&S(e)}}}function Nf(n){let e,t,i=n[3].length+"",r,s,l=n[17](n[15],n[3].length)+"",o,a,c,u=[],d=new Map,f,h,m,g,v,w=n[3];const I=A=>A[33];for(let A=0;A<w.length;A+=1){let y=xr(n,w,A),D=I(y);d.set(D,u[A]=Xr(D,y))}let R=null;w.length||(R=Jr(n));function C(A){n[24](A)}function O(A){n[25](A)}let L={items:n[8],$$slots:{default:[Kf,({item:A})=>({31:A}),({item:A})=>[0,A?1:0]]},$$scope:{ctx:n}};return n[2]!==void 0&&(L.currentIndex=n[2]),n[5]!==void 0&&(L.open=n[5]),h=new yi({props:L}),dt.push(()=>jt(h,"currentIndex",C)),dt.push(()=>jt(h,"open",O)),{c(){e=b("div"),t=b("span"),r=G(i),s=N(),o=G(l),a=N(),c=b("div");for(let A=0;A<u.length;A+=1)u[A].c();R&&R.c(),f=N(),W(h.$$.fragment),p(t,"class","m-2"),p(c,"class","m-2 is-gap-2"),ke(c,"grid",n[3].length>0)},m(A,y){E(A,e,y),_(e,t),_(t,r),_(t,s),_(t,o),_(e,a),_(e,c);for(let D=0;D<u.length;D+=1)u[D]&&u[D].m(c,null);R&&R.m(c,null),E(A,f,y),z(h,A,y),v=!0},p(A,y){(!v||y[0]&8)&&i!==(i=A[3].length+"")&&de(r,i),(!v||y[0]&8)&&l!==(l=A[17](A[15],A[3].length)+"")&&de(o,l),y[0]&263177&&(w=A[3],be(),u=un(u,y,I,1,A,w,d,c,Rn,Xr,null,xr),we(),!w.length&&R?R.p(A,y):w.length?R&&(R.d(1),R=null):(R=Jr(A),R.c(),R.m(c,null))),(!v||y[0]&8)&&ke(c,"grid",A[3].length>0);const D={};y[0]&256&&(D.items=A[8]),y[0]&192|y[1]&16385&&(D.$$scope={dirty:y,ctx:A}),!m&&y[0]&4&&(m=!0,D.currentIndex=A[2],Nt(()=>m=!1)),!g&&y[0]&32&&(g=!0,D.open=A[5],Nt(()=>g=!1)),h.$set(D)},i(A){if(!v){for(let y=0;y<w.length;y+=1)P(u[y]);P(h.$$.fragment,A),v=!0}},o(A){for(let y=0;y<u.length;y+=1)M(u[y]);M(h.$$.fragment,A),v=!1},d(A){A&&S(e);for(let y=0;y<u.length;y+=1)u[y].d();R&&R.d(),A&&S(f),K(h,A)}}}function jf(n){let e;function t(s,l){return s[15]?Gf:Wf}let r=t(n)(n);return{c(){e=b("div"),r.c(),p(e,"class","faded is-center")},m(s,l){E(s,e,l),r.m(e,null)},p(s,l){r.p(s,l)},i:j,o:j,d(s){s&&S(e),r.d()}}}function Jr(n){let e;function t(s,l){return s[10]?Uf:Vf}let i=t(n),r=i(n);return{c(){r.c(),e=me()},m(s,l){r.m(s,l),E(s,e,l)},p(s,l){i===(i=t(s))&&r?r.p(s,l):(r.d(1),r=i(s),r&&(r.c(),r.m(e.parentNode,e)))},d(s){r.d(s),s&&S(e)}}}function Vf(n){let e;return{c(){e=b("div"),e.textContent=`${U==="en"?"No similar regions":"Pas de régions similaires"}
                    `,p(e,"class","faded is-center")},m(t,i){E(t,e,i)},p:j,d(t){t&&S(e)}}}function Uf(n){let e;return{c(){e=b("div"),e.textContent=`${U==="en"?"No document selected. Select one to display results.":"Aucun document sélectionné. Sélectionnez-en un pour afficher les résultats."}
                    `,p(e,"class","faded is-center")},m(t,i){E(t,e,i)},p:j,d(t){t&&S(e)}}}function Xr(n,e){let t,i,r;return i=new Ka({props:{qImg:e[0],sImg:e[36],score:e[34],qRegions:e[37],sRegions:e[38],category:e[39],users:e[40],isManual:e[41],similarityType:e[42],index:e[44]}}),i.$on("openModal",e[18]),{key:n,first:null,c(){t=me(),W(i.$$.fragment),this.first=t},m(s,l){E(s,t,l),z(i,s,l),r=!0},p(s,l){e=s;const o={};l[0]&1&&(o.qImg=e[0]),l[0]&8&&(o.sImg=e[36]),l[0]&8&&(o.score=e[34]),l[0]&8&&(o.qRegions=e[37]),l[0]&8&&(o.sRegions=e[38]),l[0]&8&&(o.category=e[39]),l[0]&8&&(o.users=e[40]),l[0]&8&&(o.isManual=e[41]),l[0]&8&&(o.similarityType=e[42]),l[0]&8&&(o.index=e[44]),i.$set(o)},i(s){r||(P(i.$$.fragment,s),r=!0)},o(s){M(i.$$.fragment,s),r=!1},d(s){s&&S(t),K(i,s)}}}function Ff(n){let e,t;return e=new Lf({props:{mainImgItem:n[31]}}),{c(){W(e.$$.fragment)},m(i,r){z(e,i,r),t=!0},p(i,r){const s={};r[1]&1&&(s.mainImgItem=i[31]),e.$set(s)},i(i){t||(P(e.$$.fragment,i),t=!0)},o(i){M(e.$$.fragment,i),t=!1},d(i){K(e,i)}}}function Hf(n){let e,t;return e=new Af({props:{queryItem:n[16],similarItem:n[31],score:n[7]}}),{c(){W(e.$$.fragment)},m(i,r){z(e,i,r),t=!0},p(i,r){const s={};r[1]&1&&(s.similarItem=i[31]),r[0]&128&&(s.score=i[7]),e.$set(s)},i(i){t||(P(e.$$.fragment,i),t=!0)},o(i){M(e.$$.fragment,i),t=!1},d(i){K(e,i)}}}function qf(n){let e,t;return e=new cl({props:{item:n[31]}}),{c(){W(e.$$.fragment)},m(i,r){z(e,i,r),t=!0},p(i,r){const s={};r[1]&1&&(s.item=i[31]),e.$set(s)},i(i){t||(P(e.$$.fragment,i),t=!0)},o(i){M(e.$$.fragment,i),t=!1},d(i){K(e,i)}}}function Bf(n){let e,t,i;return t=new qt({props:{item:n[31],height:"full",isInModal:!0}}),{c(){e=b("div"),W(t.$$.fragment),p(e,"class","modal-region svelte-jba7xn")},m(r,s){E(r,e,s),z(t,e,null),i=!0},p(r,s){const l={};s[1]&1&&(l.item=r[31]),t.$set(l)},i(r){i||(P(t.$$.fragment,r),i=!0)},o(r){M(t.$$.fragment,r),i=!1},d(r){r&&S(e),K(t)}}}function zf(n){let e,t,i,r;const s=[Bf,qf,Hf,Ff],l=[];function o(a,c){return a[32]==="region"?0:a[32]==="page"?1:a[32]==="similarity"&&a[16]?2:a[32]==="expansion"?3:-1}return~(e=o(n))&&(t=l[e]=s[e](n)),{c(){t&&t.c(),i=me()},m(a,c){~e&&l[e].m(a,c),E(a,i,c),r=!0},p(a,c){let u=e;e=o(a),e===u?~e&&l[e].p(a,c):(t&&(be(),M(l[u],1,1,()=>{l[u]=null}),we()),~e?(t=l[e],t?t.p(a,c):(t=l[e]=s[e](a),t.c()),P(t,1),t.m(i.parentNode,i)):t=null)},i(a){r||(P(t),r=!0)},o(a){M(t),r=!1},d(a){~e&&l[e].d(a),a&&S(i)}}}function Kf(n){let e,t;return e=new Ll({props:{tabs:n[6],$$slots:{default:[zf,({activeTab:i})=>({32:i}),({activeTab:i})=>[0,i?2:0]]},$$scope:{ctx:n}}}),{c(){W(e.$$.fragment)},m(i,r){z(e,i,r),t=!0},p(i,r){const s={};r[0]&64&&(s.tabs=i[6]),r[0]&128|r[1]&16387&&(s.$$scope={dirty:r,ctx:i}),e.$set(s)},i(i){t||(P(e.$$.fragment,i),t=!0)},o(i){M(e.$$.fragment,i),t=!1},d(i){K(e,i)}}}function Wf(n){let e=U==="en"?"Retrieving similar regions...":"Récupération des régions similaires...",t;return{c(){t=G(e)},m(i,r){E(i,t,r)},p:j,d(i){i&&S(t)}}}function Gf(n){let e=U==="en"?"Retrieving propagated regions...":"Récupération de similarités propagées...",t;return{c(){t=G(e)},m(i,r){E(i,t,r)},p:j,d(i){i&&S(t)}}}function Yf(n){let e,t,i,r;const s=[jf,Nf,Df],l=[];function o(a,c){return a[1]&&a[9]==="loading"?0:a[9]==="loaded"?1:a[9]==="error"?2:-1}return~(e=o(n))&&(t=l[e]=s[e](n)),{c(){t&&t.c(),i=me()},m(a,c){~e&&l[e].m(a,c),E(a,i,c),r=!0},p(a,c){let u=e;e=o(a),e===u?~e&&l[e].p(a,c):(t&&(be(),M(l[u],1,1,()=>{l[u]=null}),we()),~e?(t=l[e],t?t.p(a,c):(t=l[e]=s[e](a),t.c()),P(t,1),t.m(i.parentNode,i)):t=null)},i(a){r||(P(t),r=!0)},o(a){M(t),r=!1},d(a){~e&&l[e].d(a),a&&S(i)}}}function xf(n,e,t){let i,r,s,l,o,a,c,u,d,f,h,{qImg:m}=e,{sImgsPromise:g}=e;const{selectedRegions:v,excludedCategories:w,similarityScoreCutoff:I,propagateFilterByRegions:R}=Je;ue(n,v,F=>t(23,h=F)),ue(n,w,F=>t(22,f=F)),ue(n,I,F=>t(21,d=F)),ue(n,R,F=>t(20,u=F));const C=De("similarityPropagatedContext")||!1,O=window.location.pathname.match(/\d+/g).join("-"),L=De("qImgMetadata")||null;let A;const y=(F,Y)=>F===null||Y===void 0||Number(F)>=Y,D=(F,Y,ee)=>!ee.includes(F),Z=(F,Y,ee,pe,ye,Wt)=>C?!0:y(F,ye)&&D(Y,ee,pe),se=(F,Y,ee,pe)=>F.filter(({uuid:ye,data:[Wt,Un,Gt,Yt,dn,Qe,hn,xt,mn]})=>Z(Wt,Qe,hn,Y,ee)),V=(F,Y)=>{const ee=Y>1;return F?U==="fr"?ee?"similarités propagées":"similarité propagée":ee?"propagated matches":"propagated match":U==="fr"?ee?"images similaires":"image similaire":ee?"similar images":"similar image"};let te=!1,X=0;const H=F=>{t(2,X=F.detail.index??0),t(5,te=!0)};function q(F){X=F,t(2,X)}function re(F){te=F,t(5,te)}return n.$$set=F=>{"qImg"in F&&t(0,m=F.qImg),"sImgsPromise"in F&&t(1,g=F.sImgsPromise)},n.$$.update=()=>{var F;n.$$.dirty[0]&8388608&&t(10,i=Object.values(h).length===0||h[O]===void 0||!Object.keys(h[O]).length),n.$$.dirty[0]&2&&(Y=>{t(9,r="loading"),t(3,l=[]),t(19,s=[])})(),n.$$.dirty[0]&2&&g.then(Y=>{t(19,s=Y.map(ee=>({uuid:window.crypto.randomUUID(),data:ee}))),t(9,r="loaded")}).catch(Y=>{t(4,A=Y),t(9,r="error")}),n.$$.dirty[0]&7864320&&t(3,l=se(s,f,d)),n.$$.dirty[0]&8&&t(8,o=l.map(({data:[Y,ee,pe,ye,Wt,Un,Gt,Yt,dn]})=>{const[Qe,hn,xt,mn]=pe.split(".")[0].split("_");return wi(pe,Qe,mn,xt)})),n.$$.dirty[0]&12&&t(7,a=((F=l[X])==null?void 0:F.data[0])??null)},t(9,r="loading"),t(19,s=[]),t(6,c=[{id:"region",label:U==="en"?"Main view":"Vue principale"},{id:"page",label:U==="en"?"Page View":"Vue de la page"},{id:"similarity",label:U==="en"?"Comparison":"Comparaison"},{id:"expansion",label:U==="en"?"Query Expansion":"Expansion de requête"}]),[m,g,X,l,A,te,c,a,o,r,i,v,w,I,R,C,L,V,H,s,u,d,f,h,q,re]}class Ml extends ce{constructor(e){super(),ae(this,e,xf,Yf,le,{qImg:0,sImgsPromise:1},null,[-1,-1])}}function Jf(n){let e,t;return e=new Ml({props:{qImg:n[0],sImgsPromise:n[1]}}),{c(){W(e.$$.fragment)},m(i,r){z(e,i,r),t=!0},p(i,[r]){const s={};r&1&&(s.qImg=i[0]),r&2&&(s.sImgsPromise=i[1]),e.$set(s)},i(i){t||(P(e.$$.fragment,i),t=!0)},o(i){M(e.$$.fragment,i),t=!1},d(i){K(e,i)}}}function Xf(n,e,t){let i,r,{qImg:s}=e,l;const o=De("isInModal")||!1,{selectedRegions:a,comparedRegions:c}=Je;ue(n,a,m=>t(4,i=m)),ue(n,c,m=>t(5,r=m));const u=`${window.location.origin}${window.location.pathname}`,d=window.location.pathname.match(/\d+/g).join("-"),f=(m,g)=>g?Object.keys(r).map(v=>r[v].id):Object.values(m[d]||{}).map(v=>v.id);async function h(m,g,v){const w=f(g,v);return w.length===0?[]:await(await fetch(`${u}similar-images`,{method:"POST",body:JSON.stringify({regionsIds:w,qImg:m,topk:12}),headers:{"Content-Type":"application/json","X-CSRFToken":Xe}})).json()}return o?l=h(s,i,o):a.subscribe(m=>{t(1,l=h(s,m,o))}),n.$$set=m=>{"qImg"in m&&t(0,s=m.qImg)},[s,l,a,c]}class Qf extends ce{constructor(e){super(),ae(this,e,Xf,Jf,le,{qImg:0})}}function Zf(n){let e,t,i,r;return i=new Ml({props:{qImg:n[0],sImgsPromise:n[1]}}),{c(){e=b("div"),t=b("div"),W(i.$$.fragment),p(t,"class","matches-suggestion svelte-1cb4wg0"),p(e,"class","block matches-suggestion-wrapper svelte-1cb4wg0")},m(s,l){E(s,e,l),_(e,t),z(i,t,null),r=!0},p(s,[l]){const o={};l&1&&(o.qImg=s[0]),l&2&&(o.sImgsPromise=s[1]),i.$set(o)},i(s){r||(P(i.$$.fragment,s),r=!0)},o(s){M(i.$$.fragment,s),r=!1},d(s){s&&S(e),K(i)}}}function ed(n,e,t){let i,r,{qImg:s}=e;const{propagateParams:l,selectedRegions:o}=Je;ue(n,l,v=>t(4,i=v)),ue(n,o,v=>t(5,r=v));const a=`${window.location.origin}${window.location.pathname}`,c=window.location.pathname.match(/\d+/g).join("-"),u=De("isInModal")||!1;let d;const f=Pn();f.setCompareFn((v,w)=>[v,w].every(I=>I&&I.hasOwnProperty("propagateRecursionDepth")&&I.hasOwnProperty("propagateFilterByRegions"))?v.propagateRecursionDepth===w.propagateRecursionDepth&&v.propagateFilterByRegions===w.propagateFilterByRegions:!1);const h=Pn();h.setCompareFn(vi),ct("similarityPropagatedContext",!0);const m=v=>Object.keys(v).includes(c)?Object.values(v[c]).map(w=>w.id):[],g=async(v,w,I)=>fetch(`${a}propagated-matches/${s}`,{method:"POST",body:JSON.stringify({regionsIds:I?[]:w,filterByRegions:I?!1:v.propagateFilterByRegions,recursionDepth:v.propagateRecursionDepth}),headers:{"Content-Type":"application/json","X-CSRFToken":Xe}}).then(R=>R.json()).catch(R=>(console.error("PropagatedMatches.getPropagatedMatches:",R),[]));return l.subscribe(v=>{f.set(v),f.same()||t(1,d=g(f.get(),m(r),u))}),o.subscribe(v=>{h.set(m(v)),i.propagateFilterByRegions===!0&&!h.same()&&t(1,d=g(i,h.get(),u))}),n.$$set=v=>{"qImg"in v&&t(0,s=v.qImg)},[s,d,l,o]}class td extends ce{constructor(e){super(),ae(this,e,ed,Zf,le,{qImg:0})}}const nd=n=>({}),Qr=n=>({}),id=n=>({}),Zr=n=>({}),rd=n=>({}),es=n=>({});function sd(n){let e;const t=n[4]["row-body"],i=qe(t,n,n[3],Qr);return{c(){i&&i.c()},m(r,s){i&&i.m(r,s),e=!0},p(r,s){i&&i.p&&(!e||s&8)&&ze(i,t,r,r[3],e?Be(t,r[3],s,nd):Ke(r[3]),Qr)},i(r){e||(P(i,r),e=!0)},o(r){M(i,r),e=!1},d(r){i&&i.d(r)}}}function ld(n){let e,t,i,r;const s=n[4]["row-body"],l=qe(s,n,n[3],Zr);return{c(){e=b("div"),t=b("div"),l&&l.c(),p(t,"class","grid is-gap-2"),p(e,"class",i="fixed-grid has-"+n[2]+"-cols")},m(o,a){E(o,e,a),_(e,t),l&&l.m(t,null),r=!0},p(o,a){l&&l.p&&(!r||a&8)&&ze(l,s,o,o[3],r?Be(s,o[3],a,id):Ke(o[3]),Zr),(!r||a&4&&i!==(i="fixed-grid has-"+o[2]+"-cols"))&&p(e,"class",i)},i(o){r||(P(l,o),r=!0)},o(o){M(l,o),r=!1},d(o){o&&S(e),l&&l.d(o)}}}function od(n){let e,t,i,r,s,l,o,a,c,u;et(n[5]);const d=n[4]["row-header"],f=qe(d,n,n[3],es),h=[ld,sd],m=[];function g(v,w){return v[0]?0:1}return l=g(n),o=m[l]=h[l](n),{c(){e=b("tr"),t=b("th"),i=b("div"),f&&f.c(),r=N(),s=b("td"),o.c(),p(i,"class","content-wrapper py-5"),p(t,"class","is-3 center-flex is-narrow"),ge(t,"width","15vw"),p(s,"class","p-5 is-fullwidth")},m(v,w){E(v,e,w),_(e,t),_(t,i),f&&f.m(i,null),_(e,r),_(e,s),m[l].m(s,null),a=!0,c||(u=ne(window,"resize",n[5]),c=!0)},p(v,[w]){f&&f.p&&(!a||w&8)&&ze(f,d,v,v[3],a?Be(d,v[3],w,rd):Ke(v[3]),es);let I=l;l=g(v),l===I?m[l].p(v,w):(be(),M(m[I],1,1,()=>{m[I]=null}),we(),o=m[l],o?o.p(v,w):(o=m[l]=h[l](v),o.c()),P(o,1),o.m(s,null))},i(v){a||(P(f,v),P(o),a=!0)},o(v){M(f,v),M(o),a=!1},d(v){v&&S(e),f&&f.d(v),m[l].d(),c=!1,u()}}}function ad(n,e,t){let i,{$$slots:r={},$$scope:s}=e,{useGrid:l=!0}=e,o=0;function a(){t(1,o=window.innerWidth)}return n.$$set=c=>{"useGrid"in c&&t(0,l=c.useGrid),"$$scope"in c&&t(3,s=c.$$scope)},n.$$.update=()=>{n.$$.dirty&2&&t(2,i=Gs(o))},[l,o,i,s,r,a]}class $l extends ce{constructor(e){super(),ae(this,e,ad,od,le,{useGrid:0})}}function cd(n){let e,t,i,r=parseInt(n[5])+"",s,l,o,a,c,u,d,f,h,m,g,v,w,I,R,C,O,L,A;return{c(){e=b("a"),t=b("i"),i=G(`
            Page `),s=G(r),l=N(),o=b("img"),c=N(),u=b("div"),d=b("div"),f=b("input"),h=N(),m=b("button"),m.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M256 80c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 144L48 224c-17.7 0-32 14.3-32 32s14.3 32 32 32l144 0 0 144c0 17.7 14.3 32 32 32s32-14.3 32-32l0-144 144 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-144 0 0-144z"></path></svg>',g=N(),v=b("button"),w=He("svg"),I=He("path"),p(t,"class","fa-solid fa-pen-to-square"),p(e,"class","tag px-2 py-1 mb-2 is-rounded is-hoverable"),p(e,"href",Ft(n[6],parseInt(n[5]))),p(e,"target","_blank"),Re(o.src,a=nt(n[0],n[0].split("_").pop(),"250,"))||p(o,"src",a),p(o,"alt","Query region"),p(o,"class","mb-3 card query-image svelte-f4ylwc"),p(f,"class","input is-small tag"),p(f,"type","text"),p(f,"placeholder",U==="en"?"Add new match":"Ajouter une correspondance"),p(m,"class","button is-small tag is-link is-center"),p(d,"class","tags has-addons"),ge(d,"flex-wrap","nowrap"),p(I,"fill","white"),p(I,"d","M376.6 84.5c11.3-13.6 9.5-33.8-4.1-45.1s-33.8-9.5-45.1 4.1L192 206 56.6 43.5C45.3 29.9 25.1 28.1 11.5 39.4S-3.9 70.9 7.4 84.5L150.3 256 7.4 427.5c-11.3 13.6-9.5 33.8 4.1 45.1s33.8 9.5 45.1-4.1L192 306 327.4 468.5c11.3 13.6 31.5 15.4 45.1 4.1s15.4-31.5 4.1-45.1L233.7 256 376.6 84.5z"),p(w,"xmlns","http://www.w3.org/2000/svg"),p(w,"viewBox","0 0 384 512"),p(v,"id","no-match"),p(v,"class",R="button is-small tag is-danger is-center m-0 "+(n[3]===1?"visible":"")+" svelte-f4ylwc"),p(v,"title",U==="en"?"No match for this region in this witness":"Aucune correspondance de cette région pour ce témoin"),p(u,"class","new-similarity control pt-2 is-center svelte-f4ylwc")},m(y,D){E(y,e,D),_(e,t),_(e,i),_(e,s),E(y,l,D),E(y,o,D),E(y,c,D),E(y,u,D),_(u,d),_(d,f),Dt(f,n[1]),_(d,h),_(d,m),_(u,g),_(u,v),_(v,w),_(w,I),O=!0,L||(A=[ne(f,"input",n[12]),ne(m,"click",n[8]),ne(v,"click",n[9])],L=!0)},p(y,D){(!O||D&1&&!Re(o.src,a=nt(y[0],y[0].split("_").pop(),"250,")))&&p(o,"src",a),D&2&&f.value!==y[1]&&Dt(f,y[1]),(!O||D&8&&R!==(R="button is-small tag is-danger is-center m-0 "+(y[3]===1?"visible":"")+" svelte-f4ylwc"))&&p(v,"class",R)},i(y){O||(et(()=>{O&&(C||(C=ot(v,bt,{duration:500},!0)),C.run(1))}),O=!0)},o(y){C||(C=ot(v,bt,{duration:500},!1)),C.run(0),O=!1},d(y){y&&S(e),y&&S(l),y&&S(o),y&&S(c),y&&S(u),y&&C&&C.end(),L=!1,Ce(A)}}}function ud(n){let e,t,i,r,s,l,o,a;return t=new Qf({props:{qImg:n[0]}}),l=new td({props:{qImg:n[0]}}),{c(){e=b("div"),W(t.$$.fragment),r=N(),s=b("div"),W(l.$$.fragment),p(e,"class",i=bn(n[7]?"":n[2])+" svelte-f4ylwc"),p(s,"class",o=bn(n[7]?"":n[2])+" svelte-f4ylwc")},m(c,u){E(c,e,u),z(t,e,null),E(c,r,u),E(c,s,u),z(l,s,null),a=!0},p(c,u){const d={};u&1&&(d.qImg=c[0]),t.$set(d),(!a||u&4&&i!==(i=bn(c[7]?"":c[2])+" svelte-f4ylwc"))&&p(e,"class",i);const f={};u&1&&(f.qImg=c[0]),l.$set(f),(!a||u&4&&o!==(o=bn(c[7]?"":c[2])+" svelte-f4ylwc"))&&p(s,"class",o)},i(c){a||(P(t.$$.fragment,c),P(l.$$.fragment,c),a=!0)},o(c){M(t.$$.fragment,c),M(l.$$.fragment,c),a=!1},d(c){c&&S(e),K(t),c&&S(r),c&&S(s),K(l)}}}function fd(n){let e,t;return e=new $l({props:{useGrid:!1,$$slots:{"row-body":[ud],"row-header":[cd]},$$scope:{ctx:n}}}),{c(){W(e.$$.fragment)},m(i,r){z(e,i,r),t=!0},p(i,[r]){const s={};r&1048591&&(s.$$scope={dirty:r,ctx:i}),e.$set(s)},i(i){t||(P(e.$$.fragment,i),t=!0)},o(i){M(e.$$.fragment,i),t=!1},d(i){K(e,i)}}}function dd(n){return n=n.replace(".jpg",""),/^wit\d+_[a-zA-Z]{3}\d+_\d+_\d+,\d+,\d+,\d+$/.test(n)}function hd(n,e,t){let i,r,s,l;const{selectedRegions:o}=Je;ue(n,o,L=>t(11,l=L));let{qImg:a}=e,c="";const[u,d,f,h]=a.split(".")[0].split("_"),m=`${window.location.origin}${window.location.pathname}`,g=window.location.pathname.match(/\d+/g).join("-"),v=U==="en"?"Error":"Erreur",w=De("manifest"),I=De("isInModal")||!1;ct("qImgMetadata",wi(a,u,h,f));async function R(){if(!c||!dd(c)){await $e(U==="en"?"Please insert a valid region reference to add a new match":"Veuillez insérer une référence de région valide pour ajouter une nouvelle correspondance","Error");return}try{const L=await fetch(`${m}add-region-pair`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":Xe},body:JSON.stringify({q_img:a.replace(".jpg",""),s_img:c,similarity_type:2})});L.ok||(console.error("Error: Network response was not ok"),await $e(U==="en"?"Problem with network, match was not added":"Problème de réseau, la correspondance n'a pas été ajoutée",v));const A=await L.json();if(A.hasOwnProperty("error")||!A.hasOwnProperty("s_regions")){await $e(U==="en"?`Request was unsuccessful, match was not added:<br>${A.error}`:`La requête n'a pas abouti, la correspondance n'a pas été ajoutée :<br>${A.error}`,v);return}const y=A.s_regions;Je.addComparedRegions(y),Je.select(y)}catch(L){console.error("Error:",L),await $e(U==="en"?`An error has occurred, match was not added:<br>${L}`:`Une erreur s'est produite, la correspondance n'a pas été ajoutée :<br>${L}`,v)}}async function C(){const L=Object.values(l[g])[0];if(await $e(U==="en"?`Do you confirm this region does not have any match in ${L.title}?`:`Confirmez-vous que cette région n'a pas de correspondance dans ${L.title} ?`,U==="en"?"Confirm no match":"Confirmer l'absence de correspondance",!0))try{(await fetch(`${m}no-match`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":Xe},body:JSON.stringify({q_img:a,s_regions:L.id})})).ok||(console.error("Error: Network response was not ok"),await $e(U==="en"?"Problem with network":"Problème de réseau",v)),Je.select(L)}catch(y){console.error("Error:",y),await $e(U==="en"?`An error has occurred, request was unsuccessful:<br>${y}`:`Une erreur s'est produite, la requête n'a pas abouti :<br>${y}`,v)}}function O(){c=this.value,t(1,c)}return n.$$set=L=>{"qImg"in L&&t(0,a=L.qImg)},n.$$.update=()=>{n.$$.dirty&2048&&t(3,i=l.hasOwnProperty(g)?Object.values(l[g]).length:0),n.$$.dirty&1024&&t(2,s=`fixed-grid has-${r-1}-cols`)},t(10,r=Gs(window.innerWidth)),[a,c,s,i,o,f,w,I,R,C,r,l,O]}class Rl extends ce{constructor(e){super(),ae(this,e,hd,fd,le,{qImg:0})}}function ts(n,e,t){const i=n.slice();return i[8]=e[t],i}function md(n){let e,t,i=n[11]+"",r;return{c(){e=b("tr"),t=G("Error when retrieving similar regions: "),r=G(i)},m(s,l){E(s,e,l),_(e,t),_(e,r)},p(s,l){l&2&&i!==(i=s[11]+"")&&de(r,i)},i:j,o:j,d(s){s&&S(e)}}}function pd(n){let e=[],t=new Map,i,r,s=n[2];const l=a=>a[8].id;for(let a=0;a<s.length;a+=1){let c=ts(n,s,a),u=l(c);t.set(u,e[a]=is(u,c))}let o=null;return s.length||(o=ns()),{c(){for(let a=0;a<e.length;a+=1)e[a].c();i=me(),o&&o.c()},m(a,c){for(let u=0;u<e.length;u+=1)e[u]&&e[u].m(a,c);E(a,i,c),o&&o.m(a,c),r=!0},p(a,c){c&4&&(s=a[2],be(),e=un(e,c,l,1,a,s,t,i.parentNode,Rn,is,i,ts),we(),!s.length&&o?o.p(a,c):s.length?o&&(o.d(1),o=null):(o=ns(),o.c(),o.m(i.parentNode,i)))},i(a){if(!r){for(let c=0;c<s.length;c+=1)P(e[c]);r=!0}},o(a){for(let c=0;c<e.length;c+=1)M(e[c]);r=!1},d(a){for(let c=0;c<e.length;c+=1)e[c].d(a);a&&S(i),o&&o.d(a)}}}function ns(n){let e,t;return{c(){e=b("tr"),e.textContent=`${U==="en"?"No similarity":"Pas de similarités"}`,t=N(),p(e,"class","faded is-center")},m(i,r){E(i,e,r),E(i,t,r)},p:j,d(i){i&&S(e),i&&S(t)}}}function is(n,e){let t,i,r;return i=new Rl({props:{qImg:e[8]}}),{key:n,first:null,c(){t=me(),W(i.$$.fragment),this.first=t},m(s,l){E(s,t,l),z(i,s,l),r=!0},p(s,l){e=s;const o={};l&4&&(o.qImg=e[8]),i.$set(o)},i(s){r||(P(i.$$.fragment,s),r=!0)},o(s){M(i.$$.fragment,s),r=!1},d(s){s&&S(t),K(i,s)}}}function gd(n){let e;return{c(){e=b("tr"),e.textContent=`${U==="en"?"Retrieving similarity page...":"Récupération la page de similarité..."}`,p(e,"class","faded is-center")},m(t,i){E(t,e,i)},p:j,i:j,o:j,d(t){t&&S(e)}}}function _d(n){let e,t,i,r={ctx:n,current:null,token:null,hasCatch:!0,pending:gd,then:pd,catch:md,value:7,error:11,blocks:[,,,]};return tt(t=n[1],r),{c(){e=me(),r.block.c()},m(s,l){E(s,e,l),r.block.m(s,r.anchor=l),r.mount=()=>e.parentNode,r.anchor=e,i=!0},p(s,l){n=s,r.ctx=n,l&2&&t!==(t=n[1])&&tt(t,r)||At(r,n,l)},i(s){i||(P(r.block),i=!0)},o(s){for(let l=0;l<3;l+=1){const o=r.blocks[l];M(o)}i=!1},d(s){s&&S(e),r.block.d(s),r.token=null,r=null}}}function vd(n){let e,t,i,r,s,l,o;return t=new Ht({props:{store:Je,nbOfItems:n[0].length,pageLength:n[6]}}),r=new Dn({props:{$$slots:{default:[_d]},$$scope:{ctx:n}}}),l=new Ht({props:{store:Je,nbOfItems:n[0].length,pageLength:n[6]}}),{c(){e=b("div"),W(t.$$.fragment),i=N(),W(r.$$.fragment),s=N(),W(l.$$.fragment)},m(a,c){E(a,e,c),z(t,e,null),_(e,i),z(r,e,null),_(e,s),z(l,e,null),o=!0},p(a,[c]){const u={};c&1&&(u.nbOfItems=a[0].length),t.$set(u);const d={};c&4102&&(d.$$scope={dirty:c,ctx:a}),r.$set(d);const f={};c&1&&(f.nbOfItems=a[0].length),l.$set(f)},i(a){o||(P(t.$$.fragment,a),P(r.$$.fragment,a),P(l.$$.fragment,a),o=!0)},o(a){M(t.$$.fragment,a),M(r.$$.fragment,a),M(l.$$.fragment,a),o=!1},d(a){a&&S(e),K(t),K(r),K(l)}}}function bd(n,e,t){let i,r,s;const{qImgs:l,pageQImgs:o,setPageQImgs:a,pageLength:c}=Je;return ue(n,l,u=>t(0,i=u)),ue(n,o,u=>t(2,s=u)),ue(n,a,u=>t(1,r=u)),[i,r,s,l,o,a,c]}class wd extends ce{constructor(e){super(),ae(this,e,bd,vd,le,{})}}function yd(n){let e,t,i,r,s,l;return s=new fn({props:{tooltipText:n[2]}}),{c(){e=b("div"),t=b("button"),i=b("span"),r=N(),W(s.$$.fragment),p(i,"class","iconify"),p(i,"data-icon",n[0]),p(i,"title",n[1]),p(t,"class","svelte-11ixywk"),p(e,"class","is-inline-block icon-tooltip svelte-11ixywk")},m(o,a){E(o,e,a),_(e,t),_(t,i),_(t,r),z(s,t,null),l=!0},p(o,[a]){(!l||a&1)&&p(i,"data-icon",o[0]),(!l||a&2)&&p(i,"title",o[1]);const c={};a&4&&(c.tooltipText=o[2]),s.$set(c)},i(o){l||(P(s.$$.fragment,o),l=!0)},o(o){M(s.$$.fragment,o),l=!1},d(o){o&&S(e),K(s)}}}function kd(n,e,t){let{iconifyIcon:i,altText:r,tooltipText:s}=e;return n.$$set=l=>{"iconifyIcon"in l&&t(0,i=l.iconifyIcon),"altText"in l&&t(1,r=l.altText),"tooltipText"in l&&t(2,s=l.tooltipText)},[i,r,s]}class Sd extends ce{constructor(e){super(),ae(this,e,kd,yd,le,{iconifyIcon:0,altText:1,tooltipText:2})}}const Ed=n=>({}),rs=n=>({}),Cd=n=>({}),ss=n=>({});function ls(n){let e,t,i,r,s,l,o,a,c,u,d,f=n[1]&&os(n);return a=new fn({props:{tooltipText:n[2][n[1]][U]}}),{c(){f&&f.c(),e=N(),t=b("div"),i=b("button"),r=He("svg"),s=He("path"),o=N(),W(a.$$.fragment),p(s,"fill","none"),p(s,"stroke","currentColor"),p(s,"stroke-linecap","round"),p(s,"stroke-linejoin","round"),p(s,"stroke-width","1.5"),p(s,"d","M12 3v18m0 0l8.5-8.5M12 21l-8.5-8.5"),p(r,"style",l=`transform: rotate(${n[1]?"180":"0"}deg)`),p(r,"xmlns","http://www.w3.org/2000/svg"),p(r,"width","24"),p(r,"height","24"),p(r,"viewBox","0 0 24 24"),p(r,"class","svelte-jbs1sd"),p(i,"class","button is-link svelte-jbs1sd"),p(t,"class","ctrl-toggle svelte-jbs1sd")},m(h,m){f&&f.m(h,m),E(h,e,m),E(h,t,m),_(t,i),_(i,r),_(r,s),_(i,o),z(a,i,null),c=!0,u||(d=ne(i,"click",yt(n[3])),u=!0)},p(h,m){h[1]?f?(f.p(h,m),m&2&&P(f,1)):(f=os(h),f.c(),P(f,1),f.m(e.parentNode,e)):f&&(be(),M(f,1,1,()=>{f=null}),we()),(!c||m&2&&l!==(l=`transform: rotate(${h[1]?"180":"0"}deg)`))&&p(r,"style",l);const g={};m&2&&(g.tooltipText=h[2][h[1]][U]),a.$set(g)},i(h){c||(P(f),P(a.$$.fragment,h),c=!0)},o(h){M(f),M(a.$$.fragment,h),c=!1},d(h){f&&f.d(h),h&&S(e),h&&S(t),K(a),u=!1,d()}}}function os(n){let e,t,i;const r=n[5]["toolbar-hidden"],s=qe(r,n,n[4],rs);return{c(){e=b("div"),s&&s.c(),p(e,"class","ctrl-extra")},m(l,o){E(l,e,o),s&&s.m(e,null),i=!0},p(l,o){s&&s.p&&(!i||o&16)&&ze(s,r,l,l[4],i?Be(r,l[4],o,Ed):Ke(l[4]),rs)},i(l){i||(P(s,l),et(()=>{i&&(t||(t=ot(e,Ui,{axis:"y"},!0)),t.run(1))}),i=!0)},o(l){M(s,l),t||(t=ot(e,Ui,{axis:"y"},!1)),t.run(0),i=!1},d(l){l&&S(e),s&&s.d(l),l&&t&&t.end()}}}function Id(n){let e,t,i,r,s,l,o,a;const c=n[5]["toolbar-visible"],u=qe(c,n,n[4],ss);let d=n[0]&&ls(n);return{c(){e=b("div"),t=b("form"),i=b("div"),r=b("div"),s=b("div"),u&&u.c(),l=N(),d&&d.c(),p(s,"class","ctrl-block svelte-jbs1sd"),p(r,"class","ctrl-block-wrapper svelte-jbs1sd"),p(i,"class","ctrl-base"),p(t,"class","ctrl svelte-jbs1sd"),p(e,"id","toolbar"),p(e,"class",o="ctrl-wrapper is-flex is-justify-content-center is-align-items-center "+(n[1]?"toolbar-expanded":"toolbar-collapsed")+" svelte-jbs1sd")},m(f,h){E(f,e,h),_(e,t),_(t,i),_(i,r),_(r,s),u&&u.m(s,null),_(t,l),d&&d.m(t,null),a=!0},p(f,[h]){u&&u.p&&(!a||h&16)&&ze(u,c,f,f[4],a?Be(c,f[4],h,Cd):Ke(f[4]),ss),f[0]?d?(d.p(f,h),h&1&&P(d,1)):(d=ls(f),d.c(),P(d,1),d.m(t,null)):d&&(be(),M(d,1,1,()=>{d=null}),we()),(!a||h&2&&o!==(o="ctrl-wrapper is-flex is-justify-content-center is-align-items-center "+(f[1]?"toolbar-expanded":"toolbar-collapsed")+" svelte-jbs1sd"))&&p(e,"class",o)},i(f){a||(P(u,f),P(d),a=!0)},o(f){M(u,f),M(d),a=!1},d(f){f&&S(e),u&&u.d(f),d&&d.d()}}}function Od(n,e,t){let i,{$$slots:r={},$$scope:s}=e,{expandable:l=!0}=e;const o={true:{en:"Collapse the toolbar",fr:"Refermer le menu"},false:{en:"Expand the toolbar",fr:"Ouvrir le menu"}},a=()=>t(1,i=!i);return n.$$set=c=>{"expandable"in c&&t(0,l=c.expandable),"$$scope"in c&&t(4,s=c.$$scope)},t(1,i=!1),[l,i,o,a,s,r]}class Ad extends ce{constructor(e){super(),ae(this,e,Od,Id,le,{expandable:0})}}function as(n){let e,t;return e=new Ci({props:{choicesItems:n[4],multiple:!0,placeholder:"...",start:Object.keys(n[5][n[13]]||{}),lightDisplay:!0,title:U==="fr"?"Régions sélectionnées":"Selected regions",selectAll:!0}}),e.$on("updateValues",n[22]),{c(){W(e.$$.fragment)},m(i,r){z(e,i,r),t=!0},p(i,r){const s={};r&16&&(s.choicesItems=i[4]),r&32&&(s.start=Object.keys(i[5][i[13]]||{})),e.$set(s)},i(i){t||(P(e.$$.fragment,i),t=!0)},o(i){M(e.$$.fragment,i),t=!1},d(i){K(e,i)}}}function Td(n){return{c:j,m:j,p:j,i:j,o:j,d:j}}function Pd(n){let e,t,i=n[28].length&&Ld(n);return{c(){i&&i.c(),e=me()},m(r,s){i&&i.m(r,s),E(r,e,s),t=!0},p(r,s){r[28].length&&i.p(r,s)},i(r){t||(P(i),t=!0)},o(r){M(i),t=!1},d(r){i&&i.d(r),r&&S(e)}}}function Ld(n){let e,t;return e=new Et({props:{title:U==="fr"?"Score minimal":"Minimal score",minVal:n[28][0],maxVal:n[28][1],start:n[0]||n[28][0],roundTo:3}}),e.$on("updateSlider",n[18]),{c(){W(e.$$.fragment)},m(i,r){z(e,i,r),t=!0},p(i,r){const s={};r&1&&(s.start=i[0]||i[28][0]),e.$set(s)},i(i){t||(P(e.$$.fragment,i),t=!0)},o(i){M(e.$$.fragment,i),t=!1},d(i){K(e,i)}}}function Md(n){return{c:j,m:j,p:j,i:j,o:j,d:j}}function $d(n){let e,t,i=Object.keys(n[4]).length,r,s,l,o=i&&as(n),a={ctx:n,current:null,token:null,hasCatch:!1,pending:Md,then:Pd,catch:Td,value:28,blocks:[,,,]};return tt(n[17],a),{c(){e=b("div"),t=b("div"),o&&o.c(),r=N(),s=b("div"),a.block.c(),p(t,"class","ctrl-input svelte-8yfni4"),p(s,"class","ctrl-input svelte-8yfni4"),p(e,"slot","toolbar-visible"),p(e,"class","ctrl-block-inputs svelte-8yfni4")},m(c,u){E(c,e,u),_(e,t),o&&o.m(t,null),_(e,r),_(e,s),a.block.m(s,a.anchor=null),a.mount=()=>s,a.anchor=null,l=!0},p(c,u){n=c,u&16&&(i=Object.keys(n[4]).length),i?o?(o.p(n,u),u&16&&P(o,1)):(o=as(n),o.c(),P(o,1),o.m(t,null)):o&&(be(),M(o,1,1,()=>{o=null}),we()),At(a,n,u)},i(c){l||(P(o),P(a.block),l=!0)},o(c){M(o);for(let u=0;u<3;u+=1){const d=a.blocks[u];M(d)}l=!1},d(c){c&&S(e),o&&o.d(),a.block.d(),a.token=null,a=null}}}function Rd(n){let e,t,i,r,s,l,o,a,c,u,d,f,h,m,g,v,w,I,R,C,O,L,A;return a=new Ci({props:{choicesItems:n[15],multiple:!0,placeholder:"...",start:n[1],lightDisplay:!0,title:U==="fr"?"Catégories masquées":"Hidden categories",selectAll:!0}}),a.$on("updateValues",n[19]),g=new Sd({props:{iconifyIcon:"material-symbols:help-outline",altText:U==="en"?"Display help":"Afficher une explication",tooltipText:n[14]}}),R=new Et({props:{title:U==="fr"?"Profondeur de récursion":"Recursion depth",minVal:n[12][0],maxVal:n[12][1],start:n[2],step:1}}),R.$on("updateSlider",n[20]),L=new ul({props:{toggleLabel:U==="en"?"Filter by region":"Filtrer par région",start:n[3],buttonDisplay:!0}}),L.$on("updateChecked",n[21]),{c(){e=b("div"),t=b("div"),i=b("div"),r=b("span"),r.textContent=`${U==="en"?"Similarity":"Similarité"}`,s=N(),l=b("div"),o=b("div"),W(a.$$.fragment),c=N(),u=b("div"),d=b("div"),f=b("div"),h=b("span"),h.textContent="Propagation",m=N(),W(g.$$.fragment),v=N(),w=b("div"),I=b("div"),W(R.$$.fragment),C=N(),O=b("div"),W(L.$$.fragment),p(r,"class","tag is-medium is-link"),p(i,"class","ctrl-block-title svelte-8yfni4"),p(o,"class","ctrl-input svelte-8yfni4"),p(l,"class","ctrl-block-inputs svelte-8yfni4"),p(t,"class","ctrl-block svelte-8yfni4"),p(e,"class","ctrl-block-wrapper svelte-8yfni4"),p(h,"class","tag is-medium is-link mr-1"),p(f,"class","ctrl-block-title svelte-8yfni4"),p(I,"class","ctrl-input svelte-8yfni4"),p(O,"class","ctrl-input svelte-8yfni4"),p(w,"class","ctrl-block-inputs svelte-8yfni4"),p(d,"class","ctrl-block svelte-8yfni4"),p(u,"class","ctrl-block-wrapper svelte-8yfni4")},m(y,D){E(y,e,D),_(e,t),_(t,i),_(i,r),_(t,s),_(t,l),_(l,o),z(a,o,null),E(y,c,D),E(y,u,D),_(u,d),_(d,f),_(f,h),_(f,m),z(g,f,null),_(d,v),_(d,w),_(w,I),z(R,I,null),_(w,C),_(w,O),z(L,O,null),A=!0},p(y,D){const Z={};D&2&&(Z.start=y[1]),a.$set(Z);const se={};D&4&&(se.start=y[2]),R.$set(se);const V={};D&8&&(V.start=y[3]),L.$set(V)},i(y){A||(P(a.$$.fragment,y),P(g.$$.fragment,y),P(R.$$.fragment,y),P(L.$$.fragment,y),A=!0)},o(y){M(a.$$.fragment,y),M(g.$$.fragment,y),M(R.$$.fragment,y),M(L.$$.fragment,y),A=!1},d(y){y&&S(e),K(a),y&&S(c),y&&S(u),K(g),K(R),K(L)}}}function Dd(n){let e,t;return e=new Ad({props:{$$slots:{"toolbar-hidden":[Rd],"toolbar-visible":[$d]},$$scope:{ctx:n}}}),{c(){W(e.$$.fragment)},m(i,r){z(e,i,r),t=!0},p(i,[r]){const s={};r&536870975&&(s.$$scope={dirty:r,ctx:i}),e.$set(s)},i(i){t||(P(e.$$.fragment,i),t=!0)},o(i){M(e.$$.fragment,i),t=!1},d(i){K(e,i)}}}function cs(){const n=document.getElementById("nav-actions");n&&document.documentElement.style.setProperty("--top-offset",`${n.offsetHeight}px`)}function Nd(n,e,t){let i,r,s,l,o,a,c,u;const{selectedRegions:d,comparedRegions:f,excludedCategories:h,similarityScoreCutoff:m,propagateRecursionDepth:g,propagateFilterByRegions:v,allowedPropagateDepthRange:w}=Je;ue(n,d,H=>t(5,u=H)),ue(n,f,H=>t(25,r=H)),ue(n,h,H=>t(1,l=H)),ue(n,m,H=>t(23,s=H)),ue(n,g,H=>t(2,o=H)),ue(n,v,H=>t(3,a=H));let I;mt(()=>{cs(),I=new ResizeObserver(()=>{cs()});const H=document.getElementById("nav-actions");return H&&I.observe(H),()=>{I&&H&&(I.unobserve(H),I.disconnect())}});const R=window.location.pathname.match(/\d+/g).join("-"),C=`${window.location.origin}${window.location.pathname}`,O=U==="en"?"Propagated matches are exact matches to images that have an exact match with the current image. There may be up to 6 exact matches connecting the current image and propagated images.":"Les correspondances propagées correspondent à des correspondances exactes à des images ayant une correspondance exacte avec l'image actuelle. Il peut y avoir jusqu'à 6 images reliant l'image actuelle à une correspondance propagée.",L=[{value:1,label:il,prefix:Qs,prefixType:"svg"},{value:2,label:rl,prefix:Zs,prefixType:"svg"},{value:3,label:sl,prefix:el,prefixType:"svg"},{value:4,label:ll,prefix:tl,prefixType:"svg"},{value:5,label:ol,prefix:nl,prefixType:"svg"}],A=xe(f,H=>Object.entries(H).map(([q,re])=>({prefix:`#${re.id}`,prefixType:"text",value:q,label:zs(re.title.replace(/^[^|]+/,""))})));ue(n,A,H=>t(4,c=H));const y=D();async function D(){let H=[];return await fetch(`${C}similarity-score-range`).then(q=>q.json()).then(q=>(H=[q.min,q.max],H.every(re=>typeof re=="number")?t(0,i=s&&H[0]<=s&&H[1]>=s?s:H[0]):(console.error(`fetchSimilarityScoreRange: expected '[number, number]', got '${H}'. Defaulting to '[]'`),H=[]),H)).catch(q=>(console.error("Error on fetchSimilarityScoreRange:",q),errorMsg.set(q.message),H))}const Z=H=>m.set(H.detail),se=H=>h.set(H.detail),V=H=>g.set(H.detail),te=H=>v.set(H.detail),X=H=>{const q=H.detail,re={[R]:{}};Object.keys(r).forEach(F=>{q.includes(F)&&(re[R][F]=r[F])}),d.set(re)};return n.$$.update=()=>{n.$$.dirty&8388608&&t(0,i=s||void 0)},[i,l,o,a,c,u,d,f,h,m,g,v,w,R,O,L,A,y,Z,se,V,te,X,s]}class jd extends ce{constructor(e){super(),ae(this,e,Nd,Dd,le,{})}}function Vd(n){let e=Object.keys(n[0]).length,t,i,r,s,l,o=e&&us();const a=[Hd,Fd,Ud],c=[];function u(d,f){return d[1]?0:d[2]?1:2}return i=u(n),r=c[i]=a[i](n),{c(){o&&o.c(),t=N(),r.c(),s=me()},m(d,f){o&&o.m(d,f),E(d,t,f),c[i].m(d,f),E(d,s,f),l=!0},p(d,f){f&1&&(e=Object.keys(d[0]).length),e?o?f&1&&P(o,1):(o=us(),o.c(),P(o,1),o.m(t.parentNode,t)):o&&(be(),M(o,1,1,()=>{o=null}),we());let h=i;i=u(d),i===h?c[i].p(d,f):(be(),M(c[h],1,1,()=>{c[h]=null}),we(),r=c[i],r?r.p(d,f):(r=c[i]=a[i](d),r.c()),P(r,1),r.m(s.parentNode,s))},i(d){l||(P(o),P(r),l=!0)},o(d){M(o),M(r),l=!1},d(d){o&&o.d(d),d&&S(t),c[i].d(d),d&&S(s)}}}function us(n){let e,t;return e=new jd({}),{c(){W(e.$$.fragment)},m(i,r){z(e,i,r),t=!0},i(i){t||(P(e.$$.fragment,i),t=!0)},o(i){M(e.$$.fragment,i),t=!1},d(i){K(e,i)}}}function Ud(n){let e,t;return e=new wd({}),{c(){W(e.$$.fragment)},m(i,r){z(e,i,r),t=!0},p:j,i(i){t||(P(e.$$.fragment,i),t=!0)},o(i){M(e.$$.fragment,i),t=!1},d(i){K(e,i)}}}function Fd(n){let e,t;return e=new Dn({props:{$$slots:{default:[zd]},$$scope:{ctx:n}}}),{c(){W(e.$$.fragment)},m(i,r){z(e,i,r),t=!0},p(i,r){const s={};r&36&&(s.$$scope={dirty:r,ctx:i}),e.$set(s)},i(i){t||(P(e.$$.fragment,i),t=!0)},o(i){M(e.$$.fragment,i),t=!1},d(i){K(e,i)}}}function Hd(n){let e,t;return e=new Dn({props:{$$slots:{default:[Kd]},$$scope:{ctx:n}}}),{c(){W(e.$$.fragment)},m(i,r){z(e,i,r),t=!0},p(i,r){const s={};r&32&&(s.$$scope={dirty:r,ctx:i}),e.$set(s)},i(i){t||(P(e.$$.fragment,i),t=!0)},o(i){M(e.$$.fragment,i),t=!1},d(i){K(e,i)}}}function qd(n){let e,t;return{c(){e=G("Erreur lors de la récupération des similarités : "),t=G(n[2])},m(i,r){E(i,e,r),E(i,t,r)},p(i,r){r&4&&de(t,i[2])},d(i){i&&S(e),i&&S(t)}}}function Bd(n){let e,t;return{c(){e=G("Error when retrieving similarities: "),t=G(n[2])},m(i,r){E(i,e,r),E(i,t,r)},p(i,r){r&4&&de(t,i[2])},d(i){i&&S(e),i&&S(t)}}}function zd(n){let e;function t(s,l){return U==="en"?Bd:qd}let r=t()(n);return{c(){e=b("tr"),r.c(),p(e,"class","faded is-center")},m(s,l){E(s,e,l),r.m(e,null)},p(s,l){r.p(s,l)},d(s){s&&S(e),r.d()}}}function Kd(n){let e;return{c(){e=b("tr"),e.textContent=`${U==="en"?"Retrieving similarities...":"Récupération des similarités..."}`,p(e,"class","faded is-center")},m(t,i){E(t,e,i)},p:j,d(t){t&&S(e)}}}function Wd(n){let e=Vt.includes("similarity"),t,i,r=e&&Vd(n);return{c(){r&&r.c(),t=me()},m(s,l){r&&r.m(s,l),E(s,t,l),i=!0},p(s,[l]){e&&r.p(s,l)},i(s){i||(P(r),i=!0)},o(s){M(r),i=!1},d(s){r&&r.d(s),s&&S(t)}}}function Gd(n,e,t){let i,r,s;ue(n,Ot,a=>t(1,r=a)),ue(n,qs,a=>t(2,s=a));const{fetchSimilarity:l,comparedRegions:o}=Je;return ue(n,o,a=>t(0,i=a)),mt(()=>{Vt.includes("similarity")&&l()}),[i,r,s,o]}class Yd extends ce{constructor(e){super(),ae(this,e,Gd,Wd,le,{})}}function fs(n,e,t){const i=n.slice();return i[16]=e[t],i[18]=t,i}function ds(n,e){let t,i,r;return i=new qt({props:{item:new ni(e[16]),index:e[18],height:e[2],borderColor:null,copyable:e[4],selectable:e[3],selectionStore:e[0],selected:e[8](e[16])}}),i.$on("openModal",e[10]),{key:n,first:null,c(){t=me(),W(i.$$.fragment),this.first=t},m(s,l){E(s,t,l),z(i,s,l),r=!0},p(s,l){e=s;const o={};l&2&&(o.item=new ni(e[16])),l&2&&(o.index=e[18]),l&4&&(o.height=e[2]),l&16&&(o.copyable=e[4]),l&8&&(o.selectable=e[3]),l&1&&(o.selectionStore=e[0]),l&258&&(o.selected=e[8](e[16])),i.$set(o)},i(s){r||(P(i.$$.fragment,s),r=!0)},o(s){M(i.$$.fragment,s),r=!1},d(s){s&&S(t),K(i,s)}}}function xd(n){let e,t;return e=new cl({props:{item:n[14]}}),{c(){W(e.$$.fragment)},m(i,r){z(e,i,r),t=!0},p(i,r){const s={};r&16384&&(s.item=i[14]),e.$set(s)},i(i){t||(P(e.$$.fragment,i),t=!0)},o(i){M(e.$$.fragment,i),t=!1},d(i){K(e,i)}}}function Jd(n){let e,t,i;return t=new qt({props:{item:n[14],height:"full",isInModal:!0,selectable:!1}}),{c(){e=b("div"),W(t.$$.fragment),p(e,"class","modal-region svelte-jba7xn")},m(r,s){E(r,e,s),z(t,e,null),i=!0},p(r,s){const l={};s&16384&&(l.item=r[14]),t.$set(l)},i(r){i||(P(t.$$.fragment,r),i=!0)},o(r){M(t.$$.fragment,r),i=!1},d(r){r&&S(e),K(t)}}}function Xd(n){let e,t,i,r;const s=[Jd,xd],l=[];function o(a,c){return a[15]==="region"?0:a[15]==="page"?1:-1}return~(e=o(n))&&(t=l[e]=s[e](n)),{c(){t&&t.c(),i=me()},m(a,c){~e&&l[e].m(a,c),E(a,i,c),r=!0},p(a,c){let u=e;e=o(a),e===u?~e&&l[e].p(a,c):(t&&(be(),M(l[u],1,1,()=>{l[u]=null}),we()),~e?(t=l[e],t?t.p(a,c):(t=l[e]=s[e](a),t.c()),P(t,1),t.m(i.parentNode,i)):t=null)},i(a){r||(P(t),r=!0)},o(a){M(t),r=!1},d(a){~e&&l[e].d(a),a&&S(i)}}}function Qd(n){let e,t;return e=new Ll({props:{tabs:n[7],$$slots:{default:[Xd,({activeTab:i})=>({15:i}),({activeTab:i})=>i?32768:0]},$$scope:{ctx:n}}}),{c(){W(e.$$.fragment)},m(i,r){z(e,i,r),t=!0},p(i,r){const s={};r&128&&(s.tabs=i[7]),r&573440&&(s.$$scope={dirty:r,ctx:i}),e.$set(s)},i(i){t||(P(e.$$.fragment,i),t=!0)},o(i){M(e.$$.fragment,i),t=!1},d(i){K(e,i)}}}function Zd(n){let e=[],t=new Map,i,r,s,l,o,a=Object.values(n[1]);const c=h=>h[16].id;for(let h=0;h<a.length;h+=1){let m=fs(n,a,h),g=c(m);t.set(g,e[h]=ds(g,m))}function u(h){n[12](h)}function d(h){n[13](h)}let f={items:n[1],$$slots:{default:[Qd,({item:h})=>({14:h}),({item:h})=>h?16384:0]},$$scope:{ctx:n}};return n[6]!==void 0&&(f.currentIndex=n[6]),n[5]!==void 0&&(f.open=n[5]),r=new yi({props:f}),dt.push(()=>jt(r,"currentIndex",u)),dt.push(()=>jt(r,"open",d)),r.$on("navigate",n[11]),{c(){for(let h=0;h<e.length;h+=1)e[h].c();i=N(),W(r.$$.fragment)},m(h,m){for(let g=0;g<e.length;g+=1)e[g]&&e[g].m(h,m);E(h,i,m),z(r,h,m),o=!0},p(h,[m]){m&1311&&(a=Object.values(h[1]),be(),e=un(e,m,c,1,h,a,t,i.parentNode,Rn,ds,i,fs),we());const g={};m&2&&(g.items=h[1]),m&540800&&(g.$$scope={dirty:m,ctx:h}),!s&&m&64&&(s=!0,g.currentIndex=h[6],Nt(()=>s=!1)),!l&&m&32&&(l=!0,g.open=h[5],Nt(()=>l=!1)),r.$set(g)},i(h){if(!o){for(let m=0;m<a.length;m+=1)P(e[m]);P(r.$$.fragment,h),o=!0}},o(h){for(let m=0;m<e.length;m+=1)M(e[m]);M(r.$$.fragment,h),o=!1},d(h){for(let m=0;m<e.length;m+=1)e[m].d(h);h&&S(i),K(r,h)}}}function eh(n,e,t){let i,r,{selectionStore:s=_t}=e;const{isSelected:l}=s;ue(n,l,w=>t(8,r=w));let{items:o=[]}=e,{height:a=96}=e,{selectable:c=!0}=e,{copyable:u=!0}=e,d=!1,f=0;const h=w=>{t(6,f=w.detail.index??0),t(5,d=!0)},m=w=>{t(6,f=w.detail.index)};function g(w){f=w,t(6,f)}function v(w){d=w,t(5,d)}return n.$$set=w=>{"selectionStore"in w&&t(0,s=w.selectionStore),"items"in w&&t(1,o=w.items),"height"in w&&t(2,a=w.height),"selectable"in w&&t(3,c=w.selectable),"copyable"in w&&t(4,u=w.copyable)},t(7,i=[{id:"region",label:U==="en"?"Main view":"Vue principale"},{id:"page",label:U==="en"?"Page View":"Vue de la page"}]),[s,o,a,c,u,d,f,i,r,l,h,m,g,v]}class Dl extends ce{constructor(e){super(),ae(this,e,eh,Zd,le,{selectionStore:0,items:1,height:2,selectable:3,copyable:4})}}function hs(n,e,t){const i=n.slice();return i[10]=e[t][0],i[11]=e[t][1],i}function th(n){let e,t=U==="en"?`Error when retrieving paginated regions: ${n[14]}`:`Erreur de récupération des pages : ${n[14]}`,i;return{c(){e=b("tr"),i=G(t),p(e,"class","faded is-center")},m(r,s){E(r,e,s),_(e,i)},p(r,s){s&1&&t!==(t=U==="en"?`Error when retrieving paginated regions: ${r[14]}`:`Erreur de récupération des pages : ${r[14]}`)&&de(i,t)},i:j,o:j,d(r){r&&S(e)}}}function nh(n){let e,t,i,r,s;const l=[rh,ih],o=[];function a(c,u){return u&2&&(e=null),e==null&&(e=Object.values(c[1]).length>0),e?0:1}return t=a(n,-1),i=o[t]=l[t](n),{c(){i.c(),r=me()},m(c,u){o[t].m(c,u),E(c,r,u),s=!0},p(c,u){let d=t;t=a(c,u),t===d?o[t].p(c,u):(be(),M(o[d],1,1,()=>{o[d]=null}),we(),i=o[t],i?i.p(c,u):(i=o[t]=l[t](c),i.c()),P(i,1),i.m(r.parentNode,r))},i(c){s||(P(i),s=!0)},o(c){M(i),s=!1},d(c){o[t].d(c),c&&S(r)}}}function ih(n){let e,t,i;return t=new Xs({}),{c(){e=b("tr"),W(t.$$.fragment)},m(r,s){E(r,e,s),z(t,e,null),i=!0},p:j,i(r){i||(P(t.$$.fragment,r),i=!0)},o(r){M(t.$$.fragment,r),i=!1},d(r){r&&S(e),K(t)}}}function rh(n){let e,t,i=Object.entries(n[1]),r=[];for(let l=0;l<i.length;l+=1)r[l]=ms(hs(n,i,l));const s=l=>M(r[l],1,1,()=>{r[l]=null});return{c(){for(let l=0;l<r.length;l+=1)r[l].c();e=me()},m(l,o){for(let a=0;a<r.length;a+=1)r[a]&&r[a].m(l,o);E(l,e,o),t=!0},p(l,o){if(o&98){i=Object.entries(l[1]);let a;for(a=0;a<i.length;a+=1){const c=hs(l,i,a);r[a]?(r[a].p(c,o),P(r[a],1)):(r[a]=ms(c),r[a].c(),P(r[a],1),r[a].m(e.parentNode,e))}for(be(),a=i.length;a<r.length;a+=1)s(a);we()}},i(l){if(!t){for(let o=0;o<i.length;o+=1)P(r[o]);t=!0}},o(l){r=r.filter(Boolean);for(let o=0;o<r.length;o+=1)M(r[o]);t=!1},d(l){it(r,l),l&&S(e)}}}function sh(n){let e,t,i,r,s,l,o,a,c=n[10]+"",u,d,f;return{c(){e=b("img"),r=N(),s=b("div"),l=b("a"),o=b("i"),a=G(`
                                Page `),u=G(c),f=N(),Re(e.src,t=nt(n[5](n[10]),"full","250,"))||p(e,"src",t),p(e,"alt",i="Canvas "+n[10]),p(e,"class","mb-3 card"),p(o,"class","fa-solid fa-pen-to-square"),p(l,"class","tag px-2 py-1 is-rounded is-hoverable"),p(l,"href",d=Ft(n[6],n[10])),p(l,"target","_blank"),p(s,"class","is-center mb-1")},m(h,m){E(h,e,m),E(h,r,m),E(h,s,m),_(s,l),_(l,o),_(l,a),_(l,u),E(h,f,m)},p(h,m){m&2&&!Re(e.src,t=nt(h[5](h[10]),"full","250,"))&&p(e,"src",t),m&2&&i!==(i="Canvas "+h[10])&&p(e,"alt",i),m&2&&c!==(c=h[10]+"")&&de(u,c),m&2&&d!==(d=Ft(h[6],h[10]))&&p(l,"href",d)},d(h){h&&S(e),h&&S(r),h&&S(s),h&&S(f)}}}function lh(n){let e,t,i;return e=new Dl({props:{items:Object.values(n[11])}}),{c(){W(e.$$.fragment),t=N()},m(r,s){z(e,r,s),E(r,t,s),i=!0},p(r,s){const l={};s&2&&(l.items=Object.values(r[11])),e.$set(l)},i(r){i||(P(e.$$.fragment,r),i=!0)},o(r){M(e.$$.fragment,r),i=!1},d(r){K(e,r),r&&S(t)}}}function ms(n){let e,t;return e=new $l({props:{$$slots:{"row-body":[lh],"row-header":[sh]},$$scope:{ctx:n}}}),{c(){W(e.$$.fragment)},m(i,r){z(e,i,r),t=!0},p(i,r){const s={};r&32770&&(s.$$scope={dirty:r,ctx:i}),e.$set(s)},i(i){t||(P(e.$$.fragment,i),t=!0)},o(i){M(e.$$.fragment,i),t=!1},d(i){K(e,i)}}}function oh(n){let e;return{c(){e=b("tr"),e.textContent=`${U==="en"?"Retrieving paginated regions...":"Récupération des pages..."}`,p(e,"class","faded is-center")},m(t,i){E(t,e,i)},p:j,i:j,o:j,d(t){t&&S(e)}}}function ah(n){let e,t,i,r={ctx:n,current:null,token:null,hasCatch:!0,pending:oh,then:nh,catch:th,value:9,error:14,blocks:[,,,]};return tt(t=n[0],r),{c(){e=me(),r.block.c()},m(s,l){E(s,e,l),r.block.m(s,r.anchor=l),r.mount=()=>e.parentNode,r.anchor=e,i=!0},p(s,l){n=s,r.ctx=n,l&1&&t!==(t=n[0])&&tt(t,r)||At(r,n,l)},i(s){i||(P(r.block),i=!0)},o(s){for(let l=0;l<3;l+=1){const o=r.blocks[l];M(o)}i=!1},d(s){s&&S(e),r.block.d(s),r.token=null,r=null}}}function ch(n){let e,t,i,r,s,l;return e=new Ht({props:{store:wt,nbOfItems:n[4]}}),i=new Dn({props:{$$slots:{default:[ah]},$$scope:{ctx:n}}}),s=new Ht({props:{store:wt,nbOfItems:n[4]}}),{c(){W(e.$$.fragment),t=N(),W(i.$$.fragment),r=N(),W(s.$$.fragment)},m(o,a){z(e,o,a),E(o,t,a),z(i,o,a),E(o,r,a),z(s,o,a),l=!0},p(o,[a]){const c={};a&32771&&(c.$$scope={dirty:a,ctx:o}),i.$set(c)},i(o){l||(P(e.$$.fragment,o),P(i.$$.fragment,o),P(s.$$.fragment,o),l=!0)},o(o){M(e.$$.fragment,o),M(i.$$.fragment,o),M(s.$$.fragment,o),l=!1},d(o){K(e,o),o&&S(t),K(i,o),o&&S(r),K(s,o)}}}function uh(n,e,t){let i,r;const{pageRegions:s,fetchPages:l}=wt;ue(n,s,f=>t(1,r=f)),ue(n,l,f=>t(0,i=f));const o=De("nbOfPages"),a=De("trailingZeros"),c=(f,h)=>f.toString().padStart(h,"0");function u(f){return`${imgPrefix}_${c(f,a)}`}const d=De("manifest");return[i,r,s,l,o,u,d]}class fh extends ce{constructor(e){super(),ae(this,e,uh,ch,le,{})}}function dh(n){let e,t,i,r,s=U==="en"?"Save selection":"Sauvegarder la sélection",l,o,a;return{c(){e=b("button"),t=b("span"),i=b("i"),r=N(),l=G(s),p(i,"class","fa-solid fa-floppy-disk"),p(e,"class","button is-link")},m(c,u){E(c,e,u),_(e,t),_(t,i),_(t,r),_(t,l),o||(a=ne(e,"click",n[7]),o=!0)},p:j,d(c){c&&S(e),o=!1,a()}}}function hh(n){let e,t,i,r,s=U==="en"?"Go to treatment":"Accéder au traitement",l,o;return{c(){var a;e=b("a"),t=b("span"),i=b("i"),r=N(),l=G(s),p(i,"class","fa-solid fa-gear"),p(e,"class","button is-link"),p(e,"href",o="/"+Ue+"/treatment/add/?document_set="+((a=n[3])==null?void 0:a.id))},m(a,c){E(a,e,c),_(e,t),_(t,i),_(t,r),_(t,l)},p(a,c){var u;c&8&&o!==(o="/"+Ue+"/treatment/add/?document_set="+((u=a[3])==null?void 0:u.id))&&p(e,"href",o)},d(a){a&&S(e)}}}function ps(n){let e,t,i,r,s,l,o;return{c(){var a,c;e=b("a"),t=b("span"),t.innerHTML='<i class="fa-solid fa-file-export"></i> JSON',r=N(),s=b("a"),l=b("span"),l.innerHTML='<i class="fa-solid fa-file-zipper"></i> ZIP',p(e,"class","button is-link is-dark"),p(e,"href",i="/"+Ue+"/document-set/"+((a=n[3])==null?void 0:a.id)+"/json"),p(e,"target","_blank"),p(s,"class","button is-link is-dark"),p(s,"href",o="/"+Ue+"/document-set/"+((c=n[3])==null?void 0:c.id)+"/zip"),p(s,"target","_blank")},m(a,c){E(a,e,c),_(e,t),E(a,r,c),E(a,s,c),_(s,l)},p(a,c){var u,d;c&8&&i!==(i="/"+Ue+"/document-set/"+((u=a[3])==null?void 0:u.id)+"/json")&&p(e,"href",i),c&8&&o!==(o="/"+Ue+"/document-set/"+((d=a[3])==null?void 0:d.id)+"/zip")&&p(s,"href",o)},d(a){a&&S(e),a&&S(r),a&&S(s)}}}function mh(n){let e,t,i,r,s,l,o;function a(f,h){return f[2]&&!f[1]?hh:dh}let c=a(n),u=c(n),d=!n[1]&&ps(n);return{c(){e=b("footer"),t=b("div"),i=b("button"),i.textContent=`${U==="en"?"Clear selection":"Vider la sélection"}`,r=N(),u.c(),s=N(),d&&d.c(),p(i,"class","button button-close is-link is-light"),p(t,"class","buttons"),p(e,"class","modal-card-foot is-center")},m(f,h){E(f,e,h),_(e,t),_(t,i),_(t,r),u.m(t,null),_(t,s),d&&d.m(t,null),l||(o=ne(i,"click",n[6]),l=!0)},p(f,[h]){c===(c=a(f))&&u?u.p(f,h):(u.d(1),u=c(f),u&&(u.c(),u.m(t,s))),f[1]?d&&(d.d(1),d=null):d?d.p(f,h):(d=ps(f),d.c(),d.m(t,null))},i:j,o:j,d(f){f&&S(e),u.d(),d&&d.d(),l=!1,o()}}}function ph(n,e,t){let i,r,{selectionStore:s}=e;const{isSaved:l,selection:o}=s;ue(n,l,d=>t(2,i=d)),ue(n,o,d=>t(3,r=d));let{isRegion:a=s.type!=="documentSet"}=e;const c=()=>s.empty(),u=()=>s.save();return n.$$set=d=>{"selectionStore"in d&&t(0,s=d.selectionStore),"isRegion"in d&&t(1,a=d.isRegion)},[s,a,i,r,l,o,c,u]}class gh extends ce{constructor(e){super(),ae(this,e,ph,mh,le,{selectionStore:0,isRegion:1})}}function gs(n,e,t){const i=n.slice();return i[31]=e[t],i}function _s(n,e,t){const i=n.slice();return i[31]=e[t],i}function _h(n){let e,t,i,r,s,l;return{c(){e=b("span"),t=G(n[10]),i=N(),r=b("span"),r.innerHTML='<i class="fas fa-edit"></i>',p(r,"class","pl-3 smaller has-text-link")},m(o,a){E(o,e,a),_(e,t),_(e,i),_(e,r),s||(l=[ne(e,"click",n[14]),ne(e,"keyup",null)],s=!0)},p(o,a){a[0]&1024&&de(t,o[10])},d(o){o&&S(e),s=!1,Ce(l)}}}function vh(n){let e,t,i;return{c(){e=b("input"),p(e,"class","input selection-title svelte-fumu7c")},m(r,s){E(r,e,s),n[23](e),Dt(e,n[5]),t||(i=[ne(e,"input",n[24]),ne(e,"keydown",n[15]),ne(e,"blur",n[16])],t=!0)},p(r,s){s[0]&32&&e.value!==r[5]&&Dt(e,r[5])},d(r){r&&S(e),n[23](null),t=!1,Ce(i)}}}function vs(n){let e,t,i;function r(){return n[25](n[31])}return{c(){e=b("button"),p(e,"class","tag is-delete is-link ml-0")},m(s,l){E(s,e,l),t||(i=ne(e,"click",r),t=!0)},p(s,l){n=s},d(s){s&&S(e),t=!1,i()}}}function bs(n,e){let t,i,r=e[31].username+"",s,l,o,a=e[9]&&vs(e);return{key:n,first:null,c(){t=b("div"),i=b("span"),s=G(r),l=N(),a&&a.c(),o=N(),p(i,"class","tag"),p(t,"class","tags has-addons svelte-fumu7c"),this.first=t},m(c,u){E(c,t,u),_(t,i),_(i,s),_(t,l),a&&a.m(t,null),_(t,o)},p(c,u){e=c,u[0]&256&&r!==(r=e[31].username+"")&&de(s,r),e[9]?a?a.p(e,u):(a=vs(e),a.c(),a.m(t,o)):a&&(a.d(1),a=null)},d(c){c&&S(t),a&&a.d()}}}function ws(n){let e,t,i,r,s,l,o,a,c,u,d,f,h,m,g=U==="en"?"Make public":"Rendre public",v,w,I,R=n[7].length>0&&ys(n);return{c(){var C;e=b("div"),t=b("div"),i=b("div"),r=b("p"),s=b("input"),l=N(),o=b("span"),o.innerHTML='<i class="fas fa-search"></i>',a=N(),R&&R.c(),c=N(),u=b("div"),d=b("label"),f=b("input"),m=N(),v=G(g),p(s,"class","input svelte-fumu7c"),p(s,"placeholder","Search users…"),p(o,"class","icon is-small is-right"),p(r,"class","control is-expanded has-icons-right"),p(i,"class","field"),p(t,"class","dropdown-trigger"),p(e,"class","dropdown is-active"),p(f,"type","checkbox"),f.checked=h=(C=n[2])==null?void 0:C.is_public,p(d,"class","checkbox"),p(u,"class","field mt-3 is-right")},m(C,O){E(C,e,O),_(e,t),_(t,i),_(i,r),_(r,s),Dt(s,n[6]),_(r,l),_(r,o),_(e,a),R&&R.m(e,null),E(C,c,O),E(C,u,O),_(u,d),_(d,f),_(d,m),_(d,v),w||(I=[ne(s,"input",n[26]),ne(s,"input",n[17]),ne(f,"change",n[28])],w=!0)},p(C,O){var L;O[0]&64&&s.value!==C[6]&&Dt(s,C[6]),C[7].length>0?R?R.p(C,O):(R=ys(C),R.c(),R.m(e,null)):R&&(R.d(1),R=null),O[0]&4&&h!==(h=(L=C[2])==null?void 0:L.is_public)&&(f.checked=h)},d(C){C&&S(e),R&&R.d(),C&&S(c),C&&S(u),w=!1,Ce(I)}}}function ys(n){let e,t,i=n[7],r=[];for(let s=0;s<i.length;s+=1)r[s]=ks(gs(n,i,s));return{c(){e=b("div"),t=b("div");for(let s=0;s<r.length;s+=1)r[s].c();p(t,"class","dropdown-content"),p(e,"class","dropdown-menu"),p(e,"id","dropdown-menu"),p(e,"role","menu")},m(s,l){E(s,e,l),_(e,t);for(let o=0;o<r.length;o+=1)r[o]&&r[o].m(t,null)},p(s,l){if(l[0]&262272){i=s[7];let o;for(o=0;o<i.length;o+=1){const a=gs(s,i,o);r[o]?r[o].p(a,l):(r[o]=ks(a),r[o].c(),r[o].m(t,null))}for(;o<r.length;o+=1)r[o].d(1);r.length=i.length}},d(s){s&&S(e),it(r,s)}}}function ks(n){let e,t=n[31].username+"",i,r,s,l;function o(){return n[27](n[31])}return{c(){e=b("div"),i=G(t),r=N(),p(e,"class","dropdown-item")},m(a,c){E(a,e,c),_(e,i),_(e,r),s||(l=[ne(e,"click",o),ne(e,"keydown",null)],s=!0)},p(a,c){n=a,c[0]&128&&t!==(t=n[31].username+"")&&de(i,t)},d(a){a&&S(e),s=!1,Ce(l)}}}function bh(n){let e,t,i,r,s,l,o,a,c,u,d,f,h,m,g,v,w,I,R,C=[],O=new Map,L,A,y,D,Z,se;function V(ee,pe){return ee[3]?vh:_h}let te=V(n),X=te(n);const H=n[22].default,q=qe(H,n,n[21],null);let re=n[8];const F=ee=>ee[31].id;for(let ee=0;ee<re.length;ee+=1){let pe=_s(n,re,ee),ye=F(pe);O.set(ye,C[ee]=bs(ye,pe))}let Y=n[9]&&ws(n);return y=new gh({props:{selectionStore:n[0]}}),{c(){e=b("div"),t=b("div"),i=N(),r=b("div"),s=b("div"),l=b("div"),o=b("i"),a=N(),X.c(),c=G(`

                (`),u=G(n[1]),d=G(")"),f=N(),h=b("button"),m=N(),g=b("section"),q&&q.c(),v=N(),w=b("h4"),w.textContent=`${U==="en"?"Shared with":"Partagé avec"}`,I=N(),R=b("div");for(let ee=0;ee<C.length;ee+=1)C[ee].c();L=N(),Y&&Y.c(),A=N(),W(y.$$.fragment),p(t,"class","modal-background"),p(o,"class","fa-solid fa-book-bookmark"),p(l,"class","title is-4 mb-0 media-content"),p(h,"class","delete media-left"),p(h,"aria-label","close"),p(s,"class","modal-card-head media mb-0 is-middle"),p(R,"class","field is-grouped is-grouped-multiline"),p(g,"class","modal-card-body"),p(r,"class","modal-content"),p(e,"id","selection-modal"),p(e,"class","modal fade"),p(e,"tabindex","-1"),p(e,"aria-labelledby","selection-modal-label"),p(e,"aria-hidden","true")},m(ee,pe){E(ee,e,pe),_(e,t),_(e,i),_(e,r),_(r,s),_(s,l),_(l,o),_(l,a),X.m(l,null),_(l,c),_(l,u),_(l,d),_(s,f),_(s,h),_(r,m),_(r,g),q&&q.m(g,null),_(g,v),_(g,w),_(g,I),_(g,R);for(let ye=0;ye<C.length;ye+=1)C[ye]&&C[ye].m(R,null);_(g,L),Y&&Y.m(g,null),_(r,A),z(y,r,null),D=!0,Z||(se=In(Ys.call(null,e)),Z=!0)},p(ee,pe){te===(te=V(ee))&&X?X.p(ee,pe):(X.d(1),X=te(ee),X&&(X.c(),X.m(l,c))),(!D||pe[0]&2)&&de(u,ee[1]),q&&q.p&&(!D||pe[0]&2097152)&&ze(q,H,ee,ee[21],D?Be(H,ee[21],pe,null):Ke(ee[21]),null),pe[0]&525056&&(re=ee[8],C=un(C,pe,F,1,ee,re,O,R,bo,bs,null,_s)),ee[9]?Y?Y.p(ee,pe):(Y=ws(ee),Y.c(),Y.m(g,null)):Y&&(Y.d(1),Y=null);const ye={};pe[0]&1&&(ye.selectionStore=ee[0]),y.$set(ye)},i(ee){D||(P(q,ee),P(y.$$.fragment,ee),D=!0)},o(ee){M(q,ee),M(y.$$.fragment,ee),D=!1},d(ee){ee&&S(e),X.d(),q&&q.d(ee);for(let pe=0;pe<C.length;pe+=1)C[pe].d();Y&&Y.d(),K(y),Z=!1,se()}}}function wh(n,e,t){let i,r,s,l,o,{$$slots:a={},$$scope:c}=e;const{selected:u}=Ro;ue(n,u,F=>t(2,l=F));let{selectionStore:d}=e,{selectionLength:f=!1}=e;const{selectionTitle:h,updateTitle:m,updatePublic:g,save:v}=d;ue(n,h,F=>t(10,o=F));let w=!1,I,R;function C(){t(3,w=!0),t(5,R=o),setTimeout(()=>I==null?void 0:I.focus(),0)}function O(F){F.key==="Enter"&&L()}function L(){t(3,w=!1),m(R),v()}let A="",y=[];async function D(){if(A.trim().length<1){t(7,y=[]);return}const Y=await(await fetch(`${window.location.origin}/search/user?q=${encodeURIComponent(A)}`)).json();t(7,y=Y.users||[])}function Z(F){d.add({id:F.id,class:"User",title:F.username}),t(6,A=""),t(7,y=[])}function se(F){d.remove(F,"User")}function V(F){dt[F?"unshift":"push"](()=>{I=F,t(4,I)})}function te(){R=this.value,t(5,R)}const X=F=>se(F.id);function H(){A=this.value,t(6,A)}const q=F=>Z(F),re=F=>g(F.target.checked);return n.$$set=F=>{"selectionStore"in F&&t(0,d=F.selectionStore),"selectionLength"in F&&t(1,f=F.selectionLength),"$$scope"in F&&t(21,c=F.$$scope)},n.$$.update=()=>{n.$$.dirty[0]&4&&t(20,i=l==null?void 0:l.owner_id),n.$$.dirty[0]&1048576&&t(9,r=So||i===En),n.$$.dirty[0]&4&&t(8,s=Object.entries((l==null?void 0:l.User)||{}).map(([F,Y])=>({id:Number(F),username:Y.title})))},[d,f,l,w,I,R,A,y,s,r,o,u,h,g,C,O,L,D,Z,se,i,c,a,V,te,X,H,q,re]}class yh extends ce{constructor(e){super(),ae(this,e,wh,bh,le,{selectionStore:0,selectionLength:1},null,[-1,-1])}}function kh(){const n=`${window.location.origin}${window.location.pathname}`,e=49,t=Oe(1),i=Oe([]),r=Oe([]),s=(async()=>{const u=await fetch(`${n}vectorized-images`).then(d=>d.json()).then(d=>(i.set(d),d)).catch(d=>console.error("Error:",d));return c(l()),u})(),l=()=>gi(t,"vp"),o=xe(t,u=>(async()=>a(u))());function a(u){const d=(u-1)*e,f=d+e,h=hi(i).slice(d,f);return r.set(h),h}function c(u){_i(u,t,"vp")}return{currentPage:t,pageLength:e,vectImgs:i,fetchVectorization:s,setPageVectImgs:o,pageVectImgs:r,handlePageUpdate:c}}const $n=kh();const Sh=n=>({}),Ss=n=>({});function Es(n){let e,t;return{c(){e=new oo(!1),t=me(),e.a=t},m(i,r){e.m(n[4],i,r),E(i,t,r)},p(i,r){r&16&&e.p(i[4])},d(i){i&&S(t),i&&e.d()}}}function Eh(n){let e,t,i,r,s,l,o,a,c,u,d,f,h,m,g,v,w,I=!n[5]&&n[4]&&Es(n);const R=n[10].actions,C=qe(R,n,n[9],Ss);return{c(){e=b("div"),t=b("figure"),i=b("div"),I&&I.c(),r=N(),s=b("img"),o=N(),a=b("div"),c=b("a"),u=b("i"),d=N(),f=b("span"),f.textContent=`${U==="en"?"Download SVG":"Télécharger le SVG"}`,h=N(),C&&C.c(),p(i,"class","svg-container svelte-c6s83q"),p(s,"class","region-img svelte-c6s83q"),Re(s.src,l=n[8])||p(s,"src",l),p(s,"alt","Extracted region"),p(t,"class","image card region-image svelte-c6s83q"),ge(t,"width",n[2]?"50%":`${n[1]}px`),ge(t,"aspect-ratio",n[6]?n[6].split(" ")[2]/n[6].split(" ")[3]:1),p(u,"class","fa-solid fa-download"),p(f,"class","tooltip"),p(c,"class","button tag svelte-c6s83q"),p(c,"href",n[7]),p(c,"download",n[0]),p(a,"class","region-btn ml-1"),p(e,"class","region is-center"),ke(e,"checked",n[3])},m(O,L){E(O,e,L),_(e,t),_(t,i),I&&I.m(i,null),_(t,r),_(t,s),_(e,o),_(e,a),_(a,c),_(c,u),_(c,d),_(c,f),_(a,h),C&&C.m(a,null),g=!0,v||(w=[ne(t,"click",n[11]),ne(t,"keyup",n[12]),ne(t,"mouseenter",n[13]),ne(t,"mouseleave",n[14])],v=!0)},p(O,[L]){!O[5]&&O[4]?I?I.p(O,L):(I=Es(O),I.c(),I.m(i,null)):I&&(I.d(1),I=null),(!g||L&6)&&ge(t,"width",O[2]?"50%":`${O[1]}px`),(!g||L&64)&&ge(t,"aspect-ratio",O[6]?O[6].split(" ")[2]/O[6].split(" ")[3]:1),(!g||L&128)&&p(c,"href",O[7]),(!g||L&1)&&p(c,"download",O[0]),C&&C.p&&(!g||L&512)&&ze(C,R,O,O[9],g?Be(R,O[9],L,Sh):Ke(O[9]),Ss),(!g||L&8)&&ke(e,"checked",O[3])},i(O){g||(P(C,O),et(()=>{g&&(m||(m=ot(e,bt,{duration:300},!0)),m.run(1))}),g=!0)},o(O){M(C,O),m||(m=ot(e,bt,{duration:300},!1)),m.run(0),g=!1},d(O){O&&S(e),I&&I.d(),C&&C.d(O),O&&m&&m.end(),v=!1,Ce(w)}}}function Ch(n,e,t){let{$$slots:i={},$$scope:r}=e,{svgPath:s}=e,{width:l=200}=e,{fullWidth:o=!1}=e,{selected:a=!1}=e;const[c,u,d,f]=s.replace(".svg","").split("_"),h=nt(`${c}_${u}_${d}`,f,`${l},`);let m=!1,g="",v="",w="";cn(()=>{w&&URL.revokeObjectURL(w)}),mt(async()=>{const A=await(await fetch(`${Io}svg/${s}`)).text(),D=new DOMParser().parseFromString(A,"image/svg+xml"),Z=D.querySelector("svg");t(6,v=Z.getAttribute("viewBox")||`0 0 ${Z.getAttribute("width")} ${Z.getAttribute("height")}`),D.querySelectorAll("image").forEach(se=>se.remove()),Z.setAttribute("viewBox",v),Z.removeAttribute("width"),Z.removeAttribute("height"),t(4,g=new XMLSerializer().serializeToString(D.documentElement))});function I(L){Tn.call(this,n,L)}function R(L){Tn.call(this,n,L)}const C=()=>t(5,m=!0),O=()=>t(5,m=!1);return n.$$set=L=>{"svgPath"in L&&t(0,s=L.svgPath),"width"in L&&t(1,l=L.width),"fullWidth"in L&&t(2,o=L.fullWidth),"selected"in L&&t(3,a=L.selected),"$$scope"in L&&t(9,r=L.$$scope)},n.$$.update=()=>{if(n.$$.dirty&16&&g){const L=new Blob([g],{type:"image/svg+xml"});t(7,w=URL.createObjectURL(L))}},[s,l,o,a,g,m,v,w,h,r,i,I,R,C,O]}class Nl extends ce{constructor(e){super(),ae(this,e,Ch,Eh,le,{svgPath:0,width:1,fullWidth:2,selected:3})}}function Cs(n,e,t){const i=n.slice();return i[15]=e[t],i[17]=t,i}function Ih(n){let e;function t(s,l){return U==="en"?Ah:Oh}let r=t()(n);return{c(){e=b("div"),r.c(),p(e,"class","faded is-center")},m(s,l){E(s,e,l),r.m(e,null)},p(s,l){r.p(s,l)},i:j,o:j,d(s){s&&S(e),r.d()}}}function Oh(n){let e,t=n[18]+"",i;return{c(){e=G("Erreur lors de la récupération des régions vectorisées : "),i=G(t)},m(r,s){E(r,e,s),E(r,i,s)},p(r,s){s&8&&t!==(t=r[18]+"")&&de(i,t)},d(r){r&&S(e),r&&S(i)}}}function Ah(n){let e,t=n[18]+"",i;return{c(){e=G("Error when retrieving vectorized regions: "),i=G(t)},m(r,s){E(r,e,s),E(r,i,s)},p(r,s){s&8&&t!==(t=r[18]+"")&&de(i,t)},d(r){r&&S(e),r&&S(i)}}}function Th(n){let e=[],t=new Map,i,r,s,l,o,a=n[4];const c=m=>m[15].id;for(let m=0;m<a.length;m+=1){let g=Cs(n,a,m),v=c(g);t.set(v,e[m]=Os(v,g))}let u=null;a.length||(u=Is());function d(m){n[11](m)}function f(m){n[12](m)}let h={items:n[4],$$slots:{default:[Lh,({item:m})=>({14:m}),({item:m})=>m?16384:0]},$$scope:{ctx:n}};return n[1]!==void 0&&(h.currentIndex=n[1]),n[0]!==void 0&&(h.open=n[0]),r=new yi({props:h}),dt.push(()=>jt(r,"currentIndex",d)),dt.push(()=>jt(r,"open",f)),{c(){for(let m=0;m<e.length;m+=1)e[m].c();u&&u.c(),i=N(),W(r.$$.fragment)},m(m,g){for(let v=0;v<e.length;v+=1)e[v]&&e[v].m(m,g);u&&u.m(m,g),E(m,i,g),z(r,m,g),o=!0},p(m,g){g&528&&(a=m[4],be(),e=un(e,g,c,1,m,a,t,i.parentNode,Rn,Os,i,Cs),we(),!a.length&&u?u.p(m,g):a.length?u&&(u.d(1),u=null):(u=Is(),u.c(),u.m(i.parentNode,i)));const v={};g&16&&(v.items=m[4]),g&540672&&(v.$$scope={dirty:g,ctx:m}),!s&&g&2&&(s=!0,v.currentIndex=m[1],Nt(()=>s=!1)),!l&&g&1&&(l=!0,v.open=m[0],Nt(()=>l=!1)),r.$set(v)},i(m){if(!o){for(let g=0;g<a.length;g+=1)P(e[g]);P(r.$$.fragment,m),o=!0}},o(m){for(let g=0;g<e.length;g+=1)M(e[g]);M(r.$$.fragment,m),o=!1},d(m){for(let g=0;g<e.length;g+=1)e[g].d(m);u&&u.d(m),m&&S(i),K(r,m)}}}function Is(n){let e;return{c(){e=b("div"),e.textContent=`${U==="en"?"No vectorization":"Pas de vectorisation"}`,p(e,"class","faded is-center")},m(t,i){E(t,e,i)},p:j,d(t){t&&S(e)}}}function Ph(n){let e,t;function i(){return n[10](n[17])}return e=new al({}),e.$on("open",i),{c(){W(e.$$.fragment)},m(r,s){z(e,r,s),t=!0},p(r,s){n=r},i(r){t||(P(e.$$.fragment,r),t=!0)},o(r){M(e.$$.fragment,r),t=!1},d(r){K(e,r)}}}function Os(n,e){let t,i,r;return i=new Nl({props:{svgPath:e[15],$$slots:{default:[Ph]},$$scope:{ctx:e}}}),{key:n,first:null,c(){t=me(),W(i.$$.fragment),this.first=t},m(s,l){E(s,t,l),z(i,s,l),r=!0},p(s,l){e=s;const o={};l&16&&(o.svgPath=e[15]),l&524304&&(o.$$scope={dirty:l,ctx:e}),i.$set(o)},i(s){r||(P(i.$$.fragment,s),r=!0)},o(s){M(i.$$.fragment,s),r=!1},d(s){s&&S(t),K(i,s)}}}function Lh(n){let e,t;return e=new Nl({props:{svgPath:n[14],fullWidth:!0}}),{c(){W(e.$$.fragment)},m(i,r){z(e,i,r),t=!0},p(i,r){const s={};r&16384&&(s.svgPath=i[14]),e.$set(s)},i(i){t||(P(e.$$.fragment,i),t=!0)},o(i){M(e.$$.fragment,i),t=!1},d(i){K(e,i)}}}function Mh(n){let e;return{c(){e=b("div"),e.textContent=`${U==="en"?"Retrieving vectorization page...":"Récupération la page de vectorisation..."}`,p(e,"class","faded is-center")},m(t,i){E(t,e,i)},p:j,i:j,o:j,d(t){t&&S(e)}}}function $h(n){let e,t,i,r,s,l,o;e=new Ht({props:{store:$n,nbOfItems:n[2].length,pageLength:n[8]}});let a={ctx:n,current:null,token:null,hasCatch:!0,pending:Mh,then:Th,catch:Ih,value:13,error:18,blocks:[,,,]};return tt(r=n[3],a),l=new Ht({props:{store:$n,nbOfItems:n[2].length,pageLength:n[8]}}),{c(){W(e.$$.fragment),t=N(),i=b("div"),a.block.c(),s=N(),W(l.$$.fragment),p(i,"class","grid is-gap-2 mx-5 svelte-1mje9rl")},m(c,u){z(e,c,u),E(c,t,u),E(c,i,u),a.block.m(i,a.anchor=null),a.mount=()=>i,a.anchor=null,E(c,s,u),z(l,c,u),o=!0},p(c,[u]){n=c;const d={};u&4&&(d.nbOfItems=n[2].length),e.$set(d),a.ctx=n,u&8&&r!==(r=n[3])&&tt(r,a)||At(a,n,u);const f={};u&4&&(f.nbOfItems=n[2].length),l.$set(f)},i(c){o||(P(e.$$.fragment,c),P(a.block),P(l.$$.fragment,c),o=!0)},o(c){M(e.$$.fragment,c);for(let u=0;u<3;u+=1){const d=a.blocks[u];M(d)}M(l.$$.fragment,c),o=!1},d(c){K(e,c),c&&S(t),c&&S(i),a.block.d(),a.token=null,a=null,c&&S(s),K(l,c)}}}function Rh(n,e,t){let i,r,s;const{vectImgs:l,pageVectImgs:o,setPageVectImgs:a,pageLength:c}=$n;ue(n,l,v=>t(2,i=v)),ue(n,o,v=>t(4,s=v)),ue(n,a,v=>t(3,r=v));let u=!1,d=0;const f=v=>{t(1,d=v),t(0,u=!0)},h=v=>f(v);function m(v){d=v,t(1,d)}function g(v){u=v,t(0,u)}return[u,d,i,r,s,l,o,a,c,f,h,m,g]}class Dh extends ce{constructor(e){super(),ae(this,e,Rh,$h,le,{})}}function Nh(n){let e,t,i={ctx:n,current:null,token:null,hasCatch:!0,pending:Hh,then:Fh,catch:jh,value:1,error:2,blocks:[,,,]};return tt(n[0],i),{c(){e=me(),i.block.c()},m(r,s){E(r,e,s),i.block.m(r,i.anchor=s),i.mount=()=>e.parentNode,i.anchor=e,t=!0},p(r,s){n=r,At(i,n,s)},i(r){t||(P(i.block),t=!0)},o(r){for(let s=0;s<3;s+=1){const l=i.blocks[s];M(l)}t=!1},d(r){r&&S(e),i.block.d(r),i.token=null,i=null}}}function jh(n){let e;function t(s,l){return U==="en"?Uh:Vh}let r=t()(n);return{c(){e=b("div"),r.c(),p(e,"class","container faded is-center")},m(s,l){E(s,e,l),r.m(e,null)},p(s,l){r.p(s,l)},i:j,o:j,d(s){s&&S(e),r.d()}}}function Vh(n){let e,t=n[2]+"",i;return{c(){e=G("Erreur lors de la récupération des régions vectorisées : "),i=G(t)},m(r,s){E(r,e,s),E(r,i,s)},p:j,d(r){r&&S(e),r&&S(i)}}}function Uh(n){let e,t=n[2]+"",i;return{c(){e=G("Error when retrieving vectorized regions: "),i=G(t)},m(r,s){E(r,e,s),E(r,i,s)},p:j,d(r){r&&S(e),r&&S(i)}}}function Fh(n){let e,t;return e=new Dh({}),{c(){W(e.$$.fragment)},m(i,r){z(e,i,r),t=!0},p:j,i(i){t||(P(e.$$.fragment,i),t=!0)},o(i){M(e.$$.fragment,i),t=!1},d(i){K(e,i)}}}function Hh(n){let e;return{c(){e=b("div"),e.textContent=`${U==="en"?"Retrieving vectorized regions...":"Récupération des régions vectorisées..."}`,p(e,"class","container faded is-center")},m(t,i){E(t,e,i)},p:j,i:j,o:j,d(t){t&&S(e)}}}function qh(n){let e=Vt.includes("vectorization"),t,i,r=e&&Nh(n);return{c(){r&&r.c(),t=me()},m(s,l){r&&r.m(s,l),E(s,t,l),i=!0},p(s,[l]){e&&r.p(s,l)},i(s){i||(P(r),i=!0)},o(s){M(r),i=!1},d(s){r&&r.d(s),s&&S(t)}}}function Bh(n){const{fetchVectorization:e}=$n;return[e]}class zh extends ce{constructor(e){super(),ae(this,e,Bh,qh,le,{})}}function Kh(n){let e,t;return{c(){e=b("iframe"),Re(e.src,t=n[0])||p(e,"src",t),ge(e,"width","100%"),ge(e,"height","75vh"),ge(e,"border","none"),p(e,"title","Mirador viewer"),e.allowFullscreen=!0},m(i,r){E(i,e,r)},p(i,[r]){r&1&&!Re(e.src,t=i[0])&&p(e,"src",t)},i:j,o:j,d(i){i&&S(e)}}}function Wh(n,e,t){let i="";return mt(()=>{manifests.length>0&&t(0,i=Ft(manifests[0]));function r(s){t(0,i=Ft(s.detail.selectedManifest))}window.addEventListener("selectManifest",r)}),[i]}class Gh extends ce{constructor(e){super(),ae(this,e,Wh,Kh,le,{})}}function As(n,e,t){const i=n.slice();return i[5]=e[t],i}function Ts(n){let e,t=n[3](n[5])+"",i,r,s;return{c(){e=b("option"),i=G(t),r=N(),e.__value=s=n[5],e.value=e.__value},m(l,o){E(l,e,o),_(e,i),_(e,r)},p(l,o){o&1&&t!==(t=l[3](l[5])+"")&&de(i,t),o&1&&s!==(s=l[5])&&(e.__value=s,e.value=e.__value)},d(l){l&&S(e)}}}function Yh(n){let e,t,i,r,s,l,o,a,c=n[0],u=[];for(let d=0;d<c.length;d+=1)u[d]=Ts(As(n,c,d));return{c(){e=b("div"),t=b("label"),t.textContent=`${U==="en"?"Digitization:":"Numérisation :"}`,i=N(),r=b("div"),s=b("div"),l=b("select");for(let d=0;d<u.length;d+=1)u[d].c();p(t,"for","digit"),p(t,"class","label"),n[1]===void 0&&et(()=>n[4].call(l)),p(s,"class","select is-small"),p(r,"id","digit"),p(r,"class","control pl-3"),p(e,"class","field selector is-flex is-right mb-2")},m(d,f){E(d,e,f),_(e,t),_(e,i),_(e,r),_(r,s),_(s,l);for(let h=0;h<u.length;h+=1)u[h]&&u[h].m(l,null);ji(l,n[1],!0),o||(a=[ne(l,"change",n[4]),ne(l,"change",n[2])],o=!0)},p(d,[f]){if(f&9){c=d[0];let h;for(h=0;h<c.length;h+=1){const m=As(d,c,h);u[h]?u[h].p(m,f):(u[h]=Ts(m),u[h].c(),u[h].m(l,null))}for(;h<u.length;h+=1)u[h].d(1);u.length=c.length}f&3&&ji(l,d[1])},i:j,o:j,d(d){d&&S(e),it(u,d),o=!1,Ce(a)}}}function xh(n,e,t){let{manifests:i}=e,r=(i==null?void 0:i[0])||"";function s(a){t(1,r=a.target.value),window.dispatchEvent(new CustomEvent("selectManifest",{detail:{selectedManifest:r}}))}function l(a){const c=a.match(/man(\d+)/),u=c?c[1]:"?",d=a.match(/anno(\d+)/),f=d?d[1]:null;let h="";return h+=`${U==="en"?"Manifest":"Manifeste"} #${u}`,f&&(h+=`, ${U==="en"?"Regions extraction":"Extraction de régions"} #${f}`),h}function o(){r=lo(this),t(1,r),t(0,i)}return n.$$set=a=>{"manifests"in a&&t(0,i=a.manifests)},[i,r,s,l,o]}class Jh extends ce{constructor(e){super(),ae(this,e,xh,Yh,le,{manifests:0})}}function Xh(n){let e,t,i,r,s=U==="en"?"Download All":"Tout Télécharger",l,o,a;return{c(){e=b("div"),t=b("button"),i=b("i"),r=N(),l=G(s),p(i,"class","fa-solid fa-download"),p(t,"class","button is-link is-light"),p(e,"class","is-right mb-3")},m(c,u){E(c,e,u),_(e,t),_(t,i),_(t,r),_(t,l),o||(a=ne(t,"click",n[0]),o=!0)},p:j,i:j,o:j,d(c){c&&S(e),o=!1,a()}}}function Qh(n){const e=`${window.location.origin}${window.location.pathname}`,t=parseInt(e.split("witness/")[1].replace("/","")),i=parseInt(e.split("regions/")[1].replace("/",""));async function r(){if(!i&&!t){console.error("No Region or Witness");return}const s=i?`${window.location.origin}/${Ue}/export-regions-imgs-and-svgs/${i}`:`${window.location.origin}/${Ue}/export-all-imgs-and-svgs/${t}`;try{const l=await Ut(()=>fetch(s,{method:"GET",headers:{"X-CSRFToken":Xe,"Content-Type":"application/json"}}));if(!l.ok)throw new Error(`HTTP error! status: ${l.status}`);const o=await l.blob();Ws(o,"vectorizations.zip")}catch(l){console.error("Erreur lors du téléchargement des vectorisations:",l)}}return[r]}class Zh extends ce{constructor(e){super(),ae(this,e,Qh,Xh,le,{})}}function Ps(n,e,t){const i=n.slice();return i[25]=e[t][0],i[26]=e[t][1],i}function Ls(n,e,t){const i=n.slice();return i[29]=e[t][0],i[30]=e[t][1],i}function em(n){let e,t,i;return t=new ea({props:{witness:n[1],editUrl:n[2],viewTitle:n[3]}}),{c(){e=b("div"),W(t.$$.fragment),p(e,"slot","sidebar")},m(r,s){E(r,e,s),z(t,e,null),i=!0},p(r,s){const l={};s[0]&2&&(l.witness=r[1]),s[0]&4&&(l.editUrl=r[2]),s[0]&8&&(l.viewTitle=r[3]),t.$set(l)},i(r){i||(P(t.$$.fragment,r),i=!0)},o(r){M(t.$$.fragment,r),i=!1},d(r){r&&S(e),K(t)}}}function tm(n){let e,t,i,r,s,l,o,a,c,u,d,f,h;r=new ha({props:{baseUrl:n[15],currentRegionId:n[16],activeTab:n[33]}});const m=[sm,rm,im],g=[];function v(C,O){return C[33]==="all"||C[33]==="page"?0:C[33]==="viewer"?1:C[33]==="vectorization"?2:-1}~(o=v(n))&&(a=g[o]=m[o](n));const w=[um,cm,am,om,lm],I=[];function R(C,O){return C[33]==="viewer"?0:C[33]==="all"?1:C[33]==="page"?2:C[33]==="similarity"?3:C[33]==="vectorization"?4:-1}return~(u=R(n))&&(d=I[u]=w[u](n)),{c(){e=b("div"),t=b("div"),i=b("div"),W(r.$$.fragment),s=N(),l=b("div"),a&&a.c(),c=N(),d&&d.c(),f=me(),p(i,"class","cell is-left"),p(l,"class","cell"),p(t,"class","actions grid"),p(e,"id","nav-actions")},m(C,O){E(C,e,O),_(e,t),_(t,i),z(r,i,null),_(t,s),_(t,l),~o&&g[o].m(l,null),E(C,c,O),~u&&I[u].m(C,O),E(C,f,O),h=!0},p(C,O){const L={};O[1]&4&&(L.activeTab=C[33]),r.$set(L);let A=o;o=v(C),o===A?~o&&g[o].p(C,O):(a&&(be(),M(g[A],1,1,()=>{g[A]=null}),we()),~o?(a=g[o],a?a.p(C,O):(a=g[o]=m[o](C),a.c()),P(a,1),a.m(l,null)):a=null);let y=u;u=R(C),u===y?~u&&I[u].p(C,O):(d&&(be(),M(I[y],1,1,()=>{I[y]=null}),we()),~u?(d=I[u],d?d.p(C,O):(d=I[u]=w[u](C),d.c()),P(d,1),d.m(f.parentNode,f)):d=null)},i(C){h||(P(r.$$.fragment,C),P(a),P(d),h=!0)},o(C){M(r.$$.fragment,C),M(a),M(d),h=!1},d(C){C&&S(e),K(r),~o&&g[o].d(),C&&S(c),~u&&I[u].d(C),C&&S(f)}}}function nm(n){let e,t;return{c(){e=b("article"),t=b("div"),t.textContent=`${U==="en"?"This witness has no digitization.":"Ce témoin n'a pas de numérisation."}`,p(t,"class","message-body"),p(e,"class","message is-warning")},m(i,r){E(i,e,r),_(e,t)},p:j,i:j,o:j,d(i){i&&S(e)}}}function im(n){let e,t;return e=new Zh({}),{c(){W(e.$$.fragment)},m(i,r){z(e,i,r),t=!0},p:j,i(i){t||(P(e.$$.fragment,i),t=!0)},o(i){M(e.$$.fragment,i),t=!1},d(i){K(e,i)}}}function rm(n){let e,t;return e=new Jh({props:{manifests:n[0]}}),{c(){W(e.$$.fragment)},m(i,r){z(e,i,r),t=!0},p(i,r){const s={};r[0]&1&&(s.manifests=i[0]),e.$set(s)},i(i){t||(P(e.$$.fragment,i),t=!0)},o(i){M(e.$$.fragment,i),t=!1},d(i){K(e,i)}}}function sm(n){let e,t;return e=new ya({}),{c(){W(e.$$.fragment)},m(i,r){z(e,i,r),t=!0},p:j,i(i){t||(P(e.$$.fragment,i),t=!0)},o(i){M(e.$$.fragment,i),t=!1},d(i){K(e,i)}}}function lm(n){let e,t;return e=new zh({}),{c(){W(e.$$.fragment)},m(i,r){z(e,i,r),t=!0},p:j,i(i){t||(P(e.$$.fragment,i),t=!0)},o(i){M(e.$$.fragment,i),t=!1},d(i){K(e,i)}}}function om(n){let e,t;return e=new Yd({}),{c(){W(e.$$.fragment)},m(i,r){z(e,i,r),t=!0},p:j,i(i){t||(P(e.$$.fragment,i),t=!0)},o(i){M(e.$$.fragment,i),t=!1},d(i){K(e,i)}}}function am(n){let e,t;return e=new fh({}),{c(){W(e.$$.fragment)},m(i,r){z(e,i,r),t=!0},p:j,i(i){t||(P(e.$$.fragment,i),t=!0)},o(i){M(e.$$.fragment,i),t=!1},d(i){K(e,i)}}}function cm(n){let e,t,i={ctx:n,current:null,token:null,hasCatch:!0,pending:pm,then:dm,catch:fm,value:34,error:35,blocks:[,,,]};return tt(n[14],i),{c(){e=b("div"),i.block.c(),p(e,"class","grid is-gap-2 mt-5")},m(r,s){E(r,e,s),i.block.m(e,i.anchor=null),i.mount=()=>e,i.anchor=null,t=!0},p(r,s){n=r,At(i,n,s)},i(r){t||(P(i.block),t=!0)},o(r){for(let s=0;s<3;s+=1){const l=i.blocks[s];M(l)}t=!1},d(r){r&&S(e),i.block.d(),i.token=null,i=null}}}function um(n){let e,t;return e=new Gh({}),{c(){W(e.$$.fragment)},m(i,r){z(e,i,r),t=!0},p:j,i(i){t||(P(e.$$.fragment,i),t=!0)},o(i){M(e.$$.fragment,i),t=!1},d(i){K(e,i)}}}function fm(n){let e,t,i=n[35]+"",r;return{c(){e=b("div"),t=G("Error when retrieving regions: "),r=G(i)},m(s,l){E(s,e,l),_(e,t),_(e,r)},p:j,i:j,o:j,d(s){s&&S(e)}}}function dm(n){let e,t,i,r,s;const l=[mm,hm],o=[];function a(c,u){return u[0]&512&&(e=null),e==null&&(e=!!Object.values(c[9]).length),e?0:1}return t=a(n,[-1,-1]),i=o[t]=l[t](n),{c(){i.c(),r=me()},m(c,u){o[t].m(c,u),E(c,r,u),s=!0},p(c,u){let d=t;t=a(c,u),t===d?o[t].p(c,u):(be(),M(o[d],1,1,()=>{o[d]=null}),we(),i=o[t],i?i.p(c,u):(i=o[t]=l[t](c),i.c()),P(i,1),i.m(r.parentNode,r))},i(c){s||(P(i),s=!0)},o(c){M(i),s=!1},d(c){o[t].d(c),c&&S(r)}}}function hm(n){let e,t;return e=new Xs({props:{currentRegionId:n[16],baseUrl:n[15]}}),{c(){W(e.$$.fragment)},m(i,r){z(e,i,r),t=!0},p:j,i(i){t||(P(e.$$.fragment,i),t=!0)},o(i){M(e.$$.fragment,i),t=!1},d(i){K(e,i)}}}function mm(n){let e,t;return e=new Dl({props:{items:Object.values(n[9])}}),{c(){W(e.$$.fragment)},m(i,r){z(e,i,r),t=!0},p(i,r){const s={};r[0]&512&&(s.items=Object.values(i[9])),e.$set(s)},i(i){t||(P(e.$$.fragment,i),t=!0)},o(i){M(e.$$.fragment,i),t=!1},d(i){K(e,i)}}}function pm(n){let e;return{c(){e=b("div"),e.textContent=`${U==="en"?"Retrieving regions...":"Récupération des régions..."}`,p(e,"class","faded is-center")},m(t,i){E(t,e,i)},p:j,i:j,o:j,d(t){t&&S(e)}}}function gm(n){let e,t,i,r;const s=[nm,tm],l=[];function o(a,c){return a[0].length===0?0:1}return t=o(n),i=l[t]=s[t](n),{c(){e=b("div"),i.c(),p(e,"slot","content")},m(a,c){E(a,e,c),l[t].m(e,null),r=!0},p(a,c){let u=t;t=o(a),t===u?l[t].p(a,c):(be(),M(l[u],1,1,()=>{l[u]=null}),we(),i=l[t],i?i.p(a,c):(i=l[t]=s[t](a),i.c()),P(i,1),i.m(e,null))},i(a){r||(P(i),r=!0)},o(a){M(i),r=!1},d(a){a&&S(e),l[t].d()}}}function _m(n){let e;return{c(){e=b("div"),e.textContent=`${U==="en"?"No regions in selection":"Aucune région sélectionnée"}`},m(t,i){E(t,e,i)},p:j,d(t){t&&S(e)}}}function vm(n){let e,t,i=Object.entries(n[7]),r=[];for(let s=0;s<i.length;s+=1)r[s]=$s(Ps(n,i,s));return{c(){e=b("div"),t=b("div");for(let s=0;s<r.length;s+=1)r[s].c();p(t,"class","grid is-gap-2"),p(e,"class","fixed-grid has-6-cols")},m(s,l){E(s,e,l),_(e,t);for(let o=0;o<r.length;o+=1)r[o]&&r[o].m(t,null)},p(s,l){if(l[0]&4224){i=Object.entries(s[7]);let o;for(o=0;o<i.length;o+=1){const a=Ps(s,i,o);r[o]?r[o].p(a,l):(r[o]=$s(a),r[o].c(),r[o].m(t,null))}for(;o<r.length;o+=1)r[o].d(1);r.length=i.length}},d(s){s&&S(e),it(r,s)}}}function Ms(n){let e,t,i,r,s,l,o,a=n[30].title+"",c,u,d,f,h,m;function g(){return n[24](n[29])}return{c(){e=b("div"),t=b("figure"),i=b("img"),s=N(),l=b("div"),o=b("span"),c=G(a),u=N(),d=b("button"),f=N(),Re(i.src,r=nt(n[30].img,n[30].xywh,"96,"))||p(i,"src",r),p(i,"alt",""),p(o,"class","overlay-desc"),p(l,"class","overlay is-center svelte-qn8evk"),p(t,"class","image is-64x64 card"),p(d,"class","delete region-btn"),p(e,"class","selection cell svelte-qn8evk")},m(v,w){E(v,e,w),_(e,t),_(t,i),_(t,s),_(t,l),_(l,o),_(o,c),_(e,u),_(e,d),_(e,f),h||(m=ne(d,"click",g),h=!0)},p(v,w){n=v,w[0]&128&&!Re(i.src,r=nt(n[30].img,n[30].xywh,"96,"))&&p(i,"src",r),w[0]&128&&a!==(a=n[30].title+"")&&de(c,a)},d(v){v&&S(e),h=!1,m()}}}function $s(n){let e,t=Object.entries(n[26]),i=[];for(let r=0;r<t.length;r+=1)i[r]=Ms(Ls(n,t,r));return{c(){for(let r=0;r<i.length;r+=1)i[r].c();e=me()},m(r,s){for(let l=0;l<i.length;l+=1)i[l]&&i[l].m(r,s);E(r,e,s)},p(r,s){if(s[0]&4224){t=Object.entries(r[26]);let l;for(l=0;l<t.length;l+=1){const o=Ls(r,t,l);i[l]?i[l].p(o,s):(i[l]=Ms(o),i[l].c(),i[l].m(e.parentNode,e))}for(;l<i.length;l+=1)i[l].d(1);i.length=t.length}},d(r){it(i,r),r&&S(e)}}}function bm(n){let e;function t(s,l){return s[6]?vm:_m}let i=t(n),r=i(n);return{c(){r.c(),e=me()},m(s,l){r.m(s,l),E(s,e,l)},p(s,l){i===(i=t(s))&&r?r.p(s,l):(r.d(1),r=i(s),r&&(r.c(),r.m(e.parentNode,e)))},d(s){r.d(s),s&&S(e)}}}function wm(n){let e,t,i,r,s,l,o,a,c,u;return e=new Js({props:{visible:n[8]}}),i=new qo({}),s=new ia({props:{selectionLength:n[4]}}),o=new Xo({props:{tabList:n[5],$$slots:{content:[gm,({activeTab:d})=>({33:d}),({activeTab:d})=>[0,d?4:0]],sidebar:[em,({activeTab:d})=>({33:d}),({activeTab:d})=>[0,d?4:0]]},$$scope:{ctx:n}}}),c=new yh({props:{selectionLength:n[4],selectionStore:_t,$$slots:{default:[bm]},$$scope:{ctx:n}}}),{c(){W(e.$$.fragment),t=N(),W(i.$$.fragment),r=N(),W(s.$$.fragment),l=N(),W(o.$$.fragment),a=N(),W(c.$$.fragment)},m(d,f){z(e,d,f),E(d,t,f),z(i,d,f),E(d,r,f),z(s,d,f),E(d,l,f),z(o,d,f),E(d,a,f),z(c,d,f),u=!0},p(d,f){const h={};f[0]&256&&(h.visible=d[8]),e.$set(h);const m={};f[0]&16&&(m.selectionLength=d[4]),s.$set(m);const g={};f[0]&32&&(g.tabList=d[5]),f[0]&527|f[1]&36&&(g.$$scope={dirty:f,ctx:d}),o.$set(g);const v={};f[0]&16&&(v.selectionLength=d[4]),f[0]&192|f[1]&32&&(v.$$scope={dirty:f,ctx:d}),c.$set(v)},i(d){u||(P(e.$$.fragment,d),P(i.$$.fragment,d),P(s.$$.fragment,d),P(o.$$.fragment,d),P(c.$$.fragment,d),u=!0)},o(d){M(e.$$.fragment,d),M(i.$$.fragment,d),M(s.$$.fragment,d),M(o.$$.fragment,d),M(c.$$.fragment,d),u=!1},d(d){K(e,d),d&&S(t),K(i,d),d&&S(r),K(s,d),d&&S(l),K(o,d),d&&S(a),K(c,d)}}}function ym(n,e,t){let i,r,s,l,o,a,c;ue(n,Ot,V=>t(8,a=V));const{selected:u,nbSelected:d,remove:f}=_t;ue(n,u,V=>t(23,o=V)),ue(n,d,V=>t(22,l=V));const{allRegions:h,fetchAll:m}=wt;ue(n,h,V=>t(9,c=V));let{manifest:g=""}=e,{manifests:v=[]}=e,{isValidated:w=!1}=e,{imgPrefix:I=""}=e,{nbOfPages:R=1}=e,{trailingZeros:C=1}=e,{witness:O={}}=e,{editUrl:L=""}=e,{viewTitle:A=""}=e;ct("witness",O),ct("nbOfPages",R),ct("trailingZeros",C),ct("imgPrefix",I),ct("manifest",g),ct("isValidated",w);const y=`${window.location.origin}${window.location.pathname}`,D=parseInt(y.split("regions/")[1].replace("/","")),Z={viewer:U==="en"?"Viewer":"Visionneuse",all:U==="en"?"All regions":"Toutes les régions",page:U==="en"?"Per page":"Par page"};Vt.includes("similarity")&&(Z.similarity=U==="en"?"Similarity":"Similarité"),Vt.includes("vectorization")&&(Z.vectorization=U==="en"?"Vectorization":"Vectorisation");const se=V=>f(V,ln);return n.$$set=V=>{"manifest"in V&&t(17,g=V.manifest),"manifests"in V&&t(0,v=V.manifests),"isValidated"in V&&t(18,w=V.isValidated),"imgPrefix"in V&&t(19,I=V.imgPrefix),"nbOfPages"in V&&t(20,R=V.nbOfPages),"trailingZeros"in V&&t(21,C=V.trailingZeros),"witness"in V&&t(1,O=V.witness),"editUrl"in V&&t(2,L=V.editUrl),"viewTitle"in V&&t(3,A=V.viewTitle)},n.$$.update=()=>{n.$$.dirty[0]&8388608&&t(7,i=o),n.$$.dirty[0]&4194304&&t(4,r=l),n.$$.dirty[0]&16&&t(6,s=r>0)},[v,O,L,A,r,Z,s,i,a,c,u,d,f,h,m,y,D,g,w,I,R,C,l,o,se]}class km extends ce{constructor(e){super(),ae(this,e,ym,wm,le,{manifest:17,manifests:0,isValidated:18,imgPrefix:19,nbOfPages:20,trailingZeros:21,witness:1,editUrl:2,viewTitle:3},null,[-1,-1])}}new km({target:document.getElementById("witness-view"),props:{viewTitle,editUrl,witness,manifest,manifests,isValidated,imgPrefix,nbOfPages,trailingZeros}});
//# sourceMappingURL=witness.js.map
