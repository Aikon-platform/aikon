var regionList=function(){"use strict";function e(){}const t=e=>e;function n(e){return e()}function r(){return Object.create(null)}function o(e){e.forEach(n)}function i(e){return"function"==typeof e}function s(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}let a;function l(e,t){return a||(a=document.createElement("a")),a.href=t,e===a.href}function c(t,...n){if(null==t)return e;const r=t.subscribe(...n);return r.unsubscribe?()=>r.unsubscribe():r}function u(e){let t;return c(e,(e=>t=e))(),t}function d(e,t,n){e.$$.on_destroy.push(c(t,n))}function f(e,t,n,r){if(e){const o=p(e,t,n,r);return e[0](o)}}function p(e,t,n,r){return e[1]&&r?function(e,t){for(const n in t)e[n]=t[n];return e}(n.ctx.slice(),e[1](r(t))):n.ctx}function m(e,t,n,r){if(e[2]&&r){const o=e[2](r(n));if(void 0===t.dirty)return o;if("object"==typeof o){const e=[],n=Math.max(t.dirty.length,o.length);for(let r=0;r<n;r+=1)e[r]=t.dirty[r]|o[r];return e}return t.dirty|o}return t.dirty}function g(e,t,n,r,o,i){if(o){const s=p(t,n,r,i);e.p(s,o)}}function h(e){if(e.ctx.length>32){const t=[],n=e.ctx.length/32;for(let e=0;e<n;e++)t[e]=-1;return t}return-1}function $(e){const t="string"==typeof e&&e.match(/^\s*(-?[\d.]+)([^\s]*)\s*$/);return t?[parseFloat(t[1]),t[2]||"px"]:[e,"px"]}const v="undefined"!=typeof window;let b=v?()=>window.performance.now():()=>Date.now(),w=v?e=>requestAnimationFrame(e):e;const y=new Set;function x(e){y.forEach((t=>{t.c(e)||(y.delete(t),t.f())})),0!==y.size&&w(x)}function k(e,t){e.appendChild(t)}function S(e){if(!e)return document;const t=e.getRootNode?e.getRootNode():e.ownerDocument;return t&&t.host?t:e.ownerDocument}function E(e){const t=I("style");return function(e,t){k(e.head||e,t),t.sheet}(S(e),t),t.sheet}function C(e,t,n){e.insertBefore(t,n||null)}function P(e){e.parentNode&&e.parentNode.removeChild(e)}function N(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function I(e){return document.createElement(e)}function L(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function O(e){return document.createTextNode(e)}function R(){return O(" ")}function A(){return O("")}function M(e,t,n,r){return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n,r)}function T(e){return function(t){return t.preventDefault(),e.call(this,t)}}function V(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function _(e,t){t=""+t,e.data!==t&&(e.data=t)}function j(e,t){e.value=null==t?"":t}function U(e,t,n,r){null==n?e.style.removeProperty(t):e.style.setProperty(t,n,r?"important":"")}function q(e,t,n){e.classList[n?"add":"remove"](t)}function z(e,t,{bubbles:n=!1,cancelable:r=!1}={}){const o=document.createEvent("CustomEvent");return o.initCustomEvent(e,n,r,t),o}class D{constructor(e=!1){this.is_svg=!1,this.is_svg=e,this.e=this.n=null}c(e){this.h(e)}m(e,t,n=null){this.e||(this.is_svg?this.e=L(t.nodeName):this.e=I(11===t.nodeType?"TEMPLATE":t.nodeName),this.t="TEMPLATE"!==t.tagName?t:t.content,this.c(e)),this.i(n)}h(e){this.e.innerHTML=e,this.n=Array.from("TEMPLATE"===this.e.nodeName?this.e.content.childNodes:this.e.childNodes)}i(e){for(let t=0;t<this.n.length;t+=1)C(this.t,this.n[t],e)}p(e){this.d(),this.h(e),this.i(this.a)}d(){this.n.forEach(P)}}const H=new Map;let F,B=0;function X(e,t,n,r,o,i,s,a=0){const l=16.666/r;let c="{\n";for(let e=0;e<=1;e+=l){const r=t+(n-t)*i(e);c+=100*e+`%{${s(r,1-r)}}\n`}const u=c+`100% {${s(n,1-n)}}\n}`,d=`__svelte_${function(e){let t=5381,n=e.length;for(;n--;)t=(t<<5)-t^e.charCodeAt(n);return t>>>0}(u)}_${a}`,f=S(e),{stylesheet:p,rules:m}=H.get(f)||function(e,t){const n={stylesheet:E(t),rules:{}};return H.set(e,n),n}(f,e);m[d]||(m[d]=!0,p.insertRule(`@keyframes ${d} ${u}`,p.cssRules.length));const g=e.style.animation||"";return e.style.animation=`${g?`${g}, `:""}${d} ${r}ms linear ${o}ms 1 both`,B+=1,d}function J(e,t){const n=(e.style.animation||"").split(", "),r=n.filter(t?e=>e.indexOf(t)<0:e=>-1===e.indexOf("__svelte")),o=n.length-r.length;o&&(e.style.animation=r.join(", "),B-=o,B||w((()=>{B||(H.forEach((e=>{const{ownerNode:t}=e.stylesheet;t&&P(t)})),H.clear())})))}function Z(e){F=e}function G(){if(!F)throw new Error("Function called outside component initialization");return F}function W(e){G().$$.on_mount.push(e)}function Y(){const e=G();return(t,n,{cancelable:r=!1}={})=>{const o=e.$$.callbacks[t];if(o){const i=z(t,n,{cancelable:r});return o.slice().forEach((t=>{t.call(e,i)})),!i.defaultPrevented}return!0}}function Q(e,t){return G().$$.context.set(e,t),t}function K(e){return G().$$.context.get(e)}const ee=[],te=[];let ne=[];const re=[],oe=Promise.resolve();let ie=!1;function se(e){ne.push(e)}const ae=new Set;let le,ce=0;function ue(){if(0!==ce)return;const e=F;do{try{for(;ce<ee.length;){const e=ee[ce];ce++,Z(e),de(e.$$)}}catch(e){throw ee.length=0,ce=0,e}for(Z(null),ee.length=0,ce=0;te.length;)te.pop()();for(let e=0;e<ne.length;e+=1){const t=ne[e];ae.has(t)||(ae.add(t),t())}ne.length=0}while(ee.length);for(;re.length;)re.pop()();ie=!1,ae.clear(),Z(e)}function de(e){if(null!==e.fragment){e.update(),o(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(se)}}function fe(e,t,n){e.dispatchEvent(z(`${t?"intro":"outro"}${n}`))}const pe=new Set;let me;function ge(){me={r:0,c:[],p:me}}function he(){me.r||o(me.c),me=me.p}function $e(e,t){e&&e.i&&(pe.delete(e),e.i(t))}function ve(e,t,n,r){if(e&&e.o){if(pe.has(e))return;pe.add(e),me.c.push((()=>{pe.delete(e),r&&(n&&e.d(1),r())})),e.o(t)}else r&&r()}const be={duration:0};function we(n,r,s,a){const l={direction:"both"};let c=r(n,s,l),u=a?0:1,d=null,f=null,p=null;function m(){p&&J(n,p)}function g(e,t){const n=e.b-u;return t*=Math.abs(n),{a:u,b:e.b,d:n,duration:t,start:e.start,end:e.start+t,group:e.group}}function h(r){const{delay:i=0,duration:s=300,easing:a=t,tick:l=e,css:h}=c||be,$={start:b()+i,b:r};r||($.group=me,me.r+=1),d||f?f=$:(h&&(m(),p=X(n,u,r,s,i,a,h)),r&&l(0,1),d=g($,s),se((()=>fe(n,r,"start"))),function(e){let t;0===y.size&&w(x),new Promise((n=>{y.add(t={c:e,f:n})}))}((e=>{if(f&&e>f.start&&(d=g(f,s),f=null,fe(n,d.b,"start"),h&&(m(),p=X(n,u,d.b,d.duration,0,a,c.css))),d)if(e>=d.end)l(u=d.b,1-u),fe(n,d.b,"end"),f||(d.b?m():--d.group.r||o(d.group.c)),d=null;else if(e>=d.start){const t=e-d.start;u=d.a+d.d*a(t/d.duration),l(u,1-u)}return!(!d&&!f)})))}return{run(e){i(c)?(le||(le=Promise.resolve(),le.then((()=>{le=null}))),le).then((()=>{c=c(l),h(e)})):h(e)},end(){m(),d=f=null}}}function ye(e,t){const n=t.token={};function r(e,r,o,i){if(t.token!==n)return;t.resolved=i;let s=t.ctx;void 0!==o&&(s=s.slice(),s[o]=i);const a=e&&(t.current=e)(s);let l=!1;t.block&&(t.blocks?t.blocks.forEach(((e,n)=>{n!==r&&e&&(ge(),ve(e,1,1,(()=>{t.blocks[n]===e&&(t.blocks[n]=null)})),he())})):t.block.d(1),a.c(),$e(a,1),a.m(t.mount(),t.anchor),l=!0),t.block=a,t.blocks&&(t.blocks[r]=a),l&&ue()}if(!(o=e)||"object"!=typeof o&&"function"!=typeof o||"function"!=typeof o.then){if(t.current!==t.then)return r(t.then,1,t.value,e),!0;t.resolved=e}else{const n=G();if(e.then((e=>{Z(n),r(t.then,1,t.value,e),Z(null)}),(e=>{if(Z(n),r(t.catch,2,t.error,e),Z(null),!t.hasCatch)throw e})),t.current!==t.pending)return r(t.pending,0),!0}var o}function xe(e,t,n){const r=t.slice(),{resolved:o}=e;e.current===e.then&&(r[e.value]=o),e.current===e.catch&&(r[e.error]=o),e.block.p(r,n)}function ke(e,t){ve(e,1,1,(()=>{t.delete(e.key)}))}function Se(e,t,n,r,i,s,a,l,c,u,d,f){let p=e.length,m=s.length,g=p;const h={};for(;g--;)h[e[g].key]=g;const $=[],v=new Map,b=new Map,w=[];for(g=m;g--;){const e=f(i,s,g),o=n(e);let l=a.get(o);l?r&&w.push((()=>l.p(e,t))):(l=u(o,e),l.c()),v.set(o,$[g]=l),o in h&&b.set(o,Math.abs(g-h[o]))}const y=new Set,x=new Set;function k(e){$e(e,1),e.m(l,d),a.set(e.key,e),d=e.first,m--}for(;p&&m;){const t=$[m-1],n=e[p-1],r=t.key,o=n.key;t===n?(d=t.first,p--,m--):v.has(o)?!a.has(r)||y.has(r)?k(t):x.has(o)?p--:b.get(r)>b.get(o)?(x.add(r),k(t)):(y.add(o),p--):(c(n,a),p--)}for(;p--;){const t=e[p];v.has(t.key)||c(t,a)}for(;m;)k($[m-1]);return o(w),$}function Ee(e){e&&e.c()}function Ce(e,t,r,s){const{fragment:a,after_update:l}=e.$$;a&&a.m(t,r),s||se((()=>{const t=e.$$.on_mount.map(n).filter(i);e.$$.on_destroy?e.$$.on_destroy.push(...t):o(t),e.$$.on_mount=[]})),l.forEach(se)}function Pe(e,t){const n=e.$$;null!==n.fragment&&(!function(e){const t=[],n=[];ne.forEach((r=>-1===e.indexOf(r)?t.push(r):n.push(r))),n.forEach((e=>e())),ne=t}(n.after_update),o(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function Ne(e,t){-1===e.$$.dirty[0]&&(ee.push(e),ie||(ie=!0,oe.then(ue)),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function Ie(t,n,i,s,a,l,c,u=[-1]){const d=F;Z(t);const f=t.$$={fragment:null,ctx:[],props:l,update:e,not_equal:a,bound:r(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(n.context||(d?d.$$.context:[])),callbacks:r(),dirty:u,skip_bound:!1,root:n.target||d.$$.root};c&&c(f.root);let p=!1;if(f.ctx=i?i(t,n.props||{},((e,n,...r)=>{const o=r.length?r[0]:n;return f.ctx&&a(f.ctx[e],f.ctx[e]=o)&&(!f.skip_bound&&f.bound[e]&&f.bound[e](o),p&&Ne(t,e)),n})):[],f.update(),p=!0,o(f.before_update),f.fragment=!!s&&s(f.ctx),n.target){if(n.hydrate){const e=function(e){return Array.from(e.childNodes)}(n.target);f.fragment&&f.fragment.l(e),e.forEach(P)}else f.fragment&&f.fragment.c();n.intro&&$e(t.$$.fragment),Ce(t,n.target,n.anchor,n.customElement),ue()}Z(d)}class Le{$destroy(){Pe(this,1),this.$destroy=e}$on(t,n){if(!i(n))return e;const r=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return r.push(n),()=>{const e=r.indexOf(n);-1!==e&&r.splice(e,1)}}$set(e){var t;this.$$set&&(t=e,0!==Object.keys(t).length)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}function Oe(e){const t=e-1;return t*t*t+1}function Re(e,{delay:n=0,duration:r=400,easing:o=t}={}){const i=+getComputedStyle(e).opacity;return{delay:n,duration:r,easing:o,css:e=>"opacity: "+e*i}}function Ae(e,{delay:t=0,duration:n=400,easing:r=Oe,x:o=0,y:i=0,opacity:s=0}={}){const a=getComputedStyle(e),l=+a.opacity,c="none"===a.transform?"":a.transform,u=l*(1-s),[d,f]=$(o),[p,m]=$(i);return{delay:t,duration:n,easing:r,css:(e,t)=>`\n\t\t\ttransform: ${c} translate(${(1-e)*d}${f}, ${(1-e)*p}${m});\n\t\t\topacity: ${l-u*t}`}}const Me=[];function Te(t,n=e){let r;const o=new Set;function i(e){if(s(t,e)&&(t=e,r)){const e=!Me.length;for(const e of o)e[1](),Me.push(e,t);if(e){for(let e=0;e<Me.length;e+=2)Me[e][0](Me[e+1]);Me.length=0}}}return{set:i,update:function(e){i(e(t))},subscribe:function(s,a=e){const l=[s,a];return o.add(l),1===o.size&&(r=n(i)||e),s(t),()=>{o.delete(l),0===o.size&&r&&(r(),r=null)}}}}function Ve(t,n,r){const s=!Array.isArray(t),a=s?[t]:t,l=n.length<2;return u=t=>{let r=!1;const u=[];let d=0,f=e;const p=()=>{if(d)return;f();const r=n(s?u[0]:u,t);l?t(r):f=i(r)?r:e},m=a.map(((e,t)=>c(e,(e=>{u[t]=e,d&=~(1<<t),r&&p()}),(()=>{d|=1<<t}))));return r=!0,p(),function(){o(m),f(),r=!1}},{subscribe:Te(r,u).subscribe};var u}const _e=APP_LANG,je=APP_NAME;WEBAPP_NAME;const Ue=USER_ID;IS_SUPERUSER,ADD_PERMISSION;const qe=CSRF_TOKEN,ze=ADDITIONAL_MODULES,De="Region",He=SAS_APP_URL,Fe=CANTALOUPE_APP_URL,Be=MEDIA_PATH,Xe=PAGE_LEN,Je=Te(!1),Ze=Te("");async function Ge(e){Je.set(!0);try{return await e()}finally{Je.set(!1)}}function We(e,t=100){const n=Math.floor(.75*t);return e.length>t?e.slice(0,n)+"..."+e.slice(-t+n):e}function Ye(e,t){if("undefined"!=typeof window){const n=parseInt(new URLSearchParams(window.location.search).get(t));if(!isNaN(n))return e.set(n),n}return e.set(1),1}function Qe(e,t,n){if(t.set(e),"undefined"!=typeof window){const t=new URL(window.location.href);t.searchParams.set(n,e),window.history.pushState({},"",t)}}function Ke(e=null,t="full",n="full"){if(!e)return"https://placehold.co/96x96/png?text=No+image";if((e=e.split("_")).length<3)return"https://placehold.co/96x96/png?text=No+image";const r=e[e.length-1].includes(",")?e.pop().replace(".jpg",""):t,o=e.join("_").replace(".jpg","");return`${Fe??"http://localhost:8182"}/iiif/2/${o}.jpg/${r}/${n}/0/default.jpg`}function et(e=null,t=1){return`${He??"http://localhost:3000"}/index.html?iiif-content=${e}&canvas=${t}`}function tt(e,t=null,n=!1){return new Promise((r=>{if(document.getElementById("msg-modal")){n?document.getElementById("modal-footer").hidden=!1:r(void 0),t&&(document.getElementById("modal-title").innerHTML=t),document.getElementById("modal-body").innerHTML=e,document.getElementById("hidden-msg-btn").click();const o=document.getElementById("cancel-btn"),i=document.getElementById("ok-btn"),s=document.getElementById("modal-bkg"),a=()=>{o.removeEventListener("click",l),s.removeEventListener("click",l),i.removeEventListener("click",c),document.getElementById("modal-footer").hidden=!0},l=()=>{a(),r(!1)},c=()=>{a(),r(!0)};o.addEventListener("click",l),i.addEventListener("click",c)}else n?r(window.confirm(e)):(window.alert(e),r(void 0))}))}function nt(e,t){const n=window.URL.createObjectURL(e),r=document.createElement("a");r.href=n,r.download=`${t}`,document.body.appendChild(r),r.click(),window.URL.revokeObjectURL(n),document.body.removeChild(r)}const rt=function(){const e={id:null,type:"documentSet",title:"en"===_e?"Document set":"Set de document",selected:{}},t={id:null,type:"regionsSet",title:"en"===_e?"Regions set":"Set de régions",selected:{}},n=Te({records:JSON.parse(localStorage.getItem("documentSet"))||e,regions:JSON.parse(localStorage.getItem("regionsSet"))||t}),{subscribe:r,update:o,get:i}=n,s=Te(!1);function a(e,t=!1){s.set(t),localStorage.setItem(e.type,JSON.stringify(e))}function l(e,t){return e[t?"regions":"records"]?.selected||{}}function c(e,t=!0){const n=l(e,t);return t?n[De]??{}:Object.entries(n)}function u(e,t,n){const r=n===De?"regions":"records",o=e[r],{[t]:i,...s}=o.selected[n];return e[r]={...o,selected:{...o.selected,[n]:s}},a(e[r]),e}function d(e,t,n=!0){const r=t.class===De?"regions":"records",o=e[r],i=o.selected,s=t.class===De?t:{title:t.title,url:t.url};return e[r]={...o,selected:{...i,[t.class]:{...i[t.class]||{},[t.id]:s}}},n&&a(e[r]),e}function f(e,t){return e[t.class.toLowerCase().includes("regions")?"regions":"records"].id===t.id}return{subscribe:r,save:e=>o((t=>function(e,t){const n=t?"regions-set":"document-set";if(t)return window.alert("Region set management is not yet implemented"),e;let r=e[t?"regions":"records"],i={};Object.entries(r.selected).forEach((([e,t])=>{i[e]=Object.keys(t)}));const a=null!==r.id?`${r.id}/change`:"add";return fetch(`${window.location.origin}/${je}/${n}/${a}`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":qe},body:JSON.stringify({title:r.title,selection:r,...i})}).then((e=>e.json())).then((e=>{if(!e?.document_set_id)throw new Error("Failed to save selection");o((n=>{const r=n[t?"regions":"records"];return r.id=e.document_set_id,r.title=e.document_set_title,s.set(!0),n}))})).catch((e=>console.error("Error:",e))),e}(t,e))),empty:n=>o((r=>(r[n?"regions":"records"]=n?t:e,a(r[n?"regions":"records"]),r))),removeAll:(e,t)=>o((n=>function(e,t,n){const r=n===De?"regions":"records",o=e[r];let i=o.selected[n];return i&&Object.keys(i).length?(t.forEach((e=>{delete i[e]})),e[r]={...o,selected:{...o.selected,[n]:i}},a(e[r]),e):e}(n,e,t))),remove:(e,t)=>o((n=>u(n,e,t))),addAll:e=>o((t=>function(e,t){const n=t[0].type===De;return t.forEach((t=>{e=d(e,t,!1)})),a(e[n?"regions":"records"]),e}(t,e))),add:e=>o((t=>d(t,e))),toggle:e=>o((t=>{const n=l(t,e.class===De);return n[e.class]?.[e.id]?u(t,e.id,e.class):d(t,e)})),updateTitle:(e,t)=>o((n=>{const r=t?"regions":"records";return n[r]={...n[r],title:e},a(n[r],!0),n})),isSaved:s,isSelected:Ve(n,(e=>t=>l(e,t.class===De)[t.class]?.hasOwnProperty(t.id)||!1)),isSetSelected:Ve(n,(e=>t=>f(e,t))),selected:Ve(n,(e=>t=>c(e,t))),nbSelected:Ve(n,(e=>t=>{const n=c(e,t);return t?Object.keys(n).length:n.reduce(((e,[t,n])=>e+Object.keys(n).length),0)})),selectionTitle:Ve(n,(e=>t=>e[t?"regions":"records"].title)),selection:Ve(n,(e=>t=>e[t?"regions":"records"])),toggleSet:n=>o((r=>f(r,n)?function(n,r){const o=r.class.toLowerCase().includes("regions");return n[o?"regions":"records"]=o?t:e,a(n[o?"regions":"records"]),n}(r,n):function(e,t){const n=t.class.toLowerCase().includes("regions")?"regions":"records";return null===t.selection.id&&(t.selection.id=t.id),e[n]=t.selection,a(e[n]),e}(r,n)))}}();const ot=function(){const e=`${window.location.origin}${window.location.pathname}`,t=Te(1),n=Te({}),r=Te({}),o=Te("");Ye(t,"p");const i=(async()=>{const t=await fetch(`${e}canvas`),r=await t.json();let o={};return Object.values(r).forEach((e=>{Object.entries(e).forEach((([e,t])=>{o[e]=t}))})),n.set(o),r})(),s=Ve(t,(t=>(async()=>{const n=await fetch(`${e}canvas?p=${t}`),o=await n.json();return r.set(o),o})()));return{currentPage:t,pageRegions:r,allRegions:n,fetchPages:s,fetchAll:i,handlePageUpdate:function(e){Qe(e,t,"p")},remove:function(e){n.update((t=>(delete t[e],{...t}))),r.update((t=>{for(const n in t)if(t[n][e]){const{[e]:r,...o}=t[n];return t[n]=o,t}return t}))},clipBoard:o,copyRef:function(e){o.update((t=>{const n=t===e?"":e;return navigator.clipboard.writeText(n).then((e=>"")),n}))}}}();function it(e){let t,n,r;return{c(){t=I("div"),t.innerHTML='<div class="loader svelte-vizlcg"></div>',V(t,"class","bkg-shade svelte-vizlcg")},m(e,n){C(e,t,n),r=!0},i(e){r||(se((()=>{r&&(n||(n=we(t,Re,{duration:150},!0)),n.run(1))})),r=!0)},o(e){n||(n=we(t,Re,{duration:150},!1)),n.run(0),r=!1},d(e){e&&P(t),e&&n&&n.end()}}}function st(e){let t,n,r=e[0]&&it();return{c(){r&&r.c(),t=A()},m(e,o){r&&r.m(e,o),C(e,t,o),n=!0},p(e,[n]){e[0]?r?1&n&&$e(r,1):(r=it(),r.c(),$e(r,1),r.m(t.parentNode,t)):r&&(ge(),ve(r,1,1,(()=>{r=null})),he())},i(e){n||($e(r),n=!0)},o(e){ve(r),n=!1},d(e){r&&r.d(e),e&&P(t)}}}function at(e,t,n){let{visible:r=!1}=t;return e.$$set=e=>{"visible"in e&&n(0,r=e.visible)},[r]}class lt extends Le{constructor(e){super(),Ie(this,e,at,st,s,{visible:0})}}function ct(e){let t;return{c(){t=L("path"),V(t,"d","M384 336H192c-8.8 0-16-7.2-16-16V64c0-8.8 7.2-16 16-16l140.1 0L400 115.9V320c0 8.8-7.2 16-16 16zM192 384H384c35.3 0 64-28.7 64-64V115.9c0-12.7-5.1-24.9-14.1-33.9L366.1 14.1c-9-9-21.2-14.1-33.9-14.1H192c-35.3 0-64 28.7-64 64V320c0 35.3 28.7 64 64 64zM64 128c-35.3 0-64 28.7-64 64V448c0 35.3 28.7 64 64 64H256c35.3 0 64-28.7 64-64V416H272v32c0 8.8-7.2 16-16 16H64c-8.8 0-16-7.2-16-16V192c0-8.8 7.2-16 16-16H96V128H64z"),V(t,"class","svelte-rtaaid")},m(e,n){C(e,t,n)},d(e){e&&P(t)}}}function ut(e){let t;return{c(){t=L("path"),V(t,"d","M208 0H332.1c12.7 0 24.9 5.1 33.9 14.1l67.9 67.9c9 9 14.1 21.2 14.1 33.9V336c0 26.5-21.5 48-48 48H208c-26.5 0-48-21.5-48-48V48c0-26.5 21.5-48 48-48zM48 128h80v64H64V448H256V416h64v48c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V176c0-26.5 21.5-48 48-48z"),V(t,"class","svelte-rtaaid")},m(e,n){C(e,t,n)},d(e){e&&P(t)}}}function dt(t){let n,r="en"===_e?"Copy ID":"Copier l'ID";return{c(){n=O(r)},m(e,t){C(e,n,t)},p:e,d(e){e&&P(n)}}}function ft(t){let n,r="en"===_e?"Copied!":"Copié !";return{c(){n=O(r)},m(e,t){C(e,n,t)},p:e,d(e){e&&P(n)}}}function pt(e){let t,n,r,i,s,a,c,u,d,f,p,m,g,h,$,v,b,w;function y(e,t){return e[4]?ut:ct}let x=y(e),S=x(e);function E(e,t){return e[4]?ft:dt}let N=E(e),O=N(e);return{c(){t=I("div"),n=I("figure"),r=I("img"),s=R(),a=I("div"),c=I("span"),d=R(),f=I("button"),p=L("svg"),S.c(),m=R(),g=I("span"),O.c(),V(r,"class","region-img svelte-rtaaid"),l(r.src,i=Ke(e[0].img,e[0].xyhw,e[1]?"96,":`,${e[2]}`))||V(r,"src",i),V(r,"alt","Extracted region"),V(c,"class","overlay-desc"),V(a,"class","overlay is-center svelte-rtaaid"),V(n,"class",u="image card region-image "+(e[1]?"is-96x96":"")+" svelte-rtaaid"),V(n,"tabindex","-1"),U(n,"height",e[2]+"px"),U(n,"min-width",e[2]+"px"),V(p,"xmlns","http://www.w3.org/2000/svg"),V(p,"viewBox","0 0 384 512"),V(p,"class","svelte-rtaaid"),V(g,"class","tooltip svelte-rtaaid"),V(f,"class","button region-btn tag svelte-rtaaid"),V(t,"class",h="region is-center "+(e[5](e[0])?"checked":"")+" svelte-rtaaid")},m(o,i){C(o,t,i),k(t,n),k(n,r),k(n,s),k(n,a),k(a,c),c.innerHTML=e[3],k(t,d),k(t,f),k(f,p),S.m(p,null),k(f,m),k(f,g),O.m(g,null),v=!0,b||(w=[M(n,"click",e[9]),M(n,"keyup",mt),M(f,"click",e[10])],b=!0)},p(e,[o]){(!v||7&o&&!l(r.src,i=Ke(e[0].img,e[0].xyhw,e[1]?"96,":`,${e[2]}`)))&&V(r,"src",i),(!v||8&o)&&(c.innerHTML=e[3]),(!v||2&o&&u!==(u="image card region-image "+(e[1]?"is-96x96":"")+" svelte-rtaaid"))&&V(n,"class",u),(!v||4&o)&&U(n,"height",e[2]+"px"),(!v||4&o)&&U(n,"min-width",e[2]+"px"),x!==(x=y(e))&&(S.d(1),S=x(e),S&&(S.c(),S.m(p,null))),N===(N=E(e))&&O?O.p(e,o):(O.d(1),O=N(e),O&&(O.c(),O.m(g,null))),(!v||33&o&&h!==(h="region is-center "+(e[5](e[0])?"checked":"")+" svelte-rtaaid"))&&V(t,"class",h)},i(e){v||(se((()=>{v&&($||($=we(t,Re,{duration:500},!0)),$.run(1))})),v=!0)},o(e){$||($=we(t,Re,{duration:500},!1)),$.run(0),v=!1},d(e){e&&P(t),S.d(),O.d(),e&&$&&$.end(),b=!1,o(w)}}}const mt=()=>null;function gt(e,t,n){let r,o,i;const{isSelected:s}=rt;d(e,s,(e=>n(5,i=e)));const{clipBoard:a}=ot;d(e,a,(e=>n(8,o=e)));let{item:l}=t,{isSquare:c=!0}=t,{height:u=(c?96:140)}=t,{desc:f=l.title}=t;return e.$$set=e=>{"item"in e&&n(0,l=e.item),"isSquare"in e&&n(1,c=e.isSquare),"height"in e&&n(2,u=e.height),"desc"in e&&n(3,f=e.desc)},e.$$.update=()=>{257&e.$$.dirty&&n(4,r=l.ref===o)},[l,c,u,f,r,i,s,a,o,()=>rt.toggle(l),()=>ot.copyRef(l.ref)]}class ht extends Le{constructor(e){super(),Ie(this,e,gt,pt,s,{item:0,isSquare:1,height:2,desc:3})}}function $t(t){let n,r,o,i,s,a,l,c,u,d="en"===_e?"Selection":"Sélection";return{c(){n=I("div"),r=I("button"),o=I("span"),i=I("i"),s=R(),a=O(d),l=O("\n            ("),c=O(t[0]),u=O(")"),V(i,"class","fa-solid fa-book-bookmark"),V(o,"id","btn-content"),V(r,"id","set-btn"),V(r,"class","button px-5 py-4 is-link js-modal-trigger svelte-hs48f9"),V(r,"data-target","selection-modal"),V(n,"class","set-container svelte-hs48f9")},m(e,t){C(e,n,t),k(n,r),k(r,o),k(o,i),k(o,s),k(o,a),k(o,l),k(o,c),k(o,u)},p(e,[t]){1&t&&_(c,e[0])},i:e,o:e,d(e){e&&P(n)}}}function vt(e,t,n){let{selectionLength:r=0}=t,o=r;return e.$$set=e=>{"selectionLength"in e&&n(0,r=e.selectionLength)},e.$$.update=()=>{if(3&e.$$.dirty&&r!==o){const e=r>o;n(1,o=r);const t=document.getElementById("btn-content");t&&t.animate([{transform:e?"translateY(-7px)":"translateX(-5px)"},{transform:e?"translateY(7px)":"translateX(5px)"},{transform:"translate(0)"}],{duration:300,easing:"cubic-bezier(0.65, 0, 0.35, 1)"})}},[r,o]}class bt extends Le{constructor(e){super(),Ie(this,e,vt,$t,s,{selectionLength:0})}}function wt(t){let n,r,o,i,s,a,l,c,u,d,f,p,m,g,h;return{c(){n=I("button"),r=R(),o=I("div"),i=I("div"),s=R(),a=I("div"),l=I("div"),l.innerHTML='<div class="title is-4 mb-0 media-content"><span id="modal-title" class="mb-0"></span></div> \n            <button class="delete media-left" aria-label="close"></button>',c=R(),u=I("section"),d=R(),f=I("footer"),p=I("div"),m=I("button"),m.textContent=""+("en"===_e?"Abort":"Retour"),g=R(),h=I("button"),h.textContent="OK",V(n,"id","hidden-msg-btn"),V(n,"class","js-modal-trigger"),V(n,"data-target","msg-modal"),n.hidden=!0,V(i,"id","modal-bkg"),V(i,"class","modal-background"),V(l,"class","modal-card-head media mb-0"),V(u,"id","modal-body"),V(u,"class","modal-card-body"),V(m,"id","cancel-btn"),V(m,"class","button is-link is-light button-close"),V(h,"id","ok-btn"),V(h,"class","button is-link button-close"),V(p,"class","buttons"),V(f,"id","modal-footer"),V(f,"class","modal-card-foot is-center pt-3"),f.hidden=!0,V(a,"class","modal-content"),V(o,"id","msg-modal"),V(o,"class","modal fade"),V(o,"tabindex","-1"),V(o,"aria-labelledby","selection-modal-label"),V(o,"aria-hidden","true")},m(e,t){C(e,n,t),C(e,r,t),C(e,o,t),k(o,i),k(o,s),k(o,a),k(a,l),k(a,c),k(a,u),k(a,d),k(a,f),k(f,p),k(p,m),k(p,g),k(p,h)},p:e,i:e,o:e,d(e){e&&P(n),e&&P(r),e&&P(o)}}}class yt extends Le{constructor(e){super(),Ie(this,e,null,wt,s,{})}}function xt(t){let n,r,o,i,s,a=ze.includes("regions"),l=a&&function(t){let n,r,o;return{c(){n=I("button"),n.textContent="en"===_e?"Automatic region extraction":"Extraction automatique des régions",V(n,"class","button is-link is-inverted")},m(e,i){C(e,n,i),r||(o=M(n,"click",t[1]),r=!0)},p:e,d(e){e&&P(n),r=!1,o()}}}(t);return{c(){n=I("div"),r=I("button"),r.textContent=""+("en"===_e?"Manually annotate":"Annoter manuellement"),o=R(),l&&l.c(),V(r,"class","button is-link"),V(n,"class","is-center buttons is-centered pt-5")},m(e,a){C(e,n,a),k(n,r),k(n,o),l&&l.m(n,null),i||(s=M(r,"click",t[0]),i=!0)},p(e,[t]){a&&l.p(e,t)},i:e,o:e,d(e){e&&P(n),l&&l.d(),i=!1,s()}}}function kt(e,t,n){const r=K("witness");let{currentRegionId:o}=t,{baseUrl:i}=t;return e.$$set=e=>{"currentRegionId"in e&&n(2,o=e.currentRegionId),"baseUrl"in e&&n(3,i=e.baseUrl)},[async function(){const e=`${window.location.origin}/${je}`;let t=`${e}/witness/${r.id}/regions/add`;if(1===r.regions.length||o){const n=o||r.regions[0];t=`${e}/witness/${r.id}/regions/${n}/add`}const n=await Ge((()=>fetch(t,{method:"POST",headers:{"X-CSRFToken":qe}})));if(!n.ok)throw await tt(`Failed to create regions: '${n.statusText}'`,"Error"),new Error(`Failed to create regions: '${n.statusText}'`);let s;try{s=await n.json()}catch(e){throw await tt(`Failed to parse JSON response: '${e}'`,"Error"),new Error(`Failed to parse JSON response: '${e}'`)}s.hasOwnProperty("mirador_url")&&window.open(s.mirador_url),s.hasOwnProperty("regions_id")&&(window.location.href=`${i.split("regions/")[0]}regions/${s.regions_id}`)},async function(){const e=`${window.location.origin}/${je}/witness/${r.id}/regions/extract`,t=await Ge((()=>fetch(e,{method:"POST",headers:{"X-CSRFToken":qe}})));let n;if(!t.ok){try{n=await t.json()}catch(e){throw await tt(`Failed to parse JSON response: '${e}'`,"Error"),new Error(`Failed to parse JSON response: '${e}'`)}throw await tt(`Failed to launch regions extraction: '${n.message}'`,"Error"),new Error(`Failed to launch regions extraction: '${n.message}'`)}const o=n.doc_set_id;if(!o)throw await tt("Failed to launch regions extraction: 'No document set id'","Error"),new Error("Failed to launch regions extraction: 'No document set id'");window.location.href=`${window.location.origin}/${je}/treatment/add/?document_set=${o}&task_type=regions`},o,i]}class St extends Le{constructor(e){super(),Ie(this,e,kt,xt,s,{currentRegionId:2,baseUrl:3})}}function Et(e,t,n){const r=e.slice();return r[6]=t[n],r}function Ct(e){let t,n=e[3].regions,r=[];for(let t=0;t<n.length;t+=1)r[t]=Nt(Et(e,n,t));return{c(){for(let e=0;e<r.length;e+=1)r[e].c();t=A()},m(e,n){for(let t=0;t<r.length;t+=1)r[t]&&r[t].m(e,n);C(e,t,n)},p(e,o){if(9&o){let i;for(n=e[3].regions,i=0;i<n.length;i+=1){const s=Et(e,n,i);r[i]?r[i].p(s,o):(r[i]=Nt(s),r[i].c(),r[i].m(t.parentNode,t))}for(;i<r.length;i+=1)r[i].d(1);r.length=n.length}},d(e){N(r,e),e&&P(t)}}}function Pt(e){let t,n;function r(e,n){return 4&n&&(t=null),null==t&&(t=!!["all","page"].includes(e[2])),t?Lt:"similarity"===e[2]?It:void 0}let o=r(e,-1),i=o&&o(e);return{c(){i&&i.c(),n=A()},m(e,t){i&&i.m(e,t),C(e,n,t)},p(e,t){o===(o=r(e,t))&&i?i.p(e,t):(i&&i.d(1),i=o&&o(e),i&&(i.c(),i.m(n.parentNode,n)))},d(e){i&&i.d(e),e&&P(n)}}}function Nt(e){let t,n,r,o,i=e[6]+"";return{c(){t=I("a"),n=O("Regions #"),r=O(i),V(t,"href",o=""+(e[0]+e[6])),V(t,"class","tag is-dark mr-3 is-rounded")},m(e,o){C(e,t,o),k(t,n),k(t,r)},p(e,n){1&n&&o!==(o=""+(e[0]+e[6]))&&V(t,"href",o)},d(e){e&&P(t)}}}function It(t){let n,r,o;return{c(){n=I("button"),n.textContent=""+("en"===_e?"Delete all regions similarity":"Supprimer toutes les similarités du document"),V(n,"class","tag is-danger")},m(e,i){C(e,n,i),r||(o=M(n,"click",t[5]),r=!0)},p:e,d(e){e&&P(n),r=!1,o()}}}function Lt(t){let n,r,o;return{c(){n=I("button"),n.textContent=""+("en"===_e?"Delete regions record":"Supprimer l'intégralité des régions"),V(n,"class","tag is-danger")},m(e,i){C(e,n,i),r||(o=M(n,"click",t[4]),r=!0)},p:e,d(e){e&&P(n),r=!1,o()}}}function Ot(t){let n;function r(e,t){return e[1]?Pt:Ct}let o=r(t),i=o(t);return{c(){n=I("div"),i.c()},m(e,t){C(e,n,t),i.m(n,null)},p(e,[t]){o===(o=r(e))&&i?i.p(e,t):(i.d(1),i=o(e),i&&(i.c(),i.m(n,null)))},i:e,o:e,d(e){e&&P(n),i.d()}}}function Rt(e,t,n){const r=K("witness");let{baseUrl:o=`${window.location.origin}${window.location.pathname}`}=t,{currentRegionId:i}=t,{currentLayout:s}=t;return e.$$set=e=>{"baseUrl"in e&&n(0,o=e.baseUrl),"currentRegionId"in e&&n(1,i=e.currentRegionId),"currentLayout"in e&&n(2,s=e.currentLayout)},[o,i,s,r,async function(){if(!await tt("en"===_e?"Are you sure you want to delete this record?":"Voulez-vous vraiment supprimer cet enregistrement ?","en"===_e?"Confirm deletion":"Confirmer la suppression",!0))return;if("number"!=typeof i)throw new Error("Invalid region ID");const e=`${window.location.origin}/${je}/regions/${i}/delete`;try{const t=await Ge((()=>fetch(e,{method:"DELETE",headers:{"X-CSRFToken":qe}})));if(204!==t.status)throw new Error(`Failed to delete regions: '${t.statusText}'`);window.location.href=`${o.split("regions/")[0]}regions/`}catch(e){console.error(e)}},async function(){if(!await tt("en"===_e?"Are you sure you want to delete all similarity scores for this document?":"Voulez-vous vraiment supprimer l'intégralité des scores de similarité pour ce document ?","en"===_e?"Confirm deletion":"Confirmer la suppression",!0))return;if("number"!=typeof i)throw new Error("Invalid region ID");const e=`${window.location.origin}/${je}/similarity/reset/${i}`;try{const t=await Ge((()=>fetch(e,{method:"DELETE",headers:{"X-CSRFToken":qe}})));if(204!==t.status&&200!==t.status)throw new Error(`Failed to delete similarity: '${t.statusText}'`);window.location.href=`${o.split("regions/")[0]}regions/`}catch(e){console.error(e),await tt(e.message,"Error")}}]}class At extends Le{constructor(e){super(),Ie(this,e,Rt,Ot,s,{baseUrl:0,currentRegionId:1,currentLayout:2})}}function Mt(e){let t;return{c(){t=L("path"),V(t,"d","M471.6 21.7c-21.9-21.9-57.3-21.9-79.2 0L362.3 51.7l97.9 97.9 30.1-30.1c21.9-21.9 21.9-57.3 0-79.2L471.6 21.7zm-299.2 220c-6.1 6.1-10.8 13.6-13.5 21.9l-29.6 88.8c-2.9 8.6-.6 18.1 5.8 24.6s15.9 8.7 24.6 5.8l88.8-29.6c8.2-2.7 15.7-7.4 21.9-13.5L437.7 172.3 339.7 74.3 172.4 241.7zM96 64C43 64 0 107 0 160V416c0 53 43 96 96 96H352c53 0 96-43 96-96V320c0-17.7-14.3-32-32-32s-32 14.3-32 32v96c0 17.7-14.3 32-32 32H96c-17.7 0-32-14.3-32-32V160c0-17.7 14.3-32 32-32h96c17.7 0 32-14.3 32-32s-14.3-32-32-32H96z"),V(t,"class","svelte-h0t5l9")},m(e,n){C(e,t,n)},d(e){e&&P(t)}}}function Tt(e){let t;return{c(){t=L("path"),V(t,"d","M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"),V(t,"class","svelte-h0t5l9")},m(e,n){C(e,t,n)},d(e){e&&P(t)}}}function Vt(t){let n,r="en"===_e?"Edit":"Modifier";return{c(){n=O(r)},m(e,t){C(e,n,t)},p:e,d(e){e&&P(n)}}}function _t(t){let n,r="en"===_e?"Validate":"Valider";return{c(){n=O(r)},m(e,t){C(e,n,t)},p:e,d(e){e&&P(n)}}}function jt(t){let n,r,i,s,a,l,c,u,d,f,p,m,g,h,$,v,b="en"===_e?"Reload":"Recharger",w="en"===_e?"Go to editor":"Aller à l'éditeur",y="en"===_e?"Delete selected regions":"Supprimer les régions sélectionnées";return{c(){n=I("button"),r=I("i"),i=R(),s=O(b),a=R(),l=I("a"),c=I("i"),u=R(),d=O(w),f=R(),p=I("button"),m=I("i"),g=R(),h=O(y),V(r,"class","fa-solid fa-rotate-right"),V(n,"class","tag is-link is-light is-rounded mr-3"),V(c,"class","fa-solid fa-edit"),V(l,"class","tag is-link is-rounded mr-3"),V(l,"href",et(t[4])),V(l,"target","_blank"),V(m,"class","fa-solid fa-trash"),V(p,"class","tag is-danger is-rounded")},m(e,o){C(e,n,o),k(n,r),k(n,i),k(n,s),C(e,a,o),C(e,l,o),k(l,c),k(l,u),k(l,d),C(e,f,o),C(e,p,o),k(p,m),k(p,g),k(p,h),$||(v=[M(n,"click",t[14]),M(p,"click",t[6])],$=!0)},p:e,d(e){e&&P(n),e&&P(a),e&&P(l),e&&P(f),e&&P(p),$=!1,o(v)}}}function Ut(t){let n,r,i,s,a,l,c,u,d,f,p,m,g,h,$,v,b,w,y,x="en"===_e?"Download":"Télécharger";function S(e,t){return e[0]?Tt:Mt}let E=S(t),N=E(t);function A(e,t){return e[0]?_t:Vt}let T=A(t),_=T(t),j=t[0]&&jt(t);return{c(){n=I("div"),r=I("button"),i=L("svg"),N.c(),s=R(),_.c(),l=R(),c=I("button"),u=I("i"),d=R(),f=I("span"),f.textContent=""+("en"===_e?"Select all":"Tout sélectionner"),p=R(),m=I("button"),g=I("i"),h=R(),$=O(x),v=R(),b=I("div"),j&&j.c(),V(i,"xmlns","http://www.w3.org/2000/svg"),V(i,"viewBox","0 0 384 512"),V(i,"class","pr-3 svelte-h0t5l9"),V(r,"class",a="button "+(t[0]?"is-success":"is-link")+" mr-3"),V(u,"class","fa-solid fa-square-check"),V(f,"id","all-selection"),V(c,"class","button is-link is-light mr-3"),V(g,"class","fa-solid fa-download"),V(m,"class","button is-link is-light"),V(n,"class","is-right mb-3"),V(b,"class","edit-action is-right svelte-h0t5l9")},m(e,o){C(e,n,o),k(n,r),k(r,i),N.m(i,null),k(r,s),_.m(r,null),k(n,l),k(n,c),k(c,u),k(c,d),k(c,f),k(n,p),k(n,m),k(m,g),k(m,h),k(m,$),C(e,v,o),C(e,b,o),j&&j.m(b,null),w||(y=[M(r,"click",t[13]),M(c,"click",t[7]),M(m,"click",t[8])],w=!0)},p(e,[t]){E!==(E=S(e))&&(N.d(1),N=E(e),N&&(N.c(),N.m(i,null))),T===(T=A(e))&&_?_.p(e,t):(_.d(1),_=T(e),_&&(_.c(),_.m(r,null))),1&t&&a!==(a="button "+(e[0]?"is-success":"is-link")+" mr-3")&&V(r,"class",a),e[0]?j?j.p(e,t):(j=jt(e),j.c(),j.m(b,null)):j&&(j.d(1),j=null)},i:e,o:e,d(e){e&&P(n),N.d(),_.d(),e&&P(v),e&&P(b),j&&j.d(),w=!1,o(y)}}}async function qt(e){const t=SAS_APP_URL.replace("https","http"),n=`${SAS_APP_URL}/annotation/destroy?uri=${t}/annotation/${e}`,r=await fetch(n,{method:"DELETE"});if(204!==r.status)throw new Error(`Failed to delete ${n} due to ${r.status}: '${r.statusText}'`)}function zt(e,t,n){let r,o,i,s,a,l,c;const{selected:u,nbSelected:f}=rt;d(e,u,(e=>n(10,a=e))),d(e,f,(e=>n(12,c=e)));const{allRegions:p}=ot;d(e,p,(e=>n(11,l=e)));const m=K("manifest"),g=K("isValidated");function h(){n(0,o=!o)}return e.$$.update=()=>{4096&e.$$.dirty&&n(9,r=c(!0)),1024&e.$$.dirty&&(i=a(!0)),2560&e.$$.dirty&&(s=r>=Object.keys(l).length)},n(0,o=!g),[o,u,f,p,m,h,async function(){if(await tt("en"===_e?"Are you sure you want to delete these regions?":"Voulez-vous vraiment supprimer ces régions ?","en"===_e?"Confirm deletion":"Confirmer la suppression",!0))for(const e of Object.keys(i))try{if(!l.hasOwnProperty(e))continue;await qt(e),ot.remove(e),rt.remove(e,De)}catch(t){await tt(`Failed to delete region ${e}: ${t.message}`,"Error")}},function(){s?rt.removeAll(Object.keys(l),De):rt.addAll(Object.values(l))},async function(){const e=Object.values(a(!0)).map((e=>e.ref)),t=await Ge((()=>fetch(`${window.location.origin}/${je}/regions/export`,{method:"POST",headers:{"X-CSRFToken":qe},body:JSON.stringify({regionsRef:e})})));nt(await t.blob(),"regions.zip")},r,a,l,c,()=>h(),()=>location.reload()]}class Dt extends Le{constructor(e){super(),Ie(this,e,zt,Ut,s,{})}}const Ht=function(){const e=`${window.location.origin}${window.location.pathname}`,t=window.location.pathname.match(/\d+/g).join("-"),n={[t]:{}},r=Te(1),o=Te({});let i=JSON.parse(localStorage.getItem("selectedRegions"));i&&!i.hasOwnProperty(t)&&(i=n);const s=Te(i||n),a=Te(JSON.parse(localStorage.getItem("excludedCategories"))||[]),l=Te([]),c=Te([]),d=()=>Ye(r,"sp"),f=Ve(r,(e=>(async()=>function(e){const t=25*(e-1),n=t+25,r=u(l).slice(t,n);return c.set(r),r}(e))()));function p(e){Qe(e,r,"sp")}function m(e){localStorage.setItem("selectedRegions",JSON.stringify(e))}const g=Ve(s,(e=>n=>e[t]?.hasOwnProperty(n)));return{currentPage:r,comparedRegions:o,excludedCategories:a,qImgs:l,pageQImgs:c,selectedRegions:s,fetchSimilarity:async function(){Je.set(!0);try{const t=await fetch(`${e}compared-regions`),n=await t.json();o.set(n);const r=await fetch(`${e}query-images`),i=await r.json();i.length>0&&(l.set(i),p(d()))}catch(e){console.error("Error:",e),Ze.set(e.message)}finally{Je.set(!1)}},setPageQImgs:f,getRegionsInfo:function(e){const t=u(o),n=Object.keys(t).filter((t=>t.startsWith(e)));return 1!==n.length?{title:"Error"}:t[n[0]]},handlePageUpdate:p,unselect:function(e){s.update((n=>{const r={...n};return delete r[t][e],m(r),r}))},select:function(e){s.update((n=>{const r={...n,[t]:{...n[t]||{},[e.ref]:e}};return m(r),r}))},addComparedRegions:function(e){o.update((t=>({...t,[e.ref]:e})))},isSelected:g,pageLength:25}}();function Ft(e){let t,n,r;const o=e[1].default,i=f(o,e,e[0],null);return{c(){t=I("table"),n=I("tbody"),i&&i.c(),V(t,"class","table is-fullwidth")},m(e,o){C(e,t,o),k(t,n),i&&i.m(n,null),r=!0},p(e,[t]){i&&i.p&&(!r||1&t)&&g(i,o,e,e[0],r?m(o,e[0],t,null):h(e[0]),null)},i(e){r||($e(i,e),r=!0)},o(e){ve(i,e),r=!1},d(e){e&&P(t),i&&i.d(e)}}}function Bt(e,t,n){let{$$slots:r={},$$scope:o}=t;return e.$$set=e=>{"$$scope"in e&&n(0,o=e.$$scope)},[o,r]}class Xt extends Le{constructor(e){super(),Ie(this,e,Bt,Ft,s,{})}}function Jt(e){let t,n,r,o,i,s,a,l,c,u=e[4]>1&&Zt(e),d=e[4]<e[3]&&Yt(e);return{c(){t=I("nav"),n=I("ul"),u&&u.c(),r=R(),o=I("li"),i=I("a"),s=O(e[4]),a=R(),d&&d.c(),V(i,"class","pagination-link is-current"),V(i,"href",null),V(n,"class","pagination-list ml-0"),V(t,"class","pagination is-centered mb-2"),V(t,"aria-label","pagination")},m(f,p){C(f,t,p),k(t,n),u&&u.m(n,null),k(n,r),k(n,o),k(o,i),k(i,s),k(n,a),d&&d.m(n,null),l||(c=M(i,"click",T(e[8])),l=!0)},p(e,t){e[4]>1?u?u.p(e,t):(u=Zt(e),u.c(),u.m(n,r)):u&&(u.d(1),u=null),16&t&&_(s,e[4]),e[4]<e[3]?d?d.p(e,t):(d=Yt(e),d.c(),d.m(n,null)):d&&(d.d(1),d=null)},d(e){e&&P(t),u&&u.d(),d&&d.d(),l=!1,c()}}}function Zt(e){let t,n,r,o,i,s,a=e[4]-1>1&&Gt(e);return{c(){t=I("li"),n=I("a"),n.textContent="1",r=R(),a&&a.c(),o=A(),V(n,"class","pagination-link"),V(n,"href",null)},m(l,c){C(l,t,c),k(t,n),C(l,r,c),a&&a.m(l,c),C(l,o,c),i||(s=M(n,"click",T(e[6])),i=!0)},p(e,t){e[4]-1>1?a?a.p(e,t):(a=Gt(e),a.c(),a.m(o.parentNode,o)):a&&(a.d(1),a=null)},d(e){e&&P(t),e&&P(r),a&&a.d(e),e&&P(o),i=!1,s()}}}function Gt(e){let t,n,r,o,i,s,a=e[4]-1+"",l=e[4]-1>2&&Wt();return{c(){l&&l.c(),t=R(),n=I("li"),r=I("a"),o=O(a),V(r,"class","pagination-link"),V(r,"href",null)},m(a,c){l&&l.m(a,c),C(a,t,c),C(a,n,c),k(n,r),k(r,o),i||(s=M(r,"click",T(e[7])),i=!0)},p(e,n){e[4]-1>2?l||(l=Wt(),l.c(),l.m(t.parentNode,t)):l&&(l.d(1),l=null),16&n&&a!==(a=e[4]-1+"")&&_(o,a)},d(e){l&&l.d(e),e&&P(t),e&&P(n),i=!1,s()}}}function Wt(e){let t;return{c(){t=I("li"),t.innerHTML='<span class="pagination-ellipsis">…</span>'},m(e,n){C(e,t,n)},d(e){e&&P(t)}}}function Yt(e){let t,n,r,o,i,s,a=e[4]+1<e[3]&&Qt(e);return{c(){a&&a.c(),t=R(),n=I("li"),r=I("a"),o=O(e[3]),V(r,"class","pagination-link"),V(r,"href",null)},m(l,c){a&&a.m(l,c),C(l,t,c),C(l,n,c),k(n,r),k(r,o),i||(s=M(r,"click",T(e[10])),i=!0)},p(e,n){e[4]+1<e[3]?a?a.p(e,n):(a=Qt(e),a.c(),a.m(t.parentNode,t)):a&&(a.d(1),a=null),8&n&&_(o,e[3])},d(e){a&&a.d(e),e&&P(t),e&&P(n),i=!1,s()}}}function Qt(e){let t,n,r,o,i,s,a,l=e[4]+1+"",c=e[4]+2<e[3]&&Kt();return{c(){t=I("li"),n=I("a"),r=O(l),o=R(),c&&c.c(),i=A(),V(n,"class","pagination-link"),V(n,"href",null)},m(l,u){C(l,t,u),k(t,n),k(n,r),C(l,o,u),c&&c.m(l,u),C(l,i,u),s||(a=M(n,"click",T(e[9])),s=!0)},p(e,t){16&t&&l!==(l=e[4]+1+"")&&_(r,l),e[4]+2<e[3]?c||(c=Kt(),c.c(),c.m(i.parentNode,i)):c&&(c.d(1),c=null)},d(e){e&&P(t),e&&P(o),c&&c.d(e),e&&P(i),s=!1,a()}}}function Kt(e){let t;return{c(){t=I("li"),t.innerHTML='<span class="pagination-ellipsis">…</span>'},m(e,n){C(e,t,n)},d(e){e&&P(t)}}}function en(t){let n,r,o,i,s,a,l,c=t[4]*t[2]-t[2]+1+"",u=Math.min(t[4]*t[2],t[1])+"",d=(t[3]>1||t[1]>t[2])&&Jt(t);return{c(){d&&d.c(),n=R(),r=I("div"),o=O(c),i=O(" - "),s=O(u),a=O(" / "),l=O(t[1]),V(r,"class","is-size-7 is-center mb-4")},m(e,t){d&&d.m(e,t),C(e,n,t),C(e,r,t),k(r,o),k(r,i),k(r,s),k(r,a),k(r,l)},p(e,[t]){e[3]>1||e[1]>e[2]?d?d.p(e,t):(d=Jt(e),d.c(),d.m(n.parentNode,n)):d&&(d.d(1),d=null),20&t&&c!==(c=e[4]*e[2]-e[2]+1+"")&&_(o,c),22&t&&u!==(u=Math.min(e[4]*e[2],e[1])+"")&&_(s,u),2&t&&_(l,e[1])},i:e,o:e,d(e){d&&d.d(e),e&&P(n),e&&P(r)}}}function tn(e,t,n){let r,o,{store:i}=t;const{currentPage:s}=i;d(e,s,(e=>n(4,o=e)));let{nbOfItems:a}=t,{pageLength:l=Xe}=t;return e.$$set=e=>{"store"in e&&n(0,i=e.store),"nbOfItems"in e&&n(1,a=e.nbOfItems),"pageLength"in e&&n(2,l=e.pageLength)},e.$$.update=()=>{6&e.$$.dirty&&n(3,r=l<Xe?1:Math.ceil(a/l))},[i,a,l,r,o,s,()=>i.handlePageUpdate(1),()=>i.handlePageUpdate(o-1),()=>i.handlePageUpdate(o),()=>i.handlePageUpdate(o+1),()=>i.handlePageUpdate(r)]}class nn extends Le{constructor(e){super(),Ie(this,e,tn,en,s,{store:0,nbOfItems:1,pageLength:2})}}const rn='<svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 68 69">\n        <rect x="10" y="10.62" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>\n        <rect x="1" y="1" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>\n        <rect x="10" y="10.62" width="46" height="45.71" rx="4.11" ry="4.11" fill="currentColor" stroke="none"/>\n    </svg>',on='<svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 70 71">\n        <rect x="12" y="12.43" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>\n        <rect x="1" y="0.81" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>\n        <path d="M 12 21.43 L 21 12.43" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>\n        <path d="M 12 30 L 30 12.43" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>\n        <path d="M 40 56 L 57 38" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>\n        <path d="M 48.3 56.29 L 57 47" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>\n        <path d="M 12 39 L 39 12" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>\n        <path d="M 12 48 L 48 12" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>\n        <path d="M 13 56 L 57 12" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>\n        <path d="M 31 56 L 57 29" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>\n        <path d="M 21 57 L 57 21" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>\n    </svg>',sn='<svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 72 73">\n        <rect x="14" y="14.43" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3" stroke-dasharray="9 9"/>\n        <rect x="1" y="0.81" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>\n    </svg>',an='<svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 59 59">\n        <rect x="1" y="0.62" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>\n        <path d="M 2.67 54.55 L 55 2" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>\n        <path d="M 54.37 54.05 L 2.72 2.24" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>\n    </svg>',ln='<svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 59 59">\n        <rect x="1" y="0.81" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>\n        <path d="M 8.69 55.28 C 9.25 44.15 18.08 35.28 28.86 35.28 C 32.5 35.28 36.07 36.3 39.18 38.25 C 44.96 41.85 48.66 48.3 49.02 55.28 Z M 17.85 21.48 C 17.85 15.37 22.79 10.39 28.86 10.39 C 34.92 10.39 39.86 15.37 39.86 21.48 C 39.86 27.59 34.92 32.56 28.86 32.56 C 22.79 32.56 17.85 27.59 17.85 21.48 Z M 40.37 36.34 C 38.43 35.13 36.32 34.25 34.13 33.7 C 38.82 31.64 42.1 26.94 42.1 21.48 C 42.1 14.13 36.16 8.15 28.86 8.15 C 21.55 8.15 15.61 14.13 15.61 21.48 C 15.61 26.95 18.9 31.66 23.6 33.71 C 13.76 36.18 6.41 45.4 6.41 56.4 C 6.41 57.02 6.92 57.52 7.54 57.52 L 50.17 57.52 C 50.79 57.52 51.3 57.02 51.3 56.4 C 51.3 48.23 47.11 40.54 40.37 36.34 Z" fill="currentColor" stroke="none"/>\n    </svg>',cn="en"===_e?"overall visual matches":"correspondances visuelles globales",un="en"===_e?"visual matches on part of the image":"correspondances visuelles sur une partie de l'image",dn="en"===_e?"semantic and non-visual matches":"correspondances sémantiques et non-visuelle",fn="en"===_e?"regions without match":"régions sans correspondance",pn="en"===_e?"user specific category":"correspondances spécifiques à l'utilisateur";function mn(e){let t,n,r,i,s,a,l,c,u,d,f,p,m,g,h,$;return n=new ht({props:{item:e[2],size:256,desc:e[3],isSquare:!1}}),{c(){t=I("div"),Ee(n.$$.fragment),r=R(),i=I("div"),s=I("span"),a=R(),l=I("span"),c=R(),u=I("span"),d=R(),f=I("span"),p=R(),m=I("span"),V(s,"class","tag is-hoverable pl-4 pr-3 py-4"),V(s,"title","en"===_e?"Exact match":"Correspondance exacte"),q(s,"is-selected",1===e[0]),V(l,"class","tag is-hoverable py-4 px-3"),V(l,"title","en"===_e?"Partial match":"Correspondance partielle"),q(l,"is-selected",2===e[0]),V(u,"class","tag is-hoverable py-4 px-3"),V(u,"title","en"===_e?"Semantic match":"Correspondance sémantique"),q(u,"is-selected",3===e[0]),V(f,"class","tag is-hoverable py-4 px-3"),V(f,"title","en"===_e?"No match":"Aucune correspondance"),q(f,"is-selected",4===e[0]),V(m,"class","tag is-hoverable pl-3 pr-4 py-4"),V(m,"title","en"===_e?"User match":"Correspondance utilisateur"),q(m,"is-selected",e[1]),V(i,"class","tags has-addons is-dark is-center")},m(o,v){C(o,t,v),Ce(n,t,null),k(t,r),k(t,i),k(i,s),s.innerHTML=rn,k(i,a),k(i,l),l.innerHTML=on,k(i,c),k(i,u),u.innerHTML=sn,k(i,d),k(i,f),f.innerHTML=an,k(i,p),k(i,m),m.innerHTML=ln,g=!0,h||($=[M(s,"click",e[13]),M(s,"keyup",null),M(l,"click",e[14]),M(l,"keyup",null),M(u,"click",e[15]),M(u,"keyup",null),M(f,"click",e[16]),M(f,"keyup",null),M(m,"click",e[17]),M(m,"keyup",null)],h=!0)},p(e,[t]){(!g||1&t)&&q(s,"is-selected",1===e[0]),(!g||1&t)&&q(l,"is-selected",2===e[0]),(!g||1&t)&&q(u,"is-selected",3===e[0]),(!g||1&t)&&q(f,"is-selected",4===e[0]),(!g||2&t)&&q(m,"is-selected",e[1])},i(e){g||($e(n.$$.fragment,e),g=!0)},o(e){ve(n.$$.fragment,e),g=!1},d(e){e&&P(t),Pe(n),h=!1,o($)}}}function gn(e,t,n){let r,o;const i=new URL(window.location.href),s=i.origin;i.pathname;let{qImg:a}=t,{sImg:l}=t,{qRegions:c}=t,{sRegions:u}=t,{score:d=0}=t,{category:f=null}=t,{users:p=[]}=t,{isManual:m}=t;const g=K("similarityPropagatedContext")||!1,[h,$,v,b]=l.split(".")[0].split("_"),w={id:l,img:l,title:`Canvas ${v} - ${b} - ${"en"===_e?"Witness":"Témoin"} #${y=h,y.match(/\d+/g).toString()}`,xywh:b,canvas:v,ref:l.replace(".jpg",""),type:De};var y;const x=`${h}_${$}`,k=`${Ht.getRegionsInfo(x).title}<br>\n        Page ${parseInt(v)}<br>\n        <b>${d?`Score: ${d}`:"en"===_e?"Manual similarity":"Correspondance manuelle"}</b>`;function S(e){let t=(e=e.slice()).indexOf(Number(Ue));return o&&-1===t?e.push(Number(Ue)):o||-1===t||e.splice(t,1),e}const E=()=>({img_1:a,img_2:l,regions_id_1:c,regions_id_2:u,score:d,category:r,category_x:S(p),is_manual:m||g});function C(e){5===e?n(1,o=!o):n(0,r=r===e?null:e)}async function P(e){console.log("categorize called !"),C(e),console.log(E());try{const t=await fetch(`${s}/${je}/save-category`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":qe},body:JSON.stringify(E())});t.ok?t.json().then((e=>console.log("categorize success response",e))):(console.error("Error: Network response was not ok"),C(e))}catch(t){console.error("Error:",t),C(e)}}return e.$$set=e=>{"qImg"in e&&n(5,a=e.qImg),"sImg"in e&&n(6,l=e.sImg),"qRegions"in e&&n(7,c=e.qRegions),"sRegions"in e&&n(8,u=e.sRegions),"score"in e&&n(9,d=e.score),"category"in e&&n(10,f=e.category),"users"in e&&n(11,p=e.users),"isManual"in e&&n(12,m=e.isManual)},e.$$.update=()=>{1024&e.$$.dirty&&n(0,r=f),2048&e.$$.dirty&&n(1,o=p.includes(Number(Ue))||!1)},[r,o,w,k,P,a,l,c,u,d,f,p,m,()=>P(1),()=>P(2),()=>P(3),()=>P(4),()=>P(5)]}class hn extends Le{constructor(e){super(),Ie(this,e,gn,mn,s,{qImg:5,sImg:6,qRegions:7,sRegions:8,score:9,category:10,users:11,isManual:12})}}function $n(e,t,n){const r=e.slice();return r[6]=t[n][0],r[7]=t[n][1],r[8]=t[n][2],r[9]=t[n][3],r[10]=t[n][4],r[11]=t[n][5],r[12]=t[n][6],r[13]=t[n][7],r}function vn(t){let n,r,o="en"===_e?`Error when retrieving similar regions: ${t[16]}`:`Erreur de recupération des régions similaires: ${t[16]}`;return{c(){n=I("div"),r=O(o),V(n,"class","faded is-center")},m(e,t){C(e,n,t),k(n,r)},p(e,t){2&t&&o!==(o="en"===_e?`Error when retrieving similar regions: ${e[16]}`:`Erreur de recupération des régions similaires: ${e[16]}`)&&_(r,o)},i:e,o:e,d(e){e&&P(n)}}}function bn(e){let t,n,r=e[5],o=[];for(let t=0;t<r.length;t+=1)o[t]=kn($n(e,r,t));const i=e=>ve(o[e],1,1,(()=>{o[e]=null}));let s=null;return r.length||(s=wn(e)),{c(){for(let e=0;e<o.length;e+=1)o[e].c();t=A(),s&&s.c()},m(e,r){for(let t=0;t<o.length;t+=1)o[t]&&o[t].m(e,r);C(e,t,r),s&&s.m(e,r),n=!0},p(e,n){if(7&n){let a;for(r=e[5],a=0;a<r.length;a+=1){const i=$n(e,r,a);o[a]?(o[a].p(i,n),$e(o[a],1)):(o[a]=kn(i),o[a].c(),$e(o[a],1),o[a].m(t.parentNode,t))}for(ge(),a=r.length;a<o.length;a+=1)i(a);he(),!r.length&&s?s.p(e,n):r.length?s&&(s.d(1),s=null):(s=wn(e),s.c(),s.m(t.parentNode,t))}},i(e){if(!n){for(let e=0;e<r.length;e+=1)$e(o[e]);n=!0}},o(e){o=o.filter(Boolean);for(let e=0;e<o.length;e+=1)ve(o[e]);n=!1},d(e){N(o,e),e&&P(t),s&&s.d(e)}}}function wn(e){let t,n;function r(e,n){return 4&n&&(t=null),null==t&&(t=!(0!==Object.values(e[2]).length)),t?xn:yn}let o=r(e,-1),i=o(e);return{c(){i.c(),n=A()},m(e,t){i.m(e,t),C(e,n,t)},p(e,t){o===(o=r(e,t))&&i?i.p(e,t):(i.d(1),i=o(e),i&&(i.c(),i.m(n.parentNode,n)))},d(e){i.d(e),e&&P(n)}}}function yn(t){let n;return{c(){n=I("div"),n.textContent=("en"===_e?"No similar regions":"Pas de régions similaires")+" \n            ",V(n,"class","faded is-center")},m(e,t){C(e,n,t)},p:e,d(e){e&&P(n)}}}function xn(t){let n;return{c(){n=I("div"),n.textContent=("en"===_e?"No document selected":"Aucun document sélectionné")+" \n            ",V(n,"class","faded is-center")},m(e,t){C(e,n,t)},p:e,d(e){e&&P(n)}}}function kn(e){let t,n;return t=new hn({props:{qImg:e[0],sImg:e[8],score:e[6],qRegions:e[9],sRegions:e[10],category:e[11],users:e[12],isManual:e[13]}}),{c(){Ee(t.$$.fragment)},m(e,r){Ce(t,e,r),n=!0},p(e,n){const r={};1&n&&(r.qImg=e[0]),2&n&&(r.sImg=e[8]),2&n&&(r.score=e[6]),2&n&&(r.qRegions=e[9]),2&n&&(r.sRegions=e[10]),2&n&&(r.category=e[11]),2&n&&(r.users=e[12]),2&n&&(r.isManual=e[13]),t.$set(r)},i(e){n||($e(t.$$.fragment,e),n=!0)},o(e){ve(t.$$.fragment,e),n=!1},d(e){Pe(t,e)}}}function Sn(t){let n;return{c(){n=I("div"),n.textContent=""+("en"!==_e||t[4]?"fr"!==_e||t[4]?"en"===_e&&t[4]?"Retrieving propagated regions...":"Récupération de similarités propagées...":"Récupération des régions similaires...":"Retrieving similar regions..."),V(n,"class","faded is-center")},m(e,t){C(e,n,t)},p:e,i:e,o:e,d(e){e&&P(n)}}}function En(e){let t,n,r,o={ctx:e,current:null,token:null,hasCatch:!0,pending:Sn,then:bn,catch:vn,value:5,error:16,blocks:[,,,]};return ye(n=e[1],o),{c(){t=A(),o.block.c()},m(e,n){C(e,t,n),o.block.m(e,o.anchor=n),o.mount=()=>t.parentNode,o.anchor=t,r=!0},p(t,[r]){e=t,o.ctx=e,2&r&&n!==(n=e[1])&&ye(n,o)||xe(o,e,r)},i(e){r||($e(o.block),r=!0)},o(e){for(let e=0;e<3;e+=1){ve(o.blocks[e])}r=!1},d(e){e&&P(t),o.block.d(e),o.token=null,o=null}}}function Cn(e,t,n){let r;const{selectedRegions:o}=Ht;d(e,o,(e=>n(2,r=e)));let{qImg:i}=t,{sImgsPromise:s}=t;const a=K("similarityPropagatedContext")||!1;return e.$$set=e=>{"qImg"in e&&n(0,i=e.qImg),"sImgsPromise"in e&&n(1,s=e.sImgsPromise)},[i,s,r,o,a]}class Pn extends Le{constructor(e){super(),Ie(this,e,Cn,En,s,{qImg:0,sImgsPromise:1})}}function Nn(e){let t,n,r;return n=new Pn({props:{qImg:e[0],sImgsPromise:e[1],displayType:"similarityMatches"}}),{c(){t=I("div"),Ee(n.$$.fragment),V(t,"class","grid is-gap-2")},m(e,o){C(e,t,o),Ce(n,t,null),r=!0},p(e,[t]){const r={};1&t&&(r.qImg=e[0]),2&t&&(r.sImgsPromise=e[1]),n.$set(r)},i(e){r||($e(n.$$.fragment,e),r=!0)},o(e){ve(n.$$.fragment,e),r=!1},d(e){e&&P(t),Pe(n)}}}function In(e,t,n){let r,o,i;const{selectedRegions:s,excludedCategories:a}=Ht;d(e,s,(e=>n(5,i=e))),d(e,a,(e=>n(4,o=e)));const l=`${window.location.origin}${window.location.pathname}`,c=window.location.pathname.match(/\d+/g).join("-");let{qImg:u}=t;return e.$$set=e=>{"qImg"in e&&n(0,u=e.qImg)},e.$$.update=()=>{49&e.$$.dirty&&n(1,r=async function(e,t,n){if(0===Object.values(t).map((e=>e.id)).length)return{};const r=await fetch(`${l}similar-images`,{method:"POST",body:JSON.stringify({regionsIds:Object.values(t[c]).map((e=>e.id)),qImg:e,topk:10,excludedCategories:n}),headers:{"Content-Type":"application/json","X-CSRFToken":qe}});return await r.json()}(u,i,o))},[u,r,s,a,o,i]}class Ln extends Le{constructor(e){super(),Ie(this,e,In,Nn,s,{qImg:0})}}function On(t){let n,r,o;return{c(){n=I("span"),r=O(t[0]),V(n,"id",t[3]),V(n,"class",o="tooltip "+t[2]+" "+(t[1]?"display":"")+" svelte-1mx5qza")},m(e,t){C(e,n,t),k(n,r)},p(e,[t]){1&t&&_(r,e[0]),6&t&&o!==(o="tooltip "+e[2]+" "+(e[1]?"display":"")+" svelte-1mx5qza")&&V(n,"class",o)},i:e,o:e,d(e){e&&P(n)}}}function Rn(e,t,n){let r,o,i,{tooltipText:s}=t,{targetHtmlId:a}=t;const l=`tooltip-generic-${window.crypto.randomUUID()}`;var c;return W((()=>{o=a?document.getElementById(a):document.getElementById(l).parentElement,a&&!o&&(console.error(`TooltipGeneric: element with ID ${a}, defaulting to the parent element`),o=document.getElementById(l).targetElement),o.addEventListener("mouseover",(()=>n(1,i=!0))),o.addEventListener("mouseout",(()=>n(1,i=!1))),o.addEventListener("click",(()=>n(1,i=!i)))})),c=()=>{["mouseover","mouseout","click"].forEach(o.removeEventListener)},G().$$.on_destroy.push(c),e.$$set=e=>{"tooltipText"in e&&n(0,s=e.tooltipText),"targetHtmlId"in e&&n(4,a=e.targetHtmlId)},n(2,r=n(2,r=s.length<20?"tooltip-thin":s.length<100?"tooltip-mid":"tooltip-wide")),o=void 0,n(1,i=!1),[s,i,r,l,a]}class An extends Le{constructor(e){super(),Ie(this,e,Rn,On,s,{tooltipText:0,targetHtmlId:4})}}function Mn(e){let t,n,r,o,i,s;return i=new An({props:{tooltipText:e[2]}}),{c(){t=I("div"),n=I("button"),r=I("span"),o=R(),Ee(i.$$.fragment),V(r,"class","iconify"),V(r,"data-icon",e[0]),V(r,"title",e[1]),V(n,"class","svelte-gmxkvo"),V(t,"class","is-inline-block icon-tooltip svelte-gmxkvo")},m(e,a){C(e,t,a),k(t,n),k(n,r),k(n,o),Ce(i,n,null),s=!0},p(e,[t]){(!s||1&t)&&V(r,"data-icon",e[0]),(!s||2&t)&&V(r,"title",e[1]);const n={};4&t&&(n.tooltipText=e[2]),i.$set(n)},i(e){s||($e(i.$$.fragment,e),s=!0)},o(e){ve(i.$$.fragment,e),s=!1},d(e){e&&P(t),Pe(i)}}}function Tn(e,t,n){let{iconifyIcon:r,altText:o,tooltipText:i}=t;return e.$$set=e=>{"iconifyIcon"in e&&n(0,r=e.iconifyIcon),"altText"in e&&n(1,o=e.altText),"tooltipText"in e&&n(2,i=e.tooltipText)},[r,o,i]}class Vn extends Le{constructor(e){super(),Ie(this,e,Tn,Mn,s,{iconifyIcon:0,altText:1,tooltipText:2})}}function _n(t){return{c:e,m:e,p:e,i:e,o:e,d:e}}function jn(e){let t,n,r,o,i,s,a=e[5].length+"",l=e[5].length>1?"es":"";return i=new Vn({props:{iconifyIcon:"material-symbols:help-outline",altText:"en"===_e?"Display help":"Afficher une explication",tooltipText:e[2]}}),{c(){t=O(a),n=O(" propagated match"),r=O(l),o=R(),Ee(i.$$.fragment)},m(e,a){C(e,t,a),C(e,n,a),C(e,r,a),C(e,o,a),Ce(i,e,a),s=!0},p(e,n){(!s||2&n)&&a!==(a=e[5].length+"")&&_(t,a),(!s||2&n)&&l!==(l=e[5].length>1?"es":"")&&_(r,l)},i(e){s||($e(i.$$.fragment,e),s=!0)},o(e){ve(i.$$.fragment,e),s=!1},d(e){e&&P(t),e&&P(n),e&&P(r),e&&P(o),Pe(i,e)}}}function Un(t){return{c:e,m:e,p:e,i:e,o:e,d:e}}function qn(e){let t,n,r,o,i,s,a,l,c={ctx:e,current:null,token:null,hasCatch:!1,pending:Un,then:jn,catch:_n,value:5,blocks:[,,,]};return ye(o=e[1],c),a=new Pn({props:{qImg:e[0],sImgsPromise:e[1],displayType:"suggestionMatches"}}),{c(){t=I("div"),n=I("div"),r=I("div"),c.block.c(),i=R(),s=I("div"),Ee(a.$$.fragment),V(r,"class","block"),V(s,"class","grid is-gap-2"),V(n,"class","matches-suggestion svelte-1li2qm8"),V(t,"class","block matches-suggestion-wrapper svelte-1li2qm8")},m(e,o){C(e,t,o),k(t,n),k(n,r),c.block.m(r,c.anchor=null),c.mount=()=>r,c.anchor=null,k(n,i),k(n,s),Ce(a,s,null),l=!0},p(t,[n]){e=t,c.ctx=e,2&n&&o!==(o=e[1])&&ye(o,c)||xe(c,e,n);const r={};1&n&&(r.qImg=e[0]),2&n&&(r.sImgsPromise=e[1]),a.$set(r)},i(e){l||($e(c.block),$e(a.$$.fragment,e),l=!0)},o(e){for(let e=0;e<3;e+=1){ve(c.blocks[e])}ve(a.$$.fragment,e),l=!1},d(e){e&&P(t),c.block.d(),c.token=null,c=null,Pe(a)}}}function zn(e,t,n){let r,{qImg:o}=t;Q("similarityPropagatedContext",!0);const i=`${window.location.origin}${window.location.pathname}`,s="en"===_e?"Propagated matches are exact matches to images that have an exact match with the current image. There may be up to 5 exact matches connecting the current image and propagated images.":"Les correspondances propagées correspondent à des correspondances exactes à des images ayant une correspondance exacte avec l'image actuelle. Il peut y avoir jusqu'à 5 images reliant l'image actuelle à une correspondance propagée.";return e.$$set=e=>{"qImg"in e&&n(0,o=e.qImg)},n(1,r=(async()=>fetch(`${i}propagated-matches/${o}`).then((e=>e.json())))()),[o,r,s]}class Dn extends Le{constructor(e){super(),Ie(this,e,zn,qn,s,{qImg:0})}}function Hn(e){let t,n,r,i,s,a,c,u,d,f,p,m,g,h,$,v,b,w,y,x,S,E,N,A,T,_,q,z,D,H,F,B,X=parseInt(e[4])+"";return _=new Ln({props:{qImg:e[0]}}),D=new Dn({props:{qImg:e[0]}}),{c(){t=I("tr"),n=I("th"),r=I("div"),i=I("a"),s=I("i"),a=O("\n                Page "),c=O(X),u=R(),d=I("img"),p=R(),m=I("div"),g=I("div"),h=I("input"),$=R(),v=I("button"),v.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M256 80c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 144L48 224c-17.7 0-32 14.3-32 32s14.3 32 32 32l144 0 0 144c0 17.7 14.3 32 32 32s32-14.3 32-32l0-144 144 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-144 0 0-144z"></path></svg>',b=R(),w=I("button"),y=L("svg"),x=L("path"),N=R(),A=I("td"),T=I("div"),Ee(_.$$.fragment),q=R(),z=I("div"),Ee(D.$$.fragment),V(s,"class","fa-solid fa-pen-to-square"),V(i,"class","tag px-2 py-1 mb-2 is-rounded is-hoverable"),V(i,"href",et(e[5],parseInt(e[4]))),V(i,"target","_blank"),l(d.src,f=Ke(e[0],"full","250,"))||V(d,"src",f),V(d,"alt","Query region"),V(d,"class","mb-3 card"),V(h,"class","input is-small tag"),V(h,"type","text"),V(h,"placeholder","en"===_e?"Add new match":"Ajouter une correspondance"),V(v,"class","button is-small tag is-link is-center"),V(g,"class","tags has-addons"),U(g,"flex-wrap","nowrap"),V(x,"fill","white"),V(x,"d","M376.6 84.5c11.3-13.6 9.5-33.8-4.1-45.1s-33.8-9.5-45.1 4.1L192 206 56.6 43.5C45.3 29.9 25.1 28.1 11.5 39.4S-3.9 70.9 7.4 84.5L150.3 256 7.4 427.5c-11.3 13.6-9.5 33.8 4.1 45.1s33.8 9.5 45.1-4.1L192 306 327.4 468.5c11.3 13.6 31.5 15.4 45.1 4.1s15.4-31.5 4.1-45.1L233.7 256 376.6 84.5z"),V(y,"xmlns","http://www.w3.org/2000/svg"),V(y,"viewBox","0 0 384 512"),V(w,"id","no-match"),V(w,"class",S="button is-small tag is-danger is-center m-0 "+(1===e[2]?"visible":"")+" svelte-f4c92p"),V(w,"title","en"===_e?"No match for this region in this witness":"Aucune correspondance de cette région pour ce témoin"),V(m,"class","new-similarity control pt-2 is-center svelte-f4c92p"),V(r,"class","content-wrapper py-5"),V(n,"class","is-3 center-flex is-narrow"),U(n,"width","260px"),V(T,"class","fixed-grid has-5-cols"),V(z,"class","fixed-grid has-5-cols"),V(A,"class","p-5 is-fullwidth")},m(o,l){C(o,t,l),k(t,n),k(n,r),k(r,i),k(i,s),k(i,a),k(i,c),k(r,u),k(r,d),k(r,p),k(r,m),k(m,g),k(g,h),j(h,e[1]),k(g,$),k(g,v),k(m,b),k(m,w),k(w,y),k(y,x),k(t,N),k(t,A),k(A,T),Ce(_,T,null),k(A,q),k(A,z),Ce(D,z,null),H=!0,F||(B=[M(h,"input",e[9]),M(v,"click",e[6]),M(w,"click",e[7])],F=!0)},p(e,[t]){(!H||1&t&&!l(d.src,f=Ke(e[0],"full","250,")))&&V(d,"src",f),2&t&&h.value!==e[1]&&j(h,e[1]),(!H||4&t&&S!==(S="button is-small tag is-danger is-center m-0 "+(1===e[2]?"visible":"")+" svelte-f4c92p"))&&V(w,"class",S);const n={};1&t&&(n.qImg=e[0]),_.$set(n);const r={};1&t&&(r.qImg=e[0]),D.$set(r)},i(e){H||(se((()=>{H&&(E||(E=we(w,Re,{duration:500},!0)),E.run(1))})),$e(_.$$.fragment,e),$e(D.$$.fragment,e),H=!0)},o(e){E||(E=we(w,Re,{duration:500},!1)),E.run(0),ve(_.$$.fragment,e),ve(D.$$.fragment,e),H=!1},d(e){e&&P(t),e&&E&&E.end(),Pe(_),Pe(D),F=!1,o(B)}}}function Fn(e,t,n){let r,o;const{selectedRegions:i}=Ht;d(e,i,(e=>n(8,o=e)));let{qImg:s}=t,a="";const[l,c,u,f]=s.split(".")[0].split("_"),p=K("manifest"),m=`${window.location.origin}${window.location.pathname}`,g=window.location.pathname.match(/\d+/g).join("-"),h="en"===_e?"Error":"Erreur";return e.$$set=e=>{"qImg"in e&&n(0,s=e.qImg)},e.$$.update=()=>{256&e.$$.dirty&&n(2,r=o.hasOwnProperty(g)?Object.values(o[g]).length:0)},[s,a,r,i,u,p,async function(){var e;if(a&&(e=(e=a).replace(".jpg",""),/^wit\d+_[a-zA-Z]{3}\d+_\d+_\d+,\d+,\d+,\d+$/.test(e)))try{const e=await fetch(`${m}add-region-pair`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":qe},body:JSON.stringify({q_img:s.replace(".jpg",""),s_img:a})});e.ok||(console.error("Error: Network response was not ok"),await tt("en"===_e?"Problem with network, match was not added":"Problème de réseau, la correspondance n'a pas été ajoutée",h));const t=await e.json();if(t.hasOwnProperty("error")||!t.hasOwnProperty("s_regions"))return void await tt("en"===_e?`Request was unsuccessful, match was not added:<br>${t.error}`:`La requête n'a pas abouti, la correspondance n'a pas été ajoutée :<br>${t.error}`,h);const n=t.s_regions;Ht.addComparedRegions(n),Ht.select(n)}catch(e){console.error("Error:",e),await tt("en"===_e?`An error has occurred, match was not added:<br>${e}`:`Une erreur s'est produite, la correspondance n'a pas été ajoutée :<br>${e}`,h)}else await tt("en"===_e?"Please insert a valid region reference to add a new match":"Veuillez insérer une référence de région valide pour ajouter une nouvelle correspondance","Error")},async function(){const e=Object.values(o[g])[0];if(await tt("en"===_e?`Do you confirm this region does not have any match in ${e.title}?`:`Confirmez-vous que cette région n'a pas de correspondance dans ${e.title} ?`,"en"===_e?"Confirm no match":"Confirmer l'absence de correspondance",!0))try{(await fetch(`${m}no-match`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":qe},body:JSON.stringify({q_img:s,s_regions:e.id})})).ok||(console.error("Error: Network response was not ok"),await tt("en"===_e?"Problem with network":"Problème de réseau",h)),Ht.select(e)}catch(e){console.error("Error:",e),await tt("en"===_e?`An error has occurred, request was unsuccessful:<br>${e}`:`Une erreur s'est produite, la requête n'a pas abouti :<br>${e}`,h)}},o,function(){a=this.value,n(1,a)}]}class Bn extends Le{constructor(e){super(),Ie(this,e,Fn,Hn,s,{qImg:0})}}function Xn(e,t,n){const r=e.slice();return r[8]=t[n],r}function Jn(t){let n,r,o,i=t[11]+"";return{c(){n=I("tr"),r=O("Error when retrieving similar regions: "),o=O(i)},m(e,t){C(e,n,t),k(n,r),k(n,o)},p(e,t){2&t&&i!==(i=e[11]+"")&&_(o,i)},i:e,o:e,d(e){e&&P(n)}}}function Zn(e){let t,n,r=[],o=new Map,i=e[2];const s=e=>e[8].id;for(let t=0;t<i.length;t+=1){let n=Xn(e,i,t),a=s(n);o.set(a,r[t]=Wn(a,n))}let a=null;return i.length||(a=Gn()),{c(){for(let e=0;e<r.length;e+=1)r[e].c();t=A(),a&&a.c()},m(e,o){for(let t=0;t<r.length;t+=1)r[t]&&r[t].m(e,o);C(e,t,o),a&&a.m(e,o),n=!0},p(e,n){4&n&&(i=e[2],ge(),r=Se(r,n,s,1,e,i,o,t.parentNode,ke,Wn,t,Xn),he(),!i.length&&a?a.p(e,n):i.length?a&&(a.d(1),a=null):(a=Gn(),a.c(),a.m(t.parentNode,t)))},i(e){if(!n){for(let e=0;e<i.length;e+=1)$e(r[e]);n=!0}},o(e){for(let e=0;e<r.length;e+=1)ve(r[e]);n=!1},d(e){for(let t=0;t<r.length;t+=1)r[t].d(e);e&&P(t),a&&a.d(e)}}}function Gn(t){let n,r;return{c(){n=I("tr"),n.textContent=""+("en"===_e?"No similarity":"Pas de similarités"),r=R(),V(n,"class","faded is-center")},m(e,t){C(e,n,t),C(e,r,t)},p:e,d(e){e&&P(n),e&&P(r)}}}function Wn(e,t){let n,r,o;return r=new Bn({props:{qImg:t[8]}}),{key:e,first:null,c(){n=A(),Ee(r.$$.fragment),this.first=n},m(e,t){C(e,n,t),Ce(r,e,t),o=!0},p(e,n){t=e;const o={};4&n&&(o.qImg=t[8]),r.$set(o)},i(e){o||($e(r.$$.fragment,e),o=!0)},o(e){ve(r.$$.fragment,e),o=!1},d(e){e&&P(n),Pe(r,e)}}}function Yn(t){let n;return{c(){n=I("tr"),n.textContent=""+("en"===_e?"Retrieving similarity page...":"Récupération la page de similarité..."),V(n,"class","faded is-center")},m(e,t){C(e,n,t)},p:e,i:e,o:e,d(e){e&&P(n)}}}function Qn(e){let t,n,r,o={ctx:e,current:null,token:null,hasCatch:!0,pending:Yn,then:Zn,catch:Jn,value:7,error:11,blocks:[,,,]};return ye(n=e[1],o),{c(){t=A(),o.block.c()},m(e,n){C(e,t,n),o.block.m(e,o.anchor=n),o.mount=()=>t.parentNode,o.anchor=t,r=!0},p(t,r){e=t,o.ctx=e,2&r&&n!==(n=e[1])&&ye(n,o)||xe(o,e,r)},i(e){r||($e(o.block),r=!0)},o(e){for(let e=0;e<3;e+=1){ve(o.blocks[e])}r=!1},d(e){e&&P(t),o.block.d(e),o.token=null,o=null}}}function Kn(e){let t,n,r,o,i,s,a;return n=new nn({props:{store:Ht,nbOfItems:e[0].length,pageLength:e[6]}}),o=new Xt({props:{$$slots:{default:[Qn]},$$scope:{ctx:e}}}),s=new nn({props:{store:Ht,nbOfItems:e[0].length,pageLength:e[6]}}),{c(){t=I("div"),Ee(n.$$.fragment),r=R(),Ee(o.$$.fragment),i=R(),Ee(s.$$.fragment)},m(e,l){C(e,t,l),Ce(n,t,null),k(t,r),Ce(o,t,null),k(t,i),Ce(s,t,null),a=!0},p(e,[t]){const r={};1&t&&(r.nbOfItems=e[0].length),n.$set(r);const i={};4102&t&&(i.$$scope={dirty:t,ctx:e}),o.$set(i);const a={};1&t&&(a.nbOfItems=e[0].length),s.$set(a)},i(e){a||($e(n.$$.fragment,e),$e(o.$$.fragment,e),$e(s.$$.fragment,e),a=!0)},o(e){ve(n.$$.fragment,e),ve(o.$$.fragment,e),ve(s.$$.fragment,e),a=!1},d(e){e&&P(t),Pe(n),Pe(o),Pe(s)}}}function er(e,t,n){let r,o,i;const{qImgs:s,pageQImgs:a,setPageQImgs:l,pageLength:c}=Ht;return d(e,s,(e=>n(0,r=e))),d(e,a,(e=>n(2,i=e))),d(e,l,(e=>n(1,o=e))),[r,o,i,s,a,l,c]}class tr extends Le{constructor(e){super(),Ie(this,e,er,Kn,s,{})}}function nr(e,t,n){const r=e.slice();return r[8]=t[n][0],r[9]=t[n][1],r}function rr(t){let n;return{c(){n=I("span"),n.textContent=""+("en"===_e?"current":"courant"),V(n,"class","tag is-dark svelte-503e8j")},m(e,t){C(e,n,t)},p:e,d(e){e&&P(n)}}}function or(e){let t,n,r,i,s,a,l,c,u=e[5](e[8]),d=We(e[9].title)+"",f=u&&rr();function p(){return e[6](e[9])}return{c(){t=I("div"),f&&f.c(),n=R(),r=I("span"),i=O(d),a=R(),V(r,"class",s="tag is-small "+(e[0](e[8])?"is-selected":"is-contrasted")+" svelte-503e8j"),V(t,"class","tags has-addons mb-0 is-hoverable")},m(e,o){C(e,t,o),f&&f.m(t,null),k(t,n),k(t,r),k(r,i),k(t,a),l||(c=[M(t,"click",p),M(t,"keyup",null)],l=!0)},p(o,a){e=o,2&a&&(u=e[5](e[8])),u?f?f.p(e,a):(f=rr(),f.c(),f.m(t,n)):f&&(f.d(1),f=null),2&a&&d!==(d=We(e[9].title)+"")&&_(i,d),3&a&&s!==(s="tag is-small "+(e[0](e[8])?"is-selected":"is-contrasted")+" svelte-503e8j")&&V(r,"class",s)},d(e){e&&P(t),f&&f.d(),l=!1,o(c)}}}function ir(t){let n,r=Object.entries(t[1]),o=[];for(let e=0;e<r.length;e+=1)o[e]=or(nr(t,r,e));return{c(){n=I("div");for(let e=0;e<o.length;e+=1)o[e].c();V(n,"class","field is-grouped is-grouped-multiline")},m(e,t){C(e,n,t);for(let e=0;e<o.length;e+=1)o[e]&&o[e].m(n,null)},p(e,[t]){if(51&t){let i;for(r=Object.entries(e[1]),i=0;i<r.length;i+=1){const s=nr(e,r,i);o[i]?o[i].p(s,t):(o[i]=or(s),o[i].c(),o[i].m(n,null))}for(;i<o.length;i+=1)o[i].d(1);o.length=r.length}},i:e,o:e,d(e){e&&P(n),N(o,e)}}}function sr(e,t,n){let r,o;const{comparedRegions:i,isSelected:s}=Ht;d(e,i,(e=>n(1,o=e))),d(e,s,(e=>n(0,r=e)));const a=K("imgPrefix");function l(e){r(e.ref)?Ht.unselect(e.ref):Ht.select(e)}return[r,o,i,s,l,function(e){return e.startsWith(a)},e=>l(e)]}class ar extends Le{constructor(e){super(),Ie(this,e,sr,ir,s,{})}}function lr(e,t,n){const r=e.slice();return r[8]=t[n],r}function cr(e){let t,n,r,o,i,s,a,l=e[8].title+"";function c(e,t){return 6&t&&(r=null),null==r&&(r=!!e[2].includes(e[8].id)),r?dr:ur}let u=c(e,-1),d=u(e);return{c(){t=I("div"),n=I("span"),d.c(),o=R(),i=O(l),V(n,"class","label svelte-1a5w65y"),V(t,"class","label-container px-2 py-1 svelte-1a5w65y")},m(e,r){C(e,t,r),k(t,n),d.m(n,null),k(n,o),k(n,i),a=!0},p(e,t){u===(u=c(e,t))&&d?d.p(e,t):(d.d(1),d=u(e),d&&(d.c(),d.m(n,o))),(!a||2&t)&&l!==(l=e[8].title+"")&&_(i,l)},i(e){a||(se((()=>{a&&(s||(s=we(t,Ae,{x:40,duration:300},!0)),s.run(1))})),a=!0)},o(e){s||(s=we(t,Ae,{x:40,duration:300},!1)),s.run(0),a=!1},d(e){e&&P(t),d.d(),e&&s&&s.end()}}}function ur(t){let n,r="en"===_e?"Hide ":"Masquer les ";return{c(){n=O(r)},m(e,t){C(e,n,t)},p:e,d(e){e&&P(n)}}}function dr(t){let n,r="en"===_e?"Show ":"Afficher les ";return{c(){n=O(r)},m(e,t){C(e,n,t)},p:e,d(e){e&&P(n)}}}function fr(e){let t,n,r,i,s,a,l,c,u=e[8].svg+"",d=e[0]===e[8].id&&cr(e);function f(){return e[5](e[8])}function p(){return e[7](e[8])}return{c(){t=I("div"),n=I("span"),r=R(),d&&d.c(),i=R(),V(n,"class","tool-icon p-1 svelte-1a5w65y"),V(t,"class",s="toolbar-item "+(e[2].includes(e[8].id)?"":"selected")+" svelte-1a5w65y")},m(o,s){C(o,t,s),k(t,n),n.innerHTML=u,k(t,r),d&&d.m(t,null),k(t,i),a=!0,l||(c=[M(t,"mouseenter",f),M(t,"mouseleave",e[6]),M(t,"click",p),M(t,"keyup",null)],l=!0)},p(r,o){e=r,(!a||2&o)&&u!==(u=e[8].svg+"")&&(n.innerHTML=u),e[0]===e[8].id?d?(d.p(e,o),3&o&&$e(d,1)):(d=cr(e),d.c(),$e(d,1),d.m(t,i)):d&&(ge(),ve(d,1,1,(()=>{d=null})),he()),(!a||6&o&&s!==(s="toolbar-item "+(e[2].includes(e[8].id)?"":"selected")+" svelte-1a5w65y"))&&V(t,"class",s)},i(e){a||($e(d),a=!0)},o(e){ve(d),a=!1},d(e){e&&P(t),d&&d.d(),l=!1,o(c)}}}function pr(e){let t,n,r,o=e[1],i=[];for(let t=0;t<o.length;t+=1)i[t]=fr(lr(e,o,t));const s=e=>ve(i[e],1,1,(()=>{i[e]=null}));return{c(){t=I("div");for(let e=0;e<i.length;e+=1)i[e].c();V(t,"class","toolbar svelte-1a5w65y")},m(e,n){C(e,t,n);for(let e=0;e<i.length;e+=1)i[e]&&i[e].m(t,null);r=!0},p(e,[n]){if(23&n){let r;for(o=e[1],r=0;r<o.length;r+=1){const s=lr(e,o,r);i[r]?(i[r].p(s,n),$e(i[r],1)):(i[r]=fr(s),i[r].c(),$e(i[r],1),i[r].m(t,null))}for(ge(),r=o.length;r<i.length;r+=1)s(r);he()}},i(e){if(!r){for(let e=0;e<o.length;e+=1)$e(i[e]);se((()=>{r&&(n||(n=we(t,Re,{duration:500},!0)),n.run(1))})),r=!0}},o(e){i=i.filter(Boolean);for(let e=0;e<i.length;e+=1)ve(i[e]);n||(n=we(t,Re,{duration:500},!1)),n.run(0),r=!1},d(e){e&&P(t),N(i,e),e&&n&&n.end()}}}function mr(e,t,n){let r,o;const{excludedCategories:i}=Ht;d(e,i,(e=>n(2,o=e)));let s=null;function a(e){i.update((t=>t.includes(e)?t.filter((t=>t!==e)):[...t,e])),localStorage.setItem("excludedCategories",JSON.stringify(o))}return n(1,r=[{id:1,title:cn,svg:rn},{id:2,title:un,svg:on},{id:3,title:dn,svg:sn},{id:4,title:fn,svg:an},{id:5,title:pn,svg:ln}]),[s,r,o,i,a,e=>n(0,s=e.id),()=>n(0,s=null),e=>a(e.id)]}class gr extends Le{constructor(e){super(),Ie(this,e,mr,pr,s,{})}}var hr,$r;function vr(e){return"object"==typeof e&&"function"==typeof e.to}function br(e){e.parentElement.removeChild(e)}function wr(e){return null!=e}function yr(e){e.preventDefault()}function xr(e){return"number"==typeof e&&!isNaN(e)&&isFinite(e)}function kr(e,t,n){n>0&&(Pr(e,t),setTimeout((function(){Nr(e,t)}),n))}function Sr(e){return Math.max(Math.min(e,100),0)}function Er(e){return Array.isArray(e)?e:[e]}function Cr(e){var t=(e=String(e)).split(".");return t.length>1?t[1].length:0}function Pr(e,t){e.classList&&!/\s/.test(t)?e.classList.add(t):e.className+=" "+t}function Nr(e,t){e.classList&&!/\s/.test(t)?e.classList.remove(t):e.className=e.className.replace(new RegExp("(^|\\b)"+t.split(" ").join("|")+"(\\b|$)","gi")," ")}function Ir(e){var t=void 0!==window.pageXOffset,n="CSS1Compat"===(e.compatMode||"");return{x:t?window.pageXOffset:n?e.documentElement.scrollLeft:e.body.scrollLeft,y:t?window.pageYOffset:n?e.documentElement.scrollTop:e.body.scrollTop}}function Lr(e,t){return 100/(t-e)}function Or(e,t,n){return 100*t/(e[n+1]-e[n])}function Rr(e,t){for(var n=1;e>=t[n];)n+=1;return n}function Ar(e,t,n){if(n>=e.slice(-1)[0])return 100;var r=Rr(n,e),o=e[r-1],i=e[r],s=t[r-1],a=t[r];return s+function(e,t){return Or(e,e[0]<0?t+Math.abs(e[0]):t-e[0],0)}([o,i],n)/Lr(s,a)}function Mr(e,t,n,r){if(100===r)return r;var o=Rr(r,e),i=e[o-1],s=e[o];return n?r-i>(s-i)/2?s:i:t[o-1]?e[o-1]+function(e,t){return Math.round(e/t)*t}(r-e[o-1],t[o-1]):r}!function(e){e.Range="range",e.Steps="steps",e.Positions="positions",e.Count="count",e.Values="values"}(hr||(hr={})),function(e){e[e.None=-1]="None",e[e.NoValue=0]="NoValue",e[e.LargeValue=1]="LargeValue",e[e.SmallValue=2]="SmallValue"}($r||($r={}));var Tr=function(){function e(e,t,n){var r;this.xPct=[],this.xVal=[],this.xSteps=[],this.xNumSteps=[],this.xHighestCompleteStep=[],this.xSteps=[n||!1],this.xNumSteps=[!1],this.snap=t;var o=[];for(Object.keys(e).forEach((function(t){o.push([Er(e[t]),t])})),o.sort((function(e,t){return e[0][0]-t[0][0]})),r=0;r<o.length;r++)this.handleEntryPoint(o[r][1],o[r][0]);for(this.xNumSteps=this.xSteps.slice(0),r=0;r<this.xNumSteps.length;r++)this.handleStepPoint(r,this.xNumSteps[r])}return e.prototype.getDistance=function(e){for(var t=[],n=0;n<this.xNumSteps.length-1;n++)t[n]=Or(this.xVal,e,n);return t},e.prototype.getAbsoluteDistance=function(e,t,n){var r,o=0;if(e<this.xPct[this.xPct.length-1])for(;e>this.xPct[o+1];)o++;else e===this.xPct[this.xPct.length-1]&&(o=this.xPct.length-2);n||e!==this.xPct[o+1]||o++,null===t&&(t=[]);var i=1,s=t[o],a=0,l=0,c=0,u=0;for(r=n?(e-this.xPct[o])/(this.xPct[o+1]-this.xPct[o]):(this.xPct[o+1]-e)/(this.xPct[o+1]-this.xPct[o]);s>0;)a=this.xPct[o+1+u]-this.xPct[o+u],t[o+u]*i+100-100*r>100?(l=a*r,i=(s-100*r)/t[o+u],r=1):(l=t[o+u]*a/100*i,i=0),n?(c-=l,this.xPct.length+u>=1&&u--):(c+=l,this.xPct.length-u>=1&&u++),s=t[o+u]*i;return e+c},e.prototype.toStepping=function(e){return e=Ar(this.xVal,this.xPct,e)},e.prototype.fromStepping=function(e){return function(e,t,n){if(n>=100)return e.slice(-1)[0];var r=Rr(n,t),o=e[r-1],i=e[r],s=t[r-1];return function(e,t){return t*(e[1]-e[0])/100+e[0]}([o,i],(n-s)*Lr(s,t[r]))}(this.xVal,this.xPct,e)},e.prototype.getStep=function(e){return e=Mr(this.xPct,this.xSteps,this.snap,e)},e.prototype.getDefaultStep=function(e,t,n){var r=Rr(e,this.xPct);return(100===e||t&&e===this.xPct[r-1])&&(r=Math.max(r-1,1)),(this.xVal[r]-this.xVal[r-1])/n},e.prototype.getNearbySteps=function(e){var t=Rr(e,this.xPct);return{stepBefore:{startValue:this.xVal[t-2],step:this.xNumSteps[t-2],highestStep:this.xHighestCompleteStep[t-2]},thisStep:{startValue:this.xVal[t-1],step:this.xNumSteps[t-1],highestStep:this.xHighestCompleteStep[t-1]},stepAfter:{startValue:this.xVal[t],step:this.xNumSteps[t],highestStep:this.xHighestCompleteStep[t]}}},e.prototype.countStepDecimals=function(){var e=this.xNumSteps.map(Cr);return Math.max.apply(null,e)},e.prototype.hasNoSize=function(){return this.xVal[0]===this.xVal[this.xVal.length-1]},e.prototype.convert=function(e){return this.getStep(this.toStepping(e))},e.prototype.handleEntryPoint=function(e,t){var n;if(!xr(n="min"===e?0:"max"===e?100:parseFloat(e))||!xr(t[0]))throw new Error("noUiSlider: 'range' value isn't numeric.");this.xPct.push(n),this.xVal.push(t[0]);var r=Number(t[1]);n?this.xSteps.push(!isNaN(r)&&r):isNaN(r)||(this.xSteps[0]=r),this.xHighestCompleteStep.push(0)},e.prototype.handleStepPoint=function(e,t){if(t)if(this.xVal[e]!==this.xVal[e+1]){this.xSteps[e]=Or([this.xVal[e],this.xVal[e+1]],t,0)/Lr(this.xPct[e],this.xPct[e+1]);var n=(this.xVal[e+1]-this.xVal[e])/this.xNumSteps[e],r=Math.ceil(Number(n.toFixed(3))-1),o=this.xVal[e]+this.xNumSteps[e]*r;this.xHighestCompleteStep[e]=o}else this.xSteps[e]=this.xHighestCompleteStep[e]=this.xVal[e]},e}(),Vr={to:function(e){return void 0===e?"":e.toFixed(2)},from:Number},_r={target:"target",base:"base",origin:"origin",handle:"handle",handleLower:"handle-lower",handleUpper:"handle-upper",touchArea:"touch-area",horizontal:"horizontal",vertical:"vertical",background:"background",connect:"connect",connects:"connects",ltr:"ltr",rtl:"rtl",textDirectionLtr:"txt-dir-ltr",textDirectionRtl:"txt-dir-rtl",draggable:"draggable",drag:"state-drag",tap:"state-tap",active:"active",tooltip:"tooltip",pips:"pips",pipsHorizontal:"pips-horizontal",pipsVertical:"pips-vertical",marker:"marker",markerHorizontal:"marker-horizontal",markerVertical:"marker-vertical",markerNormal:"marker-normal",markerLarge:"marker-large",markerSub:"marker-sub",value:"value",valueHorizontal:"value-horizontal",valueVertical:"value-vertical",valueNormal:"value-normal",valueLarge:"value-large",valueSub:"value-sub"},jr={tooltips:".__tooltips",aria:".__aria"};function Ur(e,t){if(!xr(t))throw new Error("noUiSlider: 'step' is not numeric.");e.singleStep=t}function qr(e,t){if(!xr(t))throw new Error("noUiSlider: 'keyboardPageMultiplier' is not numeric.");e.keyboardPageMultiplier=t}function zr(e,t){if(!xr(t))throw new Error("noUiSlider: 'keyboardMultiplier' is not numeric.");e.keyboardMultiplier=t}function Dr(e,t){if(!xr(t))throw new Error("noUiSlider: 'keyboardDefaultStep' is not numeric.");e.keyboardDefaultStep=t}function Hr(e,t){if("object"!=typeof t||Array.isArray(t))throw new Error("noUiSlider: 'range' is not an object.");if(void 0===t.min||void 0===t.max)throw new Error("noUiSlider: Missing 'min' or 'max' in 'range'.");e.spectrum=new Tr(t,e.snap||!1,e.singleStep)}function Fr(e,t){if(t=Er(t),!Array.isArray(t)||!t.length)throw new Error("noUiSlider: 'start' option is incorrect.");e.handles=t.length,e.start=t}function Br(e,t){if("boolean"!=typeof t)throw new Error("noUiSlider: 'snap' option must be a boolean.");e.snap=t}function Xr(e,t){if("boolean"!=typeof t)throw new Error("noUiSlider: 'animate' option must be a boolean.");e.animate=t}function Jr(e,t){if("number"!=typeof t)throw new Error("noUiSlider: 'animationDuration' option must be a number.");e.animationDuration=t}function Zr(e,t){var n,r=[!1];if("lower"===t?t=[!0,!1]:"upper"===t&&(t=[!1,!0]),!0===t||!1===t){for(n=1;n<e.handles;n++)r.push(t);r.push(!1)}else{if(!Array.isArray(t)||!t.length||t.length!==e.handles+1)throw new Error("noUiSlider: 'connect' option doesn't match handle count.");r=t}e.connect=r}function Gr(e,t){switch(t){case"horizontal":e.ort=0;break;case"vertical":e.ort=1;break;default:throw new Error("noUiSlider: 'orientation' option is invalid.")}}function Wr(e,t){if(!xr(t))throw new Error("noUiSlider: 'margin' option must be numeric.");0!==t&&(e.margin=e.spectrum.getDistance(t))}function Yr(e,t){if(!xr(t))throw new Error("noUiSlider: 'limit' option must be numeric.");if(e.limit=e.spectrum.getDistance(t),!e.limit||e.handles<2)throw new Error("noUiSlider: 'limit' option is only supported on linear sliders with 2 or more handles.")}function Qr(e,t){var n;if(!xr(t)&&!Array.isArray(t))throw new Error("noUiSlider: 'padding' option must be numeric or array of exactly 2 numbers.");if(Array.isArray(t)&&2!==t.length&&!xr(t[0])&&!xr(t[1]))throw new Error("noUiSlider: 'padding' option must be numeric or array of exactly 2 numbers.");if(0!==t){for(Array.isArray(t)||(t=[t,t]),e.padding=[e.spectrum.getDistance(t[0]),e.spectrum.getDistance(t[1])],n=0;n<e.spectrum.xNumSteps.length-1;n++)if(e.padding[0][n]<0||e.padding[1][n]<0)throw new Error("noUiSlider: 'padding' option must be a positive number(s).");var r=t[0]+t[1],o=e.spectrum.xVal[0];if(r/(e.spectrum.xVal[e.spectrum.xVal.length-1]-o)>1)throw new Error("noUiSlider: 'padding' option must not exceed 100% of the range.")}}function Kr(e,t){switch(t){case"ltr":e.dir=0;break;case"rtl":e.dir=1;break;default:throw new Error("noUiSlider: 'direction' option was not recognized.")}}function eo(e,t){if("string"!=typeof t)throw new Error("noUiSlider: 'behaviour' must be a string containing options.");var n=t.indexOf("tap")>=0,r=t.indexOf("drag")>=0,o=t.indexOf("fixed")>=0,i=t.indexOf("snap")>=0,s=t.indexOf("hover")>=0,a=t.indexOf("unconstrained")>=0,l=t.indexOf("invert-connects")>=0,c=t.indexOf("drag-all")>=0,u=t.indexOf("smooth-steps")>=0;if(o){if(2!==e.handles)throw new Error("noUiSlider: 'fixed' behaviour must be used with 2 handles");Wr(e,e.start[1]-e.start[0])}if(l&&2!==e.handles)throw new Error("noUiSlider: 'invert-connects' behaviour must be used with 2 handles");if(a&&(e.margin||e.limit))throw new Error("noUiSlider: 'unconstrained' behaviour cannot be used with margin or limit");e.events={tap:n||i,drag:r,dragAll:c,smoothSteps:u,fixed:o,snap:i,hover:s,unconstrained:a,invertConnects:l}}function to(e,t){if(!1!==t)if(!0===t||vr(t)){e.tooltips=[];for(var n=0;n<e.handles;n++)e.tooltips.push(t)}else{if((t=Er(t)).length!==e.handles)throw new Error("noUiSlider: must pass a formatter for all handles.");t.forEach((function(e){if("boolean"!=typeof e&&!vr(e))throw new Error("noUiSlider: 'tooltips' must be passed a formatter or 'false'.")})),e.tooltips=t}}function no(e,t){if(t.length!==e.handles)throw new Error("noUiSlider: must pass a attributes for all handles.");e.handleAttributes=t}function ro(e,t){if(!vr(t))throw new Error("noUiSlider: 'ariaFormat' requires 'to' method.");e.ariaFormat=t}function oo(e,t){if(!function(e){return vr(e)&&"function"==typeof e.from}(t))throw new Error("noUiSlider: 'format' requires 'to' and 'from' methods.");e.format=t}function io(e,t){if("boolean"!=typeof t)throw new Error("noUiSlider: 'keyboardSupport' option must be a boolean.");e.keyboardSupport=t}function so(e,t){e.documentElement=t}function ao(e,t){if("string"!=typeof t&&!1!==t)throw new Error("noUiSlider: 'cssPrefix' must be a string or `false`.");e.cssPrefix=t}function lo(e,t){if("object"!=typeof t)throw new Error("noUiSlider: 'cssClasses' must be an object.");"string"==typeof e.cssPrefix?(e.cssClasses={},Object.keys(t).forEach((function(n){e.cssClasses[n]=e.cssPrefix+t[n]}))):e.cssClasses=t}function co(e){var t={margin:null,limit:null,padding:null,animate:!0,animationDuration:300,ariaFormat:Vr,format:Vr},n={step:{r:!1,t:Ur},keyboardPageMultiplier:{r:!1,t:qr},keyboardMultiplier:{r:!1,t:zr},keyboardDefaultStep:{r:!1,t:Dr},start:{r:!0,t:Fr},connect:{r:!0,t:Zr},direction:{r:!0,t:Kr},snap:{r:!1,t:Br},animate:{r:!1,t:Xr},animationDuration:{r:!1,t:Jr},range:{r:!0,t:Hr},orientation:{r:!1,t:Gr},margin:{r:!1,t:Wr},limit:{r:!1,t:Yr},padding:{r:!1,t:Qr},behaviour:{r:!0,t:eo},ariaFormat:{r:!1,t:ro},format:{r:!1,t:oo},tooltips:{r:!1,t:to},keyboardSupport:{r:!0,t:io},documentElement:{r:!1,t:so},cssPrefix:{r:!0,t:ao},cssClasses:{r:!0,t:lo},handleAttributes:{r:!1,t:no}},r={connect:!1,direction:"ltr",behaviour:"tap",orientation:"horizontal",keyboardSupport:!0,cssPrefix:"noUi-",cssClasses:_r,keyboardPageMultiplier:5,keyboardMultiplier:1,keyboardDefaultStep:10};e.format&&!e.ariaFormat&&(e.ariaFormat=e.format),Object.keys(n).forEach((function(o){if(wr(e[o])||void 0!==r[o])n[o].t(t,wr(e[o])?e[o]:r[o]);else if(n[o].r)throw new Error("noUiSlider: '"+o+"' is required.")})),t.pips=e.pips;var o=document.createElement("div"),i=void 0!==o.style.msTransform,s=void 0!==o.style.transform;t.transformRule=s?"transform":i?"msTransform":"webkitTransform";return t.style=[["left","top"],["right","bottom"]][t.dir][t.ort],t}function uo(e,t,n){var r,o,i,s,a,l,c,u=window.navigator.pointerEnabled?{start:"pointerdown",move:"pointermove",end:"pointerup"}:window.navigator.msPointerEnabled?{start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:{start:"mousedown touchstart",move:"mousemove touchmove",end:"mouseup touchend"},d=window.CSS&&CSS.supports&&CSS.supports("touch-action","none")&&function(){var e=!1;try{var t=Object.defineProperty({},"passive",{get:function(){e=!0}});window.addEventListener("test",null,t)}catch(e){}return e}(),f=e,p=t.spectrum,m=[],g=[],h=[],$=0,v={},b=!1,w=e.ownerDocument,y=t.documentElement||w.documentElement,x=w.body,k="rtl"===w.dir||1===t.ort?0:100;function S(e,t){var n=w.createElement("div");return t&&Pr(n,t),e.appendChild(n),n}function E(e,n){var r=S(e,t.cssClasses.origin),o=S(r,t.cssClasses.handle);if(S(o,t.cssClasses.touchArea),o.setAttribute("data-handle",String(n)),t.keyboardSupport&&(o.setAttribute("tabindex","0"),o.addEventListener("keydown",(function(e){return function(e,n){if(N()||I(n))return!1;var r=["Left","Right"],o=["Down","Up"],i=["PageDown","PageUp"],s=["Home","End"];t.dir&&!t.ort?r.reverse():t.ort&&!t.dir&&(o.reverse(),i.reverse());var a,l=e.key.replace("Arrow",""),c=l===i[0],u=l===i[1],d=l===o[0]||l===r[0]||c,f=l===o[1]||l===r[1]||u,h=l===s[0],$=l===s[1];if(!(d||f||h||$))return!0;if(e.preventDefault(),f||d){var v=d?0:1,b=ae(n)[v];if(null===b)return!1;!1===b&&(b=p.getDefaultStep(g[n],d,t.keyboardDefaultStep)),b*=u||c?t.keyboardPageMultiplier:t.keyboardMultiplier,b=Math.max(b,1e-7),b*=d?-1:1,a=m[n]+b}else a=$?t.spectrum.xVal[t.spectrum.xVal.length-1]:t.spectrum.xVal[0];return ne(n,p.toStepping(a),!0,!0),G("slide",n),G("update",n),G("change",n),G("set",n),!1}(e,n)}))),void 0!==t.handleAttributes){var i=t.handleAttributes[n];Object.keys(i).forEach((function(e){o.setAttribute(e,i[e])}))}return o.setAttribute("role","slider"),o.setAttribute("aria-orientation",t.ort?"vertical":"horizontal"),0===n?Pr(o,t.cssClasses.handleLower):n===t.handles-1&&Pr(o,t.cssClasses.handleUpper),r.handle=o,r}function C(e,n){return!!n&&S(e,t.cssClasses.connect)}function P(e,n){return!(!t.tooltips||!t.tooltips[n])&&S(e.firstChild,t.cssClasses.tooltip)}function N(){return f.hasAttribute("disabled")}function I(e){return i[e].hasAttribute("disabled")}function L(){l&&(Z("update"+jr.tooltips),l.forEach((function(e){e&&br(e)})),l=null)}function O(){L(),l=i.map(P),J("update"+jr.tooltips,(function(e,n,r){if(l&&t.tooltips&&!1!==l[n]){var o=e[n];!0!==t.tooltips[n]&&(o=t.tooltips[n].to(r[n])),l[n].innerHTML=o}}))}function R(e,t){return e.map((function(e){return p.fromStepping(t?p.getStep(e):e)}))}function A(e){var t,n=function(e){if(e.mode===hr.Range||e.mode===hr.Steps)return p.xVal;if(e.mode===hr.Count){if(e.values<2)throw new Error("noUiSlider: 'values' (>= 2) required for mode 'count'.");for(var t=e.values-1,n=100/t,r=[];t--;)r[t]=t*n;return r.push(100),R(r,e.stepped)}return e.mode===hr.Positions?R(e.values,e.stepped):e.mode===hr.Values?e.stepped?e.values.map((function(e){return p.fromStepping(p.getStep(p.toStepping(e)))})):e.values:[]}(e),r={},o=p.xVal[0],i=p.xVal[p.xVal.length-1],s=!1,a=!1,l=0;return t=n.slice().sort((function(e,t){return e-t})),(n=t.filter((function(e){return!this[e]&&(this[e]=!0)}),{}))[0]!==o&&(n.unshift(o),s=!0),n[n.length-1]!==i&&(n.push(i),a=!0),n.forEach((function(t,o){var i,c,u,d,f,m,g,h,$,v,b=t,w=n[o+1],y=e.mode===hr.Steps;for(y&&(i=p.xNumSteps[o]),i||(i=w-b),void 0===w&&(w=b),i=Math.max(i,1e-7),c=b;c<=w;c=Number((c+i).toFixed(7))){for(h=(f=(d=p.toStepping(c))-l)/(e.density||1),v=f/($=Math.round(h)),u=1;u<=$;u+=1)r[(m=l+u*v).toFixed(5)]=[p.fromStepping(m),0];g=n.indexOf(c)>-1?$r.LargeValue:y?$r.SmallValue:$r.NoValue,!o&&s&&c!==w&&(g=0),c===w&&a||(r[d.toFixed(5)]=[c,g]),l=d}})),r}function M(e,n,r){var o,i,s=w.createElement("div"),a=((o={})[$r.None]="",o[$r.NoValue]=t.cssClasses.valueNormal,o[$r.LargeValue]=t.cssClasses.valueLarge,o[$r.SmallValue]=t.cssClasses.valueSub,o),l=((i={})[$r.None]="",i[$r.NoValue]=t.cssClasses.markerNormal,i[$r.LargeValue]=t.cssClasses.markerLarge,i[$r.SmallValue]=t.cssClasses.markerSub,i),c=[t.cssClasses.valueHorizontal,t.cssClasses.valueVertical],u=[t.cssClasses.markerHorizontal,t.cssClasses.markerVertical];function d(e,n){var r=n===t.cssClasses.value,o=r?a:l;return n+" "+(r?c:u)[t.ort]+" "+o[e]}return Pr(s,t.cssClasses.pips),Pr(s,0===t.ort?t.cssClasses.pipsHorizontal:t.cssClasses.pipsVertical),Object.keys(e).forEach((function(o){!function(e,o,i){if((i=n?n(o,i):i)!==$r.None){var a=S(s,!1);a.className=d(i,t.cssClasses.marker),a.style[t.style]=e+"%",i>$r.NoValue&&((a=S(s,!1)).className=d(i,t.cssClasses.value),a.setAttribute("data-value",String(o)),a.style[t.style]=e+"%",a.innerHTML=String(r.to(o)))}}(o,e[o][0],e[o][1])})),s}function T(){a&&(br(a),a=null)}function V(e){T();var t=A(e),n=e.filter,r=e.format||{to:function(e){return String(Math.round(e))}};return a=f.appendChild(M(t,n,r))}function _(){var e=r.getBoundingClientRect(),n="offset"+["Width","Height"][t.ort];return 0===t.ort?e.width||r[n]:e.height||r[n]}function j(e,n,r,o){var i=function(i){var s,a,l=function(e,t,n){var r=0===e.type.indexOf("touch"),o=0===e.type.indexOf("mouse"),i=0===e.type.indexOf("pointer"),s=0,a=0;0===e.type.indexOf("MSPointer")&&(i=!0);if("mousedown"===e.type&&!e.buttons&&!e.touches)return!1;if(r){var l=function(t){var r=t.target;return r===n||n.contains(r)||e.composed&&e.composedPath().shift()===n};if("touchstart"===e.type){var c=Array.prototype.filter.call(e.touches,l);if(c.length>1)return!1;s=c[0].pageX,a=c[0].pageY}else{var u=Array.prototype.find.call(e.changedTouches,l);if(!u)return!1;s=u.pageX,a=u.pageY}}t=t||Ir(w),(o||i)&&(s=e.clientX+t.x,a=e.clientY+t.y);return e.pageOffset=t,e.points=[s,a],e.cursor=o||i,e}(i,o.pageOffset,o.target||n);return!!l&&(!(N()&&!o.doNotReject)&&(s=f,a=t.cssClasses.tap,!((s.classList?s.classList.contains(a):new RegExp("\\b"+a+"\\b").test(s.className))&&!o.doNotReject)&&(!(e===u.start&&void 0!==l.buttons&&l.buttons>1)&&((!o.hover||!l.buttons)&&(d||l.preventDefault(),l.calcPoint=l.points[t.ort],void r(l,o))))))},s=[];return e.split(" ").forEach((function(e){n.addEventListener(e,i,!!d&&{passive:!0}),s.push([e,i])})),s}function U(e){var n,o,i,s,a,l,c=100*(e-(n=r,o=t.ort,i=n.getBoundingClientRect(),s=n.ownerDocument,a=s.documentElement,l=Ir(s),/webkit.*Chrome.*Mobile/i.test(navigator.userAgent)&&(l.x=0),o?i.top+l.y-a.clientTop:i.left+l.x-a.clientLeft))/_();return c=Sr(c),t.dir?100-c:c}function q(e,t){"mouseout"===e.type&&"HTML"===e.target.nodeName&&null===e.relatedTarget&&D(e,t)}function z(e,n){if(-1===navigator.appVersion.indexOf("MSIE 9")&&0===e.buttons&&0!==n.buttonsProperty)return D(e,n);var r=(t.dir?-1:1)*(e.calcPoint-n.startCalcPoint);Q(r>0,100*r/n.baseSize,n.locations,n.handleNumbers,n.connect)}function D(e,n){n.handle&&(Nr(n.handle,t.cssClasses.active),$-=1),n.listeners.forEach((function(e){y.removeEventListener(e[0],e[1])})),0===$&&(Nr(f,t.cssClasses.drag),te(),e.cursor&&(x.style.cursor="",x.removeEventListener("selectstart",yr))),t.events.smoothSteps&&(n.handleNumbers.forEach((function(e){ne(e,g[e],!0,!0,!1,!1)})),n.handleNumbers.forEach((function(e){G("update",e)}))),n.handleNumbers.forEach((function(e){G("change",e),G("set",e),G("end",e)}))}function H(e,n){if(!n.handleNumbers.some(I)){var r;if(1===n.handleNumbers.length)r=i[n.handleNumbers[0]].children[0],$+=1,Pr(r,t.cssClasses.active);e.stopPropagation();var o=[],s=j(u.move,y,z,{target:e.target,handle:r,connect:n.connect,listeners:o,startCalcPoint:e.calcPoint,baseSize:_(),pageOffset:e.pageOffset,handleNumbers:n.handleNumbers,buttonsProperty:e.buttons,locations:g.slice()}),a=j(u.end,y,D,{target:e.target,handle:r,listeners:o,doNotReject:!0,handleNumbers:n.handleNumbers}),l=j("mouseout",y,q,{target:e.target,handle:r,listeners:o,doNotReject:!0,handleNumbers:n.handleNumbers});o.push.apply(o,s.concat(a,l)),e.cursor&&(x.style.cursor=getComputedStyle(e.target).cursor,i.length>1&&Pr(f,t.cssClasses.drag),x.addEventListener("selectstart",yr,!1)),n.handleNumbers.forEach((function(e){G("start",e)}))}}function F(e){e.stopPropagation();var n=U(e.calcPoint),r=function(e){var t=100,n=!1;return i.forEach((function(r,o){if(!I(o)){var i=g[o],s=Math.abs(i-e);(s<t||s<=t&&e>i||100===s&&100===t)&&(n=o,t=s)}})),n}(n);!1!==r&&(t.events.snap||kr(f,t.cssClasses.tap,t.animationDuration),ne(r,n,!0,!0),te(),G("slide",r,!0),G("update",r,!0),t.events.snap?H(e,{handleNumbers:[r]}):(G("change",r,!0),G("set",r,!0)))}function B(e){var t=U(e.calcPoint),n=p.getStep(t),r=p.fromStepping(n);Object.keys(v).forEach((function(e){"hover"===e.split(".")[0]&&v[e].forEach((function(e){e.call(ce,r)}))}))}function X(e){e.fixed||i.forEach((function(e,t){j(u.start,e.children[0],H,{handleNumbers:[t]})})),e.tap&&j(u.start,r,F,{}),e.hover&&j(u.move,r,B,{hover:!0}),e.drag&&s.forEach((function(n,r){if(!1!==n&&0!==r&&r!==s.length-1){var o=i[r-1],a=i[r],l=[n],c=[o,a],d=[r-1,r];Pr(n,t.cssClasses.draggable),e.fixed&&(l.push(o.children[0]),l.push(a.children[0])),e.dragAll&&(c=i,d=h),l.forEach((function(e){j(u.start,e,H,{handles:c,handleNumbers:d,connect:n})}))}}))}function J(e,t){v[e]=v[e]||[],v[e].push(t),"update"===e.split(".")[0]&&i.forEach((function(e,t){G("update",t)}))}function Z(e){var t=e&&e.split(".")[0],n=t?e.substring(t.length):e;Object.keys(v).forEach((function(e){var r=e.split(".")[0],o=e.substring(r.length);t&&t!==r||n&&n!==o||function(e){return e===jr.aria||e===jr.tooltips}(o)&&n!==o||delete v[e]}))}function G(e,n,r){Object.keys(v).forEach((function(o){var i=o.split(".")[0];e===i&&v[o].forEach((function(e){e.call(ce,m.map(t.format.to),n,m.slice(),r||!1,g.slice(),ce)}))}))}function W(e,n,r,o,s,a,l){var c;return i.length>1&&!t.events.unconstrained&&(o&&n>0&&(c=p.getAbsoluteDistance(e[n-1],t.margin,!1),r=Math.max(r,c)),s&&n<i.length-1&&(c=p.getAbsoluteDistance(e[n+1],t.margin,!0),r=Math.min(r,c))),i.length>1&&t.limit&&(o&&n>0&&(c=p.getAbsoluteDistance(e[n-1],t.limit,!1),r=Math.min(r,c)),s&&n<i.length-1&&(c=p.getAbsoluteDistance(e[n+1],t.limit,!0),r=Math.max(r,c))),t.padding&&(0===n&&(c=p.getAbsoluteDistance(0,t.padding[0],!1),r=Math.max(r,c)),n===i.length-1&&(c=p.getAbsoluteDistance(100,t.padding[1],!0),r=Math.min(r,c))),l||(r=p.getStep(r)),!((r=Sr(r))===e[n]&&!a)&&r}function Y(e,n){var r=t.ort;return(r?n:e)+", "+(r?e:n)}function Q(e,n,r,o,i){var s=r.slice(),a=o[0],l=t.events.smoothSteps,c=[!e,e],u=[e,!e];o=o.slice(),e&&o.reverse(),o.length>1?o.forEach((function(e,t){var r=W(s,e,s[e]+n,c[t],u[t],!1,l);!1===r?n=0:(n=r-s[e],s[e]=r)})):c=u=[!0];var d=!1;o.forEach((function(e,t){d=ne(e,r[e]+n,c[t],u[t],!1,l)||d})),d&&(o.forEach((function(e){G("update",e),G("slide",e)})),null!=i&&G("drag",a))}function K(e,n){return t.dir?100-e-n:e}function ee(e,n){g[e]=n,m[e]=p.fromStepping(n);var r="translate("+Y(K(n,0)-k+"%","0")+")";if(i[e].style[t.transformRule]=r,t.events.invertConnects&&g.length>1){var o=g.every((function(e,t,n){return 0===t||e>=n[t-1]}));if(b!==!o)return b=!b,Zr(t,t.connect.map((function(e){return!e}))),void le()}re(e),re(e+1),b&&(re(e-1),re(e+2))}function te(){h.forEach((function(e){var t=g[e]>50?-1:1,n=3+(i.length+t*e);i[e].style.zIndex=String(n)}))}function ne(e,t,n,r,o,i){return o||(t=W(g,e,t,n,r,!1,i)),!1!==t&&(ee(e,t),!0)}function re(e){if(s[e]){var n=g.slice();b&&n.sort((function(e,t){return e-t}));var r=0,o=100;0!==e&&(r=n[e-1]),e!==s.length-1&&(o=n[e]);var i=o-r,a="translate("+Y(K(r,i)+"%","0")+")",l="scale("+Y(i/100,"1")+")";s[e].style[t.transformRule]=a+" "+l}}function oe(e,n){return null===e||!1===e||void 0===e?g[n]:("number"==typeof e&&(e=String(e)),!1!==(e=t.format.from(e))&&(e=p.toStepping(e)),!1===e||isNaN(e)?g[n]:e)}function ie(e,n,r){var o=Er(e),i=void 0===g[0];n=void 0===n||n,t.animate&&!i&&kr(f,t.cssClasses.tap,t.animationDuration),h.forEach((function(e){ne(e,oe(o[e],e),!0,!1,r)}));var s=1===h.length?0:1;if(i&&p.hasNoSize()&&(r=!0,g[0]=0,h.length>1)){var a=100/(h.length-1);h.forEach((function(e){g[e]=e*a}))}for(;s<h.length;++s)h.forEach((function(e){ne(e,g[e],!0,!0,r)}));te(),h.forEach((function(e){G("update",e),null!==o[e]&&n&&G("set",e)}))}function se(e){if(void 0===e&&(e=!1),e)return 1===m.length?m[0]:m.slice(0);var n=m.map(t.format.to);return 1===n.length?n[0]:n}function ae(e){var n=g[e],r=p.getNearbySteps(n),o=m[e],i=r.thisStep.step,s=null;if(t.snap)return[o-r.stepBefore.startValue||null,r.stepAfter.startValue-o||null];!1!==i&&o+i>r.stepAfter.startValue&&(i=r.stepAfter.startValue-o),s=o>r.thisStep.startValue?r.thisStep.step:!1!==r.stepBefore.step&&o-r.stepBefore.highestStep,100===n?i=null:0===n&&(s=null);var a=p.countStepDecimals();return null!==i&&!1!==i&&(i=Number(i.toFixed(a))),null!==s&&!1!==s&&(s=Number(s.toFixed(a))),[s,i]}function le(){for(;o.firstChild;)o.removeChild(o.firstChild);for(var e=0;e<=t.handles;e++)s[e]=C(o,t.connect[e]),re(e);X({drag:t.events.drag,fixed:!0})}Pr(c=f,t.cssClasses.target),0===t.dir?Pr(c,t.cssClasses.ltr):Pr(c,t.cssClasses.rtl),0===t.ort?Pr(c,t.cssClasses.horizontal):Pr(c,t.cssClasses.vertical),Pr(c,"rtl"===getComputedStyle(c).direction?t.cssClasses.textDirectionRtl:t.cssClasses.textDirectionLtr),r=S(c,t.cssClasses.base),function(e,n){o=S(n,t.cssClasses.connects),i=[],(s=[]).push(C(o,e[0]));for(var r=0;r<t.handles;r++)i.push(E(n,r)),h[r]=r,s.push(C(o,e[r+1]))}(t.connect,r),X(t.events),ie(t.start),t.pips&&V(t.pips),t.tooltips&&O(),Z("update"+jr.aria),J("update"+jr.aria,(function(e,n,r,o,s){h.forEach((function(e){var n=i[e],o=W(g,e,0,!0,!0,!0),a=W(g,e,100,!0,!0,!0),l=s[e],c=String(t.ariaFormat.to(r[e]));o=p.fromStepping(o).toFixed(1),a=p.fromStepping(a).toFixed(1),l=p.fromStepping(l).toFixed(1),n.children[0].setAttribute("aria-valuemin",o),n.children[0].setAttribute("aria-valuemax",a),n.children[0].setAttribute("aria-valuenow",l),n.children[0].setAttribute("aria-valuetext",c)}))}));var ce={destroy:function(){for(Z(jr.aria),Z(jr.tooltips),Object.keys(t.cssClasses).forEach((function(e){Nr(f,t.cssClasses[e])}));f.firstChild;)f.removeChild(f.firstChild);delete f.noUiSlider},steps:function(){return h.map(ae)},on:J,off:Z,get:se,set:ie,setHandle:function(e,t,n,r){if(!((e=Number(e))>=0&&e<h.length))throw new Error("noUiSlider: invalid handle number, got: "+e);ne(e,oe(t,e),!0,!0,r),G("update",e),n&&G("set",e)},reset:function(e){ie(t.start,e)},disable:function(e){null!=e?(i[e].setAttribute("disabled",""),i[e].handle.removeAttribute("tabindex")):(f.setAttribute("disabled",""),i.forEach((function(e){e.handle.removeAttribute("tabindex")})))},enable:function(e){null!=e?(i[e].removeAttribute("disabled"),i[e].handle.setAttribute("tabindex","0")):(f.removeAttribute("disabled"),i.forEach((function(e){e.removeAttribute("disabled"),e.handle.setAttribute("tabindex","0")})))},__moveHandles:function(e,t,n){Q(e,t,g,n)},options:n,updateOptions:function(e,r){var o=se(),i=["margin","limit","padding","range","animate","snap","step","format","pips","tooltips","connect"];i.forEach((function(t){void 0!==e[t]&&(n[t]=e[t])}));var s=co(n);i.forEach((function(n){void 0!==e[n]&&(t[n]=s[n])})),p=s.spectrum,t.margin=s.margin,t.limit=s.limit,t.padding=s.padding,t.pips?V(t.pips):T(),t.tooltips?O():L(),g=[],ie(wr(e.start)?e.start:o,r),e.connect&&le()},target:f,removePips:T,removeTooltips:L,getPositions:function(){return g.slice()},getTooltips:function(){return l},getOrigins:function(){return i},pips:V};return ce}var fo={__spectrum:Tr,cssClasses:_r,create:function(e,t){if(!e||!e.nodeName)throw new Error("noUiSlider: create requires a single element, got: "+e);if(e.noUiSlider)throw new Error("noUiSlider: Slider was already initialized.");var n=uo(e,co(t),t);return e.noUiSlider=n,n}};function po(t){let n,r,o;return{c(){n=I("div"),r=I("div"),o=I("div"),V(o,"class","slider"),V(r,"class","slider-wrapper svelte-ol37h4")},m(e,i){C(e,n,i),k(n,r),k(r,o),t[5](o)},p:e,i:e,o:e,d(e){e&&P(n),t[5](null)}}}function mo(e,t,n){let r,o,i,{minVal:s}=t,{maxVal:a}=t,{step:l=1}=t;const c=Y(),u={min:void 0,max:void 0},d=[`noUi-handle-${window.crypto.randomUUID()}`,`noUi-handle-${window.crypto.randomUUID()}`];const f=([e,t])=>{u.min=r.min,u.max=r.max,n(4,r={min:e,max:t}),console.log(`updateSelectedRange ::: min: old ${u.min}, new ${r.min} || max: old ${u.min}, new ${r.min}`)};return W((()=>{fo.create(i,{start:[s,a],step:l,connect:!0,range:r,handleAttributes:[{id:d[0]},{id:d[1]}]}),i.noUiSlider.on("set",(()=>{let e=i.noUiSlider.get(!0);f(e),c("updateRange",e)})),d.map(((e,t)=>{console.log("htmlId",document.getElementById(e)),o.push(new An({target:document.getElementById(e),props:{tooltipText:0===t?r.min:r.max}}))}))})),e.$$set=e=>{"minVal"in e&&n(1,s=e.minVal),"maxVal"in e&&n(2,a=e.maxVal),"step"in e&&n(3,l=e.step)},e.$$.update=()=>{6&e.$$.dirty&&n(4,r={min:s,max:a}),16&e.$$.dirty&&(o.length&&u.min!==r.min&&o[0].$set({tooltipText:r.min}),o.length&&u.max!==r.max&&o[1].$set({tooltipText:r.max}))},o=[],[i,s,a,l,r,function(e){te[e?"unshift":"push"]((()=>{i=e,n(0,i)}))}]}class go extends Le{constructor(e){super(),Ie(this,e,mo,po,s,{minVal:1,maxVal:2,step:3})}}function ho(t){let n,r,o,i,s,a,l,c;return{c(){n=I("div"),r=I("label"),o=O(t[0]),i=R(),s=I("input"),V(r,"for",t[2]),V(r,"class","is-clickable"),V(s,"type","checkbox"),V(s,"id",t[2]),V(s,"name",t[2]),V(s,"class","svelte-1vd06dk"),V(n,"class",a="pill-checkbox checkbox-wrapper tag is-clickable "+(t[1]?"is-success":"is-link")+" svelte-1vd06dk")},m(e,a){C(e,n,a),k(n,r),k(r,o),k(n,i),k(n,s),l||(c=M(s,"click",t[3]),l=!0)},p(e,[t]){1&t&&_(o,e[0]),2&t&&a!==(a="pill-checkbox checkbox-wrapper tag is-clickable "+(e[1]?"is-success":"is-link")+" svelte-1vd06dk")&&V(n,"class",a)},i:e,o:e,d(e){e&&P(n),l=!1,c()}}}function $o(e,t,n){let r,{checkboxLabel:o}=t;const i=`input-pill-checkbox-${window.crypto.randomUUID()}`,s=Y();return e.$$set=e=>{"checkboxLabel"in e&&n(0,o=e.checkboxLabel)},n(1,r=!1),[o,r,i,()=>{n(1,r=!r),s("updateChecked",r)}]}class vo extends Le{constructor(e){super(),Ie(this,e,$o,ho,s,{checkboxLabel:0})}}function bo(t){let n,r,o,i,s,a,l,c,u,d,f,p,m;return u=new go({props:{minVal:2,maxVal:6,step:1}}),u.$on("updateRange",t[0]),p=new vo({props:{checkboxLabel:"Filter by region"}}),p.$on("updateChecked",t[1]),{c(){n=I("div"),r=I("div"),o=I("span"),o.innerHTML="<b>Propagation</b>",i=R(),s=I("div"),a=I("div"),l=I("span"),l.textContent=""+("fr"===_e?"Profondeur de récursion":"Recursion depth"),c=R(),Ee(u.$$.fragment),d=R(),f=I("div"),Ee(p.$$.fragment),V(a,"class","depth column is-two-thirds svelte-15ucvkm"),V(f,"class","region column svelte-15ucvkm"),V(s,"class","columns is-flex is-vcentered is-8 propagation-ctrl-inputs svelte-15ucvkm"),V(r,"class","propagation-ctrl")},m(e,t){C(e,n,t),k(n,r),k(r,o),k(r,i),k(r,s),k(s,a),k(a,l),k(a,c),Ce(u,a,null),k(s,d),k(s,f),Ce(p,f,null),m=!0},p:e,i(e){m||($e(u.$$.fragment,e),$e(p.$$.fragment,e),m=!0)},o(e){ve(u.$$.fragment,e),ve(p.$$.fragment,e),m=!1},d(e){e&&P(n),Pe(u),Pe(p)}}}function wo(e){return[e=>e.detail,e=>e.detail]}class yo extends Le{constructor(e){super(),Ie(this,e,wo,bo,s,{})}}function xo(t){let n,r,o,i;return n=new ar({}),o=new tr({}),{c(){Ee(n.$$.fragment),r=R(),Ee(o.$$.fragment)},m(e,t){Ce(n,e,t),C(e,r,t),Ce(o,e,t),i=!0},p:e,i(e){i||($e(n.$$.fragment,e),$e(o.$$.fragment,e),i=!0)},o(e){ve(n.$$.fragment,e),ve(o.$$.fragment,e),i=!1},d(e){Pe(n,e),e&&P(r),Pe(o,e)}}}function ko(e){let t,n;return t=new Xt({props:{$$slots:{default:[Po]},$$scope:{ctx:e}}}),{c(){Ee(t.$$.fragment)},m(e,r){Ce(t,e,r),n=!0},p(e,n){const r={};10&n&&(r.$$scope={dirty:n,ctx:e}),t.$set(r)},i(e){n||($e(t.$$.fragment,e),n=!0)},o(e){ve(t.$$.fragment,e),n=!1},d(e){Pe(t,e)}}}function So(e){let t,n;return t=new Xt({props:{$$slots:{default:[No]},$$scope:{ctx:e}}}),{c(){Ee(t.$$.fragment)},m(e,r){Ce(t,e,r),n=!0},p(e,n){const r={};8&n&&(r.$$scope={dirty:n,ctx:e}),t.$set(r)},i(e){n||($e(t.$$.fragment,e),n=!0)},o(e){ve(t.$$.fragment,e),n=!1},d(e){Pe(t,e)}}}function Eo(e){let t,n;return{c(){t=O("Erreur lors de la récupération des similarités : "),n=O(e[1])},m(e,r){C(e,t,r),C(e,n,r)},p(e,t){2&t&&_(n,e[1])},d(e){e&&P(t),e&&P(n)}}}function Co(e){let t,n;return{c(){t=O("Error when retrieving similarities: "),n=O(e[1])},m(e,r){C(e,t,r),C(e,n,r)},p(e,t){2&t&&_(n,e[1])},d(e){e&&P(t),e&&P(n)}}}function Po(e){let t;let n=("en"===_e?Co:Eo)(e);return{c(){t=I("tr"),n.c(),V(t,"class","faded is-center")},m(e,r){C(e,t,r),n.m(t,null)},p(e,t){n.p(e,t)},d(e){e&&P(t),n.d()}}}function No(t){let n;return{c(){n=I("tr"),n.textContent=""+("en"===_e?"Retrieving similarities...":"Récupération des similarités..."),V(n,"class","faded is-center")},m(e,t){C(e,n,t)},p:e,d(e){e&&P(n)}}}function Io(e){let t,n,r=ze.includes("similarity"),o=r&&function(e){let t,n,r,o,i,s,a,l;t=new yo({}),r=new gr({});const c=[So,ko,xo],u=[];function d(e,t){return e[0]?0:e[1]?1:2}return i=d(e),s=u[i]=c[i](e),{c(){Ee(t.$$.fragment),n=R(),Ee(r.$$.fragment),o=R(),s.c(),a=A()},m(e,s){Ce(t,e,s),C(e,n,s),Ce(r,e,s),C(e,o,s),u[i].m(e,s),C(e,a,s),l=!0},p(e,t){let n=i;i=d(e),i===n?u[i].p(e,t):(ge(),ve(u[n],1,1,(()=>{u[n]=null})),he(),s=u[i],s?s.p(e,t):(s=u[i]=c[i](e),s.c()),$e(s,1),s.m(a.parentNode,a))},i(e){l||($e(t.$$.fragment,e),$e(r.$$.fragment,e),$e(s),l=!0)},o(e){ve(t.$$.fragment,e),ve(r.$$.fragment,e),ve(s),l=!1},d(e){Pe(t,e),e&&P(n),Pe(r,e),e&&P(o),u[i].d(e),e&&P(a)}}}(e);return{c(){o&&o.c(),t=A()},m(e,r){o&&o.m(e,r),C(e,t,r),n=!0},p(e,[t]){r&&o.p(e,t)},i(e){n||($e(o),n=!0)},o(e){ve(o),n=!1},d(e){o&&o.d(e),e&&P(t)}}}function Lo(e,t,n){let r,o;d(e,Je,(e=>n(0,r=e))),d(e,Ze,(e=>n(1,o=e)));const{fetchSimilarity:i}=Ht;return W((()=>{ze.includes("similarity")&&i()})),[r,o]}class Oo extends Le{constructor(e){super(),Ie(this,e,Lo,Io,s,{})}}function Ro(e){let t,n,r,o,i,s,a,c,u,d,p,$,v,b,w,y,x,S;const E=e[4].default,N=f(E,e,e[3],null);return{c(){t=I("tr"),n=I("th"),r=I("div"),o=I("img"),a=R(),c=I("div"),u=I("a"),d=I("i"),p=O("\n                    Page "),$=O(e[0]),b=R(),w=I("td"),y=I("div"),x=I("div"),N&&N.c(),l(o.src,i=Ke(e[1],"full","250,"))||V(o,"src",i),V(o,"alt",s="Canvas "+e[0]),V(o,"class","mb-3 card"),V(d,"class","fa-solid fa-pen-to-square"),V(u,"class","tag px-2 py-1 is-rounded is-hoverable"),V(u,"href",v=et(e[2],e[0])),V(u,"target","_blank"),V(c,"class","is-center mb-1"),V(r,"class","content-wrapper py-5"),V(n,"class","is-3 center-flex is-narrow"),U(n,"width","260px"),V(x,"class","grid is-gap-2"),V(y,"class","fixed-grid has-6-cols"),V(w,"class","p-5 is-fullwidth")},m(e,i){C(e,t,i),k(t,n),k(n,r),k(r,o),k(r,a),k(r,c),k(c,u),k(u,d),k(u,p),k(u,$),k(t,b),k(t,w),k(w,y),k(y,x),N&&N.m(x,null),S=!0},p(e,[t]){(!S||2&t&&!l(o.src,i=Ke(e[1],"full","250,")))&&V(o,"src",i),(!S||1&t&&s!==(s="Canvas "+e[0]))&&V(o,"alt",s),(!S||1&t)&&_($,e[0]),(!S||1&t&&v!==(v=et(e[2],e[0])))&&V(u,"href",v),N&&N.p&&(!S||8&t)&&g(N,E,e,e[3],S?m(E,e[3],t,null):h(e[3]),null)},i(e){S||($e(N,e),S=!0)},o(e){ve(N,e),S=!1},d(e){e&&P(t),N&&N.d(e)}}}function Ao(e,t,n){let{$$slots:r={},$$scope:o}=t,{canvasNb:i}=t,{canvasImg:s}=t;const a=K("manifest");return e.$$set=e=>{"canvasNb"in e&&n(0,i=e.canvasNb),"canvasImg"in e&&n(1,s=e.canvasImg),"$$scope"in e&&n(3,o=e.$$scope)},[i,s,a,o,r]}class Mo extends Le{constructor(e){super(),Ie(this,e,Ao,Ro,s,{canvasNb:0,canvasImg:1})}}function To(e,t,n){const r=e.slice();return r[9]=t[n][0],r[10]=t[n][1],r}function Vo(e,t,n){const r=e.slice();return r[13]=t[n],r}function _o(t){let n,r,o="en"===_e?`Error when retrieving paginated regions: ${t[16]}`:`Erreur de récupération des pages : ${t[16]}`;return{c(){n=I("tr"),r=O(o),V(n,"class","faded is-center")},m(e,t){C(e,n,t),k(n,r)},p(e,t){1&t&&o!==(o="en"===_e?`Error when retrieving paginated regions: ${e[16]}`:`Erreur de récupération des pages : ${e[16]}`)&&_(r,o)},i:e,o:e,d(e){e&&P(n)}}}function jo(e){let t,n,r,o,i;const s=[qo,Uo],a=[];function l(e,n){return 2&n&&(t=null),null==t&&(t=!!(Object.values(e[1]).length>0)),t?0:1}return n=l(e,-1),r=a[n]=s[n](e),{c(){r.c(),o=A()},m(e,t){a[n].m(e,t),C(e,o,t),i=!0},p(e,t){let i=n;n=l(e,t),n===i?a[n].p(e,t):(ge(),ve(a[i],1,1,(()=>{a[i]=null})),he(),r=a[n],r?r.p(e,t):(r=a[n]=s[n](e),r.c()),$e(r,1),r.m(o.parentNode,o))},i(e){i||($e(r),i=!0)},o(e){ve(r),i=!1},d(e){a[n].d(e),e&&P(o)}}}function Uo(t){let n,r,o;return r=new St({}),{c(){n=I("tr"),Ee(r.$$.fragment)},m(e,t){C(e,n,t),Ce(r,n,null),o=!0},p:e,i(e){o||($e(r.$$.fragment,e),o=!0)},o(e){ve(r.$$.fragment,e),o=!1},d(e){e&&P(n),Pe(r)}}}function qo(e){let t,n,r=Object.entries(e[1]),o=[];for(let t=0;t<r.length;t+=1)o[t]=Ho(To(e,r,t));const i=e=>ve(o[e],1,1,(()=>{o[e]=null}));return{c(){for(let e=0;e<o.length;e+=1)o[e].c();t=A()},m(e,r){for(let t=0;t<o.length;t+=1)o[t]&&o[t].m(e,r);C(e,t,r),n=!0},p(e,n){if(34&n){let s;for(r=Object.entries(e[1]),s=0;s<r.length;s+=1){const i=To(e,r,s);o[s]?(o[s].p(i,n),$e(o[s],1)):(o[s]=Ho(i),o[s].c(),$e(o[s],1),o[s].m(t.parentNode,t))}for(ge(),s=r.length;s<o.length;s+=1)i(s);he()}},i(e){if(!n){for(let e=0;e<r.length;e+=1)$e(o[e]);n=!0}},o(e){o=o.filter(Boolean);for(let e=0;e<o.length;e+=1)ve(o[e]);n=!1},d(e){N(o,e),e&&P(t)}}}function zo(e,t){let n,r,o;return r=new ht({props:{item:t[13],isSquare:!1}}),{key:e,first:null,c(){n=A(),Ee(r.$$.fragment),this.first=n},m(e,t){C(e,n,t),Ce(r,e,t),o=!0},p(e,n){t=e;const o={};2&n&&(o.item=t[13]),r.$set(o)},i(e){o||($e(r.$$.fragment,e),o=!0)},o(e){ve(r.$$.fragment,e),o=!1},d(e){e&&P(n),Pe(r,e)}}}function Do(e){let t,n,r=[],o=new Map,i=Object.values(e[10]);const s=e=>e[13].id;for(let t=0;t<i.length;t+=1){let n=Vo(e,i,t),a=s(n);o.set(a,r[t]=zo(a,n))}return{c(){for(let e=0;e<r.length;e+=1)r[e].c();t=R()},m(e,o){for(let t=0;t<r.length;t+=1)r[t]&&r[t].m(e,o);C(e,t,o),n=!0},p(e,n){2&n&&(i=Object.values(e[10]),ge(),r=Se(r,n,s,1,e,i,o,t.parentNode,ke,zo,t,Vo),he())},i(e){if(!n){for(let e=0;e<i.length;e+=1)$e(r[e]);n=!0}},o(e){for(let e=0;e<r.length;e+=1)ve(r[e]);n=!1},d(e){for(let t=0;t<r.length;t+=1)r[t].d(e);e&&P(t)}}}function Ho(e){let t,n;return t=new Mo({props:{canvasImg:e[5](e[9]),canvasNb:e[9],$$slots:{default:[Do]},$$scope:{ctx:e}}}),{c(){Ee(t.$$.fragment)},m(e,r){Ce(t,e,r),n=!0},p(e,n){const r={};2&n&&(r.canvasImg=e[5](e[9])),2&n&&(r.canvasNb=e[9]),131074&n&&(r.$$scope={dirty:n,ctx:e}),t.$set(r)},i(e){n||($e(t.$$.fragment,e),n=!0)},o(e){ve(t.$$.fragment,e),n=!1},d(e){Pe(t,e)}}}function Fo(t){let n;return{c(){n=I("tr"),n.textContent=""+("en"===_e?"Retrieving paginated regions...":"Récupération des pages..."),V(n,"class","faded is-center")},m(e,t){C(e,n,t)},p:e,i:e,o:e,d(e){e&&P(n)}}}function Bo(e){let t,n,r,o={ctx:e,current:null,token:null,hasCatch:!0,pending:Fo,then:jo,catch:_o,value:8,error:16,blocks:[,,,]};return ye(n=e[0],o),{c(){t=A(),o.block.c()},m(e,n){C(e,t,n),o.block.m(e,o.anchor=n),o.mount=()=>t.parentNode,o.anchor=t,r=!0},p(t,r){e=t,o.ctx=e,1&r&&n!==(n=e[0])&&ye(n,o)||xe(o,e,r)},i(e){r||($e(o.block),r=!0)},o(e){for(let e=0;e<3;e+=1){ve(o.blocks[e])}r=!1},d(e){e&&P(t),o.block.d(e),o.token=null,o=null}}}function Xo(e){let t,n,r,o,i,s;return t=new nn({props:{store:ot,nbOfItems:e[4]}}),r=new Xt({props:{$$slots:{default:[Bo]},$$scope:{ctx:e}}}),i=new nn({props:{store:ot,nbOfItems:e[4]}}),{c(){Ee(t.$$.fragment),n=R(),Ee(r.$$.fragment),o=R(),Ee(i.$$.fragment)},m(e,a){Ce(t,e,a),C(e,n,a),Ce(r,e,a),C(e,o,a),Ce(i,e,a),s=!0},p(e,[t]){const n={};131075&t&&(n.$$scope={dirty:t,ctx:e}),r.$set(n)},i(e){s||($e(t.$$.fragment,e),$e(r.$$.fragment,e),$e(i.$$.fragment,e),s=!0)},o(e){ve(t.$$.fragment,e),ve(r.$$.fragment,e),ve(i.$$.fragment,e),s=!1},d(e){Pe(t,e),e&&P(n),Pe(r,e),e&&P(o),Pe(i,e)}}}function Jo(e,t,n){let r,o;const{pageRegions:i,fetchPages:s}=ot;d(e,i,(e=>n(1,o=e))),d(e,s,(e=>n(0,r=e)));const a=K("nbOfPages"),l=K("trailingZeros");return[r,o,i,s,a,function(e){return`${imgPrefix}_${t=e,n=l,t.toString().padStart(n,"0")}`;var t,n}]}class Zo extends Le{constructor(e){super(),Ie(this,e,Jo,Xo,s,{})}}function Go(t){let n,r,o,i,s,a,l,c="en"===_e?"Save selection":"Sauvegarder la sélection";return{c(){n=I("button"),r=I("span"),o=I("i"),i=R(),s=O(c),V(o,"class","fa-solid fa-floppy-disk"),V(n,"class","button is-link")},m(e,c){C(e,n,c),k(n,r),k(r,o),k(r,i),k(r,s),a||(l=M(n,"click",t[6]),a=!0)},p:e,d(e){e&&P(n),a=!1,l()}}}function Wo(e){let t,n,r,o,i,s,a="en"===_e?"Go to treatment":"Accéder au traitement";return{c(){t=I("a"),n=I("span"),r=I("i"),o=R(),i=O(a),V(r,"class","fa-solid fa-gear"),V(t,"class","button is-link"),V(t,"href",s="/"+je+"/treatment/add/?document_set="+e[2](e[0]).id)},m(e,s){C(e,t,s),k(t,n),k(n,r),k(n,o),k(n,i)},p(e,n){5&n&&s!==(s="/"+je+"/treatment/add/?document_set="+e[2](e[0]).id)&&V(t,"href",s)},d(e){e&&P(t)}}}function Yo(t){let n,r,o,i,s,a;function l(e,t){return e[1]?Wo:Go}let c=l(t),u=c(t);return{c(){n=I("footer"),r=I("div"),o=I("button"),o.textContent=""+("en"===_e?"Clear selection":"Vider la sélection"),i=R(),u.c(),V(o,"class","button button-close is-link is-light"),V(r,"class","buttons"),V(n,"class","modal-card-foot is-center")},m(e,l){C(e,n,l),k(n,r),k(r,o),k(r,i),u.m(r,null),s||(a=M(o,"click",t[5]),s=!0)},p(e,[t]){c===(c=l(e))&&u?u.p(e,t):(u.d(1),u=c(e),u&&(u.c(),u.m(r,null)))},i:e,o:e,d(e){e&&P(n),u.d(),s=!1,a()}}}function Qo(e,t,n){let r,o;const{isSaved:i,selection:s}=rt;d(e,i,(e=>n(1,r=e))),d(e,s,(e=>n(2,o=e)));let{isRegion:a=!0}=t;return e.$$set=e=>{"isRegion"in e&&n(0,a=e.isRegion)},[a,r,o,i,s,()=>rt.empty(a),()=>rt.save(a)]}class Ko extends Le{constructor(e){super(),Ie(this,e,Qo,Yo,s,{isRegion:0})}}function ei(e){let t,n,r,i,s,a,l=e[5](e[0])+"";return{c(){t=I("span"),n=O(l),r=R(),i=I("span"),i.innerHTML='<i class="fas fa-edit"></i>',V(i,"class","pl-3 smaller has-text-link")},m(o,l){C(o,t,l),k(t,n),k(t,r),k(t,i),s||(a=[M(t,"click",e[7]),M(t,"keyup",null)],s=!0)},p(e,t){33&t&&l!==(l=e[5](e[0])+"")&&_(n,l)},d(e){e&&P(t),s=!1,o(a)}}}function ti(e){let t,n,r;return{c(){t=I("input"),V(t,"class","input selection-title svelte-sgypdx")},m(o,i){C(o,t,i),e[12](t),j(t,e[4]),n||(r=[M(t,"input",e[13]),M(t,"keydown",e[8]),M(t,"blur",e[9])],n=!0)},p(e,n){16&n&&t.value!==e[4]&&j(t,e[4])},d(i){i&&P(t),e[12](null),n=!1,o(r)}}}function ni(e){let t,n,r,o,i,s,a,l,c,u,d,p,$,v,b,w,y,x;function S(e,t){return e[2]?ti:ei}let E=S(e),N=E(e);const L=e[11].default,A=f(L,e,e[10],null);return y=new Ko({props:{isRegion:e[0]}}),{c(){t=I("div"),n=I("div"),r=R(),o=I("div"),i=I("div"),s=I("div"),a=I("i"),l=R(),N.c(),c=O("\n                ("),u=O(e[1]),d=O(")"),p=R(),$=I("button"),v=R(),b=I("section"),A&&A.c(),w=R(),Ee(y.$$.fragment),V(n,"class","modal-background"),V(a,"class","fa-solid fa-book-bookmark"),V(s,"class","title is-4 mb-0 media-content"),V($,"class","delete media-left"),V($,"aria-label","close"),V(i,"class","modal-card-head media mb-0 is-middle"),V(b,"class","modal-card-body"),V(o,"class","modal-content"),V(t,"id","selection-modal"),V(t,"class","modal fade"),V(t,"tabindex","-1"),V(t,"aria-labelledby","selection-modal-label"),V(t,"aria-hidden","true")},m(e,f){C(e,t,f),k(t,n),k(t,r),k(t,o),k(o,i),k(i,s),k(s,a),k(s,l),N.m(s,null),k(s,c),k(s,u),k(s,d),k(i,p),k(i,$),k(o,v),k(o,b),A&&A.m(b,null),k(o,w),Ce(y,o,null),x=!0},p(e,[t]){E===(E=S(e))&&N?N.p(e,t):(N.d(1),N=E(e),N&&(N.c(),N.m(s,c))),(!x||2&t)&&_(u,e[1]),A&&A.p&&(!x||1024&t)&&g(A,L,e,e[10],x?m(L,e[10],t,null):h(e[10]),null);const n={};1&t&&(n.isRegion=e[0]),y.$set(n)},i(e){x||($e(A,e),$e(y.$$.fragment,e),x=!0)},o(e){ve(A,e),ve(y.$$.fragment,e),x=!1},d(e){e&&P(t),N.d(),A&&A.d(e),Pe(y)}}}function ri(e,t,n){let r,{$$slots:o={},$$scope:i}=t;const{selectionTitle:s,updateTitle:a,save:l}=rt;d(e,s,(e=>n(5,r=e)));let c,u,{isRegion:f=!1}=t,{selectionLength:p=!1}=t,m=!1;function g(){n(2,m=!1),a(u,f),l(f)}return e.$$set=e=>{"isRegion"in e&&n(0,f=e.isRegion),"selectionLength"in e&&n(1,p=e.selectionLength),"$$scope"in e&&n(10,i=e.$$scope)},[f,p,m,c,u,r,s,function(){n(2,m=!0),n(4,u=r(f)),setTimeout((()=>c&&c.focus()),0)},function(e){"Enter"===e.key&&g()},g,i,o,function(e){te[e?"unshift":"push"]((()=>{c=e,n(3,c)}))},function(){u=this.value,n(4,u)}]}class oi extends Le{constructor(e){super(),Ie(this,e,ri,ni,s,{isRegion:0,selectionLength:1})}}const ii=function(){const e=`${window.location.origin}${window.location.pathname}`,t=Te(1),n=Te([]),r=Te([]),o=(async()=>{const t=await fetch(`${e}vectorized-images`).then((e=>e.json())).then((e=>(n.set(e),e))).catch((e=>console.error("Error:",e)));return a(i()),t})(),i=()=>Ye(t,"vp"),s=Ve(t,(e=>(async()=>function(e){const t=49*(e-1),o=t+49,i=u(n).slice(t,o);return r.set(i),i}(e))()));function a(e){Qe(e,t,"vp")}return{currentPage:t,pageLength:49,vectImgs:n,fetchVectorization:o,setPageVectImgs:s,pageVectImgs:r,handlePageUpdate:a}}();function si(e){let t,n;return{c(){t=new D(!1),n=A(),t.a=n},m(r,o){t.m(e[2],r,o),C(r,n,o)},p(e,n){4&n&&t.p(e[2])},d(e){e&&P(n),e&&t.d()}}}function ai(e){let t,n,r,i,s,a,c,u,d,f,p=!e[1]&&e[2]&&si(e);return{c(){t=I("div"),n=I("figure"),r=I("div"),p&&p.c(),i=R(),s=I("img"),V(r,"class","svg-container svelte-1egync3"),l(s.src,a=e[4])||V(s,"src",a),V(s,"alt","Extracted region"),V(s,"class","svelte-1egync3"),V(n,"class","image card region-image svelte-1egync3"),U(n,"width",e[0]+"px"),U(n,"aspect-ratio",e[3]?e[3].split(" ")[2]/e[3].split(" ")[3]:1),V(t,"class","svg-regions is-center svelte-1egync3")},m(o,a){C(o,t,a),k(t,n),k(n,r),p&&p.m(r,null),k(n,i),k(n,s),u=!0,d||(f=[M(t,"mouseenter",e[6]),M(t,"mouseleave",e[7])],d=!0)},p(e,[t]){!e[1]&&e[2]?p?p.p(e,t):(p=si(e),p.c(),p.m(r,null)):p&&(p.d(1),p=null),(!u||1&t)&&U(n,"width",e[0]+"px"),(!u||8&t)&&U(n,"aspect-ratio",e[3]?e[3].split(" ")[2]/e[3].split(" ")[3]:1)},i(e){u||(se((()=>{u&&(c||(c=we(t,Re,{duration:500},!0)),c.run(1))})),u=!0)},o(e){c||(c=we(t,Re,{duration:500},!1)),c.run(0),u=!1},d(e){e&&P(t),p&&p.d(),e&&c&&c.end(),d=!1,o(f)}}}function li(e,t,n){let{svgPath:r}=t,{width:o=200}=t;const[i,s,a,l]=r.replace(".svg","").split("_"),c=Ke(`${i}_${s}_${a}`,l,`${o},`);let u=!1,d="",f="";W((async()=>{const e=await fetch(`${Be}svg/${r}`),t=await e.text(),o=(new DOMParser).parseFromString(t,"image/svg+xml"),i=o.querySelector("svg");n(3,f=i.getAttribute("viewBox")||`0 0 ${i.getAttribute("width")} ${i.getAttribute("height")}`),o.querySelectorAll("image").forEach((e=>e.remove())),i.setAttribute("viewBox",f),i.removeAttribute("width"),i.removeAttribute("height"),n(2,d=(new XMLSerializer).serializeToString(o.documentElement))}));return e.$$set=e=>{"svgPath"in e&&n(5,r=e.svgPath),"width"in e&&n(0,o=e.width)},[o,u,d,f,c,r,()=>n(1,u=!0),()=>n(1,u=!1)]}class ci extends Le{constructor(e){super(),Ie(this,e,li,ai,s,{svgPath:5,width:0})}}function ui(t){let n,r,o,i,s,a,l,c="en"===_e?"Download All":"Tout Télécharger";return{c(){n=I("div"),r=I("button"),o=I("i"),i=R(),s=O(c),V(o,"class","fa-solid fa-download"),V(r,"class","button is-link is-light"),V(n,"class","is-right mb-3")},m(e,c){C(e,n,c),k(n,r),k(r,o),k(r,i),k(r,s),a||(l=M(r,"click",t[0]),a=!0)},p:e,i:e,o:e,d(e){e&&P(n),a=!1,l()}}}function di(e){const t=`${window.location.origin}${window.location.pathname}`,n=parseInt(t.split("witness/")[1].replace("/","")),r=parseInt(t.split("regions/")[1].replace("/",""));return[async function(){if(!r&&!n)return void console.error("No Region or Witness");const e=r?`${window.location.origin}/${je}/export-regions-imgs-and-svgs/${r}`:`${window.location.origin}/${je}/export-all-imgs-and-svgs/${n}`;try{const t=await Ge((()=>fetch(e,{method:"GET",headers:{"X-CSRFToken":qe,"Content-Type":"application/json"}})));if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);nt(await t.blob(),"vectorizations.zip")}catch(e){console.error("Erreur lors du téléchargement des vectorisations:",e)}}]}class fi extends Le{constructor(e){super(),Ie(this,e,di,ui,s,{})}}function pi(e,t,n){const r=e.slice();return r[8]=t[n],r}function mi(t){let n;let r=("en"===_e?hi:gi)(t);return{c(){n=I("div"),r.c(),V(n,"class","faded is-center")},m(e,t){C(e,n,t),r.m(n,null)},p(e,t){r.p(e,t)},i:e,o:e,d(e){e&&P(n),r.d()}}}function gi(e){let t,n,r=e[11]+"";return{c(){t=O("Erreur lors de la récupération des régions vectorisées : "),n=O(r)},m(e,r){C(e,t,r),C(e,n,r)},p(e,t){2&t&&r!==(r=e[11]+"")&&_(n,r)},d(e){e&&P(t),e&&P(n)}}}function hi(e){let t,n,r=e[11]+"";return{c(){t=O("Error when retrieving vectorized regions: "),n=O(r)},m(e,r){C(e,t,r),C(e,n,r)},p(e,t){2&t&&r!==(r=e[11]+"")&&_(n,r)},d(e){e&&P(t),e&&P(n)}}}function $i(e){let t,n,r=[],o=new Map,i=e[2];const s=e=>e[8].id;for(let t=0;t<i.length;t+=1){let n=pi(e,i,t),a=s(n);o.set(a,r[t]=bi(a,n))}let a=null;return i.length||(a=vi()),{c(){for(let e=0;e<r.length;e+=1)r[e].c();t=A(),a&&a.c()},m(e,o){for(let t=0;t<r.length;t+=1)r[t]&&r[t].m(e,o);C(e,t,o),a&&a.m(e,o),n=!0},p(e,n){4&n&&(i=e[2],ge(),r=Se(r,n,s,1,e,i,o,t.parentNode,ke,bi,t,pi),he(),!i.length&&a?a.p(e,n):i.length?a&&(a.d(1),a=null):(a=vi(),a.c(),a.m(t.parentNode,t)))},i(e){if(!n){for(let e=0;e<i.length;e+=1)$e(r[e]);n=!0}},o(e){for(let e=0;e<r.length;e+=1)ve(r[e]);n=!1},d(e){for(let t=0;t<r.length;t+=1)r[t].d(e);e&&P(t),a&&a.d(e)}}}function vi(t){let n,r;return{c(){n=I("div"),n.textContent=""+("en"===_e?"No vectorization":"Pas de vectorisation"),r=R(),V(n,"class","faded is-center")},m(e,t){C(e,n,t),C(e,r,t)},p:e,d(e){e&&P(n),e&&P(r)}}}function bi(e,t){let n,r,o;return r=new ci({props:{svgPath:t[8]}}),{key:e,first:null,c(){n=A(),Ee(r.$$.fragment),this.first=n},m(e,t){C(e,n,t),Ce(r,e,t),o=!0},p(e,n){t=e;const o={};4&n&&(o.svgPath=t[8]),r.$set(o)},i(e){o||($e(r.$$.fragment,e),o=!0)},o(e){ve(r.$$.fragment,e),o=!1},d(e){e&&P(n),Pe(r,e)}}}function wi(t){let n;return{c(){n=I("div"),n.textContent=""+("en"===_e?"Retrieving vectorization page...":"Récupération la page de vectorisation..."),V(n,"class","faded is-center")},m(e,t){C(e,n,t)},p:e,i:e,o:e,d(e){e&&P(n)}}}function yi(e){let t,n,r,o,i,s,a,l,c;t=new fi({}),r=new nn({props:{store:ii,nbOfItems:e[0].length,pageLength:e[6]}});let u={ctx:e,current:null,token:null,hasCatch:!0,pending:wi,then:$i,catch:mi,value:7,error:11,blocks:[,,,]};return ye(s=e[1],u),l=new nn({props:{store:ii,nbOfItems:e[0].length,pageLength:e[6]}}),{c(){Ee(t.$$.fragment),n=R(),Ee(r.$$.fragment),o=R(),i=I("div"),u.block.c(),a=R(),Ee(l.$$.fragment),V(i,"class","grid is-gap-2 mx-5 svelte-1mje9rl")},m(e,s){Ce(t,e,s),C(e,n,s),Ce(r,e,s),C(e,o,s),C(e,i,s),u.block.m(i,u.anchor=null),u.mount=()=>i,u.anchor=null,C(e,a,s),Ce(l,e,s),c=!0},p(t,[n]){e=t;const o={};1&n&&(o.nbOfItems=e[0].length),r.$set(o),u.ctx=e,2&n&&s!==(s=e[1])&&ye(s,u)||xe(u,e,n);const i={};1&n&&(i.nbOfItems=e[0].length),l.$set(i)},i(e){c||($e(t.$$.fragment,e),$e(r.$$.fragment,e),$e(u.block),$e(l.$$.fragment,e),c=!0)},o(e){ve(t.$$.fragment,e),ve(r.$$.fragment,e);for(let e=0;e<3;e+=1){ve(u.blocks[e])}ve(l.$$.fragment,e),c=!1},d(e){Pe(t,e),e&&P(n),Pe(r,e),e&&P(o),e&&P(i),u.block.d(),u.token=null,u=null,e&&P(a),Pe(l,e)}}}function xi(e,t,n){let r,o,i;const{vectImgs:s,pageVectImgs:a,setPageVectImgs:l,pageLength:c}=ii;return d(e,s,(e=>n(0,r=e))),d(e,a,(e=>n(2,i=e))),d(e,l,(e=>n(1,o=e))),[r,o,i,s,a,l,c]}class ki extends Le{constructor(e){super(),Ie(this,e,xi,yi,s,{})}}function Si(t){let n;let r=("en"===_e?Ci:Ei)(t);return{c(){n=I("div"),r.c(),V(n,"class","container faded is-center")},m(e,t){C(e,n,t),r.m(n,null)},p(e,t){r.p(e,t)},i:e,o:e,d(e){e&&P(n),r.d()}}}function Ei(t){let n,r,o=t[2]+"";return{c(){n=O("Erreur lors de la récupération des régions vectorisées : "),r=O(o)},m(e,t){C(e,n,t),C(e,r,t)},p:e,d(e){e&&P(n),e&&P(r)}}}function Ci(t){let n,r,o=t[2]+"";return{c(){n=O("Error when retrieving vectorized regions: "),r=O(o)},m(e,t){C(e,n,t),C(e,r,t)},p:e,d(e){e&&P(n),e&&P(r)}}}function Pi(t){let n,r;return n=new ki({}),{c(){Ee(n.$$.fragment)},m(e,t){Ce(n,e,t),r=!0},p:e,i(e){r||($e(n.$$.fragment,e),r=!0)},o(e){ve(n.$$.fragment,e),r=!1},d(e){Pe(n,e)}}}function Ni(t){let n;return{c(){n=I("div"),n.textContent=""+("en"===_e?"Retrieving vectorized regions...":"Récupération des régions vectorisées..."),V(n,"class","container faded is-center")},m(e,t){C(e,n,t)},p:e,i:e,o:e,d(e){e&&P(n)}}}function Ii(e){let t,n,r=ze.includes("vectorization"),o=r&&function(e){let t,n,r={ctx:e,current:null,token:null,hasCatch:!0,pending:Ni,then:Pi,catch:Si,value:1,error:2,blocks:[,,,]};return ye(e[0],r),{c(){t=A(),r.block.c()},m(e,o){C(e,t,o),r.block.m(e,r.anchor=o),r.mount=()=>t.parentNode,r.anchor=t,n=!0},p(t,n){xe(r,e=t,n)},i(e){n||($e(r.block),n=!0)},o(e){for(let e=0;e<3;e+=1)ve(r.blocks[e]);n=!1},d(e){e&&P(t),r.block.d(e),r.token=null,r=null}}}(e);return{c(){o&&o.c(),t=A()},m(e,r){o&&o.m(e,r),C(e,t,r),n=!0},p(e,[t]){r&&o.p(e,t)},i(e){n||($e(o),n=!0)},o(e){ve(o),n=!1},d(e){o&&o.d(e),e&&P(t)}}}function Li(e){const{fetchVectorization:t}=ii;return[t]}class Oi extends Le{constructor(e){super(),Ie(this,e,Li,Ii,s,{})}}function Ri(e,t,n){const r=e.slice();return r[22]=t[n][0],r[23]=t[n][1],r}function Ai(e,t,n){const r=e.slice();return r[27]=t[n],r}function Mi(e,t,n){const r=e.slice();return r[31]=t[n][0],r[23]=t[n][1],r}function Ti(e){let t,n,r,o;return n=new Dt({}),{c(){t=I("div"),Ee(n.$$.fragment),V(t,"class","cell")},m(e,r){C(e,t,r),Ce(n,t,null),o=!0},i(e){o||($e(n.$$.fragment,e),se((()=>{o&&(r||(r=we(t,Re,{duration:500},!0)),r.run(1))})),o=!0)},o(e){ve(n.$$.fragment,e),r||(r=we(t,Re,{duration:500},!1)),r.run(0),o=!1},d(e){e&&P(t),Pe(n),e&&r&&r.end()}}}function Vi(e){let t,n,r,i,s,a,l=e[23].text+"";function c(){return e[20](e[31])}return{c(){t=I("li"),n=I("a"),r=O(l),i=R(),V(n,"href",null),q(t,"is-active",e[31]===e[3])},m(e,o){C(e,t,o),k(t,n),k(n,r),k(t,i),s||(a=[M(t,"click",c),M(t,"keyup",Yi)],s=!0)},p(n,o){e=n,4&o[0]&&l!==(l=e[23].text+"")&&_(r,l),12&o[0]&&q(t,"is-active",e[31]===e[3])},d(e){e&&P(t),s=!1,o(a)}}}function _i(t){let n,r;return n=new Oi({}),{c(){Ee(n.$$.fragment)},m(e,t){Ce(n,e,t),r=!0},p:e,i(e){r||($e(n.$$.fragment,e),r=!0)},o(e){ve(n.$$.fragment,e),r=!1},d(e){Pe(n,e)}}}function ji(t){let n,r;return n=new Oo({}),{c(){Ee(n.$$.fragment)},m(e,t){Ce(n,e,t),r=!0},p:e,i(e){r||($e(n.$$.fragment,e),r=!0)},o(e){ve(n.$$.fragment,e),r=!1},d(e){Pe(n,e)}}}function Ui(t){let n,r;return n=new Zo({}),{c(){Ee(n.$$.fragment)},m(e,t){Ce(n,e,t),r=!0},p:e,i(e){r||($e(n.$$.fragment,e),r=!0)},o(e){ve(n.$$.fragment,e),r=!1},d(e){Pe(n,e)}}}function qi(e){let t,n,r={ctx:e,current:null,token:null,hasCatch:!0,pending:Bi,then:Di,catch:zi,value:26,error:30,blocks:[,,,]};return ye(e[9],r),{c(){t=I("div"),r.block.c(),V(t,"class","grid is-gap-2")},m(e,o){C(e,t,o),r.block.m(t,r.anchor=null),r.mount=()=>t,r.anchor=null,n=!0},p(t,n){xe(r,e=t,n)},i(e){n||($e(r.block),n=!0)},o(e){for(let e=0;e<3;e+=1){ve(r.blocks[e])}n=!1},d(e){e&&P(t),r.block.d(),r.token=null,r=null}}}function zi(t){let n,r,o,i=t[30]+"";return{c(){n=I("div"),r=O("Error when retrieving regions: "),o=O(i)},m(e,t){C(e,n,t),k(n,r),k(n,o)},p:e,i:e,o:e,d(e){e&&P(n)}}}function Di(e){let t,n,r=[],o=new Map,i=Object.values(e[6]);const s=e=>e[27].id;for(let t=0;t<i.length;t+=1){let n=Ai(e,i,t),a=s(n);o.set(a,r[t]=Fi(a,n))}let a=null;return i.length||(a=Hi(e)),{c(){for(let e=0;e<r.length;e+=1)r[e].c();t=A(),a&&a.c()},m(e,o){for(let t=0;t<r.length;t+=1)r[t]&&r[t].m(e,o);C(e,t,o),a&&a.m(e,o),n=!0},p(e,n){3136&n[0]&&(i=Object.values(e[6]),ge(),r=Se(r,n,s,1,e,i,o,t.parentNode,ke,Fi,t,Ai),he(),!i.length&&a?a.p(e,n):i.length?a&&(ge(),ve(a,1,1,(()=>{a=null})),he()):(a=Hi(e),a.c(),$e(a,1),a.m(t.parentNode,t)))},i(e){if(!n){for(let e=0;e<i.length;e+=1)$e(r[e]);n=!0}},o(e){for(let e=0;e<r.length;e+=1)ve(r[e]);n=!1},d(e){for(let t=0;t<r.length;t+=1)r[t].d(e);e&&P(t),a&&a.d(e)}}}function Hi(t){let n,r;return n=new St({props:{currentRegionId:t[11],baseUrl:t[10]}}),{c(){Ee(n.$$.fragment)},m(e,t){Ce(n,e,t),r=!0},p:e,i(e){r||($e(n.$$.fragment,e),r=!0)},o(e){ve(n.$$.fragment,e),r=!1},d(e){Pe(n,e)}}}function Fi(e,t){let n,r,o;return r=new ht({props:{item:t[27]}}),{key:e,first:null,c(){n=A(),Ee(r.$$.fragment),this.first=n},m(e,t){C(e,n,t),Ce(r,e,t),o=!0},p(e,n){t=e;const o={};64&n[0]&&(o.item=t[27]),r.$set(o)},i(e){o||($e(r.$$.fragment,e),o=!0)},o(e){ve(r.$$.fragment,e),o=!1},d(e){e&&P(n),Pe(r,e)}}}function Bi(t){let n;return{c(){n=I("div"),n.textContent=""+("en"===_e?"Retrieving regions...":"Récupération des régions..."),V(n,"class","faded is-center")},m(e,t){C(e,n,t)},p:e,i:e,o:e,d(e){e&&P(n)}}}function Xi(t){let n;return{c(){n=I("div"),n.textContent=""+("en"===_e?"No regions in selection":"Aucune région sélectionnée")},m(e,t){C(e,n,t)},p:e,d(e){e&&P(n)}}}function Ji(e){let t,n,r=Object.entries(e[1]),o=[];for(let t=0;t<r.length;t+=1)o[t]=Zi(Ri(e,r,t));return{c(){t=I("div"),n=I("div");for(let e=0;e<o.length;e+=1)o[e].c();V(n,"class","grid is-gap-2"),V(t,"class","fixed-grid has-6-cols")},m(e,r){C(e,t,r),k(t,n);for(let e=0;e<o.length;e+=1)o[e]&&o[e].m(n,null)},p(e,t){if(2&t[0]){let i;for(r=Object.entries(e[1]),i=0;i<r.length;i+=1){const s=Ri(e,r,i);o[i]?o[i].p(s,t):(o[i]=Zi(s),o[i].c(),o[i].m(n,null))}for(;i<o.length;i+=1)o[i].d(1);o.length=r.length}},d(e){e&&P(t),N(o,e)}}}function Zi(e){let t,n,r,o,i,s,a,c,u,d,f,p,m,g=e[23].title+"";function h(){return e[21](e[22])}return{c(){t=I("div"),n=I("figure"),r=I("img"),i=R(),s=I("div"),a=I("span"),c=O(g),u=R(),d=I("button"),f=R(),l(r.src,o=Ke(e[23].img,e[23].xyhw,"96,"))||V(r,"src",o),V(r,"alt","Extracted region"),V(a,"class","overlay-desc"),V(s,"class","overlay is-center svelte-403wty"),V(n,"class","image is-64x64 card"),V(d,"class","delete region-btn"),V(d,"aria-label","remove from selection"),V(t,"class","selection cell svelte-403wty")},m(e,o){C(e,t,o),k(t,n),k(n,r),k(n,i),k(n,s),k(s,a),k(a,c),k(t,u),k(t,d),k(t,f),p||(m=M(d,"click",h),p=!0)},p(t,n){e=t,2&n[0]&&!l(r.src,o=Ke(e[23].img,e[23].xyhw,"96,"))&&V(r,"src",o),2&n[0]&&g!==(g=e[23].title+"")&&_(c,g)},d(e){e&&P(t),p=!1,m()}}}function Gi(e){let t;function n(e,t){return e[4]?Ji:Xi}let r=n(e),o=r(e);return{c(){o.c(),t=A()},m(e,n){o.m(e,n),C(e,t,n)},p(e,i){r===(r=n(e))&&o?o.p(e,i):(o.d(1),o=r(e),o&&(o.c(),o.m(t.parentNode,t)))},d(e){o.d(e),e&&P(t)}}}function Wi(e){let t,n,r,o,i,s,a,l,c,u,d,f,p,m,g,h,$,v,b,w,y=["all","page"].includes(e[3]);t=new lt({props:{visible:e[5]}}),r=new yt({}),i=new bt({props:{selectionLength:e[0]}}),u=new At({props:{baseUrl:e[10],currentRegionId:e[11],currentLayout:e[3]}});let x=y&&Ti(),S=Object.entries(e[2]),E=[];for(let t=0;t<S.length;t+=1)E[t]=Vi(Mi(e,S,t));const L=[qi,Ui,ji,_i],O=[];function A(e,t){return"all"===e[3]?0:"page"===e[3]?1:"similarity"===e[3]?2:"vectorization"===e[3]?3:-1}return~(h=A(e))&&($=O[h]=L[h](e)),b=new oi({props:{isRegion:!0,selectionLength:e[0],$$slots:{default:[Gi]},$$scope:{ctx:e}}}),{c(){Ee(t.$$.fragment),n=R(),Ee(r.$$.fragment),o=R(),Ee(i.$$.fragment),s=R(),a=I("div"),l=I("div"),c=I("div"),Ee(u.$$.fragment),d=R(),x&&x.c(),f=R(),p=I("div"),m=I("ul");for(let e=0;e<E.length;e+=1)E[e].c();g=R(),$&&$.c(),v=R(),Ee(b.$$.fragment),V(c,"class","cell is-left is-middle"),V(l,"class","actions grid"),V(m,"class","panel-tabs"),V(p,"class","tabs is-centered"),V(a,"id","nav-actions"),V(a,"class","mb-5 svelte-403wty")},m(e,$){Ce(t,e,$),C(e,n,$),Ce(r,e,$),C(e,o,$),Ce(i,e,$),C(e,s,$),C(e,a,$),k(a,l),k(l,c),Ce(u,c,null),k(l,d),x&&x.m(l,null),k(a,f),k(a,p),k(p,m);for(let e=0;e<E.length;e+=1)E[e]&&E[e].m(m,null);C(e,g,$),~h&&O[h].m(e,$),C(e,v,$),Ce(b,e,$),w=!0},p(e,n){const r={};32&n[0]&&(r.visible=e[5]),t.$set(r);const o={};1&n[0]&&(o.selectionLength=e[0]),i.$set(o);const s={};if(8&n[0]&&(s.currentLayout=e[3]),u.$set(s),8&n[0]&&(y=["all","page"].includes(e[3])),y?x?8&n[0]&&$e(x,1):(x=Ti(),x.c(),$e(x,1),x.m(l,null)):x&&(ge(),ve(x,1,1,(()=>{x=null})),he()),4108&n[0]){let t;for(S=Object.entries(e[2]),t=0;t<S.length;t+=1){const r=Mi(e,S,t);E[t]?E[t].p(r,n):(E[t]=Vi(r),E[t].c(),E[t].m(m,null))}for(;t<E.length;t+=1)E[t].d(1);E.length=S.length}let a=h;h=A(e),h===a?~h&&O[h].p(e,n):($&&(ge(),ve(O[a],1,1,(()=>{O[a]=null})),he()),~h?($=O[h],$?$.p(e,n):($=O[h]=L[h](e),$.c()),$e($,1),$.m(v.parentNode,v)):$=null);const c={};1&n[0]&&(c.selectionLength=e[0]),18&n[0]|8&n[1]&&(c.$$scope={dirty:n,ctx:e}),b.$set(c)},i(e){w||($e(t.$$.fragment,e),$e(r.$$.fragment,e),$e(i.$$.fragment,e),$e(u.$$.fragment,e),$e(x),$e($),$e(b.$$.fragment,e),w=!0)},o(e){ve(t.$$.fragment,e),ve(r.$$.fragment,e),ve(i.$$.fragment,e),ve(u.$$.fragment,e),ve(x),ve($),ve(b.$$.fragment,e),w=!1},d(e){Pe(t,e),e&&P(n),Pe(r,e),e&&P(o),Pe(i,e),e&&P(s),e&&P(a),Pe(u),x&&x.d(),N(E,e),e&&P(g),~h&&O[h].d(e),e&&P(v),Pe(b,e)}}}const Yi=()=>null;function Qi(e,t,n){let r,o,i,s,a,l,c;d(e,Je,(e=>n(5,l=e)));const{selected:u}=rt;d(e,u,(e=>n(19,a=e)));const{allRegions:f,fetchAll:p}=ot;d(e,f,(e=>n(6,c=e)));let{manifest:m=""}=t,{isValidated:g=!1}=t,{imgPrefix:h=""}=t,{nbOfPages:$=1}=t,{trailingZeros:v=1}=t,{witness:b={}}=t;Q("witness",b),Q("nbOfPages",$),Q("trailingZeros",v),Q("imgPrefix",h),Q("manifest",m),Q("isValidated",g);const w=`${window.location.origin}${window.location.pathname}`,y=parseInt(w.split("regions/")[1].replace("/","")),x={all:{text:"en"===_e?"All regions":"Toutes les régions"},page:{text:"en"===_e?"Per page":"Par page"}};function k(e){n(3,s=e);const t=new URL(window.location);t.searchParams.set("tab",e),window.history.pushState({},"",t)}ze.includes("similarity")&&(x.similarity={text:"en"===_e?"Similarity":"Similarité"}),ze.includes("vectorization")&&(x.vectorization={text:"en"===_e?"Vectorization":"Vectorisation"});return e.$$set=e=>{"manifest"in e&&n(13,m=e.manifest),"isValidated"in e&&n(14,g=e.isValidated),"imgPrefix"in e&&n(15,h=e.imgPrefix),"nbOfPages"in e&&n(16,$=e.nbOfPages),"trailingZeros"in e&&n(17,v=e.trailingZeros),"witness"in e&&n(18,b=e.witness)},e.$$.update=()=>{524288&e.$$.dirty[0]&&n(1,r=a(!0)),2&e.$$.dirty[0]&&n(0,o=Object.keys(r).length),1&e.$$.dirty[0]&&n(4,i=o>0)},n(3,s=new URLSearchParams(window.location.search).get("tab")??"all"),[o,r,x,s,i,l,c,u,f,p,w,y,k,m,g,h,$,v,b,a,e=>k(e),e=>rt.remove(e,De)]}return new class extends Le{constructor(e){super(),Ie(this,e,Qi,Wi,s,{manifest:13,isValidated:14,imgPrefix:15,nbOfPages:16,trailingZeros:17,witness:18},null,[-1,-1])}}({target:document.getElementById("region-list"),props:{witness:witness,manifest:manifest,isValidated:isValidated,imgPrefix:imgPrefix,nbOfPages:nbOfPages,trailingZeros:trailingZeros}})}();
//# sourceMappingURL=regionList.js.map
