var regionList=function(){"use strict";function t(){}const e=t=>t;function n(t){return t()}function r(){return Object.create(null)}function o(t){t.forEach(n)}function i(t){return"function"==typeof t}function s(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}let a;function l(t,e){return a||(a=document.createElement("a")),a.href=e,t===a.href}function c(e,...n){if(null==e)return t;const r=e.subscribe(...n);return r.unsubscribe?()=>r.unsubscribe():r}function u(t){let e;return c(t,(t=>e=t))(),e}function d(t,e,n){t.$$.on_destroy.push(c(e,n))}function f(t,e,n,r){if(t){const o=p(t,e,n,r);return t[0](o)}}function p(t,e,n,r){return t[1]&&r?function(t,e){for(const n in e)t[n]=e[n];return t}(n.ctx.slice(),t[1](r(e))):n.ctx}function g(t,e,n,r){if(t[2]&&r){const o=t[2](r(n));if(void 0===e.dirty)return o;if("object"==typeof o){const t=[],n=Math.max(e.dirty.length,o.length);for(let r=0;r<n;r+=1)t[r]=e.dirty[r]|o[r];return t}return e.dirty|o}return e.dirty}function m(t,e,n,r,o,i){if(o){const s=p(e,n,r,i);t.p(s,o)}}function h(t){if(t.ctx.length>32){const e=[],n=t.ctx.length/32;for(let t=0;t<n;t++)e[t]=-1;return e}return-1}function $(t){const e="string"==typeof t&&t.match(/^\s*(-?[\d.]+)([^\s]*)\s*$/);return e?[parseFloat(e[1]),e[2]||"px"]:[t,"px"]}const v="undefined"!=typeof window;let b=v?()=>window.performance.now():()=>Date.now(),w=v?t=>requestAnimationFrame(t):t;const y=new Set;function x(t){y.forEach((e=>{e.c(t)||(y.delete(e),e.f())})),0!==y.size&&w(x)}function k(t,e){t.appendChild(e)}function S(t){if(!t)return document;const e=t.getRootNode?t.getRootNode():t.ownerDocument;return e&&e.host?e:t.ownerDocument}function E(t){const e=L("style");return function(t,e){k(t.head||t,e),e.sheet}(S(t),e),e.sheet}function C(t,e,n){t.insertBefore(e,n||null)}function P(t){t.parentNode&&t.parentNode.removeChild(t)}function N(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function L(t){return document.createElement(t)}function O(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function I(t){return document.createTextNode(t)}function R(){return I(" ")}function A(){return I("")}function M(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}function V(t){return function(e){return e.preventDefault(),t.call(this,e)}}function T(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function _(t,e){e=""+e,t.data!==e&&(t.data=e)}function j(t,e){t.value=null==e?"":e}function U(t,e,n,r){null==n?t.style.removeProperty(e):t.style.setProperty(e,n,r?"important":"")}function q(t,e,n){t.classList[n?"add":"remove"](e)}function z(t,e,{bubbles:n=!1,cancelable:r=!1}={}){const o=document.createEvent("CustomEvent");return o.initCustomEvent(t,n,r,e),o}class D{constructor(t=!1){this.is_svg=!1,this.is_svg=t,this.e=this.n=null}c(t){this.h(t)}m(t,e,n=null){this.e||(this.is_svg?this.e=O(e.nodeName):this.e=L(11===e.nodeType?"TEMPLATE":e.nodeName),this.t="TEMPLATE"!==e.tagName?e:e.content,this.c(t)),this.i(n)}h(t){this.e.innerHTML=t,this.n=Array.from("TEMPLATE"===this.e.nodeName?this.e.content.childNodes:this.e.childNodes)}i(t){for(let e=0;e<this.n.length;e+=1)C(this.t,this.n[e],t)}p(t){this.d(),this.h(t),this.i(this.a)}d(){this.n.forEach(P)}}const H=new Map;let F,B=0;function X(t,e,n,r,o,i,s,a=0){const l=16.666/r;let c="{\n";for(let t=0;t<=1;t+=l){const r=e+(n-e)*i(t);c+=100*t+`%{${s(r,1-r)}}\n`}const u=c+`100% {${s(n,1-n)}}\n}`,d=`__svelte_${function(t){let e=5381,n=t.length;for(;n--;)e=(e<<5)-e^t.charCodeAt(n);return e>>>0}(u)}_${a}`,f=S(t),{stylesheet:p,rules:g}=H.get(f)||function(t,e){const n={stylesheet:E(e),rules:{}};return H.set(t,n),n}(f,t);g[d]||(g[d]=!0,p.insertRule(`@keyframes ${d} ${u}`,p.cssRules.length));const m=t.style.animation||"";return t.style.animation=`${m?`${m}, `:""}${d} ${r}ms linear ${o}ms 1 both`,B+=1,d}function J(t,e){const n=(t.style.animation||"").split(", "),r=n.filter(e?t=>t.indexOf(e)<0:t=>-1===t.indexOf("__svelte")),o=n.length-r.length;o&&(t.style.animation=r.join(", "),B-=o,B||w((()=>{B||(H.forEach((t=>{const{ownerNode:e}=t.stylesheet;e&&P(e)})),H.clear())})))}function Z(t){F=t}function W(){if(!F)throw new Error("Function called outside component initialization");return F}function Y(t){W().$$.on_mount.push(t)}function G(t,e){return W().$$.context.set(t,e),e}function Q(t){return W().$$.context.get(t)}const K=[],tt=[];let et=[];const nt=[],rt=Promise.resolve();let ot=!1;function it(t){et.push(t)}const st=new Set;let at,lt=0;function ct(){if(0!==lt)return;const t=F;do{try{for(;lt<K.length;){const t=K[lt];lt++,Z(t),ut(t.$$)}}catch(t){throw K.length=0,lt=0,t}for(Z(null),K.length=0,lt=0;tt.length;)tt.pop()();for(let t=0;t<et.length;t+=1){const e=et[t];st.has(e)||(st.add(e),e())}et.length=0}while(K.length);for(;nt.length;)nt.pop()();ot=!1,st.clear(),Z(t)}function ut(t){if(null!==t.fragment){t.update(),o(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(it)}}function dt(t,e,n){t.dispatchEvent(z(`${e?"intro":"outro"}${n}`))}const ft=new Set;let pt;function gt(){pt={r:0,c:[],p:pt}}function mt(){pt.r||o(pt.c),pt=pt.p}function ht(t,e){t&&t.i&&(ft.delete(t),t.i(e))}function $t(t,e,n,r){if(t&&t.o){if(ft.has(t))return;ft.add(t),pt.c.push((()=>{ft.delete(t),r&&(n&&t.d(1),r())})),t.o(e)}else r&&r()}const vt={duration:0};function bt(n,r,s,a){const l={direction:"both"};let c=r(n,s,l),u=a?0:1,d=null,f=null,p=null;function g(){p&&J(n,p)}function m(t,e){const n=t.b-u;return e*=Math.abs(n),{a:u,b:t.b,d:n,duration:e,start:t.start,end:t.start+e,group:t.group}}function h(r){const{delay:i=0,duration:s=300,easing:a=e,tick:l=t,css:h}=c||vt,$={start:b()+i,b:r};r||($.group=pt,pt.r+=1),d||f?f=$:(h&&(g(),p=X(n,u,r,s,i,a,h)),r&&l(0,1),d=m($,s),it((()=>dt(n,r,"start"))),function(t){let e;0===y.size&&w(x),new Promise((n=>{y.add(e={c:t,f:n})}))}((t=>{if(f&&t>f.start&&(d=m(f,s),f=null,dt(n,d.b,"start"),h&&(g(),p=X(n,u,d.b,d.duration,0,a,c.css))),d)if(t>=d.end)l(u=d.b,1-u),dt(n,d.b,"end"),f||(d.b?g():--d.group.r||o(d.group.c)),d=null;else if(t>=d.start){const e=t-d.start;u=d.a+d.d*a(e/d.duration),l(u,1-u)}return!(!d&&!f)})))}return{run(t){i(c)?(at||(at=Promise.resolve(),at.then((()=>{at=null}))),at).then((()=>{c=c(l),h(t)})):h(t)},end(){g(),d=f=null}}}function wt(t,e){const n=e.token={};function r(t,r,o,i){if(e.token!==n)return;e.resolved=i;let s=e.ctx;void 0!==o&&(s=s.slice(),s[o]=i);const a=t&&(e.current=t)(s);let l=!1;e.block&&(e.blocks?e.blocks.forEach(((t,n)=>{n!==r&&t&&(gt(),$t(t,1,1,(()=>{e.blocks[n]===t&&(e.blocks[n]=null)})),mt())})):e.block.d(1),a.c(),ht(a,1),a.m(e.mount(),e.anchor),l=!0),e.block=a,e.blocks&&(e.blocks[r]=a),l&&ct()}if(!(o=t)||"object"!=typeof o&&"function"!=typeof o||"function"!=typeof o.then){if(e.current!==e.then)return r(e.then,1,e.value,t),!0;e.resolved=t}else{const n=W();if(t.then((t=>{Z(n),r(e.then,1,e.value,t),Z(null)}),(t=>{if(Z(n),r(e.catch,2,e.error,t),Z(null),!e.hasCatch)throw t})),e.current!==e.pending)return r(e.pending,0),!0}var o}function yt(t,e,n){const r=e.slice(),{resolved:o}=t;t.current===t.then&&(r[t.value]=o),t.current===t.catch&&(r[t.error]=o),t.block.p(r,n)}function xt(t,e){$t(t,1,1,(()=>{e.delete(t.key)}))}function kt(t,e,n,r,i,s,a,l,c,u,d,f){let p=t.length,g=s.length,m=p;const h={};for(;m--;)h[t[m].key]=m;const $=[],v=new Map,b=new Map,w=[];for(m=g;m--;){const t=f(i,s,m),o=n(t);let l=a.get(o);l?r&&w.push((()=>l.p(t,e))):(l=u(o,t),l.c()),v.set(o,$[m]=l),o in h&&b.set(o,Math.abs(m-h[o]))}const y=new Set,x=new Set;function k(t){ht(t,1),t.m(l,d),a.set(t.key,t),d=t.first,g--}for(;p&&g;){const e=$[g-1],n=t[p-1],r=e.key,o=n.key;e===n?(d=e.first,p--,g--):v.has(o)?!a.has(r)||y.has(r)?k(e):x.has(o)?p--:b.get(r)>b.get(o)?(x.add(r),k(e)):(y.add(o),p--):(c(n,a),p--)}for(;p--;){const e=t[p];v.has(e.key)||c(e,a)}for(;g;)k($[g-1]);return o(w),$}function St(t){t&&t.c()}function Et(t,e,r,s){const{fragment:a,after_update:l}=t.$$;a&&a.m(e,r),s||it((()=>{const e=t.$$.on_mount.map(n).filter(i);t.$$.on_destroy?t.$$.on_destroy.push(...e):o(e),t.$$.on_mount=[]})),l.forEach(it)}function Ct(t,e){const n=t.$$;null!==n.fragment&&(!function(t){const e=[],n=[];et.forEach((r=>-1===t.indexOf(r)?e.push(r):n.push(r))),n.forEach((t=>t())),et=e}(n.after_update),o(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function Pt(t,e){-1===t.$$.dirty[0]&&(K.push(t),ot||(ot=!0,rt.then(ct)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function Nt(e,n,i,s,a,l,c,u=[-1]){const d=F;Z(e);const f=e.$$={fragment:null,ctx:[],props:l,update:t,not_equal:a,bound:r(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(n.context||(d?d.$$.context:[])),callbacks:r(),dirty:u,skip_bound:!1,root:n.target||d.$$.root};c&&c(f.root);let p=!1;if(f.ctx=i?i(e,n.props||{},((t,n,...r)=>{const o=r.length?r[0]:n;return f.ctx&&a(f.ctx[t],f.ctx[t]=o)&&(!f.skip_bound&&f.bound[t]&&f.bound[t](o),p&&Pt(e,t)),n})):[],f.update(),p=!0,o(f.before_update),f.fragment=!!s&&s(f.ctx),n.target){if(n.hydrate){const t=function(t){return Array.from(t.childNodes)}(n.target);f.fragment&&f.fragment.l(t),t.forEach(P)}else f.fragment&&f.fragment.c();n.intro&&ht(e.$$.fragment),Et(e,n.target,n.anchor,n.customElement),ct()}Z(d)}class Lt{$destroy(){Ct(this,1),this.$destroy=t}$on(e,n){if(!i(n))return t;const r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(n),()=>{const t=r.indexOf(n);-1!==t&&r.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}function Ot(t){const e=t-1;return e*e*e+1}function It(t,{delay:n=0,duration:r=400,easing:o=e}={}){const i=+getComputedStyle(t).opacity;return{delay:n,duration:r,easing:o,css:t=>"opacity: "+t*i}}function Rt(t,{delay:e=0,duration:n=400,easing:r=Ot,x:o=0,y:i=0,opacity:s=0}={}){const a=getComputedStyle(t),l=+a.opacity,c="none"===a.transform?"":a.transform,u=l*(1-s),[d,f]=$(o),[p,g]=$(i);return{delay:e,duration:n,easing:r,css:(t,e)=>`\n\t\t\ttransform: ${c} translate(${(1-t)*d}${f}, ${(1-t)*p}${g});\n\t\t\topacity: ${l-u*e}`}}const At=[];function Mt(e,n=t){let r;const o=new Set;function i(t){if(s(e,t)&&(e=t,r)){const t=!At.length;for(const t of o)t[1](),At.push(t,e);if(t){for(let t=0;t<At.length;t+=2)At[t][0](At[t+1]);At.length=0}}}return{set:i,update:function(t){i(t(e))},subscribe:function(s,a=t){const l=[s,a];return o.add(l),1===o.size&&(r=n(i)||t),s(e),()=>{o.delete(l),0===o.size&&r&&(r(),r=null)}}}}function Vt(e,n,r){const s=!Array.isArray(e),a=s?[e]:e,l=n.length<2;return u=e=>{let r=!1;const u=[];let d=0,f=t;const p=()=>{if(d)return;f();const r=n(s?u[0]:u,e);l?e(r):f=i(r)?r:t},g=a.map(((t,e)=>c(t,(t=>{u[e]=t,d&=~(1<<e),r&&p()}),(()=>{d|=1<<e}))));return r=!0,p(),function(){o(g),f(),r=!1}},{subscribe:Mt(r,u).subscribe};var u}const Tt=APP_LANG,_t=APP_NAME;WEBAPP_NAME;const jt=USER_ID;IS_SUPERUSER,ADD_PERMISSION;const Ut=CSRF_TOKEN,qt=ADDITIONAL_MODULES,zt="Region",Dt=SAS_APP_URL,Ht=CANTALOUPE_APP_URL,Ft=MEDIA_PATH,Bt=PAGE_LEN,Xt=Mt(!1),Jt=Mt("");async function Zt(t){Xt.set(!0);try{return await t()}finally{Xt.set(!1)}}function Wt(t,e=100){const n=Math.floor(.75*e);return t.length>e?t.slice(0,n)+"..."+t.slice(-e+n):t}function Yt(t,e){if("undefined"!=typeof window){const n=parseInt(new URLSearchParams(window.location.search).get(e));if(!isNaN(n))return t.set(n),n}return t.set(1),1}function Gt(t,e,n){if(e.set(t),"undefined"!=typeof window){const e=new URL(window.location.href);e.searchParams.set(n,t),window.history.pushState({},"",e)}}function Qt(t=null,e="full",n="full"){if(!t)return"https://placehold.co/96x96/png?text=No+image";if((t=t.split("_")).length<3)return"https://placehold.co/96x96/png?text=No+image";const r=t[t.length-1].includes(",")?t.pop().replace(".jpg",""):e,o=t.join("_").replace(".jpg","");return`${Ht??"http://localhost:8182"}/iiif/2/${o}.jpg/${r}/${n}/0/default.jpg`}function Kt(t=null,e=1){return`${Dt??"http://localhost:3000"}/index.html?iiif-content=${t}&canvas=${e}`}function te(t,e=null,n=!1){return new Promise((r=>{if(document.getElementById("msg-modal")){n?document.getElementById("modal-footer").hidden=!1:r(void 0),e&&(document.getElementById("modal-title").innerHTML=e),document.getElementById("modal-body").innerHTML=t,document.getElementById("hidden-msg-btn").click();const o=document.getElementById("cancel-btn"),i=document.getElementById("ok-btn"),s=document.getElementById("modal-bkg"),a=()=>{o.removeEventListener("click",l),s.removeEventListener("click",l),i.removeEventListener("click",c),document.getElementById("modal-footer").hidden=!0},l=()=>{a(),r(!1)},c=()=>{a(),r(!0)};o.addEventListener("click",l),i.addEventListener("click",c)}else n?r(window.confirm(t)):(window.alert(t),r(void 0))}))}function ee(t,e){const n=window.URL.createObjectURL(t),r=document.createElement("a");r.href=n,r.download=`${e}`,document.body.appendChild(r),r.click(),window.URL.revokeObjectURL(n),document.body.removeChild(r)}const ne=function(){const t={id:null,type:"documentSet",title:"en"===Tt?"Document set":"Set de document",selected:{}},e={id:null,type:"regionsSet",title:"en"===Tt?"Regions set":"Set de régions",selected:{}},n=Mt({records:JSON.parse(localStorage.getItem("documentSet"))||t,regions:JSON.parse(localStorage.getItem("regionsSet"))||e}),{subscribe:r,update:o,get:i}=n,s=Mt(!1);function a(t,e=!1){s.set(e),localStorage.setItem(t.type,JSON.stringify(t))}function l(t,e){return t[e?"regions":"records"]?.selected||{}}function c(t,e=!0){const n=l(t,e);return e?n[zt]??{}:Object.entries(n)}function u(t,e,n){const r=n===zt?"regions":"records",o=t[r],{[e]:i,...s}=o.selected[n];return t[r]={...o,selected:{...o.selected,[n]:s}},a(t[r]),t}function d(t,e,n=!0){const r=e.class===zt?"regions":"records",o=t[r],i=o.selected,s=e.class===zt?e:{title:e.title,url:e.url};return t[r]={...o,selected:{...i,[e.class]:{...i[e.class]||{},[e.id]:s}}},n&&a(t[r]),t}function f(t,e){return t[e.class.toLowerCase().includes("regions")?"regions":"records"].id===e.id}return{subscribe:r,save:t=>o((e=>function(t,e){const n=e?"regions-set":"document-set";if(e)return window.alert("Region set management is not yet implemented"),t;let r=t[e?"regions":"records"],i={};Object.entries(r.selected).forEach((([t,e])=>{i[t]=Object.keys(e)}));const a=null!==r.id?`${r.id}/change`:"add";return fetch(`${window.location.origin}/${_t}/${n}/${a}`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":Ut},body:JSON.stringify({title:r.title,selection:r,...i})}).then((t=>t.json())).then((t=>{if(!t?.document_set_id)throw new Error("Failed to save selection");o((n=>{const r=n[e?"regions":"records"];return r.id=t.document_set_id,r.title=t.document_set_title,s.set(!0),n}))})).catch((t=>console.error("Error:",t))),t}(e,t))),empty:n=>o((r=>(r[n?"regions":"records"]=n?e:t,a(r[n?"regions":"records"]),r))),removeAll:(t,e)=>o((n=>function(t,e,n){const r=n===zt?"regions":"records",o=t[r];let i=o.selected[n];return i&&Object.keys(i).length?(e.forEach((t=>{delete i[t]})),t[r]={...o,selected:{...o.selected,[n]:i}},a(t[r]),t):t}(n,t,e))),remove:(t,e)=>o((n=>u(n,t,e))),addAll:t=>o((e=>function(t,e){const n=e[0].type===zt;return e.forEach((e=>{t=d(t,e,!1)})),a(t[n?"regions":"records"]),t}(e,t))),add:t=>o((e=>d(e,t))),toggle:t=>o((e=>{const n=l(e,t.class===zt);return n[t.class]?.[t.id]?u(e,t.id,t.class):d(e,t)})),updateTitle:(t,e)=>o((n=>{const r=e?"regions":"records";return n[r]={...n[r],title:t},a(n[r],!0),n})),isSaved:s,isSelected:Vt(n,(t=>e=>l(t,e.class===zt)[e.class]?.hasOwnProperty(e.id)||!1)),isSetSelected:Vt(n,(t=>e=>f(t,e))),selected:Vt(n,(t=>e=>c(t,e))),nbSelected:Vt(n,(t=>e=>{const n=c(t,e);return e?Object.keys(n).length:n.reduce(((t,[e,n])=>t+Object.keys(n).length),0)})),selectionTitle:Vt(n,(t=>e=>t[e?"regions":"records"].title)),selection:Vt(n,(t=>e=>t[e?"regions":"records"])),toggleSet:n=>o((r=>f(r,n)?function(n,r){const o=r.class.toLowerCase().includes("regions");return n[o?"regions":"records"]=o?e:t,a(n[o?"regions":"records"]),n}(r,n):function(t,e){const n=e.class.toLowerCase().includes("regions")?"regions":"records";return null===e.selection.id&&(e.selection.id=e.id),t[n]=e.selection,a(t[n]),t}(r,n)))}}();const re=function(){const t=`${window.location.origin}${window.location.pathname}`,e=Mt(1),n=Mt({}),r=Mt({}),o=Mt("");Yt(e,"p");const i=(async()=>{const e=await fetch(`${t}canvas`),r=await e.json();let o={};return Object.values(r).forEach((t=>{Object.entries(t).forEach((([t,e])=>{o[t]=e}))})),n.set(o),r})(),s=Vt(e,(e=>(async()=>{const n=await fetch(`${t}canvas?p=${e}`),o=await n.json();return r.set(o),o})()));return{currentPage:e,pageRegions:r,allRegions:n,fetchPages:s,fetchAll:i,handlePageUpdate:function(t){Gt(t,e,"p")},remove:function(t){n.update((e=>(delete e[t],{...e}))),r.update((e=>{for(const n in e)if(e[n][t]){const{[t]:r,...o}=e[n];return e[n]=o,e}return e}))},clipBoard:o,copyRef:function(t){o.update((e=>{const n=e===t?"":t;return navigator.clipboard.writeText(n).then((t=>"")),n}))}}}();function oe(t){let e,n,r;return{c(){e=L("div"),e.innerHTML='<div class="loader svelte-vizlcg"></div>',T(e,"class","bkg-shade svelte-vizlcg")},m(t,n){C(t,e,n),r=!0},i(t){r||(it((()=>{r&&(n||(n=bt(e,It,{duration:150},!0)),n.run(1))})),r=!0)},o(t){n||(n=bt(e,It,{duration:150},!1)),n.run(0),r=!1},d(t){t&&P(e),t&&n&&n.end()}}}function ie(t){let e,n,r=t[0]&&oe();return{c(){r&&r.c(),e=A()},m(t,o){r&&r.m(t,o),C(t,e,o),n=!0},p(t,[n]){t[0]?r?1&n&&ht(r,1):(r=oe(),r.c(),ht(r,1),r.m(e.parentNode,e)):r&&(gt(),$t(r,1,1,(()=>{r=null})),mt())},i(t){n||(ht(r),n=!0)},o(t){$t(r),n=!1},d(t){r&&r.d(t),t&&P(e)}}}function se(t,e,n){let{visible:r=!1}=e;return t.$$set=t=>{"visible"in t&&n(0,r=t.visible)},[r]}class ae extends Lt{constructor(t){super(),Nt(this,t,se,ie,s,{visible:0})}}function le(t){let e;return{c(){e=O("path"),T(e,"d","M384 336H192c-8.8 0-16-7.2-16-16V64c0-8.8 7.2-16 16-16l140.1 0L400 115.9V320c0 8.8-7.2 16-16 16zM192 384H384c35.3 0 64-28.7 64-64V115.9c0-12.7-5.1-24.9-14.1-33.9L366.1 14.1c-9-9-21.2-14.1-33.9-14.1H192c-35.3 0-64 28.7-64 64V320c0 35.3 28.7 64 64 64zM64 128c-35.3 0-64 28.7-64 64V448c0 35.3 28.7 64 64 64H256c35.3 0 64-28.7 64-64V416H272v32c0 8.8-7.2 16-16 16H64c-8.8 0-16-7.2-16-16V192c0-8.8 7.2-16 16-16H96V128H64z"),T(e,"class","svelte-rtaaid")},m(t,n){C(t,e,n)},d(t){t&&P(e)}}}function ce(t){let e;return{c(){e=O("path"),T(e,"d","M208 0H332.1c12.7 0 24.9 5.1 33.9 14.1l67.9 67.9c9 9 14.1 21.2 14.1 33.9V336c0 26.5-21.5 48-48 48H208c-26.5 0-48-21.5-48-48V48c0-26.5 21.5-48 48-48zM48 128h80v64H64V448H256V416h64v48c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V176c0-26.5 21.5-48 48-48z"),T(e,"class","svelte-rtaaid")},m(t,n){C(t,e,n)},d(t){t&&P(e)}}}function ue(e){let n,r="en"===Tt?"Copy ID":"Copier l'ID";return{c(){n=I(r)},m(t,e){C(t,n,e)},p:t,d(t){t&&P(n)}}}function de(e){let n,r="en"===Tt?"Copied!":"Copié !";return{c(){n=I(r)},m(t,e){C(t,n,e)},p:t,d(t){t&&P(n)}}}function fe(t){let e,n,r,i,s,a,c,u,d,f,p,g,m,h,$,v,b,w;function y(t,e){return t[4]?ce:le}let x=y(t),S=x(t);function E(t,e){return t[4]?de:ue}let N=E(t),I=N(t);return{c(){e=L("div"),n=L("figure"),r=L("img"),s=R(),a=L("div"),c=L("span"),d=R(),f=L("button"),p=O("svg"),S.c(),g=R(),m=L("span"),I.c(),T(r,"class","region-img svelte-rtaaid"),l(r.src,i=Qt(t[0].img,t[0].xyhw,t[1]?"96,":`,${t[2]}`))||T(r,"src",i),T(r,"alt","Extracted region"),T(c,"class","overlay-desc"),T(a,"class","overlay is-center svelte-rtaaid"),T(n,"class",u="image card region-image "+(t[1]?"is-96x96":"")+" svelte-rtaaid"),T(n,"tabindex","-1"),U(n,"height",t[2]+"px"),U(n,"min-width",t[2]+"px"),T(p,"xmlns","http://www.w3.org/2000/svg"),T(p,"viewBox","0 0 384 512"),T(p,"class","svelte-rtaaid"),T(m,"class","tooltip svelte-rtaaid"),T(f,"class","button region-btn tag svelte-rtaaid"),T(e,"class",h="region is-center "+(t[5](t[0])?"checked":"")+" svelte-rtaaid")},m(o,i){C(o,e,i),k(e,n),k(n,r),k(n,s),k(n,a),k(a,c),c.innerHTML=t[3],k(e,d),k(e,f),k(f,p),S.m(p,null),k(f,g),k(f,m),I.m(m,null),v=!0,b||(w=[M(n,"click",t[9]),M(n,"keyup",pe),M(f,"click",t[10])],b=!0)},p(t,[o]){(!v||7&o&&!l(r.src,i=Qt(t[0].img,t[0].xyhw,t[1]?"96,":`,${t[2]}`)))&&T(r,"src",i),(!v||8&o)&&(c.innerHTML=t[3]),(!v||2&o&&u!==(u="image card region-image "+(t[1]?"is-96x96":"")+" svelte-rtaaid"))&&T(n,"class",u),(!v||4&o)&&U(n,"height",t[2]+"px"),(!v||4&o)&&U(n,"min-width",t[2]+"px"),x!==(x=y(t))&&(S.d(1),S=x(t),S&&(S.c(),S.m(p,null))),N===(N=E(t))&&I?I.p(t,o):(I.d(1),I=N(t),I&&(I.c(),I.m(m,null))),(!v||33&o&&h!==(h="region is-center "+(t[5](t[0])?"checked":"")+" svelte-rtaaid"))&&T(e,"class",h)},i(t){v||(it((()=>{v&&($||($=bt(e,It,{duration:500},!0)),$.run(1))})),v=!0)},o(t){$||($=bt(e,It,{duration:500},!1)),$.run(0),v=!1},d(t){t&&P(e),S.d(),I.d(),t&&$&&$.end(),b=!1,o(w)}}}const pe=()=>null;function ge(t,e,n){let r,o,i;const{isSelected:s}=ne;d(t,s,(t=>n(5,i=t)));const{clipBoard:a}=re;d(t,a,(t=>n(8,o=t)));let{item:l}=e,{isSquare:c=!0}=e,{height:u=(c?96:140)}=e,{desc:f=l.title}=e;return t.$$set=t=>{"item"in t&&n(0,l=t.item),"isSquare"in t&&n(1,c=t.isSquare),"height"in t&&n(2,u=t.height),"desc"in t&&n(3,f=t.desc)},t.$$.update=()=>{257&t.$$.dirty&&n(4,r=l.ref===o)},[l,c,u,f,r,i,s,a,o,()=>ne.toggle(l),()=>re.copyRef(l.ref)]}class me extends Lt{constructor(t){super(),Nt(this,t,ge,fe,s,{item:0,isSquare:1,height:2,desc:3})}}function he(e){let n,r,o,i,s,a,l,c,u,d="en"===Tt?"Selection":"Sélection";return{c(){n=L("div"),r=L("button"),o=L("span"),i=L("i"),s=R(),a=I(d),l=I("\n            ("),c=I(e[0]),u=I(")"),T(i,"class","fa-solid fa-book-bookmark"),T(o,"id","btn-content"),T(r,"id","set-btn"),T(r,"class","button px-5 py-4 is-link js-modal-trigger svelte-hs48f9"),T(r,"data-target","selection-modal"),T(n,"class","set-container svelte-hs48f9")},m(t,e){C(t,n,e),k(n,r),k(r,o),k(o,i),k(o,s),k(o,a),k(o,l),k(o,c),k(o,u)},p(t,[e]){1&e&&_(c,t[0])},i:t,o:t,d(t){t&&P(n)}}}function $e(t,e,n){let{selectionLength:r=0}=e,o=r;return t.$$set=t=>{"selectionLength"in t&&n(0,r=t.selectionLength)},t.$$.update=()=>{if(3&t.$$.dirty&&r!==o){const t=r>o;n(1,o=r);const e=document.getElementById("btn-content");e&&e.animate([{transform:t?"translateY(-7px)":"translateX(-5px)"},{transform:t?"translateY(7px)":"translateX(5px)"},{transform:"translate(0)"}],{duration:300,easing:"cubic-bezier(0.65, 0, 0.35, 1)"})}},[r,o]}class ve extends Lt{constructor(t){super(),Nt(this,t,$e,he,s,{selectionLength:0})}}function be(e){let n,r,o,i,s,a,l,c,u,d,f,p,g,m,h;return{c(){n=L("button"),r=R(),o=L("div"),i=L("div"),s=R(),a=L("div"),l=L("div"),l.innerHTML='<div class="title is-4 mb-0 media-content"><span id="modal-title" class="mb-0"></span></div> \n            <button class="delete media-left" aria-label="close"></button>',c=R(),u=L("section"),d=R(),f=L("footer"),p=L("div"),g=L("button"),g.textContent=""+("en"===Tt?"Abort":"Retour"),m=R(),h=L("button"),h.textContent="OK",T(n,"id","hidden-msg-btn"),T(n,"class","js-modal-trigger"),T(n,"data-target","msg-modal"),n.hidden=!0,T(i,"id","modal-bkg"),T(i,"class","modal-background"),T(l,"class","modal-card-head media mb-0"),T(u,"id","modal-body"),T(u,"class","modal-card-body"),T(g,"id","cancel-btn"),T(g,"class","button is-link is-light button-close"),T(h,"id","ok-btn"),T(h,"class","button is-link button-close"),T(p,"class","buttons"),T(f,"id","modal-footer"),T(f,"class","modal-card-foot is-center pt-3"),f.hidden=!0,T(a,"class","modal-content"),T(o,"id","msg-modal"),T(o,"class","modal fade"),T(o,"tabindex","-1"),T(o,"aria-labelledby","selection-modal-label"),T(o,"aria-hidden","true")},m(t,e){C(t,n,e),C(t,r,e),C(t,o,e),k(o,i),k(o,s),k(o,a),k(a,l),k(a,c),k(a,u),k(a,d),k(a,f),k(f,p),k(p,g),k(p,m),k(p,h)},p:t,i:t,o:t,d(t){t&&P(n),t&&P(r),t&&P(o)}}}class we extends Lt{constructor(t){super(),Nt(this,t,null,be,s,{})}}function ye(e){let n,r,o,i,s,a=qt.includes("regions"),l=a&&function(e){let n,r,o;return{c(){n=L("button"),n.textContent="en"===Tt?"Automatic region extraction":"Extraction automatique des régions",T(n,"class","button is-link is-inverted")},m(t,i){C(t,n,i),r||(o=M(n,"click",e[1]),r=!0)},p:t,d(t){t&&P(n),r=!1,o()}}}(e);return{c(){n=L("div"),r=L("button"),r.textContent=""+("en"===Tt?"Manually annotate":"Annoter manuellement"),o=R(),l&&l.c(),T(r,"class","button is-link"),T(n,"class","is-center buttons is-centered pt-5")},m(t,a){C(t,n,a),k(n,r),k(n,o),l&&l.m(n,null),i||(s=M(r,"click",e[0]),i=!0)},p(t,[e]){a&&l.p(t,e)},i:t,o:t,d(t){t&&P(n),l&&l.d(),i=!1,s()}}}function xe(t,e,n){const r=Q("witness");let{currentRegionId:o}=e,{baseUrl:i}=e;return t.$$set=t=>{"currentRegionId"in t&&n(2,o=t.currentRegionId),"baseUrl"in t&&n(3,i=t.baseUrl)},[async function(){const t=`${window.location.origin}/${_t}`;let e=`${t}/witness/${r.id}/regions/add`;if(1===r.regions.length||o){const n=o||r.regions[0];e=`${t}/witness/${r.id}/regions/${n}/add`}const n=await Zt((()=>fetch(e,{method:"POST",headers:{"X-CSRFToken":Ut}})));if(!n.ok)throw await te(`Failed to create regions: '${n.statusText}'`,"Error"),new Error(`Failed to create regions: '${n.statusText}'`);let s;try{s=await n.json()}catch(t){throw await te(`Failed to parse JSON response: '${t}'`,"Error"),new Error(`Failed to parse JSON response: '${t}'`)}s.hasOwnProperty("mirador_url")&&window.open(s.mirador_url),s.hasOwnProperty("regions_id")&&(window.location.href=`${i.split("regions/")[0]}regions/${s.regions_id}`)},async function(){const t=`${window.location.origin}/${_t}/witness/${r.id}/regions/extract`,e=await Zt((()=>fetch(t,{method:"POST",headers:{"X-CSRFToken":Ut}})));let n;if(!e.ok){try{n=await e.json()}catch(t){throw await te(`Failed to parse JSON response: '${t}'`,"Error"),new Error(`Failed to parse JSON response: '${t}'`)}throw await te(`Failed to launch regions extraction: '${n.message}'`,"Error"),new Error(`Failed to launch regions extraction: '${n.message}'`)}const o=n.doc_set_id;if(!o)throw await te("Failed to launch regions extraction: 'No document set id'","Error"),new Error("Failed to launch regions extraction: 'No document set id'");window.location.href=`${window.location.origin}/${_t}/treatment/add/?document_set=${o}&task_type=regions`},o,i]}class ke extends Lt{constructor(t){super(),Nt(this,t,xe,ye,s,{currentRegionId:2,baseUrl:3})}}function Se(t,e,n){const r=t.slice();return r[6]=e[n],r}function Ee(t){let e,n=t[3].regions,r=[];for(let e=0;e<n.length;e+=1)r[e]=Pe(Se(t,n,e));return{c(){for(let t=0;t<r.length;t+=1)r[t].c();e=A()},m(t,n){for(let e=0;e<r.length;e+=1)r[e]&&r[e].m(t,n);C(t,e,n)},p(t,o){if(9&o){let i;for(n=t[3].regions,i=0;i<n.length;i+=1){const s=Se(t,n,i);r[i]?r[i].p(s,o):(r[i]=Pe(s),r[i].c(),r[i].m(e.parentNode,e))}for(;i<r.length;i+=1)r[i].d(1);r.length=n.length}},d(t){N(r,t),t&&P(e)}}}function Ce(t){let e,n;function r(t,n){return 4&n&&(e=null),null==e&&(e=!!["all","page"].includes(t[2])),e?Le:"similarity"===t[2]?Ne:void 0}let o=r(t,-1),i=o&&o(t);return{c(){i&&i.c(),n=A()},m(t,e){i&&i.m(t,e),C(t,n,e)},p(t,e){o===(o=r(t,e))&&i?i.p(t,e):(i&&i.d(1),i=o&&o(t),i&&(i.c(),i.m(n.parentNode,n)))},d(t){i&&i.d(t),t&&P(n)}}}function Pe(t){let e,n,r,o,i=t[6]+"";return{c(){e=L("a"),n=I("Regions #"),r=I(i),T(e,"href",o=""+(t[0]+t[6])),T(e,"class","tag is-dark mr-3 is-rounded")},m(t,o){C(t,e,o),k(e,n),k(e,r)},p(t,n){1&n&&o!==(o=""+(t[0]+t[6]))&&T(e,"href",o)},d(t){t&&P(e)}}}function Ne(e){let n,r,o;return{c(){n=L("button"),n.textContent=""+("en"===Tt?"Delete all regions similarity":"Supprimer toutes les similarités du document"),T(n,"class","tag is-danger")},m(t,i){C(t,n,i),r||(o=M(n,"click",e[5]),r=!0)},p:t,d(t){t&&P(n),r=!1,o()}}}function Le(e){let n,r,o;return{c(){n=L("button"),n.textContent=""+("en"===Tt?"Delete regions record":"Supprimer l'intégralité des régions"),T(n,"class","tag is-danger")},m(t,i){C(t,n,i),r||(o=M(n,"click",e[4]),r=!0)},p:t,d(t){t&&P(n),r=!1,o()}}}function Oe(e){let n;function r(t,e){return t[1]?Ce:Ee}let o=r(e),i=o(e);return{c(){n=L("div"),i.c()},m(t,e){C(t,n,e),i.m(n,null)},p(t,[e]){o===(o=r(t))&&i?i.p(t,e):(i.d(1),i=o(t),i&&(i.c(),i.m(n,null)))},i:t,o:t,d(t){t&&P(n),i.d()}}}function Ie(t,e,n){const r=Q("witness");let{baseUrl:o=`${window.location.origin}${window.location.pathname}`}=e,{currentRegionId:i}=e,{currentLayout:s}=e;return t.$$set=t=>{"baseUrl"in t&&n(0,o=t.baseUrl),"currentRegionId"in t&&n(1,i=t.currentRegionId),"currentLayout"in t&&n(2,s=t.currentLayout)},[o,i,s,r,async function(){if(!await te("en"===Tt?"Are you sure you want to delete this record?":"Voulez-vous vraiment supprimer cet enregistrement ?","en"===Tt?"Confirm deletion":"Confirmer la suppression",!0))return;if("number"!=typeof i)throw new Error("Invalid region ID");const t=`${window.location.origin}/${_t}/regions/${i}/delete`;try{const e=await Zt((()=>fetch(t,{method:"DELETE",headers:{"X-CSRFToken":Ut}})));if(204!==e.status)throw new Error(`Failed to delete regions: '${e.statusText}'`);window.location.href=`${o.split("regions/")[0]}regions/`}catch(t){console.error(t)}},async function(){if(!await te("en"===Tt?"Are you sure you want to delete all similarity scores for this document?":"Voulez-vous vraiment supprimer l'intégralité des scores de similarité pour ce document ?","en"===Tt?"Confirm deletion":"Confirmer la suppression",!0))return;if("number"!=typeof i)throw new Error("Invalid region ID");const t=`${window.location.origin}/${_t}/similarity/reset/${i}`;try{const e=await Zt((()=>fetch(t,{method:"DELETE",headers:{"X-CSRFToken":Ut}})));if(204!==e.status&&200!==e.status)throw new Error(`Failed to delete similarity: '${e.statusText}'`);window.location.href=`${o.split("regions/")[0]}regions/`}catch(t){console.error(t),await te(t.message,"Error")}}]}class Re extends Lt{constructor(t){super(),Nt(this,t,Ie,Oe,s,{baseUrl:0,currentRegionId:1,currentLayout:2})}}function Ae(t){let e;return{c(){e=O("path"),T(e,"d","M471.6 21.7c-21.9-21.9-57.3-21.9-79.2 0L362.3 51.7l97.9 97.9 30.1-30.1c21.9-21.9 21.9-57.3 0-79.2L471.6 21.7zm-299.2 220c-6.1 6.1-10.8 13.6-13.5 21.9l-29.6 88.8c-2.9 8.6-.6 18.1 5.8 24.6s15.9 8.7 24.6 5.8l88.8-29.6c8.2-2.7 15.7-7.4 21.9-13.5L437.7 172.3 339.7 74.3 172.4 241.7zM96 64C43 64 0 107 0 160V416c0 53 43 96 96 96H352c53 0 96-43 96-96V320c0-17.7-14.3-32-32-32s-32 14.3-32 32v96c0 17.7-14.3 32-32 32H96c-17.7 0-32-14.3-32-32V160c0-17.7 14.3-32 32-32h96c17.7 0 32-14.3 32-32s-14.3-32-32-32H96z"),T(e,"class","svelte-h0t5l9")},m(t,n){C(t,e,n)},d(t){t&&P(e)}}}function Me(t){let e;return{c(){e=O("path"),T(e,"d","M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"),T(e,"class","svelte-h0t5l9")},m(t,n){C(t,e,n)},d(t){t&&P(e)}}}function Ve(e){let n,r="en"===Tt?"Edit":"Modifier";return{c(){n=I(r)},m(t,e){C(t,n,e)},p:t,d(t){t&&P(n)}}}function Te(e){let n,r="en"===Tt?"Validate":"Valider";return{c(){n=I(r)},m(t,e){C(t,n,e)},p:t,d(t){t&&P(n)}}}function _e(e){let n,r,i,s,a,l,c,u,d,f,p,g,m,h,$,v,b="en"===Tt?"Reload":"Recharger",w="en"===Tt?"Go to editor":"Aller à l'éditeur",y="en"===Tt?"Delete selected regions":"Supprimer les régions sélectionnées";return{c(){n=L("button"),r=L("i"),i=R(),s=I(b),a=R(),l=L("a"),c=L("i"),u=R(),d=I(w),f=R(),p=L("button"),g=L("i"),m=R(),h=I(y),T(r,"class","fa-solid fa-rotate-right"),T(n,"class","tag is-link is-light is-rounded mr-3"),T(c,"class","fa-solid fa-edit"),T(l,"class","tag is-link is-rounded mr-3"),T(l,"href",Kt(e[4])),T(l,"target","_blank"),T(g,"class","fa-solid fa-trash"),T(p,"class","tag is-danger is-rounded")},m(t,o){C(t,n,o),k(n,r),k(n,i),k(n,s),C(t,a,o),C(t,l,o),k(l,c),k(l,u),k(l,d),C(t,f,o),C(t,p,o),k(p,g),k(p,m),k(p,h),$||(v=[M(n,"click",e[14]),M(p,"click",e[6])],$=!0)},p:t,d(t){t&&P(n),t&&P(a),t&&P(l),t&&P(f),t&&P(p),$=!1,o(v)}}}function je(e){let n,r,i,s,a,l,c,u,d,f,p,g,m,h,$,v,b,w,y,x="en"===Tt?"Download":"Télécharger";function S(t,e){return t[0]?Me:Ae}let E=S(e),N=E(e);function A(t,e){return t[0]?Te:Ve}let V=A(e),_=V(e),j=e[0]&&_e(e);return{c(){n=L("div"),r=L("button"),i=O("svg"),N.c(),s=R(),_.c(),l=R(),c=L("button"),u=L("i"),d=R(),f=L("span"),f.textContent=""+("en"===Tt?"Select all":"Tout sélectionner"),p=R(),g=L("button"),m=L("i"),h=R(),$=I(x),v=R(),b=L("div"),j&&j.c(),T(i,"xmlns","http://www.w3.org/2000/svg"),T(i,"viewBox","0 0 384 512"),T(i,"class","pr-3 svelte-h0t5l9"),T(r,"class",a="button "+(e[0]?"is-success":"is-link")+" mr-3"),T(u,"class","fa-solid fa-square-check"),T(f,"id","all-selection"),T(c,"class","button is-link is-light mr-3"),T(m,"class","fa-solid fa-download"),T(g,"class","button is-link is-light"),T(n,"class","is-right mb-3"),T(b,"class","edit-action is-right svelte-h0t5l9")},m(t,o){C(t,n,o),k(n,r),k(r,i),N.m(i,null),k(r,s),_.m(r,null),k(n,l),k(n,c),k(c,u),k(c,d),k(c,f),k(n,p),k(n,g),k(g,m),k(g,h),k(g,$),C(t,v,o),C(t,b,o),j&&j.m(b,null),w||(y=[M(r,"click",e[13]),M(c,"click",e[7]),M(g,"click",e[8])],w=!0)},p(t,[e]){E!==(E=S(t))&&(N.d(1),N=E(t),N&&(N.c(),N.m(i,null))),V===(V=A(t))&&_?_.p(t,e):(_.d(1),_=V(t),_&&(_.c(),_.m(r,null))),1&e&&a!==(a="button "+(t[0]?"is-success":"is-link")+" mr-3")&&T(r,"class",a),t[0]?j?j.p(t,e):(j=_e(t),j.c(),j.m(b,null)):j&&(j.d(1),j=null)},i:t,o:t,d(t){t&&P(n),N.d(),_.d(),t&&P(v),t&&P(b),j&&j.d(),w=!1,o(y)}}}async function Ue(t){const e=SAS_APP_URL.replace("https","http"),n=`${SAS_APP_URL}/annotation/destroy?uri=${e}/annotation/${t}`,r=await fetch(n,{method:"DELETE"});if(204!==r.status)throw new Error(`Failed to delete ${n} due to ${r.status}: '${r.statusText}'`)}function qe(t,e,n){let r,o,i,s,a,l,c;const{selected:u,nbSelected:f}=ne;d(t,u,(t=>n(10,a=t))),d(t,f,(t=>n(12,c=t)));const{allRegions:p}=re;d(t,p,(t=>n(11,l=t)));const g=Q("manifest"),m=Q("isValidated");function h(){n(0,o=!o)}return t.$$.update=()=>{4096&t.$$.dirty&&n(9,r=c(!0)),1024&t.$$.dirty&&(i=a(!0)),2560&t.$$.dirty&&(s=r>=Object.keys(l).length)},n(0,o=!m),[o,u,f,p,g,h,async function(){if(await te("en"===Tt?"Are you sure you want to delete these regions?":"Voulez-vous vraiment supprimer ces régions ?","en"===Tt?"Confirm deletion":"Confirmer la suppression",!0))for(const t of Object.keys(i))try{if(!l.hasOwnProperty(t))continue;await Ue(t),re.remove(t),ne.remove(t,zt)}catch(e){await te(`Failed to delete region ${t}: ${e.message}`,"Error")}},function(){s?ne.removeAll(Object.keys(l),zt):ne.addAll(Object.values(l))},async function(){const t=Object.values(a(!0)).map((t=>t.ref)),e=await Zt((()=>fetch(`${window.location.origin}/${_t}/regions/export`,{method:"POST",headers:{"X-CSRFToken":Ut},body:JSON.stringify({regionsRef:t})})));ee(await e.blob(),"regions.zip")},r,a,l,c,()=>h(),()=>location.reload()]}class ze extends Lt{constructor(t){super(),Nt(this,t,qe,je,s,{})}}const De=function(){const t=`${window.location.origin}${window.location.pathname}`,e=window.location.pathname.match(/\d+/g).join("-"),n={[e]:{}},r=Mt(1),o=Mt({});let i=JSON.parse(localStorage.getItem("selectedRegions"));i&&!i.hasOwnProperty(e)&&(i=n);const s=Mt(i||n),a=Mt(JSON.parse(localStorage.getItem("excludedCategories"))||[]),l=Mt([]),c=Mt([]),d=()=>Yt(r,"sp"),f=Vt(r,(t=>(async()=>function(t){const e=25*(t-1),n=e+25,r=u(l).slice(e,n);return c.set(r),r}(t))()));function p(t){Gt(t,r,"sp")}function g(t){localStorage.setItem("selectedRegions",JSON.stringify(t))}const m=Vt(s,(t=>n=>t[e]?.hasOwnProperty(n)));return{currentPage:r,comparedRegions:o,excludedCategories:a,qImgs:l,pageQImgs:c,selectedRegions:s,fetchSimilarity:async function(){Xt.set(!0);try{const e=await fetch(`${t}compared-regions`),n=await e.json();o.set(n);const r=await fetch(`${t}query-images`),i=await r.json();i.length>0&&(l.set(i),p(d()))}catch(t){console.error("Error:",t),Jt.set(t.message)}finally{Xt.set(!1)}},setPageQImgs:f,getRegionsInfo:function(t){const e=u(o),n=Object.keys(e).filter((e=>e.startsWith(t)));return 1!==n.length?{title:"Error"}:e[n[0]]},handlePageUpdate:p,unselect:function(t){s.update((n=>{const r={...n};return delete r[e][t],g(r),r}))},select:function(t){s.update((n=>{const r={...n,[e]:{...n[e]||{},[t.ref]:t}};return g(r),r}))},addComparedRegions:function(t){o.update((e=>({...e,[t.ref]:t})))},isSelected:m,pageLength:25}}();function He(t){let e,n,r;const o=t[1].default,i=f(o,t,t[0],null);return{c(){e=L("table"),n=L("tbody"),i&&i.c(),T(e,"class","table is-fullwidth")},m(t,o){C(t,e,o),k(e,n),i&&i.m(n,null),r=!0},p(t,[e]){i&&i.p&&(!r||1&e)&&m(i,o,t,t[0],r?g(o,t[0],e,null):h(t[0]),null)},i(t){r||(ht(i,t),r=!0)},o(t){$t(i,t),r=!1},d(t){t&&P(e),i&&i.d(t)}}}function Fe(t,e,n){let{$$slots:r={},$$scope:o}=e;return t.$$set=t=>{"$$scope"in t&&n(0,o=t.$$scope)},[o,r]}class Be extends Lt{constructor(t){super(),Nt(this,t,Fe,He,s,{})}}function Xe(t){let e,n,r,o,i,s,a,l,c,u=t[4]>1&&Je(t),d=t[4]<t[3]&&Ye(t);return{c(){e=L("nav"),n=L("ul"),u&&u.c(),r=R(),o=L("li"),i=L("a"),s=I(t[4]),a=R(),d&&d.c(),T(i,"class","pagination-link is-current"),T(i,"href",null),T(n,"class","pagination-list ml-0"),T(e,"class","pagination is-centered mb-2"),T(e,"aria-label","pagination")},m(f,p){C(f,e,p),k(e,n),u&&u.m(n,null),k(n,r),k(n,o),k(o,i),k(i,s),k(n,a),d&&d.m(n,null),l||(c=M(i,"click",V(t[8])),l=!0)},p(t,e){t[4]>1?u?u.p(t,e):(u=Je(t),u.c(),u.m(n,r)):u&&(u.d(1),u=null),16&e&&_(s,t[4]),t[4]<t[3]?d?d.p(t,e):(d=Ye(t),d.c(),d.m(n,null)):d&&(d.d(1),d=null)},d(t){t&&P(e),u&&u.d(),d&&d.d(),l=!1,c()}}}function Je(t){let e,n,r,o,i,s,a=t[4]-1>1&&Ze(t);return{c(){e=L("li"),n=L("a"),n.textContent="1",r=R(),a&&a.c(),o=A(),T(n,"class","pagination-link"),T(n,"href",null)},m(l,c){C(l,e,c),k(e,n),C(l,r,c),a&&a.m(l,c),C(l,o,c),i||(s=M(n,"click",V(t[6])),i=!0)},p(t,e){t[4]-1>1?a?a.p(t,e):(a=Ze(t),a.c(),a.m(o.parentNode,o)):a&&(a.d(1),a=null)},d(t){t&&P(e),t&&P(r),a&&a.d(t),t&&P(o),i=!1,s()}}}function Ze(t){let e,n,r,o,i,s,a=t[4]-1+"",l=t[4]-1>2&&We();return{c(){l&&l.c(),e=R(),n=L("li"),r=L("a"),o=I(a),T(r,"class","pagination-link"),T(r,"href",null)},m(a,c){l&&l.m(a,c),C(a,e,c),C(a,n,c),k(n,r),k(r,o),i||(s=M(r,"click",V(t[7])),i=!0)},p(t,n){t[4]-1>2?l||(l=We(),l.c(),l.m(e.parentNode,e)):l&&(l.d(1),l=null),16&n&&a!==(a=t[4]-1+"")&&_(o,a)},d(t){l&&l.d(t),t&&P(e),t&&P(n),i=!1,s()}}}function We(t){let e;return{c(){e=L("li"),e.innerHTML='<span class="pagination-ellipsis">…</span>'},m(t,n){C(t,e,n)},d(t){t&&P(e)}}}function Ye(t){let e,n,r,o,i,s,a=t[4]+1<t[3]&&Ge(t);return{c(){a&&a.c(),e=R(),n=L("li"),r=L("a"),o=I(t[3]),T(r,"class","pagination-link"),T(r,"href",null)},m(l,c){a&&a.m(l,c),C(l,e,c),C(l,n,c),k(n,r),k(r,o),i||(s=M(r,"click",V(t[10])),i=!0)},p(t,n){t[4]+1<t[3]?a?a.p(t,n):(a=Ge(t),a.c(),a.m(e.parentNode,e)):a&&(a.d(1),a=null),8&n&&_(o,t[3])},d(t){a&&a.d(t),t&&P(e),t&&P(n),i=!1,s()}}}function Ge(t){let e,n,r,o,i,s,a,l=t[4]+1+"",c=t[4]+2<t[3]&&Qe();return{c(){e=L("li"),n=L("a"),r=I(l),o=R(),c&&c.c(),i=A(),T(n,"class","pagination-link"),T(n,"href",null)},m(l,u){C(l,e,u),k(e,n),k(n,r),C(l,o,u),c&&c.m(l,u),C(l,i,u),s||(a=M(n,"click",V(t[9])),s=!0)},p(t,e){16&e&&l!==(l=t[4]+1+"")&&_(r,l),t[4]+2<t[3]?c||(c=Qe(),c.c(),c.m(i.parentNode,i)):c&&(c.d(1),c=null)},d(t){t&&P(e),t&&P(o),c&&c.d(t),t&&P(i),s=!1,a()}}}function Qe(t){let e;return{c(){e=L("li"),e.innerHTML='<span class="pagination-ellipsis">…</span>'},m(t,n){C(t,e,n)},d(t){t&&P(e)}}}function Ke(e){let n,r,o,i,s,a,l,c=e[4]*e[2]-e[2]+1+"",u=Math.min(e[4]*e[2],e[1])+"",d=(e[3]>1||e[1]>e[2])&&Xe(e);return{c(){d&&d.c(),n=R(),r=L("div"),o=I(c),i=I(" - "),s=I(u),a=I(" / "),l=I(e[1]),T(r,"class","is-size-7 is-center mb-4")},m(t,e){d&&d.m(t,e),C(t,n,e),C(t,r,e),k(r,o),k(r,i),k(r,s),k(r,a),k(r,l)},p(t,[e]){t[3]>1||t[1]>t[2]?d?d.p(t,e):(d=Xe(t),d.c(),d.m(n.parentNode,n)):d&&(d.d(1),d=null),20&e&&c!==(c=t[4]*t[2]-t[2]+1+"")&&_(o,c),22&e&&u!==(u=Math.min(t[4]*t[2],t[1])+"")&&_(s,u),2&e&&_(l,t[1])},i:t,o:t,d(t){d&&d.d(t),t&&P(n),t&&P(r)}}}function tn(t,e,n){let r,o,{store:i}=e;const{currentPage:s}=i;d(t,s,(t=>n(4,o=t)));let{nbOfItems:a}=e,{pageLength:l=Bt}=e;return t.$$set=t=>{"store"in t&&n(0,i=t.store),"nbOfItems"in t&&n(1,a=t.nbOfItems),"pageLength"in t&&n(2,l=t.pageLength)},t.$$.update=()=>{6&t.$$.dirty&&n(3,r=l<Bt?1:Math.ceil(a/l))},[i,a,l,r,o,s,()=>i.handlePageUpdate(1),()=>i.handlePageUpdate(o-1),()=>i.handlePageUpdate(o),()=>i.handlePageUpdate(o+1),()=>i.handlePageUpdate(r)]}class en extends Lt{constructor(t){super(),Nt(this,t,tn,Ke,s,{store:0,nbOfItems:1,pageLength:2})}}const nn='<svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 68 69">\n        <rect x="10" y="10.62" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>\n        <rect x="1" y="1" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>\n        <rect x="10" y="10.62" width="46" height="45.71" rx="4.11" ry="4.11" fill="currentColor" stroke="none"/>\n    </svg>',rn='<svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 70 71">\n        <rect x="12" y="12.43" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>\n        <rect x="1" y="0.81" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>\n        <path d="M 12 21.43 L 21 12.43" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>\n        <path d="M 12 30 L 30 12.43" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>\n        <path d="M 40 56 L 57 38" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>\n        <path d="M 48.3 56.29 L 57 47" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>\n        <path d="M 12 39 L 39 12" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>\n        <path d="M 12 48 L 48 12" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>\n        <path d="M 13 56 L 57 12" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>\n        <path d="M 31 56 L 57 29" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>\n        <path d="M 21 57 L 57 21" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>\n    </svg>',on='<svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 72 73">\n        <rect x="14" y="14.43" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3" stroke-dasharray="9 9"/>\n        <rect x="1" y="0.81" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>\n    </svg>',sn='<svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 59 59">\n        <rect x="1" y="0.62" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>\n        <path d="M 2.67 54.55 L 55 2" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>\n        <path d="M 54.37 54.05 L 2.72 2.24" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>\n    </svg>',an='<svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 59 59">\n        <rect x="1" y="0.81" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>\n        <path d="M 8.69 55.28 C 9.25 44.15 18.08 35.28 28.86 35.28 C 32.5 35.28 36.07 36.3 39.18 38.25 C 44.96 41.85 48.66 48.3 49.02 55.28 Z M 17.85 21.48 C 17.85 15.37 22.79 10.39 28.86 10.39 C 34.92 10.39 39.86 15.37 39.86 21.48 C 39.86 27.59 34.92 32.56 28.86 32.56 C 22.79 32.56 17.85 27.59 17.85 21.48 Z M 40.37 36.34 C 38.43 35.13 36.32 34.25 34.13 33.7 C 38.82 31.64 42.1 26.94 42.1 21.48 C 42.1 14.13 36.16 8.15 28.86 8.15 C 21.55 8.15 15.61 14.13 15.61 21.48 C 15.61 26.95 18.9 31.66 23.6 33.71 C 13.76 36.18 6.41 45.4 6.41 56.4 C 6.41 57.02 6.92 57.52 7.54 57.52 L 50.17 57.52 C 50.79 57.52 51.3 57.02 51.3 56.4 C 51.3 48.23 47.11 40.54 40.37 36.34 Z" fill="currentColor" stroke="none"/>\n    </svg>',ln="en"===Tt?"overall visual matches":"correspondances visuelles globales",cn="en"===Tt?"visual matches on part of the image":"correspondances visuelles sur une partie de l'image",un="en"===Tt?"semantic and non-visual matches":"correspondances sémantiques et non-visuelle",dn="en"===Tt?"regions without match":"régions sans correspondance",fn="en"===Tt?"user specific category":"correspondances spécifiques à l'utilisateur";function pn(t){let e,n,r,i,s,a,l,c,u,d,f,p,g,m,h,$;return n=new me({props:{item:t[2],size:256,desc:t[3],isSquare:!1}}),{c(){e=L("div"),St(n.$$.fragment),r=R(),i=L("div"),s=L("span"),a=R(),l=L("span"),c=R(),u=L("span"),d=R(),f=L("span"),p=R(),g=L("span"),T(s,"class","tag is-hoverable pl-4 pr-3 py-4"),T(s,"title","en"===Tt?"Exact match":"Correspondance exacte"),q(s,"is-selected",1===t[0]),T(l,"class","tag is-hoverable py-4 px-3"),T(l,"title","en"===Tt?"Partial match":"Correspondance partielle"),q(l,"is-selected",2===t[0]),T(u,"class","tag is-hoverable py-4 px-3"),T(u,"title","en"===Tt?"Semantic match":"Correspondance sémantique"),q(u,"is-selected",3===t[0]),T(f,"class","tag is-hoverable py-4 px-3"),T(f,"title","en"===Tt?"No match":"Aucune correspondance"),q(f,"is-selected",4===t[0]),T(g,"class","tag is-hoverable pl-3 pr-4 py-4"),T(g,"title","en"===Tt?"User match":"Correspondance utilisateur"),q(g,"is-selected",t[1]),T(i,"class","tags has-addons is-dark is-center")},m(o,v){C(o,e,v),Et(n,e,null),k(e,r),k(e,i),k(i,s),s.innerHTML=nn,k(i,a),k(i,l),l.innerHTML=rn,k(i,c),k(i,u),u.innerHTML=on,k(i,d),k(i,f),f.innerHTML=sn,k(i,p),k(i,g),g.innerHTML=an,m=!0,h||($=[M(s,"click",t[13]),M(s,"keyup",null),M(l,"click",t[14]),M(l,"keyup",null),M(u,"click",t[15]),M(u,"keyup",null),M(f,"click",t[16]),M(f,"keyup",null),M(g,"click",t[17]),M(g,"keyup",null)],h=!0)},p(t,[e]){(!m||1&e)&&q(s,"is-selected",1===t[0]),(!m||1&e)&&q(l,"is-selected",2===t[0]),(!m||1&e)&&q(u,"is-selected",3===t[0]),(!m||1&e)&&q(f,"is-selected",4===t[0]),(!m||2&e)&&q(g,"is-selected",t[1])},i(t){m||(ht(n.$$.fragment,t),m=!0)},o(t){$t(n.$$.fragment,t),m=!1},d(t){t&&P(e),Ct(n),h=!1,o($)}}}function gn(t,e,n){let r,o;const i=new URL(window.location.href),s=i.origin;i.pathname;let{qImg:a}=e,{sImg:l}=e,{qRegions:c}=e,{sRegions:u}=e,{score:d=0}=e,{category:f=null}=e,{users:p=[]}=e,{isManual:g}=e;const m=Q("similarityPropagatedContext")||!1,[h,$,v,b]=l.split(".")[0].split("_"),w={id:l,img:l,title:`Canvas ${v} - ${b} - ${"en"===Tt?"Witness":"Témoin"} #${y=h,y.match(/\d+/g).toString()}`,xywh:b,canvas:v,ref:l.replace(".jpg",""),type:zt};var y;const x=`${h}_${$}`,k=`${De.getRegionsInfo(x).title}<br>\n        Page ${parseInt(v)}<br>\n        <b>${d?`Score: ${d}`:"en"===Tt?"Manual similarity":"Correspondance manuelle"}</b>`;function S(t){let e=(t=t.slice()).indexOf(Number(jt));return o&&-1===e?t.push(Number(jt)):o||-1===e||t.splice(e,1),t}const E=()=>({img_1:a,img_2:l,regions_id_1:c,regions_id_2:u,score:d,category:r,category_x:S(p),is_manual:g||m});function C(t){5===t?n(1,o=!o):n(0,r=r===t?null:t)}async function P(t){console.log("categorize called !"),C(t),console.log(E());try{const e=await fetch(`${s}/${_t}/save-category`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":Ut},body:JSON.stringify(E())});e.ok?e.json().then((t=>console.log("categorize success response",t))):(console.error("Error: Network response was not ok"),C(t))}catch(e){console.error("Error:",e),C(t)}}return t.$$set=t=>{"qImg"in t&&n(5,a=t.qImg),"sImg"in t&&n(6,l=t.sImg),"qRegions"in t&&n(7,c=t.qRegions),"sRegions"in t&&n(8,u=t.sRegions),"score"in t&&n(9,d=t.score),"category"in t&&n(10,f=t.category),"users"in t&&n(11,p=t.users),"isManual"in t&&n(12,g=t.isManual)},t.$$.update=()=>{1024&t.$$.dirty&&n(0,r=f),2048&t.$$.dirty&&n(1,o=p.includes(Number(jt))||!1)},[r,o,w,k,P,a,l,c,u,d,f,p,g,()=>P(1),()=>P(2),()=>P(3),()=>P(4),()=>P(5)]}class mn extends Lt{constructor(t){super(),Nt(this,t,gn,pn,s,{qImg:5,sImg:6,qRegions:7,sRegions:8,score:9,category:10,users:11,isManual:12})}}function hn(t,e,n){const r=t.slice();return r[6]=e[n][0],r[7]=e[n][1],r[8]=e[n][2],r[9]=e[n][3],r[10]=e[n][4],r[11]=e[n][5],r[12]=e[n][6],r[13]=e[n][7],r}function $n(e){let n,r,o="en"===Tt?`Error when retrieving similar regions: ${e[16]}`:`Erreur de recupération des régions similaires: ${e[16]}`;return{c(){n=L("div"),r=I(o),T(n,"class","faded is-center")},m(t,e){C(t,n,e),k(n,r)},p(t,e){2&e&&o!==(o="en"===Tt?`Error when retrieving similar regions: ${t[16]}`:`Erreur de recupération des régions similaires: ${t[16]}`)&&_(r,o)},i:t,o:t,d(t){t&&P(n)}}}function vn(t){let e,n,r=t[5],o=[];for(let e=0;e<r.length;e+=1)o[e]=xn(hn(t,r,e));const i=t=>$t(o[t],1,1,(()=>{o[t]=null}));let s=null;return r.length||(s=bn(t)),{c(){for(let t=0;t<o.length;t+=1)o[t].c();e=A(),s&&s.c()},m(t,r){for(let e=0;e<o.length;e+=1)o[e]&&o[e].m(t,r);C(t,e,r),s&&s.m(t,r),n=!0},p(t,n){if(7&n){let a;for(r=t[5],a=0;a<r.length;a+=1){const i=hn(t,r,a);o[a]?(o[a].p(i,n),ht(o[a],1)):(o[a]=xn(i),o[a].c(),ht(o[a],1),o[a].m(e.parentNode,e))}for(gt(),a=r.length;a<o.length;a+=1)i(a);mt(),!r.length&&s?s.p(t,n):r.length?s&&(s.d(1),s=null):(s=bn(t),s.c(),s.m(e.parentNode,e))}},i(t){if(!n){for(let t=0;t<r.length;t+=1)ht(o[t]);n=!0}},o(t){o=o.filter(Boolean);for(let t=0;t<o.length;t+=1)$t(o[t]);n=!1},d(t){N(o,t),t&&P(e),s&&s.d(t)}}}function bn(t){let e,n;function r(t,n){return 4&n&&(e=null),null==e&&(e=!(0!==Object.values(t[2]).length)),e?yn:wn}let o=r(t,-1),i=o(t);return{c(){i.c(),n=A()},m(t,e){i.m(t,e),C(t,n,e)},p(t,e){o===(o=r(t,e))&&i?i.p(t,e):(i.d(1),i=o(t),i&&(i.c(),i.m(n.parentNode,n)))},d(t){i.d(t),t&&P(n)}}}function wn(e){let n;return{c(){n=L("div"),n.textContent=("en"===Tt?"No similar regions":"Pas de régions similaires")+" \n            ",T(n,"class","faded is-center")},m(t,e){C(t,n,e)},p:t,d(t){t&&P(n)}}}function yn(e){let n;return{c(){n=L("div"),n.textContent=("en"===Tt?"No document selected":"Aucun document sélectionné")+" \n            ",T(n,"class","faded is-center")},m(t,e){C(t,n,e)},p:t,d(t){t&&P(n)}}}function xn(t){let e,n;return e=new mn({props:{qImg:t[0],sImg:t[8],score:t[6],qRegions:t[9],sRegions:t[10],category:t[11],users:t[12],isManual:t[13]}}),{c(){St(e.$$.fragment)},m(t,r){Et(e,t,r),n=!0},p(t,n){const r={};1&n&&(r.qImg=t[0]),2&n&&(r.sImg=t[8]),2&n&&(r.score=t[6]),2&n&&(r.qRegions=t[9]),2&n&&(r.sRegions=t[10]),2&n&&(r.category=t[11]),2&n&&(r.users=t[12]),2&n&&(r.isManual=t[13]),e.$set(r)},i(t){n||(ht(e.$$.fragment,t),n=!0)},o(t){$t(e.$$.fragment,t),n=!1},d(t){Ct(e,t)}}}function kn(e){let n;return{c(){n=L("div"),n.textContent=""+("en"!==Tt||e[4]?"fr"!==Tt||e[4]?"en"===Tt&&e[4]?"Retrieving propagated regions...":"Récupération de similarités propagées...":"Récupération des régions similaires...":"Retrieving similar regions..."),T(n,"class","faded is-center")},m(t,e){C(t,n,e)},p:t,i:t,o:t,d(t){t&&P(n)}}}function Sn(t){let e,n,r,o={ctx:t,current:null,token:null,hasCatch:!0,pending:kn,then:vn,catch:$n,value:5,error:16,blocks:[,,,]};return wt(n=t[1],o),{c(){e=A(),o.block.c()},m(t,n){C(t,e,n),o.block.m(t,o.anchor=n),o.mount=()=>e.parentNode,o.anchor=e,r=!0},p(e,[r]){t=e,o.ctx=t,2&r&&n!==(n=t[1])&&wt(n,o)||yt(o,t,r)},i(t){r||(ht(o.block),r=!0)},o(t){for(let t=0;t<3;t+=1){$t(o.blocks[t])}r=!1},d(t){t&&P(e),o.block.d(t),o.token=null,o=null}}}function En(t,e,n){let r;const{selectedRegions:o}=De;d(t,o,(t=>n(2,r=t)));let{qImg:i}=e,{sImgsPromise:s}=e;const a=Q("similarityPropagatedContext")||!1;return t.$$set=t=>{"qImg"in t&&n(0,i=t.qImg),"sImgsPromise"in t&&n(1,s=t.sImgsPromise)},[i,s,r,o,a]}class Cn extends Lt{constructor(t){super(),Nt(this,t,En,Sn,s,{qImg:0,sImgsPromise:1})}}function Pn(t){let e,n,r;return n=new Cn({props:{qImg:t[0],sImgsPromise:t[1],displayType:"similarityMatches"}}),{c(){e=L("div"),St(n.$$.fragment),T(e,"class","grid is-gap-2")},m(t,o){C(t,e,o),Et(n,e,null),r=!0},p(t,[e]){const r={};1&e&&(r.qImg=t[0]),2&e&&(r.sImgsPromise=t[1]),n.$set(r)},i(t){r||(ht(n.$$.fragment,t),r=!0)},o(t){$t(n.$$.fragment,t),r=!1},d(t){t&&P(e),Ct(n)}}}function Nn(t,e,n){let r,o,i;const{selectedRegions:s,excludedCategories:a}=De;d(t,s,(t=>n(5,i=t))),d(t,a,(t=>n(4,o=t)));const l=`${window.location.origin}${window.location.pathname}`,c=window.location.pathname.match(/\d+/g).join("-");let{qImg:u}=e;return t.$$set=t=>{"qImg"in t&&n(0,u=t.qImg)},t.$$.update=()=>{49&t.$$.dirty&&n(1,r=async function(t,e,n){if(0===Object.values(e).map((t=>t.id)).length)return{};const r=await fetch(`${l}similar-images`,{method:"POST",body:JSON.stringify({regionsIds:Object.values(e[c]).map((t=>t.id)),qImg:t,topk:10,excludedCategories:n}),headers:{"Content-Type":"application/json","X-CSRFToken":Ut}});return await r.json()}(u,i,o))},[u,r,s,a,o,i]}class Ln extends Lt{constructor(t){super(),Nt(this,t,Nn,Pn,s,{qImg:0})}}function On(e){let n,r,o,i,s,a;return{c(){n=L("div"),r=L("button"),o=L("span"),i=R(),s=L("span"),a=I(e[2]),T(o,"class","iconify"),T(o,"data-icon",e[0]),T(o,"title",e[1]),T(s,"class","tooltip "+e[3]+" svelte-4qzyt4"),T(r,"class","svelte-4qzyt4"),T(n,"class","is-inline-block tooltip-generic svelte-4qzyt4")},m(t,e){C(t,n,e),k(n,r),k(r,o),k(r,i),k(r,s),k(s,a)},p(t,[e]){1&e&&T(o,"data-icon",t[0]),2&e&&T(o,"title",t[1]),4&e&&_(a,t[2])},i:t,o:t,d(t){t&&P(n)}}}function In(t,e,n){let{iconifyIcon:r,altText:o,tooltipText:i}=e;const s=i.length<20?"tooltip-thin":i.length<100?"tooltip-mid":"tooltip-wide";return t.$$set=t=>{"iconifyIcon"in t&&n(0,r=t.iconifyIcon),"altText"in t&&n(1,o=t.altText),"tooltipText"in t&&n(2,i=t.tooltipText)},[r,o,i,s]}class Rn extends Lt{constructor(t){super(),Nt(this,t,In,On,s,{iconifyIcon:0,altText:1,tooltipText:2})}}function An(e){return{c:t,m:t,p:t,i:t,o:t,d:t}}function Mn(t){let e,n,r,o,i,s,a=t[5].length+"",l=t[5].length>1?"es":"";return i=new Rn({props:{iconifyIcon:"material-symbols:help-outline",altText:"en"===Tt?"Display help":"Afficher une explication",tooltipText:t[2]}}),{c(){e=I(a),n=I(" propagated match"),r=I(l),o=R(),St(i.$$.fragment)},m(t,a){C(t,e,a),C(t,n,a),C(t,r,a),C(t,o,a),Et(i,t,a),s=!0},p(t,n){(!s||2&n)&&a!==(a=t[5].length+"")&&_(e,a),(!s||2&n)&&l!==(l=t[5].length>1?"es":"")&&_(r,l)},i(t){s||(ht(i.$$.fragment,t),s=!0)},o(t){$t(i.$$.fragment,t),s=!1},d(t){t&&P(e),t&&P(n),t&&P(r),t&&P(o),Ct(i,t)}}}function Vn(e){return{c:t,m:t,p:t,i:t,o:t,d:t}}function Tn(t){let e,n,r,o,i,s,a,l,c={ctx:t,current:null,token:null,hasCatch:!1,pending:Vn,then:Mn,catch:An,value:5,blocks:[,,,]};return wt(o=t[1],c),a=new Cn({props:{qImg:t[0],sImgsPromise:t[1],displayType:"suggestionMatches"}}),{c(){e=L("div"),n=L("div"),r=L("div"),c.block.c(),i=R(),s=L("div"),St(a.$$.fragment),T(r,"class","block"),T(s,"class","grid is-gap-2"),T(n,"class","matches-suggestion svelte-1li2qm8"),T(e,"class","block matches-suggestion-wrapper svelte-1li2qm8")},m(t,o){C(t,e,o),k(e,n),k(n,r),c.block.m(r,c.anchor=null),c.mount=()=>r,c.anchor=null,k(n,i),k(n,s),Et(a,s,null),l=!0},p(e,[n]){t=e,c.ctx=t,2&n&&o!==(o=t[1])&&wt(o,c)||yt(c,t,n);const r={};1&n&&(r.qImg=t[0]),2&n&&(r.sImgsPromise=t[1]),a.$set(r)},i(t){l||(ht(c.block),ht(a.$$.fragment,t),l=!0)},o(t){for(let t=0;t<3;t+=1){$t(c.blocks[t])}$t(a.$$.fragment,t),l=!1},d(t){t&&P(e),c.block.d(),c.token=null,c=null,Ct(a)}}}function _n(t,e,n){let r,{qImg:o}=e;G("similarityPropagatedContext",!0);const i=`${window.location.origin}${window.location.pathname}`,s="en"===Tt?"Propagated matches are exact matches to images that have an exact match with the current image. There may be up to 5 exact matches connecting the current image and propagated images.":"Les correspondances propagées correspondent à des correspondances exactes à des images ayant une correspondance exacte avec l'image actuelle. Il peut y avoir jusqu'à 5 images reliant l'image actuelle à une correspondance propagée.";return t.$$set=t=>{"qImg"in t&&n(0,o=t.qImg)},n(1,r=(async()=>fetch(`${i}propagated-matches/${o}`).then((t=>t.json())))()),[o,r,s]}class jn extends Lt{constructor(t){super(),Nt(this,t,_n,Tn,s,{qImg:0})}}function Un(t){let e,n,r,i,s,a,c,u,d,f,p,g,m,h,$,v,b,w,y,x,S,E,N,A,V,_,q,z,D,H,F,B,X=parseInt(t[4])+"";return _=new Ln({props:{qImg:t[0]}}),D=new jn({props:{qImg:t[0]}}),{c(){e=L("tr"),n=L("th"),r=L("div"),i=L("a"),s=L("i"),a=I("\n                Page "),c=I(X),u=R(),d=L("img"),p=R(),g=L("div"),m=L("div"),h=L("input"),$=R(),v=L("button"),v.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M256 80c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 144L48 224c-17.7 0-32 14.3-32 32s14.3 32 32 32l144 0 0 144c0 17.7 14.3 32 32 32s32-14.3 32-32l0-144 144 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-144 0 0-144z"></path></svg>',b=R(),w=L("button"),y=O("svg"),x=O("path"),N=R(),A=L("td"),V=L("div"),St(_.$$.fragment),q=R(),z=L("div"),St(D.$$.fragment),T(s,"class","fa-solid fa-pen-to-square"),T(i,"class","tag px-2 py-1 mb-2 is-rounded is-hoverable"),T(i,"href",Kt(t[5],parseInt(t[4]))),T(i,"target","_blank"),l(d.src,f=Qt(t[0],"full","250,"))||T(d,"src",f),T(d,"alt","Query region"),T(d,"class","mb-3 card"),T(h,"class","input is-small tag"),T(h,"type","text"),T(h,"placeholder","en"===Tt?"Add new match":"Ajouter une correspondance"),T(v,"class","button is-small tag is-link is-center"),T(m,"class","tags has-addons"),U(m,"flex-wrap","nowrap"),T(x,"fill","white"),T(x,"d","M376.6 84.5c11.3-13.6 9.5-33.8-4.1-45.1s-33.8-9.5-45.1 4.1L192 206 56.6 43.5C45.3 29.9 25.1 28.1 11.5 39.4S-3.9 70.9 7.4 84.5L150.3 256 7.4 427.5c-11.3 13.6-9.5 33.8 4.1 45.1s33.8 9.5 45.1-4.1L192 306 327.4 468.5c11.3 13.6 31.5 15.4 45.1 4.1s15.4-31.5 4.1-45.1L233.7 256 376.6 84.5z"),T(y,"xmlns","http://www.w3.org/2000/svg"),T(y,"viewBox","0 0 384 512"),T(w,"id","no-match"),T(w,"class",S="button is-small tag is-danger is-center m-0 "+(1===t[2]?"visible":"")+" svelte-f4c92p"),T(w,"title","en"===Tt?"No match for this region in this witness":"Aucune correspondance de cette région pour ce témoin"),T(g,"class","new-similarity control pt-2 is-center svelte-f4c92p"),T(r,"class","content-wrapper py-5"),T(n,"class","is-3 center-flex is-narrow"),U(n,"width","260px"),T(V,"class","fixed-grid has-5-cols"),T(z,"class","fixed-grid has-5-cols"),T(A,"class","p-5 is-fullwidth")},m(o,l){C(o,e,l),k(e,n),k(n,r),k(r,i),k(i,s),k(i,a),k(i,c),k(r,u),k(r,d),k(r,p),k(r,g),k(g,m),k(m,h),j(h,t[1]),k(m,$),k(m,v),k(g,b),k(g,w),k(w,y),k(y,x),k(e,N),k(e,A),k(A,V),Et(_,V,null),k(A,q),k(A,z),Et(D,z,null),H=!0,F||(B=[M(h,"input",t[9]),M(v,"click",t[6]),M(w,"click",t[7])],F=!0)},p(t,[e]){(!H||1&e&&!l(d.src,f=Qt(t[0],"full","250,")))&&T(d,"src",f),2&e&&h.value!==t[1]&&j(h,t[1]),(!H||4&e&&S!==(S="button is-small tag is-danger is-center m-0 "+(1===t[2]?"visible":"")+" svelte-f4c92p"))&&T(w,"class",S);const n={};1&e&&(n.qImg=t[0]),_.$set(n);const r={};1&e&&(r.qImg=t[0]),D.$set(r)},i(t){H||(it((()=>{H&&(E||(E=bt(w,It,{duration:500},!0)),E.run(1))})),ht(_.$$.fragment,t),ht(D.$$.fragment,t),H=!0)},o(t){E||(E=bt(w,It,{duration:500},!1)),E.run(0),$t(_.$$.fragment,t),$t(D.$$.fragment,t),H=!1},d(t){t&&P(e),t&&E&&E.end(),Ct(_),Ct(D),F=!1,o(B)}}}function qn(t,e,n){let r,o;const{selectedRegions:i}=De;d(t,i,(t=>n(8,o=t)));let{qImg:s}=e,a="";const[l,c,u,f]=s.split(".")[0].split("_"),p=Q("manifest"),g=`${window.location.origin}${window.location.pathname}`,m=window.location.pathname.match(/\d+/g).join("-"),h="en"===Tt?"Error":"Erreur";return t.$$set=t=>{"qImg"in t&&n(0,s=t.qImg)},t.$$.update=()=>{256&t.$$.dirty&&n(2,r=o.hasOwnProperty(m)?Object.values(o[m]).length:0)},[s,a,r,i,u,p,async function(){var t;if(a&&(t=(t=a).replace(".jpg",""),/^wit\d+_[a-zA-Z]{3}\d+_\d+_\d+,\d+,\d+,\d+$/.test(t)))try{const t=await fetch(`${g}add-region-pair`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":Ut},body:JSON.stringify({q_img:s.replace(".jpg",""),s_img:a})});t.ok||(console.error("Error: Network response was not ok"),await te("en"===Tt?"Problem with network, match was not added":"Problème de réseau, la correspondance n'a pas été ajoutée",h));const e=await t.json();if(e.hasOwnProperty("error")||!e.hasOwnProperty("s_regions"))return void await te("en"===Tt?`Request was unsuccessful, match was not added:<br>${e.error}`:`La requête n'a pas abouti, la correspondance n'a pas été ajoutée :<br>${e.error}`,h);const n=e.s_regions;De.addComparedRegions(n),De.select(n)}catch(t){console.error("Error:",t),await te("en"===Tt?`An error has occurred, match was not added:<br>${t}`:`Une erreur s'est produite, la correspondance n'a pas été ajoutée :<br>${t}`,h)}else await te("en"===Tt?"Please insert a valid region reference to add a new match":"Veuillez insérer une référence de région valide pour ajouter une nouvelle correspondance","Error")},async function(){const t=Object.values(o[m])[0];if(await te("en"===Tt?`Do you confirm this region does not have any match in ${t.title}?`:`Confirmez-vous que cette région n'a pas de correspondance dans ${t.title} ?`,"en"===Tt?"Confirm no match":"Confirmer l'absence de correspondance",!0))try{(await fetch(`${g}no-match`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":Ut},body:JSON.stringify({q_img:s,s_regions:t.id})})).ok||(console.error("Error: Network response was not ok"),await te("en"===Tt?"Problem with network":"Problème de réseau",h)),De.select(t)}catch(t){console.error("Error:",t),await te("en"===Tt?`An error has occurred, request was unsuccessful:<br>${t}`:`Une erreur s'est produite, la requête n'a pas abouti :<br>${t}`,h)}},o,function(){a=this.value,n(1,a)}]}class zn extends Lt{constructor(t){super(),Nt(this,t,qn,Un,s,{qImg:0})}}function Dn(t,e,n){const r=t.slice();return r[8]=e[n],r}function Hn(e){let n,r,o,i=e[11]+"";return{c(){n=L("tr"),r=I("Error when retrieving similar regions: "),o=I(i)},m(t,e){C(t,n,e),k(n,r),k(n,o)},p(t,e){2&e&&i!==(i=t[11]+"")&&_(o,i)},i:t,o:t,d(t){t&&P(n)}}}function Fn(t){let e,n,r=[],o=new Map,i=t[2];const s=t=>t[8].id;for(let e=0;e<i.length;e+=1){let n=Dn(t,i,e),a=s(n);o.set(a,r[e]=Xn(a,n))}let a=null;return i.length||(a=Bn()),{c(){for(let t=0;t<r.length;t+=1)r[t].c();e=A(),a&&a.c()},m(t,o){for(let e=0;e<r.length;e+=1)r[e]&&r[e].m(t,o);C(t,e,o),a&&a.m(t,o),n=!0},p(t,n){4&n&&(i=t[2],gt(),r=kt(r,n,s,1,t,i,o,e.parentNode,xt,Xn,e,Dn),mt(),!i.length&&a?a.p(t,n):i.length?a&&(a.d(1),a=null):(a=Bn(),a.c(),a.m(e.parentNode,e)))},i(t){if(!n){for(let t=0;t<i.length;t+=1)ht(r[t]);n=!0}},o(t){for(let t=0;t<r.length;t+=1)$t(r[t]);n=!1},d(t){for(let e=0;e<r.length;e+=1)r[e].d(t);t&&P(e),a&&a.d(t)}}}function Bn(e){let n,r;return{c(){n=L("tr"),n.textContent=""+("en"===Tt?"No similarity":"Pas de similarités"),r=R(),T(n,"class","faded is-center")},m(t,e){C(t,n,e),C(t,r,e)},p:t,d(t){t&&P(n),t&&P(r)}}}function Xn(t,e){let n,r,o;return r=new zn({props:{qImg:e[8]}}),{key:t,first:null,c(){n=A(),St(r.$$.fragment),this.first=n},m(t,e){C(t,n,e),Et(r,t,e),o=!0},p(t,n){e=t;const o={};4&n&&(o.qImg=e[8]),r.$set(o)},i(t){o||(ht(r.$$.fragment,t),o=!0)},o(t){$t(r.$$.fragment,t),o=!1},d(t){t&&P(n),Ct(r,t)}}}function Jn(e){let n;return{c(){n=L("tr"),n.textContent=""+("en"===Tt?"Retrieving similarity page...":"Récupération la page de similarité..."),T(n,"class","faded is-center")},m(t,e){C(t,n,e)},p:t,i:t,o:t,d(t){t&&P(n)}}}function Zn(t){let e,n,r,o={ctx:t,current:null,token:null,hasCatch:!0,pending:Jn,then:Fn,catch:Hn,value:7,error:11,blocks:[,,,]};return wt(n=t[1],o),{c(){e=A(),o.block.c()},m(t,n){C(t,e,n),o.block.m(t,o.anchor=n),o.mount=()=>e.parentNode,o.anchor=e,r=!0},p(e,r){t=e,o.ctx=t,2&r&&n!==(n=t[1])&&wt(n,o)||yt(o,t,r)},i(t){r||(ht(o.block),r=!0)},o(t){for(let t=0;t<3;t+=1){$t(o.blocks[t])}r=!1},d(t){t&&P(e),o.block.d(t),o.token=null,o=null}}}function Wn(t){let e,n,r,o,i,s,a;return n=new en({props:{store:De,nbOfItems:t[0].length,pageLength:t[6]}}),o=new Be({props:{$$slots:{default:[Zn]},$$scope:{ctx:t}}}),s=new en({props:{store:De,nbOfItems:t[0].length,pageLength:t[6]}}),{c(){e=L("div"),St(n.$$.fragment),r=R(),St(o.$$.fragment),i=R(),St(s.$$.fragment)},m(t,l){C(t,e,l),Et(n,e,null),k(e,r),Et(o,e,null),k(e,i),Et(s,e,null),a=!0},p(t,[e]){const r={};1&e&&(r.nbOfItems=t[0].length),n.$set(r);const i={};4102&e&&(i.$$scope={dirty:e,ctx:t}),o.$set(i);const a={};1&e&&(a.nbOfItems=t[0].length),s.$set(a)},i(t){a||(ht(n.$$.fragment,t),ht(o.$$.fragment,t),ht(s.$$.fragment,t),a=!0)},o(t){$t(n.$$.fragment,t),$t(o.$$.fragment,t),$t(s.$$.fragment,t),a=!1},d(t){t&&P(e),Ct(n),Ct(o),Ct(s)}}}function Yn(t,e,n){let r,o,i;const{qImgs:s,pageQImgs:a,setPageQImgs:l,pageLength:c}=De;return d(t,s,(t=>n(0,r=t))),d(t,a,(t=>n(2,i=t))),d(t,l,(t=>n(1,o=t))),[r,o,i,s,a,l,c]}class Gn extends Lt{constructor(t){super(),Nt(this,t,Yn,Wn,s,{})}}function Qn(t,e,n){const r=t.slice();return r[8]=e[n][0],r[9]=e[n][1],r}function Kn(e){let n;return{c(){n=L("span"),n.textContent=""+("en"===Tt?"current":"courant"),T(n,"class","tag is-dark svelte-503e8j")},m(t,e){C(t,n,e)},p:t,d(t){t&&P(n)}}}function tr(t){let e,n,r,i,s,a,l,c,u=t[5](t[8]),d=Wt(t[9].title)+"",f=u&&Kn();function p(){return t[6](t[9])}return{c(){e=L("div"),f&&f.c(),n=R(),r=L("span"),i=I(d),a=R(),T(r,"class",s="tag is-small "+(t[0](t[8])?"is-selected":"is-contrasted")+" svelte-503e8j"),T(e,"class","tags has-addons mb-0 is-hoverable")},m(t,o){C(t,e,o),f&&f.m(e,null),k(e,n),k(e,r),k(r,i),k(e,a),l||(c=[M(e,"click",p),M(e,"keyup",null)],l=!0)},p(o,a){t=o,2&a&&(u=t[5](t[8])),u?f?f.p(t,a):(f=Kn(),f.c(),f.m(e,n)):f&&(f.d(1),f=null),2&a&&d!==(d=Wt(t[9].title)+"")&&_(i,d),3&a&&s!==(s="tag is-small "+(t[0](t[8])?"is-selected":"is-contrasted")+" svelte-503e8j")&&T(r,"class",s)},d(t){t&&P(e),f&&f.d(),l=!1,o(c)}}}function er(e){let n,r=Object.entries(e[1]),o=[];for(let t=0;t<r.length;t+=1)o[t]=tr(Qn(e,r,t));return{c(){n=L("div");for(let t=0;t<o.length;t+=1)o[t].c();T(n,"class","field is-grouped is-grouped-multiline")},m(t,e){C(t,n,e);for(let t=0;t<o.length;t+=1)o[t]&&o[t].m(n,null)},p(t,[e]){if(51&e){let i;for(r=Object.entries(t[1]),i=0;i<r.length;i+=1){const s=Qn(t,r,i);o[i]?o[i].p(s,e):(o[i]=tr(s),o[i].c(),o[i].m(n,null))}for(;i<o.length;i+=1)o[i].d(1);o.length=r.length}},i:t,o:t,d(t){t&&P(n),N(o,t)}}}function nr(t,e,n){let r,o;const{comparedRegions:i,isSelected:s}=De;d(t,i,(t=>n(1,o=t))),d(t,s,(t=>n(0,r=t)));const a=Q("imgPrefix");function l(t){r(t.ref)?De.unselect(t.ref):De.select(t)}return[r,o,i,s,l,function(t){return t.startsWith(a)},t=>l(t)]}class rr extends Lt{constructor(t){super(),Nt(this,t,nr,er,s,{})}}function or(t,e,n){const r=t.slice();return r[8]=e[n],r}function ir(t){let e,n,r,o,i,s,a,l=t[8].title+"";function c(t,e){return 6&e&&(r=null),null==r&&(r=!!t[2].includes(t[8].id)),r?ar:sr}let u=c(t,-1),d=u(t);return{c(){e=L("div"),n=L("span"),d.c(),o=R(),i=I(l),T(n,"class","label svelte-1a5w65y"),T(e,"class","label-container px-2 py-1 svelte-1a5w65y")},m(t,r){C(t,e,r),k(e,n),d.m(n,null),k(n,o),k(n,i),a=!0},p(t,e){u===(u=c(t,e))&&d?d.p(t,e):(d.d(1),d=u(t),d&&(d.c(),d.m(n,o))),(!a||2&e)&&l!==(l=t[8].title+"")&&_(i,l)},i(t){a||(it((()=>{a&&(s||(s=bt(e,Rt,{x:40,duration:300},!0)),s.run(1))})),a=!0)},o(t){s||(s=bt(e,Rt,{x:40,duration:300},!1)),s.run(0),a=!1},d(t){t&&P(e),d.d(),t&&s&&s.end()}}}function sr(e){let n,r="en"===Tt?"Hide ":"Masquer les ";return{c(){n=I(r)},m(t,e){C(t,n,e)},p:t,d(t){t&&P(n)}}}function ar(e){let n,r="en"===Tt?"Show ":"Afficher les ";return{c(){n=I(r)},m(t,e){C(t,n,e)},p:t,d(t){t&&P(n)}}}function lr(t){let e,n,r,i,s,a,l,c,u=t[8].svg+"",d=t[0]===t[8].id&&ir(t);function f(){return t[5](t[8])}function p(){return t[7](t[8])}return{c(){e=L("div"),n=L("span"),r=R(),d&&d.c(),i=R(),T(n,"class","tool-icon p-1 svelte-1a5w65y"),T(e,"class",s="toolbar-item "+(t[2].includes(t[8].id)?"":"selected")+" svelte-1a5w65y")},m(o,s){C(o,e,s),k(e,n),n.innerHTML=u,k(e,r),d&&d.m(e,null),k(e,i),a=!0,l||(c=[M(e,"mouseenter",f),M(e,"mouseleave",t[6]),M(e,"click",p),M(e,"keyup",null)],l=!0)},p(r,o){t=r,(!a||2&o)&&u!==(u=t[8].svg+"")&&(n.innerHTML=u),t[0]===t[8].id?d?(d.p(t,o),3&o&&ht(d,1)):(d=ir(t),d.c(),ht(d,1),d.m(e,i)):d&&(gt(),$t(d,1,1,(()=>{d=null})),mt()),(!a||6&o&&s!==(s="toolbar-item "+(t[2].includes(t[8].id)?"":"selected")+" svelte-1a5w65y"))&&T(e,"class",s)},i(t){a||(ht(d),a=!0)},o(t){$t(d),a=!1},d(t){t&&P(e),d&&d.d(),l=!1,o(c)}}}function cr(t){let e,n,r,o=t[1],i=[];for(let e=0;e<o.length;e+=1)i[e]=lr(or(t,o,e));const s=t=>$t(i[t],1,1,(()=>{i[t]=null}));return{c(){e=L("div");for(let t=0;t<i.length;t+=1)i[t].c();T(e,"class","toolbar svelte-1a5w65y")},m(t,n){C(t,e,n);for(let t=0;t<i.length;t+=1)i[t]&&i[t].m(e,null);r=!0},p(t,[n]){if(23&n){let r;for(o=t[1],r=0;r<o.length;r+=1){const s=or(t,o,r);i[r]?(i[r].p(s,n),ht(i[r],1)):(i[r]=lr(s),i[r].c(),ht(i[r],1),i[r].m(e,null))}for(gt(),r=o.length;r<i.length;r+=1)s(r);mt()}},i(t){if(!r){for(let t=0;t<o.length;t+=1)ht(i[t]);it((()=>{r&&(n||(n=bt(e,It,{duration:500},!0)),n.run(1))})),r=!0}},o(t){i=i.filter(Boolean);for(let t=0;t<i.length;t+=1)$t(i[t]);n||(n=bt(e,It,{duration:500},!1)),n.run(0),r=!1},d(t){t&&P(e),N(i,t),t&&n&&n.end()}}}function ur(t,e,n){let r,o;const{excludedCategories:i}=De;d(t,i,(t=>n(2,o=t)));let s=null;function a(t){i.update((e=>e.includes(t)?e.filter((e=>e!==t)):[...e,t])),localStorage.setItem("excludedCategories",JSON.stringify(o))}return n(1,r=[{id:1,title:ln,svg:nn},{id:2,title:cn,svg:rn},{id:3,title:un,svg:on},{id:4,title:dn,svg:sn},{id:5,title:fn,svg:an}]),[s,r,o,i,a,t=>n(0,s=t.id),()=>n(0,s=null),t=>a(t.id)]}class dr extends Lt{constructor(t){super(),Nt(this,t,ur,cr,s,{})}}var fr,pr;function gr(t){return"object"==typeof t&&"function"==typeof t.to}function mr(t){t.parentElement.removeChild(t)}function hr(t){return null!=t}function $r(t){t.preventDefault()}function vr(t){return"number"==typeof t&&!isNaN(t)&&isFinite(t)}function br(t,e,n){n>0&&(kr(t,e),setTimeout((function(){Sr(t,e)}),n))}function wr(t){return Math.max(Math.min(t,100),0)}function yr(t){return Array.isArray(t)?t:[t]}function xr(t){var e=(t=String(t)).split(".");return e.length>1?e[1].length:0}function kr(t,e){t.classList&&!/\s/.test(e)?t.classList.add(e):t.className+=" "+e}function Sr(t,e){t.classList&&!/\s/.test(e)?t.classList.remove(e):t.className=t.className.replace(new RegExp("(^|\\b)"+e.split(" ").join("|")+"(\\b|$)","gi")," ")}function Er(t){var e=void 0!==window.pageXOffset,n="CSS1Compat"===(t.compatMode||"");return{x:e?window.pageXOffset:n?t.documentElement.scrollLeft:t.body.scrollLeft,y:e?window.pageYOffset:n?t.documentElement.scrollTop:t.body.scrollTop}}function Cr(t,e){return 100/(e-t)}function Pr(t,e,n){return 100*e/(t[n+1]-t[n])}function Nr(t,e){for(var n=1;t>=e[n];)n+=1;return n}function Lr(t,e,n){if(n>=t.slice(-1)[0])return 100;var r=Nr(n,t),o=t[r-1],i=t[r],s=e[r-1],a=e[r];return s+function(t,e){return Pr(t,t[0]<0?e+Math.abs(t[0]):e-t[0],0)}([o,i],n)/Cr(s,a)}function Or(t,e,n,r){if(100===r)return r;var o=Nr(r,t),i=t[o-1],s=t[o];return n?r-i>(s-i)/2?s:i:e[o-1]?t[o-1]+function(t,e){return Math.round(t/e)*e}(r-t[o-1],e[o-1]):r}!function(t){t.Range="range",t.Steps="steps",t.Positions="positions",t.Count="count",t.Values="values"}(fr||(fr={})),function(t){t[t.None=-1]="None",t[t.NoValue=0]="NoValue",t[t.LargeValue=1]="LargeValue",t[t.SmallValue=2]="SmallValue"}(pr||(pr={}));var Ir=function(){function t(t,e,n){var r;this.xPct=[],this.xVal=[],this.xSteps=[],this.xNumSteps=[],this.xHighestCompleteStep=[],this.xSteps=[n||!1],this.xNumSteps=[!1],this.snap=e;var o=[];for(Object.keys(t).forEach((function(e){o.push([yr(t[e]),e])})),o.sort((function(t,e){return t[0][0]-e[0][0]})),r=0;r<o.length;r++)this.handleEntryPoint(o[r][1],o[r][0]);for(this.xNumSteps=this.xSteps.slice(0),r=0;r<this.xNumSteps.length;r++)this.handleStepPoint(r,this.xNumSteps[r])}return t.prototype.getDistance=function(t){for(var e=[],n=0;n<this.xNumSteps.length-1;n++)e[n]=Pr(this.xVal,t,n);return e},t.prototype.getAbsoluteDistance=function(t,e,n){var r,o=0;if(t<this.xPct[this.xPct.length-1])for(;t>this.xPct[o+1];)o++;else t===this.xPct[this.xPct.length-1]&&(o=this.xPct.length-2);n||t!==this.xPct[o+1]||o++,null===e&&(e=[]);var i=1,s=e[o],a=0,l=0,c=0,u=0;for(r=n?(t-this.xPct[o])/(this.xPct[o+1]-this.xPct[o]):(this.xPct[o+1]-t)/(this.xPct[o+1]-this.xPct[o]);s>0;)a=this.xPct[o+1+u]-this.xPct[o+u],e[o+u]*i+100-100*r>100?(l=a*r,i=(s-100*r)/e[o+u],r=1):(l=e[o+u]*a/100*i,i=0),n?(c-=l,this.xPct.length+u>=1&&u--):(c+=l,this.xPct.length-u>=1&&u++),s=e[o+u]*i;return t+c},t.prototype.toStepping=function(t){return t=Lr(this.xVal,this.xPct,t)},t.prototype.fromStepping=function(t){return function(t,e,n){if(n>=100)return t.slice(-1)[0];var r=Nr(n,e),o=t[r-1],i=t[r],s=e[r-1];return function(t,e){return e*(t[1]-t[0])/100+t[0]}([o,i],(n-s)*Cr(s,e[r]))}(this.xVal,this.xPct,t)},t.prototype.getStep=function(t){return t=Or(this.xPct,this.xSteps,this.snap,t)},t.prototype.getDefaultStep=function(t,e,n){var r=Nr(t,this.xPct);return(100===t||e&&t===this.xPct[r-1])&&(r=Math.max(r-1,1)),(this.xVal[r]-this.xVal[r-1])/n},t.prototype.getNearbySteps=function(t){var e=Nr(t,this.xPct);return{stepBefore:{startValue:this.xVal[e-2],step:this.xNumSteps[e-2],highestStep:this.xHighestCompleteStep[e-2]},thisStep:{startValue:this.xVal[e-1],step:this.xNumSteps[e-1],highestStep:this.xHighestCompleteStep[e-1]},stepAfter:{startValue:this.xVal[e],step:this.xNumSteps[e],highestStep:this.xHighestCompleteStep[e]}}},t.prototype.countStepDecimals=function(){var t=this.xNumSteps.map(xr);return Math.max.apply(null,t)},t.prototype.hasNoSize=function(){return this.xVal[0]===this.xVal[this.xVal.length-1]},t.prototype.convert=function(t){return this.getStep(this.toStepping(t))},t.prototype.handleEntryPoint=function(t,e){var n;if(!vr(n="min"===t?0:"max"===t?100:parseFloat(t))||!vr(e[0]))throw new Error("noUiSlider: 'range' value isn't numeric.");this.xPct.push(n),this.xVal.push(e[0]);var r=Number(e[1]);n?this.xSteps.push(!isNaN(r)&&r):isNaN(r)||(this.xSteps[0]=r),this.xHighestCompleteStep.push(0)},t.prototype.handleStepPoint=function(t,e){if(e)if(this.xVal[t]!==this.xVal[t+1]){this.xSteps[t]=Pr([this.xVal[t],this.xVal[t+1]],e,0)/Cr(this.xPct[t],this.xPct[t+1]);var n=(this.xVal[t+1]-this.xVal[t])/this.xNumSteps[t],r=Math.ceil(Number(n.toFixed(3))-1),o=this.xVal[t]+this.xNumSteps[t]*r;this.xHighestCompleteStep[t]=o}else this.xSteps[t]=this.xHighestCompleteStep[t]=this.xVal[t]},t}(),Rr={to:function(t){return void 0===t?"":t.toFixed(2)},from:Number},Ar={target:"target",base:"base",origin:"origin",handle:"handle",handleLower:"handle-lower",handleUpper:"handle-upper",touchArea:"touch-area",horizontal:"horizontal",vertical:"vertical",background:"background",connect:"connect",connects:"connects",ltr:"ltr",rtl:"rtl",textDirectionLtr:"txt-dir-ltr",textDirectionRtl:"txt-dir-rtl",draggable:"draggable",drag:"state-drag",tap:"state-tap",active:"active",tooltip:"tooltip",pips:"pips",pipsHorizontal:"pips-horizontal",pipsVertical:"pips-vertical",marker:"marker",markerHorizontal:"marker-horizontal",markerVertical:"marker-vertical",markerNormal:"marker-normal",markerLarge:"marker-large",markerSub:"marker-sub",value:"value",valueHorizontal:"value-horizontal",valueVertical:"value-vertical",valueNormal:"value-normal",valueLarge:"value-large",valueSub:"value-sub"},Mr={tooltips:".__tooltips",aria:".__aria"};function Vr(t,e){if(!vr(e))throw new Error("noUiSlider: 'step' is not numeric.");t.singleStep=e}function Tr(t,e){if(!vr(e))throw new Error("noUiSlider: 'keyboardPageMultiplier' is not numeric.");t.keyboardPageMultiplier=e}function _r(t,e){if(!vr(e))throw new Error("noUiSlider: 'keyboardMultiplier' is not numeric.");t.keyboardMultiplier=e}function jr(t,e){if(!vr(e))throw new Error("noUiSlider: 'keyboardDefaultStep' is not numeric.");t.keyboardDefaultStep=e}function Ur(t,e){if("object"!=typeof e||Array.isArray(e))throw new Error("noUiSlider: 'range' is not an object.");if(void 0===e.min||void 0===e.max)throw new Error("noUiSlider: Missing 'min' or 'max' in 'range'.");t.spectrum=new Ir(e,t.snap||!1,t.singleStep)}function qr(t,e){if(e=yr(e),!Array.isArray(e)||!e.length)throw new Error("noUiSlider: 'start' option is incorrect.");t.handles=e.length,t.start=e}function zr(t,e){if("boolean"!=typeof e)throw new Error("noUiSlider: 'snap' option must be a boolean.");t.snap=e}function Dr(t,e){if("boolean"!=typeof e)throw new Error("noUiSlider: 'animate' option must be a boolean.");t.animate=e}function Hr(t,e){if("number"!=typeof e)throw new Error("noUiSlider: 'animationDuration' option must be a number.");t.animationDuration=e}function Fr(t,e){var n,r=[!1];if("lower"===e?e=[!0,!1]:"upper"===e&&(e=[!1,!0]),!0===e||!1===e){for(n=1;n<t.handles;n++)r.push(e);r.push(!1)}else{if(!Array.isArray(e)||!e.length||e.length!==t.handles+1)throw new Error("noUiSlider: 'connect' option doesn't match handle count.");r=e}t.connect=r}function Br(t,e){switch(e){case"horizontal":t.ort=0;break;case"vertical":t.ort=1;break;default:throw new Error("noUiSlider: 'orientation' option is invalid.")}}function Xr(t,e){if(!vr(e))throw new Error("noUiSlider: 'margin' option must be numeric.");0!==e&&(t.margin=t.spectrum.getDistance(e))}function Jr(t,e){if(!vr(e))throw new Error("noUiSlider: 'limit' option must be numeric.");if(t.limit=t.spectrum.getDistance(e),!t.limit||t.handles<2)throw new Error("noUiSlider: 'limit' option is only supported on linear sliders with 2 or more handles.")}function Zr(t,e){var n;if(!vr(e)&&!Array.isArray(e))throw new Error("noUiSlider: 'padding' option must be numeric or array of exactly 2 numbers.");if(Array.isArray(e)&&2!==e.length&&!vr(e[0])&&!vr(e[1]))throw new Error("noUiSlider: 'padding' option must be numeric or array of exactly 2 numbers.");if(0!==e){for(Array.isArray(e)||(e=[e,e]),t.padding=[t.spectrum.getDistance(e[0]),t.spectrum.getDistance(e[1])],n=0;n<t.spectrum.xNumSteps.length-1;n++)if(t.padding[0][n]<0||t.padding[1][n]<0)throw new Error("noUiSlider: 'padding' option must be a positive number(s).");var r=e[0]+e[1],o=t.spectrum.xVal[0];if(r/(t.spectrum.xVal[t.spectrum.xVal.length-1]-o)>1)throw new Error("noUiSlider: 'padding' option must not exceed 100% of the range.")}}function Wr(t,e){switch(e){case"ltr":t.dir=0;break;case"rtl":t.dir=1;break;default:throw new Error("noUiSlider: 'direction' option was not recognized.")}}function Yr(t,e){if("string"!=typeof e)throw new Error("noUiSlider: 'behaviour' must be a string containing options.");var n=e.indexOf("tap")>=0,r=e.indexOf("drag")>=0,o=e.indexOf("fixed")>=0,i=e.indexOf("snap")>=0,s=e.indexOf("hover")>=0,a=e.indexOf("unconstrained")>=0,l=e.indexOf("invert-connects")>=0,c=e.indexOf("drag-all")>=0,u=e.indexOf("smooth-steps")>=0;if(o){if(2!==t.handles)throw new Error("noUiSlider: 'fixed' behaviour must be used with 2 handles");Xr(t,t.start[1]-t.start[0])}if(l&&2!==t.handles)throw new Error("noUiSlider: 'invert-connects' behaviour must be used with 2 handles");if(a&&(t.margin||t.limit))throw new Error("noUiSlider: 'unconstrained' behaviour cannot be used with margin or limit");t.events={tap:n||i,drag:r,dragAll:c,smoothSteps:u,fixed:o,snap:i,hover:s,unconstrained:a,invertConnects:l}}function Gr(t,e){if(!1!==e)if(!0===e||gr(e)){t.tooltips=[];for(var n=0;n<t.handles;n++)t.tooltips.push(e)}else{if((e=yr(e)).length!==t.handles)throw new Error("noUiSlider: must pass a formatter for all handles.");e.forEach((function(t){if("boolean"!=typeof t&&!gr(t))throw new Error("noUiSlider: 'tooltips' must be passed a formatter or 'false'.")})),t.tooltips=e}}function Qr(t,e){if(e.length!==t.handles)throw new Error("noUiSlider: must pass a attributes for all handles.");t.handleAttributes=e}function Kr(t,e){if(!gr(e))throw new Error("noUiSlider: 'ariaFormat' requires 'to' method.");t.ariaFormat=e}function to(t,e){if(!function(t){return gr(t)&&"function"==typeof t.from}(e))throw new Error("noUiSlider: 'format' requires 'to' and 'from' methods.");t.format=e}function eo(t,e){if("boolean"!=typeof e)throw new Error("noUiSlider: 'keyboardSupport' option must be a boolean.");t.keyboardSupport=e}function no(t,e){t.documentElement=e}function ro(t,e){if("string"!=typeof e&&!1!==e)throw new Error("noUiSlider: 'cssPrefix' must be a string or `false`.");t.cssPrefix=e}function oo(t,e){if("object"!=typeof e)throw new Error("noUiSlider: 'cssClasses' must be an object.");"string"==typeof t.cssPrefix?(t.cssClasses={},Object.keys(e).forEach((function(n){t.cssClasses[n]=t.cssPrefix+e[n]}))):t.cssClasses=e}function io(t){var e={margin:null,limit:null,padding:null,animate:!0,animationDuration:300,ariaFormat:Rr,format:Rr},n={step:{r:!1,t:Vr},keyboardPageMultiplier:{r:!1,t:Tr},keyboardMultiplier:{r:!1,t:_r},keyboardDefaultStep:{r:!1,t:jr},start:{r:!0,t:qr},connect:{r:!0,t:Fr},direction:{r:!0,t:Wr},snap:{r:!1,t:zr},animate:{r:!1,t:Dr},animationDuration:{r:!1,t:Hr},range:{r:!0,t:Ur},orientation:{r:!1,t:Br},margin:{r:!1,t:Xr},limit:{r:!1,t:Jr},padding:{r:!1,t:Zr},behaviour:{r:!0,t:Yr},ariaFormat:{r:!1,t:Kr},format:{r:!1,t:to},tooltips:{r:!1,t:Gr},keyboardSupport:{r:!0,t:eo},documentElement:{r:!1,t:no},cssPrefix:{r:!0,t:ro},cssClasses:{r:!0,t:oo},handleAttributes:{r:!1,t:Qr}},r={connect:!1,direction:"ltr",behaviour:"tap",orientation:"horizontal",keyboardSupport:!0,cssPrefix:"noUi-",cssClasses:Ar,keyboardPageMultiplier:5,keyboardMultiplier:1,keyboardDefaultStep:10};t.format&&!t.ariaFormat&&(t.ariaFormat=t.format),Object.keys(n).forEach((function(o){if(hr(t[o])||void 0!==r[o])n[o].t(e,hr(t[o])?t[o]:r[o]);else if(n[o].r)throw new Error("noUiSlider: '"+o+"' is required.")})),e.pips=t.pips;var o=document.createElement("div"),i=void 0!==o.style.msTransform,s=void 0!==o.style.transform;e.transformRule=s?"transform":i?"msTransform":"webkitTransform";return e.style=[["left","top"],["right","bottom"]][e.dir][e.ort],e}function so(t,e,n){var r,o,i,s,a,l,c,u=window.navigator.pointerEnabled?{start:"pointerdown",move:"pointermove",end:"pointerup"}:window.navigator.msPointerEnabled?{start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:{start:"mousedown touchstart",move:"mousemove touchmove",end:"mouseup touchend"},d=window.CSS&&CSS.supports&&CSS.supports("touch-action","none")&&function(){var t=!1;try{var e=Object.defineProperty({},"passive",{get:function(){t=!0}});window.addEventListener("test",null,e)}catch(t){}return t}(),f=t,p=e.spectrum,g=[],m=[],h=[],$=0,v={},b=!1,w=t.ownerDocument,y=e.documentElement||w.documentElement,x=w.body,k="rtl"===w.dir||1===e.ort?0:100;function S(t,e){var n=w.createElement("div");return e&&kr(n,e),t.appendChild(n),n}function E(t,n){var r=S(t,e.cssClasses.origin),o=S(r,e.cssClasses.handle);if(S(o,e.cssClasses.touchArea),o.setAttribute("data-handle",String(n)),e.keyboardSupport&&(o.setAttribute("tabindex","0"),o.addEventListener("keydown",(function(t){return function(t,n){if(N()||L(n))return!1;var r=["Left","Right"],o=["Down","Up"],i=["PageDown","PageUp"],s=["Home","End"];e.dir&&!e.ort?r.reverse():e.ort&&!e.dir&&(o.reverse(),i.reverse());var a,l=t.key.replace("Arrow",""),c=l===i[0],u=l===i[1],d=l===o[0]||l===r[0]||c,f=l===o[1]||l===r[1]||u,h=l===s[0],$=l===s[1];if(!(d||f||h||$))return!0;if(t.preventDefault(),f||d){var v=d?0:1,b=at(n)[v];if(null===b)return!1;!1===b&&(b=p.getDefaultStep(m[n],d,e.keyboardDefaultStep)),b*=u||c?e.keyboardPageMultiplier:e.keyboardMultiplier,b=Math.max(b,1e-7),b*=d?-1:1,a=g[n]+b}else a=$?e.spectrum.xVal[e.spectrum.xVal.length-1]:e.spectrum.xVal[0];return nt(n,p.toStepping(a),!0,!0),W("slide",n),W("update",n),W("change",n),W("set",n),!1}(t,n)}))),void 0!==e.handleAttributes){var i=e.handleAttributes[n];Object.keys(i).forEach((function(t){o.setAttribute(t,i[t])}))}return o.setAttribute("role","slider"),o.setAttribute("aria-orientation",e.ort?"vertical":"horizontal"),0===n?kr(o,e.cssClasses.handleLower):n===e.handles-1&&kr(o,e.cssClasses.handleUpper),r.handle=o,r}function C(t,n){return!!n&&S(t,e.cssClasses.connect)}function P(t,n){return!(!e.tooltips||!e.tooltips[n])&&S(t.firstChild,e.cssClasses.tooltip)}function N(){return f.hasAttribute("disabled")}function L(t){return i[t].hasAttribute("disabled")}function O(){l&&(Z("update"+Mr.tooltips),l.forEach((function(t){t&&mr(t)})),l=null)}function I(){O(),l=i.map(P),J("update"+Mr.tooltips,(function(t,n,r){if(l&&e.tooltips&&!1!==l[n]){var o=t[n];!0!==e.tooltips[n]&&(o=e.tooltips[n].to(r[n])),l[n].innerHTML=o}}))}function R(t,e){return t.map((function(t){return p.fromStepping(e?p.getStep(t):t)}))}function A(t){var e,n=function(t){if(t.mode===fr.Range||t.mode===fr.Steps)return p.xVal;if(t.mode===fr.Count){if(t.values<2)throw new Error("noUiSlider: 'values' (>= 2) required for mode 'count'.");for(var e=t.values-1,n=100/e,r=[];e--;)r[e]=e*n;return r.push(100),R(r,t.stepped)}return t.mode===fr.Positions?R(t.values,t.stepped):t.mode===fr.Values?t.stepped?t.values.map((function(t){return p.fromStepping(p.getStep(p.toStepping(t)))})):t.values:[]}(t),r={},o=p.xVal[0],i=p.xVal[p.xVal.length-1],s=!1,a=!1,l=0;return e=n.slice().sort((function(t,e){return t-e})),(n=e.filter((function(t){return!this[t]&&(this[t]=!0)}),{}))[0]!==o&&(n.unshift(o),s=!0),n[n.length-1]!==i&&(n.push(i),a=!0),n.forEach((function(e,o){var i,c,u,d,f,g,m,h,$,v,b=e,w=n[o+1],y=t.mode===fr.Steps;for(y&&(i=p.xNumSteps[o]),i||(i=w-b),void 0===w&&(w=b),i=Math.max(i,1e-7),c=b;c<=w;c=Number((c+i).toFixed(7))){for(h=(f=(d=p.toStepping(c))-l)/(t.density||1),v=f/($=Math.round(h)),u=1;u<=$;u+=1)r[(g=l+u*v).toFixed(5)]=[p.fromStepping(g),0];m=n.indexOf(c)>-1?pr.LargeValue:y?pr.SmallValue:pr.NoValue,!o&&s&&c!==w&&(m=0),c===w&&a||(r[d.toFixed(5)]=[c,m]),l=d}})),r}function M(t,n,r){var o,i,s=w.createElement("div"),a=((o={})[pr.None]="",o[pr.NoValue]=e.cssClasses.valueNormal,o[pr.LargeValue]=e.cssClasses.valueLarge,o[pr.SmallValue]=e.cssClasses.valueSub,o),l=((i={})[pr.None]="",i[pr.NoValue]=e.cssClasses.markerNormal,i[pr.LargeValue]=e.cssClasses.markerLarge,i[pr.SmallValue]=e.cssClasses.markerSub,i),c=[e.cssClasses.valueHorizontal,e.cssClasses.valueVertical],u=[e.cssClasses.markerHorizontal,e.cssClasses.markerVertical];function d(t,n){var r=n===e.cssClasses.value,o=r?a:l;return n+" "+(r?c:u)[e.ort]+" "+o[t]}return kr(s,e.cssClasses.pips),kr(s,0===e.ort?e.cssClasses.pipsHorizontal:e.cssClasses.pipsVertical),Object.keys(t).forEach((function(o){!function(t,o,i){if((i=n?n(o,i):i)!==pr.None){var a=S(s,!1);a.className=d(i,e.cssClasses.marker),a.style[e.style]=t+"%",i>pr.NoValue&&((a=S(s,!1)).className=d(i,e.cssClasses.value),a.setAttribute("data-value",String(o)),a.style[e.style]=t+"%",a.innerHTML=String(r.to(o)))}}(o,t[o][0],t[o][1])})),s}function V(){a&&(mr(a),a=null)}function T(t){V();var e=A(t),n=t.filter,r=t.format||{to:function(t){return String(Math.round(t))}};return a=f.appendChild(M(e,n,r))}function _(){var t=r.getBoundingClientRect(),n="offset"+["Width","Height"][e.ort];return 0===e.ort?t.width||r[n]:t.height||r[n]}function j(t,n,r,o){var i=function(i){var s,a,l=function(t,e,n){var r=0===t.type.indexOf("touch"),o=0===t.type.indexOf("mouse"),i=0===t.type.indexOf("pointer"),s=0,a=0;0===t.type.indexOf("MSPointer")&&(i=!0);if("mousedown"===t.type&&!t.buttons&&!t.touches)return!1;if(r){var l=function(e){var r=e.target;return r===n||n.contains(r)||t.composed&&t.composedPath().shift()===n};if("touchstart"===t.type){var c=Array.prototype.filter.call(t.touches,l);if(c.length>1)return!1;s=c[0].pageX,a=c[0].pageY}else{var u=Array.prototype.find.call(t.changedTouches,l);if(!u)return!1;s=u.pageX,a=u.pageY}}e=e||Er(w),(o||i)&&(s=t.clientX+e.x,a=t.clientY+e.y);return t.pageOffset=e,t.points=[s,a],t.cursor=o||i,t}(i,o.pageOffset,o.target||n);return!!l&&(!(N()&&!o.doNotReject)&&(s=f,a=e.cssClasses.tap,!((s.classList?s.classList.contains(a):new RegExp("\\b"+a+"\\b").test(s.className))&&!o.doNotReject)&&(!(t===u.start&&void 0!==l.buttons&&l.buttons>1)&&((!o.hover||!l.buttons)&&(d||l.preventDefault(),l.calcPoint=l.points[e.ort],void r(l,o))))))},s=[];return t.split(" ").forEach((function(t){n.addEventListener(t,i,!!d&&{passive:!0}),s.push([t,i])})),s}function U(t){var n,o,i,s,a,l,c=100*(t-(n=r,o=e.ort,i=n.getBoundingClientRect(),s=n.ownerDocument,a=s.documentElement,l=Er(s),/webkit.*Chrome.*Mobile/i.test(navigator.userAgent)&&(l.x=0),o?i.top+l.y-a.clientTop:i.left+l.x-a.clientLeft))/_();return c=wr(c),e.dir?100-c:c}function q(t,e){"mouseout"===t.type&&"HTML"===t.target.nodeName&&null===t.relatedTarget&&D(t,e)}function z(t,n){if(-1===navigator.appVersion.indexOf("MSIE 9")&&0===t.buttons&&0!==n.buttonsProperty)return D(t,n);var r=(e.dir?-1:1)*(t.calcPoint-n.startCalcPoint);Q(r>0,100*r/n.baseSize,n.locations,n.handleNumbers,n.connect)}function D(t,n){n.handle&&(Sr(n.handle,e.cssClasses.active),$-=1),n.listeners.forEach((function(t){y.removeEventListener(t[0],t[1])})),0===$&&(Sr(f,e.cssClasses.drag),et(),t.cursor&&(x.style.cursor="",x.removeEventListener("selectstart",$r))),e.events.smoothSteps&&(n.handleNumbers.forEach((function(t){nt(t,m[t],!0,!0,!1,!1)})),n.handleNumbers.forEach((function(t){W("update",t)}))),n.handleNumbers.forEach((function(t){W("change",t),W("set",t),W("end",t)}))}function H(t,n){if(!n.handleNumbers.some(L)){var r;if(1===n.handleNumbers.length)r=i[n.handleNumbers[0]].children[0],$+=1,kr(r,e.cssClasses.active);t.stopPropagation();var o=[],s=j(u.move,y,z,{target:t.target,handle:r,connect:n.connect,listeners:o,startCalcPoint:t.calcPoint,baseSize:_(),pageOffset:t.pageOffset,handleNumbers:n.handleNumbers,buttonsProperty:t.buttons,locations:m.slice()}),a=j(u.end,y,D,{target:t.target,handle:r,listeners:o,doNotReject:!0,handleNumbers:n.handleNumbers}),l=j("mouseout",y,q,{target:t.target,handle:r,listeners:o,doNotReject:!0,handleNumbers:n.handleNumbers});o.push.apply(o,s.concat(a,l)),t.cursor&&(x.style.cursor=getComputedStyle(t.target).cursor,i.length>1&&kr(f,e.cssClasses.drag),x.addEventListener("selectstart",$r,!1)),n.handleNumbers.forEach((function(t){W("start",t)}))}}function F(t){t.stopPropagation();var n=U(t.calcPoint),r=function(t){var e=100,n=!1;return i.forEach((function(r,o){if(!L(o)){var i=m[o],s=Math.abs(i-t);(s<e||s<=e&&t>i||100===s&&100===e)&&(n=o,e=s)}})),n}(n);!1!==r&&(e.events.snap||br(f,e.cssClasses.tap,e.animationDuration),nt(r,n,!0,!0),et(),W("slide",r,!0),W("update",r,!0),e.events.snap?H(t,{handleNumbers:[r]}):(W("change",r,!0),W("set",r,!0)))}function B(t){var e=U(t.calcPoint),n=p.getStep(e),r=p.fromStepping(n);Object.keys(v).forEach((function(t){"hover"===t.split(".")[0]&&v[t].forEach((function(t){t.call(ct,r)}))}))}function X(t){t.fixed||i.forEach((function(t,e){j(u.start,t.children[0],H,{handleNumbers:[e]})})),t.tap&&j(u.start,r,F,{}),t.hover&&j(u.move,r,B,{hover:!0}),t.drag&&s.forEach((function(n,r){if(!1!==n&&0!==r&&r!==s.length-1){var o=i[r-1],a=i[r],l=[n],c=[o,a],d=[r-1,r];kr(n,e.cssClasses.draggable),t.fixed&&(l.push(o.children[0]),l.push(a.children[0])),t.dragAll&&(c=i,d=h),l.forEach((function(t){j(u.start,t,H,{handles:c,handleNumbers:d,connect:n})}))}}))}function J(t,e){v[t]=v[t]||[],v[t].push(e),"update"===t.split(".")[0]&&i.forEach((function(t,e){W("update",e)}))}function Z(t){var e=t&&t.split(".")[0],n=e?t.substring(e.length):t;Object.keys(v).forEach((function(t){var r=t.split(".")[0],o=t.substring(r.length);e&&e!==r||n&&n!==o||function(t){return t===Mr.aria||t===Mr.tooltips}(o)&&n!==o||delete v[t]}))}function W(t,n,r){Object.keys(v).forEach((function(o){var i=o.split(".")[0];t===i&&v[o].forEach((function(t){t.call(ct,g.map(e.format.to),n,g.slice(),r||!1,m.slice(),ct)}))}))}function Y(t,n,r,o,s,a,l){var c;return i.length>1&&!e.events.unconstrained&&(o&&n>0&&(c=p.getAbsoluteDistance(t[n-1],e.margin,!1),r=Math.max(r,c)),s&&n<i.length-1&&(c=p.getAbsoluteDistance(t[n+1],e.margin,!0),r=Math.min(r,c))),i.length>1&&e.limit&&(o&&n>0&&(c=p.getAbsoluteDistance(t[n-1],e.limit,!1),r=Math.min(r,c)),s&&n<i.length-1&&(c=p.getAbsoluteDistance(t[n+1],e.limit,!0),r=Math.max(r,c))),e.padding&&(0===n&&(c=p.getAbsoluteDistance(0,e.padding[0],!1),r=Math.max(r,c)),n===i.length-1&&(c=p.getAbsoluteDistance(100,e.padding[1],!0),r=Math.min(r,c))),l||(r=p.getStep(r)),!((r=wr(r))===t[n]&&!a)&&r}function G(t,n){var r=e.ort;return(r?n:t)+", "+(r?t:n)}function Q(t,n,r,o,i){var s=r.slice(),a=o[0],l=e.events.smoothSteps,c=[!t,t],u=[t,!t];o=o.slice(),t&&o.reverse(),o.length>1?o.forEach((function(t,e){var r=Y(s,t,s[t]+n,c[e],u[e],!1,l);!1===r?n=0:(n=r-s[t],s[t]=r)})):c=u=[!0];var d=!1;o.forEach((function(t,e){d=nt(t,r[t]+n,c[e],u[e],!1,l)||d})),d&&(o.forEach((function(t){W("update",t),W("slide",t)})),null!=i&&W("drag",a))}function K(t,n){return e.dir?100-t-n:t}function tt(t,n){m[t]=n,g[t]=p.fromStepping(n);var r="translate("+G(K(n,0)-k+"%","0")+")";if(i[t].style[e.transformRule]=r,e.events.invertConnects&&m.length>1){var o=m.every((function(t,e,n){return 0===e||t>=n[e-1]}));if(b!==!o)return b=!b,Fr(e,e.connect.map((function(t){return!t}))),void lt()}rt(t),rt(t+1),b&&(rt(t-1),rt(t+2))}function et(){h.forEach((function(t){var e=m[t]>50?-1:1,n=3+(i.length+e*t);i[t].style.zIndex=String(n)}))}function nt(t,e,n,r,o,i){return o||(e=Y(m,t,e,n,r,!1,i)),!1!==e&&(tt(t,e),!0)}function rt(t){if(s[t]){var n=m.slice();b&&n.sort((function(t,e){return t-e}));var r=0,o=100;0!==t&&(r=n[t-1]),t!==s.length-1&&(o=n[t]);var i=o-r,a="translate("+G(K(r,i)+"%","0")+")",l="scale("+G(i/100,"1")+")";s[t].style[e.transformRule]=a+" "+l}}function ot(t,n){return null===t||!1===t||void 0===t?m[n]:("number"==typeof t&&(t=String(t)),!1!==(t=e.format.from(t))&&(t=p.toStepping(t)),!1===t||isNaN(t)?m[n]:t)}function it(t,n,r){var o=yr(t),i=void 0===m[0];n=void 0===n||n,e.animate&&!i&&br(f,e.cssClasses.tap,e.animationDuration),h.forEach((function(t){nt(t,ot(o[t],t),!0,!1,r)}));var s=1===h.length?0:1;if(i&&p.hasNoSize()&&(r=!0,m[0]=0,h.length>1)){var a=100/(h.length-1);h.forEach((function(t){m[t]=t*a}))}for(;s<h.length;++s)h.forEach((function(t){nt(t,m[t],!0,!0,r)}));et(),h.forEach((function(t){W("update",t),null!==o[t]&&n&&W("set",t)}))}function st(t){if(void 0===t&&(t=!1),t)return 1===g.length?g[0]:g.slice(0);var n=g.map(e.format.to);return 1===n.length?n[0]:n}function at(t){var n=m[t],r=p.getNearbySteps(n),o=g[t],i=r.thisStep.step,s=null;if(e.snap)return[o-r.stepBefore.startValue||null,r.stepAfter.startValue-o||null];!1!==i&&o+i>r.stepAfter.startValue&&(i=r.stepAfter.startValue-o),s=o>r.thisStep.startValue?r.thisStep.step:!1!==r.stepBefore.step&&o-r.stepBefore.highestStep,100===n?i=null:0===n&&(s=null);var a=p.countStepDecimals();return null!==i&&!1!==i&&(i=Number(i.toFixed(a))),null!==s&&!1!==s&&(s=Number(s.toFixed(a))),[s,i]}function lt(){for(;o.firstChild;)o.removeChild(o.firstChild);for(var t=0;t<=e.handles;t++)s[t]=C(o,e.connect[t]),rt(t);X({drag:e.events.drag,fixed:!0})}kr(c=f,e.cssClasses.target),0===e.dir?kr(c,e.cssClasses.ltr):kr(c,e.cssClasses.rtl),0===e.ort?kr(c,e.cssClasses.horizontal):kr(c,e.cssClasses.vertical),kr(c,"rtl"===getComputedStyle(c).direction?e.cssClasses.textDirectionRtl:e.cssClasses.textDirectionLtr),r=S(c,e.cssClasses.base),function(t,n){o=S(n,e.cssClasses.connects),i=[],(s=[]).push(C(o,t[0]));for(var r=0;r<e.handles;r++)i.push(E(n,r)),h[r]=r,s.push(C(o,t[r+1]))}(e.connect,r),X(e.events),it(e.start),e.pips&&T(e.pips),e.tooltips&&I(),Z("update"+Mr.aria),J("update"+Mr.aria,(function(t,n,r,o,s){h.forEach((function(t){var n=i[t],o=Y(m,t,0,!0,!0,!0),a=Y(m,t,100,!0,!0,!0),l=s[t],c=String(e.ariaFormat.to(r[t]));o=p.fromStepping(o).toFixed(1),a=p.fromStepping(a).toFixed(1),l=p.fromStepping(l).toFixed(1),n.children[0].setAttribute("aria-valuemin",o),n.children[0].setAttribute("aria-valuemax",a),n.children[0].setAttribute("aria-valuenow",l),n.children[0].setAttribute("aria-valuetext",c)}))}));var ct={destroy:function(){for(Z(Mr.aria),Z(Mr.tooltips),Object.keys(e.cssClasses).forEach((function(t){Sr(f,e.cssClasses[t])}));f.firstChild;)f.removeChild(f.firstChild);delete f.noUiSlider},steps:function(){return h.map(at)},on:J,off:Z,get:st,set:it,setHandle:function(t,e,n,r){if(!((t=Number(t))>=0&&t<h.length))throw new Error("noUiSlider: invalid handle number, got: "+t);nt(t,ot(e,t),!0,!0,r),W("update",t),n&&W("set",t)},reset:function(t){it(e.start,t)},disable:function(t){null!=t?(i[t].setAttribute("disabled",""),i[t].handle.removeAttribute("tabindex")):(f.setAttribute("disabled",""),i.forEach((function(t){t.handle.removeAttribute("tabindex")})))},enable:function(t){null!=t?(i[t].removeAttribute("disabled"),i[t].handle.setAttribute("tabindex","0")):(f.removeAttribute("disabled"),i.forEach((function(t){t.removeAttribute("disabled"),t.handle.setAttribute("tabindex","0")})))},__moveHandles:function(t,e,n){Q(t,e,m,n)},options:n,updateOptions:function(t,r){var o=st(),i=["margin","limit","padding","range","animate","snap","step","format","pips","tooltips","connect"];i.forEach((function(e){void 0!==t[e]&&(n[e]=t[e])}));var s=io(n);i.forEach((function(n){void 0!==t[n]&&(e[n]=s[n])})),p=s.spectrum,e.margin=s.margin,e.limit=s.limit,e.padding=s.padding,e.pips?T(e.pips):V(),e.tooltips?I():O(),m=[],it(hr(t.start)?t.start:o,r),t.connect&&lt()},target:f,removePips:V,removeTooltips:O,getPositions:function(){return m.slice()},getTooltips:function(){return l},getOrigins:function(){return i},pips:T};return ct}var ao={__spectrum:Ir,cssClasses:Ar,create:function(t,e){if(!t||!t.nodeName)throw new Error("noUiSlider: create requires a single element, got: "+t);if(t.noUiSlider)throw new Error("noUiSlider: Slider was already initialized.");var n=so(t,io(e),e);return t.noUiSlider=n,n}};function lo(e){let n,r,o;return{c(){n=L("div"),r=L("div"),o=L("div"),T(o,"class","slider"),T(r,"class","slider-wrapper")},m(t,i){C(t,n,i),k(n,r),k(r,o),e[4](o)},p:t,i:t,o:t,d(t){t&&P(n),e[4](null)}}}function co(t,e,n){let r,o,{minVal:i}=e,{maxVal:s}=e,{step:a=1}=e;const l=function(){const t=W();return(e,n,{cancelable:r=!1}={})=>{const o=t.$$.callbacks[e];if(o){const i=z(e,n,{cancelable:r});return o.slice().forEach((e=>{e.call(t,i)})),!i.defaultPrevented}return!0}}();function c(){ao.create(o,{start:[i,s],step:a,connect:!0,range:r}),o.noUiSlider.on("set",(()=>{let t=o.noUiSlider.get(!0);(([t,e])=>{r={min:t,max:e},console.log("called it",[t,e],r)})(t),l("updateRange",t)}))}return Y((()=>{c()})),t.$$set=t=>{"minVal"in t&&n(1,i=t.minVal),"maxVal"in t&&n(2,s=t.maxVal),"step"in t&&n(3,a=t.step)},t.$$.update=()=>{6&t.$$.dirty&&(r={min:i,max:s})},[o,i,s,a,function(t){tt[t?"unshift":"push"]((()=>{o=t,n(0,o)}))}]}class uo extends Lt{constructor(t){super(),Nt(this,t,co,lo,s,{minVal:1,maxVal:2,step:3})}}function fo(t){let e,n,r,o,i,s,a,l,c,u,d;return u=new uo({props:{minVal:2,maxVal:6,step:1,numberType:"integer"}}),u.$on("updateRange",t[1]),{c(){e=L("div"),n=L("h1"),r=I(t[0]),o=R(),i=L("div"),s=L("div"),a=L("span"),a.innerHTML="<b>Propagation</b>",l=R(),c=L("div"),St(u.$$.fragment),T(c,"class","depth"),T(s,"class","propagation-ctrl"),T(i,"class","propagation-ctrl-wrapper")},m(t,f){C(t,e,f),k(e,n),k(n,r),k(e,o),k(e,i),k(i,s),k(s,a),k(s,l),k(s,c),Et(u,c,null),d=!0},p(t,[e]){(!d||1&e)&&_(r,t[0])},i(t){d||(ht(u.$$.fragment,t),d=!0)},o(t){$t(u.$$.fragment,t),d=!1},d(t){t&&P(e),Ct(u)}}}function po(t,e,n){let r;return n(0,r=[2,6]),[r,t=>n(0,r=t.detail)]}class go extends Lt{constructor(t){super(),Nt(this,t,po,fo,s,{})}}function mo(e){let n,r,o,i;return n=new rr({}),o=new Gn({}),{c(){St(n.$$.fragment),r=R(),St(o.$$.fragment)},m(t,e){Et(n,t,e),C(t,r,e),Et(o,t,e),i=!0},p:t,i(t){i||(ht(n.$$.fragment,t),ht(o.$$.fragment,t),i=!0)},o(t){$t(n.$$.fragment,t),$t(o.$$.fragment,t),i=!1},d(t){Ct(n,t),t&&P(r),Ct(o,t)}}}function ho(t){let e,n;return e=new Be({props:{$$slots:{default:[wo]},$$scope:{ctx:t}}}),{c(){St(e.$$.fragment)},m(t,r){Et(e,t,r),n=!0},p(t,n){const r={};10&n&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){n||(ht(e.$$.fragment,t),n=!0)},o(t){$t(e.$$.fragment,t),n=!1},d(t){Ct(e,t)}}}function $o(t){let e,n;return e=new Be({props:{$$slots:{default:[yo]},$$scope:{ctx:t}}}),{c(){St(e.$$.fragment)},m(t,r){Et(e,t,r),n=!0},p(t,n){const r={};8&n&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){n||(ht(e.$$.fragment,t),n=!0)},o(t){$t(e.$$.fragment,t),n=!1},d(t){Ct(e,t)}}}function vo(t){let e,n;return{c(){e=I("Erreur lors de la récupération des similarités : "),n=I(t[1])},m(t,r){C(t,e,r),C(t,n,r)},p(t,e){2&e&&_(n,t[1])},d(t){t&&P(e),t&&P(n)}}}function bo(t){let e,n;return{c(){e=I("Error when retrieving similarities: "),n=I(t[1])},m(t,r){C(t,e,r),C(t,n,r)},p(t,e){2&e&&_(n,t[1])},d(t){t&&P(e),t&&P(n)}}}function wo(t){let e;let n=("en"===Tt?bo:vo)(t);return{c(){e=L("tr"),n.c(),T(e,"class","faded is-center")},m(t,r){C(t,e,r),n.m(e,null)},p(t,e){n.p(t,e)},d(t){t&&P(e),n.d()}}}function yo(e){let n;return{c(){n=L("tr"),n.textContent=""+("en"===Tt?"Retrieving similarities...":"Récupération des similarités..."),T(n,"class","faded is-center")},m(t,e){C(t,n,e)},p:t,d(t){t&&P(n)}}}function xo(t){let e,n,r=qt.includes("similarity"),o=r&&function(t){let e,n,r,o,i,s,a,l;e=new go({}),r=new dr({});const c=[$o,ho,mo],u=[];function d(t,e){return t[0]?0:t[1]?1:2}return i=d(t),s=u[i]=c[i](t),{c(){St(e.$$.fragment),n=R(),St(r.$$.fragment),o=R(),s.c(),a=A()},m(t,s){Et(e,t,s),C(t,n,s),Et(r,t,s),C(t,o,s),u[i].m(t,s),C(t,a,s),l=!0},p(t,e){let n=i;i=d(t),i===n?u[i].p(t,e):(gt(),$t(u[n],1,1,(()=>{u[n]=null})),mt(),s=u[i],s?s.p(t,e):(s=u[i]=c[i](t),s.c()),ht(s,1),s.m(a.parentNode,a))},i(t){l||(ht(e.$$.fragment,t),ht(r.$$.fragment,t),ht(s),l=!0)},o(t){$t(e.$$.fragment,t),$t(r.$$.fragment,t),$t(s),l=!1},d(t){Ct(e,t),t&&P(n),Ct(r,t),t&&P(o),u[i].d(t),t&&P(a)}}}(t);return{c(){o&&o.c(),e=A()},m(t,r){o&&o.m(t,r),C(t,e,r),n=!0},p(t,[e]){r&&o.p(t,e)},i(t){n||(ht(o),n=!0)},o(t){$t(o),n=!1},d(t){o&&o.d(t),t&&P(e)}}}function ko(t,e,n){let r,o;d(t,Xt,(t=>n(0,r=t))),d(t,Jt,(t=>n(1,o=t)));const{fetchSimilarity:i}=De;return Y((()=>{qt.includes("similarity")&&i()})),[r,o]}class So extends Lt{constructor(t){super(),Nt(this,t,ko,xo,s,{})}}function Eo(t){let e,n,r,o,i,s,a,c,u,d,p,$,v,b,w,y,x,S;const E=t[4].default,N=f(E,t,t[3],null);return{c(){e=L("tr"),n=L("th"),r=L("div"),o=L("img"),a=R(),c=L("div"),u=L("a"),d=L("i"),p=I("\n                    Page "),$=I(t[0]),b=R(),w=L("td"),y=L("div"),x=L("div"),N&&N.c(),l(o.src,i=Qt(t[1],"full","250,"))||T(o,"src",i),T(o,"alt",s="Canvas "+t[0]),T(o,"class","mb-3 card"),T(d,"class","fa-solid fa-pen-to-square"),T(u,"class","tag px-2 py-1 is-rounded is-hoverable"),T(u,"href",v=Kt(t[2],t[0])),T(u,"target","_blank"),T(c,"class","is-center mb-1"),T(r,"class","content-wrapper py-5"),T(n,"class","is-3 center-flex is-narrow"),U(n,"width","260px"),T(x,"class","grid is-gap-2"),T(y,"class","fixed-grid has-6-cols"),T(w,"class","p-5 is-fullwidth")},m(t,i){C(t,e,i),k(e,n),k(n,r),k(r,o),k(r,a),k(r,c),k(c,u),k(u,d),k(u,p),k(u,$),k(e,b),k(e,w),k(w,y),k(y,x),N&&N.m(x,null),S=!0},p(t,[e]){(!S||2&e&&!l(o.src,i=Qt(t[1],"full","250,")))&&T(o,"src",i),(!S||1&e&&s!==(s="Canvas "+t[0]))&&T(o,"alt",s),(!S||1&e)&&_($,t[0]),(!S||1&e&&v!==(v=Kt(t[2],t[0])))&&T(u,"href",v),N&&N.p&&(!S||8&e)&&m(N,E,t,t[3],S?g(E,t[3],e,null):h(t[3]),null)},i(t){S||(ht(N,t),S=!0)},o(t){$t(N,t),S=!1},d(t){t&&P(e),N&&N.d(t)}}}function Co(t,e,n){let{$$slots:r={},$$scope:o}=e,{canvasNb:i}=e,{canvasImg:s}=e;const a=Q("manifest");return t.$$set=t=>{"canvasNb"in t&&n(0,i=t.canvasNb),"canvasImg"in t&&n(1,s=t.canvasImg),"$$scope"in t&&n(3,o=t.$$scope)},[i,s,a,o,r]}class Po extends Lt{constructor(t){super(),Nt(this,t,Co,Eo,s,{canvasNb:0,canvasImg:1})}}function No(t,e,n){const r=t.slice();return r[9]=e[n][0],r[10]=e[n][1],r}function Lo(t,e,n){const r=t.slice();return r[13]=e[n],r}function Oo(e){let n,r,o="en"===Tt?`Error when retrieving paginated regions: ${e[16]}`:`Erreur de récupération des pages : ${e[16]}`;return{c(){n=L("tr"),r=I(o),T(n,"class","faded is-center")},m(t,e){C(t,n,e),k(n,r)},p(t,e){1&e&&o!==(o="en"===Tt?`Error when retrieving paginated regions: ${t[16]}`:`Erreur de récupération des pages : ${t[16]}`)&&_(r,o)},i:t,o:t,d(t){t&&P(n)}}}function Io(t){let e,n,r,o,i;const s=[Ao,Ro],a=[];function l(t,n){return 2&n&&(e=null),null==e&&(e=!!(Object.values(t[1]).length>0)),e?0:1}return n=l(t,-1),r=a[n]=s[n](t),{c(){r.c(),o=A()},m(t,e){a[n].m(t,e),C(t,o,e),i=!0},p(t,e){let i=n;n=l(t,e),n===i?a[n].p(t,e):(gt(),$t(a[i],1,1,(()=>{a[i]=null})),mt(),r=a[n],r?r.p(t,e):(r=a[n]=s[n](t),r.c()),ht(r,1),r.m(o.parentNode,o))},i(t){i||(ht(r),i=!0)},o(t){$t(r),i=!1},d(t){a[n].d(t),t&&P(o)}}}function Ro(e){let n,r,o;return r=new ke({}),{c(){n=L("tr"),St(r.$$.fragment)},m(t,e){C(t,n,e),Et(r,n,null),o=!0},p:t,i(t){o||(ht(r.$$.fragment,t),o=!0)},o(t){$t(r.$$.fragment,t),o=!1},d(t){t&&P(n),Ct(r)}}}function Ao(t){let e,n,r=Object.entries(t[1]),o=[];for(let e=0;e<r.length;e+=1)o[e]=To(No(t,r,e));const i=t=>$t(o[t],1,1,(()=>{o[t]=null}));return{c(){for(let t=0;t<o.length;t+=1)o[t].c();e=A()},m(t,r){for(let e=0;e<o.length;e+=1)o[e]&&o[e].m(t,r);C(t,e,r),n=!0},p(t,n){if(34&n){let s;for(r=Object.entries(t[1]),s=0;s<r.length;s+=1){const i=No(t,r,s);o[s]?(o[s].p(i,n),ht(o[s],1)):(o[s]=To(i),o[s].c(),ht(o[s],1),o[s].m(e.parentNode,e))}for(gt(),s=r.length;s<o.length;s+=1)i(s);mt()}},i(t){if(!n){for(let t=0;t<r.length;t+=1)ht(o[t]);n=!0}},o(t){o=o.filter(Boolean);for(let t=0;t<o.length;t+=1)$t(o[t]);n=!1},d(t){N(o,t),t&&P(e)}}}function Mo(t,e){let n,r,o;return r=new me({props:{item:e[13],isSquare:!1}}),{key:t,first:null,c(){n=A(),St(r.$$.fragment),this.first=n},m(t,e){C(t,n,e),Et(r,t,e),o=!0},p(t,n){e=t;const o={};2&n&&(o.item=e[13]),r.$set(o)},i(t){o||(ht(r.$$.fragment,t),o=!0)},o(t){$t(r.$$.fragment,t),o=!1},d(t){t&&P(n),Ct(r,t)}}}function Vo(t){let e,n,r=[],o=new Map,i=Object.values(t[10]);const s=t=>t[13].id;for(let e=0;e<i.length;e+=1){let n=Lo(t,i,e),a=s(n);o.set(a,r[e]=Mo(a,n))}return{c(){for(let t=0;t<r.length;t+=1)r[t].c();e=R()},m(t,o){for(let e=0;e<r.length;e+=1)r[e]&&r[e].m(t,o);C(t,e,o),n=!0},p(t,n){2&n&&(i=Object.values(t[10]),gt(),r=kt(r,n,s,1,t,i,o,e.parentNode,xt,Mo,e,Lo),mt())},i(t){if(!n){for(let t=0;t<i.length;t+=1)ht(r[t]);n=!0}},o(t){for(let t=0;t<r.length;t+=1)$t(r[t]);n=!1},d(t){for(let e=0;e<r.length;e+=1)r[e].d(t);t&&P(e)}}}function To(t){let e,n;return e=new Po({props:{canvasImg:t[5](t[9]),canvasNb:t[9],$$slots:{default:[Vo]},$$scope:{ctx:t}}}),{c(){St(e.$$.fragment)},m(t,r){Et(e,t,r),n=!0},p(t,n){const r={};2&n&&(r.canvasImg=t[5](t[9])),2&n&&(r.canvasNb=t[9]),131074&n&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){n||(ht(e.$$.fragment,t),n=!0)},o(t){$t(e.$$.fragment,t),n=!1},d(t){Ct(e,t)}}}function _o(e){let n;return{c(){n=L("tr"),n.textContent=""+("en"===Tt?"Retrieving paginated regions...":"Récupération des pages..."),T(n,"class","faded is-center")},m(t,e){C(t,n,e)},p:t,i:t,o:t,d(t){t&&P(n)}}}function jo(t){let e,n,r,o={ctx:t,current:null,token:null,hasCatch:!0,pending:_o,then:Io,catch:Oo,value:8,error:16,blocks:[,,,]};return wt(n=t[0],o),{c(){e=A(),o.block.c()},m(t,n){C(t,e,n),o.block.m(t,o.anchor=n),o.mount=()=>e.parentNode,o.anchor=e,r=!0},p(e,r){t=e,o.ctx=t,1&r&&n!==(n=t[0])&&wt(n,o)||yt(o,t,r)},i(t){r||(ht(o.block),r=!0)},o(t){for(let t=0;t<3;t+=1){$t(o.blocks[t])}r=!1},d(t){t&&P(e),o.block.d(t),o.token=null,o=null}}}function Uo(t){let e,n,r,o,i,s;return e=new en({props:{store:re,nbOfItems:t[4]}}),r=new Be({props:{$$slots:{default:[jo]},$$scope:{ctx:t}}}),i=new en({props:{store:re,nbOfItems:t[4]}}),{c(){St(e.$$.fragment),n=R(),St(r.$$.fragment),o=R(),St(i.$$.fragment)},m(t,a){Et(e,t,a),C(t,n,a),Et(r,t,a),C(t,o,a),Et(i,t,a),s=!0},p(t,[e]){const n={};131075&e&&(n.$$scope={dirty:e,ctx:t}),r.$set(n)},i(t){s||(ht(e.$$.fragment,t),ht(r.$$.fragment,t),ht(i.$$.fragment,t),s=!0)},o(t){$t(e.$$.fragment,t),$t(r.$$.fragment,t),$t(i.$$.fragment,t),s=!1},d(t){Ct(e,t),t&&P(n),Ct(r,t),t&&P(o),Ct(i,t)}}}function qo(t,e,n){let r,o;const{pageRegions:i,fetchPages:s}=re;d(t,i,(t=>n(1,o=t))),d(t,s,(t=>n(0,r=t)));const a=Q("nbOfPages"),l=Q("trailingZeros");return[r,o,i,s,a,function(t){return`${imgPrefix}_${e=t,n=l,e.toString().padStart(n,"0")}`;var e,n}]}class zo extends Lt{constructor(t){super(),Nt(this,t,qo,Uo,s,{})}}function Do(e){let n,r,o,i,s,a,l,c="en"===Tt?"Save selection":"Sauvegarder la sélection";return{c(){n=L("button"),r=L("span"),o=L("i"),i=R(),s=I(c),T(o,"class","fa-solid fa-floppy-disk"),T(n,"class","button is-link")},m(t,c){C(t,n,c),k(n,r),k(r,o),k(r,i),k(r,s),a||(l=M(n,"click",e[6]),a=!0)},p:t,d(t){t&&P(n),a=!1,l()}}}function Ho(t){let e,n,r,o,i,s,a="en"===Tt?"Go to treatment":"Accéder au traitement";return{c(){e=L("a"),n=L("span"),r=L("i"),o=R(),i=I(a),T(r,"class","fa-solid fa-gear"),T(e,"class","button is-link"),T(e,"href",s="/"+_t+"/treatment/add/?document_set="+t[2](t[0]).id)},m(t,s){C(t,e,s),k(e,n),k(n,r),k(n,o),k(n,i)},p(t,n){5&n&&s!==(s="/"+_t+"/treatment/add/?document_set="+t[2](t[0]).id)&&T(e,"href",s)},d(t){t&&P(e)}}}function Fo(e){let n,r,o,i,s,a;function l(t,e){return t[1]?Ho:Do}let c=l(e),u=c(e);return{c(){n=L("footer"),r=L("div"),o=L("button"),o.textContent=""+("en"===Tt?"Clear selection":"Vider la sélection"),i=R(),u.c(),T(o,"class","button button-close is-link is-light"),T(r,"class","buttons"),T(n,"class","modal-card-foot is-center")},m(t,l){C(t,n,l),k(n,r),k(r,o),k(r,i),u.m(r,null),s||(a=M(o,"click",e[5]),s=!0)},p(t,[e]){c===(c=l(t))&&u?u.p(t,e):(u.d(1),u=c(t),u&&(u.c(),u.m(r,null)))},i:t,o:t,d(t){t&&P(n),u.d(),s=!1,a()}}}function Bo(t,e,n){let r,o;const{isSaved:i,selection:s}=ne;d(t,i,(t=>n(1,r=t))),d(t,s,(t=>n(2,o=t)));let{isRegion:a=!0}=e;return t.$$set=t=>{"isRegion"in t&&n(0,a=t.isRegion)},[a,r,o,i,s,()=>ne.empty(a),()=>ne.save(a)]}class Xo extends Lt{constructor(t){super(),Nt(this,t,Bo,Fo,s,{isRegion:0})}}function Jo(t){let e,n,r,i,s,a,l=t[5](t[0])+"";return{c(){e=L("span"),n=I(l),r=R(),i=L("span"),i.innerHTML='<i class="fas fa-edit"></i>',T(i,"class","pl-3 smaller has-text-link")},m(o,l){C(o,e,l),k(e,n),k(e,r),k(e,i),s||(a=[M(e,"click",t[7]),M(e,"keyup",null)],s=!0)},p(t,e){33&e&&l!==(l=t[5](t[0])+"")&&_(n,l)},d(t){t&&P(e),s=!1,o(a)}}}function Zo(t){let e,n,r;return{c(){e=L("input"),T(e,"class","input selection-title svelte-sgypdx")},m(o,i){C(o,e,i),t[12](e),j(e,t[4]),n||(r=[M(e,"input",t[13]),M(e,"keydown",t[8]),M(e,"blur",t[9])],n=!0)},p(t,n){16&n&&e.value!==t[4]&&j(e,t[4])},d(i){i&&P(e),t[12](null),n=!1,o(r)}}}function Wo(t){let e,n,r,o,i,s,a,l,c,u,d,p,$,v,b,w,y,x;function S(t,e){return t[2]?Zo:Jo}let E=S(t),N=E(t);const O=t[11].default,A=f(O,t,t[10],null);return y=new Xo({props:{isRegion:t[0]}}),{c(){e=L("div"),n=L("div"),r=R(),o=L("div"),i=L("div"),s=L("div"),a=L("i"),l=R(),N.c(),c=I("\n                ("),u=I(t[1]),d=I(")"),p=R(),$=L("button"),v=R(),b=L("section"),A&&A.c(),w=R(),St(y.$$.fragment),T(n,"class","modal-background"),T(a,"class","fa-solid fa-book-bookmark"),T(s,"class","title is-4 mb-0 media-content"),T($,"class","delete media-left"),T($,"aria-label","close"),T(i,"class","modal-card-head media mb-0 is-middle"),T(b,"class","modal-card-body"),T(o,"class","modal-content"),T(e,"id","selection-modal"),T(e,"class","modal fade"),T(e,"tabindex","-1"),T(e,"aria-labelledby","selection-modal-label"),T(e,"aria-hidden","true")},m(t,f){C(t,e,f),k(e,n),k(e,r),k(e,o),k(o,i),k(i,s),k(s,a),k(s,l),N.m(s,null),k(s,c),k(s,u),k(s,d),k(i,p),k(i,$),k(o,v),k(o,b),A&&A.m(b,null),k(o,w),Et(y,o,null),x=!0},p(t,[e]){E===(E=S(t))&&N?N.p(t,e):(N.d(1),N=E(t),N&&(N.c(),N.m(s,c))),(!x||2&e)&&_(u,t[1]),A&&A.p&&(!x||1024&e)&&m(A,O,t,t[10],x?g(O,t[10],e,null):h(t[10]),null);const n={};1&e&&(n.isRegion=t[0]),y.$set(n)},i(t){x||(ht(A,t),ht(y.$$.fragment,t),x=!0)},o(t){$t(A,t),$t(y.$$.fragment,t),x=!1},d(t){t&&P(e),N.d(),A&&A.d(t),Ct(y)}}}function Yo(t,e,n){let r,{$$slots:o={},$$scope:i}=e;const{selectionTitle:s,updateTitle:a,save:l}=ne;d(t,s,(t=>n(5,r=t)));let c,u,{isRegion:f=!1}=e,{selectionLength:p=!1}=e,g=!1;function m(){n(2,g=!1),a(u,f),l(f)}return t.$$set=t=>{"isRegion"in t&&n(0,f=t.isRegion),"selectionLength"in t&&n(1,p=t.selectionLength),"$$scope"in t&&n(10,i=t.$$scope)},[f,p,g,c,u,r,s,function(){n(2,g=!0),n(4,u=r(f)),setTimeout((()=>c&&c.focus()),0)},function(t){"Enter"===t.key&&m()},m,i,o,function(t){tt[t?"unshift":"push"]((()=>{c=t,n(3,c)}))},function(){u=this.value,n(4,u)}]}class Go extends Lt{constructor(t){super(),Nt(this,t,Yo,Wo,s,{isRegion:0,selectionLength:1})}}const Qo=function(){const t=`${window.location.origin}${window.location.pathname}`,e=Mt(1),n=Mt([]),r=Mt([]),o=(async()=>{const e=await fetch(`${t}vectorized-images`).then((t=>t.json())).then((t=>(n.set(t),t))).catch((t=>console.error("Error:",t)));return a(i()),e})(),i=()=>Yt(e,"vp"),s=Vt(e,(t=>(async()=>function(t){const e=49*(t-1),o=e+49,i=u(n).slice(e,o);return r.set(i),i}(t))()));function a(t){Gt(t,e,"vp")}return{currentPage:e,pageLength:49,vectImgs:n,fetchVectorization:o,setPageVectImgs:s,pageVectImgs:r,handlePageUpdate:a}}();function Ko(t){let e,n;return{c(){e=new D(!1),n=A(),e.a=n},m(r,o){e.m(t[2],r,o),C(r,n,o)},p(t,n){4&n&&e.p(t[2])},d(t){t&&P(n),t&&e.d()}}}function ti(t){let e,n,r,i,s,a,c,u,d,f,p=!t[1]&&t[2]&&Ko(t);return{c(){e=L("div"),n=L("figure"),r=L("div"),p&&p.c(),i=R(),s=L("img"),T(r,"class","svg-container svelte-1egync3"),l(s.src,a=t[4])||T(s,"src",a),T(s,"alt","Extracted region"),T(s,"class","svelte-1egync3"),T(n,"class","image card region-image svelte-1egync3"),U(n,"width",t[0]+"px"),U(n,"aspect-ratio",t[3]?t[3].split(" ")[2]/t[3].split(" ")[3]:1),T(e,"class","svg-regions is-center svelte-1egync3")},m(o,a){C(o,e,a),k(e,n),k(n,r),p&&p.m(r,null),k(n,i),k(n,s),u=!0,d||(f=[M(e,"mouseenter",t[6]),M(e,"mouseleave",t[7])],d=!0)},p(t,[e]){!t[1]&&t[2]?p?p.p(t,e):(p=Ko(t),p.c(),p.m(r,null)):p&&(p.d(1),p=null),(!u||1&e)&&U(n,"width",t[0]+"px"),(!u||8&e)&&U(n,"aspect-ratio",t[3]?t[3].split(" ")[2]/t[3].split(" ")[3]:1)},i(t){u||(it((()=>{u&&(c||(c=bt(e,It,{duration:500},!0)),c.run(1))})),u=!0)},o(t){c||(c=bt(e,It,{duration:500},!1)),c.run(0),u=!1},d(t){t&&P(e),p&&p.d(),t&&c&&c.end(),d=!1,o(f)}}}function ei(t,e,n){let{svgPath:r}=e,{width:o=200}=e;const[i,s,a,l]=r.replace(".svg","").split("_"),c=Qt(`${i}_${s}_${a}`,l,`${o},`);let u=!1,d="",f="";Y((async()=>{const t=await fetch(`${Ft}svg/${r}`),e=await t.text(),o=(new DOMParser).parseFromString(e,"image/svg+xml"),i=o.querySelector("svg");n(3,f=i.getAttribute("viewBox")||`0 0 ${i.getAttribute("width")} ${i.getAttribute("height")}`),o.querySelectorAll("image").forEach((t=>t.remove())),i.setAttribute("viewBox",f),i.removeAttribute("width"),i.removeAttribute("height"),n(2,d=(new XMLSerializer).serializeToString(o.documentElement))}));return t.$$set=t=>{"svgPath"in t&&n(5,r=t.svgPath),"width"in t&&n(0,o=t.width)},[o,u,d,f,c,r,()=>n(1,u=!0),()=>n(1,u=!1)]}class ni extends Lt{constructor(t){super(),Nt(this,t,ei,ti,s,{svgPath:5,width:0})}}function ri(e){let n,r,o,i,s,a,l,c="en"===Tt?"Download All":"Tout Télécharger";return{c(){n=L("div"),r=L("button"),o=L("i"),i=R(),s=I(c),T(o,"class","fa-solid fa-download"),T(r,"class","button is-link is-light"),T(n,"class","is-right mb-3")},m(t,c){C(t,n,c),k(n,r),k(r,o),k(r,i),k(r,s),a||(l=M(r,"click",e[0]),a=!0)},p:t,i:t,o:t,d(t){t&&P(n),a=!1,l()}}}function oi(t){const e=`${window.location.origin}${window.location.pathname}`,n=parseInt(e.split("witness/")[1].replace("/","")),r=parseInt(e.split("regions/")[1].replace("/",""));return[async function(){if(!r&&!n)return void console.error("No Region or Witness");const t=r?`${window.location.origin}/${_t}/export-regions-imgs-and-svgs/${r}`:`${window.location.origin}/${_t}/export-all-imgs-and-svgs/${n}`;try{const e=await Zt((()=>fetch(t,{method:"GET",headers:{"X-CSRFToken":Ut,"Content-Type":"application/json"}})));if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);ee(await e.blob(),"vectorizations.zip")}catch(t){console.error("Erreur lors du téléchargement des vectorisations:",t)}}]}class ii extends Lt{constructor(t){super(),Nt(this,t,oi,ri,s,{})}}function si(t,e,n){const r=t.slice();return r[8]=e[n],r}function ai(e){let n;let r=("en"===Tt?ci:li)(e);return{c(){n=L("div"),r.c(),T(n,"class","faded is-center")},m(t,e){C(t,n,e),r.m(n,null)},p(t,e){r.p(t,e)},i:t,o:t,d(t){t&&P(n),r.d()}}}function li(t){let e,n,r=t[11]+"";return{c(){e=I("Erreur lors de la récupération des régions vectorisées : "),n=I(r)},m(t,r){C(t,e,r),C(t,n,r)},p(t,e){2&e&&r!==(r=t[11]+"")&&_(n,r)},d(t){t&&P(e),t&&P(n)}}}function ci(t){let e,n,r=t[11]+"";return{c(){e=I("Error when retrieving vectorized regions: "),n=I(r)},m(t,r){C(t,e,r),C(t,n,r)},p(t,e){2&e&&r!==(r=t[11]+"")&&_(n,r)},d(t){t&&P(e),t&&P(n)}}}function ui(t){let e,n,r=[],o=new Map,i=t[2];const s=t=>t[8].id;for(let e=0;e<i.length;e+=1){let n=si(t,i,e),a=s(n);o.set(a,r[e]=fi(a,n))}let a=null;return i.length||(a=di()),{c(){for(let t=0;t<r.length;t+=1)r[t].c();e=A(),a&&a.c()},m(t,o){for(let e=0;e<r.length;e+=1)r[e]&&r[e].m(t,o);C(t,e,o),a&&a.m(t,o),n=!0},p(t,n){4&n&&(i=t[2],gt(),r=kt(r,n,s,1,t,i,o,e.parentNode,xt,fi,e,si),mt(),!i.length&&a?a.p(t,n):i.length?a&&(a.d(1),a=null):(a=di(),a.c(),a.m(e.parentNode,e)))},i(t){if(!n){for(let t=0;t<i.length;t+=1)ht(r[t]);n=!0}},o(t){for(let t=0;t<r.length;t+=1)$t(r[t]);n=!1},d(t){for(let e=0;e<r.length;e+=1)r[e].d(t);t&&P(e),a&&a.d(t)}}}function di(e){let n,r;return{c(){n=L("div"),n.textContent=""+("en"===Tt?"No vectorization":"Pas de vectorisation"),r=R(),T(n,"class","faded is-center")},m(t,e){C(t,n,e),C(t,r,e)},p:t,d(t){t&&P(n),t&&P(r)}}}function fi(t,e){let n,r,o;return r=new ni({props:{svgPath:e[8]}}),{key:t,first:null,c(){n=A(),St(r.$$.fragment),this.first=n},m(t,e){C(t,n,e),Et(r,t,e),o=!0},p(t,n){e=t;const o={};4&n&&(o.svgPath=e[8]),r.$set(o)},i(t){o||(ht(r.$$.fragment,t),o=!0)},o(t){$t(r.$$.fragment,t),o=!1},d(t){t&&P(n),Ct(r,t)}}}function pi(e){let n;return{c(){n=L("div"),n.textContent=""+("en"===Tt?"Retrieving vectorization page...":"Récupération la page de vectorisation..."),T(n,"class","faded is-center")},m(t,e){C(t,n,e)},p:t,i:t,o:t,d(t){t&&P(n)}}}function gi(t){let e,n,r,o,i,s,a,l,c;e=new ii({}),r=new en({props:{store:Qo,nbOfItems:t[0].length,pageLength:t[6]}});let u={ctx:t,current:null,token:null,hasCatch:!0,pending:pi,then:ui,catch:ai,value:7,error:11,blocks:[,,,]};return wt(s=t[1],u),l=new en({props:{store:Qo,nbOfItems:t[0].length,pageLength:t[6]}}),{c(){St(e.$$.fragment),n=R(),St(r.$$.fragment),o=R(),i=L("div"),u.block.c(),a=R(),St(l.$$.fragment),T(i,"class","grid is-gap-2 mx-5 svelte-1mje9rl")},m(t,s){Et(e,t,s),C(t,n,s),Et(r,t,s),C(t,o,s),C(t,i,s),u.block.m(i,u.anchor=null),u.mount=()=>i,u.anchor=null,C(t,a,s),Et(l,t,s),c=!0},p(e,[n]){t=e;const o={};1&n&&(o.nbOfItems=t[0].length),r.$set(o),u.ctx=t,2&n&&s!==(s=t[1])&&wt(s,u)||yt(u,t,n);const i={};1&n&&(i.nbOfItems=t[0].length),l.$set(i)},i(t){c||(ht(e.$$.fragment,t),ht(r.$$.fragment,t),ht(u.block),ht(l.$$.fragment,t),c=!0)},o(t){$t(e.$$.fragment,t),$t(r.$$.fragment,t);for(let t=0;t<3;t+=1){$t(u.blocks[t])}$t(l.$$.fragment,t),c=!1},d(t){Ct(e,t),t&&P(n),Ct(r,t),t&&P(o),t&&P(i),u.block.d(),u.token=null,u=null,t&&P(a),Ct(l,t)}}}function mi(t,e,n){let r,o,i;const{vectImgs:s,pageVectImgs:a,setPageVectImgs:l,pageLength:c}=Qo;return d(t,s,(t=>n(0,r=t))),d(t,a,(t=>n(2,i=t))),d(t,l,(t=>n(1,o=t))),[r,o,i,s,a,l,c]}class hi extends Lt{constructor(t){super(),Nt(this,t,mi,gi,s,{})}}function $i(e){let n;let r=("en"===Tt?bi:vi)(e);return{c(){n=L("div"),r.c(),T(n,"class","container faded is-center")},m(t,e){C(t,n,e),r.m(n,null)},p(t,e){r.p(t,e)},i:t,o:t,d(t){t&&P(n),r.d()}}}function vi(e){let n,r,o=e[2]+"";return{c(){n=I("Erreur lors de la récupération des régions vectorisées : "),r=I(o)},m(t,e){C(t,n,e),C(t,r,e)},p:t,d(t){t&&P(n),t&&P(r)}}}function bi(e){let n,r,o=e[2]+"";return{c(){n=I("Error when retrieving vectorized regions: "),r=I(o)},m(t,e){C(t,n,e),C(t,r,e)},p:t,d(t){t&&P(n),t&&P(r)}}}function wi(e){let n,r;return n=new hi({}),{c(){St(n.$$.fragment)},m(t,e){Et(n,t,e),r=!0},p:t,i(t){r||(ht(n.$$.fragment,t),r=!0)},o(t){$t(n.$$.fragment,t),r=!1},d(t){Ct(n,t)}}}function yi(e){let n;return{c(){n=L("div"),n.textContent=""+("en"===Tt?"Retrieving vectorized regions...":"Récupération des régions vectorisées..."),T(n,"class","container faded is-center")},m(t,e){C(t,n,e)},p:t,i:t,o:t,d(t){t&&P(n)}}}function xi(t){let e,n,r=qt.includes("vectorization"),o=r&&function(t){let e,n,r={ctx:t,current:null,token:null,hasCatch:!0,pending:yi,then:wi,catch:$i,value:1,error:2,blocks:[,,,]};return wt(t[0],r),{c(){e=A(),r.block.c()},m(t,o){C(t,e,o),r.block.m(t,r.anchor=o),r.mount=()=>e.parentNode,r.anchor=e,n=!0},p(e,n){yt(r,t=e,n)},i(t){n||(ht(r.block),n=!0)},o(t){for(let t=0;t<3;t+=1)$t(r.blocks[t]);n=!1},d(t){t&&P(e),r.block.d(t),r.token=null,r=null}}}(t);return{c(){o&&o.c(),e=A()},m(t,r){o&&o.m(t,r),C(t,e,r),n=!0},p(t,[e]){r&&o.p(t,e)},i(t){n||(ht(o),n=!0)},o(t){$t(o),n=!1},d(t){o&&o.d(t),t&&P(e)}}}function ki(t){const{fetchVectorization:e}=Qo;return[e]}class Si extends Lt{constructor(t){super(),Nt(this,t,ki,xi,s,{})}}function Ei(t,e,n){const r=t.slice();return r[22]=e[n][0],r[23]=e[n][1],r}function Ci(t,e,n){const r=t.slice();return r[27]=e[n],r}function Pi(t,e,n){const r=t.slice();return r[31]=e[n][0],r[23]=e[n][1],r}function Ni(t){let e,n,r,o;return n=new ze({}),{c(){e=L("div"),St(n.$$.fragment),T(e,"class","cell")},m(t,r){C(t,e,r),Et(n,e,null),o=!0},i(t){o||(ht(n.$$.fragment,t),it((()=>{o&&(r||(r=bt(e,It,{duration:500},!0)),r.run(1))})),o=!0)},o(t){$t(n.$$.fragment,t),r||(r=bt(e,It,{duration:500},!1)),r.run(0),o=!1},d(t){t&&P(e),Ct(n),t&&r&&r.end()}}}function Li(t){let e,n,r,i,s,a,l=t[23].text+"";function c(){return t[20](t[31])}return{c(){e=L("li"),n=L("a"),r=I(l),i=R(),T(n,"href",null),q(e,"is-active",t[31]===t[3])},m(t,o){C(t,e,o),k(e,n),k(n,r),k(e,i),s||(a=[M(e,"click",c),M(e,"keyup",Fi)],s=!0)},p(n,o){t=n,4&o[0]&&l!==(l=t[23].text+"")&&_(r,l),12&o[0]&&q(e,"is-active",t[31]===t[3])},d(t){t&&P(e),s=!1,o(a)}}}function Oi(e){let n,r;return n=new Si({}),{c(){St(n.$$.fragment)},m(t,e){Et(n,t,e),r=!0},p:t,i(t){r||(ht(n.$$.fragment,t),r=!0)},o(t){$t(n.$$.fragment,t),r=!1},d(t){Ct(n,t)}}}function Ii(e){let n,r;return n=new So({}),{c(){St(n.$$.fragment)},m(t,e){Et(n,t,e),r=!0},p:t,i(t){r||(ht(n.$$.fragment,t),r=!0)},o(t){$t(n.$$.fragment,t),r=!1},d(t){Ct(n,t)}}}function Ri(e){let n,r;return n=new zo({}),{c(){St(n.$$.fragment)},m(t,e){Et(n,t,e),r=!0},p:t,i(t){r||(ht(n.$$.fragment,t),r=!0)},o(t){$t(n.$$.fragment,t),r=!1},d(t){Ct(n,t)}}}function Ai(t){let e,n,r={ctx:t,current:null,token:null,hasCatch:!0,pending:ji,then:Vi,catch:Mi,value:26,error:30,blocks:[,,,]};return wt(t[9],r),{c(){e=L("div"),r.block.c(),T(e,"class","grid is-gap-2")},m(t,o){C(t,e,o),r.block.m(e,r.anchor=null),r.mount=()=>e,r.anchor=null,n=!0},p(e,n){yt(r,t=e,n)},i(t){n||(ht(r.block),n=!0)},o(t){for(let t=0;t<3;t+=1){$t(r.blocks[t])}n=!1},d(t){t&&P(e),r.block.d(),r.token=null,r=null}}}function Mi(e){let n,r,o,i=e[30]+"";return{c(){n=L("div"),r=I("Error when retrieving regions: "),o=I(i)},m(t,e){C(t,n,e),k(n,r),k(n,o)},p:t,i:t,o:t,d(t){t&&P(n)}}}function Vi(t){let e,n,r=[],o=new Map,i=Object.values(t[6]);const s=t=>t[27].id;for(let e=0;e<i.length;e+=1){let n=Ci(t,i,e),a=s(n);o.set(a,r[e]=_i(a,n))}let a=null;return i.length||(a=Ti(t)),{c(){for(let t=0;t<r.length;t+=1)r[t].c();e=A(),a&&a.c()},m(t,o){for(let e=0;e<r.length;e+=1)r[e]&&r[e].m(t,o);C(t,e,o),a&&a.m(t,o),n=!0},p(t,n){3136&n[0]&&(i=Object.values(t[6]),gt(),r=kt(r,n,s,1,t,i,o,e.parentNode,xt,_i,e,Ci),mt(),!i.length&&a?a.p(t,n):i.length?a&&(gt(),$t(a,1,1,(()=>{a=null})),mt()):(a=Ti(t),a.c(),ht(a,1),a.m(e.parentNode,e)))},i(t){if(!n){for(let t=0;t<i.length;t+=1)ht(r[t]);n=!0}},o(t){for(let t=0;t<r.length;t+=1)$t(r[t]);n=!1},d(t){for(let e=0;e<r.length;e+=1)r[e].d(t);t&&P(e),a&&a.d(t)}}}function Ti(e){let n,r;return n=new ke({props:{currentRegionId:e[11],baseUrl:e[10]}}),{c(){St(n.$$.fragment)},m(t,e){Et(n,t,e),r=!0},p:t,i(t){r||(ht(n.$$.fragment,t),r=!0)},o(t){$t(n.$$.fragment,t),r=!1},d(t){Ct(n,t)}}}function _i(t,e){let n,r,o;return r=new me({props:{item:e[27]}}),{key:t,first:null,c(){n=A(),St(r.$$.fragment),this.first=n},m(t,e){C(t,n,e),Et(r,t,e),o=!0},p(t,n){e=t;const o={};64&n[0]&&(o.item=e[27]),r.$set(o)},i(t){o||(ht(r.$$.fragment,t),o=!0)},o(t){$t(r.$$.fragment,t),o=!1},d(t){t&&P(n),Ct(r,t)}}}function ji(e){let n;return{c(){n=L("div"),n.textContent=""+("en"===Tt?"Retrieving regions...":"Récupération des régions..."),T(n,"class","faded is-center")},m(t,e){C(t,n,e)},p:t,i:t,o:t,d(t){t&&P(n)}}}function Ui(e){let n;return{c(){n=L("div"),n.textContent=""+("en"===Tt?"No regions in selection":"Aucune région sélectionnée")},m(t,e){C(t,n,e)},p:t,d(t){t&&P(n)}}}function qi(t){let e,n,r=Object.entries(t[1]),o=[];for(let e=0;e<r.length;e+=1)o[e]=zi(Ei(t,r,e));return{c(){e=L("div"),n=L("div");for(let t=0;t<o.length;t+=1)o[t].c();T(n,"class","grid is-gap-2"),T(e,"class","fixed-grid has-6-cols")},m(t,r){C(t,e,r),k(e,n);for(let t=0;t<o.length;t+=1)o[t]&&o[t].m(n,null)},p(t,e){if(2&e[0]){let i;for(r=Object.entries(t[1]),i=0;i<r.length;i+=1){const s=Ei(t,r,i);o[i]?o[i].p(s,e):(o[i]=zi(s),o[i].c(),o[i].m(n,null))}for(;i<o.length;i+=1)o[i].d(1);o.length=r.length}},d(t){t&&P(e),N(o,t)}}}function zi(t){let e,n,r,o,i,s,a,c,u,d,f,p,g,m=t[23].title+"";function h(){return t[21](t[22])}return{c(){e=L("div"),n=L("figure"),r=L("img"),i=R(),s=L("div"),a=L("span"),c=I(m),u=R(),d=L("button"),f=R(),l(r.src,o=Qt(t[23].img,t[23].xyhw,"96,"))||T(r,"src",o),T(r,"alt","Extracted region"),T(a,"class","overlay-desc"),T(s,"class","overlay is-center svelte-403wty"),T(n,"class","image is-64x64 card"),T(d,"class","delete region-btn"),T(d,"aria-label","remove from selection"),T(e,"class","selection cell svelte-403wty")},m(t,o){C(t,e,o),k(e,n),k(n,r),k(n,i),k(n,s),k(s,a),k(a,c),k(e,u),k(e,d),k(e,f),p||(g=M(d,"click",h),p=!0)},p(e,n){t=e,2&n[0]&&!l(r.src,o=Qt(t[23].img,t[23].xyhw,"96,"))&&T(r,"src",o),2&n[0]&&m!==(m=t[23].title+"")&&_(c,m)},d(t){t&&P(e),p=!1,g()}}}function Di(t){let e;function n(t,e){return t[4]?qi:Ui}let r=n(t),o=r(t);return{c(){o.c(),e=A()},m(t,n){o.m(t,n),C(t,e,n)},p(t,i){r===(r=n(t))&&o?o.p(t,i):(o.d(1),o=r(t),o&&(o.c(),o.m(e.parentNode,e)))},d(t){o.d(t),t&&P(e)}}}function Hi(t){let e,n,r,o,i,s,a,l,c,u,d,f,p,g,m,h,$,v,b,w,y=["all","page"].includes(t[3]);e=new ae({props:{visible:t[5]}}),r=new we({}),i=new ve({props:{selectionLength:t[0]}}),u=new Re({props:{baseUrl:t[10],currentRegionId:t[11],currentLayout:t[3]}});let x=y&&Ni(),S=Object.entries(t[2]),E=[];for(let e=0;e<S.length;e+=1)E[e]=Li(Pi(t,S,e));const O=[Ai,Ri,Ii,Oi],I=[];function A(t,e){return"all"===t[3]?0:"page"===t[3]?1:"similarity"===t[3]?2:"vectorization"===t[3]?3:-1}return~(h=A(t))&&($=I[h]=O[h](t)),b=new Go({props:{isRegion:!0,selectionLength:t[0],$$slots:{default:[Di]},$$scope:{ctx:t}}}),{c(){St(e.$$.fragment),n=R(),St(r.$$.fragment),o=R(),St(i.$$.fragment),s=R(),a=L("div"),l=L("div"),c=L("div"),St(u.$$.fragment),d=R(),x&&x.c(),f=R(),p=L("div"),g=L("ul");for(let t=0;t<E.length;t+=1)E[t].c();m=R(),$&&$.c(),v=R(),St(b.$$.fragment),T(c,"class","cell is-left is-middle"),T(l,"class","actions grid"),T(g,"class","panel-tabs"),T(p,"class","tabs is-centered"),T(a,"id","nav-actions"),T(a,"class","mb-5 svelte-403wty")},m(t,$){Et(e,t,$),C(t,n,$),Et(r,t,$),C(t,o,$),Et(i,t,$),C(t,s,$),C(t,a,$),k(a,l),k(l,c),Et(u,c,null),k(l,d),x&&x.m(l,null),k(a,f),k(a,p),k(p,g);for(let t=0;t<E.length;t+=1)E[t]&&E[t].m(g,null);C(t,m,$),~h&&I[h].m(t,$),C(t,v,$),Et(b,t,$),w=!0},p(t,n){const r={};32&n[0]&&(r.visible=t[5]),e.$set(r);const o={};1&n[0]&&(o.selectionLength=t[0]),i.$set(o);const s={};if(8&n[0]&&(s.currentLayout=t[3]),u.$set(s),8&n[0]&&(y=["all","page"].includes(t[3])),y?x?8&n[0]&&ht(x,1):(x=Ni(),x.c(),ht(x,1),x.m(l,null)):x&&(gt(),$t(x,1,1,(()=>{x=null})),mt()),4108&n[0]){let e;for(S=Object.entries(t[2]),e=0;e<S.length;e+=1){const r=Pi(t,S,e);E[e]?E[e].p(r,n):(E[e]=Li(r),E[e].c(),E[e].m(g,null))}for(;e<E.length;e+=1)E[e].d(1);E.length=S.length}let a=h;h=A(t),h===a?~h&&I[h].p(t,n):($&&(gt(),$t(I[a],1,1,(()=>{I[a]=null})),mt()),~h?($=I[h],$?$.p(t,n):($=I[h]=O[h](t),$.c()),ht($,1),$.m(v.parentNode,v)):$=null);const c={};1&n[0]&&(c.selectionLength=t[0]),18&n[0]|8&n[1]&&(c.$$scope={dirty:n,ctx:t}),b.$set(c)},i(t){w||(ht(e.$$.fragment,t),ht(r.$$.fragment,t),ht(i.$$.fragment,t),ht(u.$$.fragment,t),ht(x),ht($),ht(b.$$.fragment,t),w=!0)},o(t){$t(e.$$.fragment,t),$t(r.$$.fragment,t),$t(i.$$.fragment,t),$t(u.$$.fragment,t),$t(x),$t($),$t(b.$$.fragment,t),w=!1},d(t){Ct(e,t),t&&P(n),Ct(r,t),t&&P(o),Ct(i,t),t&&P(s),t&&P(a),Ct(u),x&&x.d(),N(E,t),t&&P(m),~h&&I[h].d(t),t&&P(v),Ct(b,t)}}}const Fi=()=>null;function Bi(t,e,n){let r,o,i,s,a,l,c;d(t,Xt,(t=>n(5,l=t)));const{selected:u}=ne;d(t,u,(t=>n(19,a=t)));const{allRegions:f,fetchAll:p}=re;d(t,f,(t=>n(6,c=t)));let{manifest:g=""}=e,{isValidated:m=!1}=e,{imgPrefix:h=""}=e,{nbOfPages:$=1}=e,{trailingZeros:v=1}=e,{witness:b={}}=e;G("witness",b),G("nbOfPages",$),G("trailingZeros",v),G("imgPrefix",h),G("manifest",g),G("isValidated",m);const w=`${window.location.origin}${window.location.pathname}`,y=parseInt(w.split("regions/")[1].replace("/","")),x={all:{text:"en"===Tt?"All regions":"Toutes les régions"},page:{text:"en"===Tt?"Per page":"Par page"}};function k(t){n(3,s=t);const e=new URL(window.location);e.searchParams.set("tab",t),window.history.pushState({},"",e)}qt.includes("similarity")&&(x.similarity={text:"en"===Tt?"Similarity":"Similarité"}),qt.includes("vectorization")&&(x.vectorization={text:"en"===Tt?"Vectorization":"Vectorisation"});return t.$$set=t=>{"manifest"in t&&n(13,g=t.manifest),"isValidated"in t&&n(14,m=t.isValidated),"imgPrefix"in t&&n(15,h=t.imgPrefix),"nbOfPages"in t&&n(16,$=t.nbOfPages),"trailingZeros"in t&&n(17,v=t.trailingZeros),"witness"in t&&n(18,b=t.witness)},t.$$.update=()=>{524288&t.$$.dirty[0]&&n(1,r=a(!0)),2&t.$$.dirty[0]&&n(0,o=Object.keys(r).length),1&t.$$.dirty[0]&&n(4,i=o>0)},n(3,s=new URLSearchParams(window.location.search).get("tab")??"all"),[o,r,x,s,i,l,c,u,f,p,w,y,k,g,m,h,$,v,b,a,t=>k(t),t=>ne.remove(t,zt)]}return new class extends Lt{constructor(t){super(),Nt(this,t,Bi,Hi,s,{manifest:13,isValidated:14,imgPrefix:15,nbOfPages:16,trailingZeros:17,witness:18},null,[-1,-1])}}({target:document.getElementById("region-list"),props:{witness:witness,manifest:manifest,isValidated:isValidated,imgPrefix:imgPrefix,nbOfPages:nbOfPages,trailingZeros:trailingZeros}})}();
//# sourceMappingURL=regionList.js.map
