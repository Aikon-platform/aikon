var regionList=function(e,t,n){"use strict";function r(){}const s=e=>e;function o(e){return e()}function i(){return Object.create(null)}function l(e){e.forEach(o)}function c(e){return"function"==typeof e}function a(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}let u;function d(e,t){return u||(u=document.createElement("a")),u.href=t,e===u.href}function p(e,...t){if(null==e)return r;const n=e.subscribe(...t);return n.unsubscribe?()=>n.unsubscribe():n}function g(e){let t;return p(e,(e=>t=e))(),t}function m(e,t,n){e.$$.on_destroy.push(p(t,n))}function f(e,t,n,r){if(e){const s=h(e,t,n,r);return e[0](s)}}function h(e,t,n,r){return e[1]&&r?function(e,t){for(const n in t)e[n]=t[n];return e}(n.ctx.slice(),e[1](r(t))):n.ctx}function $(e,t,n,r){if(e[2]&&r){const s=e[2](r(n));if(void 0===t.dirty)return s;if("object"==typeof s){const e=[],n=Math.max(t.dirty.length,s.length);for(let r=0;r<n;r+=1)e[r]=t.dirty[r]|s[r];return e}return t.dirty|s}return t.dirty}function v(e,t,n,r,s,o){if(s){const i=h(t,n,r,o);e.p(i,s)}}function w(e){if(e.ctx.length>32){const t=[],n=e.ctx.length/32;for(let e=0;e<n;e++)t[e]=-1;return t}return-1}const b="undefined"!=typeof window;let y=b?()=>window.performance.now():()=>Date.now(),x=b?e=>requestAnimationFrame(e):r;const k=new Set;function I(e){k.forEach((t=>{t.c(e)||(k.delete(t),t.f())})),0!==k.size&&x(I)}const C="undefined"!=typeof window?window:"undefined"!=typeof globalThis?globalThis:global;function S(e,t){e.appendChild(t)}function E(e){if(!e)return document;const t=e.getRootNode?e.getRootNode():e.ownerDocument;return t&&t.host?t:e.ownerDocument}function R(e){const t=L("style");return function(e,t){S(e.head||e,t),t.sheet}(E(e),t),t.sheet}function T(e,t,n){e.insertBefore(t,n||null)}function P(e){e.parentNode&&e.parentNode.removeChild(e)}function O(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function L(e){return document.createElement(e)}function N(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function j(e){return document.createTextNode(e)}function _(){return j(" ")}function M(){return j("")}function A(e,t,n,r){return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n,r)}function q(e){return function(t){return t.preventDefault(),e.call(this,t)}}function U(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function D(e,t){t=""+t,e.data!==t&&(e.data=t)}function V(e,t){e.value=null==t?"":t}function F(e,t,n,r){null==n?e.style.removeProperty(t):e.style.setProperty(t,n,r?"important":"")}function z(e,t,n){e.classList[n?"add":"remove"](t)}function B(e,t,{bubbles:n=!1,cancelable:r=!1}={}){const s=document.createEvent("CustomEvent");return s.initCustomEvent(e,n,r,t),s}class H{constructor(e=!1){this.is_svg=!1,this.is_svg=e,this.e=this.n=null}c(e){this.h(e)}m(e,t,n=null){this.e||(this.is_svg?this.e=N(t.nodeName):this.e=L(11===t.nodeType?"TEMPLATE":t.nodeName),this.t="TEMPLATE"!==t.tagName?t:t.content,this.c(e)),this.i(n)}h(e){this.e.innerHTML=e,this.n=Array.from("TEMPLATE"===this.e.nodeName?this.e.content.childNodes:this.e.childNodes)}i(e){for(let t=0;t<this.n.length;t+=1)T(this.t,this.n[t],e)}p(e){this.d(),this.h(e),this.i(this.a)}d(){this.n.forEach(P)}}const J=new Map;let X,Z=0;function W(e,t,n,r,s,o,i,l=0){const c=16.666/r;let a="{\n";for(let e=0;e<=1;e+=c){const r=t+(n-t)*o(e);a+=100*e+`%{${i(r,1-r)}}\n`}const u=a+`100% {${i(n,1-n)}}\n}`,d=`__svelte_${function(e){let t=5381,n=e.length;for(;n--;)t=(t<<5)-t^e.charCodeAt(n);return t>>>0}(u)}_${l}`,p=E(e),{stylesheet:g,rules:m}=J.get(p)||function(e,t){const n={stylesheet:R(t),rules:{}};return J.set(e,n),n}(p,e);m[d]||(m[d]=!0,g.insertRule(`@keyframes ${d} ${u}`,g.cssRules.length));const f=e.style.animation||"";return e.style.animation=`${f?`${f}, `:""}${d} ${r}ms linear ${s}ms 1 both`,Z+=1,d}function G(e,t){const n=(e.style.animation||"").split(", "),r=n.filter(t?e=>e.indexOf(t)<0:e=>-1===e.indexOf("__svelte")),s=n.length-r.length;s&&(e.style.animation=r.join(", "),Z-=s,Z||x((()=>{Z||(J.forEach((e=>{const{ownerNode:t}=e.stylesheet;t&&P(t)})),J.clear())})))}function Q(e){X=e}function K(){if(!X)throw new Error("Function called outside component initialization");return X}function Y(e){K().$$.on_mount.push(e)}function ee(e){K().$$.on_destroy.push(e)}function te(){const e=K();return(t,n,{cancelable:r=!1}={})=>{const s=e.$$.callbacks[t];if(s){const o=B(t,n,{cancelable:r});return s.slice().forEach((t=>{t.call(e,o)})),!o.defaultPrevented}return!0}}function ne(e,t){return K().$$.context.set(e,t),t}function re(e){return K().$$.context.get(e)}const se=[],oe=[];let ie=[];const le=[],ce=Promise.resolve();let ae=!1;function ue(e){ie.push(e)}const de=new Set;let pe,ge=0;function me(){if(0!==ge)return;const e=X;do{try{for(;ge<se.length;){const e=se[ge];ge++,Q(e),fe(e.$$)}}catch(e){throw se.length=0,ge=0,e}for(Q(null),se.length=0,ge=0;oe.length;)oe.pop()();for(let e=0;e<ie.length;e+=1){const t=ie[e];de.has(t)||(de.add(t),t())}ie.length=0}while(se.length);for(;le.length;)le.pop()();ae=!1,de.clear(),Q(e)}function fe(e){if(null!==e.fragment){e.update(),l(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(ue)}}function he(e,t,n){e.dispatchEvent(B(`${t?"intro":"outro"}${n}`))}const $e=new Set;let ve;function we(){ve={r:0,c:[],p:ve}}function be(){ve.r||l(ve.c),ve=ve.p}function ye(e,t){e&&e.i&&($e.delete(e),e.i(t))}function xe(e,t,n,r){if(e&&e.o){if($e.has(e))return;$e.add(e),ve.c.push((()=>{$e.delete(e),r&&(n&&e.d(1),r())})),e.o(t)}else r&&r()}const ke={duration:0};function Ie(e,t,n,o){const i={direction:"both"};let a=t(e,n,i),u=o?0:1,d=null,p=null,g=null;function m(){g&&G(e,g)}function f(e,t){const n=e.b-u;return t*=Math.abs(n),{a:u,b:e.b,d:n,duration:t,start:e.start,end:e.start+t,group:e.group}}function h(t){const{delay:n=0,duration:o=300,easing:i=s,tick:c=r,css:h}=a||ke,$={start:y()+n,b:t};t||($.group=ve,ve.r+=1),d||p?p=$:(h&&(m(),g=W(e,u,t,o,n,i,h)),t&&c(0,1),d=f($,o),ue((()=>he(e,t,"start"))),function(e){let t;0===k.size&&x(I),new Promise((n=>{k.add(t={c:e,f:n})}))}((t=>{if(p&&t>p.start&&(d=f(p,o),p=null,he(e,d.b,"start"),h&&(m(),g=W(e,u,d.b,d.duration,0,i,a.css))),d)if(t>=d.end)c(u=d.b,1-u),he(e,d.b,"end"),p||(d.b?m():--d.group.r||l(d.group.c)),d=null;else if(t>=d.start){const e=t-d.start;u=d.a+d.d*i(e/d.duration),c(u,1-u)}return!(!d&&!p)})))}return{run(e){c(a)?(pe||(pe=Promise.resolve(),pe.then((()=>{pe=null}))),pe).then((()=>{a=a(i),h(e)})):h(e)},end(){m(),d=p=null}}}function Ce(e,t){const n=t.token={};function r(e,r,s,o){if(t.token!==n)return;t.resolved=o;let i=t.ctx;void 0!==s&&(i=i.slice(),i[s]=o);const l=e&&(t.current=e)(i);let c=!1;t.block&&(t.blocks?t.blocks.forEach(((e,n)=>{n!==r&&e&&(we(),xe(e,1,1,(()=>{t.blocks[n]===e&&(t.blocks[n]=null)})),be())})):t.block.d(1),l.c(),ye(l,1),l.m(t.mount(),t.anchor),c=!0),t.block=l,t.blocks&&(t.blocks[r]=l),c&&me()}if(!(s=e)||"object"!=typeof s&&"function"!=typeof s||"function"!=typeof s.then){if(t.current!==t.then)return r(t.then,1,t.value,e),!0;t.resolved=e}else{const n=K();if(e.then((e=>{Q(n),r(t.then,1,t.value,e),Q(null)}),(e=>{if(Q(n),r(t.catch,2,t.error,e),Q(null),!t.hasCatch)throw e})),t.current!==t.pending)return r(t.pending,0),!0}var s}function Se(e,t,n){const r=t.slice(),{resolved:s}=e;e.current===e.then&&(r[e.value]=s),e.current===e.catch&&(r[e.error]=s),e.block.p(r,n)}function Ee(e,t){xe(e,1,1,(()=>{t.delete(e.key)}))}function Re(e,t,n,r,s,o,i,c,a,u,d,p){let g=e.length,m=o.length,f=g;const h={};for(;f--;)h[e[f].key]=f;const $=[],v=new Map,w=new Map,b=[];for(f=m;f--;){const e=p(s,o,f),l=n(e);let c=i.get(l);c?r&&b.push((()=>c.p(e,t))):(c=u(l,e),c.c()),v.set(l,$[f]=c),l in h&&w.set(l,Math.abs(f-h[l]))}const y=new Set,x=new Set;function k(e){ye(e,1),e.m(c,d),i.set(e.key,e),d=e.first,m--}for(;g&&m;){const t=$[m-1],n=e[g-1],r=t.key,s=n.key;t===n?(d=t.first,g--,m--):v.has(s)?!i.has(r)||y.has(r)?k(t):x.has(s)?g--:w.get(r)>w.get(s)?(x.add(r),k(t)):(y.add(s),g--):(a(n,i),g--)}for(;g--;){const t=e[g];v.has(t.key)||a(t,i)}for(;m;)k($[m-1]);return l(b),$}function Te(e){e&&e.c()}function Pe(e,t,n,r){const{fragment:s,after_update:i}=e.$$;s&&s.m(t,n),r||ue((()=>{const t=e.$$.on_mount.map(o).filter(c);e.$$.on_destroy?e.$$.on_destroy.push(...t):l(t),e.$$.on_mount=[]})),i.forEach(ue)}function Oe(e,t){const n=e.$$;null!==n.fragment&&(!function(e){const t=[],n=[];ie.forEach((r=>-1===e.indexOf(r)?t.push(r):n.push(r))),n.forEach((e=>e())),ie=t}(n.after_update),l(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function Le(e,t){-1===e.$$.dirty[0]&&(se.push(e),ae||(ae=!0,ce.then(me)),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function Ne(e,t,n,s,o,c,a,u=[-1]){const d=X;Q(e);const p=e.$$={fragment:null,ctx:[],props:c,update:r,not_equal:o,bound:i(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(d?d.$$.context:[])),callbacks:i(),dirty:u,skip_bound:!1,root:t.target||d.$$.root};a&&a(p.root);let g=!1;if(p.ctx=n?n(e,t.props||{},((t,n,...r)=>{const s=r.length?r[0]:n;return p.ctx&&o(p.ctx[t],p.ctx[t]=s)&&(!p.skip_bound&&p.bound[t]&&p.bound[t](s),g&&Le(e,t)),n})):[],p.update(),g=!0,l(p.before_update),p.fragment=!!s&&s(p.ctx),t.target){if(t.hydrate){const e=function(e){return Array.from(e.childNodes)}(t.target);p.fragment&&p.fragment.l(e),e.forEach(P)}else p.fragment&&p.fragment.c();t.intro&&ye(e.$$.fragment),Pe(e,t.target,t.anchor,t.customElement),me()}Q(d)}class je{$destroy(){Oe(this,1),this.$destroy=r}$on(e,t){if(!c(t))return r;const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(e){var t;this.$$set&&(t=e,0!==Object.keys(t).length)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}function _e(e){const t=e-1;return t*t*t+1}function Me(e,{delay:t=0,duration:n=400,easing:r=s}={}){const o=+getComputedStyle(e).opacity;return{delay:t,duration:n,easing:r,css:e=>"opacity: "+e*o}}function Ae(e,{delay:t=0,duration:n=400,easing:r=_e,axis:s="y"}={}){const o=getComputedStyle(e),i=+o.opacity,l="y"===s?"height":"width",c=parseFloat(o[l]),a="y"===s?["top","bottom"]:["left","right"],u=a.map((e=>`${e[0].toUpperCase()}${e.slice(1)}`)),d=parseFloat(o[`padding${u[0]}`]),p=parseFloat(o[`padding${u[1]}`]),g=parseFloat(o[`margin${u[0]}`]),m=parseFloat(o[`margin${u[1]}`]),f=parseFloat(o[`border${u[0]}Width`]),h=parseFloat(o[`border${u[1]}Width`]);return{delay:t,duration:n,easing:r,css:e=>`overflow: hidden;opacity: ${Math.min(20*e,1)*i};${l}: ${e*c}px;padding-${a[0]}: ${e*d}px;padding-${a[1]}: ${e*p}px;margin-${a[0]}: ${e*g}px;margin-${a[1]}: ${e*m}px;border-${a[0]}-width: ${e*f}px;border-${a[1]}-width: ${e*h}px;`}}const qe=[];function Ue(e,t=r){let n;const s=new Set;function o(t){if(a(e,t)&&(e=t,n)){const t=!qe.length;for(const t of s)t[1](),qe.push(t,e);if(t){for(let e=0;e<qe.length;e+=2)qe[e][0](qe[e+1]);qe.length=0}}}return{set:o,update:function(t){o(t(e))},subscribe:function(i,l=r){const c=[i,l];return s.add(c),1===s.size&&(n=t(o)||r),i(e),()=>{s.delete(c),0===s.size&&n&&(n(),n=null)}}}}function De(e,t,n){const s=!Array.isArray(e),o=s?[e]:e,i=t.length<2;return a=e=>{let n=!1;const a=[];let u=0,d=r;const g=()=>{if(u)return;d();const n=t(s?a[0]:a,e);i?e(n):d=c(n)?n:r},m=o.map(((e,t)=>p(e,(e=>{a[t]=e,u&=~(1<<t),n&&g()}),(()=>{u|=1<<t}))));return n=!0,g(),function(){l(m),d(),n=!1}},{subscribe:Ue(n,a).subscribe};var a}const Ve=APP_LANG,Fe=APP_NAME;WEBAPP_NAME;const ze=USER_ID;IS_SUPERUSER,ADD_PERMISSION;const Be=CSRF_TOKEN,He=ADDITIONAL_MODULES,Je="Region",Xe=SAS_APP_URL,Ze=CANTALOUPE_APP_URL,We=MEDIA_PATH,Ge=PAGE_LEN,Qe=Ue(!1),Ke=Ue("");async function Ye(e){Qe.set(!0);try{return await e()}finally{Qe.set(!1)}}function et(e,t=100){const n=Math.floor(.75*t);return e.length>t?e.slice(0,n)+"..."+e.slice(-t+n):e}function tt(e,t){if("undefined"!=typeof window){const n=parseInt(new URLSearchParams(window.location.search).get(t));if(!isNaN(n))return e.set(n),n}return e.set(1),1}function nt(e,t,n){if(t.set(e),"undefined"!=typeof window){const t=new URL(window.location.href);t.searchParams.set(n,e),window.history.pushState({},"",t)}}function rt(e=null,t="full",n="full"){if(!e)return"https://placehold.co/96x96/png?text=No+image";if((e=e.split("_")).length<3)return"https://placehold.co/96x96/png?text=No+image";const r=e[e.length-1].includes(",")?e.pop().replace(".jpg",""):t,s=e.join("_").replace(".jpg","");return`${Ze??"http://localhost:8182"}/iiif/2/${s}.jpg/${r}/${n}/0/default.jpg`}function st(e=null,t=1){return`${Xe??"http://localhost:3000"}/index.html?iiif-content=${e}&canvas=${t}`}function ot(e,t=null,n=!1){return new Promise((r=>{if(document.getElementById("msg-modal")){n?document.getElementById("modal-footer").hidden=!1:r(void 0),t&&(document.getElementById("modal-title").innerHTML=t),document.getElementById("modal-body").innerHTML=e,document.getElementById("hidden-msg-btn").click();const s=document.getElementById("cancel-btn"),o=document.getElementById("ok-btn"),i=document.getElementById("modal-bkg"),l=()=>{s.removeEventListener("click",c),i.removeEventListener("click",c),o.removeEventListener("click",a),document.getElementById("modal-footer").hidden=!0},c=()=>{l(),r(!1)},a=()=>{l(),r(!0)};s.addEventListener("click",c),o.addEventListener("click",a)}else n?r(window.confirm(e)):(window.alert(e),r(void 0))}))}function it(e,t){const n=window.URL.createObjectURL(e),r=document.createElement("a");r.href=n,r.download=`${t}`,document.body.appendChild(r),r.click(),window.URL.revokeObjectURL(n),document.body.removeChild(r)}function lt(){let e,t,n=(e,t)=>e===t;return{set:n=>{t=e,e=n},setCompareFn:e=>n=e,get:()=>e,getNewAndOld:()=>[e,t],same:()=>n(e,t)}}const ct=(e,t)=>Array.isArray(e)&&Array.isArray(t)&&e.length===t.length&&e.every(((e,n)=>e===t[n]||void 0));const at=function(){const e={id:null,type:"documentSet",title:"en"===Ve?"Document set":"Set de documents",selected:{}},t={id:null,type:"regionsSet",title:"en"===Ve?"Regions set":"Set de régions",selected:{}},n=Ue({records:JSON.parse(localStorage.getItem("documentSet"))||e,regions:JSON.parse(localStorage.getItem("regionsSet"))||t}),{subscribe:r,update:s,get:o}=n,i=Ue(!1);function l(e,t=!1){i.set(t),localStorage.setItem(e.type,JSON.stringify(e))}function c(e,t){return e[t?"regions":"records"]?.selected||{}}function a(e,t=!0){const n=c(e,t);return t?n[Je]??{}:Object.entries(n)}function u(e,t,n){const r=n===Je?"regions":"records",s=e[r],{[t]:o,...i}=s.selected[n];return e[r]={...s,selected:{...s.selected,[n]:i}},l(e[r]),e}function d(e,t,n=!0){const r=t.class===Je?"regions":"records",s=e[r],o=s.selected,i=t.class===Je?t:{title:t.title,url:t.url};return e[r]={...s,selected:{...o,[t.class]:{...o[t.class]||{},[t.id]:i}}},n&&l(e[r]),e}function p(e,t){return e[t.class.toLowerCase().includes("regions")?"regions":"records"].id===t.id}return{subscribe:r,save:e=>s((t=>function(e,t){const n=t?"regions-set":"document-set";if(t)return window.alert("Region set management is not yet implemented"),e;let r=e[t?"regions":"records"],o={};Object.entries(r.selected).forEach((([e,t])=>{o[e]=Object.keys(t)}));const c=null!==r.id?`${r.id}/change`:"add";return fetch(`${window.location.origin}/${Fe}/${n}/${c}`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":Be},body:JSON.stringify({title:r.title,selection:r,...o})}).then((e=>e.json())).then((n=>{if(!n?.document_set_id)throw new Error("Failed to save selection");s((e=>{const r=e[t?"regions":"records"];return r.id=n.document_set_id,r.title=n.document_set_title,i.set(!0),e})),l(e[t?"regions":"records"],!0)})).catch((e=>console.error("Error:",e))),e}(t,e))),empty:n=>s((r=>(r[n?"regions":"records"]=n?t:e,l(r[n?"regions":"records"]),r))),removeAll:(e,t)=>s((n=>function(e,t,n){const r=n===Je?"regions":"records",s=e[r];let o=s.selected[n];return o&&Object.keys(o).length?(t.forEach((e=>{delete o[e]})),e[r]={...s,selected:{...s.selected,[n]:o}},l(e[r]),e):e}(n,e,t))),remove:(e,t)=>s((n=>u(n,e,t))),addAll:e=>s((t=>function(e,t){const n=t[0].type===Je;return t.forEach((t=>{e=d(e,t,!1)})),l(e[n?"regions":"records"]),e}(t,e))),add:e=>s((t=>d(t,e))),toggle:e=>s((t=>{const n=c(t,e.class===Je);return n[e.class]?.[e.id]?u(t,e.id,e.class):d(t,e)})),updateTitle:(e,t)=>s((n=>{const r=t?"regions":"records";return n[r]={...n[r],title:e},l(n[r],!0),n})),isSaved:i,isSelected:De(n,(e=>t=>c(e,t.class===Je)[t.class]?.hasOwnProperty(t.id)||!1)),isSetSelected:De(n,(e=>t=>p(e,t))),selected:De(n,(e=>t=>a(e,t))),nbSelected:De(n,(e=>t=>{const n=a(e,t);return t?Object.keys(n).length:n.reduce(((e,[t,n])=>e+Object.keys(n).length),0)})),selectionTitle:De(n,(e=>t=>e[t?"regions":"records"].title)),selection:De(n,(e=>t=>e[t?"regions":"records"])),toggleSet:n=>s((r=>p(r,n)?function(n,r){const s=r.class.toLowerCase().includes("regions");return n[s?"regions":"records"]=s?t:e,l(n[s?"regions":"records"]),n}(r,n):function(e,t){const n=t.class.toLowerCase().includes("regions")?"regions":"records";return null===t.selection.id&&(t.selection.id=t.id),e[n]=t.selection,l(e[n]),e}(r,n)))}}();const ut=function(){const e=`${window.location.origin}${window.location.pathname}`,t=Ue(1),n=Ue({}),r=Ue({}),s=Ue("");tt(t,"p");const o=(async()=>{const t=await fetch(`${e}canvas`),r=await t.json();let s={};return Object.values(r).forEach((e=>{Object.entries(e).forEach((([e,t])=>{s[e]=t}))})),n.set(s),r})(),i=De(t,(t=>(async()=>{const n=await fetch(`${e}canvas?p=${t}`),s=await n.json();return r.set(s),s})()));return{currentPage:t,pageRegions:r,allRegions:n,fetchPages:i,fetchAll:o,handlePageUpdate:function(e){nt(e,t,"p")},remove:function(e){n.update((t=>(delete t[e],{...t}))),r.update((t=>{for(const n in t)if(t[n][e]){const{[e]:r,...s}=t[n];return t[n]=s,t}return t}))},clipBoard:s,copyRef:function(e){s.update((t=>{const n=t===e?"":e;return navigator.clipboard.writeText(n).then((e=>"")),n}))}}}();function dt(e){let t,n,r;return{c(){t=L("div"),t.innerHTML='<div class="loader svelte-vizlcg"></div>',U(t,"class","bkg-shade svelte-vizlcg")},m(e,n){T(e,t,n),r=!0},i(e){r||(ue((()=>{r&&(n||(n=Ie(t,Me,{duration:150},!0)),n.run(1))})),r=!0)},o(e){n||(n=Ie(t,Me,{duration:150},!1)),n.run(0),r=!1},d(e){e&&P(t),e&&n&&n.end()}}}function pt(e){let t,n,r=e[0]&&dt();return{c(){r&&r.c(),t=M()},m(e,s){r&&r.m(e,s),T(e,t,s),n=!0},p(e,[n]){e[0]?r?1&n&&ye(r,1):(r=dt(),r.c(),ye(r,1),r.m(t.parentNode,t)):r&&(we(),xe(r,1,1,(()=>{r=null})),be())},i(e){n||(ye(r),n=!0)},o(e){xe(r),n=!1},d(e){r&&r.d(e),e&&P(t)}}}function gt(e,t,n){let{visible:r=!1}=t;return e.$$set=e=>{"visible"in e&&n(0,r=e.visible)},[r]}class mt extends je{constructor(e){super(),Ne(this,e,gt,pt,a,{visible:0})}}function ft(e){let t;return{c(){t=N("path"),U(t,"d","M384 336H192c-8.8 0-16-7.2-16-16V64c0-8.8 7.2-16 16-16l140.1 0L400 115.9V320c0 8.8-7.2 16-16 16zM192 384H384c35.3 0 64-28.7 64-64V115.9c0-12.7-5.1-24.9-14.1-33.9L366.1 14.1c-9-9-21.2-14.1-33.9-14.1H192c-35.3 0-64 28.7-64 64V320c0 35.3 28.7 64 64 64zM64 128c-35.3 0-64 28.7-64 64V448c0 35.3 28.7 64 64 64H256c35.3 0 64-28.7 64-64V416H272v32c0 8.8-7.2 16-16 16H64c-8.8 0-16-7.2-16-16V192c0-8.8 7.2-16 16-16H96V128H64z"),U(t,"class","svelte-rtaaid")},m(e,n){T(e,t,n)},d(e){e&&P(t)}}}function ht(e){let t;return{c(){t=N("path"),U(t,"d","M208 0H332.1c12.7 0 24.9 5.1 33.9 14.1l67.9 67.9c9 9 14.1 21.2 14.1 33.9V336c0 26.5-21.5 48-48 48H208c-26.5 0-48-21.5-48-48V48c0-26.5 21.5-48 48-48zM48 128h80v64H64V448H256V416h64v48c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V176c0-26.5 21.5-48 48-48z"),U(t,"class","svelte-rtaaid")},m(e,n){T(e,t,n)},d(e){e&&P(t)}}}function $t(e){let t,n="en"===Ve?"Copy ID":"Copier l'ID";return{c(){t=j(n)},m(e,n){T(e,t,n)},p:r,d(e){e&&P(t)}}}function vt(e){let t,n="en"===Ve?"Copied!":"Copié !";return{c(){t=j(n)},m(e,n){T(e,t,n)},p:r,d(e){e&&P(t)}}}function wt(e){let t,n,r,s,o,i,c,a,u,p,g,m,f,h,$,v,w,b;function y(e,t){return e[4]?ht:ft}let x=y(e),k=x(e);function I(e,t){return e[4]?vt:$t}let C=I(e),E=C(e);return{c(){t=L("div"),n=L("figure"),r=L("img"),o=_(),i=L("div"),c=L("span"),u=_(),p=L("button"),g=N("svg"),k.c(),m=_(),f=L("span"),E.c(),U(r,"class","region-img svelte-rtaaid"),d(r.src,s=rt(e[0].img,e[0].xyhw,e[1]?"96,":`,${e[2]}`))||U(r,"src",s),U(r,"alt","Extracted region"),U(c,"class","overlay-desc"),U(i,"class","overlay is-center svelte-rtaaid"),U(n,"class",a="image card region-image "+(e[1]?"is-96x96":"")+" svelte-rtaaid"),U(n,"tabindex","-1"),F(n,"height",e[2]+"px"),F(n,"min-width",e[2]+"px"),U(g,"xmlns","http://www.w3.org/2000/svg"),U(g,"viewBox","0 0 384 512"),U(g,"class","svelte-rtaaid"),U(f,"class","tooltip svelte-rtaaid"),U(p,"class","button region-btn tag svelte-rtaaid"),U(t,"class",h="region is-center "+(e[5](e[0])?"checked":"")+" svelte-rtaaid")},m(s,l){T(s,t,l),S(t,n),S(n,r),S(n,o),S(n,i),S(i,c),c.innerHTML=e[3],S(t,u),S(t,p),S(p,g),k.m(g,null),S(p,m),S(p,f),E.m(f,null),v=!0,w||(b=[A(n,"click",e[9]),A(n,"keyup",bt),A(p,"click",e[10])],w=!0)},p(e,[o]){(!v||7&o&&!d(r.src,s=rt(e[0].img,e[0].xyhw,e[1]?"96,":`,${e[2]}`)))&&U(r,"src",s),(!v||8&o)&&(c.innerHTML=e[3]),(!v||2&o&&a!==(a="image card region-image "+(e[1]?"is-96x96":"")+" svelte-rtaaid"))&&U(n,"class",a),(!v||4&o)&&F(n,"height",e[2]+"px"),(!v||4&o)&&F(n,"min-width",e[2]+"px"),x!==(x=y(e))&&(k.d(1),k=x(e),k&&(k.c(),k.m(g,null))),C===(C=I(e))&&E?E.p(e,o):(E.d(1),E=C(e),E&&(E.c(),E.m(f,null))),(!v||33&o&&h!==(h="region is-center "+(e[5](e[0])?"checked":"")+" svelte-rtaaid"))&&U(t,"class",h)},i(e){v||(ue((()=>{v&&($||($=Ie(t,Me,{duration:500},!0)),$.run(1))})),v=!0)},o(e){$||($=Ie(t,Me,{duration:500},!1)),$.run(0),v=!1},d(e){e&&P(t),k.d(),E.d(),e&&$&&$.end(),w=!1,l(b)}}}const bt=()=>null;function yt(e,t,n){let r,s,o;const{isSelected:i}=at;m(e,i,(e=>n(5,o=e)));const{clipBoard:l}=ut;m(e,l,(e=>n(8,s=e)));let{item:c}=t,{isSquare:a=!0}=t,{height:u=(a?96:140)}=t,{desc:d=c.title}=t;return e.$$set=e=>{"item"in e&&n(0,c=e.item),"isSquare"in e&&n(1,a=e.isSquare),"height"in e&&n(2,u=e.height),"desc"in e&&n(3,d=e.desc)},e.$$.update=()=>{257&e.$$.dirty&&n(4,r=c.ref===s)},[c,a,u,d,r,o,i,l,s,()=>at.toggle(c),()=>ut.copyRef(c.ref)]}class xt extends je{constructor(e){super(),Ne(this,e,yt,wt,a,{item:0,isSquare:1,height:2,desc:3})}}function kt(e){let t,n,s,o,i,l,c,a,u,d="en"===Ve?"Selection":"Sélection";return{c(){t=L("div"),n=L("button"),s=L("span"),o=L("i"),i=_(),l=j(d),c=j("\n            ("),a=j(e[0]),u=j(")"),U(o,"class","fa-solid fa-book-bookmark"),U(s,"id","btn-content"),U(n,"id","set-btn"),U(n,"class","button px-5 py-4 is-link js-modal-trigger svelte-hs48f9"),U(n,"data-target","selection-modal"),U(t,"class","set-container svelte-hs48f9")},m(e,r){T(e,t,r),S(t,n),S(n,s),S(s,o),S(s,i),S(s,l),S(s,c),S(s,a),S(s,u)},p(e,[t]){1&t&&D(a,e[0])},i:r,o:r,d(e){e&&P(t)}}}function It(e,t,n){let{selectionLength:r=0}=t,s=r;return e.$$set=e=>{"selectionLength"in e&&n(0,r=e.selectionLength)},e.$$.update=()=>{if(3&e.$$.dirty&&r!==s){const e=r>s;n(1,s=r);const t=document.getElementById("btn-content");t&&t.animate([{transform:e?"translateY(-7px)":"translateX(-5px)"},{transform:e?"translateY(7px)":"translateX(5px)"},{transform:"translate(0)"}],{duration:300,easing:"cubic-bezier(0.65, 0, 0.35, 1)"})}},[r,s]}class Ct extends je{constructor(e){super(),Ne(this,e,It,kt,a,{selectionLength:0})}}function St(e){let t,n,s,o,i,l,c,a,u,d,p,g,m,f,h;return{c(){t=L("button"),n=_(),s=L("div"),o=L("div"),i=_(),l=L("div"),c=L("div"),c.innerHTML='<div class="title is-4 mb-0 media-content"><span id="modal-title" class="mb-0"></span></div> \n            <button class="delete media-left" aria-label="close"></button>',a=_(),u=L("section"),d=_(),p=L("footer"),g=L("div"),m=L("button"),m.textContent=""+("en"===Ve?"Abort":"Retour"),f=_(),h=L("button"),h.textContent="OK",U(t,"id","hidden-msg-btn"),U(t,"class","js-modal-trigger"),U(t,"data-target","msg-modal"),t.hidden=!0,U(o,"id","modal-bkg"),U(o,"class","modal-background"),U(c,"class","modal-card-head media mb-0"),U(u,"id","modal-body"),U(u,"class","modal-card-body"),U(m,"id","cancel-btn"),U(m,"class","button is-link is-light button-close"),U(h,"id","ok-btn"),U(h,"class","button is-link button-close"),U(g,"class","buttons"),U(p,"id","modal-footer"),U(p,"class","modal-card-foot is-center pt-3"),p.hidden=!0,U(l,"class","modal-content"),U(s,"id","msg-modal"),U(s,"class","modal fade"),U(s,"tabindex","-1"),U(s,"aria-labelledby","selection-modal-label"),U(s,"aria-hidden","true")},m(e,r){T(e,t,r),T(e,n,r),T(e,s,r),S(s,o),S(s,i),S(s,l),S(l,c),S(l,a),S(l,u),S(l,d),S(l,p),S(p,g),S(g,m),S(g,f),S(g,h)},p:r,i:r,o:r,d(e){e&&P(t),e&&P(n),e&&P(s)}}}class Et extends je{constructor(e){super(),Ne(this,e,null,St,a,{})}}function Rt(e){let t,n,s,o,i,l=He.includes("regions"),c=l&&function(e){let t,n,s;return{c(){t=L("button"),t.textContent="en"===Ve?"Automatic region extraction":"Extraction automatique des régions",U(t,"class","button is-link is-inverted")},m(r,o){T(r,t,o),n||(s=A(t,"click",e[1]),n=!0)},p:r,d(e){e&&P(t),n=!1,s()}}}(e);return{c(){t=L("div"),n=L("button"),n.textContent=""+("en"===Ve?"Manually annotate":"Annoter manuellement"),s=_(),c&&c.c(),U(n,"class","button is-link"),U(t,"class","is-center buttons is-centered pt-5")},m(r,l){T(r,t,l),S(t,n),S(t,s),c&&c.m(t,null),o||(i=A(n,"click",e[0]),o=!0)},p(e,[t]){l&&c.p(e,t)},i:r,o:r,d(e){e&&P(t),c&&c.d(),o=!1,i()}}}function Tt(e,t,n){const r=re("witness");let{currentRegionId:s}=t,{baseUrl:o}=t;return e.$$set=e=>{"currentRegionId"in e&&n(2,s=e.currentRegionId),"baseUrl"in e&&n(3,o=e.baseUrl)},[async function(){const e=`${window.location.origin}/${Fe}`;let t=`${e}/witness/${r.id}/regions/add`;if(1===r.regions.length||s){const n=s||r.regions[0];t=`${e}/witness/${r.id}/regions/${n}/add`}const n=await Ye((()=>fetch(t,{method:"POST",headers:{"X-CSRFToken":Be}})));if(!n.ok)throw await ot(`Failed to create regions: '${n.statusText}'`,"Error"),new Error(`Failed to create regions: '${n.statusText}'`);let i;try{i=await n.json()}catch(e){throw await ot(`Failed to parse JSON response: '${e}'`,"Error"),new Error(`Failed to parse JSON response: '${e}'`)}i.hasOwnProperty("mirador_url")&&window.open(i.mirador_url),i.hasOwnProperty("regions_id")&&(window.location.href=`${o.split("regions/")[0]}regions/${i.regions_id}`)},async function(){const e=`${window.location.origin}/${Fe}/witness/${r.id}/regions/extract`,t=await Ye((()=>fetch(e,{method:"POST",headers:{"X-CSRFToken":Be}})));let n;if(!t.ok)throw await ot(`Failed to launch regions extraction: '${n.message}'`,"Error"),new Error(`Failed to launch regions extraction: '${n.message}'`);try{n=await t.json(),console.log(n)}catch(e){throw await ot(`Failed to parse JSON response: '${e}'`,"Error"),new Error(`Failed to parse JSON response: '${e}'`)}finally{const e=n.doc_set_id;if(!e)throw await ot("Failed to launch regions extraction: 'No document set id'","Error"),new Error("Failed to launch regions extraction: 'No document set id'");window.location.href=`${window.location.origin}/${Fe}/treatment/add/?document_set=${e}&task_type=regions`}},s,o]}class Pt extends je{constructor(e){super(),Ne(this,e,Tt,Rt,a,{currentRegionId:2,baseUrl:3})}}function Ot(e,t,n){const r=e.slice();return r[6]=t[n],r}function Lt(e){let t,n=e[3].regions,r=[];for(let t=0;t<n.length;t+=1)r[t]=jt(Ot(e,n,t));return{c(){for(let e=0;e<r.length;e+=1)r[e].c();t=M()},m(e,n){for(let t=0;t<r.length;t+=1)r[t]&&r[t].m(e,n);T(e,t,n)},p(e,s){if(9&s){let o;for(n=e[3].regions,o=0;o<n.length;o+=1){const i=Ot(e,n,o);r[o]?r[o].p(i,s):(r[o]=jt(i),r[o].c(),r[o].m(t.parentNode,t))}for(;o<r.length;o+=1)r[o].d(1);r.length=n.length}},d(e){O(r,e),e&&P(t)}}}function Nt(e){let t,n;function r(e,n){return 4&n&&(t=null),null==t&&(t=!!["all","page"].includes(e[2])),t?Mt:"similarity"===e[2]?_t:void 0}let s=r(e,-1),o=s&&s(e);return{c(){o&&o.c(),n=M()},m(e,t){o&&o.m(e,t),T(e,n,t)},p(e,t){s===(s=r(e,t))&&o?o.p(e,t):(o&&o.d(1),o=s&&s(e),o&&(o.c(),o.m(n.parentNode,n)))},d(e){o&&o.d(e),e&&P(n)}}}function jt(e){let t,n,r,s,o=e[6]+"";return{c(){t=L("a"),n=j("Regions #"),r=j(o),U(t,"href",s=""+(e[0]+e[6])),U(t,"class","tag is-dark mr-3 is-rounded")},m(e,s){T(e,t,s),S(t,n),S(t,r)},p(e,n){1&n&&s!==(s=""+(e[0]+e[6]))&&U(t,"href",s)},d(e){e&&P(t)}}}function _t(e){let t,n,s;return{c(){t=L("button"),t.textContent=""+("en"===Ve?"Delete all regions similarity":"Supprimer toutes les similarités du document"),U(t,"class","tag is-danger")},m(r,o){T(r,t,o),n||(s=A(t,"click",e[5]),n=!0)},p:r,d(e){e&&P(t),n=!1,s()}}}function Mt(e){let t,n,s;return{c(){t=L("button"),t.textContent=""+("en"===Ve?"Delete regions record":"Supprimer l'intégralité des régions"),U(t,"class","tag is-danger")},m(r,o){T(r,t,o),n||(s=A(t,"click",e[4]),n=!0)},p:r,d(e){e&&P(t),n=!1,s()}}}function At(e){let t;function n(e,t){return e[1]?Nt:Lt}let s=n(e),o=s(e);return{c(){t=L("div"),o.c()},m(e,n){T(e,t,n),o.m(t,null)},p(e,[r]){s===(s=n(e))&&o?o.p(e,r):(o.d(1),o=s(e),o&&(o.c(),o.m(t,null)))},i:r,o:r,d(e){e&&P(t),o.d()}}}function qt(e,t,n){const r=re("witness");let{baseUrl:s=`${window.location.origin}${window.location.pathname}`}=t,{currentRegionId:o}=t,{currentLayout:i}=t;return e.$$set=e=>{"baseUrl"in e&&n(0,s=e.baseUrl),"currentRegionId"in e&&n(1,o=e.currentRegionId),"currentLayout"in e&&n(2,i=e.currentLayout)},[s,o,i,r,async function(){if(!await ot("en"===Ve?"Are you sure you want to delete this record?":"Voulez-vous vraiment supprimer cet enregistrement ?","en"===Ve?"Confirm deletion":"Confirmer la suppression",!0))return;if("number"!=typeof o)throw new Error("Invalid region ID");const e=`${window.location.origin}/${Fe}/regions/${o}/delete`;try{const t=await Ye((()=>fetch(e,{method:"DELETE",headers:{"X-CSRFToken":Be}})));if(204!==t.status)throw new Error(`Failed to delete regions: '${t.statusText}'`);window.location.href=`${s.split("regions/")[0]}regions/`}catch(e){console.error(e)}},async function(){if(!await ot("en"===Ve?"Are you sure you want to delete all similarity scores for this document?":"Voulez-vous vraiment supprimer l'intégralité des scores de similarité pour ce document ?","en"===Ve?"Confirm deletion":"Confirmer la suppression",!0))return;if("number"!=typeof o)throw new Error("Invalid region ID");const e=`${window.location.origin}/${Fe}/similarity/reset/${o}`;try{const t=await Ye((()=>fetch(e,{method:"DELETE",headers:{"X-CSRFToken":Be}})));if(204!==t.status&&200!==t.status)throw new Error(`Failed to delete similarity: '${t.statusText}'`);window.location.href=`${s.split("regions/")[0]}regions/`}catch(e){console.error(e),await ot(e.message,"Error")}}]}class Ut extends je{constructor(e){super(),Ne(this,e,qt,At,a,{baseUrl:0,currentRegionId:1,currentLayout:2})}}function Dt(e){let t;return{c(){t=N("path"),U(t,"d","M471.6 21.7c-21.9-21.9-57.3-21.9-79.2 0L362.3 51.7l97.9 97.9 30.1-30.1c21.9-21.9 21.9-57.3 0-79.2L471.6 21.7zm-299.2 220c-6.1 6.1-10.8 13.6-13.5 21.9l-29.6 88.8c-2.9 8.6-.6 18.1 5.8 24.6s15.9 8.7 24.6 5.8l88.8-29.6c8.2-2.7 15.7-7.4 21.9-13.5L437.7 172.3 339.7 74.3 172.4 241.7zM96 64C43 64 0 107 0 160V416c0 53 43 96 96 96H352c53 0 96-43 96-96V320c0-17.7-14.3-32-32-32s-32 14.3-32 32v96c0 17.7-14.3 32-32 32H96c-17.7 0-32-14.3-32-32V160c0-17.7 14.3-32 32-32h96c17.7 0 32-14.3 32-32s-14.3-32-32-32H96z"),U(t,"class","svelte-h0t5l9")},m(e,n){T(e,t,n)},d(e){e&&P(t)}}}function Vt(e){let t;return{c(){t=N("path"),U(t,"d","M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"),U(t,"class","svelte-h0t5l9")},m(e,n){T(e,t,n)},d(e){e&&P(t)}}}function Ft(e){let t,n="en"===Ve?"Edit":"Modifier";return{c(){t=j(n)},m(e,n){T(e,t,n)},p:r,d(e){e&&P(t)}}}function zt(e){let t,n="en"===Ve?"Validate":"Valider";return{c(){t=j(n)},m(e,n){T(e,t,n)},p:r,d(e){e&&P(t)}}}function Bt(e){let t,n,s,o,i,c,a,u,d,p,g,m,f,h,$,v,w="en"===Ve?"Reload":"Recharger",b="en"===Ve?"Go to editor":"Aller à l'éditeur",y="en"===Ve?"Delete selected regions":"Supprimer les régions sélectionnées";return{c(){t=L("button"),n=L("i"),s=_(),o=j(w),i=_(),c=L("a"),a=L("i"),u=_(),d=j(b),p=_(),g=L("button"),m=L("i"),f=_(),h=j(y),U(n,"class","fa-solid fa-rotate-right"),U(t,"class","tag is-link is-light is-rounded mr-3"),U(a,"class","fa-solid fa-edit"),U(c,"class","tag is-link is-rounded mr-3"),U(c,"href",st(e[4])),U(c,"target","_blank"),U(m,"class","fa-solid fa-trash"),U(g,"class","tag is-danger is-rounded")},m(r,l){T(r,t,l),S(t,n),S(t,s),S(t,o),T(r,i,l),T(r,c,l),S(c,a),S(c,u),S(c,d),T(r,p,l),T(r,g,l),S(g,m),S(g,f),S(g,h),$||(v=[A(t,"click",e[14]),A(g,"click",e[6])],$=!0)},p:r,d(e){e&&P(t),e&&P(i),e&&P(c),e&&P(p),e&&P(g),$=!1,l(v)}}}function Ht(e){let t,n,s,o,i,c,a,u,d,p,g,m,f,h,$,v,w,b,y,x="en"===Ve?"Download":"Télécharger";function k(e,t){return e[0]?Vt:Dt}let I=k(e),C=I(e);function E(e,t){return e[0]?zt:Ft}let R=E(e),O=R(e),M=e[0]&&Bt(e);return{c(){t=L("div"),n=L("button"),s=N("svg"),C.c(),o=_(),O.c(),c=_(),a=L("button"),u=L("i"),d=_(),p=L("span"),p.textContent=""+("en"===Ve?"Select all":"Tout sélectionner"),g=_(),m=L("button"),f=L("i"),h=_(),$=j(x),v=_(),w=L("div"),M&&M.c(),U(s,"xmlns","http://www.w3.org/2000/svg"),U(s,"viewBox","0 0 384 512"),U(s,"class","pr-3 svelte-h0t5l9"),U(n,"class",i="button "+(e[0]?"is-success":"is-link")+" mr-3"),U(u,"class","fa-solid fa-square-check"),U(p,"id","all-selection"),U(a,"class","button is-link is-light mr-3"),U(f,"class","fa-solid fa-download"),U(m,"class","button is-link is-light"),U(t,"class","is-right mb-3"),U(w,"class","edit-action is-right svelte-h0t5l9")},m(r,i){T(r,t,i),S(t,n),S(n,s),C.m(s,null),S(n,o),O.m(n,null),S(t,c),S(t,a),S(a,u),S(a,d),S(a,p),S(t,g),S(t,m),S(m,f),S(m,h),S(m,$),T(r,v,i),T(r,w,i),M&&M.m(w,null),b||(y=[A(n,"click",e[13]),A(a,"click",e[7]),A(m,"click",e[8])],b=!0)},p(e,[t]){I!==(I=k(e))&&(C.d(1),C=I(e),C&&(C.c(),C.m(s,null))),R===(R=E(e))&&O?O.p(e,t):(O.d(1),O=R(e),O&&(O.c(),O.m(n,null))),1&t&&i!==(i="button "+(e[0]?"is-success":"is-link")+" mr-3")&&U(n,"class",i),e[0]?M?M.p(e,t):(M=Bt(e),M.c(),M.m(w,null)):M&&(M.d(1),M=null)},i:r,o:r,d(e){e&&P(t),C.d(),O.d(),e&&P(v),e&&P(w),M&&M.d(),b=!1,l(y)}}}async function Jt(e){const t=SAS_APP_URL.replace("https","http"),n=`${SAS_APP_URL}/annotation/destroy?uri=${t}/annotation/${e}`,r=await fetch(n,{method:"DELETE"});if(204!==r.status)throw new Error(`Failed to delete ${n} due to ${r.status}: '${r.statusText}'`)}function Xt(e,t,n){let r,s,o,i,l,c,a;const{selected:u,nbSelected:d}=at;m(e,u,(e=>n(10,l=e))),m(e,d,(e=>n(12,a=e)));const{allRegions:p}=ut;m(e,p,(e=>n(11,c=e)));const g=re("manifest"),f=re("isValidated");function h(){n(0,s=!s)}return e.$$.update=()=>{4096&e.$$.dirty&&n(9,r=a(!0)),1024&e.$$.dirty&&(o=l(!0)),2560&e.$$.dirty&&(i=r>=Object.keys(c).length)},n(0,s=!f),[s,u,d,p,g,h,async function(){if(await ot("en"===Ve?"Are you sure you want to delete these regions?":"Voulez-vous vraiment supprimer ces régions ?","en"===Ve?"Confirm deletion":"Confirmer la suppression",!0))for(const e of Object.keys(o))try{if(!c.hasOwnProperty(e))continue;await Jt(e),ut.remove(e),at.remove(e,Je)}catch(t){await ot(`Failed to delete region ${e}: ${t.message}`,"Error")}},function(){i?at.removeAll(Object.keys(c),Je):at.addAll(Object.values(c))},async function(){const e=Object.values(l(!0)).map((e=>e.ref)),t=await Ye((()=>fetch(`${window.location.origin}/${Fe}/regions/export`,{method:"POST",headers:{"X-CSRFToken":Be},body:JSON.stringify({regionsRef:e})})));it(await t.blob(),"regions.zip")},r,l,c,a,()=>h(),()=>location.reload()]}class Zt extends je{constructor(e){super(),Ne(this,e,Xt,Ht,a,{})}}const Wt=function(){const e=`${window.location.origin}${window.location.pathname}`,t=window.location.pathname.match(/\d+/g).join("-"),n={[t]:{}},r=[2,6],s=Ue(1),o=Ue({}),i=Ue(JSON.parse(localStorage.getItem("selectedRegions"))||n);i.subscribe((e=>localStorage.setItem("selectedRegions",JSON.stringify(e))));const l=Ue(JSON.parse(localStorage.getItem("excludedCategories"))||[]);l.subscribe((e=>localStorage.setItem("excludedCategories",JSON.stringify(e))));const c=Ue(JSON.parse(localStorage.getItem("similarityScoreCutoff"))||void 0);c.subscribe((e=>{null!=e&&localStorage.setItem("similarityScoreCutoff",JSON.stringify(e))}));const a=Ue(JSON.parse(localStorage.getItem("propagateRecursionDepth"))||r[1]);a.subscribe((e=>localStorage.setItem("propagateRecursionDepth",JSON.stringify(e))));const u=Ue(JSON.parse(localStorage.getItem("propagateFilterByRegions"))||!1);u.subscribe((e=>localStorage.setItem("propagateFilterByRegions",JSON.stringify(e))));const d=De([a,u],(([e,t])=>({propagateRecursionDepth:e,propagateFilterByRegions:t}))),p=De([l,i,c],(([e,t,n])=>({excludedCategories:e,regions:t,similarityScoreCutoff:n}))),m=De([d,p],(([e,t])=>({propagate:e,similarity:t}))),f=Ue([]),h=Ue([]);function $(e){localStorage.setItem("selectedRegions",JSON.stringify(e))}const v=De(i,(e=>n=>e[t]?.hasOwnProperty(n))),w=()=>tt(s,"sp"),b=De([s,f],(([e,t])=>(async()=>function(e,t){const n=25*(e-1),r=n+25,s=t.slice(n,r);return h.set(s),s}(e,t))()));function y(e){nt(e,s,"sp")}return{currentPage:s,comparedRegions:o,excludedCategories:l,qImgs:f,pageQImgs:h,selectedRegions:i,propagateRecursionDepth:a,propagateFilterByRegions:u,similarityToolbarParams:m,propagateParams:d,similarityScoreCutoff:c,allowedPropagateDepthRange:r,fetchSimilarity:async function(){const n=async()=>{const n=await fetch(`${e}compared-regions`),r=await n.json();o.set(r),i.update((e=>{let n=e[t]||{};if(Object.keys(n).length){let s=Object.keys(n).filter((e=>Object.keys(r).includes(e))).reduce(((e,t)=>(e[t]=n[t],e)),{});e[t]=s}return e}))},r=async()=>{const t=await fetch(`${e}query-images`),n=await t.json();n.length>0&&(f.set(n),y(w()))};Qe.set(!0);try{await Promise.all([n(),r()])}catch(e){console.error("Error:",e),Ke.set(e.message)}finally{Qe.set(!1)}},setPageQImgs:b,getRegionsInfo:function(e){const t=g(o),n=Object.keys(t).filter((t=>t.startsWith(e)));return 1!==n.length?{title:"Error"}:t[n[0]]},handlePageUpdate:y,unselect:function(e){i.update((n=>{const r={...n};return delete r[t][e],$(r),r}))},select:function(e){i.update((n=>{const r={...n,[t]:{...n[t]||{},[e.ref]:e}};return $(r),r}))},addComparedRegions:function(e){o.update((t=>({...t,[e.ref]:e})))},isSelected:v,pageLength:25}}();function Gt(e){let t,n,r;const s=e[1].default,o=f(s,e,e[0],null);return{c(){t=L("table"),n=L("tbody"),o&&o.c(),U(t,"class","table is-fullwidth")},m(e,s){T(e,t,s),S(t,n),o&&o.m(n,null),r=!0},p(e,[t]){o&&o.p&&(!r||1&t)&&v(o,s,e,e[0],r?$(s,e[0],t,null):w(e[0]),null)},i(e){r||(ye(o,e),r=!0)},o(e){xe(o,e),r=!1},d(e){e&&P(t),o&&o.d(e)}}}function Qt(e,t,n){let{$$slots:r={},$$scope:s}=t;return e.$$set=e=>{"$$scope"in e&&n(0,s=e.$$scope)},[s,r]}class Kt extends je{constructor(e){super(),Ne(this,e,Qt,Gt,a,{})}}function Yt(e){let t,n,r,s,o,i,l,c,a,u=e[4]>1&&en(e),d=e[4]<e[3]&&rn(e);return{c(){t=L("nav"),n=L("ul"),u&&u.c(),r=_(),s=L("li"),o=L("a"),i=j(e[4]),l=_(),d&&d.c(),U(o,"class","pagination-link is-current"),U(o,"href",null),U(n,"class","pagination-list ml-0"),U(t,"class","pagination is-centered mb-2"),U(t,"aria-label","pagination")},m(p,g){T(p,t,g),S(t,n),u&&u.m(n,null),S(n,r),S(n,s),S(s,o),S(o,i),S(n,l),d&&d.m(n,null),c||(a=A(o,"click",q(e[8])),c=!0)},p(e,t){e[4]>1?u?u.p(e,t):(u=en(e),u.c(),u.m(n,r)):u&&(u.d(1),u=null),16&t&&D(i,e[4]),e[4]<e[3]?d?d.p(e,t):(d=rn(e),d.c(),d.m(n,null)):d&&(d.d(1),d=null)},d(e){e&&P(t),u&&u.d(),d&&d.d(),c=!1,a()}}}function en(e){let t,n,r,s,o,i,l=e[4]-1>1&&tn(e);return{c(){t=L("li"),n=L("a"),n.textContent="1",r=_(),l&&l.c(),s=M(),U(n,"class","pagination-link"),U(n,"href",null)},m(c,a){T(c,t,a),S(t,n),T(c,r,a),l&&l.m(c,a),T(c,s,a),o||(i=A(n,"click",q(e[6])),o=!0)},p(e,t){e[4]-1>1?l?l.p(e,t):(l=tn(e),l.c(),l.m(s.parentNode,s)):l&&(l.d(1),l=null)},d(e){e&&P(t),e&&P(r),l&&l.d(e),e&&P(s),o=!1,i()}}}function tn(e){let t,n,r,s,o,i,l=e[4]-1+"",c=e[4]-1>2&&nn();return{c(){c&&c.c(),t=_(),n=L("li"),r=L("a"),s=j(l),U(r,"class","pagination-link"),U(r,"href",null)},m(l,a){c&&c.m(l,a),T(l,t,a),T(l,n,a),S(n,r),S(r,s),o||(i=A(r,"click",q(e[7])),o=!0)},p(e,n){e[4]-1>2?c||(c=nn(),c.c(),c.m(t.parentNode,t)):c&&(c.d(1),c=null),16&n&&l!==(l=e[4]-1+"")&&D(s,l)},d(e){c&&c.d(e),e&&P(t),e&&P(n),o=!1,i()}}}function nn(e){let t;return{c(){t=L("li"),t.innerHTML='<span class="pagination-ellipsis">…</span>'},m(e,n){T(e,t,n)},d(e){e&&P(t)}}}function rn(e){let t,n,r,s,o,i,l=e[4]+1<e[3]&&sn(e);return{c(){l&&l.c(),t=_(),n=L("li"),r=L("a"),s=j(e[3]),U(r,"class","pagination-link"),U(r,"href",null)},m(c,a){l&&l.m(c,a),T(c,t,a),T(c,n,a),S(n,r),S(r,s),o||(i=A(r,"click",q(e[10])),o=!0)},p(e,n){e[4]+1<e[3]?l?l.p(e,n):(l=sn(e),l.c(),l.m(t.parentNode,t)):l&&(l.d(1),l=null),8&n&&D(s,e[3])},d(e){l&&l.d(e),e&&P(t),e&&P(n),o=!1,i()}}}function sn(e){let t,n,r,s,o,i,l,c=e[4]+1+"",a=e[4]+2<e[3]&&on();return{c(){t=L("li"),n=L("a"),r=j(c),s=_(),a&&a.c(),o=M(),U(n,"class","pagination-link"),U(n,"href",null)},m(c,u){T(c,t,u),S(t,n),S(n,r),T(c,s,u),a&&a.m(c,u),T(c,o,u),i||(l=A(n,"click",q(e[9])),i=!0)},p(e,t){16&t&&c!==(c=e[4]+1+"")&&D(r,c),e[4]+2<e[3]?a||(a=on(),a.c(),a.m(o.parentNode,o)):a&&(a.d(1),a=null)},d(e){e&&P(t),e&&P(s),a&&a.d(e),e&&P(o),i=!1,l()}}}function on(e){let t;return{c(){t=L("li"),t.innerHTML='<span class="pagination-ellipsis">…</span>'},m(e,n){T(e,t,n)},d(e){e&&P(t)}}}function ln(e){let t,n,s,o,i,l,c,a=e[4]*e[2]-e[2]+1+"",u=Math.min(e[4]*e[2],e[1])+"",d=(e[3]>1||e[1]>e[2])&&Yt(e);return{c(){d&&d.c(),t=_(),n=L("div"),s=j(a),o=j(" - "),i=j(u),l=j(" / "),c=j(e[1]),U(n,"class","is-size-7 is-center mb-4")},m(e,r){d&&d.m(e,r),T(e,t,r),T(e,n,r),S(n,s),S(n,o),S(n,i),S(n,l),S(n,c)},p(e,[n]){e[3]>1||e[1]>e[2]?d?d.p(e,n):(d=Yt(e),d.c(),d.m(t.parentNode,t)):d&&(d.d(1),d=null),20&n&&a!==(a=e[4]*e[2]-e[2]+1+"")&&D(s,a),22&n&&u!==(u=Math.min(e[4]*e[2],e[1])+"")&&D(i,u),2&n&&D(c,e[1])},i:r,o:r,d(e){d&&d.d(e),e&&P(t),e&&P(n)}}}function cn(e,t,n){let r,s,{store:o}=t;const{currentPage:i}=o;m(e,i,(e=>n(4,s=e)));let{nbOfItems:l}=t,{pageLength:c=Ge}=t;return e.$$set=e=>{"store"in e&&n(0,o=e.store),"nbOfItems"in e&&n(1,l=e.nbOfItems),"pageLength"in e&&n(2,c=e.pageLength)},e.$$.update=()=>{6&e.$$.dirty&&n(3,r=c<Ge?1:Math.ceil(l/c))},[o,l,c,r,s,i,()=>o.handlePageUpdate(1),()=>o.handlePageUpdate(s-1),()=>o.handlePageUpdate(s),()=>o.handlePageUpdate(s+1),()=>o.handlePageUpdate(r)]}class an extends je{constructor(e){super(),Ne(this,e,cn,ln,a,{store:0,nbOfItems:1,pageLength:2})}}const un='<svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 68 69">\n        <rect x="10" y="10.62" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>\n        <rect x="1" y="1" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>\n        <rect x="10" y="10.62" width="46" height="45.71" rx="4.11" ry="4.11" fill="currentColor" stroke="none"/>\n    </svg>',dn='<svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 70 71">\n        <rect x="12" y="12.43" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>\n        <rect x="1" y="0.81" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>\n        <path d="M 12 21.43 L 21 12.43" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>\n        <path d="M 12 30 L 30 12.43" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>\n        <path d="M 40 56 L 57 38" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>\n        <path d="M 48.3 56.29 L 57 47" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>\n        <path d="M 12 39 L 39 12" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>\n        <path d="M 12 48 L 48 12" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>\n        <path d="M 13 56 L 57 12" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>\n        <path d="M 31 56 L 57 29" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>\n        <path d="M 21 57 L 57 21" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>\n    </svg>',pn='<svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 72 73">\n        <rect x="14" y="14.43" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3" stroke-dasharray="9 9"/>\n        <rect x="1" y="0.81" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>\n    </svg>',gn='<svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 59 59">\n        <rect x="1" y="0.62" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>\n        <path d="M 2.67 54.55 L 55 2" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>\n        <path d="M 54.37 54.05 L 2.72 2.24" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>\n    </svg>',mn='<svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 59 59">\n        <rect x="1" y="0.81" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>\n        <path d="M 8.69 55.28 C 9.25 44.15 18.08 35.28 28.86 35.28 C 32.5 35.28 36.07 36.3 39.18 38.25 C 44.96 41.85 48.66 48.3 49.02 55.28 Z M 17.85 21.48 C 17.85 15.37 22.79 10.39 28.86 10.39 C 34.92 10.39 39.86 15.37 39.86 21.48 C 39.86 27.59 34.92 32.56 28.86 32.56 C 22.79 32.56 17.85 27.59 17.85 21.48 Z M 40.37 36.34 C 38.43 35.13 36.32 34.25 34.13 33.7 C 38.82 31.64 42.1 26.94 42.1 21.48 C 42.1 14.13 36.16 8.15 28.86 8.15 C 21.55 8.15 15.61 14.13 15.61 21.48 C 15.61 26.95 18.9 31.66 23.6 33.71 C 13.76 36.18 6.41 45.4 6.41 56.4 C 6.41 57.02 6.92 57.52 7.54 57.52 L 50.17 57.52 C 50.79 57.52 51.3 57.02 51.3 56.4 C 51.3 48.23 47.11 40.54 40.37 36.34 Z" fill="currentColor" stroke="none"/>\n    </svg>',fn="en"===Ve?"overall visual matches":"correspondances visuelles globales",hn="en"===Ve?"visual matches on part of the image":"correspondances visuelles sur une partie de l'image",$n="en"===Ve?"semantic and non-visual matches":"correspondances sémantiques et non-visuelle",vn="en"===Ve?"regions without match":"régions sans correspondance",wn="en"===Ve?"user specific category":"correspondances spécifiques à l'utilisateur";function bn(e){return{c:r,m:r,p:r,i:r,o:r,d:r}}function yn(e){let t,n;return t=new xt({props:{item:e[2],size:256,desc:e[32],isSquare:!1}}),{c(){Te(t.$$.fragment)},m(e,r){Pe(t,e,r),n=!0},p:r,i(e){n||(ye(t.$$.fragment,e),n=!0)},o(e){xe(t.$$.fragment,e),n=!1},d(e){Oe(t,e)}}}function xn(e){return{c:r,m:r,p:r,i:r,o:r,d:r}}function kn(e){let t,n,r,s,o,i,c,a,u,d,p,g,m,f,h,$={ctx:e,current:null,token:null,hasCatch:!1,pending:xn,then:yn,catch:bn,value:32,blocks:[,,,]};return Ce(e[3](),$),{c(){t=L("div"),$.block.c(),n=_(),r=L("div"),s=L("span"),o=_(),i=L("span"),c=_(),a=L("span"),u=_(),d=L("span"),p=_(),g=L("span"),U(s,"class","tag is-hoverable pl-4 pr-3 py-4"),U(s,"title","en"===Ve?"Exact match":"Correspondance exacte"),z(s,"is-selected",1===e[0]),U(i,"class","tag is-hoverable py-4 px-3"),U(i,"title","en"===Ve?"Partial match":"Correspondance partielle"),z(i,"is-selected",2===e[0]),U(a,"class","tag is-hoverable py-4 px-3"),U(a,"title","en"===Ve?"Semantic match":"Correspondance sémantique"),z(a,"is-selected",3===e[0]),U(d,"class","tag is-hoverable py-4 px-3"),U(d,"title","en"===Ve?"No match":"Aucune correspondance"),z(d,"is-selected",4===e[0]),U(g,"class","tag is-hoverable pl-3 pr-4 py-4"),U(g,"title","en"===Ve?"User match":"Correspondance utilisateur"),z(g,"is-selected",e[1]),U(r,"class","tags has-addons is-dark is-center")},m(l,v){T(l,t,v),$.block.m(t,$.anchor=null),$.mount=()=>t,$.anchor=n,S(t,n),S(t,r),S(r,s),s.innerHTML=un,S(r,o),S(r,i),i.innerHTML=dn,S(r,c),S(r,a),a.innerHTML=pn,S(r,u),S(r,d),d.innerHTML=gn,S(r,p),S(r,g),g.innerHTML=mn,m=!0,f||(h=[A(s,"click",e[14]),A(s,"keyup",null),A(i,"click",e[15]),A(i,"keyup",null),A(a,"click",e[16]),A(a,"keyup",null),A(d,"click",e[17]),A(d,"keyup",null),A(g,"click",e[18]),A(g,"keyup",null)],f=!0)},p(t,n){Se($,e=t,n),(!m||1&n[0])&&z(s,"is-selected",1===e[0]),(!m||1&n[0])&&z(i,"is-selected",2===e[0]),(!m||1&n[0])&&z(a,"is-selected",3===e[0]),(!m||1&n[0])&&z(d,"is-selected",4===e[0]),(!m||2&n[0])&&z(g,"is-selected",e[1])},i(e){m||(ye($.block),m=!0)},o(e){for(let e=0;e<3;e+=1){xe($.blocks[e])}m=!1},d(e){e&&P(t),$.block.d(),$.token=null,$=null,f=!1,l(h)}}}function In(e,t,n){let r,s;const o=new URL(window.location.href),i=o.origin,l=o.pathname;let{qImg:c}=t,{sImg:a}=t,{qRegions:u}=t,{sRegions:d}=t,{score:p=0}=t,{category:g=null}=t,{users:m=[]}=t,{isManual:f}=t,{similarityType:h}=t;const{getRegionsInfo:$,comparedRegions:v}=Wt,[w,b,y,x]=a.split(".")[0].split("_"),k={id:a,img:a,title:`Canvas ${y} - ${x} - ${"en"===Ve?"Witness":"Témoin"} #${I=w,I.match(/\d+/g).toString()}`,xywh:x,canvas:y,ref:a.replace(".jpg",""),type:Je};var I;const C=`${w}_${b}`;function S(e){let t=(e=e.slice()).indexOf(Number(ze));return s&&-1===t?e.push(Number(ze)):s||-1===t||e.splice(t,1),e}function E(e){5===e?n(1,s=!s):n(0,r=r===e?null:e)}async function R(e){E(e);try{(await fetch(`${i}/${Fe}/save-category`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":Be},body:JSON.stringify({img_1:c,img_2:a,regions_id_1:u,regions_id_2:d,score:p,category:r,category_x:S(m),is_manual:f||2===h,similarity_type:h})})).ok||(console.error("Error: Network response was not ok"),E(e))}catch(t){console.error("Error:",t),E(e)}}return e.$$set=e=>{"qImg"in e&&n(5,c=e.qImg),"sImg"in e&&n(6,a=e.sImg),"qRegions"in e&&n(7,u=e.qRegions),"sRegions"in e&&n(8,d=e.sRegions),"score"in e&&n(9,p=e.score),"category"in e&&n(10,g=e.category),"users"in e&&n(11,m=e.users),"isManual"in e&&n(12,f=e.isManual),"similarityType"in e&&n(13,h=e.similarityType)},e.$$.update=()=>{1024&e.$$.dirty[0]&&n(0,r=g),2048&e.$$.dirty[0]&&n(1,s=m.includes(Number(ze))||!1)},[r,s,k,async function(){const e=e=>`${e}<br>\n            Page ${parseInt(y)}<br>\n            <b>${isNaN(parseFloat(p))||1!==h?2===h&&"en"===Ve?"Manual similarity":2===h&&"fr"===Ve?"Correspondance manuelle":3===h&&"en"===Ve?"Propagated match":"Correspondance propagée":`Score: ${p}`}</b>`;return 3===h?fetch(`${i}${l}get_regions_title/${C}`).then((e=>e.json())).then((t=>e(t.title))).catch((t=>(console.error("SimilarRegion.getDesc()",t),e("fr"===Ve?"Titre inconnu":"Unknown title")))):e($(C).title)},R,c,a,u,d,p,g,m,f,h,()=>R(1),()=>R(2),()=>R(3),()=>R(4),()=>R(5)]}class Cn extends je{constructor(e){super(),Ne(this,e,In,kn,a,{qImg:5,sImg:6,qRegions:7,sRegions:8,score:9,category:10,users:11,isManual:12,similarityType:13},null,[-1,-1])}}function Sn(e,t,n){const r=e.slice();return r[19]=t[n][0],r[20]=t[n][1],r[21]=t[n][2],r[22]=t[n][3],r[23]=t[n][4],r[24]=t[n][5],r[25]=t[n][6],r[26]=t[n][7],r[27]=t[n][8],r}function En(e){let t;return{c(){t=L("div"),t.textContent=`${e[11]}`,U(t,"class","faded is-center")},m(e,n){T(e,t,n)},p:r,i:r,o:r,d(e){e&&P(t)}}}function Rn(e){let t,n,r,s={ctx:e,current:null,token:null,hasCatch:!0,pending:Mn,then:Pn,catch:Tn,value:18,error:30,blocks:[,,,]};return Ce(n=e[1],s),{c(){t=M(),s.block.c()},m(e,n){T(e,t,n),s.block.m(e,s.anchor=n),s.mount=()=>t.parentNode,s.anchor=t,r=!0},p(t,r){e=t,s.ctx=e,2&r&&n!==(n=e[1])&&Ce(n,s)||Se(s,e,r)},i(e){r||(ye(s.block),r=!0)},o(e){for(let e=0;e<3;e+=1){xe(s.blocks[e])}r=!1},d(e){e&&P(t),s.block.d(e),s.token=null,s=null}}}function Tn(e){let t,n,s="en"===Ve?`Error when retrieving similar regions: ${e[30]}`:`Erreur de recupération des régions similaires: ${e[30]}`;return{c(){t=L("div"),n=j(s),U(t,"class","faded is-center")},m(e,r){T(e,t,r),S(t,n)},p(e,t){2&t&&s!==(s="en"===Ve?`Error when retrieving similar regions: ${e[30]}`:`Erreur de recupération des régions similaires: ${e[30]}`)&&D(n,s)},i:r,o:r,d(e){e&&P(t)}}}function Pn(e){let t,n,r=e[18],s=[];for(let t=0;t<r.length;t+=1)s[t]=_n(Sn(e,r,t));const o=e=>xe(s[e],1,1,(()=>{s[e]=null}));let i=null;return r.length||(i=On(e)),{c(){for(let e=0;e<s.length;e+=1)s[e].c();t=M(),i&&i.c()},m(e,r){for(let t=0;t<s.length;t+=1)s[t]&&s[t].m(e,r);T(e,t,r),i&&i.m(e,r),n=!0},p(e,n){if(4223&n){let l;for(r=e[18],l=0;l<r.length;l+=1){const o=Sn(e,r,l);s[l]?(s[l].p(o,n),ye(s[l],1)):(s[l]=_n(o),s[l].c(),ye(s[l],1),s[l].m(t.parentNode,t))}for(we(),l=r.length;l<s.length;l+=1)o(l);be(),!r.length&&i?i.p(e,n):r.length?i&&(i.d(1),i=null):(i=On(e),i.c(),i.m(t.parentNode,t))}},i(e){if(!n){for(let e=0;e<r.length;e+=1)ye(s[e]);n=!0}},o(e){s=s.filter(Boolean);for(let e=0;e<s.length;e+=1)xe(s[e]);n=!1},d(e){O(s,e),e&&P(t),i&&i.d(e)}}}function On(e){let t;function n(e,t){return e[3]?Nn:Ln}let r=n(e),s=r(e);return{c(){s.c(),t=M()},m(e,n){s.m(e,n),T(e,t,n)},p(e,o){r===(r=n(e))&&s?s.p(e,o):(s.d(1),s=r(e),s&&(s.c(),s.m(t.parentNode,t)))},d(e){s.d(e),e&&P(t)}}}function Ln(e){let t;return{c(){t=L("div"),t.textContent=("en"===Ve?"No similar regions":"Pas de régions similaires")+" \n                ",U(t,"class","faded is-center")},m(e,n){T(e,t,n)},p:r,d(e){e&&P(t)}}}function Nn(e){let t;return{c(){t=L("div"),t.textContent=("en"===Ve?"No document selected. Select one to display results.":"Aucun document sélectionné. Sélectionnez-en un pour afficher les résultats.")+" \n                ",U(t,"class","faded is-center")},m(e,n){T(e,t,n)},p:r,d(e){e&&P(t)}}}function jn(e){let t,n;return t=new Cn({props:{qImg:e[0],sImg:e[21],score:e[19],qRegions:e[22],sRegions:e[23],category:e[24],users:e[25],isManual:e[26],similarityType:e[27]}}),{c(){Te(t.$$.fragment)},m(e,r){Pe(t,e,r),n=!0},p(e,n){const r={};1&n&&(r.qImg=e[0]),2&n&&(r.sImg=e[21]),2&n&&(r.score=e[19]),2&n&&(r.qRegions=e[22]),2&n&&(r.sRegions=e[23]),2&n&&(r.category=e[24]),2&n&&(r.users=e[25]),2&n&&(r.isManual=e[26]),2&n&&(r.similarityType=e[27]),t.$set(r)},i(e){n||(ye(t.$$.fragment,e),n=!0)},o(e){xe(t.$$.fragment,e),n=!1},d(e){Oe(t,e)}}}function _n(e){let t,n,r=e[12](e[19],e[23],e[24],e[25],e[2],e[4],e[5],e[6]),s=r&&jn(e);return{c(){s&&s.c(),t=M()},m(e,r){s&&s.m(e,r),T(e,t,r),n=!0},p(e,n){118&n&&(r=e[12](e[19],e[23],e[24],e[25],e[2],e[4],e[5],e[6])),r?s?(s.p(e,n),118&n&&ye(s,1)):(s=jn(e),s.c(),ye(s,1),s.m(t.parentNode,t)):s&&(we(),xe(s,1,1,(()=>{s=null})),be())},i(e){n||(ye(s),n=!0)},o(e){xe(s),n=!1},d(e){s&&s.d(e),e&&P(t)}}}function Mn(e){let t;return{c(){t=L("div"),t.textContent=`${e[11]}`,U(t,"class","faded is-center")},m(e,n){T(e,t,n)},p:r,i:r,o:r,d(e){e&&P(t)}}}function An(e){let t,n,r,s;const o=[Rn,En],i=[];function l(e,t){return e[1]?0:1}return t=l(e),n=i[t]=o[t](e),{c(){n.c(),r=M()},m(e,n){i[t].m(e,n),T(e,r,n),s=!0},p(e,[s]){let c=t;t=l(e),t===c?i[t].p(e,s):(we(),xe(i[c],1,1,(()=>{i[c]=null})),be(),n=i[t],n?n.p(e,s):(n=i[t]=o[t](e),n.c()),ye(n,1),n.m(r.parentNode,r))},i(e){s||(ye(n),s=!0)},o(e){xe(n),s=!1},d(e){i[t].d(e),e&&P(r)}}}function qn(e,t,n){let r,s,o,i,l,{qImg:c}=t,{sImgsPromise:a}=t;const{selectedRegions:u,excludedCategories:d,similarityScoreCutoff:p,propagateFilterByRegions:g}=Wt;m(e,u,(e=>n(2,s=e))),m(e,d,(e=>n(4,o=e))),m(e,p,(e=>n(5,i=e))),m(e,g,(e=>n(6,l=e)));const f=re("similarityPropagatedContext")||!1,h=window.location.pathname.match(/\d+/g).join("-"),$="en"!==Ve||f?"fr"!==Ve||f?"en"===Ve&&f?"Retrieving propagated regions...":"Récupération de similarités propagées...":"Récupération des régions similaires...":"Retrieving similar regions...",v=(e,t)=>Object.keys(t[h]).map((e=>t[h][e].id)).includes(e);return e.$$set=e=>{"qImg"in e&&n(0,c=e.qImg),"sImgsPromise"in e&&n(1,a=e.sImgsPromise)},e.$$.update=()=>{4&e.$$.dirty&&n(3,r=0===Object.values(s).length||void 0===s[h]||!Object.keys(s[h]).length)},[c,a,s,r,o,i,l,u,d,p,g,$,(e,t,n,r,s,o,i,l)=>{if(f)return!l||v(t,s);{let r=!l||v(t,s);return((e,t)=>void 0===t||null!=e&&Number(e)>=t)(e,i)&&((e,t,n)=>!n.includes(e))(n,0,o)&&r}}]}class Un extends je{constructor(e){super(),Ne(this,e,qn,An,a,{qImg:0,sImgsPromise:1})}}function Dn(e){let t,n,r;return n=new Un({props:{qImg:e[0],sImgsPromise:e[1],displayType:"similarityMatches"}}),{c(){t=L("div"),Te(n.$$.fragment),U(t,"class","grid is-gap-2")},m(e,s){T(e,t,s),Pe(n,t,null),r=!0},p(e,[t]){const r={};1&t&&(r.qImg=e[0]),2&t&&(r.sImgsPromise=e[1]),n.$set(r)},i(e){r||(ye(n.$$.fragment,e),r=!0)},o(e){xe(n.$$.fragment,e),r=!1},d(e){e&&P(t),Oe(n)}}}function Vn(e,t,n){let r,{qImg:s}=t;const{selectedRegions:o}=Wt,i=`${window.location.origin}${window.location.pathname}`,l=window.location.pathname.match(/\d+/g).join("-");async function c(e,t){const n=(e=>Object.values(e[l]||{}).map((e=>e.id)))(t);if(0===n.length)return{};const r=await fetch(`${i}similar-images`,{method:"POST",body:JSON.stringify({regionsIds:n,qImg:e,topk:10}),headers:{"Content-Type":"application/json","X-CSRFToken":Be}});return await r.json()}return o.subscribe((e=>{n(1,r=c(s,e))})),e.$$set=e=>{"qImg"in e&&n(0,s=e.qImg)},[s,r]}class Fn extends je{constructor(e){super(),Ne(this,e,Vn,Dn,a,{qImg:0})}}function zn(e){return{c:r,m:r,p:r,d:r}}function Bn(e){let t;let n=("fr"===Ve?Jn:Hn)(e);return{c(){n.c(),t=M()},m(e,r){n.m(e,r),T(e,t,r)},p(e,t){n.p(e,t)},d(e){n.d(e),e&&P(t)}}}function Hn(e){let t,n,r,s=e[8].length+"",o=e[8].length>1?"es":"";return{c(){t=j(s),n=j(" propagated match"),r=j(o)},m(e,s){T(e,t,s),T(e,n,s),T(e,r,s)},p(e,n){2&n&&s!==(s=e[8].length+"")&&D(t,s),2&n&&o!==(o=e[8].length>1?"es":"")&&D(r,o)},d(e){e&&P(t),e&&P(n),e&&P(r)}}}function Jn(e){let t,n,r,s=e[8].length+"",o=e[8].length>1?"similarités propagées":"similarité propagée";return{c(){t=j(s),n=_(),r=j(o)},m(e,s){T(e,t,s),T(e,n,s),T(e,r,s)},p(e,n){2&n&&s!==(s=e[8].length+"")&&D(t,s),2&n&&o!==(o=e[8].length>1?"similarités propagées":"similarité propagée")&&D(r,o)},d(e){e&&P(t),e&&P(n),e&&P(r)}}}function Xn(e){return{c:r,m:r,p:r,d:r}}function Zn(e){let t,n,r,s,o,i,l,c,a={ctx:e,current:null,token:null,hasCatch:!1,pending:Xn,then:Bn,catch:zn,value:8};return Ce(s=e[1],a),l=new Un({props:{qImg:e[0],sImgsPromise:e[1],displayType:"suggestionMatches"}}),{c(){t=L("div"),n=L("div"),r=L("div"),a.block.c(),o=_(),i=L("div"),Te(l.$$.fragment),U(r,"class","block"),U(i,"class","grid is-gap-2"),U(n,"class","matches-suggestion svelte-1li2qm8"),U(t,"class","block matches-suggestion-wrapper svelte-1li2qm8")},m(e,s){T(e,t,s),S(t,n),S(n,r),a.block.m(r,a.anchor=null),a.mount=()=>r,a.anchor=null,S(n,o),S(n,i),Pe(l,i,null),c=!0},p(t,[n]){e=t,a.ctx=e,2&n&&s!==(s=e[1])&&Ce(s,a)||Se(a,e,n);const r={};1&n&&(r.qImg=e[0]),2&n&&(r.sImgsPromise=e[1]),l.$set(r)},i(e){c||(ye(l.$$.fragment,e),c=!0)},o(e){xe(l.$$.fragment,e),c=!1},d(e){e&&P(t),a.block.d(),a.token=null,a=null,Oe(l)}}}function Wn(e,t,n){let{qImg:r}=t;const{propagateParams:s,selectedRegions:o}=Wt,i=`${window.location.origin}${window.location.pathname}`;let l;window.location.pathname.match(/\d+/g).join("-");const c=lt();c.setCompareFn(ct),ne("similarityPropagatedContext",!0);return s.subscribe((e=>{c.set(e.propagateRecursionDepth),c.same()||n(1,l=(async e=>fetch(`${i}propagated-matches/${r}`,{method:"POST",body:JSON.stringify({regionsIds:[],filterByRegions:!1,recursionDepth:e}),headers:{"Content-Type":"application/json","X-CSRFToken":Be}}).then((e=>e.json())).catch((e=>(console.error("PropagatedMatches.getPropagatedMatches:",e),[]))))(e.propagateRecursionDepth))})),e.$$set=e=>{"qImg"in e&&n(0,r=e.qImg)},[r,l]}class Gn extends je{constructor(e){super(),Ne(this,e,Wn,Zn,a,{qImg:0})}}function Qn(e){let t,n,r,s,o,i,c,a,u,p,g,m,f,h,$,v,w,b,y,x,k,I,C,E,R,O,M,q,D,z,B,H,J=parseInt(e[4])+"";return O=new Fn({props:{qImg:e[0]}}),D=new Gn({props:{qImg:e[0]}}),{c(){t=L("tr"),n=L("th"),r=L("div"),s=L("a"),o=L("i"),i=j("\n                Page "),c=j(J),a=_(),u=L("img"),g=_(),m=L("div"),f=L("div"),h=L("input"),$=_(),v=L("button"),v.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M256 80c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 144L48 224c-17.7 0-32 14.3-32 32s14.3 32 32 32l144 0 0 144c0 17.7 14.3 32 32 32s32-14.3 32-32l0-144 144 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-144 0 0-144z"></path></svg>',w=_(),b=L("button"),y=N("svg"),x=N("path"),C=_(),E=L("td"),R=L("div"),Te(O.$$.fragment),M=_(),q=L("div"),Te(D.$$.fragment),U(o,"class","fa-solid fa-pen-to-square"),U(s,"class","tag px-2 py-1 mb-2 is-rounded is-hoverable"),U(s,"href",st(e[5],parseInt(e[4]))),U(s,"target","_blank"),d(u.src,p=rt(e[0],"full","250,"))||U(u,"src",p),U(u,"alt","Query region"),U(u,"class","mb-3 card"),U(h,"class","input is-small tag"),U(h,"type","text"),U(h,"placeholder","en"===Ve?"Add new match":"Ajouter une correspondance"),U(v,"class","button is-small tag is-link is-center"),U(f,"class","tags has-addons"),F(f,"flex-wrap","nowrap"),U(x,"fill","white"),U(x,"d","M376.6 84.5c11.3-13.6 9.5-33.8-4.1-45.1s-33.8-9.5-45.1 4.1L192 206 56.6 43.5C45.3 29.9 25.1 28.1 11.5 39.4S-3.9 70.9 7.4 84.5L150.3 256 7.4 427.5c-11.3 13.6-9.5 33.8 4.1 45.1s33.8 9.5 45.1-4.1L192 306 327.4 468.5c11.3 13.6 31.5 15.4 45.1 4.1s15.4-31.5 4.1-45.1L233.7 256 376.6 84.5z"),U(y,"xmlns","http://www.w3.org/2000/svg"),U(y,"viewBox","0 0 384 512"),U(b,"id","no-match"),U(b,"class",k="button is-small tag is-danger is-center m-0 "+(1===e[2]?"visible":"")+" svelte-f4c92p"),U(b,"title","en"===Ve?"No match for this region in this witness":"Aucune correspondance de cette région pour ce témoin"),U(m,"class","new-similarity control pt-2 is-center svelte-f4c92p"),U(r,"class","content-wrapper py-5"),U(n,"class","is-3 center-flex is-narrow"),F(n,"width","260px"),U(R,"class","fixed-grid has-5-cols"),U(q,"class","fixed-grid has-5-cols"),U(E,"class","p-5 is-fullwidth")},m(l,d){T(l,t,d),S(t,n),S(n,r),S(r,s),S(s,o),S(s,i),S(s,c),S(r,a),S(r,u),S(r,g),S(r,m),S(m,f),S(f,h),V(h,e[1]),S(f,$),S(f,v),S(m,w),S(m,b),S(b,y),S(y,x),S(t,C),S(t,E),S(E,R),Pe(O,R,null),S(E,M),S(E,q),Pe(D,q,null),z=!0,B||(H=[A(h,"input",e[9]),A(v,"click",e[6]),A(b,"click",e[7])],B=!0)},p(e,[t]){(!z||1&t&&!d(u.src,p=rt(e[0],"full","250,")))&&U(u,"src",p),2&t&&h.value!==e[1]&&V(h,e[1]),(!z||4&t&&k!==(k="button is-small tag is-danger is-center m-0 "+(1===e[2]?"visible":"")+" svelte-f4c92p"))&&U(b,"class",k);const n={};1&t&&(n.qImg=e[0]),O.$set(n);const r={};1&t&&(r.qImg=e[0]),D.$set(r)},i(e){z||(ue((()=>{z&&(I||(I=Ie(b,Me,{duration:500},!0)),I.run(1))})),ye(O.$$.fragment,e),ye(D.$$.fragment,e),z=!0)},o(e){I||(I=Ie(b,Me,{duration:500},!1)),I.run(0),xe(O.$$.fragment,e),xe(D.$$.fragment,e),z=!1},d(e){e&&P(t),e&&I&&I.end(),Oe(O),Oe(D),B=!1,l(H)}}}function Kn(e,t,n){let r,s;const{selectedRegions:o}=Wt;m(e,o,(e=>n(8,s=e)));let{qImg:i}=t,l="";const[c,a,u,d]=i.split(".")[0].split("_"),p=re("manifest"),g=`${window.location.origin}${window.location.pathname}`,f=window.location.pathname.match(/\d+/g).join("-"),h="en"===Ve?"Error":"Erreur";return e.$$set=e=>{"qImg"in e&&n(0,i=e.qImg)},e.$$.update=()=>{256&e.$$.dirty&&n(2,r=s.hasOwnProperty(f)?Object.values(s[f]).length:0)},[i,l,r,o,u,p,async function(){var e;if(l&&(e=(e=l).replace(".jpg",""),/^wit\d+_[a-zA-Z]{3}\d+_\d+_\d+,\d+,\d+,\d+$/.test(e)))try{const e=await fetch(`${g}add-region-pair`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":Be},body:JSON.stringify({q_img:i.replace(".jpg",""),s_img:l,similarity_type:2})});e.ok||(console.error("Error: Network response was not ok"),await ot("en"===Ve?"Problem with network, match was not added":"Problème de réseau, la correspondance n'a pas été ajoutée",h));const t=await e.json();if(t.hasOwnProperty("error")||!t.hasOwnProperty("s_regions"))return void await ot("en"===Ve?`Request was unsuccessful, match was not added:<br>${t.error}`:`La requête n'a pas abouti, la correspondance n'a pas été ajoutée :<br>${t.error}`,h);const n=t.s_regions;Wt.addComparedRegions(n),Wt.select(n)}catch(e){console.error("Error:",e),await ot("en"===Ve?`An error has occurred, match was not added:<br>${e}`:`Une erreur s'est produite, la correspondance n'a pas été ajoutée :<br>${e}`,h)}else await ot("en"===Ve?"Please insert a valid region reference to add a new match":"Veuillez insérer une référence de région valide pour ajouter une nouvelle correspondance","Error")},async function(){const e=Object.values(s[f])[0];if(await ot("en"===Ve?`Do you confirm this region does not have any match in ${e.title}?`:`Confirmez-vous que cette région n'a pas de correspondance dans ${e.title} ?`,"en"===Ve?"Confirm no match":"Confirmer l'absence de correspondance",!0))try{(await fetch(`${g}no-match`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":Be},body:JSON.stringify({q_img:i,s_regions:e.id})})).ok||(console.error("Error: Network response was not ok"),await ot("en"===Ve?"Problem with network":"Problème de réseau",h)),Wt.select(e)}catch(e){console.error("Error:",e),await ot("en"===Ve?`An error has occurred, request was unsuccessful:<br>${e}`:`Une erreur s'est produite, la requête n'a pas abouti :<br>${e}`,h)}},s,function(){l=this.value,n(1,l)}]}class Yn extends je{constructor(e){super(),Ne(this,e,Kn,Qn,a,{qImg:0})}}function er(e,t,n){const r=e.slice();return r[8]=t[n],r}function tr(e){let t,n,s,o=e[11]+"";return{c(){t=L("tr"),n=j("Error when retrieving similar regions: "),s=j(o)},m(e,r){T(e,t,r),S(t,n),S(t,s)},p(e,t){2&t&&o!==(o=e[11]+"")&&D(s,o)},i:r,o:r,d(e){e&&P(t)}}}function nr(e){let t,n,r=[],s=new Map,o=e[2];const i=e=>e[8].id;for(let t=0;t<o.length;t+=1){let n=er(e,o,t),l=i(n);s.set(l,r[t]=sr(l,n))}let l=null;return o.length||(l=rr()),{c(){for(let e=0;e<r.length;e+=1)r[e].c();t=M(),l&&l.c()},m(e,s){for(let t=0;t<r.length;t+=1)r[t]&&r[t].m(e,s);T(e,t,s),l&&l.m(e,s),n=!0},p(e,n){4&n&&(o=e[2],we(),r=Re(r,n,i,1,e,o,s,t.parentNode,Ee,sr,t,er),be(),!o.length&&l?l.p(e,n):o.length?l&&(l.d(1),l=null):(l=rr(),l.c(),l.m(t.parentNode,t)))},i(e){if(!n){for(let e=0;e<o.length;e+=1)ye(r[e]);n=!0}},o(e){for(let e=0;e<r.length;e+=1)xe(r[e]);n=!1},d(e){for(let t=0;t<r.length;t+=1)r[t].d(e);e&&P(t),l&&l.d(e)}}}function rr(e){let t,n;return{c(){t=L("tr"),t.textContent=""+("en"===Ve?"No similarity":"Pas de similarités"),n=_(),U(t,"class","faded is-center")},m(e,r){T(e,t,r),T(e,n,r)},p:r,d(e){e&&P(t),e&&P(n)}}}function sr(e,t){let n,r,s;return r=new Yn({props:{qImg:t[8]}}),{key:e,first:null,c(){n=M(),Te(r.$$.fragment),this.first=n},m(e,t){T(e,n,t),Pe(r,e,t),s=!0},p(e,n){t=e;const s={};4&n&&(s.qImg=t[8]),r.$set(s)},i(e){s||(ye(r.$$.fragment,e),s=!0)},o(e){xe(r.$$.fragment,e),s=!1},d(e){e&&P(n),Oe(r,e)}}}function or(e){let t;return{c(){t=L("tr"),t.textContent=""+("en"===Ve?"Retrieving similarity page...":"Récupération la page de similarité..."),U(t,"class","faded is-center")},m(e,n){T(e,t,n)},p:r,i:r,o:r,d(e){e&&P(t)}}}function ir(e){let t,n,r,s={ctx:e,current:null,token:null,hasCatch:!0,pending:or,then:nr,catch:tr,value:7,error:11,blocks:[,,,]};return Ce(n=e[1],s),{c(){t=M(),s.block.c()},m(e,n){T(e,t,n),s.block.m(e,s.anchor=n),s.mount=()=>t.parentNode,s.anchor=t,r=!0},p(t,r){e=t,s.ctx=e,2&r&&n!==(n=e[1])&&Ce(n,s)||Se(s,e,r)},i(e){r||(ye(s.block),r=!0)},o(e){for(let e=0;e<3;e+=1){xe(s.blocks[e])}r=!1},d(e){e&&P(t),s.block.d(e),s.token=null,s=null}}}function lr(e){let t,n,r,s,o,i,l;return n=new an({props:{store:Wt,nbOfItems:e[0].length,pageLength:e[6]}}),s=new Kt({props:{$$slots:{default:[ir]},$$scope:{ctx:e}}}),i=new an({props:{store:Wt,nbOfItems:e[0].length,pageLength:e[6]}}),{c(){t=L("div"),Te(n.$$.fragment),r=_(),Te(s.$$.fragment),o=_(),Te(i.$$.fragment)},m(e,c){T(e,t,c),Pe(n,t,null),S(t,r),Pe(s,t,null),S(t,o),Pe(i,t,null),l=!0},p(e,[t]){const r={};1&t&&(r.nbOfItems=e[0].length),n.$set(r);const o={};4102&t&&(o.$$scope={dirty:t,ctx:e}),s.$set(o);const l={};1&t&&(l.nbOfItems=e[0].length),i.$set(l)},i(e){l||(ye(n.$$.fragment,e),ye(s.$$.fragment,e),ye(i.$$.fragment,e),l=!0)},o(e){xe(n.$$.fragment,e),xe(s.$$.fragment,e),xe(i.$$.fragment,e),l=!1},d(e){e&&P(t),Oe(n),Oe(s),Oe(i)}}}function cr(e,t,n){let r,s,o;const{qImgs:i,pageQImgs:l,setPageQImgs:c,pageLength:a}=Wt;return m(e,i,(e=>n(0,r=e))),m(e,l,(e=>n(2,o=e))),m(e,c,(e=>n(1,s=e))),[r,s,o,i,l,c,a]}class ar extends je{constructor(e){super(),Ne(this,e,cr,lr,a,{})}}function ur(e){let t,n,s;return{c(){t=L("span"),n=j(e[0]),U(t,"id",e[3]),U(t,"class",s="tooltip "+e[2]+" "+(e[1]?"display":"")+" svelte-1am23me")},m(e,r){T(e,t,r),S(t,n)},p(e,[r]){1&r&&D(n,e[0]),6&r&&s!==(s="tooltip "+e[2]+" "+(e[1]?"display":"")+" svelte-1am23me")&&U(t,"class",s)},i:r,o:r,d(e){e&&P(t)}}}function dr(e,t,n){let r,s,o,i,{tooltipText:l}=t,{targetHtmlId:c}=t;const a=`tooltip-generic-${window.crypto.randomUUID()}`,u=()=>n(1,i=!0),d=()=>n(1,i=!1),p=()=>n(1,i=!i);return Y((()=>{o=c?document.getElementById(c):document.getElementById(a).parentElement,c&&!o&&(console.error(`TooltipGeneric: element with ID ${c} not found, defaulting to the parent element`),o=document.getElementById(a).targetElement),o.addEventListener("mouseover",u),o.addEventListener("mouseout",d),o.addEventListener("click",p)})),ee((()=>{o.removeEventListener("mouseover",u),o.removeEventListener("mouseout",d),o.removeEventListener("click",p)})),e.$$set=e=>{"tooltipText"in e&&n(0,l=e.tooltipText),"targetHtmlId"in e&&n(4,c=e.targetHtmlId)},e.$$.update=()=>{33&e.$$.dirty&&n(2,r=s(l))},n(5,s=e=>n(2,r=e.length>100?"tooltip-wide":e.length>20?"tooltip-mid":"tooltip-thin")),o=void 0,n(1,i=!1),[l,i,r,a,c,s]}class pr extends je{constructor(e){super(),Ne(this,e,dr,ur,a,{tooltipText:0,targetHtmlId:4})}}function gr(e){let t,n,s,o,i,l,c,a,u,d,p,g,m,f,h,$;return{c(){t=L("div"),n=L("span"),s=j(e[2]),o=j(" ("),i=j(e[3]),l=j(")"),c=_(),a=L("div"),u=L("span"),d=j(e[0]),p=_(),g=L("div"),m=L("div"),f=_(),h=L("span"),$=j(e[1]),U(u,"class","range-marker svelte-s3mlts"),U(m,"class","slider"),U(m,"id",e[4]),U(g,"class","slider-wrapper svelte-s3mlts"),U(h,"class","range-marker svelte-s3mlts"),U(a,"class","slider-outer-wrapper is-flex flex-direction-row svelte-s3mlts")},m(e,r){T(e,t,r),S(t,n),S(n,s),S(n,o),S(n,i),S(n,l),S(t,c),S(t,a),S(a,u),S(u,d),S(a,p),S(a,g),S(g,m),S(a,f),S(a,h),S(h,$)},p(e,[t]){4&t&&D(s,e[2]),8&t&&D(i,e[3]),1&t&&D(d,e[0]),2&t&&D($,e[1])},i:r,o:r,d(e){e&&P(t)}}}function mr(t,n,r){let s,{minVal:o}=n,{maxVal:i}=n,{start:l}=n,{step:c}=n,{roundTo:a=2}=n,{title:u=""}=n;const d=te(),p=`slider-${window.crypto.randomUUID()}`,g=Array.isArray(l)&&2===l.length&&l.every((e=>!isNaN(parseFloat(e)))),m=[],f=g?[`noUi-handle-${window.crypto.randomUUID()}`,`noUi-handle-${window.crypto.randomUUID()}`]:[`noUi-handle-${window.crypto.randomUUID()}`],h=lt();h.setCompareFn(g?ct:(e,t)=>$(e)===$(t)),h.set(l);const $=e=>Number(e.toFixed(a)),v=(e,t)=>{e=Array.isArray(e)?e.map($):$(e),r(3,s=e),"set"===t&&(h.set(e),h.same()||(console.log("dispatch",h.get()),d("updateSlider",h.get())))};return Y((()=>{!function(){const t=document.getElementById(p);let n;e.create(t,{start:l,step:c,connect:!!g||"lower",range:{min:o,max:i},handleAttributes:f.map((e=>({id:e})))}),t.noUiSlider.on("update",(()=>{n=t.noUiSlider.get(!0),v(n,"update")})),t.noUiSlider.on("set",(()=>{n=t.noUiSlider.get(!0),v(n,"set")}))}(),f.map(((e,t)=>{m.push(new pr({target:document.getElementById(e),props:g?{tooltipText:s[t]}:{tooltipText:s}}))}))})),ee((()=>{document.getElementById(p)&&(document.getElementById(p).innerHTML="")})),t.$$set=e=>{"minVal"in e&&r(0,o=e.minVal),"maxVal"in e&&r(1,i=e.maxVal),"start"in e&&r(5,l=e.start),"step"in e&&r(6,c=e.step),"roundTo"in e&&r(7,a=e.roundTo),"title"in e&&r(2,u=e.title)},t.$$.update=()=>{var e;32&t.$$.dirty&&r(3,s=l),8&t.$$.dirty&&(e=s,m.length&&m.map(((t,n)=>t.$set({tooltipText:g?e[n]:e}))))},[o,i,u,s,p,l,c,a]}class fr extends je{constructor(e){super(),Ne(this,e,mr,gr,a,{minVal:0,maxVal:1,start:5,step:6,roundTo:7,title:2})}}function hr(e){let t,n,s;return{c(){t=L("input"),U(t,"type","checkbox"),U(t,"class","is-clickable svelte-1dcwq47"),U(t,"id",e[4]),U(t,"name",e[4])},m(r,o){T(r,t,o),n||(s=A(t,"click",e[5]),n=!0)},p:r,d(e){e&&P(t),n=!1,s()}}}function $r(e){let t,n,s;return{c(){t=L("input"),U(t,"type","checkbox"),U(t,"class","is-clickable svelte-1dcwq47"),U(t,"id",e[4]),U(t,"name",e[4]),t.checked=!0},m(r,o){T(r,t,o),n||(s=A(t,"click",e[5]),n=!0)},p:r,d(e){e&&P(t),n=!1,s()}}}function vr(e){let t,n,s,o,i,l,c,a;function u(e,t){return!0===e[1]?$r:hr}let d=u(e),p=d(e);return{c(){t=L("div"),n=L("span"),s=L("span"),o=L("span"),p.c(),i=_(),l=L("label"),c=j(e[0]),U(o,"class","switch-control svelte-1dcwq47"),U(s,"class","switch svelte-1dcwq47"),U(n,"class","switch-wrapper"),U(l,"for",e[4]),U(l,"class","is-clickable svelte-1dcwq47"),U(t,"class",a="input-checkbox-wrapper "+(e[2]?"button is-clickable":"is-flex is-align-items-center is-justify-content-center")+" "+(e[3]?"is-checked":"")+" svelte-1dcwq47")},m(e,r){T(e,t,r),S(t,n),S(n,s),S(s,o),p.m(o,null),S(t,i),S(t,l),S(l,c)},p(e,[n]){d===(d=u(e))&&p?p.p(e,n):(p.d(1),p=d(e),p&&(p.c(),p.m(o,null))),1&n&&D(c,e[0]),12&n&&a!==(a="input-checkbox-wrapper "+(e[2]?"button is-clickable":"is-flex is-align-items-center is-justify-content-center")+" "+(e[3]?"is-checked":"")+" svelte-1dcwq47")&&U(t,"class",a)},i:r,o:r,d(e){e&&P(t),p.d()}}}function wr(e,t,n){let r,{checkboxLabel:s}=t,{start:o=!1}=t,{buttonDisplay:i=!1}=t;const l=`input-input-checkbox-wrapper-${window.crypto.randomUUID()}`,c=te();return e.$$set=e=>{"checkboxLabel"in e&&n(0,s=e.checkboxLabel),"start"in e&&n(1,o=e.start),"buttonDisplay"in e&&n(2,i=e.buttonDisplay)},e.$$.update=()=>{2&e.$$.dirty&&n(3,r=o)},[s,o,i,r,l,()=>{n(3,r=!r),c("updateChecked",r)}]}class br extends je{constructor(e){super(),Ne(this,e,wr,vr,a,{checkboxLabel:0,start:1,buttonDisplay:2})}}function yr(e){let t,n;return{c(){t=L("label"),n=j(e[2]),U(t,"for",e[4])},m(e,r){T(e,t,r),S(t,n)},p(e,t){4&t&&D(n,e[2])},d(e){e&&P(t)}}}function xr(e){let t;return{c(){t=L("select"),U(t,"id",e[4]),U(t,"name",e[4]),U(t,"aria-label",e[2]),U(t,"class","m-1")},m(e,n){T(e,t,n)},p(e,n){4&n&&U(t,"aria-label",e[2])},i:r,o:r,d(e){e&&P(t)}}}function kr(e){let t,n,r,s=e[3].length&&Ir(e);return{c(){s&&s.c(),t=_(),n=L("select"),U(n,"id",e[4]),U(n,"name",e[4]),U(n,"aria-label",e[2]),U(n,"class","m-1"),n.multiple=!0},m(e,o){s&&s.m(e,o),T(e,t,o),T(e,n,o),r=!0},p(e,o){e[3].length?s?(s.p(e,o),8&o&&ye(s,1)):(s=Ir(e),s.c(),ye(s,1),s.m(t.parentNode,t)):s&&(we(),xe(s,1,1,(()=>{s=null})),be()),(!r||4&o)&&U(n,"aria-label",e[2])},i(e){r||(ye(s),r=!0)},o(e){xe(s),r=!1},d(e){s&&s.d(e),e&&P(t),e&&P(n)}}}function Ir(e){let t,n,r,s,o,i,l=e[3].length+"";return o=new pr({props:{targetHtmlId:e[5],tooltipText:`${e[3].length}\n                                    ${"fr"===Ve&&e[3].length>1?"valeurs sélectionnées":"fr"===Ve&&1===e[3].length?"valeur sélectionnée":"en"===Ve&&e[3].length>1?"selected values":"selected value"}`}}),{c(){t=L("span"),n=L("span"),r=j(l),s=_(),Te(o.$$.fragment),U(n,"id",e[5]),U(n,"class","input-dropdown-count tag m-1 svelte-xzv6o5"),U(t,"class","is-relative")},m(e,l){T(e,t,l),S(t,n),S(n,r),S(t,s),Pe(o,t,null),i=!0},p(e,t){(!i||8&t)&&l!==(l=e[3].length+"")&&D(r,l);const n={};8&t&&(n.tooltipText=`${e[3].length}\n                                    ${"fr"===Ve&&e[3].length>1?"valeurs sélectionnées":"fr"===Ve&&1===e[3].length?"valeur sélectionnée":"en"===Ve&&e[3].length>1?"selected values":"selected value"}`),o.$set(n)},i(e){i||(ye(o.$$.fragment,e),i=!0)},o(e){xe(o.$$.fragment,e),i=!1},d(e){e&&P(t),Oe(o)}}}function Cr(e){let t,n,r,s,o,i,l,c=void 0!==e[2]&&yr(e);const a=[kr,xr],u=[];function d(e,t){return e[0]?0:1}return s=d(e),o=u[s]=a[s](e),{c(){t=L("div"),c&&c.c(),n=_(),r=L("div"),o.c(),U(r,"class",i="input-dropdown-select "+(e[0]?"is-multiple":"is-single")+" "+(e[0]&&e[3].length?"is-flex is-justify-content-flex-start is-align-items-center":"")+" "+(e[1]?"light-display":"")+" svelte-xzv6o5"),U(t,"class","input-dropdown-select-wrapper")},m(e,o){T(e,t,o),c&&c.m(t,null),S(t,n),S(t,r),u[s].m(r,null),l=!0},p(e,[p]){void 0!==e[2]?c?c.p(e,p):(c=yr(e),c.c(),c.m(t,n)):c&&(c.d(1),c=null);let g=s;s=d(e),s===g?u[s].p(e,p):(we(),xe(u[g],1,1,(()=>{u[g]=null})),be(),o=u[s],o?o.p(e,p):(o=u[s]=a[s](e),o.c()),ye(o,1),o.m(r,null)),(!l||11&p&&i!==(i="input-dropdown-select "+(e[0]?"is-multiple":"is-single")+" "+(e[0]&&e[3].length?"is-flex is-justify-content-flex-start is-align-items-center":"")+" "+(e[1]?"light-display":"")+" svelte-xzv6o5"))&&U(r,"class",i)},i(e){l||(ye(o),l=!0)},o(e){xe(o),l=!1},d(e){e&&P(t),c&&c.d(),u[s].d()}}}function Sr(e,t,r){let s,o,{choicesItems:i}=t,{start:l=[]}=t,{multiple:c}=t,{searchable:a=!0}=t,{lightDisplay:u=!1}=t,{placeholder:d=("fr"===Ve?"Sélectionner une valeur":"Select a value")}=t,{title:p}=t,{selectAll:g=!!c}=t;const m=`input-dropdown-select-${window.crypto.randomUUID()}`,f=`input-dropdown-counter-${window.crypto.randomUUID()}`,h=`select-all-${window.crypto.randomUUID()}`,$=`unselect-all-${window.crypto.randomUUID()}`,v=te();let w;const b=lt();b.setCompareFn(ct);const y=(e,t)=>((e,t)=>t?[{value:h,label:`<b>${"fr"===Ve?"Tout sélectionner":"Select all"}</b>`},{value:$,label:`<b>${"fr"===Ve?"Tout retirer":"Remove all"}</b>`},...e]:e)(e,t).map((e=>{var t,n,r;return e.id=`dropdown-choice-${window.crypto.randomUUID()}`,e.label=`<span>\n            ${t=e.prefix||"",n=e.prefixType||"",null!=t&&null!=n&&t.length&&n.length?`<span class="dropdown-prefix-wrapper">${"iconify"===n?(r=t,`<span class="iconify" data-icon=${r}/>`):t}</span>`:""}\n            <span class="dropdown-prefix-text">${e.label}</span>\n        </span>`,e}));const x=(e,t,n,s,i,l)=>(s=structuredClone(s),n=structuredClone(n),e.detail.value===i?(r(11,o=!0),setTimeout((()=>r(11,o=!1)),250),n=n.map((e=>[i,l].includes(e.value)?{...e,selected:!1}:{...e,selected:!0})),t.removeActiveItems().clearChoices(!0,!0).setValue(n).hideDropdown(),s=[...new Set(n.filter((e=>!0===e.selected)).map((e=>e.value)))]):e.detail.value===l?(t.removeActiveItems().hideDropdown(),s=[]):s=!0===c?[...s,e.detail.value]:[e.detail.value],[...new Set(s)]);function k(e,t){const o=document.getElementById(m);w=new n(o,{items:[],choices:e,addChoices:!1,addItems:!1,removeItems:!0,removeItemButton:!0,searchEnabled:a,allowHTML:!0,shouldSort:!t,sorter:(e,t)=>e.label.localeCompare(t.label),placeholderValue:d,classNames:{item:["choices__item","dropdown-item"]},loadingText:"fr"===Ve?"Chargement...":"Loading...",noResultsText:"fr"===Ve?"Pas de résultats":"No results found",noChoicesText:"fr"===Ve?"Pas de choix pour faire la sélection":"No choices to choose from",itemSelectText:"fr"===Ve?"Cliquer pour sélectionner":"Press to select",uniqueItemText:"fr"===Ve?"Seules des valeurs uniques peuvent être ajoutées":"Only unique values can be added",customAddItemText:"fr"===Ve?"Les valeurs ne répondent pas aux conditions attendues":"Only values matching specific conditions can be added",removeItemIconText:"fr"===Ve?"Retirer l'item":"Remove item",addItemText:e=>"fr"===Ve?`Cliquer sur Entrer pour ajouter <b>${e}</b>`:`Press Enter to add <b>"${e}"</b>`,removeItemLabelText:e=>"fr"===Ve?`Retirer l'item: ${e}`:`Remove item: ${e}`,maxItemText:e=>"fr"===Ve?`Seulement ${e} items peuvent être ajoutées`:`Only ${e} items can be added`}),o.addEventListener("addItem",(t=>{r(3,s=x(t,w,e,s,h,$))})),o.addEventListener("removeItem",(e=>{r(3,s=((e,t)=>structuredClone(t).filter((t=>t!==e.detail.value)))(e,s))}))}return Y((()=>{k(function(e,t,n){return e=structuredClone(e),t=structuredClone(t),e=y(e,n).map((e=>t.includes(e.value)?{...e,selected:!0}:{...e,selected:!1})),r(3,s=t),e}(i,l,g),g)})),ee((()=>{w.destroy(),w=void 0})),e.$$set=e=>{"choicesItems"in e&&r(6,i=e.choicesItems),"start"in e&&r(7,l=e.start),"multiple"in e&&r(0,c=e.multiple),"searchable"in e&&r(8,a=e.searchable),"lightDisplay"in e&&r(1,u=e.lightDisplay),"placeholder"in e&&r(9,d=e.placeholder),"title"in e&&r(2,p=e.title),"selectAll"in e&&r(10,g=e.selectAll)},e.$$.update=()=>{var t;2056&e.$$.dirty&&(t=s,o||(b.set(t),b.same()||v("updateValues",s)))},r(3,s=[]),r(11,o=!1),[c,u,p,s,m,f,i,l,a,d,g,o]}class Er extends je{constructor(e){super(),Ne(this,e,Sr,Cr,a,{choicesItems:6,start:7,multiple:0,searchable:8,lightDisplay:1,placeholder:9,title:2,selectAll:10})}}function Rr(e){let t,n,r,s,o,i;return o=new pr({props:{tooltipText:e[2]}}),{c(){t=L("div"),n=L("button"),r=L("span"),s=_(),Te(o.$$.fragment),U(r,"class","iconify"),U(r,"data-icon",e[0]),U(r,"title",e[1]),U(n,"class","svelte-gmxkvo"),U(t,"class","is-inline-block icon-tooltip svelte-gmxkvo")},m(e,l){T(e,t,l),S(t,n),S(n,r),S(n,s),Pe(o,n,null),i=!0},p(e,[t]){(!i||1&t)&&U(r,"data-icon",e[0]),(!i||2&t)&&U(r,"title",e[1]);const n={};4&t&&(n.tooltipText=e[2]),o.$set(n)},i(e){i||(ye(o.$$.fragment,e),i=!0)},o(e){xe(o.$$.fragment,e),i=!1},d(e){e&&P(t),Oe(o)}}}function Tr(e,t,n){let{iconifyIcon:r,altText:s,tooltipText:o}=t;return e.$$set=e=>{"iconifyIcon"in e&&n(0,r=e.iconifyIcon),"altText"in e&&n(1,s=e.altText),"tooltipText"in e&&n(2,o=e.tooltipText)},[r,s,o]}class Pr extends je{constructor(e){super(),Ne(this,e,Tr,Rr,a,{iconifyIcon:0,altText:1,tooltipText:2})}}const{window:Or}=C;function Lr(e){let t,n;return t=new Er({props:{choicesItems:e[6],multiple:!0,placeholder:"...",start:Object.keys(e[7][e[18]]||{}),lightDisplay:!0,title:"fr"===Ve?"Régions sélectionnées":"Selected regions",selectAll:!0}}),t.$on("updateValues",e[28]),{c(){Te(t.$$.fragment)},m(e,r){Pe(t,e,r),n=!0},p(e,n){const r={};64&n[0]&&(r.choicesItems=e[6]),128&n[0]&&(r.start=Object.keys(e[7][e[18]]||{})),t.$set(r)},i(e){n||(ye(t.$$.fragment,e),n=!0)},o(e){xe(t.$$.fragment,e),n=!1},d(e){Oe(t,e)}}}function Nr(e){return{c:r,m:r,p:r,i:r,o:r,d:r}}function jr(e){let t,n,r=e[35].length&&function(e){let t,n;return t=new fr({props:{title:"fr"===Ve?"Score minimal":"Minimal score",minVal:e[35][0],maxVal:e[35][1],start:e[3]||e[35][0],roundTo:3}}),t.$on("updateSlider",e[24]),{c(){Te(t.$$.fragment)},m(e,r){Pe(t,e,r),n=!0},p(e,n){const r={};8&n[0]&&(r.start=e[3]||e[35][0]),t.$set(r)},i(e){n||(ye(t.$$.fragment,e),n=!0)},o(e){xe(t.$$.fragment,e),n=!1},d(e){Oe(t,e)}}}(e);return{c(){r&&r.c(),t=M()},m(e,s){r&&r.m(e,s),T(e,t,s),n=!0},p(e,t){e[35].length&&r.p(e,t)},i(e){n||(ye(r),n=!0)},o(e){xe(r),n=!1},d(e){r&&r.d(e),e&&P(t)}}}function _r(e){return{c:r,m:r,p:r,i:r,o:r,d:r}}function Mr(e){let t,n,r,s,o,i,l,c,a,u,d,p,g,m,f,h,$,v,w,b,y,x,k,I;return c=new Er({props:{choicesItems:e[20],multiple:!0,placeholder:"...",start:e[8],lightDisplay:!0,title:"fr"===Ve?"Catégories masquées":"Hidden categories",selectAll:!0}}),c.$on("updateValues",e[25]),f=new Pr({props:{iconifyIcon:"material-symbols:help-outline",altText:"en"===Ve?"Display help":"Afficher une explication",tooltipText:e[19]}}),w=new fr({props:{title:"fr"===Ve?"Profondeur de récursion":"Recursion depth",minVal:e[17][0],maxVal:e[17][1],start:e[9],step:1}}),w.$on("updateSlider",e[26]),x=new br({props:{checkboxLabel:"Filter by region",start:e[10],buttonDisplay:!0}}),x.$on("updateChecked",e[27]),{c(){t=L("div"),n=L("div"),r=L("div"),s=L("div"),s.innerHTML='<span class="tag is-medium is-link">Similarity</span>',o=_(),i=L("div"),l=L("div"),Te(c.$$.fragment),a=_(),u=L("div"),d=L("div"),p=L("div"),g=L("span"),g.textContent="Propagation",m=_(),Te(f.$$.fragment),h=_(),$=L("div"),v=L("div"),Te(w.$$.fragment),b=_(),y=L("div"),Te(x.$$.fragment),U(s,"class","ctrl-block-title svelte-1st7g3f"),U(l,"class","ctrl-input svelte-1st7g3f"),U(i,"class","ctrl-block-inputs svelte-1st7g3f"),U(r,"class","ctrl-block svelte-1st7g3f"),U(n,"class","ctrl-block-wrapper svelte-1st7g3f"),U(g,"class","tag is-medium is-link mr-1"),U(p,"class","ctrl-block-title svelte-1st7g3f"),U(v,"class","ctrl-input svelte-1st7g3f"),U(y,"class","ctrl-input svelte-1st7g3f"),U($,"class","ctrl-block-inputs svelte-1st7g3f"),U(d,"class","ctrl-block svelte-1st7g3f"),U(u,"class","ctrl-block-wrapper svelte-1st7g3f"),U(t,"class","ctrl-extra svelte-1st7g3f")},m(e,k){T(e,t,k),S(t,n),S(n,r),S(r,s),S(r,o),S(r,i),S(i,l),Pe(c,l,null),S(t,a),S(t,u),S(u,d),S(d,p),S(p,g),S(p,m),Pe(f,p,null),S(d,h),S(d,$),S($,v),Pe(w,v,null),S($,b),S($,y),Pe(x,y,null),I=!0},p(e,t){const n={};256&t[0]&&(n.start=e[8]),c.$set(n);const r={};512&t[0]&&(r.start=e[9]),w.$set(r);const s={};1024&t[0]&&(s.start=e[10]),x.$set(s)},i(e){I||(ye(c.$$.fragment,e),ye(f.$$.fragment,e),ye(w.$$.fragment,e),ye(x.$$.fragment,e),ue((()=>{I&&(k||(k=Ie(t,Ae,{axis:"y"},!0)),k.run(1))})),I=!0)},o(e){xe(c.$$.fragment,e),xe(f.$$.fragment,e),xe(w.$$.fragment,e),xe(x.$$.fragment,e),k||(k=Ie(t,Ae,{axis:"y"},!1)),k.run(0),I=!1},d(e){e&&P(t),Oe(c),Oe(f),Oe(w),Oe(x),e&&k&&k.end()}}}function Ar(e){let t,n,r,s,o,i,c,a,u,d,p,g,m,f,h,$,v,w,b,y,x,k,I,C=Object.keys(e[6]).length;ue(e[30]);let E=C&&Lr(e),R={ctx:e,current:null,token:null,hasCatch:!1,pending:_r,then:jr,catch:Nr,value:35,blocks:[,,,]};Ce(e[22],R);let O=e[2]&&Mr(e);return w=new pr({props:{tooltipText:e[4]}}),{c(){t=L("div"),n=L("form"),r=L("div"),s=L("div"),o=L("div"),i=L("div"),c=L("div"),E&&E.c(),a=_(),u=L("div"),R.block.c(),d=_(),O&&O.c(),p=_(),g=L("div"),m=L("button"),f=N("svg"),h=N("path"),v=_(),Te(w.$$.fragment),U(c,"class","ctrl-input svelte-1st7g3f"),U(u,"class","ctrl-input svelte-1st7g3f"),U(i,"class","ctrl-block-inputs svelte-1st7g3f"),U(o,"class","ctrl-block svelte-1st7g3f"),U(s,"class","ctrl-block-wrapper svelte-1st7g3f"),U(r,"class","ctrl-base svelte-1st7g3f"),U(h,"fill","none"),U(h,"stroke","currentColor"),U(h,"stroke-linecap","round"),U(h,"stroke-linejoin","round"),U(h,"stroke-width","1.5"),U(h,"d","M12 3v18m0 0l8.5-8.5M12 21l-8.5-8.5"),U(f,"style",$=`transform: rotate(${e[2]?"180":"0"}deg)`),U(f,"xmlns","http://www.w3.org/2000/svg"),U(f,"width","24"),U(f,"height","24"),U(f,"viewBox","0 0 24 24"),U(f,"class","svelte-1st7g3f"),U(m,"class","button is-link svelte-1st7g3f"),U(g,"class","ctrl-toggle svelte-1st7g3f"),U(n,"class","ctrl svelte-1st7g3f"),U(t,"class",b="ctrl-wrapper is-flex is-justify-content-center is-align-items-center "+(e[2]?"toolbar-expanded":"toolbar-collapsed")+" svelte-1st7g3f"),U(t,"style",y=e[5]?`top: ${e[5]}px`:"")},m(l,$){T(l,t,$),S(t,n),S(n,r),S(r,s),S(s,o),S(o,i),S(i,c),E&&E.m(c,null),S(i,a),S(i,u),R.block.m(u,R.anchor=null),R.mount=()=>u,R.anchor=null,S(n,d),O&&O.m(n,null),S(n,p),S(n,g),S(g,m),S(m,f),S(f,h),S(m,v),Pe(w,m,null),x=!0,k||(I=[A(Or,"resize",e[30]),A(m,"click",q(e[23]))],k=!0)},p(r,s){e=r,64&s[0]&&(C=Object.keys(e[6]).length),C?E?(E.p(e,s),64&s[0]&&ye(E,1)):(E=Lr(e),E.c(),ye(E,1),E.m(c,null)):E&&(we(),xe(E,1,1,(()=>{E=null})),be()),Se(R,e,s),e[2]?O?(O.p(e,s),4&s[0]&&ye(O,1)):(O=Mr(e),O.c(),ye(O,1),O.m(n,p)):O&&(we(),xe(O,1,1,(()=>{O=null})),be()),(!x||4&s[0]&&$!==($=`transform: rotate(${e[2]?"180":"0"}deg)`))&&U(f,"style",$);const o={};16&s[0]&&(o.tooltipText=e[4]),w.$set(o),(!x||4&s[0]&&b!==(b="ctrl-wrapper is-flex is-justify-content-center is-align-items-center "+(e[2]?"toolbar-expanded":"toolbar-collapsed")+" svelte-1st7g3f"))&&U(t,"class",b),(!x||32&s[0]&&y!==(y=e[5]?`top: ${e[5]}px`:""))&&U(t,"style",y)},i(e){x||(ye(E),ye(R.block),ye(O),ye(w.$$.fragment,e),x=!0)},o(e){xe(E);for(let e=0;e<3;e+=1){xe(R.blocks[e])}xe(O),xe(w.$$.fragment,e),x=!1},d(e){e&&P(t),E&&E.d(),R.block.d(),R.token=null,R=null,O&&O.d(),Oe(w),k=!1,l(I)}}}function qr(e,t,n){let r,s,o,i,l,c,a,u,d,p,g;const{selectedRegions:f,comparedRegions:h,excludedCategories:$,similarityScoreCutoff:v,propagateRecursionDepth:w,propagateFilterByRegions:b,allowedPropagateDepthRange:y}=Wt;m(e,f,(e=>n(7,u=e))),m(e,h,(e=>n(31,l=e))),m(e,$,(e=>n(8,d=e))),m(e,v,(e=>n(29,c=e))),m(e,w,(e=>n(9,p=e))),m(e,b,(e=>n(10,g=e)));const x=window.location.pathname.match(/\d+/g).join("-"),k=`${window.location.origin}${window.location.pathname}`,I="en"===Ve?"Propagated matches are exact matches to images that have an exact match with the current image. There may be up to 6 exact matches connecting the current image and propagated images.":"Les correspondances propagées correspondent à des correspondances exactes à des images ayant une correspondance exacte avec l'image actuelle. Il peut y avoir jusqu'à 6 images reliant l'image actuelle à une correspondance propagée.",C=[{value:1,label:fn,prefix:un,prefixType:"svg"},{value:2,label:hn,prefix:dn,prefixType:"svg"},{value:3,label:$n,prefix:pn,prefixType:"svg"},{value:4,label:vn,prefix:gn,prefixType:"svg"},{value:5,label:wn,prefix:mn,prefixType:"svg"}],S=De(h,(e=>Object.entries(e).map((([e,t])=>({prefix:`#${t.id}`,prefixType:"text",value:e,label:et(t.title.replace(/^[^|]+/,""))})))));m(e,S,(e=>n(6,a=e)));const E=async function(){let e=[];return await fetch(`${k}similarity-score-range`).then((e=>e.json())).then((t=>(e=[t.min,t.max],e.every((e=>"number"==typeof e))?n(3,r=c&&e[0]<=c&&e[1]>=c?c:e[0]):(console.error(`fetchSimilarityScoreRange: expected '[number, number]', got '${e}'. Defaulting to '[]'`),e=[]),e))).catch((t=>(console.error("Error on fetchSimilarityScoreRange:",t),errorMsg.set(t.message),e)))}();let R,T;return e.$$.update=()=>{536870912&e.$$.dirty[0]&&n(3,r=c||void 0),3&e.$$.dirty[0]&&n(5,s=document.querySelector("#nav-actions")?.offsetHeight),4&e.$$.dirty[0]&&n(4,i="fr"===Ve&&o?"Refermer le menu de recherche":"fr"!==Ve||o?"en"===Ve&&o?"Collapse the toolbar":"Expand the toolbar":"Ouvrir le menu de recherche")},n(2,o=!1),[R,T,o,r,i,s,a,u,d,p,g,f,h,$,v,w,b,y,x,I,C,S,E,()=>n(2,o=!o),e=>v.set(e.detail),e=>$.set(e.detail),e=>w.set(e.detail),e=>b.set(e.detail),e=>{const t=e.detail,n={[x]:{}};Object.keys(l).forEach((e=>{t.includes(e)&&(n[x][e]=l[e])})),f.set(n)},c,function(){n(0,R=Or.innerWidth),n(1,T=Or.innerHeight)}]}class Ur extends je{constructor(e){super(),Ne(this,e,qr,Ar,a,{},null,[-1,-1])}}function Dr(e){let t,n;return t=new Ur({}),{c(){Te(t.$$.fragment)},m(e,r){Pe(t,e,r),n=!0},i(e){n||(ye(t.$$.fragment,e),n=!0)},o(e){xe(t.$$.fragment,e),n=!1},d(e){Oe(t,e)}}}function Vr(e){let t,n;return t=new ar({}),{c(){Te(t.$$.fragment)},m(e,r){Pe(t,e,r),n=!0},p:r,i(e){n||(ye(t.$$.fragment,e),n=!0)},o(e){xe(t.$$.fragment,e),n=!1},d(e){Oe(t,e)}}}function Fr(e){let t,n;return t=new Kt({props:{$$slots:{default:[Jr]},$$scope:{ctx:e}}}),{c(){Te(t.$$.fragment)},m(e,r){Pe(t,e,r),n=!0},p(e,n){const r={};36&n&&(r.$$scope={dirty:n,ctx:e}),t.$set(r)},i(e){n||(ye(t.$$.fragment,e),n=!0)},o(e){xe(t.$$.fragment,e),n=!1},d(e){Oe(t,e)}}}function zr(e){let t,n;return t=new Kt({props:{$$slots:{default:[Xr]},$$scope:{ctx:e}}}),{c(){Te(t.$$.fragment)},m(e,r){Pe(t,e,r),n=!0},p(e,n){const r={};32&n&&(r.$$scope={dirty:n,ctx:e}),t.$set(r)},i(e){n||(ye(t.$$.fragment,e),n=!0)},o(e){xe(t.$$.fragment,e),n=!1},d(e){Oe(t,e)}}}function Br(e){let t,n;return{c(){t=j("Erreur lors de la récupération des similarités : "),n=j(e[2])},m(e,r){T(e,t,r),T(e,n,r)},p(e,t){4&t&&D(n,e[2])},d(e){e&&P(t),e&&P(n)}}}function Hr(e){let t,n;return{c(){t=j("Error when retrieving similarities: "),n=j(e[2])},m(e,r){T(e,t,r),T(e,n,r)},p(e,t){4&t&&D(n,e[2])},d(e){e&&P(t),e&&P(n)}}}function Jr(e){let t;let n=("en"===Ve?Hr:Br)(e);return{c(){t=L("tr"),n.c(),U(t,"class","faded is-center")},m(e,r){T(e,t,r),n.m(t,null)},p(e,t){n.p(e,t)},d(e){e&&P(t),n.d()}}}function Xr(e){let t;return{c(){t=L("tr"),t.textContent=""+("en"===Ve?"Retrieving similarities...":"Récupération des similarités..."),U(t,"class","faded is-center")},m(e,n){T(e,t,n)},p:r,d(e){e&&P(t)}}}function Zr(e){let t,n,r=He.includes("similarity"),s=r&&function(e){let t,n,r,s,o,i=Object.keys(e[0]).length,l=i&&Dr();const c=[zr,Fr,Vr],a=[];function u(e,t){return e[1]?0:e[2]?1:2}return n=u(e),r=a[n]=c[n](e),{c(){l&&l.c(),t=_(),r.c(),s=M()},m(e,r){l&&l.m(e,r),T(e,t,r),a[n].m(e,r),T(e,s,r),o=!0},p(e,o){1&o&&(i=Object.keys(e[0]).length),i?l?1&o&&ye(l,1):(l=Dr(),l.c(),ye(l,1),l.m(t.parentNode,t)):l&&(we(),xe(l,1,1,(()=>{l=null})),be());let d=n;n=u(e),n===d?a[n].p(e,o):(we(),xe(a[d],1,1,(()=>{a[d]=null})),be(),r=a[n],r?r.p(e,o):(r=a[n]=c[n](e),r.c()),ye(r,1),r.m(s.parentNode,s))},i(e){o||(ye(l),ye(r),o=!0)},o(e){xe(l),xe(r),o=!1},d(e){l&&l.d(e),e&&P(t),a[n].d(e),e&&P(s)}}}(e);return{c(){s&&s.c(),t=M()},m(e,r){s&&s.m(e,r),T(e,t,r),n=!0},p(e,[t]){r&&s.p(e,t)},i(e){n||(ye(s),n=!0)},o(e){xe(s),n=!1},d(e){s&&s.d(e),e&&P(t)}}}function Wr(e,t,n){let r,s,o;m(e,Qe,(e=>n(1,s=e))),m(e,Ke,(e=>n(2,o=e)));const{fetchSimilarity:i,comparedRegions:l}=Wt;return m(e,l,(e=>n(0,r=e))),Y((()=>{He.includes("similarity")&&i()})),[r,s,o,l]}class Gr extends je{constructor(e){super(),Ne(this,e,Wr,Zr,a,{})}}function Qr(e){let t,n,r,s,o,i,l,c,a,u,p,g,m,h,b,y,x,k;const I=e[4].default,C=f(I,e,e[3],null);return{c(){t=L("tr"),n=L("th"),r=L("div"),s=L("img"),l=_(),c=L("div"),a=L("a"),u=L("i"),p=j("\n                    Page "),g=j(e[0]),h=_(),b=L("td"),y=L("div"),x=L("div"),C&&C.c(),d(s.src,o=rt(e[1],"full","250,"))||U(s,"src",o),U(s,"alt",i="Canvas "+e[0]),U(s,"class","mb-3 card"),U(u,"class","fa-solid fa-pen-to-square"),U(a,"class","tag px-2 py-1 is-rounded is-hoverable"),U(a,"href",m=st(e[2],e[0])),U(a,"target","_blank"),U(c,"class","is-center mb-1"),U(r,"class","content-wrapper py-5"),U(n,"class","is-3 center-flex is-narrow"),F(n,"width","260px"),U(x,"class","grid is-gap-2"),U(y,"class","fixed-grid has-6-cols"),U(b,"class","p-5 is-fullwidth")},m(e,o){T(e,t,o),S(t,n),S(n,r),S(r,s),S(r,l),S(r,c),S(c,a),S(a,u),S(a,p),S(a,g),S(t,h),S(t,b),S(b,y),S(y,x),C&&C.m(x,null),k=!0},p(e,[t]){(!k||2&t&&!d(s.src,o=rt(e[1],"full","250,")))&&U(s,"src",o),(!k||1&t&&i!==(i="Canvas "+e[0]))&&U(s,"alt",i),(!k||1&t)&&D(g,e[0]),(!k||1&t&&m!==(m=st(e[2],e[0])))&&U(a,"href",m),C&&C.p&&(!k||8&t)&&v(C,I,e,e[3],k?$(I,e[3],t,null):w(e[3]),null)},i(e){k||(ye(C,e),k=!0)},o(e){xe(C,e),k=!1},d(e){e&&P(t),C&&C.d(e)}}}function Kr(e,t,n){let{$$slots:r={},$$scope:s}=t,{canvasNb:o}=t,{canvasImg:i}=t;const l=re("manifest");return e.$$set=e=>{"canvasNb"in e&&n(0,o=e.canvasNb),"canvasImg"in e&&n(1,i=e.canvasImg),"$$scope"in e&&n(3,s=e.$$scope)},[o,i,l,s,r]}class Yr extends je{constructor(e){super(),Ne(this,e,Kr,Qr,a,{canvasNb:0,canvasImg:1})}}function es(e,t,n){const r=e.slice();return r[9]=t[n][0],r[10]=t[n][1],r}function ts(e,t,n){const r=e.slice();return r[13]=t[n],r}function ns(e){let t,n,s="en"===Ve?`Error when retrieving paginated regions: ${e[16]}`:`Erreur de récupération des pages : ${e[16]}`;return{c(){t=L("tr"),n=j(s),U(t,"class","faded is-center")},m(e,r){T(e,t,r),S(t,n)},p(e,t){1&t&&s!==(s="en"===Ve?`Error when retrieving paginated regions: ${e[16]}`:`Erreur de récupération des pages : ${e[16]}`)&&D(n,s)},i:r,o:r,d(e){e&&P(t)}}}function rs(e){let t,n,r,s,o;const i=[os,ss],l=[];function c(e,n){return 2&n&&(t=null),null==t&&(t=!!(Object.values(e[1]).length>0)),t?0:1}return n=c(e,-1),r=l[n]=i[n](e),{c(){r.c(),s=M()},m(e,t){l[n].m(e,t),T(e,s,t),o=!0},p(e,t){let o=n;n=c(e,t),n===o?l[n].p(e,t):(we(),xe(l[o],1,1,(()=>{l[o]=null})),be(),r=l[n],r?r.p(e,t):(r=l[n]=i[n](e),r.c()),ye(r,1),r.m(s.parentNode,s))},i(e){o||(ye(r),o=!0)},o(e){xe(r),o=!1},d(e){l[n].d(e),e&&P(s)}}}function ss(e){let t,n,s;return n=new Pt({}),{c(){t=L("tr"),Te(n.$$.fragment)},m(e,r){T(e,t,r),Pe(n,t,null),s=!0},p:r,i(e){s||(ye(n.$$.fragment,e),s=!0)},o(e){xe(n.$$.fragment,e),s=!1},d(e){e&&P(t),Oe(n)}}}function os(e){let t,n,r=Object.entries(e[1]),s=[];for(let t=0;t<r.length;t+=1)s[t]=cs(es(e,r,t));const o=e=>xe(s[e],1,1,(()=>{s[e]=null}));return{c(){for(let e=0;e<s.length;e+=1)s[e].c();t=M()},m(e,r){for(let t=0;t<s.length;t+=1)s[t]&&s[t].m(e,r);T(e,t,r),n=!0},p(e,n){if(34&n){let i;for(r=Object.entries(e[1]),i=0;i<r.length;i+=1){const o=es(e,r,i);s[i]?(s[i].p(o,n),ye(s[i],1)):(s[i]=cs(o),s[i].c(),ye(s[i],1),s[i].m(t.parentNode,t))}for(we(),i=r.length;i<s.length;i+=1)o(i);be()}},i(e){if(!n){for(let e=0;e<r.length;e+=1)ye(s[e]);n=!0}},o(e){s=s.filter(Boolean);for(let e=0;e<s.length;e+=1)xe(s[e]);n=!1},d(e){O(s,e),e&&P(t)}}}function is(e,t){let n,r,s;return r=new xt({props:{item:t[13],isSquare:!1}}),{key:e,first:null,c(){n=M(),Te(r.$$.fragment),this.first=n},m(e,t){T(e,n,t),Pe(r,e,t),s=!0},p(e,n){t=e;const s={};2&n&&(s.item=t[13]),r.$set(s)},i(e){s||(ye(r.$$.fragment,e),s=!0)},o(e){xe(r.$$.fragment,e),s=!1},d(e){e&&P(n),Oe(r,e)}}}function ls(e){let t,n,r=[],s=new Map,o=Object.values(e[10]);const i=e=>e[13].id;for(let t=0;t<o.length;t+=1){let n=ts(e,o,t),l=i(n);s.set(l,r[t]=is(l,n))}return{c(){for(let e=0;e<r.length;e+=1)r[e].c();t=_()},m(e,s){for(let t=0;t<r.length;t+=1)r[t]&&r[t].m(e,s);T(e,t,s),n=!0},p(e,n){2&n&&(o=Object.values(e[10]),we(),r=Re(r,n,i,1,e,o,s,t.parentNode,Ee,is,t,ts),be())},i(e){if(!n){for(let e=0;e<o.length;e+=1)ye(r[e]);n=!0}},o(e){for(let e=0;e<r.length;e+=1)xe(r[e]);n=!1},d(e){for(let t=0;t<r.length;t+=1)r[t].d(e);e&&P(t)}}}function cs(e){let t,n;return t=new Yr({props:{canvasImg:e[5](e[9]),canvasNb:e[9],$$slots:{default:[ls]},$$scope:{ctx:e}}}),{c(){Te(t.$$.fragment)},m(e,r){Pe(t,e,r),n=!0},p(e,n){const r={};2&n&&(r.canvasImg=e[5](e[9])),2&n&&(r.canvasNb=e[9]),131074&n&&(r.$$scope={dirty:n,ctx:e}),t.$set(r)},i(e){n||(ye(t.$$.fragment,e),n=!0)},o(e){xe(t.$$.fragment,e),n=!1},d(e){Oe(t,e)}}}function as(e){let t;return{c(){t=L("tr"),t.textContent=""+("en"===Ve?"Retrieving paginated regions...":"Récupération des pages..."),U(t,"class","faded is-center")},m(e,n){T(e,t,n)},p:r,i:r,o:r,d(e){e&&P(t)}}}function us(e){let t,n,r,s={ctx:e,current:null,token:null,hasCatch:!0,pending:as,then:rs,catch:ns,value:8,error:16,blocks:[,,,]};return Ce(n=e[0],s),{c(){t=M(),s.block.c()},m(e,n){T(e,t,n),s.block.m(e,s.anchor=n),s.mount=()=>t.parentNode,s.anchor=t,r=!0},p(t,r){e=t,s.ctx=e,1&r&&n!==(n=e[0])&&Ce(n,s)||Se(s,e,r)},i(e){r||(ye(s.block),r=!0)},o(e){for(let e=0;e<3;e+=1){xe(s.blocks[e])}r=!1},d(e){e&&P(t),s.block.d(e),s.token=null,s=null}}}function ds(e){let t,n,r,s,o,i;return t=new an({props:{store:ut,nbOfItems:e[4]}}),r=new Kt({props:{$$slots:{default:[us]},$$scope:{ctx:e}}}),o=new an({props:{store:ut,nbOfItems:e[4]}}),{c(){Te(t.$$.fragment),n=_(),Te(r.$$.fragment),s=_(),Te(o.$$.fragment)},m(e,l){Pe(t,e,l),T(e,n,l),Pe(r,e,l),T(e,s,l),Pe(o,e,l),i=!0},p(e,[t]){const n={};131075&t&&(n.$$scope={dirty:t,ctx:e}),r.$set(n)},i(e){i||(ye(t.$$.fragment,e),ye(r.$$.fragment,e),ye(o.$$.fragment,e),i=!0)},o(e){xe(t.$$.fragment,e),xe(r.$$.fragment,e),xe(o.$$.fragment,e),i=!1},d(e){Oe(t,e),e&&P(n),Oe(r,e),e&&P(s),Oe(o,e)}}}function ps(e,t,n){let r,s;const{pageRegions:o,fetchPages:i}=ut;m(e,o,(e=>n(1,s=e))),m(e,i,(e=>n(0,r=e)));const l=re("nbOfPages"),c=re("trailingZeros");return[r,s,o,i,l,function(e){return`${imgPrefix}_${t=e,n=c,t.toString().padStart(n,"0")}`;var t,n}]}class gs extends je{constructor(e){super(),Ne(this,e,ps,ds,a,{})}}function ms(e){let t,n,s,o,i,l,c,a="en"===Ve?"Save selection":"Sauvegarder la sélection";return{c(){t=L("button"),n=L("span"),s=L("i"),o=_(),i=j(a),U(s,"class","fa-solid fa-floppy-disk"),U(t,"class","button is-link")},m(r,a){T(r,t,a),S(t,n),S(n,s),S(n,o),S(n,i),l||(c=A(t,"click",e[6]),l=!0)},p:r,d(e){e&&P(t),l=!1,c()}}}function fs(e){let t,n,r,s,o,i,l="en"===Ve?"Go to treatment":"Accéder au traitement";return{c(){t=L("a"),n=L("span"),r=L("i"),s=_(),o=j(l),U(r,"class","fa-solid fa-gear"),U(t,"class","button is-link"),U(t,"href",i="/"+Fe+"/treatment/add/?document_set="+e[2](e[0]).id)},m(e,i){T(e,t,i),S(t,n),S(n,r),S(n,s),S(n,o)},p(e,n){5&n&&i!==(i="/"+Fe+"/treatment/add/?document_set="+e[2](e[0]).id)&&U(t,"href",i)},d(e){e&&P(t)}}}function hs(e){let t,n,s,o,i,l;function c(e,t){return e[1]?fs:ms}let a=c(e),u=a(e);return{c(){t=L("footer"),n=L("div"),s=L("button"),s.textContent=""+("en"===Ve?"Clear selection":"Vider la sélection"),o=_(),u.c(),U(s,"class","button button-close is-link is-light"),U(n,"class","buttons"),U(t,"class","modal-card-foot is-center")},m(r,c){T(r,t,c),S(t,n),S(n,s),S(n,o),u.m(n,null),i||(l=A(s,"click",e[5]),i=!0)},p(e,[t]){a===(a=c(e))&&u?u.p(e,t):(u.d(1),u=a(e),u&&(u.c(),u.m(n,null)))},i:r,o:r,d(e){e&&P(t),u.d(),i=!1,l()}}}function $s(e,t,n){let r,s;const{isSaved:o,selection:i}=at;m(e,o,(e=>n(1,r=e))),m(e,i,(e=>n(2,s=e)));let{isRegion:l=!0}=t;return e.$$set=e=>{"isRegion"in e&&n(0,l=e.isRegion)},[l,r,s,o,i,()=>at.empty(l),()=>at.save(l)]}class vs extends je{constructor(e){super(),Ne(this,e,$s,hs,a,{isRegion:0})}}function ws(e){let t,n,r,s,o,i,c=e[5](e[0])+"";return{c(){t=L("span"),n=j(c),r=_(),s=L("span"),s.innerHTML='<i class="fas fa-edit"></i>',U(s,"class","pl-3 smaller has-text-link")},m(l,c){T(l,t,c),S(t,n),S(t,r),S(t,s),o||(i=[A(t,"click",e[7]),A(t,"keyup",null)],o=!0)},p(e,t){33&t&&c!==(c=e[5](e[0])+"")&&D(n,c)},d(e){e&&P(t),o=!1,l(i)}}}function bs(e){let t,n,r;return{c(){t=L("input"),U(t,"class","input selection-title svelte-sgypdx")},m(s,o){T(s,t,o),e[12](t),V(t,e[4]),n||(r=[A(t,"input",e[13]),A(t,"keydown",e[8]),A(t,"blur",e[9])],n=!0)},p(e,n){16&n&&t.value!==e[4]&&V(t,e[4])},d(s){s&&P(t),e[12](null),n=!1,l(r)}}}function ys(e){let t,n,r,s,o,i,l,c,a,u,d,p,g,m,h,b,y,x;function k(e,t){return e[2]?bs:ws}let I=k(e),C=I(e);const E=e[11].default,R=f(E,e,e[10],null);return y=new vs({props:{isRegion:e[0]}}),{c(){t=L("div"),n=L("div"),r=_(),s=L("div"),o=L("div"),i=L("div"),l=L("i"),c=_(),C.c(),a=j("\n                ("),u=j(e[1]),d=j(")"),p=_(),g=L("button"),m=_(),h=L("section"),R&&R.c(),b=_(),Te(y.$$.fragment),U(n,"class","modal-background"),U(l,"class","fa-solid fa-book-bookmark"),U(i,"class","title is-4 mb-0 media-content"),U(g,"class","delete media-left"),U(g,"aria-label","close"),U(o,"class","modal-card-head media mb-0 is-middle"),U(h,"class","modal-card-body"),U(s,"class","modal-content"),U(t,"id","selection-modal"),U(t,"class","modal fade"),U(t,"tabindex","-1"),U(t,"aria-labelledby","selection-modal-label"),U(t,"aria-hidden","true")},m(e,f){T(e,t,f),S(t,n),S(t,r),S(t,s),S(s,o),S(o,i),S(i,l),S(i,c),C.m(i,null),S(i,a),S(i,u),S(i,d),S(o,p),S(o,g),S(s,m),S(s,h),R&&R.m(h,null),S(s,b),Pe(y,s,null),x=!0},p(e,[t]){I===(I=k(e))&&C?C.p(e,t):(C.d(1),C=I(e),C&&(C.c(),C.m(i,a))),(!x||2&t)&&D(u,e[1]),R&&R.p&&(!x||1024&t)&&v(R,E,e,e[10],x?$(E,e[10],t,null):w(e[10]),null);const n={};1&t&&(n.isRegion=e[0]),y.$set(n)},i(e){x||(ye(R,e),ye(y.$$.fragment,e),x=!0)},o(e){xe(R,e),xe(y.$$.fragment,e),x=!1},d(e){e&&P(t),C.d(),R&&R.d(e),Oe(y)}}}function xs(e,t,n){let r,{$$slots:s={},$$scope:o}=t;const{selectionTitle:i,updateTitle:l,save:c}=at;m(e,i,(e=>n(5,r=e)));let a,u,{isRegion:d=!1}=t,{selectionLength:p=!1}=t,g=!1;function f(){n(2,g=!1),l(u,d),c(d)}return e.$$set=e=>{"isRegion"in e&&n(0,d=e.isRegion),"selectionLength"in e&&n(1,p=e.selectionLength),"$$scope"in e&&n(10,o=e.$$scope)},[d,p,g,a,u,r,i,function(){n(2,g=!0),n(4,u=r(d)),setTimeout((()=>a&&a.focus()),0)},function(e){"Enter"===e.key&&f()},f,o,s,function(e){oe[e?"unshift":"push"]((()=>{a=e,n(3,a)}))},function(){u=this.value,n(4,u)}]}class ks extends je{constructor(e){super(),Ne(this,e,xs,ys,a,{isRegion:0,selectionLength:1})}}const Is=function(){const e=`${window.location.origin}${window.location.pathname}`,t=Ue(1),n=Ue([]),r=Ue([]),s=(async()=>{const t=await fetch(`${e}vectorized-images`).then((e=>e.json())).then((e=>(n.set(e),e))).catch((e=>console.error("Error:",e)));return l(o()),t})(),o=()=>tt(t,"vp"),i=De(t,(e=>(async()=>function(e){const t=49*(e-1),s=t+49,o=g(n).slice(t,s);return r.set(o),o}(e))()));function l(e){nt(e,t,"vp")}return{currentPage:t,pageLength:49,vectImgs:n,fetchVectorization:s,setPageVectImgs:i,pageVectImgs:r,handlePageUpdate:l}}();function Cs(e){let t,n;return{c(){t=new H(!1),n=M(),t.a=n},m(r,s){t.m(e[2],r,s),T(r,n,s)},p(e,n){4&n&&t.p(e[2])},d(e){e&&P(n),e&&t.d()}}}function Ss(e){let t,n,r,s,o,i,c,a,u,p,g=!e[1]&&e[2]&&Cs(e);return{c(){t=L("div"),n=L("figure"),r=L("div"),g&&g.c(),s=_(),o=L("img"),U(r,"class","svg-container svelte-1egync3"),d(o.src,i=e[4])||U(o,"src",i),U(o,"alt","Extracted region"),U(o,"class","svelte-1egync3"),U(n,"class","image card region-image svelte-1egync3"),F(n,"width",e[0]+"px"),F(n,"aspect-ratio",e[3]?e[3].split(" ")[2]/e[3].split(" ")[3]:1),U(t,"class","svg-regions is-center svelte-1egync3")},m(i,l){T(i,t,l),S(t,n),S(n,r),g&&g.m(r,null),S(n,s),S(n,o),a=!0,u||(p=[A(t,"mouseenter",e[6]),A(t,"mouseleave",e[7])],u=!0)},p(e,[t]){!e[1]&&e[2]?g?g.p(e,t):(g=Cs(e),g.c(),g.m(r,null)):g&&(g.d(1),g=null),(!a||1&t)&&F(n,"width",e[0]+"px"),(!a||8&t)&&F(n,"aspect-ratio",e[3]?e[3].split(" ")[2]/e[3].split(" ")[3]:1)},i(e){a||(ue((()=>{a&&(c||(c=Ie(t,Me,{duration:500},!0)),c.run(1))})),a=!0)},o(e){c||(c=Ie(t,Me,{duration:500},!1)),c.run(0),a=!1},d(e){e&&P(t),g&&g.d(),e&&c&&c.end(),u=!1,l(p)}}}function Es(e,t,n){let{svgPath:r}=t,{width:s=200}=t;const[o,i,l,c]=r.replace(".svg","").split("_"),a=rt(`${o}_${i}_${l}`,c,`${s},`);let u=!1,d="",p="";Y((async()=>{const e=await fetch(`${We}svg/${r}`),t=await e.text(),s=(new DOMParser).parseFromString(t,"image/svg+xml"),o=s.querySelector("svg");n(3,p=o.getAttribute("viewBox")||`0 0 ${o.getAttribute("width")} ${o.getAttribute("height")}`),s.querySelectorAll("image").forEach((e=>e.remove())),o.setAttribute("viewBox",p),o.removeAttribute("width"),o.removeAttribute("height"),n(2,d=(new XMLSerializer).serializeToString(s.documentElement))}));return e.$$set=e=>{"svgPath"in e&&n(5,r=e.svgPath),"width"in e&&n(0,s=e.width)},[s,u,d,p,a,r,()=>n(1,u=!0),()=>n(1,u=!1)]}class Rs extends je{constructor(e){super(),Ne(this,e,Es,Ss,a,{svgPath:5,width:0})}}function Ts(e){let t,n,s,o,i,l,c,a="en"===Ve?"Download All":"Tout Télécharger";return{c(){t=L("div"),n=L("button"),s=L("i"),o=_(),i=j(a),U(s,"class","fa-solid fa-download"),U(n,"class","button is-link is-light"),U(t,"class","is-right mb-3")},m(r,a){T(r,t,a),S(t,n),S(n,s),S(n,o),S(n,i),l||(c=A(n,"click",e[0]),l=!0)},p:r,i:r,o:r,d(e){e&&P(t),l=!1,c()}}}function Ps(e){const t=`${window.location.origin}${window.location.pathname}`,n=parseInt(t.split("witness/")[1].replace("/","")),r=parseInt(t.split("regions/")[1].replace("/",""));return[async function(){if(!r&&!n)return void console.error("No Region or Witness");const e=r?`${window.location.origin}/${Fe}/export-regions-imgs-and-svgs/${r}`:`${window.location.origin}/${Fe}/export-all-imgs-and-svgs/${n}`;try{const t=await Ye((()=>fetch(e,{method:"GET",headers:{"X-CSRFToken":Be,"Content-Type":"application/json"}})));if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);it(await t.blob(),"vectorizations.zip")}catch(e){console.error("Erreur lors du téléchargement des vectorisations:",e)}}]}class Os extends je{constructor(e){super(),Ne(this,e,Ps,Ts,a,{})}}function Ls(e,t,n){const r=e.slice();return r[8]=t[n],r}function Ns(e){let t;let n=("en"===Ve?_s:js)(e);return{c(){t=L("div"),n.c(),U(t,"class","faded is-center")},m(e,r){T(e,t,r),n.m(t,null)},p(e,t){n.p(e,t)},i:r,o:r,d(e){e&&P(t),n.d()}}}function js(e){let t,n,r=e[11]+"";return{c(){t=j("Erreur lors de la récupération des régions vectorisées : "),n=j(r)},m(e,r){T(e,t,r),T(e,n,r)},p(e,t){2&t&&r!==(r=e[11]+"")&&D(n,r)},d(e){e&&P(t),e&&P(n)}}}function _s(e){let t,n,r=e[11]+"";return{c(){t=j("Error when retrieving vectorized regions: "),n=j(r)},m(e,r){T(e,t,r),T(e,n,r)},p(e,t){2&t&&r!==(r=e[11]+"")&&D(n,r)},d(e){e&&P(t),e&&P(n)}}}function Ms(e){let t,n,r=[],s=new Map,o=e[2];const i=e=>e[8].id;for(let t=0;t<o.length;t+=1){let n=Ls(e,o,t),l=i(n);s.set(l,r[t]=qs(l,n))}let l=null;return o.length||(l=As()),{c(){for(let e=0;e<r.length;e+=1)r[e].c();t=M(),l&&l.c()},m(e,s){for(let t=0;t<r.length;t+=1)r[t]&&r[t].m(e,s);T(e,t,s),l&&l.m(e,s),n=!0},p(e,n){4&n&&(o=e[2],we(),r=Re(r,n,i,1,e,o,s,t.parentNode,Ee,qs,t,Ls),be(),!o.length&&l?l.p(e,n):o.length?l&&(l.d(1),l=null):(l=As(),l.c(),l.m(t.parentNode,t)))},i(e){if(!n){for(let e=0;e<o.length;e+=1)ye(r[e]);n=!0}},o(e){for(let e=0;e<r.length;e+=1)xe(r[e]);n=!1},d(e){for(let t=0;t<r.length;t+=1)r[t].d(e);e&&P(t),l&&l.d(e)}}}function As(e){let t,n;return{c(){t=L("div"),t.textContent=""+("en"===Ve?"No vectorization":"Pas de vectorisation"),n=_(),U(t,"class","faded is-center")},m(e,r){T(e,t,r),T(e,n,r)},p:r,d(e){e&&P(t),e&&P(n)}}}function qs(e,t){let n,r,s;return r=new Rs({props:{svgPath:t[8]}}),{key:e,first:null,c(){n=M(),Te(r.$$.fragment),this.first=n},m(e,t){T(e,n,t),Pe(r,e,t),s=!0},p(e,n){t=e;const s={};4&n&&(s.svgPath=t[8]),r.$set(s)},i(e){s||(ye(r.$$.fragment,e),s=!0)},o(e){xe(r.$$.fragment,e),s=!1},d(e){e&&P(n),Oe(r,e)}}}function Us(e){let t;return{c(){t=L("div"),t.textContent=""+("en"===Ve?"Retrieving vectorization page...":"Récupération la page de vectorisation..."),U(t,"class","faded is-center")},m(e,n){T(e,t,n)},p:r,i:r,o:r,d(e){e&&P(t)}}}function Ds(e){let t,n,r,s,o,i,l,c,a;t=new Os({}),r=new an({props:{store:Is,nbOfItems:e[0].length,pageLength:e[6]}});let u={ctx:e,current:null,token:null,hasCatch:!0,pending:Us,then:Ms,catch:Ns,value:7,error:11,blocks:[,,,]};return Ce(i=e[1],u),c=new an({props:{store:Is,nbOfItems:e[0].length,pageLength:e[6]}}),{c(){Te(t.$$.fragment),n=_(),Te(r.$$.fragment),s=_(),o=L("div"),u.block.c(),l=_(),Te(c.$$.fragment),U(o,"class","grid is-gap-2 mx-5 svelte-1mje9rl")},m(e,i){Pe(t,e,i),T(e,n,i),Pe(r,e,i),T(e,s,i),T(e,o,i),u.block.m(o,u.anchor=null),u.mount=()=>o,u.anchor=null,T(e,l,i),Pe(c,e,i),a=!0},p(t,[n]){e=t;const s={};1&n&&(s.nbOfItems=e[0].length),r.$set(s),u.ctx=e,2&n&&i!==(i=e[1])&&Ce(i,u)||Se(u,e,n);const o={};1&n&&(o.nbOfItems=e[0].length),c.$set(o)},i(e){a||(ye(t.$$.fragment,e),ye(r.$$.fragment,e),ye(u.block),ye(c.$$.fragment,e),a=!0)},o(e){xe(t.$$.fragment,e),xe(r.$$.fragment,e);for(let e=0;e<3;e+=1){xe(u.blocks[e])}xe(c.$$.fragment,e),a=!1},d(e){Oe(t,e),e&&P(n),Oe(r,e),e&&P(s),e&&P(o),u.block.d(),u.token=null,u=null,e&&P(l),Oe(c,e)}}}function Vs(e,t,n){let r,s,o;const{vectImgs:i,pageVectImgs:l,setPageVectImgs:c,pageLength:a}=Is;return m(e,i,(e=>n(0,r=e))),m(e,l,(e=>n(2,o=e))),m(e,c,(e=>n(1,s=e))),[r,s,o,i,l,c,a]}class Fs extends je{constructor(e){super(),Ne(this,e,Vs,Ds,a,{})}}function zs(e){let t;let n=("en"===Ve?Hs:Bs)(e);return{c(){t=L("div"),n.c(),U(t,"class","container faded is-center")},m(e,r){T(e,t,r),n.m(t,null)},p(e,t){n.p(e,t)},i:r,o:r,d(e){e&&P(t),n.d()}}}function Bs(e){let t,n,s=e[2]+"";return{c(){t=j("Erreur lors de la récupération des régions vectorisées : "),n=j(s)},m(e,r){T(e,t,r),T(e,n,r)},p:r,d(e){e&&P(t),e&&P(n)}}}function Hs(e){let t,n,s=e[2]+"";return{c(){t=j("Error when retrieving vectorized regions: "),n=j(s)},m(e,r){T(e,t,r),T(e,n,r)},p:r,d(e){e&&P(t),e&&P(n)}}}function Js(e){let t,n;return t=new Fs({}),{c(){Te(t.$$.fragment)},m(e,r){Pe(t,e,r),n=!0},p:r,i(e){n||(ye(t.$$.fragment,e),n=!0)},o(e){xe(t.$$.fragment,e),n=!1},d(e){Oe(t,e)}}}function Xs(e){let t;return{c(){t=L("div"),t.textContent=""+("en"===Ve?"Retrieving vectorized regions...":"Récupération des régions vectorisées..."),U(t,"class","container faded is-center")},m(e,n){T(e,t,n)},p:r,i:r,o:r,d(e){e&&P(t)}}}function Zs(e){let t,n,r=He.includes("vectorization"),s=r&&function(e){let t,n,r={ctx:e,current:null,token:null,hasCatch:!0,pending:Xs,then:Js,catch:zs,value:1,error:2,blocks:[,,,]};return Ce(e[0],r),{c(){t=M(),r.block.c()},m(e,s){T(e,t,s),r.block.m(e,r.anchor=s),r.mount=()=>t.parentNode,r.anchor=t,n=!0},p(t,n){Se(r,e=t,n)},i(e){n||(ye(r.block),n=!0)},o(e){for(let e=0;e<3;e+=1)xe(r.blocks[e]);n=!1},d(e){e&&P(t),r.block.d(e),r.token=null,r=null}}}(e);return{c(){s&&s.c(),t=M()},m(e,r){s&&s.m(e,r),T(e,t,r),n=!0},p(e,[t]){r&&s.p(e,t)},i(e){n||(ye(s),n=!0)},o(e){xe(s),n=!1},d(e){s&&s.d(e),e&&P(t)}}}function Ws(e){const{fetchVectorization:t}=Is;return[t]}class Gs extends je{constructor(e){super(),Ne(this,e,Ws,Zs,a,{})}}function Qs(e,t,n){const r=e.slice();return r[22]=t[n][0],r[23]=t[n][1],r}function Ks(e,t,n){const r=e.slice();return r[27]=t[n],r}function Ys(e,t,n){const r=e.slice();return r[31]=t[n][0],r[23]=t[n][1],r}function eo(e){let t,n,r,s;return n=new Zt({}),{c(){t=L("div"),Te(n.$$.fragment),U(t,"class","cell")},m(e,r){T(e,t,r),Pe(n,t,null),s=!0},i(e){s||(ye(n.$$.fragment,e),ue((()=>{s&&(r||(r=Ie(t,Me,{duration:500},!0)),r.run(1))})),s=!0)},o(e){xe(n.$$.fragment,e),r||(r=Ie(t,Me,{duration:500},!1)),r.run(0),s=!1},d(e){e&&P(t),Oe(n),e&&r&&r.end()}}}function to(e){let t,n,r,s,o,i,c=e[23].text+"";function a(){return e[20](e[31])}return{c(){t=L("li"),n=L("a"),r=j(c),s=_(),U(n,"href",null),z(t,"is-active",e[31]===e[3])},m(e,l){T(e,t,l),S(t,n),S(n,r),S(t,s),o||(i=[A(t,"click",a),A(t,"keyup",$o)],o=!0)},p(n,s){e=n,4&s[0]&&c!==(c=e[23].text+"")&&D(r,c),12&s[0]&&z(t,"is-active",e[31]===e[3])},d(e){e&&P(t),o=!1,l(i)}}}function no(e){let t,n;return t=new Gs({}),{c(){Te(t.$$.fragment)},m(e,r){Pe(t,e,r),n=!0},p:r,i(e){n||(ye(t.$$.fragment,e),n=!0)},o(e){xe(t.$$.fragment,e),n=!1},d(e){Oe(t,e)}}}function ro(e){let t,n;return t=new Gr({}),{c(){Te(t.$$.fragment)},m(e,r){Pe(t,e,r),n=!0},p:r,i(e){n||(ye(t.$$.fragment,e),n=!0)},o(e){xe(t.$$.fragment,e),n=!1},d(e){Oe(t,e)}}}function so(e){let t,n;return t=new gs({}),{c(){Te(t.$$.fragment)},m(e,r){Pe(t,e,r),n=!0},p:r,i(e){n||(ye(t.$$.fragment,e),n=!0)},o(e){xe(t.$$.fragment,e),n=!1},d(e){Oe(t,e)}}}function oo(e){let t,n,r={ctx:e,current:null,token:null,hasCatch:!0,pending:uo,then:lo,catch:io,value:26,error:30,blocks:[,,,]};return Ce(e[9],r),{c(){t=L("div"),r.block.c(),U(t,"class","grid is-gap-2")},m(e,s){T(e,t,s),r.block.m(t,r.anchor=null),r.mount=()=>t,r.anchor=null,n=!0},p(t,n){Se(r,e=t,n)},i(e){n||(ye(r.block),n=!0)},o(e){for(let e=0;e<3;e+=1){xe(r.blocks[e])}n=!1},d(e){e&&P(t),r.block.d(),r.token=null,r=null}}}function io(e){let t,n,s,o=e[30]+"";return{c(){t=L("div"),n=j("Error when retrieving regions: "),s=j(o)},m(e,r){T(e,t,r),S(t,n),S(t,s)},p:r,i:r,o:r,d(e){e&&P(t)}}}function lo(e){let t,n,r=[],s=new Map,o=Object.values(e[6]);const i=e=>e[27].id;for(let t=0;t<o.length;t+=1){let n=Ks(e,o,t),l=i(n);s.set(l,r[t]=ao(l,n))}let l=null;return o.length||(l=co(e)),{c(){for(let e=0;e<r.length;e+=1)r[e].c();t=M(),l&&l.c()},m(e,s){for(let t=0;t<r.length;t+=1)r[t]&&r[t].m(e,s);T(e,t,s),l&&l.m(e,s),n=!0},p(e,n){3136&n[0]&&(o=Object.values(e[6]),we(),r=Re(r,n,i,1,e,o,s,t.parentNode,Ee,ao,t,Ks),be(),!o.length&&l?l.p(e,n):o.length?l&&(we(),xe(l,1,1,(()=>{l=null})),be()):(l=co(e),l.c(),ye(l,1),l.m(t.parentNode,t)))},i(e){if(!n){for(let e=0;e<o.length;e+=1)ye(r[e]);n=!0}},o(e){for(let e=0;e<r.length;e+=1)xe(r[e]);n=!1},d(e){for(let t=0;t<r.length;t+=1)r[t].d(e);e&&P(t),l&&l.d(e)}}}function co(e){let t,n;return t=new Pt({props:{currentRegionId:e[11],baseUrl:e[10]}}),{c(){Te(t.$$.fragment)},m(e,r){Pe(t,e,r),n=!0},p:r,i(e){n||(ye(t.$$.fragment,e),n=!0)},o(e){xe(t.$$.fragment,e),n=!1},d(e){Oe(t,e)}}}function ao(e,t){let n,r,s;return r=new xt({props:{item:t[27]}}),{key:e,first:null,c(){n=M(),Te(r.$$.fragment),this.first=n},m(e,t){T(e,n,t),Pe(r,e,t),s=!0},p(e,n){t=e;const s={};64&n[0]&&(s.item=t[27]),r.$set(s)},i(e){s||(ye(r.$$.fragment,e),s=!0)},o(e){xe(r.$$.fragment,e),s=!1},d(e){e&&P(n),Oe(r,e)}}}function uo(e){let t;return{c(){t=L("div"),t.textContent=""+("en"===Ve?"Retrieving regions...":"Récupération des régions..."),U(t,"class","faded is-center")},m(e,n){T(e,t,n)},p:r,i:r,o:r,d(e){e&&P(t)}}}function po(e){let t;return{c(){t=L("div"),t.textContent=""+("en"===Ve?"No regions in selection":"Aucune région sélectionnée")},m(e,n){T(e,t,n)},p:r,d(e){e&&P(t)}}}function go(e){let t,n,r=Object.entries(e[1]),s=[];for(let t=0;t<r.length;t+=1)s[t]=mo(Qs(e,r,t));return{c(){t=L("div"),n=L("div");for(let e=0;e<s.length;e+=1)s[e].c();U(n,"class","grid is-gap-2"),U(t,"class","fixed-grid has-6-cols")},m(e,r){T(e,t,r),S(t,n);for(let e=0;e<s.length;e+=1)s[e]&&s[e].m(n,null)},p(e,t){if(2&t[0]){let o;for(r=Object.entries(e[1]),o=0;o<r.length;o+=1){const i=Qs(e,r,o);s[o]?s[o].p(i,t):(s[o]=mo(i),s[o].c(),s[o].m(n,null))}for(;o<s.length;o+=1)s[o].d(1);s.length=r.length}},d(e){e&&P(t),O(s,e)}}}function mo(e){let t,n,r,s,o,i,l,c,a,u,p,g,m,f=e[23].title+"";function h(){return e[21](e[22])}return{c(){t=L("div"),n=L("figure"),r=L("img"),o=_(),i=L("div"),l=L("span"),c=j(f),a=_(),u=L("button"),p=_(),d(r.src,s=rt(e[23].img,e[23].xyhw,"96,"))||U(r,"src",s),U(r,"alt","Extracted region"),U(l,"class","overlay-desc"),U(i,"class","overlay is-center svelte-1mm19e2"),U(n,"class","image is-64x64 card"),U(u,"class","delete region-btn"),U(u,"aria-label","remove from selection"),U(t,"class","selection cell svelte-1mm19e2")},m(e,s){T(e,t,s),S(t,n),S(n,r),S(n,o),S(n,i),S(i,l),S(l,c),S(t,a),S(t,u),S(t,p),g||(m=A(u,"click",h),g=!0)},p(t,n){e=t,2&n[0]&&!d(r.src,s=rt(e[23].img,e[23].xyhw,"96,"))&&U(r,"src",s),2&n[0]&&f!==(f=e[23].title+"")&&D(c,f)},d(e){e&&P(t),g=!1,m()}}}function fo(e){let t;function n(e,t){return e[4]?go:po}let r=n(e),s=r(e);return{c(){s.c(),t=M()},m(e,n){s.m(e,n),T(e,t,n)},p(e,o){r===(r=n(e))&&s?s.p(e,o):(s.d(1),s=r(e),s&&(s.c(),s.m(t.parentNode,t)))},d(e){s.d(e),e&&P(t)}}}function ho(e){let t,n,r,s,o,i,l,c,a,u,d,p,g,m,f,h,$,v,w,b,y=["all","page"].includes(e[3]);t=new mt({props:{visible:e[5]}}),r=new Et({}),o=new Ct({props:{selectionLength:e[0]}}),u=new Ut({props:{baseUrl:e[10],currentRegionId:e[11],currentLayout:e[3]}});let x=y&&eo(),k=Object.entries(e[2]),I=[];for(let t=0;t<k.length;t+=1)I[t]=to(Ys(e,k,t));const C=[oo,so,ro,no],E=[];function R(e,t){return"all"===e[3]?0:"page"===e[3]?1:"similarity"===e[3]?2:"vectorization"===e[3]?3:-1}return~(h=R(e))&&($=E[h]=C[h](e)),w=new ks({props:{isRegion:!0,selectionLength:e[0],$$slots:{default:[fo]},$$scope:{ctx:e}}}),{c(){Te(t.$$.fragment),n=_(),Te(r.$$.fragment),s=_(),Te(o.$$.fragment),i=_(),l=L("div"),c=L("div"),a=L("div"),Te(u.$$.fragment),d=_(),x&&x.c(),p=_(),g=L("div"),m=L("ul");for(let e=0;e<I.length;e+=1)I[e].c();f=_(),$&&$.c(),v=_(),Te(w.$$.fragment),U(a,"class","cell is-left is-middle"),U(c,"class","actions grid"),U(m,"class","panel-tabs svelte-1mm19e2"),U(g,"class","tabs is-centered"),U(l,"id","nav-actions"),U(l,"class","mb-5 svelte-1mm19e2")},m(e,$){Pe(t,e,$),T(e,n,$),Pe(r,e,$),T(e,s,$),Pe(o,e,$),T(e,i,$),T(e,l,$),S(l,c),S(c,a),Pe(u,a,null),S(c,d),x&&x.m(c,null),S(l,p),S(l,g),S(g,m);for(let e=0;e<I.length;e+=1)I[e]&&I[e].m(m,null);T(e,f,$),~h&&E[h].m(e,$),T(e,v,$),Pe(w,e,$),b=!0},p(e,n){const r={};32&n[0]&&(r.visible=e[5]),t.$set(r);const s={};1&n[0]&&(s.selectionLength=e[0]),o.$set(s);const i={};if(8&n[0]&&(i.currentLayout=e[3]),u.$set(i),8&n[0]&&(y=["all","page"].includes(e[3])),y?x?8&n[0]&&ye(x,1):(x=eo(),x.c(),ye(x,1),x.m(c,null)):x&&(we(),xe(x,1,1,(()=>{x=null})),be()),4108&n[0]){let t;for(k=Object.entries(e[2]),t=0;t<k.length;t+=1){const r=Ys(e,k,t);I[t]?I[t].p(r,n):(I[t]=to(r),I[t].c(),I[t].m(m,null))}for(;t<I.length;t+=1)I[t].d(1);I.length=k.length}let l=h;h=R(e),h===l?~h&&E[h].p(e,n):($&&(we(),xe(E[l],1,1,(()=>{E[l]=null})),be()),~h?($=E[h],$?$.p(e,n):($=E[h]=C[h](e),$.c()),ye($,1),$.m(v.parentNode,v)):$=null);const a={};1&n[0]&&(a.selectionLength=e[0]),18&n[0]|8&n[1]&&(a.$$scope={dirty:n,ctx:e}),w.$set(a)},i(e){b||(ye(t.$$.fragment,e),ye(r.$$.fragment,e),ye(o.$$.fragment,e),ye(u.$$.fragment,e),ye(x),ye($),ye(w.$$.fragment,e),b=!0)},o(e){xe(t.$$.fragment,e),xe(r.$$.fragment,e),xe(o.$$.fragment,e),xe(u.$$.fragment,e),xe(x),xe($),xe(w.$$.fragment,e),b=!1},d(e){Oe(t,e),e&&P(n),Oe(r,e),e&&P(s),Oe(o,e),e&&P(i),e&&P(l),Oe(u),x&&x.d(),O(I,e),e&&P(f),~h&&E[h].d(e),e&&P(v),Oe(w,e)}}}const $o=()=>null;function vo(e,t,n){let r,s,o,i,l,c,a;m(e,Qe,(e=>n(5,c=e)));const{selected:u}=at;m(e,u,(e=>n(19,l=e)));const{allRegions:d,fetchAll:p}=ut;m(e,d,(e=>n(6,a=e)));let{manifest:g=""}=t,{isValidated:f=!1}=t,{imgPrefix:h=""}=t,{nbOfPages:$=1}=t,{trailingZeros:v=1}=t,{witness:w={}}=t;ne("witness",w),ne("nbOfPages",$),ne("trailingZeros",v),ne("imgPrefix",h),ne("manifest",g),ne("isValidated",f);const b=`${window.location.origin}${window.location.pathname}`,y=parseInt(b.split("regions/")[1].replace("/","")),x={all:{text:"en"===Ve?"All regions":"Toutes les régions"},page:{text:"en"===Ve?"Per page":"Par page"}};function k(e){n(3,i=e);const t=new URL(window.location);t.searchParams.set("tab",e),window.history.pushState({},"",t)}He.includes("similarity")&&(x.similarity={text:"en"===Ve?"Similarity":"Similarité"}),He.includes("vectorization")&&(x.vectorization={text:"en"===Ve?"Vectorization":"Vectorisation"});return e.$$set=e=>{"manifest"in e&&n(13,g=e.manifest),"isValidated"in e&&n(14,f=e.isValidated),"imgPrefix"in e&&n(15,h=e.imgPrefix),"nbOfPages"in e&&n(16,$=e.nbOfPages),"trailingZeros"in e&&n(17,v=e.trailingZeros),"witness"in e&&n(18,w=e.witness)},e.$$.update=()=>{524288&e.$$.dirty[0]&&n(1,r=l(!0)),2&e.$$.dirty[0]&&n(0,s=Object.keys(r).length),1&e.$$.dirty[0]&&n(4,o=s>0)},n(3,i=new URLSearchParams(window.location.search).get("tab")??"all"),[s,r,x,i,o,c,a,u,d,p,b,y,k,g,f,h,$,v,w,l,e=>k(e),e=>at.remove(e,Je)]}return new class extends je{constructor(e){super(),Ne(this,e,vo,ho,a,{manifest:13,isValidated:14,imgPrefix:15,nbOfPages:16,trailingZeros:17,witness:18},null,[-1,-1])}}({target:document.getElementById("region-list"),props:{witness:witness,manifest:manifest,isValidated:isValidated,imgPrefix:imgPrefix,nbOfPages:nbOfPages,trailingZeros:trailingZeros}})}(noUiSlider,0,Choices);
//# sourceMappingURL=regionList.js.map
