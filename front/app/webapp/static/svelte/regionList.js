var regionList=function(e,t,n){"use strict";function r(){}const s=e=>e;function o(e){return e()}function i(){return Object.create(null)}function l(e){e.forEach(o)}function c(e){return"function"==typeof e}function a(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}let d;function u(e,t){return d||(d=document.createElement("a")),d.href=t,e===d.href}function g(e,...t){if(null==e)return r;const n=e.subscribe(...t);return n.unsubscribe?()=>n.unsubscribe():n}function p(e){let t;return g(e,(e=>t=e))(),t}function m(e,t,n){e.$$.on_destroy.push(g(t,n))}function f(e,t,n,r){if(e){const s=h(e,t,n,r);return e[0](s)}}function h(e,t,n,r){return e[1]&&r?function(e,t){for(const n in t)e[n]=t[n];return e}(n.ctx.slice(),e[1](r(t))):n.ctx}function $(e,t,n,r){if(e[2]&&r){const s=e[2](r(n));if(void 0===t.dirty)return s;if("object"==typeof s){const e=[],n=Math.max(t.dirty.length,s.length);for(let r=0;r<n;r+=1)e[r]=t.dirty[r]|s[r];return e}return t.dirty|s}return t.dirty}function w(e,t,n,r,s,o){if(s){const i=h(t,n,r,o);e.p(i,s)}}function v(e){if(e.ctx.length>32){const t=[],n=e.ctx.length/32;for(let e=0;e<n;e++)t[e]=-1;return t}return-1}const b="undefined"!=typeof window;let y=b?()=>window.performance.now():()=>Date.now(),x=b?e=>requestAnimationFrame(e):r;const k=new Set;function I(e){k.forEach((t=>{t.c(e)||(k.delete(t),t.f())})),0!==k.size&&x(I)}const C="undefined"!=typeof window?window:"undefined"!=typeof globalThis?globalThis:global;function S(e,t){e.appendChild(t)}function E(e){if(!e)return document;const t=e.getRootNode?e.getRootNode():e.ownerDocument;return t&&t.host?t:e.ownerDocument}function R(e){const t=L("style");return function(e,t){S(e.head||e,t),t.sheet}(E(e),t),t.sheet}function T(e,t,n){e.insertBefore(t,n||null)}function P(e){e.parentNode&&e.parentNode.removeChild(e)}function O(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function L(e){return document.createElement(e)}function N(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function j(e){return document.createTextNode(e)}function _(){return j(" ")}function A(){return j("")}function M(e,t,n,r){return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n,r)}function q(e){return function(t){return t.preventDefault(),e.call(this,t)}}function U(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function D(e,t){t=""+t,e.data!==t&&(e.data=t)}function F(e,t){e.value=null==t?"":t}function V(e,t,n,r){null==n?e.style.removeProperty(t):e.style.setProperty(t,n,r?"important":"")}function z(e,t,n){e.classList[n?"add":"remove"](t)}function B(e,t,{bubbles:n=!1,cancelable:r=!1}={}){const s=document.createEvent("CustomEvent");return s.initCustomEvent(e,n,r,t),s}class H{constructor(e=!1){this.is_svg=!1,this.is_svg=e,this.e=this.n=null}c(e){this.h(e)}m(e,t,n=null){this.e||(this.is_svg?this.e=N(t.nodeName):this.e=L(11===t.nodeType?"TEMPLATE":t.nodeName),this.t="TEMPLATE"!==t.tagName?t:t.content,this.c(e)),this.i(n)}h(e){this.e.innerHTML=e,this.n=Array.from("TEMPLATE"===this.e.nodeName?this.e.content.childNodes:this.e.childNodes)}i(e){for(let t=0;t<this.n.length;t+=1)T(this.t,this.n[t],e)}p(e){this.d(),this.h(e),this.i(this.a)}d(){this.n.forEach(P)}}const J=new Map;let X,Z=0;function W(e,t,n,r,s,o,i,l=0){const c=16.666/r;let a="{\n";for(let e=0;e<=1;e+=c){const r=t+(n-t)*o(e);a+=100*e+`%{${i(r,1-r)}}\n`}const d=a+`100% {${i(n,1-n)}}\n}`,u=`__svelte_${function(e){let t=5381,n=e.length;for(;n--;)t=(t<<5)-t^e.charCodeAt(n);return t>>>0}(d)}_${l}`,g=E(e),{stylesheet:p,rules:m}=J.get(g)||function(e,t){const n={stylesheet:R(t),rules:{}};return J.set(e,n),n}(g,e);m[u]||(m[u]=!0,p.insertRule(`@keyframes ${u} ${d}`,p.cssRules.length));const f=e.style.animation||"";return e.style.animation=`${f?`${f}, `:""}${u} ${r}ms linear ${s}ms 1 both`,Z+=1,u}function G(e,t){const n=(e.style.animation||"").split(", "),r=n.filter(t?e=>e.indexOf(t)<0:e=>-1===e.indexOf("__svelte")),s=n.length-r.length;s&&(e.style.animation=r.join(", "),Z-=s,Z||x((()=>{Z||(J.forEach((e=>{const{ownerNode:t}=e.stylesheet;t&&P(t)})),J.clear())})))}function Q(e){X=e}function K(){if(!X)throw new Error("Function called outside component initialization");return X}function Y(e){K().$$.on_mount.push(e)}function ee(e){K().$$.on_destroy.push(e)}function te(){const e=K();return(t,n,{cancelable:r=!1}={})=>{const s=e.$$.callbacks[t];if(s){const o=B(t,n,{cancelable:r});return s.slice().forEach((t=>{t.call(e,o)})),!o.defaultPrevented}return!0}}function ne(e,t){return K().$$.context.set(e,t),t}function re(e){return K().$$.context.get(e)}const se=[],oe=[];let ie=[];const le=[],ce=Promise.resolve();let ae=!1;function de(e){ie.push(e)}const ue=new Set;let ge,pe=0;function me(){if(0!==pe)return;const e=X;do{try{for(;pe<se.length;){const e=se[pe];pe++,Q(e),fe(e.$$)}}catch(e){throw se.length=0,pe=0,e}for(Q(null),se.length=0,pe=0;oe.length;)oe.pop()();for(let e=0;e<ie.length;e+=1){const t=ie[e];ue.has(t)||(ue.add(t),t())}ie.length=0}while(se.length);for(;le.length;)le.pop()();ae=!1,ue.clear(),Q(e)}function fe(e){if(null!==e.fragment){e.update(),l(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(de)}}function he(e,t,n){e.dispatchEvent(B(`${t?"intro":"outro"}${n}`))}const $e=new Set;let we;function ve(){we={r:0,c:[],p:we}}function be(){we.r||l(we.c),we=we.p}function ye(e,t){e&&e.i&&($e.delete(e),e.i(t))}function xe(e,t,n,r){if(e&&e.o){if($e.has(e))return;$e.add(e),we.c.push((()=>{$e.delete(e),r&&(n&&e.d(1),r())})),e.o(t)}else r&&r()}const ke={duration:0};function Ie(e,t,n,o){const i={direction:"both"};let a=t(e,n,i),d=o?0:1,u=null,g=null,p=null;function m(){p&&G(e,p)}function f(e,t){const n=e.b-d;return t*=Math.abs(n),{a:d,b:e.b,d:n,duration:t,start:e.start,end:e.start+t,group:e.group}}function h(t){const{delay:n=0,duration:o=300,easing:i=s,tick:c=r,css:h}=a||ke,$={start:y()+n,b:t};t||($.group=we,we.r+=1),u||g?g=$:(h&&(m(),p=W(e,d,t,o,n,i,h)),t&&c(0,1),u=f($,o),de((()=>he(e,t,"start"))),function(e){let t;0===k.size&&x(I),new Promise((n=>{k.add(t={c:e,f:n})}))}((t=>{if(g&&t>g.start&&(u=f(g,o),g=null,he(e,u.b,"start"),h&&(m(),p=W(e,d,u.b,u.duration,0,i,a.css))),u)if(t>=u.end)c(d=u.b,1-d),he(e,u.b,"end"),g||(u.b?m():--u.group.r||l(u.group.c)),u=null;else if(t>=u.start){const e=t-u.start;d=u.a+u.d*i(e/u.duration),c(d,1-d)}return!(!u&&!g)})))}return{run(e){c(a)?(ge||(ge=Promise.resolve(),ge.then((()=>{ge=null}))),ge).then((()=>{a=a(i),h(e)})):h(e)},end(){m(),u=g=null}}}function Ce(e,t){const n=t.token={};function r(e,r,s,o){if(t.token!==n)return;t.resolved=o;let i=t.ctx;void 0!==s&&(i=i.slice(),i[s]=o);const l=e&&(t.current=e)(i);let c=!1;t.block&&(t.blocks?t.blocks.forEach(((e,n)=>{n!==r&&e&&(ve(),xe(e,1,1,(()=>{t.blocks[n]===e&&(t.blocks[n]=null)})),be())})):t.block.d(1),l.c(),ye(l,1),l.m(t.mount(),t.anchor),c=!0),t.block=l,t.blocks&&(t.blocks[r]=l),c&&me()}if(!(s=e)||"object"!=typeof s&&"function"!=typeof s||"function"!=typeof s.then){if(t.current!==t.then)return r(t.then,1,t.value,e),!0;t.resolved=e}else{const n=K();if(e.then((e=>{Q(n),r(t.then,1,t.value,e),Q(null)}),(e=>{if(Q(n),r(t.catch,2,t.error,e),Q(null),!t.hasCatch)throw e})),t.current!==t.pending)return r(t.pending,0),!0}var s}function Se(e,t,n){const r=t.slice(),{resolved:s}=e;e.current===e.then&&(r[e.value]=s),e.current===e.catch&&(r[e.error]=s),e.block.p(r,n)}function Ee(e,t){xe(e,1,1,(()=>{t.delete(e.key)}))}function Re(e,t,n,r,s,o,i,c,a,d,u,g){let p=e.length,m=o.length,f=p;const h={};for(;f--;)h[e[f].key]=f;const $=[],w=new Map,v=new Map,b=[];for(f=m;f--;){const e=g(s,o,f),l=n(e);let c=i.get(l);c?r&&b.push((()=>c.p(e,t))):(c=d(l,e),c.c()),w.set(l,$[f]=c),l in h&&v.set(l,Math.abs(f-h[l]))}const y=new Set,x=new Set;function k(e){ye(e,1),e.m(c,u),i.set(e.key,e),u=e.first,m--}for(;p&&m;){const t=$[m-1],n=e[p-1],r=t.key,s=n.key;t===n?(u=t.first,p--,m--):w.has(s)?!i.has(r)||y.has(r)?k(t):x.has(s)?p--:v.get(r)>v.get(s)?(x.add(r),k(t)):(y.add(s),p--):(a(n,i),p--)}for(;p--;){const t=e[p];w.has(t.key)||a(t,i)}for(;m;)k($[m-1]);return l(b),$}function Te(e){e&&e.c()}function Pe(e,t,n,r){const{fragment:s,after_update:i}=e.$$;s&&s.m(t,n),r||de((()=>{const t=e.$$.on_mount.map(o).filter(c);e.$$.on_destroy?e.$$.on_destroy.push(...t):l(t),e.$$.on_mount=[]})),i.forEach(de)}function Oe(e,t){const n=e.$$;null!==n.fragment&&(!function(e){const t=[],n=[];ie.forEach((r=>-1===e.indexOf(r)?t.push(r):n.push(r))),n.forEach((e=>e())),ie=t}(n.after_update),l(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function Le(e,t){-1===e.$$.dirty[0]&&(se.push(e),ae||(ae=!0,ce.then(me)),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function Ne(e,t,n,s,o,c,a,d=[-1]){const u=X;Q(e);const g=e.$$={fragment:null,ctx:[],props:c,update:r,not_equal:o,bound:i(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(u?u.$$.context:[])),callbacks:i(),dirty:d,skip_bound:!1,root:t.target||u.$$.root};a&&a(g.root);let p=!1;if(g.ctx=n?n(e,t.props||{},((t,n,...r)=>{const s=r.length?r[0]:n;return g.ctx&&o(g.ctx[t],g.ctx[t]=s)&&(!g.skip_bound&&g.bound[t]&&g.bound[t](s),p&&Le(e,t)),n})):[],g.update(),p=!0,l(g.before_update),g.fragment=!!s&&s(g.ctx),t.target){if(t.hydrate){const e=function(e){return Array.from(e.childNodes)}(t.target);g.fragment&&g.fragment.l(e),e.forEach(P)}else g.fragment&&g.fragment.c();t.intro&&ye(e.$$.fragment),Pe(e,t.target,t.anchor,t.customElement),me()}Q(u)}class je{$destroy(){Oe(this,1),this.$destroy=r}$on(e,t){if(!c(t))return r;const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(e){var t;this.$$set&&(t=e,0!==Object.keys(t).length)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}function _e(e){const t=e-1;return t*t*t+1}function Ae(e,{delay:t=0,duration:n=400,easing:r=s}={}){const o=+getComputedStyle(e).opacity;return{delay:t,duration:n,easing:r,css:e=>"opacity: "+e*o}}function Me(e,{delay:t=0,duration:n=400,easing:r=_e,axis:s="y"}={}){const o=getComputedStyle(e),i=+o.opacity,l="y"===s?"height":"width",c=parseFloat(o[l]),a="y"===s?["top","bottom"]:["left","right"],d=a.map((e=>`${e[0].toUpperCase()}${e.slice(1)}`)),u=parseFloat(o[`padding${d[0]}`]),g=parseFloat(o[`padding${d[1]}`]),p=parseFloat(o[`margin${d[0]}`]),m=parseFloat(o[`margin${d[1]}`]),f=parseFloat(o[`border${d[0]}Width`]),h=parseFloat(o[`border${d[1]}Width`]);return{delay:t,duration:n,easing:r,css:e=>`overflow: hidden;opacity: ${Math.min(20*e,1)*i};${l}: ${e*c}px;padding-${a[0]}: ${e*u}px;padding-${a[1]}: ${e*g}px;margin-${a[0]}: ${e*p}px;margin-${a[1]}: ${e*m}px;border-${a[0]}-width: ${e*f}px;border-${a[1]}-width: ${e*h}px;`}}const qe=[];function Ue(e,t=r){let n;const s=new Set;function o(t){if(a(e,t)&&(e=t,n)){const t=!qe.length;for(const t of s)t[1](),qe.push(t,e);if(t){for(let e=0;e<qe.length;e+=2)qe[e][0](qe[e+1]);qe.length=0}}}return{set:o,update:function(t){o(t(e))},subscribe:function(i,l=r){const c=[i,l];return s.add(c),1===s.size&&(n=t(o)||r),i(e),()=>{s.delete(c),0===s.size&&n&&(n(),n=null)}}}}function De(e,t,n){const s=!Array.isArray(e),o=s?[e]:e,i=t.length<2;return a=e=>{let n=!1;const a=[];let d=0,u=r;const p=()=>{if(d)return;u();const n=t(s?a[0]:a,e);i?e(n):u=c(n)?n:r},m=o.map(((e,t)=>g(e,(e=>{a[t]=e,d&=~(1<<t),n&&p()}),(()=>{d|=1<<t}))));return n=!0,p(),function(){l(m),u(),n=!1}},{subscribe:Ue(n,a).subscribe};var a}const Fe=APP_LANG,Ve=APP_NAME;WEBAPP_NAME;const ze=USER_ID;IS_SUPERUSER,ADD_PERMISSION;const Be=CSRF_TOKEN,He=ADDITIONAL_MODULES,Je="Region",Xe=SAS_APP_URL,Ze=CANTALOUPE_APP_URL,We=MEDIA_PATH,Ge=PAGE_LEN,Qe=Ue(!1),Ke=Ue("");async function Ye(e){Qe.set(!0);try{return await e()}finally{Qe.set(!1)}}function et(e,t=100){const n=Math.floor(.75*t);return e.length>t?e.slice(0,n)+"..."+e.slice(-t+n):e}function tt(e,t){if("undefined"!=typeof window){const n=parseInt(new URLSearchParams(window.location.search).get(t));if(!isNaN(n))return e.set(n),n}return e.set(1),1}function nt(e,t,n){if(t.set(e),"undefined"!=typeof window){const t=new URL(window.location.href);t.searchParams.set(n,e),window.history.pushState({},"",t)}}function rt(e=null,t="full",n="full"){if(!e)return"https://placehold.co/96x96/png?text=No+image";if((e=e.split("_")).length<3)return"https://placehold.co/96x96/png?text=No+image";const r=e[e.length-1].includes(",")?e.pop().replace(".jpg",""):t,s=e.join("_").replace(".jpg","");return`${Ze??"http://localhost:8182"}/iiif/2/${s}.jpg/${r}/${n}/0/default.jpg`}function st(e=null,t=1){return`${Xe??"http://localhost:3000"}/index.html?iiif-content=${e}&canvas=${t}`}function ot(e,t=null,n=!1){return new Promise((r=>{if(document.getElementById("msg-modal")){n?document.getElementById("modal-footer").hidden=!1:r(void 0),t&&(document.getElementById("modal-title").innerHTML=t),document.getElementById("modal-body").innerHTML=e,document.getElementById("hidden-msg-btn").click();const s=document.getElementById("cancel-btn"),o=document.getElementById("ok-btn"),i=document.getElementById("modal-bkg"),l=()=>{s.removeEventListener("click",c),i.removeEventListener("click",c),o.removeEventListener("click",a),document.getElementById("modal-footer").hidden=!0},c=()=>{l(),r(!1)},a=()=>{l(),r(!0)};s.addEventListener("click",c),o.addEventListener("click",a)}else n?r(window.confirm(e)):(window.alert(e),r(void 0))}))}function it(e,t){const n=window.URL.createObjectURL(e),r=document.createElement("a");r.href=n,r.download=`${t}`,document.body.appendChild(r),r.click(),window.URL.revokeObjectURL(n),document.body.removeChild(r)}function lt(){let e,t,n=(e,t)=>e===t;return{set:n=>{t=e,e=n},setCompareFn:e=>n=e,get:()=>e,getNewAndOld:()=>[e,t],same:()=>n(e,t)}}const ct=(e,t)=>Array.isArray(e)&&Array.isArray(t)&&e.length===t.length&&e.every(((e,n)=>e===t[n]||void 0));const at=function(){const e={id:null,type:"documentSet",title:"en"===Fe?"Document set":"Set de documents",selected:{}},t={id:null,type:"regionsSet",title:"en"===Fe?"Regions set":"Set de régions",selected:{}},n=Ue({records:JSON.parse(localStorage.getItem("documentSet"))||e,regions:JSON.parse(localStorage.getItem("regionsSet"))||t}),{subscribe:r,update:s,get:o}=n,i=Ue(!1);function l(e,t=!1){i.set(t),localStorage.setItem(e.type,JSON.stringify(e))}function c(e,t){return e[t?"regions":"records"]?.selected||{}}function a(e,t=!0){const n=c(e,t);return t?n[Je]??{}:Object.entries(n)}function d(e,t,n){const r=n===Je?"regions":"records",s=e[r],{[t]:o,...i}=s.selected[n];return e[r]={...s,selected:{...s.selected,[n]:i}},l(e[r]),e}function u(e,t,n=!0){const r=t.class===Je?"regions":"records",s=e[r],o=s.selected,i=t.class===Je?t:{title:t.title,url:t.url};return e[r]={...s,selected:{...o,[t.class]:{...o[t.class]||{},[t.id]:i}}},n&&l(e[r]),e}function g(e,t){return e[t.class.toLowerCase().includes("regions")?"regions":"records"].id===t.id}return{subscribe:r,save:e=>s((t=>function(e,t){const n=t?"regions-set":"document-set";if(t)return window.alert("Region set management is not yet implemented"),e;let r=e[t?"regions":"records"],o={};Object.entries(r.selected).forEach((([e,t])=>{o[e]=Object.keys(t)}));const c=null!==r.id?`${r.id}/edit`:"new";return fetch(`${window.location.origin}/${n}/${c}`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":Be},body:JSON.stringify({title:r.title,selection:r,...o})}).then((e=>e.json())).then((n=>{if(!n?.document_set_id)throw new Error("Failed to save selection");s((e=>{const r=e[t?"regions":"records"];return r.id=n.document_set_id,r.title=n.document_set_title,i.set(!0),e})),l(e[t?"regions":"records"],!0)})).catch((e=>console.error("Error:",e))),e}(t,e))),empty:n=>s((r=>(r[n?"regions":"records"]=n?t:e,l(r[n?"regions":"records"]),r))),removeAll:(e,t)=>s((n=>function(e,t,n){const r=n===Je?"regions":"records",s=e[r];let o=s.selected[n];return o&&Object.keys(o).length?(t.forEach((e=>{delete o[e]})),e[r]={...s,selected:{...s.selected,[n]:o}},l(e[r]),e):e}(n,e,t))),remove:(e,t)=>s((n=>d(n,e,t))),addAll:e=>s((t=>function(e,t){const n=t[0].type===Je;return t.forEach((t=>{e=u(e,t,!1)})),l(e[n?"regions":"records"]),e}(t,e))),add:e=>s((t=>u(t,e))),toggle:e=>s((t=>{const n=c(t,e.class===Je);return n[e.class]?.[e.id]?d(t,e.id,e.class):u(t,e)})),updateTitle:(e,t)=>s((n=>{const r=t?"regions":"records";return n[r]={...n[r],title:e},l(n[r],!0),n})),isSaved:i,isSelected:De(n,(e=>t=>c(e,t.class===Je)[t.class]?.hasOwnProperty(t.id)||!1)),isSetSelected:De(n,(e=>t=>g(e,t))),selected:De(n,(e=>t=>a(e,t))),nbSelected:De(n,(e=>t=>{const n=a(e,t);return t?Object.keys(n).length:n.reduce(((e,[t,n])=>e+Object.keys(n).length),0)})),selectionTitle:De(n,(e=>t=>e[t?"regions":"records"].title)),selection:De(n,(e=>t=>e[t?"regions":"records"])),toggleSet:n=>s((r=>g(r,n)?function(n,r){const s=r.class.toLowerCase().includes("regions");return n[s?"regions":"records"]=s?t:e,l(n[s?"regions":"records"]),n}(r,n):function(e,t){const n=t.class.toLowerCase().includes("regions")?"regions":"records";return null===t.selection.id&&(t.selection.id=t.id),e[n]=t.selection,l(e[n]),e}(r,n)))}}();const dt=function(){const e=`${window.location.origin}${window.location.pathname}`,t=Ue(1),n=Ue({}),r=Ue({}),s=Ue("");tt(t,"p");const o=(async()=>{const t=await fetch(`${e}canvas`),r=await t.json();let s={};return Object.values(r).forEach((e=>{Object.entries(e).forEach((([e,t])=>{s[e]=t}))})),n.set(s),r})(),i=De(t,(t=>(async()=>{const n=await fetch(`${e}canvas?p=${t}`),s=await n.json();return r.set(s),s})()));return{currentPage:t,pageRegions:r,allRegions:n,fetchPages:i,fetchAll:o,handlePageUpdate:function(e){nt(e,t,"p")},remove:function(e){n.update((t=>(delete t[e],{...t}))),r.update((t=>{for(const n in t)if(t[n][e]){const{[e]:r,...s}=t[n];return t[n]=s,t}return t}))},clipBoard:s,copyRef:function(e){s.update((t=>{const n=t===e?"":e;return navigator.clipboard.writeText(n).then((e=>"")),n}))}}}();function ut(e){let t,n,r;return{c(){t=L("div"),t.innerHTML='<div class="loader svelte-vizlcg"></div>',U(t,"class","bkg-shade svelte-vizlcg")},m(e,n){T(e,t,n),r=!0},i(e){r||(de((()=>{r&&(n||(n=Ie(t,Ae,{duration:150},!0)),n.run(1))})),r=!0)},o(e){n||(n=Ie(t,Ae,{duration:150},!1)),n.run(0),r=!1},d(e){e&&P(t),e&&n&&n.end()}}}function gt(e){let t,n,r=e[0]&&ut();return{c(){r&&r.c(),t=A()},m(e,s){r&&r.m(e,s),T(e,t,s),n=!0},p(e,[n]){e[0]?r?1&n&&ye(r,1):(r=ut(),r.c(),ye(r,1),r.m(t.parentNode,t)):r&&(ve(),xe(r,1,1,(()=>{r=null})),be())},i(e){n||(ye(r),n=!0)},o(e){xe(r),n=!1},d(e){r&&r.d(e),e&&P(t)}}}function pt(e,t,n){let{visible:r=!1}=t;return e.$$set=e=>{"visible"in e&&n(0,r=e.visible)},[r]}class mt extends je{constructor(e){super(),Ne(this,e,pt,gt,a,{visible:0})}}function ft(e){let t;return{c(){t=N("path"),U(t,"d","M384 336H192c-8.8 0-16-7.2-16-16V64c0-8.8 7.2-16 16-16l140.1 0L400 115.9V320c0 8.8-7.2 16-16 16zM192 384H384c35.3 0 64-28.7 64-64V115.9c0-12.7-5.1-24.9-14.1-33.9L366.1 14.1c-9-9-21.2-14.1-33.9-14.1H192c-35.3 0-64 28.7-64 64V320c0 35.3 28.7 64 64 64zM64 128c-35.3 0-64 28.7-64 64V448c0 35.3 28.7 64 64 64H256c35.3 0 64-28.7 64-64V416H272v32c0 8.8-7.2 16-16 16H64c-8.8 0-16-7.2-16-16V192c0-8.8 7.2-16 16-16H96V128H64z"),U(t,"class","svelte-rtaaid")},m(e,n){T(e,t,n)},d(e){e&&P(t)}}}function ht(e){let t;return{c(){t=N("path"),U(t,"d","M208 0H332.1c12.7 0 24.9 5.1 33.9 14.1l67.9 67.9c9 9 14.1 21.2 14.1 33.9V336c0 26.5-21.5 48-48 48H208c-26.5 0-48-21.5-48-48V48c0-26.5 21.5-48 48-48zM48 128h80v64H64V448H256V416h64v48c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V176c0-26.5 21.5-48 48-48z"),U(t,"class","svelte-rtaaid")},m(e,n){T(e,t,n)},d(e){e&&P(t)}}}function $t(e){let t,n="en"===Fe?"Copy ID":"Copier l'ID";return{c(){t=j(n)},m(e,n){T(e,t,n)},p:r,d(e){e&&P(t)}}}function wt(e){let t,n="en"===Fe?"Copied!":"Copié !";return{c(){t=j(n)},m(e,n){T(e,t,n)},p:r,d(e){e&&P(t)}}}function vt(e){let t,n,r,s,o,i,c,a,d,g,p,m,f,h,$,w,v,b;function y(e,t){return e[4]?ht:ft}let x=y(e),k=x(e);function I(e,t){return e[4]?wt:$t}let C=I(e),E=C(e);return{c(){t=L("div"),n=L("figure"),r=L("img"),o=_(),i=L("div"),c=L("span"),d=_(),g=L("button"),p=N("svg"),k.c(),m=_(),f=L("span"),E.c(),U(r,"class","region-img svelte-rtaaid"),u(r.src,s=rt(e[1].img,e[1].xyhw,e[2]?"96,":`,${e[3]}`))||U(r,"src",s),U(r,"alt","Extracted region"),U(c,"class","overlay-desc"),U(i,"class","overlay is-center svelte-rtaaid"),U(n,"class",a="image card region-image "+(e[2]?"is-96x96":"")+" svelte-rtaaid"),U(n,"tabindex","-1"),V(n,"height",e[3]+"px"),V(n,"min-width",e[3]+"px"),U(p,"xmlns","http://www.w3.org/2000/svg"),U(p,"viewBox","0 0 384 512"),U(p,"class","svelte-rtaaid"),U(f,"class","tooltip svelte-rtaaid"),U(g,"class","button region-btn tag svelte-rtaaid"),U(t,"class",h="region is-center "+(e[5](e[1])?"checked":"")+" svelte-rtaaid")},m(s,l){T(s,t,l),S(t,n),S(n,r),S(n,o),S(n,i),S(i,c),c.innerHTML=e[0],S(t,d),S(t,g),S(g,p),k.m(p,null),S(g,m),S(g,f),E.m(f,null),w=!0,v||(b=[M(n,"click",e[10]),M(n,"keyup",bt),M(g,"click",e[11])],v=!0)},p(e,[o]){(!w||14&o&&!u(r.src,s=rt(e[1].img,e[1].xyhw,e[2]?"96,":`,${e[3]}`)))&&U(r,"src",s),(!w||1&o)&&(c.innerHTML=e[0]),(!w||4&o&&a!==(a="image card region-image "+(e[2]?"is-96x96":"")+" svelte-rtaaid"))&&U(n,"class",a),(!w||8&o)&&V(n,"height",e[3]+"px"),(!w||8&o)&&V(n,"min-width",e[3]+"px"),x!==(x=y(e))&&(k.d(1),k=x(e),k&&(k.c(),k.m(p,null))),C===(C=I(e))&&E?E.p(e,o):(E.d(1),E=C(e),E&&(E.c(),E.m(f,null))),(!w||34&o&&h!==(h="region is-center "+(e[5](e[1])?"checked":"")+" svelte-rtaaid"))&&U(t,"class",h)},i(e){w||(de((()=>{w&&($||($=Ie(t,Ae,{duration:500},!0)),$.run(1))})),w=!0)},o(e){$||($=Ie(t,Ae,{duration:500},!1)),$.run(0),w=!1},d(e){e&&P(t),k.d(),E.d(),e&&$&&$.end(),v=!1,l(b)}}}const bt=()=>null;function yt(e,t,n){let r,s,o;const{isSelected:i}=at;m(e,i,(e=>n(5,o=e)));const{clipBoard:l}=dt;m(e,l,(e=>n(9,s=e)));let{item:c}=t,{isSquare:a=!0}=t,{height:d=(a?96:140)}=t,{desc:u=c.title}=t,{descPromise:g}=t;g&&g.then((e=>n(0,u=e)));return e.$$set=e=>{"item"in e&&n(1,c=e.item),"isSquare"in e&&n(2,a=e.isSquare),"height"in e&&n(3,d=e.height),"desc"in e&&n(0,u=e.desc),"descPromise"in e&&n(8,g=e.descPromise)},e.$$.update=()=>{514&e.$$.dirty&&n(4,r=c.ref===s)},[u,c,a,d,r,o,i,l,g,s,()=>at.toggle(c),()=>dt.copyRef(c.ref)]}class xt extends je{constructor(e){super(),Ne(this,e,yt,vt,a,{item:1,isSquare:2,height:3,desc:0,descPromise:8})}}function kt(e){let t,n,s,o,i,l,c,a,d,u="en"===Fe?"Selection":"Sélection";return{c(){t=L("div"),n=L("button"),s=L("span"),o=L("i"),i=_(),l=j(u),c=j("\n            ("),a=j(e[0]),d=j(")"),U(o,"class","fa-solid fa-book-bookmark"),U(s,"id","btn-content"),U(n,"id","set-btn"),U(n,"class","button px-5 py-4 is-link js-modal-trigger svelte-hs48f9"),U(n,"data-target","selection-modal"),U(t,"class","set-container svelte-hs48f9")},m(e,r){T(e,t,r),S(t,n),S(n,s),S(s,o),S(s,i),S(s,l),S(s,c),S(s,a),S(s,d)},p(e,[t]){1&t&&D(a,e[0])},i:r,o:r,d(e){e&&P(t)}}}function It(e,t,n){let{selectionLength:r=0}=t,s=r;return e.$$set=e=>{"selectionLength"in e&&n(0,r=e.selectionLength)},e.$$.update=()=>{if(3&e.$$.dirty&&r!==s){const e=r>s;n(1,s=r);const t=document.getElementById("btn-content");t&&t.animate([{transform:e?"translateY(-7px)":"translateX(-5px)"},{transform:e?"translateY(7px)":"translateX(5px)"},{transform:"translate(0)"}],{duration:300,easing:"cubic-bezier(0.65, 0, 0.35, 1)"})}},[r,s]}class Ct extends je{constructor(e){super(),Ne(this,e,It,kt,a,{selectionLength:0})}}function St(e){let t,n,s,o,i,l,c,a,d,u,g,p,m,f,h;return{c(){t=L("button"),n=_(),s=L("div"),o=L("div"),i=_(),l=L("div"),c=L("div"),c.innerHTML='<div class="title is-4 mb-0 media-content"><span id="modal-title" class="mb-0"></span></div> \n            <button class="delete media-left" aria-label="close"></button>',a=_(),d=L("section"),u=_(),g=L("footer"),p=L("div"),m=L("button"),m.textContent=""+("en"===Fe?"Abort":"Retour"),f=_(),h=L("button"),h.textContent="OK",U(t,"id","hidden-msg-btn"),U(t,"class","js-modal-trigger"),U(t,"data-target","msg-modal"),t.hidden=!0,U(o,"id","modal-bkg"),U(o,"class","modal-background"),U(c,"class","modal-card-head media mb-0"),U(d,"id","modal-body"),U(d,"class","modal-card-body"),U(m,"id","cancel-btn"),U(m,"class","button is-link is-light button-close"),U(h,"id","ok-btn"),U(h,"class","button is-link button-close"),U(p,"class","buttons"),U(g,"id","modal-footer"),U(g,"class","modal-card-foot is-center pt-3"),g.hidden=!0,U(l,"class","modal-content"),U(s,"id","msg-modal"),U(s,"class","modal fade"),U(s,"tabindex","-1"),U(s,"aria-labelledby","selection-modal-label"),U(s,"aria-hidden","true")},m(e,r){T(e,t,r),T(e,n,r),T(e,s,r),S(s,o),S(s,i),S(s,l),S(l,c),S(l,a),S(l,d),S(l,u),S(l,g),S(g,p),S(p,m),S(p,f),S(p,h)},p:r,i:r,o:r,d(e){e&&P(t),e&&P(n),e&&P(s)}}}class Et extends je{constructor(e){super(),Ne(this,e,null,St,a,{})}}function Rt(e){let t,n,s,o,i,l=He.includes("regions"),c=l&&function(e){let t,n,s;return{c(){t=L("button"),t.textContent="en"===Fe?"Automatic region extraction":"Extraction automatique des régions",U(t,"class","button is-link is-inverted")},m(r,o){T(r,t,o),n||(s=M(t,"click",e[1]),n=!0)},p:r,d(e){e&&P(t),n=!1,s()}}}(e);return{c(){t=L("div"),n=L("button"),n.textContent=""+("en"===Fe?"Manually annotate":"Annoter manuellement"),s=_(),c&&c.c(),U(n,"class","button is-link"),U(t,"class","is-center buttons is-centered pt-5")},m(r,l){T(r,t,l),S(t,n),S(t,s),c&&c.m(t,null),o||(i=M(n,"click",e[0]),o=!0)},p(e,[t]){l&&c.p(e,t)},i:r,o:r,d(e){e&&P(t),c&&c.d(),o=!1,i()}}}function Tt(e,t,n){const r=re("witness");let{currentRegionId:s}=t,{baseUrl:o}=t;return e.$$set=e=>{"currentRegionId"in e&&n(2,s=e.currentRegionId),"baseUrl"in e&&n(3,o=e.baseUrl)},[async function(){const e=`${window.location.origin}/${Ve}`;let t=`${e}/witness/${r.id}/regions/add`;if(1===r.regions.length||s){const n=s||r.regions[0];t=`${e}/witness/${r.id}/regions/${n}/add`}const n=await Ye((()=>fetch(t,{method:"POST",headers:{"X-CSRFToken":Be}})));if(!n.ok)throw await ot(`Failed to create regions: '${n.statusText}'`,"Error"),new Error(`Failed to create regions: '${n.statusText}'`);let i;try{i=await n.json()}catch(e){throw await ot(`Failed to parse JSON response: '${e}'`,"Error"),new Error(`Failed to parse JSON response: '${e}'`)}i.hasOwnProperty("mirador_url")&&window.open(i.mirador_url),i.hasOwnProperty("regions_id")&&(window.location.href=`${o.split("regions/")[0]}regions/${i.regions_id}`)},async function(){const e=`${window.location.origin}/${Ve}/witness/${r.id}/regions/extract`,t=await Ye((()=>fetch(e,{method:"POST",headers:{"X-CSRFToken":Be}})));let n;if(!t.ok)throw await ot(`Failed to launch regions extraction: '${n.message}'`,"Error"),new Error(`Failed to launch regions extraction: '${n.message}'`);try{n=await t.json(),console.log(n)}catch(e){throw await ot(`Failed to parse JSON response: '${e}'`,"Error"),new Error(`Failed to parse JSON response: '${e}'`)}finally{const e=n.doc_set_id;if(!e)throw await ot("Failed to launch regions extraction: 'No document set id'","Error"),new Error("Failed to launch regions extraction: 'No document set id'");window.location.href=`${window.location.origin}/${Ve}/treatment/add/?document_set=${e}&task_type=regions`}},s,o]}class Pt extends je{constructor(e){super(),Ne(this,e,Tt,Rt,a,{currentRegionId:2,baseUrl:3})}}function Ot(e,t,n){const r=e.slice();return r[6]=t[n],r}function Lt(e){let t,n=e[3].regions,r=[];for(let t=0;t<n.length;t+=1)r[t]=jt(Ot(e,n,t));return{c(){for(let e=0;e<r.length;e+=1)r[e].c();t=A()},m(e,n){for(let t=0;t<r.length;t+=1)r[t]&&r[t].m(e,n);T(e,t,n)},p(e,s){if(9&s){let o;for(n=e[3].regions,o=0;o<n.length;o+=1){const i=Ot(e,n,o);r[o]?r[o].p(i,s):(r[o]=jt(i),r[o].c(),r[o].m(t.parentNode,t))}for(;o<r.length;o+=1)r[o].d(1);r.length=n.length}},d(e){O(r,e),e&&P(t)}}}function Nt(e){let t,n;function r(e,n){return 4&n&&(t=null),null==t&&(t=!!["all","page"].includes(e[2])),t?At:"similarity"===e[2]?_t:void 0}let s=r(e,-1),o=s&&s(e);return{c(){o&&o.c(),n=A()},m(e,t){o&&o.m(e,t),T(e,n,t)},p(e,t){s===(s=r(e,t))&&o?o.p(e,t):(o&&o.d(1),o=s&&s(e),o&&(o.c(),o.m(n.parentNode,n)))},d(e){o&&o.d(e),e&&P(n)}}}function jt(e){let t,n,r,s,o=e[6]+"";return{c(){t=L("a"),n=j("Regions #"),r=j(o),U(t,"href",s=""+(e[0]+e[6])),U(t,"class","tag is-dark mr-3 is-rounded")},m(e,s){T(e,t,s),S(t,n),S(t,r)},p(e,n){1&n&&s!==(s=""+(e[0]+e[6]))&&U(t,"href",s)},d(e){e&&P(t)}}}function _t(e){let t,n,s;return{c(){t=L("button"),t.textContent=""+("en"===Fe?"Delete all regions similarity":"Supprimer toutes les similarités du document"),U(t,"class","tag is-danger")},m(r,o){T(r,t,o),n||(s=M(t,"click",e[5]),n=!0)},p:r,d(e){e&&P(t),n=!1,s()}}}function At(e){let t,n,s;return{c(){t=L("button"),t.textContent=""+("en"===Fe?"Delete regions record":"Supprimer l'intégralité des régions"),U(t,"class","tag is-danger")},m(r,o){T(r,t,o),n||(s=M(t,"click",e[4]),n=!0)},p:r,d(e){e&&P(t),n=!1,s()}}}function Mt(e){let t;function n(e,t){return e[1]?Nt:Lt}let s=n(e),o=s(e);return{c(){t=L("div"),o.c()},m(e,n){T(e,t,n),o.m(t,null)},p(e,[r]){s===(s=n(e))&&o?o.p(e,r):(o.d(1),o=s(e),o&&(o.c(),o.m(t,null)))},i:r,o:r,d(e){e&&P(t),o.d()}}}function qt(e,t,n){const r=re("witness");let{baseUrl:s=`${window.location.origin}${window.location.pathname}`}=t,{currentRegionId:o}=t,{currentLayout:i}=t;return e.$$set=e=>{"baseUrl"in e&&n(0,s=e.baseUrl),"currentRegionId"in e&&n(1,o=e.currentRegionId),"currentLayout"in e&&n(2,i=e.currentLayout)},[s,o,i,r,async function(){if(!await ot("en"===Fe?"Are you sure you want to delete this record?":"Voulez-vous vraiment supprimer cet enregistrement ?","en"===Fe?"Confirm deletion":"Confirmer la suppression",!0))return;if("number"!=typeof o)throw new Error("Invalid region ID");const e=`${window.location.origin}/${Ve}/regions/${o}/delete`;try{const t=await Ye((()=>fetch(e,{method:"DELETE",headers:{"X-CSRFToken":Be}})));if(204!==t.status)throw new Error(`Failed to delete regions: '${t.statusText}'`);window.location.href=`${s.split("regions/")[0]}regions/`}catch(e){console.error(e)}},async function(){if(!await ot("en"===Fe?"Are you sure you want to delete all similarity scores for this document?":"Voulez-vous vraiment supprimer l'intégralité des scores de similarité pour ce document ?","en"===Fe?"Confirm deletion":"Confirmer la suppression",!0))return;if("number"!=typeof o)throw new Error("Invalid region ID");const e=`${window.location.origin}/${Ve}/similarity/reset/${o}`;try{const t=await Ye((()=>fetch(e,{method:"DELETE",headers:{"X-CSRFToken":Be}})));if(204!==t.status&&200!==t.status)throw new Error(`Failed to delete similarity: '${t.statusText}'`);window.location.href=`${s.split("regions/")[0]}regions/`}catch(e){console.error(e),await ot(e.message,"Error")}}]}class Ut extends je{constructor(e){super(),Ne(this,e,qt,Mt,a,{baseUrl:0,currentRegionId:1,currentLayout:2})}}function Dt(e){let t;return{c(){t=N("path"),U(t,"d","M471.6 21.7c-21.9-21.9-57.3-21.9-79.2 0L362.3 51.7l97.9 97.9 30.1-30.1c21.9-21.9 21.9-57.3 0-79.2L471.6 21.7zm-299.2 220c-6.1 6.1-10.8 13.6-13.5 21.9l-29.6 88.8c-2.9 8.6-.6 18.1 5.8 24.6s15.9 8.7 24.6 5.8l88.8-29.6c8.2-2.7 15.7-7.4 21.9-13.5L437.7 172.3 339.7 74.3 172.4 241.7zM96 64C43 64 0 107 0 160V416c0 53 43 96 96 96H352c53 0 96-43 96-96V320c0-17.7-14.3-32-32-32s-32 14.3-32 32v96c0 17.7-14.3 32-32 32H96c-17.7 0-32-14.3-32-32V160c0-17.7 14.3-32 32-32h96c17.7 0 32-14.3 32-32s-14.3-32-32-32H96z"),U(t,"class","svelte-h0t5l9")},m(e,n){T(e,t,n)},d(e){e&&P(t)}}}function Ft(e){let t;return{c(){t=N("path"),U(t,"d","M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"),U(t,"class","svelte-h0t5l9")},m(e,n){T(e,t,n)},d(e){e&&P(t)}}}function Vt(e){let t,n="en"===Fe?"Edit":"Modifier";return{c(){t=j(n)},m(e,n){T(e,t,n)},p:r,d(e){e&&P(t)}}}function zt(e){let t,n="en"===Fe?"Validate":"Valider";return{c(){t=j(n)},m(e,n){T(e,t,n)},p:r,d(e){e&&P(t)}}}function Bt(e){let t,n,s,o,i,c,a,d,u,g,p,m,f,h,$,w,v="en"===Fe?"Reload":"Recharger",b="en"===Fe?"Go to editor":"Aller à l'éditeur",y="en"===Fe?"Delete selected regions":"Supprimer les régions sélectionnées";return{c(){t=L("button"),n=L("i"),s=_(),o=j(v),i=_(),c=L("a"),a=L("i"),d=_(),u=j(b),g=_(),p=L("button"),m=L("i"),f=_(),h=j(y),U(n,"class","fa-solid fa-rotate-right"),U(t,"class","tag is-link is-light is-rounded mr-3"),U(a,"class","fa-solid fa-edit"),U(c,"class","tag is-link is-rounded mr-3"),U(c,"href",st(e[4])),U(c,"target","_blank"),U(m,"class","fa-solid fa-trash"),U(p,"class","tag is-danger is-rounded")},m(r,l){T(r,t,l),S(t,n),S(t,s),S(t,o),T(r,i,l),T(r,c,l),S(c,a),S(c,d),S(c,u),T(r,g,l),T(r,p,l),S(p,m),S(p,f),S(p,h),$||(w=[M(t,"click",e[14]),M(p,"click",e[6])],$=!0)},p:r,d(e){e&&P(t),e&&P(i),e&&P(c),e&&P(g),e&&P(p),$=!1,l(w)}}}function Ht(e){let t,n,s,o,i,c,a,d,u,g,p,m,f,h,$,w,v,b,y,x="en"===Fe?"Download":"Télécharger";function k(e,t){return e[0]?Ft:Dt}let I=k(e),C=I(e);function E(e,t){return e[0]?zt:Vt}let R=E(e),O=R(e),A=e[0]&&Bt(e);return{c(){t=L("div"),n=L("button"),s=N("svg"),C.c(),o=_(),O.c(),c=_(),a=L("button"),d=L("i"),u=_(),g=L("span"),g.textContent=""+("en"===Fe?"Select all":"Tout sélectionner"),p=_(),m=L("button"),f=L("i"),h=_(),$=j(x),w=_(),v=L("div"),A&&A.c(),U(s,"xmlns","http://www.w3.org/2000/svg"),U(s,"viewBox","0 0 384 512"),U(s,"class","pr-3 svelte-h0t5l9"),U(n,"class",i="button "+(e[0]?"is-success":"is-link")+" mr-3"),U(d,"class","fa-solid fa-square-check"),U(g,"id","all-selection"),U(a,"class","button is-link is-light mr-3"),U(f,"class","fa-solid fa-download"),U(m,"class","button is-link is-light"),U(t,"class","is-right mb-3"),U(v,"class","edit-action is-right svelte-h0t5l9")},m(r,i){T(r,t,i),S(t,n),S(n,s),C.m(s,null),S(n,o),O.m(n,null),S(t,c),S(t,a),S(a,d),S(a,u),S(a,g),S(t,p),S(t,m),S(m,f),S(m,h),S(m,$),T(r,w,i),T(r,v,i),A&&A.m(v,null),b||(y=[M(n,"click",e[13]),M(a,"click",e[7]),M(m,"click",e[8])],b=!0)},p(e,[t]){I!==(I=k(e))&&(C.d(1),C=I(e),C&&(C.c(),C.m(s,null))),R===(R=E(e))&&O?O.p(e,t):(O.d(1),O=R(e),O&&(O.c(),O.m(n,null))),1&t&&i!==(i="button "+(e[0]?"is-success":"is-link")+" mr-3")&&U(n,"class",i),e[0]?A?A.p(e,t):(A=Bt(e),A.c(),A.m(v,null)):A&&(A.d(1),A=null)},i:r,o:r,d(e){e&&P(t),C.d(),O.d(),e&&P(w),e&&P(v),A&&A.d(),b=!1,l(y)}}}async function Jt(e){const t=SAS_APP_URL.replace("https","http"),n=`${SAS_APP_URL}/annotation/destroy?uri=${t}/annotation/${e}`,r=await fetch(n,{method:"DELETE"});if(204!==r.status)throw new Error(`Failed to delete ${n} due to ${r.status}: '${r.statusText}'`)}function Xt(e,t,n){let r,s,o,i,l,c,a;const{selected:d,nbSelected:u}=at;m(e,d,(e=>n(10,l=e))),m(e,u,(e=>n(12,a=e)));const{allRegions:g}=dt;m(e,g,(e=>n(11,c=e)));const p=re("manifest"),f=re("isValidated");function h(){n(0,s=!s)}return e.$$.update=()=>{4096&e.$$.dirty&&n(9,r=a(!0)),1024&e.$$.dirty&&(o=l(!0)),2560&e.$$.dirty&&(i=r>=Object.keys(c).length)},n(0,s=!f),[s,d,u,g,p,h,async function(){if(await ot("en"===Fe?"Are you sure you want to delete these regions?":"Voulez-vous vraiment supprimer ces régions ?","en"===Fe?"Confirm deletion":"Confirmer la suppression",!0))for(const e of Object.keys(o))try{if(!c.hasOwnProperty(e))continue;await Jt(e),dt.remove(e),at.remove(e,Je)}catch(t){await ot(`Failed to delete region ${e}: ${t.message}`,"Error")}},function(){i?at.removeAll(Object.keys(c),Je):at.addAll(Object.values(c))},async function(){const e=Object.values(l(!0)).map((e=>e.ref)),t=await Ye((()=>fetch(`${window.location.origin}/${Ve}/regions/export`,{method:"POST",headers:{"X-CSRFToken":Be},body:JSON.stringify({regionsRef:e})})));it(await t.blob(),"regions.zip")},r,l,c,a,()=>h(),()=>location.reload()]}class Zt extends je{constructor(e){super(),Ne(this,e,Xt,Ht,a,{})}}const Wt=function(){const e=`${window.location.origin}${window.location.pathname}`,t=window.location.pathname.match(/\d+/g).join("-"),n={[t]:{}},r=[2,6],s=Ue(1),o=Ue({}),i=Ue(JSON.parse(localStorage.getItem("selectedRegions"))||n);i.subscribe((e=>localStorage.setItem("selectedRegions",JSON.stringify(e))));const l=Ue(JSON.parse(localStorage.getItem("excludedCategories"))||[]);l.subscribe((e=>localStorage.setItem("excludedCategories",JSON.stringify(e))));const c=Ue(JSON.parse(localStorage.getItem("similarityScoreCutoff"))||void 0);c.subscribe((e=>{null!=e&&localStorage.setItem("similarityScoreCutoff",JSON.stringify(e))}));const a=Ue(JSON.parse(localStorage.getItem("propagateRecursionDepth"))||r[1]);a.subscribe((e=>localStorage.setItem("propagateRecursionDepth",JSON.stringify(e))));const d=Ue(JSON.parse(localStorage.getItem("propagateFilterByRegions"))||!1);d.subscribe((e=>localStorage.setItem("propagateFilterByRegions",JSON.stringify(e))));const u=De([a,d],(([e,t])=>({propagateRecursionDepth:e,propagateFilterByRegions:t}))),g=De([l,i,c],(([e,t,n])=>({excludedCategories:e,regions:t,similarityScoreCutoff:n}))),m=De([u,g],(([e,t])=>({propagate:e,similarity:t}))),f=Ue([]),h=Ue([]);function $(e){localStorage.setItem("selectedRegions",JSON.stringify(e))}const w=De(i,(e=>n=>e[t]?.hasOwnProperty(n))),v=()=>tt(s,"sp"),b=De([s,f],(([e,t])=>(async()=>function(e,t){const n=25*(e-1),r=n+25,s=t.slice(n,r);return h.set(s),s}(e,t))()));function y(e){nt(e,s,"sp")}return{currentPage:s,comparedRegions:o,excludedCategories:l,qImgs:f,pageQImgs:h,selectedRegions:i,propagateRecursionDepth:a,propagateFilterByRegions:d,similarityToolbarParams:m,propagateParams:u,similarityScoreCutoff:c,allowedPropagateDepthRange:r,fetchSimilarity:async function(){const n=async()=>{const n=await fetch(`${e}compared-regions`),r=await n.json();o.set(r),i.update((e=>{let n=e[t]||{};if(Object.keys(n).length){let s=Object.keys(n).filter((e=>Object.keys(r).includes(e))).reduce(((e,t)=>(e[t]=n[t],e)),{});e[t]=s}return e}))},r=async()=>{const t=await fetch(`${e}query-images`),n=await t.json();n.length>0&&(f.set(n),y(v()))};Qe.set(!0);try{await Promise.all([n(),r()])}catch(e){console.error("Error:",e),Ke.set(e.message)}finally{Qe.set(!1)}},setPageQImgs:b,getRegionsInfo:function(e){const t=p(o),n=Object.keys(t).filter((t=>t.startsWith(e)));return 1!==n.length?{title:"Error"}:t[n[0]]},handlePageUpdate:y,unselect:function(e){i.update((n=>{const r={...n};return delete r[t][e],$(r),r}))},select:function(e){i.update((n=>{const r={...n,[t]:{...n[t]||{},[e.ref]:e}};return $(r),r}))},addComparedRegions:function(e){o.update((t=>({...t,[e.ref]:e})))},isSelected:w,pageLength:25}}();function Gt(e){let t,n,r;const s=e[1].default,o=f(s,e,e[0],null);return{c(){t=L("table"),n=L("tbody"),o&&o.c(),U(t,"class","table is-fullwidth")},m(e,s){T(e,t,s),S(t,n),o&&o.m(n,null),r=!0},p(e,[t]){o&&o.p&&(!r||1&t)&&w(o,s,e,e[0],r?$(s,e[0],t,null):v(e[0]),null)},i(e){r||(ye(o,e),r=!0)},o(e){xe(o,e),r=!1},d(e){e&&P(t),o&&o.d(e)}}}function Qt(e,t,n){let{$$slots:r={},$$scope:s}=t;return e.$$set=e=>{"$$scope"in e&&n(0,s=e.$$scope)},[s,r]}class Kt extends je{constructor(e){super(),Ne(this,e,Qt,Gt,a,{})}}function Yt(e){let t,n,r,s,o,i,l,c,a,d=e[4]>1&&en(e),u=e[4]<e[3]&&rn(e);return{c(){t=L("nav"),n=L("ul"),d&&d.c(),r=_(),s=L("li"),o=L("a"),i=j(e[4]),l=_(),u&&u.c(),U(o,"class","pagination-link is-current"),U(o,"href",null),U(n,"class","pagination-list ml-0"),U(t,"class","pagination is-centered mb-2"),U(t,"aria-label","pagination")},m(g,p){T(g,t,p),S(t,n),d&&d.m(n,null),S(n,r),S(n,s),S(s,o),S(o,i),S(n,l),u&&u.m(n,null),c||(a=M(o,"click",q(e[8])),c=!0)},p(e,t){e[4]>1?d?d.p(e,t):(d=en(e),d.c(),d.m(n,r)):d&&(d.d(1),d=null),16&t&&D(i,e[4]),e[4]<e[3]?u?u.p(e,t):(u=rn(e),u.c(),u.m(n,null)):u&&(u.d(1),u=null)},d(e){e&&P(t),d&&d.d(),u&&u.d(),c=!1,a()}}}function en(e){let t,n,r,s,o,i,l=e[4]-1>1&&tn(e);return{c(){t=L("li"),n=L("a"),n.textContent="1",r=_(),l&&l.c(),s=A(),U(n,"class","pagination-link"),U(n,"href",null)},m(c,a){T(c,t,a),S(t,n),T(c,r,a),l&&l.m(c,a),T(c,s,a),o||(i=M(n,"click",q(e[6])),o=!0)},p(e,t){e[4]-1>1?l?l.p(e,t):(l=tn(e),l.c(),l.m(s.parentNode,s)):l&&(l.d(1),l=null)},d(e){e&&P(t),e&&P(r),l&&l.d(e),e&&P(s),o=!1,i()}}}function tn(e){let t,n,r,s,o,i,l=e[4]-1+"",c=e[4]-1>2&&nn();return{c(){c&&c.c(),t=_(),n=L("li"),r=L("a"),s=j(l),U(r,"class","pagination-link"),U(r,"href",null)},m(l,a){c&&c.m(l,a),T(l,t,a),T(l,n,a),S(n,r),S(r,s),o||(i=M(r,"click",q(e[7])),o=!0)},p(e,n){e[4]-1>2?c||(c=nn(),c.c(),c.m(t.parentNode,t)):c&&(c.d(1),c=null),16&n&&l!==(l=e[4]-1+"")&&D(s,l)},d(e){c&&c.d(e),e&&P(t),e&&P(n),o=!1,i()}}}function nn(e){let t;return{c(){t=L("li"),t.innerHTML='<span class="pagination-ellipsis">…</span>'},m(e,n){T(e,t,n)},d(e){e&&P(t)}}}function rn(e){let t,n,r,s,o,i,l=e[4]+1<e[3]&&sn(e);return{c(){l&&l.c(),t=_(),n=L("li"),r=L("a"),s=j(e[3]),U(r,"class","pagination-link"),U(r,"href",null)},m(c,a){l&&l.m(c,a),T(c,t,a),T(c,n,a),S(n,r),S(r,s),o||(i=M(r,"click",q(e[10])),o=!0)},p(e,n){e[4]+1<e[3]?l?l.p(e,n):(l=sn(e),l.c(),l.m(t.parentNode,t)):l&&(l.d(1),l=null),8&n&&D(s,e[3])},d(e){l&&l.d(e),e&&P(t),e&&P(n),o=!1,i()}}}function sn(e){let t,n,r,s,o,i,l,c=e[4]+1+"",a=e[4]+2<e[3]&&on();return{c(){t=L("li"),n=L("a"),r=j(c),s=_(),a&&a.c(),o=A(),U(n,"class","pagination-link"),U(n,"href",null)},m(c,d){T(c,t,d),S(t,n),S(n,r),T(c,s,d),a&&a.m(c,d),T(c,o,d),i||(l=M(n,"click",q(e[9])),i=!0)},p(e,t){16&t&&c!==(c=e[4]+1+"")&&D(r,c),e[4]+2<e[3]?a||(a=on(),a.c(),a.m(o.parentNode,o)):a&&(a.d(1),a=null)},d(e){e&&P(t),e&&P(s),a&&a.d(e),e&&P(o),i=!1,l()}}}function on(e){let t;return{c(){t=L("li"),t.innerHTML='<span class="pagination-ellipsis">…</span>'},m(e,n){T(e,t,n)},d(e){e&&P(t)}}}function ln(e){let t,n,s,o,i,l,c,a=e[4]*e[2]-e[2]+1+"",d=Math.min(e[4]*e[2],e[1])+"",u=(e[3]>1||e[1]>e[2])&&Yt(e);return{c(){u&&u.c(),t=_(),n=L("div"),s=j(a),o=j(" - "),i=j(d),l=j(" / "),c=j(e[1]),U(n,"class","is-size-7 is-center mb-4")},m(e,r){u&&u.m(e,r),T(e,t,r),T(e,n,r),S(n,s),S(n,o),S(n,i),S(n,l),S(n,c)},p(e,[n]){e[3]>1||e[1]>e[2]?u?u.p(e,n):(u=Yt(e),u.c(),u.m(t.parentNode,t)):u&&(u.d(1),u=null),20&n&&a!==(a=e[4]*e[2]-e[2]+1+"")&&D(s,a),22&n&&d!==(d=Math.min(e[4]*e[2],e[1])+"")&&D(i,d),2&n&&D(c,e[1])},i:r,o:r,d(e){u&&u.d(e),e&&P(t),e&&P(n)}}}function cn(e,t,n){let r,s,{store:o}=t;const{currentPage:i}=o;m(e,i,(e=>n(4,s=e)));let{nbOfItems:l}=t,{pageLength:c=Ge}=t;return e.$$set=e=>{"store"in e&&n(0,o=e.store),"nbOfItems"in e&&n(1,l=e.nbOfItems),"pageLength"in e&&n(2,c=e.pageLength)},e.$$.update=()=>{6&e.$$.dirty&&n(3,r=c<Ge?1:Math.ceil(l/c))},[o,l,c,r,s,i,()=>o.handlePageUpdate(1),()=>o.handlePageUpdate(s-1),()=>o.handlePageUpdate(s),()=>o.handlePageUpdate(s+1),()=>o.handlePageUpdate(r)]}class an extends je{constructor(e){super(),Ne(this,e,cn,ln,a,{store:0,nbOfItems:1,pageLength:2})}}const dn='<svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 68 69">\n        <rect x="10" y="10.62" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>\n        <rect x="1" y="1" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>\n        <rect x="10" y="10.62" width="46" height="45.71" rx="4.11" ry="4.11" fill="currentColor" stroke="none"/>\n    </svg>',un='<svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 70 71">\n        <rect x="12" y="12.43" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>\n        <rect x="1" y="0.81" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>\n        <path d="M 12 21.43 L 21 12.43" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>\n        <path d="M 12 30 L 30 12.43" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>\n        <path d="M 40 56 L 57 38" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>\n        <path d="M 48.3 56.29 L 57 47" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>\n        <path d="M 12 39 L 39 12" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>\n        <path d="M 12 48 L 48 12" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>\n        <path d="M 13 56 L 57 12" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>\n        <path d="M 31 56 L 57 29" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>\n        <path d="M 21 57 L 57 21" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>\n    </svg>',gn='<svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 72 73">\n        <rect x="14" y="14.43" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3" stroke-dasharray="9 9"/>\n        <rect x="1" y="0.81" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>\n    </svg>',pn='<svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 59 59">\n        <rect x="1" y="0.62" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>\n        <path d="M 2.67 54.55 L 55 2" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>\n        <path d="M 54.37 54.05 L 2.72 2.24" fill="none" stroke="currentColor" stroke-width="3" stroke-miterlimit="10"/>\n    </svg>',mn='<svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 59 59">\n        <rect x="1" y="0.81" width="55.71" height="55.71" rx="5.01" ry="5.01" fill="none" stroke="currentColor" stroke-width="3"/>\n        <path d="M 8.69 55.28 C 9.25 44.15 18.08 35.28 28.86 35.28 C 32.5 35.28 36.07 36.3 39.18 38.25 C 44.96 41.85 48.66 48.3 49.02 55.28 Z M 17.85 21.48 C 17.85 15.37 22.79 10.39 28.86 10.39 C 34.92 10.39 39.86 15.37 39.86 21.48 C 39.86 27.59 34.92 32.56 28.86 32.56 C 22.79 32.56 17.85 27.59 17.85 21.48 Z M 40.37 36.34 C 38.43 35.13 36.32 34.25 34.13 33.7 C 38.82 31.64 42.1 26.94 42.1 21.48 C 42.1 14.13 36.16 8.15 28.86 8.15 C 21.55 8.15 15.61 14.13 15.61 21.48 C 15.61 26.95 18.9 31.66 23.6 33.71 C 13.76 36.18 6.41 45.4 6.41 56.4 C 6.41 57.02 6.92 57.52 7.54 57.52 L 50.17 57.52 C 50.79 57.52 51.3 57.02 51.3 56.4 C 51.3 48.23 47.11 40.54 40.37 36.34 Z" fill="currentColor" stroke="none"/>\n    </svg>',fn="en"===Fe?"overall visual matches":"correspondances visuelles globales",hn="en"===Fe?"visual matches on part of the image":"correspondances visuelles sur une partie de l'image",$n="en"===Fe?"semantic and non-visual matches":"correspondances sémantiques et non-visuelle",wn="en"===Fe?"regions without match":"régions sans correspondance",vn="en"===Fe?"user specific category":"correspondances spécifiques à l'utilisateur";function bn(e){let t,n,r,s,o,i,c,a,d,u,g,p,m,f,h,$;return n=new xt({props:{item:e[2],size:256,descPromise:e[3](),isSquare:!1}}),{c(){t=L("div"),Te(n.$$.fragment),r=_(),s=L("div"),o=L("span"),i=_(),c=L("span"),a=_(),d=L("span"),u=_(),g=L("span"),p=_(),m=L("span"),U(o,"class","tag is-hoverable pl-4 pr-3 py-4"),U(o,"title","en"===Fe?"Exact match":"Correspondance exacte"),z(o,"is-selected",1===e[0]),U(c,"class","tag is-hoverable py-4 px-3"),U(c,"title","en"===Fe?"Partial match":"Correspondance partielle"),z(c,"is-selected",2===e[0]),U(d,"class","tag is-hoverable py-4 px-3"),U(d,"title","en"===Fe?"Semantic match":"Correspondance sémantique"),z(d,"is-selected",3===e[0]),U(g,"class","tag is-hoverable py-4 px-3"),U(g,"title","en"===Fe?"No match":"Aucune correspondance"),z(g,"is-selected",4===e[0]),U(m,"class","tag is-hoverable pl-3 pr-4 py-4"),U(m,"title","en"===Fe?"User match":"Correspondance utilisateur"),z(m,"is-selected",e[1]),U(s,"class","tags has-addons is-dark is-center")},m(l,w){T(l,t,w),Pe(n,t,null),S(t,r),S(t,s),S(s,o),o.innerHTML=dn,S(s,i),S(s,c),c.innerHTML=un,S(s,a),S(s,d),d.innerHTML=gn,S(s,u),S(s,g),g.innerHTML=pn,S(s,p),S(s,m),m.innerHTML=mn,f=!0,h||($=[M(o,"click",e[14]),M(o,"keyup",null),M(c,"click",e[15]),M(c,"keyup",null),M(d,"click",e[16]),M(d,"keyup",null),M(g,"click",e[17]),M(g,"keyup",null),M(m,"click",e[18]),M(m,"keyup",null)],h=!0)},p(e,t){(!f||1&t[0])&&z(o,"is-selected",1===e[0]),(!f||1&t[0])&&z(c,"is-selected",2===e[0]),(!f||1&t[0])&&z(d,"is-selected",3===e[0]),(!f||1&t[0])&&z(g,"is-selected",4===e[0]),(!f||2&t[0])&&z(m,"is-selected",e[1])},i(e){f||(ye(n.$$.fragment,e),f=!0)},o(e){xe(n.$$.fragment,e),f=!1},d(e){e&&P(t),Oe(n),h=!1,l($)}}}function yn(e,t,n){let r,s;const o=new URL(window.location.href),i=o.origin,l=o.pathname;let{qImg:c}=t,{sImg:a}=t,{qRegions:d}=t,{sRegions:u}=t,{score:g=0}=t,{category:p=null}=t,{users:m=[]}=t,{isManual:f}=t,{similarityType:h}=t;const{getRegionsInfo:$,comparedRegions:w}=Wt,v=re("similarityPropagatedContext")||!1,[b,y,x,k]=a.split(".")[0].split("_"),I={id:a,img:a,title:`Canvas ${x} - ${k} - ${"en"===Fe?"Witness":"Témoin"} #${C=b,C.match(/\d+/g).toString()}`,xywh:k,canvas:x,ref:a.replace(".jpg",""),type:Je};var C;const S=`${b}_${y}`;function E(e){let t=(e=e.slice()).indexOf(Number(ze));return s&&-1===t?e.push(Number(ze)):s||-1===t||e.splice(t,1),e}function R(e){5===e?n(1,s=!s):n(0,r=r===e?null:e)}async function T(e){R(e);try{(await fetch(`${i}/${Ve}/save-category`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":Be},body:JSON.stringify({img_1:c,img_2:a,regions_id_1:d,regions_id_2:u,score:g,category:r,category_x:E(m),is_manual:f||2===h,similarity_type:h})})).ok||(console.error("Error: Network response was not ok"),R(e))}catch(t){console.error("Error:",t),R(e)}}return e.$$set=e=>{"qImg"in e&&n(5,c=e.qImg),"sImg"in e&&n(6,a=e.sImg),"qRegions"in e&&n(7,d=e.qRegions),"sRegions"in e&&n(8,u=e.sRegions),"score"in e&&n(9,g=e.score),"category"in e&&n(10,p=e.category),"users"in e&&n(11,m=e.users),"isManual"in e&&n(12,f=e.isManual),"similarityType"in e&&n(13,h=e.similarityType)},e.$$.update=()=>{1024&e.$$.dirty[0]&&n(0,r=p),2048&e.$$.dirty[0]&&n(1,s=m.includes(Number(ze))||!1)},[r,s,I,async function(){const e=e=>`${e}<br>\n            Page ${parseInt(x)}<br>\n            <b>${isNaN(parseFloat(g))||1!==h?2===h&&"en"===Fe?"Manual similarity":2===h&&"fr"===Fe?"Correspondance manuelle":3===h&&"en"===Fe?"Propagated match":"Correspondance propagée":`Score: ${g}`}</b>`;return!0===v?fetch(`${i}${l}get_regions_title/${S}`).then((e=>e.json())).then((t=>e(t.title))).catch((t=>(console.error("SimilarRegion.getDesc()",t),e("fr"===Fe?"Titre inconnu":"Unknown title")))):Promise.resolve(e($(S).title))},T,c,a,d,u,g,p,m,f,h,()=>T(1),()=>T(2),()=>T(3),()=>T(4),()=>T(5)]}class xn extends je{constructor(e){super(),Ne(this,e,yn,bn,a,{qImg:5,sImg:6,qRegions:7,sRegions:8,score:9,category:10,users:11,isManual:12,similarityType:13},null,[-1,-1])}}function kn(e,t,n){const r=e.slice();return r[22]=t[n].uuid,r[23]=t[n].data[0],r[24]=t[n].data[1],r[25]=t[n].data[2],r[26]=t[n].data[3],r[27]=t[n].data[4],r[28]=t[n].data[5],r[29]=t[n].data[6],r[30]=t[n].data[7],r[31]=t[n].data[8],r}function In(e){let t,n,s="en"===Fe?`Error when retrieving similar regions: ${e[2]}`:`Erreur de recupération des régions similaires: ${e[2]}`;return{c(){t=L("div"),n=j(s),U(t,"class","faded is-center")},m(e,r){T(e,t,r),S(t,n)},p(e,t){4&t[0]&&s!==(s="en"===Fe?`Error when retrieving similar regions: ${e[2]}`:`Erreur de recupération des régions similaires: ${e[2]}`)&&D(n,s)},i:r,o:r,d(e){e&&P(t)}}}function Cn(e){let t,n,r,s,o,i,l,c,a=e[4].length+"",d=e[11](e[10],e[4].length)+"",u=[],g=new Map,p=e[4];const m=e=>e[22];for(let t=0;t<p.length;t+=1){let n=kn(e,p,t),r=m(n);g.set(r,u[t]=Pn(r,n))}let f=null;return p.length||(f=En(e)),{c(){t=L("div"),n=L("span"),r=j(a),s=_(),o=j(d),i=_(),l=L("div");for(let e=0;e<u.length;e+=1)u[e].c();f&&f.c(),U(n,"class","m-2"),U(l,"class","m-2 is-gap-2"),z(l,"grid",e[4].length>0)},m(e,a){T(e,t,a),S(t,n),S(n,r),S(n,s),S(n,o),S(t,i),S(t,l);for(let e=0;e<u.length;e+=1)u[e]&&u[e].m(l,null);f&&f.m(l,null),c=!0},p(e,t){(!c||16&t[0])&&a!==(a=e[4].length+"")&&D(r,a),(!c||16&t[0])&&d!==(d=e[11](e[10],e[4].length)+"")&&D(o,d),49&t[0]&&(p=e[4],ve(),u=Re(u,t,m,1,e,p,g,l,Ee,Pn,null,kn),be(),!p.length&&f?f.p(e,t):p.length?f&&(f.d(1),f=null):(f=En(e),f.c(),f.m(l,null))),(!c||16&t[0])&&z(l,"grid",e[4].length>0)},i(e){if(!c){for(let e=0;e<p.length;e+=1)ye(u[e]);c=!0}},o(e){for(let e=0;e<u.length;e+=1)xe(u[e]);c=!1},d(e){e&&P(t);for(let e=0;e<u.length;e+=1)u[e].d();f&&f.d()}}}function Sn(e){let t;return{c(){t=L("div"),t.textContent=""+("en"!==Fe||e[10]?"fr"!==Fe||e[10]?"en"===Fe&&e[10]?"Retrieving propagated regions...":"Récupération de similarités propagées...":"Récupération des régions similaires...":"Retrieving similar regions..."),U(t,"class","faded is-center")},m(e,n){T(e,t,n)},p:r,i:r,o:r,d(e){e&&P(t)}}}function En(e){let t;function n(e,t){return e[5]?Tn:Rn}let r=n(e),s=r(e);return{c(){s.c(),t=A()},m(e,n){s.m(e,n),T(e,t,n)},p(e,o){r===(r=n(e))&&s?s.p(e,o):(s.d(1),s=r(e),s&&(s.c(),s.m(t.parentNode,t)))},d(e){s.d(e),e&&P(t)}}}function Rn(e){let t;return{c(){t=L("div"),t.textContent=("en"===Fe?"No similar regions":"Pas de régions similaires")+" \n                    ",U(t,"class","faded is-center")},m(e,n){T(e,t,n)},p:r,d(e){e&&P(t)}}}function Tn(e){let t;return{c(){t=L("div"),t.textContent=("en"===Fe?"No document selected. Select one to display results.":"Aucun document sélectionné. Sélectionnez-en un pour afficher les résultats.")+" \n                    ",U(t,"class","faded is-center")},m(e,n){T(e,t,n)},p:r,d(e){e&&P(t)}}}function Pn(e,t){let n,r,s;return r=new xn({props:{qImg:t[0],sImg:t[25],score:t[23],qRegions:t[26],sRegions:t[27],category:t[28],users:t[29],isManual:t[30],similarityType:t[31]}}),{key:e,first:null,c(){n=A(),Te(r.$$.fragment),this.first=n},m(e,t){T(e,n,t),Pe(r,e,t),s=!0},p(e,n){t=e;const s={};1&n[0]&&(s.qImg=t[0]),16&n[0]&&(s.sImg=t[25]),16&n[0]&&(s.score=t[23]),16&n[0]&&(s.qRegions=t[26]),16&n[0]&&(s.sRegions=t[27]),16&n[0]&&(s.category=t[28]),16&n[0]&&(s.users=t[29]),16&n[0]&&(s.isManual=t[30]),16&n[0]&&(s.similarityType=t[31]),r.$set(s)},i(e){s||(ye(r.$$.fragment,e),s=!0)},o(e){xe(r.$$.fragment,e),s=!1},d(e){e&&P(n),Oe(r,e)}}}function On(e){let t,n,r,s;const o=[Sn,Cn,In],i=[];function l(e,t){return e[1]&&"loading"===e[3]?0:"loaded"===e[3]?1:"error"===e[3]?2:-1}return~(t=l(e))&&(n=i[t]=o[t](e)),{c(){n&&n.c(),r=A()},m(e,n){~t&&i[t].m(e,n),T(e,r,n),s=!0},p(e,s){let c=t;t=l(e),t===c?~t&&i[t].p(e,s):(n&&(ve(),xe(i[c],1,1,(()=>{i[c]=null})),be()),~t?(n=i[t],n?n.p(e,s):(n=i[t]=o[t](e),n.c()),ye(n,1),n.m(r.parentNode,r)):n=null)},i(e){s||(ye(n),s=!0)},o(e){xe(n),s=!1},d(e){~t&&i[t].d(e),e&&P(r)}}}function Ln(e,t,n){let r,s,o,i,l,c,a,d,{qImg:u}=t,{sImgsPromise:g}=t;const{selectedRegions:p,excludedCategories:f,similarityScoreCutoff:h,propagateFilterByRegions:$}=Wt;m(e,p,(e=>n(16,d=e))),m(e,f,(e=>n(15,a=e))),m(e,h,(e=>n(14,c=e))),m(e,$,(e=>n(13,l=e)));const w=re("similarityPropagatedContext")||!1,v=window.location.pathname.match(/\d+/g).join("-");let b;const y=(e,t,n,r,s,o)=>!!w||((e,t)=>void 0===t||null!=e&&Number(e)>=t)(e,s)&&((e,t,n)=>!n.includes(e))(t,0,r);return e.$$set=e=>{"qImg"in e&&n(0,u=e.qImg),"sImgsPromise"in e&&n(1,g=e.sImgsPromise)},e.$$.update=()=>{var t,l;65536&e.$$.dirty[0]&&n(5,r=0===Object.values(d).length||void 0===d[v]||!Object.keys(d[v]).length),2&e.$$.dirty[0]&&(n(3,s="loading"),n(4,i=[]),n(12,o=[])),2&e.$$.dirty[0]&&g.then((e=>{n(12,o=e.map((e=>({uuid:window.crypto.randomUUID(),data:e})))),n(3,s="loaded")})).catch((e=>{n(2,b=e),n(3,s="error")})),61440&e.$$.dirty[0]&&n(4,(t=a,l=c,i=o.filter((({uuid:e,data:[n,r,s,o,i,c,a,d,u]})=>y(n,c,0,t,l)))))},n(3,s="loading"),n(12,o=[]),[u,g,b,s,i,r,p,f,h,$,w,(e,t)=>{const n=t>1;return e?"fr"===Fe?n?"similarités propagées":"similarité propagée":n?"propagated matches":"propagated match":"fr"===Fe?n?"images similaires":"image similaire":n?"similar images":"similar image"},o,l,c,a,d]}class Nn extends je{constructor(e){super(),Ne(this,e,Ln,On,a,{qImg:0,sImgsPromise:1},null,[-1,-1])}}function jn(e){let t,n,r;return n=new Nn({props:{qImg:e[0],sImgsPromise:e[1]}}),{c(){t=L("div"),Te(n.$$.fragment)},m(e,s){T(e,t,s),Pe(n,t,null),r=!0},p(e,[t]){const r={};1&t&&(r.qImg=e[0]),2&t&&(r.sImgsPromise=e[1]),n.$set(r)},i(e){r||(ye(n.$$.fragment,e),r=!0)},o(e){xe(n.$$.fragment,e),r=!1},d(e){e&&P(t),Oe(n)}}}function _n(e,t,n){let r,{qImg:s}=t;const{selectedRegions:o}=Wt,i=`${window.location.origin}${window.location.pathname}`,l=window.location.pathname.match(/\d+/g).join("-");async function c(e,t){const n=(e=>Object.values(e[l]||{}).map((e=>e.id)))(t);if(0===n.length)return[];const r=await fetch(`${i}similar-images`,{method:"POST",body:JSON.stringify({regionsIds:n,qImg:e,topk:10}),headers:{"Content-Type":"application/json","X-CSRFToken":Be}});return await r.json()}return o.subscribe((e=>{n(1,r=c(s,e))})),e.$$set=e=>{"qImg"in e&&n(0,s=e.qImg)},[s,r]}class An extends je{constructor(e){super(),Ne(this,e,_n,jn,a,{qImg:0})}}function Mn(e){let t,n,r,s,o,i;return o=new Nn({props:{qImg:e[0],sImgsPromise:e[1]}}),{c(){t=L("div"),n=L("div"),r=L("div"),s=_(),Te(o.$$.fragment),U(r,"class","block"),U(n,"class","matches-suggestion svelte-1li2qm8"),U(t,"class","block matches-suggestion-wrapper svelte-1li2qm8")},m(e,l){T(e,t,l),S(t,n),S(n,r),S(n,s),Pe(o,n,null),i=!0},p(e,[t]){const n={};1&t&&(n.qImg=e[0]),2&t&&(n.sImgsPromise=e[1]),o.$set(n)},i(e){i||(ye(o.$$.fragment,e),i=!0)},o(e){xe(o.$$.fragment,e),i=!1},d(e){e&&P(t),Oe(o)}}}function qn(e,t,n){let r,s,{qImg:o}=t;const{propagateParams:i,selectedRegions:l}=Wt;m(e,i,(e=>n(4,r=e))),m(e,l,(e=>n(5,s=e)));const c=`${window.location.origin}${window.location.pathname}`,a=window.location.pathname.match(/\d+/g).join("-");let d;const u=lt();u.setCompareFn(((e,t)=>!![e,t].every((e=>e&&e.hasOwnProperty("propagateRecursionDepth")&&e.hasOwnProperty("propagateFilterByRegions")))&&(e.propagateRecursionDepth===t.propagateRecursionDepth&&e.propagateFilterByRegions===t.propagateFilterByRegions)));const g=lt();g.setCompareFn(ct),ne("similarityPropagatedContext",!0);const p=e=>Object.keys(e).includes(a)?Object.values(e[a]).map((e=>e.id)):[],f=async(e,t)=>fetch(`${c}propagated-matches/${o}`,{method:"POST",body:JSON.stringify({regionsIds:t,filterByRegions:e.propagateFilterByRegions,recursionDepth:e.propagateRecursionDepth}),headers:{"Content-Type":"application/json","X-CSRFToken":Be}}).then((e=>e.json())).catch((e=>(console.error("PropagatedMatches.getPropagatedMatches:",e),[])));return i.subscribe((e=>{u.set(e),u.same()||n(1,d=f(u.get(),p(s)))})),l.subscribe((e=>{g.set(p(e)),!0!==r.propagateFilterByRegions||g.same()||n(1,d=f(r,g.get()))})),e.$$set=e=>{"qImg"in e&&n(0,o=e.qImg)},[o,d,i,l]}class Un extends je{constructor(e){super(),Ne(this,e,qn,Mn,a,{qImg:0})}}function Dn(e){let t,n,r,s,o,i,c,a,d,g,p,m,f,h,$,w,v,b,y,x,k,I,C,E,R,O,A,q,D,z,B,H,J=parseInt(e[4])+"";return O=new An({props:{qImg:e[0]}}),D=new Un({props:{qImg:e[0]}}),{c(){t=L("tr"),n=L("th"),r=L("div"),s=L("a"),o=L("i"),i=j("\n                Page "),c=j(J),a=_(),d=L("img"),p=_(),m=L("div"),f=L("div"),h=L("input"),$=_(),w=L("button"),w.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M256 80c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 144L48 224c-17.7 0-32 14.3-32 32s14.3 32 32 32l144 0 0 144c0 17.7 14.3 32 32 32s32-14.3 32-32l0-144 144 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-144 0 0-144z"></path></svg>',v=_(),b=L("button"),y=N("svg"),x=N("path"),C=_(),E=L("td"),R=L("div"),Te(O.$$.fragment),A=_(),q=L("div"),Te(D.$$.fragment),U(o,"class","fa-solid fa-pen-to-square"),U(s,"class","tag px-2 py-1 mb-2 is-rounded is-hoverable"),U(s,"href",st(e[5],parseInt(e[4]))),U(s,"target","_blank"),u(d.src,g=rt(e[0],"full","250,"))||U(d,"src",g),U(d,"alt","Query region"),U(d,"class","mb-3 card"),U(h,"class","input is-small tag"),U(h,"type","text"),U(h,"placeholder","en"===Fe?"Add new match":"Ajouter une correspondance"),U(w,"class","button is-small tag is-link is-center"),U(f,"class","tags has-addons"),V(f,"flex-wrap","nowrap"),U(x,"fill","white"),U(x,"d","M376.6 84.5c11.3-13.6 9.5-33.8-4.1-45.1s-33.8-9.5-45.1 4.1L192 206 56.6 43.5C45.3 29.9 25.1 28.1 11.5 39.4S-3.9 70.9 7.4 84.5L150.3 256 7.4 427.5c-11.3 13.6-9.5 33.8 4.1 45.1s33.8 9.5 45.1-4.1L192 306 327.4 468.5c11.3 13.6 31.5 15.4 45.1 4.1s15.4-31.5 4.1-45.1L233.7 256 376.6 84.5z"),U(y,"xmlns","http://www.w3.org/2000/svg"),U(y,"viewBox","0 0 384 512"),U(b,"id","no-match"),U(b,"class",k="button is-small tag is-danger is-center m-0 "+(1===e[2]?"visible":"")+" svelte-f4c92p"),U(b,"title","en"===Fe?"No match for this region in this witness":"Aucune correspondance de cette région pour ce témoin"),U(m,"class","new-similarity control pt-2 is-center svelte-f4c92p"),U(r,"class","content-wrapper py-5"),U(n,"class","is-3 center-flex is-narrow"),V(n,"width","260px"),U(R,"class","fixed-grid has-5-cols"),U(q,"class","fixed-grid has-5-cols"),U(E,"class","p-5 is-fullwidth")},m(l,u){T(l,t,u),S(t,n),S(n,r),S(r,s),S(s,o),S(s,i),S(s,c),S(r,a),S(r,d),S(r,p),S(r,m),S(m,f),S(f,h),F(h,e[1]),S(f,$),S(f,w),S(m,v),S(m,b),S(b,y),S(y,x),S(t,C),S(t,E),S(E,R),Pe(O,R,null),S(E,A),S(E,q),Pe(D,q,null),z=!0,B||(H=[M(h,"input",e[9]),M(w,"click",e[6]),M(b,"click",e[7])],B=!0)},p(e,[t]){(!z||1&t&&!u(d.src,g=rt(e[0],"full","250,")))&&U(d,"src",g),2&t&&h.value!==e[1]&&F(h,e[1]),(!z||4&t&&k!==(k="button is-small tag is-danger is-center m-0 "+(1===e[2]?"visible":"")+" svelte-f4c92p"))&&U(b,"class",k);const n={};1&t&&(n.qImg=e[0]),O.$set(n);const r={};1&t&&(r.qImg=e[0]),D.$set(r)},i(e){z||(de((()=>{z&&(I||(I=Ie(b,Ae,{duration:500},!0)),I.run(1))})),ye(O.$$.fragment,e),ye(D.$$.fragment,e),z=!0)},o(e){I||(I=Ie(b,Ae,{duration:500},!1)),I.run(0),xe(O.$$.fragment,e),xe(D.$$.fragment,e),z=!1},d(e){e&&P(t),e&&I&&I.end(),Oe(O),Oe(D),B=!1,l(H)}}}function Fn(e,t,n){let r,s;const{selectedRegions:o}=Wt;m(e,o,(e=>n(8,s=e)));let{qImg:i}=t,l="";const[c,a,d,u]=i.split(".")[0].split("_"),g=re("manifest"),p=`${window.location.origin}${window.location.pathname}`,f=window.location.pathname.match(/\d+/g).join("-"),h="en"===Fe?"Error":"Erreur";return e.$$set=e=>{"qImg"in e&&n(0,i=e.qImg)},e.$$.update=()=>{256&e.$$.dirty&&n(2,r=s.hasOwnProperty(f)?Object.values(s[f]).length:0)},[i,l,r,o,d,g,async function(){var e;if(l&&(e=(e=l).replace(".jpg",""),/^wit\d+_[a-zA-Z]{3}\d+_\d+_\d+,\d+,\d+,\d+$/.test(e)))try{const e=await fetch(`${p}add-region-pair`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":Be},body:JSON.stringify({q_img:i.replace(".jpg",""),s_img:l,similarity_type:2})});e.ok||(console.error("Error: Network response was not ok"),await ot("en"===Fe?"Problem with network, match was not added":"Problème de réseau, la correspondance n'a pas été ajoutée",h));const t=await e.json();if(t.hasOwnProperty("error")||!t.hasOwnProperty("s_regions"))return void await ot("en"===Fe?`Request was unsuccessful, match was not added:<br>${t.error}`:`La requête n'a pas abouti, la correspondance n'a pas été ajoutée :<br>${t.error}`,h);const n=t.s_regions;Wt.addComparedRegions(n),Wt.select(n)}catch(e){console.error("Error:",e),await ot("en"===Fe?`An error has occurred, match was not added:<br>${e}`:`Une erreur s'est produite, la correspondance n'a pas été ajoutée :<br>${e}`,h)}else await ot("en"===Fe?"Please insert a valid region reference to add a new match":"Veuillez insérer une référence de région valide pour ajouter une nouvelle correspondance","Error")},async function(){const e=Object.values(s[f])[0];if(await ot("en"===Fe?`Do you confirm this region does not have any match in ${e.title}?`:`Confirmez-vous que cette région n'a pas de correspondance dans ${e.title} ?`,"en"===Fe?"Confirm no match":"Confirmer l'absence de correspondance",!0))try{(await fetch(`${p}no-match`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":Be},body:JSON.stringify({q_img:i,s_regions:e.id})})).ok||(console.error("Error: Network response was not ok"),await ot("en"===Fe?"Problem with network":"Problème de réseau",h)),Wt.select(e)}catch(e){console.error("Error:",e),await ot("en"===Fe?`An error has occurred, request was unsuccessful:<br>${e}`:`Une erreur s'est produite, la requête n'a pas abouti :<br>${e}`,h)}},s,function(){l=this.value,n(1,l)}]}class Vn extends je{constructor(e){super(),Ne(this,e,Fn,Dn,a,{qImg:0})}}function zn(e,t,n){const r=e.slice();return r[8]=t[n],r}function Bn(e){let t,n,s,o=e[11]+"";return{c(){t=L("tr"),n=j("Error when retrieving similar regions: "),s=j(o)},m(e,r){T(e,t,r),S(t,n),S(t,s)},p(e,t){2&t&&o!==(o=e[11]+"")&&D(s,o)},i:r,o:r,d(e){e&&P(t)}}}function Hn(e){let t,n,r=[],s=new Map,o=e[2];const i=e=>e[8].id;for(let t=0;t<o.length;t+=1){let n=zn(e,o,t),l=i(n);s.set(l,r[t]=Xn(l,n))}let l=null;return o.length||(l=Jn()),{c(){for(let e=0;e<r.length;e+=1)r[e].c();t=A(),l&&l.c()},m(e,s){for(let t=0;t<r.length;t+=1)r[t]&&r[t].m(e,s);T(e,t,s),l&&l.m(e,s),n=!0},p(e,n){4&n&&(o=e[2],ve(),r=Re(r,n,i,1,e,o,s,t.parentNode,Ee,Xn,t,zn),be(),!o.length&&l?l.p(e,n):o.length?l&&(l.d(1),l=null):(l=Jn(),l.c(),l.m(t.parentNode,t)))},i(e){if(!n){for(let e=0;e<o.length;e+=1)ye(r[e]);n=!0}},o(e){for(let e=0;e<r.length;e+=1)xe(r[e]);n=!1},d(e){for(let t=0;t<r.length;t+=1)r[t].d(e);e&&P(t),l&&l.d(e)}}}function Jn(e){let t,n;return{c(){t=L("tr"),t.textContent=""+("en"===Fe?"No similarity":"Pas de similarités"),n=_(),U(t,"class","faded is-center")},m(e,r){T(e,t,r),T(e,n,r)},p:r,d(e){e&&P(t),e&&P(n)}}}function Xn(e,t){let n,r,s;return r=new Vn({props:{qImg:t[8]}}),{key:e,first:null,c(){n=A(),Te(r.$$.fragment),this.first=n},m(e,t){T(e,n,t),Pe(r,e,t),s=!0},p(e,n){t=e;const s={};4&n&&(s.qImg=t[8]),r.$set(s)},i(e){s||(ye(r.$$.fragment,e),s=!0)},o(e){xe(r.$$.fragment,e),s=!1},d(e){e&&P(n),Oe(r,e)}}}function Zn(e){let t;return{c(){t=L("tr"),t.textContent=""+("en"===Fe?"Retrieving similarity page...":"Récupération la page de similarité..."),U(t,"class","faded is-center")},m(e,n){T(e,t,n)},p:r,i:r,o:r,d(e){e&&P(t)}}}function Wn(e){let t,n,r,s={ctx:e,current:null,token:null,hasCatch:!0,pending:Zn,then:Hn,catch:Bn,value:7,error:11,blocks:[,,,]};return Ce(n=e[1],s),{c(){t=A(),s.block.c()},m(e,n){T(e,t,n),s.block.m(e,s.anchor=n),s.mount=()=>t.parentNode,s.anchor=t,r=!0},p(t,r){e=t,s.ctx=e,2&r&&n!==(n=e[1])&&Ce(n,s)||Se(s,e,r)},i(e){r||(ye(s.block),r=!0)},o(e){for(let e=0;e<3;e+=1){xe(s.blocks[e])}r=!1},d(e){e&&P(t),s.block.d(e),s.token=null,s=null}}}function Gn(e){let t,n,r,s,o,i,l;return n=new an({props:{store:Wt,nbOfItems:e[0].length,pageLength:e[6]}}),s=new Kt({props:{$$slots:{default:[Wn]},$$scope:{ctx:e}}}),i=new an({props:{store:Wt,nbOfItems:e[0].length,pageLength:e[6]}}),{c(){t=L("div"),Te(n.$$.fragment),r=_(),Te(s.$$.fragment),o=_(),Te(i.$$.fragment)},m(e,c){T(e,t,c),Pe(n,t,null),S(t,r),Pe(s,t,null),S(t,o),Pe(i,t,null),l=!0},p(e,[t]){const r={};1&t&&(r.nbOfItems=e[0].length),n.$set(r);const o={};4102&t&&(o.$$scope={dirty:t,ctx:e}),s.$set(o);const l={};1&t&&(l.nbOfItems=e[0].length),i.$set(l)},i(e){l||(ye(n.$$.fragment,e),ye(s.$$.fragment,e),ye(i.$$.fragment,e),l=!0)},o(e){xe(n.$$.fragment,e),xe(s.$$.fragment,e),xe(i.$$.fragment,e),l=!1},d(e){e&&P(t),Oe(n),Oe(s),Oe(i)}}}function Qn(e,t,n){let r,s,o;const{qImgs:i,pageQImgs:l,setPageQImgs:c,pageLength:a}=Wt;return m(e,i,(e=>n(0,r=e))),m(e,l,(e=>n(2,o=e))),m(e,c,(e=>n(1,s=e))),[r,s,o,i,l,c,a]}class Kn extends je{constructor(e){super(),Ne(this,e,Qn,Gn,a,{})}}function Yn(e){let t,n,s;return{c(){t=L("span"),n=j(e[0]),U(t,"id",e[3]),U(t,"class",s="tooltip "+e[2]+" "+(e[1]?"display":"")+" svelte-1am23me")},m(e,r){T(e,t,r),S(t,n)},p(e,[r]){1&r&&D(n,e[0]),6&r&&s!==(s="tooltip "+e[2]+" "+(e[1]?"display":"")+" svelte-1am23me")&&U(t,"class",s)},i:r,o:r,d(e){e&&P(t)}}}function er(e,t,n){let r,s,o,i,{tooltipText:l}=t,{targetHtmlId:c}=t;const a=`tooltip-generic-${window.crypto.randomUUID()}`,d=()=>n(1,i=!0),u=()=>n(1,i=!1),g=()=>n(1,i=!i);return Y((()=>{o=c?document.getElementById(c):document.getElementById(a).parentElement,c&&!o&&(console.error(`TooltipGeneric: element with ID ${c} not found, defaulting to the parent element`),o=document.getElementById(a).targetElement),o.addEventListener("mouseover",d),o.addEventListener("mouseout",u),o.addEventListener("click",g)})),ee((()=>{o.removeEventListener("mouseover",d),o.removeEventListener("mouseout",u),o.removeEventListener("click",g)})),e.$$set=e=>{"tooltipText"in e&&n(0,l=e.tooltipText),"targetHtmlId"in e&&n(4,c=e.targetHtmlId)},e.$$.update=()=>{33&e.$$.dirty&&n(2,r=s(l))},n(5,s=e=>n(2,r=e.length>100?"tooltip-wide":e.length>20?"tooltip-mid":"tooltip-thin")),o=void 0,n(1,i=!1),[l,i,r,a,c,s]}class tr extends je{constructor(e){super(),Ne(this,e,er,Yn,a,{tooltipText:0,targetHtmlId:4})}}function nr(e){let t,n,s,o,i,l,c,a,d,u,g,p,m,f,h,$;return{c(){t=L("div"),n=L("span"),s=j(e[2]),o=j(" ("),i=j(e[3]),l=j(")"),c=_(),a=L("div"),d=L("span"),u=j(e[0]),g=_(),p=L("div"),m=L("div"),f=_(),h=L("span"),$=j(e[1]),U(d,"class","range-marker svelte-s3mlts"),U(m,"class","slider"),U(m,"id",e[4]),U(p,"class","slider-wrapper svelte-s3mlts"),U(h,"class","range-marker svelte-s3mlts"),U(a,"class","slider-outer-wrapper is-flex flex-direction-row svelte-s3mlts")},m(e,r){T(e,t,r),S(t,n),S(n,s),S(n,o),S(n,i),S(n,l),S(t,c),S(t,a),S(a,d),S(d,u),S(a,g),S(a,p),S(p,m),S(a,f),S(a,h),S(h,$)},p(e,[t]){4&t&&D(s,e[2]),8&t&&D(i,e[3]),1&t&&D(u,e[0]),2&t&&D($,e[1])},i:r,o:r,d(e){e&&P(t)}}}function rr(t,n,r){let s,{minVal:o}=n,{maxVal:i}=n,{start:l}=n,{step:c}=n,{roundTo:a=2}=n,{title:d=""}=n;const u=te(),g=`slider-${window.crypto.randomUUID()}`,p=Array.isArray(l)&&2===l.length&&l.every((e=>!isNaN(parseFloat(e)))),m=[],f=p?[`noUi-handle-${window.crypto.randomUUID()}`,`noUi-handle-${window.crypto.randomUUID()}`]:[`noUi-handle-${window.crypto.randomUUID()}`],h=lt();h.setCompareFn(p?ct:(e,t)=>$(e)===$(t)),h.set(l);const $=e=>Number(e.toFixed(a)),w=(e,t)=>{e=Array.isArray(e)?e.map($):$(e),r(3,s=e),"set"===t&&(h.set(e),h.same()||u("updateSlider",h.get()))};return Y((()=>{!function(){const t=document.getElementById(g);let n;e.create(t,{start:l,step:c,connect:!!p||"lower",range:{min:o,max:i},handleAttributes:f.map((e=>({id:e})))}),t.noUiSlider.on("update",(()=>{n=t.noUiSlider.get(!0),w(n,"update")})),t.noUiSlider.on("set",(()=>{n=t.noUiSlider.get(!0),w(n,"set")}))}(),f.map(((e,t)=>{m.push(new tr({target:document.getElementById(e),props:p?{tooltipText:s[t]}:{tooltipText:s}}))}))})),ee((()=>{document.getElementById(g)&&(document.getElementById(g).innerHTML="")})),t.$$set=e=>{"minVal"in e&&r(0,o=e.minVal),"maxVal"in e&&r(1,i=e.maxVal),"start"in e&&r(5,l=e.start),"step"in e&&r(6,c=e.step),"roundTo"in e&&r(7,a=e.roundTo),"title"in e&&r(2,d=e.title)},t.$$.update=()=>{var e;32&t.$$.dirty&&r(3,s=l),8&t.$$.dirty&&(e=s,m.length&&m.map(((t,n)=>t.$set({tooltipText:p?e[n]:e}))))},[o,i,d,s,g,l,c,a]}class sr extends je{constructor(e){super(),Ne(this,e,rr,nr,a,{minVal:0,maxVal:1,start:5,step:6,roundTo:7,title:2})}}function or(e){let t,n,s;return{c(){t=L("input"),U(t,"type","checkbox"),U(t,"class","is-clickable svelte-1dcwq47"),U(t,"id",e[4]),U(t,"name",e[4])},m(r,o){T(r,t,o),n||(s=M(t,"click",e[5]),n=!0)},p:r,d(e){e&&P(t),n=!1,s()}}}function ir(e){let t,n,s;return{c(){t=L("input"),U(t,"type","checkbox"),U(t,"class","is-clickable svelte-1dcwq47"),U(t,"id",e[4]),U(t,"name",e[4]),t.checked=!0},m(r,o){T(r,t,o),n||(s=M(t,"click",e[5]),n=!0)},p:r,d(e){e&&P(t),n=!1,s()}}}function lr(e){let t,n,s,o,i,l,c,a;function d(e,t){return!0===e[1]?ir:or}let u=d(e),g=u(e);return{c(){t=L("div"),n=L("span"),s=L("span"),o=L("span"),g.c(),i=_(),l=L("label"),c=j(e[0]),U(o,"class","switch-control svelte-1dcwq47"),U(s,"class","switch svelte-1dcwq47"),U(n,"class","switch-wrapper"),U(l,"for",e[4]),U(l,"class","is-clickable svelte-1dcwq47"),U(t,"class",a="input-checkbox-wrapper "+(e[2]?"button is-clickable":"is-flex is-align-items-center is-justify-content-center")+" "+(e[3]?"is-checked":"")+" svelte-1dcwq47")},m(e,r){T(e,t,r),S(t,n),S(n,s),S(s,o),g.m(o,null),S(t,i),S(t,l),S(l,c)},p(e,[n]){u===(u=d(e))&&g?g.p(e,n):(g.d(1),g=u(e),g&&(g.c(),g.m(o,null))),1&n&&D(c,e[0]),12&n&&a!==(a="input-checkbox-wrapper "+(e[2]?"button is-clickable":"is-flex is-align-items-center is-justify-content-center")+" "+(e[3]?"is-checked":"")+" svelte-1dcwq47")&&U(t,"class",a)},i:r,o:r,d(e){e&&P(t),g.d()}}}function cr(e,t,n){let r,{checkboxLabel:s}=t,{start:o=!1}=t,{buttonDisplay:i=!1}=t;const l=`input-input-checkbox-wrapper-${window.crypto.randomUUID()}`,c=te();return e.$$set=e=>{"checkboxLabel"in e&&n(0,s=e.checkboxLabel),"start"in e&&n(1,o=e.start),"buttonDisplay"in e&&n(2,i=e.buttonDisplay)},e.$$.update=()=>{2&e.$$.dirty&&n(3,r=o)},[s,o,i,r,l,()=>{n(3,r=!r),c("updateChecked",r)}]}class ar extends je{constructor(e){super(),Ne(this,e,cr,lr,a,{checkboxLabel:0,start:1,buttonDisplay:2})}}function dr(e){let t,n;return{c(){t=L("label"),n=j(e[2]),U(t,"for",e[4])},m(e,r){T(e,t,r),S(t,n)},p(e,t){4&t&&D(n,e[2])},d(e){e&&P(t)}}}function ur(e){let t;return{c(){t=L("select"),U(t,"id",e[4]),U(t,"name",e[4]),U(t,"aria-label",e[2]),U(t,"class","m-1")},m(e,n){T(e,t,n)},p(e,n){4&n&&U(t,"aria-label",e[2])},i:r,o:r,d(e){e&&P(t)}}}function gr(e){let t,n,r,s=e[3].length&&pr(e);return{c(){s&&s.c(),t=_(),n=L("select"),U(n,"id",e[4]),U(n,"name",e[4]),U(n,"aria-label",e[2]),U(n,"class","m-1"),n.multiple=!0},m(e,o){s&&s.m(e,o),T(e,t,o),T(e,n,o),r=!0},p(e,o){e[3].length?s?(s.p(e,o),8&o&&ye(s,1)):(s=pr(e),s.c(),ye(s,1),s.m(t.parentNode,t)):s&&(ve(),xe(s,1,1,(()=>{s=null})),be()),(!r||4&o)&&U(n,"aria-label",e[2])},i(e){r||(ye(s),r=!0)},o(e){xe(s),r=!1},d(e){s&&s.d(e),e&&P(t),e&&P(n)}}}function pr(e){let t,n,r,s,o,i,l=e[3].length+"";return o=new tr({props:{targetHtmlId:e[5],tooltipText:`${e[3].length}\n                                    ${"fr"===Fe&&e[3].length>1?"valeurs sélectionnées":"fr"===Fe&&1===e[3].length?"valeur sélectionnée":"en"===Fe&&e[3].length>1?"selected values":"selected value"}`}}),{c(){t=L("span"),n=L("span"),r=j(l),s=_(),Te(o.$$.fragment),U(n,"id",e[5]),U(n,"class","input-dropdown-count tag m-1 svelte-xzv6o5"),U(t,"class","is-relative")},m(e,l){T(e,t,l),S(t,n),S(n,r),S(t,s),Pe(o,t,null),i=!0},p(e,t){(!i||8&t)&&l!==(l=e[3].length+"")&&D(r,l);const n={};8&t&&(n.tooltipText=`${e[3].length}\n                                    ${"fr"===Fe&&e[3].length>1?"valeurs sélectionnées":"fr"===Fe&&1===e[3].length?"valeur sélectionnée":"en"===Fe&&e[3].length>1?"selected values":"selected value"}`),o.$set(n)},i(e){i||(ye(o.$$.fragment,e),i=!0)},o(e){xe(o.$$.fragment,e),i=!1},d(e){e&&P(t),Oe(o)}}}function mr(e){let t,n,r,s,o,i,l,c=void 0!==e[2]&&dr(e);const a=[gr,ur],d=[];function u(e,t){return e[0]?0:1}return s=u(e),o=d[s]=a[s](e),{c(){t=L("div"),c&&c.c(),n=_(),r=L("div"),o.c(),U(r,"class",i="input-dropdown-select "+(e[0]?"is-multiple":"is-single")+" "+(e[0]&&e[3].length?"is-flex is-justify-content-flex-start is-align-items-center":"")+" "+(e[1]?"light-display":"")+" svelte-xzv6o5"),U(t,"class","input-dropdown-select-wrapper")},m(e,o){T(e,t,o),c&&c.m(t,null),S(t,n),S(t,r),d[s].m(r,null),l=!0},p(e,[g]){void 0!==e[2]?c?c.p(e,g):(c=dr(e),c.c(),c.m(t,n)):c&&(c.d(1),c=null);let p=s;s=u(e),s===p?d[s].p(e,g):(ve(),xe(d[p],1,1,(()=>{d[p]=null})),be(),o=d[s],o?o.p(e,g):(o=d[s]=a[s](e),o.c()),ye(o,1),o.m(r,null)),(!l||11&g&&i!==(i="input-dropdown-select "+(e[0]?"is-multiple":"is-single")+" "+(e[0]&&e[3].length?"is-flex is-justify-content-flex-start is-align-items-center":"")+" "+(e[1]?"light-display":"")+" svelte-xzv6o5"))&&U(r,"class",i)},i(e){l||(ye(o),l=!0)},o(e){xe(o),l=!1},d(e){e&&P(t),c&&c.d(),d[s].d()}}}function fr(e,t,r){let s,o,{choicesItems:i}=t,{start:l=[]}=t,{multiple:c}=t,{searchable:a=!0}=t,{lightDisplay:d=!1}=t,{placeholder:u=("fr"===Fe?"Sélectionner une valeur":"Select a value")}=t,{title:g}=t,{selectAll:p=!!c}=t;const m=`input-dropdown-select-${window.crypto.randomUUID()}`,f=`input-dropdown-counter-${window.crypto.randomUUID()}`,h=`select-all-${window.crypto.randomUUID()}`,$=`unselect-all-${window.crypto.randomUUID()}`,w=te();let v;const b=lt();b.setCompareFn(ct);const y=(e,t)=>((e,t)=>t?[{value:h,label:`<b>${"fr"===Fe?"Tout sélectionner":"Select all"}</b>`},{value:$,label:`<b>${"fr"===Fe?"Tout retirer":"Remove all"}</b>`},...e]:e)(e,t).map((e=>{var t,n,r;return e.id=`dropdown-choice-${window.crypto.randomUUID()}`,e.label=`<span>\n            ${t=e.prefix||"",n=e.prefixType||"",null!=t&&null!=n&&t.length&&n.length?`<span class="dropdown-prefix-wrapper">${"iconify"===n?(r=t,`<span class="iconify" data-icon=${r}/>`):t}</span>`:""}\n            <span class="dropdown-prefix-text">${e.label}</span>\n        </span>`,e}));const x=(e,t,n,s,i,l)=>(s=structuredClone(s),n=structuredClone(n),e.detail.value===i?(r(11,o=!0),setTimeout((()=>r(11,o=!1)),250),n=n.map((e=>[i,l].includes(e.value)?{...e,selected:!1}:{...e,selected:!0})),t.removeActiveItems().clearChoices(!0,!0).setValue(n).hideDropdown(),s=[...new Set(n.filter((e=>!0===e.selected)).map((e=>e.value)))]):e.detail.value===l?(t.removeActiveItems().hideDropdown(),s=[]):s=!0===c?[...s,e.detail.value]:[e.detail.value],[...new Set(s)]);function k(e,t){const o=document.getElementById(m);v=new n(o,{items:[],choices:e,addChoices:!1,addItems:!1,removeItems:!0,removeItemButton:!0,searchEnabled:a,allowHTML:!0,shouldSort:!t,sorter:(e,t)=>e.label.localeCompare(t.label),placeholderValue:u,classNames:{item:["choices__item","dropdown-item"]},loadingText:"fr"===Fe?"Chargement...":"Loading...",noResultsText:"fr"===Fe?"Pas de résultats":"No results found",noChoicesText:"fr"===Fe?"Pas de choix pour faire la sélection":"No choices to choose from",itemSelectText:"fr"===Fe?"Cliquer pour sélectionner":"Press to select",uniqueItemText:"fr"===Fe?"Seules des valeurs uniques peuvent être ajoutées":"Only unique values can be added",customAddItemText:"fr"===Fe?"Les valeurs ne répondent pas aux conditions attendues":"Only values matching specific conditions can be added",removeItemIconText:"fr"===Fe?"Retirer l'item":"Remove item",addItemText:e=>"fr"===Fe?`Cliquer sur Entrer pour ajouter <b>${e}</b>`:`Press Enter to add <b>"${e}"</b>`,removeItemLabelText:e=>"fr"===Fe?`Retirer l'item: ${e}`:`Remove item: ${e}`,maxItemText:e=>"fr"===Fe?`Seulement ${e} items peuvent être ajoutées`:`Only ${e} items can be added`}),o.addEventListener("addItem",(t=>{r(3,s=x(t,v,e,s,h,$))})),o.addEventListener("removeItem",(e=>{r(3,s=((e,t)=>structuredClone(t).filter((t=>t!==e.detail.value)))(e,s))}))}return Y((()=>{k(function(e,t,n){return e=structuredClone(e),t=structuredClone(t),e=y(e,n).map((e=>t.includes(e.value)?{...e,selected:!0}:{...e,selected:!1})),r(3,s=t),e}(i,l,p),p)})),ee((()=>{v.destroy(),v=void 0})),e.$$set=e=>{"choicesItems"in e&&r(6,i=e.choicesItems),"start"in e&&r(7,l=e.start),"multiple"in e&&r(0,c=e.multiple),"searchable"in e&&r(8,a=e.searchable),"lightDisplay"in e&&r(1,d=e.lightDisplay),"placeholder"in e&&r(9,u=e.placeholder),"title"in e&&r(2,g=e.title),"selectAll"in e&&r(10,p=e.selectAll)},e.$$.update=()=>{var t;2056&e.$$.dirty&&(t=s,o||(b.set(t),b.same()||w("updateValues",s)))},r(3,s=[]),r(11,o=!1),[c,d,g,s,m,f,i,l,a,u,p,o]}class hr extends je{constructor(e){super(),Ne(this,e,fr,mr,a,{choicesItems:6,start:7,multiple:0,searchable:8,lightDisplay:1,placeholder:9,title:2,selectAll:10})}}function $r(e){let t,n,r,s,o,i;return o=new tr({props:{tooltipText:e[2]}}),{c(){t=L("div"),n=L("button"),r=L("span"),s=_(),Te(o.$$.fragment),U(r,"class","iconify"),U(r,"data-icon",e[0]),U(r,"title",e[1]),U(n,"class","svelte-gmxkvo"),U(t,"class","is-inline-block icon-tooltip svelte-gmxkvo")},m(e,l){T(e,t,l),S(t,n),S(n,r),S(n,s),Pe(o,n,null),i=!0},p(e,[t]){(!i||1&t)&&U(r,"data-icon",e[0]),(!i||2&t)&&U(r,"title",e[1]);const n={};4&t&&(n.tooltipText=e[2]),o.$set(n)},i(e){i||(ye(o.$$.fragment,e),i=!0)},o(e){xe(o.$$.fragment,e),i=!1},d(e){e&&P(t),Oe(o)}}}function wr(e,t,n){let{iconifyIcon:r,altText:s,tooltipText:o}=t;return e.$$set=e=>{"iconifyIcon"in e&&n(0,r=e.iconifyIcon),"altText"in e&&n(1,s=e.altText),"tooltipText"in e&&n(2,o=e.tooltipText)},[r,s,o]}class vr extends je{constructor(e){super(),Ne(this,e,wr,$r,a,{iconifyIcon:0,altText:1,tooltipText:2})}}const{window:br}=C;function yr(e){let t,n;return t=new hr({props:{choicesItems:e[6],multiple:!0,placeholder:"...",start:Object.keys(e[7][e[18]]||{}),lightDisplay:!0,title:"fr"===Fe?"Régions sélectionnées":"Selected regions",selectAll:!0}}),t.$on("updateValues",e[28]),{c(){Te(t.$$.fragment)},m(e,r){Pe(t,e,r),n=!0},p(e,n){const r={};64&n[0]&&(r.choicesItems=e[6]),128&n[0]&&(r.start=Object.keys(e[7][e[18]]||{})),t.$set(r)},i(e){n||(ye(t.$$.fragment,e),n=!0)},o(e){xe(t.$$.fragment,e),n=!1},d(e){Oe(t,e)}}}function xr(e){return{c:r,m:r,p:r,i:r,o:r,d:r}}function kr(e){let t,n,r=e[35].length&&function(e){let t,n;return t=new sr({props:{title:"fr"===Fe?"Score minimal":"Minimal score",minVal:e[35][0],maxVal:e[35][1],start:e[3]||e[35][0],roundTo:3}}),t.$on("updateSlider",e[24]),{c(){Te(t.$$.fragment)},m(e,r){Pe(t,e,r),n=!0},p(e,n){const r={};8&n[0]&&(r.start=e[3]||e[35][0]),t.$set(r)},i(e){n||(ye(t.$$.fragment,e),n=!0)},o(e){xe(t.$$.fragment,e),n=!1},d(e){Oe(t,e)}}}(e);return{c(){r&&r.c(),t=A()},m(e,s){r&&r.m(e,s),T(e,t,s),n=!0},p(e,t){e[35].length&&r.p(e,t)},i(e){n||(ye(r),n=!0)},o(e){xe(r),n=!1},d(e){r&&r.d(e),e&&P(t)}}}function Ir(e){return{c:r,m:r,p:r,i:r,o:r,d:r}}function Cr(e){let t,n,r,s,o,i,l,c,a,d,u,g,p,m,f,h,$,w,v,b,y,x,k,I;return c=new hr({props:{choicesItems:e[20],multiple:!0,placeholder:"...",start:e[8],lightDisplay:!0,title:"fr"===Fe?"Catégories masquées":"Hidden categories",selectAll:!0}}),c.$on("updateValues",e[25]),f=new vr({props:{iconifyIcon:"material-symbols:help-outline",altText:"en"===Fe?"Display help":"Afficher une explication",tooltipText:e[19]}}),v=new sr({props:{title:"fr"===Fe?"Profondeur de récursion":"Recursion depth",minVal:e[17][0],maxVal:e[17][1],start:e[9],step:1}}),v.$on("updateSlider",e[26]),x=new ar({props:{checkboxLabel:"Filter by region",start:e[10],buttonDisplay:!0}}),x.$on("updateChecked",e[27]),{c(){t=L("div"),n=L("div"),r=L("div"),s=L("div"),s.innerHTML='<span class="tag is-medium is-link">Similarity</span>',o=_(),i=L("div"),l=L("div"),Te(c.$$.fragment),a=_(),d=L("div"),u=L("div"),g=L("div"),p=L("span"),p.textContent="Propagation",m=_(),Te(f.$$.fragment),h=_(),$=L("div"),w=L("div"),Te(v.$$.fragment),b=_(),y=L("div"),Te(x.$$.fragment),U(s,"class","ctrl-block-title svelte-1st7g3f"),U(l,"class","ctrl-input svelte-1st7g3f"),U(i,"class","ctrl-block-inputs svelte-1st7g3f"),U(r,"class","ctrl-block svelte-1st7g3f"),U(n,"class","ctrl-block-wrapper svelte-1st7g3f"),U(p,"class","tag is-medium is-link mr-1"),U(g,"class","ctrl-block-title svelte-1st7g3f"),U(w,"class","ctrl-input svelte-1st7g3f"),U(y,"class","ctrl-input svelte-1st7g3f"),U($,"class","ctrl-block-inputs svelte-1st7g3f"),U(u,"class","ctrl-block svelte-1st7g3f"),U(d,"class","ctrl-block-wrapper svelte-1st7g3f"),U(t,"class","ctrl-extra svelte-1st7g3f")},m(e,k){T(e,t,k),S(t,n),S(n,r),S(r,s),S(r,o),S(r,i),S(i,l),Pe(c,l,null),S(t,a),S(t,d),S(d,u),S(u,g),S(g,p),S(g,m),Pe(f,g,null),S(u,h),S(u,$),S($,w),Pe(v,w,null),S($,b),S($,y),Pe(x,y,null),I=!0},p(e,t){const n={};256&t[0]&&(n.start=e[8]),c.$set(n);const r={};512&t[0]&&(r.start=e[9]),v.$set(r);const s={};1024&t[0]&&(s.start=e[10]),x.$set(s)},i(e){I||(ye(c.$$.fragment,e),ye(f.$$.fragment,e),ye(v.$$.fragment,e),ye(x.$$.fragment,e),de((()=>{I&&(k||(k=Ie(t,Me,{axis:"y"},!0)),k.run(1))})),I=!0)},o(e){xe(c.$$.fragment,e),xe(f.$$.fragment,e),xe(v.$$.fragment,e),xe(x.$$.fragment,e),k||(k=Ie(t,Me,{axis:"y"},!1)),k.run(0),I=!1},d(e){e&&P(t),Oe(c),Oe(f),Oe(v),Oe(x),e&&k&&k.end()}}}function Sr(e){let t,n,r,s,o,i,c,a,d,u,g,p,m,f,h,$,w,v,b,y,x,k,I,C=Object.keys(e[6]).length;de(e[30]);let E=C&&yr(e),R={ctx:e,current:null,token:null,hasCatch:!1,pending:Ir,then:kr,catch:xr,value:35,blocks:[,,,]};Ce(e[22],R);let O=e[2]&&Cr(e);return v=new tr({props:{tooltipText:e[4]}}),{c(){t=L("div"),n=L("form"),r=L("div"),s=L("div"),o=L("div"),i=L("div"),c=L("div"),E&&E.c(),a=_(),d=L("div"),R.block.c(),u=_(),O&&O.c(),g=_(),p=L("div"),m=L("button"),f=N("svg"),h=N("path"),w=_(),Te(v.$$.fragment),U(c,"class","ctrl-input svelte-1st7g3f"),U(d,"class","ctrl-input svelte-1st7g3f"),U(i,"class","ctrl-block-inputs svelte-1st7g3f"),U(o,"class","ctrl-block svelte-1st7g3f"),U(s,"class","ctrl-block-wrapper svelte-1st7g3f"),U(r,"class","ctrl-base svelte-1st7g3f"),U(h,"fill","none"),U(h,"stroke","currentColor"),U(h,"stroke-linecap","round"),U(h,"stroke-linejoin","round"),U(h,"stroke-width","1.5"),U(h,"d","M12 3v18m0 0l8.5-8.5M12 21l-8.5-8.5"),U(f,"style",$=`transform: rotate(${e[2]?"180":"0"}deg)`),U(f,"xmlns","http://www.w3.org/2000/svg"),U(f,"width","24"),U(f,"height","24"),U(f,"viewBox","0 0 24 24"),U(f,"class","svelte-1st7g3f"),U(m,"class","button is-link svelte-1st7g3f"),U(p,"class","ctrl-toggle svelte-1st7g3f"),U(n,"class","ctrl svelte-1st7g3f"),U(t,"class",b="ctrl-wrapper is-flex is-justify-content-center is-align-items-center "+(e[2]?"toolbar-expanded":"toolbar-collapsed")+" svelte-1st7g3f"),U(t,"style",y=e[5]?`top: ${e[5]}px`:"")},m(l,$){T(l,t,$),S(t,n),S(n,r),S(r,s),S(s,o),S(o,i),S(i,c),E&&E.m(c,null),S(i,a),S(i,d),R.block.m(d,R.anchor=null),R.mount=()=>d,R.anchor=null,S(n,u),O&&O.m(n,null),S(n,g),S(n,p),S(p,m),S(m,f),S(f,h),S(m,w),Pe(v,m,null),x=!0,k||(I=[M(br,"resize",e[30]),M(m,"click",q(e[23]))],k=!0)},p(r,s){e=r,64&s[0]&&(C=Object.keys(e[6]).length),C?E?(E.p(e,s),64&s[0]&&ye(E,1)):(E=yr(e),E.c(),ye(E,1),E.m(c,null)):E&&(ve(),xe(E,1,1,(()=>{E=null})),be()),Se(R,e,s),e[2]?O?(O.p(e,s),4&s[0]&&ye(O,1)):(O=Cr(e),O.c(),ye(O,1),O.m(n,g)):O&&(ve(),xe(O,1,1,(()=>{O=null})),be()),(!x||4&s[0]&&$!==($=`transform: rotate(${e[2]?"180":"0"}deg)`))&&U(f,"style",$);const o={};16&s[0]&&(o.tooltipText=e[4]),v.$set(o),(!x||4&s[0]&&b!==(b="ctrl-wrapper is-flex is-justify-content-center is-align-items-center "+(e[2]?"toolbar-expanded":"toolbar-collapsed")+" svelte-1st7g3f"))&&U(t,"class",b),(!x||32&s[0]&&y!==(y=e[5]?`top: ${e[5]}px`:""))&&U(t,"style",y)},i(e){x||(ye(E),ye(R.block),ye(O),ye(v.$$.fragment,e),x=!0)},o(e){xe(E);for(let e=0;e<3;e+=1){xe(R.blocks[e])}xe(O),xe(v.$$.fragment,e),x=!1},d(e){e&&P(t),E&&E.d(),R.block.d(),R.token=null,R=null,O&&O.d(),Oe(v),k=!1,l(I)}}}function Er(e,t,n){let r,s,o,i,l,c,a,d,u,g,p;const{selectedRegions:f,comparedRegions:h,excludedCategories:$,similarityScoreCutoff:w,propagateRecursionDepth:v,propagateFilterByRegions:b,allowedPropagateDepthRange:y}=Wt;m(e,f,(e=>n(7,d=e))),m(e,h,(e=>n(31,l=e))),m(e,$,(e=>n(8,u=e))),m(e,w,(e=>n(29,c=e))),m(e,v,(e=>n(9,g=e))),m(e,b,(e=>n(10,p=e)));const x=window.location.pathname.match(/\d+/g).join("-"),k=`${window.location.origin}${window.location.pathname}`,I="en"===Fe?"Propagated matches are exact matches to images that have an exact match with the current image. There may be up to 6 exact matches connecting the current image and propagated images.":"Les correspondances propagées correspondent à des correspondances exactes à des images ayant une correspondance exacte avec l'image actuelle. Il peut y avoir jusqu'à 6 images reliant l'image actuelle à une correspondance propagée.",C=[{value:1,label:fn,prefix:dn,prefixType:"svg"},{value:2,label:hn,prefix:un,prefixType:"svg"},{value:3,label:$n,prefix:gn,prefixType:"svg"},{value:4,label:wn,prefix:pn,prefixType:"svg"},{value:5,label:vn,prefix:mn,prefixType:"svg"}],S=De(h,(e=>Object.entries(e).map((([e,t])=>({prefix:`#${t.id}`,prefixType:"text",value:e,label:et(t.title.replace(/^[^|]+/,""))})))));m(e,S,(e=>n(6,a=e)));const E=async function(){let e=[];return await fetch(`${k}similarity-score-range`).then((e=>e.json())).then((t=>(e=[t.min,t.max],e.every((e=>"number"==typeof e))?n(3,r=c&&e[0]<=c&&e[1]>=c?c:e[0]):(console.error(`fetchSimilarityScoreRange: expected '[number, number]', got '${e}'. Defaulting to '[]'`),e=[]),e))).catch((t=>(console.error("Error on fetchSimilarityScoreRange:",t),errorMsg.set(t.message),e)))}();let R,T;return e.$$.update=()=>{536870912&e.$$.dirty[0]&&n(3,r=c||void 0),3&e.$$.dirty[0]&&n(5,s=document.querySelector("#nav-actions")?.offsetHeight),4&e.$$.dirty[0]&&n(4,i="fr"===Fe&&o?"Refermer le menu de recherche":"fr"!==Fe||o?"en"===Fe&&o?"Collapse the toolbar":"Expand the toolbar":"Ouvrir le menu de recherche")},n(2,o=!1),[R,T,o,r,i,s,a,d,u,g,p,f,h,$,w,v,b,y,x,I,C,S,E,()=>n(2,o=!o),e=>w.set(e.detail),e=>$.set(e.detail),e=>v.set(e.detail),e=>b.set(e.detail),e=>{const t=e.detail,n={[x]:{}};Object.keys(l).forEach((e=>{t.includes(e)&&(n[x][e]=l[e])})),f.set(n)},c,function(){n(0,R=br.innerWidth),n(1,T=br.innerHeight)}]}class Rr extends je{constructor(e){super(),Ne(this,e,Er,Sr,a,{},null,[-1,-1])}}function Tr(e){let t,n;return t=new Rr({}),{c(){Te(t.$$.fragment)},m(e,r){Pe(t,e,r),n=!0},i(e){n||(ye(t.$$.fragment,e),n=!0)},o(e){xe(t.$$.fragment,e),n=!1},d(e){Oe(t,e)}}}function Pr(e){let t,n;return t=new Kn({}),{c(){Te(t.$$.fragment)},m(e,r){Pe(t,e,r),n=!0},p:r,i(e){n||(ye(t.$$.fragment,e),n=!0)},o(e){xe(t.$$.fragment,e),n=!1},d(e){Oe(t,e)}}}function Or(e){let t,n;return t=new Kt({props:{$$slots:{default:[_r]},$$scope:{ctx:e}}}),{c(){Te(t.$$.fragment)},m(e,r){Pe(t,e,r),n=!0},p(e,n){const r={};36&n&&(r.$$scope={dirty:n,ctx:e}),t.$set(r)},i(e){n||(ye(t.$$.fragment,e),n=!0)},o(e){xe(t.$$.fragment,e),n=!1},d(e){Oe(t,e)}}}function Lr(e){let t,n;return t=new Kt({props:{$$slots:{default:[Ar]},$$scope:{ctx:e}}}),{c(){Te(t.$$.fragment)},m(e,r){Pe(t,e,r),n=!0},p(e,n){const r={};32&n&&(r.$$scope={dirty:n,ctx:e}),t.$set(r)},i(e){n||(ye(t.$$.fragment,e),n=!0)},o(e){xe(t.$$.fragment,e),n=!1},d(e){Oe(t,e)}}}function Nr(e){let t,n;return{c(){t=j("Erreur lors de la récupération des similarités : "),n=j(e[2])},m(e,r){T(e,t,r),T(e,n,r)},p(e,t){4&t&&D(n,e[2])},d(e){e&&P(t),e&&P(n)}}}function jr(e){let t,n;return{c(){t=j("Error when retrieving similarities: "),n=j(e[2])},m(e,r){T(e,t,r),T(e,n,r)},p(e,t){4&t&&D(n,e[2])},d(e){e&&P(t),e&&P(n)}}}function _r(e){let t;let n=("en"===Fe?jr:Nr)(e);return{c(){t=L("tr"),n.c(),U(t,"class","faded is-center")},m(e,r){T(e,t,r),n.m(t,null)},p(e,t){n.p(e,t)},d(e){e&&P(t),n.d()}}}function Ar(e){let t;return{c(){t=L("tr"),t.textContent=""+("en"===Fe?"Retrieving similarities...":"Récupération des similarités..."),U(t,"class","faded is-center")},m(e,n){T(e,t,n)},p:r,d(e){e&&P(t)}}}function Mr(e){let t,n,r=He.includes("similarity"),s=r&&function(e){let t,n,r,s,o,i=Object.keys(e[0]).length,l=i&&Tr();const c=[Lr,Or,Pr],a=[];function d(e,t){return e[1]?0:e[2]?1:2}return n=d(e),r=a[n]=c[n](e),{c(){l&&l.c(),t=_(),r.c(),s=A()},m(e,r){l&&l.m(e,r),T(e,t,r),a[n].m(e,r),T(e,s,r),o=!0},p(e,o){1&o&&(i=Object.keys(e[0]).length),i?l?1&o&&ye(l,1):(l=Tr(),l.c(),ye(l,1),l.m(t.parentNode,t)):l&&(ve(),xe(l,1,1,(()=>{l=null})),be());let u=n;n=d(e),n===u?a[n].p(e,o):(ve(),xe(a[u],1,1,(()=>{a[u]=null})),be(),r=a[n],r?r.p(e,o):(r=a[n]=c[n](e),r.c()),ye(r,1),r.m(s.parentNode,s))},i(e){o||(ye(l),ye(r),o=!0)},o(e){xe(l),xe(r),o=!1},d(e){l&&l.d(e),e&&P(t),a[n].d(e),e&&P(s)}}}(e);return{c(){s&&s.c(),t=A()},m(e,r){s&&s.m(e,r),T(e,t,r),n=!0},p(e,[t]){r&&s.p(e,t)},i(e){n||(ye(s),n=!0)},o(e){xe(s),n=!1},d(e){s&&s.d(e),e&&P(t)}}}function qr(e,t,n){let r,s,o;m(e,Qe,(e=>n(1,s=e))),m(e,Ke,(e=>n(2,o=e)));const{fetchSimilarity:i,comparedRegions:l}=Wt;return m(e,l,(e=>n(0,r=e))),Y((()=>{He.includes("similarity")&&i()})),[r,s,o,l]}class Ur extends je{constructor(e){super(),Ne(this,e,qr,Mr,a,{})}}function Dr(e){let t,n,r,s,o,i,l,c,a,d,g,p,m,h,b,y,x,k;const I=e[4].default,C=f(I,e,e[3],null);return{c(){t=L("tr"),n=L("th"),r=L("div"),s=L("img"),l=_(),c=L("div"),a=L("a"),d=L("i"),g=j("\n                    Page "),p=j(e[0]),h=_(),b=L("td"),y=L("div"),x=L("div"),C&&C.c(),u(s.src,o=rt(e[1],"full","250,"))||U(s,"src",o),U(s,"alt",i="Canvas "+e[0]),U(s,"class","mb-3 card"),U(d,"class","fa-solid fa-pen-to-square"),U(a,"class","tag px-2 py-1 is-rounded is-hoverable"),U(a,"href",m=st(e[2],e[0])),U(a,"target","_blank"),U(c,"class","is-center mb-1"),U(r,"class","content-wrapper py-5"),U(n,"class","is-3 center-flex is-narrow"),V(n,"width","260px"),U(x,"class","grid is-gap-2"),U(y,"class","fixed-grid has-6-cols"),U(b,"class","p-5 is-fullwidth")},m(e,o){T(e,t,o),S(t,n),S(n,r),S(r,s),S(r,l),S(r,c),S(c,a),S(a,d),S(a,g),S(a,p),S(t,h),S(t,b),S(b,y),S(y,x),C&&C.m(x,null),k=!0},p(e,[t]){(!k||2&t&&!u(s.src,o=rt(e[1],"full","250,")))&&U(s,"src",o),(!k||1&t&&i!==(i="Canvas "+e[0]))&&U(s,"alt",i),(!k||1&t)&&D(p,e[0]),(!k||1&t&&m!==(m=st(e[2],e[0])))&&U(a,"href",m),C&&C.p&&(!k||8&t)&&w(C,I,e,e[3],k?$(I,e[3],t,null):v(e[3]),null)},i(e){k||(ye(C,e),k=!0)},o(e){xe(C,e),k=!1},d(e){e&&P(t),C&&C.d(e)}}}function Fr(e,t,n){let{$$slots:r={},$$scope:s}=t,{canvasNb:o}=t,{canvasImg:i}=t;const l=re("manifest");return e.$$set=e=>{"canvasNb"in e&&n(0,o=e.canvasNb),"canvasImg"in e&&n(1,i=e.canvasImg),"$$scope"in e&&n(3,s=e.$$scope)},[o,i,l,s,r]}class Vr extends je{constructor(e){super(),Ne(this,e,Fr,Dr,a,{canvasNb:0,canvasImg:1})}}function zr(e,t,n){const r=e.slice();return r[9]=t[n][0],r[10]=t[n][1],r}function Br(e,t,n){const r=e.slice();return r[13]=t[n],r}function Hr(e){let t,n,s="en"===Fe?`Error when retrieving paginated regions: ${e[16]}`:`Erreur de récupération des pages : ${e[16]}`;return{c(){t=L("tr"),n=j(s),U(t,"class","faded is-center")},m(e,r){T(e,t,r),S(t,n)},p(e,t){1&t&&s!==(s="en"===Fe?`Error when retrieving paginated regions: ${e[16]}`:`Erreur de récupération des pages : ${e[16]}`)&&D(n,s)},i:r,o:r,d(e){e&&P(t)}}}function Jr(e){let t,n,r,s,o;const i=[Zr,Xr],l=[];function c(e,n){return 2&n&&(t=null),null==t&&(t=!!(Object.values(e[1]).length>0)),t?0:1}return n=c(e,-1),r=l[n]=i[n](e),{c(){r.c(),s=A()},m(e,t){l[n].m(e,t),T(e,s,t),o=!0},p(e,t){let o=n;n=c(e,t),n===o?l[n].p(e,t):(ve(),xe(l[o],1,1,(()=>{l[o]=null})),be(),r=l[n],r?r.p(e,t):(r=l[n]=i[n](e),r.c()),ye(r,1),r.m(s.parentNode,s))},i(e){o||(ye(r),o=!0)},o(e){xe(r),o=!1},d(e){l[n].d(e),e&&P(s)}}}function Xr(e){let t,n,s;return n=new Pt({}),{c(){t=L("tr"),Te(n.$$.fragment)},m(e,r){T(e,t,r),Pe(n,t,null),s=!0},p:r,i(e){s||(ye(n.$$.fragment,e),s=!0)},o(e){xe(n.$$.fragment,e),s=!1},d(e){e&&P(t),Oe(n)}}}function Zr(e){let t,n,r=Object.entries(e[1]),s=[];for(let t=0;t<r.length;t+=1)s[t]=Qr(zr(e,r,t));const o=e=>xe(s[e],1,1,(()=>{s[e]=null}));return{c(){for(let e=0;e<s.length;e+=1)s[e].c();t=A()},m(e,r){for(let t=0;t<s.length;t+=1)s[t]&&s[t].m(e,r);T(e,t,r),n=!0},p(e,n){if(34&n){let i;for(r=Object.entries(e[1]),i=0;i<r.length;i+=1){const o=zr(e,r,i);s[i]?(s[i].p(o,n),ye(s[i],1)):(s[i]=Qr(o),s[i].c(),ye(s[i],1),s[i].m(t.parentNode,t))}for(ve(),i=r.length;i<s.length;i+=1)o(i);be()}},i(e){if(!n){for(let e=0;e<r.length;e+=1)ye(s[e]);n=!0}},o(e){s=s.filter(Boolean);for(let e=0;e<s.length;e+=1)xe(s[e]);n=!1},d(e){O(s,e),e&&P(t)}}}function Wr(e,t){let n,r,s;return r=new xt({props:{item:t[13],isSquare:!1}}),{key:e,first:null,c(){n=A(),Te(r.$$.fragment),this.first=n},m(e,t){T(e,n,t),Pe(r,e,t),s=!0},p(e,n){t=e;const s={};2&n&&(s.item=t[13]),r.$set(s)},i(e){s||(ye(r.$$.fragment,e),s=!0)},o(e){xe(r.$$.fragment,e),s=!1},d(e){e&&P(n),Oe(r,e)}}}function Gr(e){let t,n,r=[],s=new Map,o=Object.values(e[10]);const i=e=>e[13].id;for(let t=0;t<o.length;t+=1){let n=Br(e,o,t),l=i(n);s.set(l,r[t]=Wr(l,n))}return{c(){for(let e=0;e<r.length;e+=1)r[e].c();t=_()},m(e,s){for(let t=0;t<r.length;t+=1)r[t]&&r[t].m(e,s);T(e,t,s),n=!0},p(e,n){2&n&&(o=Object.values(e[10]),ve(),r=Re(r,n,i,1,e,o,s,t.parentNode,Ee,Wr,t,Br),be())},i(e){if(!n){for(let e=0;e<o.length;e+=1)ye(r[e]);n=!0}},o(e){for(let e=0;e<r.length;e+=1)xe(r[e]);n=!1},d(e){for(let t=0;t<r.length;t+=1)r[t].d(e);e&&P(t)}}}function Qr(e){let t,n;return t=new Vr({props:{canvasImg:e[5](e[9]),canvasNb:e[9],$$slots:{default:[Gr]},$$scope:{ctx:e}}}),{c(){Te(t.$$.fragment)},m(e,r){Pe(t,e,r),n=!0},p(e,n){const r={};2&n&&(r.canvasImg=e[5](e[9])),2&n&&(r.canvasNb=e[9]),131074&n&&(r.$$scope={dirty:n,ctx:e}),t.$set(r)},i(e){n||(ye(t.$$.fragment,e),n=!0)},o(e){xe(t.$$.fragment,e),n=!1},d(e){Oe(t,e)}}}function Kr(e){let t;return{c(){t=L("tr"),t.textContent=""+("en"===Fe?"Retrieving paginated regions...":"Récupération des pages..."),U(t,"class","faded is-center")},m(e,n){T(e,t,n)},p:r,i:r,o:r,d(e){e&&P(t)}}}function Yr(e){let t,n,r,s={ctx:e,current:null,token:null,hasCatch:!0,pending:Kr,then:Jr,catch:Hr,value:8,error:16,blocks:[,,,]};return Ce(n=e[0],s),{c(){t=A(),s.block.c()},m(e,n){T(e,t,n),s.block.m(e,s.anchor=n),s.mount=()=>t.parentNode,s.anchor=t,r=!0},p(t,r){e=t,s.ctx=e,1&r&&n!==(n=e[0])&&Ce(n,s)||Se(s,e,r)},i(e){r||(ye(s.block),r=!0)},o(e){for(let e=0;e<3;e+=1){xe(s.blocks[e])}r=!1},d(e){e&&P(t),s.block.d(e),s.token=null,s=null}}}function es(e){let t,n,r,s,o,i;return t=new an({props:{store:dt,nbOfItems:e[4]}}),r=new Kt({props:{$$slots:{default:[Yr]},$$scope:{ctx:e}}}),o=new an({props:{store:dt,nbOfItems:e[4]}}),{c(){Te(t.$$.fragment),n=_(),Te(r.$$.fragment),s=_(),Te(o.$$.fragment)},m(e,l){Pe(t,e,l),T(e,n,l),Pe(r,e,l),T(e,s,l),Pe(o,e,l),i=!0},p(e,[t]){const n={};131075&t&&(n.$$scope={dirty:t,ctx:e}),r.$set(n)},i(e){i||(ye(t.$$.fragment,e),ye(r.$$.fragment,e),ye(o.$$.fragment,e),i=!0)},o(e){xe(t.$$.fragment,e),xe(r.$$.fragment,e),xe(o.$$.fragment,e),i=!1},d(e){Oe(t,e),e&&P(n),Oe(r,e),e&&P(s),Oe(o,e)}}}function ts(e,t,n){let r,s;const{pageRegions:o,fetchPages:i}=dt;m(e,o,(e=>n(1,s=e))),m(e,i,(e=>n(0,r=e)));const l=re("nbOfPages"),c=re("trailingZeros");return[r,s,o,i,l,function(e){return`${imgPrefix}_${t=e,n=c,t.toString().padStart(n,"0")}`;var t,n}]}class ns extends je{constructor(e){super(),Ne(this,e,ts,es,a,{})}}function rs(e){let t,n,s,o,i,l,c,a="en"===Fe?"Save selection":"Sauvegarder la sélection";return{c(){t=L("button"),n=L("span"),s=L("i"),o=_(),i=j(a),U(s,"class","fa-solid fa-floppy-disk"),U(t,"class","button is-link")},m(r,a){T(r,t,a),S(t,n),S(n,s),S(n,o),S(n,i),l||(c=M(t,"click",e[6]),l=!0)},p:r,d(e){e&&P(t),l=!1,c()}}}function ss(e){let t,n,r,s,o,i,l="en"===Fe?"Go to treatment":"Accéder au traitement";return{c(){t=L("a"),n=L("span"),r=L("i"),s=_(),o=j(l),U(r,"class","fa-solid fa-gear"),U(t,"class","button is-link"),U(t,"href",i="/"+Ve+"/treatment/add/?document_set="+e[2](e[0]).id)},m(e,i){T(e,t,i),S(t,n),S(n,r),S(n,s),S(n,o)},p(e,n){5&n&&i!==(i="/"+Ve+"/treatment/add/?document_set="+e[2](e[0]).id)&&U(t,"href",i)},d(e){e&&P(t)}}}function os(e){let t,n,s,o,i,l;function c(e,t){return e[1]?ss:rs}let a=c(e),d=a(e);return{c(){t=L("footer"),n=L("div"),s=L("button"),s.textContent=""+("en"===Fe?"Clear selection":"Vider la sélection"),o=_(),d.c(),U(s,"class","button button-close is-link is-light"),U(n,"class","buttons"),U(t,"class","modal-card-foot is-center")},m(r,c){T(r,t,c),S(t,n),S(n,s),S(n,o),d.m(n,null),i||(l=M(s,"click",e[5]),i=!0)},p(e,[t]){a===(a=c(e))&&d?d.p(e,t):(d.d(1),d=a(e),d&&(d.c(),d.m(n,null)))},i:r,o:r,d(e){e&&P(t),d.d(),i=!1,l()}}}function is(e,t,n){let r,s;const{isSaved:o,selection:i}=at;m(e,o,(e=>n(1,r=e))),m(e,i,(e=>n(2,s=e)));let{isRegion:l=!0}=t;return e.$$set=e=>{"isRegion"in e&&n(0,l=e.isRegion)},[l,r,s,o,i,()=>at.empty(l),()=>at.save(l)]}class ls extends je{constructor(e){super(),Ne(this,e,is,os,a,{isRegion:0})}}function cs(e){let t,n,r,s,o,i,c=e[5](e[0])+"";return{c(){t=L("span"),n=j(c),r=_(),s=L("span"),s.innerHTML='<i class="fas fa-edit"></i>',U(s,"class","pl-3 smaller has-text-link")},m(l,c){T(l,t,c),S(t,n),S(t,r),S(t,s),o||(i=[M(t,"click",e[7]),M(t,"keyup",null)],o=!0)},p(e,t){33&t&&c!==(c=e[5](e[0])+"")&&D(n,c)},d(e){e&&P(t),o=!1,l(i)}}}function as(e){let t,n,r;return{c(){t=L("input"),U(t,"class","input selection-title svelte-sgypdx")},m(s,o){T(s,t,o),e[12](t),F(t,e[4]),n||(r=[M(t,"input",e[13]),M(t,"keydown",e[8]),M(t,"blur",e[9])],n=!0)},p(e,n){16&n&&t.value!==e[4]&&F(t,e[4])},d(s){s&&P(t),e[12](null),n=!1,l(r)}}}function ds(e){let t,n,r,s,o,i,l,c,a,d,u,g,p,m,h,b,y,x;function k(e,t){return e[2]?as:cs}let I=k(e),C=I(e);const E=e[11].default,R=f(E,e,e[10],null);return y=new ls({props:{isRegion:e[0]}}),{c(){t=L("div"),n=L("div"),r=_(),s=L("div"),o=L("div"),i=L("div"),l=L("i"),c=_(),C.c(),a=j("\n                ("),d=j(e[1]),u=j(")"),g=_(),p=L("button"),m=_(),h=L("section"),R&&R.c(),b=_(),Te(y.$$.fragment),U(n,"class","modal-background"),U(l,"class","fa-solid fa-book-bookmark"),U(i,"class","title is-4 mb-0 media-content"),U(p,"class","delete media-left"),U(p,"aria-label","close"),U(o,"class","modal-card-head media mb-0 is-middle"),U(h,"class","modal-card-body"),U(s,"class","modal-content"),U(t,"id","selection-modal"),U(t,"class","modal fade"),U(t,"tabindex","-1"),U(t,"aria-labelledby","selection-modal-label"),U(t,"aria-hidden","true")},m(e,f){T(e,t,f),S(t,n),S(t,r),S(t,s),S(s,o),S(o,i),S(i,l),S(i,c),C.m(i,null),S(i,a),S(i,d),S(i,u),S(o,g),S(o,p),S(s,m),S(s,h),R&&R.m(h,null),S(s,b),Pe(y,s,null),x=!0},p(e,[t]){I===(I=k(e))&&C?C.p(e,t):(C.d(1),C=I(e),C&&(C.c(),C.m(i,a))),(!x||2&t)&&D(d,e[1]),R&&R.p&&(!x||1024&t)&&w(R,E,e,e[10],x?$(E,e[10],t,null):v(e[10]),null);const n={};1&t&&(n.isRegion=e[0]),y.$set(n)},i(e){x||(ye(R,e),ye(y.$$.fragment,e),x=!0)},o(e){xe(R,e),xe(y.$$.fragment,e),x=!1},d(e){e&&P(t),C.d(),R&&R.d(e),Oe(y)}}}function us(e,t,n){let r,{$$slots:s={},$$scope:o}=t;const{selectionTitle:i,updateTitle:l,save:c}=at;m(e,i,(e=>n(5,r=e)));let a,d,{isRegion:u=!1}=t,{selectionLength:g=!1}=t,p=!1;function f(){n(2,p=!1),l(d,u),c(u)}return e.$$set=e=>{"isRegion"in e&&n(0,u=e.isRegion),"selectionLength"in e&&n(1,g=e.selectionLength),"$$scope"in e&&n(10,o=e.$$scope)},[u,g,p,a,d,r,i,function(){n(2,p=!0),n(4,d=r(u)),setTimeout((()=>a&&a.focus()),0)},function(e){"Enter"===e.key&&f()},f,o,s,function(e){oe[e?"unshift":"push"]((()=>{a=e,n(3,a)}))},function(){d=this.value,n(4,d)}]}class gs extends je{constructor(e){super(),Ne(this,e,us,ds,a,{isRegion:0,selectionLength:1})}}const ps=function(){const e=`${window.location.origin}${window.location.pathname}`,t=Ue(1),n=Ue([]),r=Ue([]),s=(async()=>{const t=await fetch(`${e}vectorized-images`).then((e=>e.json())).then((e=>(n.set(e),e))).catch((e=>console.error("Error:",e)));return l(o()),t})(),o=()=>tt(t,"vp"),i=De(t,(e=>(async()=>function(e){const t=49*(e-1),s=t+49,o=p(n).slice(t,s);return r.set(o),o}(e))()));function l(e){nt(e,t,"vp")}return{currentPage:t,pageLength:49,vectImgs:n,fetchVectorization:s,setPageVectImgs:i,pageVectImgs:r,handlePageUpdate:l}}();function ms(e){let t,n;return{c(){t=new H(!1),n=A(),t.a=n},m(r,s){t.m(e[2],r,s),T(r,n,s)},p(e,n){4&n&&t.p(e[2])},d(e){e&&P(n),e&&t.d()}}}function fs(e){let t,n,r,s,o,i,c,a,d,g,p=!e[1]&&e[2]&&ms(e);return{c(){t=L("div"),n=L("figure"),r=L("div"),p&&p.c(),s=_(),o=L("img"),U(r,"class","svg-container svelte-1egync3"),u(o.src,i=e[4])||U(o,"src",i),U(o,"alt","Extracted region"),U(o,"class","svelte-1egync3"),U(n,"class","image card region-image svelte-1egync3"),V(n,"width",e[0]+"px"),V(n,"aspect-ratio",e[3]?e[3].split(" ")[2]/e[3].split(" ")[3]:1),U(t,"class","svg-regions is-center svelte-1egync3")},m(i,l){T(i,t,l),S(t,n),S(n,r),p&&p.m(r,null),S(n,s),S(n,o),a=!0,d||(g=[M(t,"mouseenter",e[6]),M(t,"mouseleave",e[7])],d=!0)},p(e,[t]){!e[1]&&e[2]?p?p.p(e,t):(p=ms(e),p.c(),p.m(r,null)):p&&(p.d(1),p=null),(!a||1&t)&&V(n,"width",e[0]+"px"),(!a||8&t)&&V(n,"aspect-ratio",e[3]?e[3].split(" ")[2]/e[3].split(" ")[3]:1)},i(e){a||(de((()=>{a&&(c||(c=Ie(t,Ae,{duration:500},!0)),c.run(1))})),a=!0)},o(e){c||(c=Ie(t,Ae,{duration:500},!1)),c.run(0),a=!1},d(e){e&&P(t),p&&p.d(),e&&c&&c.end(),d=!1,l(g)}}}function hs(e,t,n){let{svgPath:r}=t,{width:s=200}=t;const[o,i,l,c]=r.replace(".svg","").replace(".jpg","").split("_"),a=rt(`${o}_${i}_${l}`,c,`${s},`);let d=!1,u="",g="";Y((async()=>{const e=await fetch(`${We}svg/${r}`),t=await e.text(),s=(new DOMParser).parseFromString(t,"image/svg+xml"),o=s.querySelector("svg");n(3,g=o.getAttribute("viewBox")||`0 0 ${o.getAttribute("width")} ${o.getAttribute("height")}`),s.querySelectorAll("image").forEach((e=>e.remove())),o.setAttribute("viewBox",g),o.removeAttribute("width"),o.removeAttribute("height"),n(2,u=(new XMLSerializer).serializeToString(s.documentElement))}));return e.$$set=e=>{"svgPath"in e&&n(5,r=e.svgPath),"width"in e&&n(0,s=e.width)},[s,d,u,g,a,r,()=>n(1,d=!0),()=>n(1,d=!1)]}class $s extends je{constructor(e){super(),Ne(this,e,hs,fs,a,{svgPath:5,width:0})}}function ws(e){let t,n,s,o,i,l,c,a="en"===Fe?"Download All":"Tout Télécharger";return{c(){t=L("div"),n=L("button"),s=L("i"),o=_(),i=j(a),U(s,"class","fa-solid fa-download"),U(n,"class","button is-link is-light"),U(t,"class","is-right mb-3")},m(r,a){T(r,t,a),S(t,n),S(n,s),S(n,o),S(n,i),l||(c=M(n,"click",e[0]),l=!0)},p:r,i:r,o:r,d(e){e&&P(t),l=!1,c()}}}function vs(e){const t=`${window.location.origin}${window.location.pathname}`,n=parseInt(t.split("witness/")[1].replace("/","")),r=parseInt(t.split("regions/")[1].replace("/",""));return[async function(){if(!r&&!n)return void console.error("No Region or Witness");const e=r?`${window.location.origin}/${Ve}/export-regions-imgs-and-svgs/${r}`:`${window.location.origin}/${Ve}/export-all-imgs-and-svgs/${n}`;try{const t=await Ye((()=>fetch(e,{method:"GET",headers:{"X-CSRFToken":Be,"Content-Type":"application/json"}})));if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);it(await t.blob(),"vectorizations.zip")}catch(e){console.error("Erreur lors du téléchargement des vectorisations:",e)}}]}class bs extends je{constructor(e){super(),Ne(this,e,vs,ws,a,{})}}function ys(e,t,n){const r=e.slice();return r[8]=t[n],r}function xs(e){let t;let n=("en"===Fe?Is:ks)(e);return{c(){t=L("div"),n.c(),U(t,"class","faded is-center")},m(e,r){T(e,t,r),n.m(t,null)},p(e,t){n.p(e,t)},i:r,o:r,d(e){e&&P(t),n.d()}}}function ks(e){let t,n,r=e[11]+"";return{c(){t=j("Erreur lors de la récupération des régions vectorisées : "),n=j(r)},m(e,r){T(e,t,r),T(e,n,r)},p(e,t){2&t&&r!==(r=e[11]+"")&&D(n,r)},d(e){e&&P(t),e&&P(n)}}}function Is(e){let t,n,r=e[11]+"";return{c(){t=j("Error when retrieving vectorized regions: "),n=j(r)},m(e,r){T(e,t,r),T(e,n,r)},p(e,t){2&t&&r!==(r=e[11]+"")&&D(n,r)},d(e){e&&P(t),e&&P(n)}}}function Cs(e){let t,n,r=[],s=new Map,o=e[2];const i=e=>e[8].id;for(let t=0;t<o.length;t+=1){let n=ys(e,o,t),l=i(n);s.set(l,r[t]=Es(l,n))}let l=null;return o.length||(l=Ss()),{c(){for(let e=0;e<r.length;e+=1)r[e].c();t=A(),l&&l.c()},m(e,s){for(let t=0;t<r.length;t+=1)r[t]&&r[t].m(e,s);T(e,t,s),l&&l.m(e,s),n=!0},p(e,n){4&n&&(o=e[2],ve(),r=Re(r,n,i,1,e,o,s,t.parentNode,Ee,Es,t,ys),be(),!o.length&&l?l.p(e,n):o.length?l&&(l.d(1),l=null):(l=Ss(),l.c(),l.m(t.parentNode,t)))},i(e){if(!n){for(let e=0;e<o.length;e+=1)ye(r[e]);n=!0}},o(e){for(let e=0;e<r.length;e+=1)xe(r[e]);n=!1},d(e){for(let t=0;t<r.length;t+=1)r[t].d(e);e&&P(t),l&&l.d(e)}}}function Ss(e){let t,n;return{c(){t=L("div"),t.textContent=""+("en"===Fe?"No vectorization":"Pas de vectorisation"),n=_(),U(t,"class","faded is-center")},m(e,r){T(e,t,r),T(e,n,r)},p:r,d(e){e&&P(t),e&&P(n)}}}function Es(e,t){let n,r,s;return r=new $s({props:{svgPath:t[8]}}),{key:e,first:null,c(){n=A(),Te(r.$$.fragment),this.first=n},m(e,t){T(e,n,t),Pe(r,e,t),s=!0},p(e,n){t=e;const s={};4&n&&(s.svgPath=t[8]),r.$set(s)},i(e){s||(ye(r.$$.fragment,e),s=!0)},o(e){xe(r.$$.fragment,e),s=!1},d(e){e&&P(n),Oe(r,e)}}}function Rs(e){let t;return{c(){t=L("div"),t.textContent=""+("en"===Fe?"Retrieving vectorization page...":"Récupération la page de vectorisation..."),U(t,"class","faded is-center")},m(e,n){T(e,t,n)},p:r,i:r,o:r,d(e){e&&P(t)}}}function Ts(e){let t,n,r,s,o,i,l,c,a;t=new bs({}),r=new an({props:{store:ps,nbOfItems:e[0].length,pageLength:e[6]}});let d={ctx:e,current:null,token:null,hasCatch:!0,pending:Rs,then:Cs,catch:xs,value:7,error:11,blocks:[,,,]};return Ce(i=e[1],d),c=new an({props:{store:ps,nbOfItems:e[0].length,pageLength:e[6]}}),{c(){Te(t.$$.fragment),n=_(),Te(r.$$.fragment),s=_(),o=L("div"),d.block.c(),l=_(),Te(c.$$.fragment),U(o,"class","grid is-gap-2 mx-5 svelte-1mje9rl")},m(e,i){Pe(t,e,i),T(e,n,i),Pe(r,e,i),T(e,s,i),T(e,o,i),d.block.m(o,d.anchor=null),d.mount=()=>o,d.anchor=null,T(e,l,i),Pe(c,e,i),a=!0},p(t,[n]){e=t;const s={};1&n&&(s.nbOfItems=e[0].length),r.$set(s),d.ctx=e,2&n&&i!==(i=e[1])&&Ce(i,d)||Se(d,e,n);const o={};1&n&&(o.nbOfItems=e[0].length),c.$set(o)},i(e){a||(ye(t.$$.fragment,e),ye(r.$$.fragment,e),ye(d.block),ye(c.$$.fragment,e),a=!0)},o(e){xe(t.$$.fragment,e),xe(r.$$.fragment,e);for(let e=0;e<3;e+=1){xe(d.blocks[e])}xe(c.$$.fragment,e),a=!1},d(e){Oe(t,e),e&&P(n),Oe(r,e),e&&P(s),e&&P(o),d.block.d(),d.token=null,d=null,e&&P(l),Oe(c,e)}}}function Ps(e,t,n){let r,s,o;const{vectImgs:i,pageVectImgs:l,setPageVectImgs:c,pageLength:a}=ps;return m(e,i,(e=>n(0,r=e))),m(e,l,(e=>n(2,o=e))),m(e,c,(e=>n(1,s=e))),[r,s,o,i,l,c,a]}class Os extends je{constructor(e){super(),Ne(this,e,Ps,Ts,a,{})}}function Ls(e){let t;let n=("en"===Fe?js:Ns)(e);return{c(){t=L("div"),n.c(),U(t,"class","container faded is-center")},m(e,r){T(e,t,r),n.m(t,null)},p(e,t){n.p(e,t)},i:r,o:r,d(e){e&&P(t),n.d()}}}function Ns(e){let t,n,s=e[2]+"";return{c(){t=j("Erreur lors de la récupération des régions vectorisées : "),n=j(s)},m(e,r){T(e,t,r),T(e,n,r)},p:r,d(e){e&&P(t),e&&P(n)}}}function js(e){let t,n,s=e[2]+"";return{c(){t=j("Error when retrieving vectorized regions: "),n=j(s)},m(e,r){T(e,t,r),T(e,n,r)},p:r,d(e){e&&P(t),e&&P(n)}}}function _s(e){let t,n;return t=new Os({}),{c(){Te(t.$$.fragment)},m(e,r){Pe(t,e,r),n=!0},p:r,i(e){n||(ye(t.$$.fragment,e),n=!0)},o(e){xe(t.$$.fragment,e),n=!1},d(e){Oe(t,e)}}}function As(e){let t;return{c(){t=L("div"),t.textContent=""+("en"===Fe?"Retrieving vectorized regions...":"Récupération des régions vectorisées..."),U(t,"class","container faded is-center")},m(e,n){T(e,t,n)},p:r,i:r,o:r,d(e){e&&P(t)}}}function Ms(e){let t,n,r=He.includes("vectorization"),s=r&&function(e){let t,n,r={ctx:e,current:null,token:null,hasCatch:!0,pending:As,then:_s,catch:Ls,value:1,error:2,blocks:[,,,]};return Ce(e[0],r),{c(){t=A(),r.block.c()},m(e,s){T(e,t,s),r.block.m(e,r.anchor=s),r.mount=()=>t.parentNode,r.anchor=t,n=!0},p(t,n){Se(r,e=t,n)},i(e){n||(ye(r.block),n=!0)},o(e){for(let e=0;e<3;e+=1)xe(r.blocks[e]);n=!1},d(e){e&&P(t),r.block.d(e),r.token=null,r=null}}}(e);return{c(){s&&s.c(),t=A()},m(e,r){s&&s.m(e,r),T(e,t,r),n=!0},p(e,[t]){r&&s.p(e,t)},i(e){n||(ye(s),n=!0)},o(e){xe(s),n=!1},d(e){s&&s.d(e),e&&P(t)}}}function qs(e){const{fetchVectorization:t}=ps;return[t]}class Us extends je{constructor(e){super(),Ne(this,e,qs,Ms,a,{})}}function Ds(e,t,n){const r=e.slice();return r[22]=t[n][0],r[23]=t[n][1],r}function Fs(e,t,n){const r=e.slice();return r[27]=t[n],r}function Vs(e,t,n){const r=e.slice();return r[31]=t[n][0],r[23]=t[n][1],r}function zs(e){let t,n,r,s;return n=new Zt({}),{c(){t=L("div"),Te(n.$$.fragment),U(t,"class","cell")},m(e,r){T(e,t,r),Pe(n,t,null),s=!0},i(e){s||(ye(n.$$.fragment,e),de((()=>{s&&(r||(r=Ie(t,Ae,{duration:500},!0)),r.run(1))})),s=!0)},o(e){xe(n.$$.fragment,e),r||(r=Ie(t,Ae,{duration:500},!1)),r.run(0),s=!1},d(e){e&&P(t),Oe(n),e&&r&&r.end()}}}function Bs(e){let t,n,r,s,o,i,c=e[23].text+"";function a(){return e[20](e[31])}return{c(){t=L("li"),n=L("a"),r=j(c),s=_(),U(n,"href",null),z(t,"is-active",e[31]===e[3])},m(e,l){T(e,t,l),S(t,n),S(n,r),S(t,s),o||(i=[M(t,"click",a),M(t,"keyup",oo)],o=!0)},p(n,s){e=n,4&s[0]&&c!==(c=e[23].text+"")&&D(r,c),12&s[0]&&z(t,"is-active",e[31]===e[3])},d(e){e&&P(t),o=!1,l(i)}}}function Hs(e){let t,n;return t=new Us({}),{c(){Te(t.$$.fragment)},m(e,r){Pe(t,e,r),n=!0},p:r,i(e){n||(ye(t.$$.fragment,e),n=!0)},o(e){xe(t.$$.fragment,e),n=!1},d(e){Oe(t,e)}}}function Js(e){let t,n;return t=new Ur({}),{c(){Te(t.$$.fragment)},m(e,r){Pe(t,e,r),n=!0},p:r,i(e){n||(ye(t.$$.fragment,e),n=!0)},o(e){xe(t.$$.fragment,e),n=!1},d(e){Oe(t,e)}}}function Xs(e){let t,n;return t=new ns({}),{c(){Te(t.$$.fragment)},m(e,r){Pe(t,e,r),n=!0},p:r,i(e){n||(ye(t.$$.fragment,e),n=!0)},o(e){xe(t.$$.fragment,e),n=!1},d(e){Oe(t,e)}}}function Zs(e){let t,n,r={ctx:e,current:null,token:null,hasCatch:!0,pending:Ys,then:Gs,catch:Ws,value:26,error:30,blocks:[,,,]};return Ce(e[9],r),{c(){t=L("div"),r.block.c(),U(t,"class","grid is-gap-2")},m(e,s){T(e,t,s),r.block.m(t,r.anchor=null),r.mount=()=>t,r.anchor=null,n=!0},p(t,n){Se(r,e=t,n)},i(e){n||(ye(r.block),n=!0)},o(e){for(let e=0;e<3;e+=1){xe(r.blocks[e])}n=!1},d(e){e&&P(t),r.block.d(),r.token=null,r=null}}}function Ws(e){let t,n,s,o=e[30]+"";return{c(){t=L("div"),n=j("Error when retrieving regions: "),s=j(o)},m(e,r){T(e,t,r),S(t,n),S(t,s)},p:r,i:r,o:r,d(e){e&&P(t)}}}function Gs(e){let t,n,r=[],s=new Map,o=Object.values(e[6]);const i=e=>e[27].id;for(let t=0;t<o.length;t+=1){let n=Fs(e,o,t),l=i(n);s.set(l,r[t]=Ks(l,n))}let l=null;return o.length||(l=Qs(e)),{c(){for(let e=0;e<r.length;e+=1)r[e].c();t=A(),l&&l.c()},m(e,s){for(let t=0;t<r.length;t+=1)r[t]&&r[t].m(e,s);T(e,t,s),l&&l.m(e,s),n=!0},p(e,n){3136&n[0]&&(o=Object.values(e[6]),ve(),r=Re(r,n,i,1,e,o,s,t.parentNode,Ee,Ks,t,Fs),be(),!o.length&&l?l.p(e,n):o.length?l&&(ve(),xe(l,1,1,(()=>{l=null})),be()):(l=Qs(e),l.c(),ye(l,1),l.m(t.parentNode,t)))},i(e){if(!n){for(let e=0;e<o.length;e+=1)ye(r[e]);n=!0}},o(e){for(let e=0;e<r.length;e+=1)xe(r[e]);n=!1},d(e){for(let t=0;t<r.length;t+=1)r[t].d(e);e&&P(t),l&&l.d(e)}}}function Qs(e){let t,n;return t=new Pt({props:{currentRegionId:e[11],baseUrl:e[10]}}),{c(){Te(t.$$.fragment)},m(e,r){Pe(t,e,r),n=!0},p:r,i(e){n||(ye(t.$$.fragment,e),n=!0)},o(e){xe(t.$$.fragment,e),n=!1},d(e){Oe(t,e)}}}function Ks(e,t){let n,r,s;return r=new xt({props:{item:t[27]}}),{key:e,first:null,c(){n=A(),Te(r.$$.fragment),this.first=n},m(e,t){T(e,n,t),Pe(r,e,t),s=!0},p(e,n){t=e;const s={};64&n[0]&&(s.item=t[27]),r.$set(s)},i(e){s||(ye(r.$$.fragment,e),s=!0)},o(e){xe(r.$$.fragment,e),s=!1},d(e){e&&P(n),Oe(r,e)}}}function Ys(e){let t;return{c(){t=L("div"),t.textContent=""+("en"===Fe?"Retrieving regions...":"Récupération des régions..."),U(t,"class","faded is-center")},m(e,n){T(e,t,n)},p:r,i:r,o:r,d(e){e&&P(t)}}}function eo(e){let t;return{c(){t=L("div"),t.textContent=""+("en"===Fe?"No regions in selection":"Aucune région sélectionnée")},m(e,n){T(e,t,n)},p:r,d(e){e&&P(t)}}}function to(e){let t,n,r=Object.entries(e[1]),s=[];for(let t=0;t<r.length;t+=1)s[t]=no(Ds(e,r,t));return{c(){t=L("div"),n=L("div");for(let e=0;e<s.length;e+=1)s[e].c();U(n,"class","grid is-gap-2"),U(t,"class","fixed-grid has-6-cols")},m(e,r){T(e,t,r),S(t,n);for(let e=0;e<s.length;e+=1)s[e]&&s[e].m(n,null)},p(e,t){if(2&t[0]){let o;for(r=Object.entries(e[1]),o=0;o<r.length;o+=1){const i=Ds(e,r,o);s[o]?s[o].p(i,t):(s[o]=no(i),s[o].c(),s[o].m(n,null))}for(;o<s.length;o+=1)s[o].d(1);s.length=r.length}},d(e){e&&P(t),O(s,e)}}}function no(e){let t,n,r,s,o,i,l,c,a,d,g,p,m,f=e[23].title+"";function h(){return e[21](e[22])}return{c(){t=L("div"),n=L("figure"),r=L("img"),o=_(),i=L("div"),l=L("span"),c=j(f),a=_(),d=L("button"),g=_(),u(r.src,s=rt(e[23].img,e[23].xyhw,"96,"))||U(r,"src",s),U(r,"alt","Extracted region"),U(l,"class","overlay-desc"),U(i,"class","overlay is-center svelte-1mm19e2"),U(n,"class","image is-64x64 card"),U(d,"class","delete region-btn"),U(d,"aria-label","remove from selection"),U(t,"class","selection cell svelte-1mm19e2")},m(e,s){T(e,t,s),S(t,n),S(n,r),S(n,o),S(n,i),S(i,l),S(l,c),S(t,a),S(t,d),S(t,g),p||(m=M(d,"click",h),p=!0)},p(t,n){e=t,2&n[0]&&!u(r.src,s=rt(e[23].img,e[23].xyhw,"96,"))&&U(r,"src",s),2&n[0]&&f!==(f=e[23].title+"")&&D(c,f)},d(e){e&&P(t),p=!1,m()}}}function ro(e){let t;function n(e,t){return e[4]?to:eo}let r=n(e),s=r(e);return{c(){s.c(),t=A()},m(e,n){s.m(e,n),T(e,t,n)},p(e,o){r===(r=n(e))&&s?s.p(e,o):(s.d(1),s=r(e),s&&(s.c(),s.m(t.parentNode,t)))},d(e){s.d(e),e&&P(t)}}}function so(e){let t,n,r,s,o,i,l,c,a,d,u,g,p,m,f,h,$,w,v,b,y=["all","page"].includes(e[3]);t=new mt({props:{visible:e[5]}}),r=new Et({}),o=new Ct({props:{selectionLength:e[0]}}),d=new Ut({props:{baseUrl:e[10],currentRegionId:e[11],currentLayout:e[3]}});let x=y&&zs(),k=Object.entries(e[2]),I=[];for(let t=0;t<k.length;t+=1)I[t]=Bs(Vs(e,k,t));const C=[Zs,Xs,Js,Hs],E=[];function R(e,t){return"all"===e[3]?0:"page"===e[3]?1:"similarity"===e[3]?2:"vectorization"===e[3]?3:-1}return~(h=R(e))&&($=E[h]=C[h](e)),v=new gs({props:{isRegion:!0,selectionLength:e[0],$$slots:{default:[ro]},$$scope:{ctx:e}}}),{c(){Te(t.$$.fragment),n=_(),Te(r.$$.fragment),s=_(),Te(o.$$.fragment),i=_(),l=L("div"),c=L("div"),a=L("div"),Te(d.$$.fragment),u=_(),x&&x.c(),g=_(),p=L("div"),m=L("ul");for(let e=0;e<I.length;e+=1)I[e].c();f=_(),$&&$.c(),w=_(),Te(v.$$.fragment),U(a,"class","cell is-left is-middle"),U(c,"class","actions grid"),U(m,"class","panel-tabs svelte-1mm19e2"),U(p,"class","tabs is-centered"),U(l,"id","nav-actions"),U(l,"class","mb-5 svelte-1mm19e2")},m(e,$){Pe(t,e,$),T(e,n,$),Pe(r,e,$),T(e,s,$),Pe(o,e,$),T(e,i,$),T(e,l,$),S(l,c),S(c,a),Pe(d,a,null),S(c,u),x&&x.m(c,null),S(l,g),S(l,p),S(p,m);for(let e=0;e<I.length;e+=1)I[e]&&I[e].m(m,null);T(e,f,$),~h&&E[h].m(e,$),T(e,w,$),Pe(v,e,$),b=!0},p(e,n){const r={};32&n[0]&&(r.visible=e[5]),t.$set(r);const s={};1&n[0]&&(s.selectionLength=e[0]),o.$set(s);const i={};if(8&n[0]&&(i.currentLayout=e[3]),d.$set(i),8&n[0]&&(y=["all","page"].includes(e[3])),y?x?8&n[0]&&ye(x,1):(x=zs(),x.c(),ye(x,1),x.m(c,null)):x&&(ve(),xe(x,1,1,(()=>{x=null})),be()),4108&n[0]){let t;for(k=Object.entries(e[2]),t=0;t<k.length;t+=1){const r=Vs(e,k,t);I[t]?I[t].p(r,n):(I[t]=Bs(r),I[t].c(),I[t].m(m,null))}for(;t<I.length;t+=1)I[t].d(1);I.length=k.length}let l=h;h=R(e),h===l?~h&&E[h].p(e,n):($&&(ve(),xe(E[l],1,1,(()=>{E[l]=null})),be()),~h?($=E[h],$?$.p(e,n):($=E[h]=C[h](e),$.c()),ye($,1),$.m(w.parentNode,w)):$=null);const a={};1&n[0]&&(a.selectionLength=e[0]),18&n[0]|8&n[1]&&(a.$$scope={dirty:n,ctx:e}),v.$set(a)},i(e){b||(ye(t.$$.fragment,e),ye(r.$$.fragment,e),ye(o.$$.fragment,e),ye(d.$$.fragment,e),ye(x),ye($),ye(v.$$.fragment,e),b=!0)},o(e){xe(t.$$.fragment,e),xe(r.$$.fragment,e),xe(o.$$.fragment,e),xe(d.$$.fragment,e),xe(x),xe($),xe(v.$$.fragment,e),b=!1},d(e){Oe(t,e),e&&P(n),Oe(r,e),e&&P(s),Oe(o,e),e&&P(i),e&&P(l),Oe(d),x&&x.d(),O(I,e),e&&P(f),~h&&E[h].d(e),e&&P(w),Oe(v,e)}}}const oo=()=>null;function io(e,t,n){let r,s,o,i,l,c,a;m(e,Qe,(e=>n(5,c=e)));const{selected:d}=at;m(e,d,(e=>n(19,l=e)));const{allRegions:u,fetchAll:g}=dt;m(e,u,(e=>n(6,a=e)));let{manifest:p=""}=t,{isValidated:f=!1}=t,{imgPrefix:h=""}=t,{nbOfPages:$=1}=t,{trailingZeros:w=1}=t,{witness:v={}}=t;ne("witness",v),ne("nbOfPages",$),ne("trailingZeros",w),ne("imgPrefix",h),ne("manifest",p),ne("isValidated",f);const b=`${window.location.origin}${window.location.pathname}`,y=parseInt(b.split("regions/")[1].replace("/","")),x={all:{text:"en"===Fe?"All regions":"Toutes les régions"},page:{text:"en"===Fe?"Per page":"Par page"}};function k(e){n(3,i=e);const t=new URL(window.location);t.searchParams.set("tab",e),window.history.pushState({},"",t)}He.includes("similarity")&&(x.similarity={text:"en"===Fe?"Similarity":"Similarité"}),He.includes("vectorization")&&(x.vectorization={text:"en"===Fe?"Vectorization":"Vectorisation"});return e.$$set=e=>{"manifest"in e&&n(13,p=e.manifest),"isValidated"in e&&n(14,f=e.isValidated),"imgPrefix"in e&&n(15,h=e.imgPrefix),"nbOfPages"in e&&n(16,$=e.nbOfPages),"trailingZeros"in e&&n(17,w=e.trailingZeros),"witness"in e&&n(18,v=e.witness)},e.$$.update=()=>{524288&e.$$.dirty[0]&&n(1,r=l(!0)),2&e.$$.dirty[0]&&n(0,s=Object.keys(r).length),1&e.$$.dirty[0]&&n(4,o=s>0)},n(3,i=new URLSearchParams(window.location.search).get("tab")??"all"),[s,r,x,i,o,c,a,d,u,g,b,y,k,p,f,h,$,w,v,l,e=>k(e),e=>at.remove(e,Je)]}return new class extends je{constructor(e){super(),Ne(this,e,io,so,a,{manifest:13,isValidated:14,imgPrefix:15,nbOfPages:16,trailingZeros:17,witness:18},null,[-1,-1])}}({target:document.getElementById("region-list"),props:{witness:witness,manifest:manifest,isValidated:isValidated,imgPrefix:imgPrefix,nbOfPages:nbOfPages,trailingZeros:trailingZeros}})}(noUiSlider,0,Choices);
//# sourceMappingURL=regionList.js.map
